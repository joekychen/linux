<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-tegra › tegra2_clocks.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tegra2_clocks.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * arch/arm/mach-tegra/tegra2_clocks.c</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2010 Google, Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * Author:</span>
<span class="cm"> *	Colin Cross &lt;ccross@google.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This software is licensed under the terms of the GNU General Public</span>
<span class="cm"> * License version 2, as published by the Free Software Foundation, and</span>
<span class="cm"> * may be copied, distributed, and modified under those terms.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/clkdev.h&gt;</span>
<span class="cp">#include &lt;linux/clk.h&gt;</span>

<span class="cp">#include &lt;mach/iomap.h&gt;</span>
<span class="cp">#include &lt;mach/suspend.h&gt;</span>

<span class="cp">#include &quot;clock.h&quot;</span>
<span class="cp">#include &quot;fuse.h&quot;</span>
<span class="cp">#include &quot;tegra2_emc.h&quot;</span>

<span class="cp">#define RST_DEVICES			0x004</span>
<span class="cp">#define RST_DEVICES_SET			0x300</span>
<span class="cp">#define RST_DEVICES_CLR			0x304</span>
<span class="cp">#define RST_DEVICES_NUM			3</span>

<span class="cp">#define CLK_OUT_ENB			0x010</span>
<span class="cp">#define CLK_OUT_ENB_SET			0x320</span>
<span class="cp">#define CLK_OUT_ENB_CLR			0x324</span>
<span class="cp">#define CLK_OUT_ENB_NUM			3</span>

<span class="cp">#define CLK_MASK_ARM			0x44</span>
<span class="cp">#define MISC_CLK_ENB			0x48</span>

<span class="cp">#define OSC_CTRL			0x50</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_MASK		(3&lt;&lt;30)</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_13MHZ		(0&lt;&lt;30)</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_19_2MHZ	(1&lt;&lt;30)</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_12MHZ		(2&lt;&lt;30)</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_26MHZ		(3&lt;&lt;30)</span>
<span class="cp">#define OSC_CTRL_MASK			(0x3f2 | OSC_CTRL_OSC_FREQ_MASK)</span>

<span class="cp">#define OSC_FREQ_DET			0x58</span>
<span class="cp">#define OSC_FREQ_DET_TRIG		(1&lt;&lt;31)</span>

<span class="cp">#define OSC_FREQ_DET_STATUS		0x5C</span>
<span class="cp">#define OSC_FREQ_DET_BUSY		(1&lt;&lt;31)</span>
<span class="cp">#define OSC_FREQ_DET_CNT_MASK		0xFFFF</span>

<span class="cp">#define PERIPH_CLK_SOURCE_I2S1		0x100</span>
<span class="cp">#define PERIPH_CLK_SOURCE_EMC		0x19c</span>
<span class="cp">#define PERIPH_CLK_SOURCE_OSC		0x1fc</span>
<span class="cp">#define PERIPH_CLK_SOURCE_NUM \</span>
<span class="cp">	((PERIPH_CLK_SOURCE_OSC - PERIPH_CLK_SOURCE_I2S1) / 4)</span>

<span class="cp">#define PERIPH_CLK_SOURCE_MASK		(3&lt;&lt;30)</span>
<span class="cp">#define PERIPH_CLK_SOURCE_SHIFT		30</span>
<span class="cp">#define PERIPH_CLK_SOURCE_ENABLE	(1&lt;&lt;28)</span>
<span class="cp">#define PERIPH_CLK_SOURCE_DIVU71_MASK	0xFF</span>
<span class="cp">#define PERIPH_CLK_SOURCE_DIVU16_MASK	0xFFFF</span>
<span class="cp">#define PERIPH_CLK_SOURCE_DIV_SHIFT	0</span>

<span class="cp">#define SDMMC_CLK_INT_FB_SEL		(1 &lt;&lt; 23)</span>
<span class="cp">#define SDMMC_CLK_INT_FB_DLY_SHIFT	16</span>
<span class="cp">#define SDMMC_CLK_INT_FB_DLY_MASK	(0xF &lt;&lt; SDMMC_CLK_INT_FB_DLY_SHIFT)</span>

<span class="cp">#define PLL_BASE			0x0</span>
<span class="cp">#define PLL_BASE_BYPASS			(1&lt;&lt;31)</span>
<span class="cp">#define PLL_BASE_ENABLE			(1&lt;&lt;30)</span>
<span class="cp">#define PLL_BASE_REF_ENABLE		(1&lt;&lt;29)</span>
<span class="cp">#define PLL_BASE_OVERRIDE		(1&lt;&lt;28)</span>
<span class="cp">#define PLL_BASE_DIVP_MASK		(0x7&lt;&lt;20)</span>
<span class="cp">#define PLL_BASE_DIVP_SHIFT		20</span>
<span class="cp">#define PLL_BASE_DIVN_MASK		(0x3FF&lt;&lt;8)</span>
<span class="cp">#define PLL_BASE_DIVN_SHIFT		8</span>
<span class="cp">#define PLL_BASE_DIVM_MASK		(0x1F)</span>
<span class="cp">#define PLL_BASE_DIVM_SHIFT		0</span>

<span class="cp">#define PLL_OUT_RATIO_MASK		(0xFF&lt;&lt;8)</span>
<span class="cp">#define PLL_OUT_RATIO_SHIFT		8</span>
<span class="cp">#define PLL_OUT_OVERRIDE		(1&lt;&lt;2)</span>
<span class="cp">#define PLL_OUT_CLKEN			(1&lt;&lt;1)</span>
<span class="cp">#define PLL_OUT_RESET_DISABLE		(1&lt;&lt;0)</span>

<span class="cp">#define PLL_MISC(c)			(((c)-&gt;flags &amp; PLL_ALT_MISC_REG) ? 0x4 : 0xc)</span>

<span class="cp">#define PLL_MISC_DCCON_SHIFT		20</span>
<span class="cp">#define PLL_MISC_CPCON_SHIFT		8</span>
<span class="cp">#define PLL_MISC_CPCON_MASK		(0xF&lt;&lt;PLL_MISC_CPCON_SHIFT)</span>
<span class="cp">#define PLL_MISC_LFCON_SHIFT		4</span>
<span class="cp">#define PLL_MISC_LFCON_MASK		(0xF&lt;&lt;PLL_MISC_LFCON_SHIFT)</span>
<span class="cp">#define PLL_MISC_VCOCON_SHIFT		0</span>
<span class="cp">#define PLL_MISC_VCOCON_MASK		(0xF&lt;&lt;PLL_MISC_VCOCON_SHIFT)</span>

<span class="cp">#define PLLU_BASE_POST_DIV		(1&lt;&lt;20)</span>

<span class="cp">#define PLLD_MISC_CLKENABLE		(1&lt;&lt;30)</span>
<span class="cp">#define PLLD_MISC_DIV_RST		(1&lt;&lt;23)</span>
<span class="cp">#define PLLD_MISC_DCCON_SHIFT		12</span>

<span class="cp">#define PLLE_MISC_READY			(1 &lt;&lt; 15)</span>

<span class="cp">#define PERIPH_CLK_TO_ENB_REG(c)	((c-&gt;u.periph.clk_num / 32) * 4)</span>
<span class="cp">#define PERIPH_CLK_TO_ENB_SET_REG(c)	((c-&gt;u.periph.clk_num / 32) * 8)</span>
<span class="cp">#define PERIPH_CLK_TO_ENB_BIT(c)	(1 &lt;&lt; (c-&gt;u.periph.clk_num % 32))</span>

<span class="cp">#define SUPER_CLK_MUX			0x00</span>
<span class="cp">#define SUPER_STATE_SHIFT		28</span>
<span class="cp">#define SUPER_STATE_MASK		(0xF &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_STATE_STANDBY		(0x0 &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_STATE_IDLE		(0x1 &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_STATE_RUN			(0x2 &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_STATE_IRQ			(0x3 &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_STATE_FIQ			(0x4 &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_SOURCE_MASK		0xF</span>
<span class="cp">#define	SUPER_FIQ_SOURCE_SHIFT		12</span>
<span class="cp">#define	SUPER_IRQ_SOURCE_SHIFT		8</span>
<span class="cp">#define	SUPER_RUN_SOURCE_SHIFT		4</span>
<span class="cp">#define	SUPER_IDLE_SOURCE_SHIFT		0</span>

<span class="cp">#define SUPER_CLK_DIVIDER		0x04</span>

<span class="cp">#define BUS_CLK_DISABLE			(1&lt;&lt;3)</span>
<span class="cp">#define BUS_CLK_DIV_MASK		0x3</span>

<span class="cp">#define PMC_CTRL			0x0</span>
 <span class="cp">#define PMC_CTRL_BLINK_ENB		(1 &lt;&lt; 7)</span>

<span class="cp">#define PMC_DPD_PADS_ORIDE		0x1c</span>
 <span class="cp">#define PMC_DPD_PADS_ORIDE_BLINK_ENB	(1 &lt;&lt; 20)</span>

<span class="cp">#define PMC_BLINK_TIMER_DATA_ON_SHIFT	0</span>
<span class="cp">#define PMC_BLINK_TIMER_DATA_ON_MASK	0x7fff</span>
<span class="cp">#define PMC_BLINK_TIMER_ENB		(1 &lt;&lt; 15)</span>
<span class="cp">#define PMC_BLINK_TIMER_DATA_OFF_SHIFT	16</span>
<span class="cp">#define PMC_BLINK_TIMER_DATA_OFF_MASK	0xffff</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg_clk_base</span> <span class="o">=</span> <span class="n">IO_ADDRESS</span><span class="p">(</span><span class="n">TEGRA_CLK_RESET_BASE</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg_pmc_base</span> <span class="o">=</span> <span class="n">IO_ADDRESS</span><span class="p">(</span><span class="n">TEGRA_PMC_BASE</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Some clocks share a register with other clocks.  Any clock op that</span>
<span class="cm"> * non-atomically modifies a register used by another clock must lock</span>
<span class="cm"> * clock_register_lock first.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">DEFINE_SPINLOCK</span><span class="p">(</span><span class="n">clock_register_lock</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Some peripheral clocks share an enable bit, so refcount the enable bits</span>
<span class="cm"> * in registers CLK_ENABLE_L, CLK_ENABLE_H, and CLK_ENABLE_U</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">tegra_periph_clk_enable_refcount</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">32</span><span class="p">];</span>

<span class="cp">#define clk_writel(value, reg) \</span>
<span class="cp">	__raw_writel(value, reg_clk_base + (reg))</span>
<span class="cp">#define clk_readl(reg) \</span>
<span class="cp">	__raw_readl(reg_clk_base + (reg))</span>
<span class="cp">#define pmc_writel(value, reg) \</span>
<span class="cp">	__raw_writel(value, reg_pmc_base + (reg))</span>
<span class="cp">#define pmc_readl(reg) \</span>
<span class="cp">	__raw_readl(reg_pmc_base + (reg))</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">clk_measure_input_freq</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">clock_autodetect</span><span class="p">;</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">OSC_FREQ_DET_TRIG</span> <span class="o">|</span> <span class="mi">1</span><span class="p">,</span> <span class="n">OSC_FREQ_DET</span><span class="p">);</span>
	<span class="k">do</span> <span class="p">{}</span> <span class="k">while</span> <span class="p">(</span><span class="n">clk_readl</span><span class="p">(</span><span class="n">OSC_FREQ_DET_STATUS</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">OSC_FREQ_DET_BUSY</span><span class="p">);</span>
	<span class="n">clock_autodetect</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">OSC_FREQ_DET_STATUS</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">clock_autodetect</span> <span class="o">&gt;=</span> <span class="mi">732</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">clock_autodetect</span> <span class="o">&lt;=</span> <span class="mi">732</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">12000000</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">clock_autodetect</span> <span class="o">&gt;=</span> <span class="mi">794</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">clock_autodetect</span> <span class="o">&lt;=</span> <span class="mi">794</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">13000000</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">clock_autodetect</span> <span class="o">&gt;=</span> <span class="mi">1172</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">clock_autodetect</span> <span class="o">&lt;=</span> <span class="mi">1172</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">19200000</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">clock_autodetect</span> <span class="o">&gt;=</span> <span class="mi">1587</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">clock_autodetect</span> <span class="o">&lt;=</span> <span class="mi">1587</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">26000000</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Unexpected clock autodetect value %d&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">clock_autodetect</span><span class="p">);</span>
		<span class="n">BUG</span><span class="p">();</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">clk_div71_get_divider</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s64</span> <span class="n">divider_u71</span> <span class="o">=</span> <span class="n">parent_rate</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">divider_u71</span> <span class="o">+=</span> <span class="n">rate</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">do_div</span><span class="p">(</span><span class="n">divider_u71</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">divider_u71</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">divider_u71</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">divider_u71</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">clk_div16_get_divider</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s64</span> <span class="n">divider_u16</span><span class="p">;</span>

	<span class="n">divider_u16</span> <span class="o">=</span> <span class="n">parent_rate</span><span class="p">;</span>
	<span class="n">divider_u16</span> <span class="o">+=</span> <span class="n">rate</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">do_div</span><span class="p">(</span><span class="n">divider_u16</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">divider_u16</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">divider_u16</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">divider_u16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* clk_m functions */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">tegra2_clk_m_autodetect_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">auto_clock_control</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">OSC_CTRL</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">OSC_CTRL_OSC_FREQ_MASK</span><span class="p">;</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">clk_measure_input_freq</span><span class="p">();</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">12000000</span>:
		<span class="n">auto_clock_control</span> <span class="o">|=</span> <span class="n">OSC_CTRL_OSC_FREQ_12MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">13000000</span>:
		<span class="n">auto_clock_control</span> <span class="o">|=</span> <span class="n">OSC_CTRL_OSC_FREQ_13MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">19200000</span>:
		<span class="n">auto_clock_control</span> <span class="o">|=</span> <span class="n">OSC_CTRL_OSC_FREQ_19_2MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">26000000</span>:
		<span class="n">auto_clock_control</span> <span class="o">|=</span> <span class="n">OSC_CTRL_OSC_FREQ_26MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Unexpected clock rate %ld&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">);</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">auto_clock_control</span><span class="p">,</span> <span class="n">OSC_CTRL</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_clk_m_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="n">tegra2_clk_m_autodetect_rate</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_clk_m_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_clk_m_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="n">BUG</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_clk_m_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="n">tegra2_clk_m_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>		<span class="o">=</span> <span class="n">tegra2_clk_m_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>	<span class="o">=</span> <span class="n">tegra2_clk_m_disable</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* super clock functions */</span>
<span class="cm">/* &quot;super clocks&quot; on tegra have two-stage muxes and a clock skipping</span>
<span class="cm"> * super divider.  We will ignore the clock skipping divider, since we</span>
<span class="cm"> * can&#39;t lower the voltage when using the clock skip, but we can if we</span>
<span class="cm"> * lower the PLL frequency.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_super_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">source</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">shift</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_MUX</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">ON</span><span class="p">;</span>
	<span class="n">BUG_ON</span><span class="p">(((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SUPER_STATE_RUN</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SUPER_STATE_IDLE</span><span class="p">));</span>
	<span class="n">shift</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">==</span> <span class="n">SUPER_STATE_IDLE</span><span class="p">)</span> <span class="o">?</span>
		<span class="n">SUPER_IDLE_SOURCE_SHIFT</span> <span class="o">:</span> <span class="n">SUPER_RUN_SOURCE_SHIFT</span><span class="p">;</span>
	<span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">SUPER_SOURCE_MASK</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">==</span> <span class="n">source</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_super_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_DIVIDER</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_super_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="cm">/* oops - don&#39;t disable the CPU clock! */</span>
	<span class="n">BUG</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_super_clk_set_parent</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">shift</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_MUX</span><span class="p">);</span>
	<span class="n">BUG_ON</span><span class="p">(((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SUPER_STATE_RUN</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SUPER_STATE_IDLE</span><span class="p">));</span>
	<span class="n">shift</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">==</span> <span class="n">SUPER_STATE_IDLE</span><span class="p">)</span> <span class="o">?</span>
		<span class="n">SUPER_IDLE_SOURCE_SHIFT</span> <span class="o">:</span> <span class="n">SUPER_RUN_SOURCE_SHIFT</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">SUPER_SOURCE_MASK</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">)</span>
				<span class="n">clk_enable</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

			<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span> <span class="o">&amp;&amp;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span>
				<span class="n">clk_disable</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

			<span class="n">clk_reparent</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Super clocks have &quot;clock skippers&quot; instead of dividers.  Dividing using</span>
<span class="cm"> * a clock skipper does not allow the voltage to be scaled down, so instead</span>
<span class="cm"> * adjust the rate of the parent clock.  This requires that the parent of a</span>
<span class="cm"> * super clock have no other children, otherwise the rate will change</span>
<span class="cm"> * underneath the other children.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_super_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">clk_set_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_super_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="n">tegra2_super_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="n">tegra2_super_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="n">tegra2_super_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span>		<span class="o">=</span> <span class="n">tegra2_super_clk_set_parent</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="n">tegra2_super_clk_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* virtual cpu clock functions */</span>
<span class="cm">/* some clocks can not be stopped (cpu, memory bus) while the SoC is running.</span>
<span class="cm">   To change the frequency of these clocks, the parent pll may need to be</span>
<span class="cm">   reprogrammed, so the clock must be moved off the pll, the pll reprogrammed,</span>
<span class="cm">   and then the clock moved back to the pll.  To hide this sequence, a virtual</span>
<span class="cm">   clock handles it.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_cpu_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_cpu_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_cpu_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="cm">/* oops - don&#39;t disable the CPU clock! */</span>
	<span class="n">BUG</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_cpu_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * Take an extra reference to the main pll so it doesn&#39;t turn</span>
<span class="cm">	 * off when we move the cpu off of it</span>
<span class="cm">	 */</span>
	<span class="n">clk_enable</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="n">main</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">clk_set_parent</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="n">backup</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Failed to switch cpu to clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="n">backup</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">==</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="n">backup</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">clk_set_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="n">main</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Failed to change cpu pll to %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">clk_set_parent</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="n">main</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Failed to switch cpu to clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="n">main</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

<span class="nl">out:</span>
	<span class="n">clk_disable</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">cpu</span><span class="p">.</span><span class="n">main</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_cpu_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>     <span class="o">=</span> <span class="n">tegra2_cpu_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>   <span class="o">=</span> <span class="n">tegra2_cpu_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>  <span class="o">=</span> <span class="n">tegra2_cpu_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="n">tegra2_cpu_clk_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* virtual cop clock functions. Used to acquire the fake &#39;cop&#39; clock to</span>
<span class="cm"> * reset the COP block (i.e. AVP) */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_cop_clk_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">bool</span> <span class="n">assert</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">assert</span> <span class="o">?</span> <span class="n">RST_DEVICES_SET</span> <span class="o">:</span> <span class="n">RST_DEVICES_CLR</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">assert</span> <span class="o">?</span> <span class="s">&quot;assert&quot;</span> <span class="o">:</span> <span class="s">&quot;deassert&quot;</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_cop_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">reset</span>    <span class="o">=</span> <span class="n">tegra2_cop_clk_reset</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* bus clock functions */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_bus_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">BUS_CLK_DISABLE</span><span class="p">)</span> <span class="o">?</span> <span class="n">OFF</span> <span class="o">:</span> <span class="n">ON</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">BUS_CLK_DIV_MASK</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_bus_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">BUS_CLK_DISABLE</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_bus_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">BUS_CLK_DISABLE</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_bus_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">==</span> <span class="n">parent_rate</span> <span class="o">/</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">BUS_CLK_DIV_MASK</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
			<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_bus_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="n">tegra2_bus_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="n">tegra2_bus_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="n">tegra2_bus_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="n">tegra2_bus_clk_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Blink output functions */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_blink_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_CTRL</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PMC_CTRL_BLINK_ENB</span><span class="p">)</span> <span class="o">?</span> <span class="n">ON</span> <span class="o">:</span> <span class="n">OFF</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PMC_BLINK_TIMER_ENB</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">on_off</span><span class="p">;</span>

		<span class="n">on_off</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">PMC_BLINK_TIMER_DATA_ON_SHIFT</span><span class="p">)</span> <span class="o">&amp;</span>
			<span class="n">PMC_BLINK_TIMER_DATA_ON_MASK</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">&gt;&gt;=</span> <span class="n">PMC_BLINK_TIMER_DATA_OFF_SHIFT</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="n">PMC_BLINK_TIMER_DATA_OFF_MASK</span><span class="p">;</span>
		<span class="n">on_off</span> <span class="o">+=</span> <span class="n">val</span><span class="p">;</span>
		<span class="cm">/* each tick in the blink timer is 4 32KHz clocks */</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">on_off</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_blink_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_DPD_PADS_ORIDE</span><span class="p">);</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span> <span class="o">|</span> <span class="n">PMC_DPD_PADS_ORIDE_BLINK_ENB</span><span class="p">,</span> <span class="n">PMC_DPD_PADS_ORIDE</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_CTRL</span><span class="p">);</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span> <span class="o">|</span> <span class="n">PMC_CTRL_BLINK_ENB</span><span class="p">,</span> <span class="n">PMC_CTRL</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_blink_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_CTRL</span><span class="p">);</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">PMC_CTRL_BLINK_ENB</span><span class="p">,</span> <span class="n">PMC_CTRL</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_DPD_PADS_ORIDE</span><span class="p">);</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">PMC_DPD_PADS_ORIDE_BLINK_ENB</span><span class="p">,</span> <span class="n">PMC_DPD_PADS_ORIDE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_blink_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&gt;=</span> <span class="n">parent_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">pmc_writel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">on_off</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

		<span class="n">on_off</span> <span class="o">=</span> <span class="n">DIV_ROUND_UP</span><span class="p">(</span><span class="n">parent_rate</span> <span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">on_off</span> <span class="o">*</span> <span class="mi">8</span><span class="p">;</span>

		<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">on_off</span> <span class="o">&amp;</span> <span class="n">PMC_BLINK_TIMER_DATA_ON_MASK</span><span class="p">)</span> <span class="o">&lt;&lt;</span>
			<span class="n">PMC_BLINK_TIMER_DATA_ON_SHIFT</span><span class="p">;</span>
		<span class="n">on_off</span> <span class="o">&amp;=</span> <span class="n">PMC_BLINK_TIMER_DATA_OFF_MASK</span><span class="p">;</span>
		<span class="n">on_off</span> <span class="o">&lt;&lt;=</span> <span class="n">PMC_BLINK_TIMER_DATA_OFF_SHIFT</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">on_off</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">PMC_BLINK_TIMER_ENB</span><span class="p">;</span>
		<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_blink_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_blink_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_blink_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_blink_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_blink_clk_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* PLL Functions */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_pll_clk_wait_for_lock</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">udelay</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">lock_delay</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_pll_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_ENABLE</span><span class="p">)</span> <span class="o">?</span> <span class="n">ON</span> <span class="o">:</span> <span class="n">OFF</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLL_FIXED</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_OVERRIDE</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_warning</span><span class="p">(</span><span class="s">&quot;Clock %s has unknown fixed frequency</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_BYPASS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_DIVN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">PLL_BASE_DIVN_SHIFT</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_DIVM_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">PLL_BASE_DIVM_SHIFT</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLU</span><span class="p">)</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">*=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLLU_BASE_POST_DIV</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">*=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_DIVP_MASK</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_pll_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PLL_BASE_BYPASS</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">PLL_BASE_ENABLE</span><span class="p">;</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>

	<span class="n">tegra2_pll_clk_wait_for_lock</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_pll_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">PLL_BASE_BYPASS</span> <span class="o">|</span> <span class="n">PLL_BASE_ENABLE</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_pll_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">input_rate</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="n">input_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">freq_table</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input_rate</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input_rate</span> <span class="o">==</span> <span class="n">input_rate</span> <span class="o">&amp;&amp;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">output_rate</span> <span class="o">==</span> <span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">m</span> <span class="o">*</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">;</span>

			<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLL_FIXED</span><span class="p">)</span>
				<span class="n">val</span> <span class="o">|=</span> <span class="n">PLL_BASE_OVERRIDE</span><span class="p">;</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">PLL_BASE_DIVP_MASK</span> <span class="o">|</span> <span class="n">PLL_BASE_DIVN_MASK</span> <span class="o">|</span>
				 <span class="n">PLL_BASE_DIVM_MASK</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">m</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_BASE_DIVM_SHIFT</span><span class="p">)</span> <span class="o">|</span>
				<span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_BASE_DIVN_SHIFT</span><span class="p">);</span>
			<span class="n">BUG_ON</span><span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLU</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
					<span class="n">val</span> <span class="o">|=</span> <span class="n">PLLU_BASE_POST_DIV</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
					<span class="n">val</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_BASE_DIVP_SHIFT</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLL_HAS_CPCON</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
				<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PLL_MISC_CPCON_MASK</span><span class="p">;</span>
				<span class="n">val</span> <span class="o">|=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">cpcon</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_MISC_CPCON_SHIFT</span><span class="p">;</span>
				<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">ON</span><span class="p">)</span>
				<span class="n">tegra2_pll_clk_enable</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>

			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_pll_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="n">tegra2_pll_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="n">tegra2_pll_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="n">tegra2_pll_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="n">tegra2_pll_clk_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_pllx_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">tegra2_pll_clk_init</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tegra_sku_id</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">max_rate</span> <span class="o">=</span> <span class="mi">750000000</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_pllx_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>     <span class="o">=</span> <span class="n">tegra2_pllx_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>   <span class="o">=</span> <span class="n">tegra2_pll_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>  <span class="o">=</span> <span class="n">tegra2_pll_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="n">tegra2_pll_clk_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_plle_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLLE_MISC_READY</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">PLL_BASE_ENABLE</span> <span class="o">|</span> <span class="n">PLL_BASE_BYPASS</span><span class="p">;</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_plle_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>       <span class="o">=</span> <span class="n">tegra2_pll_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>     <span class="o">=</span> <span class="n">tegra2_plle_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>   <span class="o">=</span> <span class="n">tegra2_pll_clk_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Clock divider ops */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_pll_div_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">divu71</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">&gt;&gt;=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_OUT_CLKEN</span><span class="p">)</span> <span class="o">?</span> <span class="n">ON</span> <span class="o">:</span> <span class="n">OFF</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_OUT_RESET_DISABLE</span><span class="p">))</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divu71</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_OUT_RATIO_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">PLL_OUT_RATIO_SHIFT</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="p">(</span><span class="n">divu71</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_pll_div_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">new_val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">new_val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
		<span class="n">new_val</span> <span class="o">&amp;=</span> <span class="mh">0xFFFF</span><span class="p">;</span>

		<span class="n">new_val</span> <span class="o">|=</span> <span class="n">PLL_OUT_CLKEN</span> <span class="o">|</span> <span class="n">PLL_OUT_RESET_DISABLE</span><span class="p">;</span>

		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0xFFFF</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">new_val</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLD</span><span class="p">));</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PLLD_MISC_DIV_RST</span><span class="p">;</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_pll_div_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">new_val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">new_val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
		<span class="n">new_val</span> <span class="o">&amp;=</span> <span class="mh">0xFFFF</span><span class="p">;</span>

		<span class="n">new_val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">PLL_OUT_CLKEN</span> <span class="o">|</span> <span class="n">PLL_OUT_RESET_DISABLE</span><span class="p">);</span>

		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0xFFFF</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">new_val</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLD</span><span class="p">));</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">PLLD_MISC_DIV_RST</span><span class="p">;</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_pll_div_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">new_val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">divider_u71</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider_u71</span> <span class="o">=</span> <span class="n">clk_div71_get_divider</span><span class="p">(</span><span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider_u71</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">new_val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
			<span class="n">new_val</span> <span class="o">&amp;=</span> <span class="mh">0xFFFF</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71_FIXED</span><span class="p">)</span>
				<span class="n">new_val</span> <span class="o">|=</span> <span class="n">PLL_OUT_OVERRIDE</span><span class="p">;</span>
			<span class="n">new_val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PLL_OUT_RATIO_MASK</span><span class="p">;</span>
			<span class="n">new_val</span> <span class="o">|=</span> <span class="n">divider_u71</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_OUT_RATIO_SHIFT</span><span class="p">;</span>

			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0xFFFF</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">new_val</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
			<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">divider_u71</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_2</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">parent_rate</span> <span class="o">==</span> <span class="n">rate</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">long</span> <span class="nf">tegra2_pll_div_clk_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">divider</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider</span> <span class="o">=</span> <span class="n">clk_div71_get_divider</span><span class="p">(</span><span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">divider</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">DIV_ROUND_UP</span><span class="p">(</span><span class="n">parent_rate</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">divider</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_2</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">DIV_ROUND_UP</span><span class="p">(</span><span class="n">parent_rate</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_pll_div_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="n">tegra2_pll_div_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="n">tegra2_pll_div_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="n">tegra2_pll_div_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="n">tegra2_pll_div_clk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span>		<span class="o">=</span> <span class="n">tegra2_pll_div_clk_round_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Periph clk ops */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_periph_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">mux</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MUX</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">PERIPH_CLK_SOURCE_SHIFT</span> <span class="o">==</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">)</span>
				<span class="n">mux</span> <span class="o">=</span> <span class="n">sel</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">mux</span><span class="p">);</span>

		<span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">mux</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">input</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">divu71</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">PERIPH_CLK_SOURCE_DIVU71_MASK</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">divu71</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U16</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">divu16</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">PERIPH_CLK_SOURCE_DIVU16_MASK</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">divu16</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">ON</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">clk_readl</span><span class="p">(</span><span class="n">CLK_OUT_ENB</span> <span class="o">+</span> <span class="n">PERIPH_CLK_TO_ENB_REG</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&amp;</span>
			<span class="n">PERIPH_CLK_TO_ENB_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PERIPH_NO_RESET</span><span class="p">))</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clk_readl</span><span class="p">(</span><span class="n">RST_DEVICES</span> <span class="o">+</span> <span class="n">PERIPH_CLK_TO_ENB_REG</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&amp;</span>
				<span class="n">PERIPH_CLK_TO_ENB_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_periph_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">refcount</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">refcount</span> <span class="o">=</span> <span class="n">tegra_periph_clk_enable_refcount</span><span class="p">[</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">refcount</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">clk_writel</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_ENB_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
		<span class="n">CLK_OUT_ENB_SET</span> <span class="o">+</span> <span class="n">PERIPH_CLK_TO_ENB_SET_REG</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PERIPH_NO_RESET</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PERIPH_MANUAL_RESET</span><span class="p">))</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_ENB_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
			<span class="n">RST_DEVICES_CLR</span> <span class="o">+</span> <span class="n">PERIPH_CLK_TO_ENB_SET_REG</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PERIPH_EMC_ENB</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The EMC peripheral clock has 2 extra enable bits */</span>
		<span class="cm">/* FIXME: Do they need to be disabled? */</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">;</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="p">}</span>

<span class="nl">out:</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_periph_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">)</span>
		<span class="n">tegra_periph_clk_enable_refcount</span><span class="p">[</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tegra_periph_clk_enable_refcount</span><span class="p">[</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_ENB_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
			<span class="n">CLK_OUT_ENB_CLR</span> <span class="o">+</span> <span class="n">PERIPH_CLK_TO_ENB_SET_REG</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>

	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clock_register_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_periph_clk_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">bool</span> <span class="n">assert</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">base</span> <span class="o">=</span> <span class="n">assert</span> <span class="o">?</span> <span class="n">RST_DEVICES_SET</span> <span class="o">:</span> <span class="n">RST_DEVICES_CLR</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s %s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
		 <span class="n">assert</span> <span class="o">?</span> <span class="s">&quot;assert&quot;</span> <span class="o">:</span> <span class="s">&quot;deassert&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PERIPH_NO_RESET</span><span class="p">))</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_ENB_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
			   <span class="n">base</span> <span class="o">+</span> <span class="n">PERIPH_CLK_TO_ENB_SET_REG</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_periph_clk_set_parent</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PERIPH_CLK_SOURCE_MASK</span><span class="p">;</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">PERIPH_CLK_SOURCE_SHIFT</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">)</span>
				<span class="n">clk_enable</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

			<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span> <span class="o">&amp;&amp;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span>
				<span class="n">clk_disable</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

			<span class="n">clk_reparent</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_periph_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">divider</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider</span> <span class="o">=</span> <span class="n">clk_div71_get_divider</span><span class="p">(</span><span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PERIPH_CLK_SOURCE_DIVU71_MASK</span><span class="p">;</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">divider</span><span class="p">;</span>
			<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">divider</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U16</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider</span> <span class="o">=</span> <span class="n">clk_div16_get_divider</span><span class="p">(</span><span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PERIPH_CLK_SOURCE_DIVU16_MASK</span><span class="p">;</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">divider</span><span class="p">;</span>
			<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">divider</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">parent_rate</span> <span class="o">&lt;=</span> <span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">long</span> <span class="nf">tegra2_periph_clk_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">divider</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider</span> <span class="o">=</span> <span class="n">clk_div71_get_divider</span><span class="p">(</span><span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">divider</span><span class="p">;</span>

		<span class="k">return</span> <span class="n">DIV_ROUND_UP</span><span class="p">(</span><span class="n">parent_rate</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">divider</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U16</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider</span> <span class="o">=</span> <span class="n">clk_div16_get_divider</span><span class="p">(</span><span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">divider</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">DIV_ROUND_UP</span><span class="p">(</span><span class="n">parent_rate</span><span class="p">,</span> <span class="n">divider</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_periph_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_set_parent</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_reset</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* The SDMMC controllers have extra bits in the clock source register that</span>
<span class="cm"> * adjust the delay between the clock and data to compenstate for delays</span>
<span class="cm"> * on the PCB. */</span>
<span class="kt">void</span> <span class="nf">tegra2_sdmmc_tap_delay</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">delay</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">reg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">spinlock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">delay</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">);</span>
	<span class="n">reg</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SDMMC_CLK_INT_FB_DLY_MASK</span><span class="p">;</span>
	<span class="n">reg</span> <span class="o">|=</span> <span class="n">SDMMC_CLK_INT_FB_SEL</span><span class="p">;</span>
	<span class="n">reg</span> <span class="o">|=</span> <span class="n">delay</span> <span class="o">&lt;&lt;</span> <span class="n">SDMMC_CLK_INT_FB_DLY_SHIFT</span><span class="p">;</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">spinlock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* External memory controller clock ops */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_emc_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">tegra2_periph_clk_init</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">max_rate</span> <span class="o">=</span> <span class="n">clk_get_rate_locked</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">long</span> <span class="nf">tegra2_emc_clk_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">long</span> <span class="n">emc_rate</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">clk_rate</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * The slowest entry in the EMC clock table that is at least as</span>
<span class="cm">	 * fast as rate.</span>
<span class="cm">	 */</span>
	<span class="n">emc_rate</span> <span class="o">=</span> <span class="n">tegra_emc_round_rate</span><span class="p">(</span><span class="n">rate</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emc_rate</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">max_rate</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * The fastest rate the PLL will generate that is at most the</span>
<span class="cm">	 * requested rate.</span>
<span class="cm">	 */</span>
	<span class="n">clk_rate</span> <span class="o">=</span> <span class="n">tegra2_periph_clk_round_rate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">emc_rate</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * If this fails, and emc_rate &gt; clk_rate, it&#39;s because the maximum</span>
<span class="cm">	 * rate in the EMC tables is larger than the maximum rate of the EMC</span>
<span class="cm">	 * clock. The EMC clock&#39;s max rate is the rate it was running when the</span>
<span class="cm">	 * kernel booted. Such a mismatch is probably due to using the wrong</span>
<span class="cm">	 * BCT, i.e. using a Tegra20 BCT with an EMC table written for Tegra25.</span>
<span class="cm">	 */</span>
	<span class="n">WARN_ONCE</span><span class="p">(</span><span class="n">emc_rate</span> <span class="o">!=</span> <span class="n">clk_rate</span><span class="p">,</span>
		<span class="s">&quot;emc_rate %ld != clk_rate %ld&quot;</span><span class="p">,</span>
		<span class="n">emc_rate</span><span class="p">,</span> <span class="n">clk_rate</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">emc_rate</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_emc_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * The Tegra2 memory controller has an interlock with the clock</span>
<span class="cm">	 * block that allows memory shadowed registers to be updated,</span>
<span class="cm">	 * and then transfer them to the main registers at the same</span>
<span class="cm">	 * time as the clock update without glitches.</span>
<span class="cm">	 */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">tegra_emc_set_rate</span><span class="p">(</span><span class="n">rate</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">tegra2_periph_clk_set_rate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_emc_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_emc_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_set_parent</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_emc_clk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_emc_clk_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_reset</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Clock doubler ops */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_clk_double_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">ON</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">clk_readl</span><span class="p">(</span><span class="n">CLK_OUT_ENB</span> <span class="o">+</span> <span class="n">PERIPH_CLK_TO_ENB_REG</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&amp;</span>
			<span class="n">PERIPH_CLK_TO_ENB_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_clk_double_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_clk_double_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_clk_double_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_periph_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_clk_double_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Audio sync clock ops */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_audio_sync_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">source</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">))</span> <span class="o">?</span> <span class="n">OFF</span> <span class="o">:</span> <span class="n">ON</span><span class="p">;</span>
	<span class="n">source</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">==</span> <span class="n">source</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_audio_sync_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_audio_sync_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_audio_sync_clk_set_parent</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0xf</span><span class="p">;</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">)</span>
				<span class="n">clk_enable</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

			<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span> <span class="o">&amp;&amp;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span>
				<span class="n">clk_disable</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

			<span class="n">clk_reparent</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_audio_sync_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>       <span class="o">=</span> <span class="n">tegra2_audio_sync_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>     <span class="o">=</span> <span class="n">tegra2_audio_sync_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>    <span class="o">=</span> <span class="n">tegra2_audio_sync_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span> <span class="o">=</span> <span class="n">tegra2_audio_sync_clk_set_parent</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* cdev1 and cdev2 (dap_mclk1 and dap_mclk2) ops */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_cdev_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* We could un-tristate the cdev1 or cdev2 pingroup here; this is</span>
<span class="cm">	 * currently done in the pinmux code. */</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">ON</span><span class="p">;</span>

	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">clk_readl</span><span class="p">(</span><span class="n">CLK_OUT_ENB</span> <span class="o">+</span> <span class="n">PERIPH_CLK_TO_ENB_REG</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&amp;</span>
			<span class="n">PERIPH_CLK_TO_ENB_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra2_cdev_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">);</span>

	<span class="n">clk_writel</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_ENB_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
		<span class="n">CLK_OUT_ENB_SET</span> <span class="o">+</span> <span class="n">PERIPH_CLK_TO_ENB_SET_REG</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_cdev_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">);</span>

	<span class="n">clk_writel</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_ENB_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
		<span class="n">CLK_OUT_ENB_CLR</span> <span class="o">+</span> <span class="n">PERIPH_CLK_TO_ENB_SET_REG</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_cdev_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_cdev_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_cdev_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra2_cdev_clk_disable</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* shared bus ops */</span>
<span class="cm">/*</span>
<span class="cm"> * Some clocks may have multiple downstream users that need to request a</span>
<span class="cm"> * higher clock rate.  Shared bus clocks provide a unique shared_bus_user</span>
<span class="cm"> * clock to each user.  The frequency of the bus is set to the highest</span>
<span class="cm"> * enabled shared_bus_user clock, with a minimum value set by the</span>
<span class="cm"> * shared bus.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra_clk_shared_bus_update</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">bus</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">bus</span><span class="o">-&gt;</span><span class="n">min_rate</span><span class="p">;</span>

	<span class="n">list_for_each_entry</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bus</span><span class="o">-&gt;</span><span class="n">shared_bus_list</span><span class="p">,</span> <span class="n">u</span><span class="p">.</span><span class="n">shared_bus_user</span><span class="p">.</span><span class="n">node</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">shared_bus_user</span><span class="p">.</span><span class="n">enabled</span><span class="p">)</span>
			<span class="n">rate</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">shared_bus_user</span><span class="p">.</span><span class="n">rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">==</span> <span class="n">clk_get_rate_locked</span><span class="p">(</span><span class="n">bus</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">clk_set_rate_locked</span><span class="p">(</span><span class="n">bus</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra_clk_shared_bus_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">max_rate</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">max_rate</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">shared_bus_user</span><span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">max_rate</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">set</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">spinlock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">list_add_tail</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">shared_bus_user</span><span class="p">.</span><span class="n">node</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">shared_bus_list</span><span class="p">);</span>

	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">spinlock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra_clk_shared_bus_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">new_rate</span> <span class="o">=</span> <span class="n">rate</span><span class="p">;</span>

	<span class="n">new_rate</span> <span class="o">=</span> <span class="n">clk_round_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">,</span> <span class="n">new_rate</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">new_rate</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">new_rate</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">spinlock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">shared_bus_user</span><span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">new_rate</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">tegra_clk_shared_bus_update</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">spinlock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">long</span> <span class="nf">tegra_clk_shared_bus_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">clk_round_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra_clk_shared_bus_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">spinlock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">shared_bus_user</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">tegra_clk_shared_bus_update</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">spinlock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra_clk_shared_bus_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">spinlock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">shared_bus_user</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">tegra_clk_shared_bus_update</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">WARN_ON_ONCE</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>

	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">spinlock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_clk_shared_bus_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">tegra_clk_shared_bus_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span> <span class="o">=</span> <span class="n">tegra_clk_shared_bus_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span> <span class="o">=</span> <span class="n">tegra_clk_shared_bus_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="n">tegra_clk_shared_bus_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="n">tegra_clk_shared_bus_round_rate</span><span class="p">,</span>
<span class="p">};</span>


<span class="cm">/* Clock definitions */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_32k</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;clk_32k&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">32768</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>  <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span> <span class="o">=</span> <span class="mi">32768</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_s_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">32768</span><span class="p">,</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">366</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">32768</span><span class="p">,</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">397</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">32768</span><span class="p">,</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">586</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">32768</span><span class="p">,</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">793</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_s</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_s&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_ALT_MISC_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">26000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xf0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">32768</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">32768</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* FIXME */</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* FIXME */</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">12000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">26000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_s_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">tegra_clk_m_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_s</span><span class="p">,</span>  <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span> <span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_m</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;clk_m&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inputs</span>    <span class="o">=</span> <span class="n">tegra_clk_m_sel</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x1fc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">28</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">26000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_c_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_c</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_c&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>	   <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">600000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">31000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1400000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_c_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_c_out1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_c_out1&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">DIV_U71</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x84</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">600000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_m_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">666000000</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">666000000</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">666000000</span><span class="p">,</span> <span class="mi">555</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">666000000</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_m</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_m&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x90</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">800000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">31000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1200000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_m_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_m_out1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_m_out1&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">DIV_U71</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x94</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">600000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_p_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span>   <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">432000000</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">432000000</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">432000000</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span>   <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">432000000</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_p</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_p&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span> <span class="o">|</span> <span class="n">PLL_FIXED</span> <span class="o">|</span> <span class="n">PLL_HAS_CPCON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xa0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">432000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">31000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1400000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_p_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_p_out1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_p_out1&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_FIXED</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xa4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">432000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_p_out2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_p_out2&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_FIXED</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xa4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">432000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_p_out3</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_p_out3&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_FIXED</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xa8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">432000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_p_out4</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_p_out4&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_FIXED</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xa8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">432000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_a_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">28800000</span><span class="p">,</span> <span class="mi">56448000</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">28800000</span><span class="p">,</span> <span class="mi">73728000</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">28800000</span><span class="p">,</span> <span class="mi">24000000</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_a</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_a&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xb0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">73728000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">31000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1400000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_a_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_a_out0</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_a_out0&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">DIV_U71</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_a</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xb4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">73728000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_d_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">594000000</span><span class="p">,</span> <span class="mi">594</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">594000000</span><span class="p">,</span> <span class="mi">594</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">594000000</span><span class="p">,</span> <span class="mi">495</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">594000000</span><span class="p">,</span> <span class="mi">594</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">625</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_d</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_d&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span> <span class="o">|</span> <span class="n">PLLD</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xd0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">1000000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">40000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">40000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1000000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_d_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_d_out0</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_d_out0&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">DIV_2</span> <span class="o">|</span> <span class="n">PLLD</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_d</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">500000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_u_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">480000000</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">480000000</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">480000000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">480000000</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_u</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_u&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLLU</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xc0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">480000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">40000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">480000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">960000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_u_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_x_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* 1 GHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">625</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>

	<span class="cm">/* 912 MHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">912000000</span><span class="p">,</span>  <span class="mi">912</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">912000000</span><span class="p">,</span>  <span class="mi">912</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">912000000</span><span class="p">,</span>  <span class="mi">760</span><span class="p">,</span>  <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">912000000</span><span class="p">,</span>  <span class="mi">912</span><span class="p">,</span>  <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>

	<span class="cm">/* 816 MHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">816000000</span><span class="p">,</span>  <span class="mi">816</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">816000000</span><span class="p">,</span>  <span class="mi">816</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">816000000</span><span class="p">,</span>  <span class="mi">680</span><span class="p">,</span>  <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">816000000</span><span class="p">,</span>  <span class="mi">816</span><span class="p">,</span>  <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>

	<span class="cm">/* 760 MHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">760000000</span><span class="p">,</span>  <span class="mi">760</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">760000000</span><span class="p">,</span>  <span class="mi">760</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">760000000</span><span class="p">,</span>  <span class="mi">950</span><span class="p">,</span>  <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">760000000</span><span class="p">,</span>  <span class="mi">760</span><span class="p">,</span>  <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>

	<span class="cm">/* 750 MHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">750000000</span><span class="p">,</span>  <span class="mi">750</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">750000000</span><span class="p">,</span>  <span class="mi">750</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">750000000</span><span class="p">,</span>  <span class="mi">625</span><span class="p">,</span>  <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">750000000</span><span class="p">,</span>  <span class="mi">750</span><span class="p">,</span>  <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>

	<span class="cm">/* 608 MHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">608000000</span><span class="p">,</span>  <span class="mi">608</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">608000000</span><span class="p">,</span>  <span class="mi">608</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">608000000</span><span class="p">,</span>  <span class="mi">380</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">608000000</span><span class="p">,</span>  <span class="mi">608</span><span class="p">,</span>  <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>

	<span class="cm">/* 456 MHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">456000000</span><span class="p">,</span>  <span class="mi">456</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">456000000</span><span class="p">,</span>  <span class="mi">456</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">456000000</span><span class="p">,</span>  <span class="mi">380</span><span class="p">,</span>  <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">456000000</span><span class="p">,</span>  <span class="mi">456</span><span class="p">,</span>  <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>

	<span class="cm">/* 312 MHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">312000000</span><span class="p">,</span>  <span class="mi">312</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">312000000</span><span class="p">,</span>  <span class="mi">312</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">312000000</span><span class="p">,</span>  <span class="mi">260</span><span class="p">,</span>  <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">312000000</span><span class="p">,</span>  <span class="mi">312</span><span class="p">,</span>  <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_x</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_x&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span> <span class="o">|</span> <span class="n">PLL_ALT_MISC_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pllx_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xe0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">1000000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">31000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1200000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_x_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_e_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">100000000</span><span class="p">,</span>  <span class="mi">200</span><span class="p">,</span>  <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_e</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_e&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>	   <span class="o">=</span> <span class="n">PLL_ALT_MISC_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_plle_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xe8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">100000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">12000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">12000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_e_freq_table</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_d</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;clk_d&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PERIPH_NO_RESET</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_double_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x34</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">52000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span>  <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">clk_num</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* dap_mclk1, belongs to the cdev1 pingroup. */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_cdev1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;cdev1&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_cdev_clk_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span>      <span class="o">=</span> <span class="mi">26000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">26000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span>  <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">clk_num</span> <span class="o">=</span> <span class="mi">94</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* dap_mclk2, belongs to the cdev2 pingroup. */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_cdev2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;cdev2&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_cdev_clk_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span>      <span class="o">=</span> <span class="mi">26000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">26000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span>  <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">clk_num</span>   <span class="o">=</span> <span class="mi">93</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* initialized before peripheral clocks */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_audio_sync_clk</span><span class="p">[</span><span class="mi">8</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">audio_sources</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span> <span class="n">mux_audio_sync_clk_sources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;spdif_in&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;i2s1&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;i2s2&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;pll_a_out0&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span> <span class="p">},</span>
<span class="cp">#if 0</span><span class="c"> /* FIXME: not implemented */</span>
<span class="c">	{ .name = &quot;ac97&quot;, .value = 3 },</span>
<span class="c">	{ .name = &quot;ext_audio_clk2&quot;, .value = 5 },</span>
<span class="c">	{ .name = &quot;ext_audio_clk1&quot;, .value = 6 },</span>
<span class="c">	{ .name = &quot;ext_vimclk&quot;, .value = 7 },</span>
<span class="cp">#endif</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_audio</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;audio&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inputs</span>    <span class="o">=</span> <span class="n">mux_audio_sync_clk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x38</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">73728000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_audio_sync_clk_ops</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_audio_2x</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;audio_2x&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PERIPH_NO_RESET</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">48000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_double_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x34</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_audio</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">clk_num</span> <span class="o">=</span> <span class="mi">89</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_lookup</span> <span class="n">tegra_audio_clk_lookups</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;audio&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_audio</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;audio_2x&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_audio_2x</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* This is called after peripheral clocks are initialized, as the</span>
<span class="cm"> * audio_sync clock depends on some of the peripheral clocks.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">init_audio_sync_clock_mux</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span> <span class="o">=</span> <span class="n">mux_audio_sync_clk</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">audio_sources</span> <span class="o">*</span><span class="n">src</span> <span class="o">=</span> <span class="n">mux_audio_sync_clk_sources</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk_lookup</span> <span class="o">*</span><span class="n">lookup</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">sel</span><span class="o">++</span><span class="p">,</span> <span class="n">src</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">=</span> <span class="n">tegra_get_clock_by_name</span><span class="p">(</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">)</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: could not find clk %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
				<span class="n">src</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">lookup</span> <span class="o">=</span> <span class="n">tegra_audio_clk_lookups</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_audio_clk_lookups</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">lookup</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">clk_init</span><span class="p">(</span><span class="n">lookup</span><span class="o">-&gt;</span><span class="n">clk</span><span class="p">);</span>
		<span class="n">clkdev_add</span><span class="p">(</span><span class="n">lookup</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_cclk</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out4</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">5</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out3</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_d</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">7</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_x</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_sclk</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c_out1</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out4</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out3</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out2</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_d</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">5</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m_out1</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">7</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_cclk</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;cclk&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inputs</span>	<span class="o">=</span> <span class="n">mux_cclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>	<span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_super_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span> <span class="o">=</span> <span class="mi">1000000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_sclk</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;sclk&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inputs</span>	<span class="o">=</span> <span class="n">mux_sclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>	<span class="o">=</span> <span class="mh">0x28</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_super_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span> <span class="o">=</span> <span class="mi">240000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_rate</span> <span class="o">=</span> <span class="mi">120000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_virtual_cpu</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;cpu&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_cclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_cpu_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">1000000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">cpu</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">main</span>      <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_x</span><span class="p">,</span>
		<span class="p">.</span><span class="n">backup</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_cop</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;cop&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_sclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_cop_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">240000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_hclk</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;hclk&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">DIV_BUS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_sclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>		<span class="o">=</span> <span class="mh">0x30</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_bus_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>       <span class="o">=</span> <span class="mi">240000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_pclk</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;pclk&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">DIV_BUS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_hclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>		<span class="o">=</span> <span class="mh">0x30</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_bus_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>       <span class="o">=</span> <span class="mi">120000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_blink</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;blink&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>		<span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_blink_clk_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>	<span class="o">=</span> <span class="mi">32768</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_a_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllm_pllc_pllp_clkm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllaout0_audio2x_pllp_clkm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_a_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_audio_2x</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_plld_pllc_clkm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_d_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_pllc_audio_clkm_clk32</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_audio</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>   <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_pllc_pllm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_clk_m</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_out3</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out3</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_plld</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_d</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_clk_32k</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pclk</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_pclk</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_emc</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;emc&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_emc_clk_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span> <span class="o">=</span> <span class="mh">0x19c</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span> <span class="o">=</span> <span class="mi">800000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">mux_pllm_pllc_pllp_clkm</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_EMC_ENB</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">clk_num</span> <span class="o">=</span> <span class="mi">57</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#define PERIPH_CLK(_name, _dev, _con, _clk_num, _reg, _max, _inputs, _flags) \</span>
<span class="cp">	{						\</span>
<span class="cp">		.name      = _name,			\</span>
<span class="cp">		.lookup    = {				\</span>
<span class="cp">			.dev_id    = _dev,		\</span>
<span class="cp">			.con_id	   = _con,		\</span>
<span class="cp">		},					\</span>
<span class="cp">		.ops       = &amp;tegra_periph_clk_ops,	\</span>
<span class="cp">		.reg       = _reg,			\</span>
<span class="cp">		.inputs    = _inputs,			\</span>
<span class="cp">		.flags     = _flags,			\</span>
<span class="cp">		.max_rate  = _max,			\</span>
<span class="cp">		.u.periph = {				\</span>
<span class="cp">			.clk_num   = _clk_num,		\</span>
<span class="cp">		},					\</span>
<span class="cp">	}</span>

<span class="cp">#define SHARED_CLK(_name, _dev, _con, _parent)		\</span>
<span class="cp">	{						\</span>
<span class="cp">		.name      = _name,			\</span>
<span class="cp">		.lookup    = {				\</span>
<span class="cp">			.dev_id    = _dev,		\</span>
<span class="cp">			.con_id    = _con,		\</span>
<span class="cp">		},					\</span>
<span class="cp">		.ops       = &amp;tegra_clk_shared_bus_ops,	\</span>
<span class="cp">		.parent = _parent,			\</span>
<span class="cp">	}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_list_clks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;apbdma&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-dma&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">34</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">108000000</span><span class="p">,</span> <span class="n">mux_pclk</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;rtc&quot;</span><span class="p">,</span>	<span class="s">&quot;rtc-tegra&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">4</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">32768</span><span class="p">,</span>     <span class="n">mux_clk_32k</span><span class="p">,</span>			<span class="n">PERIPH_NO_RESET</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;timer&quot;</span><span class="p">,</span>	<span class="s">&quot;timer&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">5</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2s1&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra20-i2s.0&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">11</span><span class="p">,</span>	<span class="mh">0x100</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllaout0_audio2x_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2s2&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra20-i2s.1&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">18</span><span class="p">,</span>	<span class="mh">0x104</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllaout0_audio2x_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;spdif_out&quot;</span><span class="p">,</span>	<span class="s">&quot;spdif_out&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">10</span><span class="p">,</span>	<span class="mh">0x108</span><span class="p">,</span>	<span class="mi">100000000</span><span class="p">,</span> <span class="n">mux_pllaout0_audio2x_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;spdif_in&quot;</span><span class="p">,</span>	<span class="s">&quot;spdif_in&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">10</span><span class="p">,</span>	<span class="mh">0x10c</span><span class="p">,</span>	<span class="mi">100000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;pwm&quot;</span><span class="p">,</span>	<span class="s">&quot;pwm&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">17</span><span class="p">,</span>	<span class="mh">0x110</span><span class="p">,</span>	<span class="mi">432000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_audio_clkm_clk32</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;spi&quot;</span><span class="p">,</span>	<span class="s">&quot;spi&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">43</span><span class="p">,</span>	<span class="mh">0x114</span><span class="p">,</span>	<span class="mi">40000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;xio&quot;</span><span class="p">,</span>	<span class="s">&quot;xio&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">45</span><span class="p">,</span>	<span class="mh">0x120</span><span class="p">,</span>	<span class="mi">150000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;twc&quot;</span><span class="p">,</span>	<span class="s">&quot;twc&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">16</span><span class="p">,</span>	<span class="mh">0x12c</span><span class="p">,</span>	<span class="mi">150000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sbc1&quot;</span><span class="p">,</span>	<span class="s">&quot;spi_tegra.0&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">41</span><span class="p">,</span>	<span class="mh">0x134</span><span class="p">,</span>	<span class="mi">160000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sbc2&quot;</span><span class="p">,</span>	<span class="s">&quot;spi_tegra.1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">44</span><span class="p">,</span>	<span class="mh">0x118</span><span class="p">,</span>	<span class="mi">160000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sbc3&quot;</span><span class="p">,</span>	<span class="s">&quot;spi_tegra.2&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">46</span><span class="p">,</span>	<span class="mh">0x11c</span><span class="p">,</span>	<span class="mi">160000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sbc4&quot;</span><span class="p">,</span>	<span class="s">&quot;spi_tegra.3&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">68</span><span class="p">,</span>	<span class="mh">0x1b4</span><span class="p">,</span>	<span class="mi">160000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;ide&quot;</span><span class="p">,</span>	<span class="s">&quot;ide&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">25</span><span class="p">,</span>	<span class="mh">0x144</span><span class="p">,</span>	<span class="mi">100000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;ndflash&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_nand&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">13</span><span class="p">,</span>	<span class="mh">0x160</span><span class="p">,</span>	<span class="mi">164000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;vfir&quot;</span><span class="p">,</span>	<span class="s">&quot;vfir&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">7</span><span class="p">,</span>	<span class="mh">0x168</span><span class="p">,</span>	<span class="mi">72000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sdmmc1&quot;</span><span class="p">,</span>	<span class="s">&quot;sdhci-tegra.0&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">14</span><span class="p">,</span>	<span class="mh">0x150</span><span class="p">,</span>	<span class="mi">52000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sdmmc2&quot;</span><span class="p">,</span>	<span class="s">&quot;sdhci-tegra.1&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">9</span><span class="p">,</span>	<span class="mh">0x154</span><span class="p">,</span>	<span class="mi">52000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sdmmc3&quot;</span><span class="p">,</span>	<span class="s">&quot;sdhci-tegra.2&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">69</span><span class="p">,</span>	<span class="mh">0x1bc</span><span class="p">,</span>	<span class="mi">52000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sdmmc4&quot;</span><span class="p">,</span>	<span class="s">&quot;sdhci-tegra.3&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">15</span><span class="p">,</span>	<span class="mh">0x164</span><span class="p">,</span>	<span class="mi">52000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;vcp&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-avp&quot;</span><span class="p">,</span>		<span class="s">&quot;vcp&quot;</span><span class="p">,</span>	<span class="mi">29</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;bsea&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-avp&quot;</span><span class="p">,</span>		<span class="s">&quot;bsea&quot;</span><span class="p">,</span>	<span class="mi">62</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;bsev&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-aes&quot;</span><span class="p">,</span>		<span class="s">&quot;bsev&quot;</span><span class="p">,</span>	<span class="mi">63</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;vde&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-avp&quot;</span><span class="p">,</span>		<span class="s">&quot;vde&quot;</span><span class="p">,</span>	<span class="mi">61</span><span class="p">,</span>	<span class="mh">0x1c8</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage and process_id */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;csite&quot;</span><span class="p">,</span>	<span class="s">&quot;csite&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">73</span><span class="p">,</span>	<span class="mh">0x1d4</span><span class="p">,</span>	<span class="mi">144000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* max rate ??? */</span>
	<span class="cm">/* FIXME: what is la? */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;la&quot;</span><span class="p">,</span>	<span class="s">&quot;la&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">76</span><span class="p">,</span>	<span class="mh">0x1f8</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;owr&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_w1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">71</span><span class="p">,</span>	<span class="mh">0x1cc</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;nor&quot;</span><span class="p">,</span>	<span class="s">&quot;nor&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">42</span><span class="p">,</span>	<span class="mh">0x1d0</span><span class="p">,</span>	<span class="mi">92000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;mipi&quot;</span><span class="p">,</span>	<span class="s">&quot;mipi&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">50</span><span class="p">,</span>	<span class="mh">0x174</span><span class="p">,</span>	<span class="mi">60000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2c1&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.0&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">12</span><span class="p">,</span>	<span class="mh">0x124</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U16</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2c2&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">54</span><span class="p">,</span>	<span class="mh">0x198</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U16</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2c3&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.2&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">67</span><span class="p">,</span>	<span class="mh">0x1b8</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U16</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;dvc&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.3&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">47</span><span class="p">,</span>	<span class="mh">0x128</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U16</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2c1_i2c&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.0&quot;</span><span class="p">,</span>		<span class="s">&quot;i2c&quot;</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">72000000</span><span class="p">,</span>  <span class="n">mux_pllp_out3</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2c2_i2c&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.1&quot;</span><span class="p">,</span>		<span class="s">&quot;i2c&quot;</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">72000000</span><span class="p">,</span>  <span class="n">mux_pllp_out3</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2c3_i2c&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.2&quot;</span><span class="p">,</span>		<span class="s">&quot;i2c&quot;</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">72000000</span><span class="p">,</span>  <span class="n">mux_pllp_out3</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;dvc_i2c&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.3&quot;</span><span class="p">,</span>		<span class="s">&quot;i2c&quot;</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">72000000</span><span class="p">,</span>  <span class="n">mux_pllp_out3</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uarta&quot;</span><span class="p">,</span>	<span class="s">&quot;uart.0&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">6</span><span class="p">,</span>	<span class="mh">0x178</span><span class="p">,</span>	<span class="mi">600000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uartb&quot;</span><span class="p">,</span>	<span class="s">&quot;uart.1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">7</span><span class="p">,</span>	<span class="mh">0x17c</span><span class="p">,</span>	<span class="mi">600000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uartc&quot;</span><span class="p">,</span>	<span class="s">&quot;uart.2&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">55</span><span class="p">,</span>	<span class="mh">0x1a0</span><span class="p">,</span>	<span class="mi">600000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uartd&quot;</span><span class="p">,</span>	<span class="s">&quot;uart.3&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">65</span><span class="p">,</span>	<span class="mh">0x1c0</span><span class="p">,</span>	<span class="mi">600000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uarte&quot;</span><span class="p">,</span>	<span class="s">&quot;uart.4&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">66</span><span class="p">,</span>	<span class="mh">0x1c4</span><span class="p">,</span>	<span class="mi">600000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;3d&quot;</span><span class="p">,</span>	<span class="s">&quot;3d&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">24</span><span class="p">,</span>	<span class="mh">0x158</span><span class="p">,</span>	<span class="mi">300000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_MANUAL_RESET</span><span class="p">),</span> <span class="cm">/* scales with voltage and process_id */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">,</span>	<span class="s">&quot;2d&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">21</span><span class="p">,</span>	<span class="mh">0x15c</span><span class="p">,</span>	<span class="mi">300000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage and process_id */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;vi&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_camera&quot;</span><span class="p">,</span>		<span class="s">&quot;vi&quot;</span><span class="p">,</span>	<span class="mi">20</span><span class="p">,</span>	<span class="mh">0x148</span><span class="p">,</span>	<span class="mi">150000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage and process_id */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;vi_sensor&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_camera&quot;</span><span class="p">,</span>		<span class="s">&quot;vi_sensor&quot;</span><span class="p">,</span>	<span class="mi">20</span><span class="p">,</span>	<span class="mh">0x1a8</span><span class="p">,</span>	<span class="mi">150000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_NO_RESET</span><span class="p">),</span> <span class="cm">/* scales with voltage and process_id */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;epp&quot;</span><span class="p">,</span>	<span class="s">&quot;epp&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">19</span><span class="p">,</span>	<span class="mh">0x16c</span><span class="p">,</span>	<span class="mi">300000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage and process_id */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;mpe&quot;</span><span class="p">,</span>	<span class="s">&quot;mpe&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">60</span><span class="p">,</span>	<span class="mh">0x170</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage and process_id */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;host1x&quot;</span><span class="p">,</span>	<span class="s">&quot;host1x&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">28</span><span class="p">,</span>	<span class="mh">0x180</span><span class="p">,</span>	<span class="mi">166000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage and process_id */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;cve&quot;</span><span class="p">,</span>	<span class="s">&quot;cve&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">49</span><span class="p">,</span>	<span class="mh">0x140</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_pllp_plld_pllc_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;tvo&quot;</span><span class="p">,</span>	<span class="s">&quot;tvo&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">49</span><span class="p">,</span>	<span class="mh">0x188</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_pllp_plld_pllc_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;hdmi&quot;</span><span class="p">,</span>	<span class="s">&quot;hdmi&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">51</span><span class="p">,</span>	<span class="mh">0x18c</span><span class="p">,</span>	<span class="mi">600000000</span><span class="p">,</span> <span class="n">mux_pllp_plld_pllc_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;tvdac&quot;</span><span class="p">,</span>	<span class="s">&quot;tvdac&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">53</span><span class="p">,</span>	<span class="mh">0x194</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_pllp_plld_pllc_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;disp1&quot;</span><span class="p">,</span>	<span class="s">&quot;tegradc.0&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">27</span><span class="p">,</span>	<span class="mh">0x138</span><span class="p">,</span>	<span class="mi">600000000</span><span class="p">,</span> <span class="n">mux_pllp_plld_pllc_clkm</span><span class="p">,</span>	<span class="n">MUX</span><span class="p">),</span> <span class="cm">/* scales with voltage and process_id */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;disp2&quot;</span><span class="p">,</span>	<span class="s">&quot;tegradc.1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">26</span><span class="p">,</span>	<span class="mh">0x13c</span><span class="p">,</span>	<span class="mi">600000000</span><span class="p">,</span> <span class="n">mux_pllp_plld_pllc_clkm</span><span class="p">,</span>	<span class="n">MUX</span><span class="p">),</span> <span class="cm">/* scales with voltage and process_id */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;usbd&quot;</span><span class="p">,</span>	<span class="s">&quot;fsl-tegra-udc&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">22</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">480000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;usb2&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-ehci.1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">58</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">480000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;usb3&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-ehci.2&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">59</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">480000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;dsi&quot;</span><span class="p">,</span>	<span class="s">&quot;dsi&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">48</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">500000000</span><span class="p">,</span> <span class="n">mux_plld</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;csi&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_camera&quot;</span><span class="p">,</span>		<span class="s">&quot;csi&quot;</span><span class="p">,</span>	<span class="mi">52</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">72000000</span><span class="p">,</span>  <span class="n">mux_pllp_out3</span><span class="p">,</span>		<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;isp&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_camera&quot;</span><span class="p">,</span>		<span class="s">&quot;isp&quot;</span><span class="p">,</span>	<span class="mi">23</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">150000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span> <span class="cm">/* same frequency as VI */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;csus&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_camera&quot;</span><span class="p">,</span>		<span class="s">&quot;csus&quot;</span><span class="p">,</span>	<span class="mi">92</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">150000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="n">PERIPH_NO_RESET</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;pex&quot;</span><span class="p">,</span>       <span class="nb">NULL</span><span class="p">,</span>			<span class="s">&quot;pex&quot;</span><span class="p">,</span>  <span class="mi">70</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="n">PERIPH_MANUAL_RESET</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;afi&quot;</span><span class="p">,</span>       <span class="nb">NULL</span><span class="p">,</span>			<span class="s">&quot;afi&quot;</span><span class="p">,</span>  <span class="mi">72</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="n">PERIPH_MANUAL_RESET</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;pcie_xclk&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>		  <span class="s">&quot;pcie_xclk&quot;</span><span class="p">,</span>  <span class="mi">74</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="n">PERIPH_MANUAL_RESET</span><span class="p">),</span>

	<span class="n">SHARED_CLK</span><span class="p">(</span><span class="s">&quot;avp.sclk&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-avp&quot;</span><span class="p">,</span>		<span class="s">&quot;sclk&quot;</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_clk_sclk</span><span class="p">),</span>
	<span class="n">SHARED_CLK</span><span class="p">(</span><span class="s">&quot;avp.emc&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-avp&quot;</span><span class="p">,</span>		<span class="s">&quot;emc&quot;</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_clk_emc</span><span class="p">),</span>
	<span class="n">SHARED_CLK</span><span class="p">(</span><span class="s">&quot;cpu.emc&quot;</span><span class="p">,</span>	<span class="s">&quot;cpu&quot;</span><span class="p">,</span>			<span class="s">&quot;emc&quot;</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_clk_emc</span><span class="p">),</span>
	<span class="n">SHARED_CLK</span><span class="p">(</span><span class="s">&quot;disp1.emc&quot;</span><span class="p">,</span>	<span class="s">&quot;tegradc.0&quot;</span><span class="p">,</span>		<span class="s">&quot;emc&quot;</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_clk_emc</span><span class="p">),</span>
	<span class="n">SHARED_CLK</span><span class="p">(</span><span class="s">&quot;disp2.emc&quot;</span><span class="p">,</span>	<span class="s">&quot;tegradc.1&quot;</span><span class="p">,</span>		<span class="s">&quot;emc&quot;</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_clk_emc</span><span class="p">),</span>
	<span class="n">SHARED_CLK</span><span class="p">(</span><span class="s">&quot;hdmi.emc&quot;</span><span class="p">,</span>	<span class="s">&quot;hdmi&quot;</span><span class="p">,</span>			<span class="s">&quot;emc&quot;</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_clk_emc</span><span class="p">),</span>
	<span class="n">SHARED_CLK</span><span class="p">(</span><span class="s">&quot;host.emc&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_grhost&quot;</span><span class="p">,</span>		<span class="s">&quot;emc&quot;</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_clk_emc</span><span class="p">),</span>
	<span class="n">SHARED_CLK</span><span class="p">(</span><span class="s">&quot;usbd.emc&quot;</span><span class="p">,</span>	<span class="s">&quot;fsl-tegra-udc&quot;</span><span class="p">,</span>	<span class="s">&quot;emc&quot;</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_clk_emc</span><span class="p">),</span>
	<span class="n">SHARED_CLK</span><span class="p">(</span><span class="s">&quot;usb1.emc&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-ehci.0&quot;</span><span class="p">,</span>		<span class="s">&quot;emc&quot;</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_clk_emc</span><span class="p">),</span>
	<span class="n">SHARED_CLK</span><span class="p">(</span><span class="s">&quot;usb2.emc&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-ehci.1&quot;</span><span class="p">,</span>		<span class="s">&quot;emc&quot;</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_clk_emc</span><span class="p">),</span>
	<span class="n">SHARED_CLK</span><span class="p">(</span><span class="s">&quot;usb3.emc&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-ehci.2&quot;</span><span class="p">,</span>		<span class="s">&quot;emc&quot;</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_clk_emc</span><span class="p">),</span>
<span class="p">};</span>

<span class="cp">#define CLK_DUPLICATE(_name, _dev, _con)		\</span>
<span class="cp">	{						\</span>
<span class="cp">		.name	= _name,			\</span>
<span class="cp">		.lookup	= {				\</span>
<span class="cp">			.dev_id	= _dev,			\</span>
<span class="cp">			.con_id		= _con,		\</span>
<span class="cp">		},					\</span>
<span class="cp">	}</span>

<span class="cm">/* Some clocks may be used by different drivers depending on the board</span>
<span class="cm"> * configuration.  List those here to register them twice in the clock lookup</span>
<span class="cm"> * table under two names.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_duplicate</span> <span class="n">tegra_clk_duplicates</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;uarta&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_uart.0&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;uartb&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_uart.1&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;uartc&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_uart.2&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;uartd&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_uart.3&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;uarte&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_uart.4&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;usbd&quot;</span><span class="p">,</span> <span class="s">&quot;utmip-pad&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;usbd&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-ehci.0&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;usbd&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-otg&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;hdmi&quot;</span><span class="p">,</span> <span class="s">&quot;tegradc.0&quot;</span><span class="p">,</span> <span class="s">&quot;hdmi&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;hdmi&quot;</span><span class="p">,</span> <span class="s">&quot;tegradc.1&quot;</span><span class="p">,</span> <span class="s">&quot;hdmi&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;pwm&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_pwm.0&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;pwm&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_pwm.1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;pwm&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_pwm.2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;pwm&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_pwm.3&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;host1x&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_grhost&quot;</span><span class="p">,</span> <span class="s">&quot;host1x&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_grhost&quot;</span><span class="p">,</span> <span class="s">&quot;gr2d&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;3d&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_grhost&quot;</span><span class="p">,</span> <span class="s">&quot;gr3d&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;epp&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_grhost&quot;</span><span class="p">,</span> <span class="s">&quot;epp&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;mpe&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_grhost&quot;</span><span class="p">,</span> <span class="s">&quot;mpe&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;cop&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-avp&quot;</span><span class="p">,</span> <span class="s">&quot;cop&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;vde&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-aes&quot;</span><span class="p">,</span> <span class="s">&quot;vde&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="cp">#define CLK(dev, con, ck)	\</span>
<span class="cp">	{			\</span>
<span class="cp">		.dev_id = dev,	\</span>
<span class="cp">		.con_id = con,	\</span>
<span class="cp">		.clk = ck,	\</span>
<span class="cp">	}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">tegra_ptr_clks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_s</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_m_out1</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_c_out1</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_p_out1</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_p_out2</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_p_out3</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_p_out4</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_a</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_a_out0</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_d</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_d_out0</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_u</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_x</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_e</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_cclk</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_sclk</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_hclk</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_pclk</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_d</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_cdev1</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_cdev2</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_virtual_cpu</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_blink</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_cop</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_emc</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra2_init_one_clock</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">clk_init</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
	<span class="n">INIT_LIST_HEAD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">shared_bus_list</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">.</span><span class="n">dev_id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">.</span><span class="n">con_id</span><span class="p">)</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
	<span class="n">clkdev_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">tegra2_init_clocks</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_ptr_clks</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">tegra2_init_one_clock</span><span class="p">(</span><span class="n">tegra_ptr_clks</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_list_clks</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">tegra2_init_one_clock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_list_clks</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_clk_duplicates</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">tegra_get_clock_by_name</span><span class="p">(</span><span class="n">tegra_clk_duplicates</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Unknown duplicate clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
				<span class="n">tegra_clk_duplicates</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">tegra_clk_duplicates</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lookup</span><span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
		<span class="n">clkdev_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_clk_duplicates</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lookup</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">init_audio_sync_clock_mux</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_PM</span>
<span class="k">static</span> <span class="n">u32</span> <span class="n">clk_rst_suspend</span><span class="p">[</span><span class="n">RST_DEVICES_NUM</span> <span class="o">+</span> <span class="n">CLK_OUT_ENB_NUM</span> <span class="o">+</span>
			   <span class="n">PERIPH_CLK_SOURCE_NUM</span> <span class="o">+</span> <span class="mi">22</span><span class="p">];</span>

<span class="kt">void</span> <span class="nf">tegra_clk_suspend</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">off</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">ctx</span> <span class="o">=</span> <span class="n">clk_rst_suspend</span><span class="p">;</span>

	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">OSC_CTRL</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">OSC_CTRL_MASK</span><span class="p">;</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_c</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_c</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">));</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_a</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_a</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_pll_a</span><span class="p">));</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_s</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_s</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_pll_s</span><span class="p">));</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_d</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_d</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_pll_d</span><span class="p">));</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_u</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_u</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_pll_u</span><span class="p">));</span>

	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_m_out1</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_a_out0</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_pll_c_out1</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>

	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_clk_cclk</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_clk_cclk</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_DIVIDER</span><span class="p">);</span>

	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_clk_sclk</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_clk_sclk</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_DIVIDER</span><span class="p">);</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_clk_pclk</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>

	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">tegra_clk_audio</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">off</span> <span class="o">=</span> <span class="n">PERIPH_CLK_SOURCE_I2S1</span><span class="p">;</span> <span class="n">off</span> <span class="o">&lt;=</span> <span class="n">PERIPH_CLK_SOURCE_OSC</span><span class="p">;</span>
			<span class="n">off</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">off</span> <span class="o">==</span> <span class="n">PERIPH_CLK_SOURCE_EMC</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">off</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">off</span> <span class="o">=</span> <span class="n">RST_DEVICES</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">RST_DEVICES_NUM</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">off</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span>
		<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">off</span><span class="p">);</span>

	<span class="n">off</span> <span class="o">=</span> <span class="n">CLK_OUT_ENB</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CLK_OUT_ENB_NUM</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">off</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span>
		<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">off</span><span class="p">);</span>

	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">MISC_CLK_ENB</span><span class="p">);</span>
	<span class="o">*</span><span class="n">ctx</span><span class="o">++</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">CLK_MASK_ARM</span><span class="p">);</span>

	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">ctx</span> <span class="o">-</span> <span class="n">clk_rst_suspend</span> <span class="o">!=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">clk_rst_suspend</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">tegra_clk_resume</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">off</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">ctx</span> <span class="o">=</span> <span class="n">clk_rst_suspend</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">OSC_CTRL</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">OSC_CTRL_MASK</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">;</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">OSC_CTRL</span><span class="p">);</span>

	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_c</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_c</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">));</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_a</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_a</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_pll_a</span><span class="p">));</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_s</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_s</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_pll_s</span><span class="p">));</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_d</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_d</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_pll_d</span><span class="p">));</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_u</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_u</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_pll_u</span><span class="p">));</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_m_out1</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_a_out0</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_pll_c_out1</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>

	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_clk_cclk</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_clk_cclk</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_DIVIDER</span><span class="p">);</span>

	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_clk_sclk</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_clk_sclk</span><span class="p">.</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_DIVIDER</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_clk_pclk</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>

	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">tegra_clk_audio</span><span class="p">.</span><span class="n">reg</span><span class="p">);</span>

	<span class="cm">/* enable all clocks before configuring clock sources */</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="mh">0xbffffff9ul</span><span class="p">,</span> <span class="n">CLK_OUT_ENB</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="mh">0xfefffff7ul</span><span class="p">,</span> <span class="n">CLK_OUT_ENB</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="mh">0x77f01bfful</span><span class="p">,</span> <span class="n">CLK_OUT_ENB</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">wmb</span><span class="p">();</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">off</span> <span class="o">=</span> <span class="n">PERIPH_CLK_SOURCE_I2S1</span><span class="p">;</span> <span class="n">off</span> <span class="o">&lt;=</span> <span class="n">PERIPH_CLK_SOURCE_OSC</span><span class="p">;</span>
			<span class="n">off</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">off</span> <span class="o">==</span> <span class="n">PERIPH_CLK_SOURCE_EMC</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">off</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">wmb</span><span class="p">();</span>

	<span class="n">off</span> <span class="o">=</span> <span class="n">RST_DEVICES</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">RST_DEVICES_NUM</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">off</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">off</span><span class="p">);</span>
	<span class="n">wmb</span><span class="p">();</span>

	<span class="n">off</span> <span class="o">=</span> <span class="n">CLK_OUT_ENB</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CLK_OUT_ENB_NUM</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">off</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">off</span><span class="p">);</span>
	<span class="n">wmb</span><span class="p">();</span>

	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">MISC_CLK_ENB</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="o">*</span><span class="n">ctx</span><span class="o">++</span><span class="p">,</span> <span class="n">CLK_MASK_ARM</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
