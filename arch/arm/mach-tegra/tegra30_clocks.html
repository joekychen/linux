<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-tegra › tegra30_clocks.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tegra30_clocks.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * arch/arm/mach-tegra/tegra30_clocks.c</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2010-2011 NVIDIA CORPORATION.  All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; version 2 of the License.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="cm"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm"> * more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along</span>
<span class="cm"> * with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/err.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/clk.h&gt;</span>
<span class="cp">#include &lt;linux/cpufreq.h&gt;</span>
<span class="cp">#include &lt;linux/syscore_ops.h&gt;</span>

<span class="cp">#include &lt;asm/clkdev.h&gt;</span>

<span class="cp">#include &lt;mach/iomap.h&gt;</span>

<span class="cp">#include &quot;clock.h&quot;</span>
<span class="cp">#include &quot;fuse.h&quot;</span>

<span class="cp">#define USE_PLL_LOCK_BITS 0</span>

<span class="cp">#define RST_DEVICES_L			0x004</span>
<span class="cp">#define RST_DEVICES_H			0x008</span>
<span class="cp">#define RST_DEVICES_U			0x00C</span>
<span class="cp">#define RST_DEVICES_V			0x358</span>
<span class="cp">#define RST_DEVICES_W			0x35C</span>
<span class="cp">#define RST_DEVICES_SET_L		0x300</span>
<span class="cp">#define RST_DEVICES_CLR_L		0x304</span>
<span class="cp">#define RST_DEVICES_SET_V		0x430</span>
<span class="cp">#define RST_DEVICES_CLR_V		0x434</span>
<span class="cp">#define RST_DEVICES_NUM			5</span>

<span class="cp">#define CLK_OUT_ENB_L			0x010</span>
<span class="cp">#define CLK_OUT_ENB_H			0x014</span>
<span class="cp">#define CLK_OUT_ENB_U			0x018</span>
<span class="cp">#define CLK_OUT_ENB_V			0x360</span>
<span class="cp">#define CLK_OUT_ENB_W			0x364</span>
<span class="cp">#define CLK_OUT_ENB_SET_L		0x320</span>
<span class="cp">#define CLK_OUT_ENB_CLR_L		0x324</span>
<span class="cp">#define CLK_OUT_ENB_SET_V		0x440</span>
<span class="cp">#define CLK_OUT_ENB_CLR_V		0x444</span>
<span class="cp">#define CLK_OUT_ENB_NUM			5</span>

<span class="cp">#define RST_DEVICES_V_SWR_CPULP_RST_DIS	(0x1 &lt;&lt; 1)</span>
<span class="cp">#define CLK_OUT_ENB_V_CLK_ENB_CPULP_EN	(0x1 &lt;&lt; 1)</span>

<span class="cp">#define PERIPH_CLK_TO_BIT(c)		(1 &lt;&lt; (c-&gt;u.periph.clk_num % 32))</span>
<span class="cp">#define PERIPH_CLK_TO_RST_REG(c)	\</span>
<span class="cp">	periph_clk_to_reg((c), RST_DEVICES_L, RST_DEVICES_V, 4)</span>
<span class="cp">#define PERIPH_CLK_TO_RST_SET_REG(c)	\</span>
<span class="cp">	periph_clk_to_reg((c), RST_DEVICES_SET_L, RST_DEVICES_SET_V, 8)</span>
<span class="cp">#define PERIPH_CLK_TO_RST_CLR_REG(c)	\</span>
<span class="cp">	periph_clk_to_reg((c), RST_DEVICES_CLR_L, RST_DEVICES_CLR_V, 8)</span>

<span class="cp">#define PERIPH_CLK_TO_ENB_REG(c)	\</span>
<span class="cp">	periph_clk_to_reg((c), CLK_OUT_ENB_L, CLK_OUT_ENB_V, 4)</span>
<span class="cp">#define PERIPH_CLK_TO_ENB_SET_REG(c)	\</span>
<span class="cp">	periph_clk_to_reg((c), CLK_OUT_ENB_SET_L, CLK_OUT_ENB_SET_V, 8)</span>
<span class="cp">#define PERIPH_CLK_TO_ENB_CLR_REG(c)	\</span>
<span class="cp">	periph_clk_to_reg((c), CLK_OUT_ENB_CLR_L, CLK_OUT_ENB_CLR_V, 8)</span>

<span class="cp">#define CLK_MASK_ARM			0x44</span>
<span class="cp">#define MISC_CLK_ENB			0x48</span>

<span class="cp">#define OSC_CTRL			0x50</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_MASK		(0xF&lt;&lt;28)</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_13MHZ		(0x0&lt;&lt;28)</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_19_2MHZ	(0x4&lt;&lt;28)</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_12MHZ		(0x8&lt;&lt;28)</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_26MHZ		(0xC&lt;&lt;28)</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_16_8MHZ	(0x1&lt;&lt;28)</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_38_4MHZ	(0x5&lt;&lt;28)</span>
<span class="cp">#define OSC_CTRL_OSC_FREQ_48MHZ		(0x9&lt;&lt;28)</span>
<span class="cp">#define OSC_CTRL_MASK			(0x3f2 | OSC_CTRL_OSC_FREQ_MASK)</span>

<span class="cp">#define OSC_CTRL_PLL_REF_DIV_MASK	(3&lt;&lt;26)</span>
<span class="cp">#define OSC_CTRL_PLL_REF_DIV_1		(0&lt;&lt;26)</span>
<span class="cp">#define OSC_CTRL_PLL_REF_DIV_2		(1&lt;&lt;26)</span>
<span class="cp">#define OSC_CTRL_PLL_REF_DIV_4		(2&lt;&lt;26)</span>

<span class="cp">#define OSC_FREQ_DET			0x58</span>
<span class="cp">#define OSC_FREQ_DET_TRIG		(1&lt;&lt;31)</span>

<span class="cp">#define OSC_FREQ_DET_STATUS		0x5C</span>
<span class="cp">#define OSC_FREQ_DET_BUSY		(1&lt;&lt;31)</span>
<span class="cp">#define OSC_FREQ_DET_CNT_MASK		0xFFFF</span>

<span class="cp">#define PERIPH_CLK_SOURCE_I2S1		0x100</span>
<span class="cp">#define PERIPH_CLK_SOURCE_EMC		0x19c</span>
<span class="cp">#define PERIPH_CLK_SOURCE_OSC		0x1fc</span>
<span class="cp">#define PERIPH_CLK_SOURCE_NUM1 \</span>
<span class="cp">	((PERIPH_CLK_SOURCE_OSC - PERIPH_CLK_SOURCE_I2S1) / 4)</span>

<span class="cp">#define PERIPH_CLK_SOURCE_G3D2		0x3b0</span>
<span class="cp">#define PERIPH_CLK_SOURCE_SE		0x42c</span>
<span class="cp">#define PERIPH_CLK_SOURCE_NUM2 \</span>
<span class="cp">	((PERIPH_CLK_SOURCE_SE - PERIPH_CLK_SOURCE_G3D2) / 4 + 1)</span>

<span class="cp">#define AUDIO_DLY_CLK			0x49c</span>
<span class="cp">#define AUDIO_SYNC_CLK_SPDIF		0x4b4</span>
<span class="cp">#define PERIPH_CLK_SOURCE_NUM3 \</span>
<span class="cp">	((AUDIO_SYNC_CLK_SPDIF - AUDIO_DLY_CLK) / 4 + 1)</span>

<span class="cp">#define PERIPH_CLK_SOURCE_NUM		(PERIPH_CLK_SOURCE_NUM1 + \</span>
<span class="cp">					 PERIPH_CLK_SOURCE_NUM2 + \</span>
<span class="cp">					 PERIPH_CLK_SOURCE_NUM3)</span>

<span class="cp">#define CPU_SOFTRST_CTRL		0x380</span>

<span class="cp">#define PERIPH_CLK_SOURCE_DIVU71_MASK	0xFF</span>
<span class="cp">#define PERIPH_CLK_SOURCE_DIVU16_MASK	0xFFFF</span>
<span class="cp">#define PERIPH_CLK_SOURCE_DIV_SHIFT	0</span>
<span class="cp">#define PERIPH_CLK_SOURCE_DIVIDLE_SHIFT	8</span>
<span class="cp">#define PERIPH_CLK_SOURCE_DIVIDLE_VAL	50</span>
<span class="cp">#define PERIPH_CLK_UART_DIV_ENB		(1&lt;&lt;24)</span>
<span class="cp">#define PERIPH_CLK_VI_SEL_EX_SHIFT	24</span>
<span class="cp">#define PERIPH_CLK_VI_SEL_EX_MASK	(0x3&lt;&lt;PERIPH_CLK_VI_SEL_EX_SHIFT)</span>
<span class="cp">#define PERIPH_CLK_NAND_DIV_EX_ENB	(1&lt;&lt;8)</span>
<span class="cp">#define PERIPH_CLK_DTV_POLARITY_INV	(1&lt;&lt;25)</span>

<span class="cp">#define AUDIO_SYNC_SOURCE_MASK		0x0F</span>
<span class="cp">#define AUDIO_SYNC_DISABLE_BIT		0x10</span>
<span class="cp">#define AUDIO_SYNC_TAP_NIBBLE_SHIFT(c)	((c-&gt;reg_shift - 24) * 4)</span>

<span class="cp">#define PLL_BASE			0x0</span>
<span class="cp">#define PLL_BASE_BYPASS			(1&lt;&lt;31)</span>
<span class="cp">#define PLL_BASE_ENABLE			(1&lt;&lt;30)</span>
<span class="cp">#define PLL_BASE_REF_ENABLE		(1&lt;&lt;29)</span>
<span class="cp">#define PLL_BASE_OVERRIDE		(1&lt;&lt;28)</span>
<span class="cp">#define PLL_BASE_LOCK			(1&lt;&lt;27)</span>
<span class="cp">#define PLL_BASE_DIVP_MASK		(0x7&lt;&lt;20)</span>
<span class="cp">#define PLL_BASE_DIVP_SHIFT		20</span>
<span class="cp">#define PLL_BASE_DIVN_MASK		(0x3FF&lt;&lt;8)</span>
<span class="cp">#define PLL_BASE_DIVN_SHIFT		8</span>
<span class="cp">#define PLL_BASE_DIVM_MASK		(0x1F)</span>
<span class="cp">#define PLL_BASE_DIVM_SHIFT		0</span>

<span class="cp">#define PLL_OUT_RATIO_MASK		(0xFF&lt;&lt;8)</span>
<span class="cp">#define PLL_OUT_RATIO_SHIFT		8</span>
<span class="cp">#define PLL_OUT_OVERRIDE		(1&lt;&lt;2)</span>
<span class="cp">#define PLL_OUT_CLKEN			(1&lt;&lt;1)</span>
<span class="cp">#define PLL_OUT_RESET_DISABLE		(1&lt;&lt;0)</span>

<span class="cp">#define PLL_MISC(c)			\</span>
<span class="cp">	(((c)-&gt;flags &amp; PLL_ALT_MISC_REG) ? 0x4 : 0xc)</span>
<span class="cp">#define PLL_MISC_LOCK_ENABLE(c)	\</span>
<span class="cp">	(((c)-&gt;flags &amp; (PLLU | PLLD)) ? (1&lt;&lt;22) : (1&lt;&lt;18))</span>

<span class="cp">#define PLL_MISC_DCCON_SHIFT		20</span>
<span class="cp">#define PLL_MISC_CPCON_SHIFT		8</span>
<span class="cp">#define PLL_MISC_CPCON_MASK		(0xF&lt;&lt;PLL_MISC_CPCON_SHIFT)</span>
<span class="cp">#define PLL_MISC_LFCON_SHIFT		4</span>
<span class="cp">#define PLL_MISC_LFCON_MASK		(0xF&lt;&lt;PLL_MISC_LFCON_SHIFT)</span>
<span class="cp">#define PLL_MISC_VCOCON_SHIFT		0</span>
<span class="cp">#define PLL_MISC_VCOCON_MASK		(0xF&lt;&lt;PLL_MISC_VCOCON_SHIFT)</span>
<span class="cp">#define PLLD_MISC_CLKENABLE		(1&lt;&lt;30)</span>

<span class="cp">#define PLLU_BASE_POST_DIV		(1&lt;&lt;20)</span>

<span class="cp">#define PLLD_BASE_DSIB_MUX_SHIFT	25</span>
<span class="cp">#define PLLD_BASE_DSIB_MUX_MASK		(1&lt;&lt;PLLD_BASE_DSIB_MUX_SHIFT)</span>
<span class="cp">#define PLLD_BASE_CSI_CLKENABLE		(1&lt;&lt;26)</span>
<span class="cp">#define PLLD_MISC_DSI_CLKENABLE		(1&lt;&lt;30)</span>
<span class="cp">#define PLLD_MISC_DIV_RST		(1&lt;&lt;23)</span>
<span class="cp">#define PLLD_MISC_DCCON_SHIFT		12</span>

<span class="cp">#define PLLDU_LFCON_SET_DIVN		600</span>

<span class="cm">/* FIXME: OUT_OF_TABLE_CPCON per pll */</span>
<span class="cp">#define OUT_OF_TABLE_CPCON		0x8</span>

<span class="cp">#define SUPER_CLK_MUX			0x00</span>
<span class="cp">#define SUPER_STATE_SHIFT		28</span>
<span class="cp">#define SUPER_STATE_MASK		(0xF &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_STATE_STANDBY		(0x0 &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_STATE_IDLE		(0x1 &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_STATE_RUN			(0x2 &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_STATE_IRQ			(0x3 &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_STATE_FIQ			(0x4 &lt;&lt; SUPER_STATE_SHIFT)</span>
<span class="cp">#define SUPER_LP_DIV2_BYPASS		(0x1 &lt;&lt; 16)</span>
<span class="cp">#define SUPER_SOURCE_MASK		0xF</span>
<span class="cp">#define	SUPER_FIQ_SOURCE_SHIFT		12</span>
<span class="cp">#define	SUPER_IRQ_SOURCE_SHIFT		8</span>
<span class="cp">#define	SUPER_RUN_SOURCE_SHIFT		4</span>
<span class="cp">#define	SUPER_IDLE_SOURCE_SHIFT		0</span>

<span class="cp">#define SUPER_CLK_DIVIDER		0x04</span>
<span class="cp">#define SUPER_CLOCK_DIV_U71_SHIFT	16</span>
<span class="cp">#define SUPER_CLOCK_DIV_U71_MASK	(0xff &lt;&lt; SUPER_CLOCK_DIV_U71_SHIFT)</span>
<span class="cm">/* guarantees safe cpu backup */</span>
<span class="cp">#define SUPER_CLOCK_DIV_U71_MIN		0x2</span>

<span class="cp">#define BUS_CLK_DISABLE			(1&lt;&lt;3)</span>
<span class="cp">#define BUS_CLK_DIV_MASK		0x3</span>

<span class="cp">#define PMC_CTRL			0x0</span>
 <span class="cp">#define PMC_CTRL_BLINK_ENB		(1 &lt;&lt; 7)</span>

<span class="cp">#define PMC_DPD_PADS_ORIDE		0x1c</span>
 <span class="cp">#define PMC_DPD_PADS_ORIDE_BLINK_ENB	(1 &lt;&lt; 20)</span>

<span class="cp">#define PMC_BLINK_TIMER_DATA_ON_SHIFT	0</span>
<span class="cp">#define PMC_BLINK_TIMER_DATA_ON_MASK	0x7fff</span>
<span class="cp">#define PMC_BLINK_TIMER_ENB		(1 &lt;&lt; 15)</span>
<span class="cp">#define PMC_BLINK_TIMER_DATA_OFF_SHIFT	16</span>
<span class="cp">#define PMC_BLINK_TIMER_DATA_OFF_MASK	0xffff</span>

<span class="cp">#define PMC_PLLP_WB0_OVERRIDE				0xf8</span>
<span class="cp">#define PMC_PLLP_WB0_OVERRIDE_PLLM_ENABLE		(1 &lt;&lt; 12)</span>

<span class="cp">#define UTMIP_PLL_CFG2					0x488</span>
<span class="cp">#define UTMIP_PLL_CFG2_STABLE_COUNT(x)			(((x) &amp; 0xfff) &lt;&lt; 6)</span>
<span class="cp">#define UTMIP_PLL_CFG2_ACTIVE_DLY_COUNT(x)		(((x) &amp; 0x3f) &lt;&lt; 18)</span>
<span class="cp">#define UTMIP_PLL_CFG2_FORCE_PD_SAMP_A_POWERDOWN	(1 &lt;&lt; 0)</span>
<span class="cp">#define UTMIP_PLL_CFG2_FORCE_PD_SAMP_B_POWERDOWN	(1 &lt;&lt; 2)</span>
<span class="cp">#define UTMIP_PLL_CFG2_FORCE_PD_SAMP_C_POWERDOWN	(1 &lt;&lt; 4)</span>

<span class="cp">#define UTMIP_PLL_CFG1					0x484</span>
<span class="cp">#define UTMIP_PLL_CFG1_ENABLE_DLY_COUNT(x)		(((x) &amp; 0x1f) &lt;&lt; 27)</span>
<span class="cp">#define UTMIP_PLL_CFG1_XTAL_FREQ_COUNT(x)		(((x) &amp; 0xfff) &lt;&lt; 0)</span>
<span class="cp">#define UTMIP_PLL_CFG1_FORCE_PLL_ENABLE_POWERDOWN	(1 &lt;&lt; 14)</span>
<span class="cp">#define UTMIP_PLL_CFG1_FORCE_PLL_ACTIVE_POWERDOWN	(1 &lt;&lt; 12)</span>
<span class="cp">#define UTMIP_PLL_CFG1_FORCE_PLLU_POWERDOWN		(1 &lt;&lt; 16)</span>

<span class="cp">#define PLLE_BASE_CML_ENABLE		(1&lt;&lt;31)</span>
<span class="cp">#define PLLE_BASE_ENABLE		(1&lt;&lt;30)</span>
<span class="cp">#define PLLE_BASE_DIVCML_SHIFT		24</span>
<span class="cp">#define PLLE_BASE_DIVCML_MASK		(0xf&lt;&lt;PLLE_BASE_DIVCML_SHIFT)</span>
<span class="cp">#define PLLE_BASE_DIVP_SHIFT		16</span>
<span class="cp">#define PLLE_BASE_DIVP_MASK		(0x3f&lt;&lt;PLLE_BASE_DIVP_SHIFT)</span>
<span class="cp">#define PLLE_BASE_DIVN_SHIFT		8</span>
<span class="cp">#define PLLE_BASE_DIVN_MASK		(0xFF&lt;&lt;PLLE_BASE_DIVN_SHIFT)</span>
<span class="cp">#define PLLE_BASE_DIVM_SHIFT		0</span>
<span class="cp">#define PLLE_BASE_DIVM_MASK		(0xFF&lt;&lt;PLLE_BASE_DIVM_SHIFT)</span>
<span class="cp">#define PLLE_BASE_DIV_MASK		\</span>
<span class="cp">	(PLLE_BASE_DIVCML_MASK | PLLE_BASE_DIVP_MASK | \</span>
<span class="cp">	 PLLE_BASE_DIVN_MASK | PLLE_BASE_DIVM_MASK)</span>
<span class="cp">#define PLLE_BASE_DIV(m, n, p, cml)		\</span>
<span class="cp">	 (((cml)&lt;&lt;PLLE_BASE_DIVCML_SHIFT) | ((p)&lt;&lt;PLLE_BASE_DIVP_SHIFT) | \</span>
<span class="cp">	  ((n)&lt;&lt;PLLE_BASE_DIVN_SHIFT) | ((m)&lt;&lt;PLLE_BASE_DIVM_SHIFT))</span>

<span class="cp">#define PLLE_MISC_SETUP_BASE_SHIFT	16</span>
<span class="cp">#define PLLE_MISC_SETUP_BASE_MASK	(0xFFFF&lt;&lt;PLLE_MISC_SETUP_BASE_SHIFT)</span>
<span class="cp">#define PLLE_MISC_READY			(1&lt;&lt;15)</span>
<span class="cp">#define PLLE_MISC_LOCK			(1&lt;&lt;11)</span>
<span class="cp">#define PLLE_MISC_LOCK_ENABLE		(1&lt;&lt;9)</span>
<span class="cp">#define PLLE_MISC_SETUP_EX_SHIFT	2</span>
<span class="cp">#define PLLE_MISC_SETUP_EX_MASK		(0x3&lt;&lt;PLLE_MISC_SETUP_EX_SHIFT)</span>
<span class="cp">#define PLLE_MISC_SETUP_MASK		\</span>
<span class="cp">	  (PLLE_MISC_SETUP_BASE_MASK | PLLE_MISC_SETUP_EX_MASK)</span>
<span class="cp">#define PLLE_MISC_SETUP_VALUE		\</span>
<span class="cp">	  ((0x7&lt;&lt;PLLE_MISC_SETUP_BASE_SHIFT) | (0x0&lt;&lt;PLLE_MISC_SETUP_EX_SHIFT))</span>

<span class="cp">#define PLLE_SS_CTRL			0x68</span>
<span class="cp">#define	PLLE_SS_INCINTRV_SHIFT		24</span>
<span class="cp">#define	PLLE_SS_INCINTRV_MASK		(0x3f&lt;&lt;PLLE_SS_INCINTRV_SHIFT)</span>
<span class="cp">#define	PLLE_SS_INC_SHIFT		16</span>
<span class="cp">#define	PLLE_SS_INC_MASK		(0xff&lt;&lt;PLLE_SS_INC_SHIFT)</span>
<span class="cp">#define	PLLE_SS_MAX_SHIFT		0</span>
<span class="cp">#define	PLLE_SS_MAX_MASK		(0x1ff&lt;&lt;PLLE_SS_MAX_SHIFT)</span>
<span class="cp">#define PLLE_SS_COEFFICIENTS_MASK	\</span>
<span class="cp">	(PLLE_SS_INCINTRV_MASK | PLLE_SS_INC_MASK | PLLE_SS_MAX_MASK)</span>
<span class="cp">#define PLLE_SS_COEFFICIENTS_12MHZ	\</span>
<span class="cp">	((0x18&lt;&lt;PLLE_SS_INCINTRV_SHIFT) | (0x1&lt;&lt;PLLE_SS_INC_SHIFT) | \</span>
<span class="cp">	 (0x24&lt;&lt;PLLE_SS_MAX_SHIFT))</span>
<span class="cp">#define PLLE_SS_DISABLE			((1&lt;&lt;12) | (1&lt;&lt;11) | (1&lt;&lt;10))</span>

<span class="cp">#define PLLE_AUX			0x48c</span>
<span class="cp">#define PLLE_AUX_PLLP_SEL		(1&lt;&lt;2)</span>
<span class="cp">#define PLLE_AUX_CML_SATA_ENABLE	(1&lt;&lt;1)</span>
<span class="cp">#define PLLE_AUX_CML_PCIE_ENABLE	(1&lt;&lt;0)</span>

<span class="cp">#define	PMC_SATA_PWRGT			0x1ac</span>
<span class="cp">#define PMC_SATA_PWRGT_PLLE_IDDQ_VALUE	(1&lt;&lt;5)</span>
<span class="cp">#define PMC_SATA_PWRGT_PLLE_IDDQ_SWCTL	(1&lt;&lt;4)</span>

<span class="cp">#define ROUND_DIVIDER_UP	0</span>
<span class="cp">#define ROUND_DIVIDER_DOWN	1</span>

<span class="cm">/* FIXME: recommended safety delay after lock is detected */</span>
<span class="cp">#define PLL_POST_LOCK_DELAY		100</span>

<span class="cm">/**</span>
<span class="cm">* Structure defining the fields for USB UTMI clocks Parameters.</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">utmi_clk_param</span> <span class="p">{</span>
	<span class="cm">/* Oscillator Frequency in KHz */</span>
	<span class="n">u32</span> <span class="n">osc_frequency</span><span class="p">;</span>
	<span class="cm">/* UTMIP PLL Enable Delay Count  */</span>
	<span class="n">u8</span> <span class="n">enable_delay_count</span><span class="p">;</span>
	<span class="cm">/* UTMIP PLL Stable count */</span>
	<span class="n">u8</span> <span class="n">stable_count</span><span class="p">;</span>
	<span class="cm">/*  UTMIP PLL Active delay count */</span>
	<span class="n">u8</span> <span class="n">active_delay_count</span><span class="p">;</span>
	<span class="cm">/* UTMIP PLL Xtal frequency count */</span>
	<span class="n">u8</span> <span class="n">xtal_freq_count</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">utmi_clk_param</span> <span class="n">utmi_parameters</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">osc_frequency</span> <span class="o">=</span> <span class="mi">13000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">enable_delay_count</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
		<span class="p">.</span><span class="n">stable_count</span> <span class="o">=</span> <span class="mh">0x33</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_delay_count</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xtal_freq_count</span> <span class="o">=</span> <span class="mh">0x7F</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">osc_frequency</span> <span class="o">=</span> <span class="mi">19200000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">enable_delay_count</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
		<span class="p">.</span><span class="n">stable_count</span> <span class="o">=</span> <span class="mh">0x4B</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_delay_count</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xtal_freq_count</span> <span class="o">=</span> <span class="mh">0xBB</span><span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">osc_frequency</span> <span class="o">=</span> <span class="mi">12000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">enable_delay_count</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
		<span class="p">.</span><span class="n">stable_count</span> <span class="o">=</span> <span class="mh">0x2F</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_delay_count</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xtal_freq_count</span> <span class="o">=</span> <span class="mh">0x76</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">osc_frequency</span> <span class="o">=</span> <span class="mi">26000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">enable_delay_count</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
		<span class="p">.</span><span class="n">stable_count</span> <span class="o">=</span> <span class="mh">0x66</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_delay_count</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xtal_freq_count</span> <span class="o">=</span> <span class="mh">0xFE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">osc_frequency</span> <span class="o">=</span> <span class="mi">16800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">enable_delay_count</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
		<span class="p">.</span><span class="n">stable_count</span> <span class="o">=</span> <span class="mh">0x41</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_delay_count</span> <span class="o">=</span> <span class="mh">0x0A</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xtal_freq_count</span> <span class="o">=</span> <span class="mh">0xA4</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg_clk_base</span> <span class="o">=</span> <span class="n">IO_ADDRESS</span><span class="p">(</span><span class="n">TEGRA_CLK_RESET_BASE</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg_pmc_base</span> <span class="o">=</span> <span class="n">IO_ADDRESS</span><span class="p">(</span><span class="n">TEGRA_PMC_BASE</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">misc_gp_hidrev_base</span> <span class="o">=</span> <span class="n">IO_ADDRESS</span><span class="p">(</span><span class="n">TEGRA_APB_MISC_BASE</span><span class="p">);</span>

<span class="cp">#define MISC_GP_HIDREV                  0x804</span>

<span class="cm">/*</span>
<span class="cm"> * Some peripheral clocks share an enable bit, so refcount the enable bits</span>
<span class="cm"> * in registers CLK_ENABLE_L, ... CLK_ENABLE_W</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">tegra_periph_clk_enable_refcount</span><span class="p">[</span><span class="n">CLK_OUT_ENB_NUM</span> <span class="o">*</span> <span class="mi">32</span><span class="p">];</span>

<span class="cp">#define clk_writel(value, reg) \</span>
<span class="cp">	__raw_writel(value, (u32)reg_clk_base + (reg))</span>
<span class="cp">#define clk_readl(reg) \</span>
<span class="cp">	__raw_readl((u32)reg_clk_base + (reg))</span>
<span class="cp">#define pmc_writel(value, reg) \</span>
<span class="cp">	__raw_writel(value, (u32)reg_pmc_base + (reg))</span>
<span class="cp">#define pmc_readl(reg) \</span>
<span class="cp">	__raw_readl((u32)reg_pmc_base + (reg))</span>
<span class="cp">#define chipid_readl() \</span>
<span class="cp">	__raw_readl((u32)misc_gp_hidrev_base + MISC_GP_HIDREV)</span>

<span class="cp">#define clk_writel_delay(value, reg)					\</span>
<span class="cp">	do {								\</span>
<span class="cp">		__raw_writel((value), (u32)reg_clk_base + (reg));	\</span>
<span class="cp">		udelay(2);						\</span>
<span class="cp">	} while (0)</span>


<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">clk_set_div</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">u32</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">clk_set_rate</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">periph_clk_to_reg</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg_L</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg_V</span><span class="p">,</span> <span class="kt">int</span> <span class="n">offs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span> <span class="o">/</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">reg</span> <span class="o">&gt;=</span> <span class="n">RST_DEVICES_NUM</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">reg_L</span> <span class="o">+</span> <span class="p">(</span><span class="n">reg</span> <span class="o">*</span> <span class="n">offs</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">reg_V</span> <span class="o">+</span> <span class="p">((</span><span class="n">reg</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">offs</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">reg</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">clk_measure_input_freq</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">clock_autodetect</span><span class="p">;</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">OSC_FREQ_DET_TRIG</span> <span class="o">|</span> <span class="mi">1</span><span class="p">,</span> <span class="n">OSC_FREQ_DET</span><span class="p">);</span>
	<span class="k">do</span> <span class="p">{}</span> <span class="k">while</span> <span class="p">(</span><span class="n">clk_readl</span><span class="p">(</span><span class="n">OSC_FREQ_DET_STATUS</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">OSC_FREQ_DET_BUSY</span><span class="p">);</span>
	<span class="n">clock_autodetect</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">OSC_FREQ_DET_STATUS</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">clock_autodetect</span> <span class="o">&gt;=</span> <span class="mi">732</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">clock_autodetect</span> <span class="o">&lt;=</span> <span class="mi">732</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">12000000</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">clock_autodetect</span> <span class="o">&gt;=</span> <span class="mi">794</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">clock_autodetect</span> <span class="o">&lt;=</span> <span class="mi">794</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">13000000</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">clock_autodetect</span> <span class="o">&gt;=</span> <span class="mi">1172</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">clock_autodetect</span> <span class="o">&lt;=</span> <span class="mi">1172</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">19200000</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">clock_autodetect</span> <span class="o">&gt;=</span> <span class="mi">1587</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">clock_autodetect</span> <span class="o">&lt;=</span> <span class="mi">1587</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">26000000</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">clock_autodetect</span> <span class="o">&gt;=</span> <span class="mi">1025</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">clock_autodetect</span> <span class="o">&lt;=</span> <span class="mi">1025</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">16800000</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">clock_autodetect</span> <span class="o">&gt;=</span> <span class="mi">2344</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">clock_autodetect</span> <span class="o">&lt;=</span> <span class="mi">2344</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">38400000</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">clock_autodetect</span> <span class="o">&gt;=</span> <span class="mi">2928</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">clock_autodetect</span> <span class="o">&lt;=</span> <span class="mi">2928</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">48000000</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Unexpected clock autodetect value %d&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
			<span class="n">clock_autodetect</span><span class="p">);</span>
		<span class="n">BUG</span><span class="p">();</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">clk_div71_get_divider</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">,</span>
				 <span class="n">u32</span> <span class="n">flags</span><span class="p">,</span> <span class="n">u32</span> <span class="n">round_mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s64</span> <span class="n">divider_u71</span> <span class="o">=</span> <span class="n">parent_rate</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rate</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71_INT</span><span class="p">))</span>
		<span class="n">divider_u71</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">round_mode</span> <span class="o">==</span> <span class="n">ROUND_DIVIDER_UP</span><span class="p">)</span>
		<span class="n">divider_u71</span> <span class="o">+=</span> <span class="n">rate</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">do_div</span><span class="p">(</span><span class="n">divider_u71</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71_INT</span><span class="p">)</span>
		<span class="n">divider_u71</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">divider_u71</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">divider_u71</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">divider_u71</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">clk_div16_get_divider</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s64</span> <span class="n">divider_u16</span><span class="p">;</span>

	<span class="n">divider_u16</span> <span class="o">=</span> <span class="n">parent_rate</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rate</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">divider_u16</span> <span class="o">+=</span> <span class="n">rate</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">do_div</span><span class="p">(</span><span class="n">divider_u16</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">divider_u16</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">divider_u16</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mh">0xFFFF</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">divider_u16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* clk_m functions */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">tegra30_clk_m_autodetect_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">osc_ctrl</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">OSC_CTRL</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">auto_clock_control</span> <span class="o">=</span> <span class="n">osc_ctrl</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">OSC_CTRL_OSC_FREQ_MASK</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pll_ref_div</span> <span class="o">=</span> <span class="n">osc_ctrl</span> <span class="o">&amp;</span> <span class="n">OSC_CTRL_PLL_REF_DIV_MASK</span><span class="p">;</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">clk_measure_input_freq</span><span class="p">();</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">12000000</span>:
		<span class="n">auto_clock_control</span> <span class="o">|=</span> <span class="n">OSC_CTRL_OSC_FREQ_12MHZ</span><span class="p">;</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">pll_ref_div</span> <span class="o">!=</span> <span class="n">OSC_CTRL_PLL_REF_DIV_1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">13000000</span>:
		<span class="n">auto_clock_control</span> <span class="o">|=</span> <span class="n">OSC_CTRL_OSC_FREQ_13MHZ</span><span class="p">;</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">pll_ref_div</span> <span class="o">!=</span> <span class="n">OSC_CTRL_PLL_REF_DIV_1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">19200000</span>:
		<span class="n">auto_clock_control</span> <span class="o">|=</span> <span class="n">OSC_CTRL_OSC_FREQ_19_2MHZ</span><span class="p">;</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">pll_ref_div</span> <span class="o">!=</span> <span class="n">OSC_CTRL_PLL_REF_DIV_1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">26000000</span>:
		<span class="n">auto_clock_control</span> <span class="o">|=</span> <span class="n">OSC_CTRL_OSC_FREQ_26MHZ</span><span class="p">;</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">pll_ref_div</span> <span class="o">!=</span> <span class="n">OSC_CTRL_PLL_REF_DIV_1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">16800000</span>:
		<span class="n">auto_clock_control</span> <span class="o">|=</span> <span class="n">OSC_CTRL_OSC_FREQ_16_8MHZ</span><span class="p">;</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">pll_ref_div</span> <span class="o">!=</span> <span class="n">OSC_CTRL_PLL_REF_DIV_1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">38400000</span>:
		<span class="n">auto_clock_control</span> <span class="o">|=</span> <span class="n">OSC_CTRL_OSC_FREQ_38_4MHZ</span><span class="p">;</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">pll_ref_div</span> <span class="o">!=</span> <span class="n">OSC_CTRL_PLL_REF_DIV_2</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">48000000</span>:
		<span class="n">auto_clock_control</span> <span class="o">|=</span> <span class="n">OSC_CTRL_OSC_FREQ_48MHZ</span><span class="p">;</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">pll_ref_div</span> <span class="o">!=</span> <span class="n">OSC_CTRL_PLL_REF_DIV_4</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Unexpected clock rate %ld&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">);</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">auto_clock_control</span><span class="p">,</span> <span class="n">OSC_CTRL</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_clk_m_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="n">tegra30_clk_m_autodetect_rate</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_clk_m_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_clk_m_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="n">WARN</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Attempting to disable main SoC clock</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_clk_m_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="n">tegra30_clk_m_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>		<span class="o">=</span> <span class="n">tegra30_clk_m_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>	<span class="o">=</span> <span class="n">tegra30_clk_m_disable</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_clk_m_div_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">enable</span>		<span class="o">=</span> <span class="n">tegra30_clk_m_enable</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* PLL reference divider functions */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_pll_ref_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">pll_ref_div</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">OSC_CTRL</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">OSC_CTRL_PLL_REF_DIV_MASK</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">pll_ref_div</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OSC_CTRL_PLL_REF_DIV_1</span>:
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OSC_CTRL_PLL_REF_DIV_2</span>:
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OSC_CTRL_PLL_REF_DIV_4</span>:
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Invalid pll ref divider %d&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">pll_ref_div</span><span class="p">);</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">ON</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_pll_ref_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="n">tegra30_pll_ref_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>		<span class="o">=</span> <span class="n">tegra30_clk_m_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>	<span class="o">=</span> <span class="n">tegra30_clk_m_disable</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* super clock functions */</span>
<span class="cm">/* &quot;super clocks&quot; on tegra30 have two-stage muxes, fractional 7.1 divider and</span>
<span class="cm"> * clock skipping super divider.  We will ignore the clock skipping divider,</span>
<span class="cm"> * since we can&#39;t lower the voltage when using the clock skip, but we can if</span>
<span class="cm"> * we lower the PLL frequency. We will use 7.1 divider for CPU super-clock</span>
<span class="cm"> * only when its parent is a fixed rate PLL, since we can&#39;t change PLL rate</span>
<span class="cm"> * in this case.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_super_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">source</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">shift</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_MUX</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">ON</span><span class="p">;</span>
	<span class="n">BUG_ON</span><span class="p">(((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SUPER_STATE_RUN</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SUPER_STATE_IDLE</span><span class="p">));</span>
	<span class="n">shift</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">==</span> <span class="n">SUPER_STATE_IDLE</span><span class="p">)</span> <span class="o">?</span>
		<span class="n">SUPER_IDLE_SOURCE_SHIFT</span> <span class="o">:</span> <span class="n">SUPER_RUN_SOURCE_SHIFT</span><span class="p">;</span>
	<span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">SUPER_SOURCE_MASK</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_2</span><span class="p">)</span>
		<span class="n">source</span> <span class="o">|=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_LP_DIV2_BYPASS</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">==</span> <span class="n">source</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Init safe 7.1 divider value (does not affect PLLX path) */</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">SUPER_CLOCK_DIV_U71_MIN</span> <span class="o">&lt;&lt;</span> <span class="n">SUPER_CLOCK_DIV_U71_SHIFT</span><span class="p">,</span>
			   <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_DIVIDER</span><span class="p">);</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLX</span><span class="p">))</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">+=</span> <span class="n">SUPER_CLOCK_DIV_U71_MIN</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_DIVIDER</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_super_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_super_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* since tegra 3 has 2 CPU super clocks - low power lp-mode clock and</span>
<span class="cm">	   geared up g-mode super clock - mode switch may request to disable</span>
<span class="cm">	   either of them; accept request with no affect on h/w */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_super_clk_set_parent</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">shift</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_MUX</span><span class="p">);</span>
	<span class="n">BUG_ON</span><span class="p">(((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SUPER_STATE_RUN</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">!=</span> <span class="n">SUPER_STATE_IDLE</span><span class="p">));</span>
	<span class="n">shift</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SUPER_STATE_MASK</span><span class="p">)</span> <span class="o">==</span> <span class="n">SUPER_STATE_IDLE</span><span class="p">)</span> <span class="o">?</span>
		<span class="n">SUPER_IDLE_SOURCE_SHIFT</span> <span class="o">:</span> <span class="n">SUPER_RUN_SOURCE_SHIFT</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* For LP mode super-clock switch between PLLX direct</span>
<span class="cm">			   and divided-by-2 outputs is allowed only when other</span>
<span class="cm">			   than PLLX clock source is current parent */</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLX</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
			    <span class="p">((</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">^</span> <span class="n">val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">SUPER_LP_DIV2_BYPASS</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLX</span><span class="p">)</span>
					<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
				<span class="n">val</span> <span class="o">^=</span> <span class="n">SUPER_LP_DIV2_BYPASS</span><span class="p">;</span>
				<span class="n">clk_writel_delay</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">SUPER_SOURCE_MASK</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">SUPER_SOURCE_MASK</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">;</span>

			<span class="cm">/* 7.1 divider for CPU super-clock does not affect</span>
<span class="cm">			   PLLX path */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">u32</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLX</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">div</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span>
							<span class="n">SUPER_CLK_DIVIDER</span><span class="p">);</span>
					<span class="n">div</span> <span class="o">&amp;=</span> <span class="n">SUPER_CLOCK_DIV_U71_MASK</span><span class="p">;</span>
					<span class="n">div</span> <span class="o">&gt;&gt;=</span> <span class="n">SUPER_CLOCK_DIV_U71_SHIFT</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">div</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
				<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">)</span>
				<span class="n">clk_enable</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

			<span class="n">clk_writel_delay</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span> <span class="o">&amp;&amp;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span>
				<span class="n">clk_disable</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

			<span class="n">clk_reparent</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Do not use super clocks &quot;skippers&quot;, since dividing using a clock skipper</span>
<span class="cm"> * does not allow the voltage to be scaled down. Instead adjust the rate of</span>
<span class="cm"> * the parent clock. This requires that the parent of a super clock have no</span>
<span class="cm"> * other children, otherwise the rate will change underneath the other</span>
<span class="cm"> * children. Special case: if fixed rate PLL is CPU super clock parent the</span>
<span class="cm"> * rate of this PLL can&#39;t be changed, and it has many other children. In</span>
<span class="cm"> * this case use 7.1 fractional divider to adjust the super clock rate.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_super_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLL_FIXED</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="n">clk_div71_get_divider</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">fixed_rate</span><span class="p">,</span>
					<span class="n">rate</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">,</span> <span class="n">ROUND_DIVIDER_DOWN</span><span class="p">);</span>
		<span class="n">div</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">div</span><span class="p">,</span> <span class="n">SUPER_CLOCK_DIV_U71_MIN</span><span class="p">);</span>

		<span class="n">clk_writel</span><span class="p">(</span><span class="n">div</span> <span class="o">&lt;&lt;</span> <span class="n">SUPER_CLOCK_DIV_U71_SHIFT</span><span class="p">,</span>
			   <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">SUPER_CLK_DIVIDER</span><span class="p">);</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">div</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">clk_set_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_super_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="n">tegra30_super_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="n">tegra30_super_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="n">tegra30_super_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span>		<span class="o">=</span> <span class="n">tegra30_super_clk_set_parent</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="n">tegra30_super_clk_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_twd_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* The input value &#39;rate&#39; is the clock rate of the CPU complex. */</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">rate</span> <span class="o">*</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra30_twd_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">set_rate</span>	<span class="o">=</span> <span class="n">tegra30_twd_clk_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Blink output functions */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_blink_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_CTRL</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PMC_CTRL_BLINK_ENB</span><span class="p">)</span> <span class="o">?</span> <span class="n">ON</span> <span class="o">:</span> <span class="n">OFF</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PMC_BLINK_TIMER_ENB</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">on_off</span><span class="p">;</span>

		<span class="n">on_off</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">PMC_BLINK_TIMER_DATA_ON_SHIFT</span><span class="p">)</span> <span class="o">&amp;</span>
			<span class="n">PMC_BLINK_TIMER_DATA_ON_MASK</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">&gt;&gt;=</span> <span class="n">PMC_BLINK_TIMER_DATA_OFF_SHIFT</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="n">PMC_BLINK_TIMER_DATA_OFF_MASK</span><span class="p">;</span>
		<span class="n">on_off</span> <span class="o">+=</span> <span class="n">val</span><span class="p">;</span>
		<span class="cm">/* each tick in the blink timer is 4 32KHz clocks */</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">on_off</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_blink_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_DPD_PADS_ORIDE</span><span class="p">);</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span> <span class="o">|</span> <span class="n">PMC_DPD_PADS_ORIDE_BLINK_ENB</span><span class="p">,</span> <span class="n">PMC_DPD_PADS_ORIDE</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_CTRL</span><span class="p">);</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span> <span class="o">|</span> <span class="n">PMC_CTRL_BLINK_ENB</span><span class="p">,</span> <span class="n">PMC_CTRL</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_blink_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_CTRL</span><span class="p">);</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">PMC_CTRL_BLINK_ENB</span><span class="p">,</span> <span class="n">PMC_CTRL</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_DPD_PADS_ORIDE</span><span class="p">);</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">PMC_DPD_PADS_ORIDE_BLINK_ENB</span><span class="p">,</span> <span class="n">PMC_DPD_PADS_ORIDE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_blink_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&gt;=</span> <span class="n">parent_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">pmc_writel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">on_off</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

		<span class="n">on_off</span> <span class="o">=</span> <span class="n">DIV_ROUND_UP</span><span class="p">(</span><span class="n">parent_rate</span> <span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">on_off</span> <span class="o">*</span> <span class="mi">8</span><span class="p">;</span>

		<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">on_off</span> <span class="o">&amp;</span> <span class="n">PMC_BLINK_TIMER_DATA_ON_MASK</span><span class="p">)</span> <span class="o">&lt;&lt;</span>
			<span class="n">PMC_BLINK_TIMER_DATA_ON_SHIFT</span><span class="p">;</span>
		<span class="n">on_off</span> <span class="o">&amp;=</span> <span class="n">PMC_BLINK_TIMER_DATA_OFF_MASK</span><span class="p">;</span>
		<span class="n">on_off</span> <span class="o">&lt;&lt;=</span> <span class="n">PMC_BLINK_TIMER_DATA_OFF_SHIFT</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">on_off</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">PMC_BLINK_TIMER_ENB</span><span class="p">;</span>
		<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_blink_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_blink_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_blink_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_blink_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_blink_clk_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* PLL Functions */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_pll_clk_wait_for_lock</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">u32</span> <span class="n">lock_reg</span><span class="p">,</span>
					 <span class="n">u32</span> <span class="n">lock_bit</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if USE_PLL_LOCK_BITS</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">lock_delay</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clk_readl</span><span class="p">(</span><span class="n">lock_reg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">lock_bit</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">udelay</span><span class="p">(</span><span class="n">PLL_POST_LOCK_DELAY</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>		<span class="cm">/* timeout = 2 * lock time */</span>
	<span class="p">}</span>
	<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Timed out waiting for lock bit on pll %s&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">udelay</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">lock_delay</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_utmi_param_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">reg</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">main_rate</span> <span class="o">=</span>
		<span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">utmi_parameters</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">main_rate</span> <span class="o">==</span> <span class="n">utmi_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">osc_frequency</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">utmi_parameters</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Unexpected main rate %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">main_rate</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">UTMIP_PLL_CFG2</span><span class="p">);</span>

	<span class="cm">/* Program UTMIP PLL stable and active counts */</span>
	<span class="cm">/* [FIXME] arclk_rst.h says WRONG! This should be 1ms -&gt; 0x50 Check! */</span>
	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">UTMIP_PLL_CFG2_STABLE_COUNT</span><span class="p">(</span><span class="o">~</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">reg</span> <span class="o">|=</span> <span class="n">UTMIP_PLL_CFG2_STABLE_COUNT</span><span class="p">(</span>
			<span class="n">utmi_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">stable_count</span><span class="p">);</span>

	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">UTMIP_PLL_CFG2_ACTIVE_DLY_COUNT</span><span class="p">(</span><span class="o">~</span><span class="mi">0</span><span class="p">);</span>

	<span class="n">reg</span> <span class="o">|=</span> <span class="n">UTMIP_PLL_CFG2_ACTIVE_DLY_COUNT</span><span class="p">(</span>
			<span class="n">utmi_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">active_delay_count</span><span class="p">);</span>

	<span class="cm">/* Remove power downs from UTMIP PLL control bits */</span>
	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">UTMIP_PLL_CFG2_FORCE_PD_SAMP_A_POWERDOWN</span><span class="p">;</span>
	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">UTMIP_PLL_CFG2_FORCE_PD_SAMP_B_POWERDOWN</span><span class="p">;</span>
	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">UTMIP_PLL_CFG2_FORCE_PD_SAMP_C_POWERDOWN</span><span class="p">;</span>

	<span class="n">clk_writel</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">UTMIP_PLL_CFG2</span><span class="p">);</span>

	<span class="cm">/* Program UTMIP PLL delay and oscillator frequency counts */</span>
	<span class="n">reg</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">UTMIP_PLL_CFG1</span><span class="p">);</span>
	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">UTMIP_PLL_CFG1_ENABLE_DLY_COUNT</span><span class="p">(</span><span class="o">~</span><span class="mi">0</span><span class="p">);</span>

	<span class="n">reg</span> <span class="o">|=</span> <span class="n">UTMIP_PLL_CFG1_ENABLE_DLY_COUNT</span><span class="p">(</span>
		<span class="n">utmi_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enable_delay_count</span><span class="p">);</span>

	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">UTMIP_PLL_CFG1_XTAL_FREQ_COUNT</span><span class="p">(</span><span class="o">~</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">reg</span> <span class="o">|=</span> <span class="n">UTMIP_PLL_CFG1_XTAL_FREQ_COUNT</span><span class="p">(</span>
		<span class="n">utmi_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">xtal_freq_count</span><span class="p">);</span>

	<span class="cm">/* Remove power downs from UTMIP PLL control bits */</span>
	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">UTMIP_PLL_CFG1_FORCE_PLL_ENABLE_POWERDOWN</span><span class="p">;</span>
	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">UTMIP_PLL_CFG1_FORCE_PLL_ACTIVE_POWERDOWN</span><span class="p">;</span>
	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">UTMIP_PLL_CFG1_FORCE_PLLU_POWERDOWN</span><span class="p">;</span>

	<span class="n">clk_writel</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">UTMIP_PLL_CFG1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_pll_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_ENABLE</span><span class="p">)</span> <span class="o">?</span> <span class="n">ON</span> <span class="o">:</span> <span class="n">OFF</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLL_FIXED</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_OVERRIDE</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">input_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">freq_table</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input_rate</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input_rate</span> <span class="o">==</span> <span class="n">input_rate</span> <span class="o">&amp;&amp;</span>
				<span class="n">sel</span><span class="o">-&gt;</span><span class="n">output_rate</span> <span class="o">==</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">fixed_rate</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
				<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">m</span> <span class="o">*</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">;</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Clock %s has unknown fixed frequency</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_BYPASS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_DIVN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">PLL_BASE_DIVN_SHIFT</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_DIVM_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">PLL_BASE_DIVM_SHIFT</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLU</span><span class="p">)</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">*=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLLU_BASE_POST_DIV</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">*=</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_BASE_DIVP_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
					<span class="n">PLL_BASE_DIVP_SHIFT</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLL_FIXED</span><span class="p">)</span> <span class="p">{</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">clk_get_rate_locked</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
			<span class="n">BUG_ON</span><span class="p">(</span><span class="n">rate</span> <span class="o">!=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">fixed_rate</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLU</span><span class="p">)</span>
		<span class="n">tegra30_utmi_param_configure</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_pll_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

<span class="cp">#if USE_PLL_LOCK_BITS</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">PLL_MISC_LOCK_ENABLE</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
<span class="cp">#endif</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PLL_BASE_BYPASS</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">PLL_BASE_ENABLE</span><span class="p">;</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLM</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_PLLP_WB0_OVERRIDE</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">PMC_PLLP_WB0_OVERRIDE_PLLM_ENABLE</span><span class="p">;</span>
		<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">PMC_PLLP_WB0_OVERRIDE</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">tegra30_pll_clk_wait_for_lock</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">,</span> <span class="n">PLL_BASE_LOCK</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_pll_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">PLL_BASE_BYPASS</span> <span class="o">|</span> <span class="n">PLL_BASE_ENABLE</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLM</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_PLLP_WB0_OVERRIDE</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PMC_PLLP_WB0_OVERRIDE_PLLM_ENABLE</span><span class="p">;</span>
		<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">PMC_PLLP_WB0_OVERRIDE</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_pll_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">,</span> <span class="n">p_div</span><span class="p">,</span> <span class="n">old_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">input_rate</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">cfg</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLL_FIXED</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">!=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">fixed_rate</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Can not change %s fixed rate %lu to %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">fixed_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLM</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">!=</span> <span class="n">clk_get_rate_locked</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Can not change memory %s rate in flight</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">p_div</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">input_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

	<span class="cm">/* Check if the target rate is tabulated */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">freq_table</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input_rate</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input_rate</span> <span class="o">==</span> <span class="n">input_rate</span> <span class="o">&amp;&amp;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">output_rate</span> <span class="o">==</span> <span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLU</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">BUG_ON</span><span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
					<span class="n">p_div</span> <span class="o">=</span> <span class="n">PLLU_BASE_POST_DIV</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">BUG_ON</span><span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">val</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">;</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="n">val</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">)</span>
					<span class="n">p_div</span><span class="o">++</span><span class="p">;</span>
				<span class="n">p_div</span> <span class="o">&lt;&lt;=</span> <span class="n">PLL_BASE_DIVP_SHIFT</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/* Configure out-of-table rate */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input_rate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cfreq</span><span class="p">;</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLU</span><span class="p">);</span>
		<span class="n">sel</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cfg</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">input_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">12000000</span>:
		<span class="k">case</span> <span class="mi">26000000</span>:
			<span class="n">cfreq</span> <span class="o">=</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&lt;=</span> <span class="mi">1000000</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1000000</span> <span class="o">:</span> <span class="mi">2000000</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">13000000</span>:
			<span class="n">cfreq</span> <span class="o">=</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&lt;=</span> <span class="mi">1000000</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1000000</span> <span class="o">:</span> <span class="mi">2600000</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">16800000</span>:
		<span class="k">case</span> <span class="mi">19200000</span>:
			<span class="n">cfreq</span> <span class="o">=</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&lt;=</span> <span class="mi">1200000</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1200000</span> <span class="o">:</span> <span class="mi">2400000</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Unexpected reference rate %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">__func__</span><span class="p">,</span> <span class="n">input_rate</span><span class="p">);</span>
			<span class="n">BUG</span><span class="p">();</span>
		<span class="p">}</span>

		<span class="cm">/* Raise VCO to guarantee 0.5% accuracy */</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">output_rate</span> <span class="o">=</span> <span class="n">rate</span><span class="p">;</span> <span class="n">cfg</span><span class="p">.</span><span class="n">output_rate</span> <span class="o">&lt;</span> <span class="mi">200</span> <span class="o">*</span> <span class="n">cfreq</span><span class="p">;</span>
		      <span class="n">cfg</span><span class="p">.</span><span class="n">output_rate</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">p_div</span><span class="o">++</span><span class="p">;</span>

		<span class="n">cfg</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">p_div</span><span class="p">;</span>
		<span class="n">cfg</span><span class="p">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">input_rate</span> <span class="o">/</span> <span class="n">cfreq</span><span class="p">;</span>
		<span class="n">cfg</span><span class="p">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">output_rate</span> <span class="o">/</span> <span class="n">cfreq</span><span class="p">;</span>
		<span class="n">cfg</span><span class="p">.</span><span class="n">cpcon</span> <span class="o">=</span> <span class="n">OUT_OF_TABLE_CPCON</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">cfg</span><span class="p">.</span><span class="n">m</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">PLL_BASE_DIVM_MASK</span> <span class="o">&gt;&gt;</span> <span class="n">PLL_BASE_DIVM_SHIFT</span><span class="p">))</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">n</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">PLL_BASE_DIVN_MASK</span> <span class="o">&gt;&gt;</span> <span class="n">PLL_BASE_DIVN_SHIFT</span><span class="p">))</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">p_div</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">PLL_BASE_DIVP_MASK</span> <span class="o">&gt;&gt;</span> <span class="n">PLL_BASE_DIVP_SHIFT</span><span class="p">))</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">output_rate</span> <span class="o">&gt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">vco_max</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Failed to set %s out-of-table rate %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">p_div</span> <span class="o">&lt;&lt;=</span> <span class="n">PLL_BASE_DIVP_SHIFT</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">m</span> <span class="o">*</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">;</span>

	<span class="n">old_base</span> <span class="o">=</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">PLL_BASE_DIVM_MASK</span> <span class="o">|</span> <span class="n">PLL_BASE_DIVN_MASK</span> <span class="o">|</span>
		 <span class="p">((</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLU</span><span class="p">)</span> <span class="o">?</span> <span class="n">PLLU_BASE_POST_DIV</span> <span class="o">:</span> <span class="n">PLL_BASE_DIVP_MASK</span><span class="p">));</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">m</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_BASE_DIVM_SHIFT</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_BASE_DIVN_SHIFT</span><span class="p">)</span> <span class="o">|</span> <span class="n">p_div</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">old_base</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">ON</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tegra30_pll_clk_disable</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">PLL_BASE_BYPASS</span> <span class="o">|</span> <span class="n">PLL_BASE_ENABLE</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLL_HAS_CPCON</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PLL_MISC_CPCON_MASK</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">cpcon</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_MISC_CPCON_SHIFT</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PLLU</span> <span class="o">|</span> <span class="n">PLLD</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PLL_MISC_LFCON_MASK</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="n">PLLDU_LFCON_SET_DIVN</span><span class="p">)</span>
				<span class="n">val</span> <span class="o">|=</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_MISC_LFCON_SHIFT</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PLLX</span> <span class="o">|</span> <span class="n">PLLM</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_MISC_DCCON_SHIFT</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">vco_max</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">))</span>
				<span class="n">val</span> <span class="o">|=</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_MISC_DCCON_SHIFT</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">ON</span><span class="p">)</span>
		<span class="n">tegra30_pll_clk_enable</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_pll_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="n">tegra30_pll_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="n">tegra30_pll_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="n">tegra30_pll_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="n">tegra30_pll_clk_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">tegra30_plld_clk_cfg_ex</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">enum</span> <span class="n">tegra_clk_ex_param</span> <span class="n">p</span><span class="p">,</span> <span class="n">u32</span> <span class="n">setting</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">reg</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">TEGRA_CLK_PLLD_CSI_OUT_ENB</span>:
		<span class="n">mask</span> <span class="o">=</span> <span class="n">PLLD_BASE_CSI_CLKENABLE</span><span class="p">;</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">TEGRA_CLK_PLLD_DSI_OUT_ENB</span>:
		<span class="n">mask</span> <span class="o">=</span> <span class="n">PLLD_MISC_DSI_CLKENABLE</span><span class="p">;</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">TEGRA_CLK_PLLD_MIPI_MUX_SEL</span>:
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLL_ALT_MISC_REG</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">mask</span> <span class="o">=</span> <span class="n">PLLD_BASE_DSIB_MUX_MASK</span><span class="p">;</span>
			<span class="n">reg</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="cm">/* fall through - error since PLLD2 does not have MUX_SEL control */</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">)</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">mask</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_plld_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="n">tegra30_pll_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="n">tegra30_pll_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="n">tegra30_pll_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="n">tegra30_pll_clk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_cfg_ex</span>		<span class="o">=</span> <span class="n">tegra30_plld_clk_cfg_ex</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_plle_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">PLLE_AUX</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLLE_AUX_PLLP_SEL</span><span class="p">)</span> <span class="o">?</span>
		<span class="n">tegra_get_clock_by_name</span><span class="p">(</span><span class="s">&quot;pll_p&quot;</span><span class="p">)</span> <span class="o">:</span>
		<span class="n">tegra_get_clock_by_name</span><span class="p">(</span><span class="s">&quot;pll_ref&quot;</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLLE_BASE_ENABLE</span><span class="p">)</span> <span class="o">?</span> <span class="n">ON</span> <span class="o">:</span> <span class="n">OFF</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLLE_BASE_DIVN_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">PLLE_BASE_DIVN_SHIFT</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLLE_BASE_DIVM_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">PLLE_BASE_DIVM_SHIFT</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">*=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLLE_BASE_DIVP_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">PLLE_BASE_DIVP_SHIFT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_plle_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">PLLE_BASE_CML_ENABLE</span> <span class="o">|</span> <span class="n">PLLE_BASE_ENABLE</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_plle_training</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="cm">/* PLLE is already disabled, and setup cleared;</span>
<span class="cm">	 * create falling edge on PLLE IDDQ input */</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_SATA_PWRGT</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">PMC_SATA_PWRGT_PLLE_IDDQ_VALUE</span><span class="p">;</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">PMC_SATA_PWRGT</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_SATA_PWRGT</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">PMC_SATA_PWRGT_PLLE_IDDQ_SWCTL</span><span class="p">;</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">PMC_SATA_PWRGT</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">PMC_SATA_PWRGT</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PMC_SATA_PWRGT_PLLE_IDDQ_VALUE</span><span class="p">;</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">PMC_SATA_PWRGT</span><span class="p">);</span>

	<span class="k">do</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLLE_MISC_READY</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_plle_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">bool</span> <span class="n">force_training</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">fixed_rate</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">input_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span><span class="p">.</span><span class="n">freq_table</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input_rate</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input_rate</span> <span class="o">==</span> <span class="n">input_rate</span> <span class="o">&amp;&amp;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">output_rate</span> <span class="o">==</span> <span class="n">rate</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input_rate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOSYS</span><span class="p">;</span>

	<span class="cm">/* disable PLLE, clear setup fiels */</span>
	<span class="n">tegra30_plle_clk_disable</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">PLLE_MISC_LOCK_ENABLE</span> <span class="o">|</span> <span class="n">PLLE_MISC_SETUP_MASK</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>

	<span class="cm">/* training */</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force_training</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLLE_MISC_READY</span><span class="p">)))</span>
		<span class="n">tegra30_plle_training</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>

	<span class="cm">/* configure dividers, setup, disable SS */</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PLLE_BASE_DIV_MASK</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">PLLE_BASE_DIV</span><span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">m</span><span class="p">,</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">,</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">,</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">cpcon</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">m</span> <span class="o">*</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">PLLE_MISC_SETUP_VALUE</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">PLLE_MISC_LOCK_ENABLE</span><span class="p">;</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">PLLE_SS_CTRL</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">PLLE_SS_DISABLE</span><span class="p">;</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">PLLE_SS_CTRL</span><span class="p">);</span>

	<span class="cm">/* enable and lock PLLE*/</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="n">PLLE_BASE_CML_ENABLE</span> <span class="o">|</span> <span class="n">PLLE_BASE_ENABLE</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_BASE</span><span class="p">);</span>

	<span class="n">tegra30_pll_clk_wait_for_lock</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">PLL_MISC</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">PLLE_MISC_LOCK</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_plle_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">tegra30_plle_configure</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_plle_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="n">tegra30_plle_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="n">tegra30_plle_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="n">tegra30_plle_clk_disable</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Clock divider ops */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_pll_div_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">divu71</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">&gt;&gt;=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_OUT_CLKEN</span><span class="p">)</span> <span class="o">?</span> <span class="n">ON</span> <span class="o">:</span> <span class="n">OFF</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_OUT_RESET_DISABLE</span><span class="p">))</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">;</span>

		<span class="n">divu71</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PLL_OUT_RATIO_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">PLL_OUT_RATIO_SHIFT</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="p">(</span><span class="n">divu71</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">ON</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PLLD</span> <span class="o">|</span> <span class="n">PLLX</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">ON</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_pll_div_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">new_val</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">new_val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
		<span class="n">new_val</span> <span class="o">&amp;=</span> <span class="mh">0xFFFF</span><span class="p">;</span>

		<span class="n">new_val</span> <span class="o">|=</span> <span class="n">PLL_OUT_CLKEN</span> <span class="o">|</span> <span class="n">PLL_OUT_RESET_DISABLE</span><span class="p">;</span>

		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0xFFFF</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">new_val</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
		<span class="n">clk_writel_delay</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_2</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_pll_div_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">new_val</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">new_val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
		<span class="n">new_val</span> <span class="o">&amp;=</span> <span class="mh">0xFFFF</span><span class="p">;</span>

		<span class="n">new_val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">PLL_OUT_CLKEN</span> <span class="o">|</span> <span class="n">PLL_OUT_RESET_DISABLE</span><span class="p">);</span>

		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0xFFFF</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">new_val</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
		<span class="n">clk_writel_delay</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_pll_div_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">new_val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">divider_u71</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider_u71</span> <span class="o">=</span> <span class="n">clk_div71_get_divider</span><span class="p">(</span>
			<span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">,</span> <span class="n">ROUND_DIVIDER_UP</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider_u71</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">new_val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
			<span class="n">new_val</span> <span class="o">&amp;=</span> <span class="mh">0xFFFF</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71_FIXED</span><span class="p">)</span>
				<span class="n">new_val</span> <span class="o">|=</span> <span class="n">PLL_OUT_OVERRIDE</span><span class="p">;</span>
			<span class="n">new_val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PLL_OUT_RATIO_MASK</span><span class="p">;</span>
			<span class="n">new_val</span> <span class="o">|=</span> <span class="n">divider_u71</span> <span class="o">&lt;&lt;</span> <span class="n">PLL_OUT_RATIO_SHIFT</span><span class="p">;</span>

			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0xFFFF</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">new_val</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">;</span>
			<span class="n">clk_writel_delay</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">divider_u71</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_2</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">clk_set_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">,</span> <span class="n">rate</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">long</span> <span class="nf">tegra30_pll_div_clk_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">divider</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider</span> <span class="o">=</span> <span class="n">clk_div71_get_divider</span><span class="p">(</span>
			<span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">,</span> <span class="n">ROUND_DIVIDER_UP</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">divider</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">DIV_ROUND_UP</span><span class="p">(</span><span class="n">parent_rate</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">divider</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_2</span><span class="p">)</span>
		<span class="cm">/* no rounding - fixed DIV_2 dividers pass rate to parent PLL */</span>
		<span class="k">return</span> <span class="n">rate</span><span class="p">;</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_pll_div_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="n">tegra30_pll_div_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="n">tegra30_pll_div_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="n">tegra30_pll_div_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="n">tegra30_pll_div_clk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span>		<span class="o">=</span> <span class="n">tegra30_pll_div_clk_round_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Periph clk ops */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">periph_clk_source_mask</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MUX8</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">7</span> <span class="o">&lt;&lt;</span> <span class="mi">29</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MUX_PWM</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">28</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MUX_CLK_OUT</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLD</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">PLLD_BASE_DSIB_MUX_MASK</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">30</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">periph_clk_source_shift</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MUX8</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">29</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MUX_PWM</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">28</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MUX_CLK_OUT</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PLLD</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">PLLD_BASE_DSIB_MUX_SHIFT</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="mi">30</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_periph_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">mux</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MUX</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">periph_clk_source_mask</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&gt;&gt;</span>
			    <span class="n">periph_clk_source_shift</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">==</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">)</span>
				<span class="n">mux</span> <span class="o">=</span> <span class="n">sel</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">mux</span><span class="p">);</span>

		<span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">mux</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">input</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">divu71</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">PERIPH_CLK_SOURCE_DIVU71_MASK</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71_UART</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">PERIPH_CLK_UART_DIV_ENB</span><span class="p">)))</span> <span class="p">{</span>
			<span class="n">divu71</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71_IDLE</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">PERIPH_CLK_SOURCE_DIVU71_MASK</span> <span class="o">&lt;&lt;</span>
				<span class="n">PERIPH_CLK_SOURCE_DIVIDLE_SHIFT</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="n">PERIPH_CLK_SOURCE_DIVIDLE_VAL</span> <span class="o">&lt;&lt;</span>
				<span class="n">PERIPH_CLK_SOURCE_DIVIDLE_SHIFT</span><span class="p">);</span>
			<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">divu71</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U16</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">divu16</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">PERIPH_CLK_SOURCE_DIVU16_MASK</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">divu16</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">ON</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">clk_readl</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_ENB_REG</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">PERIPH_CLK_TO_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PERIPH_NO_RESET</span><span class="p">))</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clk_readl</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_RST_REG</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">PERIPH_CLK_TO_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_periph_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">tegra_periph_clk_enable_refcount</span><span class="p">[</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tegra_periph_clk_enable_refcount</span><span class="p">[</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">clk_writel_delay</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">PERIPH_CLK_TO_ENB_SET_REG</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PERIPH_NO_RESET</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		 <span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PERIPH_MANUAL_RESET</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clk_readl</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_RST_REG</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&amp;</span>
			 <span class="n">PERIPH_CLK_TO_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>	<span class="cm">/* reset propagation delay */</span>
			<span class="n">clk_writel</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
				 <span class="n">PERIPH_CLK_TO_RST_CLR_REG</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_periph_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">)</span>
		<span class="n">tegra_periph_clk_enable_refcount</span><span class="p">[</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tegra_periph_clk_enable_refcount</span><span class="p">[</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* If peripheral is in the APB bus then read the APB bus to</span>
<span class="cm">		 * flush the write operation in apb bus. This will avoid the</span>
<span class="cm">		 * peripheral access after disabling clock*/</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PERIPH_ON_APB</span><span class="p">)</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">chipid_readl</span><span class="p">();</span>

		<span class="n">clk_writel_delay</span><span class="p">(</span>
			<span class="n">PERIPH_CLK_TO_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">PERIPH_CLK_TO_ENB_CLR_REG</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_periph_clk_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">bool</span> <span class="n">assert</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s %s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
		 <span class="n">assert</span> <span class="o">?</span> <span class="s">&quot;assert&quot;</span> <span class="o">:</span> <span class="s">&quot;deassert&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PERIPH_NO_RESET</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">assert</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* If peripheral is in the APB bus then read the APB</span>
<span class="cm">			 * bus to flush the write operation in apb bus. This</span>
<span class="cm">			 * will avoid the peripheral access after disabling</span>
<span class="cm">			 * clock */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PERIPH_ON_APB</span><span class="p">)</span>
				<span class="n">val</span> <span class="o">=</span> <span class="n">chipid_readl</span><span class="p">();</span>

			<span class="n">clk_writel</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
				   <span class="n">PERIPH_CLK_TO_RST_SET_REG</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">clk_writel</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
				   <span class="n">PERIPH_CLK_TO_RST_CLR_REG</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_periph_clk_set_parent</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MUX</span><span class="p">))</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="p">(</span><span class="o">-</span><span class="n">EINVAL</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">periph_clk_source_mask</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">periph_clk_source_shift</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">)</span>
				<span class="n">clk_enable</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

			<span class="n">clk_writel_delay</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span> <span class="o">&amp;&amp;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span>
				<span class="n">clk_disable</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

			<span class="n">clk_reparent</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_periph_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">divider</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider</span> <span class="o">=</span> <span class="n">clk_div71_get_divider</span><span class="p">(</span>
			<span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">,</span> <span class="n">ROUND_DIVIDER_UP</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PERIPH_CLK_SOURCE_DIVU71_MASK</span><span class="p">;</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">divider</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71_UART</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">divider</span><span class="p">)</span>
					<span class="n">val</span> <span class="o">|=</span> <span class="n">PERIPH_CLK_UART_DIV_ENB</span><span class="p">;</span>
				<span class="k">else</span>
					<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PERIPH_CLK_UART_DIV_ENB</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">clk_writel_delay</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">divider</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U16</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider</span> <span class="o">=</span> <span class="n">clk_div16_get_divider</span><span class="p">(</span><span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PERIPH_CLK_SOURCE_DIVU16_MASK</span><span class="p">;</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">divider</span><span class="p">;</span>
			<span class="n">clk_writel_delay</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="n">divider</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">parent_rate</span> <span class="o">&lt;=</span> <span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">long</span> <span class="nf">tegra30_periph_clk_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">divider</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U71</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider</span> <span class="o">=</span> <span class="n">clk_div71_get_divider</span><span class="p">(</span>
			<span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">,</span> <span class="n">ROUND_DIVIDER_UP</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">divider</span><span class="p">;</span>

		<span class="k">return</span> <span class="n">DIV_ROUND_UP</span><span class="p">(</span><span class="n">parent_rate</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">divider</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DIV_U16</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">divider</span> <span class="o">=</span> <span class="n">clk_div16_get_divider</span><span class="p">(</span><span class="n">parent_rate</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">divider</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">divider</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">DIV_ROUND_UP</span><span class="p">(</span><span class="n">parent_rate</span><span class="p">,</span> <span class="n">divider</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_periph_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_set_parent</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_reset</span><span class="p">,</span>
<span class="p">};</span>


<span class="cm">/* Periph extended clock configuration ops */</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">tegra30_vi_clk_cfg_ex</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">enum</span> <span class="n">tegra_clk_ex_param</span> <span class="n">p</span><span class="p">,</span> <span class="n">u32</span> <span class="n">setting</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="n">TEGRA_CLK_VI_INP_SEL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PERIPH_CLK_VI_SEL_EX_MASK</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="n">setting</span> <span class="o">&lt;&lt;</span> <span class="n">PERIPH_CLK_VI_SEL_EX_SHIFT</span><span class="p">)</span> <span class="o">&amp;</span>
			<span class="n">PERIPH_CLK_VI_SEL_EX_MASK</span><span class="p">;</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_vi_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_set_parent</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_cfg_ex</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_vi_clk_cfg_ex</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_reset</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">tegra30_nand_clk_cfg_ex</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">enum</span> <span class="n">tegra_clk_ex_param</span> <span class="n">p</span><span class="p">,</span> <span class="n">u32</span> <span class="n">setting</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="n">TEGRA_CLK_NAND_PAD_DIV2_ENB</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">)</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">PERIPH_CLK_NAND_DIV_EX_ENB</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PERIPH_CLK_NAND_DIV_EX_ENB</span><span class="p">;</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_nand_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_set_parent</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_cfg_ex</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_nand_clk_cfg_ex</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_reset</span><span class="p">,</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kt">int</span>
<span class="nf">tegra30_dtv_clk_cfg_ex</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">enum</span> <span class="n">tegra_clk_ex_param</span> <span class="n">p</span><span class="p">,</span> <span class="n">u32</span> <span class="n">setting</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="n">TEGRA_CLK_DTV_INVERT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">setting</span><span class="p">)</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">PERIPH_CLK_DTV_POLARITY_INV</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PERIPH_CLK_DTV_POLARITY_INV</span><span class="p">;</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_dtv_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_set_parent</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_cfg_ex</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_dtv_clk_cfg_ex</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_reset</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_dsib_clk_set_parent</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">tegra_get_clock_by_name</span><span class="p">(</span><span class="s">&quot;pll_d&quot;</span><span class="p">);</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">)</span>
				<span class="n">clk_enable</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

			<span class="cm">/* The DSIB parent selection bit is in PLLD base</span>
<span class="cm">			   register - can not do direct r-m-w, must be</span>
<span class="cm">			   protected by PLLD lock */</span>
			<span class="n">tegra_clk_cfg_ex</span><span class="p">(</span>
				<span class="n">d</span><span class="p">,</span> <span class="n">TEGRA_CLK_PLLD_MIPI_MUX_SEL</span><span class="p">,</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span> <span class="o">&amp;&amp;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span>
				<span class="n">clk_disable</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

			<span class="n">clk_reparent</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_dsib_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_dsib_clk_set_parent</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_reset</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* pciex clock support only reset function */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_pciex_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">reset</span>    <span class="o">=</span> <span class="n">tegra30_periph_clk_reset</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Output clock ops */</span>

<span class="k">static</span> <span class="n">DEFINE_SPINLOCK</span><span class="p">(</span><span class="n">clk_out_lock</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_clk_out_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">mux</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">))</span> <span class="o">?</span> <span class="n">ON</span> <span class="o">:</span> <span class="n">OFF</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">periph_clk_source_mask</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&gt;&gt;</span>
		     <span class="n">periph_clk_source_shift</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">==</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">)</span>
			<span class="n">mux</span> <span class="o">=</span> <span class="n">sel</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">mux</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">mux</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_clk_out_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clk_out_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">);</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clk_out_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_clk_out_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s on clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clk_out_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">);</span>
	<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clk_out_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_clk_out_set_parent</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">)</span>
				<span class="n">clk_enable</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

			<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clk_out_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">pmc_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">periph_clk_source_mask</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">periph_clk_source_shift</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
			<span class="n">pmc_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clk_out_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span> <span class="o">&amp;&amp;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span>
				<span class="n">clk_disable</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

			<span class="n">clk_reparent</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_clk_out_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_clk_out_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_clk_out_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_clk_out_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_clk_out_set_parent</span><span class="p">,</span>
<span class="p">};</span>


<span class="cm">/* Clock doubler ops */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_clk_double_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">ON</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">clk_readl</span><span class="p">(</span><span class="n">PERIPH_CLK_TO_ENB_REG</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">PERIPH_CLK_TO_BIT</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_clk_double_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">==</span> <span class="n">parent_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">);</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">parent_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg_shift</span><span class="p">));</span>
		<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">mul</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_clk_double_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_clk_double_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_periph_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_clk_double_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Audio sync clock ops */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_sync_source_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_sync_source_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">set_rate</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_sync_source_set_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_audio_sync_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">source</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">AUDIO_SYNC_DISABLE_BIT</span><span class="p">)</span> <span class="o">?</span> <span class="n">OFF</span> <span class="o">:</span> <span class="n">ON</span><span class="p">;</span>
	<span class="n">source</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="n">AUDIO_SYNC_SOURCE_MASK</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">==</span> <span class="n">source</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_audio_sync_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">AUDIO_SYNC_DISABLE_BIT</span><span class="p">)),</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_audio_sync_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">((</span><span class="n">val</span> <span class="o">|</span> <span class="n">AUDIO_SYNC_DISABLE_BIT</span><span class="p">),</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_audio_sync_clk_set_parent</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">;</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">sel</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span><span class="o">-&gt;</span><span class="n">input</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">AUDIO_SYNC_SOURCE_MASK</span><span class="p">;</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">sel</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">)</span>
				<span class="n">clk_enable</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

			<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">refcnt</span> <span class="o">&amp;&amp;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span>
				<span class="n">clk_disable</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>

			<span class="n">clk_reparent</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_audio_sync_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>       <span class="o">=</span> <span class="n">tegra30_audio_sync_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>     <span class="o">=</span> <span class="n">tegra30_audio_sync_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>    <span class="o">=</span> <span class="n">tegra30_audio_sync_clk_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span> <span class="o">=</span> <span class="n">tegra30_audio_sync_clk_set_parent</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* cml0 (pcie), and cml1 (sata) clock ops */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_cml_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">)</span> <span class="o">?</span> <span class="n">ON</span> <span class="o">:</span> <span class="n">OFF</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tegra30_cml_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_cml_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">clk_readl</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span><span class="p">.</span><span class="n">clk_num</span><span class="p">);</span>
	<span class="n">clk_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_ops</span> <span class="n">tegra_cml_clk_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_cml_clk_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_cml_clk_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_cml_clk_disable</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Clock definitions */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_32k</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;clk_32k&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">32768</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>  <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span> <span class="o">=</span> <span class="mi">32768</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_m</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;clk_m&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x1fc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">28</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">48000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_m_div2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;clk_m_div2&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mul</span>       <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">div</span>       <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">state</span>     <span class="o">=</span> <span class="n">ON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">24000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_m_div4</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;clk_m_div4&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mul</span>       <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">div</span>       <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">state</span>     <span class="o">=</span> <span class="n">ON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">12000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_ref</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_ref&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ref_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">26000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_c_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1040000000</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1040000000</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">1040000000</span><span class="p">,</span> <span class="mi">495</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>		<span class="cm">/* actual: 1039.5 MHz */</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1040000000</span><span class="p">,</span> <span class="mi">325</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1040000000</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">832000000</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">832000000</span><span class="p">,</span> <span class="mi">832</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">832000000</span><span class="p">,</span> <span class="mi">396</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>		<span class="cm">/* actual: 831.6 MHz */</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">832000000</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">832000000</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">624000000</span><span class="p">,</span> <span class="mi">624</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">624000000</span><span class="p">,</span> <span class="mi">624</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">624000000</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">624000000</span><span class="p">,</span> <span class="mi">624</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">520000000</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">520000000</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">520000000</span><span class="p">,</span> <span class="mi">495</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>		<span class="cm">/* actual: 519.75 MHz */</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">520000000</span><span class="p">,</span> <span class="mi">325</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">520000000</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">416000000</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">416000000</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">416000000</span><span class="p">,</span> <span class="mi">396</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>		<span class="cm">/* actual: 415.8 MHz */</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">416000000</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">416000000</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_c</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_c&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>	   <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ref</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">1400000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">31000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1400000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_c_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_c_out1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_c_out1&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">DIV_U71</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x84</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">700000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_m_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">666000000</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">666000000</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">666000000</span><span class="p">,</span> <span class="mi">555</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">666000000</span><span class="p">,</span> <span class="mi">555</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">666000000</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_m</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_m&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span> <span class="o">|</span> <span class="n">PLLM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x90</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ref</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">800000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">31000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1200000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_m_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_m_out1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_m_out1&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">DIV_U71</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x94</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">600000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_p_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_p</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_p&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span> <span class="o">|</span> <span class="n">PLL_FIXED</span> <span class="o">|</span> <span class="n">PLL_HAS_CPCON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xa0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ref</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">432000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">31000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1400000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_p_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fixed_rate</span> <span class="o">=</span> <span class="mi">408000000</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_p_out1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_p_out1&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_FIXED</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xa4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">432000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_p_out2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_p_out2&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_FIXED</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xa4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">432000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_p_out3</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_p_out3&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_FIXED</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xa8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">432000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_p_out4</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_p_out4&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">ENABLE_ON_INIT</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_FIXED</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xa8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">432000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_a_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">9600000</span><span class="p">,</span> <span class="mi">564480000</span><span class="p">,</span> <span class="mi">294</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">9600000</span><span class="p">,</span> <span class="mi">552960000</span><span class="p">,</span> <span class="mi">288</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">9600000</span><span class="p">,</span> <span class="mi">24000000</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">28800000</span><span class="p">,</span> <span class="mi">56448000</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">28800000</span><span class="p">,</span> <span class="mi">73728000</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">28800000</span><span class="p">,</span> <span class="mi">24000000</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_a</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_a&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xb0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">700000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">31000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1400000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_a_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_a_out0</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_a_out0&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">DIV_U71</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_a</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xb4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">100000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_d_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">594000000</span><span class="p">,</span> <span class="mi">594</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">594000000</span><span class="p">,</span> <span class="mi">594</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">594000000</span><span class="p">,</span> <span class="mi">495</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">594000000</span><span class="p">,</span> <span class="mi">495</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">594000000</span><span class="p">,</span> <span class="mi">594</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">625</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_d</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_d&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span> <span class="o">|</span> <span class="n">PLLD</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_plld_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xd0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ref</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">1000000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">40000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">40000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1000000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_d_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_d_out0</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_d_out0&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">DIV_2</span> <span class="o">|</span> <span class="n">PLLD</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_d</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">500000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_d2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_d2&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span> <span class="o">|</span> <span class="n">PLL_ALT_MISC_REG</span> <span class="o">|</span> <span class="n">PLLD</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_plld_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0x4b8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ref</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">1000000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">40000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">40000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1000000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_d_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_d2_out0</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_d2_out0&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">DIV_2</span> <span class="o">|</span> <span class="n">PLLD</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_d2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">500000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_u_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">480000000</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">480000000</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">480000000</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">480000000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">480000000</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_u</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_u&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span> <span class="o">|</span> <span class="n">PLLU</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xc0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ref</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">480000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">40000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">480000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">960000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_u_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_x_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* 1.7 GHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1700000000</span><span class="p">,</span> <span class="mi">850</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1700000000</span><span class="p">,</span> <span class="mi">915</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1699.2 MHz */</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">1700000000</span><span class="p">,</span> <span class="mi">708</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1699.2 MHz */</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1700000000</span><span class="p">,</span> <span class="mi">885</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1699.2 MHz */</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1700000000</span><span class="p">,</span> <span class="mi">850</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="cm">/* 1.6 GHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1600000000</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1600000000</span><span class="p">,</span> <span class="mi">738</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1599.0 MHz */</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">1600000000</span><span class="p">,</span> <span class="mi">857</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1599.7 MHz */</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1600000000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1600000000</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="cm">/* 1.5 GHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1500000000</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1500000000</span><span class="p">,</span> <span class="mi">923</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1499.8 MHz */</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">1500000000</span><span class="p">,</span> <span class="mi">625</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1500000000</span><span class="p">,</span> <span class="mi">625</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1500000000</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="cm">/* 1.4 GHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1400000000</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1400000000</span><span class="p">,</span> <span class="mi">969</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1399.7 MHz */</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">1400000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1400000000</span><span class="p">,</span> <span class="mi">875</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1400000000</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="cm">/* 1.3 GHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1300000000</span><span class="p">,</span> <span class="mi">975</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1300000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">1300000000</span><span class="p">,</span> <span class="mi">928</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1299.2 MHz */</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1300000000</span><span class="p">,</span> <span class="mi">812</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1299.2 MHz */</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1300000000</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="cm">/* 1.2 GHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1200000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1200000000</span><span class="p">,</span> <span class="mi">923</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1199.9 MHz */</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">1200000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1200000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1200000000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="cm">/* 1.1 GHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1100000000</span><span class="p">,</span> <span class="mi">825</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1100000000</span><span class="p">,</span> <span class="mi">846</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1099.8 MHz */</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">1100000000</span><span class="p">,</span> <span class="mi">982</span><span class="p">,</span>  <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1099.8 MHz */</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1100000000</span><span class="p">,</span> <span class="mi">859</span><span class="p">,</span>  <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 1099.5 MHz */</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1100000000</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="cm">/* 1 GHz */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">13000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">16800000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">833</span><span class="p">,</span>  <span class="mi">14</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>	<span class="cm">/* actual: 999.6 MHz */</span>
	<span class="p">{</span> <span class="mi">19200000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">625</span><span class="p">,</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">26000000</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">},</span>

	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_x</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_x&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_HAS_CPCON</span> <span class="o">|</span> <span class="n">PLL_ALT_MISC_REG</span> <span class="o">|</span> <span class="n">PLLX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xe0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_ref</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">1700000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">31000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">1700000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_x_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_x_out0</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_x_out0&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_div_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">DIV_2</span> <span class="o">|</span> <span class="n">PLLX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_x</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">850000000</span><span class="p">,</span>
<span class="p">};</span>


<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_pll_freq_table</span> <span class="n">tegra_pll_e_freq_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* PLLE special case: use cpcon field to store cml divider value */</span>
	<span class="p">{</span> <span class="mi">12000000</span><span class="p">,</span>  <span class="mi">100000000</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">18</span><span class="p">,</span> <span class="mi">11</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">216000000</span><span class="p">,</span> <span class="mi">100000000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">13</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pll_e</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pll_e&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>     <span class="o">=</span> <span class="n">PLL_ALT_MISC_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_plle_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="mh">0xe8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">100000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">input_min</span> <span class="o">=</span> <span class="mi">12000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_max</span> <span class="o">=</span> <span class="mi">216000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_min</span>    <span class="o">=</span> <span class="mi">12000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cf_max</span>    <span class="o">=</span> <span class="mi">12000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_min</span>   <span class="o">=</span> <span class="mi">1200000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vco_max</span>   <span class="o">=</span> <span class="mi">2400000000U</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_table</span> <span class="o">=</span> <span class="n">tegra_pll_e_freq_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lock_delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fixed_rate</span> <span class="o">=</span> <span class="mi">100000000</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_cml0_clk</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;cml0&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_e</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_cml_clk_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="n">PLLE_AUX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">100000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span>  <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">clk_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_cml1_clk</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;cml1&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_e</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_cml_clk_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>       <span class="o">=</span> <span class="n">PLLE_AUX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">100000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span>  <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">clk_num</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_pciex_clk</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>      <span class="o">=</span> <span class="s">&quot;pciex&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_e</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pciex_clk_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>  <span class="o">=</span> <span class="mi">100000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">u</span><span class="p">.</span><span class="n">periph</span>  <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">clk_num</span>   <span class="o">=</span> <span class="mi">74</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Audio sync clocks */</span>
<span class="cp">#define SYNC_SOURCE(_id)				\</span>
<span class="cp">	{						\</span>
<span class="cp">		.name      = #_id &quot;_sync&quot;,		\</span>
<span class="cp">		.rate      = 24000000,			\</span>
<span class="cp">		.max_rate  = 24000000,			\</span>
<span class="cp">		.ops       = &amp;tegra_sync_source_ops	\</span>
<span class="cp">	}</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_sync_source_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SYNC_SOURCE</span><span class="p">(</span><span class="n">spdif_in</span><span class="p">),</span>
	<span class="n">SYNC_SOURCE</span><span class="p">(</span><span class="n">i2s0</span><span class="p">),</span>
	<span class="n">SYNC_SOURCE</span><span class="p">(</span><span class="n">i2s1</span><span class="p">),</span>
	<span class="n">SYNC_SOURCE</span><span class="p">(</span><span class="n">i2s2</span><span class="p">),</span>
	<span class="n">SYNC_SOURCE</span><span class="p">(</span><span class="n">i2s3</span><span class="p">),</span>
	<span class="n">SYNC_SOURCE</span><span class="p">(</span><span class="n">i2s4</span><span class="p">),</span>
	<span class="n">SYNC_SOURCE</span><span class="p">(</span><span class="n">vimclk</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_audio_sync_clk</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_sync_source_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_sync_source_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_sync_source_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_sync_source_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_sync_source_list</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_sync_source_list</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">5</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_a_out0</span><span class="p">,</span>		<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_sync_source_list</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">7</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cp">#define AUDIO_SYNC_CLK(_id, _index)			\</span>
<span class="cp">	{						\</span>
<span class="cp">		.name      = #_id,			\</span>
<span class="cp">		.inputs    = mux_audio_sync_clk,	\</span>
<span class="cp">		.reg       = 0x4A0 + (_index) * 4,	\</span>
<span class="cp">		.max_rate  = 24000000,			\</span>
<span class="cp">		.ops       = &amp;tegra_audio_sync_clk_ops	\</span>
<span class="cp">	}</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_audio_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">AUDIO_SYNC_CLK</span><span class="p">(</span><span class="n">audio0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">AUDIO_SYNC_CLK</span><span class="p">(</span><span class="n">audio1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">AUDIO_SYNC_CLK</span><span class="p">(</span><span class="n">audio2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">AUDIO_SYNC_CLK</span><span class="p">(</span><span class="n">audio3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">AUDIO_SYNC_CLK</span><span class="p">(</span><span class="n">audio4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
	<span class="n">AUDIO_SYNC_CLK</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>	<span class="cm">/* SPDIF */</span>
<span class="p">};</span>

<span class="cp">#define AUDIO_SYNC_2X_CLK(_id, _index)				\</span>
<span class="cp">	{							\</span>
<span class="cp">		.name      = #_id &quot;_2x&quot;,			\</span>
<span class="cp">		.flags     = PERIPH_NO_RESET,			\</span>
<span class="cp">		.max_rate  = 48000000,				\</span>
<span class="cp">		.ops       = &amp;tegra_clk_double_ops,		\</span>
<span class="cp">		.reg       = 0x49C,				\</span>
<span class="cp">		.reg_shift = 24 + (_index),			\</span>
<span class="cp">		.parent    = &amp;tegra_clk_audio_list[(_index)],	\</span>
<span class="cp">		.u.periph = {					\</span>
<span class="cp">			.clk_num = 113 + (_index),		\</span>
<span class="cp">		},						\</span>
<span class="cp">	}</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_audio_2x_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">AUDIO_SYNC_2X_CLK</span><span class="p">(</span><span class="n">audio0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">AUDIO_SYNC_2X_CLK</span><span class="p">(</span><span class="n">audio1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">AUDIO_SYNC_2X_CLK</span><span class="p">(</span><span class="n">audio2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">AUDIO_SYNC_2X_CLK</span><span class="p">(</span><span class="n">audio3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">AUDIO_SYNC_2X_CLK</span><span class="p">(</span><span class="n">audio4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
	<span class="n">AUDIO_SYNC_2X_CLK</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>	<span class="cm">/* SPDIF */</span>
<span class="p">};</span>

<span class="cp">#define MUX_I2S_SPDIF(_id, _index)					\</span>
<span class="cp">static struct clk_mux_sel mux_pllaout0_##_id##_2x_pllp_clkm[] = {	\</span>
<span class="cp">	{.input = &amp;tegra_pll_a_out0, .value = 0},			\</span>
<span class="cp">	{.input = &amp;tegra_clk_audio_2x_list[(_index)], .value = 1},	\</span>
<span class="cp">	{.input = &amp;tegra_pll_p, .value = 2},				\</span>
<span class="cp">	{.input = &amp;tegra_clk_m, .value = 3},				\</span>
<span class="cp">	{ 0, 0},							\</span>
<span class="cp">}</span>
<span class="n">MUX_I2S_SPDIF</span><span class="p">(</span><span class="n">audio0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">MUX_I2S_SPDIF</span><span class="p">(</span><span class="n">audio1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">MUX_I2S_SPDIF</span><span class="p">(</span><span class="n">audio2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">MUX_I2S_SPDIF</span><span class="p">(</span><span class="n">audio3</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="n">MUX_I2S_SPDIF</span><span class="p">(</span><span class="n">audio4</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="n">MUX_I2S_SPDIF</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>		<span class="cm">/* SPDIF */</span>

<span class="cm">/* External clock outputs (through PMC) */</span>
<span class="cp">#define MUX_EXTERN_OUT(_id)						\</span>
<span class="cp">static struct clk_mux_sel mux_clkm_clkm2_clkm4_extern##_id[] = {	\</span>
<span class="cp">	{.input = &amp;tegra_clk_m,		.value = 0},			\</span>
<span class="cp">	{.input = &amp;tegra_clk_m_div2,	.value = 1},			\</span>
<span class="cp">	{.input = &amp;tegra_clk_m_div4,	.value = 2},			\</span>
<span class="cp">	{.input = NULL,			.value = 3}, </span><span class="cm">/* placeholder */</span><span class="cp">	\</span>
<span class="cp">	{ 0, 0},							\</span>
<span class="cp">}</span>
<span class="n">MUX_EXTERN_OUT</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">MUX_EXTERN_OUT</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">MUX_EXTERN_OUT</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="o">*</span><span class="n">mux_extern_out_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">mux_clkm_clkm2_clkm4_extern1</span><span class="p">,</span>
	<span class="n">mux_clkm_clkm2_clkm4_extern2</span><span class="p">,</span>
	<span class="n">mux_clkm_clkm2_clkm4_extern3</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define CLK_OUT_CLK(_id)					\</span>
<span class="cp">	{							\</span>
<span class="cp">		.name      = &quot;clk_out_&quot; #_id,			\</span>
<span class="cp">		.lookup    = {					\</span>
<span class="cp">			.dev_id    = &quot;clk_out_&quot; #_id,		\</span>
<span class="cp">			.con_id	   = &quot;extern&quot; #_id,		\</span>
<span class="cp">		},						\</span>
<span class="cp">		.ops       = &amp;tegra_clk_out_ops,		\</span>
<span class="cp">		.reg       = 0x1a8,				\</span>
<span class="cp">		.inputs    = mux_clkm_clkm2_clkm4_extern##_id,	\</span>
<span class="cp">		.flags     = MUX_CLK_OUT,			\</span>
<span class="cp">		.max_rate  = 216000000,				\</span>
<span class="cp">		.u.periph = {					\</span>
<span class="cp">			.clk_num   = (_id - 1) * 8 + 2,		\</span>
<span class="cp">		},						\</span>
<span class="cp">	}</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_out_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">CLK_OUT_CLK</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
	<span class="n">CLK_OUT_CLK</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
	<span class="n">CLK_OUT_CLK</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* called after peripheral external clocks are initialized */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">init_clk_out_mux</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span>

	<span class="cm">/* output clock con_id is the name of peripheral</span>
<span class="cm">	   external clock connected to input 3 of the output mux */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_clk_out_list</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">tegra_get_clock_by_name</span><span class="p">(</span>
			<span class="n">tegra_clk_out_list</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lookup</span><span class="p">.</span><span class="n">con_id</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="p">)</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: could not find clk %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
			       <span class="n">tegra_clk_out_list</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lookup</span><span class="p">.</span><span class="n">con_id</span><span class="p">);</span>
		<span class="n">mux_extern_out_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">].</span><span class="n">input</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Peripheral muxes */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_sclk</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c_out1</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out4</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out3</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out2</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span><span class="p">},</span>
	<span class="cm">/* { .input = &amp;tegra_clk_d,	.value = 5}, - no use on tegra30 */</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m_out1</span><span class="p">,</span>	<span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">7</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_sclk</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;sclk&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inputs</span>	<span class="o">=</span> <span class="n">mux_sclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>	<span class="o">=</span> <span class="mh">0x28</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_super_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span> <span class="o">=</span> <span class="mi">334000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_rate</span> <span class="o">=</span> <span class="mi">40000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_blink</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;blink&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>		<span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_blink_clk_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span>	<span class="o">=</span> <span class="mi">32768</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_a_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_clkm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_plld_pllc_clkm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_d_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_pllm_plld_plla_pllc_plld2_clkm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_d_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_a_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_d2_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">5</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_plla_pllc_pllp_clkm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_a_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="cm">/* { .input = &amp;tegra_pll_c, .value = 1}, no use on tegra30 */</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_pllc_clk32_clkm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>   <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_pllc_clkm_clk32</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>   <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_pllc_pllm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span>     <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_clk_m</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_pllp_out3</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out3</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_plld_out0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_d_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_plld_out0_plld2_out0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_d_out0</span><span class="p">,</span>  <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_d2_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_clk_32k</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_plla_clk32_pllp_clkm_plle</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_a_out0</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>    <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>      <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>      <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_e</span><span class="p">,</span>      <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_mux_sel</span> <span class="n">mux_cclk_g</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>        <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span>        <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>      <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span>        <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>        <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out4</span><span class="p">,</span>   <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">5</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_p_out3</span><span class="p">,</span>   <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">input</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_pll_x</span><span class="p">,</span>        <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">8</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_clk_cclk_g</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;cclk_g&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_INT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">mux_cclk_g</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg</span>	<span class="o">=</span> <span class="mh">0x368</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_super_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span> <span class="o">=</span> <span class="mi">1700000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra30_clk_twd</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">parent</span>	  <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra_clk_cclk_g</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>     <span class="o">=</span> <span class="s">&quot;twd&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span>      <span class="o">=</span> <span class="o">&amp;</span><span class="n">tegra30_twd_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_rate</span> <span class="o">=</span> <span class="mi">1400000000</span><span class="p">,</span>	<span class="cm">/* Same as tegra_clk_cpu_cmplx.max_rate */</span>
	<span class="p">.</span><span class="n">mul</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">div</span>      <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define PERIPH_CLK(_name, _dev, _con, _clk_num, _reg, _max, _inputs, _flags) \</span>
<span class="cp">	{						\</span>
<span class="cp">		.name      = _name,			\</span>
<span class="cp">		.lookup    = {				\</span>
<span class="cp">			.dev_id    = _dev,		\</span>
<span class="cp">			.con_id	   = _con,		\</span>
<span class="cp">		},					\</span>
<span class="cp">		.ops       = &amp;tegra_periph_clk_ops,	\</span>
<span class="cp">		.reg       = _reg,			\</span>
<span class="cp">		.inputs    = _inputs,			\</span>
<span class="cp">		.flags     = _flags,			\</span>
<span class="cp">		.max_rate  = _max,			\</span>
<span class="cp">		.u.periph = {				\</span>
<span class="cp">			.clk_num   = _clk_num,		\</span>
<span class="cp">		},					\</span>
<span class="cp">	}</span>

<span class="cp">#define PERIPH_CLK_EX(_name, _dev, _con, _clk_num, _reg, _max, _inputs,	\</span>
<span class="cp">			_flags, _ops)					\</span>
<span class="cp">	{						\</span>
<span class="cp">		.name      = _name,			\</span>
<span class="cp">		.lookup    = {				\</span>
<span class="cp">			.dev_id    = _dev,		\</span>
<span class="cp">			.con_id	   = _con,		\</span>
<span class="cp">		},					\</span>
<span class="cp">		.ops       = _ops,			\</span>
<span class="cp">		.reg       = _reg,			\</span>
<span class="cp">		.inputs    = _inputs,			\</span>
<span class="cp">		.flags     = _flags,			\</span>
<span class="cp">		.max_rate  = _max,			\</span>
<span class="cp">		.u.periph = {				\</span>
<span class="cp">			.clk_num   = _clk_num,		\</span>
<span class="cp">		},					\</span>
<span class="cp">	}</span>

<span class="cp">#define SHARED_CLK(_name, _dev, _con, _parent, _id, _div, _mode)\</span>
<span class="cp">	{						\</span>
<span class="cp">		.name      = _name,			\</span>
<span class="cp">		.lookup    = {				\</span>
<span class="cp">			.dev_id    = _dev,		\</span>
<span class="cp">			.con_id    = _con,		\</span>
<span class="cp">		},					\</span>
<span class="cp">		.ops       = &amp;tegra_clk_shared_bus_ops,	\</span>
<span class="cp">		.parent = _parent,			\</span>
<span class="cp">		.u.shared_bus_user = {			\</span>
<span class="cp">			.client_id = _id,		\</span>
<span class="cp">			.client_div = _div,		\</span>
<span class="cp">			.mode = _mode,			\</span>
<span class="cp">		},					\</span>
<span class="cp">	}</span>
<span class="k">struct</span> <span class="n">clk</span> <span class="n">tegra_list_clks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;apbdma&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-dma&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">34</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;rtc&quot;</span><span class="p">,</span>	<span class="s">&quot;rtc-tegra&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">4</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">32768</span><span class="p">,</span>     <span class="n">mux_clk_32k</span><span class="p">,</span>			<span class="n">PERIPH_NO_RESET</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;kbc&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-kbc&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">36</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">32768</span><span class="p">,</span>     <span class="n">mux_clk_32k</span><span class="p">,</span>			<span class="n">PERIPH_NO_RESET</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;timer&quot;</span><span class="p">,</span>	<span class="s">&quot;timer&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">5</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;kfuse&quot;</span><span class="p">,</span>	<span class="s">&quot;kfuse-tegra&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">40</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;fuse&quot;</span><span class="p">,</span>	<span class="s">&quot;fuse-tegra&quot;</span><span class="p">,</span>		<span class="s">&quot;fuse&quot;</span><span class="p">,</span>	<span class="mi">39</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;fuse_burn&quot;</span><span class="p">,</span>	<span class="s">&quot;fuse-tegra&quot;</span><span class="p">,</span>		<span class="s">&quot;fuse_burn&quot;</span><span class="p">,</span>	<span class="mi">39</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>		<span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;apbif&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-ahub&quot;</span><span class="p">,</span>		<span class="s">&quot;apbif&quot;</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2s0&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-i2s.0&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">30</span><span class="p">,</span>	<span class="mh">0x1d8</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllaout0_audio0_2x_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2s1&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-i2s.1&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">11</span><span class="p">,</span>	<span class="mh">0x100</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllaout0_audio1_2x_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2s2&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-i2s.2&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">18</span><span class="p">,</span>	<span class="mh">0x104</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllaout0_audio2_2x_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2s3&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-i2s.3&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">101</span><span class="p">,</span>	<span class="mh">0x3bc</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllaout0_audio3_2x_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2s4&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-i2s.4&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">102</span><span class="p">,</span>	<span class="mh">0x3c0</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllaout0_audio4_2x_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;spdif_out&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-spdif&quot;</span><span class="p">,</span>	<span class="s">&quot;spdif_out&quot;</span><span class="p">,</span>	<span class="mi">10</span><span class="p">,</span>	<span class="mh">0x108</span><span class="p">,</span>	<span class="mi">100000000</span><span class="p">,</span> <span class="n">mux_pllaout0_audio_2x_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;spdif_in&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-spdif&quot;</span><span class="p">,</span>	<span class="s">&quot;spdif_in&quot;</span><span class="p">,</span>	<span class="mi">10</span><span class="p">,</span>	<span class="mh">0x10c</span><span class="p">,</span>	<span class="mi">100000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;pwm&quot;</span><span class="p">,</span>	<span class="s">&quot;pwm&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">17</span><span class="p">,</span>	<span class="mh">0x110</span><span class="p">,</span>	<span class="mi">432000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_clk32_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">MUX_PWM</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;d_audio&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-ahub&quot;</span><span class="p">,</span>		<span class="s">&quot;d_audio&quot;</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span>	<span class="mh">0x3d0</span><span class="p">,</span>	<span class="mi">48000000</span><span class="p">,</span>  <span class="n">mux_plla_pllc_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;dam0&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-dam.0&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>   <span class="mi">108</span><span class="p">,</span>	<span class="mh">0x3d8</span><span class="p">,</span>	<span class="mi">48000000</span><span class="p">,</span>  <span class="n">mux_plla_pllc_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;dam1&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-dam.1&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>   <span class="mi">109</span><span class="p">,</span>	<span class="mh">0x3dc</span><span class="p">,</span>	<span class="mi">48000000</span><span class="p">,</span>  <span class="n">mux_plla_pllc_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;dam2&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-dam.2&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>   <span class="mi">110</span><span class="p">,</span>	<span class="mh">0x3e0</span><span class="p">,</span>	<span class="mi">48000000</span><span class="p">,</span>  <span class="n">mux_plla_pllc_pllp_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;hda&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-hda&quot;</span><span class="p">,</span>		<span class="s">&quot;hda&quot;</span><span class="p">,</span>   <span class="mi">125</span><span class="p">,</span>	<span class="mh">0x428</span><span class="p">,</span>	<span class="mi">108000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;hda2codec_2x&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-hda&quot;</span><span class="p">,</span>	<span class="s">&quot;hda2codec&quot;</span><span class="p">,</span>   <span class="mi">111</span><span class="p">,</span>	<span class="mh">0x3e4</span><span class="p">,</span>	<span class="mi">48000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;hda2hdmi&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra30-hda&quot;</span><span class="p">,</span>		<span class="s">&quot;hda2hdmi&quot;</span><span class="p">,</span>	<span class="mi">128</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">48000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sbc1&quot;</span><span class="p">,</span>	<span class="s">&quot;spi_tegra.0&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">41</span><span class="p">,</span>	<span class="mh">0x134</span><span class="p">,</span>	<span class="mi">160000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sbc2&quot;</span><span class="p">,</span>	<span class="s">&quot;spi_tegra.1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">44</span><span class="p">,</span>	<span class="mh">0x118</span><span class="p">,</span>	<span class="mi">160000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sbc3&quot;</span><span class="p">,</span>	<span class="s">&quot;spi_tegra.2&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">46</span><span class="p">,</span>	<span class="mh">0x11c</span><span class="p">,</span>	<span class="mi">160000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sbc4&quot;</span><span class="p">,</span>	<span class="s">&quot;spi_tegra.3&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">68</span><span class="p">,</span>	<span class="mh">0x1b4</span><span class="p">,</span>	<span class="mi">160000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sbc5&quot;</span><span class="p">,</span>	<span class="s">&quot;spi_tegra.4&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">104</span><span class="p">,</span>	<span class="mh">0x3c8</span><span class="p">,</span>	<span class="mi">160000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sbc6&quot;</span><span class="p">,</span>	<span class="s">&quot;spi_tegra.5&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">105</span><span class="p">,</span>	<span class="mh">0x3cc</span><span class="p">,</span>	<span class="mi">160000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sata_oob&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_sata_oob&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">123</span><span class="p">,</span>	<span class="mh">0x420</span><span class="p">,</span>	<span class="mi">216000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sata&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_sata&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">124</span><span class="p">,</span>	<span class="mh">0x424</span><span class="p">,</span>	<span class="mi">216000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sata_cold&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_sata_cold&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">129</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">48000000</span><span class="p">,</span>  <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK_EX</span><span class="p">(</span><span class="s">&quot;ndflash&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_nand&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">13</span><span class="p">,</span>	<span class="mh">0x160</span><span class="p">,</span>	<span class="mi">240000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_nand_clk_ops</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;ndspeed&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_nand_speed&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">80</span><span class="p">,</span>	<span class="mh">0x3f8</span><span class="p">,</span>	<span class="mi">240000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;vfir&quot;</span><span class="p">,</span>	<span class="s">&quot;vfir&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">7</span><span class="p">,</span>	<span class="mh">0x168</span><span class="p">,</span>	<span class="mi">72000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sdmmc1&quot;</span><span class="p">,</span>	<span class="s">&quot;sdhci-tegra.0&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">14</span><span class="p">,</span>	<span class="mh">0x150</span><span class="p">,</span>	<span class="mi">208000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sdmmc2&quot;</span><span class="p">,</span>	<span class="s">&quot;sdhci-tegra.1&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">9</span><span class="p">,</span>	<span class="mh">0x154</span><span class="p">,</span>	<span class="mi">104000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sdmmc3&quot;</span><span class="p">,</span>	<span class="s">&quot;sdhci-tegra.2&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">69</span><span class="p">,</span>	<span class="mh">0x1bc</span><span class="p">,</span>	<span class="mi">208000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;sdmmc4&quot;</span><span class="p">,</span>	<span class="s">&quot;sdhci-tegra.3&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">15</span><span class="p">,</span>	<span class="mh">0x164</span><span class="p">,</span>	<span class="mi">104000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;vcp&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-avp&quot;</span><span class="p">,</span>		<span class="s">&quot;vcp&quot;</span><span class="p">,</span>	<span class="mi">29</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;bsea&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-avp&quot;</span><span class="p">,</span>		<span class="s">&quot;bsea&quot;</span><span class="p">,</span>	<span class="mi">62</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;bsev&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-aes&quot;</span><span class="p">,</span>		<span class="s">&quot;bsev&quot;</span><span class="p">,</span>	<span class="mi">63</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;vde&quot;</span><span class="p">,</span>	<span class="s">&quot;vde&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">61</span><span class="p">,</span>	<span class="mh">0x1c8</span><span class="p">,</span>	<span class="mi">520000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_INT</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;csite&quot;</span><span class="p">,</span>	<span class="s">&quot;csite&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">73</span><span class="p">,</span>	<span class="mh">0x1d4</span><span class="p">,</span>	<span class="mi">144000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* max rate ??? */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;la&quot;</span><span class="p">,</span>	<span class="s">&quot;la&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">76</span><span class="p">,</span>	<span class="mh">0x1f8</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;owr&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_w1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">71</span><span class="p">,</span>	<span class="mh">0x1cc</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;nor&quot;</span><span class="p">,</span>	<span class="s">&quot;nor&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">42</span><span class="p">,</span>	<span class="mh">0x1d0</span><span class="p">,</span>	<span class="mi">127000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;mipi&quot;</span><span class="p">,</span>	<span class="s">&quot;mipi&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">50</span><span class="p">,</span>	<span class="mh">0x174</span><span class="p">,</span>	<span class="mi">60000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span> <span class="cm">/* scales with voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2c1&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.0&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">12</span><span class="p">,</span>	<span class="mh">0x124</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_clkm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U16</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2c2&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">54</span><span class="p">,</span>	<span class="mh">0x198</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_clkm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U16</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2c3&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.2&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">67</span><span class="p">,</span>	<span class="mh">0x1b8</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_clkm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U16</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2c4&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.3&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">103</span><span class="p">,</span>	<span class="mh">0x3c4</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_clkm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U16</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2c5&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-i2c.4&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">47</span><span class="p">,</span>	<span class="mh">0x128</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_clkm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U16</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uarta&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_uart.0&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">6</span><span class="p">,</span>	<span class="mh">0x178</span><span class="p">,</span>	<span class="mi">800000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_UART</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uartb&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_uart.1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">7</span><span class="p">,</span>	<span class="mh">0x17c</span><span class="p">,</span>	<span class="mi">800000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_UART</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uartc&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_uart.2&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">55</span><span class="p">,</span>	<span class="mh">0x1a0</span><span class="p">,</span>	<span class="mi">800000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_UART</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uartd&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_uart.3&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">65</span><span class="p">,</span>	<span class="mh">0x1c0</span><span class="p">,</span>	<span class="mi">800000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_UART</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uarte&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_uart.4&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">66</span><span class="p">,</span>	<span class="mh">0x1c4</span><span class="p">,</span>	<span class="mi">800000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_UART</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uarta_dbg&quot;</span><span class="p">,</span>	<span class="s">&quot;serial8250.0&quot;</span><span class="p">,</span>		<span class="s">&quot;uarta&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>	<span class="mh">0x178</span><span class="p">,</span>	<span class="mi">800000000</span><span class="p">,</span> <span class="n">mux_pllp_clkm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_UART</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uartb_dbg&quot;</span><span class="p">,</span>	<span class="s">&quot;serial8250.0&quot;</span><span class="p">,</span>		<span class="s">&quot;uartb&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>	<span class="mh">0x17c</span><span class="p">,</span>	<span class="mi">800000000</span><span class="p">,</span> <span class="n">mux_pllp_clkm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_UART</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uartc_dbg&quot;</span><span class="p">,</span>	<span class="s">&quot;serial8250.0&quot;</span><span class="p">,</span>		<span class="s">&quot;uartc&quot;</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span>	<span class="mh">0x1a0</span><span class="p">,</span>	<span class="mi">800000000</span><span class="p">,</span> <span class="n">mux_pllp_clkm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_UART</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uartd_dbg&quot;</span><span class="p">,</span>	<span class="s">&quot;serial8250.0&quot;</span><span class="p">,</span>		<span class="s">&quot;uartd&quot;</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span>	<span class="mh">0x1c0</span><span class="p">,</span>	<span class="mi">800000000</span><span class="p">,</span> <span class="n">mux_pllp_clkm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_UART</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;uarte_dbg&quot;</span><span class="p">,</span>	<span class="s">&quot;serial8250.0&quot;</span><span class="p">,</span>		<span class="s">&quot;uarte&quot;</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span>	<span class="mh">0x1c4</span><span class="p">,</span>	<span class="mi">800000000</span><span class="p">,</span> <span class="n">mux_pllp_clkm</span><span class="p">,</span>		<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_UART</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK_EX</span><span class="p">(</span><span class="s">&quot;vi&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_camera&quot;</span><span class="p">,</span>		<span class="s">&quot;vi&quot;</span><span class="p">,</span>	<span class="mi">20</span><span class="p">,</span>	<span class="mh">0x148</span><span class="p">,</span>	<span class="mi">425000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_INT</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_vi_clk_ops</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;3d&quot;</span><span class="p">,</span>	<span class="s">&quot;3d&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">24</span><span class="p">,</span>	<span class="mh">0x158</span><span class="p">,</span>	<span class="mi">520000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_INT</span> <span class="o">|</span> <span class="n">DIV_U71_IDLE</span> <span class="o">|</span> <span class="n">PERIPH_MANUAL_RESET</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;3d2&quot;</span><span class="p">,</span>       <span class="s">&quot;3d2&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">98</span><span class="p">,</span>	<span class="mh">0x3b0</span><span class="p">,</span>	<span class="mi">520000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_INT</span> <span class="o">|</span> <span class="n">DIV_U71_IDLE</span> <span class="o">|</span> <span class="n">PERIPH_MANUAL_RESET</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;2d&quot;</span><span class="p">,</span>	<span class="s">&quot;2d&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">21</span><span class="p">,</span>	<span class="mh">0x15c</span><span class="p">,</span>	<span class="mi">520000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_INT</span> <span class="o">|</span> <span class="n">DIV_U71_IDLE</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;vi_sensor&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_camera&quot;</span><span class="p">,</span>		<span class="s">&quot;vi_sensor&quot;</span><span class="p">,</span>	<span class="mi">20</span><span class="p">,</span>	<span class="mh">0x1a8</span><span class="p">,</span>	<span class="mi">150000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_NO_RESET</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;epp&quot;</span><span class="p">,</span>	<span class="s">&quot;epp&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">19</span><span class="p">,</span>	<span class="mh">0x16c</span><span class="p">,</span>	<span class="mi">520000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_INT</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;mpe&quot;</span><span class="p">,</span>	<span class="s">&quot;mpe&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">60</span><span class="p">,</span>	<span class="mh">0x170</span><span class="p">,</span>	<span class="mi">520000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_INT</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;host1x&quot;</span><span class="p">,</span>	<span class="s">&quot;host1x&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">28</span><span class="p">,</span>	<span class="mh">0x180</span><span class="p">,</span>	<span class="mi">260000000</span><span class="p">,</span> <span class="n">mux_pllm_pllc_pllp_plla</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_INT</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;cve&quot;</span><span class="p">,</span>	<span class="s">&quot;cve&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">49</span><span class="p">,</span>	<span class="mh">0x140</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_pllp_plld_pllc_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;tvo&quot;</span><span class="p">,</span>	<span class="s">&quot;tvo&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">49</span><span class="p">,</span>	<span class="mh">0x188</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_pllp_plld_pllc_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK_EX</span><span class="p">(</span><span class="s">&quot;dtv&quot;</span><span class="p">,</span>	<span class="s">&quot;dtv&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">79</span><span class="p">,</span>	<span class="mh">0x1dc</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">,</span>		<span class="o">&amp;</span><span class="n">tegra_dtv_clk_ops</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;hdmi&quot;</span><span class="p">,</span>	<span class="s">&quot;hdmi&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">51</span><span class="p">,</span>	<span class="mh">0x18c</span><span class="p">,</span>	<span class="mi">148500000</span><span class="p">,</span> <span class="n">mux_pllp_pllm_plld_plla_pllc_plld2_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">MUX8</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;tvdac&quot;</span><span class="p">,</span>	<span class="s">&quot;tvdac&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">53</span><span class="p">,</span>	<span class="mh">0x194</span><span class="p">,</span>	<span class="mi">220000000</span><span class="p">,</span> <span class="n">mux_pllp_plld_pllc_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;disp1&quot;</span><span class="p">,</span>	<span class="s">&quot;tegradc.0&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">27</span><span class="p">,</span>	<span class="mh">0x138</span><span class="p">,</span>	<span class="mi">600000000</span><span class="p">,</span> <span class="n">mux_pllp_pllm_plld_plla_pllc_plld2_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">MUX8</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;disp2&quot;</span><span class="p">,</span>	<span class="s">&quot;tegradc.1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">26</span><span class="p">,</span>	<span class="mh">0x13c</span><span class="p">,</span>	<span class="mi">600000000</span><span class="p">,</span> <span class="n">mux_pllp_pllm_plld_plla_pllc_plld2_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">MUX8</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;usbd&quot;</span><span class="p">,</span>	<span class="s">&quot;fsl-tegra-udc&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">22</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">480000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;usb2&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-ehci.1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">58</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">480000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;usb3&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-ehci.2&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">59</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">480000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span> <span class="cm">/* requires min voltage */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;dsia&quot;</span><span class="p">,</span>	<span class="s">&quot;tegradc.0&quot;</span><span class="p">,</span>		<span class="s">&quot;dsia&quot;</span><span class="p">,</span>	<span class="mi">48</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">500000000</span><span class="p">,</span> <span class="n">mux_plld_out0</span><span class="p">,</span>		<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK_EX</span><span class="p">(</span><span class="s">&quot;dsib&quot;</span><span class="p">,</span>	<span class="s">&quot;tegradc.1&quot;</span><span class="p">,</span>		<span class="s">&quot;dsib&quot;</span><span class="p">,</span>	<span class="mi">82</span><span class="p">,</span>	<span class="mh">0xd0</span><span class="p">,</span>	<span class="mi">500000000</span><span class="p">,</span> <span class="n">mux_plld_out0_plld2_out0</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">PLLD</span><span class="p">,</span>	<span class="o">&amp;</span><span class="n">tegra_dsib_clk_ops</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;csi&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_camera&quot;</span><span class="p">,</span>		<span class="s">&quot;csi&quot;</span><span class="p">,</span>	<span class="mi">52</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">102000000</span><span class="p">,</span> <span class="n">mux_pllp_out3</span><span class="p">,</span>		<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;isp&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_camera&quot;</span><span class="p">,</span>		<span class="s">&quot;isp&quot;</span><span class="p">,</span>	<span class="mi">23</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">150000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span> <span class="cm">/* same frequency as VI */</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;csus&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra_camera&quot;</span><span class="p">,</span>		<span class="s">&quot;csus&quot;</span><span class="p">,</span>	<span class="mi">92</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">150000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="n">PERIPH_NO_RESET</span><span class="p">),</span>

	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;tsensor&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-tsensor&quot;</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">100</span><span class="p">,</span>	<span class="mh">0x3b8</span><span class="p">,</span>	<span class="mi">216000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_clkm_clk32</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;actmon&quot;</span><span class="p">,</span>	<span class="s">&quot;actmon&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">119</span><span class="p">,</span>	<span class="mh">0x3e8</span><span class="p">,</span>	<span class="mi">216000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_clk32_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;extern1&quot;</span><span class="p">,</span>	<span class="s">&quot;extern1&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">120</span><span class="p">,</span>	<span class="mh">0x3ec</span><span class="p">,</span>	<span class="mi">216000000</span><span class="p">,</span> <span class="n">mux_plla_clk32_pllp_clkm_plle</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">MUX8</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;extern2&quot;</span><span class="p">,</span>	<span class="s">&quot;extern2&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">121</span><span class="p">,</span>	<span class="mh">0x3f0</span><span class="p">,</span>	<span class="mi">216000000</span><span class="p">,</span> <span class="n">mux_plla_clk32_pllp_clkm_plle</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">MUX8</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;extern3&quot;</span><span class="p">,</span>	<span class="s">&quot;extern3&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">122</span><span class="p">,</span>	<span class="mh">0x3f4</span><span class="p">,</span>	<span class="mi">216000000</span><span class="p">,</span> <span class="n">mux_plla_clk32_pllp_clkm_plle</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">MUX8</span> <span class="o">|</span> <span class="n">DIV_U71</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;i2cslow&quot;</span><span class="p">,</span>	<span class="s">&quot;i2cslow&quot;</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">81</span><span class="p">,</span>	<span class="mh">0x3fc</span><span class="p">,</span>	<span class="mi">26000000</span><span class="p">,</span>  <span class="n">mux_pllp_pllc_clk32_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">PERIPH_ON_APB</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;pcie&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-pcie&quot;</span><span class="p">,</span>		<span class="s">&quot;pcie&quot;</span><span class="p">,</span>	<span class="mi">70</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;afi&quot;</span><span class="p">,</span>	<span class="s">&quot;tegra-pcie&quot;</span><span class="p">,</span>		<span class="s">&quot;afi&quot;</span><span class="p">,</span>	<span class="mi">72</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>	<span class="mi">250000000</span><span class="p">,</span> <span class="n">mux_clk_m</span><span class="p">,</span>			<span class="mi">0</span><span class="p">),</span>
	<span class="n">PERIPH_CLK</span><span class="p">(</span><span class="s">&quot;se&quot;</span><span class="p">,</span>	<span class="s">&quot;se&quot;</span><span class="p">,</span>			<span class="nb">NULL</span><span class="p">,</span>	<span class="mi">127</span><span class="p">,</span>	<span class="mh">0x42c</span><span class="p">,</span>	<span class="mi">520000000</span><span class="p">,</span> <span class="n">mux_pllp_pllc_pllm_clkm</span><span class="p">,</span>	<span class="n">MUX</span> <span class="o">|</span> <span class="n">DIV_U71</span> <span class="o">|</span> <span class="n">DIV_U71_INT</span><span class="p">),</span>
<span class="p">};</span>

<span class="cp">#define CLK_DUPLICATE(_name, _dev, _con)		\</span>
<span class="cp">	{						\</span>
<span class="cp">		.name	= _name,			\</span>
<span class="cp">		.lookup	= {				\</span>
<span class="cp">			.dev_id	= _dev,			\</span>
<span class="cp">			.con_id		= _con,		\</span>
<span class="cp">		},					\</span>
<span class="cp">	}</span>

<span class="cm">/* Some clocks may be used by different drivers depending on the board</span>
<span class="cm"> * configuration.  List those here to register them twice in the clock lookup</span>
<span class="cm"> * table under two names.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">clk_duplicate</span> <span class="n">tegra_clk_duplicates</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;usbd&quot;</span><span class="p">,</span> <span class="s">&quot;utmip-pad&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;usbd&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-ehci.0&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;usbd&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-otg&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;hdmi&quot;</span><span class="p">,</span> <span class="s">&quot;tegradc.0&quot;</span><span class="p">,</span> <span class="s">&quot;hdmi&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;hdmi&quot;</span><span class="p">,</span> <span class="s">&quot;tegradc.1&quot;</span><span class="p">,</span> <span class="s">&quot;hdmi&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;dsib&quot;</span><span class="p">,</span> <span class="s">&quot;tegradc.0&quot;</span><span class="p">,</span> <span class="s">&quot;dsib&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;dsia&quot;</span><span class="p">,</span> <span class="s">&quot;tegradc.1&quot;</span><span class="p">,</span> <span class="s">&quot;dsia&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;pwm&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_pwm.0&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;pwm&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_pwm.1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;pwm&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_pwm.2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;pwm&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_pwm.3&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;bsev&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-avp&quot;</span><span class="p">,</span> <span class="s">&quot;bsev&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;bsev&quot;</span><span class="p">,</span> <span class="s">&quot;nvavp&quot;</span><span class="p">,</span> <span class="s">&quot;bsev&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;vde&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-aes&quot;</span><span class="p">,</span> <span class="s">&quot;vde&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;bsea&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-aes&quot;</span><span class="p">,</span> <span class="s">&quot;bsea&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;bsea&quot;</span><span class="p">,</span> <span class="s">&quot;nvavp&quot;</span><span class="p">,</span> <span class="s">&quot;bsea&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;cml1&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_sata_cml&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;cml0&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_pcie&quot;</span><span class="p">,</span> <span class="s">&quot;cml&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;pciex&quot;</span><span class="p">,</span> <span class="s">&quot;tegra_pcie&quot;</span><span class="p">,</span> <span class="s">&quot;pciex&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;i2c1&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-i2c-slave.0&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;i2c2&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-i2c-slave.1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;i2c3&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-i2c-slave.2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;i2c4&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-i2c-slave.3&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;i2c5&quot;</span><span class="p">,</span> <span class="s">&quot;tegra-i2c-slave.4&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;sbc1&quot;</span><span class="p">,</span> <span class="s">&quot;spi_slave_tegra.0&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;sbc2&quot;</span><span class="p">,</span> <span class="s">&quot;spi_slave_tegra.1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;sbc3&quot;</span><span class="p">,</span> <span class="s">&quot;spi_slave_tegra.2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;sbc4&quot;</span><span class="p">,</span> <span class="s">&quot;spi_slave_tegra.3&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;sbc5&quot;</span><span class="p">,</span> <span class="s">&quot;spi_slave_tegra.4&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;sbc6&quot;</span><span class="p">,</span> <span class="s">&quot;spi_slave_tegra.5&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;twd&quot;</span><span class="p">,</span> <span class="s">&quot;smp_twd&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;vcp&quot;</span><span class="p">,</span> <span class="s">&quot;nvavp&quot;</span><span class="p">,</span> <span class="s">&quot;vcp&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;i2s0&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;i2s0&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;i2s1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;i2s1&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;i2s2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;i2s2&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;i2s3&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;i2s3&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;i2s4&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;i2s4&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;dam0&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;dam0&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;dam1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;dam1&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;dam2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;dam2&quot;</span><span class="p">),</span>
	<span class="n">CLK_DUPLICATE</span><span class="p">(</span><span class="s">&quot;spdif_in&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;spdif_in&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">tegra_ptr_clks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_32k</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_m</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_m_div2</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_m_div4</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_ref</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_m</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_m_out1</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_c</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_c_out1</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_p</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_p_out1</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_p_out2</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_p_out3</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_p_out4</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_a</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_a_out0</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_d</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_d_out0</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_d2</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_d2_out0</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_u</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_x</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_x_out0</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pll_e</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_cclk_g</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_cml0_clk</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_cml1_clk</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_pciex_clk</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_sclk</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra_clk_blink</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">tegra30_clk_twd</span><span class="p">,</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">tegra30_init_one_clock</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">clk_init</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
	<span class="n">INIT_LIST_HEAD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">shared_bus_list</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">.</span><span class="n">dev_id</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">.</span><span class="n">con_id</span><span class="p">)</span>
		<span class="n">c</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
	<span class="n">clkdev_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">lookup</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">tegra30_init_clocks</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_ptr_clks</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">tegra30_init_one_clock</span><span class="p">(</span><span class="n">tegra_ptr_clks</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_list_clks</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">tegra30_init_one_clock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_list_clks</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_clk_duplicates</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">tegra_get_clock_by_name</span><span class="p">(</span><span class="n">tegra_clk_duplicates</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: Unknown duplicate clock %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
				<span class="n">tegra_clk_duplicates</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">tegra_clk_duplicates</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lookup</span><span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
		<span class="n">clkdev_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_clk_duplicates</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lookup</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_sync_source_list</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">tegra30_init_one_clock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_sync_source_list</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_clk_audio_list</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">tegra30_init_one_clock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_clk_audio_list</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_clk_audio_2x_list</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">tegra30_init_one_clock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_clk_audio_2x_list</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="n">init_clk_out_mux</span><span class="p">();</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tegra_clk_out_list</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">tegra30_init_one_clock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tegra_clk_out_list</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
