<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › include › asm › kgdb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>kgdb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * ARM KGDB support</span>
<span class="cm"> *</span>
<span class="cm"> * Author: Deepak Saxena &lt;dsaxena@mvista.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2002 MontaVista Software Inc.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ARM_KGDB_H__</span>
<span class="cp">#define __ARM_KGDB_H__</span>

<span class="cp">#include &lt;linux/ptrace.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * GDB assumes that we&#39;re a user process being debugged, so</span>
<span class="cm"> * it will send us an SWI command to write into memory as the</span>
<span class="cm"> * debug trap. When an SWI occurs, the next instruction addr is</span>
<span class="cm"> * placed into R14_svc before jumping to the vector trap.</span>
<span class="cm"> * This doesn&#39;t work for kernel debugging as we are already in SVC</span>
<span class="cm"> * we would loose the kernel&#39;s LR, which is a bad thing. This</span>
<span class="cm"> * is  bad thing.</span>
<span class="cm"> *</span>
<span class="cm"> * By doing this as an undefined instruction trap, we force a mode</span>
<span class="cm"> * switch from SVC to UND mode, allowing us to save full kernel state.</span>
<span class="cm"> *</span>
<span class="cm"> * We also define a KGDB_COMPILED_BREAK which can be used to compile</span>
<span class="cm"> * in breakpoints. This is important for things like sysrq-G and for</span>
<span class="cm"> * the initial breakpoint from trap_init().</span>
<span class="cm"> *</span>
<span class="cm"> * Note to ARM HW designers: Add real trap support like SH &amp;&amp; PPC to</span>
<span class="cm"> * make our lives much much simpler. :)</span>
<span class="cm"> */</span>
<span class="cp">#define BREAK_INSTR_SIZE	4</span>
<span class="cp">#define GDB_BREAKINST		0xef9f0001</span>
<span class="cp">#define KGDB_BREAKINST		0xe7ffdefe</span>
<span class="cp">#define KGDB_COMPILED_BREAK	0xe7ffdeff</span>
<span class="cp">#define CACHE_FLUSH_IS_SAFE	1</span>

<span class="cp">#ifndef	__ASSEMBLY__</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">arch_kgdb_breakpoint</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">asm</span><span class="p">(</span><span class="s">&quot;.word 0xe7ffdeff&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">kgdb_handle_bus_error</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kgdb_fault_expected</span><span class="p">;</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * From Kevin Hilman:</span>
<span class="cm"> *</span>
<span class="cm"> * gdb is expecting the following registers layout.</span>
<span class="cm"> *</span>
<span class="cm"> * r0-r15: 1 long word each</span>
<span class="cm"> * f0-f7:  unused, 3 long words each !!</span>
<span class="cm"> * fps:    unused, 1 long word</span>
<span class="cm"> * cpsr:   1 long word</span>
<span class="cm"> *</span>
<span class="cm"> * Even though f0-f7 and fps are not used, they need to be</span>
<span class="cm"> * present in the registers sent for correct processing in</span>
<span class="cm"> * the host-side gdb.</span>
<span class="cm"> *</span>
<span class="cm"> * In particular, it is crucial that CPSR is in the right place,</span>
<span class="cm"> * otherwise gdb will not be able to correctly interpret stepping over</span>
<span class="cm"> * conditional branches.</span>
<span class="cm"> */</span>
<span class="cp">#define _GP_REGS		16</span>
<span class="cp">#define _FP_REGS		8</span>
<span class="cp">#define _EXTRA_REGS		2</span>
<span class="cp">#define GDB_MAX_REGS		(_GP_REGS + (_FP_REGS * 3) + _EXTRA_REGS)</span>
<span class="cp">#define DBG_MAX_REG_NUM		(_GP_REGS + _FP_REGS + _EXTRA_REGS)</span>

<span class="cp">#define KGDB_MAX_NO_CPUS	1</span>
<span class="cp">#define BUFMAX			400</span>
<span class="cp">#define NUMREGBYTES		(DBG_MAX_REG_NUM &lt;&lt; 2)</span>
<span class="cp">#define NUMCRITREGBYTES		(32 &lt;&lt; 2)</span>

<span class="cp">#define _R0			0</span>
<span class="cp">#define _R1			1</span>
<span class="cp">#define _R2			2</span>
<span class="cp">#define _R3			3</span>
<span class="cp">#define _R4			4</span>
<span class="cp">#define _R5			5</span>
<span class="cp">#define _R6			6</span>
<span class="cp">#define _R7			7</span>
<span class="cp">#define _R8			8</span>
<span class="cp">#define _R9			9</span>
<span class="cp">#define _R10			10</span>
<span class="cp">#define _FP			11</span>
<span class="cp">#define _IP			12</span>
<span class="cp">#define _SPT			13</span>
<span class="cp">#define _LR			14</span>
<span class="cp">#define _PC			15</span>
<span class="cp">#define _CPSR			(GDB_MAX_REGS - 1)</span>

<span class="cm">/*</span>
<span class="cm"> * So that we can denote the end of a frame for tracing,</span>
<span class="cm"> * in the simple case:</span>
<span class="cm"> */</span>
<span class="cp">#define CFI_END_FRAME(func)	__CFI_END_FRAME(_PC, _SPT, func)</span>

<span class="cp">#endif </span><span class="cm">/* __ASM_KGDB_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
