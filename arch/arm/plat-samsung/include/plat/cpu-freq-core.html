<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › plat-samsung › include › plat › cpu-freq-core.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>cpu-freq-core.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* arch/arm/plat-samsung/include/plat/cpu-freq-core.h</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2006-2009 Simtec Electronics</span>
<span class="cm"> *	http://armlinux.simtec.co.uk/</span>
<span class="cm"> *	Ben Dooks &lt;ben@simtec.co.uk&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * S3C CPU frequency scaling support - core support</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm">*/</span>

<span class="cp">#include &lt;plat/cpu-freq.h&gt;</span>

<span class="k">struct</span> <span class="n">seq_file</span><span class="p">;</span>

<span class="cp">#define MAX_BANKS (8)</span>
<span class="cp">#define S3C2412_MAX_IO	(8)</span>

<span class="cm">/**</span>
<span class="cm"> * struct s3c2410_iobank_timing - IO bank timings for S3C2410 style timings</span>
<span class="cm"> * @bankcon: The cached version of settings in this structure.</span>
<span class="cm"> * @tacp:</span>
<span class="cm"> * @tacs: Time from address valid to nCS asserted.</span>
<span class="cm"> * @tcos: Time from nCS asserted to nOE or nWE asserted.</span>
<span class="cm"> * @tacc: Time that nOE or nWE is asserted.</span>
<span class="cm"> * @tcoh: Time nCS is held after nOE or nWE are released.</span>
<span class="cm"> * @tcah: Time address is held for after</span>
<span class="cm"> * @nwait_en: Whether nWAIT is enabled for this bank.</span>
<span class="cm"> *</span>
<span class="cm"> * This structure represents the IO timings for a S3C2410 style IO bank</span>
<span class="cm"> * used by the CPU frequency support if it needs to change the settings</span>
<span class="cm"> * of the IO.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s3c2410_iobank_timing</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">bankcon</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">tacp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">tacs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">tcos</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">tacc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">tcoh</span><span class="p">;</span>		<span class="cm">/* nCS hold afrer nOE/nWE */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">tcah</span><span class="p">;</span>		<span class="cm">/* Address hold after nCS */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">nwait_en</span><span class="p">;</span>	<span class="cm">/* nWait enabled for bank. */</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct s3c2412_iobank_timing - io timings for PL092 (S3C2412) style IO</span>
<span class="cm"> * @idcy: The idle cycle time between transactions.</span>
<span class="cm"> * @wstrd: nCS release to end of read cycle.</span>
<span class="cm"> * @wstwr: nCS release to end of write cycle.</span>
<span class="cm"> * @wstoen: nCS assertion to nOE assertion time.</span>
<span class="cm"> * @wstwen: nCS assertion to nWE assertion time.</span>
<span class="cm"> * @wstbrd: Burst ready delay.</span>
<span class="cm"> * @smbidcyr: Register cache for smbidcyr value.</span>
<span class="cm"> * @smbwstrd: Register cache for smbwstrd value.</span>
<span class="cm"> * @smbwstwr: Register cache for smbwstwr value.</span>
<span class="cm"> * @smbwstoen: Register cache for smbwstoen value.</span>
<span class="cm"> * @smbwstwen: Register cache for smbwstwen value.</span>
<span class="cm"> * @smbwstbrd: Register cache for smbwstbrd value.</span>
<span class="cm"> *</span>
<span class="cm"> * Timing information for a IO bank on an S3C2412 or similar system which</span>
<span class="cm"> * uses a PL093 block.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s3c2412_iobank_timing</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">idcy</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">wstrd</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">wstwr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">wstoen</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">wstwen</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">wstbrd</span><span class="p">;</span>

	<span class="cm">/* register cache */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">smbidcyr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">smbwstrd</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">smbwstwr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">smbwstoen</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">smbwstwen</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">smbwstbrd</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">s3c_iobank</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">s3c2410_iobank_timing</span>	<span class="o">*</span><span class="n">io_2410</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">s3c2412_iobank_timing</span>	<span class="o">*</span><span class="n">io_2412</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct s3c_iotimings - Chip IO timings holder</span>
<span class="cm"> * @bank: The timings for each IO bank.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s3c_iotimings</span> <span class="p">{</span>
	<span class="k">union</span> <span class="n">s3c_iobank</span>	<span class="n">bank</span><span class="p">[</span><span class="n">MAX_BANKS</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct s3c_plltab - PLL table information.</span>
<span class="cm"> * @vals: List of PLL values.</span>
<span class="cm"> * @size: Size of the PLL table @vals.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s3c_plltab</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">s3c_pllval</span>	<span class="o">*</span><span class="n">vals</span><span class="p">;</span>
	<span class="kt">int</span>			 <span class="n">size</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct s3c_cpufreq_config - current cpu frequency configuration</span>
<span class="cm"> * @freq: The current settings for the core clocks.</span>
<span class="cm"> * @max: Maxium settings, derived from core, board and user settings.</span>
<span class="cm"> * @pll: The PLL table entry for the current PLL settings.</span>
<span class="cm"> * @divs: The divisor settings for the core clocks.</span>
<span class="cm"> * @info: The current core driver information.</span>
<span class="cm"> * @board: The information for the board we are running on.</span>
<span class="cm"> * @lock_pll: Set if the PLL settings cannot be changed.</span>
<span class="cm"> *</span>
<span class="cm"> * This is for the core drivers that need to know information about</span>
<span class="cm"> * the current settings and values. It should not be needed by any</span>
<span class="cm"> * device drivers.</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">s3c_freq</span>		<span class="n">freq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">s3c_freq</span>		<span class="n">max</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cpufreq_frequency_table</span> <span class="n">pll</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">s3c_clkdivs</span>	<span class="n">divs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">s3c_cpufreq_info</span> <span class="o">*</span><span class="n">info</span><span class="p">;</span>	<span class="cm">/* for core, not drivers */</span>
	<span class="k">struct</span> <span class="n">s3c_cpufreq_board</span> <span class="o">*</span><span class="n">board</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">lock_pll</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct s3c_cpufreq_info - Information for the CPU frequency driver.</span>
<span class="cm"> * @name: The name of this implementation.</span>
<span class="cm"> * @max: The maximum frequencies for the system.</span>
<span class="cm"> * @latency: Transition latency to give to cpufreq.</span>
<span class="cm"> * @locktime_m: The lock-time in uS for the MPLL.</span>
<span class="cm"> * @locktime_u: The lock-time in uS for the UPLL.</span>
<span class="cm"> * @locttime_bits: The number of bits each LOCKTIME field.</span>
<span class="cm"> * @need_pll: Set if this driver needs to change the PLL values to achieve</span>
<span class="cm"> *	any frequency changes. This is really only need by devices like the</span>
<span class="cm"> *	S3C2410 where there is no or limited divider between the PLL and the</span>
<span class="cm"> *	ARMCLK.</span>
<span class="cm"> * @resume_clocks: Update the clocks on resume.</span>
<span class="cm"> * @get_iotiming: Get the current IO timing data, mainly for use at start.</span>
<span class="cm"> * @set_iotiming: Update the IO timings from the cached copies calculated</span>
<span class="cm"> *	from the @calc_iotiming entry when changing the frequency.</span>
<span class="cm"> * @calc_iotiming: Calculate and update the cached copies of the IO timings</span>
<span class="cm"> *	from the newly calculated frequencies.</span>
<span class="cm"> * @calc_freqtable: Calculate (fill in) the given frequency table from the</span>
<span class="cm"> *	current frequency configuration. If the table passed in is NULL,</span>
<span class="cm"> *	then the return is the number of elements to be filled for allocation</span>
<span class="cm"> *	of the table.</span>
<span class="cm"> * @set_refresh: Set the memory refresh configuration.</span>
<span class="cm"> * @set_fvco: Set the PLL frequencies.</span>
<span class="cm"> * @set_divs: Update the clock divisors.</span>
<span class="cm"> * @calc_divs: Calculate the clock divisors.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s3c_cpufreq_info</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span>		<span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">s3c_freq</span>		<span class="n">max</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">latency</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">locktime_m</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">locktime_u</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">locktime_bits</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">need_pll</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* driver routines */</span>

	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">resume_clocks</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>

	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">get_iotiming</span><span class="p">)(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">s3c_iotimings</span> <span class="o">*</span><span class="n">timings</span><span class="p">);</span>

	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">set_iotiming</span><span class="p">)(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">s3c_iotimings</span> <span class="o">*</span><span class="n">timings</span><span class="p">);</span>

	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">calc_iotiming</span><span class="p">)(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">s3c_iotimings</span> <span class="o">*</span><span class="n">timings</span><span class="p">);</span>

	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">calc_freqtable</span><span class="p">)(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">cpufreq_frequency_table</span> <span class="o">*</span><span class="n">t</span><span class="p">,</span>
					  <span class="kt">size_t</span> <span class="n">table_size</span><span class="p">);</span>

	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">debug_io_show</span><span class="p">)(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
					 <span class="k">union</span> <span class="n">s3c_iobank</span> <span class="o">*</span><span class="n">iob</span><span class="p">);</span>

	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">set_refresh</span><span class="p">)(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">);</span>
	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">set_fvco</span><span class="p">)(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">);</span>
	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">set_divs</span><span class="p">)(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">calc_divs</span><span class="p">)(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">s3c_cpufreq_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">s3c_plltab_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">cpufreq_frequency_table</span> <span class="o">*</span><span class="n">plls</span><span class="p">,</span>
			       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">plls_no</span><span class="p">);</span>

<span class="cm">/* exports and utilities for debugfs */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">s3c_cpufreq_getconfig</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">s3c_iotimings</span> <span class="o">*</span><span class="n">s3c_cpufreq_getiotimings</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_CPU_FREQ_S3C24XX_DEBUGFS</span>
<span class="cp">#define s3c_cpufreq_debugfs_call(x) x</span>
<span class="cp">#else</span>
<span class="cp">#define s3c_cpufreq_debugfs_call(x) NULL</span>
<span class="cp">#endif</span>

<span class="cm">/* Useful utility functions. */</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">s3c_cpufreq_clk_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>

<span class="cm">/* S3C2410 and compatible exported functions */</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">s3c2410_cpufreq_setrefresh</span><span class="p">(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">s3c2410_set_fvco</span><span class="p">(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_S3C2410_IOTIMING</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">s3c2410_iotiming_debugfs</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
				     <span class="k">union</span> <span class="n">s3c_iobank</span> <span class="o">*</span><span class="n">iob</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">s3c2410_iotiming_calc</span><span class="p">(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">s3c_iotimings</span> <span class="o">*</span><span class="n">iot</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">s3c2410_iotiming_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">s3c_iotimings</span> <span class="o">*</span><span class="n">timings</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">s3c2410_iotiming_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">s3c_iotimings</span> <span class="o">*</span><span class="n">iot</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="cp">#define s3c2410_iotiming_debugfs NULL</span>
<span class="cp">#define s3c2410_iotiming_calc NULL</span>
<span class="cp">#define s3c2410_iotiming_get NULL</span>
<span class="cp">#define s3c2410_iotiming_set NULL</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_S3C2410_IOTIMING */</span><span class="cp"></span>

<span class="cm">/* S3C2412 compatible routines */</span>

<span class="cp">#ifdef CONFIG_S3C2412_IOTIMING</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">s3c2412_iotiming_debugfs</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
				     <span class="k">union</span> <span class="n">s3c_iobank</span> <span class="o">*</span><span class="n">iob</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">s3c2412_iotiming_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">s3c_iotimings</span> <span class="o">*</span><span class="n">timings</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">s3c2412_iotiming_calc</span><span class="p">(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">s3c_iotimings</span> <span class="o">*</span><span class="n">iot</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">s3c2412_iotiming_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">s3c_cpufreq_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">s3c_iotimings</span> <span class="o">*</span><span class="n">iot</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="cp">#define s3c2412_iotiming_debugfs NULL</span>
<span class="cp">#define s3c2412_iotiming_calc NULL</span>
<span class="cp">#define s3c2412_iotiming_get NULL</span>
<span class="cp">#define s3c2412_iotiming_set NULL</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_S3C2412_IOTIMING */</span><span class="cp"></span>

<span class="cp">#ifdef CONFIG_CPU_FREQ_S3C24XX_DEBUG</span>
<span class="cp">#define s3c_freq_dbg(x...) printk(KERN_INFO x)</span>
<span class="cp">#else</span>
<span class="cp">#define s3c_freq_dbg(x...) do { if (0) printk(x); } while (0)</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_CPU_FREQ_S3C24XX_DEBUG */</span><span class="cp"></span>

<span class="cp">#ifdef CONFIG_CPU_FREQ_S3C24XX_IODEBUG</span>
<span class="cp">#define s3c_freq_iodbg(x...) printk(KERN_INFO x)</span>
<span class="cp">#else</span>
<span class="cp">#define s3c_freq_iodbg(x...) do { if (0) printk(x); } while (0)</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_CPU_FREQ_S3C24XX_IODEBUG */</span><span class="cp"></span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">s3c_cpufreq_addfreq</span><span class="p">(</span><span class="k">struct</span> <span class="n">cpufreq_frequency_table</span> <span class="o">*</span><span class="n">table</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">table_size</span><span class="p">,</span>
				      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">index</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">table_size</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

		<span class="n">s3c_freq_dbg</span><span class="p">(</span><span class="s">&quot;%s: { %d = %u kHz }</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">__func__</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">freq</span><span class="p">);</span>

		<span class="n">table</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">;</span>
		<span class="n">table</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">freq</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
