<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-s3c24xx › include › mach › io.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>io.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * arch/arm/mach-s3c2410/include/mach/io.h</span>
<span class="cm"> *  from arch/arm/mach-rpc/include/mach/io.h</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1997 Russell King</span>
<span class="cm"> *	     (C) 2003 Simtec Electronics</span>
<span class="cm">*/</span>

<span class="cp">#ifndef __ASM_ARM_ARCH_IO_H</span>
<span class="cp">#define __ASM_ARM_ARCH_IO_H</span>

<span class="cp">#include &lt;mach/hardware.h&gt;</span>

<span class="cp">#define IO_SPACE_LIMIT 0xffffffff</span>

<span class="cm">/*</span>
<span class="cm"> * We use two different types of addressing - PC style addresses, and ARM</span>
<span class="cm"> * addresses.  PC style accesses the PC hardware with the normal PC IO</span>
<span class="cm"> * addresses, eg 0x3f8 for serial#1.  ARM addresses are above A28</span>
<span class="cm"> * and are translated to the start of IO.  Note that all addresses are</span>
<span class="cm"> * not shifted left!</span>
<span class="cm"> */</span>

<span class="cp">#define __PORT_PCIO(x)	((x) &lt; (1&lt;&lt;28))</span>

<span class="cp">#define PCIO_BASE	 (S3C24XX_VA_ISA_WORD)</span>
<span class="cp">#define PCIO_BASE_b	 (S3C24XX_VA_ISA_BYTE)</span>
<span class="cp">#define PCIO_BASE_w	 (S3C24XX_VA_ISA_WORD)</span>
<span class="cp">#define PCIO_BASE_l	 (S3C24XX_VA_ISA_WORD)</span>
<span class="cm">/*</span>
<span class="cm"> * Dynamic IO functions - let the compiler</span>
<span class="cm"> * optimize the expressions</span>
<span class="cm"> */</span>

<span class="cp">#define DECLARE_DYN_OUT(sz,fnsuffix,instr) \</span>
<span class="cp">static inline void __out##fnsuffix (unsigned int val, unsigned int port) \</span>
<span class="cp">{ \</span>
<span class="cp">	unsigned long temp;				      \</span>
<span class="cp">	__asm__ __volatile__(				      \</span>
<span class="cp">	&quot;cmp	%2, #(1&lt;&lt;28)\n\t&quot;			      \</span>
<span class="cp">	&quot;mov	%0, %2\n\t&quot;				      \</span>
<span class="cp">	&quot;addcc	%0, %0, %3\n\t&quot;				      \</span>
<span class="cp">	&quot;str&quot; instr &quot; %1, [%0, #0 ]	@ out&quot; #fnsuffix      \</span>
<span class="cp">	: &quot;=&amp;r&quot; (temp)					      \</span>
<span class="cp">	: &quot;r&quot; (val), &quot;r&quot; (port), &quot;Ir&quot; (PCIO_BASE_##fnsuffix)  \</span>
<span class="cp">	: &quot;cc&quot;);					      \</span>
<span class="cp">}</span>


<span class="cp">#define DECLARE_DYN_IN(sz,fnsuffix,instr)				\</span>
<span class="cp">static inline unsigned sz __in##fnsuffix (unsigned int port)		\</span>
<span class="cp">{									\</span>
<span class="cp">	unsigned long temp, value;					\</span>
<span class="cp">	__asm__ __volatile__(						\</span>
<span class="cp">	&quot;cmp	%2, #(1&lt;&lt;28)\n\t&quot;					\</span>
<span class="cp">	&quot;mov	%0, %2\n\t&quot;						\</span>
<span class="cp">	&quot;addcc	%0, %0, %3\n\t&quot;						\</span>
<span class="cp">	&quot;ldr&quot; instr &quot;	%1, [%0, #0 ]	@ in&quot; #fnsuffix		\</span>
<span class="cp">	: &quot;=&amp;r&quot; (temp), &quot;=r&quot; (value)					\</span>
<span class="cp">	: &quot;r&quot; (port), &quot;Ir&quot; (PCIO_BASE_##fnsuffix)	\</span>
<span class="cp">	: &quot;cc&quot;);							\</span>
<span class="cp">	return (unsigned sz)value;					\</span>
<span class="cp">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">__ioaddr</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__PORT_PCIO</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="n">PCIO_BASE</span> <span class="o">+</span> <span class="n">port</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">)</span><span class="n">port</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define DECLARE_IO(sz,fnsuffix,instr)	\</span>
<span class="cp">	DECLARE_DYN_IN(sz,fnsuffix,instr) \</span>
<span class="cp">	DECLARE_DYN_OUT(sz,fnsuffix,instr)</span>

<span class="n">DECLARE_IO</span><span class="p">(</span><span class="kt">char</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="s">&quot;b&quot;</span><span class="p">)</span>
<span class="n">DECLARE_IO</span><span class="p">(</span><span class="kt">short</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="s">&quot;h&quot;</span><span class="p">)</span>
<span class="n">DECLARE_IO</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span>

<span class="cp">#undef DECLARE_IO</span>
<span class="cp">#undef DECLARE_DYN_IN</span>

<span class="cm">/*</span>
<span class="cm"> * Constant address IO functions</span>
<span class="cm"> *</span>
<span class="cm"> * These have to be macros for the &#39;J&#39; constraint to work -</span>
<span class="cm"> * +/-4096 immediate operand.</span>
<span class="cm"> */</span>
<span class="cp">#define __outbc(value,port)						\</span>
<span class="cp">({									\</span>
<span class="cp">	if (__PORT_PCIO((port)))					\</span>
<span class="cp">		__asm__ __volatile__(					\</span>
<span class="cp">		&quot;strb	%0, [%1, %2]	@ outbc&quot;			\</span>
<span class="cp">		: : &quot;r&quot; (value), &quot;r&quot; (PCIO_BASE), &quot;Jr&quot; ((port)));	\</span>
<span class="cp">	else								\</span>
<span class="cp">		__asm__ __volatile__(					\</span>
<span class="cp">		&quot;strb	%0, [%1, #0]	@ outbc&quot;			\</span>
<span class="cp">		: : &quot;r&quot; (value), &quot;r&quot; ((port)));				\</span>
<span class="cp">})</span>

<span class="cp">#define __inbc(port)							\</span>
<span class="cp">({									\</span>
<span class="cp">	unsigned char result;						\</span>
<span class="cp">	if (__PORT_PCIO((port)))					\</span>
<span class="cp">		__asm__ __volatile__(					\</span>
<span class="cp">		&quot;ldrb	%0, [%1, %2]	@ inbc&quot;				\</span>
<span class="cp">		: &quot;=r&quot; (result) : &quot;r&quot; (PCIO_BASE), &quot;Jr&quot; ((port)));	\</span>
<span class="cp">	else								\</span>
<span class="cp">		__asm__ __volatile__(					\</span>
<span class="cp">		&quot;ldrb	%0, [%1, #0]	@ inbc&quot;				\</span>
<span class="cp">		: &quot;=r&quot; (result) : &quot;r&quot; ((port)));			\</span>
<span class="cp">	result;								\</span>
<span class="cp">})</span>

<span class="cp">#define __outwc(value,port)						\</span>
<span class="cp">({									\</span>
<span class="cp">	unsigned long v = value;					\</span>
<span class="cp">	if (__PORT_PCIO((port))) {					\</span>
<span class="cp">		if ((port) &lt; 256 &amp;&amp; (port) &gt; -256)			\</span>
<span class="cp">			__asm__ __volatile__(				\</span>
<span class="cp">			&quot;strh	%0, [%1, %2]	@ outwc&quot;		\</span>
<span class="cp">			: : &quot;r&quot; (v), &quot;r&quot; (PCIO_BASE), &quot;Jr&quot; ((port)));	\</span>
<span class="cp">		else if ((port) &gt; 0)					\</span>
<span class="cp">			__asm__ __volatile__(				\</span>
<span class="cp">			&quot;strh	%0, [%1, %2]	@ outwc&quot;		\</span>
<span class="cp">			: : &quot;r&quot; (v),					\</span>
<span class="cp">			    &quot;r&quot; (PCIO_BASE + ((port) &amp; ~0xff)),		\</span>
<span class="cp">			     &quot;Jr&quot; (((port) &amp; 0xff)));			\</span>
<span class="cp">		else							\</span>
<span class="cp">			__asm__ __volatile__(				\</span>
<span class="cp">			&quot;strh	%0, [%1, #0]	@ outwc&quot;		\</span>
<span class="cp">			: : &quot;r&quot; (v),					\</span>
<span class="cp">			    &quot;r&quot; (PCIO_BASE + (port)));			\</span>
<span class="cp">	} else								\</span>
<span class="cp">		__asm__ __volatile__(					\</span>
<span class="cp">		&quot;strh	%0, [%1, #0]	@ outwc&quot;			\</span>
<span class="cp">		: : &quot;r&quot; (v), &quot;r&quot; ((port)));				\</span>
<span class="cp">})</span>

<span class="cp">#define __inwc(port)							\</span>
<span class="cp">({									\</span>
<span class="cp">	unsigned short result;						\</span>
<span class="cp">	if (__PORT_PCIO((port))) {					\</span>
<span class="cp">		if ((port) &lt; 256 &amp;&amp; (port) &gt; -256 )			\</span>
<span class="cp">			__asm__ __volatile__(				\</span>
<span class="cp">			&quot;ldrh	%0, [%1, %2]	@ inwc&quot;			\</span>
<span class="cp">			: &quot;=r&quot; (result)					\</span>
<span class="cp">			: &quot;r&quot; (PCIO_BASE),				\</span>
<span class="cp">			  &quot;Jr&quot; ((port)));				\</span>
<span class="cp">		else if ((port) &gt; 0)					\</span>
<span class="cp">			__asm__ __volatile__(				\</span>
<span class="cp">			&quot;ldrh	%0, [%1, %2]	@ inwc&quot;			\</span>
<span class="cp">			: &quot;=r&quot; (result)					\</span>
<span class="cp">			: &quot;r&quot; (PCIO_BASE + ((port) &amp; ~0xff)),		\</span>
<span class="cp">			  &quot;Jr&quot; (((port) &amp; 0xff)));			\</span>
<span class="cp">		else							\</span>
<span class="cp">			__asm__ __volatile__(				\</span>
<span class="cp">			&quot;ldrh	%0, [%1, #0]	@ inwc&quot;			\</span>
<span class="cp">			: &quot;=r&quot; (result)					\</span>
<span class="cp">			: &quot;r&quot; (PCIO_BASE + ((port))));			\</span>
<span class="cp">	} else								\</span>
<span class="cp">		__asm__ __volatile__(					\</span>
<span class="cp">		&quot;ldrh	%0, [%1, #0]	@ inwc&quot;				\</span>
<span class="cp">		: &quot;=r&quot; (result) : &quot;r&quot; ((port)));			\</span>
<span class="cp">	result;								\</span>
<span class="cp">})</span>

<span class="cp">#define __outlc(value,port)						\</span>
<span class="cp">({									\</span>
<span class="cp">	unsigned long v = value;					\</span>
<span class="cp">	if (__PORT_PCIO((port)))					\</span>
<span class="cp">		__asm__ __volatile__(					\</span>
<span class="cp">		&quot;str	%0, [%1, %2]	@ outlc&quot;			\</span>
<span class="cp">		: : &quot;r&quot; (v), &quot;r&quot; (PCIO_BASE), &quot;Jr&quot; ((port)));	\</span>
<span class="cp">	else								\</span>
<span class="cp">		__asm__ __volatile__(					\</span>
<span class="cp">		&quot;str	%0, [%1, #0]	@ outlc&quot;			\</span>
<span class="cp">		: : &quot;r&quot; (v), &quot;r&quot; ((port)));		\</span>
<span class="cp">})</span>

<span class="cp">#define __inlc(port)							\</span>
<span class="cp">({									\</span>
<span class="cp">	unsigned long result;						\</span>
<span class="cp">	if (__PORT_PCIO((port)))					\</span>
<span class="cp">		__asm__ __volatile__(					\</span>
<span class="cp">		&quot;ldr	%0, [%1, %2]	@ inlc&quot;				\</span>
<span class="cp">		: &quot;=r&quot; (result) : &quot;r&quot; (PCIO_BASE), &quot;Jr&quot; ((port)));	\</span>
<span class="cp">	else								\</span>
<span class="cp">		__asm__ __volatile__(					\</span>
<span class="cp">		&quot;ldr	%0, [%1, #0]	@ inlc&quot;				\</span>
<span class="cp">		: &quot;=r&quot; (result) : &quot;r&quot; ((port)));		\</span>
<span class="cp">	result;								\</span>
<span class="cp">})</span>

<span class="cp">#define __ioaddrc(port)	((__PORT_PCIO(port) ? PCIO_BASE + (port) : (void __iomem *)(port)))</span>

<span class="cp">#define inb(p)		(__builtin_constant_p((p)) ? __inbc(p)	   : __inb(p))</span>
<span class="cp">#define inw(p)		(__builtin_constant_p((p)) ? __inwc(p)	   : __inw(p))</span>
<span class="cp">#define inl(p)		(__builtin_constant_p((p)) ? __inlc(p)	   : __inl(p))</span>
<span class="cp">#define outb(v,p)	(__builtin_constant_p((p)) ? __outbc(v,p) : __outb(v,p))</span>
<span class="cp">#define outw(v,p)	(__builtin_constant_p((p)) ? __outwc(v,p) : __outw(v,p))</span>
<span class="cp">#define outl(v,p)	(__builtin_constant_p((p)) ? __outlc(v,p) : __outl(v,p))</span>
<span class="cp">#define __ioaddr(p)	(__builtin_constant_p((p)) ? __ioaddr(p)  : __ioaddrc(p))</span>

<span class="cp">#define insb(p,d,l)	__raw_readsb(__ioaddr(p),d,l)</span>
<span class="cp">#define insw(p,d,l)	__raw_readsw(__ioaddr(p),d,l)</span>
<span class="cp">#define insl(p,d,l)	__raw_readsl(__ioaddr(p),d,l)</span>

<span class="cp">#define outsb(p,d,l)	__raw_writesb(__ioaddr(p),d,l)</span>
<span class="cp">#define outsw(p,d,l)	__raw_writesw(__ioaddr(p),d,l)</span>
<span class="cp">#define outsl(p,d,l)	__raw_writesl(__ioaddr(p),d,l)</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
