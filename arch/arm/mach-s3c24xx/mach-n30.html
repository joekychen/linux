<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-s3c24xx › mach-n30.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>mach-n30.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* Machine specific code for the Acer n30, Acer N35, Navman PiN 570,</span>
<span class="cm"> * Yakumo AlphaX and Airis NC05 PDAs.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2003-2005 Simtec Electronics</span>
<span class="cm"> *	Ben Dooks &lt;ben@simtec.co.uk&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2005-2008 Christer Weinigel &lt;christer@weinigel.se&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * There is a wiki with more information about the n30 port at</span>
<span class="cm"> * http://handhelds.org/moin/moin.cgi/AcerN30Documentation .</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#include &lt;linux/gpio_keys.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/gpio.h&gt;</span>
<span class="cp">#include &lt;linux/input.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/serial_core.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/host.h&gt;</span>

<span class="cp">#include &lt;mach/hardware.h&gt;</span>
<span class="cp">#include &lt;asm/irq.h&gt;</span>
<span class="cp">#include &lt;asm/mach-types.h&gt;</span>

<span class="cp">#include &lt;mach/fb.h&gt;</span>
<span class="cp">#include &lt;mach/leds-gpio.h&gt;</span>
<span class="cp">#include &lt;mach/regs-gpio.h&gt;</span>
<span class="cp">#include &lt;mach/regs-lcd.h&gt;</span>

<span class="cp">#include &lt;asm/mach/arch.h&gt;</span>
<span class="cp">#include &lt;asm/mach/irq.h&gt;</span>
<span class="cp">#include &lt;asm/mach/map.h&gt;</span>

<span class="cp">#include &lt;plat/iic.h&gt;</span>
<span class="cp">#include &lt;plat/regs-serial.h&gt;</span>

<span class="cp">#include &lt;plat/clock.h&gt;</span>
<span class="cp">#include &lt;plat/cpu.h&gt;</span>
<span class="cp">#include &lt;plat/devs.h&gt;</span>
<span class="cp">#include &lt;plat/mci.h&gt;</span>
<span class="cp">#include &lt;plat/s3c2410.h&gt;</span>
<span class="cp">#include &lt;plat/udc.h&gt;</span>

<span class="cp">#include &quot;common.h&quot;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">n30_iodesc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* nothing here yet */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s3c2410_uartcfg</span> <span class="n">n30_uartcfgs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Normal serial port */</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">hwport</span>	     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ucon</span>	     <span class="o">=</span> <span class="mh">0x2c5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ulcon</span>	     <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ufcon</span>	     <span class="o">=</span> <span class="mh">0x51</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* IR port */</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">hwport</span>	     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">uart_flags</span>  <span class="o">=</span> <span class="n">UPF_CONS_FLOW</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ucon</span>	     <span class="o">=</span> <span class="mh">0x2c5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ulcon</span>	     <span class="o">=</span> <span class="mh">0x43</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ufcon</span>	     <span class="o">=</span> <span class="mh">0x51</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* On the N30 the bluetooth controller is connected here.</span>
<span class="cm">	 * On the N35 and variants the GPS receiver is connected here. */</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">hwport</span>	     <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ucon</span>	     <span class="o">=</span> <span class="mh">0x2c5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ulcon</span>	     <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ufcon</span>	     <span class="o">=</span> <span class="mh">0x51</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s3c2410_udc_mach_info</span> <span class="n">n30_udc_cfg</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">vbus_pin</span>		<span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
	<span class="p">.</span><span class="n">vbus_pin_inverted</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pullup_pin</span>		<span class="o">=</span> <span class="n">S3C2410_GPB</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_keys_button</span> <span class="n">n30_buttons</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_POWER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Power&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_UP</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Thumbwheel Up&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_DOWN</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Thumbwheel Down&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_ENTER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Thumbwheel Press&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_HOMEPAGE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Home&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_CALENDAR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Calendar&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_ADDRESSBOOK</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Contacts&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_MAIL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Mail&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_keys_platform_data</span> <span class="n">n30_button_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">buttons</span>	<span class="o">=</span> <span class="n">n30_buttons</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nbuttons</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">n30_buttons</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">n30_button_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;gpio-keys&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">n30_button_data</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_keys_button</span> <span class="n">n35_buttons</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_POWER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">EV_PWR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Power&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wakeup</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_UP</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Joystick Up&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_DOWN</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Joystick Down&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_DOWN</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Joystick Left&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_DOWN</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Joystick Right&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_ENTER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Joystick Press&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_HOMEPAGE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Home&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_CALENDAR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Calendar&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_ADDRESSBOOK</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Contacts&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">KEY_MAIL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Mail&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">SW_RADIO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;GPS Antenna&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
		<span class="p">.</span><span class="n">code</span>		<span class="o">=</span> <span class="n">SW_HEADPHONE_INSERT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>		<span class="o">=</span> <span class="s">&quot;Headphone&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_keys_platform_data</span> <span class="n">n35_button_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">buttons</span>	<span class="o">=</span> <span class="n">n35_buttons</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nbuttons</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">n35_buttons</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">n35_button_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;gpio-keys&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">n35_button_data</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* This is the bluetooth LED on the device. */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">s3c24xx_led_platdata</span> <span class="n">n30_blue_led_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;blue_led&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
	<span class="p">.</span><span class="n">def_trigger</span>	<span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* This is the blue LED on the device. Originally used to indicate GPS activity</span>
<span class="cm"> * by flashing. */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">s3c24xx_led_platdata</span> <span class="n">n35_blue_led_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;blue_led&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPD</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
	<span class="p">.</span><span class="n">def_trigger</span>	<span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* This LED is driven by the battery microcontroller, and is blinking</span>
<span class="cm"> * red, blinking green or solid green when the battery is low,</span>
<span class="cm"> * charging or full respectively.  By driving GPD9 low, it&#39;s possible</span>
<span class="cm"> * to force the LED to blink red, so call that warning LED.  */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">s3c24xx_led_platdata</span> <span class="n">n30_warning_led_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;warning_led&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>          <span class="o">=</span> <span class="n">S3C24XX_LEDF_ACTLOW</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPD</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
	<span class="p">.</span><span class="n">def_trigger</span>	<span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s3c24xx_led_platdata</span> <span class="n">n35_warning_led_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;warning_led&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>          <span class="o">=</span> <span class="n">S3C24XX_LEDF_ACTLOW</span> <span class="o">|</span> <span class="n">S3C24XX_LEDF_TRISTATE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">S3C2410_GPD</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
	<span class="p">.</span><span class="n">def_trigger</span>	<span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">n30_blue_led</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;s3c24xx_led&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">n30_blue_led_pdata</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">n35_blue_led</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;s3c24xx_led&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">n35_blue_led_pdata</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">n30_warning_led</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;s3c24xx_led&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">n30_warning_led_pdata</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">n35_warning_led</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;s3c24xx_led&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">n35_warning_led_pdata</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s3c2410fb_display</span> <span class="n">n30_display</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">S3C2410_LCDCON1_TFT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">width</span>		<span class="o">=</span> <span class="mi">240</span><span class="p">,</span>
	<span class="p">.</span><span class="n">height</span>		<span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pixclock</span>	<span class="o">=</span> <span class="mi">170000</span><span class="p">,</span>

	<span class="p">.</span><span class="n">xres</span>		<span class="o">=</span> <span class="mi">240</span><span class="p">,</span>
	<span class="p">.</span><span class="n">yres</span>		<span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bpp</span>		<span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">left_margin</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">right_margin</span>	<span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hsync_len</span>	<span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
	<span class="p">.</span><span class="n">upper_margin</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">lower_margin</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vsync_len</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>

	<span class="p">.</span><span class="n">lcdcon5</span> <span class="o">=</span> <span class="n">S3C2410_LCDCON5_INVVLINE</span> <span class="o">|</span> <span class="n">S3C2410_LCDCON5_INVVFRAME</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s3c2410fb_mach_info</span> <span class="n">n30_fb_info</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">displays</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">n30_display</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_displays</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">default_display</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">lpcsel</span>		<span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">n30_sdi_set_power</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">power_mode</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">vdd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">power_mode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">MMC_POWER_ON</span>:
	<span class="k">case</span> <span class="n">MMC_POWER_UP</span>:
		<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MMC_POWER_OFF</span>:
	<span class="nl">default:</span>
		<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s3c24xx_mci_pdata</span> <span class="n">n30_mci_cfg</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">gpio_detect</span>	<span class="o">=</span> <span class="n">S3C2410_GPF</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
	<span class="p">.</span><span class="n">gpio_wprotect</span>  <span class="o">=</span> <span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
	<span class="p">.</span><span class="n">ocr_avail</span>	<span class="o">=</span> <span class="n">MMC_VDD_32_33</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_power</span>	<span class="o">=</span> <span class="n">n30_sdi_set_power</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">n30_devices</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">s3c_device_lcd</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_wdt</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_i2c0</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_iis</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_ohci</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_rtc</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_usbgadget</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_sdi</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">n30_button_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">n30_blue_led</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">n30_warning_led</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">n35_devices</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">s3c_device_lcd</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_wdt</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_i2c0</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_iis</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_rtc</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_usbgadget</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">s3c_device_sdi</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">n35_button_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">n35_blue_led</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">n35_warning_led</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s3c2410_platform_i2c</span> <span class="n">__initdata</span> <span class="n">n30_i2ccfg</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">slave_addr</span>	<span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="p">.</span><span class="n">frequency</span>	<span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Lots of hardcoded stuff, but it sets up the hardware in a useful</span>
<span class="cm"> * state so that we can boot Linux directly from flash. */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">n30_hwinit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* GPA0-11 special functions -- unknown what they do</span>
<span class="cm">	 * GPA12 N30 special function -- unknown what it does</span>
<span class="cm">	 *       N35/PiN output -- unknown what it does</span>
<span class="cm">	 *</span>
<span class="cm">	 * A12 is nGCS1 on the N30 and an output on the N35/PiN.  I</span>
<span class="cm">	 * don&#39;t think it does anything useful on the N30, so I ought</span>
<span class="cm">	 * to make it an output there too since it always driven to 0</span>
<span class="cm">	 * as far as I can tell. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">machine_is_n30</span><span class="p">())</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x007fffff</span><span class="p">,</span> <span class="n">S3C2410_GPACON</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">machine_is_n35</span><span class="p">())</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x007fefff</span><span class="p">,</span> <span class="n">S3C2410_GPACON</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x00000000</span><span class="p">,</span> <span class="n">S3C2410_GPADAT</span><span class="p">);</span>

	<span class="cm">/* GPB0 TOUT0 backlight level</span>
<span class="cm">	 * GPB1 output 1=backlight on</span>
<span class="cm">	 * GPB2 output IrDA enable 0=transceiver enabled, 1=disabled</span>
<span class="cm">	 * GPB3 output USB D+ pull up 0=disabled, 1=enabled</span>
<span class="cm">	 * GPB4 N30 output -- unknown function</span>
<span class="cm">	 *      N30/PiN GPS control 0=GPS enabled, 1=GPS disabled</span>
<span class="cm">	 * GPB5 output -- unknown function</span>
<span class="cm">	 * GPB6 input -- unknown function</span>
<span class="cm">	 * GPB7 output -- unknown function</span>
<span class="cm">	 * GPB8 output -- probably LCD driver enable</span>
<span class="cm">	 * GPB9 output -- probably LCD VSYNC driver enable</span>
<span class="cm">	 * GPB10 output -- probably LCD HSYNC driver enable</span>
<span class="cm">	 */</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x00154556</span><span class="p">,</span> <span class="n">S3C2410_GPBCON</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x00000750</span><span class="p">,</span> <span class="n">S3C2410_GPBDAT</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x00000073</span><span class="p">,</span> <span class="n">S3C2410_GPBUP</span><span class="p">);</span>

	<span class="cm">/* GPC0 input RS232 DCD/DSR/RI</span>
<span class="cm">	 * GPC1 LCD</span>
<span class="cm">	 * GPC2 output RS232 DTR?</span>
<span class="cm">	 * GPC3 input RS232 DCD/DSR/RI</span>
<span class="cm">	 * GPC4 LCD</span>
<span class="cm">	 * GPC5 output 0=NAND write enabled, 1=NAND write protect</span>
<span class="cm">	 * GPC6 input -- unknown function</span>
<span class="cm">	 * GPC7 input charger status 0=charger connected</span>
<span class="cm">	 *      this input can be triggered by power on the USB device</span>
<span class="cm">	 *      port too, but will go back to disconnected soon after.</span>
<span class="cm">	 * GPC8 N30/N35 output -- unknown function, always driven to 1</span>
<span class="cm">	 *      PiN input -- unknown function, always read as 1</span>
<span class="cm">	 *      Make it an input with a pull up for all models.</span>
<span class="cm">	 * GPC9-15 LCD</span>
<span class="cm">	 */</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0xaaa80618</span><span class="p">,</span> <span class="n">S3C2410_GPCCON</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0000014c</span><span class="p">,</span> <span class="n">S3C2410_GPCDAT</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0000fef2</span><span class="p">,</span> <span class="n">S3C2410_GPCUP</span><span class="p">);</span>

	<span class="cm">/* GPD0 input -- unknown function</span>
<span class="cm">	 * GPD1-D7 LCD</span>
<span class="cm">	 * GPD8 N30 output -- unknown function</span>
<span class="cm">	 *      N35/PiN output 1=GPS LED on</span>
<span class="cm">	 * GPD9 output 0=power led blinks red, 1=normal power led function</span>
<span class="cm">	 * GPD10 output -- unknown function</span>
<span class="cm">	 * GPD11-15 LCD drivers</span>
<span class="cm">	 */</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0xaa95aaa4</span><span class="p">,</span> <span class="n">S3C2410_GPDCON</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x00000601</span><span class="p">,</span> <span class="n">S3C2410_GPDDAT</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0000fbfe</span><span class="p">,</span> <span class="n">S3C2410_GPDUP</span><span class="p">);</span>

	<span class="cm">/* GPE0-4 I2S audio bus</span>
<span class="cm">	 * GPE5-10 SD/MMC bus</span>
<span class="cm">	 * E11-13 outputs -- unknown function, probably power management</span>
<span class="cm">	 * E14-15 I2C bus connected to the battery controller</span>
<span class="cm">	 */</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0xa56aaaaa</span><span class="p">,</span> <span class="n">S3C2410_GPECON</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0000efc5</span><span class="p">,</span> <span class="n">S3C2410_GPEDAT</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0000f81f</span><span class="p">,</span> <span class="n">S3C2410_GPEUP</span><span class="p">);</span>

	<span class="cm">/* GPF0  input 0=power button pressed</span>
<span class="cm">	 * GPF1  input SD/MMC switch 0=card present</span>
<span class="cm">	 * GPF2  N30 1=reset button pressed (inverted compared to the rest)</span>
<span class="cm">	 *	 N35/PiN 0=reset button pressed</span>
<span class="cm">	 * GPF3  N30/PiN input -- unknown function</span>
<span class="cm">	 *       N35 input GPS antenna position, 0=antenna closed, 1=open</span>
<span class="cm">	 * GPF4  input 0=button 4 pressed</span>
<span class="cm">	 * GPF5  input 0=button 3 pressed</span>
<span class="cm">	 * GPF6  input 0=button 2 pressed</span>
<span class="cm">	 * GPF7  input 0=button 1 pressed</span>
<span class="cm">	 */</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0000aaaa</span><span class="p">,</span> <span class="n">S3C2410_GPFCON</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x00000000</span><span class="p">,</span> <span class="n">S3C2410_GPFDAT</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x000000ff</span><span class="p">,</span> <span class="n">S3C2410_GPFUP</span><span class="p">);</span>

	<span class="cm">/* GPG0  input RS232 DCD/DSR/RI</span>
<span class="cm">	 * GPG1  input 1=USB gadget port has power from a host</span>
<span class="cm">	 * GPG2  N30 input -- unknown function</span>
<span class="cm">	 *       N35/PiN input 0=headphones plugged in, 1=not plugged in</span>
<span class="cm">	 * GPG3  N30 output -- unknown function</span>
<span class="cm">	 *       N35/PiN input with unknown function</span>
<span class="cm">	 * GPG4  N30 output 0=MMC enabled, 1=MMC disabled</span>
<span class="cm">	 * GPG5  N30 output 0=BlueTooth chip disabled, 1=enabled</span>
<span class="cm">	 *       N35/PiN input joystick right</span>
<span class="cm">	 * GPG6  N30 output 0=blue led on, 1=off</span>
<span class="cm">	 *       N35/PiN input joystick left</span>
<span class="cm">	 * GPG7  input 0=thumbwheel pressed</span>
<span class="cm">	 * GPG8  input 0=thumbwheel down</span>
<span class="cm">	 * GPG9  input 0=thumbwheel up</span>
<span class="cm">	 * GPG10 input SD/MMC write protect switch</span>
<span class="cm">	 * GPG11 N30 input -- unknown function</span>
<span class="cm">	 *       N35 output 0=GPS antenna powered, 1=not powered</span>
<span class="cm">	 *       PiN output -- unknown function</span>
<span class="cm">	 * GPG12-15 touch screen functions</span>
<span class="cm">	 *</span>
<span class="cm">	 * The pullups differ between the models, so enable all</span>
<span class="cm">	 * pullups that are enabled on any of the models.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">machine_is_n30</span><span class="p">())</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0xff0a956a</span><span class="p">,</span> <span class="n">S3C2410_GPGCON</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">machine_is_n35</span><span class="p">())</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0xff4aa92a</span><span class="p">,</span> <span class="n">S3C2410_GPGCON</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0000e800</span><span class="p">,</span> <span class="n">S3C2410_GPGDAT</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0000f86f</span><span class="p">,</span> <span class="n">S3C2410_GPGUP</span><span class="p">);</span>

	<span class="cm">/* GPH0/1/2/3 RS232 serial port</span>
<span class="cm">	 * GPH4/5 IrDA serial port</span>
<span class="cm">	 * GPH6/7  N30 BlueTooth serial port</span>
<span class="cm">	 *         N35/PiN GPS receiver</span>
<span class="cm">	 * GPH8 input -- unknown function</span>
<span class="cm">	 * GPH9 CLKOUT0 HCLK -- unknown use</span>
<span class="cm">	 * GPH10 CLKOUT1 FCLK -- unknown use</span>
<span class="cm">	 *</span>
<span class="cm">	 * The pull ups for H6/H7 are enabled on N30 but not on the</span>
<span class="cm">	 * N35/PiN.  I suppose is useful for a budget model of the N30</span>
<span class="cm">	 * with no bluetooh.  It doesn&#39;t hurt to have the pull ups</span>
<span class="cm">	 * enabled on the N35, so leave them enabled for all models.</span>
<span class="cm">	 */</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0028aaaa</span><span class="p">,</span> <span class="n">S3C2410_GPHCON</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x000005ef</span><span class="p">,</span> <span class="n">S3C2410_GPHDAT</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0000063f</span><span class="p">,</span> <span class="n">S3C2410_GPHUP</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">n30_map_io</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s3c24xx_init_io</span><span class="p">(</span><span class="n">n30_iodesc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">n30_iodesc</span><span class="p">));</span>
	<span class="n">n30_hwinit</span><span class="p">();</span>
	<span class="n">s3c24xx_init_clocks</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">s3c24xx_init_uarts</span><span class="p">(</span><span class="n">n30_uartcfgs</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">n30_uartcfgs</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/* GPB3 is the line that controls the pull-up for the USB D+ line */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">n30_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">WARN_ON</span><span class="p">(</span><span class="n">gpio_request</span><span class="p">(</span><span class="n">S3C2410_GPG</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="s">&quot;mmc power&quot;</span><span class="p">));</span>

	<span class="n">s3c24xx_fb_set_platdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n30_fb_info</span><span class="p">);</span>
	<span class="n">s3c24xx_udc_set_platdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n30_udc_cfg</span><span class="p">);</span>
	<span class="n">s3c24xx_mci_set_platdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n30_mci_cfg</span><span class="p">);</span>
	<span class="n">s3c_i2c0_set_platdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n30_i2ccfg</span><span class="p">);</span>

	<span class="cm">/* Turn off suspend on both USB ports, and switch the</span>
<span class="cm">	 * selectable USB port to USB device mode. */</span>

	<span class="n">s3c2410_modify_misccr</span><span class="p">(</span><span class="n">S3C2410_MISCCR_USBHOST</span> <span class="o">|</span>
			      <span class="n">S3C2410_MISCCR_USBSUSPND0</span> <span class="o">|</span>
			      <span class="n">S3C2410_MISCCR_USBSUSPND1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">machine_is_n30</span><span class="p">())</span> <span class="p">{</span>
		<span class="cm">/* Turn off suspend on both USB ports, and switch the</span>
<span class="cm">		 * selectable USB port to USB device mode. */</span>
		<span class="n">s3c2410_modify_misccr</span><span class="p">(</span><span class="n">S3C2410_MISCCR_USBHOST</span> <span class="o">|</span>
				      <span class="n">S3C2410_MISCCR_USBSUSPND0</span> <span class="o">|</span>
				      <span class="n">S3C2410_MISCCR_USBSUSPND1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>

		<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">n30_devices</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">n30_devices</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">machine_is_n35</span><span class="p">())</span> <span class="p">{</span>
		<span class="cm">/* Turn off suspend and switch the selectable USB port</span>
<span class="cm">		 * to USB device mode.  Turn on suspend for the host</span>
<span class="cm">		 * port since it is not connected on the N35.</span>
<span class="cm">		 *</span>
<span class="cm">		 * Actually, the host port is available at some pads</span>
<span class="cm">		 * on the back of the device, so it would actually be</span>
<span class="cm">		 * possible to add a USB device inside the N35 if you</span>
<span class="cm">		 * are willing to do some hardware modifications. */</span>
		<span class="n">s3c2410_modify_misccr</span><span class="p">(</span><span class="n">S3C2410_MISCCR_USBHOST</span> <span class="o">|</span>
				      <span class="n">S3C2410_MISCCR_USBSUSPND0</span> <span class="o">|</span>
				      <span class="n">S3C2410_MISCCR_USBSUSPND1</span><span class="p">,</span>
				      <span class="n">S3C2410_MISCCR_USBSUSPND0</span><span class="p">);</span>

		<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">n35_devices</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">n35_devices</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="n">MACHINE_START</span><span class="p">(</span><span class="n">N30</span><span class="p">,</span> <span class="s">&quot;Acer-N30&quot;</span><span class="p">)</span>
	<span class="cm">/* Maintainer: Christer Weinigel &lt;christer@weinigel.se&gt;,</span>
<span class="cm">				Ben Dooks &lt;ben-linux@fluff.org&gt;</span>
<span class="cm">	*/</span>
	<span class="p">.</span><span class="n">atag_offset</span>	<span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>
	<span class="p">.</span><span class="n">timer</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">s3c24xx_timer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span>	<span class="o">=</span> <span class="n">n30_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>	<span class="o">=</span> <span class="n">s3c24xx_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">n30_map_io</span><span class="p">,</span>
	<span class="p">.</span><span class="n">restart</span>	<span class="o">=</span> <span class="n">s3c2410_restart</span><span class="p">,</span>
<span class="n">MACHINE_END</span>

<span class="n">MACHINE_START</span><span class="p">(</span><span class="n">N35</span><span class="p">,</span> <span class="s">&quot;Acer-N35&quot;</span><span class="p">)</span>
	<span class="cm">/* Maintainer: Christer Weinigel &lt;christer@weinigel.se&gt;</span>
<span class="cm">	*/</span>
	<span class="p">.</span><span class="n">atag_offset</span>	<span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>
	<span class="p">.</span><span class="n">timer</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">s3c24xx_timer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span>	<span class="o">=</span> <span class="n">n30_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>	<span class="o">=</span> <span class="n">s3c24xx_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">n30_map_io</span><span class="p">,</span>
	<span class="p">.</span><span class="n">restart</span>	<span class="o">=</span> <span class="n">s3c2410_restart</span><span class="p">,</span>
<span class="n">MACHINE_END</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
