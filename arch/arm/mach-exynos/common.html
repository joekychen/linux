<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-exynos › common.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>common.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2010-2011 Samsung Electronics Co., Ltd.</span>
<span class="cm"> *		http://www.samsung.com</span>
<span class="cm"> *</span>
<span class="cm"> * Common Codes for EXYNOS</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/irq.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/gpio.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/serial_core.h&gt;</span>
<span class="cp">#include &lt;linux/of.h&gt;</span>
<span class="cp">#include &lt;linux/of_irq.h&gt;</span>
<span class="cp">#include &lt;linux/export.h&gt;</span>
<span class="cp">#include &lt;linux/irqdomain.h&gt;</span>
<span class="cp">#include &lt;linux/of_address.h&gt;</span>

<span class="cp">#include &lt;asm/proc-fns.h&gt;</span>
<span class="cp">#include &lt;asm/exception.h&gt;</span>
<span class="cp">#include &lt;asm/hardware/cache-l2x0.h&gt;</span>
<span class="cp">#include &lt;asm/hardware/gic.h&gt;</span>
<span class="cp">#include &lt;asm/mach/map.h&gt;</span>
<span class="cp">#include &lt;asm/mach/irq.h&gt;</span>
<span class="cp">#include &lt;asm/cacheflush.h&gt;</span>

<span class="cp">#include &lt;mach/regs-irq.h&gt;</span>
<span class="cp">#include &lt;mach/regs-pmu.h&gt;</span>
<span class="cp">#include &lt;mach/regs-gpio.h&gt;</span>
<span class="cp">#include &lt;mach/pmu.h&gt;</span>

<span class="cp">#include &lt;plat/cpu.h&gt;</span>
<span class="cp">#include &lt;plat/clock.h&gt;</span>
<span class="cp">#include &lt;plat/devs.h&gt;</span>
<span class="cp">#include &lt;plat/pm.h&gt;</span>
<span class="cp">#include &lt;plat/sdhci.h&gt;</span>
<span class="cp">#include &lt;plat/gpio-cfg.h&gt;</span>
<span class="cp">#include &lt;plat/adc-core.h&gt;</span>
<span class="cp">#include &lt;plat/fb-core.h&gt;</span>
<span class="cp">#include &lt;plat/fimc-core.h&gt;</span>
<span class="cp">#include &lt;plat/iic-core.h&gt;</span>
<span class="cp">#include &lt;plat/tv-core.h&gt;</span>
<span class="cp">#include &lt;plat/regs-serial.h&gt;</span>

<span class="cp">#include &quot;common.h&quot;</span>
<span class="cp">#define L2_AUX_VAL 0x7C470001</span>
<span class="cp">#define L2_AUX_MASK 0xC200ffff</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">name_exynos4210</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;EXYNOS4210&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">name_exynos4212</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;EXYNOS4212&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">name_exynos4412</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;EXYNOS4412&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">name_exynos5250</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;EXYNOS5250&quot;</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">exynos4_map_io</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">exynos5_map_io</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">exynos4_init_clocks</span><span class="p">(</span><span class="kt">int</span> <span class="n">xtal</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">exynos5_init_clocks</span><span class="p">(</span><span class="kt">int</span> <span class="n">xtal</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">exynos_init_uarts</span><span class="p">(</span><span class="k">struct</span> <span class="n">s3c2410_uartcfg</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">no</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">exynos_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">cpu_table</span> <span class="n">cpu_ids</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">idcode</span>		<span class="o">=</span> <span class="n">EXYNOS4210_CPU_ID</span><span class="p">,</span>
		<span class="p">.</span><span class="n">idmask</span>		<span class="o">=</span> <span class="n">EXYNOS4_CPU_MASK</span><span class="p">,</span>
		<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">exynos4_map_io</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init_clocks</span>	<span class="o">=</span> <span class="n">exynos4_init_clocks</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init_uarts</span>	<span class="o">=</span> <span class="n">exynos_init_uarts</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="n">exynos_init</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="n">name_exynos4210</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">idcode</span>		<span class="o">=</span> <span class="n">EXYNOS4212_CPU_ID</span><span class="p">,</span>
		<span class="p">.</span><span class="n">idmask</span>		<span class="o">=</span> <span class="n">EXYNOS4_CPU_MASK</span><span class="p">,</span>
		<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">exynos4_map_io</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init_clocks</span>	<span class="o">=</span> <span class="n">exynos4_init_clocks</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init_uarts</span>	<span class="o">=</span> <span class="n">exynos_init_uarts</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="n">exynos_init</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="n">name_exynos4212</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">idcode</span>		<span class="o">=</span> <span class="n">EXYNOS4412_CPU_ID</span><span class="p">,</span>
		<span class="p">.</span><span class="n">idmask</span>		<span class="o">=</span> <span class="n">EXYNOS4_CPU_MASK</span><span class="p">,</span>
		<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">exynos4_map_io</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init_clocks</span>	<span class="o">=</span> <span class="n">exynos4_init_clocks</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init_uarts</span>	<span class="o">=</span> <span class="n">exynos_init_uarts</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="n">exynos_init</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="n">name_exynos4412</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">idcode</span>		<span class="o">=</span> <span class="n">EXYNOS5250_SOC_ID</span><span class="p">,</span>
		<span class="p">.</span><span class="n">idmask</span>		<span class="o">=</span> <span class="n">EXYNOS5_SOC_MASK</span><span class="p">,</span>
		<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">exynos5_map_io</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init_clocks</span>	<span class="o">=</span> <span class="n">exynos5_init_clocks</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init_uarts</span>	<span class="o">=</span> <span class="n">exynos_init_uarts</span><span class="p">,</span>
		<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="n">exynos_init</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="n">name_exynos5250</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Initial IO mappings */</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">exynos_iodesc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_CHIPID</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS_PA_CHIPID</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">exynos4_iodesc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S3C_VA_SYS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_SYSCON</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_64K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S3C_VA_TIMER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_TIMER</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_16K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S3C_VA_WATCHDOG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_WATCHDOG</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_SROMC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_SROMC</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_SYSTIMER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_SYSTIMER</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_PMU</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_PMU</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_64K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_COMBINER_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_COMBINER</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_GIC_CPU</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_GIC_CPU</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_64K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_GIC_DIST</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_GIC_DIST</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_64K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S3C_VA_UART</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_UART</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_512K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_CMU</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_CMU</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_128K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_COREPERI_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_COREPERI</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_8K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_L2CC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_L2CC</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_DMC0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_DMC0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_64K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_DMC1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_DMC1</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_64K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S3C_VA_USB_HSPHY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_HSPHY</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">exynos4_iodesc0</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_SYSRAM</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_SYSRAM0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">exynos4_iodesc1</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_SYSRAM</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS4_PA_SYSRAM1</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">exynos5_iodesc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S3C_VA_SYS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_SYSCON</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_64K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S3C_VA_TIMER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_TIMER</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_16K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S3C_VA_WATCHDOG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_WATCHDOG</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_SROMC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_SROMC</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_SYSTIMER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_SYSTIMER</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_SYSRAM</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_SYSRAM</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_CMU</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_CMU</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="mi">144</span> <span class="o">*</span> <span class="n">SZ_1K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_PMU</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_PMU</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_64K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_COMBINER_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_COMBINER</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S3C_VA_UART</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_UART</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_512K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_GIC_CPU</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_GIC_CPU</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_8K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">S5P_VA_GIC_DIST</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">EXYNOS5_PA_GIC_DIST</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_4K</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">exynos4_restart</span><span class="p">(</span><span class="kt">char</span> <span class="n">mode</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x1</span><span class="p">,</span> <span class="n">S5P_SWRESET</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">exynos5_restart</span><span class="p">(</span><span class="kt">char</span> <span class="n">mode</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x1</span><span class="p">,</span> <span class="n">EXYNOS_SWRESET</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">exynos_init_late</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">exynos_pm_late_initcall</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * exynos_map_io</span>
<span class="cm"> *</span>
<span class="cm"> * register the standard cpu IO areas</span>
<span class="cm"> */</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">exynos_init_io</span><span class="p">(</span><span class="k">struct</span> <span class="n">map_desc</span> <span class="o">*</span><span class="n">mach_desc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* initialize the io descriptors we need for initialization */</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">exynos_iodesc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">exynos_iodesc</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mach_desc</span><span class="p">)</span>
		<span class="n">iotable_init</span><span class="p">(</span><span class="n">mach_desc</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

	<span class="cm">/* detect cpu id and rev. */</span>
	<span class="n">s5p_init_cpu</span><span class="p">(</span><span class="n">S5P_VA_CHIPID</span><span class="p">);</span>

	<span class="n">s3c_init_cpu</span><span class="p">(</span><span class="n">samsung_cpu_id</span><span class="p">,</span> <span class="n">cpu_ids</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cpu_ids</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">exynos4_map_io</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">exynos4_iodesc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">exynos4_iodesc</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">soc_is_exynos4210</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">samsung_rev</span><span class="p">()</span> <span class="o">==</span> <span class="n">EXYNOS4210_REV_0</span><span class="p">)</span>
		<span class="n">iotable_init</span><span class="p">(</span><span class="n">exynos4_iodesc0</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">exynos4_iodesc0</span><span class="p">));</span>
	<span class="k">else</span>
		<span class="n">iotable_init</span><span class="p">(</span><span class="n">exynos4_iodesc1</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">exynos4_iodesc1</span><span class="p">));</span>

	<span class="cm">/* initialize device information early */</span>
	<span class="n">exynos4_default_sdhci0</span><span class="p">();</span>
	<span class="n">exynos4_default_sdhci1</span><span class="p">();</span>
	<span class="n">exynos4_default_sdhci2</span><span class="p">();</span>
	<span class="n">exynos4_default_sdhci3</span><span class="p">();</span>

	<span class="n">s3c_adc_setname</span><span class="p">(</span><span class="s">&quot;samsung-adc-v3&quot;</span><span class="p">);</span>

	<span class="n">s3c_fimc_setname</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;exynos4-fimc&quot;</span><span class="p">);</span>
	<span class="n">s3c_fimc_setname</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;exynos4-fimc&quot;</span><span class="p">);</span>
	<span class="n">s3c_fimc_setname</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;exynos4-fimc&quot;</span><span class="p">);</span>
	<span class="n">s3c_fimc_setname</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;exynos4-fimc&quot;</span><span class="p">);</span>

	<span class="n">s3c_sdhci_setname</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;exynos4-sdhci&quot;</span><span class="p">);</span>
	<span class="n">s3c_sdhci_setname</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;exynos4-sdhci&quot;</span><span class="p">);</span>
	<span class="n">s3c_sdhci_setname</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;exynos4-sdhci&quot;</span><span class="p">);</span>
	<span class="n">s3c_sdhci_setname</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;exynos4-sdhci&quot;</span><span class="p">);</span>

	<span class="cm">/* The I2C bus controllers are directly compatible with s3c2440 */</span>
	<span class="n">s3c_i2c0_setname</span><span class="p">(</span><span class="s">&quot;s3c2440-i2c&quot;</span><span class="p">);</span>
	<span class="n">s3c_i2c1_setname</span><span class="p">(</span><span class="s">&quot;s3c2440-i2c&quot;</span><span class="p">);</span>
	<span class="n">s3c_i2c2_setname</span><span class="p">(</span><span class="s">&quot;s3c2440-i2c&quot;</span><span class="p">);</span>

	<span class="n">s5p_fb_setname</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;exynos4-fb&quot;</span><span class="p">);</span>
	<span class="n">s5p_hdmi_setname</span><span class="p">(</span><span class="s">&quot;exynos4-hdmi&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">exynos5_map_io</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">exynos5_iodesc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">exynos5_iodesc</span><span class="p">));</span>

	<span class="n">s3c_device_i2c0</span><span class="p">.</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">start</span> <span class="o">=</span> <span class="n">EXYNOS5_PA_IIC</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">s3c_device_i2c0</span><span class="p">.</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">end</span>   <span class="o">=</span> <span class="n">EXYNOS5_PA_IIC</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">SZ_4K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">s3c_device_i2c0</span><span class="p">.</span><span class="n">resource</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">start</span> <span class="o">=</span> <span class="n">EXYNOS5_IRQ_IIC</span><span class="p">;</span>
	<span class="n">s3c_device_i2c0</span><span class="p">.</span><span class="n">resource</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">end</span>   <span class="o">=</span> <span class="n">EXYNOS5_IRQ_IIC</span><span class="p">;</span>

	<span class="n">s3c_sdhci_setname</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;exynos4-sdhci&quot;</span><span class="p">);</span>
	<span class="n">s3c_sdhci_setname</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;exynos4-sdhci&quot;</span><span class="p">);</span>
	<span class="n">s3c_sdhci_setname</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;exynos4-sdhci&quot;</span><span class="p">);</span>
	<span class="n">s3c_sdhci_setname</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;exynos4-sdhci&quot;</span><span class="p">);</span>

	<span class="cm">/* The I2C bus controllers are directly compatible with s3c2440 */</span>
	<span class="n">s3c_i2c0_setname</span><span class="p">(</span><span class="s">&quot;s3c2440-i2c&quot;</span><span class="p">);</span>
	<span class="n">s3c_i2c1_setname</span><span class="p">(</span><span class="s">&quot;s3c2440-i2c&quot;</span><span class="p">);</span>
	<span class="n">s3c_i2c2_setname</span><span class="p">(</span><span class="s">&quot;s3c2440-i2c&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">exynos4_init_clocks</span><span class="p">(</span><span class="kt">int</span> <span class="n">xtal</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;%s: initializing clocks</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>

	<span class="n">s3c24xx_register_baseclocks</span><span class="p">(</span><span class="n">xtal</span><span class="p">);</span>
	<span class="n">s5p_register_clocks</span><span class="p">(</span><span class="n">xtal</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">soc_is_exynos4210</span><span class="p">())</span>
		<span class="n">exynos4210_register_clocks</span><span class="p">();</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">soc_is_exynos4212</span><span class="p">()</span> <span class="o">||</span> <span class="n">soc_is_exynos4412</span><span class="p">())</span>
		<span class="n">exynos4212_register_clocks</span><span class="p">();</span>

	<span class="n">exynos4_register_clocks</span><span class="p">();</span>
	<span class="n">exynos4_setup_clocks</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">exynos5_init_clocks</span><span class="p">(</span><span class="kt">int</span> <span class="n">xtal</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;%s: initializing clocks</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>

	<span class="n">s3c24xx_register_baseclocks</span><span class="p">(</span><span class="n">xtal</span><span class="p">);</span>
	<span class="n">s5p_register_clocks</span><span class="p">(</span><span class="n">xtal</span><span class="p">);</span>

	<span class="n">exynos5_register_clocks</span><span class="p">();</span>
	<span class="n">exynos5_setup_clocks</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">#define COMBINER_ENABLE_SET	0x0</span>
<span class="cp">#define COMBINER_ENABLE_CLEAR	0x4</span>
<span class="cp">#define COMBINER_INT_STATUS	0xC</span>

<span class="k">static</span> <span class="n">DEFINE_SPINLOCK</span><span class="p">(</span><span class="n">irq_controller_lock</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">combiner_chip_data</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq_offset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq_mask</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">base</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">combiner_irq_domain</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">combiner_chip_data</span> <span class="n">combiner_data</span><span class="p">[</span><span class="n">MAX_COMBINER_NR</span><span class="p">];</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">combiner_base</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">combiner_chip_data</span> <span class="o">*</span><span class="n">combiner_data</span> <span class="o">=</span>
		<span class="n">irq_data_get_irq_chip_data</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">combiner_data</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">combiner_mask_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">hwirq</span> <span class="o">%</span> <span class="mi">32</span><span class="p">);</span>

	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">combiner_base</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">COMBINER_ENABLE_CLEAR</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">combiner_unmask_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">hwirq</span> <span class="o">%</span> <span class="mi">32</span><span class="p">);</span>

	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">combiner_base</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">COMBINER_ENABLE_SET</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">combiner_handle_cascade_irq</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">irq_desc</span> <span class="o">*</span><span class="n">desc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">combiner_chip_data</span> <span class="o">*</span><span class="n">chip_data</span> <span class="o">=</span> <span class="n">irq_get_handler_data</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">irq_chip</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">irq_get_chip</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cascade_irq</span><span class="p">,</span> <span class="n">combiner_irq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">chained_irq_enter</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>

	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">irq_controller_lock</span><span class="p">);</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">chip_data</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">+</span> <span class="n">COMBINER_INT_STATUS</span><span class="p">);</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">irq_controller_lock</span><span class="p">);</span>
	<span class="n">status</span> <span class="o">&amp;=</span> <span class="n">chip_data</span><span class="o">-&gt;</span><span class="n">irq_mask</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">combiner_irq</span> <span class="o">=</span> <span class="n">__ffs</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>

	<span class="n">cascade_irq</span> <span class="o">=</span> <span class="n">combiner_irq</span> <span class="o">+</span> <span class="p">(</span><span class="n">chip_data</span><span class="o">-&gt;</span><span class="n">irq_offset</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">31</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">cascade_irq</span> <span class="o">&gt;=</span> <span class="n">NR_IRQS</span><span class="p">))</span>
		<span class="n">do_bad_IRQ</span><span class="p">(</span><span class="n">cascade_irq</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">generic_handle_irq</span><span class="p">(</span><span class="n">cascade_irq</span><span class="p">);</span>

 <span class="nl">out:</span>
	<span class="n">chained_irq_exit</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">irq_chip</span> <span class="n">combiner_chip</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;COMBINER&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_mask</span>	<span class="o">=</span> <span class="n">combiner_mask_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_unmask</span>	<span class="o">=</span> <span class="n">combiner_unmask_irq</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">combiner_cascade_irq</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">combiner_nr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max_nr</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">soc_is_exynos5250</span><span class="p">())</span>
		<span class="n">max_nr</span> <span class="o">=</span> <span class="n">EXYNOS5_MAX_COMBINER_NR</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">max_nr</span> <span class="o">=</span> <span class="n">EXYNOS4_MAX_COMBINER_NR</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">combiner_nr</span> <span class="o">&gt;=</span> <span class="n">max_nr</span><span class="p">)</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq_set_handler_data</span><span class="p">(</span><span class="n">irq</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">combiner_data</span><span class="p">[</span><span class="n">combiner_nr</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="n">irq_set_chained_handler</span><span class="p">(</span><span class="n">irq</span><span class="p">,</span> <span class="n">combiner_handle_cascade_irq</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">combiner_init_one</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">combiner_nr</span><span class="p">,</span>
				     <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">base</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">combiner_data</span><span class="p">[</span><span class="n">combiner_nr</span><span class="p">].</span><span class="n">base</span> <span class="o">=</span> <span class="n">base</span><span class="p">;</span>
	<span class="n">combiner_data</span><span class="p">[</span><span class="n">combiner_nr</span><span class="p">].</span><span class="n">irq_offset</span> <span class="o">=</span> <span class="n">irq_find_mapping</span><span class="p">(</span>
		<span class="n">combiner_irq_domain</span><span class="p">,</span> <span class="n">combiner_nr</span> <span class="o">*</span> <span class="n">MAX_IRQ_IN_COMBINER</span><span class="p">);</span>
	<span class="n">combiner_data</span><span class="p">[</span><span class="n">combiner_nr</span><span class="p">].</span><span class="n">irq_mask</span> <span class="o">=</span> <span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">combiner_nr</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

	<span class="cm">/* Disable all interrupts */</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">combiner_data</span><span class="p">[</span><span class="n">combiner_nr</span><span class="p">].</span><span class="n">irq_mask</span><span class="p">,</span>
		     <span class="n">base</span> <span class="o">+</span> <span class="n">COMBINER_ENABLE_CLEAR</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_OF</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">combiner_irq_domain_xlate</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">device_node</span> <span class="o">*</span><span class="n">controller</span><span class="p">,</span>
				     <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">intspec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">intsize</span><span class="p">,</span>
				     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">out_hwirq</span><span class="p">,</span>
				     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">out_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">of_node</span> <span class="o">!=</span> <span class="n">controller</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">intsize</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="o">*</span><span class="n">out_hwirq</span> <span class="o">=</span> <span class="n">intspec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">MAX_IRQ_IN_COMBINER</span> <span class="o">+</span> <span class="n">intspec</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="o">*</span><span class="n">out_type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">combiner_irq_domain_xlate</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">device_node</span> <span class="o">*</span><span class="n">controller</span><span class="p">,</span>
				     <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">intspec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">intsize</span><span class="p">,</span>
				     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">out_hwirq</span><span class="p">,</span>
				     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">out_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">combiner_irq_domain_map</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_domain</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">,</span>
				   <span class="n">irq_hw_number_t</span> <span class="n">hw</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">irq_set_chip_and_handler</span><span class="p">(</span><span class="n">irq</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">combiner_chip</span><span class="p">,</span> <span class="n">handle_level_irq</span><span class="p">);</span>
	<span class="n">irq_set_chip_data</span><span class="p">(</span><span class="n">irq</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">combiner_data</span><span class="p">[</span><span class="n">hw</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">]);</span>
	<span class="n">set_irq_flags</span><span class="p">(</span><span class="n">irq</span><span class="p">,</span> <span class="n">IRQF_VALID</span> <span class="o">|</span> <span class="n">IRQF_PROBE</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">irq_domain_ops</span> <span class="n">combiner_irq_domain_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">xlate</span>	<span class="o">=</span> <span class="n">combiner_irq_domain_xlate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">map</span>	<span class="o">=</span> <span class="n">combiner_irq_domain_map</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">combiner_init</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">combiner_base</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_node</span> <span class="o">*</span><span class="n">np</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">irq</span><span class="p">,</span> <span class="n">irq_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max_nr</span><span class="p">,</span> <span class="n">nr_irq</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">of_property_read_u32</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="s">&quot;samsung,combiner-nr&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">max_nr</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">pr_warning</span><span class="p">(</span><span class="s">&quot;%s: number of combiners not specified, &quot;</span>
				<span class="s">&quot;setting default as %d.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">__func__</span><span class="p">,</span> <span class="n">EXYNOS4_MAX_COMBINER_NR</span><span class="p">);</span>
			<span class="n">max_nr</span> <span class="o">=</span> <span class="n">EXYNOS4_MAX_COMBINER_NR</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">max_nr</span> <span class="o">=</span> <span class="n">soc_is_exynos5250</span><span class="p">()</span> <span class="o">?</span> <span class="n">EXYNOS5_MAX_COMBINER_NR</span> <span class="o">:</span>
						<span class="n">EXYNOS4_MAX_COMBINER_NR</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">nr_irq</span> <span class="o">=</span> <span class="n">max_nr</span> <span class="o">*</span> <span class="n">MAX_IRQ_IN_COMBINER</span><span class="p">;</span>

	<span class="n">irq_base</span> <span class="o">=</span> <span class="n">irq_alloc_descs</span><span class="p">(</span><span class="n">COMBINER_IRQ</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nr_irq</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IS_ERR_VALUE</span><span class="p">(</span><span class="n">irq_base</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">irq_base</span> <span class="o">=</span> <span class="n">COMBINER_IRQ</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">pr_warning</span><span class="p">(</span><span class="s">&quot;%s: irq desc alloc failed. Continuing with %d as linux irq base</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">irq_base</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">combiner_irq_domain</span> <span class="o">=</span> <span class="n">irq_domain_add_legacy</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">nr_irq</span><span class="p">,</span> <span class="n">irq_base</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">combiner_irq_domain_ops</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">combiner_data</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">WARN_ON</span><span class="p">(</span><span class="o">!</span><span class="n">combiner_irq_domain</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_warning</span><span class="p">(</span><span class="s">&quot;%s: irq domain init failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">max_nr</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">combiner_init_one</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">combiner_base</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mh">0x10</span><span class="p">);</span>
		<span class="n">irq</span> <span class="o">=</span> <span class="n">IRQ_SPI</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_OF</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="p">)</span>
			<span class="n">irq</span> <span class="o">=</span> <span class="n">irq_of_parse_and_map</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
<span class="cp">#endif</span>
		<span class="n">combiner_cascade_irq</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">irq</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_OF</span>
<span class="kt">int</span> <span class="n">__init</span> <span class="nf">combiner_of_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device_node</span> <span class="o">*</span><span class="n">np</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_node</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">combiner_base</span><span class="p">;</span>

	<span class="n">combiner_base</span> <span class="o">=</span> <span class="n">of_iomap</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">combiner_base</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s: failed to map combiner registers</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENXIO</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">combiner_init</span><span class="p">(</span><span class="n">combiner_base</span><span class="p">,</span> <span class="n">np</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">of_device_id</span> <span class="n">exynos4_dt_irq_match</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">&quot;arm,cortex-a9-gic&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">gic_of_init</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">&quot;samsung,exynos4210-combiner&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">combiner_of_init</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{},</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">exynos4_init_irq</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gic_bank_offset</span><span class="p">;</span>

	<span class="n">gic_bank_offset</span> <span class="o">=</span> <span class="n">soc_is_exynos4412</span><span class="p">()</span> <span class="o">?</span> <span class="mh">0x4000</span> <span class="o">:</span> <span class="mh">0x8000</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">of_have_populated_dt</span><span class="p">())</span>
		<span class="n">gic_init_bases</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">IRQ_PPI</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">S5P_VA_GIC_DIST</span><span class="p">,</span> <span class="n">S5P_VA_GIC_CPU</span><span class="p">,</span> <span class="n">gic_bank_offset</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_OF</span>
	<span class="k">else</span>
		<span class="n">of_irq_init</span><span class="p">(</span><span class="n">exynos4_dt_irq_match</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">of_have_populated_dt</span><span class="p">())</span>
		<span class="n">combiner_init</span><span class="p">(</span><span class="n">S5P_VA_COMBINER_BASE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * The parameters of s5p_init_irq() are for VIC init.</span>
<span class="cm">	 * Theses parameters should be NULL and 0 because EXYNOS4</span>
<span class="cm">	 * uses GIC instead of VIC.</span>
<span class="cm">	 */</span>
	<span class="n">s5p_init_irq</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">exynos5_init_irq</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_OF</span>
	<span class="n">of_irq_init</span><span class="p">(</span><span class="n">exynos4_dt_irq_match</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="cm">/*</span>
<span class="cm">	 * The parameters of s5p_init_irq() are for VIC init.</span>
<span class="cm">	 * Theses parameters should be NULL and 0 because EXYNOS4</span>
<span class="cm">	 * uses GIC instead of VIC.</span>
<span class="cm">	 */</span>
	<span class="n">s5p_init_irq</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">bus_type</span> <span class="n">exynos_subsys</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;exynos-core&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev_name</span>	<span class="o">=</span> <span class="s">&quot;exynos-core&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">device</span> <span class="n">exynos4_dev</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">bus</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">exynos_subsys</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">exynos_core_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">subsys_system_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">exynos_subsys</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">core_initcall</span><span class="p">(</span><span class="n">exynos_core_init</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_CACHE_L2X0</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">exynos4_l2x0_cache_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">soc_is_exynos5250</span><span class="p">())</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">l2x0_of_init</span><span class="p">(</span><span class="n">L2_AUX_VAL</span><span class="p">,</span> <span class="n">L2_AUX_MASK</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">l2x0_regs_phys</span> <span class="o">=</span> <span class="n">virt_to_phys</span><span class="p">(</span><span class="o">&amp;</span><span class="n">l2x0_saved_regs</span><span class="p">);</span>
		<span class="n">clean_dcache_area</span><span class="p">(</span><span class="o">&amp;</span><span class="n">l2x0_regs_phys</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">));</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">S5P_VA_L2CC</span> <span class="o">+</span> <span class="n">L2X0_CTRL</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">l2x0_saved_regs</span><span class="p">.</span><span class="n">phy_base</span> <span class="o">=</span> <span class="n">EXYNOS4_PA_L2CC</span><span class="p">;</span>
		<span class="cm">/* TAG, Data Latency Control: 2 cycles */</span>
		<span class="n">l2x0_saved_regs</span><span class="p">.</span><span class="n">tag_latency</span> <span class="o">=</span> <span class="mh">0x110</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">soc_is_exynos4212</span><span class="p">()</span> <span class="o">||</span> <span class="n">soc_is_exynos4412</span><span class="p">())</span>
			<span class="n">l2x0_saved_regs</span><span class="p">.</span><span class="n">data_latency</span> <span class="o">=</span> <span class="mh">0x120</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">l2x0_saved_regs</span><span class="p">.</span><span class="n">data_latency</span> <span class="o">=</span> <span class="mh">0x110</span><span class="p">;</span>

		<span class="n">l2x0_saved_regs</span><span class="p">.</span><span class="n">prefetch_ctrl</span> <span class="o">=</span> <span class="mh">0x30000007</span><span class="p">;</span>
		<span class="n">l2x0_saved_regs</span><span class="p">.</span><span class="n">pwr_ctrl</span> <span class="o">=</span>
			<span class="p">(</span><span class="n">L2X0_DYNAMIC_CLK_GATING_EN</span> <span class="o">|</span> <span class="n">L2X0_STNDBY_MODE_EN</span><span class="p">);</span>

		<span class="n">l2x0_regs_phys</span> <span class="o">=</span> <span class="n">virt_to_phys</span><span class="p">(</span><span class="o">&amp;</span><span class="n">l2x0_saved_regs</span><span class="p">);</span>

		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">l2x0_saved_regs</span><span class="p">.</span><span class="n">tag_latency</span><span class="p">,</span>
				<span class="n">S5P_VA_L2CC</span> <span class="o">+</span> <span class="n">L2X0_TAG_LATENCY_CTRL</span><span class="p">);</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">l2x0_saved_regs</span><span class="p">.</span><span class="n">data_latency</span><span class="p">,</span>
				<span class="n">S5P_VA_L2CC</span> <span class="o">+</span> <span class="n">L2X0_DATA_LATENCY_CTRL</span><span class="p">);</span>

		<span class="cm">/* L2X0 Prefetch Control */</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">l2x0_saved_regs</span><span class="p">.</span><span class="n">prefetch_ctrl</span><span class="p">,</span>
				<span class="n">S5P_VA_L2CC</span> <span class="o">+</span> <span class="n">L2X0_PREFETCH_CTRL</span><span class="p">);</span>

		<span class="cm">/* L2X0 Power Control */</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">l2x0_saved_regs</span><span class="p">.</span><span class="n">pwr_ctrl</span><span class="p">,</span>
				<span class="n">S5P_VA_L2CC</span> <span class="o">+</span> <span class="n">L2X0_POWER_CTRL</span><span class="p">);</span>

		<span class="n">clean_dcache_area</span><span class="p">(</span><span class="o">&amp;</span><span class="n">l2x0_regs_phys</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">));</span>
		<span class="n">clean_dcache_area</span><span class="p">(</span><span class="o">&amp;</span><span class="n">l2x0_saved_regs</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">l2x0_regs</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="n">l2x0_init</span><span class="p">(</span><span class="n">S5P_VA_L2CC</span><span class="p">,</span> <span class="n">L2_AUX_VAL</span><span class="p">,</span> <span class="n">L2_AUX_MASK</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">early_initcall</span><span class="p">(</span><span class="n">exynos4_l2x0_cache_init</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">exynos5_l2_cache_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">soc_is_exynos5250</span><span class="p">())</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c1, c0, 0</span><span class="se">\n</span><span class="s">&quot;</span>
		     <span class="s">&quot;bic %0, %0, #(1 &lt;&lt; 2)</span><span class="se">\n</span><span class="s">&quot;</span>	<span class="cm">/* cache disable */</span>
		     <span class="s">&quot;mcr p15, 0, %0, c1, c0, 0</span><span class="se">\n</span><span class="s">&quot;</span>
		     <span class="s">&quot;mrc p15, 1, %0, c9, c0, 2</span><span class="se">\n</span><span class="s">&quot;</span>
		     <span class="o">:</span> <span class="s">&quot;=r&quot;</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>

	<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 1, %0, c9, c0, 2</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>
	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c1, c0, 0</span><span class="se">\n</span><span class="s">&quot;</span>
		     <span class="s">&quot;orr %0, %0, #(1 &lt;&lt; 2)</span><span class="se">\n</span><span class="s">&quot;</span>	<span class="cm">/* cache enable */</span>
		     <span class="s">&quot;mcr p15, 0, %0, c1, c0, 0</span><span class="se">\n</span><span class="s">&quot;</span>
		     <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">early_initcall</span><span class="p">(</span><span class="n">exynos5_l2_cache_init</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">exynos_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;EXYNOS: Initializing architecture</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">device_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">exynos4_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* uart registration process */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">exynos_init_uarts</span><span class="p">(</span><span class="k">struct</span> <span class="n">s3c2410_uartcfg</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">no</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">s3c2410_uartcfg</span> <span class="o">*</span><span class="n">tcfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ucnt</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">ucnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ucnt</span> <span class="o">&lt;</span> <span class="n">no</span><span class="p">;</span> <span class="n">ucnt</span><span class="o">++</span><span class="p">,</span> <span class="n">tcfg</span><span class="o">++</span><span class="p">)</span>
		<span class="n">tcfg</span><span class="o">-&gt;</span><span class="n">has_fracval</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">soc_is_exynos5250</span><span class="p">())</span>
		<span class="n">s3c24xx_init_uartdevs</span><span class="p">(</span><span class="s">&quot;exynos4210-uart&quot;</span><span class="p">,</span> <span class="n">exynos5_uart_resources</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">no</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">s3c24xx_init_uartdevs</span><span class="p">(</span><span class="s">&quot;exynos4210-uart&quot;</span><span class="p">,</span> <span class="n">exynos4_uart_resources</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">no</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">exynos_eint_base</span><span class="p">;</span>

<span class="k">static</span> <span class="n">DEFINE_SPINLOCK</span><span class="p">(</span><span class="n">eint_lock</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">eint0_15_data</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">exynos4_irq_to_gpio</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="n">IRQ_EINT</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">irq</span> <span class="o">-=</span> <span class="n">IRQ_EINT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">EXYNOS4_GPX0</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>

	<span class="n">irq</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">EXYNOS4_GPX1</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>

	<span class="n">irq</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">EXYNOS4_GPX2</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>

	<span class="n">irq</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">EXYNOS4_GPX3</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">exynos5_irq_to_gpio</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="n">IRQ_EINT</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">irq</span> <span class="o">-=</span> <span class="n">IRQ_EINT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">EXYNOS5_GPX0</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>

	<span class="n">irq</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">EXYNOS5_GPX1</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>

	<span class="n">irq</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">EXYNOS5_GPX2</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>

	<span class="n">irq</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">EXYNOS5_GPX3</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">exynos4_eint0_15_src_int</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EXYNOS4_IRQ_EINT0</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT1</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT2</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT3</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT4</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT5</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT6</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT7</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT8</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT9</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT10</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT11</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT12</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT13</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT14</span><span class="p">,</span>
	<span class="n">EXYNOS4_IRQ_EINT15</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">exynos5_eint0_15_src_int</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EXYNOS5_IRQ_EINT0</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT1</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT2</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT3</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT4</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT5</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT6</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT7</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT8</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT9</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT10</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT11</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT12</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT13</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT14</span><span class="p">,</span>
	<span class="n">EXYNOS5_IRQ_EINT15</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">exynos_irq_eint_mask</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">mask</span><span class="p">;</span>

	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eint_lock</span><span class="p">);</span>
	<span class="n">mask</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">EINT_MASK</span><span class="p">(</span><span class="n">exynos_eint_base</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">));</span>
	<span class="n">mask</span> <span class="o">|=</span> <span class="n">EINT_OFFSET_BIT</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">EINT_MASK</span><span class="p">(</span><span class="n">exynos_eint_base</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">));</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eint_lock</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">exynos_irq_eint_unmask</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">mask</span><span class="p">;</span>

	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eint_lock</span><span class="p">);</span>
	<span class="n">mask</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">EINT_MASK</span><span class="p">(</span><span class="n">exynos_eint_base</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">));</span>
	<span class="n">mask</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">EINT_OFFSET_BIT</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">));</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">EINT_MASK</span><span class="p">(</span><span class="n">exynos_eint_base</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">));</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eint_lock</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">exynos_irq_eint_ack</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">EINT_OFFSET_BIT</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">),</span>
		     <span class="n">EINT_PEND</span><span class="p">(</span><span class="n">exynos_eint_base</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">exynos_irq_eint_maskack</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">exynos_irq_eint_mask</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
	<span class="n">exynos_irq_eint_ack</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">exynos_irq_eint_set_type</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">offs</span> <span class="o">=</span> <span class="n">EINT_OFFSET</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">shift</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ctrl</span><span class="p">,</span> <span class="n">mask</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">newvalue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">IRQ_TYPE_EDGE_RISING</span>:
		<span class="n">newvalue</span> <span class="o">=</span> <span class="n">S5P_IRQ_TYPE_EDGE_RISING</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">IRQ_TYPE_EDGE_FALLING</span>:
		<span class="n">newvalue</span> <span class="o">=</span> <span class="n">S5P_IRQ_TYPE_EDGE_FALLING</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">IRQ_TYPE_EDGE_BOTH</span>:
		<span class="n">newvalue</span> <span class="o">=</span> <span class="n">S5P_IRQ_TYPE_EDGE_BOTH</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">IRQ_TYPE_LEVEL_LOW</span>:
		<span class="n">newvalue</span> <span class="o">=</span> <span class="n">S5P_IRQ_TYPE_LEVEL_LOW</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">IRQ_TYPE_LEVEL_HIGH</span>:
		<span class="n">newvalue</span> <span class="o">=</span> <span class="n">S5P_IRQ_TYPE_LEVEL_HIGH</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;No such irq type %d&quot;</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">offs</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">mask</span> <span class="o">=</span> <span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">;</span>

	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eint_lock</span><span class="p">);</span>
	<span class="n">ctrl</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">EINT_CON</span><span class="p">(</span><span class="n">exynos_eint_base</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">));</span>
	<span class="n">ctrl</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>
	<span class="n">ctrl</span> <span class="o">|=</span> <span class="n">newvalue</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">;</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="n">EINT_CON</span><span class="p">(</span><span class="n">exynos_eint_base</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">));</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eint_lock</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">soc_is_exynos5250</span><span class="p">())</span>
		<span class="n">s3c_gpio_cfgpin</span><span class="p">(</span><span class="n">exynos5_irq_to_gpio</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">),</span> <span class="n">S3C_GPIO_SFN</span><span class="p">(</span><span class="mh">0xf</span><span class="p">));</span>
	<span class="k">else</span>
		<span class="n">s3c_gpio_cfgpin</span><span class="p">(</span><span class="n">exynos4_irq_to_gpio</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">),</span> <span class="n">S3C_GPIO_SFN</span><span class="p">(</span><span class="mh">0xf</span><span class="p">));</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">irq_chip</span> <span class="n">exynos_irq_eint</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;exynos-eint&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_mask</span>	<span class="o">=</span> <span class="n">exynos_irq_eint_mask</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_unmask</span>	<span class="o">=</span> <span class="n">exynos_irq_eint_unmask</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_mask_ack</span>	<span class="o">=</span> <span class="n">exynos_irq_eint_maskack</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_ack</span>	<span class="o">=</span> <span class="n">exynos_irq_eint_ack</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_set_type</span>	<span class="o">=</span> <span class="n">exynos_irq_eint_set_type</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_PM</span>
	<span class="p">.</span><span class="n">irq_set_wake</span>	<span class="o">=</span> <span class="n">s3c_irqext_wake</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * exynos4_irq_demux_eint</span>
<span class="cm"> *</span>
<span class="cm"> * This function demuxes the IRQ from from EINTs 16 to 31.</span>
<span class="cm"> * It is designed to be inlined into the specific handler</span>
<span class="cm"> * s5p_irq_demux_eintX_Y.</span>
<span class="cm"> *</span>
<span class="cm"> * Each EINT pend/mask registers handle eight of them.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">exynos_irq_demux_eint</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">start</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">status</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">EINT_PEND</span><span class="p">(</span><span class="n">exynos_eint_base</span><span class="p">,</span> <span class="n">start</span><span class="p">));</span>
	<span class="n">u32</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">EINT_MASK</span><span class="p">(</span><span class="n">exynos_eint_base</span><span class="p">,</span> <span class="n">start</span><span class="p">));</span>

	<span class="n">status</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">&amp;=</span> <span class="mh">0xff</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">irq</span> <span class="o">=</span> <span class="n">fls</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">generic_handle_irq</span><span class="p">(</span><span class="n">irq</span> <span class="o">+</span> <span class="n">start</span><span class="p">);</span>
		<span class="n">status</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">irq</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">exynos_irq_demux_eint16_31</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">irq_desc</span> <span class="o">*</span><span class="n">desc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">irq_chip</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">irq_get_chip</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>
	<span class="n">chained_irq_enter</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>
	<span class="n">exynos_irq_demux_eint</span><span class="p">(</span><span class="n">IRQ_EINT</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
	<span class="n">exynos_irq_demux_eint</span><span class="p">(</span><span class="n">IRQ_EINT</span><span class="p">(</span><span class="mi">24</span><span class="p">));</span>
	<span class="n">chained_irq_exit</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">exynos_irq_eint0_15</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">irq_desc</span> <span class="o">*</span><span class="n">desc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">irq_data</span> <span class="o">=</span> <span class="n">irq_get_handler_data</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">irq_chip</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">irq_get_chip</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>

	<span class="n">chained_irq_enter</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>
	<span class="n">chip</span><span class="o">-&gt;</span><span class="n">irq_mask</span><span class="p">(</span><span class="o">&amp;</span><span class="n">desc</span><span class="o">-&gt;</span><span class="n">irq_data</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">irq_ack</span><span class="p">)</span>
		<span class="n">chip</span><span class="o">-&gt;</span><span class="n">irq_ack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">desc</span><span class="o">-&gt;</span><span class="n">irq_data</span><span class="p">);</span>

	<span class="n">generic_handle_irq</span><span class="p">(</span><span class="o">*</span><span class="n">irq_data</span><span class="p">);</span>

	<span class="n">chip</span><span class="o">-&gt;</span><span class="n">irq_unmask</span><span class="p">(</span><span class="o">&amp;</span><span class="n">desc</span><span class="o">-&gt;</span><span class="n">irq_data</span><span class="p">);</span>
	<span class="n">chained_irq_exit</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">exynos_init_irq_eint</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">soc_is_exynos5250</span><span class="p">())</span>
		<span class="n">exynos_eint_base</span> <span class="o">=</span> <span class="n">ioremap</span><span class="p">(</span><span class="n">EXYNOS5_PA_GPIO1</span><span class="p">,</span> <span class="n">SZ_4K</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">exynos_eint_base</span> <span class="o">=</span> <span class="n">ioremap</span><span class="p">(</span><span class="n">EXYNOS4_PA_GPIO2</span><span class="p">,</span> <span class="n">SZ_4K</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">exynos_eint_base</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;unable to ioremap for EINT base address</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">irq</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">irq</span> <span class="o">&lt;=</span> <span class="mi">31</span> <span class="p">;</span> <span class="n">irq</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">irq_set_chip_and_handler</span><span class="p">(</span><span class="n">IRQ_EINT</span><span class="p">(</span><span class="n">irq</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">exynos_irq_eint</span><span class="p">,</span>
					 <span class="n">handle_level_irq</span><span class="p">);</span>
		<span class="n">set_irq_flags</span><span class="p">(</span><span class="n">IRQ_EINT</span><span class="p">(</span><span class="n">irq</span><span class="p">),</span> <span class="n">IRQF_VALID</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">irq_set_chained_handler</span><span class="p">(</span><span class="n">EXYNOS_IRQ_EINT16_31</span><span class="p">,</span> <span class="n">exynos_irq_demux_eint16_31</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">irq</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">irq</span> <span class="o">&lt;=</span> <span class="mi">15</span> <span class="p">;</span> <span class="n">irq</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">eint0_15_data</span><span class="p">[</span><span class="n">irq</span><span class="p">]</span> <span class="o">=</span> <span class="n">IRQ_EINT</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">soc_is_exynos5250</span><span class="p">())</span> <span class="p">{</span>
			<span class="n">irq_set_handler_data</span><span class="p">(</span><span class="n">exynos5_eint0_15_src_int</span><span class="p">[</span><span class="n">irq</span><span class="p">],</span>
					     <span class="o">&amp;</span><span class="n">eint0_15_data</span><span class="p">[</span><span class="n">irq</span><span class="p">]);</span>
			<span class="n">irq_set_chained_handler</span><span class="p">(</span><span class="n">exynos5_eint0_15_src_int</span><span class="p">[</span><span class="n">irq</span><span class="p">],</span>
						<span class="n">exynos_irq_eint0_15</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">irq_set_handler_data</span><span class="p">(</span><span class="n">exynos4_eint0_15_src_int</span><span class="p">[</span><span class="n">irq</span><span class="p">],</span>
					     <span class="o">&amp;</span><span class="n">eint0_15_data</span><span class="p">[</span><span class="n">irq</span><span class="p">]);</span>
			<span class="n">irq_set_chained_handler</span><span class="p">(</span><span class="n">exynos4_eint0_15_src_int</span><span class="p">[</span><span class="n">irq</span><span class="p">],</span>
						<span class="n">exynos_irq_eint0_15</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">arch_initcall</span><span class="p">(</span><span class="n">exynos_init_irq_eint</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
