f | devices.c | s | 2.7K | 83 | Tony Lindgren | tony@atomide.com | 1336606512 |  | ARM: OMAP: Move omap_mmc_add() to mach-omap1  Now that omap2420 is using hwmod for MMC, this code is omap1 only used on omap1.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | common.c | s | 1.9K | 68 | Paul Walmsley | paul@pwsan.com | 1334320466 |  | ARM: OMAP: add includes for missing prototypes  Several C files in arch/arm/mach-omap* and arch/arm/plat-omap declare functions that are used by other files, but don't include the header file where the prototype is declared.  This results in the following warnings from sparse:      arch/arm/mach-omap2/irq.c:114:5: warning: symbol 'omap_irq_pending' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:186:13: warning: symbol 'omap2_init_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:191:13: warning: symbol 'omap3_init_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:196:13: warning: symbol 'ti81xx_init_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:233:39: warning: symbol 'omap2_intc_handle_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:242:6: warning: symbol 'omap_intc_save_context' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:265:6: warning: symbol 'omap_intc_restore_context' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:291:6: warning: symbol 'omap3_intc_suspend' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:297:6: warning: symbol 'omap3_intc_prepare_idle' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:306:6: warning: symbol 'omap3_intc_resume_idle' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:312:39: warning: symbol 'omap3_intc_handle_irq' was not declared. Should it be static?     arch/arm/mach-omap2/omap-secure.c:59:12: warning: symbol 'omap_secure_ram_reserve_memblock' was not declared. Should it be static?     arch/arm/mach-omap2/board-zoom-display.c:133:13: warning: symbol 'zoom_display_init' was not declared. Should it be static?     arch/arm/plat-omap/common.c:73:13: warning: symbol 'omap_init_consistent_dma_size' was not declared. Should it be static?     arch/arm/mach-omap1/irq.c:61:5: warning: symbol 'omap_irq_flags' was not declared. Should it be static?     arch/arm/mach-omap1/irq.c:179:13: warning: symbol 'omap1_init_irq' was not declared. Should it be static?     arch/arm/mach-omap1/reset.c:11:6: warning: symbol 'omap1_restart' was not declared. Should it be static?  Fix by including the appropriate header files.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: Senthilvadivu Guruswamy <svadivu@ti.com> Acked-by: Santosh Shilimkar <santosh.shilimkar@ti.com>
f | Makefile | g | 670B |  | Paul Walmsley | paul@pwsan.com | 1334320467 |  | ARM: OMAP1: OCPI: move to mach-omap1/  Move the OMAP1 OCPI "bus" code to arch/arm/mach-omap1, since it is only used on OMAP1 devices.  In the long term, it probably makes sense to move the OCPI bus code to somewhere under drivers/.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Tony Lindgren <tony@atomide.com>
f | debug-leds.c | s | 7.0K | 253 | David Howells | dhowells@redhat.com | 1332955801 |  | Disintegrate asm/system.h for ARM  Disintegrate asm/system.h for ARM.  Signed-off-by: David Howells <dhowells@redhat.com> cc: Russell King <linux@arm.linux.org.uk> cc: linux-arm-kernel@lists.infradead.org
d | include |  | 1 items |  | Tony Lindgren | tony@atomide.com | 1338972140 |  | ARM: OMAP: Fix MMC_OMAP build when only MMC_OMAP_HS is selected  If CONFIG_MMC_OMAP is not set and CONFIG_MMC_OMAP_HS is set, we can get error: redefinition of `omap242x_init_mmc' error.  Fix it by removing MMC_OMAP_HS from MMC_OMAP ifdefs as they do not depend on each other.  While at it, also prettify the formatting a bit.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | clock.c | s | 11K | 457 | Todd Poynor | toddpoynor@google.com | 1339955870 |  | ARM: OMAP: PM: Lock clocks list while generating summary  Commit a53025724052b2b1edbc982a4a248784638f563d (OMAP: Add debugfs node to show the summary of all clocks) introduced clock summary, however, we are interested in seeing snapshot of the clock state, not in dynamically changing clock configurations as the data provided by clock summary will then be useless for debugging configuration issues. So, hold the common lock when dumping the clock summary.  Cc: Paul Walmsley <paul@pwsan.com> Cc: Tony Lindgren <tony@atomide.com> Signed-off-by: Todd Poynor <toddpoynor@google.com> [nm@ti.com: added commit message] Signed-off-by: Nishanth Menon <nm@ti.com> [paul@pwsan.com: minor edits to commit message] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | dma.c | s | 51K | 1845 | Linus Torvalds | torvalds@linux-foundation.org | 1338060709 |  | 
f | fb.c | s | 2.6K | 86 | Tony Lindgren | tony@atomide.com | 1331279601 |  | ARM: OMAP2+: Fix compile error when FB_OMAP2 is not set  Otherwise we will get:  arch/arm/plat-omap/fb.c:101: error: expected ‘)’ before ‘*’ token  Signed-off-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>
f | omap_device.c | s | 30K | 951 | Paul Walmsley | paul@pwsan.com | 1334699447 |  | ARM: OMAP2+: clean up some cppcheck warnings  Resolve some warnings identified by cppcheck in arch/arm/mach-omap2:      [arch/arm/mach-omap2/usb-tusb6010.c:129]: (style) Checking if unsigned variable 'tmp' is less than zero.     [arch/arm/mach-omap2/prm_common.c:241]: (error) Possible null pointer dereference: irq_setup - otherwise it is redundant to check if irq_setup is null at line 247     [arch/arm/mach-omap2/pm34xx.c:790]: (style) Variable 'per_clkdm' is assigned a value that is never used     [arch/arm/mach-omap2/pm34xx.c:790]: (style) Variable 'core_clkdm' is assigned a value that is never used     [arch/arm/mach-omap2/pm24xx.c:185]: (style) Variable 'only_idle' is assigned a value that is never used     [arch/arm/mach-omap2/mux.c:254]: (error) Possible null pointer dereference: mux     [arch/arm/mach-omap2/mux.c:258]: (error) Possible null pointer dereference: mux     [arch/arm/mach-omap2/gpmc-onenand.c:178]: (style) Variable 'tick_ns' is assigned a value that is never used     [arch/arm/mach-omap2/gpio.c:56]: (error) Possible null pointer dereference: pdata - otherwise it is redundant to check if pdata is null at line 57     [arch/arm/mach-omap2/devices.c:45]: (style) Variable 'l' is assigned a value that is never used     [arch/arm/mach-omap2/board-omap3evm.c:641] -> [arch/arm/mach-omap2/board-omap3evm.c:639]: (style) Found duplicate branches for if and else.     [arch/arm/mach-omap2/am35xx-emac.c:95]: (style) Variable 'regval' is assigned a value that is never used     [arch/arm/mach-omap2/devices.c:74]: (style) Variable 'l' is assigned a value that is never used     [arch/arm/mach-omap2/pm34xx.c:277]: (style) Variable 'per_prev_state' is assigned a value that is never used     [arch/arm/plat-omap/dmtimer.c:352]: (error) Possible null pointer dereference: timer - otherwise it is redundant to check if timer is null at line 354     [arch/arm/plat-omap/omap_device.c:478]: (style) Variable 'c' is assigned a value that is never used     [arch/arm/plat-omap/usb.c:42]: (style) Variable 'status' is assigned a value that is never used     [arch/arm/mach-omap1/clock.c:197]: (style) Variable 'dpll1_rate' is assigned a value that is never used     [arch/arm/mach-omap1/lcd_dma.c:60]: (style) struct or union member 'lcd_dma_info::size' is never used     [arch/arm/mach-omap1/pm.c:572]: (style) Variable 'entry' is assigned a value that is never used  Some of them are pretty good catches, such as gpio.c:56 and usb-tusb6010.c:129.  Thanks to Jarkko Nikula for some comments on the sscanf() warnings. It seems that the kernel sscanf() ignores the field width anyway for the %d format, so those changes have been dropped from this second version.  Thanks to Daniel Marjamäki <daniel.marjamaki@gmail.com> for pointing out that a variable was unnecessarily marked static in the board-omap3evm.c change.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Felipe Balbi <balbi@ti.com> Cc: Tony Lindgren <tony@atomide.com> Cc: Kevin Hilman <khilman@ti.com> Cc: Peter Ujfalusi <peter.ujfalusi@ti.com> Cc: Jarkko Nikula <jarkko.nikula@bitmer.com> Cc: Charulatha Varadarajan <charu@ti.com> Cc: Daniel Marjamäki <daniel.marjamaki@gmail.com> Cc: Tarun Kanti DebBarma <tarun.kanti@ti.com> Reviewed-by: Charulatha Varadarajan <charu@ti.com> # for gpio.c
f | i2c.c | s | 7.0K | 239 | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1320453667 |  | ARM: OMAP: I2C: Fix omap_register_i2c_bus() return value on success  Commit 4d17aeb1c5b2375769446d13012a98e6d265ec13 ("OMAP: I2C: split device registration and convert OMAP2+ to omap_device") makes omap2_i2c_add_bus() return a pointer to an omap_device instead on success instead of 0.  This breaks the omap_register_i2c_bus() ABI and results in the igep0020 board code detecting an I2C bus registration error when there is none.  Fix the problem by using PTR_RET() instead of PTR_ERR() in omap2_i2c_add_bus().  Reported-by: Alexander Kinzer <a.kinzer@plusoptix.de> Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> [tony@atomide.com: updated to return pdev instead of od] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | mux.c | s | 2.2K | 76 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP: Remove plat/io.h by splitting it into mach/io.h and mach/hardware.h  This is needed to minimize io.h so the SoC specific io.h for ARMs can removed.  Note that minimal driver changes for DSS and RNG are needed to include cpu.h for SoC detection macros.  Cc: Tomi Valkeinen <tomi.valkeinen@ti.com> Cc: Matt Mackall <mpm@selenic.com> Cc: Herbert Xu <herbert@gondor.apana.org.au> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | debug-devices.c | s | 2.1K | 79 | Russell King | rmk+kernel@arm.linux.org.uk | 1312810061 |  | ARM: gpio: convert includes of mach/gpio.h and asm/gpio.h to linux/gpio.h  Convert arch/arm includes of mach/gpio.h and asm/gpio.h to linux/gpio.h before we start consolidating the individual platform implementations of the gpio header files.  Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
f | counter_32k.c | s | 3.1K | 94 | Linus Torvalds | torvalds@linux-foundation.org | 1338060709 |  | 
f | Kconfig | g | 5.7K |  | Rob Herring | rob.herring@calxeda.com | 1333650595 |  | ARM: fix __io macro for PCMCIA  With commit c334bc1 (ARM: make mach/io.h include optional), PCMCIA was broken. PCMCIA depends on __io() returning a valid i/o address, and most ARM platforms require IO_SPACE_LIMIT be set to 0xffffffff for PCMCIA. This needs a better fix with a fixed i/o address mapping, but for now we just restore things to the previous behavior.  This fixes at91, omap1, pxa and sa11xx. pxa needs io.h if PCI is enabled, but PCMCIA is not. sa11xx already has IO_SPACE_LIMIT set to 0xffffffff, so it doesn't need an io.h.  Signed-off-by: Rob Herring <rob.herring@calxeda.com> Cc: Joachim Eastwood <joachim.eastwood@jotron.com> Cc: Russell King <linux@arm.linux.org.uk> Cc: Andrew Victor <linux@maxim.org.za> Cc: Nicolas Ferre <nicolas.ferre@atmel.com> Cc: Jean-Christophe Plagniol-Villard <plagnioj@jcrosoft.com> Tested-by: Paul Parsons <lost.distance@yahoo.com> (pxa270) Acked-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Olof Johansson <olof@lixom.net>
f | omap-pm-noop.c | s | 9.1K | 309 | Kevin Hilman | khilman@ti.com | 1330990682 |  | ARM: OMAP: omap_device: remove omap_device_parent  Currently all omap_devices are forced to have the dummy device 'omap_device_parent' as a parent.  This was used to distinguish omap_devices from "normal" platform_devices in the OMAP PM core code.  Now that we implement the PM core using PM domains, this is no longer needed, and is removed.  This also frees up omap_devices to have a more complex parent/child relationships that model actual device relationships.  The only in-tree user of omap_device_parent was the OMAP PM layer to handle lost-context count for omap_devices.  That is now converted to use the presence of the omap_device_pm_domain instead.  Signed-off-by: Kevin Hilman <khilman@ti.com>
f | mailbox.c | s | 9.1K | 357 | Felipe Contreras | felipe.contreras@nokia.com | 1330992663 |  | ARM: OMAP: mailbox: trivial whitespace fix  Trivial whitespace fix  Signed-off-by: Felipe Contreras <felipe.contreras@nokia.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | dmtimer.c | s | 18K | 634 | Linus Torvalds | torvalds@linux-foundation.org | 1338060709 |  | 
f | usb.c | s | 4.1K | 123 | Paul Walmsley | paul@pwsan.com | 1336755403 |  | ARM: OMAP: OTG integration: fix compiler warning  Tony reported the following compile warning after commit eeb3711b89d68e147e05e7b43a49ecc5009dc157 ("ARM: OMAP2+: clean up some cppcheck warnings"):  arch/arm/plat-omap/usb.c: In function 'omap_otg_init': arch/arm/plat-omap/usb.c:40: warning: unused variable 'status'  This happens if CONFIG_ARCH_OMAP_OTG is set but CONFIG_USB_GADGET_OMAP, CONFIG_USB_OHCI_HCD, CONFIG_USB_OHCI_HCD_MODULE, and CONFIG_USB_OTG are all unset.  Fix by localizing the status variable to the blocks that use it.  Compile-tested only, with omap2plus_defconfig and omap2plus_defconfig with CONFIG_USB_OHCI_HCD and CONFIG_USB_OTG enabled.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | sram.c | s | 10K | 337 | Olof Johansson | olof@lixom.net | 1336555726 |  | 
f | sram.h | s | 134B | 4 | Manjunath Kondaiah G | manjugk@ti.com | 1286557958 |  | OMAP: plat-omap: Fix static function warnings  This patch fixes sparse warnings due non declarations of static functions.  arch/arm/plat-omap/sram.c:130:13: warning: symbol 'omap_detect_sram' was not declared. Should it be static? arch/arm/plat-omap/sram.c:216:13: warning: symbol 'omap_map_sram' was not declared. Should it be static? arch/arm/plat-omap/sram.c:450:12: warning: symbol 'omap_sram_init' was not declared. Should it be static? arch/arm/plat-omap/sram.c:348:12: warning: symbol 'omap242x_sram_init' was not declared. Should it be static? arch/arm/plat-omap/sram.c:369:12: warning: symbol 'omap243x_sram_init' was not declared. Should it be static? arch/arm/plat-omap/sram.c:425:12: warning: symbol 'omap34xx_sram_init' was not declared. Should it be static? arch/arm/plat-omap/sram.c:441:12: warning: symbol 'omap44xx_sram_init' was not declared. Should it be static  arch/arm/plat-omap/mcbsp.c:36:6: warning: symbol 'omap_mcbsp_write' was not declared. Should it be static? arch/arm/plat-omap/mcbsp.c:50:5: warning: symbol 'omap_mcbsp_read' was not declared. Should it be static? arch/arm/plat-omap/mcbsp.c:65:6: warning: symbol 'omap_mcbsp_st_write' was not declared. Should it be static? arch/arm/plat-omap/mcbsp.c:70:5: warning: symbol 'omap_mcbsp_st_read' was not declared. Should it be static? arch/arm/plat-omap/mcbsp.c:1648:15: warning: symbol 'omap_st_add' was not declared. Should it be static?  arch/arm/plat-omap/fb.c:414:15: warning: symbol 'omapfb_reserve_sram' was not declared. Should it be static? arch/arm/plat-omap/cpu-omap.c:43:5: warning: symbol 'omap_verify_speed' was not declared. Should it be static? arch/arm/plat-omap/cpu-omap.c:61:14: warning: symbol 'omap_getspeed' was not declared. Should it be static?  Signed-off-by: Manjunath Kondaiah G <manjugk@ti.com> Cc: linux-arm-kernel@lists.infradead.org Cc: Nishanth Menon <nm@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
