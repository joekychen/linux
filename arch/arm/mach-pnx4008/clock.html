<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-pnx4008 › clock.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>clock.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * arch/arm/mach-pnx4008/clock.c</span>
<span class="cm"> *</span>
<span class="cm"> * Clock control driver for PNX4008</span>
<span class="cm"> *</span>
<span class="cm"> * Authors: Vitaly Wool, Dmitry Chigirev &lt;source@mvista.com&gt;</span>
<span class="cm"> * Generic clock management functions are partially based on:</span>
<span class="cm"> *  linux/arch/arm/mach-omap/clock.c</span>
<span class="cm"> *</span>
<span class="cm"> * 2005-2006 (c) MontaVista Software, Inc. This file is licensed under</span>
<span class="cm"> * the terms of the GNU General Public License version 2. This program</span>
<span class="cm"> * is licensed &quot;as is&quot; without any warranty of any kind, whether express</span>
<span class="cm"> * or implied.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/err.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/clkdev.h&gt;</span>

<span class="cp">#include &lt;mach/hardware.h&gt;</span>
<span class="cp">#include &lt;mach/clock.h&gt;</span>
<span class="cp">#include &quot;clock.h&quot;</span>

<span class="cm">/*forward declaration*/</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">per_ck</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">hclk_ck</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">ck_1MHz</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">ck_13MHz</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">ck_pll1</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">local_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">clock_lock</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">local_irq_disable</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">clock_unlock</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">local_irq_enable</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">propagate_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">tmp_clk</span><span class="p">;</span>

	<span class="n">tmp_clk</span> <span class="o">=</span> <span class="n">clk</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">tmp_clk</span><span class="o">-&gt;</span><span class="n">propagate_next</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tmp_clk</span> <span class="o">=</span> <span class="n">tmp_clk</span><span class="o">-&gt;</span><span class="n">propagate_next</span><span class="p">;</span>
		<span class="n">local_set_rate</span><span class="p">(</span><span class="n">tmp_clk</span><span class="p">,</span> <span class="n">tmp_clk</span><span class="o">-&gt;</span><span class="n">user_rate</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">clk_reg_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg</span><span class="p">)</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg</span><span class="p">)</span> <span class="o">&amp;</span>
			     <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_shift</span><span class="p">),</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">clk_reg_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg</span><span class="p">)</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg</span><span class="p">)</span> <span class="o">|</span>
			     <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_shift</span><span class="p">),</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">clk_reg_disable1</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg1</span><span class="p">)</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg1</span><span class="p">)</span> <span class="o">&amp;</span>
			     <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_shift1</span><span class="p">),</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">clk_reg_enable1</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg1</span><span class="p">)</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg1</span><span class="p">)</span> <span class="o">|</span>
			     <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_shift1</span><span class="p">),</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable_reg1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">clk_wait_for_pll_lock</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mh">0xFFF</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">;</span>	<span class="cm">/*wait for PLL to lock */</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span>
		       <span class="s">&quot;%s ERROR: failed to lock, scale reg data: %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">clk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">));</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">switch_to_dirty_13mhz</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tmp_reg</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">)</span>
		<span class="n">clk_reg_enable1</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>

	<span class="n">tmp_reg</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent_switch_reg</span><span class="p">);</span>
	<span class="cm">/*if 13Mhz clock selected, select 13&#39;MHz (dirty) source from OSC */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tmp_reg</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">tmp_reg</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>	<span class="cm">/* Trigger switch to 13&#39;MHz (dirty) clock */</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">tmp_reg</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent_switch_reg</span><span class="p">);</span>
		<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mh">0xFFF</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent_switch_reg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">;</span>	<span class="cm">/*wait for 13&#39;MHz selection status */</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent_switch_reg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span>
			       <span class="s">&quot;%s ERROR: failed to select 13&#39;MHz, parent sw reg data: %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">clk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent_switch_reg</span><span class="p">));</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">)</span>
		<span class="n">clk_reg_disable1</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">switch_to_clean_13mhz</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tmp_reg</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">)</span>
		<span class="n">clk_reg_enable1</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>

	<span class="n">tmp_reg</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent_switch_reg</span><span class="p">);</span>
	<span class="cm">/*if 13&#39;Mhz clock selected, select 13MHz (clean) source from OSC */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tmp_reg</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tmp_reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>	<span class="cm">/* Trigger switch to 13MHz (clean) clock */</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">tmp_reg</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent_switch_reg</span><span class="p">);</span>
		<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mh">0xFFF</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent_switch_reg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">;</span>	<span class="cm">/*wait for 13MHz selection status */</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent_switch_reg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span>
			       <span class="s">&quot;%s ERROR: failed to select 13MHz, parent sw reg data: %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">clk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent_switch_reg</span><span class="p">));</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">)</span>
		<span class="n">clk_reg_disable1</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">set_13MHz_parent</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">parent</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">ck_13MHz</span><span class="p">)</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">switch_to_clean_13mhz</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">parent</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">ck_pll1</span><span class="p">)</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">switch_to_dirty_13mhz</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define PLL160_MIN_FCCO 156000</span>
<span class="cp">#define PLL160_MAX_FCCO 320000</span>

<span class="cm">/*</span>
<span class="cm"> * Calculate pll160 settings.</span>
<span class="cm"> * Possible input: up to 320MHz with step of clk-&gt;parent-&gt;rate.</span>
<span class="cm"> * In PNX4008 parent rate for pll160s may be either 1 or 13MHz.</span>
<span class="cm"> * Ignored paths: &quot;feedback&quot; (bit 13 set), &quot;div-by-N&quot;.</span>
<span class="cm"> * Setting ARM PLL4 rate to 0 will put CPU into direct run mode.</span>
<span class="cm"> * Setting PLL5 and PLL3 rate to 0 will disable USB and DSP clock input.</span>
<span class="cm"> * Please refer to PNX4008 IC manual for details.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pll160_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">tmp_reg</span><span class="p">,</span> <span class="n">tmp_m</span><span class="p">,</span> <span class="n">tmp_2p</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">parent_rate</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">parent_rate</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">parent_rate</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="cm">/* set direct run for ARM or disable output for others  */</span>
	<span class="n">clk_reg_disable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>

	<span class="cm">/* disable source input as well (ignored for ARM) */</span>
	<span class="n">clk_reg_disable1</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>

	<span class="n">tmp_reg</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">);</span>
	<span class="n">tmp_reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x1ffff</span><span class="p">;</span>	<span class="cm">/*clear all settings, power down */</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">tmp_reg</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">);</span>

	<span class="n">rate</span> <span class="o">-=</span> <span class="n">rate</span> <span class="o">%</span> <span class="n">parent_rate</span><span class="p">;</span>	<span class="cm">/*round down the input */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&gt;</span> <span class="n">PLL160_MAX_FCCO</span><span class="p">)</span>
		<span class="n">rate</span> <span class="o">=</span> <span class="n">PLL160_MAX_FCCO</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">clk_reg_enable1</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
	<span class="n">tmp_reg</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">==</span> <span class="n">parent_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*enter direct bypass mode */</span>
		<span class="n">tmp_reg</span> <span class="o">|=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">));</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">tmp_reg</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">);</span>
		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">parent_rate</span><span class="p">;</span>
		<span class="n">clk_reg_enable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">tmp_2p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">tmp_2p</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">tmp_2p</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">*</span> <span class="n">tmp_2p</span> <span class="o">&gt;=</span> <span class="n">PLL160_MIN_FCCO</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="n">i</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tmp_2p</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">tmp_reg</span> <span class="o">|=</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">tmp_reg</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>	<span class="cm">/*direct mode, no divide */</span>

	<span class="n">tmp_m</span> <span class="o">=</span> <span class="n">rate</span> <span class="o">*</span> <span class="n">tmp_2p</span><span class="p">;</span>
	<span class="n">tmp_m</span> <span class="o">/=</span> <span class="n">parent_rate</span><span class="p">;</span>

	<span class="n">tmp_reg</span> <span class="o">|=</span> <span class="p">(</span><span class="n">tmp_m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/*calculate M */</span>
	<span class="n">tmp_reg</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>	<span class="cm">/*power up PLL */</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">tmp_reg</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">clk_wait_for_pll_lock</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">clk_reg_disable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
		<span class="n">clk_reg_disable1</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>

		<span class="n">tmp_reg</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">);</span>
		<span class="n">tmp_reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x1ffff</span><span class="p">;</span>	<span class="cm">/*clear all settings, power down */</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">tmp_reg</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">);</span>
		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_m</span> <span class="o">*</span> <span class="n">parent_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">tmp_2p</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">RATE_PROPAGATES</span><span class="p">)</span>
		<span class="n">propagate_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>

	<span class="n">clk_reg_enable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*configure PER_CLK*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">per_clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">tmp</span><span class="p">;</span>

	<span class="n">tmp</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x1f</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">|=</span> <span class="p">((</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">/</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">);</span>
	<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*configure HCLK*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">hclk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x3</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">tmp</span> <span class="o">|=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>:
		<span class="n">tmp</span> <span class="o">|=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">scale_reg</span><span class="p">);</span>
	<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">hclk_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">1</span>:
	<span class="k">case</span> <span class="mi">4</span>:
		<span class="k">return</span> <span class="n">rate</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">per_clk_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">CLK_RATE_13MHZ</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">on_off_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">clk_reg_enable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">clk_reg_disable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">on_off_inv_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">clk_reg_disable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>	<span class="cm">/*enable bit is inverted */</span>
		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">clk_reg_enable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">on_off_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">rate</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">pll4_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&gt;</span> <span class="n">CLK_RATE_208MHZ</span><span class="p">)</span>
		<span class="n">rate</span> <span class="o">=</span> <span class="n">CLK_RATE_208MHZ</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">==</span> <span class="n">CLK_RATE_208MHZ</span> <span class="o">&amp;&amp;</span> <span class="n">hclk_ck</span><span class="p">.</span><span class="n">user_rate</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">rate</span> <span class="o">=</span> <span class="n">CLK_RATE_208MHZ</span> <span class="o">-</span> <span class="n">CLK_RATE_13MHZ</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">rate</span> <span class="o">-</span> <span class="p">(</span><span class="n">rate</span> <span class="o">%</span> <span class="p">(</span><span class="n">hclk_ck</span><span class="p">.</span><span class="n">user_rate</span> <span class="o">*</span> <span class="n">CLK_RATE_13MHZ</span><span class="p">)));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">pll3_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&gt;</span> <span class="n">CLK_RATE_208MHZ</span><span class="p">)</span>
		<span class="n">rate</span> <span class="o">=</span> <span class="n">CLK_RATE_208MHZ</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">rate</span> <span class="o">-</span> <span class="n">rate</span> <span class="o">%</span> <span class="n">CLK_RATE_13MHZ</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">pll5_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">rate</span> <span class="o">?</span> <span class="n">CLK_RATE_48MHZ</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">ck_13MHz_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">rate</span> <span class="o">?</span> <span class="n">CLK_RATE_13MHZ</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ck_13MHz_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">clk_reg_disable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>	<span class="cm">/*enable bit is inverted */</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">CLK_RATE_13MHZ</span><span class="p">;</span>
		<span class="n">ck_1MHz</span><span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">CLK_RATE_1MHZ</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">clk_reg_enable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ck_1MHz</span><span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pll1_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if 0</span><span class="c"> /* doesn&#39;t work on some boards, probably a HW BUG */</span>
<span class="c">	if (rate) {</span>
<span class="c">		clk_reg_disable(clk);	/*enable bit is inverted */</span>
<span class="c">		if (!clk_wait_for_pll_lock(clk)) {</span>
<span class="c">			clk-&gt;rate = CLK_RATE_13MHZ;</span>
<span class="c">		} else {</span>
<span class="c">			clk_reg_enable(clk);</span>
<span class="c">			clk-&gt;rate = 0;</span>
<span class="c">		}</span>

<span class="c">	} else {</span>
<span class="c">		clk_reg_enable(clk);</span>
<span class="c">		clk-&gt;rate = 0;</span>
<span class="c">	}</span>
<span class="cp">#endif</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Clock sources */</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">osc_13MHz</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;osc_13MHz&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">FIXED_RATE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">CLK_RATE_13MHZ</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">ck_13MHz</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ck_13MHz&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">osc_13MHz</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_13MHz_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_13MHz_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">OSC13CTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">CLK_RATE_13MHZ</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">osc_32KHz</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;osc_32KHz&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">FIXED_RATE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">CLK_RATE_32KHZ</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*attached to PLL5*/</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">ck_1MHz</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ck_1MHz&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">FIXED_RATE</span> <span class="o">|</span> <span class="n">PARENT_SET_RATE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_13MHz</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* PLL1 (397) - provides 13&#39; MHz clock */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">ck_pll1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ck_pll1&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">osc_32KHz</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_13MHz_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pll1_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">PLLCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">scale_reg</span> <span class="o">=</span> <span class="n">PLLCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">CLK_RATE_13MHZ</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* CPU/Bus PLL */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">ck_pll4</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ck_pll4&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_pll1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">RATE_PROPAGATES</span> <span class="o">|</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">propagate_next</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">per_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pll4_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pll160_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">CLK_RATE_208MHZ</span><span class="p">,</span>
	<span class="p">.</span><span class="n">scale_reg</span> <span class="o">=</span> <span class="n">HCLKPLLCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">PWRCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent_switch_reg</span> <span class="o">=</span> <span class="n">SYSCLKCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">set_13MHz_parent</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* USB PLL */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">ck_pll5</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ck_pll5&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_1MHz</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pll5_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pll160_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">scale_reg</span> <span class="o">=</span> <span class="n">USBCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">USBCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">18</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg1</span> <span class="o">=</span> <span class="n">USBCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift1</span> <span class="o">=</span> <span class="mi">17</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* XPERTTeak DSP PLL */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">ck_pll3</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ck_pll3&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_pll1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pll3_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pll160_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">scale_reg</span> <span class="o">=</span> <span class="n">DSPPLLCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">DSPCLKCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg1</span> <span class="o">=</span> <span class="n">DSPCLKCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift1</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent_switch_reg</span> <span class="o">=</span> <span class="n">DSPCLKCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">set_13MHz_parent</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">hclk_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;hclk_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_pll4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">PARENT_SET_RATE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hclk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hclk_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">scale_reg</span> <span class="o">=</span> <span class="n">HCLKDIVCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">user_rate</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">per_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;per_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_pll4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">FIXED_RATE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">propagate_next</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hclk_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">per_clk_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">per_clk_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">scale_reg</span> <span class="o">=</span> <span class="n">HCLKDIVCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">CLK_RATE_13MHZ</span><span class="p">,</span>
	<span class="p">.</span><span class="n">user_rate</span> <span class="o">=</span> <span class="n">CLK_RATE_13MHZ</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">m2hclk_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;m2hclk_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hclk_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_inv_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">PWRCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">vfp9_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vfp9_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_pll4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">VFP9CLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">keyscan_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;keyscan_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">osc_32KHz</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">KEYCLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">touch_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;touch_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">osc_32KHz</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">TSCLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">pwm1_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;pwm1_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">osc_32KHz</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">PWMCLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">pwm2_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;pwm2_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">osc_32KHz</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">PWMCLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">jpeg_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;jpeg_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hclk_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">JPEGCLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">ms_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ms_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_pll4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">MSCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">dum_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;dum_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hclk_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">DUMCLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">flash_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;flash_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hclk_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Only MLC clock supported */</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">FLASHCLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">i2c0_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;i2c0_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">per_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span> <span class="o">|</span> <span class="n">FIXED_RATE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">I2CCLKCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">13000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span> <span class="o">=</span> <span class="n">clk_reg_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span> <span class="o">=</span> <span class="n">clk_reg_disable</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">i2c1_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;i2c1_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">per_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span> <span class="o">|</span> <span class="n">FIXED_RATE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">I2CCLKCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">13000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span> <span class="o">=</span> <span class="n">clk_reg_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span> <span class="o">=</span> <span class="n">clk_reg_disable</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">i2c2_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;i2c2_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">per_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span> <span class="o">|</span> <span class="n">FIXED_RATE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">USB_OTG_CLKCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">13000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span> <span class="o">=</span> <span class="n">clk_reg_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span> <span class="o">=</span> <span class="n">clk_reg_disable</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">spi0_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;spi0_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hclk_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">SPICTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">spi1_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;spi1_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hclk_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">SPICTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">dma_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;dma_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hclk_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">DMACLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">uart3_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;uart3_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">per_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">UARTCLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">uart4_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;uart4_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">per_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">UARTCLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">uart5_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;uart5_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">per_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">UARTCLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">uart6_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;uart6_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">per_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">round_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_round_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">on_off_set_rate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">UARTCLKCTRL_REG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="n">wdt_ck</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wdt_ck&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">per_ck</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_reg</span> <span class="o">=</span> <span class="n">TIMCLKCTRL_REG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span> <span class="o">=</span> <span class="n">clk_reg_enable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span> <span class="o">=</span> <span class="n">clk_reg_disable</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* These clocks are visible outside this module</span>
<span class="cm"> * and can be initialized</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">onchip_clks</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">ck_13MHz</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">ck_pll1</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">ck_pll4</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">ck_pll5</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">ck_pll3</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">vfp9_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">m2hclk_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">hclk_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">dma_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">flash_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">dum_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">keyscan_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">pwm1_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">pwm2_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">jpeg_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">ms_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">touch_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">i2c0_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">i2c1_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">i2c2_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">spi0_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">spi1_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">uart3_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">uart4_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">uart5_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">uart6_ck</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">wdt_ck</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">clk_lookup</span> <span class="n">onchip_clkreg</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_13MHz</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;ck_13MHz&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_pll1</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;ck_pll1&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_pll4</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;ck_pll4&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_pll5</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;ck_pll5&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ck_pll3</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;ck_pll3&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">vfp9_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;vfp9_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">m2hclk_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;m2hclk_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hclk_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;hclk_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dma_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;dma_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">flash_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;flash_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dum_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;dum_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">keyscan_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;keyscan_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pwm1_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;pwm1_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pwm2_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;pwm2_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">jpeg_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;jpeg_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ms_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;ms_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">touch_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;touch_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">i2c0_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">dev_id</span> <span class="o">=</span> <span class="s">&quot;pnx-i2c.0&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">i2c1_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">dev_id</span> <span class="o">=</span> <span class="s">&quot;pnx-i2c.1&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">i2c2_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">dev_id</span> <span class="o">=</span> <span class="s">&quot;pnx-i2c.2&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spi0_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;spi0_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spi1_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;spi1_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">uart3_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;uart3_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">uart4_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;uart4_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">uart5_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;uart5_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">uart6_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">con_id</span> <span class="o">=</span> <span class="s">&quot;uart6_ck&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wdt_ck</span><span class="p">,</span>	<span class="p">.</span><span class="n">dev_id</span> <span class="o">=</span> <span class="s">&quot;pnx4008-watchdog&quot;</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">local_clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">WARN_ON</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">usecount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="o">--</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">usecount</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">disable</span><span class="p">)</span>
			<span class="n">clk</span><span class="o">-&gt;</span><span class="n">disable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">FIXED_RATE</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">&amp;&amp;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">set_rate</span><span class="p">)</span>
			<span class="n">clk</span><span class="o">-&gt;</span><span class="n">set_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span>
			<span class="n">local_clk_disable</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">local_clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">usecount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">local_clk_enable</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable</span><span class="p">)</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">FIXED_RATE</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">&amp;&amp;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">set_rate</span>
			    <span class="o">&amp;&amp;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">user_rate</span><span class="p">)</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">set_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">user_rate</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">local_clk_disable</span><span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">usecount</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">local_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">set_rate</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">user_rate</span> <span class="o">==</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">&amp;&amp;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* if clock enabled or rate not set */</span>
			<span class="n">clk</span><span class="o">-&gt;</span><span class="n">user_rate</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">round_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">set_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">user_rate</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">clk</span><span class="o">-&gt;</span><span class="n">user_rate</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">round_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">clk_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">FIXED_RATE</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">clock_lock</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PARENT_SET_RATE</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">user_rate</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">round_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="cm">/* parent clock needs to be refreshed</span>
<span class="cm">		   for the setting to take effect */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">local_set_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">clock_unlock</span><span class="p">();</span>

<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">clk_set_rate</span><span class="p">);</span>

<span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">clk_get_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">clock_lock</span><span class="p">();</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">;</span>
	<span class="n">clock_unlock</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">clk_get_rate</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">clk_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">clock_lock</span><span class="p">();</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">local_clk_enable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
	<span class="n">clock_unlock</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">clk_enable</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">clk_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">clock_lock</span><span class="p">();</span>
	<span class="n">local_clk_disable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
	<span class="n">clock_unlock</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">clk_disable</span><span class="p">);</span>

<span class="kt">long</span> <span class="nf">clk_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">long</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">clock_lock</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">round_rate</span><span class="p">)</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">round_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">;</span>
	<span class="n">clock_unlock</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">clk_round_rate</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">clk_set_parent</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">set_parent</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">clock_lock</span><span class="p">();</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">set_parent</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">parent</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span>
		<span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span>
	<span class="n">clock_unlock</span><span class="p">();</span>

<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">clk_set_parent</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">clk_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">**</span><span class="n">clkp</span><span class="p">;</span>

	<span class="cm">/* Disable autoclocking, as it doesn&#39;t seem to work */</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0xff</span><span class="p">,</span> <span class="n">AUTOCLK_CTRL</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">clkp</span> <span class="o">=</span> <span class="n">onchip_clks</span><span class="p">;</span> <span class="n">clkp</span> <span class="o">&lt;</span> <span class="n">onchip_clks</span> <span class="o">+</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">onchip_clks</span><span class="p">);</span>
	     <span class="n">clkp</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span> <span class="o">=</span> <span class="o">*</span><span class="n">clkp</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">NEEDS_INITIALIZATION</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">set_rate</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">clk</span><span class="o">-&gt;</span><span class="n">user_rate</span> <span class="o">=</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">;</span>
				<span class="n">local_set_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">user_rate</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">set_parent</span><span class="p">)</span>
					<span class="n">clk</span><span class="o">-&gt;</span><span class="n">set_parent</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable</span> <span class="o">&amp;&amp;</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">usecount</span><span class="p">)</span>
				<span class="n">clk</span><span class="o">-&gt;</span><span class="n">enable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">disable</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">clk</span><span class="o">-&gt;</span><span class="n">usecount</span><span class="p">)</span>
				<span class="n">clk</span><span class="o">-&gt;</span><span class="n">disable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;%s: clock %s, rate %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">__func__</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">clk</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">local_clk_enable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ck_pll4</span><span class="p">);</span>

	<span class="cm">/* if ck_13MHz is not used, disable it. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ck_13MHz</span><span class="p">.</span><span class="n">usecount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">local_clk_disable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ck_13MHz</span><span class="p">);</span>

	<span class="cm">/* Disable autoclocking */</span>
	<span class="n">__raw_writeb</span><span class="p">(</span><span class="mh">0xff</span><span class="p">,</span> <span class="n">AUTOCLK_CTRL</span><span class="p">);</span>

	<span class="n">clkdev_add_table</span><span class="p">(</span><span class="n">onchip_clkreg</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">onchip_clkreg</span><span class="p">));</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">arch_initcall</span><span class="p">(</span><span class="n">clk_init</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
