<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-omap2 › usb-host.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>usb-host.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * usb-host.c - OMAP USB Host</span>
<span class="cm"> *</span>
<span class="cm"> * This file will contain the board specific details for the</span>
<span class="cm"> * Synopsys EHCI/OHCI host controller on OMAP3430 and onwards</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2007-2011 Texas Instruments</span>
<span class="cm"> * Author: Vikram Pandita &lt;vikram.pandita@ti.com&gt;</span>
<span class="cm"> * Author: Keshava Munegowda &lt;keshava_mgowda@ti.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Generalization by:</span>
<span class="cm"> * Felipe Balbi &lt;balbi@ti.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/dma-mapping.h&gt;</span>

<span class="cp">#include &lt;asm/io.h&gt;</span>

<span class="cp">#include &lt;mach/hardware.h&gt;</span>
<span class="cp">#include &lt;mach/irqs.h&gt;</span>
<span class="cp">#include &lt;plat/usb.h&gt;</span>
<span class="cp">#include &lt;plat/omap_device.h&gt;</span>

<span class="cp">#include &quot;mux.h&quot;</span>

<span class="cp">#ifdef CONFIG_MFD_OMAP_USB_HOST</span>

<span class="cp">#define OMAP_USBHS_DEVICE	&quot;usbhs_omap&quot;</span>
<span class="cp">#define	USBHS_UHH_HWMODNAME	&quot;usb_host_hs&quot;</span>
<span class="cp">#define USBHS_TLL_HWMODNAME	&quot;usb_tll_hs&quot;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">usbhs_omap_platform_data</span>		<span class="n">usbhs_data</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">ehci_hcd_omap_platform_data</span>	<span class="n">ehci_data</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">ohci_hcd_omap_platform_data</span>	<span class="n">ohci_data</span><span class="p">;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">omap_device_pm_latency</span> <span class="n">omap_uhhtll_latency</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	  <span class="p">{</span>
		<span class="p">.</span><span class="n">deactivate_func</span> <span class="o">=</span> <span class="n">omap_device_idle_hwmods</span><span class="p">,</span>
		<span class="p">.</span><span class="n">activate_func</span>	 <span class="o">=</span> <span class="n">omap_device_enable_hwmods</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">OMAP_DEVICE_LATENCY_AUTO_ADJUST</span><span class="p">,</span>
	  <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* MUX settings for EHCI pins */</span>
<span class="cm">/*</span>
<span class="cm"> * setup_ehci_io_mux - initialize IO pad mux for USBHOST</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">setup_ehci_io_mux</span><span class="p">(</span><span class="k">const</span> <span class="k">enum</span> <span class="n">usbhs_omap_port_mode</span> <span class="o">*</span><span class="n">port_mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">port_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OMAP_EHCI_PORT_MODE_PHY</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_stp&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_clk&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_dir&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_nxt&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_data0&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_data1&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_data2&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_data3&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_data4&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_data5&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_data6&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_data7&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_EHCI_PORT_MODE_TLL</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_stp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLUP</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_clk&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_dir&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_nxt&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_data0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_data1&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_data2&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_data3&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_data4&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_data5&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_data6&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb1_tll_data7&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_USBHS_PORT_MODE_UNUSED</span>:
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">port_mode</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OMAP_EHCI_PORT_MODE_PHY</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_stp&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_clk&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_dir&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_nxt&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_data0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_data1&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_data2&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_data3&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_data4&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_data5&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_data6&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_data7&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_EHCI_PORT_MODE_TLL</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_stp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLUP</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_clk&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_dir&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_nxt&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_data0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_data1&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_data2&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_data3&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_data4&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_data5&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_data6&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb2_tll_data7&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_USBHS_PORT_MODE_UNUSED</span>:
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">port_mode</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OMAP_EHCI_PORT_MODE_PHY</span>:
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;Port3 can&#39;t be used in PHY mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_EHCI_PORT_MODE_TLL</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_stp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLUP</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_clk&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_dir&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_nxt&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_data0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_data1&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_data2&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_data3&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_data4&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_data5&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_data6&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;hsusb3_tll_data7&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_USBHS_PORT_MODE_UNUSED</span>:
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">setup_4430ehci_io_mux</span><span class="p">(</span><span class="k">const</span> <span class="k">enum</span> <span class="n">usbhs_omap_port_mode</span> <span class="o">*</span><span class="n">port_mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">port_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OMAP_EHCI_PORT_MODE_PHY</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_stp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_clk&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_dir&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_nxt&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_dat0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_dat1&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_dat2&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_dat3&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_dat4&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_dat5&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_dat6&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpiphy_dat7&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_EHCI_PORT_MODE_TLL</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_stp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLUP</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_clk&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_dir&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_nxt&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_dat0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_dat1&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_dat2&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_dat3&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_dat4&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_dat5&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_dat6&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_ulpitll_dat7&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_USBHS_PORT_MODE_UNUSED</span>:
	<span class="nl">default:</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">port_mode</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OMAP_EHCI_PORT_MODE_PHY</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_stp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_clk&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_dir&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_nxt&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_dat0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_dat1&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_dat2&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_dat3&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_dat4&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_dat5&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_dat6&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpiphy_dat7&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_EHCI_PORT_MODE_TLL</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_stp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLUP</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_clk&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_dir&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_nxt&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_dat0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_dat1&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_dat2&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_dat3&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_dat4&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_dat5&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_dat6&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_ulpitll_dat7&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_USBHS_PORT_MODE_UNUSED</span>:
	<span class="nl">default:</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">setup_ohci_io_mux</span><span class="p">(</span><span class="k">const</span> <span class="k">enum</span> <span class="n">usbhs_omap_port_mode</span> <span class="o">*</span><span class="n">port_mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">port_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_6PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_6PIN_DPDM</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_6PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_6PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm1_rxdp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm1_rxdm&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_4PIN_DPDM</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_4PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm1_rxrcv&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_3PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_3PIN_DATSE0</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm1_txen_n&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_2PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_2PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm1_txse0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm1_txdat&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_USBHS_PORT_MODE_UNUSED</span>:
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">port_mode</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_6PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_6PIN_DPDM</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_6PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_6PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm2_rxdp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm2_rxdm&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_4PIN_DPDM</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_4PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm2_rxrcv&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_3PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_3PIN_DATSE0</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm2_txen_n&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_2PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_2PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm2_txse0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm2_txdat&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_USBHS_PORT_MODE_UNUSED</span>:
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">port_mode</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_6PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_6PIN_DPDM</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_6PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_6PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm3_rxdp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm3_rxdm&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_4PIN_DPDM</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_4PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm3_rxrcv&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_3PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_3PIN_DATSE0</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm3_txen_n&quot;</span><span class="p">,</span> <span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_2PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_2PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm3_txse0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;mm3_txdat&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OMAP_USBHS_PORT_MODE_UNUSED</span>:
		<span class="cm">/* FALLTHROUGH */</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">setup_4430ohci_io_mux</span><span class="p">(</span><span class="k">const</span> <span class="k">enum</span> <span class="n">usbhs_omap_port_mode</span> <span class="o">*</span><span class="n">port_mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">port_mode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_6PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_6PIN_DPDM</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_6PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_6PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_mm_rxdp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_mm_rxdm&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_4PIN_DPDM</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_4PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_mm_rxrcv&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_3PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_3PIN_DATSE0</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_mm_txen&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>


	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_2PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_2PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_mm_txdat&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb1_mm_txse0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">OMAP_USBHS_PORT_MODE_UNUSED</span>:
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">port_mode</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_6PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_6PIN_DPDM</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_6PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_6PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_mm_rxdp&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_mm_rxdm&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_4PIN_DPDM</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_4PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_mm_rxrcv&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_PHY_3PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_3PIN_DATSE0</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_mm_txen&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>


	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_2PIN_DATSE0</span>:
	<span class="k">case</span> <span class="n">OMAP_OHCI_PORT_MODE_TLL_2PIN_DPDM</span>:
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_mm_txdat&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="n">omap_mux_init_signal</span><span class="p">(</span><span class="s">&quot;usbb2_mm_txse0&quot;</span><span class="p">,</span>
			<span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">OMAP_USBHS_PORT_MODE_UNUSED</span>:
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">usbhs_init</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">usbhs_omap_board_data</span> <span class="o">*</span><span class="n">pdata</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">omap_hwmod</span>	<span class="o">*</span><span class="n">oh</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">platform_device</span>	<span class="o">*</span><span class="n">pdev</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">bus_id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">OMAP3_HS_USB_PORTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">usbhs_data</span><span class="p">.</span><span class="n">port_mode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">port_mode</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">ohci_data</span><span class="p">.</span><span class="n">port_mode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">port_mode</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">ehci_data</span><span class="p">.</span><span class="n">port_mode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">port_mode</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">ehci_data</span><span class="p">.</span><span class="n">reset_gpio_port</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">reset_gpio_port</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">ehci_data</span><span class="p">.</span><span class="n">regulator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">regulator</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="n">ehci_data</span><span class="p">.</span><span class="n">phy_reset</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">phy_reset</span><span class="p">;</span>
	<span class="n">ohci_data</span><span class="p">.</span><span class="n">es2_compatibility</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">es2_compatibility</span><span class="p">;</span>
	<span class="n">usbhs_data</span><span class="p">.</span><span class="n">ehci_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ehci_data</span><span class="p">;</span>
	<span class="n">usbhs_data</span><span class="p">.</span><span class="n">ohci_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ohci_data</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cpu_is_omap34xx</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">setup_ehci_io_mux</span><span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">port_mode</span><span class="p">);</span>
		<span class="n">setup_ohci_io_mux</span><span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">port_mode</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cpu_is_omap44xx</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">setup_4430ehci_io_mux</span><span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">port_mode</span><span class="p">);</span>
		<span class="n">setup_4430ohci_io_mux</span><span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">port_mode</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">oh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">omap_hwmod_lookup</span><span class="p">(</span><span class="n">USBHS_UHH_HWMODNAME</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">oh</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Could not look up %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">USBHS_UHH_HWMODNAME</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">oh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">omap_hwmod_lookup</span><span class="p">(</span><span class="n">USBHS_TLL_HWMODNAME</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">oh</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Could not look up %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">USBHS_TLL_HWMODNAME</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">pdev</span> <span class="o">=</span> <span class="n">omap_device_build_ss</span><span class="p">(</span><span class="n">OMAP_USBHS_DEVICE</span><span class="p">,</span> <span class="n">bus_id</span><span class="p">,</span> <span class="n">oh</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
				<span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">usbhs_data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">usbhs_data</span><span class="p">),</span>
				<span class="n">omap_uhhtll_latency</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap_uhhtll_latency</span><span class="p">),</span> <span class="nb">false</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">pdev</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Could not build hwmod devices %s,%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">USBHS_UHH_HWMODNAME</span><span class="p">,</span> <span class="n">USBHS_TLL_HWMODNAME</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cp">#else</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">usbhs_init</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">usbhs_omap_board_data</span> <span class="o">*</span><span class="n">pdata</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
