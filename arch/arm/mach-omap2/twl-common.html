<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-omap2 › twl-common.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>twl-common.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * twl-common.c</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2011 Texas Instruments, Inc..</span>
<span class="cm"> * Author: Peter Ujfalusi &lt;peter.ujfalusi@ti.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License</span>
<span class="cm"> * version 2 as published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> * General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA</span>
<span class="cm"> * 02110-1301 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/i2c/twl.h&gt;</span>
<span class="cp">#include &lt;linux/gpio.h&gt;</span>
<span class="cp">#include &lt;linux/regulator/machine.h&gt;</span>
<span class="cp">#include &lt;linux/regulator/fixed.h&gt;</span>

<span class="cp">#include &lt;plat/i2c.h&gt;</span>
<span class="cp">#include &lt;plat/usb.h&gt;</span>

<span class="cp">#include &quot;twl-common.h&quot;</span>
<span class="cp">#include &quot;pm.h&quot;</span>
<span class="cp">#include &quot;voltage.h&quot;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">pmic_i2c_board_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">addr</span>		<span class="o">=</span> <span class="mh">0x48</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">I2C_CLIENT_WAKE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">omap4_i2c1_board_info</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">addr</span>		<span class="o">=</span> <span class="mh">0x48</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">I2C_CLIENT_WAKE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;twl6040&quot;</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">),</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">twl_set_voltage</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">target_uV</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">voltagedomain</span> <span class="o">*</span><span class="n">voltdm</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">voltagedomain</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">voltdm_scale</span><span class="p">(</span><span class="n">voltdm</span><span class="p">,</span> <span class="n">target_uV</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">twl_get_voltage</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">voltagedomain</span> <span class="o">*</span><span class="n">voltdm</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">voltagedomain</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">voltdm_get_voltage</span><span class="p">(</span><span class="n">voltdm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap_pmic_init</span><span class="p">(</span><span class="kt">int</span> <span class="n">bus</span><span class="p">,</span> <span class="n">u32</span> <span class="n">clkrate</span><span class="p">,</span>
			   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pmic_type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pmic_irq</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">twl4030_platform_data</span> <span class="o">*</span><span class="n">pmic_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">strncpy</span><span class="p">(</span><span class="n">pmic_i2c_board_info</span><span class="p">.</span><span class="n">type</span><span class="p">,</span> <span class="n">pmic_type</span><span class="p">,</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">pmic_i2c_board_info</span><span class="p">.</span><span class="n">type</span><span class="p">));</span>
	<span class="n">pmic_i2c_board_info</span><span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">pmic_irq</span><span class="p">;</span>
	<span class="n">pmic_i2c_board_info</span><span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="n">pmic_data</span><span class="p">;</span>

	<span class="n">omap_register_i2c_bus</span><span class="p">(</span><span class="n">bus</span><span class="p">,</span> <span class="n">clkrate</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pmic_i2c_board_info</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap4_pmic_init</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pmic_type</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">twl4030_platform_data</span> <span class="o">*</span><span class="n">pmic_data</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">twl6040_platform_data</span> <span class="o">*</span><span class="n">twl6040_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">twl6040_irq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* PMIC part*/</span>
	<span class="n">strncpy</span><span class="p">(</span><span class="n">omap4_i2c1_board_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">type</span><span class="p">,</span> <span class="n">pmic_type</span><span class="p">,</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">omap4_i2c1_board_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">type</span><span class="p">));</span>
	<span class="n">omap4_i2c1_board_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">irq</span> <span class="o">=</span> <span class="n">OMAP44XX_IRQ_SYS_1N</span><span class="p">;</span>
	<span class="n">omap4_i2c1_board_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">platform_data</span> <span class="o">=</span> <span class="n">pmic_data</span><span class="p">;</span>

	<span class="cm">/* TWL6040 audio IC part */</span>
	<span class="n">omap4_i2c1_board_info</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">irq</span> <span class="o">=</span> <span class="n">twl6040_irq</span><span class="p">;</span>
	<span class="n">omap4_i2c1_board_info</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">platform_data</span> <span class="o">=</span> <span class="n">twl6040_data</span><span class="p">;</span>

	<span class="n">omap_register_i2c_bus</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">omap4_i2c1_board_info</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap_pmic_late_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* Init the OMAP TWL parameters (if PMIC has been registerd) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pmic_i2c_board_info</span><span class="p">.</span><span class="n">irq</span><span class="p">)</span>
		<span class="n">omap3_twl_init</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">omap4_i2c1_board_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">irq</span><span class="p">)</span>
		<span class="n">omap4_twl_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_ARCH_OMAP3)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_usb_data</span> <span class="n">omap3_usb_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">usb_mode</span>	<span class="o">=</span> <span class="n">T2_USB_MODE_ULPI</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">omap3_batt_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/* 0 C */</span>
<span class="mi">30800</span><span class="p">,</span> <span class="mi">29500</span><span class="p">,</span> <span class="mi">28300</span><span class="p">,</span> <span class="mi">27100</span><span class="p">,</span>
<span class="mi">26000</span><span class="p">,</span> <span class="mi">24900</span><span class="p">,</span> <span class="mi">23900</span><span class="p">,</span> <span class="mi">22900</span><span class="p">,</span> <span class="mi">22000</span><span class="p">,</span> <span class="mi">21100</span><span class="p">,</span> <span class="mi">20300</span><span class="p">,</span> <span class="mi">19400</span><span class="p">,</span> <span class="mi">18700</span><span class="p">,</span> <span class="mi">17900</span><span class="p">,</span>
<span class="mi">17200</span><span class="p">,</span> <span class="mi">16500</span><span class="p">,</span> <span class="mi">15900</span><span class="p">,</span> <span class="mi">15300</span><span class="p">,</span> <span class="mi">14700</span><span class="p">,</span> <span class="mi">14100</span><span class="p">,</span> <span class="mi">13600</span><span class="p">,</span> <span class="mi">13100</span><span class="p">,</span> <span class="mi">12600</span><span class="p">,</span> <span class="mi">12100</span><span class="p">,</span>
<span class="mi">11600</span><span class="p">,</span> <span class="mi">11200</span><span class="p">,</span> <span class="mi">10800</span><span class="p">,</span> <span class="mi">10400</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">9630</span><span class="p">,</span>  <span class="mi">9280</span><span class="p">,</span>  <span class="mi">8950</span><span class="p">,</span>  <span class="mi">8620</span><span class="p">,</span>  <span class="mi">8310</span><span class="p">,</span>
<span class="mi">8020</span><span class="p">,</span>  <span class="mi">7730</span><span class="p">,</span>  <span class="mi">7460</span><span class="p">,</span>  <span class="mi">7200</span><span class="p">,</span>  <span class="mi">6950</span><span class="p">,</span>  <span class="mi">6710</span><span class="p">,</span>  <span class="mi">6470</span><span class="p">,</span>  <span class="mi">6250</span><span class="p">,</span>  <span class="mi">6040</span><span class="p">,</span>  <span class="mi">5830</span><span class="p">,</span>
<span class="mi">5640</span><span class="p">,</span>  <span class="mi">5450</span><span class="p">,</span>  <span class="mi">5260</span><span class="p">,</span>  <span class="mi">5090</span><span class="p">,</span>  <span class="mi">4920</span><span class="p">,</span>  <span class="mi">4760</span><span class="p">,</span>  <span class="mi">4600</span><span class="p">,</span>  <span class="mi">4450</span><span class="p">,</span>  <span class="mi">4310</span><span class="p">,</span>  <span class="mi">4170</span><span class="p">,</span>
<span class="mi">4040</span><span class="p">,</span>  <span class="mi">3910</span><span class="p">,</span>  <span class="mi">3790</span><span class="p">,</span>  <span class="mi">3670</span><span class="p">,</span>  <span class="mi">3550</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_bci_platform_data</span> <span class="n">omap3_bci_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">battery_tmp_tbl</span>	<span class="o">=</span> <span class="n">omap3_batt_table</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tblsize</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap3_batt_table</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_madc_platform_data</span> <span class="n">omap3_madc_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">irq_line</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_codec_data</span> <span class="n">omap3_codec</span><span class="p">;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_audio_data</span> <span class="n">omap3_audio_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">audio_mclk</span> <span class="o">=</span> <span class="mi">26000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">codec</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap3_codec</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">omap3_vdda_dac_supplies</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vdda_dac&quot;</span><span class="p">,</span> <span class="s">&quot;omapdss_venc&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap3_vdac_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap3_vdda_dac_supplies</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>	<span class="o">=</span> <span class="n">omap3_vdda_dac_supplies</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">omap3_vpll2_supplies</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vdds_dsi&quot;</span><span class="p">,</span> <span class="s">&quot;omapdss&quot;</span><span class="p">),</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vdds_dsi&quot;</span><span class="p">,</span> <span class="s">&quot;omapdss_dsi.0&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap3_vpll2_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>                 <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>                 <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>       <span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>         <span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap3_vpll2_supplies</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>		<span class="o">=</span> <span class="n">omap3_vpll2_supplies</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">omap3_vdd1_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vcc&quot;</span><span class="p">,</span> <span class="s">&quot;mpu.0&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">omap3_vdd2_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vcc&quot;</span><span class="p">,</span> <span class="s">&quot;l3_main.0&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap3_vdd1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;vdd_mpu_iva&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">600000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1450000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap3_vdd1_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>		<span class="o">=</span> <span class="n">omap3_vdd1_supply</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap3_vdd2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;vdd_core&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">600000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1450000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap3_vdd2_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>		<span class="o">=</span> <span class="n">omap3_vdd2_supply</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl_regulator_driver_data</span> <span class="n">omap3_vdd1_drvdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">get_voltage</span> <span class="o">=</span> <span class="n">twl_get_voltage</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">twl_set_voltage</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl_regulator_driver_data</span> <span class="n">omap3_vdd2_drvdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">get_voltage</span> <span class="o">=</span> <span class="n">twl_get_voltage</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">twl_set_voltage</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap3_pmic_get_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">twl4030_platform_data</span> <span class="o">*</span><span class="n">pmic_data</span><span class="p">,</span>
				  <span class="n">u32</span> <span class="n">pdata_flags</span><span class="p">,</span> <span class="n">u32</span> <span class="n">regulators_flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">irq_base</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">irq_base</span> <span class="o">=</span> <span class="n">TWL4030_IRQ_BASE</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">irq_end</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">irq_end</span> <span class="o">=</span> <span class="n">TWL4030_IRQ_END</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdd1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">omap3_vdd1</span><span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap3_vdd1_drvdata</span><span class="p">;</span>
		<span class="n">omap3_vdd1_drvdata</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">voltdm_lookup</span><span class="p">(</span><span class="s">&quot;mpu_iva&quot;</span><span class="p">);</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdd1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap3_vdd1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdd2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">omap3_vdd2</span><span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap3_vdd2_drvdata</span><span class="p">;</span>
		<span class="n">omap3_vdd2_drvdata</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">voltdm_lookup</span><span class="p">(</span><span class="s">&quot;core&quot;</span><span class="p">);</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdd2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap3_vdd2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Common platform data configurations */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pdata_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_PDATA_USB</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">usb</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">usb</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap3_usb_pdata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pdata_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_PDATA_BCI</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">bci</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">bci</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap3_bci_pdata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pdata_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_PDATA_MADC</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">madc</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">madc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap3_madc_pdata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pdata_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_PDATA_AUDIO</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">audio</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">audio</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap3_audio_pdata</span><span class="p">;</span>

	<span class="cm">/* Common regulator configurations */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_VDAC</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdac</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdac</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap3_vdac_idata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_VPLL2</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vpll2</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vpll2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap3_vpll2_idata</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_ARCH_OMAP3 */</span><span class="cp"></span>

<span class="cp">#if defined(CONFIG_ARCH_OMAP4)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_usb_data</span> <span class="n">omap4_usb_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_init</span>	<span class="o">=</span> <span class="n">omap4430_phy_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_exit</span>	<span class="o">=</span> <span class="n">omap4430_phy_exit</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_power</span>	<span class="o">=</span> <span class="n">omap4430_phy_power</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_set_clock</span>	<span class="o">=</span> <span class="n">omap4430_phy_set_clk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_suspend</span>	<span class="o">=</span> <span class="n">omap4430_phy_suspend</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_vdac_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">supply_regulator</span>	<span class="o">=</span> <span class="s">&quot;V2V1&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_vaux2_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1200000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_vaux3_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">3000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">omap4_vmmc_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vmmc&quot;</span><span class="p">,</span> <span class="s">&quot;omap_hsmmc.0&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* VMMC1 for MMC1 card */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_vmmc_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1200000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">3000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>  <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap4_vmmc_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>      <span class="o">=</span> <span class="n">omap4_vmmc_supply</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_vpp_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">2500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_vana_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">2100000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">2100000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">omap4_vcxio_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vdds_dsi&quot;</span><span class="p">,</span> <span class="s">&quot;omapdss_dss&quot;</span><span class="p">),</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vdds_dsi&quot;</span><span class="p">,</span> <span class="s">&quot;omapdss_dsi.0&quot;</span><span class="p">),</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vdds_dsi&quot;</span><span class="p">,</span> <span class="s">&quot;omapdss_dsi.1&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_vcxio_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">always_on</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap4_vcxio_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>	<span class="o">=</span> <span class="n">omap4_vcxio_supply</span><span class="p">,</span>
	<span class="p">.</span><span class="n">supply_regulator</span>	<span class="o">=</span> <span class="s">&quot;V2V1&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_vusb_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">3300000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">3300000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_clk32kg_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">omap4_vdd1_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vcc&quot;</span><span class="p">,</span> <span class="s">&quot;mpu.0&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">omap4_vdd2_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vcc&quot;</span><span class="p">,</span> <span class="s">&quot;iva.0&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">omap4_vdd3_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vcc&quot;</span><span class="p">,</span> <span class="s">&quot;l3_main.0&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_vdd1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;vdd_mpu&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap4_vdd1_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>		<span class="o">=</span> <span class="n">omap4_vdd1_supply</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_vdd2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;vdd_iva&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap4_vdd2_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>		<span class="o">=</span> <span class="n">omap4_vdd2_supply</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_vdd3</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;vdd_core&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap4_vdd3_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>		<span class="o">=</span> <span class="n">omap4_vdd3_supply</span><span class="p">,</span>
<span class="p">};</span>


<span class="k">static</span> <span class="k">struct</span> <span class="n">twl_regulator_driver_data</span> <span class="n">omap4_vdd1_drvdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">get_voltage</span> <span class="o">=</span> <span class="n">twl_get_voltage</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">twl_set_voltage</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl_regulator_driver_data</span> <span class="n">omap4_vdd2_drvdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">get_voltage</span> <span class="o">=</span> <span class="n">twl_get_voltage</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">twl_set_voltage</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl_regulator_driver_data</span> <span class="n">omap4_vdd3_drvdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">get_voltage</span> <span class="o">=</span> <span class="n">twl_get_voltage</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">twl_set_voltage</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">omap4_v1v8_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vio&quot;</span><span class="p">,</span> <span class="s">&quot;1-004b&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_v1v8_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">always_on</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap4_v1v8_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>	<span class="o">=</span> <span class="n">omap4_v1v8_supply</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">omap4_v2v1_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;v2v1&quot;</span><span class="p">,</span> <span class="s">&quot;1-004b&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">omap4_v2v1_idata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">2100000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">2100000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap4_v2v1_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>	<span class="o">=</span> <span class="n">omap4_v2v1_supply</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap4_pmic_get_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">twl4030_platform_data</span> <span class="o">*</span><span class="n">pmic_data</span><span class="p">,</span>
				  <span class="n">u32</span> <span class="n">pdata_flags</span><span class="p">,</span> <span class="n">u32</span> <span class="n">regulators_flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">irq_base</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">irq_base</span> <span class="o">=</span> <span class="n">TWL6030_IRQ_BASE</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">irq_end</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">irq_end</span> <span class="o">=</span> <span class="n">TWL6030_IRQ_END</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdd1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">omap4_vdd1</span><span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vdd1_drvdata</span><span class="p">;</span>
		<span class="n">omap4_vdd1_drvdata</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">voltdm_lookup</span><span class="p">(</span><span class="s">&quot;mpu&quot;</span><span class="p">);</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdd1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vdd1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdd2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">omap4_vdd2</span><span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vdd2_drvdata</span><span class="p">;</span>
		<span class="n">omap4_vdd2_drvdata</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">voltdm_lookup</span><span class="p">(</span><span class="s">&quot;iva&quot;</span><span class="p">);</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdd2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vdd2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdd3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">omap4_vdd3</span><span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vdd3_drvdata</span><span class="p">;</span>
		<span class="n">omap4_vdd3_drvdata</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">voltdm_lookup</span><span class="p">(</span><span class="s">&quot;core&quot;</span><span class="p">);</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdd3</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vdd3</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Common platform data configurations */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pdata_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_PDATA_USB</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">usb</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">usb</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_usb_pdata</span><span class="p">;</span>

	<span class="cm">/* Common regulator configurations */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_VDAC</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdac</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vdac</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vdac_idata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_VAUX2</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vaux2</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vaux2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vaux2_idata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_VAUX3</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vaux3</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vaux3</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vaux3_idata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_VMMC</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vmmc</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vmmc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vmmc_idata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_VPP</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vpp</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vpp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vpp_idata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_VANA</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vana</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vana</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vana_idata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_VCXIO</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vcxio</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vcxio</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vcxio_idata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_VUSB</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vusb</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">vusb</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_vusb_idata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_CLK32KG</span> <span class="o">&amp;&amp;</span>
	    <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">clk32kg</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">clk32kg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_clk32kg_idata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_V1V8</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">v1v8</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">v1v8</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_v1v8_idata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">regulators_flags</span> <span class="o">&amp;</span> <span class="n">TWL_COMMON_REGULATOR_V2V1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">v2v1</span><span class="p">)</span>
		<span class="n">pmic_data</span><span class="o">-&gt;</span><span class="n">v2v1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">omap4_v2v1_idata</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_ARCH_OMAP4 */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
