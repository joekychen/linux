<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-omap2 › io.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>io.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * linux/arch/arm/mach-omap2/io.c</span>
<span class="cm"> *</span>
<span class="cm"> * OMAP2 I/O mapping code</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2005 Nokia Corporation</span>
<span class="cm"> * Copyright (C) 2007-2009 Texas Instruments</span>
<span class="cm"> *</span>
<span class="cm"> * Author:</span>
<span class="cm"> *	Juha Yrjola &lt;juha.yrjola@nokia.com&gt;</span>
<span class="cm"> *	Syed Khasim &lt;x0khasim@ti.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Added OMAP4 support - Santosh Shilimkar &lt;santosh.shilimkar@ti.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/clk.h&gt;</span>

<span class="cp">#include &lt;asm/tlb.h&gt;</span>
<span class="cp">#include &lt;asm/mach/map.h&gt;</span>

<span class="cp">#include &lt;plat/sram.h&gt;</span>
<span class="cp">#include &lt;plat/sdrc.h&gt;</span>
<span class="cp">#include &lt;plat/serial.h&gt;</span>
<span class="cp">#include &lt;plat/omap-pm.h&gt;</span>
<span class="cp">#include &lt;plat/omap_hwmod.h&gt;</span>
<span class="cp">#include &lt;plat/multi.h&gt;</span>
<span class="cp">#include &lt;plat/dma.h&gt;</span>

<span class="cp">#include &quot;iomap.h&quot;</span>
<span class="cp">#include &quot;voltage.h&quot;</span>
<span class="cp">#include &quot;powerdomain.h&quot;</span>
<span class="cp">#include &quot;clockdomain.h&quot;</span>
<span class="cp">#include &quot;common.h&quot;</span>
<span class="cp">#include &quot;clock2xxx.h&quot;</span>
<span class="cp">#include &quot;clock3xxx.h&quot;</span>
<span class="cp">#include &quot;clock44xx.h&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * The machine specific code may provide the extra mapping besides the</span>
<span class="cm"> * default mapping provided here.</span>
<span class="cm"> */</span>

<span class="cp">#if defined(CONFIG_SOC_OMAP2420) || defined(CONFIG_SOC_OMAP2430)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">omap24xx_io_desc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L3_24XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L3_24XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L3_24XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L4_24XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L4_24XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L4_24XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_SOC_OMAP2420</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">omap242x_io_desc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">DSP_MEM_2420_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">DSP_MEM_2420_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">DSP_MEM_2420_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">DSP_IPI_2420_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">DSP_IPI_2420_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">DSP_IPI_2420_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">DSP_MMU_2420_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">DSP_MMU_2420_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">DSP_MMU_2420_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_SOC_OMAP2430</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">omap243x_io_desc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L4_WK_243X_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L4_WK_243X_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L4_WK_243X_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">OMAP243X_GPMC_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">OMAP243X_GPMC_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">OMAP243X_GPMC_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">OMAP243X_SDRC_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">OMAP243X_SDRC_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">OMAP243X_SDRC_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">OMAP243X_SMS_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">OMAP243X_SMS_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">OMAP243X_SMS_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
<span class="p">};</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef	CONFIG_ARCH_OMAP3</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">omap34xx_io_desc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L3_34XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L3_34XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L3_34XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L4_34XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L4_34XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L4_34XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">OMAP34XX_GPMC_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">OMAP34XX_GPMC_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">OMAP34XX_GPMC_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">OMAP343X_SMS_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">OMAP343X_SMS_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">OMAP343X_SMS_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">OMAP343X_SDRC_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">OMAP343X_SDRC_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">OMAP343X_SDRC_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L4_PER_34XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L4_PER_34XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L4_PER_34XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L4_EMU_34XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L4_EMU_34XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L4_EMU_34XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
<span class="cp">#if defined(CONFIG_DEBUG_LL) &amp;&amp;							\</span>
<span class="cp">	(defined(CONFIG_MACH_OMAP_ZOOM2) || defined(CONFIG_MACH_OMAP_ZOOM3))</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">ZOOM_UART_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">ZOOM_UART_BASE</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">SZ_1M</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_SOC_TI81XX</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">omapti81xx_io_desc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L4_34XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L4_34XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L4_34XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_SOC_AM33XX</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">omapam33xx_io_desc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L4_34XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L4_34XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L4_34XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L4_WK_AM33XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L4_WK_AM33XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L4_WK_AM33XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef	CONFIG_ARCH_OMAP4</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">omap44xx_io_desc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L3_44XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L3_44XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L3_44XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L4_44XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L4_44XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L4_44XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">L4_PER_44XX_VIRT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">L4_PER_44XX_PHYS</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">L4_PER_44XX_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#ifdef CONFIG_OMAP4_ERRATA_I688</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="n">OMAP4_SRAM_VA</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="n">OMAP4_SRAM_PA</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">PAGE_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_MEMORY_SO</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>

<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_SOC_OMAP2420</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap242x_map_common_io</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">omap24xx_io_desc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap24xx_io_desc</span><span class="p">));</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">omap242x_io_desc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap242x_io_desc</span><span class="p">));</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_SOC_OMAP2430</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap243x_map_common_io</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">omap24xx_io_desc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap24xx_io_desc</span><span class="p">));</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">omap243x_io_desc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap243x_io_desc</span><span class="p">));</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_ARCH_OMAP3</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap34xx_map_common_io</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">omap34xx_io_desc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap34xx_io_desc</span><span class="p">));</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_SOC_TI81XX</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omapti81xx_map_common_io</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">omapti81xx_io_desc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omapti81xx_io_desc</span><span class="p">));</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_SOC_AM33XX</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omapam33xx_map_common_io</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">omapam33xx_io_desc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omapam33xx_io_desc</span><span class="p">));</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_ARCH_OMAP4</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap44xx_map_common_io</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">omap44xx_io_desc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">omap44xx_io_desc</span><span class="p">));</span>
	<span class="n">omap_barriers_init</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * omap2_init_reprogram_sdrc - reprogram SDRC timing parameters</span>
<span class="cm"> *</span>
<span class="cm"> * Sets the CORE DPLL3 M2 divider to the same value that it&#39;s at</span>
<span class="cm"> * currently.  This has the effect of setting the SDRC SDRAM AC timing</span>
<span class="cm"> * registers to the values currently defined by the kernel.  Currently</span>
<span class="cm"> * only defined for OMAP3; will return 0 if called on OMAP2.  Returns</span>
<span class="cm"> * -EINVAL if the dpll3_m2_ck cannot be found, 0 if called on OMAP2,</span>
<span class="cm"> * or passes along the return value of clk_set_rate().</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">_omap2_init_reprogram_sdrc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">dpll3_m2_ck</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">rate</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cpu_is_omap34xx</span><span class="p">())</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">dpll3_m2_ck</span> <span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;dpll3_m2_ck&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">dpll3_m2_ck</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">rate</span> <span class="o">=</span> <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">dpll3_m2_ck</span><span class="p">);</span>
	<span class="n">pr_info</span><span class="p">(</span><span class="s">&quot;Reprogramming SDRC clock to %ld Hz</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">clk_set_rate</span><span class="p">(</span><span class="n">dpll3_m2_ck</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">)</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;dpll3_m2_clk rate change failed: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>

	<span class="n">clk_put</span><span class="p">(</span><span class="n">dpll3_m2_ck</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">v</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">_set_hwmod_postsetup_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_hwmod</span> <span class="o">*</span><span class="n">oh</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">omap_hwmod_set_postsetup_state</span><span class="p">(</span><span class="n">oh</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap_common_init_early</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_init_consistent_dma_size</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap_hwmod_init_postsetup</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">postsetup_state</span><span class="p">;</span>

	<span class="cm">/* Set the default postsetup state for all hwmods */</span>
<span class="cp">#ifdef CONFIG_PM_RUNTIME</span>
	<span class="n">postsetup_state</span> <span class="o">=</span> <span class="n">_HWMOD_STATE_IDLE</span><span class="p">;</span>
<span class="cp">#else</span>
	<span class="n">postsetup_state</span> <span class="o">=</span> <span class="n">_HWMOD_STATE_ENABLED</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">omap_hwmod_for_each</span><span class="p">(</span><span class="n">_set_hwmod_postsetup_state</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">postsetup_state</span><span class="p">);</span>

	<span class="n">omap_pm_if_early_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_SOC_OMAP2420</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap2420_init_early</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap2_set_globals_242x</span><span class="p">();</span>
	<span class="n">omap2xxx_check_revision</span><span class="p">();</span>
	<span class="n">omap_common_init_early</span><span class="p">();</span>
	<span class="n">omap2xxx_voltagedomains_init</span><span class="p">();</span>
	<span class="n">omap242x_powerdomains_init</span><span class="p">();</span>
	<span class="n">omap242x_clockdomains_init</span><span class="p">();</span>
	<span class="n">omap2420_hwmod_init</span><span class="p">();</span>
	<span class="n">omap_hwmod_init_postsetup</span><span class="p">();</span>
	<span class="n">omap2420_clk_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap2420_init_late</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_mux_late_init</span><span class="p">();</span>
	<span class="n">omap2_common_pm_late_init</span><span class="p">();</span>
	<span class="n">omap2_pm_init</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_SOC_OMAP2430</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap2430_init_early</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap2_set_globals_243x</span><span class="p">();</span>
	<span class="n">omap2xxx_check_revision</span><span class="p">();</span>
	<span class="n">omap_common_init_early</span><span class="p">();</span>
	<span class="n">omap2xxx_voltagedomains_init</span><span class="p">();</span>
	<span class="n">omap243x_powerdomains_init</span><span class="p">();</span>
	<span class="n">omap243x_clockdomains_init</span><span class="p">();</span>
	<span class="n">omap2430_hwmod_init</span><span class="p">();</span>
	<span class="n">omap_hwmod_init_postsetup</span><span class="p">();</span>
	<span class="n">omap2430_clk_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap2430_init_late</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_mux_late_init</span><span class="p">();</span>
	<span class="n">omap2_common_pm_late_init</span><span class="p">();</span>
	<span class="n">omap2_pm_init</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Currently only board-omap3beagle.c should call this because of the</span>
<span class="cm"> * same machine_id for 34xx and 36xx beagle.. Will get fixed with DT.</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_ARCH_OMAP3</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap3_init_early</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap2_set_globals_3xxx</span><span class="p">();</span>
	<span class="n">omap3xxx_check_revision</span><span class="p">();</span>
	<span class="n">omap3xxx_check_features</span><span class="p">();</span>
	<span class="n">omap_common_init_early</span><span class="p">();</span>
	<span class="n">omap3xxx_voltagedomains_init</span><span class="p">();</span>
	<span class="n">omap3xxx_powerdomains_init</span><span class="p">();</span>
	<span class="n">omap3xxx_clockdomains_init</span><span class="p">();</span>
	<span class="n">omap3xxx_hwmod_init</span><span class="p">();</span>
	<span class="n">omap_hwmod_init_postsetup</span><span class="p">();</span>
	<span class="n">omap3xxx_clk_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap3430_init_early</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap3_init_early</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap35xx_init_early</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap3_init_early</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap3630_init_early</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap3_init_early</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">am35xx_init_early</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap3_init_early</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">ti81xx_init_early</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap2_set_globals_ti81xx</span><span class="p">();</span>
	<span class="n">omap3xxx_check_revision</span><span class="p">();</span>
	<span class="n">ti81xx_check_features</span><span class="p">();</span>
	<span class="n">omap_common_init_early</span><span class="p">();</span>
	<span class="n">omap3xxx_voltagedomains_init</span><span class="p">();</span>
	<span class="n">omap3xxx_powerdomains_init</span><span class="p">();</span>
	<span class="n">omap3xxx_clockdomains_init</span><span class="p">();</span>
	<span class="n">omap3xxx_hwmod_init</span><span class="p">();</span>
	<span class="n">omap_hwmod_init_postsetup</span><span class="p">();</span>
	<span class="n">omap3xxx_clk_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap3_init_late</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_mux_late_init</span><span class="p">();</span>
	<span class="n">omap2_common_pm_late_init</span><span class="p">();</span>
	<span class="n">omap3_pm_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap3430_init_late</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_mux_late_init</span><span class="p">();</span>
	<span class="n">omap2_common_pm_late_init</span><span class="p">();</span>
	<span class="n">omap3_pm_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap35xx_init_late</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_mux_late_init</span><span class="p">();</span>
	<span class="n">omap2_common_pm_late_init</span><span class="p">();</span>
	<span class="n">omap3_pm_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap3630_init_late</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_mux_late_init</span><span class="p">();</span>
	<span class="n">omap2_common_pm_late_init</span><span class="p">();</span>
	<span class="n">omap3_pm_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">am35xx_init_late</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_mux_late_init</span><span class="p">();</span>
	<span class="n">omap2_common_pm_late_init</span><span class="p">();</span>
	<span class="n">omap3_pm_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">ti81xx_init_late</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_mux_late_init</span><span class="p">();</span>
	<span class="n">omap2_common_pm_late_init</span><span class="p">();</span>
	<span class="n">omap3_pm_init</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_ARCH_OMAP4</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap4430_init_early</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap2_set_globals_443x</span><span class="p">();</span>
	<span class="n">omap4xxx_check_revision</span><span class="p">();</span>
	<span class="n">omap4xxx_check_features</span><span class="p">();</span>
	<span class="n">omap_common_init_early</span><span class="p">();</span>
	<span class="n">omap44xx_voltagedomains_init</span><span class="p">();</span>
	<span class="n">omap44xx_powerdomains_init</span><span class="p">();</span>
	<span class="n">omap44xx_clockdomains_init</span><span class="p">();</span>
	<span class="n">omap44xx_hwmod_init</span><span class="p">();</span>
	<span class="n">omap_hwmod_init_postsetup</span><span class="p">();</span>
	<span class="n">omap4xxx_clk_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap4430_init_late</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_mux_late_init</span><span class="p">();</span>
	<span class="n">omap2_common_pm_late_init</span><span class="p">();</span>
	<span class="n">omap4_pm_init</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">omap_sdrc_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_sdrc_params</span> <span class="o">*</span><span class="n">sdrc_cs0</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">omap_sdrc_params</span> <span class="o">*</span><span class="n">sdrc_cs1</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_sram_init</span><span class="p">();</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cpu_is_omap24xx</span><span class="p">()</span> <span class="o">||</span> <span class="n">omap3_has_sdrc</span><span class="p">())</span> <span class="p">{</span>
		<span class="n">omap2_sdrc_init</span><span class="p">(</span><span class="n">sdrc_cs0</span><span class="p">,</span> <span class="n">sdrc_cs1</span><span class="p">);</span>
		<span class="n">_omap2_init_reprogram_sdrc</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
