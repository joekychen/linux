f | pm34xx.c | s | 21K | 682 | Tony Lindgren | tony@atomide.com | 1338800985 |  | Merge branch 'for_3.5/fixes/pm' of git://git.kernel.org/pub/scm/linux/kernel/git/khilman/linux-omap-pm into fixes
f | board-omap4panda.c | s | 14K | 467 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | clockdomains44xx_data.c | s | 13K | 402 | Paul Walmsley | paul@pwsan.com | 1334864029 |  | ARM: OMAP2+: clockdomains: make {prm,cm}_clkdm common  The PRM and CM implicit clockdomains will soon be used by OMAP44xx. So, make them common to OMAP2+ and modify the OMAP4 clockdomains code so use of these clockdomains doesn't crash the system.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Rajendra Nayak <rnayak@ti.com>
f | clock3xxx.c | s | 2.5K | 83 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP: Remove plat/io.h by splitting it into mach/io.h and mach/hardware.h  This is needed to minimize io.h so the SoC specific io.h for ARMs can removed.  Note that minimal driver changes for DSS and RNG are needed to include cpu.h for SoC detection macros.  Cc: Tomi Valkeinen <tomi.valkeinen@ti.com> Cc: Matt Mackall <mpm@selenic.com> Cc: Herbert Xu <herbert@gondor.apana.org.au> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | prcm-common.h | s | 18K | 462 | R Sricharan | r.sricharan@ti.com | 1336456522 |  | ARM: OMAP4+: Add prm and cm base init function.  Instead of statically defining seperate arrays for every OMAP4+ archs, have a generic init function to populate the arrays. This avoids the need for creating new array for every arch added in the future that reuses the prm and cm registers read/write code.  Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: R Sricharan <r.sricharan@ti.com> Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | board-zoom-debugboard.c | s | 3.3K | 113 | Russ Dill | Russ.Dill@ti.com | 1333474399 |  | ARM: OMAP2+: smsc911x: Add fixed board regulators  Initialize fixed regulators in the board files. Trying to do this in a generic way in gpmc-smsc911x.c gets messy as the regulator may be provided by drivers, such as twl4030, for some boards.  Signed-off-by: Russ Dill <russ.dill@ti.com> Signed-off-by: Igor Grinberg <grinberg@compulab.co.il> [tony@atomide.com: combined into one patch, updated comments] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | clkt_iclk.c | s | 2.0K | 66 | Paul Walmsley | paul@pwsan.com | 1299553392 |  | OMAP2430/3xxx: clock: add modem clock autoidle support  OMAP2430 and OMAP3xxx have modem autoidle bits that are actually attached to clocks with CM_FCLKEN bits; add the code and data to handle these.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com>
f | mux34xx.h | s | 20K | 387 | Tony Lindgren | tony@atomide.com | 1260576993 |  | omap: mux: Add 36xx CBP package support  Add 36xx CBP package support  Cc: Benoit Cousson <b-cousson@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | Makefile | g | 10K |  | Olof Johansson | olof@lixom.net | 1336718572 |  | 
f | voltagedomains3xxx_data.c | s | 2.9K | 108 | Kevin Hilman | khilman@ti.com | 1336667982 |  | ARM: OMAP: AM35xx: convert 3517 detection/flags to AM35xx  Currently cpu_is_omap3517() actually detects any device in the AM35x family (3517 and no-SGX version 3505.)  To make it more clear what is being detected, convert the names from 3517 to AM35xx.  This adds a new soc_is_am35xx() which duplicates the cpu_is_omap3517(). In order to avoid cross-tree dependencies with clock-tree changes, cpu_is_omap3517() is left until the clock changes are merged, at which point cpu_is_omap3517() will be completely removed.  Acked-by: Vaibhav Hiremath <hvaibhav@ti.com> Tested-by: Vaibhav Hiremath <hvaibhav@ti.com> Tested-by: Mark A. Greer <mgreer@animalcreek.com> Signed-off-by: Kevin Hilman <khilman@ti.com> [tony@atomide.com: change to use soc_is_omap instead] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | emu.c | s | 1.3K | 41 | Tony Lindgren | tony@atomide.com | 1330479221 |  | ARM: OMAP2+: Fix L4_EMU_34XX_BASE error after iomap changes  With the introduction of iomap changes platform init code fails for emu.c if CONFIG_OMAP3_EMU is selected:  arch/arm/mach-omap2/emu.c:35:8: error: 'L4_EMU_34XX_BASE' undeclared here (not in a function)  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | powerdomains2xxx_3xxx_data.c | s | 1.9K | 59 | Kevin Hilman | khilman@ti.com | 1316111950 |  | OMAP3: powerdomain data: add voltage domains  Add voltage domain name to indicate which voltagedomain each powerdomain is in.  Signed-off-by: Kevin Hilman <khilman@ti.com>
f | twl-common.h | s | 2.0K | 48 | Peter Ujfalusi | peter.ujfalusi@ti.com | 1336598356 |  | OMAP4: twl-common: Add twl6030 V1V8, V2V1 SMPS common configuration  V1V8 supply from twl6030 commonly used as VIO for the machine. V2V1 is adviced to supply the twl6040, and also to feed the twl6030's VCXIO_IN, and VDAC_IN inputs. Create the common regulator configurations for these regulators: Make the V2V1 as supply_regulator for VCXIO, VDAC. Add twl6040 (1-004b) as consumer for V1V8, and V2V1.  Signed-off-by: Peter Ujfalusi <peter.ujfalusi@ti.com> [tony@atomide.com: updated for the pm regulator changes] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | common.c | s | 4.6K | 154 | R Sricharan | r.sricharan@ti.com | 1336456522 |  | ARM: OMAP4+: Add prm and cm base init function.  Instead of statically defining seperate arrays for every OMAP4+ archs, have a generic init function to populate the arrays. This avoids the need for creating new array for every arch added in the future that reuses the prm and cm registers read/write code.  Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: R Sricharan <r.sricharan@ti.com> Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | clock2420_data.c | s | 59K | 1817 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP: Remove plat/io.h by splitting it into mach/io.h and mach/hardware.h  This is needed to minimize io.h so the SoC specific io.h for ARMs can removed.  Note that minimal driver changes for DSS and RNG are needed to include cpu.h for SoC detection macros.  Cc: Tomi Valkeinen <tomi.valkeinen@ti.com> Cc: Matt Mackall <mpm@selenic.com> Cc: Herbert Xu <herbert@gondor.apana.org.au> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | clockdomain.c | s | 30K | 888 | Santosh Shilimkar | santosh.shilimkar@ti.com | 1336456538 |  | ARM: OMAP2+: powerdomain: Get rid off duplicate pwrdm_clkdm_state_switch() API  With patch 'ARM: OMAP2+: powerdomain: Wait for powerdomain transition in pwrdm_state_switch()', the pwrdm_clkdm_state_switch() API becomes duplicate of pwrdm_state_switch().  Get rid off duplicate pwrdm_clkdm_state_switch() and update the users of it with pwrdm_state_switch()  Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | board-cm-t3517.c | s | 7.8K | 273 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | prm44xx.h | s | 48K | 738 | Tero Kristo | t-kristo@ti.com | 1324071418 |  | ARM: OMAP: PRCM: add suspend prepare / finish support  PRCM chain handler needs to disable forwarding of interrupts during suspend, because runtime PM is disabled and most of the drivers are potentially not able to handle interrupts coming at this time.  This patch masks all the PRCM interrupt events if a PRCM interrupt occurs during suspend, but does not ack them. Once suspend finish is called, all the masked events will be re-enabled, which causes immediate PRCM interrupt and handles the postponed event.  The suspend prepare and complete  callbacks will be called from pm34xx.c / pm44xx.c files in the following patches.  The functions defined in this patch should eventually be moved to suspend->prepare and suspend->finish driver hooks, once the PRCM chain handler will be made as its own driver.  Signed-off-by: Tero Kristo <t-kristo@ti.com> Cc: Kevin Hilman <khilman@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Tested-by: Kevin Hilman <khilman@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com> [paul@pwsan.com: add kerneldoc, add omap_prcm_irq_setup.saved_mask, add fn  ptrs for save_and_clear_irqen() and restore_irqen()] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | clock34xx.c | s | 5.1K | 138 | Paul Walmsley | paul@pwsan.com | 1299553443 |  | OMAP3: clock: use autoidle clkops for all autoidle-controllable interface clocks  Mark each interface clock with a corresponding CM_AUTOIDLE bit with a clkops that has the allow_idle/deny_idle function pointers populated. This allows the OMAP clock framework to enable and disable autoidle for these clocks.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com>
f | sdrc.h | s | 1.9K | 60 | Jean Pihet | j-pihet@ti.com | 1292971556 |  | OMAP2+: use global values for the SRAM PA addresses  The SRAM PA addresses are locally defined and used at different places, i.e. SRAM management code and idle sleep code.  The macros are now defined at a centralized place, for easier maintenance.  Tested on N900 and Beagleboard with full RET and OFF modes, using cpuidle and suspend.  Signed-off-by: Jean Pihet <j-pihet@ti.com> Acked-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Tested-by: Nishanth Menon<nm@ti.com> Signed-off-by: Kevin Hilman <khilman@deeprootsystems.com>
f | board-flash.c | s | 6.0K | 205 | Kevin Hilman | khilman@ti.com | 1340706597 |  | ARM: OMAP2+: nand: fix build error when CONFIG_MTD_ONENAND_OMAP2=n  commit 8259573b (ARM: OMAP2+: nand: Make board_onenand_init() visible to board code) broke the build for configs with OneNAND disabled.  By removing the static in the header file, it created a duplicate definition in the .c and the .h files, resuling in a build error:  /work/kernel/omap/dev/arch/arm/mach-omap2/board-flash.c:102:111: error: redefinition of 'board_onenand_init' /work/kernel/omap/dev/arch/arm/mach-omap2/board-flash.h:56:51: note: previous definition of 'board_onenand_init' was here make[2]: *** [arch/arm/mach-omap2/board-flash.o] Error 1 make[2]: *** Waiting for unfinished jobs.... make[1]: *** [arch/arm/mach-omap2] Error 2 make: *** [sub-make] Error 2  Fix this by removing the duplicate dummy entry from the C file.  Cc: Enric Balletbò i Serra <eballetbo@gmail.com> Cc: Javier Martinez Canillas <javier@dowhile0.org> Signed-off-by: Kevin Hilman <khilman@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | omap-mpuss-lowpower.c | s | 10K | 336 | Linus Torvalds | torvalds@linux-foundation.org | 1332975501 |  | 
f | common-board-devices.c | s | 3.6K | 122 | Tony Lindgren | tony@atomide.com | 1333041364 |  | Merge branch 'fixes-gpio-to-irq' into fixes  Conflicts: 	arch/arm/mach-omap1/board-htcherald.c 	arch/arm/mach-omap2/board-rx51-peripherals.c 	arch/arm/plat-omap/include/plat/gpio.h 	drivers/input/serio/ams_delta_serio.c
f | clock2xxx.c | s | 1.5K | 59 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP: Remove plat/io.h by splitting it into mach/io.h and mach/hardware.h  This is needed to minimize io.h so the SoC specific io.h for ARMs can removed.  Note that minimal driver changes for DSS and RNG are needed to include cpu.h for SoC detection macros.  Cc: Tomi Valkeinen <tomi.valkeinen@ti.com> Cc: Matt Mackall <mpm@selenic.com> Cc: Herbert Xu <herbert@gondor.apana.org.au> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | devices.c | s | 18K | 680 | Linus Torvalds | torvalds@linux-foundation.org | 1338060709 |  | 
f | board-h4.c | s | 10.0K | 356 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | voltage.h | s | 5.4K | 155 | Kevin Hilman | khilman@ti.com | 1316622981 |  | ARM: OMAP: voltage: voltage layer present, even when CONFIG_PM=n  Even when CONFIG_PM=n, we try to scale the boot voltage to a sane, known value using OPP table to find matching voltage based on boot frequency.  This should be done, even when CONFIG_PM=n to avoid mis-configured bootloaders and/or boot voltage assumptions made by boot loaders.  Also fixes various compile problems due to depenencies between voltage domain and powerdomain code (also present when CONFIG_PM=n).  Reported-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | common-board-devices.h | s | 437B | 10 | Peter Ujfalusi | peter.ujfalusi@ti.com | 1309794207 |  | OMAP: New twl-common for common TWL configuration  Introduce a new file, which will be used to configure common pmic (TWL) devices, regulators, and TWL audio.  Signed-off-by: Peter Ujfalusi <peter.ujfalusi@ti.com> Acked-by: Tony Lindgren <tony@atomide.com>
f | clock3xxx_data.c | s | 109K | 3241 | Kevin Hilman | khilman@ti.com | 1337986128 |  | ARM: OMAP3: clock data: cleanup AM3[35]x SoC detection  Use the more generic SoC family soc_is_am35xx() instead of the specific cpu_is_omap3517() (which is being removed.)  Acked-by: Vaibhav Hiremath <hvaibhav@ti.com> Tested-by: Vaibhav Hiremath <hvaibhav@ti.com> Tested-by: Mark A. Greer <mgreer@animalcreek.com> Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | board-omap3logic.c | s | 7.3K | 225 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | am35xx-emac.c | s | 3.5K | 98 | Paul Walmsley | paul@pwsan.com | 1334699447 |  | ARM: OMAP2+: clean up some cppcheck warnings  Resolve some warnings identified by cppcheck in arch/arm/mach-omap2:      [arch/arm/mach-omap2/usb-tusb6010.c:129]: (style) Checking if unsigned variable 'tmp' is less than zero.     [arch/arm/mach-omap2/prm_common.c:241]: (error) Possible null pointer dereference: irq_setup - otherwise it is redundant to check if irq_setup is null at line 247     [arch/arm/mach-omap2/pm34xx.c:790]: (style) Variable 'per_clkdm' is assigned a value that is never used     [arch/arm/mach-omap2/pm34xx.c:790]: (style) Variable 'core_clkdm' is assigned a value that is never used     [arch/arm/mach-omap2/pm24xx.c:185]: (style) Variable 'only_idle' is assigned a value that is never used     [arch/arm/mach-omap2/mux.c:254]: (error) Possible null pointer dereference: mux     [arch/arm/mach-omap2/mux.c:258]: (error) Possible null pointer dereference: mux     [arch/arm/mach-omap2/gpmc-onenand.c:178]: (style) Variable 'tick_ns' is assigned a value that is never used     [arch/arm/mach-omap2/gpio.c:56]: (error) Possible null pointer dereference: pdata - otherwise it is redundant to check if pdata is null at line 57     [arch/arm/mach-omap2/devices.c:45]: (style) Variable 'l' is assigned a value that is never used     [arch/arm/mach-omap2/board-omap3evm.c:641] -> [arch/arm/mach-omap2/board-omap3evm.c:639]: (style) Found duplicate branches for if and else.     [arch/arm/mach-omap2/am35xx-emac.c:95]: (style) Variable 'regval' is assigned a value that is never used     [arch/arm/mach-omap2/devices.c:74]: (style) Variable 'l' is assigned a value that is never used     [arch/arm/mach-omap2/pm34xx.c:277]: (style) Variable 'per_prev_state' is assigned a value that is never used     [arch/arm/plat-omap/dmtimer.c:352]: (error) Possible null pointer dereference: timer - otherwise it is redundant to check if timer is null at line 354     [arch/arm/plat-omap/omap_device.c:478]: (style) Variable 'c' is assigned a value that is never used     [arch/arm/plat-omap/usb.c:42]: (style) Variable 'status' is assigned a value that is never used     [arch/arm/mach-omap1/clock.c:197]: (style) Variable 'dpll1_rate' is assigned a value that is never used     [arch/arm/mach-omap1/lcd_dma.c:60]: (style) struct or union member 'lcd_dma_info::size' is never used     [arch/arm/mach-omap1/pm.c:572]: (style) Variable 'entry' is assigned a value that is never used  Some of them are pretty good catches, such as gpio.c:56 and usb-tusb6010.c:129.  Thanks to Jarkko Nikula for some comments on the sscanf() warnings. It seems that the kernel sscanf() ignores the field width anyway for the %d format, so those changes have been dropped from this second version.  Thanks to Daniel Marjamäki <daniel.marjamaki@gmail.com> for pointing out that a variable was unnecessarily marked static in the board-omap3evm.c change.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Felipe Balbi <balbi@ti.com> Cc: Tony Lindgren <tony@atomide.com> Cc: Kevin Hilman <khilman@ti.com> Cc: Peter Ujfalusi <peter.ujfalusi@ti.com> Cc: Jarkko Nikula <jarkko.nikula@bitmer.com> Cc: Charulatha Varadarajan <charu@ti.com> Cc: Daniel Marjamäki <daniel.marjamaki@gmail.com> Cc: Tarun Kanti DebBarma <tarun.kanti@ti.com> Reviewed-by: Charulatha Varadarajan <charu@ti.com> # for gpio.c
f | cm2xxx_3xxx.c | s | 17K | 508 | Tony Lindgren | tony@atomide.com | 1331139783 |  | ARM: OMAP2+: Fix build error after merge  Commit 9890ce44 (ARM: get rid of asm/irq.h in asm/prom.h) removed include of asm/irq.h in asm/prom.h. This commit together with recent omap cleanup to remove io.h causes build breakage:  arrch/arm/mach-omap2/control.c: In function 'omap3_ctrl_write_boot_mode': arch/arm/mach-omap2/control.c:238: error: 'OMAP343X_CTRL_BASE' undeclared (first use in this function) ...  Fix this by including hardware.h directly where needed instead of relying on asm/irq.h in asm/prom.h.  Reported-by: Russell King <rmk+kernel@arm.linux.org.uk> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | powerdomain2xxx_3xxx.c | s | 6.7K | 199 | Tony Lindgren | tony@atomide.com | 1331170174 |  | ARM: OMAP2+: Fix build issues with missing include of linux/bug.h  Otherwise we can get the following if bug.h is not included from kernel.h:  arch/arm/mach-omap2/powerdomain-common.c: In function 'omap2_pwrdm_get_mem_bank_onstate_mask': arch/arm/mach-omap2/powerdomain-common.c:64:3: error: implicit declaration of function 'WARN_ON' [-Werror=implicit-function-declaration] cc1: some warnings being treated as errors  Signed-off-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Olof Johansson <olof@lixom.net>
f | vc.h | s | 4.1K | 114 | Kevin Hilman | khilman@ti.com | 1316113762 |  | OMAP2+: VC: more registers are per-channel starting with OMAP5  Starting with OMAP5, the following registers are per-channel and not common to a all VC channels:   - SMPS I2C slave address  - SMPS voltage register address offset  - SMPS cmd/value register address offset  - VC channel configuration register  Move these from the channel-common struct into the per-channel struct to support OMAP5.  Signed-off-by: Kevin Hilman <khilman@ti.com>
f | omap_twl.c | s | 10K | 317 | Nishanth Menon | nm@ti.com | 1316113777 |  | OMAP4: PM: TWL6030: add cmd register  Without the command register, ON/ONLP/RET/OFF voltages are useless. and TWL will be unable to use these  Signed-off-by: Nishanth Menon <nm@ti.com>
f | mux2430.c | s | 29K | 780 | Dan Murphy | dmurphy@ti.com | 1289991714 |  | OMAP: mux: Add __func__ macro to pr_xxx macros  Removed mux: and added the __func__ macro to make debugging easier.  Signed-off-by: Dan Murphy <dmurphy@ti.com> Signed-off-by: Benoit Cousson <b-cousson@ti.com> Cc: Tony Lindgren <tony@atomide.com>
f | clock44xx_data.c | s | 104K | 3121 | Jon Hunter | jon-hunter@ti.com | 1340809799 |  | ARM: OMAP4470: Fix OMAP4470 boot failure  OMAP4470 currently fails to boot, printing various messages such as ...  omap_hwmod: mpu: cannot clk_get main_clk dpll_mpu_m2_ck omap_hwmod: mpu: cannot _init_clocks ------------[ cut here ]------------ WARNING: at arch/arm/mach-omap2/omap_hwmod.c:2062 _init+0x2a0/0x2e4() omap_hwmod: mpu: couldn't init clocks Modules linked in: [<c001c7fc>] (unwind_backtrace+0x0/0xf4) from [<c0043c64>] (warn_slowpath_common+0x4c/0x64) [<c0043c64>] (warn_slowpath_common+0x4c/0x64) from [<c0043d10>] (warn_slowpath_fmt+0x30/0x40) [<c0043d10>] (warn_slowpath_fmt+0x30/0x40) from [<c0674208>] (_init+0x2a0/0x2e4) [<c0674208>] (_init+0x2a0/0x2e4) from [<c067428c>] (omap_hwmod_setup_one+0x40/0x60) [<c067428c>] (omap_hwmod_setup_one+0x40/0x60) from [<c0674280>] (omap_hwmod_setup_one+0x34/0x60) [<c0674280>] (omap_hwmod_setup_one+0x34/0x60) from [<c06726f4>] (omap_dm_timer_init_one+0x30/0x250) [<c06726f4>] (omap_dm_timer_init_one+0x30/0x250) from [<c0672930>] (omap2_gp_clockevent_init+0x1c/0x108) [<c0672930>] (omap2_gp_clockevent_init+0x1c/0x108) from [<c0672c60>] (omap4_timer_init+0x10/0x5c) [<c0672c60>] (omap4_timer_init+0x10/0x5c) from [<c066c418>] (time_init+0x20/0x30) [<c066c418>] (time_init+0x20/0x30) from [<c0668814>] (start_kernel+0x1b0/0x304) [<c0668814>] (start_kernel+0x1b0/0x304) from [<80008044>] (0x80008044) ---[ end trace 1b75b31a2719ed1c ]---  The problem is that currently none of the clocks are being registered for OMAP4470 devices and so on boot-up no clocks can be found and the kernel panics.  This fix allows the kernel to boot without failure using a simple RAMDISK file system on OMAP4470 blaze board.  Per feedback from Paul and Benoit the 4470 clock data is incomplete for new modules such as the 2D graphics block that has been added to the 4470. Therefore add a warning to indicate that the clock data is incomplete.  Cc: Paul Walmsley <paul@pwsan.com> Cc: Benoit Cousson <b-cousson@ti.com> Signed-off-by: Jon Hunter <jon-hunter@ti.com> [tony@atomide.com: updated comments] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | dsp.c | s | 2.9K | 97 | Tony Lindgren | tony@atomide.com | 1338972140 |  | ARM: OMAP2+: Fix compile for CONFIG_TIDSPBRIDGE platform init code  Commit 7f28427b (ARM: OMAP2+: Move omap_dsp_reserve_sdram_memblock() to mach-omap2) moved DSP platform init code, but failed to include memblock.h causing:  arch/arm/mach-omap2/dsp.c: In function 'omap_dsp_reserve_sdram_memblock': arch/arm/mach-omap2/dsp.c:58: error: implicit declaration of function 'arm_memblock_steal'  Reported-by: Russell King <rmk+kernel@arm.linux.org.uk> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | pm.c | s | 7.0K | 269 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | clkt_dpll.c | s | 10K | 305 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP: Remove plat/io.h by splitting it into mach/io.h and mach/hardware.h  This is needed to minimize io.h so the SoC specific io.h for ARMs can removed.  Note that minimal driver changes for DSS and RNG are needed to include cpu.h for SoC detection macros.  Cc: Tomi Valkeinen <tomi.valkeinen@ti.com> Cc: Matt Mackall <mpm@selenic.com> Cc: Herbert Xu <herbert@gondor.apana.org.au> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | gpio.c | s | 5.2K | 142 | Linus Torvalds | torvalds@linux-foundation.org | 1337893306 |  | 
f | control.c | s | 18K | 520 | Tony Lindgren | tony@atomide.com | 1331139783 |  | ARM: OMAP2+: Fix build error after merge  Commit 9890ce44 (ARM: get rid of asm/irq.h in asm/prom.h) removed include of asm/irq.h in asm/prom.h. This commit together with recent omap cleanup to remove io.h causes build breakage:  arrch/arm/mach-omap2/control.c: In function 'omap3_ctrl_write_boot_mode': arch/arm/mach-omap2/control.c:238: error: 'OMAP343X_CTRL_BASE' undeclared (first use in this function) ...  Fix this by including hardware.h directly where needed instead of relying on asm/irq.h in asm/prom.h.  Reported-by: Russell King <rmk+kernel@arm.linux.org.uk> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | sdram-micron-mt46h32m32lf-6.h | s | 1.3K | 51 | Tony Lindgren | tony@atomide.com | 1256056847 |  | omap: headers: Move remaining headers from include/mach to include/plat  Move the remaining headers under plat-omap/include/mach to plat-omap/include/plat. Also search and replace the files using these headers to include using the right path.  This was done with:  #!/bin/bash mach_dir_old="arch/arm/plat-omap/include/mach" plat_dir_new="arch/arm/plat-omap/include/plat" headers=$(cd $mach_dir_old && ls *.h) omap_dirs="arch/arm/*omap*/ \ drivers/video/omap \ sound/soc/omap" other_files="drivers/leds/leds-ams-delta.c \ drivers/mfd/menelaus.c \ drivers/mfd/twl4030-core.c \ drivers/mtd/nand/ams-delta.c"  for header in $headers; do 	old="#include <mach\/$header" 	new="#include <plat\/$header" 	for dir in $omap_dirs; do 		find $dir -type f -name \*.[chS] || \ 			xargs sed -i "s/$old/$new/" 	done 	find drivers/ -type f -name \*omap*.[chS] || \ 		xargs sed -i "s/$old/$new/" 	for file in $other_files; do 		sed -i "s/$old/$new/" $file 	done done  for header in $(ls $mach_dir_old/*.h); do 	git mv $header $plat_dir_new/ done  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | clkt2xxx_dpll.c | s | 1.4K | 51 | Paul Walmsley | paul@pwsan.com | 1299553325 |  | OMAP2: clock: add DPLL autoidle support  Add the necessary code and data to allow the clock framework to enable and disable the OMAP2 DPLL autoidle state.  This is so the direct register access can be moved out of the mach-omap2/pm24xx.c code, and other code that needs to control this (e.g., CPUIdle) can do so via an API. As part of this patch, remove the pm24xx.c code that formerly wrote directly to the autoidle bits.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Kevin Hilman <khilman@ti.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com>
f | iomap.h | s | 6.6K | 141 | Santosh Shilimkar | santosh.shilimkar@ti.com | 1336458264 |  | ARM: OMAP4: Reduce the static IO mapping  EMIF, GMPC and DMM driver can ioremap() the address space as part of driver intialisation and there is no need to have static IO mapping for them.  Hence remove the un-used static IP space and let the respective drivers manage it as part if driver init.  Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com>
f | vp.c | s | 7.2K | 231 | Yuan Jiangli | jlyuan@motorola.com | 1331079230 |  | ARM: OMAP3+: PM: VP: fix integer truncation error  commit 2f34ce81b8c05c900e45bd88595cc154f7bb5957 (OMAP3: PM: Adding voltage driver support.) introduced runtime computation of waittime to handle all potential sys clocks available.  In the voltage processor, the SPMSUpdateWait is calculated based on the slew rate and the voltage step (SMPSUpdateWait = slew rate * Voltage Step). After the voltage processor receives the SMPS_Ack signal, the Voltage Controller will wait for SMPSUpdateWait clock cycles for the voltage to settle to the new value. For all practical purposes, the waittime parameter is the OMAP hardware translation of what the slew rate on the PMIC is.  As an example, with TPS62361 on OMAP4460, step_size = 10000 slew_rate = 32000 sys_clk_rate = 38400  Our current computation results in the following:  = ((step_size / slew_rate) * sys_clk_rate) / 1000  = ((10000 / 32000) * 38400 / 1000  = 0  Fix the same using DIV_ROUND_UP as an extra wait clock cycle is better than lesser clock cycle. For the above example, this translates to:  = (10000 * 38400) / (1000 * 32000)  = 12  Acked-by: Jon Hunter <jon-hunter@ti.com> [nm@ti.com: slightly better implementation] Signed-off-by: Nishanth Menon <nm@ti.com> Signed-off-by: Yuan Jiangli <jlyuan@motorola.com> Acked-by: Kevin Hilman <khilman@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | smartreflex.h | s | 7.6K | 224 | Nishanth Menon | nm@ti.com | 1330975766 |  | ARM: OMAP3+: SmartReflex Class3: disable errorgen before disable VP  SmartReflex AVS Errorgen module supplies signals to Voltage Processor. It is suggested that by disabling Errorgen module before we disable VP, we might be able to ensure lesser chances of race condition to occur in the system.  Signed-off-by: Nishanth Menon <nm@ti.com> Signed-off-by: Jean Pihet <j-pihet@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | clock44xx.h | s | 517B | 16 | Mike Turquette | mturquette@ti.com | 1317970378 |  | ARM: OMAP4: clock: round_rate and recalc functions for DPLL_ABE  OMAP4 DPLL_ABE can enable a 4X multipler on top of the normal MN multipler and divider. This is achieved by setting CM_CLKMODE_DPLL_ABE.DPLL_REGM4XEN bit in CKGEN module of CM1. From the OMAP4 TRM:  Fdpll = Fref x 2 x (4 x M/(N+1)) in case REGM4XEN bit field is set (only applicable to DPLL_ABE).  Add new round_rate() and recalc() functions for OMAP4, that check the setting of REGM4XEN bit and handle this appropriately. The new functions are a simple wrapper on top of the existing omap2_dpll_round_rate() and omap2_dpll_get_rate() functions to handle the REGM4XEN bit.  The REGM4XEN bit is only implemented for the ABE DPLL on OMAP4 and so only dpll_abe_ck uses omap4_dpll_regm4xen_round_rate() and omap4_dpll_regm4xen_recalc() functions.  Signed-off-by: Mike Turquette <mturquette@ti.com> Tested-by: Jon Hunter <jon-hunter@ti.com> Signed-off-by: Jon Hunter <jon-hunter@ti.com> [paul@pwsan.com: fixed attempt to return a negative from a fn returning 		 unsigned; pass along errors from omap2_dpll_round_rate(); 		 added documentation; added Jon's S-o-b] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | smartreflex.c | s | 30K | 990 | Jean Pihet | jean.pihet@newoldbits.com | 1330975767 |  | ARM: OMAP3+: SmartReflex: fix error handling  Fix the code to correctly use IS_ERR and PTR_ERR on the return values pointers  Reported-by: Sergei Shtylyov <sshtylyov@ru.mvista.com> Signed-off-by: Jean Pihet <j-pihet@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | sr_device.c | s | 3.5K | 119 | Arnd Bergmann | arnd@arndb.de | 1332283344 |  | Merge branch 'next/fixes-non-critical' into next/drivers  Conflicts: 	arch/arm/mach-lpc32xx/clock.c 	arch/arm/mach-pxa/pxa25x.c 	arch/arm/mach-pxa/pxa27x.c  The conflicts with pxa are non-obvious, we have multiple branches adding and removing the same clock settings. According to Haojian Zhuang, removing the sa1100 rtc dummy clock is the correct fix here.  Signed-off-by: Arnd Bergmann <arnd@arndb.de>
f | omap_phy_internal.c | s | 6.9K | 249 | Tony Lindgren | tony@atomide.com | 1340201895 |  | ARM: OMAP2+: Fix MUSB ifdefs for platform init code  Commit 62285963 (usb: musb: drop a gigantic amount of ifdeferry) got rid of a bunch of ifdefs in the MUSB code. Looks like the platform init code is still using these dropped defines though, which in many cases results the board defaulting always to host mode.  Currently the situation is that USB_MUSB_HDRC is the main Kconfig option with additional USB_GADGET_MUSB_HDRC so only these two should be used to select between host and OTG mode.  Fix the situation for omaps. The following users should fix the platform init code in a similar way:  Dropped Kconfig option          Current users  USB_MUSB_OTG                    blackfin, davinci, not in Kconfigs USB_MUSB_PERIPHERAL             davinci, not in Kconfigs USB_MUSB_HOST                   davinci, not in Kconfigs USB_MUSB_HDRC_HCD               blackfin, not in Kconfigs USB_MUSB_OTG                    blackfin, not in Kconfigs  Cc: Mike Frysinger <vapier@gentoo.org> Cc: Sekhar Nori <nsekhar@ti.com> Cc: linux-usb@vger.kernel.org Cc: Felipe Balbi <balbi@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | voltagedomains2xxx_data.c | s | 699B | 27 | Kevin Hilman | khilman@ti.com | 1316111950 |  | OMAP2: add voltage domains and connect to powerdomains  Create basic voltagedomains for OMAP2 and associate OMAP2 powerdomains with the newly created voltage domains.  While here, update copyright on powerdomain data to 2011.  Signed-off-by: Kevin Hilman <khilman@ti.com>
f | clock2430.c | s | 1.8K | 56 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP: Remove plat/io.h by splitting it into mach/io.h and mach/hardware.h  This is needed to minimize io.h so the SoC specific io.h for ARMs can removed.  Note that minimal driver changes for DSS and RNG are needed to include cpu.h for SoC detection macros.  Cc: Tomi Valkeinen <tomi.valkeinen@ti.com> Cc: Matt Mackall <mpm@selenic.com> Cc: Herbert Xu <herbert@gondor.apana.org.au> Signed-off-by: Tony Lindgren <tony@atomide.com>
d | include |  | 1 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1338060709 |  | 
f | powerdomain-common.c | s | 3.1K | 102 | Tony Lindgren | tony@atomide.com | 1331170174 |  | ARM: OMAP2+: Fix build issues with missing include of linux/bug.h  Otherwise we can get the following if bug.h is not included from kernel.h:  arch/arm/mach-omap2/powerdomain-common.c: In function 'omap2_pwrdm_get_mem_bank_onstate_mask': arch/arm/mach-omap2/powerdomain-common.c:64:3: error: implicit declaration of function 'WARN_ON' [-Werror=implicit-function-declaration] cc1: some warnings being treated as errors  Signed-off-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Olof Johansson <olof@lixom.net>
f | sdram-hynix-h8mbx00u0mer-0em.h | s | 1.2K | 47 | vikram pandita | vikram.pandita@ti.com | 1258914273 |  | omap3: zoom: Introduce zoom3 board support  Zoom3 is the next version of Zoom2 board. There has been a silicon update from zoom2 to zoom3.         Zoom2 has OMAP34xx         Zoom3 has OMAP3630 [1] Zoom3 = OMAP3630 SOM board [2] + same zoom2 main board [3] + same debugboard  Zoom3 has a SDRAM part from Hynix Zoom2 had SDRAM part from micron  Hynix memory timings are contributed by: Chalhoub, Nicole and Bour, Vincent  Reuse the zoom2 files as much for zoom3, as at board level, there is no change at all.  References: (courtesy Nishant Menon) [1] OMAP3630 http://focus.ti.com/general/docs/wtbu/wtbuproductcontent.tsp?templateId=6123&navigationId=12836&contentId=52606  [2] SOM boards http://logicpd.com/products/system-modules/texas-instruments-omap35x-som-lv  [3] Zoom2 boards http://logicpd.com/products/development-kits/texas-instruments-zoom%E2%84%A2-omap34x-ii-mdp OMAP3630:  Signed-off-by: Vikram Pandita <vikram.pandita@ti.com> Cc: Nicole Chalhoub <n-chalhoub@ti.com> Cc: Vincent Bour <v-bour@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | twl-common.c | s | 15K | 465 | Peter Ujfalusi | peter.ujfalusi@ti.com | 1336598356 |  | OMAP4: twl-common: Add twl6030 V1V8, V2V1 SMPS common configuration  V1V8 supply from twl6030 commonly used as VIO for the machine. V2V1 is adviced to supply the twl6040, and also to feed the twl6030's VCXIO_IN, and VDAC_IN inputs. Create the common regulator configurations for these regulators: Make the V2V1 as supply_regulator for VCXIO, VDAC. Add twl6040 (1-004b) as consumer for V1V8, and V2V1.  Signed-off-by: Peter Ujfalusi <peter.ujfalusi@ti.com> [tony@atomide.com: updated for the pm regulator changes] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | cm2_44xx.h | s | 28K | 438 | Benoit Cousson | b-cousson@ti.com | 1310260505 |  | OMAP4: cm: Remove RESTORE macros to avoid access from SW  The restore part of the CM is an alias of some regular registers used only during the SAR restore to facilate the dma to write a contiguous set of registers. The registers should never be used by the SW, only the original register have to be used.  Remove them from cmX_44xx.h files to avoid anybody to use them by mistake.  Signed-off-by: Benoit Cousson <b-cousson@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | cm44xx.h | s | 710B | 22 | Benoit Cousson | b-cousson@ti.com | 1310298990 |  | OMAP4: hwmod: Replace CLKCTRL absolute address with offset macros  The CLKCTRL register was accessed using an absolute address. The usage of hardcoded macros to calculate virtual address from physical one should be avoided as much as possible. The usage of a offset will allow future improvement like migration from the current architecture code toward a module driver.  Update cm_xxx accessor, move definition to the proper header file and update copyrights.  Signed-off-by: Benoit Cousson <b-cousson@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Todd Poynor <toddpoynor@google.com> [paul@pwsan.com: renamed 'omap4_cm_' fns to 'omap4_cminst_'; removed empty  fn prototype section from cm44xx.h; incorporated comments from Todd;  documented some functions] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | prm-regbits-24xx.h | s | 8.3K | 215 | Paul Walmsley | paul@pwsan.com | 1292986915 |  | OMAP2/3: PRCM: split OMAP2/3-specific PRCM code into OMAP2/3-specific files  In preparation for adding OMAP4-specific PRCM accessor/mutator functions, split the existing OMAP2/3 PRCM code into OMAP2/3-specific files.  Most of what was in mach-omap2/{cm,prm}.{c,h} has now been moved into mach-omap2/{cm,prm}2xxx_3xxx.{c,h}, since it was OMAP2xxx/3xxx-specific.  This process also requires the #includes in each of these files to be changed to reference the new file name.  As part of doing so, add some comments into plat-omap/sram.c and plat-omap/mcbsp.c, which use "sideways includes", to indicate that these users of the PRM/CM includes should not be doing so.  Thanks to Felipe Contreras <felipe.contreras@gmail.com> for comments on this patch.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Jarkko Nikula <jhnikula@gmail.com> Cc: Peter Ujfalusi <peter.ujfalusi@nokia.com> Cc: Liam Girdwood <lrg@slimlogic.co.uk> Cc: Omar Ramirez Luna <omar.ramirez@ti.com> Acked-by: Omar Ramirez Luna <omar.ramirez@ti.com> Cc: Felipe Contreras <felipe.contreras@gmail.com> Acked-by: Felipe Contreras <felipe.contreras@gmail.com> Cc: Greg Kroah-Hartman <greg@kroah.com> Acked-by: Mark Brown <broonie@opensource.wolfsonmicro.com> Reviewed-by: Kevin Hilman <khilman@deeprootsystems.com> Tested-by: Kevin Hilman <khilman@deeprootsystems.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Tested-by: Santosh Shilimkar <santosh.shilimkar@ti.com>
f | board-2430sdp.c | s | 7.3K | 261 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | board-ti8168evm.c | s | 1.9K | 62 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | clock34xx.h | s | 626B | 15 | Paul Walmsley | paul@pwsan.com | 1299553443 |  | OMAP3: clock: use autoidle clkops for all autoidle-controllable interface clocks  Mark each interface clock with a corresponding CM_AUTOIDLE bit with a clkops that has the allow_idle/deny_idle function pointers populated. This allows the OMAP clock framework to enable and disable autoidle for these clocks.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com>
f | scrm44xx.h | s | 6.2K | 153 | Benoit Cousson | b-cousson@ti.com | 1292986914 |  | OMAP4: PRCM: Add SCRM header file  Add the header file with scrm registers absolute address, offset and bitfields.  Signed-off-by: Benoit Cousson <b-cousson@ti.com> Signed-off-by: Rajendra Nayak <rnayak@ti.com> [paul@pwsan.com: renamed OMAP4_SCRM to OMAP4_SCRM_BASE] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | sleep34xx.S | g | 15K |  | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP: Remove plat/io.h by splitting it into mach/io.h and mach/hardware.h  This is needed to minimize io.h so the SoC specific io.h for ARMs can removed.  Note that minimal driver changes for DSS and RNG are needed to include cpu.h for SoC detection macros.  Cc: Tomi Valkeinen <tomi.valkeinen@ti.com> Cc: Matt Mackall <mpm@selenic.com> Cc: Herbert Xu <herbert@gondor.apana.org.au> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | omap-secure.c | s | 1.6K | 61 | Paul Walmsley | paul@pwsan.com | 1334320466 |  | ARM: OMAP: add includes for missing prototypes  Several C files in arch/arm/mach-omap* and arch/arm/plat-omap declare functions that are used by other files, but don't include the header file where the prototype is declared.  This results in the following warnings from sparse:      arch/arm/mach-omap2/irq.c:114:5: warning: symbol 'omap_irq_pending' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:186:13: warning: symbol 'omap2_init_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:191:13: warning: symbol 'omap3_init_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:196:13: warning: symbol 'ti81xx_init_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:233:39: warning: symbol 'omap2_intc_handle_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:242:6: warning: symbol 'omap_intc_save_context' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:265:6: warning: symbol 'omap_intc_restore_context' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:291:6: warning: symbol 'omap3_intc_suspend' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:297:6: warning: symbol 'omap3_intc_prepare_idle' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:306:6: warning: symbol 'omap3_intc_resume_idle' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:312:39: warning: symbol 'omap3_intc_handle_irq' was not declared. Should it be static?     arch/arm/mach-omap2/omap-secure.c:59:12: warning: symbol 'omap_secure_ram_reserve_memblock' was not declared. Should it be static?     arch/arm/mach-omap2/board-zoom-display.c:133:13: warning: symbol 'zoom_display_init' was not declared. Should it be static?     arch/arm/plat-omap/common.c:73:13: warning: symbol 'omap_init_consistent_dma_size' was not declared. Should it be static?     arch/arm/mach-omap1/irq.c:61:5: warning: symbol 'omap_irq_flags' was not declared. Should it be static?     arch/arm/mach-omap1/irq.c:179:13: warning: symbol 'omap1_init_irq' was not declared. Should it be static?     arch/arm/mach-omap1/reset.c:11:6: warning: symbol 'omap1_restart' was not declared. Should it be static?  Fix by including the appropriate header files.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: Senthilvadivu Guruswamy <svadivu@ti.com> Acked-by: Santosh Shilimkar <santosh.shilimkar@ti.com>
f | prcm_mpu44xx.c | s | 1006B | 37 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP2+: Move most of plat/io.h into local iomap.h  There's no need to have these defines in plat/io.h.  Note that we now need to ifdef omap_read/write calls as they will be available for omap1 only.  While at it, clean up the includes to group them like they typically are grouped.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | iommu2.c | s | 8.5K | 291 | Ohad Ben-Cohen | ohad@wizery.com | 1314351961 |  | omap: iommu: omapify 'struct iommu' and exposed API  Prepend 'omap_' to OMAP's 'struct iommu' and exposed API, to prevent namespace pollution and generally to improve readability of the code that still uses the driver directly.  Update the users as needed as well.  Signed-off-by: Ohad Ben-Cohen <ohad@wizery.com> Acked-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Acked-by: Hiroshi DOYU <Hiroshi.DOYU@nokia.com> Acked-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Joerg Roedel <joerg.roedel@amd.com>
f | board-am3517crane.c | s | 2.8K | 90 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | dma.c | s | 7.7K | 250 | R Sricharan | r.sricharan@ti.com | 1336458264 |  | ARM: OMAP2+: dma: Define dma capabilities register bitfields and use them.  The system dma module has capabiities register indicating the support for descriptor loading, constant fill, etc. Use this instead of OMAP revision check to identify the features supported runtime.  This avoids patching the code for feature SOCs which has those capabilities.  Signed-off-by: R Sricharan <r.sricharan@ti.com> Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com>
f | omap_hwmod_2xxx_3xxx_ipblock_data.c | s | 7.4K | 266 | Paul Walmsley | paul@pwsan.com | 1336519536 |  | ARM: OMAP2+: hwmod data: add HDQ/1-wire hwmod shared data  Much of the HDQ1W integration data is common between multiple generations of OMAP SoCs, so rather than make several copies, we add it once into files which are compiled for multiple SoCs.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: NeilBrown <neilb@suse.de> Tested-by: NeilBrown <neilb@suse.de>
f | mux2420.c | s | 24K | 677 | Dan Murphy | dmurphy@ti.com | 1289991714 |  | OMAP: mux: Add __func__ macro to pr_xxx macros  Removed mux: and added the __func__ macro to make debugging easier.  Signed-off-by: Dan Murphy <dmurphy@ti.com> Signed-off-by: Benoit Cousson <b-cousson@ti.com> Cc: Tony Lindgren <tony@atomide.com>
f | cminst44xx.c | s | 11K | 315 | Paul Walmsley | paul@pwsan.com | 1340323727 |  | ARM: OMAP2+: CM: increase the module disable timeout  Increase the timeout for disabling an IP block to five milliseconds. This is to handle the usb_host_fs idle latency, which takes almost four milliseconds after a host controller reset.  This is the second of two patches needed to resolve the following boot warning:  omap_hwmod: usb_host_fs: _wait_target_disable failed  Thanks to Sergei Shtylyov <sshtylyov@mvista.com> for finding an unrelated hunk in a previous version of this patch.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Sergei Shtylyov <sshtylyov@mvista.com> Cc: Tero Kristo <t-kristo@ti.com>
f | omap_l3_smx.h | s | 8.0K | 314 | sricharan | r.sricharan@ti.com | 1316851137 |  | OMAP: Fix sparse warnings in l3 error handler.  Fix below sparse warnings from the l3-noc and l3-smx error handlers files.  arch/arm/mach-omap2/omap_l3_smx.h:209:22: warning: symbol 'omap3_l3_app_bases' was not declared. Should it be static? arch/arm/mach-omap2/omap_l3_smx.h:308:22: warning: symbol 'omap3_l3_debug_bases' was not declared. Should it be static? arch/arm/mach-omap2/omap_l3_smx.h:325:2: warning: incorrect type in initializer (different address spaces) arch/arm/mach-omap2/omap_l3_smx.h:325:2:    expected unsigned int [usertype] * arch/arm/mach-omap2/omap_l3_smx.h:325:2:    got unsigned int [noderef] [toplevel] <asn:2>*<noident> arch/arm/mach-omap2/omap_l3_smx.h:326:2: warning: incorrect type in initializer (different address spaces) arch/arm/mach-omap2/omap_l3_smx.h:326:2:    expected unsigned int [usertype] * arch/arm/mach-omap2/omap_l3_smx.h:326:2:    got unsigned int [noderef] [toplevel] <asn:2>*<noident> arch/arm/mach-omap2/omap_l3_smx.h:324:5: warning: symbol 'omap3_l3_bases' was not declared. Should it be static?   CC      arch/arm/mach-omap2/omap_l3_smx.o   CHECK   arch/arm/mach-omap2/omap_l3_noc.c arch/arm/mach-omap2/omap_l3_noc.c:73:13: warning: symbol '__v' shadows an earlier one arch/arm/mach-omap2/omap_l3_noc.c:73:13: originally declared here arch/arm/mach-omap2/omap_l3_noc.c:83:20: warning: symbol '__v' shadows an earlier one arch/arm/mach-omap2/omap_l3_noc.c:83:20: originally declared here arch/arm/mach-omap2/omap_l3_noc.c:90:5: warning: symbol '__v' shadows an earlier one arch/arm/mach-omap2/omap_l3_noc.c:90:5: originally declared here arch/arm/mach-omap2/omap_l3_noc.h:39:5: warning: symbol 'l3_flagmux' was not declared. Should it be static? arch/arm/mach-omap2/omap_l3_noc.h:46:5: warning: symbol 'l3_targ_inst_clk1' was not declared. Should it be static? arch/arm/mach-omap2/omap_l3_noc.h:54:5: warning: symbol 'l3_targ_inst_clk2' was not declared. Should it be static? arch/arm/mach-omap2/omap_l3_noc.h:75:5: warning: symbol 'l3_targ_inst_clk3' was not declared. Should it be static? arch/arm/mach-omap2/omap_l3_noc.h:79:6: warning: symbol 'l3_targ_inst_name' was not declared. Should it be static? arch/arm/mach-omap2/omap_l3_noc.h:112:5: warning: symbol 'l3_targ' was not declared. Should it be static? arch/arm/mach-omap2/omap_l3_noc.c:72:11: warning: cast removes address space of expression arch/arm/mach-omap2/omap_l3_noc.c:73:13: warning: incorrect type in argument 1 (different base types) arch/arm/mach-omap2/omap_l3_noc.c:73:13:    expected void const volatile [noderef] <asn:2>*<noident> arch/arm/mach-omap2/omap_l3_noc.c:73:13:    got unsigned int arch/arm/mach-omap2/omap_l3_noc.c:83:20: warning: incorrect type in argument 1 (different base types) arch/arm/mach-omap2/omap_l3_noc.c:83:20:    expected void const volatile [noderef] <asn:2>*<noident> arch/arm/mach-omap2/omap_l3_noc.c:83:20:    got unsigned int arch/arm/mach-omap2/omap_l3_noc.c:90:5: warning: incorrect type in argument 1 (different base types) arch/arm/mach-omap2/omap_l3_noc.c:90:5:    expected void const volatile [noderef] <asn:2>*<noident> arch/arm/mach-omap2/omap_l3_noc.c:90:5:    got unsigned int arch/arm/mach-omap2/omap_l3_noc.c:96:5: warning: incorrect type in argument 1 (different base types) arch/arm/mach-omap2/omap_l3_noc.c:96:5:    expected void const volatile [noderef] <asn:2>*<noident> arch/arm/mach-omap2/omap_l3_noc.c:96:5:    got unsigned int arch/arm/mach-omap2/omap_l3_noc.c:108:5: warning: incorrect type in argument 1 (different base types) arch/arm/mach-omap2/omap_l3_noc.c:108:5:    expected void const volatile [noderef] <asn:2>*<noident> arch/arm/mach-omap2/omap_l3_noc.c:108:5:    got unsigned int  Signed-off-by: sricharan <r.sricharan@ti.com> Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Reported-by: Paul Walmsley <paul@pwsan.com> Reviewed-by: Paul Walmsley <paul@pwsan.com>
f | wd_timer.h | s | 550B | 14 | Kevin Hilman | khilman@ti.com | 1336519537 |  | ARM: OMAP2+: WDTIMER integration: fix !PM boot crash, disarm timer after hwmod reset  Without runtime PM enabled, hwmod needs to leave all IP blocks in an enabled state by default so any driver access to the HW will succeed. This is accomplished by seting the postsetup_state to enabled for all hwmods during init when runtime PM is disabled.  Currently, we have a special case for WDT in that its postsetup_state is always set to disabled.  This is done so that the WDT is disabled and the timer is disarmed at boot in case there is no WDT driver. This also means that when runtime PM is disabled, if a WDT driver *is* built in the kernel, the kernel will crash on the first access to the WDT hardware.  We can't simply leave the WDT module enabled, because the timer is armed by default after reset. That means that if there is no WDT driver initialzed or loaded before the timer expires, the kernel will reboot.  To fix this, a custom reset method is added to the watchdog class of omap_hwmod.  This method will *always* disarm the timer after hwmod reset.  The WDT timer then will only be rearmed when/if the driver is loaded for the WDT.  With the timer disarmed by default, we no longer need a special-case for the postsetup_state of WDT during init, so it is removed.  Any platforms wishing to ensure the watchdog remains armed across the entire boot boot can simply disable the reset-on-init feature of the watchdog hwmod using omap_hwmod_no_setup_reset().  Tested on 3530/Overo, 4430/Panda.  NOTE: on 4430, the hwmod OCP reset does not seem to rearm the timer as documented in the TRM (and what happens on OMAP3.)  I noticed this because testing the HWMOD_INIT_NO_RESET feature with no driver loaded, I expected a reboot part way through the boot, but did not see a reboot.  Adding some debug to read the counter, I verified that right after OCP softreset, the counter is not firing.  After writing the magic start sequence, the timer starts counting.  This means that the timer disarm sequence added here does not seem to be needed for 4430, but is technically the correct way to ensure the timer is disarmed, so it is left in for OMAP4.  Special thanks to Paul Walmsley for helping brainstorm ideas to fix this problem.  Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: Kevin Hilman <khilman@ti.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com> Acked-by: Santosh Shilimkar <santosh.shilimkar@ti.com> [paul@pwsan.com: updated the omap2_wd_timer_reset() function in the  wake of commit 3c55c1baffa5f719eb2ae9729088bc867f972f53 ("ARM:  OMAP2+: hwmod: Revert "ARM: OMAP2+: hwmod: Make omap_hwmod_softreset  wait for reset status""); added kerneldoc; rolled in warning fix from Kevin] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | omap_hwmod_2xxx_3xxx_interconnect_data.c | s | 3.4K | 162 | Paul Walmsley | paul@pwsan.com | 1336519536 |  | ARM: OMAP2+: hwmod data: add HDQ/1-wire hwmod shared data  Much of the HDQ1W integration data is common between multiple generations of OMAP SoCs, so rather than make several copies, we add it once into files which are compiled for multiple SoCs.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: NeilBrown <neilb@suse.de> Tested-by: NeilBrown <neilb@suse.de>
f | board-3430sdp.c | s | 14K | 535 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | omap_hwmod_2xxx_ipblock_data.c | s | 17K | 675 | Kevin Hilman | khilman@ti.com | 1336519537 |  | ARM: OMAP2+: WDTIMER integration: fix !PM boot crash, disarm timer after hwmod reset  Without runtime PM enabled, hwmod needs to leave all IP blocks in an enabled state by default so any driver access to the HW will succeed. This is accomplished by seting the postsetup_state to enabled for all hwmods during init when runtime PM is disabled.  Currently, we have a special case for WDT in that its postsetup_state is always set to disabled.  This is done so that the WDT is disabled and the timer is disarmed at boot in case there is no WDT driver. This also means that when runtime PM is disabled, if a WDT driver *is* built in the kernel, the kernel will crash on the first access to the WDT hardware.  We can't simply leave the WDT module enabled, because the timer is armed by default after reset. That means that if there is no WDT driver initialzed or loaded before the timer expires, the kernel will reboot.  To fix this, a custom reset method is added to the watchdog class of omap_hwmod.  This method will *always* disarm the timer after hwmod reset.  The WDT timer then will only be rearmed when/if the driver is loaded for the WDT.  With the timer disarmed by default, we no longer need a special-case for the postsetup_state of WDT during init, so it is removed.  Any platforms wishing to ensure the watchdog remains armed across the entire boot boot can simply disable the reset-on-init feature of the watchdog hwmod using omap_hwmod_no_setup_reset().  Tested on 3530/Overo, 4430/Panda.  NOTE: on 4430, the hwmod OCP reset does not seem to rearm the timer as documented in the TRM (and what happens on OMAP3.)  I noticed this because testing the HWMOD_INIT_NO_RESET feature with no driver loaded, I expected a reboot part way through the boot, but did not see a reboot.  Adding some debug to read the counter, I verified that right after OCP softreset, the counter is not firing.  After writing the magic start sequence, the timer starts counting.  This means that the timer disarm sequence added here does not seem to be needed for 4430, but is technically the correct way to ensure the timer is disarmed, so it is left in for OMAP4.  Special thanks to Paul Walmsley for helping brainstorm ideas to fix this problem.  Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: Kevin Hilman <khilman@ti.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com> Acked-by: Santosh Shilimkar <santosh.shilimkar@ti.com> [paul@pwsan.com: updated the omap2_wd_timer_reset() function in the  wake of commit 3c55c1baffa5f719eb2ae9729088bc867f972f53 ("ARM:  OMAP2+: hwmod: Revert "ARM: OMAP2+: hwmod: Make omap_hwmod_softreset  wait for reset status""); added kerneldoc; rolled in warning fix from Kevin] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | board-omap3pandora.c | s | 16K | 556 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | omap_opp_data.h | s | 3.3K | 83 | Paul Walmsley | paul@pwsan.com | 1299820665 |  | OMAP2+: voltage: reorganize, split code from data  This is a first pass at reorganizing mach-omap2/voltage.c:  - Separate almost all of the data from the code of mach-omap2/voltage.c.   The code remains in mach-omap2/voltage.c.  The data goes into one   of several places, depending on what type of data it is:    - Silicon process/validation data: mach-omap2/opp*_data.c   - VC (Voltage Controller) data: mach-omap2/vc*_data.c   - VP (Voltage Processor) data: mach-omap2/vp*_data.c   - Voltage domain data: mach-omap2/voltagedomains*_data.c    The ultimate goal is for all this data to be autogenerated, the same   way we autogenerate the rest of our data.  - Separate VC and VP common data from VDD-specific VC and VP data.  - Separate common voltage.c code from SoC-specific code; reuse common code.  - Reorganize structures to avoid unnecessary memory loss due to unpacked   fields.  There is much left to be done.  VC code and VP code should be separated out into vc*.c and vp*.c files.  Many fields in the existing structures are superfluous, and should be removed.  Some code in voltage.c seems to be duplicated; that code should be moved into functions of its own.  Proper voltage domain code should be created, as was done with the powerdomain and clockdomains, and powerdomains should reference voltagedomains.  Thanks to Shweta Gulati <shweta.gulati@ti.com> for comments.  Thanks to Rajendra Nayak <rnayak@ti.com> for finding and fixing some bugs that prevented OMAP4 from booting:     https://patchwork.kernel.org/patch/587311/  His patch has been folded into this one to avoid breaking OMAP4 between patches.  Thanks also to Kevin Hilman <khilman@ti.com> for finding and fixing a compile problem when !CONFIG_PM:     http://www.spinics.net/lists/arm-kernel/msg118067.html  His patch has also been folded into this one to avoid breaking !CONFIG_PM builds.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Shweta Gulati <shweta.gulati@ti.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Kevin Hilman <khilman@ti.com>
f | usb-tusb6010.c | s | 8.7K | 284 | Tony Lindgren | tony@atomide.com | 1340201895 |  | ARM: OMAP2: Fix tusb6010 GPIO interrupt for n8x0  Here's one more gpio_to_irq conversion that we missed earlier. Tested with n800 in gadget mode using USB_ETH.  Cc: Felipe Balbi <balbi@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | usb-musb.c | s | 3.0K | 107 | Tony Lindgren | tony@atomide.com | 1340201895 |  | ARM: OMAP2+: Fix MUSB ifdefs for platform init code  Commit 62285963 (usb: musb: drop a gigantic amount of ifdeferry) got rid of a bunch of ifdefs in the MUSB code. Looks like the platform init code is still using these dropped defines though, which in many cases results the board defaulting always to host mode.  Currently the situation is that USB_MUSB_HDRC is the main Kconfig option with additional USB_GADGET_MUSB_HDRC so only these two should be used to select between host and OTG mode.  Fix the situation for omaps. The following users should fix the platform init code in a similar way:  Dropped Kconfig option          Current users  USB_MUSB_OTG                    blackfin, davinci, not in Kconfigs USB_MUSB_PERIPHERAL             davinci, not in Kconfigs USB_MUSB_HOST                   davinci, not in Kconfigs USB_MUSB_HDRC_HCD               blackfin, not in Kconfigs USB_MUSB_OTG                    blackfin, not in Kconfigs  Cc: Mike Frysinger <vapier@gentoo.org> Cc: Sekhar Nori <nsekhar@ti.com> Cc: linux-usb@vger.kernel.org Cc: Felipe Balbi <balbi@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | omap4-common.c | s | 6.0K | 220 | Balaji T K | balajitk@ti.com | 1336522584 |  | ARM: OMAP4: hsmmc: check for null pointer  platform_device pdev can be NULL if CONFIG_MMC_OMAP_HS is not set. Add check for NULL pointer. while at it move the duplicated functions to omap4-common.c  Fixes the following boot crash seen with omap4sdp and omap4panda when MMC is disabled.  Unable to handle kernel NULL pointer dereference at virtual address 0000008c pgd = c0004000 [0000008c] *pgd=00000000 Internal error: Oops: 5 [#1] SMP ARM Modules linked in: CPU: 0    Not tainted  (3.4.0-rc1-05971-ga4dfa82 #4) PC is at omap_4430sdp_init+0x184/0x410 LR is at device_add+0x1a0/0x664  Signed-off-by: Balaji T K <balajitk@ti.com> Reported-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | omap_hwmod_2xxx_interconnect_data.c | s | 9.0K | 334 | Paul Walmsley | paul@pwsan.com | 1334831106 |  | ARM: OMAP2xxx: hwmod data: share common interface data  Several struct omap_hwmod_ocp_if records can be shared between OMAP2420 and OMAP2430.  Move these shared records out of the chip-specific files into mach-omap2/omap_hwmod_2xxx_interconnect_data.c.  This should save some memory and source lines, at the cost of readability.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Benoît Cousson <b-cousson@ti.com>
f | clock.c | s | 14K | 453 | Tony Lindgren | tony@atomide.com | 1336502949 |  | 
f | sleep44xx.S | g | 9.7K |  | David Howells | dhowells@redhat.com | 1332955801 |  | Disintegrate asm/system.h for ARM  Disintegrate asm/system.h for ARM.  Signed-off-by: David Howells <dhowells@redhat.com> cc: Russell King <linux@arm.linux.org.uk> cc: linux-arm-kernel@lists.infradead.org
f | mux2420.h | s | 15K | 278 | Tony Lindgren | tony@atomide.com | 1278336696 |  | omap: mux: Add data for 2420  Add data for 2420. Big thanks to Paul Walmsley <paul@pwsan.com> for generating usable mux data out of TRMs.  Cc: Benoit Cousson <b-cousson@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | clock36xx.h | s | 313B | 10 | Paul Walmsley | paul@pwsan.com | 1267038975 |  | OMAP3/4 clock: split into per-chip family files  clock34xx_data.c now contains data for the OMAP34xx family, the OMAP36xx family, and the OMAP3517 family, so rename it to clock3xxx_data.c.  Rename clock34xx.c to clock3xxx.c, and move the chip family-specific clock functions to clock34xx.c, clock36xx.c, or clock3517.c, as appropriate.  So now "clock3xxx.*" refers to the OMAP3 superset.  The main goal here is to prepare to compile chip family-specific clock functions only for kernel builds that target that chip family.  To get to that point, we also need to add CONFIG_SOC_* options for those other chip families; that will be done in future patches, planned for 2.6.35.  OMAP4 is also affected by this.  It duplicated the OMAP3 non-CORE DPLL clkops structure.  The OMAP4 variant of this clkops structure has been removed, and since there was nothing else currently in clock44xx.c, it too has been removed -- it can always be added back later when there is some content for it.  (The OMAP4 clock autogeneration scripts have been updated accordingly.)  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Benoît Cousson <b-cousson@ti.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Ranjith Lohithakshan <ranjithl@ti.com> Cc: Tony Lindgren <tony@atomide.com>
f | display.c | s | 12K | 417 | Tomi Valkeinen | tomi.valkeinen@ti.com | 1338905724 |  | OMAPDSS: fix registration of DPI and SDI devices  The omapdss arch initialization code registers all the output devices as omap_devices. However, DPI and SDI are not proper omap_devices, as they do not have any corresponding HWMOD. This leads to crashes or problems when the platform code tries to use omap_device functions for DPI and SDI devices.  One such crash was reported by John Stultz <johnstul@us.ibm.com>:  [   18.756835] Unable to handle kernel NULL pointer dereference at virtual addr8 [   18.765319] pgd = ea6b8000 [   18.768188] [00000018] *pgd=aa942831, *pte=00000000, *ppte=00000000 [   18.774749] Internal error: Oops: 17 [#1] SMP ARM [   18.779663] Modules linked in: [   18.782836] CPU: 0    Not tainted  (3.5.0-rc1-dirty #456) [   18.788482] PC is at _od_resume_noirq+0x1c/0x78 [   18.793212] LR is at _od_resume_noirq+0x6c/0x78 [   18.797943] pc : [<c00307ec>]    lr : [<c003083c>]    psr: 20000113 [   18.797943] sp : ec3abe80  ip : ec3abdb8  fp : 00000006 [   18.809936] r10: ec1148b8  r9 : c08a48f0  r8 : c00307d0 [   18.815368] r7 : 00000000  r6 : 00000000  r5 : ec114800  r4 : ec114808 [   18.822174] r3 : 00000000  r2 : 00000000  r1 : ec154fe8  r0 : 00000006 [   18.829010] Flags: nzCv  IRQs on  FIQs on  Mode SVC_32  ISA ARM Segment user [   18.836456] Control: 10c5387d  Table: aa6b804a  DAC: 00000015 [   18.842437] Process sh (pid: 1139, stack limit = 0xec3aa2f0) [   18.848358] Stack: (0xec3abe80 to 0xec3ac000)  DPI and SDI can be plain platform_devices. This patch changes the registration from omap_device_register() to platform_device_add().  Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com> Reported-by: John Stultz <johnstul@us.ibm.com> Tested-by: Jean Pihet <jean.pihet@newoldbits.com>
f | i2c.c | s | 2.9K | 92 | Tony Lindgren | tony@atomide.com | 1321549770 |  | ARM: 7159/1: OMAP: Introduce local common.h files  As suggested by Russell King - ARM Linux <linux@arm.linux.org.uk>, there's no need to keep local prototypes in non-local headers.  Add mach-omap1/common.h and mach-omap2/common.h and move the local prototypes there from plat/common.h and mach/omap4-common.h.  Signed-off-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
f | cm2xxx_3xxx.h | s | 5.0K | 121 | Paul Walmsley | paul@pwsan.com | 1299553333 |  | OMAP2xxx: clock: add clockfw autoidle support for APLLs  OMAP2xxx devices have two on-chip APLLs.  These APLLs can automatically enter idle when not in use.  Connect the APLL autoidle code to the clock code, so that the clock framework can handle this process.  As part of this patch, remove the code in mach-omap2/pm24xx.c that previously handled APLL autoidle control.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Kevin Hilman <khilman@ti.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com>
f | clock36xx.c | s | 2.0K | 61 | Paul Walmsley | paul@pwsan.com | 1267038975 |  | OMAP3/4 clock: split into per-chip family files  clock34xx_data.c now contains data for the OMAP34xx family, the OMAP36xx family, and the OMAP3517 family, so rename it to clock3xxx_data.c.  Rename clock34xx.c to clock3xxx.c, and move the chip family-specific clock functions to clock34xx.c, clock36xx.c, or clock3517.c, as appropriate.  So now "clock3xxx.*" refers to the OMAP3 superset.  The main goal here is to prepare to compile chip family-specific clock functions only for kernel builds that target that chip family.  To get to that point, we also need to add CONFIG_SOC_* options for those other chip families; that will be done in future patches, planned for 2.6.35.  OMAP4 is also affected by this.  It duplicated the OMAP3 non-CORE DPLL clkops structure.  The OMAP4 variant of this clkops structure has been removed, and since there was nothing else currently in clock44xx.c, it too has been removed -- it can always be added back later when there is some content for it.  (The OMAP4 clock autogeneration scripts have been updated accordingly.)  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Benoît Cousson <b-cousson@ti.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Ranjith Lohithakshan <ranjithl@ti.com> Cc: Tony Lindgren <tony@atomide.com>
f | cm44xx.c | s | 1.3K | 45 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP2+: Move most of plat/io.h into local iomap.h  There's no need to have these defines in plat/io.h.  Note that we now need to ifdef omap_read/write calls as they will be available for omap1 only.  While at it, clean up the includes to group them like they typically are grouped.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | sram34xx.S | g | 10K |  | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP2+: Move most of plat/io.h into local iomap.h  There's no need to have these defines in plat/io.h.  Note that we now need to ifdef omap_read/write calls as they will be available for omap1 only.  While at it, clean up the includes to group them like they typically are grouped.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | opp2xxx.h | s | 15K | 388 | Afzal Mohammed | afzal@ti.com | 1323802003 |  | ARM: OMAP: am33xx: Update common omap platform files  This patch updates the common platform files with AM335X device support (AM33XX family).  The approach taken in this patch is, AM33XX device will be considered as OMAP3 variant, and a separate SoC class created for AM33XX family of devices with a subclass type for AM335X device, which is newly added device in the family.  This means, cpu_is_omap34xx(), cpu_is_am33xx() and cpu_is_am335x() checks will return success on AM335X device. A kernel config option CONFIG_SOC_OMAPAM33XX is added under OMAP3 to include support for AM33XX build.  Also, cpu_mask and RATE_IN_XXX flags have crossed 8 bit hence struct clksel_rate.flags, struct prcm_config.flags and cpu_mask are changed to u16 from u8.  Signed-off-by: Afzal Mohammed <afzal@ti.com> Signed-off-by: Vaibhav Hiremath <hvaibhav@ti.com> Cc: Hemant Pedanekar <hemantp@ti.com> [tony@atomide.com: left out CK_AM33XX for now] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | display.h | s | 893B | 25 | Archit Taneja | archit@ti.com | 1320747406 |  | ARM: OMAP2PLUS: DSS: Ensure DSS works correctly if display is enabled in bootloader  Resetting DISPC when a DISPC output is enabled causes the DSS to go into an inconsistent state. Thus if the bootloader has enabled a display, the hwmod code cannot reset the DISPC module just like that, but the outputs need to be disabled first.  Add function dispc_disable_outputs() which disables all active overlay manager and ensure all frame transfers are completed.  Modify omap_dss_reset() to call this function and clear DSS_CONTROL, DSS_SDI_CONTROL and DSS_PLL_CONTROL so that DSS is in a clean state when the DSS2 driver starts.  This resolves the hang issue(caused by a L3 error during boot) seen on the beagle board C3, which has a factory bootloader that enables display. The issue is resolved with this patch.  Thanks to Tomi and Sricharan for some additional testing.  Acked-by: Tomi Valkeinen <tomi.valkeinen@ti.com> Tested-by: R, Sricharan <r.sricharan@ti.com> Signed-off-by: Archit Taneja <archit@ti.com> [paul@pwsan.com: restructured code, removed omap_{read,write}l(), removed  cpu_is_omap*() calls and converted to dev_attr] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | usb-host.c | s | 16K | 509 | Igor Grinberg | grinberg@compulab.co.il | 1333476517 |  | ARM: OMAP: fix section mismatches in usb-host.c  Fix the below section mismatch warning and alike:  WARNING: vmlinux.o(.text+0x281d4): Section mismatch in reference from the function setup_ehci_io_mux() to the function .init.text:omap_mux_init_signal() The function setup_ehci_io_mux() references the function __init omap_mux_init_signal(). This is often because setup_ehci_io_mux lacks a __init annotation or the annotation of omap_mux_init_signal is wrong.  Signed-off-by: Igor Grinberg <grinberg@compulab.co.il> Reviewed-by: Shubhrajyoti D <shubhrajyoti@ti.com> Acked-by: Felipe Balbi <balbi@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | clock.h | s | 5.2K | 131 | Kevin Hilman | khilman@ti.com | 1334450947 |  | ARM: OMAP: clock: cleanup CPUfreq leftovers, fix build errors  Now that we have OPP layer, and OMAP CPUfreq driver is using it, we no longer need/use the clock framework code for filling up CPUfreq tables.  Remove it.  Removing this code also eliminates build errors when CPU_FREQ_TABLE support is not enabled.  Thanks to Russell King for pointing out the parts I missed under plat-omap in the original version and also pointing out the build errors when CPUFREQ_TABLE support was not enabled.  Cc: Russell King <rmk+kernel@arm.linux.org.uk> Signed-off-by: Kevin Hilman <khilman@ti.com> Acked-by: Paul Walmsley <paul@pwsan.com> Acked-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Olof Johansson <olof@lixom.net>
f | omap_l3_noc.c | s | 6.7K | 237 | Govindraj.R | govindraj.raja@ti.com | 1322088337 |  | ARM: OMAP2+: Fix Compilation error when omap_l3_noc built as module  Fix below compilation failure on mainline kernel 3.2-rc1 when omap_l3_noc.c is built as module.  arch/arm/mach-omap2/omap_l3_noc.c:240: error: expected ',' or ';' before 'MODULE_DEVICE_TABLE'  Signed-off-by: Govindraj.R <govindraj.raja@ti.com> Acked-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | clkt2xxx_dpllcore.c | s | 4.4K | 145 | Paul Walmsley | paul@pwsan.com | 1292990714 |  | OMAP2/3: PRM/CM: prefix OMAP2 PRM/CM functions with "omap2_"  Now that OMAP4-specific PRCM functions have been added, distinguish the existing OMAP2/3-specific PRCM functions by prefixing them with "omap2_".  This patch should not result in any functional change.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Kevin Hilman <khilman@deeprootsystems.com> Cc: Jarkko Nikula <jhnikula@gmail.com> Cc: Peter Ujfalusi <peter.ujfalusi@nokia.com> Cc: Liam Girdwood <lrg@slimlogic.co.uk> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Tested-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Tested-by: Rajendra Nayak <rnayak@ti.com>
f | board-3630sdp.c | s | 5.3K | 198 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | board-omap3stalker.c | s | 11K | 375 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | board-zoom-display.c | s | 3.6K | 122 | Paul Walmsley | paul@pwsan.com | 1334320466 |  | ARM: OMAP: add includes for missing prototypes  Several C files in arch/arm/mach-omap* and arch/arm/plat-omap declare functions that are used by other files, but don't include the header file where the prototype is declared.  This results in the following warnings from sparse:      arch/arm/mach-omap2/irq.c:114:5: warning: symbol 'omap_irq_pending' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:186:13: warning: symbol 'omap2_init_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:191:13: warning: symbol 'omap3_init_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:196:13: warning: symbol 'ti81xx_init_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:233:39: warning: symbol 'omap2_intc_handle_irq' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:242:6: warning: symbol 'omap_intc_save_context' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:265:6: warning: symbol 'omap_intc_restore_context' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:291:6: warning: symbol 'omap3_intc_suspend' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:297:6: warning: symbol 'omap3_intc_prepare_idle' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:306:6: warning: symbol 'omap3_intc_resume_idle' was not declared. Should it be static?     arch/arm/mach-omap2/irq.c:312:39: warning: symbol 'omap3_intc_handle_irq' was not declared. Should it be static?     arch/arm/mach-omap2/omap-secure.c:59:12: warning: symbol 'omap_secure_ram_reserve_memblock' was not declared. Should it be static?     arch/arm/mach-omap2/board-zoom-display.c:133:13: warning: symbol 'zoom_display_init' was not declared. Should it be static?     arch/arm/plat-omap/common.c:73:13: warning: symbol 'omap_init_consistent_dma_size' was not declared. Should it be static?     arch/arm/mach-omap1/irq.c:61:5: warning: symbol 'omap_irq_flags' was not declared. Should it be static?     arch/arm/mach-omap1/irq.c:179:13: warning: symbol 'omap1_init_irq' was not declared. Should it be static?     arch/arm/mach-omap1/reset.c:11:6: warning: symbol 'omap1_restart' was not declared. Should it be static?  Fix by including the appropriate header files.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: Senthilvadivu Guruswamy <svadivu@ti.com> Acked-by: Santosh Shilimkar <santosh.shilimkar@ti.com>
f | vp3xxx_data.c | s | 2.4K | 70 | Tony Lindgren | tony@atomide.com | 1321549770 |  | ARM: 7159/1: OMAP: Introduce local common.h files  As suggested by Russell King - ARM Linux <linux@arm.linux.org.uk>, there's no need to keep local prototypes in non-local headers.  Add mach-omap1/common.h and mach-omap2/common.h and move the local prototypes there from plat/common.h and mach/omap4-common.h.  Signed-off-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
f | id.c | s | 12K | 471 | Tony Lindgren | tony@atomide.com | 1338800985 |  | Merge branch 'for_3.5/fixes/pm' of git://git.kernel.org/pub/scm/linux/kernel/git/khilman/linux-omap-pm into fixes
f | omap_hwmod_3xxx_data.c | s | 83K | 3030 | Olof Johansson | olof@lixom.net | 1336718572 |  | 
f | dpll44xx.c | s | 3.7K | 122 | Mike Turquette | mturquette@ti.com | 1317970378 |  | ARM: OMAP4: clock: round_rate and recalc functions for DPLL_ABE  OMAP4 DPLL_ABE can enable a 4X multipler on top of the normal MN multipler and divider. This is achieved by setting CM_CLKMODE_DPLL_ABE.DPLL_REGM4XEN bit in CKGEN module of CM1. From the OMAP4 TRM:  Fdpll = Fref x 2 x (4 x M/(N+1)) in case REGM4XEN bit field is set (only applicable to DPLL_ABE).  Add new round_rate() and recalc() functions for OMAP4, that check the setting of REGM4XEN bit and handle this appropriately. The new functions are a simple wrapper on top of the existing omap2_dpll_round_rate() and omap2_dpll_get_rate() functions to handle the REGM4XEN bit.  The REGM4XEN bit is only implemented for the ABE DPLL on OMAP4 and so only dpll_abe_ck uses omap4_dpll_regm4xen_round_rate() and omap4_dpll_regm4xen_recalc() functions.  Signed-off-by: Mike Turquette <mturquette@ti.com> Tested-by: Jon Hunter <jon-hunter@ti.com> Signed-off-by: Jon Hunter <jon-hunter@ti.com> [paul@pwsan.com: fixed attempt to return a negative from a fn returning 		 unsigned; pass along errors from omap2_dpll_round_rate(); 		 added documentation; added Jon's S-o-b] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | prm-regbits-34xx.h | s | 20K | 478 | Paul Walmsley | paul@pwsan.com | 1292986915 |  | OMAP2/3: PRCM: split OMAP2/3-specific PRCM code into OMAP2/3-specific files  In preparation for adding OMAP4-specific PRCM accessor/mutator functions, split the existing OMAP2/3 PRCM code into OMAP2/3-specific files.  Most of what was in mach-omap2/{cm,prm}.{c,h} has now been moved into mach-omap2/{cm,prm}2xxx_3xxx.{c,h}, since it was OMAP2xxx/3xxx-specific.  This process also requires the #includes in each of these files to be changed to reference the new file name.  As part of doing so, add some comments into plat-omap/sram.c and plat-omap/mcbsp.c, which use "sideways includes", to indicate that these users of the PRM/CM includes should not be doing so.  Thanks to Felipe Contreras <felipe.contreras@gmail.com> for comments on this patch.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Jarkko Nikula <jhnikula@gmail.com> Cc: Peter Ujfalusi <peter.ujfalusi@nokia.com> Cc: Liam Girdwood <lrg@slimlogic.co.uk> Cc: Omar Ramirez Luna <omar.ramirez@ti.com> Acked-by: Omar Ramirez Luna <omar.ramirez@ti.com> Cc: Felipe Contreras <felipe.contreras@gmail.com> Acked-by: Felipe Contreras <felipe.contreras@gmail.com> Cc: Greg Kroah-Hartman <greg@kroah.com> Acked-by: Mark Brown <broonie@opensource.wolfsonmicro.com> Reviewed-by: Kevin Hilman <khilman@deeprootsystems.com> Tested-by: Kevin Hilman <khilman@deeprootsystems.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Tested-by: Santosh Shilimkar <santosh.shilimkar@ti.com>
f | prm_common.c | s | 8.6K | 267 | Paul Walmsley | paul@pwsan.com | 1334699447 |  | ARM: OMAP2+: clean up some cppcheck warnings  Resolve some warnings identified by cppcheck in arch/arm/mach-omap2:      [arch/arm/mach-omap2/usb-tusb6010.c:129]: (style) Checking if unsigned variable 'tmp' is less than zero.     [arch/arm/mach-omap2/prm_common.c:241]: (error) Possible null pointer dereference: irq_setup - otherwise it is redundant to check if irq_setup is null at line 247     [arch/arm/mach-omap2/pm34xx.c:790]: (style) Variable 'per_clkdm' is assigned a value that is never used     [arch/arm/mach-omap2/pm34xx.c:790]: (style) Variable 'core_clkdm' is assigned a value that is never used     [arch/arm/mach-omap2/pm24xx.c:185]: (style) Variable 'only_idle' is assigned a value that is never used     [arch/arm/mach-omap2/mux.c:254]: (error) Possible null pointer dereference: mux     [arch/arm/mach-omap2/mux.c:258]: (error) Possible null pointer dereference: mux     [arch/arm/mach-omap2/gpmc-onenand.c:178]: (style) Variable 'tick_ns' is assigned a value that is never used     [arch/arm/mach-omap2/gpio.c:56]: (error) Possible null pointer dereference: pdata - otherwise it is redundant to check if pdata is null at line 57     [arch/arm/mach-omap2/devices.c:45]: (style) Variable 'l' is assigned a value that is never used     [arch/arm/mach-omap2/board-omap3evm.c:641] -> [arch/arm/mach-omap2/board-omap3evm.c:639]: (style) Found duplicate branches for if and else.     [arch/arm/mach-omap2/am35xx-emac.c:95]: (style) Variable 'regval' is assigned a value that is never used     [arch/arm/mach-omap2/devices.c:74]: (style) Variable 'l' is assigned a value that is never used     [arch/arm/mach-omap2/pm34xx.c:277]: (style) Variable 'per_prev_state' is assigned a value that is never used     [arch/arm/plat-omap/dmtimer.c:352]: (error) Possible null pointer dereference: timer - otherwise it is redundant to check if timer is null at line 354     [arch/arm/plat-omap/omap_device.c:478]: (style) Variable 'c' is assigned a value that is never used     [arch/arm/plat-omap/usb.c:42]: (style) Variable 'status' is assigned a value that is never used     [arch/arm/mach-omap1/clock.c:197]: (style) Variable 'dpll1_rate' is assigned a value that is never used     [arch/arm/mach-omap1/lcd_dma.c:60]: (style) struct or union member 'lcd_dma_info::size' is never used     [arch/arm/mach-omap1/pm.c:572]: (style) Variable 'entry' is assigned a value that is never used  Some of them are pretty good catches, such as gpio.c:56 and usb-tusb6010.c:129.  Thanks to Jarkko Nikula for some comments on the sscanf() warnings. It seems that the kernel sscanf() ignores the field width anyway for the %d format, so those changes have been dropped from this second version.  Thanks to Daniel Marjamäki <daniel.marjamaki@gmail.com> for pointing out that a variable was unnecessarily marked static in the board-omap3evm.c change.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Felipe Balbi <balbi@ti.com> Cc: Tony Lindgren <tony@atomide.com> Cc: Kevin Hilman <khilman@ti.com> Cc: Peter Ujfalusi <peter.ujfalusi@ti.com> Cc: Jarkko Nikula <jarkko.nikula@bitmer.com> Cc: Charulatha Varadarajan <charu@ti.com> Cc: Daniel Marjamäki <daniel.marjamaki@gmail.com> Cc: Tarun Kanti DebBarma <tarun.kanti@ti.com> Reviewed-by: Charulatha Varadarajan <charu@ti.com> # for gpio.c
f | board-rx51-video.c | s | 2.4K | 85 | Linus Torvalds | torvalds@linux-foundation.org | 1306437114 |  | Merge branch 'omap-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tmlind/linux-omap-2.6  * 'omap-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tmlind/linux-omap-2.6: (33 commits)   OMAP3: PM: Boot message is not an error, and not helpful, remove it   OMAP3: cpuidle: change the power domains modes determination logic   OMAP3: cpuidle: code rework for improved readability   OMAP3: cpuidle: re-organize the C-states data   OMAP3: clean-up mach specific cpuidle data structures   OMAP3 cpuidle: remove useless SDP specific timings   usb: otg: OMAP4430: Powerdown the internal PHY when USB is disabled   usb: otg: OMAP4430: Fixing the omap4430_phy_init function   usb: musb: am35x: fix compile error when building am35x   usb: musb: OMAP4430: Power down the PHY during board init   omap: drop board-igep0030.c   omap: igep0020: add support for IGEP3   omap: igep0020: minor refactoring   omap: igep0020: name refactoring for future merge with IGEP3   omap: Remove support for omap2evm   arm: omap2plus: GPIO cleanup   omap: musb: introduce default board config   omap: move detection of NAND CS to common-board-devices   omap: use common initialization for PMIC i2c bus   omap: consolidate touch screen initialization among different boards   ...
f | cm1_44xx.h | s | 13K | 212 | Benoit Cousson | b-cousson@ti.com | 1310260505 |  | OMAP4: cm: Remove RESTORE macros to avoid access from SW  The restore part of the CM is an alias of some regular registers used only during the SAR restore to facilate the dma to write a contiguous set of registers. The registers should never be used by the SW, only the original register have to be used.  Remove them from cmX_44xx.h files to avoid anybody to use them by mistake.  Signed-off-by: Benoit Cousson <b-cousson@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | clock_common_data.c | s | 1.3K | 40 | Paul Walmsley | paul@pwsan.com | 1299554477 |  | OMAP2xxx: clock: remove dsp_irate_ick  After commit 81b34fbecbfbf24ed95c2d80d5cb14149652408f ("OMAP2 clock: split OMAP2420, OMAP2430 clock data into their own files"), it's possible to remove dsp_irate_ick from the OMAP2420 and OMAP2430 clock files.  It was originally only needed due to a 2420/2430 clock tree difference, and now that the data is in separate files, it's superfluous.  Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | mux.c | s | 26K | 946 | Olof Johansson | olof@lixom.net | 1340493389 |  | 
f | board-4430sdp.c | s | 22K | 811 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | board-am3517evm.c | s | 9.7K | 331 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | dpll3xxx.c | s | 15K | 521 | Vaibhav Bedia | vaibhav.bedia@ti.com | 1336456530 |  | ARM: OMAP3+: dpll: Configure autoidle mode only if it's supported  The current DPLL code enables and disables autoidle features without checking whether the autoidle register is available. Fix this by putting a check for the existence of the autoidle register in the DPLL data.  With such a check in place, for DPLLs which do not support this feature, simply skipping the autoidle_reg entry in the DPLL data is sufficient.  Signed-off-by: Vaibhav Bedia <vaibhav.bedia@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | board-omap3touchbook.c | s | 9.6K | 335 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | vc.c | s | 10K | 309 | Tony Lindgren | tony@atomide.com | 1331232492 |  | ARM: OMAP2+: Fix build for omap4 only builds with missing include of linux/bug.h  Found few more with randconfig generated .configs:  In file included from arch/arm/mach-omap2/prm-regbits-34xx.h:17,                  from arch/arm/mach-omap2/vc.c:18: arch/arm/mach-omap2/prm2xxx_3xxx.h: In function ‘omap2_prm_read_mod_reg’: arch/arm/mach-omap2/prm2xxx_3xxx.h:239: error: implicit declaration of function ‘WARN’  In file included from arch/arm/mach-omap2/powerdomain44xx.c:22: arch/arm/mach-omap2/prm2xxx_3xxx.h: In function ‘omap2_prm_read_mod_reg’: arch/arm/mach-omap2/prm2xxx_3xxx.h:239: error: implicit declaration of function ‘WARN’  This is because omap2_prm functions are currently just stubs for omap4 only builds.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | omap_l3_noc.h | s | 3.4K | 149 | sricharan | r.sricharan@ti.com | 1316851137 |  | OMAP: Print Initiator name for l3 custom error.  The initiator id gets logged in the l3 target registers for custom error. So print it to aid debugging.  Based on a internal patch by Devaraj Rangasamy <dev@ti.com>  Signed-off-by: sricharan <r.sricharan@ti.com> Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com>
f | cm-regbits-34xx.h | s | 27K | 694 | Rajendra Nayak | rnayak@ti.com | 1336456521 |  | ARM: OMAP3: Fix CM register bit masks  The register bits for MPU_CLK_SRC and IVA2_CLK_SRC in CM_CLKSEL1_PLL register are 3 bits wide.  Fix the MASK definition accordingly.  Signed-off-by: Rajendra Nayak <rnayak@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | board-devkit8000.c | s | 18K | 562 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | prm2xxx_3xxx.c | s | 9.2K | 268 | Kevin Hilman | khilman@ti.com | 1336779977 |  | ARM: OMAP3: PM: fix shared PRCM interrupts: leave disabled at boot  By default, request_irq() will auto-enable the requested IRQ.  For PRCM interrupts, we may want to avoid that until the PM core code is fully ready to handle the interrupts.  This is particularily true for IO pad interrupts on OMAP3, which are shared between the hwmod core and the PRM core.  In order to avoid PRCM IO-chain interrupts until the PM core is ready to handle them, ready, set the IRQ_NOAUTOEN flag for the PRCM IO-chain interrupt,  which means it will remain disabled after request_irq().  Then, explicitly enable the PRCM interrupts after the request_irq() in the PM core (but not in the hwmod core.)  Special thanks to Tero Kristo for suggesting to isolate the fix to only the IO-chain interrupt on OMAP3 instead of all PRCM interrupts.  Cc: Tero Kristo <t-kristo@ti.com> Acked-by: Paul Walmsley <paul@pwsan.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | mcbsp.c | s | 5.7K | 198 | Linus Torvalds | torvalds@linux-foundation.org | 1332888954 |  | 
f | gpmc-nand.c | s | 3.2K | 102 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP: Remove plat/io.h by splitting it into mach/io.h and mach/hardware.h  This is needed to minimize io.h so the SoC specific io.h for ARMs can removed.  Note that minimal driver changes for DSS and RNG are needed to include cpu.h for SoC detection macros.  Cc: Tomi Valkeinen <tomi.valkeinen@ti.com> Cc: Matt Mackall <mpm@selenic.com> Cc: Herbert Xu <herbert@gondor.apana.org.au> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | pm.h | s | 3.1K | 99 | Daniel Lezcano | daniel.lezcano@linaro.org | 1336076369 |  | ARM: OMAP3: cpuidle - remove cpuidle_params_table  We do not longer need the ''cpuidle_params_table' array as we defined the states in the driver and we checked they are all valid.  We also remove the structure definition as it is no longer used.  Signed-off-by: Daniel Lezcano <daniel.lezcano@linaro.org> Reviewed-by: Jean Pihet <j-pihet@ti.com> Reviewed-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Tested-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Tested-by: Kevin Hilman <khilman@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | smartreflex-class3.c | s | 1.4K | 51 | Nishanth Menon | nm@ti.com | 1330975766 |  | ARM: OMAP3+: SmartReflex Class3: disable errorgen before disable VP  SmartReflex AVS Errorgen module supplies signals to Voltage Processor. It is suggested that by disabling Errorgen module before we disable VP, we might be able to ensure lesser chances of race condition to occur in the system.  Signed-off-by: Nishanth Menon <nm@ti.com> Signed-off-by: Jean Pihet <j-pihet@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | clkt2xxx_apll.c | s | 3.2K | 115 | Paul Walmsley | paul@pwsan.com | 1299553333 |  | OMAP2xxx: clock: add clockfw autoidle support for APLLs  OMAP2xxx devices have two on-chip APLLs.  These APLLs can automatically enter idle when not in use.  Connect the APLL autoidle code to the clock code, so that the clock framework can handle this process.  As part of this patch, remove the code in mach-omap2/pm24xx.c that previously handled APLL autoidle control.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Kevin Hilman <khilman@ti.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com>
f | gpmc-smc91x.c | s | 4.9K | 161 | Igor Grinberg | grinberg@compulab.co.il | 1305193926 |  | arm: omap2plus: GPIO cleanup  use gpio_request_<one||array>() instead of multiple gpiolib calls, remove unneeded variables, etc.  Signed-off-by: Igor Grinberg <grinberg@compulab.co.il> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | board-omap3beagle.c | s | 13K | 473 | Russ Dill | Russ.Dill@ti.com | 1340201901 |  | ARM: OMAP: Fix Beagleboard DVI reset gpio  Commit e813a55eb9c9bc6c8039fb16332cf43402125b30 ("OMAP: board-files: remove custom PD GPIO handling for DVI output") moved TFP410 chip's powerdown-gpio handling from the board files to the tfp410 driver. One gpio_request_one(powerdown-gpio, ...) was mistakenly left unremoved in the Beagle board file. This causes the tfp410 driver to fail to request the gpio on Beagle, causing the driver to fail and thus the DVI output doesn't work.  This patch removes several boot errors from board-omap3beagle.c:   - gpio_request: gpio--22 (DVI reset) status -22  - Unable to get DVI reset GPIO  There is a combination of leftover code and revision confusion. Additionally, xM support is currently a hack.  For original Beagleboard this removes the double initialization of GPIO 170, properly configures it as an output, and wraps the initialization in an if block so that xM does not attempt to request it.  For Beagleboard xM it removes reference to GPIO 129 which was part of rev A1 and A2 designs, but never functioned. It then properly assigns beagle_dvi_device.reset_gpio in beagle_twl_gpio_setup and removes the hack of initializing it high. Additionally, it uses gpio_set_value_cansleep since this GPIO is connected through i2c.  Unfortunately, there is no way to tell the difference between xM A2 and A3. However, GPIO 129 does not function on rev A1 and A2, and the TWL GPIO used on A3 and beyond is not used on rev A1 and A2, there are no problems created by this fix.  Tested on Beagleboard-xM Rev C1 and Beagleboard Rev B4.  Signed-off-by: Russ Dill <Russ.Dill@ti.com> Acked-by: Tomi Valkeinen <tomi.valkeinen@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | mailbox.c | s | 10K | 364 | Tony Lindgren | tony@atomide.com | 1336584455 |  | ARM: OMAP2+: Incorrect Register Offsets in OMAP Mailbox  Looks like the register offsets are incorrect in the OMAP mailbox code (arch/arm/mach-omap2/mailbox.c) for the OMAP4_MAILBOX_IRQ* macros. The discrepancy is with p.224 of TI document SPRUGX9 and p3891 of SWPU231K.  Acked-by: Vaibhav Bedia <vaibhav.bedia@ti.com> Signed-off-by: Henry Chan <enli.chan@gmail.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | board-flash.h | s | 1.6K | 55 | Javier Martinez Canillas | javier@dowhile0.org | 1336598354 |  | ARM: OMAP2+: nand: Make board_onenand_init() visible to board code  board_onenand_init() and board_nand_init() initialization functions are used to initialize OneNAND and NAND memories respectively. But only board_nand_init() was visible to be used from board code. This patch makes possible to initialize a OneNAND flash memory within platform code.  Signed-off-by: Javier Martinez Canillas <javier@dowhile0.org> Acked-by: Enric Balletbo i Serra <eballetbo@gmail.com> Tested-by: Enric Balletbo i Serra <eballetbo@gmail.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | powerdomain44xx.c | s | 5.6K | 180 | Tony Lindgren | tony@atomide.com | 1331232492 |  | ARM: OMAP2+: Fix build for omap4 only builds with missing include of linux/bug.h  Found few more with randconfig generated .configs:  In file included from arch/arm/mach-omap2/prm-regbits-34xx.h:17,                  from arch/arm/mach-omap2/vc.c:18: arch/arm/mach-omap2/prm2xxx_3xxx.h: In function ‘omap2_prm_read_mod_reg’: arch/arm/mach-omap2/prm2xxx_3xxx.h:239: error: implicit declaration of function ‘WARN’  In file included from arch/arm/mach-omap2/powerdomain44xx.c:22: arch/arm/mach-omap2/prm2xxx_3xxx.h: In function ‘omap2_prm_read_mod_reg’: arch/arm/mach-omap2/prm2xxx_3xxx.h:239: error: implicit declaration of function ‘WARN’  This is because omap2_prm functions are currently just stubs for omap4 only builds.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | irq.c | s | 8.9K | 300 | Tony Lindgren | tony@atomide.com | 1338800985 |  | Merge branch 'for_3.5/fixes/pm' of git://git.kernel.org/pub/scm/linux/kernel/git/khilman/linux-omap-pm into fixes
f | gpmc.c | s | 27K | 941 | Linus Torvalds | torvalds@linux-foundation.org | 1338594942 |  | 
f | vc44xx_data.c | s | 3.1K | 81 | Tony Lindgren | tony@atomide.com | 1321549770 |  | ARM: 7159/1: OMAP: Introduce local common.h files  As suggested by Russell King - ARM Linux <linux@arm.linux.org.uk>, there's no need to keep local prototypes in non-local headers.  Add mach-omap1/common.h and mach-omap2/common.h and move the local prototypes there from plat/common.h and mach/omap4-common.h.  Signed-off-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
f | clkt_clksel.c | s | 14K | 427 | Tony Lindgren | tony@atomide.com | 1331170174 |  | ARM: OMAP2+: Fix build issues with missing include of linux/bug.h  Otherwise we can get the following if bug.h is not included from kernel.h:  arch/arm/mach-omap2/powerdomain-common.c: In function 'omap2_pwrdm_get_mem_bank_onstate_mask': arch/arm/mach-omap2/powerdomain-common.c:64:3: error: implicit declaration of function 'WARN_ON' [-Werror=implicit-function-declaration] cc1: some warnings being treated as errors  Signed-off-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Olof Johansson <olof@lixom.net>
f | gpmc-onenand.c | s | 10K | 364 | Paul Walmsley | paul@pwsan.com | 1334699447 |  | ARM: OMAP2+: clean up some cppcheck warnings  Resolve some warnings identified by cppcheck in arch/arm/mach-omap2:      [arch/arm/mach-omap2/usb-tusb6010.c:129]: (style) Checking if unsigned variable 'tmp' is less than zero.     [arch/arm/mach-omap2/prm_common.c:241]: (error) Possible null pointer dereference: irq_setup - otherwise it is redundant to check if irq_setup is null at line 247     [arch/arm/mach-omap2/pm34xx.c:790]: (style) Variable 'per_clkdm' is assigned a value that is never used     [arch/arm/mach-omap2/pm34xx.c:790]: (style) Variable 'core_clkdm' is assigned a value that is never used     [arch/arm/mach-omap2/pm24xx.c:185]: (style) Variable 'only_idle' is assigned a value that is never used     [arch/arm/mach-omap2/mux.c:254]: (error) Possible null pointer dereference: mux     [arch/arm/mach-omap2/mux.c:258]: (error) Possible null pointer dereference: mux     [arch/arm/mach-omap2/gpmc-onenand.c:178]: (style) Variable 'tick_ns' is assigned a value that is never used     [arch/arm/mach-omap2/gpio.c:56]: (error) Possible null pointer dereference: pdata - otherwise it is redundant to check if pdata is null at line 57     [arch/arm/mach-omap2/devices.c:45]: (style) Variable 'l' is assigned a value that is never used     [arch/arm/mach-omap2/board-omap3evm.c:641] -> [arch/arm/mach-omap2/board-omap3evm.c:639]: (style) Found duplicate branches for if and else.     [arch/arm/mach-omap2/am35xx-emac.c:95]: (style) Variable 'regval' is assigned a value that is never used     [arch/arm/mach-omap2/devices.c:74]: (style) Variable 'l' is assigned a value that is never used     [arch/arm/mach-omap2/pm34xx.c:277]: (style) Variable 'per_prev_state' is assigned a value that is never used     [arch/arm/plat-omap/dmtimer.c:352]: (error) Possible null pointer dereference: timer - otherwise it is redundant to check if timer is null at line 354     [arch/arm/plat-omap/omap_device.c:478]: (style) Variable 'c' is assigned a value that is never used     [arch/arm/plat-omap/usb.c:42]: (style) Variable 'status' is assigned a value that is never used     [arch/arm/mach-omap1/clock.c:197]: (style) Variable 'dpll1_rate' is assigned a value that is never used     [arch/arm/mach-omap1/lcd_dma.c:60]: (style) struct or union member 'lcd_dma_info::size' is never used     [arch/arm/mach-omap1/pm.c:572]: (style) Variable 'entry' is assigned a value that is never used  Some of them are pretty good catches, such as gpio.c:56 and usb-tusb6010.c:129.  Thanks to Jarkko Nikula for some comments on the sscanf() warnings. It seems that the kernel sscanf() ignores the field width anyway for the %d format, so those changes have been dropped from this second version.  Thanks to Daniel Marjamäki <daniel.marjamaki@gmail.com> for pointing out that a variable was unnecessarily marked static in the board-omap3evm.c change.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Felipe Balbi <balbi@ti.com> Cc: Tony Lindgren <tony@atomide.com> Cc: Kevin Hilman <khilman@ti.com> Cc: Peter Ujfalusi <peter.ujfalusi@ti.com> Cc: Jarkko Nikula <jarkko.nikula@bitmer.com> Cc: Charulatha Varadarajan <charu@ti.com> Cc: Daniel Marjamäki <daniel.marjamaki@gmail.com> Cc: Tarun Kanti DebBarma <tarun.kanti@ti.com> Reviewed-by: Charulatha Varadarajan <charu@ti.com> # for gpio.c
f | hsmmc.h | s | 1.7K | 45 | Linus Torvalds | torvalds@linux-foundation.org | 1332993585 |  | 
f | clockdomains2xxx_3xxx_data.c | s | 2.6K | 80 | Paul Walmsley | paul@pwsan.com | 1334864029 |  | ARM: OMAP2+: clockdomains: make {prm,cm}_clkdm common  The PRM and CM implicit clockdomains will soon be used by OMAP44xx. So, make them common to OMAP2+ and modify the OMAP4 clockdomains code so use of these clockdomains doesn't crash the system.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Rajendra Nayak <rnayak@ti.com>
f | clkt34xx_dpll3m2.c | s | 3.1K | 106 | Avinash H.M | avinashhm@ti.com | 1305295698 |  | OMAP3: set the core dpll clk rate in its set_rate function  The debug l3_ick/rate is not displaying the actual rate of the clock in hardware. This is because, the core dpll set_rate function doesn't update the clk.rate. After fixing, the l3_ick/rate is displaying proper values.  Signed-off-by: Shweta Gulati <shweta.gulati@ti.com> Signed-off-by: Avinash.H.M <avinashhm@ti.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Paul Wamsley <paul@pwsan.com> Acked-by: Paul Walmsley <paul@pwsan.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | hwspinlock.c | s | 1.7K | 53 | Paul Walmsley | paul@pwsan.com | 1334320466 |  | ARM: OMAP2+: declare file-local functions as static  Several function declarations used only in the files in which they're declared should include the static keyword, but don't:      arch/arm/mach-omap2/serial.c:248:6: warning: symbol 'cmdline_find_option' was not declared. Should it be static?     arch/arm/mach-omap2/omap-wakeupgen.c:259:6: warning: symbol 'irq_sar_clear' was not declared. Should it be static?     arch/arm/mach-omap2/board-rx51-peripherals.c:878:27: warning: symbol 'rx51_vibra_data' was not declared. Should it be static?     arch/arm/mach-omap2/board-rx51-peripherals.c:882:27: warning: symbol 'rx51_audio_data' was not declared. Should it be static?     arch/arm/mach-omap2/board-omap4panda.c:201:29: warning: symbol 'omap_panda_wlan_data' was not declared. Should it be static?     arch/arm/mach-omap2/board-omap4panda.c:393:24: warning: symbol 'omap4_panda_dvi_device' was not declared. Should it be static?     arch/arm/mach-omap2/board-omap4panda.c:403:12: warning: symbol 'omap4_panda_dvi_init' was not declared. Should it be static?     arch/arm/mach-omap2/board-omap4panda.c:464:6: warning: symbol 'omap4_panda_display_init' was not declared. Should it be static?     arch/arm/mach-omap2/hsmmc.c:434:6: warning: symbol 'omap_init_hsmmc' was not declared. Should it be static?     arch/arm/mach-omap2/hwspinlock.c:31:12: warning: symbol 'hwspinlocks_init' was not declared. Should it be static?     arch/arm/mach-omap1/timer.c:58:12: warning: symbol 'omap1_dm_timer_init' was not declared. Should it be static?     arch/arm/mach-omap1/fpga.c:90:6: warning: symbol 'innovator_fpga_IRQ_demux' was not declared. Should it be static?  Mark all of these as static.  Thanks to Arnd Bergmann <arnd@arndb.de> for pointing out a typo in the original patch description.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Govindraj R <govindraj.raja@ti.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: David Anders <x0132446@ti.com> Acked-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Acked-by: Arnd Bergmann <arnd@arndb.de>
f | omap-iommu.c | s | 3.6K | 151 | Ohad Ben-Cohen | ohad@wizery.com | 1330957100 |  | ARM: OMAP: fix iommu, not mailbox  For some weird (freudian?) reason, commit 435792d "ARM: OMAP: make iommu subsys_initcall to fix builtin omap3isp" unintentionally changed the mailbox's initcall instead of the iommu's.  Fix that.  Reported-by: Fernando Guzman Lugo <fernando.lugo@ti.com> Signed-off-by: Ohad Ben-Cohen <ohad@wizery.com> Cc: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Cc: Joerg Roedel <Joerg.Roedel@amd.com> Cc: Tony Lindgren <tony@atomide.com> Signed-off-by: Joerg Roedel <joerg.roedel@amd.com>
f | powerdomains2xxx_3xxx_data.h | s | 596B | 18 | Paul Walmsley | paul@pwsan.com | 1292990716 |  | OMAP2+: powerdomain: move header file from plat-omap to mach-omap2  The OMAP powerdomain code and data is all OMAP2+-specific.  This seems unlikely to change any time soon.  Move plat-omap/include/plat/powerdomain.h to mach-omap2/powerdomain.h.  The primary point of doing this is to remove the temptation for unrelated upper-layer code to access powerdomain code and data directly.  As part of this process, remove the references to powerdomain data from the GPIO "driver" and the OMAP PM no-op layer, both in plat-omap. Change the DSPBridge code to point to the new location for the powerdomain headers.  The DSPBridge code should not be including the powerdomain headers; these should be removed.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Kevin Hilman <khilman@deeprootsystems.com> Cc: Omar Ramirez Luna <omar.ramirez@ti.com> Cc: Felipe Contreras <felipe.contreras@gmail.com> Cc: Greg Kroah-Hartman <greg@kroah.com>
f | opp2430_data.c | s | 4.8K | 122 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP: Remove plat/io.h by splitting it into mach/io.h and mach/hardware.h  This is needed to minimize io.h so the SoC specific io.h for ARMs can removed.  Note that minimal driver changes for DSS and RNG are needed to include cpu.h for SoC detection macros.  Cc: Tomi Valkeinen <tomi.valkeinen@ti.com> Cc: Matt Mackall <mpm@selenic.com> Cc: Herbert Xu <herbert@gondor.apana.org.au> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | board-n8x0.c | s | 15K | 624 | Tony Lindgren | tony@atomide.com | 1340201895 |  | ARM: OMAP2+: Fix MUSB ifdefs for platform init code  Commit 62285963 (usb: musb: drop a gigantic amount of ifdeferry) got rid of a bunch of ifdefs in the MUSB code. Looks like the platform init code is still using these dropped defines though, which in many cases results the board defaulting always to host mode.  Currently the situation is that USB_MUSB_HDRC is the main Kconfig option with additional USB_GADGET_MUSB_HDRC so only these two should be used to select between host and OTG mode.  Fix the situation for omaps. The following users should fix the platform init code in a similar way:  Dropped Kconfig option          Current users  USB_MUSB_OTG                    blackfin, davinci, not in Kconfigs USB_MUSB_PERIPHERAL             davinci, not in Kconfigs USB_MUSB_HOST                   davinci, not in Kconfigs USB_MUSB_HDRC_HCD               blackfin, not in Kconfigs USB_MUSB_OTG                    blackfin, not in Kconfigs  Cc: Mike Frysinger <vapier@gentoo.org> Cc: Sekhar Nori <nsekhar@ti.com> Cc: linux-usb@vger.kernel.org Cc: Felipe Balbi <balbi@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | board-rx51-peripherals.c | s | 32K | 1096 | Tony Lindgren | tony@atomide.com | 1338802914 |  | ARM: OMAP: Fix lis3lv02d accelerometer to use gpio_to_irq  Commit 3b511201 (ARM: OMAP: rx51: Platform support for lis3lv02d accelerometer) added support for lis3lv02d accelerometer.  The patch was still using OMAP_GPIO_IRQ which no longer exists.  Fix it by using gpio_to_irq().  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | gpmc-smsc911x.c | s | 2.6K | 85 | Russ Dill | Russ.Dill@ti.com | 1333474294 |  | ARM: OMAP2+: smsc911x: Remove regulator support from gmpc-smsc911x  Adding in support for regulators here creates several headaches.  - Boards that declare their own regulator cannot use this function.  - Multiple calls to this function require special handling.  - Boards that declare id's other than '0' need special handling.  Now that there is a simple regulator_register_fixed, we can push this registration back into the board files.  Signed-off-by: Russ Dill <russ.dill@ti.com> Tested-by: Igor Grinberg <grinberg@compulab.co.il> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | clock3517.h | s | 355B | 11 | Paul Walmsley | paul@pwsan.com | 1267038975 |  | OMAP3/4 clock: split into per-chip family files  clock34xx_data.c now contains data for the OMAP34xx family, the OMAP36xx family, and the OMAP3517 family, so rename it to clock3xxx_data.c.  Rename clock34xx.c to clock3xxx.c, and move the chip family-specific clock functions to clock34xx.c, clock36xx.c, or clock3517.c, as appropriate.  So now "clock3xxx.*" refers to the OMAP3 superset.  The main goal here is to prepare to compile chip family-specific clock functions only for kernel builds that target that chip family.  To get to that point, we also need to add CONFIG_SOC_* options for those other chip families; that will be done in future patches, planned for 2.6.35.  OMAP4 is also affected by this.  It duplicated the OMAP3 non-CORE DPLL clkops structure.  The OMAP4 variant of this clkops structure has been removed, and since there was nothing else currently in clock44xx.c, it too has been removed -- it can always be added back later when there is some content for it.  (The OMAP4 clock autogeneration scripts have been updated accordingly.)  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Benoît Cousson <b-cousson@ti.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Ranjith Lohithakshan <ranjithl@ti.com> Cc: Tony Lindgren <tony@atomide.com>
f | timer.c | s | 14K | 485 | Vaibhav Hiremath | hvaibhav@ti.com | 1336583225 |  | ARM: OMAP: Make OMAP clocksource source selection using kernel param  Current OMAP code supports couple of clocksource options based on compilation flag (CONFIG_OMAP_32K_TIMER). The 32KHz sync-timer and a gptimer which can run on 32KHz or system clock (e.g 38.4 MHz). So there can be 3 options -  1. 32KHz sync-timer 2. Sys_clock based (e.g 13/19.2/26/38.4 MHz) gptimer 3. 32KHz based gptimer.  The optional gptimer based clocksource was added so that it can give the high precision than sync-timer, so expected usage was 2 and not 3. Unfortunately option 2, clocksource doesn't meet the requirement of free-running clock as per clocksource need. It stops in low power states when sys_clock is cut. That makes gptimer based clocksource option useless for OMAP2/3/4 devices with sys_clock as a clock input. So, in order to use option 2, deeper idle state MUST be disabled.  Option 3 will still work but it is no better than 32K sync-timer based clocksource.  We must support both sync timer and gptimer based clocksource as some OMAP based derivative SoCs like AM33XX does not have the sync timer.  Considering above, make sync-timer and gptimer clocksource runtime selectable so that both OMAP and AMXXXX continue to use the same code.  And, in order to precisely configure/setup sched_clock for given clocksource, decision has to be made early enough in boot sequence.  So, the solution is,  Use standard kernel parameter ("clocksource=") to override default 32k_sync-timer, in addition to this, we also use hwmod database lookup mechanism, through which at run-time we can identify availability of 32k-sync timer on the device, else fall back to gptimer.  Also, moved low-level SoC specific init code to respective files, (mach-omap1/timer32k.c and mach-omap2/timer.c)  Signed-off-by: Vaibhav Hiremath <hvaibhav@ti.com> Signed-off-by: Felipe Balbi <balbi@ti.com> Reviewed-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Acked-by: Kevin Hilman <khilman@ti.com> Tested-by: Kevin Hilman <khilman@ti.com> Cc: Benoit Cousson <b-cousson@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Tarun Kanti DebBarma <tarun.kanti@ti.com> Cc: Ming Lei <tom.leiming@gmail.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | clkt2xxx_virt_prcm_set.c | s | 4.5K | 138 | Kevin Hilman | khilman@ti.com | 1334450947 |  | ARM: OMAP: clock: cleanup CPUfreq leftovers, fix build errors  Now that we have OPP layer, and OMAP CPUfreq driver is using it, we no longer need/use the clock framework code for filling up CPUfreq tables.  Remove it.  Removing this code also eliminates build errors when CPU_FREQ_TABLE support is not enabled.  Thanks to Russell King for pointing out the parts I missed under plat-omap in the original version and also pointing out the build errors when CPUFREQ_TABLE support was not enabled.  Cc: Russell King <rmk+kernel@arm.linux.org.uk> Signed-off-by: Kevin Hilman <khilman@ti.com> Acked-by: Paul Walmsley <paul@pwsan.com> Acked-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Olof Johansson <olof@lixom.net>
f | hsmmc.c | s | 15K | 515 | Kevin Hilman | khilman@ti.com | 1336667982 |  | ARM: OMAP: AM35xx: convert 3517 detection/flags to AM35xx  Currently cpu_is_omap3517() actually detects any device in the AM35x family (3517 and no-SGX version 3505.)  To make it more clear what is being detected, convert the names from 3517 to AM35xx.  This adds a new soc_is_am35xx() which duplicates the cpu_is_omap3517(). In order to avoid cross-tree dependencies with clock-tree changes, cpu_is_omap3517() is left until the clock changes are merged, at which point cpu_is_omap3517() will be completely removed.  Acked-by: Vaibhav Hiremath <hvaibhav@ti.com> Tested-by: Vaibhav Hiremath <hvaibhav@ti.com> Tested-by: Mark A. Greer <mgreer@animalcreek.com> Signed-off-by: Kevin Hilman <khilman@ti.com> [tony@atomide.com: change to use soc_is_omap instead] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | mux34xx.c | s | 78K | 2040 | Nishanth Menon | nm@ti.com | 1294372708 |  | omap3||4: mux: make local structures static  Mux data is passed by pointers to mux.c from the SoC specific mux file, these variables dont really need to be global scope.  This fixes the following sparse warnings: arch/arm/mach-omap2/mux44xx.c:547:29: warning: symbol 'omap4_core_cbl_ball' was not declared. Should it be static? arch/arm/mach-omap2/mux44xx.c:1265:29: warning: symbol 'omap4_core_cbs_ball' was not declared. Should it be static? arch/arm/mach-omap2/mux44xx.c:1549:29: warning: symbol 'omap4_wkup_cbl_cbs_ball' was not declared. Should it be static?  Signed-off-by: Nishanth Menon <nm@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | sdram-nokia.c | s | 6.3K | 255 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP2+: Move most of plat/io.h into local iomap.h  There's no need to have these defines in plat/io.h.  Note that we now need to ifdef omap_read/write calls as they will be available for omap1 only.  While at it, clean up the includes to group them like they typically are grouped.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | omap-hotplug.c | s | 1.5K | 62 | Santosh Shilimkar | santosh.shilimkar@ti.com | 1330468452 |  | ARM: OMAP: Fix section mismatch warning for platform_cpu_die()  WARNING: vmlinux.o(.text+0x226d0): Section mismatch in reference from the function platform_cpu_die() to the function .cpuinit.text:omap4_hotplug_cpu() The function platform_cpu_die() references the function __cpuinit omap4_hotplug_cpu(). This is often because platform_cpu_die lacks a __cpuinit annotation or the annotation of omap4_hotplug_cpu is wrong.  Thanks to Russell King for suggesting to use __ref instead of the initial (and wrong) approach to use __cpuinit.  Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | prm2xxx_3xxx.h | s | 16K | 394 | Tero Kristo | t-kristo@ti.com | 1324071418 |  | ARM: OMAP: PRCM: add suspend prepare / finish support  PRCM chain handler needs to disable forwarding of interrupts during suspend, because runtime PM is disabled and most of the drivers are potentially not able to handle interrupts coming at this time.  This patch masks all the PRCM interrupt events if a PRCM interrupt occurs during suspend, but does not ack them. Once suspend finish is called, all the masked events will be re-enabled, which causes immediate PRCM interrupt and handles the postponed event.  The suspend prepare and complete  callbacks will be called from pm34xx.c / pm44xx.c files in the following patches.  The functions defined in this patch should eventually be moved to suspend->prepare and suspend->finish driver hooks, once the PRCM chain handler will be made as its own driver.  Signed-off-by: Tero Kristo <t-kristo@ti.com> Cc: Kevin Hilman <khilman@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Tested-by: Kevin Hilman <khilman@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com> [paul@pwsan.com: add kerneldoc, add omap_prcm_irq_setup.saved_mask, add fn  ptrs for save_and_clear_irqen() and restore_irqen()] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | cminst44xx.h | s | 2.2K | 55 | Paul Walmsley | paul@pwsan.com | 1312968043 |  | OMAP: hwmod: fix build break on non-OMAP4 multi-OMAP2 builds  Builds for multi-OMAP2 (e.g., OMAP2420 with OMAP2430) with CONFIG_ARCH_OMAP4=n fail with the following errors:  arch/arm/mach-omap2/built-in.o: In function `_enable_module': arch/arm/mach-omap2/omap_hwmod.c:701: undefined reference to `omap4_cminst_module_enable' arch/arm/mach-omap2/built-in.o: In function `_disable_module': arch/arm/mach-omap2/omap_hwmod.c:726: undefined reference to `omap4_cminst_module_disable' arch/arm/mach-omap2/built-in.o: In function `_wait_target_disable': arch/arm/mach-omap2/omap_hwmod.c:1179: undefined reference to `omap4_cminst_wait_module_idle'  This is probably due to the preprocessor directives in arch/arm/plat-omap/include/plat/cpu.h that convert some cpu_is_omap*() expressions from preprocessor directives into something that is only resolvable during runtime, if multiple OMAP2 build targets are selected.  Thanks to Tony Lindgren <tony@atomide.com> for reporting.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | cpuidle44xx.c | s | 4.9K | 179 | Daniel Lezcano | daniel.lezcano@linaro.org | 1336068057 |  | ARM: OMAP4: cpuidle - remove omap4_idle_data initialization at boot time  We initialized it at compile time, no need to do that at boot time.  Signed-off-by: Daniel Lezcano <daniel.lezcano@linaro.org> Reviewed-by: Jean Pihet <j-pihet@ti.com> Reviewed-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Tested-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Tested-by: Kevin Hilman <khilman@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | omap-wakeupgen.c | s | 9.6K | 332 | Paul Walmsley | paul@pwsan.com | 1334320466 |  | ARM: OMAP2+: declare file-local functions as static  Several function declarations used only in the files in which they're declared should include the static keyword, but don't:      arch/arm/mach-omap2/serial.c:248:6: warning: symbol 'cmdline_find_option' was not declared. Should it be static?     arch/arm/mach-omap2/omap-wakeupgen.c:259:6: warning: symbol 'irq_sar_clear' was not declared. Should it be static?     arch/arm/mach-omap2/board-rx51-peripherals.c:878:27: warning: symbol 'rx51_vibra_data' was not declared. Should it be static?     arch/arm/mach-omap2/board-rx51-peripherals.c:882:27: warning: symbol 'rx51_audio_data' was not declared. Should it be static?     arch/arm/mach-omap2/board-omap4panda.c:201:29: warning: symbol 'omap_panda_wlan_data' was not declared. Should it be static?     arch/arm/mach-omap2/board-omap4panda.c:393:24: warning: symbol 'omap4_panda_dvi_device' was not declared. Should it be static?     arch/arm/mach-omap2/board-omap4panda.c:403:12: warning: symbol 'omap4_panda_dvi_init' was not declared. Should it be static?     arch/arm/mach-omap2/board-omap4panda.c:464:6: warning: symbol 'omap4_panda_display_init' was not declared. Should it be static?     arch/arm/mach-omap2/hsmmc.c:434:6: warning: symbol 'omap_init_hsmmc' was not declared. Should it be static?     arch/arm/mach-omap2/hwspinlock.c:31:12: warning: symbol 'hwspinlocks_init' was not declared. Should it be static?     arch/arm/mach-omap1/timer.c:58:12: warning: symbol 'omap1_dm_timer_init' was not declared. Should it be static?     arch/arm/mach-omap1/fpga.c:90:6: warning: symbol 'innovator_fpga_IRQ_demux' was not declared. Should it be static?  Mark all of these as static.  Thanks to Arnd Bergmann <arnd@arndb.de> for pointing out a typo in the original patch description.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Govindraj R <govindraj.raja@ti.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: David Anders <x0132446@ti.com> Acked-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Acked-by: Arnd Bergmann <arnd@arndb.de>
f | board-rm680.c | s | 4.1K | 148 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | prcm44xx.h | s | 1.1K | 37 | Paul Walmsley | paul@pwsan.com | 1292990714 |  | OMAP4: PRCM: add OMAP4-specific accessor/mutator functions  In some ways, the OMAP4 PRCM register layout is quite different than the OMAP2/3 PRCM register layout.  For example, on OMAP2/3, from a register layout point of view, all CM instances were located in the CM subsystem, and all PRM instances were located in the PRM subsystem. OMAP4 changes this.  Now, for example, some CM instances, such as WKUP_CM and EMU_CM, are located in the system PRM subsystem.  And a "local PRCM" exists for the MPU - this PRCM combines registers that would normally appear in both CM and PRM instances, but uses its own register layout which matches neither the OMAP2/3 PRCM layout nor the OMAP4 PRCM layout.  To try to deal with this, introduce some new functions, omap4_cminst* and omap4_prminst*.  The former is to be used when writing to a CM instance register (no matter what subsystem or hardware module it exists in), and the latter, similarly, with PRM instance registers. To determine which "PRCM partition" to write to, the functions take a PRCM instance ID argument.  Subsequent patches add these partition IDs to the OMAP4 powerdomain and clockdomain definitions.  As far as I can see, there's really no good way to handle these types of register access inconsistencies.  This patch seemed like the least bad approach.  Moving forward, the long-term goal is to remove all direct PRCM register access from the PM code.  PRCM register access should go through layers such as the powerdomain and clockdomain code that can hide the details of how to interact with the specific hardware variant.  While here, rename cm4xxx.c to cm44xx.c to match the naming convention of the other OMAP4 PRCM files.  Thanks to Santosh Shilimkar <santosh.shilimkar@ti.com>, Rajendra Nayak <rnayak@ti.com>, and Benoît Cousson <b-cousson@ti.com> for some comments.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Benoît Cousson <b-cousson@ti.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com>
f | board-omap3evm.c | s | 18K | 574 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | powerdomains2xxx_data.c | s | 2.9K | 116 | Kevin Hilman | khilman@ti.com | 1316111950 |  | OMAP2: add voltage domains and connect to powerdomains  Create basic voltagedomains for OMAP2 and associate OMAP2 powerdomains with the newly created voltage domains.  While here, update copyright on powerdomain data to 2011.  Signed-off-by: Kevin Hilman <khilman@ti.com>
f | vp44xx_data.c | s | 2.8K | 80 | Tony Lindgren | tony@atomide.com | 1321549770 |  | ARM: 7159/1: OMAP: Introduce local common.h files  As suggested by Russell King - ARM Linux <linux@arm.linux.org.uk>, there's no need to keep local prototypes in non-local headers.  Add mach-omap1/common.h and mach-omap2/common.h and move the local prototypes there from plat/common.h and mach/omap4-common.h.  Signed-off-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
f | cm-regbits-24xx.h | s | 14K | 389 | Paul Walmsley | paul@pwsan.com | 1299553377 |  | OMAP2420: clock: use autoidle clkops for all autoidle-controllable interface clocks  Mark each interface clock with a corresponding CM_AUTOIDLE bit with a clkops that has the allow_idle/deny_idle function pointers populated. This allows the OMAP clock framework to enable and disable autoidle for these clocks.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com>
f | board-zoom.c | s | 4.5K | 141 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | sleep24xx.S | g | 3.9K |  | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP2+: Move most of plat/io.h into local iomap.h  There's no need to have these defines in plat/io.h.  Note that we now need to ifdef omap_read/write calls as they will be available for omap1 only.  While at it, clean up the includes to group them like they typically are grouped.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | clkt2xxx_osc.c | s | 1.9K | 63 | Paul Walmsley | paul@pwsan.com | 1299553341 |  | OMAP2+: clock: comment that osc_ck/osc_sys_ck should use clockfw autoidle control  Place some comments in the OMAP oscillator clock control code to note that its autoidle mode should eventually be controlled via the new OMAP clockfw autoidle control interface.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com>
f | clock3xxx.h | s | 563B | 16 | Paul Walmsley | paul@pwsan.com | 1267038975 |  | OMAP3/4 clock: split into per-chip family files  clock34xx_data.c now contains data for the OMAP34xx family, the OMAP36xx family, and the OMAP3517 family, so rename it to clock3xxx_data.c.  Rename clock34xx.c to clock3xxx.c, and move the chip family-specific clock functions to clock34xx.c, clock36xx.c, or clock3517.c, as appropriate.  So now "clock3xxx.*" refers to the OMAP3 superset.  The main goal here is to prepare to compile chip family-specific clock functions only for kernel builds that target that chip family.  To get to that point, we also need to add CONFIG_SOC_* options for those other chip families; that will be done in future patches, planned for 2.6.35.  OMAP4 is also affected by this.  It duplicated the OMAP3 non-CORE DPLL clkops structure.  The OMAP4 variant of this clkops structure has been removed, and since there was nothing else currently in clock44xx.c, it too has been removed -- it can always be added back later when there is some content for it.  (The OMAP4 clock autogeneration scripts have been updated accordingly.)  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Benoît Cousson <b-cousson@ti.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Ranjith Lohithakshan <ranjithl@ti.com> Cc: Tony Lindgren <tony@atomide.com>
f | prminst44xx.c | s | 5.5K | 157 | R Sricharan | r.sricharan@ti.com | 1336456522 |  | ARM: OMAP4+: Add prm and cm base init function.  Instead of statically defining seperate arrays for every OMAP4+ archs, have a generic init function to populate the arrays. This avoids the need for creating new array for every arch added in the future that reuses the prm and cm registers read/write code.  Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: R Sricharan <r.sricharan@ti.com> Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | powerdomain.h | s | 8.8K | 205 | Santosh Shilimkar | santosh.shilimkar@ti.com | 1336456538 |  | ARM: OMAP2+: powerdomain: Get rid off duplicate pwrdm_clkdm_state_switch() API  With patch 'ARM: OMAP2+: powerdomain: Wait for powerdomain transition in pwrdm_state_switch()', the pwrdm_clkdm_state_switch() API becomes duplicate of pwrdm_state_switch().  Get rid off duplicate pwrdm_clkdm_state_switch() and update the users of it with pwrdm_state_switch()  Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | omap_hwmod_common_data.c | s | 1.7K | 50 | Archit Taneja | archit@ti.com | 1320747406 |  | ARM: OMAP2PLUS: DSS: Ensure DSS works correctly if display is enabled in bootloader  Resetting DISPC when a DISPC output is enabled causes the DSS to go into an inconsistent state. Thus if the bootloader has enabled a display, the hwmod code cannot reset the DISPC module just like that, but the outputs need to be disabled first.  Add function dispc_disable_outputs() which disables all active overlay manager and ensure all frame transfers are completed.  Modify omap_dss_reset() to call this function and clear DSS_CONTROL, DSS_SDI_CONTROL and DSS_PLL_CONTROL so that DSS is in a clean state when the DSS2 driver starts.  This resolves the hang issue(caused by a L3 error during boot) seen on the beagle board C3, which has a factory bootloader that enables display. The issue is resolved with this patch.  Thanks to Tomi and Sricharan for some additional testing.  Acked-by: Tomi Valkeinen <tomi.valkeinen@ti.com> Tested-by: R, Sricharan <r.sricharan@ti.com> Signed-off-by: Archit Taneja <archit@ti.com> [paul@pwsan.com: restructured code, removed omap_{read,write}l(), removed  cpu_is_omap*() calls and converted to dev_attr] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | clkt2xxx_sys.c | s | 1.0K | 40 | Paul Walmsley | paul@pwsan.com | 1292986915 |  | OMAP2/3: PRCM: split OMAP2/3-specific PRCM code into OMAP2/3-specific files  In preparation for adding OMAP4-specific PRCM accessor/mutator functions, split the existing OMAP2/3 PRCM code into OMAP2/3-specific files.  Most of what was in mach-omap2/{cm,prm}.{c,h} has now been moved into mach-omap2/{cm,prm}2xxx_3xxx.{c,h}, since it was OMAP2xxx/3xxx-specific.  This process also requires the #includes in each of these files to be changed to reference the new file name.  As part of doing so, add some comments into plat-omap/sram.c and plat-omap/mcbsp.c, which use "sideways includes", to indicate that these users of the PRM/CM includes should not be doing so.  Thanks to Felipe Contreras <felipe.contreras@gmail.com> for comments on this patch.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Jarkko Nikula <jhnikula@gmail.com> Cc: Peter Ujfalusi <peter.ujfalusi@nokia.com> Cc: Liam Girdwood <lrg@slimlogic.co.uk> Cc: Omar Ramirez Luna <omar.ramirez@ti.com> Acked-by: Omar Ramirez Luna <omar.ramirez@ti.com> Cc: Felipe Contreras <felipe.contreras@gmail.com> Acked-by: Felipe Contreras <felipe.contreras@gmail.com> Cc: Greg Kroah-Hartman <greg@kroah.com> Acked-by: Mark Brown <broonie@opensource.wolfsonmicro.com> Reviewed-by: Kevin Hilman <khilman@deeprootsystems.com> Tested-by: Kevin Hilman <khilman@deeprootsystems.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Tested-by: Santosh Shilimkar <santosh.shilimkar@ti.com>
f | clockdomain.h | s | 8.1K | 191 | Paul Walmsley | paul@pwsan.com | 1316037681 |  | OMAP: clockdomain code/data: remove omap_chip bitmask from struct clockdomain  At Tony's request, remove the omap_chip bitmasks from the clockdomain and clockdomain dependency definitions.  Instead, initialize clockdomains based on one or more lists that are applicable to a particular SoC family, variant, and silicon revision.  Tony Lindgren <tony@atomide.com> found a bug in a previous version of this patch - thanks Tony.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Tony Lindgren <tony@atomide.com>
f | usb-fs.c | s | 7.7K | 297 | Paul Walmsley | paul@pwsan.com | 1286559620 |  | OMAP: control: move plat-omap/control.h to mach-omap2/control.h  Only OMAP2+ platforms have the System Control Module (SCM) IP block. In the past, we've kept the SCM header file in plat-omap.  This has led to abuse - device drivers including it; includes being added that create implicit dependencies on OMAP2+ builds; etc.  In response, move the SCM headers into mach-omap2/.  As part of this, remove the direct SCM access from the OMAP UDC driver.  It was clearly broken.  The UDC code needs an indepth review for use on OMAP2+ chips.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Cory Maccarrone <darkstar6262@gmail.com> Cc: Kyungmin Park <kyungmin.park@samsung.com>
f | am35xx-emac.h | s | 530B | 13 | Ilya Yanok | yanok@emcraft.com | 1330974516 |  | ARM: OMAP: move generic EMAC init to separate file  AM35xx SoCs include DaVinci EMAC IP. Initialization code in board-am3517evm.c is pretty board independent and will work for any AM35xx based board so move this code to it's own file to be reused by other boards.  Signed-off-by: Ilya Yanok <yanok@emcraft.com> Signed-off-by: Igor Grinberg <grinberg@compulab.co.il> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | devices.h | s | 515B | 15 | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1300780422 |  | [media] omap3: Add function to register omap3isp platform device structure  The omap3isp platform device requires platform data. Instead of registering the device in omap2_init_devices(), export an omap3_init_camera() function to fill the device structure with the platform data pointer and register the device.  Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Acked-by: Tony Lindgren <tony@atomide.com> Acked-by: Hans Verkuil <hverkuil@xs4all.nl> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | serial.c | s | 10K | 314 | Govindraj.R | govindraj.raja@ti.com | 1338894251 |  | OMAP2+: UART: Add mechanism to probe uart pins and configure rx wakeup  The commit (bce492c0  ARM: OMAP2+: UART: Fix incorrect population of default uart pads) removed default uart pads that where getting populated and which was making rx pin wakeup capable. If uart pads were used in different mode by any other module then it would fail since the default pads took over all the uart pins forcefully. With removal of default pads the rx_pad wakeup for console uart while waking up from off mode is broken.  Utilise the mux api available to probe the availability of mux pins in uart mode and probe for availability of uart pin in mux mode0 if uart is available as uart pin itself then configure rx pin as wakeup capable.  This patch itself doesn't cater to all boards. Boards using uart rx wakeup mechanism should ensure the usage of omap_serial_init_port by configuring required uart ports and pass necessary mux data, till then this probing of uart pins can cater to enabling of rx pad wakeup to most of the boards.  This patch can also throw some boot warning from _omap_mux_get_by_name if pin is requested for availability is not present while dynamically probing the uart pins availability such boot warnings can be addressed only when board files are patched with omap_serial_init_port calls passing the right pads needed for a given port.  Discussion Threads for reference: http://www.spinics.net/lists/linux-omap/msg69859.html http://www.spinics.net/lists/linux-omap/msg68659.html  Cc: Felipe Balbi <balbi@ti.com> Cc: Kevin Hilman <khilman@ti.com> Cc: Russ Dill <russ.dill@gmail.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Ameya Palande <ameya.palande@ti.com> Signed-off-by: Govindraj.R <govindraj.raja@ti.com> [tony@atomide.com: updated to fix compile when CONFIG_OMAP_MUX is not set] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | omap-smp.c | s | 4.6K | 157 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP2+: Move most of plat/io.h into local iomap.h  There's no need to have these defines in plat/io.h.  Note that we now need to ifdef omap_read/write calls as they will be available for omap1 only.  While at it, clean up the includes to group them like they typically are grouped.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | powerdomains44xx_data.c | s | 9.8K | 336 | Benoit Cousson | b-cousson@ti.com | 1316111950 |  | OMAP4: powerdomain data: add voltage domains  Add voltage domain name to indicate which voltagedomain each powerdomain is in.  The fixed voltage domain like ldo_wakeup for emu and wkup power domain is added too.  Signed-off-by: Benoit Cousson <b-cousson@ti.com> Cc: Paul Walmsley <paul@pwsan.com> [khilman@ti.com]: renamed wakeup domain: s/ldo_wakeup/wakeup/ Signed-off-by: Kevin Hilman <khilman@ti.com>
f | prminst44xx.h | s | 1.2K | 29 | Benoit Cousson | b-cousson@ti.com | 1310298991 |  | OMAP4: prm: Replace warm reset API with the offset based version  The warm reset function was still using the obsolete API. Replace it by the new one and move the file to the proper c file.  Change the function names to stick to the file convention as suggested by Paul Walmsley <paul@pwsan.com>: prm_xxx -> prminst_xxx  Signed-off-by: Benoit Cousson <b-cousson@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Rajendra Nayak <rnayak@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | board-generic.c | s | 3.4K | 117 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | prcm_mpu44xx.h | s | 4.7K | 90 | Benoit Cousson | b-cousson@ti.com | 1310260506 |  | OMAP4: prcm_mpu: Fix indent in few macros  Some maros were not well aligned. Re-align them.  Signed-off-by: Benoit Cousson <b-cousson@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Rajendra Nayak <rnayak@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | clockdomains2420_data.c | s | 4.0K | 135 | Paul Walmsley | paul@pwsan.com | 1316037681 |  | OMAP: clockdomain code/data: remove omap_chip bitmask from struct clockdomain  At Tony's request, remove the omap_chip bitmasks from the clockdomain and clockdomain dependency definitions.  Instead, initialize clockdomains based on one or more lists that are applicable to a particular SoC family, variant, and silicon revision.  Tony Lindgren <tony@atomide.com> found a bug in a previous version of this patch - thanks Tony.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Tony Lindgren <tony@atomide.com>
f | omap-smc.S | g | 1.8K |  | Santosh Shilimkar | santosh.shilimkar@ti.com | 1323372540 |  | ARM: OMAP: Add Secure HAL and monitor mode API infrastructure.  On OMAP secure/emulation devices, certain APIs are exported by secure code. Add an infrastructure so that relevant operations on secure devices can be implemented using it.  While at this, rename omap44xx-smc.S to omap-smc.S since the common APIs can be used on other OMAP's too.  Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Acked-by: Jean Pihet <j-pihet@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com> Tested-by: Vishwanath BS <vishwanath.bs@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | board-ldp.c | s | 10K | 397 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | omap_hwmod.c | s | 94K | 2878 | Djamil Elaidi | d-elaidi@ti.com | 1340323726 |  | ARM: OMAP4+: hwmod: fix issue causing IPs not going back to Smart-Standby  If an IP is configured in Smart-Standby-Wakeup, when disabling wakeup feature the IP will not go back to Smart-Standby, but will remain in Smart-Standby-Wakeup.  Signed-off-by: Djamil Elaidi <d-elaidi@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | pm24xx.c | s | 9.6K | 302 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | board-rx51.c | s | 3.2K | 110 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | Kconfig | g | 8.5K |  | Linus Torvalds | torvalds@linux-foundation.org | 1338060709 |  | 
f | board-igep0020.c | s | 17K | 570 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | control.h | s | 18K | 369 | Linus Torvalds | torvalds@linux-foundation.org | 1332889412 |  | 
f | cm.h | s | 1.2K | 33 | Paul Walmsley | paul@pwsan.com | 1340323727 |  | ARM: OMAP2+: CM: increase the module disable timeout  Increase the timeout for disabling an IP block to five milliseconds. This is to handle the usb_host_fs idle latency, which takes almost four milliseconds after a host controller reset.  This is the second of two patches needed to resolve the following boot warning:  omap_hwmod: usb_host_fs: _wait_target_disable failed  Thanks to Sergei Shtylyov <sshtylyov@mvista.com> for finding an unrelated hunk in a previous version of this patch.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Sergei Shtylyov <sshtylyov@mvista.com> Cc: Tero Kristo <t-kristo@ti.com>
f | pm44xx.c | s | 5.9K | 184 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | clockdomain44xx.c | s | 3.7K | 115 | Paul Walmsley | paul@pwsan.com | 1334864029 |  | ARM: OMAP2+: clockdomains: make {prm,cm}_clkdm common  The PRM and CM implicit clockdomains will soon be used by OMAP44xx. So, make them common to OMAP2+ and modify the OMAP4 clockdomains code so use of these clockdomains doesn't crash the system.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Rajendra Nayak <rnayak@ti.com>
f | mux44xx.c | s | 61K | 1337 | Colin Cross | ccross@android.com | 1306920304 |  | ARM: omap4: Pass core and wakeup mux tables to omap4_mux_init  OMAP4 contains two separate instances of the padconf registers, one in the core system config and one in the wakeup system config. Pass in two tables to apply the correct values to each instance.  Signed-off-by: Colin Cross <ccross@android.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | sdram-nokia.h | s | 327B | 10 | Aaro Koskinen | aaro.koskinen@nokia.com | 1292627624 |  | arm: omap: add sdram-nokia.h  Add a header file for Nokia SDRAM functions. Based on patches by Juha Keski-Saari.  Signed-off-by: Aaro Koskinen <aaro.koskinen@nokia.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | cpuidle34xx.c | s | 9.2K | 341 | Daniel Lezcano | daniel.lezcano@linaro.org | 1336165630 |  | ARM: OMAP3: cpuidle - check the powerdomain lookup  At init time, check the powerdomains lookup is successful otherwise exit the cpuidle driver init function with -ENODEV like what is done for the omap3 cpuidle driver.  Signed-off-by: Daniel Lezcano <daniel.lezcano@linaro.org> Reviewed-by: Jean Pihet <j-pihet@ti.com> Tested-by: Kevin Hilman <khilman@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | voltagedomains44xx_data.c | s | 2.7K | 98 | Russell King | rmk+kernel@arm.linux.org.uk | 1329816994 |  | ARM: OMAP: fix voltage domain build errors with PM_OPP disabled  The voltage domain code wants the voltage tables, which are in the opp*.c files.  These files aren't built when PM_OPP is disabled, causing the following build errors at link time:  twl-common.c:(.init.text+0x2e48): undefined reference to `omap34xx_vddmpu_volt_data' twl-common.c:(.init.text+0x2e4c): undefined reference to `omap34xx_vddcore_volt_data' twl-common.c:(.init.text+0x2e5c): undefined reference to `omap36xx_vddmpu_volt_data' twl-common.c:(.init.text+0x2e60): undefined reference to `omap36xx_vddcore_volt_data' twl-common.c:(.init.text+0x2830): undefined reference to `omap44xx_vdd_mpu_volt_data' twl-common.c:(.init.text+0x283c): undefined reference to `omap44xx_vdd_iva_volt_data' twl-common.c:(.init.text+0x2844): undefined reference to `omap44xx_vdd_core_volt_data'  Acked-by: Kevin Hilman <khilman@ti.com> Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
f | clockdomain2xxx_3xxx.c | s | 7.1K | 231 | Paul Walmsley | paul@pwsan.com | 1316037681 |  | OMAP: clockdomain code/data: remove omap_chip bitmask from struct clockdomain  At Tony's request, remove the omap_chip bitmasks from the clockdomain and clockdomain dependency definitions.  Instead, initialize clockdomains based on one or more lists that are applicable to a particular SoC family, variant, and silicon revision.  Tony Lindgren <tony@atomide.com> found a bug in a previous version of this patch - thanks Tony.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Tony Lindgren <tony@atomide.com>
f | sdram-qimonda-hyb18m512160af-6.h | s | 1.2K | 50 | Tony Lindgren | tony@atomide.com | 1256056847 |  | omap: headers: Move remaining headers from include/mach to include/plat  Move the remaining headers under plat-omap/include/mach to plat-omap/include/plat. Also search and replace the files using these headers to include using the right path.  This was done with:  #!/bin/bash mach_dir_old="arch/arm/plat-omap/include/mach" plat_dir_new="arch/arm/plat-omap/include/plat" headers=$(cd $mach_dir_old && ls *.h) omap_dirs="arch/arm/*omap*/ \ drivers/video/omap \ sound/soc/omap" other_files="drivers/leds/leds-ams-delta.c \ drivers/mfd/menelaus.c \ drivers/mfd/twl4030-core.c \ drivers/mtd/nand/ams-delta.c"  for header in $headers; do 	old="#include <mach\/$header" 	new="#include <plat\/$header" 	for dir in $omap_dirs; do 		find $dir -type f -name \*.[chS] || \ 			xargs sed -i "s/$old/$new/" 	done 	find drivers/ -type f -name \*omap*.[chS] || \ 		xargs sed -i "s/$old/$new/" 	for file in $other_files; do 		sed -i "s/$old/$new/" $file 	done done  for header in $(ls $mach_dir_old/*.h); do 	git mv $header $plat_dir_new/ done  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | omap_hwmod_2430_data.c | s | 23K | 849 | Vaibhav Hiremath | hvaibhav@ti.com | 1336519536 |  | ARM: OMAP2/3: hwmod data: Add 32k-sync timer data to hwmod database  Add 32k-sync timer hwmod-data and add ocp_if details to omap2 & 3 hwmod table.  Signed-off-by: Vaibhav Hiremath <hvaibhav@ti.com> Signed-off-by: Felipe Balbi <balbi@ti.com> Reviewed-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: Benoit Cousson <b-cousson@ti.com> Cc: Tony Lindgren <tony@atomide.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Kevin Hilman <khilman@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | clock2430_data.c | s | 62K | 1906 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP: Remove plat/io.h by splitting it into mach/io.h and mach/hardware.h  This is needed to minimize io.h so the SoC specific io.h for ARMs can removed.  Note that minimal driver changes for DSS and RNG are needed to include cpu.h for SoC detection macros.  Cc: Tomi Valkeinen <tomi.valkeinen@ti.com> Cc: Matt Mackall <mpm@selenic.com> Cc: Herbert Xu <herbert@gondor.apana.org.au> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | sram243x.S | g | 10K |  | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP2+: Move most of plat/io.h into local iomap.h  There's no need to have these defines in plat/io.h.  Note that we now need to ifdef omap_read/write calls as they will be available for omap1 only.  While at it, clean up the includes to group them like they typically are grouped.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | opp4xxx_data.c | s | 3.7K | 90 | Tony Lindgren | tony@atomide.com | 1299865198 |  | Merge branch 'for_2.6.39/pm-integration' of ssh://master.kernel.org/pub/scm/linux/kernel/git/khilman/linux-omap-pm into omap-for-linus
f | board-zoom-peripherals.c | s | 7.6K | 276 | Tony Lindgren | tony@atomide.com | 1333041364 |  | Merge branch 'fixes-gpio-to-irq' into fixes  Conflicts: 	arch/arm/mach-omap1/board-htcherald.c 	arch/arm/mach-omap2/board-rx51-peripherals.c 	arch/arm/plat-omap/include/plat/gpio.h 	drivers/input/serio/ams_delta_serio.c
f | vp.h | s | 4.2K | 116 | Kevin Hilman | khilman@ti.com | 1316113748 |  | OMAP3+: VP: remove unused omap_vp_get_curr_volt()  Signed-off-by: Kevin Hilman <khilman@ti.com>
f | clockdomains2430_data.c | s | 4.9K | 160 | Paul Walmsley | paul@pwsan.com | 1316037681 |  | OMAP: clockdomain code/data: remove omap_chip bitmask from struct clockdomain  At Tony's request, remove the omap_chip bitmasks from the clockdomain and clockdomain dependency definitions.  Instead, initialize clockdomains based on one or more lists that are applicable to a particular SoC family, variant, and silicon revision.  Tony Lindgren <tony@atomide.com> found a bug in a previous version of this patch - thanks Tony.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Tony Lindgren <tony@atomide.com>
f | msdi.c | s | 2.6K | 74 | Tony Lindgren | tony@atomide.com | 1336519413 |  | ARM: OMAP2420: hwmod data: Add MMC hwmod data for 2420  Add MMC for 2420 so we can pass the DMA request lines the same way as we already do on omap2430 and later.  Cc: Benoit Cousson <b-cousson@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: Tony Lindgren <tony@atomide.com> [paul@pwsan.com: updated to apply on top of the 3.5 hwmod cleanup;  changed mmc hwmod name/class to "msdi" as documented in the 2420 TRM Rev X;  added sysconfig register information; added 16 bit register width flag;  added MSDI custom reset code] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | board-cm-t35.c | s | 18K | 587 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | omap-headsmp.S | g | 1.2K |  | Russell King | rmk+kernel@arm.linux.org.uk | 1329127237 |  | ARM: omap: fix section mismatch warning for omap_secondary_startup()  WARNING: vmlinux.o(.text+0x1c664): Section mismatch in reference from the function omap_secondary_startup() to the function .cpuinit.text:secondary_startup() The function omap_secondary_startup() references the function __cpuinit secondary_startup(). This is often because omap_secondary_startup lacks a __cpuinit annotation or the annotation of secondary_startup is wrong.  Unfortunately, fixing this causes a new warning which is harder to solve:  WARNING: arch/arm/mach-omap2/built-in.o(.text+0x5328): Section mismatch in reference from the function omap4_hotplug_cpu() to the function .cpuinit.text:omap_secondary_startup() The function omap4_hotplug_cpu() references the function __cpuinit omap_secondary_startup(). This is often because omap4_hotplug_cpu lacks a __cpuinit annotation or the annotation of omap_secondary_startup is wrong.  because omap4_hotplug_cpu() is used by power management code as well, which may not end up using omap_secondary_startup().  Acked-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
f | pm-debug.c | s | 5.9K | 221 | Jean Pihet | jean.pihet@newoldbits.com | 1330990682 |  | ARM: OMAP2+: PM debug: fix the use of debugfs_create_* API  Check the return code pointer value from debugfs_create_dir for error or NULL. Also added an additional check to prevent the creation of a 'suspend' entry at the debugfs root in case a power domain directory cannot be created.  Signed-off-by: Jean Pihet <j-pihet@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | clock2xxx.h | s | 1.3K | 36 | Felipe Balbi | balbi@ti.com | 1299721468 |  | OMAP: clock: fix compile warning  if building kernels without OMAP2 support, we will see a warning such as:  arch/arm/mach-omap2/io.c: In function 'omap2_init_common_infrastructure': arch/arm/mach-omap2/io.c:389:3: warning: statement with no effect arch/arm/mach-omap2/io.c:391:3: warning: statement with no effect  Signed-off-by: Felipe Balbi <balbi@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | io.c | s | 10K | 462 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | omap_hwmod_2420_data.c | s | 14K | 528 | Vaibhav Hiremath | hvaibhav@ti.com | 1336519536 |  | ARM: OMAP2/3: hwmod data: Add 32k-sync timer data to hwmod database  Add 32k-sync timer hwmod-data and add ocp_if details to omap2 & 3 hwmod table.  Signed-off-by: Vaibhav Hiremath <hvaibhav@ti.com> Signed-off-by: Felipe Balbi <balbi@ti.com> Reviewed-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: Benoit Cousson <b-cousson@ti.com> Cc: Tony Lindgren <tony@atomide.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Kevin Hilman <khilman@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | board-apollon.c | s | 9.0K | 314 | Shawn Guo | shawn.guo@linaro.org | 1336480580 |  | ARM: omap2: use machine specific hook for late init  Signed-off-by: Shawn Guo <shawn.guo@linaro.org> Acked-by: Tony Lindgren <tony@atomide.com>
f | prm.h | s | 1.5K | 49 | Paul Walmsley | paul@pwsan.com | 1292986915 |  | OMAP2/3: PRCM: split OMAP2/3-specific PRCM code into OMAP2/3-specific files  In preparation for adding OMAP4-specific PRCM accessor/mutator functions, split the existing OMAP2/3 PRCM code into OMAP2/3-specific files.  Most of what was in mach-omap2/{cm,prm}.{c,h} has now been moved into mach-omap2/{cm,prm}2xxx_3xxx.{c,h}, since it was OMAP2xxx/3xxx-specific.  This process also requires the #includes in each of these files to be changed to reference the new file name.  As part of doing so, add some comments into plat-omap/sram.c and plat-omap/mcbsp.c, which use "sideways includes", to indicate that these users of the PRM/CM includes should not be doing so.  Thanks to Felipe Contreras <felipe.contreras@gmail.com> for comments on this patch.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Jarkko Nikula <jhnikula@gmail.com> Cc: Peter Ujfalusi <peter.ujfalusi@nokia.com> Cc: Liam Girdwood <lrg@slimlogic.co.uk> Cc: Omar Ramirez Luna <omar.ramirez@ti.com> Acked-by: Omar Ramirez Luna <omar.ramirez@ti.com> Cc: Felipe Contreras <felipe.contreras@gmail.com> Acked-by: Felipe Contreras <felipe.contreras@gmail.com> Cc: Greg Kroah-Hartman <greg@kroah.com> Acked-by: Mark Brown <broonie@opensource.wolfsonmicro.com> Reviewed-by: Kevin Hilman <khilman@deeprootsystems.com> Tested-by: Kevin Hilman <khilman@deeprootsystems.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Tested-by: Santosh Shilimkar <santosh.shilimkar@ti.com>
f | board-overo.c | s | 13K | 488 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | powerdomain.c | s | 27K | 870 | Santosh Shilimkar | santosh.shilimkar@ti.com | 1336456538 |  | ARM: OMAP2+: powerdomain: Get rid off duplicate pwrdm_clkdm_state_switch() API  With patch 'ARM: OMAP2+: powerdomain: Wait for powerdomain transition in pwrdm_state_switch()', the pwrdm_clkdm_state_switch() API becomes duplicate of pwrdm_state_switch().  Get rid off duplicate pwrdm_clkdm_state_switch() and update the users of it with pwrdm_state_switch()  Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: Rajendra Nayak <rnayak@ti.com> Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | voltage.c | s | 11K | 380 | Kevin Hilman | khilman@ti.com | 1331084234 |  | ARM: OMAP2+: voltage: ensure voltage used is exact voltage from OPP table  When using the SMPS regulators to scale voltages, the regulator framework may pass a minimum voltage that is not an exact OPP voltage. For the VC/VP controlled voltage domains, we must ensure that the voltage requested is the exact voltage from the OPP table.  This is especially critical when using SR.  To fix, voltdm_scale() uses the target voltage passed to walk through the OPP voltages until it finds a voltage that is >= one of the OPP voltages.  Cc: Tero Kristo <t-kristo@ti.com> Cc: Nishanth Menon <nm@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | clockdomains3xxx_data.c | s | 10K | 348 | Mark A. Greer | mgreer@animalcreek.com | 1336456538 |  | arm: omap3: clockdomain data: Remove superfluous commas from gfx_sgx_3xxx_wkdeps[]  Clean up clockdomains3xxx_data.c a bit by removing the superfluous commas in gfx_sgx_3xxx_wkdeps[].  Signed-off-by: Mark A. Greer <mgreer@animalcreek.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | omap_hwmod_common_data.h | s | 8.0K | 157 | Vaibhav Hiremath | hvaibhav@ti.com | 1336519536 |  | ARM: OMAP2/3: hwmod data: Add 32k-sync timer data to hwmod database  Add 32k-sync timer hwmod-data and add ocp_if details to omap2 & 3 hwmod table.  Signed-off-by: Vaibhav Hiremath <hvaibhav@ti.com> Signed-off-by: Felipe Balbi <balbi@ti.com> Reviewed-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: Benoit Cousson <b-cousson@ti.com> Cc: Tony Lindgren <tony@atomide.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Kevin Hilman <khilman@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | powerdomains3xxx_data.c | s | 7.9K | 289 | Kevin Hilman | khilman@ti.com | 1336667982 |  | ARM: OMAP: AM35xx: convert 3517 detection/flags to AM35xx  Currently cpu_is_omap3517() actually detects any device in the AM35x family (3517 and no-SGX version 3505.)  To make it more clear what is being detected, convert the names from 3517 to AM35xx.  This adds a new soc_is_am35xx() which duplicates the cpu_is_omap3517(). In order to avoid cross-tree dependencies with clock-tree changes, cpu_is_omap3517() is left until the clock changes are merged, at which point cpu_is_omap3517() will be completely removed.  Acked-by: Vaibhav Hiremath <hvaibhav@ti.com> Tested-by: Vaibhav Hiremath <hvaibhav@ti.com> Tested-by: Mark A. Greer <mgreer@animalcreek.com> Signed-off-by: Kevin Hilman <khilman@ti.com> [tony@atomide.com: change to use soc_is_omap instead] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | sram242x.S | g | 10K |  | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP2+: Move most of plat/io.h into local iomap.h  There's no need to have these defines in plat/io.h.  Note that we now need to ifdef omap_read/write calls as they will be available for omap1 only.  While at it, clean up the includes to group them like they typically are grouped.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | mux44xx.h | s | 15K | 286 | Benoit Cousson | b-cousson@ti.com | 1289991712 |  | OMAP4: mux: Add CBS package data for OMAP4430 ES2  Please note that the full muxmodes are re-defined for ES2 instead of using the subset. There are 81 differences among 204 pins. The subset fixup will have to iterate over the whole list for each subset entry, which can lead to an important number of iteration. On the other hand, it will take much more memory at boot time.  Signed-off-by: Benoit Cousson <b-cousson@ti.com> Cc: Tony Lindgren <tony@atomide.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com> Cc: Anand Gadiyar <gadiyar@ti.com>
f | common.h | s | 8.2K | 273 | Linus Torvalds | torvalds@linux-foundation.org | 1338063241 |  | 
f | omap_hwmod_44xx_data.c | s | 153K | 5462 | Ricardo Neri | ricardo.neri@ti.com | 1340323727 |  | ARM: OMAP4: hwmod data: Force HDMI in no-idle while enabled  As per the OMAP4 documentation, audio over HDMI must be transmitted in no-idle mode. This patch adds the HWMOD_SWSUP_SIDLE so that omap_hwmod uses no-idle/force-idle settings instead of smart-idle mode.  This is required as the DSS interface clock is used as functional clock for the HDMI wrapper audio FIFO. If no-idle mode is not used, audio could be choppy, have bad quality or not be audible at all.  Signed-off-by: Ricardo Neri <ricardo.neri@ti.com> [b-cousson@ti.com: Update the subject and align the .flags location with the script template] Signed-off-by: Benoit Cousson <b-cousson@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | opp.c | s | 2.5K | 83 | Nishanth Menon | nm@ti.com | 1332457877 |  | ARM: OMAP2+: OPP: allow OPP enumeration to continue if device is not present  On platforms such as OMAP3, certain variants may not have IVA, SGX or some specific component. We currently have a check to aid fixing wrong population of OPP entries for issues such as typos. This however causes a conflict with valid requirement where the SoC variant does not actually have the module present.  So, reduce the severity of the print to a debug statement and skip registering that specific OPP, but continue down the list.  Reported-by: Steve Sakoman <steve@sakoman.com> Reported-by: Maximilian Schwerin <mvs@tigris.de> Acked-by: Steve Sakoman <steve@sakoman.com> Tested-by: Maximilian Schwerin <mvs@tigris.de> Signed-off-by: Nishanth Menon <nm@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | wd_timer.c | s | 2.9K | 84 | Kevin Hilman | khilman@ti.com | 1336519537 |  | ARM: OMAP2+: WDTIMER integration: fix !PM boot crash, disarm timer after hwmod reset  Without runtime PM enabled, hwmod needs to leave all IP blocks in an enabled state by default so any driver access to the HW will succeed. This is accomplished by seting the postsetup_state to enabled for all hwmods during init when runtime PM is disabled.  Currently, we have a special case for WDT in that its postsetup_state is always set to disabled.  This is done so that the WDT is disabled and the timer is disarmed at boot in case there is no WDT driver. This also means that when runtime PM is disabled, if a WDT driver *is* built in the kernel, the kernel will crash on the first access to the WDT hardware.  We can't simply leave the WDT module enabled, because the timer is armed by default after reset. That means that if there is no WDT driver initialzed or loaded before the timer expires, the kernel will reboot.  To fix this, a custom reset method is added to the watchdog class of omap_hwmod.  This method will *always* disarm the timer after hwmod reset.  The WDT timer then will only be rearmed when/if the driver is loaded for the WDT.  With the timer disarmed by default, we no longer need a special-case for the postsetup_state of WDT during init, so it is removed.  Any platforms wishing to ensure the watchdog remains armed across the entire boot boot can simply disable the reset-on-init feature of the watchdog hwmod using omap_hwmod_no_setup_reset().  Tested on 3530/Overo, 4430/Panda.  NOTE: on 4430, the hwmod OCP reset does not seem to rearm the timer as documented in the TRM (and what happens on OMAP3.)  I noticed this because testing the HWMOD_INIT_NO_RESET feature with no driver loaded, I expected a reboot part way through the boot, but did not see a reboot.  Adding some debug to read the counter, I verified that right after OCP softreset, the counter is not firing.  After writing the magic start sequence, the timer starts counting.  This means that the timer disarm sequence added here does not seem to be needed for 4430, but is technically the correct way to ensure the timer is disarmed, so it is left in for OMAP4.  Special thanks to Paul Walmsley for helping brainstorm ideas to fix this problem.  Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: Kevin Hilman <khilman@ti.com> Cc: Santosh Shilimkar <santosh.shilimkar@ti.com> Acked-by: Santosh Shilimkar <santosh.shilimkar@ti.com> [paul@pwsan.com: updated the omap2_wd_timer_reset() function in the  wake of commit 3c55c1baffa5f719eb2ae9729088bc867f972f53 ("ARM:  OMAP2+: hwmod: Revert "ARM: OMAP2+: hwmod: Make omap_hwmod_softreset  wait for reset status""); added kerneldoc; rolled in warning fix from Kevin] Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | sdrc2xxx.c | s | 4.3K | 146 | Tony Lindgren | tony@atomide.com | 1331139783 |  | ARM: OMAP2+: Fix build error after merge  Commit 9890ce44 (ARM: get rid of asm/irq.h in asm/prom.h) removed include of asm/irq.h in asm/prom.h. This commit together with recent omap cleanup to remove io.h causes build breakage:  arrch/arm/mach-omap2/control.c: In function 'omap3_ctrl_write_boot_mode': arch/arm/mach-omap2/control.c:238: error: 'OMAP343X_CTRL_BASE' undeclared (first use in this function) ...  Fix this by including hardware.h directly where needed instead of relying on asm/irq.h in asm/prom.h.  Reported-by: Russell King <rmk+kernel@arm.linux.org.uk> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | prm44xx.c | s | 7.0K | 210 | Tony Lindgren | tony@atomide.com | 1333471772 |  | Merge branch 'misc_devel_3.4' of git://git.pwsan.com/linux-2.6 into fixes
f | sdrc.c | s | 4.4K | 151 | Tony Lindgren | tony@atomide.com | 1321549770 |  | ARM: 7159/1: OMAP: Introduce local common.h files  As suggested by Russell King - ARM Linux <linux@arm.linux.org.uk>, there's no need to keep local prototypes in non-local headers.  Add mach-omap1/common.h and mach-omap2/common.h and move the local prototypes there from plat/common.h and mach/omap4-common.h.  Signed-off-by: Tony Lindgren <tony@atomide.com> Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
f | clockdomains_common_data.c | s | 536B | 20 | Paul Walmsley | paul@pwsan.com | 1334864029 |  | ARM: OMAP2+: clockdomains: make {prm,cm}_clkdm common  The PRM and CM implicit clockdomains will soon be used by OMAP44xx. So, make them common to OMAP2+ and modify the OMAP4 clockdomains code so use of these clockdomains doesn't crash the system.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: Rajendra Nayak <rnayak@ti.com>
f | omap4-sar-layout.h | s | 1.8K | 44 | Santosh Shilimkar | santosh.shilimkar@ti.com | 1323372541 |  | ARM: OMAP4: PM: Add L2X0 cache lowpower support  When MPUSS hits off-mode, L2 cache is lost. This patch adds L2X0 necessary maintenance operations and context restoration in the low power code.  Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Acked-by: Jean Pihet <j-pihet@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com> Tested-by: Vishwanath BS <vishwanath.bs@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | clock3517.c | s | 4.2K | 114 | Paul Walmsley | paul@pwsan.com | 1299553443 |  | OMAP3: clock: use autoidle clkops for all autoidle-controllable interface clocks  Mark each interface clock with a corresponding CM_AUTOIDLE bit with a clkops that has the allow_idle/deny_idle function pointers populated. This allows the OMAP clock framework to enable and disable autoidle for these clocks.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Tested-by: Rajendra Nayak <rnayak@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com>
f | mux2430.h | s | 19K | 366 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | Makefile.boot | g | 86B |  | Sascha Hauer | s.hauer@pengutronix.de | 1318839160 |  | ARM: 7022/1: allow to detect conflicting zreladdrs  Boards used to specify zreladdr in their Makefile.boot with zreladdr-y := x, so conflicting zreladdrs were silently overwritten. This patch changes this to zreladdr-y += x, so that we end up with multiple words in zreladdr in such a case. We can detect this later and complain if necessary.  Signed-off-by: Sascha Hauer <s.hauer@pengutronix.de> Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
f | mux.h | s | 9.5K | 307 | Govindraj.R | govindraj.raja@ti.com | 1338894251 |  | OMAP2+: UART: Add mechanism to probe uart pins and configure rx wakeup  The commit (bce492c0  ARM: OMAP2+: UART: Fix incorrect population of default uart pads) removed default uart pads that where getting populated and which was making rx pin wakeup capable. If uart pads were used in different mode by any other module then it would fail since the default pads took over all the uart pins forcefully. With removal of default pads the rx_pad wakeup for console uart while waking up from off mode is broken.  Utilise the mux api available to probe the availability of mux pins in uart mode and probe for availability of uart pin in mux mode0 if uart is available as uart pin itself then configure rx pin as wakeup capable.  This patch itself doesn't cater to all boards. Boards using uart rx wakeup mechanism should ensure the usage of omap_serial_init_port by configuring required uart ports and pass necessary mux data, till then this probing of uart pins can cater to enabling of rx pad wakeup to most of the boards.  This patch can also throw some boot warning from _omap_mux_get_by_name if pin is requested for availability is not present while dynamically probing the uart pins availability such boot warnings can be addressed only when board files are patched with omap_serial_init_port calls passing the right pads needed for a given port.  Discussion Threads for reference: http://www.spinics.net/lists/linux-omap/msg69859.html http://www.spinics.net/lists/linux-omap/msg68659.html  Cc: Felipe Balbi <balbi@ti.com> Cc: Kevin Hilman <khilman@ti.com> Cc: Russ Dill <russ.dill@gmail.com> Cc: Paul Walmsley <paul@pwsan.com> Cc: Ameya Palande <ameya.palande@ti.com> Signed-off-by: Govindraj.R <govindraj.raja@ti.com> [tony@atomide.com: updated to fix compile when CONFIG_OMAP_MUX is not set] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | cm-regbits-44xx.h | s | 53K | 1164 | Linus Torvalds | torvalds@linux-foundation.org | 1311725371 |  | Merge branch 'next/soc' of git://git.kernel.org/pub/scm/linux/kernel/git/arm/linux-arm-soc  * 'next/soc' of git://git.kernel.org/pub/scm/linux/kernel/git/arm/linux-arm-soc:   MAINTAINERS: add maintainer of CSR SiRFprimaII machine   ARM: CSR: initializing L2 cache   ARM: CSR: mapping early DEBUG_LL uart   ARM: CSR: Adding CSR SiRFprimaII board support   OMAP4: clocks: Update the clock tree with 4460 clock nodes   OMAP4: PRCM: OMAP4460 specific PRM and CM register bitshifts   OMAP4: ID: add omap_has_feature for max freq supported   OMAP: ID: introduce chip detection for OMAP4460   ARM: Xilinx: merge board file into main platform code   ARM: Xilinx: Adding Xilinx board support  Fix up conflicts in arch/arm/mach-omap2/cm-regbits-44xx.h
f | opp3xxx_data.c | s | 6.0K | 145 | Tony Lindgren | tony@atomide.com | 1299865198 |  | Merge branch 'for_2.6.39/pm-integration' of ssh://master.kernel.org/pub/scm/linux/kernel/git/khilman/linux-omap-pm into omap-for-linus
f | sdram-numonyx-m65kxxxxam.h | s | 1.1K | 47 | Enric Balletbo i Serra | eballetbo@iseebcn.com | 1266456200 |  | omap3: SDRC: add timing data for Numonyx M65KxxxxAM  Add timing data for the Numonyx M65KxxxxAM SDRAM chip, used on the IGEP v2 board.  Signed-off-by: Enric Balletbo i Serra <eballetbo@iseebcn.com> Signed-off-by: Tony Lindgren <tony@atomide.com>
f | vc3xxx_data.c | s | 2.4K | 67 | Tero Kristo | t-kristo@ti.com | 1331084124 |  | arm: omap3: voltage: fix channel configuration  OMAP3 uses the default settings for VDD1 channel, otherwise the settings will overlap with VDD2 and attempting to modify VDD1 voltage will actually change VDD2 voltage.  Signed-off-by: Tero Kristo <t-kristo@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com> Signed-off-by: Kevin Hilman <khilman@ti.com>
f | omap_l3_smx.c | s | 7.3K | 263 | Tony Lindgren | tony@atomide.com | 1338972140 |  | ARM: OMAP3: Fix omap3_l3_block_irq warning when CONFIG_BUG is not set  Otherwise we will get:  arch/arm/mach-omap2/omap_l3_smx.c: In function ‘omap3_l3_block_irq’: arch/arm/mach-omap2/omap_l3_smx.c:156: warning: unused variable ‘address’ arch/arm/mach-omap2/omap_l3_smx.c:155: warning: unused variable ‘multi’ arch/arm/mach-omap2/omap_l3_smx.c:154: warning: unused variable ‘initid’ arch/arm/mach-omap2/omap_l3_smx.c:153: warning: unused variable ‘code’ arch/arm/mach-omap2/omap_l3_smx.c: At top level: arch/arm/mach-omap2/omap_l3_smx.c:68: warning: ‘omap3_l3_code_string’ defined but not used arch/arm/mach-omap2/omap_l3_smx.c:90: warning: ‘omap3_l3_initiator_string’ defined but not used  Fix it by always showing the L3 error.  Signed-off-by: Tony Lindgren <tony@atomide.com>
f | prm-regbits-44xx.h | s | 80K | 1790 | Rajendra Nayak | rnayak@ti.com | 1310116704 |  | OMAP4: PRCM: OMAP4460 specific PRM and CM register bitshifts  This patch adds additional register bitshifts for registers added in OMAP4460 platform.  Signed-off-by: Rajendra Nayak <rnayak@ti.com> Signed-off-by: Nishanth Menon <nm@ti.com> Signed-off-by: Benoit Cousson <b-cousson@ti.com> Reviewed-by: Kevin Hilman <khilman@ti.com> Acked-by: Paul Walmsley <paul@pwsan.com> [tony@atomide.com: updated to apply on cleanup patches] Signed-off-by: Tony Lindgren <tony@atomide.com>
f | hdq1w.c | s | 2.3K | 63 | Paul Walmsley | paul@pwsan.com | 1336519536 |  | ARM: OMAP2+: HDQ1W: add custom reset function  Implement a custom reset function for the HDQ1W IP block.  This is because the HDQ1W IP block, like I2C, has an internal clock gating bit that needs to be toggled after setting the SOFTRESET bit to allow the reset to propagate.  Signed-off-by: Paul Walmsley <paul@pwsan.com> Cc: NeilBrown <neilb@suse.de> Cc: Avinash.H.M <avinashhm@ti.com> Tested-by: NeilBrown <neilb@suse.de>
f | prcm.c | s | 4.9K | 147 | R Sricharan | r.sricharan@ti.com | 1336456522 |  | ARM: OMAP4+: Add prm and cm base init function.  Instead of statically defining seperate arrays for every OMAP4+ archs, have a generic init function to populate the arrays. This avoids the need for creating new array for every arch added in the future that reuses the prm and cm registers read/write code.  Cc: Paul Walmsley <paul@pwsan.com> Signed-off-by: R Sricharan <r.sricharan@ti.com> Signed-off-by: Santosh Shilimkar <santosh.shilimkar@ti.com> Signed-off-by: Paul Walmsley <paul@pwsan.com>
f | opp2420_data.c | s | 4.9K | 116 | Tony Lindgren | tony@atomide.com | 1330108475 |  | ARM: OMAP: Remove plat/io.h by splitting it into mach/io.h and mach/hardware.h  This is needed to minimize io.h so the SoC specific io.h for ARMs can removed.  Note that minimal driver changes for DSS and RNG are needed to include cpu.h for SoC detection macros.  Cc: Tomi Valkeinen <tomi.valkeinen@ti.com> Cc: Matt Mackall <mpm@selenic.com> Cc: Herbert Xu <herbert@gondor.apana.org.au> Signed-off-by: Tony Lindgren <tony@atomide.com>
