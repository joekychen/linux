<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-omap2 › board-rx51-peripherals.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>board-rx51-peripherals.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * linux/arch/arm/mach-omap2/board-rx51-peripherals.c</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2008-2009 Nokia</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/input.h&gt;</span>
<span class="cp">#include &lt;linux/input/matrix_keypad.h&gt;</span>
<span class="cp">#include &lt;linux/spi/spi.h&gt;</span>
<span class="cp">#include &lt;linux/wl12xx.h&gt;</span>
<span class="cp">#include &lt;linux/spi/tsc2005.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/i2c/twl.h&gt;</span>
<span class="cp">#include &lt;linux/clk.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/regulator/machine.h&gt;</span>
<span class="cp">#include &lt;linux/gpio.h&gt;</span>
<span class="cp">#include &lt;linux/gpio_keys.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/host.h&gt;</span>
<span class="cp">#include &lt;linux/power/isp1704_charger.h&gt;</span>
<span class="cp">#include &lt;asm/system_info.h&gt;</span>

<span class="cp">#include &lt;plat/mcspi.h&gt;</span>
<span class="cp">#include &lt;plat/board.h&gt;</span>
<span class="cp">#include &quot;common.h&quot;</span>
<span class="cp">#include &lt;plat/dma.h&gt;</span>
<span class="cp">#include &lt;plat/gpmc.h&gt;</span>
<span class="cp">#include &lt;plat/onenand.h&gt;</span>
<span class="cp">#include &lt;plat/gpmc-smc91x.h&gt;</span>

<span class="cp">#include &lt;mach/board-rx51.h&gt;</span>

<span class="cp">#include &lt;sound/tlv320aic3x.h&gt;</span>
<span class="cp">#include &lt;sound/tpa6130a2-plat.h&gt;</span>
<span class="cp">#include &lt;media/radio-si4713.h&gt;</span>
<span class="cp">#include &lt;media/si4713.h&gt;</span>
<span class="cp">#include &lt;linux/leds-lp5523.h&gt;</span>

<span class="cp">#include &lt;../drivers/staging/iio/light/tsl2563.h&gt;</span>
<span class="cp">#include &lt;linux/lis3lv02d.h&gt;</span>

<span class="cp">#include &quot;mux.h&quot;</span>
<span class="cp">#include &quot;hsmmc.h&quot;</span>
<span class="cp">#include &quot;common-board-devices.h&quot;</span>

<span class="cp">#define SYSTEM_REV_B_USES_VAUX3	0x1699</span>
<span class="cp">#define SYSTEM_REV_S_USES_VAUX3 0x8</span>

<span class="cp">#define RX51_WL1251_POWER_GPIO		87</span>
<span class="cp">#define RX51_WL1251_IRQ_GPIO		42</span>
<span class="cp">#define RX51_FMTX_RESET_GPIO		163</span>
<span class="cp">#define RX51_FMTX_IRQ			53</span>
<span class="cp">#define RX51_LP5523_CHIP_EN_GPIO	41</span>

<span class="cp">#define RX51_USB_TRANSCEIVER_RST_GPIO	67</span>

<span class="cp">#define RX51_TSC2005_RESET_GPIO         104</span>
<span class="cp">#define RX51_TSC2005_IRQ_GPIO           100</span>

<span class="cp">#define LIS302_IRQ1_GPIO 181</span>
<span class="cp">#define LIS302_IRQ2_GPIO 180  </span><span class="cm">/* Not yet in use */</span><span class="cp"></span>

<span class="cm">/* list all spi devices here */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">RX51_SPI_WL1251</span><span class="p">,</span>
	<span class="n">RX51_SPI_MIPID</span><span class="p">,</span>		<span class="cm">/* LCD panel */</span>
	<span class="n">RX51_SPI_TSC2005</span><span class="p">,</span>	<span class="cm">/* Touch Controller */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">wl12xx_platform_data</span> <span class="n">wl1251_pdata</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">tsc2005_platform_data</span> <span class="n">tsc2005_pdata</span><span class="p">;</span>

<span class="cp">#if defined(CONFIG_SENSORS_LIS3_I2C) || defined(CONFIG_SENSORS_LIS3_I2C_MODULE)</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">lis302_setup</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">irq1</span> <span class="o">=</span> <span class="n">LIS302_IRQ1_GPIO</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">irq2</span> <span class="o">=</span> <span class="n">LIS302_IRQ2_GPIO</span><span class="p">;</span>

	<span class="cm">/* gpio for interrupt pin 1 */</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">gpio_request</span><span class="p">(</span><span class="n">irq1</span><span class="p">,</span> <span class="s">&quot;lis3lv02dl_irq1&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;lis3lv02dl: gpio request failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* gpio for interrupt pin 2 */</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">gpio_request</span><span class="p">(</span><span class="n">irq2</span><span class="p">,</span> <span class="s">&quot;lis3lv02dl_irq2&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">gpio_free</span><span class="p">(</span><span class="n">irq1</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;lis3lv02dl: gpio request failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">irq1</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">irq2</span><span class="p">);</span>

<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lis302_release</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_free</span><span class="p">(</span><span class="n">LIS302_IRQ1_GPIO</span><span class="p">);</span>
	<span class="n">gpio_free</span><span class="p">(</span><span class="n">LIS302_IRQ2_GPIO</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lis3lv02d_platform_data</span> <span class="n">rx51_lis3lv02d_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">click_flags</span>    <span class="o">=</span> <span class="n">LIS3_CLICK_SINGLE_X</span> <span class="o">|</span> <span class="n">LIS3_CLICK_SINGLE_Y</span> <span class="o">|</span>
			  <span class="n">LIS3_CLICK_SINGLE_Z</span><span class="p">,</span>
	<span class="cm">/* Limits are 0.5g * value */</span>
	<span class="p">.</span><span class="n">click_thresh_x</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">click_thresh_y</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">click_thresh_z</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
	<span class="cm">/* Click must be longer than time limit */</span>
	<span class="p">.</span><span class="n">click_time_limit</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
	<span class="cm">/* Kind of debounce filter */</span>
	<span class="p">.</span><span class="n">click_latency</span>    <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>

	<span class="cm">/* Limits for all axis. millig-value / 18 to get HW values */</span>
	<span class="p">.</span><span class="n">wakeup_flags</span> <span class="o">=</span> <span class="n">LIS3_WAKEUP_X_HI</span> <span class="o">|</span> <span class="n">LIS3_WAKEUP_Y_HI</span><span class="p">,</span>
	<span class="p">.</span><span class="n">wakeup_thresh</span> <span class="o">=</span> <span class="mi">800</span> <span class="o">/</span> <span class="mi">18</span><span class="p">,</span>
	<span class="p">.</span><span class="n">wakeup_flags2</span> <span class="o">=</span> <span class="n">LIS3_WAKEUP_Z_HI</span> <span class="p">,</span>
	<span class="p">.</span><span class="n">wakeup_thresh2</span> <span class="o">=</span> <span class="mi">900</span> <span class="o">/</span> <span class="mi">18</span><span class="p">,</span>

	<span class="p">.</span><span class="n">hipass_ctrl</span> <span class="o">=</span> <span class="n">LIS3_HIPASS1_DISABLE</span> <span class="o">|</span> <span class="n">LIS3_HIPASS2_DISABLE</span><span class="p">,</span>

	<span class="cm">/* Interrupt line 2 for click detection, line 1 for thresholds */</span>
	<span class="p">.</span><span class="n">irq_cfg</span> <span class="o">=</span> <span class="n">LIS3_IRQ2_CLICK</span> <span class="o">|</span> <span class="n">LIS3_IRQ1_FF_WU_12</span><span class="p">,</span>

	<span class="p">.</span><span class="n">axis_x</span> <span class="o">=</span> <span class="n">LIS3_DEV_X</span><span class="p">,</span>
	<span class="p">.</span><span class="n">axis_y</span> <span class="o">=</span> <span class="n">LIS3_INV_DEV_Y</span><span class="p">,</span>
	<span class="p">.</span><span class="n">axis_z</span> <span class="o">=</span> <span class="n">LIS3_INV_DEV_Z</span><span class="p">,</span>
	<span class="p">.</span><span class="n">setup_resources</span> <span class="o">=</span> <span class="n">lis302_setup</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release_resources</span> <span class="o">=</span> <span class="n">lis302_release</span><span class="p">,</span>
	<span class="p">.</span><span class="n">st_min_limits</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">.</span><span class="n">st_max_limits</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">},</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_SENSORS_TSL2563) || defined(CONFIG_SENSORS_TSL2563_MODULE)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">tsl2563_platform_data</span> <span class="n">rx51_tsl2563_platform_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">cover_comp_gain</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_LEDS_LP5523) || defined(CONFIG_LEDS_LP5523_MODULE)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">lp5523_led_config</span> <span class="n">rx51_lp5523_led_config</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">chan_nr</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">led_current</span>	<span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan_nr</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">led_current</span>	<span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan_nr</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">led_current</span>	<span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan_nr</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">led_current</span>	<span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan_nr</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">led_current</span>	<span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan_nr</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">led_current</span>	<span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan_nr</span>	<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
		<span class="p">.</span><span class="n">led_current</span>	<span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan_nr</span>	<span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
		<span class="p">.</span><span class="n">led_current</span>	<span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan_nr</span>	<span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">led_current</span>	<span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rx51_lp5523_setup</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">gpio_request_one</span><span class="p">(</span><span class="n">RX51_LP5523_CHIP_EN_GPIO</span><span class="p">,</span> <span class="n">GPIOF_DIR_OUT</span><span class="p">,</span>
			<span class="s">&quot;lp5523_enable&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rx51_lp5523_release</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_free</span><span class="p">(</span><span class="n">RX51_LP5523_CHIP_EN_GPIO</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rx51_lp5523_enable</span><span class="p">(</span><span class="n">bool</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">RX51_LP5523_CHIP_EN_GPIO</span><span class="p">,</span> <span class="o">!!</span><span class="n">state</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lp5523_platform_data</span> <span class="n">rx51_lp5523_platform_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">led_config</span>		<span class="o">=</span> <span class="n">rx51_lp5523_led_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_channels</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_lp5523_led_config</span><span class="p">),</span>
	<span class="p">.</span><span class="n">clock_mode</span>		<span class="o">=</span> <span class="n">LP5523_CLOCK_AUTO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">setup_resources</span>	<span class="o">=</span> <span class="n">rx51_lp5523_setup</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release_resources</span>	<span class="o">=</span> <span class="n">rx51_lp5523_release</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="n">rx51_lp5523_enable</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">omap2_mcspi_device_config</span> <span class="n">wl1251_mcspi_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">turbo_mode</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">omap2_mcspi_device_config</span> <span class="n">mipid_mcspi_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">turbo_mode</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">omap2_mcspi_device_config</span> <span class="n">tsc2005_mcspi_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">turbo_mode</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">spi_board_info</span> <span class="n">rx51_peripherals_spi_board_info</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">RX51_SPI_WL1251</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span>		<span class="o">=</span> <span class="s">&quot;wl1251&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bus_num</span>		<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_select</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_speed_hz</span>   	<span class="o">=</span> <span class="mi">48000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mode</span>                   <span class="o">=</span> <span class="n">SPI_MODE_3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">controller_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">wl1251_mcspi_config</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">wl1251_pdata</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">RX51_SPI_MIPID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span>		<span class="o">=</span> <span class="s">&quot;acx565akm&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bus_num</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_select</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_speed_hz</span>		<span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">controller_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">mipid_mcspi_config</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">RX51_SPI_TSC2005</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span>		<span class="o">=</span> <span class="s">&quot;tsc2005&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bus_num</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_select</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_speed_hz</span>		<span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">controller_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">tsc2005_mcspi_config</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tsc2005_pdata</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rx51_charger_set_power</span><span class="p">(</span><span class="n">bool</span> <span class="n">on</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">RX51_USB_TRANSCEIVER_RST_GPIO</span><span class="p">,</span> <span class="n">on</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">isp1704_charger_data</span> <span class="n">rx51_charger_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">set_power</span>	<span class="o">=</span> <span class="n">rx51_charger_set_power</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">rx51_charger_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;isp1704_charger&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_charger_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">rx51_charger_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">WARN_ON</span><span class="p">(</span><span class="n">gpio_request_one</span><span class="p">(</span><span class="n">RX51_USB_TRANSCEIVER_RST_GPIO</span><span class="p">,</span>
		<span class="n">GPIOF_OUT_INIT_HIGH</span><span class="p">,</span> <span class="s">&quot;isp1704_reset&quot;</span><span class="p">));</span>

	<span class="n">platform_device_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rx51_charger_device</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_KEYBOARD_GPIO) || defined(CONFIG_KEYBOARD_GPIO_MODULE)</span>

<span class="cp">#define RX51_GPIO_CAMERA_LENS_COVER	110</span>
<span class="cp">#define RX51_GPIO_CAMERA_FOCUS		68</span>
<span class="cp">#define RX51_GPIO_CAMERA_CAPTURE	69</span>
<span class="cp">#define RX51_GPIO_KEYPAD_SLIDE		71</span>
<span class="cp">#define RX51_GPIO_LOCK_BUTTON		113</span>
<span class="cp">#define RX51_GPIO_PROXIMITY		89</span>

<span class="cp">#define RX51_GPIO_DEBOUNCE_TIMEOUT	10</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_keys_button</span> <span class="n">rx51_gpio_keys</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">desc</span>			<span class="o">=</span> <span class="s">&quot;Camera Lens Cover&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>			<span class="o">=</span> <span class="n">EV_SW</span><span class="p">,</span>
		<span class="p">.</span><span class="n">code</span>			<span class="o">=</span> <span class="n">SW_CAMERA_LENS_COVER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>			<span class="o">=</span> <span class="n">RX51_GPIO_CAMERA_LENS_COVER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">debounce_interval</span>	<span class="o">=</span> <span class="n">RX51_GPIO_DEBOUNCE_TIMEOUT</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">desc</span>			<span class="o">=</span> <span class="s">&quot;Camera Focus&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>			<span class="o">=</span> <span class="n">EV_KEY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">code</span>			<span class="o">=</span> <span class="n">KEY_CAMERA_FOCUS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>			<span class="o">=</span> <span class="n">RX51_GPIO_CAMERA_FOCUS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">debounce_interval</span>	<span class="o">=</span> <span class="n">RX51_GPIO_DEBOUNCE_TIMEOUT</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">desc</span>			<span class="o">=</span> <span class="s">&quot;Camera Capture&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>			<span class="o">=</span> <span class="n">EV_KEY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">code</span>			<span class="o">=</span> <span class="n">KEY_CAMERA</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>			<span class="o">=</span> <span class="n">RX51_GPIO_CAMERA_CAPTURE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">debounce_interval</span>	<span class="o">=</span> <span class="n">RX51_GPIO_DEBOUNCE_TIMEOUT</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">desc</span>			<span class="o">=</span> <span class="s">&quot;Lock Button&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>			<span class="o">=</span> <span class="n">EV_KEY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">code</span>			<span class="o">=</span> <span class="n">KEY_SCREENLOCK</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>			<span class="o">=</span> <span class="n">RX51_GPIO_LOCK_BUTTON</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">debounce_interval</span>	<span class="o">=</span> <span class="n">RX51_GPIO_DEBOUNCE_TIMEOUT</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">desc</span>			<span class="o">=</span> <span class="s">&quot;Keypad Slide&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>			<span class="o">=</span> <span class="n">EV_SW</span><span class="p">,</span>
		<span class="p">.</span><span class="n">code</span>			<span class="o">=</span> <span class="n">SW_KEYPAD_SLIDE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>			<span class="o">=</span> <span class="n">RX51_GPIO_KEYPAD_SLIDE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">debounce_interval</span>	<span class="o">=</span> <span class="n">RX51_GPIO_DEBOUNCE_TIMEOUT</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">desc</span>			<span class="o">=</span> <span class="s">&quot;Proximity Sensor&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>			<span class="o">=</span> <span class="n">EV_SW</span><span class="p">,</span>
		<span class="p">.</span><span class="n">code</span>			<span class="o">=</span> <span class="n">SW_FRONT_PROXIMITY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>			<span class="o">=</span> <span class="n">RX51_GPIO_PROXIMITY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">debounce_interval</span>	<span class="o">=</span> <span class="n">RX51_GPIO_DEBOUNCE_TIMEOUT</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_keys_platform_data</span> <span class="n">rx51_gpio_keys_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">buttons</span>	<span class="o">=</span> <span class="n">rx51_gpio_keys</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nbuttons</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_gpio_keys</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">rx51_gpio_keys_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;gpio-keys&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_gpio_keys_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">rx51_add_gpio_keys</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">platform_device_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rx51_gpio_keys_device</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">rx51_add_gpio_keys</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_KEYBOARD_GPIO || CONFIG_KEYBOARD_GPIO_MODULE */</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">uint32_t</span> <span class="n">board_keymap</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * Note that KEY(x, 8, KEY_XXX) entries represent &quot;entrire row</span>
<span class="cm">	 * connected to the ground&quot; matrix state.</span>
<span class="cm">	 */</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">KEY_Q</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">KEY_O</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">KEY_P</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">KEY_COMMA</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">KEY_BACKSPACE</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">KEY_A</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">KEY_S</span><span class="p">),</span>

	<span class="n">KEY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">KEY_W</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">KEY_D</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">KEY_F</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">KEY_G</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">KEY_H</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">KEY_J</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">KEY_K</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">KEY_L</span><span class="p">),</span>

	<span class="n">KEY</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">KEY_E</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">KEY_DOT</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">KEY_UP</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">KEY_ENTER</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">KEY_Z</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">KEY_X</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">KEY_C</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">KEY_F9</span><span class="p">),</span>

	<span class="n">KEY</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">KEY_R</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">KEY_V</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">KEY_B</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">KEY_N</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">KEY_M</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">KEY_SPACE</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">KEY_SPACE</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">KEY_LEFT</span><span class="p">),</span>

	<span class="n">KEY</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">KEY_T</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">KEY_DOWN</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">KEY_RIGHT</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">KEY_LEFTCTRL</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">KEY_RIGHTALT</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">KEY_LEFTSHIFT</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">KEY_F10</span><span class="p">),</span>

	<span class="n">KEY</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">KEY_Y</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">KEY_F11</span><span class="p">),</span>

	<span class="n">KEY</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">KEY_U</span><span class="p">),</span>

	<span class="n">KEY</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">KEY_I</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">KEY_F7</span><span class="p">),</span>
	<span class="n">KEY</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">KEY_F8</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">matrix_keymap_data</span> <span class="n">board_map_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">keymap</span>			<span class="o">=</span> <span class="n">board_keymap</span><span class="p">,</span>
	<span class="p">.</span><span class="n">keymap_size</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">board_keymap</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_keypad_data</span> <span class="n">rx51_kp_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">keymap_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">board_map_data</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rows</span>		<span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cols</span>		<span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rep</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Enable input logic and pull all lines up when eMMC is on. */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">omap_board_mux</span> <span class="n">rx51_mmc2_on_mux</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_CMD</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLUP</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT0</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLUP</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT1</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLUP</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT2</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLUP</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT3</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLUP</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT4</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLUP</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT5</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLUP</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT6</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLUP</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT7</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLUP</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">reg_offset</span> <span class="o">=</span> <span class="n">OMAP_MUX_TERMINATOR</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Disable input logic and pull all lines down when eMMC is off. */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">omap_board_mux</span> <span class="n">rx51_mmc2_off_mux</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_CMD</span><span class="p">,</span> <span class="n">OMAP_PULL_ENA</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT0</span><span class="p">,</span> <span class="n">OMAP_PULL_ENA</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT1</span><span class="p">,</span> <span class="n">OMAP_PULL_ENA</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT2</span><span class="p">,</span> <span class="n">OMAP_PULL_ENA</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT3</span><span class="p">,</span> <span class="n">OMAP_PULL_ENA</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT4</span><span class="p">,</span> <span class="n">OMAP_PULL_ENA</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT5</span><span class="p">,</span> <span class="n">OMAP_PULL_ENA</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT6</span><span class="p">,</span> <span class="n">OMAP_PULL_ENA</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="n">OMAP3_MUX</span><span class="p">(</span><span class="n">SDMMC2_DAT7</span><span class="p">,</span> <span class="n">OMAP_PULL_ENA</span> <span class="o">|</span> <span class="n">OMAP_MUX_MODE0</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">reg_offset</span> <span class="o">=</span> <span class="n">OMAP_MUX_TERMINATOR</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">omap_mux_partition</span> <span class="o">*</span><span class="n">partition</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Current flows to eMMC when eMMC is off and the data lines are pulled up,</span>
<span class="cm"> * so pull them down. N.B. we pull 8 lines because we are using 8 lines.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">rx51_mmc2_remux</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slot</span><span class="p">,</span> <span class="kt">int</span> <span class="n">power_on</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">power_on</span><span class="p">)</span>
		<span class="n">omap_mux_write_array</span><span class="p">(</span><span class="n">partition</span><span class="p">,</span> <span class="n">rx51_mmc2_on_mux</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">omap_mux_write_array</span><span class="p">(</span><span class="n">partition</span><span class="p">,</span> <span class="n">rx51_mmc2_off_mux</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">omap2_hsmmc_info</span> <span class="n">mmc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;external&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mmc</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span>		<span class="o">=</span> <span class="n">MMC_CAP_4_BIT_DATA</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cover_only</span>	<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_cd</span>	<span class="o">=</span> <span class="mi">160</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_wp</span>	<span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">power_saving</span>	<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;internal&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mmc</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span>		<span class="o">=</span> <span class="n">MMC_CAP_4_BIT_DATA</span> <span class="o">|</span> <span class="n">MMC_CAP_8_BIT_DATA</span><span class="p">,</span>
						<span class="cm">/* See also rx51_mmc2_remux */</span>
		<span class="p">.</span><span class="n">gpio_cd</span>	<span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_wp</span>	<span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">nonremovable</span>	<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">power_saving</span>	<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">remux</span>		<span class="o">=</span> <span class="n">rx51_mmc2_remux</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{}</span>	<span class="cm">/* Terminator */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">rx51_vmmc1_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vmmc&quot;</span><span class="p">,</span> <span class="s">&quot;omap_hsmmc.0&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">rx51_vaux2_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vdds_csib&quot;</span><span class="p">,</span> <span class="s">&quot;omap3isp&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">rx51_vaux3_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vmmc&quot;</span><span class="p">,</span> <span class="s">&quot;omap_hsmmc.1&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">rx51_vsim_supply</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vmmc_aux&quot;</span><span class="p">,</span> <span class="s">&quot;omap_hsmmc.1&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">rx51_vmmc2_supplies</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* tlv320aic3x analog supplies */</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;AVDD&quot;</span><span class="p">,</span> <span class="s">&quot;2-0018&quot;</span><span class="p">),</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;DRVDD&quot;</span><span class="p">,</span> <span class="s">&quot;2-0018&quot;</span><span class="p">),</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;AVDD&quot;</span><span class="p">,</span> <span class="s">&quot;2-0019&quot;</span><span class="p">),</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;DRVDD&quot;</span><span class="p">,</span> <span class="s">&quot;2-0019&quot;</span><span class="p">),</span>
	<span class="cm">/* tpa6130a2 */</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;Vdd&quot;</span><span class="p">,</span> <span class="s">&quot;2-0060&quot;</span><span class="p">),</span>
	<span class="cm">/* Keep vmmc as last item. It is not iterated for newer boards */</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vmmc&quot;</span><span class="p">,</span> <span class="s">&quot;omap_hsmmc.1&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">rx51_vio_supplies</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* tlv320aic3x digital supplies */</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;IOVDD&quot;</span><span class="p">,</span> <span class="s">&quot;2-0018&quot;</span><span class="p">),</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;DVDD&quot;</span><span class="p">,</span> <span class="s">&quot;2-0018&quot;</span><span class="p">),</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;IOVDD&quot;</span><span class="p">,</span> <span class="s">&quot;2-0019&quot;</span><span class="p">),</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;DVDD&quot;</span><span class="p">,</span> <span class="s">&quot;2-0019&quot;</span><span class="p">),</span>
	<span class="cm">/* Si4713 IO supply */</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vio&quot;</span><span class="p">,</span> <span class="s">&quot;2-0063&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">rx51_vaux1_consumers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vdds_sdi&quot;</span><span class="p">,</span> <span class="s">&quot;omapdss&quot;</span><span class="p">),</span>
	<span class="cm">/* Si4713 supply */</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vdd&quot;</span><span class="p">,</span> <span class="s">&quot;2-0063&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vaux1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;V28&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">always_on</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span> <span class="cm">/* due battery cover sensor */</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_vaux1_consumers</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>	<span class="o">=</span> <span class="n">rx51_vaux1_consumers</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vaux2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;VCSI&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_vaux2_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>	<span class="o">=</span> <span class="n">rx51_vaux2_supply</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* VAUX3 - adds more power to VIO_18 rail */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vaux3_cam</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;VCAM_DIG_18&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vaux3_mmc</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;VMMC2_30&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">3000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_vaux3_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>	<span class="o">=</span> <span class="n">rx51_vaux3_supply</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vaux4</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;VCAM_ANA_28&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vmmc1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1850000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">3150000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_vmmc1_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>	<span class="o">=</span> <span class="n">rx51_vmmc1_supply</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vmmc2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;V28_A&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">3000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">always_on</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span> <span class="cm">/* due VIO leak to AIC34 VDDs */</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_vmmc2_supplies</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>	<span class="o">=</span> <span class="n">rx51_vmmc2_supplies</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vpll1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;VPLL&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">always_on</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vpll2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;VSDI_CSI&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">always_on</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vsim</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;VMMC2_IO_18&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_vsim_supply</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>	<span class="o">=</span> <span class="n">rx51_vsim_supply</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vio</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_VOLTAGE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_MODE</span>
					<span class="o">|</span> <span class="n">REGULATOR_CHANGE_STATUS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_consumer_supplies</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_vio_supplies</span><span class="p">),</span>
	<span class="p">.</span><span class="n">consumer_supplies</span>	<span class="o">=</span> <span class="n">rx51_vio_supplies</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vintana1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;VINTANA1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">always_on</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vintana2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;VINTANA2&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">2750000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">2750000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">apply_uV</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">always_on</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">rx51_vintdig</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;VINTDIG&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_uV</span>			<span class="o">=</span> <span class="mi">1500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_uV</span>			<span class="o">=</span> <span class="mi">1500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">always_on</span>		<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_modes_mask</span>	<span class="o">=</span> <span class="n">REGULATOR_MODE_NORMAL</span>
					<span class="o">|</span> <span class="n">REGULATOR_MODE_STANDBY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">valid_ops_mask</span>		<span class="o">=</span> <span class="n">REGULATOR_CHANGE_MODE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">si4713_platform_data</span> <span class="n">rx51_si4713_i2c_data</span> <span class="n">__initdata_or_module</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">gpio_reset</span>	<span class="o">=</span> <span class="n">RX51_FMTX_RESET_GPIO</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">rx51_si4713_board_info</span> <span class="n">__initdata_or_module</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;si4713&quot;</span><span class="p">,</span> <span class="n">SI4713_I2C_ADDR_BUSEN_HIGH</span><span class="p">),</span>
	<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_si4713_i2c_data</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">radio_si4713_platform_data</span> <span class="n">rx51_si4713_data</span> <span class="n">__initdata_or_module</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_bus</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">subdev_board_info</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_si4713_board_info</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">rx51_si4713_dev</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;radio-si4713&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_si4713_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">__init</span> <span class="kt">void</span> <span class="nf">rx51_init_si4713</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">gpio_request_one</span><span class="p">(</span><span class="n">RX51_FMTX_IRQ</span><span class="p">,</span> <span class="n">GPIOF_DIR_IN</span><span class="p">,</span> <span class="s">&quot;si4713 irq&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;Cannot request si4713 irq gpio. %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">rx51_si4713_board_info</span><span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">gpio_to_irq</span><span class="p">(</span><span class="n">RX51_FMTX_IRQ</span><span class="p">);</span>
	<span class="n">platform_device_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rx51_si4713_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rx51_twlgpio_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">gpio</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* FIXME this gpio setup is just a placeholder for now */</span>
	<span class="n">gpio_request_one</span><span class="p">(</span><span class="n">gpio</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span> <span class="n">GPIOF_OUT_INIT_LOW</span><span class="p">,</span> <span class="s">&quot;backlight_pwm&quot;</span><span class="p">);</span>
	<span class="n">gpio_request_one</span><span class="p">(</span><span class="n">gpio</span> <span class="o">+</span> <span class="mi">7</span><span class="p">,</span> <span class="n">GPIOF_OUT_INIT_LOW</span><span class="p">,</span> <span class="s">&quot;speaker_en&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_gpio_platform_data</span> <span class="n">rx51_gpio_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">gpio_base</span>		<span class="o">=</span> <span class="n">OMAP_MAX_GPIO_LINES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_base</span>		<span class="o">=</span> <span class="n">TWL4030_GPIO_IRQ_BASE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_end</span>		<span class="o">=</span> <span class="n">TWL4030_GPIO_IRQ_END</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pulldowns</span>		<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
				<span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
				<span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
				<span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
				<span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="p">,</span>
	<span class="p">.</span><span class="n">setup</span>			<span class="o">=</span> <span class="n">rx51_twlgpio_setup</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_ins</span> <span class="n">sleep_on_seq</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/*</span>
<span class="cm"> * Turn off everything</span>
<span class="cm"> */</span>
	<span class="p">{</span><span class="n">MSG_BROADCAST</span><span class="p">(</span><span class="n">DEV_GRP_NULL</span><span class="p">,</span> <span class="n">RES_GRP_ALL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">RES_STATE_SLEEP</span><span class="p">),</span> <span class="mi">2</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_script</span> <span class="n">sleep_on_script</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">sleep_on_seq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">size</span>   <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sleep_on_seq</span><span class="p">),</span>
	<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">TWL4030_SLEEP_SCRIPT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_ins</span> <span class="n">wakeup_seq</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/*</span>
<span class="cm"> * Reenable everything</span>
<span class="cm"> */</span>
	<span class="p">{</span><span class="n">MSG_BROADCAST</span><span class="p">(</span><span class="n">DEV_GRP_NULL</span><span class="p">,</span> <span class="n">RES_GRP_ALL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">RES_STATE_ACTIVE</span><span class="p">),</span> <span class="mi">2</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_script</span> <span class="n">wakeup_script</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">script</span>	<span class="o">=</span> <span class="n">wakeup_seq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wakeup_seq</span><span class="p">),</span>
	<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">TWL4030_WAKEUP12_SCRIPT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_ins</span> <span class="n">wakeup_p3_seq</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/*</span>
<span class="cm"> * Reenable everything</span>
<span class="cm"> */</span>
	<span class="p">{</span><span class="n">MSG_BROADCAST</span><span class="p">(</span><span class="n">DEV_GRP_NULL</span><span class="p">,</span> <span class="n">RES_GRP_ALL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">RES_STATE_ACTIVE</span><span class="p">),</span> <span class="mi">2</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_script</span> <span class="n">wakeup_p3_script</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">script</span>	<span class="o">=</span> <span class="n">wakeup_p3_seq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wakeup_p3_seq</span><span class="p">),</span>
	<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">TWL4030_WAKEUP3_SCRIPT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_ins</span> <span class="n">wrst_seq</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/*</span>
<span class="cm"> * Reset twl4030.</span>
<span class="cm"> * Reset VDD1 regulator.</span>
<span class="cm"> * Reset VDD2 regulator.</span>
<span class="cm"> * Reset VPLL1 regulator.</span>
<span class="cm"> * Enable sysclk output.</span>
<span class="cm"> * Reenable twl4030.</span>
<span class="cm"> */</span>
	<span class="p">{</span><span class="n">MSG_SINGULAR</span><span class="p">(</span><span class="n">DEV_GRP_NULL</span><span class="p">,</span> <span class="n">RES_RESET</span><span class="p">,</span> <span class="n">RES_STATE_OFF</span><span class="p">),</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MSG_BROADCAST</span><span class="p">(</span><span class="n">DEV_GRP_NULL</span><span class="p">,</span> <span class="n">RES_GRP_ALL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">RES_STATE_ACTIVE</span><span class="p">),</span>
		<span class="mh">0x13</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MSG_BROADCAST</span><span class="p">(</span><span class="n">DEV_GRP_NULL</span><span class="p">,</span> <span class="n">RES_GRP_PP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">RES_STATE_OFF</span><span class="p">),</span> <span class="mh">0x13</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MSG_SINGULAR</span><span class="p">(</span><span class="n">DEV_GRP_NULL</span><span class="p">,</span> <span class="n">RES_VDD1</span><span class="p">,</span> <span class="n">RES_STATE_WRST</span><span class="p">),</span> <span class="mh">0x13</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MSG_SINGULAR</span><span class="p">(</span><span class="n">DEV_GRP_NULL</span><span class="p">,</span> <span class="n">RES_VDD2</span><span class="p">,</span> <span class="n">RES_STATE_WRST</span><span class="p">),</span> <span class="mh">0x13</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MSG_SINGULAR</span><span class="p">(</span><span class="n">DEV_GRP_NULL</span><span class="p">,</span> <span class="n">RES_VPLL1</span><span class="p">,</span> <span class="n">RES_STATE_WRST</span><span class="p">),</span> <span class="mh">0x35</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MSG_SINGULAR</span><span class="p">(</span><span class="n">DEV_GRP_P3</span><span class="p">,</span> <span class="n">RES_HFCLKOUT</span><span class="p">,</span> <span class="n">RES_STATE_ACTIVE</span><span class="p">),</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MSG_SINGULAR</span><span class="p">(</span><span class="n">DEV_GRP_NULL</span><span class="p">,</span> <span class="n">RES_RESET</span><span class="p">,</span> <span class="n">RES_STATE_ACTIVE</span><span class="p">),</span> <span class="mi">2</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_script</span> <span class="n">wrst_script</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">wrst_seq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">size</span>   <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wrst_seq</span><span class="p">),</span>
	<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">TWL4030_WRST_SCRIPT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_script</span> <span class="o">*</span><span class="n">twl4030_scripts</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* wakeup12 script should be loaded before sleep script, otherwise a</span>
<span class="cm">	   board might hit retention before loading of wakeup script is</span>
<span class="cm">	   completed. This can cause boot failures depending on timing issues.</span>
<span class="cm">	*/</span>
	<span class="o">&amp;</span><span class="n">wakeup_script</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sleep_on_script</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">wakeup_p3_script</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">wrst_script</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_resconfig</span> <span class="n">twl4030_rconfig</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VDD1</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="n">RES_STATE_OFF</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="n">RES_STATE_OFF</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VDD2</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="n">RES_STATE_OFF</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="n">RES_STATE_OFF</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VPLL1</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="n">RES_STATE_OFF</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="n">RES_STATE_OFF</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VPLL2</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VAUX1</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VAUX2</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VAUX3</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VAUX4</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VMMC1</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VMMC2</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VDAC</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VSIM</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VINTANA1</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="n">DEV_GRP_P1</span> <span class="o">|</span> <span class="n">DEV_GRP_P3</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VINTANA2</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="n">DEV_GRP_P1</span> <span class="o">|</span> <span class="n">DEV_GRP_P3</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VINTDIG</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="n">DEV_GRP_P1</span> <span class="o">|</span> <span class="n">DEV_GRP_P3</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_VIO</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="n">DEV_GRP_P3</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_CLKEN</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="n">DEV_GRP_P1</span> <span class="o">|</span> <span class="n">DEV_GRP_P3</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_REGEN</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="n">DEV_GRP_P1</span> <span class="o">|</span> <span class="n">DEV_GRP_P3</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_NRES_PWRON</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="n">DEV_GRP_P1</span> <span class="o">|</span> <span class="n">DEV_GRP_P3</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_SYSEN</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="n">DEV_GRP_P1</span> <span class="o">|</span> <span class="n">DEV_GRP_P3</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_HFCLKOUT</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="n">DEV_GRP_P3</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_32KCLKOUT</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_RESET</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">RES_MAIN_REF</span><span class="p">,</span> <span class="p">.</span><span class="n">devgroup</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">type2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_off</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">remap_sleep</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_power_data</span> <span class="n">rx51_t2scripts_data</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">scripts</span>        <span class="o">=</span> <span class="n">twl4030_scripts</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">twl4030_scripts</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource_config</span> <span class="o">=</span> <span class="n">twl4030_rconfig</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_vibra_data</span> <span class="n">rx51_vibra_data</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">coexist</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_audio_data</span> <span class="n">rx51_audio_data</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">audio_mclk</span>	<span class="o">=</span> <span class="mi">26000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vibra</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vibra_data</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">twl4030_platform_data</span> <span class="n">rx51_twldata</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* platform_data for children goes here */</span>
	<span class="p">.</span><span class="n">gpio</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_gpio_data</span><span class="p">,</span>
	<span class="p">.</span><span class="n">keypad</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_kp_data</span><span class="p">,</span>
	<span class="p">.</span><span class="n">power</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_t2scripts_data</span><span class="p">,</span>
	<span class="p">.</span><span class="n">audio</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_audio_data</span><span class="p">,</span>

	<span class="p">.</span><span class="n">vaux1</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vaux1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vaux2</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vaux2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vaux4</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vaux4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vmmc1</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vmmc1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vpll1</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vpll1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vpll2</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vpll2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vsim</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vsim</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vintana1</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vintana1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vintana2</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vintana2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vintdig</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vintdig</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vio</span>			<span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vio</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tpa6130a2_platform_data</span> <span class="n">rx51_tpa6130a2_data</span> <span class="n">__initdata_or_module</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">power_gpio</span>		<span class="o">=</span> <span class="mi">98</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Audio setup data */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">aic3x_setup_data</span> <span class="n">rx51_aic34_setup</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">gpio_func</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">AIC3X_GPIO1_FUNC_DISABLED</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_func</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">AIC3X_GPIO2_FUNC_DIGITAL_MIC_INPUT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">aic3x_pdata</span> <span class="n">rx51_aic3x_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">setup</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_aic34_setup</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_reset</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">aic3x_pdata</span> <span class="n">rx51_aic3x_data2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">gpio_reset</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">rx51_peripherals_i2c_board_info_2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;tlv320aic3x&quot;</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">),</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_aic3x_data</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;tlv320aic3x&quot;</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">),</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_aic3x_data2</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#if defined(CONFIG_SENSORS_TSL2563) || defined(CONFIG_SENSORS_TSL2563_MODULE)</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;tsl2563&quot;</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">),</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_tsl2563_platform_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(CONFIG_LEDS_LP5523) || defined(CONFIG_LEDS_LP5523_MODULE)</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;lp5523&quot;</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">),</span>
		<span class="p">.</span><span class="n">platform_data</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_lp5523_platform_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;bq27200&quot;</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">),</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;tpa6130a2&quot;</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">),</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_tpa6130a2_data</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">rx51_peripherals_i2c_board_info_3</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cp">#if defined(CONFIG_SENSORS_LIS3_I2C) || defined(CONFIG_SENSORS_LIS3_I2C_MODULE)</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;lis3lv02d&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">),</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_lis3lv02d_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">rx51_i2c_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">system_rev</span> <span class="o">&gt;=</span> <span class="n">SYSTEM_REV_S_USES_VAUX3</span> <span class="o">&amp;&amp;</span> <span class="n">system_rev</span> <span class="o">&lt;</span> <span class="mh">0x100</span><span class="p">)</span> <span class="o">||</span>
	    <span class="n">system_rev</span> <span class="o">&gt;=</span> <span class="n">SYSTEM_REV_B_USES_VAUX3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rx51_twldata</span><span class="p">.</span><span class="n">vaux3</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vaux3_mmc</span><span class="p">;</span>
		<span class="cm">/* Only older boards use VMMC2 for internal MMC */</span>
		<span class="n">rx51_vmmc2</span><span class="p">.</span><span class="n">num_consumer_supplies</span><span class="o">--</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">rx51_twldata</span><span class="p">.</span><span class="n">vaux3</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vaux3_cam</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">rx51_twldata</span><span class="p">.</span><span class="n">vmmc2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rx51_vmmc2</span><span class="p">;</span>
	<span class="n">omap3_pmic_get_config</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rx51_twldata</span><span class="p">,</span>
			<span class="n">TWL_COMMON_PDATA_USB</span> <span class="o">|</span> <span class="n">TWL_COMMON_PDATA_MADC</span><span class="p">,</span>
			<span class="n">TWL_COMMON_REGULATOR_VDAC</span><span class="p">);</span>

	<span class="n">rx51_twldata</span><span class="p">.</span><span class="n">vdac</span><span class="o">-&gt;</span><span class="n">constraints</span><span class="p">.</span><span class="n">apply_uV</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">rx51_twldata</span><span class="p">.</span><span class="n">vdac</span><span class="o">-&gt;</span><span class="n">constraints</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;VDAC&quot;</span><span class="p">;</span>

	<span class="n">omap_pmic_init</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2200</span><span class="p">,</span> <span class="s">&quot;twl5030&quot;</span><span class="p">,</span> <span class="n">INT_34XX_SYS_NIRQ</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rx51_twldata</span><span class="p">);</span>
	<span class="n">omap_register_i2c_bus</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">rx51_peripherals_i2c_board_info_2</span><span class="p">,</span>
			      <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_peripherals_i2c_board_info_2</span><span class="p">));</span>
<span class="cp">#if defined(CONFIG_SENSORS_LIS3_I2C) || defined(CONFIG_SENSORS_LIS3_I2C_MODULE)</span>
	<span class="n">rx51_lis3lv02d_data</span><span class="p">.</span><span class="n">irq2</span> <span class="o">=</span> <span class="n">gpio_to_irq</span><span class="p">(</span><span class="n">LIS302_IRQ2_GPIO</span><span class="p">);</span>
	<span class="n">rx51_peripherals_i2c_board_info_3</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">irq</span> <span class="o">=</span> <span class="n">gpio_to_irq</span><span class="p">(</span><span class="n">LIS302_IRQ1_GPIO</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="n">omap_register_i2c_bus</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">rx51_peripherals_i2c_board_info_3</span><span class="p">,</span>
			      <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_peripherals_i2c_board_info_3</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_MTD_ONENAND_OMAP2) || \</span>
<span class="cp">	defined(CONFIG_MTD_ONENAND_OMAP2_MODULE)</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mtd_partition</span> <span class="n">onenand_partitions</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;bootloader&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>         <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>           <span class="o">=</span> <span class="mh">0x20000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mask_flags</span>     <span class="o">=</span> <span class="n">MTD_WRITEABLE</span><span class="p">,</span>	<span class="cm">/* Force read-only */</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;config&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>         <span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>           <span class="o">=</span> <span class="mh">0x60000</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;log&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>         <span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>           <span class="o">=</span> <span class="mh">0x40000</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;kernel&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>         <span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>           <span class="o">=</span> <span class="mh">0x200000</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;initfs&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>         <span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>           <span class="o">=</span> <span class="mh">0x200000</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;rootfs&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>         <span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>           <span class="o">=</span> <span class="n">MTDPART_SIZ_FULL</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">omap_onenand_platform_data</span> <span class="n">board_onenand_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">cs</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_irq</span>	<span class="o">=</span> <span class="mi">65</span><span class="p">,</span>
		<span class="p">.</span><span class="n">parts</span>		<span class="o">=</span> <span class="n">onenand_partitions</span><span class="p">,</span>
		<span class="p">.</span><span class="n">nr_parts</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">onenand_partitions</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">ONENAND_SYNC_READWRITE</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_SMC91X) || defined(CONFIG_SMC91X_MODULE)</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">omap_smc91x_platform_data</span> <span class="n">board_smc91x_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">cs</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_irq</span>	<span class="o">=</span> <span class="mi">54</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwrdwn</span>	<span class="o">=</span> <span class="mi">86</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_reset</span>	<span class="o">=</span> <span class="mi">164</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">GPMC_TIMINGS_SMC91C96</span> <span class="o">|</span> <span class="n">IORESOURCE_IRQ_HIGHLEVEL</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">board_smc91x_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">omap_mux_init_gpio</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLDOWN</span><span class="p">);</span>
	<span class="n">omap_mux_init_gpio</span><span class="p">(</span><span class="mi">86</span><span class="p">,</span> <span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>
	<span class="n">omap_mux_init_gpio</span><span class="p">(</span><span class="mi">164</span><span class="p">,</span> <span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>

	<span class="n">gpmc_smc91x_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">board_smc91x_data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#else</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">board_smc91x_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rx51_wl1251_set_power</span><span class="p">(</span><span class="n">bool</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">RX51_WL1251_POWER_GPIO</span><span class="p">,</span> <span class="n">enable</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio</span> <span class="n">rx51_wl1251_gpios</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">RX51_WL1251_POWER_GPIO</span><span class="p">,</span> <span class="n">GPIOF_OUT_INIT_LOW</span><span class="p">,</span>	<span class="s">&quot;wl1251 power&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">RX51_WL1251_IRQ_GPIO</span><span class="p">,</span>	  <span class="n">GPIOF_IN</span><span class="p">,</span>		<span class="s">&quot;wl1251 irq&quot;</span>	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">rx51_init_wl1251</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">gpio_request_array</span><span class="p">(</span><span class="n">rx51_wl1251_gpios</span><span class="p">,</span>
				 <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_wl1251_gpios</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">error</span><span class="p">;</span>

	<span class="n">irq</span> <span class="o">=</span> <span class="n">gpio_to_irq</span><span class="p">(</span><span class="n">RX51_WL1251_IRQ_GPIO</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err_irq</span><span class="p">;</span>

	<span class="n">wl1251_pdata</span><span class="p">.</span><span class="n">set_power</span> <span class="o">=</span> <span class="n">rx51_wl1251_set_power</span><span class="p">;</span>
	<span class="n">rx51_peripherals_spi_board_info</span><span class="p">[</span><span class="n">RX51_SPI_WL1251</span><span class="p">].</span><span class="n">irq</span> <span class="o">=</span> <span class="n">irq</span><span class="p">;</span>

	<span class="k">return</span><span class="p">;</span>

<span class="nl">err_irq:</span>
	<span class="n">gpio_free</span><span class="p">(</span><span class="n">RX51_WL1251_IRQ_GPIO</span><span class="p">);</span>
	<span class="n">gpio_free</span><span class="p">(</span><span class="n">RX51_WL1251_POWER_GPIO</span><span class="p">);</span>
<span class="nl">error:</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;wl1251 board initialisation failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">wl1251_pdata</span><span class="p">.</span><span class="n">set_power</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Now rx51_peripherals_spi_board_info[1].irq is zero and</span>
<span class="cm">	 * set_power is null, and wl1251_probe() will fail.</span>
<span class="cm">	 */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tsc2005_platform_data</span> <span class="n">tsc2005_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ts_pressure_max</span>	<span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_pressure_fudge</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_x_max</span>		<span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_x_fudge</span>		<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_y_max</span>		<span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_y_fudge</span>		<span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_x_plate_ohm</span>		<span class="o">=</span> <span class="mi">280</span><span class="p">,</span>
	<span class="p">.</span><span class="n">esd_timeout_ms</span>		<span class="o">=</span> <span class="mi">8000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio</span> <span class="n">rx51_tsc2005_gpios</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">RX51_TSC2005_IRQ_GPIO</span><span class="p">,</span>   <span class="n">GPIOF_IN</span><span class="p">,</span>		<span class="s">&quot;tsc2005 IRQ&quot;</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">RX51_TSC2005_RESET_GPIO</span><span class="p">,</span> <span class="n">GPIOF_OUT_INIT_HIGH</span><span class="p">,</span>	<span class="s">&quot;tsc2005 reset&quot;</span>	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rx51_tsc2005_set_reset</span><span class="p">(</span><span class="n">bool</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">RX51_TSC2005_RESET_GPIO</span><span class="p">,</span> <span class="n">enable</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">rx51_init_tsc2005</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">r</span><span class="p">;</span>

	<span class="n">omap_mux_init_gpio</span><span class="p">(</span><span class="n">RX51_TSC2005_RESET_GPIO</span><span class="p">,</span> <span class="n">OMAP_PIN_OUTPUT</span><span class="p">);</span>
	<span class="n">omap_mux_init_gpio</span><span class="p">(</span><span class="n">RX51_TSC2005_IRQ_GPIO</span><span class="p">,</span> <span class="n">OMAP_PIN_INPUT_PULLUP</span><span class="p">);</span>

	<span class="n">r</span> <span class="o">=</span> <span class="n">gpio_request_array</span><span class="p">(</span><span class="n">rx51_tsc2005_gpios</span><span class="p">,</span>
			       <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_tsc2005_gpios</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;tsc2005 board initialization failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">tsc2005_pdata</span><span class="p">.</span><span class="n">esd_timeout_ms</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">tsc2005_pdata</span><span class="p">.</span><span class="n">set_reset</span> <span class="o">=</span> <span class="n">rx51_tsc2005_set_reset</span><span class="p">;</span>
	<span class="n">rx51_peripherals_spi_board_info</span><span class="p">[</span><span class="n">RX51_SPI_TSC2005</span><span class="p">].</span><span class="n">irq</span> <span class="o">=</span>
				<span class="n">gpio_to_irq</span><span class="p">(</span><span class="n">RX51_TSC2005_IRQ_GPIO</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">rx51_peripherals_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rx51_i2c_init</span><span class="p">();</span>
	<span class="n">regulator_has_full_constraints</span><span class="p">();</span>
	<span class="n">gpmc_onenand_init</span><span class="p">(</span><span class="n">board_onenand_data</span><span class="p">);</span>
	<span class="n">board_smc91x_init</span><span class="p">();</span>
	<span class="n">rx51_add_gpio_keys</span><span class="p">();</span>
	<span class="n">rx51_init_wl1251</span><span class="p">();</span>
	<span class="n">rx51_init_tsc2005</span><span class="p">();</span>
	<span class="n">rx51_init_si4713</span><span class="p">();</span>
	<span class="n">spi_register_board_info</span><span class="p">(</span><span class="n">rx51_peripherals_spi_board_info</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rx51_peripherals_spi_board_info</span><span class="p">));</span>

	<span class="n">partition</span> <span class="o">=</span> <span class="n">omap_mux_get</span><span class="p">(</span><span class="s">&quot;core&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partition</span><span class="p">)</span>
		<span class="n">omap_hsmmc_init</span><span class="p">(</span><span class="n">mmc</span><span class="p">);</span>

	<span class="n">rx51_charger_init</span><span class="p">();</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
