<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › kernel › kprobes-thumb.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>kprobes-thumb.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * arch/arm/kernel/kprobes-thumb.c</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2011 Jon Medhurst &lt;tixy@yxit.co.uk&gt;.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/kprobes.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>

<span class="cp">#include &quot;kprobes.h&quot;</span>


<span class="cm">/*</span>
<span class="cm"> * True if current instruction is in an IT block.</span>
<span class="cm"> */</span>
<span class="cp">#define in_it_block(cpsr)	((cpsr &amp; 0x06000c00) != 0x00000000)</span>

<span class="cm">/*</span>
<span class="cm"> * Return the condition code to check for the currently executing instruction.</span>
<span class="cm"> * This is in ITSTATE&lt;7:4&gt; which is in CPSR&lt;15:12&gt; but is only valid if</span>
<span class="cm"> * in_it_block returns true.</span>
<span class="cm"> */</span>
<span class="cp">#define current_cond(cpsr)	((cpsr &gt;&gt; 12) &amp; 0xf)</span>

<span class="cm">/*</span>
<span class="cm"> * Return the PC value for a probe in thumb code.</span>
<span class="cm"> * This is the address of the probed instruction plus 4.</span>
<span class="cm"> * We subtract one because the address will have bit zero set to indicate</span>
<span class="cm"> * a pointer to thumb code.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__kprobes</span> <span class="nf">thumb_probe_pc</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">addr</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t32_simulate_table_branch</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="o">=</span> <span class="p">(</span><span class="n">rn</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">?</span> <span class="n">pc</span> <span class="o">:</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">halfwords</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="cm">/* TBH */</span>
		<span class="n">halfwords</span> <span class="o">=</span> <span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span><span class="n">rnv</span><span class="p">)[</span><span class="n">rmv</span><span class="p">];</span>
	<span class="k">else</span> <span class="cm">/* TBB */</span>
		<span class="n">halfwords</span> <span class="o">=</span> <span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">rnv</span><span class="p">)[</span><span class="n">rmv</span><span class="p">];</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">=</span> <span class="n">pc</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">halfwords</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t32_simulate_mrs</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xf8ff03df</span><span class="p">;</span> <span class="cm">/* Mask out execution state */</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t32_simulate_cond_branch</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="kt">long</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x7ff</span><span class="p">;</span>		<span class="cm">/* imm11 */</span>
	<span class="n">offset</span> <span class="o">+=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x003f0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">;</span>	<span class="cm">/* imm6 */</span>
	<span class="n">offset</span> <span class="o">+=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x00002000</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">;</span>	<span class="cm">/* J1 */</span>
	<span class="n">offset</span> <span class="o">+=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x00000800</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">;</span>	<span class="cm">/* J2 */</span>
	<span class="n">offset</span> <span class="o">-=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x04000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">;</span>	<span class="cm">/* Apply sign bit */</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">=</span> <span class="n">pc</span> <span class="o">+</span> <span class="p">(</span><span class="n">offset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">enum</span> <span class="n">kprobe_insn</span> <span class="n">__kprobes</span>
<span class="nf">t32_decode_cond_branch</span><span class="p">(</span><span class="n">kprobe_opcode_t</span> <span class="n">insn</span><span class="p">,</span> <span class="k">struct</span> <span class="n">arch_specific_insn</span> <span class="o">*</span><span class="n">asi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">cc</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">22</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_check_cc</span> <span class="o">=</span> <span class="n">kprobe_condition_checks</span><span class="p">[</span><span class="n">cc</span><span class="p">];</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_handler</span> <span class="o">=</span> <span class="n">t32_simulate_cond_branch</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">INSN_GOOD_NO_SLOT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t32_simulate_branch</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="kt">long</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x7ff</span><span class="p">;</span>		<span class="cm">/* imm11 */</span>
	<span class="n">offset</span> <span class="o">+=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x03ff0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">;</span>	<span class="cm">/* imm10 */</span>
	<span class="n">offset</span> <span class="o">+=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x00002000</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">;</span>	<span class="cm">/* J1 */</span>
	<span class="n">offset</span> <span class="o">+=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x00000800</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">;</span>	<span class="cm">/* J2 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x04000000</span><span class="p">)</span>
		<span class="n">offset</span> <span class="o">-=</span> <span class="mh">0x00800000</span><span class="p">;</span> <span class="cm">/* Apply sign bit */</span>
	<span class="k">else</span>
		<span class="n">offset</span> <span class="o">^=</span> <span class="mh">0x00600000</span><span class="p">;</span> <span class="cm">/* Invert J1 and J2 */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/* BL or BLX */</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_lr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)))</span> <span class="p">{</span>
			<span class="cm">/* BLX so switch to ARM mode */</span>
			<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PSR_T_BIT</span><span class="p">;</span>
			<span class="n">pc</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mi">3</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">=</span> <span class="n">pc</span> <span class="o">+</span> <span class="p">(</span><span class="n">offset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t32_simulate_ldr_literal</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">3</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rtv</span><span class="p">;</span>

	<span class="kt">long</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xfff</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x00800000</span><span class="p">)</span>
		<span class="n">addr</span> <span class="o">+=</span> <span class="n">offset</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">addr</span> <span class="o">-=</span> <span class="n">offset</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x00400000</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* LDR */</span>
		<span class="n">rtv</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rt</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">bx_write_pc</span><span class="p">(</span><span class="n">rtv</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x00200000</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* LDRH */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x01000000</span><span class="p">)</span>
			<span class="n">rtv</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">s16</span> <span class="o">*</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">rtv</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* LDRB */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x01000000</span><span class="p">)</span>
			<span class="n">rtv</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">s8</span> <span class="o">*</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">rtv</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">=</span> <span class="n">rtv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">enum</span> <span class="n">kprobe_insn</span> <span class="n">__kprobes</span>
<span class="nf">t32_decode_ldmstm</span><span class="p">(</span><span class="n">kprobe_opcode_t</span> <span class="n">insn</span><span class="p">,</span> <span class="k">struct</span> <span class="n">arch_specific_insn</span> <span class="o">*</span><span class="n">asi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">enum</span> <span class="n">kprobe_insn</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">kprobe_decode_ldmstm</span><span class="p">(</span><span class="n">insn</span><span class="p">,</span> <span class="n">asi</span><span class="p">);</span>

	<span class="cm">/* Fixup modified instruction to have halfwords in correct order...*/</span>
	<span class="n">insn</span> <span class="o">=</span> <span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span><span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
	<span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span><span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t32_emulate_ldrdstrd</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">3</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rt1</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rt1v</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt1</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rt2v</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt2</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">rn</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">?</span> <span class="n">pc</span>
							  <span class="o">:</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;blx    %[fn]&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rt1v</span><span class="p">),</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rt2v</span><span class="p">),</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rt1v</span><span class="p">),</span> <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">rt2v</span><span class="p">),</span> <span class="s">&quot;2&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rn</span> <span class="o">!=</span> <span class="mi">15</span><span class="p">)</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">]</span> <span class="o">=</span> <span class="n">rnv</span><span class="p">;</span> <span class="cm">/* Writeback base register */</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rt1v</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt2</span><span class="p">]</span> <span class="o">=</span> <span class="n">rt2v</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t32_emulate_ldrstr</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rtv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;blx    %[fn]&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rtv</span><span class="p">),</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rtv</span><span class="p">),</span> <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">]</span> <span class="o">=</span> <span class="n">rnv</span><span class="p">;</span> <span class="cm">/* Writeback base register */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rt</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="cm">/* Can&#39;t be true for a STR as they aren&#39;t allowed */</span>
		<span class="n">bx_write_pc</span><span class="p">(</span><span class="n">rtv</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">=</span> <span class="n">rtv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpsr</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span><span class="p">;</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;msr	cpsr_fs, %[cpsr]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;blx    %[fn]			</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;mrs	%[cpsr], cpsr		</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">),</span> <span class="p">[</span><span class="n">cpsr</span><span class="p">]</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span>
		  <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdv</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">=</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">APSR_MASK</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cpsr</span> <span class="o">&amp;</span> <span class="n">APSR_MASK</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t32_emulate_rd8pc16_noflags</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">pc</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">3</span><span class="p">;</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;blx    %[fn]&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t32_emulate_rd8rn16_noflags</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;blx    %[fn]&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t32_emulate_rdlo12rdhi8rn16rm0_noflags</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rdlo</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rdhi</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdlov</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rdlo</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdhiv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rdhi</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;blx    %[fn]&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdlov</span><span class="p">),</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdhiv</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rdlov</span><span class="p">),</span> <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">rdhiv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span>
		  <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rdlo</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdlov</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rdhi</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdhiv</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* These emulation encodings are functionally equivalent... */</span>
<span class="cp">#define t32_emulate_rd8rn16rm0ra12_noflags \</span>
<span class="cp">		t32_emulate_rdlo12rdhi8rn16rm0_noflags</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t32_table_1110_100x_x0xx</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Load/store multiple instructions */</span>

	<span class="cm">/* Rn is PC		1110 100x x0xx 1111 xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfe4f0000</span><span class="p">,</span> <span class="mh">0xe80f0000</span><span class="p">),</span>

	<span class="cm">/* SRS			1110 1000 00x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* RFE			1110 1000 00x1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xffc00000</span><span class="p">,</span> <span class="mh">0xe8000000</span><span class="p">),</span>
	<span class="cm">/* SRS			1110 1001 10x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* RFE			1110 1001 10x1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xffc00000</span><span class="p">,</span> <span class="mh">0xe9800000</span><span class="p">),</span>

	<span class="cm">/* STM Rn, {...pc}	1110 100x x0x0 xxxx 1xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfe508000</span><span class="p">,</span> <span class="mh">0xe8008000</span><span class="p">),</span>
	<span class="cm">/* LDM Rn, {...lr,pc}	1110 100x x0x1 xxxx 11xx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfe50c000</span><span class="p">,</span> <span class="mh">0xe810c000</span><span class="p">),</span>
	<span class="cm">/* LDM/STM Rn, {...sp}	1110 100x x0xx xxxx xx1x xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfe402000</span><span class="p">,</span> <span class="mh">0xe8002000</span><span class="p">),</span>

	<span class="cm">/* STMIA		1110 1000 10x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDMIA		1110 1000 10x1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* STMDB		1110 1001 00x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDMDB		1110 1001 00x1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_CUSTOM</span>	<span class="p">(</span><span class="mh">0xfe400000</span><span class="p">,</span> <span class="mh">0xe8000000</span><span class="p">,</span> <span class="n">t32_decode_ldmstm</span><span class="p">),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t32_table_1110_100x_x1xx</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Load/store dual, load/store exclusive, table branch */</span>

	<span class="cm">/* STRD (immediate)	1110 1000 x110 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRD (immediate)	1110 1000 x111 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xff600000</span><span class="p">,</span> <span class="mh">0xe8600000</span><span class="p">),</span>
	<span class="cm">/* STRD (immediate)	1110 1001 x1x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRD (immediate)	1110 1001 x1x1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xff400000</span><span class="p">,</span> <span class="mh">0xe9400000</span><span class="p">,</span> <span class="n">t32_emulate_ldrdstrd</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCWB</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* TBB			1110 1000 1101 xxxx xxxx xxxx 0000 xxxx */</span>
	<span class="cm">/* TBH			1110 1000 1101 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="n">DECODE_SIMULATEX</span><span class="p">(</span><span class="mh">0xfff000e0</span><span class="p">,</span> <span class="mh">0xe8d00000</span><span class="p">,</span> <span class="n">t32_simulate_table_branch</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* STREX		1110 1000 0100 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDREX		1110 1000 0101 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* STREXB		1110 1000 1100 xxxx xxxx xxxx 0100 xxxx */</span>
	<span class="cm">/* STREXH		1110 1000 1100 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="cm">/* STREXD		1110 1000 1100 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* LDREXB		1110 1000 1101 xxxx xxxx xxxx 0100 xxxx */</span>
	<span class="cm">/* LDREXH		1110 1000 1101 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="cm">/* LDREXD		1110 1000 1101 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* And unallocated instructions...				*/</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t32_table_1110_101x</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Data-processing (shifted register)				*/</span>

	<span class="cm">/* TST			1110 1010 0001 xxxx xxxx 1111 xxxx xxxx */</span>
	<span class="cm">/* TEQ			1110 1010 1001 xxxx xxxx 1111 xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xff700f00</span><span class="p">,</span> <span class="mh">0xea100f00</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* CMN			1110 1011 0001 xxxx xxxx 1111 xxxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfff00f00</span><span class="p">,</span> <span class="mh">0xeb100f00</span><span class="p">),</span>
	<span class="cm">/* CMP			1110 1011 1011 xxxx xxxx 1111 xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfff00f00</span><span class="p">,</span> <span class="mh">0xebb00f00</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* MOV			1110 1010 010x 1111 xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* MVN			1110 1010 011x 1111 xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xffcf0000</span><span class="p">,</span> <span class="mh">0xea4f0000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* ???			1110 1010 101x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ???			1110 1010 111x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xffa00000</span><span class="p">,</span> <span class="mh">0xeaa00000</span><span class="p">),</span>
	<span class="cm">/* ???			1110 1011 001x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xffe00000</span><span class="p">,</span> <span class="mh">0xeb200000</span><span class="p">),</span>
	<span class="cm">/* ???			1110 1011 100x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xffe00000</span><span class="p">,</span> <span class="mh">0xeb800000</span><span class="p">),</span>
	<span class="cm">/* ???			1110 1011 111x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xffe00000</span><span class="p">,</span> <span class="mh">0xebe00000</span><span class="p">),</span>

	<span class="cm">/* ADD/SUB SP, SP, Rm, LSL #0..3				*/</span>
	<span class="cm">/*			1110 1011 x0xx 1101 x000 1101 xx00 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xff4f7f30</span><span class="p">,</span> <span class="mh">0xeb0d0d00</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* ADD/SUB SP, SP, Rm, shift					*/</span>
	<span class="cm">/*			1110 1011 x0xx 1101 xxxx 1101 xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xff4f0f00</span><span class="p">,</span> <span class="mh">0xeb0d0d00</span><span class="p">),</span>

	<span class="cm">/* ADD/SUB Rd, SP, Rm, shift					*/</span>
	<span class="cm">/*			1110 1011 x0xx 1101 xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xff4f0000</span><span class="p">,</span> <span class="mh">0xeb0d0000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* AND			1110 1010 000x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* BIC			1110 1010 001x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ORR			1110 1010 010x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ORN			1110 1010 011x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* EOR			1110 1010 100x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* PKH			1110 1010 110x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ADD			1110 1011 000x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ADC			1110 1011 010x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* SBC			1110 1011 011x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* SUB			1110 1011 101x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* RSB			1110 1011 110x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfe000000</span><span class="p">,</span> <span class="mh">0xea000000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t32_table_1111_0x0x___0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Data-processing (modified immediate)				*/</span>

	<span class="cm">/* TST			1111 0x00 0001 xxxx 0xxx 1111 xxxx xxxx */</span>
	<span class="cm">/* TEQ			1111 0x00 1001 xxxx 0xxx 1111 xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfb708f00</span><span class="p">,</span> <span class="mh">0xf0100f00</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* CMN			1111 0x01 0001 xxxx 0xxx 1111 xxxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfbf08f00</span><span class="p">,</span> <span class="mh">0xf1100f00</span><span class="p">),</span>
	<span class="cm">/* CMP			1111 0x01 1011 xxxx 0xxx 1111 xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfbf08f00</span><span class="p">,</span> <span class="mh">0xf1b00f00</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* MOV			1111 0x00 010x 1111 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* MVN			1111 0x00 011x 1111 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfbcf8000</span><span class="p">,</span> <span class="mh">0xf04f0000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* ???			1111 0x00 101x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfbe08000</span><span class="p">,</span> <span class="mh">0xf0a00000</span><span class="p">),</span>
	<span class="cm">/* ???			1111 0x00 110x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ???			1111 0x00 111x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfbc08000</span><span class="p">,</span> <span class="mh">0xf0c00000</span><span class="p">),</span>
	<span class="cm">/* ???			1111 0x01 001x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfbe08000</span><span class="p">,</span> <span class="mh">0xf1200000</span><span class="p">),</span>
	<span class="cm">/* ???			1111 0x01 100x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfbe08000</span><span class="p">,</span> <span class="mh">0xf1800000</span><span class="p">),</span>
	<span class="cm">/* ???			1111 0x01 111x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfbe08000</span><span class="p">,</span> <span class="mh">0xf1e00000</span><span class="p">),</span>

	<span class="cm">/* ADD Rd, SP, #imm	1111 0x01 000x 1101 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* SUB Rd, SP, #imm	1111 0x01 101x 1101 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfb4f8000</span><span class="p">,</span> <span class="mh">0xf10d0000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* AND			1111 0x00 000x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* BIC			1111 0x00 001x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ORR			1111 0x00 010x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ORN			1111 0x00 011x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* EOR			1111 0x00 100x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ADD			1111 0x01 000x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ADC			1111 0x01 010x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* SBC			1111 0x01 011x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* SUB			1111 0x01 101x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* RSB			1111 0x01 110x xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfa008000</span><span class="p">,</span> <span class="mh">0xf0000000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t32_table_1111_0x1x___0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Data-processing (plain binary immediate)			*/</span>

	<span class="cm">/* ADDW Rd, PC, #imm	1111 0x10 0000 1111 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfbff8000</span><span class="p">,</span> <span class="mh">0xf20f0000</span><span class="p">),</span>
	<span class="cm">/* SUBW	Rd, PC, #imm	1111 0x10 1010 1111 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfbff8000</span><span class="p">,</span> <span class="mh">0xf2af0000</span><span class="p">,</span> <span class="n">t32_emulate_rd8pc16_noflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">PC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* ADDW SP, SP, #imm	1111 0x10 0000 1101 0xxx 1101 xxxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfbff8f00</span><span class="p">,</span> <span class="mh">0xf20d0d00</span><span class="p">),</span>
	<span class="cm">/* SUBW	SP, SP, #imm	1111 0x10 1010 1101 0xxx 1101 xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfbff8f00</span><span class="p">,</span> <span class="mh">0xf2ad0d00</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16_noflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* ADDW			1111 0x10 0000 xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfbf08000</span><span class="p">,</span> <span class="mh">0xf2000000</span><span class="p">),</span>
	<span class="cm">/* SUBW			1111 0x10 1010 xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfbf08000</span><span class="p">,</span> <span class="mh">0xf2a00000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16_noflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* MOVW			1111 0x10 0100 xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* MOVT			1111 0x10 1100 xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfb708000</span><span class="p">,</span> <span class="mh">0xf2400000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16_noflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* SSAT16		1111 0x11 0010 xxxx 0000 xxxx 00xx xxxx */</span>
	<span class="cm">/* SSAT			1111 0x11 00x0 xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* USAT16		1111 0x11 1010 xxxx 0000 xxxx 00xx xxxx */</span>
	<span class="cm">/* USAT			1111 0x11 10x0 xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfb508000</span><span class="p">,</span> <span class="mh">0xf3000000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* SFBX			1111 0x11 0100 xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* UFBX			1111 0x11 1100 xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfb708000</span><span class="p">,</span> <span class="mh">0xf3400000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16_noflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* BFC			1111 0x11 0110 1111 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfbff8000</span><span class="p">,</span> <span class="mh">0xf36f0000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16_noflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* BFI			1111 0x11 0110 xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfbf08000</span><span class="p">,</span> <span class="mh">0xf3600000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16_noflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPCX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t32_table_1111_0xxx___1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Branches and miscellaneous control				*/</span>

	<span class="cm">/* YIELD		1111 0011 1010 xxxx 10x0 x000 0000 0001 */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfff0d7ff</span><span class="p">,</span> <span class="mh">0xf3a08001</span><span class="p">),</span>
	<span class="cm">/* SEV			1111 0011 1010 xxxx 10x0 x000 0000 0100 */</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0xfff0d7ff</span><span class="p">,</span> <span class="mh">0xf3a08004</span><span class="p">,</span> <span class="n">kprobe_emulate_none</span><span class="p">),</span>
	<span class="cm">/* NOP			1111 0011 1010 xxxx 10x0 x000 0000 0000 */</span>
	<span class="cm">/* WFE			1111 0011 1010 xxxx 10x0 x000 0000 0010 */</span>
	<span class="cm">/* WFI			1111 0011 1010 xxxx 10x0 x000 0000 0011 */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xfff0d7fc</span><span class="p">,</span> <span class="mh">0xf3a08000</span><span class="p">,</span> <span class="n">kprobe_simulate_nop</span><span class="p">),</span>

	<span class="cm">/* MRS Rd, CPSR		1111 0011 1110 xxxx 10x0 xxxx xxxx xxxx */</span>
	<span class="n">DECODE_SIMULATEX</span><span class="p">(</span><span class="mh">0xfff0d000</span><span class="p">,</span> <span class="mh">0xf3e08000</span><span class="p">,</span> <span class="n">t32_simulate_mrs</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Unsupported instructions</span>
<span class="cm">	 *			1111 0x11 1xxx xxxx 10x0 xxxx xxxx xxxx</span>
<span class="cm">	 *</span>
<span class="cm">	 * MSR			1111 0011 100x xxxx 10x0 xxxx xxxx xxxx</span>
<span class="cm">	 * DBG hint		1111 0011 1010 xxxx 10x0 x000 1111 xxxx</span>
<span class="cm">	 * Unallocated hints	1111 0011 1010 xxxx 10x0 x000 xxxx xxxx</span>
<span class="cm">	 * CPS			1111 0011 1010 xxxx 10x0 xxxx xxxx xxxx</span>
<span class="cm">	 * CLREX/DSB/DMB/ISB	1111 0011 1011 xxxx 10x0 xxxx xxxx xxxx</span>
<span class="cm">	 * BXJ			1111 0011 1100 xxxx 10x0 xxxx xxxx xxxx</span>
<span class="cm">	 * SUBS PC,LR,#&lt;imm8&gt;	1111 0011 1101 xxxx 10x0 xxxx xxxx xxxx</span>
<span class="cm">	 * MRS Rd, SPSR		1111 0011 1111 xxxx 10x0 xxxx xxxx xxxx</span>
<span class="cm">	 * SMC			1111 0111 1111 xxxx 1000 xxxx xxxx xxxx</span>
<span class="cm">	 * UNDEFINED		1111 0111 1111 xxxx 1010 xxxx xxxx xxxx</span>
<span class="cm">	 * ???			1111 0111 1xxx xxxx 1010 xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfb80d000</span><span class="p">,</span> <span class="mh">0xf3808000</span><span class="p">),</span>

	<span class="cm">/* Bcc			1111 0xxx xxxx xxxx 10x0 xxxx xxxx xxxx */</span>
	<span class="n">DECODE_CUSTOM</span>	<span class="p">(</span><span class="mh">0xf800d000</span><span class="p">,</span> <span class="mh">0xf0008000</span><span class="p">,</span> <span class="n">t32_decode_cond_branch</span><span class="p">),</span>

	<span class="cm">/* BLX			1111 0xxx xxxx xxxx 11x0 xxxx xxxx xxx0 */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xf800d001</span><span class="p">,</span> <span class="mh">0xf000c000</span><span class="p">),</span>
	<span class="cm">/* B			1111 0xxx xxxx xxxx 10x1 xxxx xxxx xxxx */</span>
	<span class="cm">/* BL			1111 0xxx xxxx xxxx 11x1 xxxx xxxx xxxx */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xf8009000</span><span class="p">,</span> <span class="mh">0xf0009000</span><span class="p">,</span> <span class="n">t32_simulate_branch</span><span class="p">),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t32_table_1111_100x_x0x1__1111</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Memory hints							*/</span>

	<span class="cm">/* PLD (literal)	1111 1000 x001 1111 1111 xxxx xxxx xxxx */</span>
	<span class="cm">/* PLI (literal)	1111 1001 x001 1111 1111 xxxx xxxx xxxx */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xfe7ff000</span><span class="p">,</span> <span class="mh">0xf81ff000</span><span class="p">,</span> <span class="n">kprobe_simulate_nop</span><span class="p">),</span>

	<span class="cm">/* PLD{W} (immediate)	1111 1000 10x1 xxxx 1111 xxxx xxxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xffd0f000</span><span class="p">,</span> <span class="mh">0xf890f000</span><span class="p">),</span>
	<span class="cm">/* PLD{W} (immediate)	1111 1000 00x1 xxxx 1111 1100 xxxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xffd0ff00</span><span class="p">,</span> <span class="mh">0xf810fc00</span><span class="p">),</span>
	<span class="cm">/* PLI (immediate)	1111 1001 1001 xxxx 1111 xxxx xxxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfff0f000</span><span class="p">,</span> <span class="mh">0xf990f000</span><span class="p">),</span>
	<span class="cm">/* PLI (immediate)	1111 1001 0001 xxxx 1111 1100 xxxx xxxx */</span>
	<span class="n">DECODE_SIMULATEX</span><span class="p">(</span><span class="mh">0xfff0ff00</span><span class="p">,</span> <span class="mh">0xf910fc00</span><span class="p">,</span> <span class="n">kprobe_simulate_nop</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* PLD{W} (register)	1111 1000 00x1 xxxx 1111 0000 00xx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xffd0ffc0</span><span class="p">,</span> <span class="mh">0xf810f000</span><span class="p">),</span>
	<span class="cm">/* PLI (register)	1111 1001 0001 xxxx 1111 0000 00xx xxxx */</span>
	<span class="n">DECODE_SIMULATEX</span><span class="p">(</span><span class="mh">0xfff0ffc0</span><span class="p">,</span> <span class="mh">0xf910f000</span><span class="p">,</span> <span class="n">kprobe_simulate_nop</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* Other unallocated instructions...				*/</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t32_table_1111_100x</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Store/Load single data item					*/</span>

	<span class="cm">/* ???			1111 100x x11x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfe600000</span><span class="p">,</span> <span class="mh">0xf8600000</span><span class="p">),</span>

	<span class="cm">/* ???			1111 1001 0101 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfff00000</span><span class="p">,</span> <span class="mh">0xf9500000</span><span class="p">),</span>

	<span class="cm">/* ???			1111 100x 0xxx xxxx xxxx 10x0 xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfe800d00</span><span class="p">,</span> <span class="mh">0xf8000800</span><span class="p">),</span>

	<span class="cm">/* STRBT		1111 1000 0000 xxxx xxxx 1110 xxxx xxxx */</span>
	<span class="cm">/* STRHT		1111 1000 0010 xxxx xxxx 1110 xxxx xxxx */</span>
	<span class="cm">/* STRT			1111 1000 0100 xxxx xxxx 1110 xxxx xxxx */</span>
	<span class="cm">/* LDRBT		1111 1000 0001 xxxx xxxx 1110 xxxx xxxx */</span>
	<span class="cm">/* LDRSBT		1111 1001 0001 xxxx xxxx 1110 xxxx xxxx */</span>
	<span class="cm">/* LDRHT		1111 1000 0011 xxxx xxxx 1110 xxxx xxxx */</span>
	<span class="cm">/* LDRSHT		1111 1001 0011 xxxx xxxx 1110 xxxx xxxx */</span>
	<span class="cm">/* LDRT			1111 1000 0101 xxxx xxxx 1110 xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfe800f00</span><span class="p">,</span> <span class="mh">0xf8000e00</span><span class="p">),</span>

	<span class="cm">/* STR{,B,H} Rn,[PC...]	1111 1000 xxx0 1111 xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xff1f0000</span><span class="p">,</span> <span class="mh">0xf80f0000</span><span class="p">),</span>

	<span class="cm">/* STR{,B,H} PC,[Rn...]	1111 1000 xxx0 xxxx 1111 xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xff10f000</span><span class="p">,</span> <span class="mh">0xf800f000</span><span class="p">),</span>

	<span class="cm">/* LDR (literal)	1111 1000 x101 1111 xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_SIMULATEX</span><span class="p">(</span><span class="mh">0xff7f0000</span><span class="p">,</span> <span class="mh">0xf85f0000</span><span class="p">,</span> <span class="n">t32_simulate_ldr_literal</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">PC</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* STR (immediate)	1111 1000 0100 xxxx xxxx 1xxx xxxx xxxx */</span>
	<span class="cm">/* LDR (immediate)	1111 1000 0101 xxxx xxxx 1xxx xxxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xffe00800</span><span class="p">,</span> <span class="mh">0xf8400800</span><span class="p">),</span>
	<span class="cm">/* STR (immediate)	1111 1000 1100 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDR (immediate)	1111 1000 1101 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xffe00000</span><span class="p">,</span> <span class="mh">0xf8c00000</span><span class="p">,</span> <span class="n">t32_emulate_ldrstr</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCX</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* STR (register)	1111 1000 0100 xxxx xxxx 0000 00xx xxxx */</span>
	<span class="cm">/* LDR (register)	1111 1000 0101 xxxx xxxx 0000 00xx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xffe00fc0</span><span class="p">,</span> <span class="mh">0xf8400000</span><span class="p">,</span> <span class="n">t32_emulate_ldrstr</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCX</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* LDRB (literal)	1111 1000 x001 1111 xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRSB (literal)	1111 1001 x001 1111 xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRH (literal)	1111 1000 x011 1111 xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRSH (literal)	1111 1001 x011 1111 xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_SIMULATEX</span><span class="p">(</span><span class="mh">0xfe5f0000</span><span class="p">,</span> <span class="mh">0xf81f0000</span><span class="p">,</span> <span class="n">t32_simulate_ldr_literal</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">PC</span><span class="p">,</span> <span class="n">NOSPPCX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* STRB (immediate)	1111 1000 0000 xxxx xxxx 1xxx xxxx xxxx */</span>
	<span class="cm">/* STRH (immediate)	1111 1000 0010 xxxx xxxx 1xxx xxxx xxxx */</span>
	<span class="cm">/* LDRB (immediate)	1111 1000 0001 xxxx xxxx 1xxx xxxx xxxx */</span>
	<span class="cm">/* LDRSB (immediate)	1111 1001 0001 xxxx xxxx 1xxx xxxx xxxx */</span>
	<span class="cm">/* LDRH (immediate)	1111 1000 0011 xxxx xxxx 1xxx xxxx xxxx */</span>
	<span class="cm">/* LDRSH (immediate)	1111 1001 0011 xxxx xxxx 1xxx xxxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfec00800</span><span class="p">,</span> <span class="mh">0xf8000800</span><span class="p">),</span>
	<span class="cm">/* STRB (immediate)	1111 1000 1000 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* STRH (immediate)	1111 1000 1010 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRB (immediate)	1111 1000 1001 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRSB (immediate)	1111 1001 1001 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRH (immediate)	1111 1000 1011 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRSH (immediate)	1111 1001 1011 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfec00000</span><span class="p">,</span> <span class="mh">0xf8800000</span><span class="p">,</span> <span class="n">t32_emulate_ldrstr</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCX</span><span class="p">,</span> <span class="n">NOSPPCX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* STRB (register)	1111 1000 0000 xxxx xxxx 0000 00xx xxxx */</span>
	<span class="cm">/* STRH (register)	1111 1000 0010 xxxx xxxx 0000 00xx xxxx */</span>
	<span class="cm">/* LDRB (register)	1111 1000 0001 xxxx xxxx 0000 00xx xxxx */</span>
	<span class="cm">/* LDRSB (register)	1111 1001 0001 xxxx xxxx 0000 00xx xxxx */</span>
	<span class="cm">/* LDRH (register)	1111 1000 0011 xxxx xxxx 0000 00xx xxxx */</span>
	<span class="cm">/* LDRSH (register)	1111 1001 0011 xxxx xxxx 0000 00xx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfe800fc0</span><span class="p">,</span> <span class="mh">0xf8000000</span><span class="p">,</span> <span class="n">t32_emulate_ldrstr</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCX</span><span class="p">,</span> <span class="n">NOSPPCX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* Other unallocated instructions...				*/</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t32_table_1111_1010___1111</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Data-processing (register)					*/</span>

	<span class="cm">/* ???			1111 1010 011x xxxx 1111 xxxx 1xxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xffe0f080</span><span class="p">,</span> <span class="mh">0xfa60f080</span><span class="p">),</span>

	<span class="cm">/* SXTH			1111 1010 0000 1111 1111 xxxx 1xxx xxxx */</span>
	<span class="cm">/* UXTH			1111 1010 0001 1111 1111 xxxx 1xxx xxxx */</span>
	<span class="cm">/* SXTB16		1111 1010 0010 1111 1111 xxxx 1xxx xxxx */</span>
	<span class="cm">/* UXTB16		1111 1010 0011 1111 1111 xxxx 1xxx xxxx */</span>
	<span class="cm">/* SXTB			1111 1010 0100 1111 1111 xxxx 1xxx xxxx */</span>
	<span class="cm">/* UXTB			1111 1010 0101 1111 1111 xxxx 1xxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xff8ff080</span><span class="p">,</span> <span class="mh">0xfa0ff080</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>


	<span class="cm">/* ???			1111 1010 1xxx xxxx 1111 xxxx 0x11 xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xff80f0b0</span><span class="p">,</span> <span class="mh">0xfa80f030</span><span class="p">),</span>
	<span class="cm">/* ???			1111 1010 1x11 xxxx 1111 xxxx 0xxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xffb0f080</span><span class="p">,</span> <span class="mh">0xfab0f000</span><span class="p">),</span>

	<span class="cm">/* SADD16		1111 1010 1001 xxxx 1111 xxxx 0000 xxxx */</span>
	<span class="cm">/* SASX			1111 1010 1010 xxxx 1111 xxxx 0000 xxxx */</span>
	<span class="cm">/* SSAX			1111 1010 1110 xxxx 1111 xxxx 0000 xxxx */</span>
	<span class="cm">/* SSUB16		1111 1010 1101 xxxx 1111 xxxx 0000 xxxx */</span>
	<span class="cm">/* SADD8		1111 1010 1000 xxxx 1111 xxxx 0000 xxxx */</span>
	<span class="cm">/* SSUB8		1111 1010 1100 xxxx 1111 xxxx 0000 xxxx */</span>

	<span class="cm">/* QADD16		1111 1010 1001 xxxx 1111 xxxx 0001 xxxx */</span>
	<span class="cm">/* QASX			1111 1010 1010 xxxx 1111 xxxx 0001 xxxx */</span>
	<span class="cm">/* QSAX			1111 1010 1110 xxxx 1111 xxxx 0001 xxxx */</span>
	<span class="cm">/* QSUB16		1111 1010 1101 xxxx 1111 xxxx 0001 xxxx */</span>
	<span class="cm">/* QADD8		1111 1010 1000 xxxx 1111 xxxx 0001 xxxx */</span>
	<span class="cm">/* QSUB8		1111 1010 1100 xxxx 1111 xxxx 0001 xxxx */</span>

	<span class="cm">/* SHADD16		1111 1010 1001 xxxx 1111 xxxx 0010 xxxx */</span>
	<span class="cm">/* SHASX		1111 1010 1010 xxxx 1111 xxxx 0010 xxxx */</span>
	<span class="cm">/* SHSAX		1111 1010 1110 xxxx 1111 xxxx 0010 xxxx */</span>
	<span class="cm">/* SHSUB16		1111 1010 1101 xxxx 1111 xxxx 0010 xxxx */</span>
	<span class="cm">/* SHADD8		1111 1010 1000 xxxx 1111 xxxx 0010 xxxx */</span>
	<span class="cm">/* SHSUB8		1111 1010 1100 xxxx 1111 xxxx 0010 xxxx */</span>

	<span class="cm">/* UADD16		1111 1010 1001 xxxx 1111 xxxx 0100 xxxx */</span>
	<span class="cm">/* UASX			1111 1010 1010 xxxx 1111 xxxx 0100 xxxx */</span>
	<span class="cm">/* USAX			1111 1010 1110 xxxx 1111 xxxx 0100 xxxx */</span>
	<span class="cm">/* USUB16		1111 1010 1101 xxxx 1111 xxxx 0100 xxxx */</span>
	<span class="cm">/* UADD8		1111 1010 1000 xxxx 1111 xxxx 0100 xxxx */</span>
	<span class="cm">/* USUB8		1111 1010 1100 xxxx 1111 xxxx 0100 xxxx */</span>

	<span class="cm">/* UQADD16		1111 1010 1001 xxxx 1111 xxxx 0101 xxxx */</span>
	<span class="cm">/* UQASX		1111 1010 1010 xxxx 1111 xxxx 0101 xxxx */</span>
	<span class="cm">/* UQSAX		1111 1010 1110 xxxx 1111 xxxx 0101 xxxx */</span>
	<span class="cm">/* UQSUB16		1111 1010 1101 xxxx 1111 xxxx 0101 xxxx */</span>
	<span class="cm">/* UQADD8		1111 1010 1000 xxxx 1111 xxxx 0101 xxxx */</span>
	<span class="cm">/* UQSUB8		1111 1010 1100 xxxx 1111 xxxx 0101 xxxx */</span>

	<span class="cm">/* UHADD16		1111 1010 1001 xxxx 1111 xxxx 0110 xxxx */</span>
	<span class="cm">/* UHASX		1111 1010 1010 xxxx 1111 xxxx 0110 xxxx */</span>
	<span class="cm">/* UHSAX		1111 1010 1110 xxxx 1111 xxxx 0110 xxxx */</span>
	<span class="cm">/* UHSUB16		1111 1010 1101 xxxx 1111 xxxx 0110 xxxx */</span>
	<span class="cm">/* UHADD8		1111 1010 1000 xxxx 1111 xxxx 0110 xxxx */</span>
	<span class="cm">/* UHSUB8		1111 1010 1100 xxxx 1111 xxxx 0110 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xff80f080</span><span class="p">,</span> <span class="mh">0xfa80f000</span><span class="p">),</span>

	<span class="cm">/* SXTAH		1111 1010 0000 xxxx 1111 xxxx 1xxx xxxx */</span>
	<span class="cm">/* UXTAH		1111 1010 0001 xxxx 1111 xxxx 1xxx xxxx */</span>
	<span class="cm">/* SXTAB16		1111 1010 0010 xxxx 1111 xxxx 1xxx xxxx */</span>
	<span class="cm">/* UXTAB16		1111 1010 0011 xxxx 1111 xxxx 1xxx xxxx */</span>
	<span class="cm">/* SXTAB		1111 1010 0100 xxxx 1111 xxxx 1xxx xxxx */</span>
	<span class="cm">/* UXTAB		1111 1010 0101 xxxx 1111 xxxx 1xxx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xff80f080</span><span class="p">,</span> <span class="mh">0xfa00f080</span><span class="p">),</span>

	<span class="cm">/* QADD			1111 1010 1000 xxxx 1111 xxxx 1000 xxxx */</span>
	<span class="cm">/* QDADD		1111 1010 1000 xxxx 1111 xxxx 1001 xxxx */</span>
	<span class="cm">/* QSUB			1111 1010 1000 xxxx 1111 xxxx 1010 xxxx */</span>
	<span class="cm">/* QDSUB		1111 1010 1000 xxxx 1111 xxxx 1011 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfff0f0c0</span><span class="p">,</span> <span class="mh">0xfa80f080</span><span class="p">),</span>

	<span class="cm">/* SEL			1111 1010 1010 xxxx 1111 xxxx 1000 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfff0f0f0</span><span class="p">,</span> <span class="mh">0xfaa0f080</span><span class="p">),</span>

	<span class="cm">/* LSL			1111 1010 000x xxxx 1111 xxxx 0000 xxxx */</span>
	<span class="cm">/* LSR			1111 1010 001x xxxx 1111 xxxx 0000 xxxx */</span>
	<span class="cm">/* ASR			1111 1010 010x xxxx 1111 xxxx 0000 xxxx */</span>
	<span class="cm">/* ROR			1111 1010 011x xxxx 1111 xxxx 0000 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xff80f0f0</span><span class="p">,</span> <span class="mh">0xfa00f000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* CLZ			1111 1010 1010 xxxx 1111 xxxx 1000 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfff0f0f0</span><span class="p">,</span> <span class="mh">0xfab0f080</span><span class="p">),</span>

	<span class="cm">/* REV			1111 1010 1001 xxxx 1111 xxxx 1000 xxxx */</span>
	<span class="cm">/* REV16		1111 1010 1001 xxxx 1111 xxxx 1001 xxxx */</span>
	<span class="cm">/* RBIT			1111 1010 1001 xxxx 1111 xxxx 1010 xxxx */</span>
	<span class="cm">/* REVSH		1111 1010 1001 xxxx 1111 xxxx 1011 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xfff0f0c0</span><span class="p">,</span> <span class="mh">0xfa90f080</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16_noflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SAMEAS16</span><span class="p">)),</span>

	<span class="cm">/* Other unallocated instructions...				*/</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t32_table_1111_1011_0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Multiply, multiply accumulate, and absolute difference	*/</span>

	<span class="cm">/* ???			1111 1011 0000 xxxx 1111 xxxx 0001 xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfff0f0f0</span><span class="p">,</span> <span class="mh">0xfb00f010</span><span class="p">),</span>
	<span class="cm">/* ???			1111 1011 0111 xxxx 1111 xxxx 0001 xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfff0f0f0</span><span class="p">,</span> <span class="mh">0xfb70f010</span><span class="p">),</span>

	<span class="cm">/* SMULxy		1111 1011 0001 xxxx 1111 xxxx 00xx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfff0f0c0</span><span class="p">,</span> <span class="mh">0xfb10f000</span><span class="p">),</span>
	<span class="cm">/* MUL			1111 1011 0000 xxxx 1111 xxxx 0000 xxxx */</span>
	<span class="cm">/* SMUAD{X}		1111 1011 0010 xxxx 1111 xxxx 000x xxxx */</span>
	<span class="cm">/* SMULWy		1111 1011 0011 xxxx 1111 xxxx 000x xxxx */</span>
	<span class="cm">/* SMUSD{X}		1111 1011 0100 xxxx 1111 xxxx 000x xxxx */</span>
	<span class="cm">/* SMMUL{R}		1111 1011 0101 xxxx 1111 xxxx 000x xxxx */</span>
	<span class="cm">/* USAD8		1111 1011 0111 xxxx 1111 xxxx 0000 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xff80f0e0</span><span class="p">,</span> <span class="mh">0xfb00f000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* ???			1111 1011 0111 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfff000f0</span><span class="p">,</span> <span class="mh">0xfb700010</span><span class="p">),</span>

	<span class="cm">/* SMLAxy		1111 1011 0001 xxxx xxxx xxxx 00xx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfff000c0</span><span class="p">,</span> <span class="mh">0xfb100000</span><span class="p">),</span>
	<span class="cm">/* MLA			1111 1011 0000 xxxx xxxx xxxx 0000 xxxx */</span>
	<span class="cm">/* MLS			1111 1011 0000 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="cm">/* SMLAD{X}		1111 1011 0010 xxxx xxxx xxxx 000x xxxx */</span>
	<span class="cm">/* SMLAWy		1111 1011 0011 xxxx xxxx xxxx 000x xxxx */</span>
	<span class="cm">/* SMLSD{X}		1111 1011 0100 xxxx xxxx xxxx 000x xxxx */</span>
	<span class="cm">/* SMMLA{R}		1111 1011 0101 xxxx xxxx xxxx 000x xxxx */</span>
	<span class="cm">/* SMMLS{R}		1111 1011 0110 xxxx xxxx xxxx 000x xxxx */</span>
	<span class="cm">/* USADA8		1111 1011 0111 xxxx xxxx xxxx 0000 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xff8000c0</span><span class="p">,</span> <span class="mh">0xfb000000</span><span class="p">,</span> <span class="n">t32_emulate_rd8rn16rm0ra12_noflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPC</span><span class="p">,</span> <span class="n">NOSPPCX</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* Other unallocated instructions...				*/</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t32_table_1111_1011_1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Long multiply, long multiply accumulate, and divide		*/</span>

	<span class="cm">/* UMAAL		1111 1011 1110 xxxx xxxx xxxx 0110 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfff000f0</span><span class="p">,</span> <span class="mh">0xfbe00060</span><span class="p">),</span>
	<span class="cm">/* SMLALxy		1111 1011 1100 xxxx xxxx xxxx 10xx xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xfff000c0</span><span class="p">,</span> <span class="mh">0xfbc00080</span><span class="p">),</span>
	<span class="cm">/* SMLALD{X}		1111 1011 1100 xxxx xxxx xxxx 110x xxxx */</span>
	<span class="cm">/* SMLSLD{X}		1111 1011 1101 xxxx xxxx xxxx 110x xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xffe000e0</span><span class="p">,</span> <span class="mh">0xfbc000c0</span><span class="p">),</span>
	<span class="cm">/* SMULL		1111 1011 1000 xxxx xxxx xxxx 0000 xxxx */</span>
	<span class="cm">/* UMULL		1111 1011 1010 xxxx xxxx xxxx 0000 xxxx */</span>
	<span class="cm">/* SMLAL		1111 1011 1100 xxxx xxxx xxxx 0000 xxxx */</span>
	<span class="cm">/* UMLAL		1111 1011 1110 xxxx xxxx xxxx 0000 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0xff9000f0</span><span class="p">,</span> <span class="mh">0xfb800000</span><span class="p">,</span> <span class="n">t32_emulate_rdlo12rdhi8rn16rm0_noflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOSPPC</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOSPPC</span><span class="p">)),</span>

	<span class="cm">/* SDIV			1111 1011 1001 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="cm">/* UDIV			1111 1011 1011 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="cm">/* Other unallocated instructions...				*/</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">kprobe_decode_thumb32_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

	<span class="cm">/*</span>
<span class="cm">	 * Load/store multiple instructions</span>
<span class="cm">	 *			1110 100x x0xx xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xfe400000</span><span class="p">,</span> <span class="mh">0xe8000000</span><span class="p">,</span> <span class="n">t32_table_1110_100x_x0xx</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Load/store dual, load/store exclusive, table branch</span>
<span class="cm">	 *			1110 100x x1xx xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xfe400000</span><span class="p">,</span> <span class="mh">0xe8400000</span><span class="p">,</span> <span class="n">t32_table_1110_100x_x1xx</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Data-processing (shifted register)</span>
<span class="cm">	 *			1110 101x xxxx xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xfe000000</span><span class="p">,</span> <span class="mh">0xea000000</span><span class="p">,</span> <span class="n">t32_table_1110_101x</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Coprocessor instructions</span>
<span class="cm">	 *			1110 11xx xxxx xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfc000000</span><span class="p">,</span> <span class="mh">0xec000000</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Data-processing (modified immediate)</span>
<span class="cm">	 *			1111 0x0x xxxx xxxx 0xxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xfa008000</span><span class="p">,</span> <span class="mh">0xf0000000</span><span class="p">,</span> <span class="n">t32_table_1111_0x0x___0</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Data-processing (plain binary immediate)</span>
<span class="cm">	 *			1111 0x1x xxxx xxxx 0xxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xfa008000</span><span class="p">,</span> <span class="mh">0xf2000000</span><span class="p">,</span> <span class="n">t32_table_1111_0x1x___0</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Branches and miscellaneous control</span>
<span class="cm">	 *			1111 0xxx xxxx xxxx 1xxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xf8008000</span><span class="p">,</span> <span class="mh">0xf0008000</span><span class="p">,</span> <span class="n">t32_table_1111_0xxx___1</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Advanced SIMD element or structure load/store instructions</span>
<span class="cm">	 *			1111 1001 xxx0 xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xff100000</span><span class="p">,</span> <span class="mh">0xf9000000</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Memory hints</span>
<span class="cm">	 *			1111 100x x0x1 xxxx 1111 xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xfe50f000</span><span class="p">,</span> <span class="mh">0xf810f000</span><span class="p">,</span> <span class="n">t32_table_1111_100x_x0x1__1111</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Store single data item</span>
<span class="cm">	 *			1111 1000 xxx0 xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 * Load single data items</span>
<span class="cm">	 *			1111 100x xxx1 xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xfe000000</span><span class="p">,</span> <span class="mh">0xf8000000</span><span class="p">,</span> <span class="n">t32_table_1111_100x</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Data-processing (register)</span>
<span class="cm">	 *			1111 1010 xxxx xxxx 1111 xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xff00f000</span><span class="p">,</span> <span class="mh">0xfa00f000</span><span class="p">,</span> <span class="n">t32_table_1111_1010___1111</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Multiply, multiply accumulate, and absolute difference</span>
<span class="cm">	 *			1111 1011 0xxx xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xff800000</span><span class="p">,</span> <span class="mh">0xfb000000</span><span class="p">,</span> <span class="n">t32_table_1111_1011_0</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Long multiply, long multiply accumulate, and divide</span>
<span class="cm">	 *			1111 1011 1xxx xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xff800000</span><span class="p">,</span> <span class="mh">0xfb800000</span><span class="p">,</span> <span class="n">t32_table_1111_1011_1</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Coprocessor instructions</span>
<span class="cm">	 *			1111 11xx xxxx xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>
<span class="cp">#ifdef CONFIG_ARM_KPROBES_TEST_MODULE</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">kprobe_decode_thumb32_table</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_simulate_bxblx</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="o">=</span> <span class="p">(</span><span class="n">rm</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">?</span> <span class="n">pc</span> <span class="o">:</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">))</span> <span class="cm">/* BLX ? */</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_lr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>

	<span class="n">bx_write_pc</span><span class="p">(</span><span class="n">rmv</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_simulate_ldr_literal</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span><span class="o">*</span> <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">3</span><span class="p">);</span>
	<span class="kt">long</span> <span class="n">index</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_simulate_ldrstr_sp_relative</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span><span class="o">*</span> <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_sp</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">index</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x800</span><span class="p">)</span> <span class="cm">/* LDR */</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
	<span class="k">else</span> <span class="cm">/* STR */</span>
		<span class="n">base</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_simulate_reladr</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x800</span><span class="p">)</span> <span class="o">?</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_sp</span>
					    <span class="o">:</span> <span class="p">(</span><span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">3</span><span class="p">);</span>
	<span class="kt">long</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_simulate_add_sp_imm</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">imm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="cm">/* SUB */</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_sp</span> <span class="o">-=</span> <span class="n">imm</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
	<span class="k">else</span> <span class="cm">/* ADD */</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_sp</span> <span class="o">+=</span> <span class="n">imm</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_simulate_cbz</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">;</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">nonzero</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">]</span> <span class="o">?</span> <span class="n">insn</span> <span class="o">:</span> <span class="o">~</span><span class="n">insn</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">nonzero</span> <span class="o">&amp;</span> <span class="mh">0x800</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x200</span><span class="p">;</span>
		<span class="kt">long</span> <span class="n">imm5</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf8</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">=</span> <span class="n">pc</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">imm5</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_simulate_it</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * The 8 IT state bits are split into two parts in CPSR:</span>
<span class="cm">	 *	ITSTATE&lt;1:0&gt; are in CPSR&lt;26:25&gt;</span>
<span class="cm">	 *	ITSTATE&lt;7:2&gt; are in CPSR&lt;15:10&gt;</span>
<span class="cm">	 * The new IT state is in the lower byte of insn.</span>
<span class="cm">	 */</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpsr</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span><span class="p">;</span>
	<span class="n">cpsr</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PSR_IT_MASK</span><span class="p">;</span>
	<span class="n">cpsr</span> <span class="o">|=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xfc</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">cpsr</span> <span class="o">|=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">=</span> <span class="n">cpsr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_singlestep_it</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">t16_simulate_it</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">enum</span> <span class="n">kprobe_insn</span> <span class="n">__kprobes</span>
<span class="nf">t16_decode_it</span><span class="p">(</span><span class="n">kprobe_opcode_t</span> <span class="n">insn</span><span class="p">,</span> <span class="k">struct</span> <span class="n">arch_specific_insn</span> <span class="o">*</span><span class="n">asi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_singlestep</span> <span class="o">=</span> <span class="n">t16_singlestep_it</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">INSN_GOOD_NO_SLOT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_simulate_cond_branch</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="kt">long</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">;</span>
	<span class="n">offset</span> <span class="o">-=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">;</span> <span class="cm">/* Apply sign bit */</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">=</span> <span class="n">pc</span> <span class="o">+</span> <span class="p">(</span><span class="n">offset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">enum</span> <span class="n">kprobe_insn</span> <span class="n">__kprobes</span>
<span class="nf">t16_decode_cond_branch</span><span class="p">(</span><span class="n">kprobe_opcode_t</span> <span class="n">insn</span><span class="p">,</span> <span class="k">struct</span> <span class="n">arch_specific_insn</span> <span class="o">*</span><span class="n">asi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">cc</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_check_cc</span> <span class="o">=</span> <span class="n">kprobe_condition_checks</span><span class="p">[</span><span class="n">cc</span><span class="p">];</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_handler</span> <span class="o">=</span> <span class="n">t16_simulate_cond_branch</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">INSN_GOOD_NO_SLOT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_simulate_branch</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="kt">long</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x3ff</span><span class="p">;</span>
	<span class="n">offset</span> <span class="o">-=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x400</span><span class="p">;</span> <span class="cm">/* Apply sign bit */</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">=</span> <span class="n">pc</span> <span class="o">+</span> <span class="p">(</span><span class="n">offset</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__kprobes</span>
<span class="nf">t16_emulate_loregs</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">oldcpsr</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">newcpsr</span><span class="p">;</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;msr	cpsr_fs, %[oldcpsr]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;ldmia	%[regs], {r0-r7}	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;blx	%[fn]			</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;stmia	%[regs], {r0-r7}	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;mrs	%[newcpsr], cpsr	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="o">:</span> <span class="p">[</span><span class="n">newcpsr</span><span class="p">]</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">newcpsr</span><span class="p">)</span>
		<span class="o">:</span> <span class="p">[</span><span class="n">oldcpsr</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">oldcpsr</span><span class="p">),</span> <span class="p">[</span><span class="n">regs</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">regs</span><span class="p">),</span>
		  <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;r0&quot;</span><span class="p">,</span> <span class="s">&quot;r1&quot;</span><span class="p">,</span> <span class="s">&quot;r2&quot;</span><span class="p">,</span> <span class="s">&quot;r3&quot;</span><span class="p">,</span> <span class="s">&quot;r4&quot;</span><span class="p">,</span> <span class="s">&quot;r5&quot;</span><span class="p">,</span> <span class="s">&quot;r6&quot;</span><span class="p">,</span> <span class="s">&quot;r7&quot;</span><span class="p">,</span>
		  <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
		<span class="p">);</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">oldcpsr</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">APSR_MASK</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">newcpsr</span> <span class="o">&amp;</span> <span class="n">APSR_MASK</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_emulate_loregs_rwflags</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">=</span> <span class="n">t16_emulate_loregs</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_emulate_loregs_noitrwflags</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpsr</span> <span class="o">=</span> <span class="n">t16_emulate_loregs</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">in_it_block</span><span class="p">(</span><span class="n">cpsr</span><span class="p">))</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">=</span> <span class="n">cpsr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_emulate_hiregs</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">thumb_probe_pc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">rdn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">);</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpsr</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span><span class="p">;</span>

	<span class="n">rdnv</span> <span class="o">=</span> <span class="p">(</span><span class="n">rdn</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">?</span> <span class="n">pc</span> <span class="o">:</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rdn</span><span class="p">];</span>
	<span class="n">rmv</span> <span class="o">=</span> <span class="p">(</span><span class="n">rm</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">?</span> <span class="n">pc</span> <span class="o">:</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;msr	cpsr_fs, %[cpsr]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;blx    %[fn]			</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;mrs	%[cpsr], cpsr		</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdnv</span><span class="p">),</span> <span class="p">[</span><span class="n">cpsr</span><span class="p">]</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rdnv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span> <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rdn</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span>
		<span class="n">rdnv</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rdn</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdnv</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">=</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">APSR_MASK</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cpsr</span> <span class="o">&amp;</span> <span class="n">APSR_MASK</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">enum</span> <span class="n">kprobe_insn</span> <span class="n">__kprobes</span>
<span class="nf">t16_decode_hiregs</span><span class="p">(</span><span class="n">kprobe_opcode_t</span> <span class="n">insn</span><span class="p">,</span> <span class="k">struct</span> <span class="n">arch_specific_insn</span> <span class="o">*</span><span class="n">asi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">insn</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x00ff</span><span class="p">;</span>
	<span class="n">insn</span> <span class="o">|=</span> <span class="mh">0x001</span><span class="p">;</span> <span class="cm">/* Set Rdn = R1 and Rm = R0 */</span>
	<span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span><span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">insn</span><span class="p">;</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_handler</span> <span class="o">=</span> <span class="n">t16_emulate_hiregs</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">INSN_GOOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_emulate_push</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;ldr	r9, [%[regs], #13*4]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;ldr	r8, [%[regs], #14*4]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;ldmia	%[regs], {r0-r7}	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;blx	%[fn]			</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;str	r9, [%[regs], #13*4]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="o">:</span>
		<span class="o">:</span> <span class="p">[</span><span class="n">regs</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">regs</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;r0&quot;</span><span class="p">,</span> <span class="s">&quot;r1&quot;</span><span class="p">,</span> <span class="s">&quot;r2&quot;</span><span class="p">,</span> <span class="s">&quot;r3&quot;</span><span class="p">,</span> <span class="s">&quot;r4&quot;</span><span class="p">,</span> <span class="s">&quot;r5&quot;</span><span class="p">,</span> <span class="s">&quot;r6&quot;</span><span class="p">,</span> <span class="s">&quot;r7&quot;</span><span class="p">,</span> <span class="s">&quot;r8&quot;</span><span class="p">,</span> <span class="s">&quot;r9&quot;</span><span class="p">,</span>
		  <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
		<span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">enum</span> <span class="n">kprobe_insn</span> <span class="n">__kprobes</span>
<span class="nf">t16_decode_push</span><span class="p">(</span><span class="n">kprobe_opcode_t</span> <span class="n">insn</span><span class="p">,</span> <span class="k">struct</span> <span class="n">arch_specific_insn</span> <span class="o">*</span><span class="n">asi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * To simulate a PUSH we use a Thumb-2 &quot;STMDB R9!, {registers}&quot;</span>
<span class="cm">	 * and call it with R9=SP and LR in the register list represented</span>
<span class="cm">	 * by R8.</span>
<span class="cm">	 */</span>
	<span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span><span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xe929</span><span class="p">;</span>		<span class="cm">/* 1st half STMDB R9!,{} */</span>
	<span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span><span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x1ff</span><span class="p">;</span>	<span class="cm">/* 2nd half (register list) */</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_handler</span> <span class="o">=</span> <span class="n">t16_emulate_push</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">INSN_GOOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_emulate_pop_nopc</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;ldr	r9, [%[regs], #13*4]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;ldmia	%[regs], {r0-r7}	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;blx	%[fn]			</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;stmia	%[regs], {r0-r7}	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;str	r9, [%[regs], #13*4]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="o">:</span>
		<span class="o">:</span> <span class="p">[</span><span class="n">regs</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">regs</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;r0&quot;</span><span class="p">,</span> <span class="s">&quot;r1&quot;</span><span class="p">,</span> <span class="s">&quot;r2&quot;</span><span class="p">,</span> <span class="s">&quot;r3&quot;</span><span class="p">,</span> <span class="s">&quot;r4&quot;</span><span class="p">,</span> <span class="s">&quot;r5&quot;</span><span class="p">,</span> <span class="s">&quot;r6&quot;</span><span class="p">,</span> <span class="s">&quot;r7&quot;</span><span class="p">,</span> <span class="s">&quot;r9&quot;</span><span class="p">,</span>
		  <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
		<span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">t16_emulate_pop_pc</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r8&quot;</span><span class="p">);</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;ldr	r9, [%[regs], #13*4]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;ldmia	%[regs], {r0-r7}	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;blx	%[fn]			</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;stmia	%[regs], {r0-r7}	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;str	r9, [%[regs], #13*4]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">pc</span><span class="p">)</span>
		<span class="o">:</span> <span class="p">[</span><span class="n">regs</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">regs</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;r0&quot;</span><span class="p">,</span> <span class="s">&quot;r1&quot;</span><span class="p">,</span> <span class="s">&quot;r2&quot;</span><span class="p">,</span> <span class="s">&quot;r3&quot;</span><span class="p">,</span> <span class="s">&quot;r4&quot;</span><span class="p">,</span> <span class="s">&quot;r5&quot;</span><span class="p">,</span> <span class="s">&quot;r6&quot;</span><span class="p">,</span> <span class="s">&quot;r7&quot;</span><span class="p">,</span> <span class="s">&quot;r9&quot;</span><span class="p">,</span>
		  <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
		<span class="p">);</span>

	<span class="n">bx_write_pc</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">enum</span> <span class="n">kprobe_insn</span> <span class="n">__kprobes</span>
<span class="nf">t16_decode_pop</span><span class="p">(</span><span class="n">kprobe_opcode_t</span> <span class="n">insn</span><span class="p">,</span> <span class="k">struct</span> <span class="n">arch_specific_insn</span> <span class="o">*</span><span class="n">asi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * To simulate a POP we use a Thumb-2 &quot;LDMDB R9!, {registers}&quot;</span>
<span class="cm">	 * and call it with R9=SP and PC in the register list represented</span>
<span class="cm">	 * by R8.</span>
<span class="cm">	 */</span>
	<span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span><span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xe8b9</span><span class="p">;</span>		<span class="cm">/* 1st half LDMIA R9!,{} */</span>
	<span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span><span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x1ff</span><span class="p">;</span>	<span class="cm">/* 2nd half (register list) */</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_handler</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0x100</span> <span class="o">?</span> <span class="n">t16_emulate_pop_pc</span>
					 <span class="o">:</span> <span class="n">t16_emulate_pop_nopc</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">INSN_GOOD</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">t16_table_1011</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Miscellaneous 16-bit instructions		    */</span>

	<span class="cm">/* ADD (SP plus immediate)	1011 0000 0xxx xxxx */</span>
	<span class="cm">/* SUB (SP minus immediate)	1011 0000 1xxx xxxx */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xff00</span><span class="p">,</span> <span class="mh">0xb000</span><span class="p">,</span> <span class="n">t16_simulate_add_sp_imm</span><span class="p">),</span>

	<span class="cm">/* CBZ				1011 00x1 xxxx xxxx */</span>
	<span class="cm">/* CBNZ				1011 10x1 xxxx xxxx */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xf500</span><span class="p">,</span> <span class="mh">0xb100</span><span class="p">,</span> <span class="n">t16_simulate_cbz</span><span class="p">),</span>

	<span class="cm">/* SXTH				1011 0010 00xx xxxx */</span>
	<span class="cm">/* SXTB				1011 0010 01xx xxxx */</span>
	<span class="cm">/* UXTH				1011 0010 10xx xxxx */</span>
	<span class="cm">/* UXTB				1011 0010 11xx xxxx */</span>
	<span class="cm">/* REV				1011 1010 00xx xxxx */</span>
	<span class="cm">/* REV16			1011 1010 01xx xxxx */</span>
	<span class="cm">/* ???				1011 1010 10xx xxxx */</span>
	<span class="cm">/* REVSH			1011 1010 11xx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xffc0</span><span class="p">,</span> <span class="mh">0xba80</span><span class="p">),</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0xf500</span><span class="p">,</span> <span class="mh">0xb000</span><span class="p">,</span> <span class="n">t16_emulate_loregs_rwflags</span><span class="p">),</span>

	<span class="cm">/* PUSH				1011 010x xxxx xxxx */</span>
	<span class="n">DECODE_CUSTOM</span>	<span class="p">(</span><span class="mh">0xfe00</span><span class="p">,</span> <span class="mh">0xb400</span><span class="p">,</span> <span class="n">t16_decode_push</span><span class="p">),</span>
	<span class="cm">/* POP				1011 110x xxxx xxxx */</span>
	<span class="n">DECODE_CUSTOM</span>	<span class="p">(</span><span class="mh">0xfe00</span><span class="p">,</span> <span class="mh">0xbc00</span><span class="p">,</span> <span class="n">t16_decode_pop</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * If-Then, and hints</span>
<span class="cm">	 *				1011 1111 xxxx xxxx</span>
<span class="cm">	 */</span>

	<span class="cm">/* YIELD			1011 1111 0001 0000 */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0xffff</span><span class="p">,</span> <span class="mh">0xbf10</span><span class="p">),</span>
	<span class="cm">/* SEV				1011 1111 0100 0000 */</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0xffff</span><span class="p">,</span> <span class="mh">0xbf40</span><span class="p">,</span> <span class="n">kprobe_emulate_none</span><span class="p">),</span>
	<span class="cm">/* NOP				1011 1111 0000 0000 */</span>
	<span class="cm">/* WFE				1011 1111 0010 0000 */</span>
	<span class="cm">/* WFI				1011 1111 0011 0000 */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xffcf</span><span class="p">,</span> <span class="mh">0xbf00</span><span class="p">,</span> <span class="n">kprobe_simulate_nop</span><span class="p">),</span>
	<span class="cm">/* Unassigned hints		1011 1111 xxxx 0000 */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xff0f</span><span class="p">,</span> <span class="mh">0xbf00</span><span class="p">),</span>
	<span class="cm">/* IT				1011 1111 xxxx xxxx */</span>
	<span class="n">DECODE_CUSTOM</span>	<span class="p">(</span><span class="mh">0xff00</span><span class="p">,</span> <span class="mh">0xbf00</span><span class="p">,</span> <span class="n">t16_decode_it</span><span class="p">),</span>

	<span class="cm">/* SETEND			1011 0110 010x xxxx */</span>
	<span class="cm">/* CPS				1011 0110 011x xxxx */</span>
	<span class="cm">/* BKPT				1011 1110 xxxx xxxx */</span>
	<span class="cm">/* And unallocated instructions...		    */</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">kprobe_decode_thumb16_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

	<span class="cm">/*</span>
<span class="cm">	 * Shift (immediate), add, subtract, move, and compare</span>
<span class="cm">	 *				00xx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>

	<span class="cm">/* CMP (immediate)		0010 1xxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x2800</span><span class="p">,</span> <span class="n">t16_emulate_loregs_rwflags</span><span class="p">),</span>

	<span class="cm">/* ADD (register)		0001 100x xxxx xxxx */</span>
	<span class="cm">/* SUB (register)		0001 101x xxxx xxxx */</span>
	<span class="cm">/* LSL (immediate)		0000 0xxx xxxx xxxx */</span>
	<span class="cm">/* LSR (immediate)		0000 1xxx xxxx xxxx */</span>
	<span class="cm">/* ASR (immediate)		0001 0xxx xxxx xxxx */</span>
	<span class="cm">/* ADD (immediate, Thumb)	0001 110x xxxx xxxx */</span>
	<span class="cm">/* SUB (immediate, Thumb)	0001 111x xxxx xxxx */</span>
	<span class="cm">/* MOV (immediate)		0010 0xxx xxxx xxxx */</span>
	<span class="cm">/* ADD (immediate, Thumb)	0011 0xxx xxxx xxxx */</span>
	<span class="cm">/* SUB (immediate, Thumb)	0011 1xxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0xc000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="n">t16_emulate_loregs_noitrwflags</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * 16-bit Thumb data-processing instructions</span>
<span class="cm">	 *				0100 00xx xxxx xxxx</span>
<span class="cm">	 */</span>

	<span class="cm">/* TST (register)		0100 0010 00xx xxxx */</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0xffc0</span><span class="p">,</span> <span class="mh">0x4200</span><span class="p">,</span> <span class="n">t16_emulate_loregs_rwflags</span><span class="p">),</span>
	<span class="cm">/* CMP (register)		0100 0010 10xx xxxx */</span>
	<span class="cm">/* CMN (register)		0100 0010 11xx xxxx */</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0xff80</span><span class="p">,</span> <span class="mh">0x4280</span><span class="p">,</span> <span class="n">t16_emulate_loregs_rwflags</span><span class="p">),</span>
	<span class="cm">/* AND (register)		0100 0000 00xx xxxx */</span>
	<span class="cm">/* EOR (register)		0100 0000 01xx xxxx */</span>
	<span class="cm">/* LSL (register)		0100 0000 10xx xxxx */</span>
	<span class="cm">/* LSR (register)		0100 0000 11xx xxxx */</span>
	<span class="cm">/* ASR (register)		0100 0001 00xx xxxx */</span>
	<span class="cm">/* ADC (register)		0100 0001 01xx xxxx */</span>
	<span class="cm">/* SBC (register)		0100 0001 10xx xxxx */</span>
	<span class="cm">/* ROR (register)		0100 0001 11xx xxxx */</span>
	<span class="cm">/* RSB (immediate)		0100 0010 01xx xxxx */</span>
	<span class="cm">/* ORR (register)		0100 0011 00xx xxxx */</span>
	<span class="cm">/* MUL				0100 0011 00xx xxxx */</span>
	<span class="cm">/* BIC (register)		0100 0011 10xx xxxx */</span>
	<span class="cm">/* MVN (register)		0100 0011 10xx xxxx */</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0xfc00</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="n">t16_emulate_loregs_noitrwflags</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Special data instructions and branch and exchange</span>
<span class="cm">	 *				0100 01xx xxxx xxxx</span>
<span class="cm">	 */</span>

	<span class="cm">/* BLX pc			0100 0111 1111 1xxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfff8</span><span class="p">,</span> <span class="mh">0x47f8</span><span class="p">),</span>

	<span class="cm">/* BX (register)		0100 0111 0xxx xxxx */</span>
	<span class="cm">/* BLX (register)		0100 0111 1xxx xxxx */</span>
	<span class="n">DECODE_SIMULATE</span> <span class="p">(</span><span class="mh">0xff00</span><span class="p">,</span> <span class="mh">0x4700</span><span class="p">,</span> <span class="n">t16_simulate_bxblx</span><span class="p">),</span>

	<span class="cm">/* ADD pc, pc			0100 0100 1111 1111 */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xffff</span><span class="p">,</span> <span class="mh">0x44ff</span><span class="p">),</span>

	<span class="cm">/* ADD (register)		0100 0100 xxxx xxxx */</span>
	<span class="cm">/* CMP (register)		0100 0101 xxxx xxxx */</span>
	<span class="cm">/* MOV (register)		0100 0110 xxxx xxxx */</span>
	<span class="n">DECODE_CUSTOM</span>	<span class="p">(</span><span class="mh">0xfc00</span><span class="p">,</span> <span class="mh">0x4400</span><span class="p">,</span> <span class="n">t16_decode_hiregs</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Load from Literal Pool</span>
<span class="cm">	 * LDR (literal)		0100 1xxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x4800</span><span class="p">,</span> <span class="n">t16_simulate_ldr_literal</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * 16-bit Thumb Load/store instructions</span>
<span class="cm">	 *				0101 xxxx xxxx xxxx</span>
<span class="cm">	 *				011x xxxx xxxx xxxx</span>
<span class="cm">	 *				100x xxxx xxxx xxxx</span>
<span class="cm">	 */</span>

	<span class="cm">/* STR (register)		0101 000x xxxx xxxx */</span>
	<span class="cm">/* STRH (register)		0101 001x xxxx xxxx */</span>
	<span class="cm">/* STRB (register)		0101 010x xxxx xxxx */</span>
	<span class="cm">/* LDRSB (register)		0101 011x xxxx xxxx */</span>
	<span class="cm">/* LDR (register)		0101 100x xxxx xxxx */</span>
	<span class="cm">/* LDRH (register)		0101 101x xxxx xxxx */</span>
	<span class="cm">/* LDRB (register)		0101 110x xxxx xxxx */</span>
	<span class="cm">/* LDRSH (register)		0101 111x xxxx xxxx */</span>
	<span class="cm">/* STR (immediate, Thumb)	0110 0xxx xxxx xxxx */</span>
	<span class="cm">/* LDR (immediate, Thumb)	0110 1xxx xxxx xxxx */</span>
	<span class="cm">/* STRB (immediate, Thumb)	0111 0xxx xxxx xxxx */</span>
	<span class="cm">/* LDRB (immediate, Thumb)	0111 1xxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0xc000</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="n">t16_emulate_loregs_rwflags</span><span class="p">),</span>
	<span class="cm">/* STRH (immediate, Thumb)	1000 0xxx xxxx xxxx */</span>
	<span class="cm">/* LDRH (immediate, Thumb)	1000 1xxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0xf000</span><span class="p">,</span> <span class="mh">0x8000</span><span class="p">,</span> <span class="n">t16_emulate_loregs_rwflags</span><span class="p">),</span>
	<span class="cm">/* STR (immediate, Thumb)	1001 0xxx xxxx xxxx */</span>
	<span class="cm">/* LDR (immediate, Thumb)	1001 1xxx xxxx xxxx */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xf000</span><span class="p">,</span> <span class="mh">0x9000</span><span class="p">,</span> <span class="n">t16_simulate_ldrstr_sp_relative</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Generate PC-/SP-relative address</span>
<span class="cm">	 * ADR (literal)		1010 0xxx xxxx xxxx</span>
<span class="cm">	 * ADD (SP plus immediate)	1010 1xxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xf000</span><span class="p">,</span> <span class="mh">0xa000</span><span class="p">,</span> <span class="n">t16_simulate_reladr</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Miscellaneous 16-bit instructions</span>
<span class="cm">	 *				1011 xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xf000</span><span class="p">,</span> <span class="mh">0xb000</span><span class="p">,</span> <span class="n">t16_table_1011</span><span class="p">),</span>

	<span class="cm">/* STM				1100 0xxx xxxx xxxx */</span>
	<span class="cm">/* LDM				1100 1xxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0xf000</span><span class="p">,</span> <span class="mh">0xc000</span><span class="p">,</span> <span class="n">t16_emulate_loregs_rwflags</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Conditional branch, and Supervisor Call</span>
<span class="cm">	 */</span>

	<span class="cm">/* Permanently UNDEFINED	1101 1110 xxxx xxxx */</span>
	<span class="cm">/* SVC				1101 1111 xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0xfe00</span><span class="p">,</span> <span class="mh">0xde00</span><span class="p">),</span>

	<span class="cm">/* Conditional branch		1101 xxxx xxxx xxxx */</span>
	<span class="n">DECODE_CUSTOM</span>	<span class="p">(</span><span class="mh">0xf000</span><span class="p">,</span> <span class="mh">0xd000</span><span class="p">,</span> <span class="n">t16_decode_cond_branch</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Unconditional branch</span>
<span class="cm">	 * B				1110 0xxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0xe000</span><span class="p">,</span> <span class="n">t16_simulate_branch</span><span class="p">),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>
<span class="cp">#ifdef CONFIG_ARM_KPROBES_TEST_MODULE</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">kprobe_decode_thumb16_table</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__kprobes</span> <span class="nf">thumb_check_cc</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpsr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">in_it_block</span><span class="p">(</span><span class="n">cpsr</span><span class="p">)))</span>
		<span class="k">return</span> <span class="n">kprobe_condition_checks</span><span class="p">[</span><span class="n">current_cond</span><span class="p">(</span><span class="n">cpsr</span><span class="p">)](</span><span class="n">cpsr</span><span class="p">);</span>
	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span> <span class="nf">thumb16_singlestep</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_handler</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">=</span> <span class="n">it_advance</span><span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span> <span class="nf">thumb32_singlestep</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_handler</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">=</span> <span class="n">it_advance</span><span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="n">kprobe_insn</span> <span class="n">__kprobes</span>
<span class="nf">thumb16_kprobe_decode_insn</span><span class="p">(</span><span class="n">kprobe_opcode_t</span> <span class="n">insn</span><span class="p">,</span> <span class="k">struct</span> <span class="n">arch_specific_insn</span> <span class="o">*</span><span class="n">asi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_singlestep</span> <span class="o">=</span> <span class="n">thumb16_singlestep</span><span class="p">;</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_check_cc</span> <span class="o">=</span> <span class="n">thumb_check_cc</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">kprobe_decode_insn</span><span class="p">(</span><span class="n">insn</span><span class="p">,</span> <span class="n">asi</span><span class="p">,</span> <span class="n">kprobe_decode_thumb16_table</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="n">kprobe_insn</span> <span class="n">__kprobes</span>
<span class="nf">thumb32_kprobe_decode_insn</span><span class="p">(</span><span class="n">kprobe_opcode_t</span> <span class="n">insn</span><span class="p">,</span> <span class="k">struct</span> <span class="n">arch_specific_insn</span> <span class="o">*</span><span class="n">asi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_singlestep</span> <span class="o">=</span> <span class="n">thumb32_singlestep</span><span class="p">;</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_check_cc</span> <span class="o">=</span> <span class="n">thumb_check_cc</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">kprobe_decode_insn</span><span class="p">(</span><span class="n">insn</span><span class="p">,</span> <span class="n">asi</span><span class="p">,</span> <span class="n">kprobe_decode_thumb32_table</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
