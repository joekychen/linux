<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › kernel › kprobes-arm.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>kprobes-arm.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * arch/arm/kernel/kprobes-decode.c</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2006, 2007 Motorola Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> * General Public License for more details.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * We do not have hardware single-stepping on ARM, This</span>
<span class="cm"> * effort is further complicated by the ARM not having a</span>
<span class="cm"> * &quot;next PC&quot; register.  Instructions that change the PC</span>
<span class="cm"> * can&#39;t be safely single-stepped in a MP environment, so</span>
<span class="cm"> * we have a lot of work to do:</span>
<span class="cm"> *</span>
<span class="cm"> * In the prepare phase:</span>
<span class="cm"> *   *) If it is an instruction that does anything</span>
<span class="cm"> *      with the CPU mode, we reject it for a kprobe.</span>
<span class="cm"> *      (This is out of laziness rather than need.  The</span>
<span class="cm"> *      instructions could be simulated.)</span>
<span class="cm"> *</span>
<span class="cm"> *   *) Otherwise, decode the instruction rewriting its</span>
<span class="cm"> *      registers to take fixed, ordered registers and</span>
<span class="cm"> *      setting a handler for it to run the instruction.</span>
<span class="cm"> *</span>
<span class="cm"> * In the execution phase by an instruction&#39;s handler:</span>
<span class="cm"> *</span>
<span class="cm"> *   *) If the PC is written to by the instruction, the</span>
<span class="cm"> *      instruction must be fully simulated in software.</span>
<span class="cm"> *</span>
<span class="cm"> *   *) Otherwise, a modified form of the instruction is</span>
<span class="cm"> *      directly executed.  Its handler calls the</span>
<span class="cm"> *      instruction in insn[0].  In insn[1] is a</span>
<span class="cm"> *      &quot;mov pc, lr&quot; to return.</span>
<span class="cm"> *</span>
<span class="cm"> *      Before calling, load up the reordered registers</span>
<span class="cm"> *      from the original instruction&#39;s registers.  If one</span>
<span class="cm"> *      of the original input registers is the PC, compute</span>
<span class="cm"> *      and adjust the appropriate input register.</span>
<span class="cm"> *</span>
<span class="cm"> *	After call completes, copy the output registers to</span>
<span class="cm"> *      the original instruction&#39;s original registers.</span>
<span class="cm"> *</span>
<span class="cm"> * We don&#39;t use a real breakpoint instruction since that</span>
<span class="cm"> * would have us in the kernel go from SVC mode to SVC</span>
<span class="cm"> * mode losing the link register.  Instead we use an</span>
<span class="cm"> * undefined instruction.  To simplify processing, the</span>
<span class="cm"> * undefined instruction used for kprobes must be reserved</span>
<span class="cm"> * exclusively for kprobes use.</span>
<span class="cm"> *</span>
<span class="cm"> * TODO: ifdef out some instruction decoding based on architecture.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/kprobes.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>

<span class="cp">#include &quot;kprobes.h&quot;</span>

<span class="cp">#define sign_extend(x, signbit) ((x) | (0 - ((x) &amp; (1 &lt;&lt; (signbit)))))</span>

<span class="cp">#define branch_displacement(insn) sign_extend(((insn) &amp; 0xffffff) &lt;&lt; 2, 25)</span>

<span class="cp">#if  __LINUX_ARM_ARCH__ &gt;= 6</span>
<span class="cp">#define BLX(reg)	&quot;blx	&quot;reg&quot;		\n\t&quot;</span>
<span class="cp">#else</span>
<span class="cp">#define BLX(reg)	&quot;mov	lr, pc		\n\t&quot;	\</span>
<span class="cp">			&quot;mov	pc, &quot;reg&quot;	\n\t&quot;</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * To avoid the complications of mimicing single-stepping on a</span>
<span class="cm"> * processor without a Next-PC or a single-step mode, and to</span>
<span class="cm"> * avoid having to deal with the side-effects of boosting, we</span>
<span class="cm"> * simulate or emulate (almost) all ARM instructions.</span>
<span class="cm"> *</span>
<span class="cm"> * &quot;Simulation&quot; is where the instruction&#39;s behavior is duplicated in</span>
<span class="cm"> * C code.  &quot;Emulation&quot; is where the original instruction is rewritten</span>
<span class="cm"> * and executed, often by altering its registers.</span>
<span class="cm"> *</span>
<span class="cm"> * By having all behavior of the kprobe&#39;d instruction completed before</span>
<span class="cm"> * returning from the kprobe_handler(), all locks (scheduler and</span>
<span class="cm"> * interrupt) can safely be released.  There is no need for secondary</span>
<span class="cm"> * breakpoints, no race with MP or preemptable kernels, nor having to</span>
<span class="cm"> * clean up resources counts at a later time impacting overall system</span>
<span class="cm"> * performance.  By rewriting the instruction, only the minimum registers</span>
<span class="cm"> * need to be loaded and saved back optimizing performance.</span>
<span class="cm"> *</span>
<span class="cm"> * Calling the insnslot_*_rwflags version of a function doesn&#39;t hurt</span>
<span class="cm"> * anything even when the CPSR flags aren&#39;t updated by the</span>
<span class="cm"> * instruction.  It&#39;s just a little slower in return for saving</span>
<span class="cm"> * a little space by not having a duplicate function that doesn&#39;t</span>
<span class="cm"> * update the flags.  (The same optimization can be said for</span>
<span class="cm"> * instructions that do or don&#39;t perform register writeback)</span>
<span class="cm"> * Also, instructions can either read the flags, only write the</span>
<span class="cm"> * flags, or read and write the flags.  To save combinations</span>
<span class="cm"> * rather than for sheer performance, flag functions just assume</span>
<span class="cm"> * read and write of flags.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span> <span class="nf">simulate_bbl</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">iaddr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">disp</span>  <span class="o">=</span> <span class="n">branch_displacement</span><span class="p">(</span><span class="n">insn</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">))</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_lr</span> <span class="o">=</span> <span class="n">iaddr</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">=</span> <span class="n">iaddr</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">disp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span> <span class="nf">simulate_blx1</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">iaddr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">disp</span> <span class="o">=</span> <span class="n">branch_displacement</span><span class="p">(</span><span class="n">insn</span><span class="p">);</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_lr</span> <span class="o">=</span> <span class="n">iaddr</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">=</span> <span class="n">iaddr</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">disp</span> <span class="o">+</span> <span class="p">((</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">23</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">);</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">|=</span> <span class="n">PSR_T_BIT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span> <span class="nf">simulate_blx2bx</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">rmv</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">))</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_lr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">=</span> <span class="n">rmv</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x1</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">PSR_T_BIT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rmv</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">|=</span> <span class="n">PSR_T_BIT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span> <span class="nf">simulate_mrs</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xf8ff03df</span><span class="p">;</span> <span class="cm">/* Mask out execution state */</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span> <span class="nf">simulate_mov_ipsp</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">emulate_ldrdstrd</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rtv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rt2v</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">rn</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">?</span> <span class="n">pc</span>
							  <span class="o">:</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="n">BLX</span><span class="p">(</span><span class="s">&quot;%[fn]&quot;</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rtv</span><span class="p">),</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rt2v</span><span class="p">),</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rtv</span><span class="p">),</span> <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">rt2v</span><span class="p">),</span> <span class="s">&quot;2&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span>
		  <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">=</span> <span class="n">rtv</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rt2v</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">is_writeback</span><span class="p">(</span><span class="n">insn</span><span class="p">))</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">]</span> <span class="o">=</span> <span class="n">rnv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">emulate_ldr</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rtv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">);</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">rn</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">?</span> <span class="n">pc</span>
							  <span class="o">:</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="n">BLX</span><span class="p">(</span><span class="s">&quot;%[fn]&quot;</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rtv</span><span class="p">),</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rt</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span>
		<span class="n">load_write_pc</span><span class="p">(</span><span class="n">rtv</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span> <span class="o">=</span> <span class="n">rtv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">is_writeback</span><span class="p">(</span><span class="n">insn</span><span class="p">))</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">]</span> <span class="o">=</span> <span class="n">rnv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">emulate_str</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rtpc</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">addr</span> <span class="o">+</span> <span class="n">str_pc_offset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnpc</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rtv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">rt</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">?</span> <span class="n">rtpc</span>
							  <span class="o">:</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rt</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">rn</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">?</span> <span class="n">rnpc</span>
							  <span class="o">:</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="n">BLX</span><span class="p">(</span><span class="s">&quot;%[fn]&quot;</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rtv</span><span class="p">),</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">is_writeback</span><span class="p">(</span><span class="n">insn</span><span class="p">))</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">]</span> <span class="o">=</span> <span class="n">rnv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">emulate_rd12rn16rm0rs8_rwflags</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rs</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">rn</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">?</span> <span class="n">pc</span>
							  <span class="o">:</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">rm</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">?</span> <span class="n">pc</span>
							  <span class="o">:</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rsv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rs</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpsr</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span><span class="p">;</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;msr	cpsr_fs, %[cpsr]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="n">BLX</span><span class="p">(</span><span class="s">&quot;%[fn]&quot;</span><span class="p">)</span>
		<span class="s">&quot;mrs	%[cpsr], cpsr		</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">),</span> <span class="p">[</span><span class="n">cpsr</span><span class="p">]</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rsv</span><span class="p">),</span>
		  <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rd</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span>
		<span class="n">alu_write_pc</span><span class="p">(</span><span class="n">rdv</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdv</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">=</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">APSR_MASK</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cpsr</span> <span class="o">&amp;</span> <span class="n">APSR_MASK</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">emulate_rd12rn16rm0_rwflags_nopc</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpsr</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span><span class="p">;</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;msr	cpsr_fs, %[cpsr]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="n">BLX</span><span class="p">(</span><span class="s">&quot;%[fn]&quot;</span><span class="p">)</span>
		<span class="s">&quot;mrs	%[cpsr], cpsr		</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">),</span> <span class="p">[</span><span class="n">cpsr</span><span class="p">]</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span>
		  <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdv</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">=</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">APSR_MASK</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cpsr</span> <span class="o">&amp;</span> <span class="n">APSR_MASK</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">emulate_rd16rn12rm0rs8_rwflags_nopc</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rs</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rsv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rs</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpsr</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span><span class="p">;</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;msr	cpsr_fs, %[cpsr]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="n">BLX</span><span class="p">(</span><span class="s">&quot;%[fn]&quot;</span><span class="p">)</span>
		<span class="s">&quot;mrs	%[cpsr], cpsr		</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">),</span> <span class="p">[</span><span class="n">cpsr</span><span class="p">]</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rsv</span><span class="p">),</span>
		  <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdv</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">=</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">APSR_MASK</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cpsr</span> <span class="o">&amp;</span> <span class="n">APSR_MASK</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">emulate_rd12rm0_noflags_nopc</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rd</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="n">BLX</span><span class="p">(</span><span class="s">&quot;%[fn]&quot;</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rdv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rd</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span>
<span class="nf">emulate_rdlo12rdhi16rn0rm8_rwflags_nopc</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kprobe_opcode_t</span> <span class="n">insn</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rdlo</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rdhi</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rn</span> <span class="o">=</span> <span class="n">insn</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rm</span> <span class="o">=</span> <span class="p">(</span><span class="n">insn</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdlov</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r0&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rdlo</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rdhiv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rdhi</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rnv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rn</span><span class="p">];</span>
	<span class="k">register</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rmv</span> <span class="n">asm</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rm</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpsr</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span><span class="p">;</span>

	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span>
		<span class="s">&quot;msr	cpsr_fs, %[cpsr]	</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="n">BLX</span><span class="p">(</span><span class="s">&quot;%[fn]&quot;</span><span class="p">)</span>
		<span class="s">&quot;mrs	%[cpsr], cpsr		</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdlov</span><span class="p">),</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">rdhiv</span><span class="p">),</span> <span class="p">[</span><span class="n">cpsr</span><span class="p">]</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">rdlov</span><span class="p">),</span> <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">rdhiv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rnv</span><span class="p">),</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">rmv</span><span class="p">),</span>
		  <span class="s">&quot;2&quot;</span> <span class="p">(</span><span class="n">cpsr</span><span class="p">),</span> <span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_fn</span><span class="p">)</span>
		<span class="o">:</span> <span class="s">&quot;lr&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span>
	<span class="p">);</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rdlo</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdlov</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">uregs</span><span class="p">[</span><span class="n">rdhi</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdhiv</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">=</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_cpsr</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">APSR_MASK</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cpsr</span> <span class="o">&amp;</span> <span class="n">APSR_MASK</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * For the instruction masking and comparisons in all the &quot;space_*&quot;</span>
<span class="cm"> * functions below, Do _not_ rearrange the order of tests unless</span>
<span class="cm"> * you&#39;re very, very sure of what you are doing.  For the sake of</span>
<span class="cm"> * efficiency, the masks for some tests sometimes assume other test</span>
<span class="cm"> * have been done prior to them so the number of patterns to test</span>
<span class="cm"> * for an instruction set can be as broad as possible to reduce the</span>
<span class="cm"> * number of tests needed.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_1111_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Unconditional instructions					*/</span>

	<span class="cm">/* memory hint		1111 0100 x001 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* PLDI (immediate)	1111 0100 x101 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* PLDW (immediate)	1111 0101 x001 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* PLD (immediate)	1111 0101 x101 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xfe300000</span><span class="p">,</span> <span class="mh">0xf4100000</span><span class="p">,</span> <span class="n">kprobe_simulate_nop</span><span class="p">),</span>

	<span class="cm">/* memory hint		1111 0110 x001 xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* PLDI (register)	1111 0110 x101 xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* PLDW (register)	1111 0111 x001 xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* PLD (register)	1111 0111 x101 xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xfe300010</span><span class="p">,</span> <span class="mh">0xf6100000</span><span class="p">,</span> <span class="n">kprobe_simulate_nop</span><span class="p">),</span>

	<span class="cm">/* BLX (immediate)	1111 101x xxxx xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xfe000000</span><span class="p">,</span> <span class="mh">0xfa000000</span><span class="p">,</span> <span class="n">simulate_blx1</span><span class="p">),</span>

	<span class="cm">/* CPS			1111 0001 0000 xxx0 xxxx xxxx xx0x xxxx */</span>
	<span class="cm">/* SETEND		1111 0001 0000 0001 xxxx xxxx 0000 xxxx */</span>
	<span class="cm">/* SRS			1111 100x x1x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* RFE			1111 100x x0x1 xxxx xxxx xxxx xxxx xxxx */</span>

	<span class="cm">/* Coprocessor instructions... */</span>
	<span class="cm">/* MCRR2		1111 1100 0100 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* MRRC2		1111 1100 0101 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDC2			1111 110x xxx1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* STC2			1111 110x xxx0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* CDP2			1111 1110 xxxx xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* MCR2			1111 1110 xxx0 xxxx xxxx xxxx xxx1 xxxx */</span>
	<span class="cm">/* MRC2			1111 1110 xxx1 xxxx xxxx xxxx xxx1 xxxx */</span>

	<span class="cm">/* Other unallocated instructions...				*/</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_cccc_0001_0xx0____0xxx_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Miscellaneous instructions					*/</span>

	<span class="cm">/* MRS cpsr		cccc 0001 0000 xxxx xxxx xxxx 0000 xxxx */</span>
	<span class="n">DECODE_SIMULATEX</span><span class="p">(</span><span class="mh">0x0ff000f0</span><span class="p">,</span> <span class="mh">0x01000000</span><span class="p">,</span> <span class="n">simulate_mrs</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* BX			cccc 0001 0010 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0x0ff000f0</span><span class="p">,</span> <span class="mh">0x01200010</span><span class="p">,</span> <span class="n">simulate_blx2bx</span><span class="p">),</span>

	<span class="cm">/* BLX (register)	cccc 0001 0010 xxxx xxxx xxxx 0011 xxxx */</span>
	<span class="n">DECODE_SIMULATEX</span><span class="p">(</span><span class="mh">0x0ff000f0</span><span class="p">,</span> <span class="mh">0x01200030</span><span class="p">,</span> <span class="n">simulate_blx2bx</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* CLZ			cccc 0001 0110 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0ff000f0</span><span class="p">,</span> <span class="mh">0x01600010</span><span class="p">,</span> <span class="n">emulate_rd12rm0_noflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* QADD			cccc 0001 0000 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="cm">/* QSUB			cccc 0001 0010 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="cm">/* QDADD		cccc 0001 0100 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="cm">/* QDSUB		cccc 0001 0110 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0f9000f0</span><span class="p">,</span> <span class="mh">0x01000050</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* BXJ			cccc 0001 0010 xxxx xxxx xxxx 0010 xxxx */</span>
	<span class="cm">/* MSR			cccc 0001 0x10 xxxx xxxx xxxx 0000 xxxx */</span>
	<span class="cm">/* MRS spsr		cccc 0001 0100 xxxx xxxx xxxx 0000 xxxx */</span>
	<span class="cm">/* BKPT			1110 0001 0010 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* SMC			cccc 0001 0110 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* And unallocated instructions...				*/</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_cccc_0001_0xx0____1xx0_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Halfword multiply and multiply-accumulate			*/</span>

	<span class="cm">/* SMLALxy		cccc 0001 0100 xxxx xxxx xxxx 1xx0 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0ff00090</span><span class="p">,</span> <span class="mh">0x01400080</span><span class="p">,</span> <span class="n">emulate_rdlo12rdhi16rn0rm8_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* SMULWy		cccc 0001 0010 xxxx xxxx xxxx 1x10 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0x0ff000b0</span><span class="p">,</span> <span class="mh">0x012000a0</span><span class="p">),</span>
	<span class="cm">/* SMULxy		cccc 0001 0110 xxxx xxxx xxxx 1xx0 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0ff00090</span><span class="p">,</span> <span class="mh">0x01600080</span><span class="p">,</span> <span class="n">emulate_rd16rn12rm0rs8_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* SMLAxy		cccc 0001 0000 xxxx xxxx xxxx 1xx0 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0x0ff00090</span><span class="p">,</span> <span class="mh">0x01000080</span><span class="p">),</span>
	<span class="cm">/* SMLAWy		cccc 0001 0010 xxxx xxxx xxxx 1x00 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0ff000b0</span><span class="p">,</span> <span class="mh">0x01200080</span><span class="p">,</span> <span class="n">emulate_rd16rn12rm0rs8_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_cccc_0000_____1001_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Multiply and multiply-accumulate				*/</span>

	<span class="cm">/* MUL			cccc 0000 0000 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* MULS			cccc 0000 0001 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0fe000f0</span><span class="p">,</span> <span class="mh">0x00000090</span><span class="p">,</span> <span class="n">emulate_rd16rn12rm0rs8_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* MLA			cccc 0000 0010 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* MLAS			cccc 0000 0011 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0x0fe000f0</span><span class="p">,</span> <span class="mh">0x00200090</span><span class="p">),</span>
	<span class="cm">/* MLS			cccc 0000 0110 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0ff000f0</span><span class="p">,</span> <span class="mh">0x00600090</span><span class="p">,</span> <span class="n">emulate_rd16rn12rm0rs8_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* UMAAL		cccc 0000 0100 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0x0ff000f0</span><span class="p">,</span> <span class="mh">0x00400090</span><span class="p">),</span>
	<span class="cm">/* UMULL		cccc 0000 1000 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* UMULLS		cccc 0000 1001 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* UMLAL		cccc 0000 1010 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* UMLALS		cccc 0000 1011 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* SMULL		cccc 0000 1100 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* SMULLS		cccc 0000 1101 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* SMLAL		cccc 0000 1110 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* SMLALS		cccc 0000 1111 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0f8000f0</span><span class="p">,</span> <span class="mh">0x00800090</span><span class="p">,</span> <span class="n">emulate_rdlo12rdhi16rn0rm8_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_cccc_0001_____1001_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Synchronization primitives					*/</span>

<span class="cp">#if __LINUX_ARM_ARCH__ &lt; 6</span>
	<span class="cm">/* Deprecated on ARMv6 and may be UNDEFINED on v7		*/</span>
	<span class="cm">/* SMP/SWPB		cccc 0001 0x00 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0fb000f0</span><span class="p">,</span> <span class="mh">0x01000090</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>
<span class="cp">#endif</span>
	<span class="cm">/* LDREX/STREX{,D,B,H}	cccc 0001 1xxx xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* And unallocated instructions...				*/</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_cccc_000x_____1xx1_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Extra load/store instructions				*/</span>

	<span class="cm">/* STRHT		cccc 0000 xx10 xxxx xxxx xxxx 1011 xxxx */</span>
	<span class="cm">/* ???			cccc 0000 xx10 xxxx xxxx xxxx 11x1 xxxx */</span>
	<span class="cm">/* LDRHT		cccc 0000 xx11 xxxx xxxx xxxx 1011 xxxx */</span>
	<span class="cm">/* LDRSBT		cccc 0000 xx11 xxxx xxxx xxxx 1101 xxxx */</span>
	<span class="cm">/* LDRSHT		cccc 0000 xx11 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0f200090</span><span class="p">,</span> <span class="mh">0x00200090</span><span class="p">),</span>

	<span class="cm">/* LDRD/STRD lr,pc,{...	cccc 000x x0x0 xxxx 111x xxxx 1101 xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0e10e0d0</span><span class="p">,</span> <span class="mh">0x0000e0d0</span><span class="p">),</span>

	<span class="cm">/* LDRD (register)	cccc 000x x0x0 xxxx xxxx xxxx 1101 xxxx */</span>
	<span class="cm">/* STRD (register)	cccc 000x x0x0 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e5000d0</span><span class="p">,</span> <span class="mh">0x000000d0</span><span class="p">,</span> <span class="n">emulate_ldrdstrd</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCWB</span><span class="p">,</span> <span class="n">NOPCX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* LDRD (immediate)	cccc 000x x1x0 xxxx xxxx xxxx 1101 xxxx */</span>
	<span class="cm">/* STRD (immediate)	cccc 000x x1x0 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e5000d0</span><span class="p">,</span> <span class="mh">0x004000d0</span><span class="p">,</span> <span class="n">emulate_ldrdstrd</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCWB</span><span class="p">,</span> <span class="n">NOPCX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* STRH (register)	cccc 000x x0x0 xxxx xxxx xxxx 1011 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e5000f0</span><span class="p">,</span> <span class="mh">0x000000b0</span><span class="p">,</span> <span class="n">emulate_str</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCWB</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* LDRH (register)	cccc 000x x0x1 xxxx xxxx xxxx 1011 xxxx */</span>
	<span class="cm">/* LDRSB (register)	cccc 000x x0x1 xxxx xxxx xxxx 1101 xxxx */</span>
	<span class="cm">/* LDRSH (register)	cccc 000x x0x1 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e500090</span><span class="p">,</span> <span class="mh">0x00100090</span><span class="p">,</span> <span class="n">emulate_ldr</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCWB</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* STRH (immediate)	cccc 000x x1x0 xxxx xxxx xxxx 1011 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e5000f0</span><span class="p">,</span> <span class="mh">0x004000b0</span><span class="p">,</span> <span class="n">emulate_str</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCWB</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* LDRH (immediate)	cccc 000x x1x1 xxxx xxxx xxxx 1011 xxxx */</span>
	<span class="cm">/* LDRSB (immediate)	cccc 000x x1x1 xxxx xxxx xxxx 1101 xxxx */</span>
	<span class="cm">/* LDRSH (immediate)	cccc 000x x1x1 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e500090</span><span class="p">,</span> <span class="mh">0x00500090</span><span class="p">,</span> <span class="n">emulate_ldr</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCWB</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_cccc_000x_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Data-processing (register)					*/</span>

	<span class="cm">/* &lt;op&gt;S PC, ...	cccc 000x xxx1 xxxx 1111 xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0e10f000</span><span class="p">,</span> <span class="mh">0x0010f000</span><span class="p">),</span>

	<span class="cm">/* MOV IP, SP		1110 0001 1010 0000 1100 0000 0000 1101 */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0xffffffff</span><span class="p">,</span> <span class="mh">0xe1a0c00d</span><span class="p">,</span> <span class="n">simulate_mov_ipsp</span><span class="p">),</span>

	<span class="cm">/* TST (register)	cccc 0001 0001 xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* TEQ (register)	cccc 0001 0011 xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* CMP (register)	cccc 0001 0101 xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* CMN (register)	cccc 0001 0111 xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0f900010</span><span class="p">,</span> <span class="mh">0x01100000</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0rs8_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">)),</span>

	<span class="cm">/* MOV (register)	cccc 0001 101x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* MVN (register)	cccc 0001 111x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0fa00010</span><span class="p">,</span> <span class="mh">0x01a00000</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0rs8_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">)),</span>

	<span class="cm">/* AND (register)	cccc 0000 000x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* EOR (register)	cccc 0000 001x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* SUB (register)	cccc 0000 010x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* RSB (register)	cccc 0000 011x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* ADD (register)	cccc 0000 100x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* ADC (register)	cccc 0000 101x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* SBC (register)	cccc 0000 110x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* RSC (register)	cccc 0000 111x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* ORR (register)	cccc 0001 100x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* BIC (register)	cccc 0001 110x xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e000010</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0rs8_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">ANY</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">)),</span>

	<span class="cm">/* TST (reg-shift reg)	cccc 0001 0001 xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* TEQ (reg-shift reg)	cccc 0001 0011 xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* CMP (reg-shift reg)	cccc 0001 0101 xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* CMN (reg-shift reg)	cccc 0001 0111 xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0f900090</span><span class="p">,</span> <span class="mh">0x01100010</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0rs8_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">)),</span>

	<span class="cm">/* MOV (reg-shift reg)	cccc 0001 101x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* MVN (reg-shift reg)	cccc 0001 111x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0fa00090</span><span class="p">,</span> <span class="mh">0x01a00010</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0rs8_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">)),</span>

	<span class="cm">/* AND (reg-shift reg)	cccc 0000 000x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* EOR (reg-shift reg)	cccc 0000 001x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* SUB (reg-shift reg)	cccc 0000 010x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* RSB (reg-shift reg)	cccc 0000 011x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* ADD (reg-shift reg)	cccc 0000 100x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* ADC (reg-shift reg)	cccc 0000 101x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* SBC (reg-shift reg)	cccc 0000 110x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* RSC (reg-shift reg)	cccc 0000 111x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* ORR (reg-shift reg)	cccc 0001 100x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="cm">/* BIC (reg-shift reg)	cccc 0001 110x xxxx xxxx xxxx 0xx1 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e000090</span><span class="p">,</span> <span class="mh">0x00000010</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0rs8_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">ANY</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">)),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_cccc_001x_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Data-processing (immediate)					*/</span>

	<span class="cm">/* MOVW			cccc 0011 0000 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* MOVT			cccc 0011 0100 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0fb00000</span><span class="p">,</span> <span class="mh">0x03000000</span><span class="p">,</span> <span class="n">emulate_rd12rm0_noflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* YIELD		cccc 0011 0010 0000 xxxx xxxx 0000 0001 */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0x0fff00ff</span><span class="p">,</span> <span class="mh">0x03200001</span><span class="p">),</span>
	<span class="cm">/* SEV			cccc 0011 0010 0000 xxxx xxxx 0000 0100 */</span>
	<span class="n">DECODE_EMULATE</span>	<span class="p">(</span><span class="mh">0x0fff00ff</span><span class="p">,</span> <span class="mh">0x03200004</span><span class="p">,</span> <span class="n">kprobe_emulate_none</span><span class="p">),</span>
	<span class="cm">/* NOP			cccc 0011 0010 0000 xxxx xxxx 0000 0000 */</span>
	<span class="cm">/* WFE			cccc 0011 0010 0000 xxxx xxxx 0000 0010 */</span>
	<span class="cm">/* WFI			cccc 0011 0010 0000 xxxx xxxx 0000 0011 */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0x0fff00fc</span><span class="p">,</span> <span class="mh">0x03200000</span><span class="p">,</span> <span class="n">kprobe_simulate_nop</span><span class="p">),</span>
	<span class="cm">/* DBG			cccc 0011 0010 0000 xxxx xxxx ffff xxxx */</span>
	<span class="cm">/* unallocated hints	cccc 0011 0010 0000 xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* MSR (immediate)	cccc 0011 0x10 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0fb00000</span><span class="p">,</span> <span class="mh">0x03200000</span><span class="p">),</span>

	<span class="cm">/* &lt;op&gt;S PC, ...	cccc 001x xxx1 xxxx 1111 xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0e10f000</span><span class="p">,</span> <span class="mh">0x0210f000</span><span class="p">),</span>

	<span class="cm">/* TST (immediate)	cccc 0011 0001 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* TEQ (immediate)	cccc 0011 0011 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* CMP (immediate)	cccc 0011 0101 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* CMN (immediate)	cccc 0011 0111 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0f900000</span><span class="p">,</span> <span class="mh">0x03100000</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0rs8_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* MOV (immediate)	cccc 0011 101x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* MVN (immediate)	cccc 0011 111x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0fa00000</span><span class="p">,</span> <span class="mh">0x03a00000</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0rs8_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* AND (immediate)	cccc 0010 000x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* EOR (immediate)	cccc 0010 001x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* SUB (immediate)	cccc 0010 010x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* RSB (immediate)	cccc 0010 011x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ADD (immediate)	cccc 0010 100x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ADC (immediate)	cccc 0010 101x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* SBC (immediate)	cccc 0010 110x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* RSC (immediate)	cccc 0010 111x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* ORR (immediate)	cccc 0011 100x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* BIC (immediate)	cccc 0011 110x xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e000000</span><span class="p">,</span> <span class="mh">0x02000000</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0rs8_rwflags</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">ANY</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_cccc_0110_____xxx1_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Media instructions						*/</span>

	<span class="cm">/* SEL			cccc 0110 1000 xxxx xxxx xxxx 1011 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0ff000f0</span><span class="p">,</span> <span class="mh">0x068000b0</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* SSAT			cccc 0110 101x xxxx xxxx xxxx xx01 xxxx */</span>
	<span class="cm">/* USAT			cccc 0110 111x xxxx xxxx xxxx xx01 xxxx */</span>
	<span class="n">DECODE_OR</span><span class="p">(</span><span class="mh">0x0fa00030</span><span class="p">,</span> <span class="mh">0x06a00010</span><span class="p">),</span>
	<span class="cm">/* SSAT16		cccc 0110 1010 xxxx xxxx xxxx 0011 xxxx */</span>
	<span class="cm">/* USAT16		cccc 0110 1110 xxxx xxxx xxxx 0011 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0fb000f0</span><span class="p">,</span> <span class="mh">0x06a00030</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* REV			cccc 0110 1011 xxxx xxxx xxxx 0011 xxxx */</span>
	<span class="cm">/* REV16		cccc 0110 1011 xxxx xxxx xxxx 1011 xxxx */</span>
	<span class="cm">/* RBIT			cccc 0110 1111 xxxx xxxx xxxx 0011 xxxx */</span>
	<span class="cm">/* REVSH		cccc 0110 1111 xxxx xxxx xxxx 1011 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0fb00070</span><span class="p">,</span> <span class="mh">0x06b00030</span><span class="p">,</span> <span class="n">emulate_rd12rm0_noflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* ???			cccc 0110 0x00 xxxx xxxx xxxx xxx1 xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0fb00010</span><span class="p">,</span> <span class="mh">0x06000010</span><span class="p">),</span>
	<span class="cm">/* ???			cccc 0110 0xxx xxxx xxxx xxxx 1011 xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0f8000f0</span><span class="p">,</span> <span class="mh">0x060000b0</span><span class="p">),</span>
	<span class="cm">/* ???			cccc 0110 0xxx xxxx xxxx xxxx 1101 xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0f8000f0</span><span class="p">,</span> <span class="mh">0x060000d0</span><span class="p">),</span>
	<span class="cm">/* SADD16		cccc 0110 0001 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="cm">/* SADDSUBX		cccc 0110 0001 xxxx xxxx xxxx 0011 xxxx */</span>
	<span class="cm">/* SSUBADDX		cccc 0110 0001 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="cm">/* SSUB16		cccc 0110 0001 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* SADD8		cccc 0110 0001 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* SSUB8		cccc 0110 0001 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="cm">/* QADD16		cccc 0110 0010 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="cm">/* QADDSUBX		cccc 0110 0010 xxxx xxxx xxxx 0011 xxxx */</span>
	<span class="cm">/* QSUBADDX		cccc 0110 0010 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="cm">/* QSUB16		cccc 0110 0010 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* QADD8		cccc 0110 0010 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* QSUB8		cccc 0110 0010 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="cm">/* SHADD16		cccc 0110 0011 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="cm">/* SHADDSUBX		cccc 0110 0011 xxxx xxxx xxxx 0011 xxxx */</span>
	<span class="cm">/* SHSUBADDX		cccc 0110 0011 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="cm">/* SHSUB16		cccc 0110 0011 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* SHADD8		cccc 0110 0011 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* SHSUB8		cccc 0110 0011 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="cm">/* UADD16		cccc 0110 0101 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="cm">/* UADDSUBX		cccc 0110 0101 xxxx xxxx xxxx 0011 xxxx */</span>
	<span class="cm">/* USUBADDX		cccc 0110 0101 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="cm">/* USUB16		cccc 0110 0101 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* UADD8		cccc 0110 0101 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* USUB8		cccc 0110 0101 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="cm">/* UQADD16		cccc 0110 0110 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="cm">/* UQADDSUBX		cccc 0110 0110 xxxx xxxx xxxx 0011 xxxx */</span>
	<span class="cm">/* UQSUBADDX		cccc 0110 0110 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="cm">/* UQSUB16		cccc 0110 0110 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* UQADD8		cccc 0110 0110 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* UQSUB8		cccc 0110 0110 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="cm">/* UHADD16		cccc 0110 0111 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="cm">/* UHADDSUBX		cccc 0110 0111 xxxx xxxx xxxx 0011 xxxx */</span>
	<span class="cm">/* UHSUBADDX		cccc 0110 0111 xxxx xxxx xxxx 0101 xxxx */</span>
	<span class="cm">/* UHSUB16		cccc 0110 0111 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* UHADD8		cccc 0110 0111 xxxx xxxx xxxx 1001 xxxx */</span>
	<span class="cm">/* UHSUB8		cccc 0110 0111 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0f800010</span><span class="p">,</span> <span class="mh">0x06000010</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* PKHBT		cccc 0110 1000 xxxx xxxx xxxx x001 xxxx */</span>
	<span class="cm">/* PKHTB		cccc 0110 1000 xxxx xxxx xxxx x101 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0ff00030</span><span class="p">,</span> <span class="mh">0x06800010</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* ???			cccc 0110 1001 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* ???			cccc 0110 1101 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0fb000f0</span><span class="p">,</span> <span class="mh">0x06900070</span><span class="p">),</span>

	<span class="cm">/* SXTB16		cccc 0110 1000 1111 xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* SXTB			cccc 0110 1010 1111 xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* SXTH			cccc 0110 1011 1111 xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* UXTB16		cccc 0110 1100 1111 xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* UXTB			cccc 0110 1110 1111 xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* UXTH			cccc 0110 1111 1111 xxxx xxxx 0111 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0f8f00f0</span><span class="p">,</span> <span class="mh">0x068f0070</span><span class="p">,</span> <span class="n">emulate_rd12rm0_noflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* SXTAB16		cccc 0110 1000 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* SXTAB		cccc 0110 1010 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* SXTAH		cccc 0110 1011 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* UXTAB16		cccc 0110 1100 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* UXTAB		cccc 0110 1110 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="cm">/* UXTAH		cccc 0110 1111 xxxx xxxx xxxx 0111 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0f8000f0</span><span class="p">,</span> <span class="mh">0x06800070</span><span class="p">,</span> <span class="n">emulate_rd12rn16rm0_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCX</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_cccc_0111_____xxx1_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Media instructions						*/</span>

	<span class="cm">/* UNDEFINED		cccc 0111 1111 xxxx xxxx xxxx 1111 xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0ff000f0</span><span class="p">,</span> <span class="mh">0x07f000f0</span><span class="p">),</span>

	<span class="cm">/* SMLALD		cccc 0111 0100 xxxx xxxx xxxx 00x1 xxxx */</span>
	<span class="cm">/* SMLSLD		cccc 0111 0100 xxxx xxxx xxxx 01x1 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0ff00090</span><span class="p">,</span> <span class="mh">0x07400010</span><span class="p">,</span> <span class="n">emulate_rdlo12rdhi16rn0rm8_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* SMUAD		cccc 0111 0000 xxxx 1111 xxxx 00x1 xxxx */</span>
	<span class="cm">/* SMUSD		cccc 0111 0000 xxxx 1111 xxxx 01x1 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0x0ff0f090</span><span class="p">,</span> <span class="mh">0x0700f010</span><span class="p">),</span>
	<span class="cm">/* SMMUL		cccc 0111 0101 xxxx 1111 xxxx 00x1 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0x0ff0f0d0</span><span class="p">,</span> <span class="mh">0x0750f010</span><span class="p">),</span>
	<span class="cm">/* USAD8		cccc 0111 1000 xxxx 1111 xxxx 0001 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0ff0f0f0</span><span class="p">,</span> <span class="mh">0x0780f010</span><span class="p">,</span> <span class="n">emulate_rd16rn12rm0rs8_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* SMLAD		cccc 0111 0000 xxxx xxxx xxxx 00x1 xxxx */</span>
	<span class="cm">/* SMLSD		cccc 0111 0000 xxxx xxxx xxxx 01x1 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0x0ff00090</span><span class="p">,</span> <span class="mh">0x07000010</span><span class="p">),</span>
	<span class="cm">/* SMMLA		cccc 0111 0101 xxxx xxxx xxxx 00x1 xxxx */</span>
	<span class="n">DECODE_OR</span>	<span class="p">(</span><span class="mh">0x0ff000d0</span><span class="p">,</span> <span class="mh">0x07500010</span><span class="p">),</span>
	<span class="cm">/* USADA8		cccc 0111 1000 xxxx xxxx xxxx 0001 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0ff000f0</span><span class="p">,</span> <span class="mh">0x07800010</span><span class="p">,</span> <span class="n">emulate_rd16rn12rm0rs8_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPCX</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* SMMLS		cccc 0111 0101 xxxx xxxx xxxx 11x1 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0ff000d0</span><span class="p">,</span> <span class="mh">0x075000d0</span><span class="p">,</span> <span class="n">emulate_rd16rn12rm0rs8_rwflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* SBFX			cccc 0111 101x xxxx xxxx xxxx x101 xxxx */</span>
	<span class="cm">/* UBFX			cccc 0111 111x xxxx xxxx xxxx x101 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0fa00070</span><span class="p">,</span> <span class="mh">0x07a00050</span><span class="p">,</span> <span class="n">emulate_rd12rm0_noflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* BFC			cccc 0111 110x xxxx xxxx xxxx x001 1111 */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0fe0007f</span><span class="p">,</span> <span class="mh">0x07c0001f</span><span class="p">,</span> <span class="n">emulate_rd12rm0_noflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* BFI			cccc 0111 110x xxxx xxxx xxxx x001 xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0fe00070</span><span class="p">,</span> <span class="mh">0x07c00010</span><span class="p">,</span> <span class="n">emulate_rd12rm0_noflags_nopc</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPCX</span><span class="p">)),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_cccc_01xx_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Load/store word and unsigned byte				*/</span>

	<span class="cm">/* LDRB/STRB pc,[...]	cccc 01xx x0xx xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0c40f000</span><span class="p">,</span> <span class="mh">0x0440f000</span><span class="p">),</span>

	<span class="cm">/* STRT			cccc 01x0 x010 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRT			cccc 01x0 x011 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* STRBT		cccc 01x0 x110 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRBT		cccc 01x0 x111 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0d200000</span><span class="p">,</span> <span class="mh">0x04200000</span><span class="p">),</span>

	<span class="cm">/* STR (immediate)	cccc 010x x0x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* STRB (immediate)	cccc 010x x1x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e100000</span><span class="p">,</span> <span class="mh">0x04000000</span><span class="p">,</span> <span class="n">emulate_str</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCWB</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* LDR (immediate)	cccc 010x x0x1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRB (immediate)	cccc 010x x1x1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e100000</span><span class="p">,</span> <span class="mh">0x04100000</span><span class="p">,</span> <span class="n">emulate_ldr</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCWB</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>

	<span class="cm">/* STR (register)	cccc 011x x0x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* STRB (register)	cccc 011x x1x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e100000</span><span class="p">,</span> <span class="mh">0x06000000</span><span class="p">,</span> <span class="n">emulate_str</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCWB</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="cm">/* LDR (register)	cccc 011x x0x1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDRB (register)	cccc 011x x1x1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_EMULATEX</span>	<span class="p">(</span><span class="mh">0x0e100000</span><span class="p">,</span> <span class="mh">0x06100000</span><span class="p">,</span> <span class="n">emulate_ldr</span><span class="p">,</span>
						 <span class="n">REGS</span><span class="p">(</span><span class="n">NOPCWB</span><span class="p">,</span> <span class="n">ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NOPC</span><span class="p">)),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">arm_cccc_100x_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Block data transfer instructions				*/</span>

	<span class="cm">/* LDM			cccc 100x x0x1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* STM			cccc 100x x0x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_CUSTOM</span>	<span class="p">(</span><span class="mh">0x0e400000</span><span class="p">,</span> <span class="mh">0x08000000</span><span class="p">,</span> <span class="n">kprobe_decode_ldmstm</span><span class="p">),</span>

	<span class="cm">/* STM (user registers)	cccc 100x x1x0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDM (user registers)	cccc 100x x1x1 xxxx 0xxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDM (exception ret)	cccc 100x x1x1 xxxx 1xxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_END</span>
<span class="p">};</span>

<span class="k">const</span> <span class="k">union</span> <span class="n">decode_item</span> <span class="n">kprobe_decode_arm_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * Unconditional instructions</span>
<span class="cm">	 *			1111 xxxx xxxx xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0xf0000000</span><span class="p">,</span> <span class="mh">0xf0000000</span><span class="p">,</span> <span class="n">arm_1111_table</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Miscellaneous instructions</span>
<span class="cm">	 *			cccc 0001 0xx0 xxxx xxxx xxxx 0xxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0x0f900080</span><span class="p">,</span> <span class="mh">0x01000000</span><span class="p">,</span> <span class="n">arm_cccc_0001_0xx0____0xxx_table</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Halfword multiply and multiply-accumulate</span>
<span class="cm">	 *			cccc 0001 0xx0 xxxx xxxx xxxx 1xx0 xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0x0f900090</span><span class="p">,</span> <span class="mh">0x01000080</span><span class="p">,</span> <span class="n">arm_cccc_0001_0xx0____1xx0_table</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Multiply and multiply-accumulate</span>
<span class="cm">	 *			cccc 0000 xxxx xxxx xxxx xxxx 1001 xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0x0f0000f0</span><span class="p">,</span> <span class="mh">0x00000090</span><span class="p">,</span> <span class="n">arm_cccc_0000_____1001_table</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Synchronization primitives</span>
<span class="cm">	 *			cccc 0001 xxxx xxxx xxxx xxxx 1001 xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0x0f0000f0</span><span class="p">,</span> <span class="mh">0x01000090</span><span class="p">,</span> <span class="n">arm_cccc_0001_____1001_table</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Extra load/store instructions</span>
<span class="cm">	 *			cccc 000x xxxx xxxx xxxx xxxx 1xx1 xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0x0e000090</span><span class="p">,</span> <span class="mh">0x00000090</span><span class="p">,</span> <span class="n">arm_cccc_000x_____1xx1_table</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Data-processing (register)</span>
<span class="cm">	 *			cccc 000x xxxx xxxx xxxx xxxx xxx0 xxxx</span>
<span class="cm">	 * Data-processing (register-shifted register)</span>
<span class="cm">	 *			cccc 000x xxxx xxxx xxxx xxxx 0xx1 xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0x0e000000</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">,</span> <span class="n">arm_cccc_000x_table</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Data-processing (immediate)</span>
<span class="cm">	 *			cccc 001x xxxx xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0x0e000000</span><span class="p">,</span> <span class="mh">0x02000000</span><span class="p">,</span> <span class="n">arm_cccc_001x_table</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Media instructions</span>
<span class="cm">	 *			cccc 011x xxxx xxxx xxxx xxxx xxx1 xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0x0f000010</span><span class="p">,</span> <span class="mh">0x06000010</span><span class="p">,</span> <span class="n">arm_cccc_0110_____xxx1_table</span><span class="p">),</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0x0f000010</span><span class="p">,</span> <span class="mh">0x07000010</span><span class="p">,</span> <span class="n">arm_cccc_0111_____xxx1_table</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Load/store word and unsigned byte</span>
<span class="cm">	 *			cccc 01xx xxxx xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0x0c000000</span><span class="p">,</span> <span class="mh">0x04000000</span><span class="p">,</span> <span class="n">arm_cccc_01xx_table</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Block data transfer instructions</span>
<span class="cm">	 *			cccc 100x xxxx xxxx xxxx xxxx xxxx xxxx</span>
<span class="cm">	 */</span>
	<span class="n">DECODE_TABLE</span>	<span class="p">(</span><span class="mh">0x0e000000</span><span class="p">,</span> <span class="mh">0x08000000</span><span class="p">,</span> <span class="n">arm_cccc_100x_table</span><span class="p">),</span>

	<span class="cm">/* B			cccc 1010 xxxx xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* BL			cccc 1011 xxxx xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_SIMULATE</span>	<span class="p">(</span><span class="mh">0x0e000000</span><span class="p">,</span> <span class="mh">0x0a000000</span><span class="p">,</span> <span class="n">simulate_bbl</span><span class="p">),</span>

	<span class="cm">/*</span>
<span class="cm">	 * Supervisor Call, and coprocessor instructions</span>
<span class="cm">	 */</span>

	<span class="cm">/* MCRR			cccc 1100 0100 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* MRRC			cccc 1100 0101 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* LDC			cccc 110x xxx1 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* STC			cccc 110x xxx0 xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="cm">/* CDP			cccc 1110 xxxx xxxx xxxx xxxx xxx0 xxxx */</span>
	<span class="cm">/* MCR			cccc 1110 xxx0 xxxx xxxx xxxx xxx1 xxxx */</span>
	<span class="cm">/* MRC			cccc 1110 xxx1 xxxx xxxx xxxx xxx1 xxxx */</span>
	<span class="cm">/* SVC			cccc 1111 xxxx xxxx xxxx xxxx xxxx xxxx */</span>
	<span class="n">DECODE_REJECT</span>	<span class="p">(</span><span class="mh">0x0c000000</span><span class="p">,</span> <span class="mh">0x0c000000</span><span class="p">),</span>

	<span class="n">DECODE_END</span>
<span class="p">};</span>
<span class="cp">#ifdef CONFIG_ARM_KPROBES_TEST_MODULE</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">kprobe_decode_arm_table</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__kprobes</span> <span class="nf">arm_singlestep</span><span class="p">(</span><span class="k">struct</span> <span class="n">kprobe</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ARM_pc</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">p</span><span class="o">-&gt;</span><span class="n">ainsn</span><span class="p">.</span><span class="n">insn_handler</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">regs</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Return:</span>
<span class="cm"> *   INSN_REJECTED     If instruction is one not allowed to kprobe,</span>
<span class="cm"> *   INSN_GOOD         If instruction is supported and uses instruction slot,</span>
<span class="cm"> *   INSN_GOOD_NO_SLOT If instruction is supported but doesn&#39;t use its slot.</span>
<span class="cm"> *</span>
<span class="cm"> * For instructions we don&#39;t want to kprobe (INSN_REJECTED return result):</span>
<span class="cm"> *   These are generally ones that modify the processor state making</span>
<span class="cm"> *   them &quot;hard&quot; to simulate such as switches processor modes or</span>
<span class="cm"> *   make accesses in alternate modes.  Any of these could be simulated</span>
<span class="cm"> *   if the work was put into it, but low return considering they</span>
<span class="cm"> *   should also be very rare.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">kprobe_insn</span> <span class="n">__kprobes</span>
<span class="nf">arm_kprobe_decode_insn</span><span class="p">(</span><span class="n">kprobe_opcode_t</span> <span class="n">insn</span><span class="p">,</span> <span class="k">struct</span> <span class="n">arch_specific_insn</span> <span class="o">*</span><span class="n">asi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_singlestep</span> <span class="o">=</span> <span class="n">arm_singlestep</span><span class="p">;</span>
	<span class="n">asi</span><span class="o">-&gt;</span><span class="n">insn_check_cc</span> <span class="o">=</span> <span class="n">kprobe_condition_checks</span><span class="p">[</span><span class="n">insn</span><span class="o">&gt;&gt;</span><span class="mi">28</span><span class="p">];</span>
	<span class="k">return</span> <span class="n">kprobe_decode_insn</span><span class="p">(</span><span class="n">insn</span><span class="p">,</span> <span class="n">asi</span><span class="p">,</span> <span class="n">kprobe_decode_arm_table</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
