<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › kernel › perf_event_v7.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>perf_event_v7.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * ARMv7 Cortex-A8 and Cortex-A9 Performance Events handling code.</span>
<span class="cm"> *</span>
<span class="cm"> * ARMv7 support: Jean Pihet &lt;jpihet@mvista.com&gt;</span>
<span class="cm"> * 2010 (c) MontaVista Software, LLC.</span>
<span class="cm"> *</span>
<span class="cm"> * Copied from ARMv6 code, with the low level code inspired</span>
<span class="cm"> *  by the ARMv7 Oprofile code.</span>
<span class="cm"> *</span>
<span class="cm"> * Cortex-A8 has up to 4 configurable performance counters and</span>
<span class="cm"> *  a single cycle counter.</span>
<span class="cm"> * Cortex-A9 has up to 31 configurable performance counters and</span>
<span class="cm"> *  a single cycle counter.</span>
<span class="cm"> *</span>
<span class="cm"> * All counters can be enabled/disabled and IRQ masked separately. The cycle</span>
<span class="cm"> *  counter and all 4 performance counters together can be reset separately.</span>
<span class="cm"> */</span>

<span class="cp">#ifdef CONFIG_CPU_V7</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="n">armv7pmu</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Common ARMv7 event types</span>
<span class="cm"> *</span>
<span class="cm"> * Note: An implementation may not be able to count all of these events</span>
<span class="cm"> * but the encodings are considered to be `reserved&#39; in the case that</span>
<span class="cm"> * they are not available.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">armv7_perf_types</span> <span class="p">{</span>
	<span class="n">ARMV7_PERFCTR_PMNC_SW_INCR</span>			<span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_L1_ICACHE_REFILL</span>			<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_ITLB_REFILL</span>			<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span>			<span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span>			<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_DTLB_REFILL</span>			<span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_MEM_READ</span>				<span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_MEM_WRITE</span>				<span class="o">=</span> <span class="mh">0x07</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_INSTR_EXECUTED</span>			<span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_EXC_TAKEN</span>				<span class="o">=</span> <span class="mh">0x09</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_EXC_EXECUTED</span>			<span class="o">=</span> <span class="mh">0x0A</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_CID_WRITE</span>				<span class="o">=</span> <span class="mh">0x0B</span><span class="p">,</span>

	<span class="cm">/*</span>
<span class="cm">	 * ARMV7_PERFCTR_PC_WRITE is equivalent to HW_BRANCH_INSTRUCTIONS.</span>
<span class="cm">	 * It counts:</span>
<span class="cm">	 *  - all (taken) branch instructions,</span>
<span class="cm">	 *  - instructions that explicitly write the PC,</span>
<span class="cm">	 *  - exception generating instructions.</span>
<span class="cm">	 */</span>
	<span class="n">ARMV7_PERFCTR_PC_WRITE</span>				<span class="o">=</span> <span class="mh">0x0C</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_PC_IMM_BRANCH</span>			<span class="o">=</span> <span class="mh">0x0D</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_PC_PROC_RETURN</span>			<span class="o">=</span> <span class="mh">0x0E</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_MEM_UNALIGNED_ACCESS</span>		<span class="o">=</span> <span class="mh">0x0F</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span>		<span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_CLOCK_CYCLES</span>			<span class="o">=</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_PC_BRANCH_PRED</span>			<span class="o">=</span> <span class="mh">0x12</span><span class="p">,</span>

	<span class="cm">/* These events are defined by the PMUv2 supplement (ARM DDI 0457A). */</span>
	<span class="n">ARMV7_PERFCTR_MEM_ACCESS</span>			<span class="o">=</span> <span class="mh">0x13</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_L1_ICACHE_ACCESS</span>			<span class="o">=</span> <span class="mh">0x14</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_L1_DCACHE_WB</span>			<span class="o">=</span> <span class="mh">0x15</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_L2_CACHE_ACCESS</span>			<span class="o">=</span> <span class="mh">0x16</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_L2_CACHE_REFILL</span>			<span class="o">=</span> <span class="mh">0x17</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_L2_CACHE_WB</span>			<span class="o">=</span> <span class="mh">0x18</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_BUS_ACCESS</span>			<span class="o">=</span> <span class="mh">0x19</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_MEM_ERROR</span>				<span class="o">=</span> <span class="mh">0x1A</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_INSTR_SPEC</span>			<span class="o">=</span> <span class="mh">0x1B</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_TTBR_WRITE</span>			<span class="o">=</span> <span class="mh">0x1C</span><span class="p">,</span>
	<span class="n">ARMV7_PERFCTR_BUS_CYCLES</span>			<span class="o">=</span> <span class="mh">0x1D</span><span class="p">,</span>

	<span class="n">ARMV7_PERFCTR_CPU_CYCLES</span>			<span class="o">=</span> <span class="mh">0xFF</span>
<span class="p">};</span>

<span class="cm">/* ARMv7 Cortex-A8 specific event types */</span>
<span class="k">enum</span> <span class="n">armv7_a8_perf_types</span> <span class="p">{</span>
	<span class="n">ARMV7_A8_PERFCTR_L2_CACHE_ACCESS</span>		<span class="o">=</span> <span class="mh">0x43</span><span class="p">,</span>
	<span class="n">ARMV7_A8_PERFCTR_L2_CACHE_REFILL</span>		<span class="o">=</span> <span class="mh">0x44</span><span class="p">,</span>
	<span class="n">ARMV7_A8_PERFCTR_L1_ICACHE_ACCESS</span>		<span class="o">=</span> <span class="mh">0x50</span><span class="p">,</span>
	<span class="n">ARMV7_A8_PERFCTR_STALL_ISIDE</span>			<span class="o">=</span> <span class="mh">0x56</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* ARMv7 Cortex-A9 specific event types */</span>
<span class="k">enum</span> <span class="n">armv7_a9_perf_types</span> <span class="p">{</span>
	<span class="n">ARMV7_A9_PERFCTR_INSTR_CORE_RENAME</span>		<span class="o">=</span> <span class="mh">0x68</span><span class="p">,</span>
	<span class="n">ARMV7_A9_PERFCTR_STALL_ICACHE</span>			<span class="o">=</span> <span class="mh">0x60</span><span class="p">,</span>
	<span class="n">ARMV7_A9_PERFCTR_STALL_DISPATCH</span>			<span class="o">=</span> <span class="mh">0x66</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* ARMv7 Cortex-A5 specific event types */</span>
<span class="k">enum</span> <span class="n">armv7_a5_perf_types</span> <span class="p">{</span>
	<span class="n">ARMV7_A5_PERFCTR_PREFETCH_LINEFILL</span>		<span class="o">=</span> <span class="mh">0xc2</span><span class="p">,</span>
	<span class="n">ARMV7_A5_PERFCTR_PREFETCH_LINEFILL_DROP</span>		<span class="o">=</span> <span class="mh">0xc3</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* ARMv7 Cortex-A15 specific event types */</span>
<span class="k">enum</span> <span class="n">armv7_a15_perf_types</span> <span class="p">{</span>
	<span class="n">ARMV7_A15_PERFCTR_L1_DCACHE_ACCESS_READ</span>		<span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="n">ARMV7_A15_PERFCTR_L1_DCACHE_ACCESS_WRITE</span>	<span class="o">=</span> <span class="mh">0x41</span><span class="p">,</span>
	<span class="n">ARMV7_A15_PERFCTR_L1_DCACHE_REFILL_READ</span>		<span class="o">=</span> <span class="mh">0x42</span><span class="p">,</span>
	<span class="n">ARMV7_A15_PERFCTR_L1_DCACHE_REFILL_WRITE</span>	<span class="o">=</span> <span class="mh">0x43</span><span class="p">,</span>

	<span class="n">ARMV7_A15_PERFCTR_DTLB_REFILL_L1_READ</span>		<span class="o">=</span> <span class="mh">0x4C</span><span class="p">,</span>
	<span class="n">ARMV7_A15_PERFCTR_DTLB_REFILL_L1_WRITE</span>		<span class="o">=</span> <span class="mh">0x4D</span><span class="p">,</span>

	<span class="n">ARMV7_A15_PERFCTR_L2_CACHE_ACCESS_READ</span>		<span class="o">=</span> <span class="mh">0x50</span><span class="p">,</span>
	<span class="n">ARMV7_A15_PERFCTR_L2_CACHE_ACCESS_WRITE</span>		<span class="o">=</span> <span class="mh">0x51</span><span class="p">,</span>
	<span class="n">ARMV7_A15_PERFCTR_L2_CACHE_REFILL_READ</span>		<span class="o">=</span> <span class="mh">0x52</span><span class="p">,</span>
	<span class="n">ARMV7_A15_PERFCTR_L2_CACHE_REFILL_WRITE</span>		<span class="o">=</span> <span class="mh">0x53</span><span class="p">,</span>

	<span class="n">ARMV7_A15_PERFCTR_PC_WRITE_SPEC</span>			<span class="o">=</span> <span class="mh">0x76</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Cortex-A8 HW events mapping</span>
<span class="cm"> *</span>
<span class="cm"> * The hardware events that we support. We do support cache operations but</span>
<span class="cm"> * we have harvard caches and no way to combine instruction and data</span>
<span class="cm"> * accesses/misses in hardware.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">armv7_a8_perf_map</span><span class="p">[</span><span class="n">PERF_COUNT_HW_MAX</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CPU_CYCLES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_CPU_CYCLES</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_INSTRUCTIONS</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_INSTR_EXECUTED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_REFERENCES</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_MISSES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BRANCH_INSTRUCTIONS</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_WRITE</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BRANCH_MISSES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BUS_CYCLES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">HW_OP_UNSUPPORTED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_STALLED_CYCLES_FRONTEND</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_A8_PERFCTR_STALL_ISIDE</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_STALLED_CYCLES_BACKEND</span><span class="p">]</span>	<span class="o">=</span> <span class="n">HW_OP_UNSUPPORTED</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">armv7_a8_perf_cache_map</span><span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_MAX</span><span class="p">]</span>
					  <span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_OP_MAX</span><span class="p">]</span>
					  <span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_RESULT_MAX</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">L1D</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * The performance counters don&#39;t differentiate between read</span>
<span class="cm">		 * and write accesses/misses so this isn&#39;t strictly correct,</span>
<span class="cm">		 * but it&#39;s the best we can do. Writes and reads get</span>
<span class="cm">		 * combined.</span>
<span class="cm">		 */</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">L1I</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A8_PERFCTR_L1_ICACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A8_PERFCTR_L1_ICACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">LL</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A8_PERFCTR_L2_CACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A8_PERFCTR_L2_CACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A8_PERFCTR_L2_CACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A8_PERFCTR_L2_CACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">DTLB</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_DTLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_DTLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">ITLB</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_ITLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_ITLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">BPU</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_PRED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_PRED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">NODE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Cortex-A9 HW events mapping</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">armv7_a9_perf_map</span><span class="p">[</span><span class="n">PERF_COUNT_HW_MAX</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CPU_CYCLES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_CPU_CYCLES</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_INSTRUCTIONS</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_A9_PERFCTR_INSTR_CORE_RENAME</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_REFERENCES</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_MISSES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BRANCH_INSTRUCTIONS</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_WRITE</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BRANCH_MISSES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BUS_CYCLES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">HW_OP_UNSUPPORTED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_STALLED_CYCLES_FRONTEND</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_A9_PERFCTR_STALL_ICACHE</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_STALLED_CYCLES_BACKEND</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_A9_PERFCTR_STALL_DISPATCH</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">armv7_a9_perf_cache_map</span><span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_MAX</span><span class="p">]</span>
					  <span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_OP_MAX</span><span class="p">]</span>
					  <span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_RESULT_MAX</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">L1D</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * The performance counters don&#39;t differentiate between read</span>
<span class="cm">		 * and write accesses/misses so this isn&#39;t strictly correct,</span>
<span class="cm">		 * but it&#39;s the best we can do. Writes and reads get</span>
<span class="cm">		 * combined.</span>
<span class="cm">		 */</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">L1I</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">LL</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">DTLB</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_DTLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_DTLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">ITLB</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_ITLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_ITLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">BPU</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_PRED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_PRED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">NODE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Cortex-A5 HW events mapping</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">armv7_a5_perf_map</span><span class="p">[</span><span class="n">PERF_COUNT_HW_MAX</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CPU_CYCLES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_CPU_CYCLES</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_INSTRUCTIONS</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_INSTR_EXECUTED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_REFERENCES</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_MISSES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BRANCH_INSTRUCTIONS</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_WRITE</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BRANCH_MISSES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BUS_CYCLES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">HW_OP_UNSUPPORTED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_STALLED_CYCLES_FRONTEND</span><span class="p">]</span>	<span class="o">=</span> <span class="n">HW_OP_UNSUPPORTED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_STALLED_CYCLES_BACKEND</span><span class="p">]</span>	<span class="o">=</span> <span class="n">HW_OP_UNSUPPORTED</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">armv7_a5_perf_cache_map</span><span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_MAX</span><span class="p">]</span>
					<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_OP_MAX</span><span class="p">]</span>
					<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_RESULT_MAX</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">L1D</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A5_PERFCTR_PREFETCH_LINEFILL</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A5_PERFCTR_PREFETCH_LINEFILL_DROP</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">L1I</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="cm">/*</span>
<span class="cm">		 * The prefetch counters don&#39;t differentiate between the I</span>
<span class="cm">		 * side and the D side.</span>
<span class="cm">		 */</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A5_PERFCTR_PREFETCH_LINEFILL</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A5_PERFCTR_PREFETCH_LINEFILL_DROP</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">LL</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">DTLB</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_DTLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_DTLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">ITLB</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_ITLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_ITLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">BPU</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_PRED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_PRED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">NODE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Cortex-A15 HW events mapping</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">armv7_a15_perf_map</span><span class="p">[</span><span class="n">PERF_COUNT_HW_MAX</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CPU_CYCLES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_CPU_CYCLES</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_INSTRUCTIONS</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_INSTR_EXECUTED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_REFERENCES</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_MISSES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BRANCH_INSTRUCTIONS</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_A15_PERFCTR_PC_WRITE_SPEC</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BRANCH_MISSES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BUS_CYCLES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_BUS_CYCLES</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_STALLED_CYCLES_FRONTEND</span><span class="p">]</span>	<span class="o">=</span> <span class="n">HW_OP_UNSUPPORTED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_STALLED_CYCLES_BACKEND</span><span class="p">]</span>	<span class="o">=</span> <span class="n">HW_OP_UNSUPPORTED</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">armv7_a15_perf_cache_map</span><span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_MAX</span><span class="p">]</span>
					<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_OP_MAX</span><span class="p">]</span>
					<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_RESULT_MAX</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">L1D</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A15_PERFCTR_L1_DCACHE_ACCESS_READ</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A15_PERFCTR_L1_DCACHE_REFILL_READ</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A15_PERFCTR_L1_DCACHE_ACCESS_WRITE</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A15_PERFCTR_L1_DCACHE_REFILL_WRITE</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">L1I</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * Not all performance counters differentiate between read</span>
<span class="cm">		 * and write accesses/misses so we&#39;re not always strictly</span>
<span class="cm">		 * correct, but it&#39;s the best we can do. Writes and reads get</span>
<span class="cm">		 * combined in these cases.</span>
<span class="cm">		 */</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">LL</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A15_PERFCTR_L2_CACHE_ACCESS_READ</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A15_PERFCTR_L2_CACHE_REFILL_READ</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A15_PERFCTR_L2_CACHE_ACCESS_WRITE</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A15_PERFCTR_L2_CACHE_REFILL_WRITE</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">DTLB</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A15_PERFCTR_DTLB_REFILL_L1_READ</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_A15_PERFCTR_DTLB_REFILL_L1_WRITE</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">ITLB</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_ITLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_ITLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">BPU</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_PRED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_PRED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">NODE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Cortex-A7 HW events mapping</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">armv7_a7_perf_map</span><span class="p">[</span><span class="n">PERF_COUNT_HW_MAX</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CPU_CYCLES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_CPU_CYCLES</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_INSTRUCTIONS</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_INSTR_EXECUTED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_REFERENCES</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_MISSES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BRANCH_INSTRUCTIONS</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_WRITE</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BRANCH_MISSES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_BUS_CYCLES</span><span class="p">]</span>		<span class="o">=</span> <span class="n">ARMV7_PERFCTR_BUS_CYCLES</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_STALLED_CYCLES_FRONTEND</span><span class="p">]</span>	<span class="o">=</span> <span class="n">HW_OP_UNSUPPORTED</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_COUNT_HW_STALLED_CYCLES_BACKEND</span><span class="p">]</span>	<span class="o">=</span> <span class="n">HW_OP_UNSUPPORTED</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">armv7_a7_perf_cache_map</span><span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_MAX</span><span class="p">]</span>
					<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_OP_MAX</span><span class="p">]</span>
					<span class="p">[</span><span class="n">PERF_COUNT_HW_CACHE_RESULT_MAX</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">L1D</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * The performance counters don&#39;t differentiate between read</span>
<span class="cm">		 * and write accesses/misses so this isn&#39;t strictly correct,</span>
<span class="cm">		 * but it&#39;s the best we can do. Writes and reads get</span>
<span class="cm">		 * combined.</span>
<span class="cm">		 */</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_DCACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">L1I</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L1_ICACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">LL</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L2_CACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L2_CACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L2_CACHE_ACCESS</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_L2_CACHE_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">DTLB</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_DTLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_DTLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">ITLB</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_ITLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_ITLB_REFILL</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">BPU</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_PRED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_PRED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">ARMV7_PERFCTR_PC_BRANCH_MIS_PRED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">NODE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_READ</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_WRITE</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">OP_PREFETCH</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_ACCESS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
			<span class="p">[</span><span class="n">C</span><span class="p">(</span><span class="n">RESULT_MISS</span><span class="p">)]</span>	<span class="o">=</span> <span class="n">CACHE_OP_UNSUPPORTED</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Perf Events&#39; indices</span>
<span class="cm"> */</span>
<span class="cp">#define	ARMV7_IDX_CYCLE_COUNTER	0</span>
<span class="cp">#define	ARMV7_IDX_COUNTER0	1</span>
<span class="cp">#define	ARMV7_IDX_COUNTER_LAST	(ARMV7_IDX_CYCLE_COUNTER + cpu_pmu-&gt;num_events - 1)</span>

<span class="cp">#define	ARMV7_MAX_COUNTERS	32</span>
<span class="cp">#define	ARMV7_COUNTER_MASK	(ARMV7_MAX_COUNTERS - 1)</span>

<span class="cm">/*</span>
<span class="cm"> * ARMv7 low level PMNC access</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Perf Event to low level counters mapping</span>
<span class="cm"> */</span>
<span class="cp">#define	ARMV7_IDX_TO_COUNTER(x)	\</span>
<span class="cp">	(((x) - ARMV7_IDX_COUNTER0) &amp; ARMV7_COUNTER_MASK)</span>

<span class="cm">/*</span>
<span class="cm"> * Per-CPU PMNC: config reg</span>
<span class="cm"> */</span>
<span class="cp">#define ARMV7_PMNC_E		(1 &lt;&lt; 0) </span><span class="cm">/* Enable all counters */</span><span class="cp"></span>
<span class="cp">#define ARMV7_PMNC_P		(1 &lt;&lt; 1) </span><span class="cm">/* Reset all counters */</span><span class="cp"></span>
<span class="cp">#define ARMV7_PMNC_C		(1 &lt;&lt; 2) </span><span class="cm">/* Cycle counter reset */</span><span class="cp"></span>
<span class="cp">#define ARMV7_PMNC_D		(1 &lt;&lt; 3) </span><span class="cm">/* CCNT counts every 64th cpu cycle */</span><span class="cp"></span>
<span class="cp">#define ARMV7_PMNC_X		(1 &lt;&lt; 4) </span><span class="cm">/* Export to ETM */</span><span class="cp"></span>
<span class="cp">#define ARMV7_PMNC_DP		(1 &lt;&lt; 5) </span><span class="cm">/* Disable CCNT if non-invasive debug*/</span><span class="cp"></span>
<span class="cp">#define	ARMV7_PMNC_N_SHIFT	11	 </span><span class="cm">/* Number of counters supported */</span><span class="cp"></span>
<span class="cp">#define	ARMV7_PMNC_N_MASK	0x1f</span>
<span class="cp">#define	ARMV7_PMNC_MASK		0x3f	 </span><span class="cm">/* Mask for writable bits */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * FLAG: counters overflow flag status reg</span>
<span class="cm"> */</span>
<span class="cp">#define	ARMV7_FLAG_MASK		0xffffffff	</span><span class="cm">/* Mask for writable bits */</span><span class="cp"></span>
<span class="cp">#define	ARMV7_OVERFLOWED_MASK	ARMV7_FLAG_MASK</span>

<span class="cm">/*</span>
<span class="cm"> * PMXEVTYPER: Event selection reg</span>
<span class="cm"> */</span>
<span class="cp">#define	ARMV7_EVTYPE_MASK	0xc00000ff	</span><span class="cm">/* Mask for writable bits */</span><span class="cp"></span>
<span class="cp">#define	ARMV7_EVTYPE_EVENT	0xff		</span><span class="cm">/* Mask for EVENT bits */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Event filters for PMUv2</span>
<span class="cm"> */</span>
<span class="cp">#define	ARMV7_EXCLUDE_PL1	(1 &lt;&lt; 31)</span>
<span class="cp">#define	ARMV7_EXCLUDE_USER	(1 &lt;&lt; 30)</span>
<span class="cp">#define	ARMV7_INCLUDE_HYP	(1 &lt;&lt; 27)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">armv7_pmnc_read</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c12, 0&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">armv7_pmnc_write</span><span class="p">(</span><span class="n">u32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="n">ARMV7_PMNC_MASK</span><span class="p">;</span>
	<span class="n">isb</span><span class="p">();</span>
	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 0, %0, c9, c12, 0&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">armv7_pmnc_has_overflowed</span><span class="p">(</span><span class="n">u32</span> <span class="n">pmnc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">pmnc</span> <span class="o">&amp;</span> <span class="n">ARMV7_OVERFLOWED_MASK</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">armv7_pmnc_counter_valid</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">ARMV7_IDX_CYCLE_COUNTER</span> <span class="o">&amp;&amp;</span> <span class="n">idx</span> <span class="o">&lt;=</span> <span class="n">ARMV7_IDX_COUNTER_LAST</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">armv7_pmnc_counter_has_overflowed</span><span class="p">(</span><span class="n">u32</span> <span class="n">pmnc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">counter</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">armv7_pmnc_counter_valid</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;CPU%u checking wrong counter %d overflow status</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">smp_processor_id</span><span class="p">(),</span> <span class="n">idx</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">counter</span> <span class="o">=</span> <span class="n">ARMV7_IDX_TO_COUNTER</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">pmnc</span> <span class="o">&amp;</span> <span class="n">BIT</span><span class="p">(</span><span class="n">counter</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">armv7_pmnc_select_counter</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">counter</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">armv7_pmnc_counter_valid</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;CPU%u selecting wrong PMNC counter %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">smp_processor_id</span><span class="p">(),</span> <span class="n">idx</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">counter</span> <span class="o">=</span> <span class="n">ARMV7_IDX_TO_COUNTER</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 0, %0, c9, c12, 5&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">counter</span><span class="p">));</span>
	<span class="n">isb</span><span class="p">();</span>

	<span class="k">return</span> <span class="n">idx</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">armv7pmu_read_counter</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">armv7_pmnc_counter_valid</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;CPU%u reading wrong counter %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">smp_processor_id</span><span class="p">(),</span> <span class="n">idx</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">==</span> <span class="n">ARMV7_IDX_CYCLE_COUNTER</span><span class="p">)</span>
		<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c13, 0&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">value</span><span class="p">));</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">armv7_pmnc_select_counter</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="n">idx</span><span class="p">)</span>
		<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c13, 2&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">value</span><span class="p">));</span>

	<span class="k">return</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">armv7pmu_write_counter</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">armv7_pmnc_counter_valid</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;CPU%u writing wrong counter %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">smp_processor_id</span><span class="p">(),</span> <span class="n">idx</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">==</span> <span class="n">ARMV7_IDX_CYCLE_COUNTER</span><span class="p">)</span>
		<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 0, %0, c9, c13, 0&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">value</span><span class="p">));</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">armv7_pmnc_select_counter</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="n">idx</span><span class="p">)</span>
		<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 0, %0, c9, c13, 2&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">value</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">armv7_pmnc_write_evtsel</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">armv7_pmnc_select_counter</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="n">idx</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="n">ARMV7_EVTYPE_MASK</span><span class="p">;</span>
		<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 0, %0, c9, c13, 1&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">val</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">armv7_pmnc_enable_counter</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">counter</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">armv7_pmnc_counter_valid</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;CPU%u enabling wrong PMNC counter %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">smp_processor_id</span><span class="p">(),</span> <span class="n">idx</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">counter</span> <span class="o">=</span> <span class="n">ARMV7_IDX_TO_COUNTER</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 0, %0, c9, c12, 1&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="n">counter</span><span class="p">)));</span>
	<span class="k">return</span> <span class="n">idx</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">armv7_pmnc_disable_counter</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">counter</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">armv7_pmnc_counter_valid</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;CPU%u disabling wrong PMNC counter %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">smp_processor_id</span><span class="p">(),</span> <span class="n">idx</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">counter</span> <span class="o">=</span> <span class="n">ARMV7_IDX_TO_COUNTER</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 0, %0, c9, c12, 2&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="n">counter</span><span class="p">)));</span>
	<span class="k">return</span> <span class="n">idx</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">armv7_pmnc_enable_intens</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">counter</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">armv7_pmnc_counter_valid</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;CPU%u enabling wrong PMNC counter IRQ enable %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">smp_processor_id</span><span class="p">(),</span> <span class="n">idx</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">counter</span> <span class="o">=</span> <span class="n">ARMV7_IDX_TO_COUNTER</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 0, %0, c9, c14, 1&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="n">counter</span><span class="p">)));</span>
	<span class="k">return</span> <span class="n">idx</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">armv7_pmnc_disable_intens</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">counter</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">armv7_pmnc_counter_valid</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;CPU%u disabling wrong PMNC counter IRQ enable %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">smp_processor_id</span><span class="p">(),</span> <span class="n">idx</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">counter</span> <span class="o">=</span> <span class="n">ARMV7_IDX_TO_COUNTER</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 0, %0, c9, c14, 2&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="n">counter</span><span class="p">)));</span>
	<span class="n">isb</span><span class="p">();</span>
	<span class="cm">/* Clear the overflow flag in case an interrupt is pending. */</span>
	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 0, %0, c9, c12, 3&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="n">counter</span><span class="p">)));</span>
	<span class="n">isb</span><span class="p">();</span>

	<span class="k">return</span> <span class="n">idx</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">armv7_pmnc_getreset_flags</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="cm">/* Read */</span>
	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c12, 3&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">val</span><span class="p">));</span>

	<span class="cm">/* Write to clear flags */</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="n">ARMV7_FLAG_MASK</span><span class="p">;</span>
	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mcr p15, 0, %0, c9, c12, 3&quot;</span> <span class="o">:</span> <span class="o">:</span> <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">val</span><span class="p">));</span>

	<span class="k">return</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef DEBUG</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">armv7_pmnc_dump_regs</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cnt</span><span class="p">;</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;PMNC registers dump:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c12, 0&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">val</span><span class="p">));</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;PMNC  =0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c12, 1&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">val</span><span class="p">));</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;CNTENS=0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c14, 1&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">val</span><span class="p">));</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;INTENS=0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c12, 3&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">val</span><span class="p">));</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;FLAGS =0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c12, 5&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">val</span><span class="p">));</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;SELECT=0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c13, 0&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">val</span><span class="p">));</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;CCNT  =0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="n">ARMV7_IDX_COUNTER0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;=</span> <span class="n">ARMV7_IDX_COUNTER_LAST</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">armv7_pmnc_select_counter</span><span class="p">(</span><span class="n">cnt</span><span class="p">);</span>
		<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c13, 2&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">val</span><span class="p">));</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;CNT[%d] count =0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">ARMV7_IDX_TO_COUNTER</span><span class="p">(</span><span class="n">cnt</span><span class="p">),</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">asm</span> <span class="k">volatile</span><span class="p">(</span><span class="s">&quot;mrc p15, 0, %0, c9, c13, 1&quot;</span> <span class="o">:</span> <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">val</span><span class="p">));</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;CNT[%d] evtsel=0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">ARMV7_IDX_TO_COUNTER</span><span class="p">(</span><span class="n">cnt</span><span class="p">),</span> <span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">armv7pmu_enable_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hw_perf_event</span> <span class="o">*</span><span class="n">hwc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pmu_hw_events</span> <span class="o">*</span><span class="n">events</span> <span class="o">=</span> <span class="n">cpu_pmu</span><span class="o">-&gt;</span><span class="n">get_hw_events</span><span class="p">();</span>

	<span class="cm">/*</span>
<span class="cm">	 * Enable counter and interrupt, and set the counter to count</span>
<span class="cm">	 * the event that we&#39;re interested in.</span>
<span class="cm">	 */</span>
	<span class="n">raw_spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="o">-&gt;</span><span class="n">pmu_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Disable counter</span>
<span class="cm">	 */</span>
	<span class="n">armv7_pmnc_disable_counter</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Set event (if destined for PMNx counters)</span>
<span class="cm">	 * We only need to set the event for the cycle counter if we</span>
<span class="cm">	 * have the ability to perform event filtering.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">armv7pmu</span><span class="p">.</span><span class="n">set_event_filter</span> <span class="o">||</span> <span class="n">idx</span> <span class="o">!=</span> <span class="n">ARMV7_IDX_CYCLE_COUNTER</span><span class="p">)</span>
		<span class="n">armv7_pmnc_write_evtsel</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">hwc</span><span class="o">-&gt;</span><span class="n">config_base</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Enable interrupt for this counter</span>
<span class="cm">	 */</span>
	<span class="n">armv7_pmnc_enable_intens</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Enable counter</span>
<span class="cm">	 */</span>
	<span class="n">armv7_pmnc_enable_counter</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>

	<span class="n">raw_spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="o">-&gt;</span><span class="n">pmu_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">armv7pmu_disable_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hw_perf_event</span> <span class="o">*</span><span class="n">hwc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pmu_hw_events</span> <span class="o">*</span><span class="n">events</span> <span class="o">=</span> <span class="n">cpu_pmu</span><span class="o">-&gt;</span><span class="n">get_hw_events</span><span class="p">();</span>

	<span class="cm">/*</span>
<span class="cm">	 * Disable counter and interrupt</span>
<span class="cm">	 */</span>
	<span class="n">raw_spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="o">-&gt;</span><span class="n">pmu_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Disable counter</span>
<span class="cm">	 */</span>
	<span class="n">armv7_pmnc_disable_counter</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Disable interrupt for this counter</span>
<span class="cm">	 */</span>
	<span class="n">armv7_pmnc_disable_intens</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>

	<span class="n">raw_spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="o">-&gt;</span><span class="n">pmu_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">irqreturn_t</span> <span class="nf">armv7pmu_handle_irq</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq_num</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">pmnc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">perf_sample_data</span> <span class="n">data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pmu_hw_events</span> <span class="o">*</span><span class="n">cpuc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Get and reset the IRQ flags</span>
<span class="cm">	 */</span>
	<span class="n">pmnc</span> <span class="o">=</span> <span class="n">armv7_pmnc_getreset_flags</span><span class="p">();</span>

	<span class="cm">/*</span>
<span class="cm">	 * Did an overflow occur?</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">armv7_pmnc_has_overflowed</span><span class="p">(</span><span class="n">pmnc</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">IRQ_NONE</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Handle the counter(s) overflow(s)</span>
<span class="cm">	 */</span>
	<span class="n">regs</span> <span class="o">=</span> <span class="n">get_irq_regs</span><span class="p">();</span>

	<span class="n">cpuc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">__get_cpu_var</span><span class="p">(</span><span class="n">cpu_hw_events</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">cpu_pmu</span><span class="o">-&gt;</span><span class="n">num_events</span><span class="p">;</span> <span class="o">++</span><span class="n">idx</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">perf_event</span> <span class="o">*</span><span class="n">event</span> <span class="o">=</span> <span class="n">cpuc</span><span class="o">-&gt;</span><span class="n">events</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
		<span class="k">struct</span> <span class="n">hw_perf_event</span> <span class="o">*</span><span class="n">hwc</span><span class="p">;</span>

		<span class="cm">/* Ignore if we don&#39;t have an event. */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">event</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="cm">/*</span>
<span class="cm">		 * We have a single interrupt for all counters. Check that</span>
<span class="cm">		 * each counter has overflowed before we process it.</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">armv7_pmnc_counter_has_overflowed</span><span class="p">(</span><span class="n">pmnc</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="n">hwc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
		<span class="n">armpmu_event_update</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hwc</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
		<span class="n">perf_sample_data_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">hwc</span><span class="o">-&gt;</span><span class="n">last_period</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">armpmu_event_set_period</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">hwc</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">perf_event_overflow</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">regs</span><span class="p">))</span>
			<span class="n">cpu_pmu</span><span class="o">-&gt;</span><span class="n">disable</span><span class="p">(</span><span class="n">hwc</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * Handle the pending perf events.</span>
<span class="cm">	 *</span>
<span class="cm">	 * Note: this call *must* be run with interrupts disabled. For</span>
<span class="cm">	 * platforms that can have the PMU interrupts raised as an NMI, this</span>
<span class="cm">	 * will not work.</span>
<span class="cm">	 */</span>
	<span class="n">irq_work_run</span><span class="p">();</span>

	<span class="k">return</span> <span class="n">IRQ_HANDLED</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">armv7pmu_start</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pmu_hw_events</span> <span class="o">*</span><span class="n">events</span> <span class="o">=</span> <span class="n">cpu_pmu</span><span class="o">-&gt;</span><span class="n">get_hw_events</span><span class="p">();</span>

	<span class="n">raw_spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="o">-&gt;</span><span class="n">pmu_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="cm">/* Enable all counters */</span>
	<span class="n">armv7_pmnc_write</span><span class="p">(</span><span class="n">armv7_pmnc_read</span><span class="p">()</span> <span class="o">|</span> <span class="n">ARMV7_PMNC_E</span><span class="p">);</span>
	<span class="n">raw_spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="o">-&gt;</span><span class="n">pmu_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">armv7pmu_stop</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pmu_hw_events</span> <span class="o">*</span><span class="n">events</span> <span class="o">=</span> <span class="n">cpu_pmu</span><span class="o">-&gt;</span><span class="n">get_hw_events</span><span class="p">();</span>

	<span class="n">raw_spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="o">-&gt;</span><span class="n">pmu_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="cm">/* Disable all counters */</span>
	<span class="n">armv7_pmnc_write</span><span class="p">(</span><span class="n">armv7_pmnc_read</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ARMV7_PMNC_E</span><span class="p">);</span>
	<span class="n">raw_spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="o">-&gt;</span><span class="n">pmu_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">armv7pmu_get_event_idx</span><span class="p">(</span><span class="k">struct</span> <span class="n">pmu_hw_events</span> <span class="o">*</span><span class="n">cpuc</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">hw_perf_event</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">evtype</span> <span class="o">=</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">config_base</span> <span class="o">&amp;</span> <span class="n">ARMV7_EVTYPE_EVENT</span><span class="p">;</span>

	<span class="cm">/* Always place a cycle counter into the cycle counter. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">evtype</span> <span class="o">==</span> <span class="n">ARMV7_PERFCTR_CPU_CYCLES</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">test_and_set_bit</span><span class="p">(</span><span class="n">ARMV7_IDX_CYCLE_COUNTER</span><span class="p">,</span> <span class="n">cpuc</span><span class="o">-&gt;</span><span class="n">used_mask</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

		<span class="k">return</span> <span class="n">ARMV7_IDX_CYCLE_COUNTER</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * For anything other than a cycle counter, try and use</span>
<span class="cm">	 * the events counters</span>
<span class="cm">	 */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="n">ARMV7_IDX_COUNTER0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">cpu_pmu</span><span class="o">-&gt;</span><span class="n">num_events</span><span class="p">;</span> <span class="o">++</span><span class="n">idx</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">test_and_set_bit</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">cpuc</span><span class="o">-&gt;</span><span class="n">used_mask</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">idx</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* The counters are all in use. */</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Add an event filter to a given event. This will only work for PMUv2 PMUs.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">armv7pmu_set_event_filter</span><span class="p">(</span><span class="k">struct</span> <span class="n">hw_perf_event</span> <span class="o">*</span><span class="n">event</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">perf_event_attr</span> <span class="o">*</span><span class="n">attr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">config_base</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">exclude_idle</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">exclude_user</span><span class="p">)</span>
		<span class="n">config_base</span> <span class="o">|=</span> <span class="n">ARMV7_EXCLUDE_USER</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">exclude_kernel</span><span class="p">)</span>
		<span class="n">config_base</span> <span class="o">|=</span> <span class="n">ARMV7_EXCLUDE_PL1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">exclude_hv</span><span class="p">)</span>
		<span class="n">config_base</span> <span class="o">|=</span> <span class="n">ARMV7_INCLUDE_HYP</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Install the filter into config_base as this is used to</span>
<span class="cm">	 * construct the event type.</span>
<span class="cm">	 */</span>
	<span class="n">event</span><span class="o">-&gt;</span><span class="n">config_base</span> <span class="o">=</span> <span class="n">config_base</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">armv7pmu_reset</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">idx</span><span class="p">,</span> <span class="n">nb_cnt</span> <span class="o">=</span> <span class="n">cpu_pmu</span><span class="o">-&gt;</span><span class="n">num_events</span><span class="p">;</span>

	<span class="cm">/* The counter and interrupt enable registers are unknown at reset. */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="n">ARMV7_IDX_CYCLE_COUNTER</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">nb_cnt</span><span class="p">;</span> <span class="o">++</span><span class="n">idx</span><span class="p">)</span>
		<span class="n">armv7pmu_disable_event</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>

	<span class="cm">/* Initialize &amp; Reset PMNC: C and P bits */</span>
	<span class="n">armv7_pmnc_write</span><span class="p">(</span><span class="n">ARMV7_PMNC_P</span> <span class="o">|</span> <span class="n">ARMV7_PMNC_C</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">armv7_a8_map_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">perf_event</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">map_cpu_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">armv7_a8_perf_map</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">armv7_a8_perf_cache_map</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">armv7_a9_map_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">perf_event</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">map_cpu_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">armv7_a9_perf_map</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">armv7_a9_perf_cache_map</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">armv7_a5_map_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">perf_event</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">map_cpu_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">armv7_a5_perf_map</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">armv7_a5_perf_cache_map</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">armv7_a15_map_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">perf_event</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">map_cpu_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">armv7_a15_perf_map</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">armv7_a15_perf_cache_map</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">armv7_a7_map_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">perf_event</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">map_cpu_event</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">armv7_a7_perf_map</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">armv7_a7_perf_cache_map</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="n">armv7pmu</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">handle_irq</span>		<span class="o">=</span> <span class="n">armv7pmu_handle_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable</span>			<span class="o">=</span> <span class="n">armv7pmu_enable_event</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>		<span class="o">=</span> <span class="n">armv7pmu_disable_event</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_counter</span>		<span class="o">=</span> <span class="n">armv7pmu_read_counter</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write_counter</span>		<span class="o">=</span> <span class="n">armv7pmu_write_counter</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_event_idx</span>		<span class="o">=</span> <span class="n">armv7pmu_get_event_idx</span><span class="p">,</span>
	<span class="p">.</span><span class="n">start</span>			<span class="o">=</span> <span class="n">armv7pmu_start</span><span class="p">,</span>
	<span class="p">.</span><span class="n">stop</span>			<span class="o">=</span> <span class="n">armv7pmu_stop</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span>			<span class="o">=</span> <span class="n">armv7pmu_reset</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_period</span>		<span class="o">=</span> <span class="p">(</span><span class="mi">1LLU</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">u32</span> <span class="n">__init</span> <span class="nf">armv7_read_num_pmnc_events</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">nb_cnt</span><span class="p">;</span>

	<span class="cm">/* Read the nb of CNTx counters supported from PMNC */</span>
	<span class="n">nb_cnt</span> <span class="o">=</span> <span class="p">(</span><span class="n">armv7_pmnc_read</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">ARMV7_PMNC_N_SHIFT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ARMV7_PMNC_N_MASK</span><span class="p">;</span>

	<span class="cm">/* Add the CPU cycles counter and return */</span>
	<span class="k">return</span> <span class="n">nb_cnt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="o">*</span><span class="n">__init</span> <span class="nf">armv7_a8_pmu_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="n">ARM_PERF_PMU_ID_CA8</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;ARMv7 Cortex-A8&quot;</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">map_event</span>	<span class="o">=</span> <span class="n">armv7_a8_map_event</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">num_events</span>	<span class="o">=</span> <span class="n">armv7_read_num_pmnc_events</span><span class="p">();</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">armv7pmu</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="o">*</span><span class="n">__init</span> <span class="nf">armv7_a9_pmu_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="n">ARM_PERF_PMU_ID_CA9</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;ARMv7 Cortex-A9&quot;</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">map_event</span>	<span class="o">=</span> <span class="n">armv7_a9_map_event</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">num_events</span>	<span class="o">=</span> <span class="n">armv7_read_num_pmnc_events</span><span class="p">();</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">armv7pmu</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="o">*</span><span class="n">__init</span> <span class="nf">armv7_a5_pmu_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="n">ARM_PERF_PMU_ID_CA5</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;ARMv7 Cortex-A5&quot;</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">map_event</span>	<span class="o">=</span> <span class="n">armv7_a5_map_event</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">num_events</span>	<span class="o">=</span> <span class="n">armv7_read_num_pmnc_events</span><span class="p">();</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">armv7pmu</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="o">*</span><span class="n">__init</span> <span class="nf">armv7_a15_pmu_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="n">ARM_PERF_PMU_ID_CA15</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;ARMv7 Cortex-A15&quot;</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">map_event</span>	<span class="o">=</span> <span class="n">armv7_a15_map_event</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">num_events</span>	<span class="o">=</span> <span class="n">armv7_read_num_pmnc_events</span><span class="p">();</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">set_event_filter</span> <span class="o">=</span> <span class="n">armv7pmu_set_event_filter</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">armv7pmu</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="o">*</span><span class="n">__init</span> <span class="nf">armv7_a7_pmu_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="n">ARM_PERF_PMU_ID_CA7</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;ARMv7 Cortex-A7&quot;</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">map_event</span>	<span class="o">=</span> <span class="n">armv7_a7_map_event</span><span class="p">;</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">num_events</span>	<span class="o">=</span> <span class="n">armv7_read_num_pmnc_events</span><span class="p">();</span>
	<span class="n">armv7pmu</span><span class="p">.</span><span class="n">set_event_filter</span> <span class="o">=</span> <span class="n">armv7pmu_set_event_filter</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">armv7pmu</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="o">*</span><span class="n">__init</span> <span class="nf">armv7_a8_pmu_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="o">*</span><span class="n">__init</span> <span class="nf">armv7_a9_pmu_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="o">*</span><span class="n">__init</span> <span class="nf">armv7_a5_pmu_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="o">*</span><span class="n">__init</span> <span class="nf">armv7_a15_pmu_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">arm_pmu</span> <span class="o">*</span><span class="n">__init</span> <span class="nf">armv7_a7_pmu_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif	</span><span class="cm">/* CONFIG_CPU_V7 */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
