<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-shmobile › board-armadillo800eva.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>board-armadillo800eva.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * armadillo 800 eva board support</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2012 Renesas Solutions Corp.</span>
<span class="cm"> * Copyright (C) 2012 Kuninori Morimoto &lt;kuninori.morimoto.gx@renesas.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; version 2 of the License.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/clk.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/err.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/input.h&gt;</span>
<span class="cp">#include &lt;linux/irq.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/gpio.h&gt;</span>
<span class="cp">#include &lt;linux/gpio_keys.h&gt;</span>
<span class="cp">#include &lt;linux/sh_eth.h&gt;</span>
<span class="cp">#include &lt;linux/videodev2.h&gt;</span>
<span class="cp">#include &lt;linux/usb/renesas_usbhs.h&gt;</span>
<span class="cp">#include &lt;linux/mfd/tmio.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/host.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/sh_mmcif.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/sh_mobile_sdhi.h&gt;</span>
<span class="cp">#include &lt;mach/common.h&gt;</span>
<span class="cp">#include &lt;mach/irqs.h&gt;</span>
<span class="cp">#include &lt;asm/page.h&gt;</span>
<span class="cp">#include &lt;asm/mach-types.h&gt;</span>
<span class="cp">#include &lt;asm/mach/arch.h&gt;</span>
<span class="cp">#include &lt;asm/mach/map.h&gt;</span>
<span class="cp">#include &lt;asm/mach/time.h&gt;</span>
<span class="cp">#include &lt;asm/hardware/cache-l2x0.h&gt;</span>
<span class="cp">#include &lt;mach/r8a7740.h&gt;</span>
<span class="cp">#include &lt;video/sh_mobile_lcdc.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * CON1		Camera Module</span>
<span class="cm"> * CON2		Extension Bus</span>
<span class="cm"> * CON3		HDMI Output</span>
<span class="cm"> * CON4		Composite Video Output</span>
<span class="cm"> * CON5		H-UDI JTAG</span>
<span class="cm"> * CON6		ARM JTAG</span>
<span class="cm"> * CON7		SD1</span>
<span class="cm"> * CON8		SD2</span>
<span class="cm"> * CON9		RTC BackUp</span>
<span class="cm"> * CON10	Monaural Mic Input</span>
<span class="cm"> * CON11	Stereo Headphone Output</span>
<span class="cm"> * CON12	Audio Line Output(L)</span>
<span class="cm"> * CON13	Audio Line Output(R)</span>
<span class="cm"> * CON14	AWL13 Module</span>
<span class="cm"> * CON15	Extension</span>
<span class="cm"> * CON16	LCD1</span>
<span class="cm"> * CON17	LCD2</span>
<span class="cm"> * CON19	Power Input</span>
<span class="cm"> * CON20	USB1</span>
<span class="cm"> * CON21	USB2</span>
<span class="cm"> * CON22	Serial</span>
<span class="cm"> * CON23	LAN</span>
<span class="cm"> * CON24	USB3</span>
<span class="cm"> * LED1		Camera LED(Yellow)</span>
<span class="cm"> * LED2		Power LED (Green)</span>
<span class="cm"> * ED3-LED6	User LED(Yellow)</span>
<span class="cm"> * LED7		LAN link LED(Green)</span>
<span class="cm"> * LED8		LAN activity LED(Yellow)</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * DipSwitch</span>
<span class="cm"> *</span>
<span class="cm"> *                    SW1</span>
<span class="cm"> *</span>
<span class="cm"> * -12345678-+---------------+----------------------------</span>
<span class="cm"> *  1        | boot          | hermit</span>
<span class="cm"> *  0        | boot          | OS auto boot</span>
<span class="cm"> * -12345678-+---------------+----------------------------</span>
<span class="cm"> *   00      | boot device   | eMMC</span>
<span class="cm"> *   10      | boot device   | SDHI0 (CON7)</span>
<span class="cm"> *   01      | boot device   | -</span>
<span class="cm"> *   11      | boot device   | Extension Buss (CS0)</span>
<span class="cm"> * -12345678-+---------------+----------------------------</span>
<span class="cm"> *     0     | Extension Bus | D8-D15 disable, eMMC enable</span>
<span class="cm"> *     1     | Extension Bus | D8-D15 enable,  eMMC disable</span>
<span class="cm"> * -12345678-+---------------+----------------------------</span>
<span class="cm"> *      0    | SDHI1         | COM8 disable, COM14 enable</span>
<span class="cm"> *      1    | SDHI1         | COM8 enable,  COM14 disable</span>
<span class="cm"> * -12345678-+---------------+----------------------------</span>
<span class="cm"> *       0   | USB0          | COM20 enable,  COM24 disable</span>
<span class="cm"> *       1   | USB0          | COM20 disable, COM24 enable</span>
<span class="cm"> * -12345678-+---------------+----------------------------</span>
<span class="cm"> *        00 | JTAG          | SH-X2</span>
<span class="cm"> *        10 | JTAG          | ARM</span>
<span class="cm"> *        01 | JTAG          | -</span>
<span class="cm"> *        11 | JTAG          | Boundary Scan</span>
<span class="cm"> *-----------+---------------+----------------------------</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * USB function</span>
<span class="cm"> *</span>
<span class="cm"> * When you use USB Function,</span>
<span class="cm"> * set SW1.6 ON, and connect cable to CN24.</span>
<span class="cm"> *</span>
<span class="cm"> * USBF needs workaround on R8A7740 chip.</span>
<span class="cm"> * These are a little bit complex.</span>
<span class="cm"> * see</span>
<span class="cm"> *	usbhsf_power_ctrl()</span>
<span class="cm"> *</span>
<span class="cm"> * CAUTION</span>
<span class="cm"> *</span>
<span class="cm"> * It uses autonomy mode for USB hotplug at this point</span>
<span class="cm"> * (= usbhs_private.platform_callback.get_vbus is NULL),</span>
<span class="cm"> * since we don&#39;t know what&#39;s happen on PM control</span>
<span class="cm"> * on this workaround.</span>
<span class="cm"> */</span>
<span class="cp">#define USBCR1		0xe605810a</span>
<span class="cp">#define USBH		0xC6700000</span>
<span class="cp">#define USBH_USBCTR	0x10834</span>

<span class="k">struct</span> <span class="n">usbhsf_private</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">phy</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">usb24</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">pci</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">func</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">host</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">usbh_base</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">renesas_usbhs_platform_info</span> <span class="n">info</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define usbhsf_get_priv(pdev)				\</span>
<span class="cp">	container_of(renesas_usbhs_get_info(pdev),	\</span>
<span class="cp">		     struct usbhsf_private, info)</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">usbhsf_get_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">USBHS_GADGET</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">usbhsf_power_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">,</span>
			      <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">base</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usbhsf_private</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">usbhsf_get_priv</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Work around for USB Function.</span>
<span class="cm">	 * It needs USB host clock, and settings</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">enable</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * enable all the related usb clocks</span>
<span class="cm">		 * for usb workaround</span>
<span class="cm">		 */</span>
		<span class="n">clk_enable</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">usb24</span><span class="p">);</span>
		<span class="n">clk_enable</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">pci</span><span class="p">);</span>
		<span class="n">clk_enable</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">host</span><span class="p">);</span>
		<span class="n">clk_enable</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">func</span><span class="p">);</span>
		<span class="n">clk_enable</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">phy</span><span class="p">);</span>

		<span class="cm">/*</span>
<span class="cm">		 * set USBCR1</span>
<span class="cm">		 *</span>
<span class="cm">		 * Port1 is driven by USB function,</span>
<span class="cm">		 * Port2 is driven by USB HOST</span>
<span class="cm">		 * One HOST (Port1 or Port2 is HOST)</span>
<span class="cm">		 * USB PLL input clock = 24MHz</span>
<span class="cm">		 */</span>
		<span class="n">__raw_writew</span><span class="p">(</span><span class="mh">0xd750</span><span class="p">,</span> <span class="n">USBCR1</span><span class="p">);</span>
		<span class="n">mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

		<span class="cm">/*</span>
<span class="cm">		 * start USB Host</span>
<span class="cm">		 */</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0000000c</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbh_base</span> <span class="o">+</span> <span class="n">USBH_USBCTR</span><span class="p">);</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x00000008</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbh_base</span> <span class="o">+</span> <span class="n">USBH_USBCTR</span><span class="p">);</span>
		<span class="n">mdelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

		<span class="cm">/*</span>
<span class="cm">		 * USB PHY Power ON</span>
<span class="cm">		 */</span>
		<span class="n">__raw_writew</span><span class="p">(</span><span class="mh">0xd770</span><span class="p">,</span> <span class="n">USBCR1</span><span class="p">);</span>
		<span class="n">__raw_writew</span><span class="p">(</span><span class="mh">0x4000</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="mh">0x102</span><span class="p">);</span> <span class="cm">/* USBF :: SUSPMODE */</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="mh">0x0000010f</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbh_base</span> <span class="o">+</span> <span class="n">USBH_USBCTR</span><span class="p">);</span>
		<span class="n">__raw_writew</span><span class="p">(</span><span class="mh">0xd7c0</span><span class="p">,</span> <span class="n">USBCR1</span><span class="p">);</span> <span class="cm">/* GPIO */</span>

		<span class="n">clk_disable</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">phy</span><span class="p">);</span>
		<span class="n">clk_disable</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">func</span><span class="p">);</span>	<span class="cm">/* usb work around */</span>
		<span class="n">clk_disable</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">host</span><span class="p">);</span>	<span class="cm">/* usb work around */</span>
		<span class="n">clk_disable</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">pci</span><span class="p">);</span>		<span class="cm">/* usb work around */</span>
		<span class="n">clk_disable</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">usb24</span><span class="p">);</span>	<span class="cm">/* usb work around */</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">usbhsf_hardware_exit</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usbhsf_private</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">usbhsf_get_priv</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">phy</span><span class="p">))</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">phy</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">usb24</span><span class="p">))</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">usb24</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">pci</span><span class="p">))</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">pci</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">host</span><span class="p">))</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">host</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">func</span><span class="p">))</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">func</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbh_base</span><span class="p">)</span>
		<span class="n">iounmap</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbh_base</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">phy</span>	<span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">usb24</span>	<span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">pci</span>	<span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">host</span>	<span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">func</span>	<span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbh_base</span>	<span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">usbhsf_hardware_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usbhsf_private</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">usbhsf_get_priv</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">phy</span>	<span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;phy&quot;</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">usb24</span>	<span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;usb24&quot;</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">pci</span>	<span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;pci&quot;</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">func</span>	<span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;func&quot;</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">host</span>	<span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;host&quot;</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbh_base</span>	<span class="o">=</span> <span class="n">ioremap_nocache</span><span class="p">(</span><span class="n">USBH</span><span class="p">,</span> <span class="mh">0x20000</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">phy</span><span class="p">)</span>		<span class="o">||</span>
	    <span class="n">IS_ERR</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">usb24</span><span class="p">)</span>		<span class="o">||</span>
	    <span class="n">IS_ERR</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">pci</span><span class="p">)</span>		<span class="o">||</span>
	    <span class="n">IS_ERR</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">host</span><span class="p">)</span>		<span class="o">||</span>
	    <span class="n">IS_ERR</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">func</span><span class="p">)</span>		<span class="o">||</span>
	    <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbh_base</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;USB clock setting failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">usbhsf_hardware_exit</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* usb24 use 1/1 of parent clock (= usb24s = 24MHz) */</span>
	<span class="n">clk_set_rate</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">usb24</span><span class="p">,</span>
		     <span class="n">clk_get_rate</span><span class="p">(</span><span class="n">clk_get_parent</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">usb24</span><span class="p">)));</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">usbhsf_private</span> <span class="n">usbhsf_private</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_callback</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">get_id</span>		<span class="o">=</span> <span class="n">usbhsf_get_id</span><span class="p">,</span>
			<span class="p">.</span><span class="n">hardware_init</span>	<span class="o">=</span> <span class="n">usbhsf_hardware_init</span><span class="p">,</span>
			<span class="p">.</span><span class="n">hardware_exit</span>	<span class="o">=</span> <span class="n">usbhsf_hardware_exit</span><span class="p">,</span>
			<span class="p">.</span><span class="n">power_ctrl</span>	<span class="o">=</span> <span class="n">usbhsf_power_ctrl</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_param</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">buswait_bwait</span>		<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
			<span class="p">.</span><span class="n">detection_delay</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">usbhsf_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;USBHS&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe6890000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe6890104</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0A20</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">usbhsf_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;renesas_usbhs&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">usbhsf_private</span><span class="p">.</span><span class="n">info</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">usbhsf_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">usbhsf_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Ether */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_eth_plat_data</span> <span class="n">sh_eth_platdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy</span>			<span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* LAN8710A */</span>
	<span class="p">.</span><span class="n">edmac_endian</span>		<span class="o">=</span> <span class="n">EDMAC_LITTLE_ENDIAN</span><span class="p">,</span>
	<span class="p">.</span><span class="n">register_type</span>		<span class="o">=</span> <span class="n">SH_ETH_REG_GIGABIT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_interface</span>		<span class="o">=</span> <span class="n">PHY_INTERFACE_MODE_MII</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sh_eth_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe9a00000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe9a00800</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe9a01800</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe9a02000</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0500</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sh_eth_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;sh-eth&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sh_eth_platdata</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">sh_eth_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sh_eth_resources</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* LCDC */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">lcdc0_mode</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;AMPIER/AM-800480&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">xres</span>		<span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
	<span class="p">.</span><span class="n">yres</span>		<span class="o">=</span> <span class="mi">480</span><span class="p">,</span>
	<span class="p">.</span><span class="n">left_margin</span>	<span class="o">=</span> <span class="mi">88</span><span class="p">,</span>
	<span class="p">.</span><span class="n">right_margin</span>	<span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hsync_len</span>	<span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
	<span class="p">.</span><span class="n">upper_margin</span>	<span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
	<span class="p">.</span><span class="n">lower_margin</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vsync_len</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sync</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_lcdc_info</span> <span class="n">lcdc0_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">clock_source</span>	<span class="o">=</span> <span class="n">LCDC_CLK_BUS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan</span>		<span class="o">=</span> <span class="n">LCDC_CHAN_MAINLCD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fourcc</span>		<span class="o">=</span> <span class="n">V4L2_PIX_FMT_RGB565</span><span class="p">,</span>
		<span class="p">.</span><span class="n">interface_type</span>	<span class="o">=</span> <span class="n">RGB24</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_divider</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lcd_modes</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">lcdc0_mode</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_modes</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">panel_cfg</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">width</span>	<span class="o">=</span> <span class="mi">111</span><span class="p">,</span>
			<span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">68</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">lcdc0_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;LCD0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xfe940000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xfe943fff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">intcs_evt2irq</span><span class="p">(</span><span class="mh">0x580</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">lcdc0_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_lcdc_fb&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">lcdc0_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">lcdc0_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">lcdc0_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">coherent_dma_mask</span> <span class="o">=</span> <span class="o">~</span><span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* GPIO KEY */</span>
<span class="cp">#define GPIO_KEY(c, g, d) { .code = c, .gpio = g, .desc = d, .active_low = 1 }</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_keys_button</span> <span class="n">gpio_buttons</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">GPIO_KEY</span><span class="p">(</span><span class="n">KEY_POWER</span><span class="p">,</span>	<span class="n">GPIO_PORT99</span><span class="p">,</span>	<span class="s">&quot;SW1&quot;</span><span class="p">),</span>
	<span class="n">GPIO_KEY</span><span class="p">(</span><span class="n">KEY_BACK</span><span class="p">,</span>	<span class="n">GPIO_PORT100</span><span class="p">,</span>	<span class="s">&quot;SW2&quot;</span><span class="p">),</span>
	<span class="n">GPIO_KEY</span><span class="p">(</span><span class="n">KEY_MENU</span><span class="p">,</span>	<span class="n">GPIO_PORT97</span><span class="p">,</span>	<span class="s">&quot;SW3&quot;</span><span class="p">),</span>
	<span class="n">GPIO_KEY</span><span class="p">(</span><span class="n">KEY_HOME</span><span class="p">,</span>	<span class="n">GPIO_PORT98</span><span class="p">,</span>	<span class="s">&quot;SW4&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_keys_platform_data</span> <span class="n">gpio_key_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">buttons</span>	<span class="o">=</span> <span class="n">gpio_buttons</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nbuttons</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">gpio_buttons</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">gpio_keys_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>   <span class="o">=</span> <span class="s">&quot;gpio-keys&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>     <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>    <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">gpio_key_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* SDHI0 */</span>
<span class="cm">/*</span>
<span class="cm"> * FIXME</span>
<span class="cm"> *</span>
<span class="cm"> * It use polling mode here, since</span>
<span class="cm"> * CD (= Card Detect) pin is not connected to SDHI0_CD.</span>
<span class="cm"> * We can use IRQ31 as card detect irq,</span>
<span class="cm"> * but it needs chattering removal operation</span>
<span class="cm"> */</span>
<span class="cp">#define IRQ31	evt2irq(0x33E0)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_sdhi_info</span> <span class="n">sdhi0_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">tmio_caps</span>	<span class="o">=</span> <span class="n">MMC_CAP_SD_HIGHSPEED</span> <span class="o">|</span> <span class="n">MMC_CAP_SDIO_IRQ</span> <span class="o">|</span>\
			  <span class="n">MMC_CAP_NEEDS_POLL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_ocr_mask</span>	<span class="o">=</span> <span class="n">MMC_VDD_165_195</span> <span class="o">|</span> <span class="n">MMC_VDD_32_33</span> <span class="o">|</span> <span class="n">MMC_VDD_33_34</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_flags</span>	<span class="o">=</span> <span class="n">TMIO_MMC_HAS_IDLE_WAIT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sdhi0_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;SDHI0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe6850000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe6850100</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/*</span>
<span class="cm">	 * no SH_MOBILE_SDHI_IRQ_CARD_DETECT here</span>
<span class="cm">	 */</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="n">SH_MOBILE_SDHI_IRQ_SDCARD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0E20</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="n">SH_MOBILE_SDHI_IRQ_SDIO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0E40</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sdhi0_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_sdhi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">sdhi0_info</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sdhi0_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">sdhi0_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* SDHI1 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_sdhi_info</span> <span class="n">sdhi1_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">tmio_caps</span>	<span class="o">=</span> <span class="n">MMC_CAP_SD_HIGHSPEED</span> <span class="o">|</span> <span class="n">MMC_CAP_SDIO_IRQ</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_ocr_mask</span>	<span class="o">=</span> <span class="n">MMC_VDD_165_195</span> <span class="o">|</span> <span class="n">MMC_VDD_32_33</span> <span class="o">|</span> <span class="n">MMC_VDD_33_34</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_flags</span>	<span class="o">=</span> <span class="n">TMIO_MMC_HAS_IDLE_WAIT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sdhi1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;SDHI1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe6860000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe6860100</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0E80</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0EA0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0EC0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sdhi1_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_sdhi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">sdhi1_info</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sdhi1_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">sdhi1_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* MMCIF */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mmcif_plat_data</span> <span class="n">sh_mmcif_plat</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">sup_pclk</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ocr</span>		<span class="o">=</span> <span class="n">MMC_VDD_165_195</span> <span class="o">|</span> <span class="n">MMC_VDD_32_33</span> <span class="o">|</span> <span class="n">MMC_VDD_33_34</span><span class="p">,</span>
	<span class="p">.</span><span class="n">caps</span>		<span class="o">=</span> <span class="n">MMC_CAP_4_BIT_DATA</span> <span class="o">|</span>
			  <span class="n">MMC_CAP_8_BIT_DATA</span> <span class="o">|</span>
			  <span class="n">MMC_CAP_NONREMOVABLE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sh_mmcif_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;MMCIF&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe6bd0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe6bd0100</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* MMC ERR */</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x1AC0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* MMC NOR */</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x1AE0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sh_mmcif_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mmcif&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">sh_mmcif_plat</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sh_mmcif_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">sh_mmcif_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* I2C */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">i2c0_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;st1232-ts&quot;</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">),</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0340</span><span class="p">),</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * board devices</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">eva_devices</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">lcdc0_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">gpio_keys_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sh_eth_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sdhi0_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sh_mmcif_device</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">eva_clock_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">system</span>	<span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;system_clk&quot;</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">xtal1</span>	<span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;extal1&quot;</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">usb24s</span>	<span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;usb24s&quot;</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>	<span class="o">||</span>
	    <span class="n">IS_ERR</span><span class="p">(</span><span class="n">xtal1</span><span class="p">)</span>	<span class="o">||</span>
	    <span class="n">IS_ERR</span><span class="p">(</span><span class="n">usb24s</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;armadillo800eva board clock init failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">clock_error</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* armadillo 800 eva extal1 is 24MHz */</span>
	<span class="n">clk_set_rate</span><span class="p">(</span><span class="n">xtal1</span><span class="p">,</span> <span class="mi">24000000</span><span class="p">);</span>

	<span class="cm">/* usb24s use extal1 (= system) clock (= 24MHz) */</span>
	<span class="n">clk_set_parent</span><span class="p">(</span><span class="n">usb24s</span><span class="p">,</span> <span class="n">system</span><span class="p">);</span>

<span class="nl">clock_error:</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">system</span><span class="p">))</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">system</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">xtal1</span><span class="p">))</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">xtal1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">usb24s</span><span class="p">))</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">usb24s</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * board init</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">eva_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eva_clock_init</span><span class="p">();</span>

	<span class="n">r8a7740_pinmux_init</span><span class="p">();</span>

	<span class="cm">/* SCIFA1 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SCIFA1_RXD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SCIFA1_TXD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* LCDC0 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDC0_SELECT</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D0</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D1</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D2</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D3</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D4</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D5</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D6</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D7</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D8</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D9</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D10</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D11</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D12</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D13</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D14</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D15</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D16</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D17</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D18_PORT40</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D19_PORT4</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D20_PORT3</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D21_PORT2</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D22_PORT0</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D23_PORT1</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_DCK</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_VSYN</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_HSYN</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_DISP</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_LCLK_PORT165</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>

	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT61</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* LCDDON */</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT61</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT202</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* LCD0_LED_CONT */</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT202</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* Touchscreen */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_IRQ10</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* TP_INT */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT166</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* TP_RST_B */</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT166</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* GETHER */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_CRS</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_MDC</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_MDIO</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_TX_ER</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_RX_ER</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_ERXD0</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_ERXD1</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_ERXD2</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_ERXD3</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_TX_CLK</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_TX_EN</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_ETXD0</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_ETXD1</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_ETXD2</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_ETXD3</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_PHY_INT</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_COL</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_RX_DV</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_ET_RX_CLK</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>

	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT18</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* PHY_RST */</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT18</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* USB */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT159</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* USB_DEVICE_MODE */</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PORT159</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PORT159</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/* USB Host */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* USB Func */</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VBUS</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
		<span class="n">platform_device_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">usbhsf_device</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* SDHI0 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0_CMD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0_CLK</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0_D0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0_D1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0_D2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0_D3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0_WP</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT17</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>	<span class="cm">/* SDHI0_18/33_B */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT74</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>	<span class="cm">/* SDHI0_PON */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT75</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>	<span class="cm">/* SDSLOT1_PON */</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT17</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT74</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT75</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* we can use GPIO_FN_IRQ31_PORT167 here for SDHI0 CD irq */</span>

	<span class="cm">/*</span>
<span class="cm">	 * MMCIF</span>
<span class="cm">	 *</span>
<span class="cm">	 * Here doesn&#39;t care SW1.4 status,</span>
<span class="cm">	 * since CON2 is not mounted.</span>
<span class="cm">	 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC1_CLK_PORT103</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC1_CMD_PORT104</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC1_D0_PORT149</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC1_D1_PORT148</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC1_D2_PORT147</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC1_D3_PORT146</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC1_D4_PORT145</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC1_D5_PORT144</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC1_D6_PORT143</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC1_D7_PORT142</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * CAUTION</span>
<span class="cm">	 *</span>
<span class="cm">	 * DBGMD/LCDC0/FSIA MUX</span>
<span class="cm">	 * DBGMD_SELECT_B should be set after setting PFC Function.</span>
<span class="cm">	 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT176</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT176</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * We can switch CON8/CON14 by SW1.5,</span>
<span class="cm">	 * but it needs after DBGMD_SELECT_B</span>
<span class="cm">	 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT6</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PORT6</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PORT6</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/* CON14 enable */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* CON8 (SDHI1) enable */</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1_CLK</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1_CMD</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1_D0</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1_D1</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1_D2</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1_D3</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1_CD</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1_WP</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>

		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT16</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* SDSLOT2_PON */</span>
		<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT16</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

		<span class="n">platform_device_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sdhi1_device</span><span class="p">);</span>
	<span class="p">}</span>


<span class="cp">#ifdef CONFIG_CACHE_L2X0</span>
	<span class="cm">/* Early BRESP enable, Shared attribute override enable, 32K*8way */</span>
	<span class="n">l2x0_init</span><span class="p">(</span><span class="n">__io</span><span class="p">(</span><span class="mh">0xf0002000</span><span class="p">),</span> <span class="mh">0x40440000</span><span class="p">,</span> <span class="mh">0x82000fff</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i2c0_devices</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">i2c0_devices</span><span class="p">));</span>

	<span class="n">r8a7740_add_standard_devices</span><span class="p">();</span>

	<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">eva_devices</span><span class="p">,</span>
			     <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">eva_devices</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">eva_earlytimer_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">r8a7740_clock_init</span><span class="p">(</span><span class="n">MD_CK0</span> <span class="o">|</span> <span class="n">MD_CK2</span><span class="p">);</span>
	<span class="n">shmobile_earlytimer_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">eva_add_early_devices</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">r8a7740_add_early_devices</span><span class="p">();</span>

	<span class="cm">/* override timer setup with board-specific code */</span>
	<span class="n">shmobile_timer</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">eva_earlytimer_init</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">eva_boards_compat_dt</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;renesas,armadillo800eva&quot;</span><span class="p">,</span>
	<span class="nb">NULL</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">DT_MACHINE_START</span><span class="p">(</span><span class="n">ARMADILLO800EVA_DT</span><span class="p">,</span> <span class="s">&quot;armadillo800eva&quot;</span><span class="p">)</span>
	<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">r8a7740_map_io</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_early</span>	<span class="o">=</span> <span class="n">eva_add_early_devices</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>	<span class="o">=</span> <span class="n">r8a7740_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">handle_irq</span>	<span class="o">=</span> <span class="n">shmobile_handle_irq_intc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span>	<span class="o">=</span> <span class="n">eva_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_late</span>	<span class="o">=</span> <span class="n">shmobile_init_late</span><span class="p">,</span>
	<span class="p">.</span><span class="n">timer</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">shmobile_timer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dt_compat</span>	<span class="o">=</span> <span class="n">eva_boards_compat_dt</span><span class="p">,</span>
<span class="n">MACHINE_END</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
