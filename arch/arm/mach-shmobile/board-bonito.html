<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-shmobile › board-bonito.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>board-bonito.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * bonito board support</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2011 Renesas Solutions Corp.</span>
<span class="cm"> * Copyright (C) 2011 Kuninori Morimoto &lt;kuninori.morimoto.gx@renesas.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; version 2 of the License.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/irq.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/gpio.h&gt;</span>
<span class="cp">#include &lt;linux/smsc911x.h&gt;</span>
<span class="cp">#include &lt;linux/videodev2.h&gt;</span>
<span class="cp">#include &lt;mach/common.h&gt;</span>
<span class="cp">#include &lt;asm/mach-types.h&gt;</span>
<span class="cp">#include &lt;asm/mach/arch.h&gt;</span>
<span class="cp">#include &lt;asm/mach/map.h&gt;</span>
<span class="cp">#include &lt;asm/mach/time.h&gt;</span>
<span class="cp">#include &lt;asm/hardware/cache-l2x0.h&gt;</span>
<span class="cp">#include &lt;mach/r8a7740.h&gt;</span>
<span class="cp">#include &lt;mach/irqs.h&gt;</span>
<span class="cp">#include &lt;video/sh_mobile_lcdc.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * CS	Address		device			note</span>
<span class="cm"> *----------------------------------------------------------------</span>
<span class="cm"> * 0	0x0000_0000	NOR Flash (64MB)	SW12 : bit3 = OFF</span>
<span class="cm"> * 2	0x0800_0000	ExtNOR (64MB)		SW12 : bit3 = OFF</span>
<span class="cm"> * 4			-</span>
<span class="cm"> * 5A			-</span>
<span class="cm"> * 5B	0x1600_0000	SRAM (8MB)</span>
<span class="cm"> * 6	0x1800_0000	FPGA (64K)</span>
<span class="cm"> *	0x1801_0000	Ether (4KB)</span>
<span class="cm"> *	0x1801_1000	USB (4KB)</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * SW12</span>
<span class="cm"> *</span>
<span class="cm"> *	bit1			bit2			bit3</span>
<span class="cm"> *----------------------------------------------------------------------------</span>
<span class="cm"> * ON	NOR WriteProtect	NAND WriteProtect	CS0 ExtNOR / CS2 NOR</span>
<span class="cm"> * OFF	NOR Not WriteProtect	NAND Not WriteProtect	CS0 NOR    / CS2 ExtNOR</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * SCIFA5 (CN42)</span>
<span class="cm"> *</span>
<span class="cm"> * S38.3 = ON</span>
<span class="cm"> * S39.6 = ON</span>
<span class="cm"> * S43.1 = ON</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * LCDC0 (CN3/CN4/CN7)</span>
<span class="cm"> *</span>
<span class="cm"> * S38.1 = OFF</span>
<span class="cm"> * S38.2 = OFF</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * FPGA</span>
<span class="cm"> */</span>
<span class="cp">#define IRQSR0		0x0020</span>
<span class="cp">#define IRQSR1		0x0022</span>
<span class="cp">#define IRQMR0		0x0030</span>
<span class="cp">#define IRQMR1		0x0032</span>
<span class="cp">#define BUSSWMR1	0x0070</span>
<span class="cp">#define BUSSWMR2	0x0072</span>
<span class="cp">#define BUSSWMR3	0x0074</span>
<span class="cp">#define BUSSWMR4	0x0076</span>

<span class="cp">#define LCDCR		0x10B4</span>
<span class="cp">#define DEVRSTCR1	0x10D0</span>
<span class="cp">#define DEVRSTCR2	0x10D2</span>
<span class="cp">#define A1MDSR		0x10E0</span>
<span class="cp">#define BVERR		0x1100</span>

<span class="cm">/* FPGA IRQ */</span>
<span class="cp">#define FPGA_IRQ_BASE		(512)</span>
<span class="cp">#define FPGA_IRQ0		(FPGA_IRQ_BASE)</span>
<span class="cp">#define FPGA_IRQ1		(FPGA_IRQ_BASE + 16)</span>
<span class="cp">#define FPGA_ETH_IRQ		(FPGA_IRQ0 + 15)</span>
<span class="k">static</span> <span class="n">u16</span> <span class="nf">bonito_fpga_read</span><span class="p">(</span><span class="n">u32</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__raw_readw</span><span class="p">(</span><span class="mh">0xf0003000</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bonito_fpga_write</span><span class="p">(</span><span class="n">u32</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mh">0xf0003000</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bonito_fpga_irq_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span> <span class="o">=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="mi">1016</span><span class="p">)</span> <span class="o">?</span> <span class="n">IRQMR0</span> <span class="o">:</span> <span class="n">IRQMR1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">shift</span> <span class="o">=</span> <span class="n">irq</span> <span class="o">%</span> <span class="mi">16</span><span class="p">;</span>

	<span class="n">bonito_fpga_write</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">bonito_fpga_read</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bonito_fpga_irq_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">irq_data</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span> <span class="o">=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">irq</span> <span class="o">&lt;</span> <span class="mi">1016</span><span class="p">)</span> <span class="o">?</span> <span class="n">IRQMR0</span> <span class="o">:</span> <span class="n">IRQMR1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">shift</span> <span class="o">=</span> <span class="n">irq</span> <span class="o">%</span> <span class="mi">16</span><span class="p">;</span>

	<span class="n">bonito_fpga_write</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">bonito_fpga_read</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">irq_chip</span> <span class="n">bonito_fpga_irq_chip</span> <span class="n">__read_mostly</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;bonito FPGA&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_mask</span>	<span class="o">=</span> <span class="n">bonito_fpga_irq_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_unmask</span>	<span class="o">=</span> <span class="n">bonito_fpga_irq_enable</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bonito_fpga_irq_demux</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">irq_desc</span> <span class="o">*</span><span class="n">desc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span>  <span class="n">bonito_fpga_read</span><span class="p">(</span><span class="n">IRQSR1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span>
		   <span class="n">bonito_fpga_read</span><span class="p">(</span><span class="n">IRQSR0</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">bonito_fpga_read</span><span class="p">(</span><span class="n">IRQMR1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span>
		   <span class="n">bonito_fpga_read</span><span class="p">(</span><span class="n">IRQMR0</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)))</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="n">generic_handle_irq</span><span class="p">(</span><span class="n">FPGA_IRQ_BASE</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bonito_fpga_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">bonito_fpga_write</span><span class="p">(</span><span class="n">IRQMR0</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">);</span> <span class="cm">/* mask all */</span>
	<span class="n">bonito_fpga_write</span><span class="p">(</span><span class="n">IRQMR1</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">);</span> <span class="cm">/* mask all */</span>

	<span class="cm">/* Device reset */</span>
	<span class="n">bonito_fpga_write</span><span class="p">(</span><span class="n">DEVRSTCR1</span><span class="p">,</span>
		   <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>	<span class="cm">/* Eth */</span>

	<span class="cm">/* FPGA irq require special handling */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">FPGA_IRQ_BASE</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">FPGA_IRQ_BASE</span> <span class="o">+</span> <span class="mi">32</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">irq_set_chip_and_handler_name</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bonito_fpga_irq_chip</span><span class="p">,</span>
					      <span class="n">handle_level_irq</span><span class="p">,</span> <span class="s">&quot;level&quot;</span><span class="p">);</span>
		<span class="n">set_irq_flags</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">IRQF_VALID</span><span class="p">);</span> <span class="cm">/* yuck */</span>
	<span class="p">}</span>

	<span class="n">irq_set_chained_handler</span><span class="p">(</span><span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0340</span><span class="p">),</span> <span class="n">bonito_fpga_irq_demux</span><span class="p">);</span>
	<span class="n">irq_set_irq_type</span><span class="p">(</span><span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0340</span><span class="p">),</span> <span class="n">IRQ_TYPE_LEVEL_LOW</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">* PMIC settings</span>
<span class="cm">*</span>
<span class="cm">* FIXME</span>
<span class="cm">*</span>
<span class="cm">* bonito board needs some settings by pmic which use i2c access.</span>
<span class="cm">* pmic settings use device_initcall() here for use it.</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">pmic_settings</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="k">static</span> <span class="n">__u8</span> <span class="n">pmic_do_2A</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x1C</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span>
	<span class="mh">0x1A</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">pmic_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="n">i2c_get_adapter</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pmic_settings</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">msg</span><span class="p">.</span><span class="n">addr</span>	<span class="o">=</span> <span class="mh">0x46</span><span class="p">;</span>
	<span class="n">msg</span><span class="p">.</span><span class="n">buf</span>		<span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
	<span class="n">msg</span><span class="p">.</span><span class="n">len</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">msg</span><span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmic_settings</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">0</span><span class="p">];</span>
		<span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pmic_settings</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>

		<span class="k">if</span> <span class="p">((</span><span class="mh">0xff</span> <span class="o">==</span> <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">==</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="n">ret</span> <span class="o">=</span> <span class="n">i2c_transfer</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;i2c transfer fail</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">device_initcall</span><span class="p">(</span><span class="n">pmic_init</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * LCDC0</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">lcdc0_mode</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;WVGA Panel&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">xres</span>		<span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
	<span class="p">.</span><span class="n">yres</span>		<span class="o">=</span> <span class="mi">480</span><span class="p">,</span>
	<span class="p">.</span><span class="n">left_margin</span>	<span class="o">=</span> <span class="mi">88</span><span class="p">,</span>
	<span class="p">.</span><span class="n">right_margin</span>	<span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hsync_len</span>	<span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
	<span class="p">.</span><span class="n">upper_margin</span>	<span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
	<span class="p">.</span><span class="n">lower_margin</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vsync_len</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sync</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_lcdc_info</span> <span class="n">lcdc0_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">clock_source</span>	<span class="o">=</span> <span class="n">LCDC_CLK_BUS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan</span>			<span class="o">=</span> <span class="n">LCDC_CHAN_MAINLCD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fourcc</span> <span class="o">=</span> <span class="n">V4L2_PIX_FMT_RGB565</span><span class="p">,</span>
		<span class="p">.</span><span class="n">interface_type</span>		<span class="o">=</span> <span class="n">RGB24</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_divider</span>		<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lcd_modes</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">lcdc0_mode</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_modes</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">panel_cfg</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">width</span>	<span class="o">=</span> <span class="mi">152</span><span class="p">,</span>
			<span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">91</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">lcdc0_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;LCDC0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xfe940000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xfe943fff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">intcs_evt2irq</span><span class="p">(</span><span class="mh">0x0580</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">lcdc0_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_lcdc_fb&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">lcdc0_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">lcdc0_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">lcdc0_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">coherent_dma_mask</span> <span class="o">=</span> <span class="o">~</span><span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * SMSC 9221</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">smsc_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>		<span class="o">=</span> <span class="mh">0x18010000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>		<span class="o">=</span> <span class="mh">0x18011000</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>		<span class="o">=</span> <span class="n">FPGA_ETH_IRQ</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">smsc911x_platform_config</span> <span class="n">smsc_platdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">SMSC911X_USE_16BIT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_interface</span>	<span class="o">=</span> <span class="n">PHY_INTERFACE_MODE_MII</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_polarity</span>	<span class="o">=</span> <span class="n">SMSC911X_IRQ_POLARITY_ACTIVE_LOW</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_type</span>	<span class="o">=</span> <span class="n">SMSC911X_IRQ_TYPE_PUSH_PULL</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">smsc_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;smsc911x&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>  <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">smsc_platdata</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">smsc_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">smsc_resources</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * core board devices</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">bonito_core_devices</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * base board devices</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">bonito_base_devices</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">lcdc0_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">smsc_device</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * map I/O</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">map_desc</span> <span class="n">bonito_io_desc</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * for FPGA (0x1800000-0x19ffffff)</span>
<span class="cm">	 * 0x18000000-0x18002000 -&gt; 0xf0003000-0xf0005000</span>
<span class="cm">	 */</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="k">virtual</span>	<span class="o">=</span> <span class="mh">0xf0003000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pfn</span>		<span class="o">=</span> <span class="n">__phys_to_pfn</span><span class="p">(</span><span class="mh">0x18000000</span><span class="p">),</span>
		<span class="p">.</span><span class="n">length</span>		<span class="o">=</span> <span class="n">PAGE_SIZE</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="n">MT_DEVICE_NONSHARED</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">bonito_map_io</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">r8a7740_map_io</span><span class="p">();</span>
	<span class="n">iotable_init</span><span class="p">(</span><span class="n">bonito_io_desc</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bonito_io_desc</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * board init</span>
<span class="cm"> */</span>
<span class="cp">#define BIT_ON(sw, bit)		(sw &amp; (1 &lt;&lt; bit))</span>
<span class="cp">#define BIT_OFF(sw, bit)	(!(sw &amp; (1 &lt;&lt; bit)))</span>

<span class="cp">#define VCCQ1CR		0xE6058140</span>
<span class="cp">#define VCCQ1LCDCR	0xE6058186</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">bonito_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">r8a7740_pinmux_init</span><span class="p">();</span>
	<span class="n">bonito_fpga_init</span><span class="p">();</span>

	<span class="n">pmic_settings</span> <span class="o">=</span> <span class="n">pmic_do_2A</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * core board settings</span>
<span class="cm">	 */</span>

<span class="cp">#ifdef CONFIG_CACHE_L2X0</span>
	<span class="cm">/* Early BRESP enable, Shared attribute override enable, 32K*8way */</span>
	<span class="n">l2x0_init</span><span class="p">(</span><span class="n">IOMEM</span><span class="p">(</span><span class="mh">0xf0002000</span><span class="p">),</span> <span class="mh">0x40440000</span><span class="p">,</span> <span class="mh">0x82000fff</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="n">r8a7740_add_standard_devices</span><span class="p">();</span>

	<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">bonito_core_devices</span><span class="p">,</span>
			     <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bonito_core_devices</span><span class="p">));</span>

	<span class="cm">/*</span>
<span class="cm">	 * base board settings</span>
<span class="cm">	 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT176</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PORT176</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PORT176</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">bsw2</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">bsw3</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">bsw4</span><span class="p">;</span>

		<span class="cm">/*</span>
<span class="cm">		 * FPGA</span>
<span class="cm">		 */</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_CS5B</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_CS6A</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_CS5A_PORT105</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_IRQ10</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>

		<span class="n">val</span> <span class="o">=</span> <span class="n">bonito_fpga_read</span><span class="p">(</span><span class="n">BVERR</span><span class="p">);</span>
		<span class="n">pr_info</span><span class="p">(</span><span class="s">&quot;bonito version: cpu %02x, base %02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="p">((</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">),</span>
			<span class="p">((</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">));</span>

		<span class="n">bsw2</span> <span class="o">=</span> <span class="n">bonito_fpga_read</span><span class="p">(</span><span class="n">BUSSWMR2</span><span class="p">);</span>
		<span class="n">bsw3</span> <span class="o">=</span> <span class="n">bonito_fpga_read</span><span class="p">(</span><span class="n">BUSSWMR3</span><span class="p">);</span>
		<span class="n">bsw4</span> <span class="o">=</span> <span class="n">bonito_fpga_read</span><span class="p">(</span><span class="n">BUSSWMR4</span><span class="p">);</span>

		<span class="cm">/*</span>
<span class="cm">		 * SCIFA5 (CN42)</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">BIT_OFF</span><span class="p">(</span><span class="n">bsw2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span>	<span class="cm">/* S38.3 = ON */</span>
		    <span class="n">BIT_OFF</span><span class="p">(</span><span class="n">bsw3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">&amp;&amp;</span>	<span class="cm">/* S39.6 = ON */</span>
		    <span class="n">BIT_OFF</span><span class="p">(</span><span class="n">bsw4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="p">{</span>	<span class="cm">/* S43.1 = ON */</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SCIFA5_TXD_PORT91</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SCIFA5_RXD_PORT92</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/*</span>
<span class="cm">		 * LCDC0 (CN3)</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">BIT_ON</span><span class="p">(</span><span class="n">bsw2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span>	<span class="cm">/* S38.1 = OFF */</span>
		    <span class="n">BIT_ON</span><span class="p">(</span><span class="n">bsw2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>	<span class="cm">/* S38.2 = OFF */</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDC0_SELECT</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D0</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D1</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D2</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D3</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D4</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D5</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D6</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D7</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D8</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D9</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D10</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D11</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D12</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D13</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D14</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D15</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D16</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D17</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D18_PORT163</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D19_PORT162</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D20_PORT161</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D21_PORT158</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D22_PORT160</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_D23_PORT159</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_DCK</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_VSYN</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_HSYN</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_DISP</span><span class="p">,</span>		<span class="nb">NULL</span><span class="p">);</span>
			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCD0_LCLK_PORT165</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>

			<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT61</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* LCDDON */</span>
			<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT61</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

			<span class="cm">/* backlight on */</span>
			<span class="n">bonito_fpga_write</span><span class="p">(</span><span class="n">LCDCR</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

			<span class="cm">/*  drivability Max */</span>
			<span class="n">__raw_writew</span><span class="p">(</span><span class="mh">0x00FF</span> <span class="p">,</span> <span class="n">VCCQ1LCDCR</span><span class="p">);</span>
			<span class="n">__raw_writew</span><span class="p">(</span><span class="mh">0xFFFF</span> <span class="p">,</span> <span class="n">VCCQ1CR</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">bonito_base_devices</span><span class="p">,</span>
				     <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bonito_base_devices</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">bonito_earlytimer_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">md_ck</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* read MD_CK value */</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">bonito_fpga_read</span><span class="p">(</span><span class="n">A1MDSR</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">))</span>
		<span class="n">md_ck</span> <span class="o">|=</span> <span class="n">MD_CK2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">))</span>
		<span class="n">md_ck</span> <span class="o">|=</span> <span class="n">MD_CK1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">))</span>
		<span class="n">md_ck</span> <span class="o">|=</span> <span class="n">MD_CK0</span><span class="p">;</span>

	<span class="n">r8a7740_clock_init</span><span class="p">(</span><span class="n">md_ck</span><span class="p">);</span>
	<span class="n">shmobile_earlytimer_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">bonito_add_early_devices</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">r8a7740_add_early_devices</span><span class="p">();</span>

	<span class="cm">/* override timer setup with board-specific code */</span>
	<span class="n">shmobile_timer</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">bonito_earlytimer_init</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">MACHINE_START</span><span class="p">(</span><span class="n">BONITO</span><span class="p">,</span> <span class="s">&quot;bonito&quot;</span><span class="p">)</span>
	<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">bonito_map_io</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_early</span>	<span class="o">=</span> <span class="n">bonito_add_early_devices</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>	<span class="o">=</span> <span class="n">r8a7740_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">handle_irq</span>	<span class="o">=</span> <span class="n">shmobile_handle_irq_intc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span>	<span class="o">=</span> <span class="n">bonito_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_late</span>	<span class="o">=</span> <span class="n">shmobile_init_late</span><span class="p">,</span>
	<span class="p">.</span><span class="n">timer</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">shmobile_timer</span><span class="p">,</span>
<span class="n">MACHINE_END</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
