<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-shmobile › board-mackerel.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>board-mackerel.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * mackerel board support</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2010 Renesas Solutions Corp.</span>
<span class="cm"> * Kuninori Morimoto &lt;kuninori.morimoto.gx@renesas.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * based on ap4evb</span>
<span class="cm"> * Copyright (C) 2010  Magnus Damm</span>
<span class="cm"> * Copyright (C) 2008  Yoshihiro Shimoda</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; version 2 of the License.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<span class="cm"> */</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/irq.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/gpio.h&gt;</span>
<span class="cp">#include &lt;linux/input.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/leds.h&gt;</span>
<span class="cp">#include &lt;linux/mfd/tmio.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/host.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/sh_mmcif.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/sh_mobile_sdhi.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/mtd.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/partitions.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/physmap.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/sh_flctl.h&gt;</span>
<span class="cp">#include &lt;linux/pm_clock.h&gt;</span>
<span class="cp">#include &lt;linux/smsc911x.h&gt;</span>
<span class="cp">#include &lt;linux/sh_intc.h&gt;</span>
<span class="cp">#include &lt;linux/tca6416_keypad.h&gt;</span>
<span class="cp">#include &lt;linux/usb/renesas_usbhs.h&gt;</span>
<span class="cp">#include &lt;linux/dma-mapping.h&gt;</span>

<span class="cp">#include &lt;video/sh_mobile_hdmi.h&gt;</span>
<span class="cp">#include &lt;video/sh_mobile_lcdc.h&gt;</span>
<span class="cp">#include &lt;media/sh_mobile_ceu.h&gt;</span>
<span class="cp">#include &lt;media/soc_camera.h&gt;</span>
<span class="cp">#include &lt;media/soc_camera_platform.h&gt;</span>
<span class="cp">#include &lt;sound/sh_fsi.h&gt;</span>
<span class="cp">#include &lt;sound/simple_card.h&gt;</span>

<span class="cp">#include &lt;mach/common.h&gt;</span>
<span class="cp">#include &lt;mach/irqs.h&gt;</span>
<span class="cp">#include &lt;mach/sh7372.h&gt;</span>

<span class="cp">#include &lt;asm/mach/arch.h&gt;</span>
<span class="cp">#include &lt;asm/mach-types.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Address	Interface		BusWidth	note</span>
<span class="cm"> * ------------------------------------------------------------------</span>
<span class="cm"> * 0x0000_0000	NOR Flash ROM (MCP)	16bit		SW7 : bit1 = ON</span>
<span class="cm"> * 0x0800_0000	user area		-</span>
<span class="cm"> * 0x1000_0000	NOR Flash ROM (MCP)	16bit		SW7 : bit1 = OFF</span>
<span class="cm"> * 0x1400_0000	Ether (LAN9220)		16bit</span>
<span class="cm"> * 0x1600_0000	user area		-		cannot use with NAND</span>
<span class="cm"> * 0x1800_0000	user area		-</span>
<span class="cm"> * 0x1A00_0000	-</span>
<span class="cm"> * 0x4000_0000	LPDDR2-SDRAM (POP)	32bit</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * CPU mode</span>
<span class="cm"> *</span>
<span class="cm"> * SW4                                     | Boot Area| Master   | Remarks</span>
<span class="cm"> *  1  | 2   | 3   | 4   | 5   | 6   | 8   |          | Processor|</span>
<span class="cm"> * ----+-----+-----+-----+-----+-----+-----+----------+----------+--------------</span>
<span class="cm"> * ON  | ON  | OFF | ON  | ON  | OFF | OFF | External | System   | External ROM</span>
<span class="cm"> * ON  | ON  | ON  | ON  | ON  | OFF | OFF | External | System   | ROM Debug</span>
<span class="cm"> * ON  | ON  | X   | ON  | OFF | OFF | OFF | Built-in | System   | ROM Debug</span>
<span class="cm"> * X   | OFF | X   | X   | X   | X   | OFF | Built-in | System   | MaskROM</span>
<span class="cm"> * OFF | X   | X   | X   | X   | X   | OFF | Built-in | System   | MaskROM</span>
<span class="cm"> * X   | X   | X   | OFF | X   | X   | OFF | Built-in | System   | MaskROM</span>
<span class="cm"> * OFF | ON  | OFF | X   | X   | OFF | ON  | External | System   | Standalone</span>
<span class="cm"> * ON  | OFF | OFF | X   | X   | OFF | ON  | External | Realtime | Standalone</span>
<span class="cm">*/</span>

<span class="cm">/*</span>
<span class="cm"> * NOR Flash ROM</span>
<span class="cm"> *</span>
<span class="cm"> *  SW1  |     SW2    | SW7  | NOR Flash ROM</span>
<span class="cm"> *  bit1 | bit1  bit2 | bit1 | Memory allocation</span>
<span class="cm"> * ------+------------+------+------------------</span>
<span class="cm"> *  OFF  | ON     OFF | ON   |    Area 0</span>
<span class="cm"> *  OFF  | ON     OFF | OFF  |    Area 4</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * SMSC 9220</span>
<span class="cm"> *</span>
<span class="cm"> *  SW1		SMSC 9220</span>
<span class="cm"> * -----------------------</span>
<span class="cm"> *  ON		access disable</span>
<span class="cm"> *  OFF		access enable</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * NAND Flash ROM</span>
<span class="cm"> *</span>
<span class="cm"> *  SW1  |     SW2    | SW7  | NAND Flash ROM</span>
<span class="cm"> *  bit1 | bit1  bit2 | bit2 | Memory allocation</span>
<span class="cm"> * ------+------------+------+------------------</span>
<span class="cm"> *  OFF  | ON     OFF | ON   |    FCE 0</span>
<span class="cm"> *  OFF  | ON     OFF | OFF  |    FCE 1</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * External interrupt pin settings</span>
<span class="cm"> *</span>
<span class="cm"> * IRQX  | pin setting        | device             | level</span>
<span class="cm"> * ------+--------------------+--------------------+-------</span>
<span class="cm"> * IRQ0  | ICR1A.IRQ0SA=0010  | SDHI2 card detect  | Low</span>
<span class="cm"> * IRQ6  | ICR1A.IRQ6SA=0011  | Ether(LAN9220)     | High</span>
<span class="cm"> * IRQ7  | ICR1A.IRQ7SA=0010  | LCD Touch Panel    | Low</span>
<span class="cm"> * IRQ8  | ICR2A.IRQ8SA=0010  | MMC/SD card detect | Low</span>
<span class="cm"> * IRQ9  | ICR2A.IRQ9SA=0010  | KEY(TCA6408)       | Low</span>
<span class="cm"> * IRQ21 | ICR4A.IRQ21SA=0011 | Sensor(ADXL345)    | High</span>
<span class="cm"> * IRQ22 | ICR4A.IRQ22SA=0011 | Sensor(AK8975)     | High</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * USB</span>
<span class="cm"> *</span>
<span class="cm"> * USB0 : CN22 : Function</span>
<span class="cm"> * USB1 : CN31 : Function/Host *1</span>
<span class="cm"> *</span>
<span class="cm"> * J30 (for CN31) *1</span>
<span class="cm"> * ----------+---------------+-------------</span>
<span class="cm"> * 1-2 short | VBUS 5V       | Host</span>
<span class="cm"> * open      | external VBUS | Function</span>
<span class="cm"> *</span>
<span class="cm"> * CAUTION</span>
<span class="cm"> *</span>
<span class="cm"> * renesas_usbhs driver can use external interrupt mode</span>
<span class="cm"> * (which come from USB-PHY) or autonomy mode (it use own interrupt)</span>
<span class="cm"> * for detecting connection/disconnection when Function.</span>
<span class="cm"> * USB will be power OFF while it has been disconnecting</span>
<span class="cm"> * if external interrupt mode, and it is always power ON if autonomy mode,</span>
<span class="cm"> *</span>
<span class="cm"> * mackerel can not use external interrupt (IRQ7-PORT167) mode on &quot;USB0&quot;,</span>
<span class="cm"> * because Touchscreen is using IRQ7-PORT40.</span>
<span class="cm"> * It is impossible to use IRQ7 demux on this board.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * SDHI0 (CN12)</span>
<span class="cm"> *</span>
<span class="cm"> * SW56 : OFF</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/* MMC /SDHI1 (CN7)</span>
<span class="cm"> *</span>
<span class="cm"> * I/O voltage : 1.8v</span>
<span class="cm"> *</span>
<span class="cm"> * Power voltage : 1.8v or 3.3v</span>
<span class="cm"> *  J22 : select power voltage *1</span>
<span class="cm"> *	1-2 pin : 1.8v</span>
<span class="cm"> *	2-3 pin : 3.3v</span>
<span class="cm"> *</span>
<span class="cm"> * *1</span>
<span class="cm"> * Please change J22 depends the card to be used.</span>
<span class="cm"> * MMC&#39;s OCR field set to support either voltage for the card inserted.</span>
<span class="cm"> *</span>
<span class="cm"> *	SW1	|	SW33</span>
<span class="cm"> *		| bit1 | bit2 | bit3 | bit4</span>
<span class="cm"> * -------------+------+------+------+-------</span>
<span class="cm"> * MMC0   OFF	|  OFF |   X  |  ON  |  X       (Use MMCIF)</span>
<span class="cm"> * SDHI1  OFF	|  ON  |   X  |  OFF |  X       (Use MFD_SH_MOBILE_SDHI)</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * SDHI2 (CN23)</span>
<span class="cm"> *</span>
<span class="cm"> * microSD card sloct</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * FSI - AK4642</span>
<span class="cm"> *</span>
<span class="cm"> * it needs amixer settings for playing</span>
<span class="cm"> *</span>
<span class="cm"> * amixer set &quot;Headphone&quot; on</span>
<span class="cm"> * amixer set &quot;HPOUTL Mixer DACH&quot; on</span>
<span class="cm"> * amixer set &quot;HPOUTR Mixer DACH&quot; on</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * FIXME !!</span>
<span class="cm"> *</span>
<span class="cm"> * gpio_no_direction</span>
<span class="cm"> * gpio_pull_down</span>
<span class="cm"> * are quick_hack.</span>
<span class="cm"> *</span>
<span class="cm"> * current gpio frame work doesn&#39;t have</span>
<span class="cm"> * the method to control only pull up/down/free.</span>
<span class="cm"> * this function should be replaced by correct gpio function</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">gpio_no_direction</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__raw_writeb</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">gpio_pull_down</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">data</span> <span class="o">=</span> <span class="n">__raw_readb</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>

	<span class="n">data</span> <span class="o">&amp;=</span> <span class="mh">0x0F</span><span class="p">;</span>
	<span class="n">data</span> <span class="o">|=</span> <span class="mh">0xA0</span><span class="p">;</span>

	<span class="n">__raw_writeb</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* MTD */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mtd_partition</span> <span class="n">nor_flash_partitions</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;loader&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>		<span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>		<span class="o">=</span> <span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mask_flags</span>	<span class="o">=</span> <span class="n">MTD_WRITEABLE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;bootenv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>		<span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>		<span class="o">=</span> <span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mask_flags</span>	<span class="o">=</span> <span class="n">MTD_WRITEABLE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;kernel_ro&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>		<span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>		<span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mask_flags</span>	<span class="o">=</span> <span class="n">MTD_WRITEABLE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;kernel&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>		<span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>		<span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;data&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>		<span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>		<span class="o">=</span> <span class="n">MTDPART_SIZ_FULL</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">physmap_flash_data</span> <span class="n">nor_flash_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">width</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parts</span>		<span class="o">=</span> <span class="n">nor_flash_partitions</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nr_parts</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">nor_flash_partitions</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">nor_flash_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0x20000000</span><span class="p">,</span> <span class="cm">/* CS0 shadow instead of regular CS0 */</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0x28000000</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="cm">/* needed by USB MASK ROM boot */</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">nor_flash_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;physmap-flash&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">nor_flash_data</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">nor_flash_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">nor_flash_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* SMSC */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">smc911x_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0x14000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0x16000000</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x02c0</span><span class="p">)</span> <span class="cm">/* IRQ6A */</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span> <span class="o">|</span> <span class="n">IORESOURCE_IRQ_LOWLEVEL</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">smsc911x_platform_config</span> <span class="n">smsc911x_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">SMSC911X_USE_16BIT</span> <span class="o">|</span> <span class="n">SMSC911X_SAVE_MAC_ADDRESS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_polarity</span>   <span class="o">=</span> <span class="n">SMSC911X_IRQ_POLARITY_ACTIVE_LOW</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_type</span>       <span class="o">=</span> <span class="n">SMSC911X_IRQ_TYPE_PUSH_PULL</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">smc911x_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;smsc911x&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>             <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>  <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">smc911x_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>       <span class="o">=</span> <span class="n">smc911x_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>            <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">smsc911x_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* MERAM */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_meram_info</span> <span class="n">mackerel_meram_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">addr_mode</span>	<span class="o">=</span> <span class="n">SH_MOBILE_MERAM_MODE1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">meram_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;regs&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe8000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe807ffff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;meram&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe8080000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe81fffff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">meram_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_meram&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">meram_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">meram_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mackerel_meram_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* LCDC */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">mackerel_lcdc_modes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;WVGA Panel&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xres</span>		<span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
		<span class="p">.</span><span class="n">yres</span>		<span class="o">=</span> <span class="mi">480</span><span class="p">,</span>
		<span class="p">.</span><span class="n">left_margin</span>	<span class="o">=</span> <span class="mi">220</span><span class="p">,</span>
		<span class="p">.</span><span class="n">right_margin</span>	<span class="o">=</span> <span class="mi">110</span><span class="p">,</span>
		<span class="p">.</span><span class="n">hsync_len</span>	<span class="o">=</span> <span class="mi">70</span><span class="p">,</span>
		<span class="p">.</span><span class="n">upper_margin</span>	<span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lower_margin</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vsync_len</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sync</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mackerel_set_brightness</span><span class="p">(</span><span class="kt">int</span> <span class="n">brightness</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PORT31</span><span class="p">,</span> <span class="n">brightness</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mackerel_get_brightness</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PORT31</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sh_mobile_meram_cfg</span> <span class="n">lcd_meram_cfg</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">icb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">meram_size</span>     <span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">icb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">meram_size</span>     <span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_lcdc_info</span> <span class="n">lcdc_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">meram_dev</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mackerel_meram_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clock_source</span> <span class="o">=</span> <span class="n">LCDC_CLK_BUS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan</span> <span class="o">=</span> <span class="n">LCDC_CHAN_MAINLCD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fourcc</span> <span class="o">=</span> <span class="n">V4L2_PIX_FMT_RGB565</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lcd_modes</span> <span class="o">=</span> <span class="n">mackerel_lcdc_modes</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_modes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mackerel_lcdc_modes</span><span class="p">),</span>
		<span class="p">.</span><span class="n">interface_type</span>		<span class="o">=</span> <span class="n">RGB24</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_divider</span>		<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">panel_cfg</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">width</span>		<span class="o">=</span> <span class="mi">152</span><span class="p">,</span>
			<span class="p">.</span><span class="n">height</span>		<span class="o">=</span> <span class="mi">91</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">bl_info</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;sh_mobile_lcdc_bl&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_brightness</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">set_brightness</span> <span class="o">=</span> <span class="n">mackerel_set_brightness</span><span class="p">,</span>
			<span class="p">.</span><span class="n">get_brightness</span> <span class="o">=</span> <span class="n">mackerel_get_brightness</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">meram_cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">lcd_meram_cfg</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">lcdc_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;LCDC&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xfe940000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xfe943fff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">intcs_evt2irq</span><span class="p">(</span><span class="mh">0x580</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">lcdc_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_lcdc_fb&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">lcdc_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">lcdc_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">lcdc_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">coherent_dma_mask</span> <span class="o">=</span> <span class="o">~</span><span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* HDMI */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_hdmi_info</span> <span class="n">hdmi_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">HDMI_SND_SRC_SPDIF</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">hdmi_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;HDMI&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe6be0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe6be00ff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* There&#39;s also an HDMI interrupt on INTCS @ 0x18e0 */</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x17e0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">hdmi_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh-mobile-hdmi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">hdmi_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">hdmi_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>             <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">hdmi_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sh_mobile_meram_cfg</span> <span class="n">hdmi_meram_cfg</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">icb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">meram_size</span>     <span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">icb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">meram_size</span>     <span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_lcdc_info</span> <span class="n">hdmi_lcdc_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">meram_dev</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mackerel_meram_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clock_source</span> <span class="o">=</span> <span class="n">LCDC_CLK_EXTERNAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">chan</span> <span class="o">=</span> <span class="n">LCDC_CHAN_MAINLCD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fourcc</span> <span class="o">=</span> <span class="n">V4L2_PIX_FMT_RGB565</span><span class="p">,</span>
		<span class="p">.</span><span class="n">interface_type</span> <span class="o">=</span> <span class="n">RGB24</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_divider</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">LCDC_FLAGS_DWPOL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">meram_cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hdmi_meram_cfg</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_dev</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hdmi_device</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">hdmi_lcdc_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;LCDC1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xfe944000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xfe947fff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">intcs_evt2irq</span><span class="p">(</span><span class="mh">0x1780</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">hdmi_lcdc_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_lcdc_fb&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">hdmi_lcdc_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">hdmi_lcdc_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">hdmi_lcdc_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">coherent_dma_mask</span> <span class="o">=</span> <span class="o">~</span><span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">asoc_simple_dai_init_info</span> <span class="n">fsi2_hdmi_init_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">cpu_daifmt</span>	<span class="o">=</span> <span class="n">SND_SOC_DAIFMT_CBM_CFM</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">asoc_simple_card_info</span> <span class="n">fsi2_hdmi_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;HDMI&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">card</span>		<span class="o">=</span> <span class="s">&quot;FSI2B-HDMI&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cpu_dai</span>	<span class="o">=</span> <span class="s">&quot;fsib-dai&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">codec</span>		<span class="o">=</span> <span class="s">&quot;sh-mobile-hdmi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">platform</span>	<span class="o">=</span> <span class="s">&quot;sh_fsi2&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">codec_dai</span>	<span class="o">=</span> <span class="s">&quot;sh_mobile_hdmi-hifi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">fsi2_hdmi_init_info</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">fsi_hdmi_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;asoc-simple-card&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">fsi2_hdmi_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">hdmi_init_pm_clock</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">hdmi_ick</span> <span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdmi_device</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;ick&quot;</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">rate</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">hdmi_ick</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">PTR_ERR</span><span class="p">(</span><span class="n">hdmi_ick</span><span class="p">);</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Cannot get HDMI ICK: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">clk_set_parent</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_pllc2_clk</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sh7372_dv_clki_div2_clk</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Cannot set PLLC2 parent: %d, %d users</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">ret</span><span class="p">,</span> <span class="n">sh7372_pllc2_clk</span><span class="p">.</span><span class="n">usecount</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;PLLC2 initial frequency %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		 <span class="n">clk_get_rate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_pllc2_clk</span><span class="p">));</span>

	<span class="n">rate</span> <span class="o">=</span> <span class="n">clk_round_rate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_pllc2_clk</span><span class="p">,</span> <span class="mi">594000000</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Cannot get suitable rate: %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">rate</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">clk_set_rate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_pllc2_clk</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Cannot set rate %ld: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;PLLC2 set frequency %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">clk_set_parent</span><span class="p">(</span><span class="n">hdmi_ick</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sh7372_pllc2_clk</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Cannot set HDMI parent: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>

<span class="nl">out:</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">hdmi_ick</span><span class="p">))</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">hdmi_ick</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* USBHS0 is connected to CN22 which takes a USB Mini-B plug</span>
<span class="cm"> *</span>
<span class="cm"> * The sh7372 SoC has IRQ7 set aside for USBHS0 hotplug,</span>
<span class="cm"> * but on this particular board IRQ7 is already used by</span>
<span class="cm"> * the touch screen. This leaves us with software polling.</span>
<span class="cm"> */</span>
<span class="cp">#define USBHS0_POLL_INTERVAL (HZ * 5)</span>

<span class="k">struct</span> <span class="n">usbhs_private</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">usbphyaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">usbcrcaddr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">renesas_usbhs_platform_info</span> <span class="n">info</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define usbhs_get_priv(pdev)				\</span>
<span class="cp">	container_of(renesas_usbhs_get_info(pdev),	\</span>
<span class="cp">		     struct usbhs_private, info)</span>

<span class="cp">#define usbhs_is_connected(priv)			\</span>
<span class="cp">	(!((1 &lt;&lt; 7) &amp; __raw_readw(priv-&gt;usbcrcaddr)))</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">usbhs_get_vbus</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">usbhs_is_connected</span><span class="p">(</span><span class="n">usbhs_get_priv</span><span class="p">(</span><span class="n">pdev</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">usbhs_phy_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usbhs_private</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">usbhs_get_priv</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>

	<span class="cm">/* init phy */</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="mh">0x8a0a</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbcrcaddr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">usbhs0_get_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">USBHS_GADGET</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">usbhs0_work_function</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usbhs_private</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">work</span><span class="p">,</span> <span class="k">struct</span> <span class="n">usbhs_private</span><span class="p">,</span>
						  <span class="n">work</span><span class="p">.</span><span class="n">work</span><span class="p">);</span>

	<span class="n">renesas_usbhs_call_notify_hotplug</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">);</span>
	<span class="n">schedule_delayed_work</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">work</span><span class="p">,</span> <span class="n">USBHS0_POLL_INTERVAL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">usbhs0_hardware_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usbhs_private</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">usbhs_get_priv</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">pdev</span> <span class="o">=</span> <span class="n">pdev</span><span class="p">;</span>
	<span class="n">INIT_DELAYED_WORK</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">work</span><span class="p">,</span> <span class="n">usbhs0_work_function</span><span class="p">);</span>
	<span class="n">schedule_delayed_work</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">work</span><span class="p">,</span> <span class="n">USBHS0_POLL_INTERVAL</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">usbhs0_hardware_exit</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usbhs_private</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">usbhs_get_priv</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>

	<span class="n">cancel_delayed_work_sync</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">work</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">usbhs_private</span> <span class="n">usbhs0_private</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">usbcrcaddr</span>	<span class="o">=</span> <span class="mh">0xe605810c</span><span class="p">,</span>		<span class="cm">/* USBCR2 */</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_callback</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">hardware_init</span>	<span class="o">=</span> <span class="n">usbhs0_hardware_init</span><span class="p">,</span>
			<span class="p">.</span><span class="n">hardware_exit</span>	<span class="o">=</span> <span class="n">usbhs0_hardware_exit</span><span class="p">,</span>
			<span class="p">.</span><span class="n">phy_reset</span>	<span class="o">=</span> <span class="n">usbhs_phy_reset</span><span class="p">,</span>
			<span class="p">.</span><span class="n">get_id</span>		<span class="o">=</span> <span class="n">usbhs0_get_id</span><span class="p">,</span>
			<span class="p">.</span><span class="n">get_vbus</span>	<span class="o">=</span> <span class="n">usbhs_get_vbus</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_param</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">buswait_bwait</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
			<span class="p">.</span><span class="n">d0_tx_id</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_USB0_TX</span><span class="p">,</span>
			<span class="p">.</span><span class="n">d1_rx_id</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_USB0_RX</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">usbhs0_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;USBHS0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe6890000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe68900e6</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x1ca0</span><span class="p">)</span> <span class="cm">/* USB0_USB0I0 */</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">usbhs0_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;renesas_usbhs&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">usbhs0_private</span><span class="p">.</span><span class="n">info</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">usbhs0_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">usbhs0_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* USBHS1 is connected to CN31 which takes a USB Mini-AB plug</span>
<span class="cm"> *</span>
<span class="cm"> * Use J30 to select between Host and Function. This setting</span>
<span class="cm"> * can however not be detected by software. Hotplug of USBHS1</span>
<span class="cm"> * is provided via IRQ8.</span>
<span class="cm"> *</span>
<span class="cm"> * Current USB1 works as &quot;USB Host&quot;.</span>
<span class="cm"> *  - set J30 &quot;short&quot;</span>
<span class="cm"> *</span>
<span class="cm"> * If you want to use it as &quot;USB gadget&quot;,</span>
<span class="cm"> *  - J30 &quot;open&quot;</span>
<span class="cm"> *  - modify usbhs1_get_id() USBHS_HOST -&gt; USBHS_GADGET</span>
<span class="cm"> *  - add .get_vbus = usbhs_get_vbus in usbhs1_private</span>
<span class="cm"> */</span>
<span class="cp">#define IRQ8 evt2irq(0x0300)</span>
<span class="cp">#define USB_PHY_MODE		(1 &lt;&lt; 4)</span>
<span class="cp">#define USB_PHY_INT_EN		((1 &lt;&lt; 3) | (1 &lt;&lt; 2))</span>
<span class="cp">#define USB_PHY_ON		(1 &lt;&lt; 1)</span>
<span class="cp">#define USB_PHY_OFF		(1 &lt;&lt; 0)</span>
<span class="cp">#define USB_PHY_INT_CLR		(USB_PHY_ON | USB_PHY_OFF)</span>

<span class="k">static</span> <span class="n">irqreturn_t</span> <span class="nf">usbhs1_interrupt</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">usbhs_private</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">usbhs_get_priv</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>

	<span class="n">renesas_usbhs_call_notify_hotplug</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>

	<span class="cm">/* clear status */</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="n">__raw_readw</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbphyaddr</span><span class="p">)</span> <span class="o">|</span> <span class="n">USB_PHY_INT_CLR</span><span class="p">,</span>
		     <span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbphyaddr</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">IRQ_HANDLED</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">usbhs1_hardware_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usbhs_private</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">usbhs_get_priv</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="cm">/* clear interrupt status */</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="n">USB_PHY_MODE</span> <span class="o">|</span> <span class="n">USB_PHY_INT_CLR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbphyaddr</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">request_irq</span><span class="p">(</span><span class="n">IRQ8</span><span class="p">,</span> <span class="n">usbhs1_interrupt</span><span class="p">,</span> <span class="n">IRQF_TRIGGER_HIGH</span><span class="p">,</span>
			  <span class="n">dev_name</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">pdev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;request_irq err</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* enable USB phy interrupt */</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="n">USB_PHY_MODE</span> <span class="o">|</span> <span class="n">USB_PHY_INT_EN</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbphyaddr</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">usbhs1_hardware_exit</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usbhs_private</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">usbhs_get_priv</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>

	<span class="cm">/* clear interrupt status */</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="n">USB_PHY_MODE</span> <span class="o">|</span> <span class="n">USB_PHY_INT_CLR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">usbphyaddr</span><span class="p">);</span>

	<span class="n">free_irq</span><span class="p">(</span><span class="n">IRQ8</span><span class="p">,</span> <span class="n">pdev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">usbhs1_get_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">USBHS_HOST</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="n">usbhs1_pipe_cfg</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">USB_ENDPOINT_XFER_CONTROL</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_ISOC</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_ISOC</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_BULK</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_BULK</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_BULK</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_INT</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_INT</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_INT</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_BULK</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_BULK</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_BULK</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_BULK</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_BULK</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_BULK</span><span class="p">,</span>
	<span class="n">USB_ENDPOINT_XFER_BULK</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">usbhs_private</span> <span class="n">usbhs1_private</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">usbphyaddr</span>	<span class="o">=</span> <span class="mh">0xe60581e2</span><span class="p">,</span>		<span class="cm">/* USBPHY1INTAP */</span>
	<span class="p">.</span><span class="n">usbcrcaddr</span>	<span class="o">=</span> <span class="mh">0xe6058130</span><span class="p">,</span>		<span class="cm">/* USBCR4 */</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_callback</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">hardware_init</span>	<span class="o">=</span> <span class="n">usbhs1_hardware_init</span><span class="p">,</span>
			<span class="p">.</span><span class="n">hardware_exit</span>	<span class="o">=</span> <span class="n">usbhs1_hardware_exit</span><span class="p">,</span>
			<span class="p">.</span><span class="n">get_id</span>		<span class="o">=</span> <span class="n">usbhs1_get_id</span><span class="p">,</span>
			<span class="p">.</span><span class="n">phy_reset</span>	<span class="o">=</span> <span class="n">usbhs_phy_reset</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_param</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">buswait_bwait</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_otg</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">pipe_type</span>	<span class="o">=</span> <span class="n">usbhs1_pipe_cfg</span><span class="p">,</span>
			<span class="p">.</span><span class="n">pipe_size</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">usbhs1_pipe_cfg</span><span class="p">),</span>
			<span class="p">.</span><span class="n">d0_tx_id</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_USB1_TX</span><span class="p">,</span>
			<span class="p">.</span><span class="n">d1_rx_id</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_USB1_RX</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">usbhs1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;USBHS1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe68b0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe68b00e6</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x1ce0</span><span class="p">)</span> <span class="cm">/* USB1_USB1I0 */</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">usbhs1_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;renesas_usbhs&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">usbhs1_private</span><span class="p">.</span><span class="n">info</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">usbhs1_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">usbhs1_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* LED */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_led</span> <span class="n">mackerel_leds</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;led0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">GPIO_PORT0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_state</span>	<span class="o">=</span> <span class="n">LEDS_GPIO_DEFSTATE_ON</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;led1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">GPIO_PORT1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_state</span>	<span class="o">=</span> <span class="n">LEDS_GPIO_DEFSTATE_ON</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;led2&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">GPIO_PORT2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_state</span>	<span class="o">=</span> <span class="n">LEDS_GPIO_DEFSTATE_ON</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;led3&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="n">GPIO_PORT159</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_state</span>	<span class="o">=</span> <span class="n">LEDS_GPIO_DEFSTATE_ON</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_led_platform_data</span> <span class="n">mackerel_leds_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">leds</span> <span class="o">=</span> <span class="n">mackerel_leds</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_leds</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mackerel_leds</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">leds_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;leds-gpio&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">mackerel_leds_pdata</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* FSI */</span>
<span class="cp">#define IRQ_FSI evt2irq(0x1840)</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">__fsi_set_round_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">,</span> <span class="kt">long</span> <span class="n">rate</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">enable</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">clk_disable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">clk_set_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">clk_round_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">rate</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">clk_enable</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">fsi_b_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">fsib_clk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">fdiv_clk</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sh7372_fsidivb_clk</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">fsib_rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">fdiv_rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ackmd_bpfmd</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="cm">/* clock start */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">44100</span>:
		<span class="n">fsib_rate</span>	<span class="o">=</span> <span class="n">rate</span> <span class="o">*</span> <span class="mi">256</span><span class="p">;</span>
		<span class="n">ackmd_bpfmd</span>	<span class="o">=</span> <span class="n">SH_FSI_ACKMD_256</span> <span class="o">|</span> <span class="n">SH_FSI_BPFMD_64</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">48000</span>:
		<span class="n">fsib_rate</span>	<span class="o">=</span> <span class="mi">85428000</span><span class="p">;</span> <span class="cm">/* around 48kHz x 256 x 7 */</span>
		<span class="n">fdiv_rate</span>	<span class="o">=</span> <span class="n">rate</span> <span class="o">*</span> <span class="mi">256</span><span class="p">;</span>
		<span class="n">ackmd_bpfmd</span>	<span class="o">=</span> <span class="n">SH_FSI_ACKMD_256</span> <span class="o">|</span> <span class="n">SH_FSI_BPFMD_64</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;unsupported rate in FSI2 port B</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* FSI B setting */</span>
	<span class="n">fsib_clk</span> <span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;ickb&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">fsib_clk</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>

	<span class="cm">/* fsib */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">__fsi_set_round_rate</span><span class="p">(</span><span class="n">fsib_clk</span><span class="p">,</span> <span class="n">fsib_rate</span><span class="p">,</span> <span class="n">enable</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">fsi_set_rate_end</span><span class="p">;</span>

	<span class="cm">/* FSI DIV */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">__fsi_set_round_rate</span><span class="p">(</span><span class="n">fdiv_clk</span><span class="p">,</span> <span class="n">fdiv_rate</span><span class="p">,</span> <span class="n">enable</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* disable FSI B */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">enable</span><span class="p">)</span>
			<span class="n">__fsi_set_round_rate</span><span class="p">(</span><span class="n">fsib_clk</span><span class="p">,</span> <span class="n">fsib_rate</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">fsi_set_rate_end</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">ackmd_bpfmd</span><span class="p">;</span>

<span class="nl">fsi_set_rate_end:</span>
	<span class="n">clk_put</span><span class="p">(</span><span class="n">fsib_clk</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_fsi_platform_info</span> <span class="n">fsi_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">port_a</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">SH_FSI_BRS_INV</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_id</span> <span class="o">=</span> <span class="n">SHDMA_SLAVE_FSIA_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rx_id</span> <span class="o">=</span> <span class="n">SHDMA_SLAVE_FSIA_RX</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">port_b</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">SH_FSI_BRS_INV</span>	<span class="o">|</span>
			<span class="n">SH_FSI_BRM_INV</span>	<span class="o">|</span>
			<span class="n">SH_FSI_LRS_INV</span>	<span class="o">|</span>
			<span class="n">SH_FSI_FMT_SPDIF</span><span class="p">,</span>
		<span class="p">.</span><span class="n">set_rate</span> <span class="o">=</span> <span class="n">fsi_b_set_rate</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">fsi_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* we need 0xFE1F0000 to access DMA</span>
<span class="cm">		 * instead of 0xFE3C0000 */</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;FSI&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="mh">0xFE1F0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>    <span class="o">=</span> <span class="mh">0xFE1F0400</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="n">IRQ_FSI</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">fsi_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_fsi2&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">fsi_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">fsi_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">fsi_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">asoc_simple_dai_init_info</span> <span class="n">fsi2_ak4643_init_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">fmt</span>		<span class="o">=</span> <span class="n">SND_SOC_DAIFMT_LEFT_J</span><span class="p">,</span>
	<span class="p">.</span><span class="n">codec_daifmt</span>	<span class="o">=</span> <span class="n">SND_SOC_DAIFMT_CBM_CFM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cpu_daifmt</span>	<span class="o">=</span> <span class="n">SND_SOC_DAIFMT_CBS_CFS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sysclk</span>		<span class="o">=</span> <span class="mi">11289600</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">asoc_simple_card_info</span> <span class="n">fsi2_ak4643_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;AK4643&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">card</span>		<span class="o">=</span> <span class="s">&quot;FSI2A-AK4643&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cpu_dai</span>	<span class="o">=</span> <span class="s">&quot;fsia-dai&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">codec</span>		<span class="o">=</span> <span class="s">&quot;ak4642-codec.0-0013&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">platform</span>	<span class="o">=</span> <span class="s">&quot;sh_fsi2&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">codec_dai</span>	<span class="o">=</span> <span class="s">&quot;ak4642-hifi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">fsi2_ak4643_init_info</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">fsi_ak4643_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;asoc-simple-card&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">fsi2_ak4643_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* FLCTL */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mtd_partition</span> <span class="n">nand_partition_info</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;system&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="mi">128</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;userdata&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>	<span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="mi">256</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;cache&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>	<span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="mi">128</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">nand_flash_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe6a30000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe6a3009b</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_flctl_platform_data</span> <span class="n">nand_flash_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">parts</span>		<span class="o">=</span> <span class="n">nand_partition_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nr_parts</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">nand_partition_info</span><span class="p">),</span>
	<span class="p">.</span><span class="n">flcmncr_val</span>	<span class="o">=</span> <span class="n">CLK_16B_12L_4H</span> <span class="o">|</span> <span class="n">TYPESEL_SET</span>
			<span class="o">|</span> <span class="n">SHBUSSEL</span> <span class="o">|</span> <span class="n">SEL_16BIT</span> <span class="o">|</span> <span class="n">SNAND_E</span><span class="p">,</span>
	<span class="p">.</span><span class="n">use_holden</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">nand_flash_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_flctl&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">nand_flash_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">nand_flash_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">nand_flash_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * The card detect pin of the top SD/MMC slot (CN7) is active low and is</span>
<span class="cm"> * connected to GPIO A22 of SH7372 (GPIO_PORT41).</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">slot_cn7_get_cd</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">!</span><span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PORT41</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* SDHI0 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_sdhi_info</span> <span class="n">sdhi0_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">dma_slave_tx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_SDHI0_TX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_slave_rx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_SDHI0_RX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_flags</span>	<span class="o">=</span> <span class="n">TMIO_MMC_USE_GPIO_CD</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_caps</span>	<span class="o">=</span> <span class="n">MMC_CAP_SD_HIGHSPEED</span> <span class="o">|</span> <span class="n">MMC_CAP_SDIO_IRQ</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cd_gpio</span>	<span class="o">=</span> <span class="n">GPIO_PORT172</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sdhi0_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;SDHI0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe6850000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe68500ff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0e00</span><span class="p">)</span> <span class="cm">/* SDHI0_SDHI0I0 */</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0e20</span><span class="p">)</span> <span class="cm">/* SDHI0_SDHI0I1 */</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0e40</span><span class="p">)</span> <span class="cm">/* SDHI0_SDHI0I2 */</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sdhi0_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_sdhi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sdhi0_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">sdhi0_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">sdhi0_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#if !defined(CONFIG_MMC_SH_MMCIF) &amp;&amp; !defined(CONFIG_MMC_SH_MMCIF_MODULE)</span>
<span class="cm">/* SDHI1 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_sdhi_info</span> <span class="n">sdhi1_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">dma_slave_tx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_SDHI1_TX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_slave_rx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_SDHI1_RX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_ocr_mask</span>	<span class="o">=</span> <span class="n">MMC_VDD_165_195</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_flags</span>	<span class="o">=</span> <span class="n">TMIO_MMC_WRPROTECT_DISABLE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_caps</span>	<span class="o">=</span> <span class="n">MMC_CAP_SD_HIGHSPEED</span> <span class="o">|</span> <span class="n">MMC_CAP_SDIO_IRQ</span> <span class="o">|</span>
			  <span class="n">MMC_CAP_NEEDS_POLL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_cd</span>		<span class="o">=</span> <span class="n">slot_cn7_get_cd</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sdhi1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;SDHI1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe6860000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe68600ff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="n">SH_MOBILE_SDHI_IRQ_CARD_DETECT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0e80</span><span class="p">),</span> <span class="cm">/* SDHI1_SDHI1I0 */</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="n">SH_MOBILE_SDHI_IRQ_SDCARD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0ea0</span><span class="p">),</span> <span class="cm">/* SDHI1_SDHI1I1 */</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="n">SH_MOBILE_SDHI_IRQ_SDIO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x0ec0</span><span class="p">),</span> <span class="cm">/* SDHI1_SDHI1I2 */</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sdhi1_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_sdhi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sdhi1_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">sdhi1_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">sdhi1_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * The card detect pin of the top SD/MMC slot (CN23) is active low and is</span>
<span class="cm"> * connected to GPIO SCIFB_SCK of SH7372 (GPIO_PORT162).</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">slot_cn23_get_cd</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">!</span><span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PORT162</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* SDHI2 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_sdhi_info</span> <span class="n">sdhi2_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">dma_slave_tx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_SDHI2_TX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_slave_rx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_SDHI2_RX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_flags</span>	<span class="o">=</span> <span class="n">TMIO_MMC_WRPROTECT_DISABLE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_caps</span>	<span class="o">=</span> <span class="n">MMC_CAP_SD_HIGHSPEED</span> <span class="o">|</span> <span class="n">MMC_CAP_SDIO_IRQ</span> <span class="o">|</span>
			  <span class="n">MMC_CAP_NEEDS_POLL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_cd</span>		<span class="o">=</span> <span class="n">slot_cn23_get_cd</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sdhi2_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;SDHI2&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xe6870000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xe68700ff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="n">SH_MOBILE_SDHI_IRQ_CARD_DETECT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x1200</span><span class="p">),</span> <span class="cm">/* SDHI2_SDHI2I0 */</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="n">SH_MOBILE_SDHI_IRQ_SDCARD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x1220</span><span class="p">),</span> <span class="cm">/* SDHI2_SDHI2I1 */</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="n">SH_MOBILE_SDHI_IRQ_SDIO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x1240</span><span class="p">),</span> <span class="cm">/* SDHI2_SDHI2I2 */</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sdhi2_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;sh_mobile_sdhi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sdhi2_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">sdhi2_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">sdhi2_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* SH_MMCIF */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sh_mmcif_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;MMCIF&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xE6BD0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xE6BD00FF</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* MMC ERR */</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x1ac0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* MMC NOR */</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x1ae0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mmcif_plat_data</span> <span class="n">sh_mmcif_plat</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">sup_pclk</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ocr</span>		<span class="o">=</span> <span class="n">MMC_VDD_165_195</span> <span class="o">|</span> <span class="n">MMC_VDD_32_33</span> <span class="o">|</span> <span class="n">MMC_VDD_33_34</span><span class="p">,</span>
	<span class="p">.</span><span class="n">caps</span>		<span class="o">=</span> <span class="n">MMC_CAP_4_BIT_DATA</span> <span class="o">|</span>
			  <span class="n">MMC_CAP_8_BIT_DATA</span> <span class="o">|</span>
			  <span class="n">MMC_CAP_NEEDS_POLL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_cd</span>		<span class="o">=</span> <span class="n">slot_cn7_get_cd</span><span class="p">,</span>
	<span class="p">.</span><span class="n">slave_id_tx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_MMCIF_TX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">slave_id_rx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_MMCIF_RX</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sh_mmcif_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mmcif&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">dma_mask</span>		<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">coherent_dma_mask</span>	<span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">sh_mmcif_plat</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sh_mmcif_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">sh_mmcif_resources</span><span class="p">,</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kt">int</span> <span class="n">mackerel_camera_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">soc_camera_device</span> <span class="o">*</span><span class="n">icd</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">mackerel_camera_del</span><span class="p">(</span><span class="k">struct</span> <span class="n">soc_camera_device</span> <span class="o">*</span><span class="n">icd</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">camera_set_capture</span><span class="p">(</span><span class="k">struct</span> <span class="n">soc_camera_platform_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			      <span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* camera sensor always enabled */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">soc_camera_platform_info</span> <span class="n">camera_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">format_name</span> <span class="o">=</span> <span class="s">&quot;UYVY&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">format_depth</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">format</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">V4L2_MBUS_FMT_UYVY8_2X8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SMPTE170M</span><span class="p">,</span>
		<span class="p">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>
		<span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">mbus_param</span> <span class="o">=</span> <span class="n">V4L2_MBUS_PCLK_SAMPLE_RISING</span> <span class="o">|</span> <span class="n">V4L2_MBUS_MASTER</span> <span class="o">|</span>
	<span class="n">V4L2_MBUS_VSYNC_ACTIVE_HIGH</span> <span class="o">|</span> <span class="n">V4L2_MBUS_HSYNC_ACTIVE_HIGH</span> <span class="o">|</span>
	<span class="n">V4L2_MBUS_DATA_ACTIVE_HIGH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mbus_type</span> <span class="o">=</span> <span class="n">V4L2_MBUS_PARALLEL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_capture</span> <span class="o">=</span> <span class="n">camera_set_capture</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">soc_camera_link</span> <span class="n">camera_link</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">bus_id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">add_device</span>	<span class="o">=</span> <span class="n">mackerel_camera_add</span><span class="p">,</span>
	<span class="p">.</span><span class="n">del_device</span>	<span class="o">=</span> <span class="n">mackerel_camera_del</span><span class="p">,</span>
	<span class="p">.</span><span class="n">module_name</span>	<span class="o">=</span> <span class="s">&quot;soc_camera_platform&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">priv</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">camera_info</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">camera_device</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mackerel_camera_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">soc_camera_platform_release</span><span class="p">(</span><span class="o">&amp;</span><span class="n">camera_device</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mackerel_camera_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">soc_camera_device</span> <span class="o">*</span><span class="n">icd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">soc_camera_platform_add</span><span class="p">(</span><span class="n">icd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">camera_device</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">camera_link</span><span class="p">,</span>
				       <span class="n">mackerel_camera_release</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mackerel_camera_del</span><span class="p">(</span><span class="k">struct</span> <span class="n">soc_camera_device</span> <span class="o">*</span><span class="n">icd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">soc_camera_platform_del</span><span class="p">(</span><span class="n">icd</span><span class="p">,</span> <span class="n">camera_device</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">camera_link</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_ceu_info</span> <span class="n">sh_mobile_ceu_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">SH_CEU_FLAG_USE_8BIT_BUS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_width</span> <span class="o">=</span> <span class="mi">8188</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_height</span> <span class="o">=</span> <span class="mi">8188</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">ceu_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;CEU&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xfe910000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xfe91009f</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="n">intcs_evt2irq</span><span class="p">(</span><span class="mh">0x880</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* place holder for contiguous memory */</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">ceu_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_ceu&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>             <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* &quot;ceu0&quot; clock */</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ceu_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">ceu_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">sh_mobile_ceu_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">coherent_dma_mask</span>	<span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">mackerel_camera</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;soc-camera-pdrv&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">camera_link</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">mackerel_devices</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">nor_flash_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">smc911x_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">lcdc_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">usbhs1_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">usbhs0_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">leds_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">fsi_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">fsi_ak4643_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">fsi_hdmi_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">nand_flash_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sdhi0_device</span><span class="p">,</span>
<span class="cp">#if !defined(CONFIG_MMC_SH_MMCIF) &amp;&amp; !defined(CONFIG_MMC_SH_MMCIF_MODULE)</span>
	<span class="o">&amp;</span><span class="n">sdhi1_device</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="o">&amp;</span><span class="n">sdhi2_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sh_mmcif_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">ceu_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">mackerel_camera</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">hdmi_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">hdmi_lcdc_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">meram_device</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Keypad Initialization */</span>
<span class="cp">#define KEYPAD_BUTTON(ev_type, ev_code, act_low) \</span>
<span class="cp">{								\</span>
<span class="cp">	.type		= ev_type,				\</span>
<span class="cp">	.code		= ev_code,				\</span>
<span class="cp">	.active_low	= act_low,				\</span>
<span class="cp">}</span>

<span class="cp">#define KEYPAD_BUTTON_LOW(event_code) KEYPAD_BUTTON(EV_KEY, event_code, 1)</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tca6416_button</span> <span class="n">mackerel_gpio_keys</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">KEYPAD_BUTTON_LOW</span><span class="p">(</span><span class="n">KEY_HOME</span><span class="p">),</span>
	<span class="n">KEYPAD_BUTTON_LOW</span><span class="p">(</span><span class="n">KEY_MENU</span><span class="p">),</span>
	<span class="n">KEYPAD_BUTTON_LOW</span><span class="p">(</span><span class="n">KEY_BACK</span><span class="p">),</span>
	<span class="n">KEYPAD_BUTTON_LOW</span><span class="p">(</span><span class="n">KEY_POWER</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tca6416_keys_platform_data</span> <span class="n">mackerel_tca6416_keys_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">buttons</span>	<span class="o">=</span> <span class="n">mackerel_gpio_keys</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nbuttons</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mackerel_gpio_keys</span><span class="p">),</span>
	<span class="p">.</span><span class="n">rep</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">use_polling</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pinmask</span>	<span class="o">=</span> <span class="mh">0x000F</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* I2C */</span>
<span class="cp">#define IRQ7 evt2irq(0x02e0)</span>
<span class="cp">#define IRQ9 evt2irq(0x0320)</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">i2c0_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;ak4643&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">),</span>
	<span class="p">},</span>
	<span class="cm">/* Keypad */</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;tca6408-keys&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mackerel_tca6416_keys_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">IRQ9</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* Touchscreen */</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;st1232-ts&quot;</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">),</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">IRQ7</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#define IRQ21 evt2irq(0x32a0)</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">i2c1_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Accelerometer */</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;adxl34x&quot;</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">),</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">IRQ21</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#define GPIO_PORT9CR	0xE6051009</span>
<span class="cp">#define GPIO_PORT10CR	0xE605100A</span>
<span class="cp">#define GPIO_PORT167CR	0xE60520A7</span>
<span class="cp">#define GPIO_PORT168CR	0xE60520A8</span>
<span class="cp">#define SRCR4		0xe61580bc</span>
<span class="cp">#define USCCR1		0xE6058144</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">mackerel_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">srcr4</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">;</span>

	<span class="cm">/* External clock source */</span>
	<span class="n">clk_set_rate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_dv_clki_clk</span><span class="p">,</span> <span class="mi">27000000</span><span class="p">);</span>

	<span class="n">sh7372_pinmux_init</span><span class="p">();</span>

	<span class="cm">/* enable SCIFA0 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SCIFA0_TXD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SCIFA0_RXD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* enable SMSC911X */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_CS5A</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_IRQ6_39</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* LCDC */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD23</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD22</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD21</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD20</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD19</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD18</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD17</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD16</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD15</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD14</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD13</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD12</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD11</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD10</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD9</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD8</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD7</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD6</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD5</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD4</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD3</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD2</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD1</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD0</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDDISP</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDDCK</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>

	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT31</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* backlight */</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT31</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="cm">/* off by default */</span>

	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT151</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* LCDDON */</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT151</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* USBHS0 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VBUS0_0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_pull_down</span><span class="p">(</span><span class="n">GPIO_PORT168CR</span><span class="p">);</span> <span class="cm">/* VBUS0_0 pull down */</span>

	<span class="cm">/* USBHS1 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VBUS0_1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_pull_down</span><span class="p">(</span><span class="n">GPIO_PORT167CR</span><span class="p">);</span> <span class="cm">/* VBUS0_1 pull down */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_IDIN_1_113</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* enable FSI2 port A (ak4643) */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIAIBT</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIAILR</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIAISLD</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIAOSLD</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT161</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PORT161</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="cm">/* slave */</span>

	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT9</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT10</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_no_direction</span><span class="p">(</span><span class="n">GPIO_PORT9CR</span><span class="p">);</span>  <span class="cm">/* FSIAOBT needs no direction */</span>
	<span class="n">gpio_no_direction</span><span class="p">(</span><span class="n">GPIO_PORT10CR</span><span class="p">);</span> <span class="cm">/* FSIAOLR needs no direction */</span>

	<span class="n">intc_set_priority</span><span class="p">(</span><span class="n">IRQ_FSI</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="cm">/* irq priority FSI(3) &gt; SMSC911X(2) */</span>

	<span class="cm">/* setup FSI2 port B (HDMI) */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIBCK</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="n">__raw_readw</span><span class="p">(</span><span class="n">USCCR1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="n">USCCR1</span><span class="p">);</span> <span class="cm">/* use SPDIF */</span>

	<span class="cm">/* set SPU2 clock to 119.6 MHz */</span>
	<span class="n">clk</span> <span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;spu_clk&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">clk</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">clk_set_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">clk_round_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="mi">119600000</span><span class="p">));</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* enable Keypad */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_IRQ9_42</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">irq_set_irq_type</span><span class="p">(</span><span class="n">IRQ9</span><span class="p">,</span> <span class="n">IRQ_TYPE_LEVEL_HIGH</span><span class="p">);</span>

	<span class="cm">/* enable Touchscreen */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_IRQ7_40</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">irq_set_irq_type</span><span class="p">(</span><span class="n">IRQ7</span><span class="p">,</span> <span class="n">IRQ_TYPE_LEVEL_LOW</span><span class="p">);</span>

	<span class="cm">/* enable Accelerometer */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_IRQ21</span><span class="p">,</span>	<span class="nb">NULL</span><span class="p">);</span>
	<span class="n">irq_set_irq_type</span><span class="p">(</span><span class="n">IRQ21</span><span class="p">,</span> <span class="n">IRQ_TYPE_LEVEL_HIGH</span><span class="p">);</span>

	<span class="cm">/* enable SDHI0 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHIWP0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHICMD0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHICLK0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID0_3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID0_2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID0_1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID0_0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* SDHI0 PORT172 card-detect IRQ26 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_IRQ26_172</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

<span class="cp">#if !defined(CONFIG_MMC_SH_MMCIF) &amp;&amp; !defined(CONFIG_MMC_SH_MMCIF_MODULE)</span>
	<span class="cm">/* enable SDHI1 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHICMD1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHICLK1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID1_3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID1_2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID1_1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID1_0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="cm">/* card detect pin for MMC slot (CN7) */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT41</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PORT41</span><span class="p">);</span>

	<span class="cm">/* enable SDHI2 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHICMD2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHICLK2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID2_3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID2_2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID2_1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHID2_0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* card detect pin for microSD slot (CN23) */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PORT162</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PORT162</span><span class="p">);</span>

	<span class="cm">/* MMCIF */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMCD0_0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMCD0_1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMCD0_2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMCD0_3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMCD0_4</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMCD0_5</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMCD0_6</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMCD0_7</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMCCMD0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMCCLK0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* FLCTL */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D0_NAF0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D1_NAF1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D2_NAF2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D3_NAF3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D4_NAF4</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D5_NAF5</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D6_NAF6</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D7_NAF7</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D8_NAF8</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D9_NAF9</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D10_NAF10</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D11_NAF11</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D12_NAF12</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D13_NAF13</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D14_NAF14</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_D15_NAF15</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FCE0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_WE0_FWE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FRB</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_A4_FOE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_A5_FCDE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_RD_FSC</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* enable GPS module (GT-720F) */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SCIFA2_TXD1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SCIFA2_RXD1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* CEU */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_CLK</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_VD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_HD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_FIELD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_CKO</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_D7</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_D6</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_D5</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_D4</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_D3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_D2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_D1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO_D0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* HDMI */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_HDMI_HPD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_HDMI_CEC</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* Reset HDMI, must be held at least one EXTALR (32768Hz) period */</span>
	<span class="n">srcr4</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">SRCR4</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">srcr4</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">),</span> <span class="n">SRCR4</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">srcr4</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">),</span> <span class="n">SRCR4</span><span class="p">);</span>

	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i2c0_devices</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">i2c0_devices</span><span class="p">));</span>
	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i2c1_devices</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">i2c1_devices</span><span class="p">));</span>

	<span class="n">sh7372_add_standard_devices</span><span class="p">();</span>

	<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">mackerel_devices</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mackerel_devices</span><span class="p">));</span>

	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a4lc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lcdc_device</span><span class="p">);</span>
	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a4lc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdmi_lcdc_device</span><span class="p">);</span>
	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a4lc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">meram_device</span><span class="p">);</span>
	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a4mp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsi_device</span><span class="p">);</span>
	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a3sp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">usbhs0_device</span><span class="p">);</span>
	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a3sp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">usbhs1_device</span><span class="p">);</span>
	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a3sp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nand_flash_device</span><span class="p">);</span>
	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a3sp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sh_mmcif_device</span><span class="p">);</span>
	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a3sp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sdhi0_device</span><span class="p">);</span>
<span class="cp">#if !defined(CONFIG_MMC_SH_MMCIF) &amp;&amp; !defined(CONFIG_MMC_SH_MMCIF_MODULE)</span>
	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a3sp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sdhi1_device</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a3sp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sdhi2_device</span><span class="p">);</span>
	<span class="n">sh7372_add_device_to_domain</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7372_a4r</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ceu_device</span><span class="p">);</span>

	<span class="n">hdmi_init_pm_clock</span><span class="p">();</span>
	<span class="n">sh7372_pm_init</span><span class="p">();</span>
	<span class="n">pm_clk_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fsi_device</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;spu2&quot;</span><span class="p">);</span>
	<span class="n">pm_clk_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdmi_lcdc_device</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;hdmi&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">MACHINE_START</span><span class="p">(</span><span class="n">MACKEREL</span><span class="p">,</span> <span class="s">&quot;mackerel&quot;</span><span class="p">)</span>
	<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">sh7372_map_io</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_early</span>	<span class="o">=</span> <span class="n">sh7372_add_early_devices</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>	<span class="o">=</span> <span class="n">sh7372_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">handle_irq</span>	<span class="o">=</span> <span class="n">shmobile_handle_irq_intc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span>	<span class="o">=</span> <span class="n">mackerel_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_late</span>	<span class="o">=</span> <span class="n">shmobile_init_late</span><span class="p">,</span>
	<span class="p">.</span><span class="n">timer</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">shmobile_timer</span><span class="p">,</span>
<span class="n">MACHINE_END</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
