<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-bcmring › csp › dmac › dmacHw_extra.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>dmacHw_extra.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*****************************************************************************</span>
<span class="cm">* Copyright 2003 - 2008 Broadcom Corporation.  All rights reserved.</span>
<span class="cm">*</span>
<span class="cm">* Unless you and Broadcom execute a separate written software license</span>
<span class="cm">* agreement governing use of this software, this software is licensed to you</span>
<span class="cm">* under the terms of the GNU General Public License version 2, available at</span>
<span class="cm">* http://www.broadcom.com/licenses/GPLv2.php (the &quot;GPL&quot;).</span>
<span class="cm">*</span>
<span class="cm">* Notwithstanding the above, under no circumstances may you combine this</span>
<span class="cm">* software in any way with any other Broadcom software provided under a</span>
<span class="cm">* license other than the GPL, without Broadcom&#39;s express prior written</span>
<span class="cm">* consent.</span>
<span class="cm">*****************************************************************************/</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @file    dmacHw_extra.c</span>
<span class="cm">*</span>
<span class="cm">*  @brief   Extra Low level DMA controller driver routines</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*</span>
<span class="cm">*   These routines provide basic DMA functionality only.</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>

<span class="cm">/* ---- Include Files ---------------------------------------------------- */</span>

<span class="cp">#include &lt;csp/stdint.h&gt;</span>
<span class="cp">#include &lt;stddef.h&gt;</span>

<span class="cp">#include &lt;csp/dmacHw.h&gt;</span>
<span class="cp">#include &lt;mach/csp/dmacHw_reg.h&gt;</span>
<span class="cp">#include &lt;mach/csp/dmacHw_priv.h&gt;</span>

<span class="k">extern</span> <span class="n">dmacHw_CBLK_t</span> <span class="n">dmacHw_gCblk</span><span class="p">[</span><span class="n">dmacHw_MAX_CHANNEL_COUNT</span><span class="p">];</span>	<span class="cm">/* Declared in dmacHw.c */</span>

<span class="cm">/* ---- External Function Prototypes ------------------------------------- */</span>

<span class="cm">/* ---- Internal Use Function Prototypes --------------------------------- */</span>
<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Overwrites data length in the descriptor</span>
<span class="cm">*</span>
<span class="cm">*  This function overwrites data length in the descriptor</span>
<span class="cm">*</span>
<span class="cm">*</span>
<span class="cm">*  @return   void</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*          This is only used for PCM channel</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="n">dmacHw_setDataLength</span><span class="p">(</span><span class="n">dmacHw_CONFIG_t</span> <span class="o">*</span><span class="n">pConfig</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Configuration settings */</span>
			  <span class="kt">void</span> <span class="o">*</span><span class="n">pDescriptor</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Descriptor buffer */</span>
			  <span class="kt">size_t</span> <span class="n">dataLen</span>	<span class="cm">/*   [ IN ] Data length in bytes */</span>
    <span class="p">);</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Helper function to display DMA registers</span>
<span class="cm">*</span>
<span class="cm">*  @return  void</span>
<span class="cm">*</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*     None</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">DisplayRegisterContents</span><span class="p">(</span><span class="kt">int</span> <span class="n">module</span><span class="p">,</span>	<span class="cm">/*   [ IN ] DMA Controller unit  (0-1) */</span>
				    <span class="kt">int</span> <span class="n">channel</span><span class="p">,</span>	<span class="cm">/*   [ IN ] DMA Channel          (0-7) / -1(all) */</span>
				    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="p">...)</span>	<span class="cm">/*   [ IN ] Callback to the print function */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">chan</span><span class="p">;</span>

	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Displaying register content </span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt raw transfer              0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_RAW_TRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt raw block                 0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_RAW_BLOCK</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt raw src transfer          0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_RAW_STRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt raw dst transfer          0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_RAW_DTRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt raw error                 0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_RAW_ERROR</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;--------------------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt stat transfer             0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_STAT_TRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt stat block                0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_STAT_BLOCK</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt stat src transfer         0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_STAT_STRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt stat dst transfer         0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_STAT_DTRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt stat error                0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_STAT_ERROR</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;--------------------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt mask transfer             0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_MASK_TRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt mask block                0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_MASK_BLOCK</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt mask src transfer         0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_MASK_STRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt mask dst transfer         0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_MASK_DTRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt mask error                0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_MASK_ERROR</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;--------------------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt clear transfer            0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_CLEAR_TRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt clear block               0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_CLEAR_BLOCK</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt clear src transfer        0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_CLEAR_STRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt clear dst transfer        0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_CLEAR_DTRAN</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: Interrupt clear error               0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_CLEAR_ERROR</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;--------------------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: SW source req                       0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SW_HS_SRC_REQ</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: SW dest req                         0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SW_HS_DST_REQ</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: SW source signal                    0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SW_HS_SRC_SGL_REQ</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: SW dest signal                      0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SW_HS_DST_SGL_REQ</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: SW source last                      0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SW_HS_SRC_LST_REQ</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: SW dest last                        0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SW_HS_DST_LST_REQ</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;--------------------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: misc config                         0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_MISC_CFG</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: misc channel enable                 0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_MISC_CH_ENABLE</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: misc ID                             0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_MISC_ID</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Module %d: misc test                           0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">module</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_MISC_TEST</span><span class="p">(</span><span class="n">module</span><span class="p">)));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">chan</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">chan</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">chan</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;--------------------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Source                   0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SAR</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Destination              0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_DAR</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d LLP                      0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_LLP</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Control (LO)             0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_CTL_LO</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Control (HI)             0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_CTL_HI</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Source Stats             0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SSTAT</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Dest Stats               0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_DSTAT</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Source Stats Addr        0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SSTATAR</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Dest Stats Addr          0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_DSTATAR</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Config (LO)              0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_CFG_LO</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
			    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Config (HI)              0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_CFG_HI</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">chan</span> <span class="o">=</span> <span class="n">channel</span><span class="p">;</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;--------------------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Source                   0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SAR</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Destination              0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_DAR</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d LLP                      0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_LLP</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Control (LO)             0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
		     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_CTL_LO</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Control (HI)             0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
		     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_CTL_HI</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Source Stats             0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SSTAT</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Dest Stats               0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_DSTAT</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Source Stats Addr        0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
		     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_SSTATAR</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Dest Stats Addr          0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
		     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_DSTATAR</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Config (LO)              0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
		     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_CFG_LO</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span>
		    <span class="p">(</span><span class="s">&quot;Module %d: Channel %d Config (HI)              0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span>
		     <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="n">dmacHw_REG_CFG_HI</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">chan</span><span class="p">)));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Helper function to display descriptor ring</span>
<span class="cm">*</span>
<span class="cm">*  @return  void</span>
<span class="cm">*</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*     None</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">DisplayDescRing</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">pDescriptor</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Descriptor buffer */</span>
			    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="p">...)</span>	<span class="cm">/*   [ IN ] Callback to the print function */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_DESC_RING_t</span> <span class="o">*</span><span class="n">pRing</span> <span class="o">=</span> <span class="n">dmacHw_GET_DESC_RING</span><span class="p">(</span><span class="n">pDescriptor</span><span class="p">);</span>
	<span class="n">dmacHw_DESC_t</span> <span class="o">*</span><span class="n">pStart</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">pStart</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">((</span><span class="n">dmacHw_DESC_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">llp</span> <span class="o">!=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pStart</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Head</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pStart</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Tail</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pStart</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pProg</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Prog</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pStart</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pEnd</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;End</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pStart</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pFree</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Free</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;0x%X:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">pStart</span><span class="p">);</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;sar    0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">sar</span><span class="p">);</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;dar    0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">dar</span><span class="p">);</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;llp    0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">llp</span><span class="p">);</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ctl.lo 0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">lo</span><span class="p">);</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ctl.hi 0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">hi</span><span class="p">);</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;sstat  0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">sstat</span><span class="p">);</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;dstat  0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">dstat</span><span class="p">);</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;devCtl 0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">devCtl</span><span class="p">);</span>

		<span class="n">pStart</span> <span class="o">=</span> <span class="p">(</span><span class="n">dmacHw_DESC_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">llp</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pStart</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">)</span> <span class="p">{</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Head</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pStart</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span><span class="p">)</span> <span class="p">{</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Tail</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pStart</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pProg</span><span class="p">)</span> <span class="p">{</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Prog</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pStart</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pEnd</span><span class="p">)</span> <span class="p">{</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;End</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pStart</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pFree</span><span class="p">)</span> <span class="p">{</span>
		<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;Free</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;0x%X:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">pStart</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;sar    0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">sar</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;dar    0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">dar</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;llp    0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">llp</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ctl.lo 0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">lo</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ctl.hi 0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">hi</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;sstat  0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">sstat</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;dstat  0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">dstat</span><span class="p">);</span>
	<span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;devCtl 0x%0X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pStart</span><span class="o">-&gt;</span><span class="n">devCtl</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Check if DMA channel is the flow controller</span>
<span class="cm">*</span>
<span class="cm">*  @return  1 : If DMA is a flow controller</span>
<span class="cm">*           0 : Peripheral is the flow controller</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*     None</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">DmaIsFlowController</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">pDescriptor</span>	<span class="cm">/*   [ IN ] Descriptor buffer */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">ttfc</span> <span class="o">=</span>
	    <span class="p">(</span><span class="n">dmacHw_GET_DESC_RING</span><span class="p">(</span><span class="n">pDescriptor</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">pTail</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span>
	    <span class="n">lo</span> <span class="o">&amp;</span> <span class="n">dmacHw_REG_CTL_TTFC_MASK</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">ttfc</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">dmacHw_REG_CTL_TTFC_MM_DMAC</span>:
	<span class="k">case</span> <span class="n">dmacHw_REG_CTL_TTFC_MP_DMAC</span>:
	<span class="k">case</span> <span class="n">dmacHw_REG_CTL_TTFC_PM_DMAC</span>:
	<span class="k">case</span> <span class="n">dmacHw_REG_CTL_TTFC_PP_DMAC</span>:
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Overwrites data length in the descriptor</span>
<span class="cm">*</span>
<span class="cm">*  This function overwrites data length in the descriptor</span>
<span class="cm">*</span>
<span class="cm">*</span>
<span class="cm">*  @return   void</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*          This is only used for PCM channel</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="nf">dmacHw_setDataLength</span><span class="p">(</span><span class="n">dmacHw_CONFIG_t</span> <span class="o">*</span><span class="n">pConfig</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Configuration settings */</span>
			  <span class="kt">void</span> <span class="o">*</span><span class="n">pDescriptor</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Descriptor buffer */</span>
			  <span class="kt">size_t</span> <span class="n">dataLen</span>	<span class="cm">/*   [ IN ] Data length in bytes */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_DESC_t</span> <span class="o">*</span><span class="n">pProg</span><span class="p">;</span>
	<span class="n">dmacHw_DESC_t</span> <span class="o">*</span><span class="n">pHead</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">srcTs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">srcTrSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">pHead</span> <span class="o">=</span> <span class="p">(</span><span class="n">dmacHw_GET_DESC_RING</span><span class="p">(</span><span class="n">pDescriptor</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">;</span>
	<span class="n">pProg</span> <span class="o">=</span> <span class="n">pHead</span><span class="p">;</span>

	<span class="n">srcTrSize</span> <span class="o">=</span> <span class="n">dmacHw_GetTrWidthInBytes</span><span class="p">(</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">srcMaxTransactionWidth</span><span class="p">);</span>
	<span class="n">srcTs</span> <span class="o">=</span> <span class="n">dataLen</span> <span class="o">/</span> <span class="n">srcTrSize</span><span class="p">;</span>
	<span class="k">do</span> <span class="p">{</span>
		<span class="n">pProg</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">hi</span> <span class="o">=</span> <span class="n">srcTs</span> <span class="o">&amp;</span> <span class="n">dmacHw_REG_CTL_BLOCK_TS_MASK</span><span class="p">;</span>
		<span class="n">pProg</span> <span class="o">=</span> <span class="p">(</span><span class="n">dmacHw_DESC_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">pProg</span><span class="o">-&gt;</span><span class="n">llp</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">pProg</span> <span class="o">!=</span> <span class="n">pHead</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Clears the interrupt</span>
<span class="cm">*</span>
<span class="cm">*  This function clears the DMA channel specific interrupt</span>
<span class="cm">*</span>
<span class="cm">*</span>
<span class="cm">*  @return   void</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*     Must be called under the context of ISR</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="nf">dmacHw_clearInterrupt</span><span class="p">(</span><span class="n">dmacHw_HANDLE_t</span> <span class="n">handle</span>	<span class="cm">/* [ IN ] DMA Channel handle */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_CBLK_t</span> <span class="o">*</span><span class="n">pCblk</span> <span class="o">=</span> <span class="n">dmacHw_HANDLE_TO_CBLK</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>

	<span class="n">dmacHw_TRAN_INT_CLEAR</span><span class="p">(</span><span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">module</span><span class="p">,</span> <span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">);</span>
	<span class="n">dmacHw_BLOCK_INT_CLEAR</span><span class="p">(</span><span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">module</span><span class="p">,</span> <span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">);</span>
	<span class="n">dmacHw_ERROR_INT_CLEAR</span><span class="p">(</span><span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">module</span><span class="p">,</span> <span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Returns the cause of channel specific DMA interrupt</span>
<span class="cm">*</span>
<span class="cm">*  This function returns the cause of interrupt</span>
<span class="cm">*</span>
<span class="cm">*  @return  Interrupt status, each bit representing a specific type of interrupt</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*     Should be called under the context of ISR</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="n">dmacHw_INTERRUPT_STATUS_e</span> <span class="nf">dmacHw_getInterruptStatus</span><span class="p">(</span><span class="n">dmacHw_HANDLE_t</span> <span class="n">handle</span>	<span class="cm">/* [ IN ] DMA Channel handle */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_CBLK_t</span> <span class="o">*</span><span class="n">pCblk</span> <span class="o">=</span> <span class="n">dmacHw_HANDLE_TO_CBLK</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
	<span class="n">dmacHw_INTERRUPT_STATUS_e</span> <span class="n">status</span> <span class="o">=</span> <span class="n">dmacHw_INTERRUPT_STATUS_NONE</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_STAT_TRAN</span><span class="p">(</span><span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">module</span><span class="p">)</span> <span class="o">&amp;</span>
	    <span class="p">((</span><span class="mh">0x00000001</span> <span class="o">&lt;&lt;</span> <span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">status</span> <span class="o">|=</span> <span class="n">dmacHw_INTERRUPT_STATUS_TRANS</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_STAT_BLOCK</span><span class="p">(</span><span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">module</span><span class="p">)</span> <span class="o">&amp;</span>
	    <span class="p">((</span><span class="mh">0x00000001</span> <span class="o">&lt;&lt;</span> <span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">status</span> <span class="o">|=</span> <span class="n">dmacHw_INTERRUPT_STATUS_BLOCK</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_STAT_ERROR</span><span class="p">(</span><span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">module</span><span class="p">)</span> <span class="o">&amp;</span>
	    <span class="p">((</span><span class="mh">0x00000001</span> <span class="o">&lt;&lt;</span> <span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">status</span> <span class="o">|=</span> <span class="n">dmacHw_INTERRUPT_STATUS_ERROR</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Indentifies a DMA channel causing interrupt</span>
<span class="cm">*</span>
<span class="cm">*  This functions returns a channel causing interrupt of type dmacHw_INTERRUPT_STATUS_e</span>
<span class="cm">*</span>
<span class="cm">*  @return  NULL   : No channel causing DMA interrupt</span>
<span class="cm">*           ! NULL : Handle to a channel causing DMA interrupt</span>
<span class="cm">*  @note</span>
<span class="cm">*     dmacHw_clearInterrupt() must be called with a valid handle after calling this function</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="n">dmacHw_HANDLE_t</span> <span class="nf">dmacHw_getInterruptSource</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dmaChannelCount_0</span> <span class="o">+</span> <span class="n">dmaChannelCount_1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">dmacHw_REG_INT_STAT_TRAN</span><span class="p">(</span><span class="n">dmacHw_gCblk</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">module</span><span class="p">)</span> <span class="o">&amp;</span>
		     <span class="p">((</span><span class="mh">0x00000001</span> <span class="o">&lt;&lt;</span> <span class="n">dmacHw_gCblk</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">channel</span><span class="p">)))</span>
		    <span class="o">||</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_STAT_BLOCK</span><span class="p">(</span><span class="n">dmacHw_gCblk</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">module</span><span class="p">)</span> <span class="o">&amp;</span>
			<span class="p">((</span><span class="mh">0x00000001</span> <span class="o">&lt;&lt;</span> <span class="n">dmacHw_gCblk</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">channel</span><span class="p">)))</span>
		    <span class="o">||</span> <span class="p">(</span><span class="n">dmacHw_REG_INT_STAT_ERROR</span><span class="p">(</span><span class="n">dmacHw_gCblk</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">module</span><span class="p">)</span> <span class="o">&amp;</span>
			<span class="p">((</span><span class="mh">0x00000001</span> <span class="o">&lt;&lt;</span> <span class="n">dmacHw_gCblk</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">channel</span><span class="p">)))</span>
		    <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="n">dmacHw_CBLK_TO_HANDLE</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dmacHw_gCblk</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">dmacHw_CBLK_TO_HANDLE</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief  Estimates number of descriptor needed to perform certain DMA transfer</span>
<span class="cm">*</span>
<span class="cm">*</span>
<span class="cm">*  @return  On failure : -1</span>
<span class="cm">*           On success : Number of descriptor count</span>
<span class="cm">*</span>
<span class="cm">*</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">int</span> <span class="nf">dmacHw_calculateDescriptorCount</span><span class="p">(</span><span class="n">dmacHw_CONFIG_t</span> <span class="o">*</span><span class="n">pConfig</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Configuration settings */</span>
				    <span class="kt">void</span> <span class="o">*</span><span class="n">pSrcAddr</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Source (Peripheral/Memory) address */</span>
				    <span class="kt">void</span> <span class="o">*</span><span class="n">pDstAddr</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Destination (Peripheral/Memory) address */</span>
				    <span class="kt">size_t</span> <span class="n">dataLen</span>	<span class="cm">/*   [ IN ] Data length in bytes */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">srcTs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">oddSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">descCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dstTrSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">srcTrSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">maxBlockSize</span> <span class="o">=</span> <span class="n">dmacHw_MAX_BLOCKSIZE</span><span class="p">;</span>
	<span class="n">dmacHw_TRANSACTION_WIDTH_e</span> <span class="n">dstTrWidth</span><span class="p">;</span>
	<span class="n">dmacHw_TRANSACTION_WIDTH_e</span> <span class="n">srcTrWidth</span><span class="p">;</span>

	<span class="n">dstTrSize</span> <span class="o">=</span> <span class="n">dmacHw_GetTrWidthInBytes</span><span class="p">(</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">dstMaxTransactionWidth</span><span class="p">);</span>
	<span class="n">srcTrSize</span> <span class="o">=</span> <span class="n">dmacHw_GetTrWidthInBytes</span><span class="p">(</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">srcMaxTransactionWidth</span><span class="p">);</span>

	<span class="cm">/* Skip Tx if buffer is NULL  or length is unknown */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">pSrcAddr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">pDstAddr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">dataLen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/* Do not initiate transfer */</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Ensure scatter and gather are transaction aligned */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">srcGatherWidth</span> <span class="o">%</span> <span class="n">srcTrSize</span>
	    <span class="o">||</span> <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">dstScatterWidth</span> <span class="o">%</span> <span class="n">dstTrSize</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	   Background 1: DMAC can not perform DMA if source and destination addresses are</span>
<span class="cm">	   not properly aligned with the channel&#39;s transaction width. So, for successful</span>
<span class="cm">	   DMA transfer, transaction width must be set according to the alignment of the</span>
<span class="cm">	   source and destination address.</span>
<span class="cm">	 */</span>

	<span class="cm">/* Adjust destination transaction width if destination address is not aligned properly */</span>
	<span class="n">dstTrWidth</span> <span class="o">=</span> <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">dstMaxTransactionWidth</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">dmacHw_ADDRESS_MASK</span><span class="p">(</span><span class="n">dstTrSize</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">pDstAddr</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dstTrWidth</span> <span class="o">=</span> <span class="n">dmacHw_GetNextTrWidth</span><span class="p">(</span><span class="n">dstTrWidth</span><span class="p">);</span>
		<span class="n">dstTrSize</span> <span class="o">=</span> <span class="n">dmacHw_GetTrWidthInBytes</span><span class="p">(</span><span class="n">dstTrWidth</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Adjust source transaction width if source address is not aligned properly */</span>
	<span class="n">srcTrWidth</span> <span class="o">=</span> <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">srcMaxTransactionWidth</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">dmacHw_ADDRESS_MASK</span><span class="p">(</span><span class="n">srcTrSize</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">pSrcAddr</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">srcTrWidth</span> <span class="o">=</span> <span class="n">dmacHw_GetNextTrWidth</span><span class="p">(</span><span class="n">srcTrWidth</span><span class="p">);</span>
		<span class="n">srcTrSize</span> <span class="o">=</span> <span class="n">dmacHw_GetTrWidthInBytes</span><span class="p">(</span><span class="n">srcTrWidth</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Find the maximum transaction per descriptor */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">maxDataPerBlock</span>
	    <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">maxDataPerBlock</span> <span class="o">/</span> <span class="n">srcTrSize</span><span class="p">)</span> <span class="o">&lt;</span>
		<span class="n">dmacHw_MAX_BLOCKSIZE</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">maxBlockSize</span> <span class="o">=</span> <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">maxDataPerBlock</span> <span class="o">/</span> <span class="n">srcTrSize</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Find number of source transactions needed to complete the DMA transfer */</span>
	<span class="n">srcTs</span> <span class="o">=</span> <span class="n">dataLen</span> <span class="o">/</span> <span class="n">srcTrSize</span><span class="p">;</span>
	<span class="cm">/* Find the odd number of bytes that need to be transferred as single byte transaction width */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">srcTs</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">dstTrSize</span> <span class="o">&gt;</span> <span class="n">srcTrSize</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">oddSize</span> <span class="o">=</span> <span class="n">dataLen</span> <span class="o">%</span> <span class="n">dstTrSize</span><span class="p">;</span>
		<span class="cm">/* Adjust source transaction count due to &quot;oddSize&quot; */</span>
		<span class="n">srcTs</span> <span class="o">=</span> <span class="n">srcTs</span> <span class="o">-</span> <span class="p">(</span><span class="n">oddSize</span> <span class="o">/</span> <span class="n">srcTrSize</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">oddSize</span> <span class="o">=</span> <span class="n">dataLen</span> <span class="o">%</span> <span class="n">srcTrSize</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* Adjust &quot;descCount&quot; due to &quot;oddSize&quot; */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">oddSize</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">descCount</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Find the number of descriptor needed for total &quot;srcTs&quot; */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">srcTs</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">descCount</span> <span class="o">+=</span> <span class="p">((</span><span class="n">srcTs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">maxBlockSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">descCount</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Check the existence of pending descriptor</span>
<span class="cm">*</span>
<span class="cm">*  This function confirmes if there is any pending descriptor in the chain</span>
<span class="cm">*  to program the channel</span>
<span class="cm">*</span>
<span class="cm">*  @return  1 : Channel need to be programmed with pending descriptor</span>
<span class="cm">*           0 : No more pending descriptor to programe the channel</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*     - This function should be called from ISR in case there are pending</span>
<span class="cm">*       descriptor to program the channel.</span>
<span class="cm">*</span>
<span class="cm">*     Example:</span>
<span class="cm">*</span>
<span class="cm">*     dmac_isr ()</span>
<span class="cm">*     {</span>
<span class="cm">*         ...</span>
<span class="cm">*         if (dmacHw_descriptorPending (handle))</span>
<span class="cm">*         {</span>
<span class="cm">*            dmacHw_initiateTransfer (handle);</span>
<span class="cm">*         }</span>
<span class="cm">*     }</span>
<span class="cm">*</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">uint32_t</span> <span class="nf">dmacHw_descriptorPending</span><span class="p">(</span><span class="n">dmacHw_HANDLE_t</span> <span class="n">handle</span><span class="p">,</span>	<span class="cm">/*   [ IN ] DMA Channel handle */</span>
				  <span class="kt">void</span> <span class="o">*</span><span class="n">pDescriptor</span>	<span class="cm">/*   [ IN ] Descriptor buffer */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_CBLK_t</span> <span class="o">*</span><span class="n">pCblk</span> <span class="o">=</span> <span class="n">dmacHw_HANDLE_TO_CBLK</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
	<span class="n">dmacHw_DESC_RING_t</span> <span class="o">*</span><span class="n">pRing</span> <span class="o">=</span> <span class="n">dmacHw_GET_DESC_RING</span><span class="p">(</span><span class="n">pDescriptor</span><span class="p">);</span>

	<span class="cm">/* Make sure channel is not busy */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CHANNEL_BUSY</span><span class="p">(</span><span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">module</span><span class="p">,</span> <span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/* Check if pEnd is not processed */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pEnd</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Something left for processing */</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Program channel register to stop transfer</span>
<span class="cm">*</span>
<span class="cm">*  Ensures the channel is not doing any transfer after calling this function</span>
<span class="cm">*</span>
<span class="cm">*  @return  void</span>
<span class="cm">*</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="nf">dmacHw_stopTransfer</span><span class="p">(</span><span class="n">dmacHw_HANDLE_t</span> <span class="n">handle</span>	<span class="cm">/*   [ IN ] DMA Channel handle */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_CBLK_t</span> <span class="o">*</span><span class="n">pCblk</span><span class="p">;</span>

	<span class="n">pCblk</span> <span class="o">=</span> <span class="n">dmacHw_HANDLE_TO_CBLK</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>

	<span class="cm">/* Stop the channel */</span>
	<span class="n">dmacHw_DMA_STOP</span><span class="p">(</span><span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">module</span><span class="p">,</span> <span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Deallocates source or destination memory, allocated</span>
<span class="cm">*</span>
<span class="cm">*  This function can be called to deallocate data memory that was DMAed successfully</span>
<span class="cm">*</span>
<span class="cm">*  @return  On failure : -1</span>
<span class="cm">*           On success : Number of buffer freed</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*     This function will be called ONLY, when source OR destination address is pointing</span>
<span class="cm">*     to dynamic memory</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">int</span> <span class="nf">dmacHw_freeMem</span><span class="p">(</span><span class="n">dmacHw_CONFIG_t</span> <span class="o">*</span><span class="n">pConfig</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Configuration settings */</span>
		   <span class="kt">void</span> <span class="o">*</span><span class="n">pDescriptor</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Descriptor buffer */</span>
		   <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fpFree</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span>	<span class="cm">/*   [ IN ] Function pointer to free data memory */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_DESC_RING_t</span> <span class="o">*</span><span class="n">pRing</span> <span class="o">=</span> <span class="n">dmacHw_GET_DESC_RING</span><span class="p">(</span><span class="n">pDescriptor</span><span class="p">);</span>
	<span class="kt">uint32_t</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fpFree</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">while</span> <span class="p">((</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pFree</span> <span class="o">!=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span><span class="p">)</span>
	       <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pFree</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">lo</span> <span class="o">&amp;</span> <span class="n">dmacHw_DESC_FREE</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pFree</span><span class="o">-&gt;</span><span class="n">devCtl</span> <span class="o">==</span> <span class="n">dmacHw_FREE_USER_MEMORY</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Identify, which memory to free */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dmacHw_DST_IS_MEMORY</span><span class="p">(</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">transferType</span><span class="p">))</span> <span class="p">{</span>
				<span class="p">(</span><span class="o">*</span><span class="n">fpFree</span><span class="p">)</span> <span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pFree</span><span class="o">-&gt;</span><span class="n">dar</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="cm">/* Destination was a peripheral */</span>
				<span class="p">(</span><span class="o">*</span><span class="n">fpFree</span><span class="p">)</span> <span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pFree</span><span class="o">-&gt;</span><span class="n">sar</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="cm">/* Unmark user memory to indicate it is freed */</span>
			<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pFree</span><span class="o">-&gt;</span><span class="n">devCtl</span> <span class="o">=</span> <span class="o">~</span><span class="n">dmacHw_FREE_USER_MEMORY</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">dmacHw_NEXT_DESC</span><span class="p">(</span><span class="n">pRing</span><span class="p">,</span> <span class="n">pFree</span><span class="p">);</span>

		<span class="n">count</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Prepares descriptor ring, when source peripheral working as a flow controller</span>
<span class="cm">*</span>
<span class="cm">*  This function will update the discriptor ring by allocating buffers, when source peripheral</span>
<span class="cm">*  has to work as a flow controller to transfer data from:</span>
<span class="cm">*           - Peripheral to memory.</span>
<span class="cm">*</span>
<span class="cm">*  @return  On failure : -1</span>
<span class="cm">*           On success : Number of descriptor updated</span>
<span class="cm">*</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*     Channel must be configured for peripheral to memory transfer</span>
<span class="cm">*</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">int</span> <span class="nf">dmacHw_setVariableDataDescriptor</span><span class="p">(</span><span class="n">dmacHw_HANDLE_t</span> <span class="n">handle</span><span class="p">,</span>	<span class="cm">/*   [ IN ] DMA Channel handle */</span>
				     <span class="n">dmacHw_CONFIG_t</span> <span class="o">*</span><span class="n">pConfig</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Configuration settings */</span>
				     <span class="kt">void</span> <span class="o">*</span><span class="n">pDescriptor</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Descriptor buffer */</span>
				     <span class="kt">uint32_t</span> <span class="n">srcAddr</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Source peripheral address */</span>
				     <span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">fpAlloc</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span> <span class="n">len</span><span class="p">),</span>	<span class="cm">/*   [ IN ] Function pointer  that provides destination memory */</span>
				     <span class="kt">int</span> <span class="n">len</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Number of bytes &quot;fpAlloc&quot; will allocate for destination */</span>
				     <span class="kt">int</span> <span class="n">num</span>	<span class="cm">/*   [ IN ] Number of descriptor to set */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_CBLK_t</span> <span class="o">*</span><span class="n">pCblk</span> <span class="o">=</span> <span class="n">dmacHw_HANDLE_TO_CBLK</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
	<span class="n">dmacHw_DESC_t</span> <span class="o">*</span><span class="n">pProg</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">dmacHw_DESC_t</span> <span class="o">*</span><span class="n">pLast</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">dmacHw_DESC_RING_t</span> <span class="o">*</span><span class="n">pRing</span> <span class="o">=</span> <span class="n">dmacHw_GET_DESC_RING</span><span class="p">(</span><span class="n">pDescriptor</span><span class="p">);</span>
	<span class="kt">uint32_t</span> <span class="n">dstAddr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">controlParam</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">dmacHw_ASSERT</span><span class="p">(</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">transferType</span> <span class="o">==</span>
		      <span class="n">dmacHw_TRANSFER_TYPE_PERIPHERAL_TO_MEM</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">&gt;</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">num</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">pLast</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pEnd</span><span class="p">;</span>	<span class="cm">/* Last descriptor updated */</span>
	<span class="n">pProg</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">;</span>	<span class="cm">/* First descriptor in the new list */</span>

	<span class="n">controlParam</span> <span class="o">=</span> <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">srcUpdate</span> <span class="o">|</span>
	    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">dstUpdate</span> <span class="o">|</span>
	    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">srcMaxTransactionWidth</span> <span class="o">|</span>
	    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">dstMaxTransactionWidth</span> <span class="o">|</span>
	    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">srcMasterInterface</span> <span class="o">|</span>
	    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">dstMasterInterface</span> <span class="o">|</span>
	    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">srcMaxBurstWidth</span> <span class="o">|</span>
	    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">dstMaxBurstWidth</span> <span class="o">|</span>
	    <span class="n">dmacHw_REG_CTL_TTFC_PM_PERI</span> <span class="o">|</span>
	    <span class="n">dmacHw_REG_CTL_LLP_DST_EN</span> <span class="o">|</span>
	    <span class="n">dmacHw_REG_CTL_LLP_SRC_EN</span> <span class="o">|</span> <span class="n">dmacHw_REG_CTL_INT_EN</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Allocate Rx buffer only for idle descriptor */</span>
		<span class="k">if</span> <span class="p">(((</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">hi</span> <span class="o">&amp;</span> <span class="n">dmacHw_DESC_FREE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">((</span><span class="n">dmacHw_DESC_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">llp</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span><span class="p">)</span>
		    <span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Rx descriptor is not idle */</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="cm">/* Set source address */</span>
		<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">sar</span> <span class="o">=</span> <span class="n">srcAddr</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fpAlloc</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Allocate memory for buffer in descriptor */</span>
			<span class="n">dstAddr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">fpAlloc</span><span class="p">)</span> <span class="p">(</span><span class="n">len</span><span class="p">);</span>
			<span class="cm">/* Check the destination address */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dstAddr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/* Not a single descriptor is available */</span>
					<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="cm">/* Set destination address */</span>
			<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">dar</span> <span class="o">=</span> <span class="n">dstAddr</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="cm">/* Set control information */</span>
		<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">lo</span> <span class="o">=</span> <span class="n">controlParam</span><span class="p">;</span>
		<span class="cm">/* Use &quot;devCtl&quot; to mark the memory that need to be freed later */</span>
		<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">devCtl</span> <span class="o">=</span> <span class="n">dmacHw_FREE_USER_MEMORY</span><span class="p">;</span>
		<span class="cm">/* Descriptor is now owned by the channel */</span>
		<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">hi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="cm">/* Remember the descriptor last updated */</span>
		<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pEnd</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">;</span>
		<span class="cm">/* Update next descriptor */</span>
		<span class="n">dmacHw_NEXT_DESC</span><span class="p">(</span><span class="n">pRing</span><span class="p">,</span> <span class="n">pHead</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Mark the end of the list */</span>
	<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pEnd</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">lo</span> <span class="o">&amp;=</span>
	    <span class="o">~</span><span class="p">(</span><span class="n">dmacHw_REG_CTL_LLP_DST_EN</span> <span class="o">|</span> <span class="n">dmacHw_REG_CTL_LLP_SRC_EN</span><span class="p">);</span>
	<span class="cm">/* Connect the list */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pLast</span> <span class="o">!=</span> <span class="n">pProg</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pLast</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">lo</span> <span class="o">|=</span>
		    <span class="n">dmacHw_REG_CTL_LLP_DST_EN</span> <span class="o">|</span> <span class="n">dmacHw_REG_CTL_LLP_SRC_EN</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* Mark the descriptors are updated */</span>
	<span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">descUpdated</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">varDataStarted</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* LLP must be pointing to the first descriptor */</span>
		<span class="n">dmacHw_SET_LLP</span><span class="p">(</span><span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">module</span><span class="p">,</span> <span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span>
			       <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">pProg</span> <span class="o">-</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">virt2PhyOffset</span><span class="p">);</span>
		<span class="cm">/* Channel, handling variable data started */</span>
		<span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">varDataStarted</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Read data DMAed to memory</span>
<span class="cm">*</span>
<span class="cm">*  This function will read data that has been DMAed to memory while transferring from:</span>
<span class="cm">*          - Memory to memory</span>
<span class="cm">*          - Peripheral to memory</span>
<span class="cm">*</span>
<span class="cm">*  @param    handle     -</span>
<span class="cm">*  @param    ppBbuf     -</span>
<span class="cm">*  @param    pLen       -</span>
<span class="cm">*</span>
<span class="cm">*  @return  0 - No more data is available to read</span>
<span class="cm">*           1 - More data might be available to read</span>
<span class="cm">*</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">int</span> <span class="nf">dmacHw_readTransferredData</span><span class="p">(</span><span class="n">dmacHw_HANDLE_t</span> <span class="n">handle</span><span class="p">,</span>	<span class="cm">/*  [ IN ] DMA Channel handle */</span>
			       <span class="n">dmacHw_CONFIG_t</span> <span class="o">*</span><span class="n">pConfig</span><span class="p">,</span>	<span class="cm">/*   [ IN ]  Configuration settings */</span>
			       <span class="kt">void</span> <span class="o">*</span><span class="n">pDescriptor</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Descriptor buffer */</span>
			       <span class="kt">void</span> <span class="o">**</span><span class="n">ppBbuf</span><span class="p">,</span>	<span class="cm">/*   [ OUT ] Data received */</span>
			       <span class="kt">size_t</span> <span class="o">*</span><span class="n">pLlen</span>	<span class="cm">/*   [ OUT ] Length of the data received */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_DESC_RING_t</span> <span class="o">*</span><span class="n">pRing</span> <span class="o">=</span> <span class="n">dmacHw_GET_DESC_RING</span><span class="p">(</span><span class="n">pDescriptor</span><span class="p">);</span>

	<span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">handle</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">transferMode</span> <span class="o">!=</span> <span class="n">dmacHw_TRANSFER_MODE_CONTINUOUS</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(((</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">hi</span> <span class="o">&amp;</span> <span class="n">dmacHw_DESC_FREE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span> <span class="o">==</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">)</span>
		    <span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* No receive data available */</span>
			<span class="o">*</span><span class="n">ppBbuf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
			<span class="o">*</span><span class="n">pLlen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/* Return read buffer and length */</span>
	<span class="o">*</span><span class="n">ppBbuf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span><span class="o">-&gt;</span><span class="n">dar</span><span class="p">;</span>

	<span class="cm">/* Extract length of the received data */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">DmaIsFlowController</span><span class="p">(</span><span class="n">pDescriptor</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">uint32_t</span> <span class="n">srcTrSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">lo</span> <span class="o">&amp;</span> <span class="n">dmacHw_REG_CTL_SRC_TR_WIDTH_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">dmacHw_REG_CTL_SRC_TR_WIDTH_8</span>:
			<span class="n">srcTrSize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">dmacHw_REG_CTL_SRC_TR_WIDTH_16</span>:
			<span class="n">srcTrSize</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">dmacHw_REG_CTL_SRC_TR_WIDTH_32</span>:
			<span class="n">srcTrSize</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">dmacHw_REG_CTL_SRC_TR_WIDTH_64</span>:
			<span class="n">srcTrSize</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">dmacHw_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="cm">/* Calculate length from the block size */</span>
		<span class="o">*</span><span class="n">pLlen</span> <span class="o">=</span>
		    <span class="p">(</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">hi</span> <span class="o">&amp;</span> <span class="n">dmacHw_REG_CTL_BLOCK_TS_MASK</span><span class="p">)</span> <span class="o">*</span>
		    <span class="n">srcTrSize</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* Extract length from the source peripheral */</span>
		<span class="o">*</span><span class="n">pLlen</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span><span class="o">-&gt;</span><span class="n">sstat</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Advance tail to next descriptor */</span>
	<span class="n">dmacHw_NEXT_DESC</span><span class="p">(</span><span class="n">pRing</span><span class="p">,</span> <span class="n">pTail</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Set descriptor carrying control information</span>
<span class="cm">*</span>
<span class="cm">*  This function will be used to send specific control information to the device</span>
<span class="cm">*  using the DMA channel</span>
<span class="cm">*</span>
<span class="cm">*</span>
<span class="cm">*  @return  -1 - On failure</span>
<span class="cm">*            0 - On success</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*     None</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">int</span> <span class="nf">dmacHw_setControlDescriptor</span><span class="p">(</span><span class="n">dmacHw_CONFIG_t</span> <span class="o">*</span><span class="n">pConfig</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Configuration settings */</span>
				<span class="kt">void</span> <span class="o">*</span><span class="n">pDescriptor</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Descriptor buffer */</span>
				<span class="kt">uint32_t</span> <span class="n">ctlAddress</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Address of the device control register */</span>
				<span class="kt">uint32_t</span> <span class="n">control</span>	<span class="cm">/*   [ IN ] Device control information */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_DESC_RING_t</span> <span class="o">*</span><span class="n">pRing</span> <span class="o">=</span> <span class="n">dmacHw_GET_DESC_RING</span><span class="p">(</span><span class="n">pDescriptor</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ctlAddress</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Check the availability of descriptors in the ring */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">hi</span> <span class="o">&amp;</span> <span class="n">dmacHw_DESC_FREE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* Set control information */</span>
	<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">devCtl</span> <span class="o">=</span> <span class="n">control</span><span class="p">;</span>
	<span class="cm">/* Set source and destination address */</span>
	<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">sar</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">devCtl</span><span class="p">;</span>
	<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">dar</span> <span class="o">=</span> <span class="n">ctlAddress</span><span class="p">;</span>
	<span class="cm">/* Set control parameters */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">flowControler</span> <span class="o">==</span> <span class="n">dmacHw_FLOW_CONTROL_DMA</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">lo</span> <span class="o">=</span> <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">transferType</span> <span class="o">|</span>
		    <span class="n">dmacHw_SRC_ADDRESS_UPDATE_MODE_INC</span> <span class="o">|</span>
		    <span class="n">dmacHw_DST_ADDRESS_UPDATE_MODE_INC</span> <span class="o">|</span>
		    <span class="n">dmacHw_SRC_TRANSACTION_WIDTH_32</span> <span class="o">|</span>
		    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">dstMaxTransactionWidth</span> <span class="o">|</span>
		    <span class="n">dmacHw_SRC_BURST_WIDTH_0</span> <span class="o">|</span>
		    <span class="n">dmacHw_DST_BURST_WIDTH_0</span> <span class="o">|</span>
		    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">srcMasterInterface</span> <span class="o">|</span>
		    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">dstMasterInterface</span> <span class="o">|</span> <span class="n">dmacHw_REG_CTL_INT_EN</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="kt">uint32_t</span> <span class="n">transferType</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">transferType</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">dmacHw_TRANSFER_TYPE_PERIPHERAL_TO_MEM</span>:
			<span class="n">transferType</span> <span class="o">=</span> <span class="n">dmacHw_REG_CTL_TTFC_PM_PERI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">dmacHw_TRANSFER_TYPE_MEM_TO_PERIPHERAL</span>:
			<span class="n">transferType</span> <span class="o">=</span> <span class="n">dmacHw_REG_CTL_TTFC_MP_PERI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">dmacHw_ASSERT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">lo</span> <span class="o">=</span> <span class="n">transferType</span> <span class="o">|</span>
		    <span class="n">dmacHw_SRC_ADDRESS_UPDATE_MODE_INC</span> <span class="o">|</span>
		    <span class="n">dmacHw_DST_ADDRESS_UPDATE_MODE_INC</span> <span class="o">|</span>
		    <span class="n">dmacHw_SRC_TRANSACTION_WIDTH_32</span> <span class="o">|</span>
		    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">dstMaxTransactionWidth</span> <span class="o">|</span>
		    <span class="n">dmacHw_SRC_BURST_WIDTH_0</span> <span class="o">|</span>
		    <span class="n">dmacHw_DST_BURST_WIDTH_0</span> <span class="o">|</span>
		    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">srcMasterInterface</span> <span class="o">|</span>
		    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">dstMasterInterface</span> <span class="o">|</span>
		    <span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">flowControler</span> <span class="o">|</span> <span class="n">dmacHw_REG_CTL_INT_EN</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Set block transaction size to one 32 bit transaction */</span>
	<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">hi</span> <span class="o">=</span> <span class="n">dmacHw_REG_CTL_BLOCK_TS_MASK</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* Remember the descriptor to initialize the registers */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pProg</span> <span class="o">==</span> <span class="n">dmacHw_DESC_INIT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pProg</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pEnd</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">;</span>

	<span class="cm">/* Advance the descriptor */</span>
	<span class="n">dmacHw_NEXT_DESC</span><span class="p">(</span><span class="n">pRing</span><span class="p">,</span> <span class="n">pHead</span><span class="p">);</span>

	<span class="cm">/* Update Tail pointer if destination is a peripheral */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dmacHw_DST_IS_MEMORY</span><span class="p">(</span><span class="n">pConfig</span><span class="o">-&gt;</span><span class="n">transferType</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Sets channel specific user data</span>
<span class="cm">*</span>
<span class="cm">*  This function associates user data to a specific DMA channel</span>
<span class="cm">*</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="nf">dmacHw_setChannelUserData</span><span class="p">(</span><span class="n">dmacHw_HANDLE_t</span> <span class="n">handle</span><span class="p">,</span>	<span class="cm">/*  [ IN ] DMA Channel handle */</span>
			       <span class="kt">void</span> <span class="o">*</span><span class="n">userData</span>	<span class="cm">/*  [ IN ] User data */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_CBLK_t</span> <span class="o">*</span><span class="n">pCblk</span> <span class="o">=</span> <span class="n">dmacHw_HANDLE_TO_CBLK</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>

	<span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">userData</span> <span class="o">=</span> <span class="n">userData</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Gets channel specific user data</span>
<span class="cm">*</span>
<span class="cm">*  This function returns user data specific to a DMA channel</span>
<span class="cm">*</span>
<span class="cm">*  @return   user data</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="o">*</span><span class="nf">dmacHw_getChannelUserData</span><span class="p">(</span><span class="n">dmacHw_HANDLE_t</span> <span class="n">handle</span>	<span class="cm">/*  [ IN ] DMA Channel handle */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_CBLK_t</span> <span class="o">*</span><span class="n">pCblk</span> <span class="o">=</span> <span class="n">dmacHw_HANDLE_TO_CBLK</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">userData</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Resets descriptor control information</span>
<span class="cm">*</span>
<span class="cm">*  @return  void</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="nf">dmacHw_resetDescriptorControl</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">pDescriptor</span>	<span class="cm">/*   [ IN ] Descriptor buffer  */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">dmacHw_DESC_RING_t</span> <span class="o">*</span><span class="n">pRing</span><span class="p">;</span>
	<span class="n">dmacHw_DESC_t</span> <span class="o">*</span><span class="n">pDesc</span><span class="p">;</span>

	<span class="n">pRing</span> <span class="o">=</span> <span class="n">dmacHw_GET_DESC_RING</span><span class="p">(</span><span class="n">pDescriptor</span><span class="p">);</span>
	<span class="n">pDesc</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">num</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Mark descriptor is ready to use */</span>
		<span class="n">pDesc</span><span class="o">-&gt;</span><span class="n">ctl</span><span class="p">.</span><span class="n">hi</span> <span class="o">=</span> <span class="n">dmacHw_DESC_FREE</span><span class="p">;</span>
		<span class="cm">/* Look into next link list item */</span>
		<span class="n">pDesc</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pFree</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pTail</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pEnd</span> <span class="o">=</span> <span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pHead</span><span class="p">;</span>
	<span class="n">pRing</span><span class="o">-&gt;</span><span class="n">pProg</span> <span class="o">=</span> <span class="n">dmacHw_DESC_INIT</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/**</span>
<span class="cm">*  @brief   Displays channel specific registers and other control parameters</span>
<span class="cm">*</span>
<span class="cm">*  @return  void</span>
<span class="cm">*</span>
<span class="cm">*</span>
<span class="cm">*  @note</span>
<span class="cm">*     None</span>
<span class="cm">*/</span>
<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="nf">dmacHw_printDebugInfo</span><span class="p">(</span><span class="n">dmacHw_HANDLE_t</span> <span class="n">handle</span><span class="p">,</span>	<span class="cm">/*  [ IN ] DMA Channel handle */</span>
			   <span class="kt">void</span> <span class="o">*</span><span class="n">pDescriptor</span><span class="p">,</span>	<span class="cm">/*   [ IN ] Descriptor buffer */</span>
			   <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fpPrint</span><span class="p">)</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="p">...)</span>	<span class="cm">/*  [ IN ] Print callback function */</span>
    <span class="p">)</span> <span class="p">{</span>
	<span class="n">dmacHw_CBLK_t</span> <span class="o">*</span><span class="n">pCblk</span> <span class="o">=</span> <span class="n">dmacHw_HANDLE_TO_CBLK</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>

	<span class="n">DisplayRegisterContents</span><span class="p">(</span><span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">module</span><span class="p">,</span> <span class="n">pCblk</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span> <span class="n">fpPrint</span><span class="p">);</span>
	<span class="n">DisplayDescRing</span><span class="p">(</span><span class="n">pDescriptor</span><span class="p">,</span> <span class="n">fpPrint</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
