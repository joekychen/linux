<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-sa1100 › cpu-sa1100.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>cpu-sa1100.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * cpu-sa1100.c: clock scaling for the SA1100</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2000 2001, The Delft University of Technology</span>
<span class="cm"> *</span>
<span class="cm"> * Authors:</span>
<span class="cm"> * - Johan Pouwelse (J.A.Pouwelse@its.tudelft.nl): initial version</span>
<span class="cm"> * - Erik Mouw (J.A.K.Mouw@its.tudelft.nl):</span>
<span class="cm"> *   - major rewrite for linux-2.3.99</span>
<span class="cm"> *   - rewritten for the more generic power management scheme in</span>
<span class="cm"> *     linux-2.4.5-rmk1</span>
<span class="cm"> *</span>
<span class="cm"> * This software has been developed while working on the LART</span>
<span class="cm"> * computing board (http://www.lartmaker.nl/), which is</span>
<span class="cm"> * sponsored by the Mobile Multi-media Communications</span>
<span class="cm"> * (http://www.mobimedia.org/) and Ubiquitous Communications</span>
<span class="cm"> * (http://www.ubicom.tudelft.nl/) projects.</span>
<span class="cm"> *</span>
<span class="cm"> * The authors can be reached at:</span>
<span class="cm"> *</span>
<span class="cm"> *  Erik Mouw</span>
<span class="cm"> *  Information and Communication Theory Group</span>
<span class="cm"> *  Faculty of Information Technology and Systems</span>
<span class="cm"> *  Delft University of Technology</span>
<span class="cm"> *  P.O. Box 5031</span>
<span class="cm"> *  2600 GA Delft</span>
<span class="cm"> *  The Netherlands</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Theory of operations</span>
<span class="cm"> * ====================</span>
<span class="cm"> *</span>
<span class="cm"> * Clock scaling can be used to lower the power consumption of the CPU</span>
<span class="cm"> * core. This will give you a somewhat longer running time.</span>
<span class="cm"> *</span>
<span class="cm"> * The SA-1100 has a single register to change the core clock speed:</span>
<span class="cm"> *</span>
<span class="cm"> *   PPCR      0x90020014    PLL config</span>
<span class="cm"> *</span>
<span class="cm"> * However, the DRAM timings are closely related to the core clock</span>
<span class="cm"> * speed, so we need to change these, too. The used registers are:</span>
<span class="cm"> *</span>
<span class="cm"> *   MDCNFG    0xA0000000    DRAM config</span>
<span class="cm"> *   MDCAS0    0xA0000004    Access waveform</span>
<span class="cm"> *   MDCAS1    0xA0000008    Access waveform</span>
<span class="cm"> *   MDCAS2    0xA000000C    Access waveform</span>
<span class="cm"> *</span>
<span class="cm"> * Care must be taken to change the DRAM parameters the correct way,</span>
<span class="cm"> * because otherwise the DRAM becomes unusable and the kernel will</span>
<span class="cm"> * crash.</span>
<span class="cm"> *</span>
<span class="cm"> * The simple solution to avoid a kernel crash is to put the actual</span>
<span class="cm"> * clock change in ROM and jump to that code from the kernel. The main</span>
<span class="cm"> * disadvantage is that the ROM has to be modified, which is not</span>
<span class="cm"> * possible on all SA-1100 platforms. Another disadvantage is that</span>
<span class="cm"> * jumping to ROM makes clock switching unnecessary complicated.</span>
<span class="cm"> *</span>
<span class="cm"> * The idea behind this driver is that the memory configuration can be</span>
<span class="cm"> * changed while running from DRAM (even with interrupts turned on!)</span>
<span class="cm"> * as long as all re-configuration steps yield a valid DRAM</span>
<span class="cm"> * configuration. The advantages are clear: it will run on all SA-1100</span>
<span class="cm"> * platforms, and the code is very simple.</span>
<span class="cm"> *</span>
<span class="cm"> * If you really want to understand what is going on in</span>
<span class="cm"> * sa1100_update_dram_timings(), you&#39;ll have to read sections 8.2,</span>
<span class="cm"> * 9.5.7.3, and 10.2 from the &quot;Intel StrongARM SA-1100 Microprocessor</span>
<span class="cm"> * Developers Manual&quot; (available for free from Intel).</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/cpufreq.h&gt;</span>

<span class="cp">#include &lt;asm/cputype.h&gt;</span>

<span class="cp">#include &lt;mach/hardware.h&gt;</span>

<span class="cp">#include &quot;generic.h&quot;</span>

<span class="k">struct</span> <span class="n">sa1100_dram_regs</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">speed</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mdcnfg</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mdcas0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mdcas1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mdcas2</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">static</span> <span class="k">struct</span> <span class="n">cpufreq_driver</span> <span class="n">sa1100_driver</span><span class="p">;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sa1100_dram_regs</span> <span class="n">sa1100_dram_settings</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/*speed,     mdcnfg,     mdcas0,     mdcas1,     mdcas2,   clock freq */</span>
	<span class="p">{</span> <span class="mi">59000</span><span class="p">,</span> <span class="mh">0x00dc88a3</span><span class="p">,</span> <span class="mh">0xcccccccf</span><span class="p">,</span> <span class="mh">0xfffffffc</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/*  59.0 MHz */</span>
	<span class="p">{</span> <span class="mi">73700</span><span class="p">,</span> <span class="mh">0x011490a3</span><span class="p">,</span> <span class="mh">0xcccccccf</span><span class="p">,</span> <span class="mh">0xfffffffc</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/*  73.7 MHz */</span>
	<span class="p">{</span> <span class="mi">88500</span><span class="p">,</span> <span class="mh">0x014e90a3</span><span class="p">,</span> <span class="mh">0xcccccccf</span><span class="p">,</span> <span class="mh">0xfffffffc</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/*  88.5 MHz */</span>
	<span class="p">{</span><span class="mi">103200</span><span class="p">,</span> <span class="mh">0x01889923</span><span class="p">,</span> <span class="mh">0xcccccccf</span><span class="p">,</span> <span class="mh">0xfffffffc</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/* 103.2 MHz */</span>
	<span class="p">{</span><span class="mi">118000</span><span class="p">,</span> <span class="mh">0x01c29923</span><span class="p">,</span> <span class="mh">0x9999998f</span><span class="p">,</span> <span class="mh">0xfffffff9</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/* 118.0 MHz */</span>
	<span class="p">{</span><span class="mi">132700</span><span class="p">,</span> <span class="mh">0x01fb2123</span><span class="p">,</span> <span class="mh">0x9999998f</span><span class="p">,</span> <span class="mh">0xfffffff9</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/* 132.7 MHz */</span>
	<span class="p">{</span><span class="mi">147500</span><span class="p">,</span> <span class="mh">0x02352123</span><span class="p">,</span> <span class="mh">0x3333330f</span><span class="p">,</span> <span class="mh">0xfffffff3</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/* 147.5 MHz */</span>
	<span class="p">{</span><span class="mi">162200</span><span class="p">,</span> <span class="mh">0x026b29a3</span><span class="p">,</span> <span class="mh">0x38e38e1f</span><span class="p">,</span> <span class="mh">0xfff8e38e</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/* 162.2 MHz */</span>
	<span class="p">{</span><span class="mi">176900</span><span class="p">,</span> <span class="mh">0x02a329a3</span><span class="p">,</span> <span class="mh">0x71c71c1f</span><span class="p">,</span> <span class="mh">0xfff1c71c</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/* 176.9 MHz */</span>
	<span class="p">{</span><span class="mi">191700</span><span class="p">,</span> <span class="mh">0x02dd31a3</span><span class="p">,</span> <span class="mh">0xe38e383f</span><span class="p">,</span> <span class="mh">0xffe38e38</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/* 191.7 MHz */</span>
	<span class="p">{</span><span class="mi">206400</span><span class="p">,</span> <span class="mh">0x03153223</span><span class="p">,</span> <span class="mh">0xc71c703f</span><span class="p">,</span> <span class="mh">0xffc71c71</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/* 206.4 MHz */</span>
	<span class="p">{</span><span class="mi">221200</span><span class="p">,</span> <span class="mh">0x034fba23</span><span class="p">,</span> <span class="mh">0xc71c703f</span><span class="p">,</span> <span class="mh">0xffc71c71</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">},</span><span class="cm">/* 221.2 MHz */</span>
	<span class="p">{</span><span class="mi">235900</span><span class="p">,</span> <span class="mh">0x03853a23</span><span class="p">,</span> <span class="mh">0xe1e1e07f</span><span class="p">,</span> <span class="mh">0xe1e1e1e1</span><span class="p">,</span> <span class="mh">0xffffffe1</span><span class="p">},</span><span class="cm">/* 235.9 MHz */</span>
	<span class="p">{</span><span class="mi">250700</span><span class="p">,</span> <span class="mh">0x03bf3aa3</span><span class="p">,</span> <span class="mh">0xc3c3c07f</span><span class="p">,</span> <span class="mh">0xc3c3c3c3</span><span class="p">,</span> <span class="mh">0xffffffc3</span><span class="p">},</span><span class="cm">/* 250.7 MHz */</span>
	<span class="p">{</span><span class="mi">265400</span><span class="p">,</span> <span class="mh">0x03f7c2a3</span><span class="p">,</span> <span class="mh">0xc3c3c07f</span><span class="p">,</span> <span class="mh">0xc3c3c3c3</span><span class="p">,</span> <span class="mh">0xffffffc3</span><span class="p">},</span><span class="cm">/* 265.4 MHz */</span>
	<span class="p">{</span><span class="mi">280200</span><span class="p">,</span> <span class="mh">0x0431c2a3</span><span class="p">,</span> <span class="mh">0x878780ff</span><span class="p">,</span> <span class="mh">0x87878787</span><span class="p">,</span> <span class="mh">0xffffff87</span><span class="p">},</span><span class="cm">/* 280.2 MHz */</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span> <span class="cm">/* last entry */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sa1100_update_dram_timings</span><span class="p">(</span><span class="kt">int</span> <span class="n">current_speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">new_speed</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sa1100_dram_regs</span> <span class="o">*</span><span class="n">settings</span> <span class="o">=</span> <span class="n">sa1100_dram_settings</span><span class="p">;</span>

	<span class="cm">/* find speed */</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">settings</span><span class="o">-&gt;</span><span class="n">speed</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">new_speed</span> <span class="o">==</span> <span class="n">settings</span><span class="o">-&gt;</span><span class="n">speed</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="n">settings</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">settings</span><span class="o">-&gt;</span><span class="n">speed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">panic</span><span class="p">(</span><span class="s">&quot;%s: couldn&#39;t find dram setting for speed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		      <span class="n">__func__</span><span class="p">,</span> <span class="n">new_speed</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* No risk, no fun: run with interrupts on! */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">new_speed</span> <span class="o">&gt;</span> <span class="n">current_speed</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* We&#39;re going FASTER, so first relax the memory</span>
<span class="cm">		 * timings before changing the core frequency</span>
<span class="cm">		 */</span>

		<span class="cm">/* Half the memory access clock */</span>
		<span class="n">MDCNFG</span> <span class="o">|=</span> <span class="n">MDCNFG_CDB2</span><span class="p">;</span>

		<span class="cm">/* The order of these statements IS important, keep 8</span>
<span class="cm">		 * pulses!!</span>
<span class="cm">		 */</span>
		<span class="n">MDCAS2</span> <span class="o">=</span> <span class="n">settings</span><span class="o">-&gt;</span><span class="n">mdcas2</span><span class="p">;</span>
		<span class="n">MDCAS1</span> <span class="o">=</span> <span class="n">settings</span><span class="o">-&gt;</span><span class="n">mdcas1</span><span class="p">;</span>
		<span class="n">MDCAS0</span> <span class="o">=</span> <span class="n">settings</span><span class="o">-&gt;</span><span class="n">mdcas0</span><span class="p">;</span>
		<span class="n">MDCNFG</span> <span class="o">=</span> <span class="n">settings</span><span class="o">-&gt;</span><span class="n">mdcnfg</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* We&#39;re going SLOWER: first decrease the core</span>
<span class="cm">		 * frequency and then tighten the memory settings.</span>
<span class="cm">		 */</span>

		<span class="cm">/* Half the memory access clock */</span>
		<span class="n">MDCNFG</span> <span class="o">|=</span> <span class="n">MDCNFG_CDB2</span><span class="p">;</span>

		<span class="cm">/* The order of these statements IS important, keep 8</span>
<span class="cm">		 * pulses!!</span>
<span class="cm">		 */</span>
		<span class="n">MDCAS0</span> <span class="o">=</span> <span class="n">settings</span><span class="o">-&gt;</span><span class="n">mdcas0</span><span class="p">;</span>
		<span class="n">MDCAS1</span> <span class="o">=</span> <span class="n">settings</span><span class="o">-&gt;</span><span class="n">mdcas1</span><span class="p">;</span>
		<span class="n">MDCAS2</span> <span class="o">=</span> <span class="n">settings</span><span class="o">-&gt;</span><span class="n">mdcas2</span><span class="p">;</span>
		<span class="n">MDCNFG</span> <span class="o">=</span> <span class="n">settings</span><span class="o">-&gt;</span><span class="n">mdcnfg</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sa1100_target</span><span class="p">(</span><span class="k">struct</span> <span class="n">cpufreq_policy</span> <span class="o">*</span><span class="n">policy</span><span class="p">,</span>
			 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">target_freq</span><span class="p">,</span>
			 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">relation</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cur</span> <span class="o">=</span> <span class="n">sa11x0_getspeed</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">new_ppcr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cpufreq_freqs</span> <span class="n">freqs</span><span class="p">;</span>

	<span class="n">new_ppcr</span> <span class="o">=</span> <span class="n">sa11x0_freq_to_ppcr</span><span class="p">(</span><span class="n">target_freq</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">relation</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CPUFREQ_RELATION_L</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">sa11x0_ppcr_to_freq</span><span class="p">(</span><span class="n">new_ppcr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">policy</span><span class="o">-&gt;</span><span class="n">max</span><span class="p">)</span>
			<span class="n">new_ppcr</span><span class="o">--</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CPUFREQ_RELATION_H</span>:
		<span class="k">if</span> <span class="p">((</span><span class="n">sa11x0_ppcr_to_freq</span><span class="p">(</span><span class="n">new_ppcr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">target_freq</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="p">(</span><span class="n">sa11x0_ppcr_to_freq</span><span class="p">(</span><span class="n">new_ppcr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">policy</span><span class="o">-&gt;</span><span class="n">min</span><span class="p">))</span>
			<span class="n">new_ppcr</span><span class="o">--</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">freqs</span><span class="p">.</span><span class="n">old</span> <span class="o">=</span> <span class="n">cur</span><span class="p">;</span>
	<span class="n">freqs</span><span class="p">.</span><span class="n">new</span> <span class="o">=</span> <span class="n">sa11x0_ppcr_to_freq</span><span class="p">(</span><span class="n">new_ppcr</span><span class="p">);</span>
	<span class="n">freqs</span><span class="p">.</span><span class="n">cpu</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">cpufreq_notify_transition</span><span class="p">(</span><span class="o">&amp;</span><span class="n">freqs</span><span class="p">,</span> <span class="n">CPUFREQ_PRECHANGE</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">freqs</span><span class="p">.</span><span class="n">new</span> <span class="o">&gt;</span> <span class="n">cur</span><span class="p">)</span>
		<span class="n">sa1100_update_dram_timings</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">freqs</span><span class="p">.</span><span class="n">new</span><span class="p">);</span>

	<span class="n">PPCR</span> <span class="o">=</span> <span class="n">new_ppcr</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">freqs</span><span class="p">.</span><span class="n">new</span> <span class="o">&lt;</span> <span class="n">cur</span><span class="p">)</span>
		<span class="n">sa1100_update_dram_timings</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">freqs</span><span class="p">.</span><span class="n">new</span><span class="p">);</span>

	<span class="n">cpufreq_notify_transition</span><span class="p">(</span><span class="o">&amp;</span><span class="n">freqs</span><span class="p">,</span> <span class="n">CPUFREQ_POSTCHANGE</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">sa1100_cpu_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">cpufreq_policy</span> <span class="o">*</span><span class="n">policy</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">policy</span><span class="o">-&gt;</span><span class="n">cpu</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">policy</span><span class="o">-&gt;</span><span class="n">cur</span> <span class="o">=</span> <span class="n">policy</span><span class="o">-&gt;</span><span class="n">min</span> <span class="o">=</span> <span class="n">policy</span><span class="o">-&gt;</span><span class="n">max</span> <span class="o">=</span> <span class="n">sa11x0_getspeed</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">policy</span><span class="o">-&gt;</span><span class="n">cpuinfo</span><span class="p">.</span><span class="n">min_freq</span> <span class="o">=</span> <span class="mi">59000</span><span class="p">;</span>
	<span class="n">policy</span><span class="o">-&gt;</span><span class="n">cpuinfo</span><span class="p">.</span><span class="n">max_freq</span> <span class="o">=</span> <span class="mi">287000</span><span class="p">;</span>
	<span class="n">policy</span><span class="o">-&gt;</span><span class="n">cpuinfo</span><span class="p">.</span><span class="n">transition_latency</span> <span class="o">=</span> <span class="n">CPUFREQ_ETERNAL</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">cpufreq_driver</span> <span class="n">sa1100_driver</span> <span class="n">__refdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">CPUFREQ_STICKY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">verify</span>		<span class="o">=</span> <span class="n">sa11x0_verify_speed</span><span class="p">,</span>
	<span class="p">.</span><span class="n">target</span>		<span class="o">=</span> <span class="n">sa1100_target</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span>		<span class="o">=</span> <span class="n">sa11x0_getspeed</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="n">sa1100_cpu_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sa1100&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">sa1100_dram_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cpu_is_sa1100</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">cpufreq_register_driver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sa1100_driver</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">arch_initcall</span><span class="p">(</span><span class="n">sa1100_dram_init</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
