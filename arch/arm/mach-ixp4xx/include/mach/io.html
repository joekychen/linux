<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-ixp4xx › include › mach › io.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>io.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * arch/arm/mach-ixp4xx/include/mach/io.h</span>
<span class="cm"> *</span>
<span class="cm"> * Author: Deepak Saxena &lt;dsaxena@plexity.net&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2002-2005  MontaVista Software, Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASM_ARM_ARCH_IO_H</span>
<span class="cp">#define __ASM_ARM_ARCH_IO_H</span>

<span class="cp">#include &lt;linux/bitops.h&gt;</span>

<span class="cp">#include &lt;mach/hardware.h&gt;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">ixp4xx_pci_read</span><span class="p">)(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">u32</span><span class="o">*</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ixp4xx_pci_write</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">u32</span> <span class="n">data</span><span class="p">);</span>


<span class="cm">/*</span>
<span class="cm"> * IXP4xx provides two methods of accessing PCI memory space:</span>
<span class="cm"> *</span>
<span class="cm"> * 1) A direct mapped window from 0x48000000 to 0x4BFFFFFF (64MB).</span>
<span class="cm"> *    To access PCI via this space, we simply ioremap() the BAR</span>
<span class="cm"> *    into the kernel and we can use the standard read[bwl]/write[bwl]</span>
<span class="cm"> *    macros. This is the preffered method due to speed but it</span>
<span class="cm"> *    limits the system to just 64MB of PCI memory. This can be</span>
<span class="cm"> *    problematic if using video cards and other memory-heavy targets.</span>
<span class="cm"> *</span>
<span class="cm"> * 2) If &gt; 64MB of memory space is required, the IXP4xx can use indirect</span>
<span class="cm"> *    registers to access the whole 4 GB of PCI memory space (as we do below</span>
<span class="cm"> *    for I/O transactions). This allows currently for up to 1 GB (0x10000000</span>
<span class="cm"> *    to 0x4FFFFFFF) of memory on the bus. The disadvantage of this is that</span>
<span class="cm"> *    every PCI access requires three local register accesses plus a spinlock,</span>
<span class="cm"> *    but in some cases the performance hit is acceptable. In addition, you</span>
<span class="cm"> *    cannot mmap() PCI devices in this case.</span>
<span class="cm"> */</span>
<span class="cp">#ifdef	CONFIG_IXP4XX_INDIRECT_PCI</span>

<span class="cm">/*</span>
<span class="cm"> * In the case of using indirect PCI, we simply return the actual PCI</span>
<span class="cm"> * address and our read/write implementation use that to drive the </span>
<span class="cm"> * access registers. If something outside of PCI is ioremap&#39;d, we</span>
<span class="cm"> * fallback to the default.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">is_pci_memory</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">PCIBIOS_MIN_MEM</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&lt;=</span> <span class="mh">0x4FFFFFFF</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define writeb(v, p)			__indirect_writeb(v, p)</span>
<span class="cp">#define writew(v, p)			__indirect_writew(v, p)</span>
<span class="cp">#define writel(v, p)			__indirect_writel(v, p)</span>

<span class="cp">#define writesb(p, v, l)		__indirect_writesb(p, v, l)</span>
<span class="cp">#define writesw(p, v, l)		__indirect_writesw(p, v, l)</span>
<span class="cp">#define writesl(p, v, l)		__indirect_writesl(p, v, l)</span>

<span class="cp">#define readb(p)			__indirect_readb(p)</span>
<span class="cp">#define readw(p)			__indirect_readw(p)</span>
<span class="cp">#define readl(p)			__indirect_readl(p)</span>

<span class="cp">#define readsb(p, v, l)			__indirect_readsb(p, v, l)</span>
<span class="cp">#define readsw(p, v, l)			__indirect_readsw(p, v, l)</span>
<span class="cp">#define readsl(p, v, l)			__indirect_readsl(p, v, l)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__indirect_writeb</span><span class="p">(</span><span class="n">u8</span> <span class="n">value</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">n</span><span class="p">,</span> <span class="n">byte_enables</span><span class="p">,</span> <span class="n">data</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_pci_memory</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">__raw_writeb</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">n</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">byte_enables</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">IXP4XX_PCI_NP_CBE_BESL</span><span class="p">;</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
	<span class="n">ixp4xx_pci_write</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">byte_enables</span> <span class="o">|</span> <span class="n">NP_CMD_MEMWRITE</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__indirect_writesb</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">bus_addr</span><span class="p">,</span>
				      <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="n">writeb</span><span class="p">(</span><span class="o">*</span><span class="n">vaddr</span><span class="o">++</span><span class="p">,</span> <span class="n">bus_addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__indirect_writew</span><span class="p">(</span><span class="n">u16</span> <span class="n">value</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">n</span><span class="p">,</span> <span class="n">byte_enables</span><span class="p">,</span> <span class="n">data</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_pci_memory</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">__raw_writew</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">n</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">byte_enables</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span> <span class="o">&lt;&lt;</span> <span class="n">IXP4XX_PCI_NP_CBE_BESL</span><span class="p">;</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
	<span class="n">ixp4xx_pci_write</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">byte_enables</span> <span class="o">|</span> <span class="n">NP_CMD_MEMWRITE</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__indirect_writesw</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">bus_addr</span><span class="p">,</span>
				      <span class="k">const</span> <span class="n">u16</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="n">writew</span><span class="p">(</span><span class="o">*</span><span class="n">vaddr</span><span class="o">++</span><span class="p">,</span> <span class="n">bus_addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__indirect_writel</span><span class="p">(</span><span class="n">u32</span> <span class="n">value</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">__force</span> <span class="n">u32</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_pci_memory</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ixp4xx_pci_write</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">NP_CMD_MEMWRITE</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__indirect_writesl</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">bus_addr</span><span class="p">,</span>
				      <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="n">writel</span><span class="p">(</span><span class="o">*</span><span class="n">vaddr</span><span class="o">++</span><span class="p">,</span> <span class="n">bus_addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="nf">__indirect_readb</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">n</span><span class="p">,</span> <span class="n">byte_enables</span><span class="p">,</span> <span class="n">data</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_pci_memory</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">__raw_readb</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>

	<span class="n">n</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">byte_enables</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">IXP4XX_PCI_NP_CBE_BESL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ixp4xx_pci_read</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">byte_enables</span> <span class="o">|</span> <span class="n">NP_CMD_MEMREAD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">))</span>
		<span class="k">return</span> <span class="mh">0xff</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__indirect_readsb</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">bus_addr</span><span class="p">,</span>
				     <span class="n">u8</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">vaddr</span><span class="o">++</span> <span class="o">=</span> <span class="n">readb</span><span class="p">(</span><span class="n">bus_addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="nf">__indirect_readw</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">n</span><span class="p">,</span> <span class="n">byte_enables</span><span class="p">,</span> <span class="n">data</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_pci_memory</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">__raw_readw</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>

	<span class="n">n</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">byte_enables</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span> <span class="o">&lt;&lt;</span> <span class="n">IXP4XX_PCI_NP_CBE_BESL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ixp4xx_pci_read</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">byte_enables</span> <span class="o">|</span> <span class="n">NP_CMD_MEMREAD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">))</span>
		<span class="k">return</span> <span class="mh">0xffff</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">data</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__indirect_readsw</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">bus_addr</span><span class="p">,</span>
				     <span class="n">u16</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">vaddr</span><span class="o">++</span> <span class="o">=</span> <span class="n">readw</span><span class="p">(</span><span class="n">bus_addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">__indirect_readl</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">__force</span> <span class="n">u32</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">data</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_pci_memory</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ixp4xx_pci_read</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">NP_CMD_MEMREAD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">))</span>
		<span class="k">return</span> <span class="mh">0xffffffff</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__indirect_readsl</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">bus_addr</span><span class="p">,</span>
				     <span class="n">u32</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">vaddr</span><span class="o">++</span> <span class="o">=</span> <span class="n">readl</span><span class="p">(</span><span class="n">bus_addr</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * We can use the built-in functions b/c they end up calling writeb/readb</span>
<span class="cm"> */</span>
<span class="cp">#define memset_io(c,v,l)		_memset_io((c),(v),(l))</span>
<span class="cp">#define memcpy_fromio(a,c,l)		_memcpy_fromio((a),(c),(l))</span>
<span class="cp">#define memcpy_toio(c,a,l)		_memcpy_toio((c),(a),(l))</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_IXP4XX_INDIRECT_PCI */</span><span class="cp"></span>

<span class="cp">#ifndef CONFIG_PCI</span>

<span class="cp">#define	__io(v)		__typesafe_io(v)</span>

<span class="cp">#else</span>

<span class="cm">/*</span>
<span class="cm"> * IXP4xx does not have a transparent cpu -&gt; PCI I/O translation</span>
<span class="cm"> * window.  Instead, it has a set of registers that must be tweaked</span>
<span class="cm"> * with the proper byte lanes, command types, and address for the</span>
<span class="cm"> * transaction.  This means that we need to override the default</span>
<span class="cm"> * I/O functions.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">outb</span><span class="p">(</span><span class="n">u8</span> <span class="n">value</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">n</span><span class="p">,</span> <span class="n">byte_enables</span><span class="p">,</span> <span class="n">data</span><span class="p">;</span>
	<span class="n">n</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">byte_enables</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">IXP4XX_PCI_NP_CBE_BESL</span><span class="p">;</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
	<span class="n">ixp4xx_pci_write</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">byte_enables</span> <span class="o">|</span> <span class="n">NP_CMD_IOWRITE</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">outsb</span><span class="p">(</span><span class="n">u32</span> <span class="n">io_addr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="n">outb</span><span class="p">(</span><span class="o">*</span><span class="n">vaddr</span><span class="o">++</span><span class="p">,</span> <span class="n">io_addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">outw</span><span class="p">(</span><span class="n">u16</span> <span class="n">value</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">n</span><span class="p">,</span> <span class="n">byte_enables</span><span class="p">,</span> <span class="n">data</span><span class="p">;</span>
	<span class="n">n</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">byte_enables</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span> <span class="o">&lt;&lt;</span> <span class="n">IXP4XX_PCI_NP_CBE_BESL</span><span class="p">;</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
	<span class="n">ixp4xx_pci_write</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">byte_enables</span> <span class="o">|</span> <span class="n">NP_CMD_IOWRITE</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">outsw</span><span class="p">(</span><span class="n">u32</span> <span class="n">io_addr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u16</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="n">outw</span><span class="p">(</span><span class="n">cpu_to_le16</span><span class="p">(</span><span class="o">*</span><span class="n">vaddr</span><span class="o">++</span><span class="p">),</span> <span class="n">io_addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">outl</span><span class="p">(</span><span class="n">u32</span> <span class="n">value</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ixp4xx_pci_write</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">NP_CMD_IOWRITE</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">outsl</span><span class="p">(</span><span class="n">u32</span> <span class="n">io_addr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="n">outl</span><span class="p">(</span><span class="n">cpu_to_le32</span><span class="p">(</span><span class="o">*</span><span class="n">vaddr</span><span class="o">++</span><span class="p">),</span> <span class="n">io_addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">inb</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">n</span><span class="p">,</span> <span class="n">byte_enables</span><span class="p">,</span> <span class="n">data</span><span class="p">;</span>
	<span class="n">n</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">byte_enables</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">IXP4XX_PCI_NP_CBE_BESL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ixp4xx_pci_read</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">byte_enables</span> <span class="o">|</span> <span class="n">NP_CMD_IOREAD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">))</span>
		<span class="k">return</span> <span class="mh">0xff</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">insb</span><span class="p">(</span><span class="n">u32</span> <span class="n">io_addr</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">vaddr</span><span class="o">++</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">io_addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u16</span> <span class="nf">inw</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">n</span><span class="p">,</span> <span class="n">byte_enables</span><span class="p">,</span> <span class="n">data</span><span class="p">;</span>
	<span class="n">n</span> <span class="o">=</span> <span class="n">addr</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">byte_enables</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span> <span class="o">&lt;&lt;</span> <span class="n">IXP4XX_PCI_NP_CBE_BESL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ixp4xx_pci_read</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">byte_enables</span> <span class="o">|</span> <span class="n">NP_CMD_IOREAD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">))</span>
		<span class="k">return</span> <span class="mh">0xffff</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">data</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">insw</span><span class="p">(</span><span class="n">u32</span> <span class="n">io_addr</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">vaddr</span><span class="o">++</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">inw</span><span class="p">(</span><span class="n">io_addr</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">inl</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">data</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ixp4xx_pci_read</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">NP_CMD_IOREAD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">))</span>
		<span class="k">return</span> <span class="mh">0xffffffff</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">insl</span><span class="p">(</span><span class="n">u32</span> <span class="n">io_addr</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">vaddr</span><span class="o">++</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">inl</span><span class="p">(</span><span class="n">io_addr</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#define PIO_OFFSET      0x10000UL</span>
<span class="cp">#define PIO_MASK        0x0ffffUL</span>

<span class="cp">#define	__is_io_address(p)	(((unsigned long)p &gt;= PIO_OFFSET) &amp;&amp; \</span>
<span class="cp">					((unsigned long)p &lt;= (PIO_MASK + PIO_OFFSET)))</span>

<span class="cp">#define	ioread8(p)			ioread8(p)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ioread8</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">inb</span><span class="p">(</span><span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">);</span>
	<span class="k">else</span>
<span class="cp">#ifndef CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">__raw_readb</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">__indirect_readb</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define	ioread8_rep(p, v, c)		ioread8_rep(p, v, c)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ioread8_rep</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="n">insb</span><span class="p">(</span><span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
	<span class="k">else</span>
<span class="cp">#ifndef	CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="n">__raw_readsb</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="n">__indirect_readsb</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define	ioread16(p)			ioread16(p)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ioread16</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="k">return</span>	<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">inw</span><span class="p">(</span><span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">);</span>
	<span class="k">else</span>
<span class="cp">#ifndef CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="k">return</span> <span class="n">le16_to_cpu</span><span class="p">((</span><span class="n">__force</span> <span class="n">__le16</span><span class="p">)</span><span class="n">__raw_readw</span><span class="p">(</span><span class="n">addr</span><span class="p">));</span>
<span class="cp">#else</span>
		<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">__indirect_readw</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define	ioread16_rep(p, v, c)		ioread16_rep(p, v, c)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ioread16_rep</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span>
				<span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="n">insw</span><span class="p">(</span><span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
	<span class="k">else</span>
<span class="cp">#ifndef	CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="n">__raw_readsw</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="n">__indirect_readsw</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define	ioread32(p)			ioread32(p)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ioread32</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="k">return</span>	<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">inl</span><span class="p">(</span><span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">);</span>
	<span class="k">else</span> <span class="p">{</span>
<span class="cp">#ifndef CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="k">return</span> <span class="n">le32_to_cpu</span><span class="p">((</span><span class="n">__force</span> <span class="n">__le32</span><span class="p">)</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">addr</span><span class="p">));</span>
<span class="cp">#else</span>
		<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">__indirect_readl</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cp">#define	ioread32_rep(p, v, c)		ioread32_rep(p, v, c)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ioread32_rep</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span>
				<span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="n">insl</span><span class="p">(</span><span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
	<span class="k">else</span>
<span class="cp">#ifndef	CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="n">__raw_readsl</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="n">__indirect_readsl</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define	iowrite8(v, p)			iowrite8(v, p)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">iowrite8</span><span class="p">(</span><span class="n">u8</span> <span class="n">value</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="n">outb</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">);</span>
	<span class="k">else</span>
<span class="cp">#ifndef CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="n">__raw_writeb</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="n">__indirect_writeb</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define	iowrite8_rep(p, v, c)		iowrite8_rep(p, v, c)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">iowrite8_rep</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span>
				<span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="n">outsb</span><span class="p">(</span><span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
	<span class="k">else</span>
<span class="cp">#ifndef CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="n">__raw_writesb</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="n">__indirect_writesb</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define	iowrite16(v, p)			iowrite16(v, p)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">iowrite16</span><span class="p">(</span><span class="n">u16</span> <span class="n">value</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="n">outw</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">);</span>
	<span class="k">else</span>
<span class="cp">#ifndef CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="n">__raw_writew</span><span class="p">(</span><span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">addr</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="n">__indirect_writew</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define	iowrite16_rep(p, v, c)		iowrite16_rep(p, v, c)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">iowrite16_rep</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span>
				 <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="n">outsw</span><span class="p">(</span><span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
	<span class="k">else</span>
<span class="cp">#ifndef CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="n">__raw_writesw</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="n">__indirect_writesw</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define	iowrite32(v, p)			iowrite32(v, p)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">iowrite32</span><span class="p">(</span><span class="n">u32</span> <span class="n">value</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="n">outl</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">);</span>
	<span class="k">else</span>
<span class="cp">#ifndef CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="n">__raw_writel</span><span class="p">((</span><span class="n">u32</span> <span class="n">__force</span><span class="p">)</span><span class="n">cpu_to_le32</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">addr</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="n">__indirect_writel</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define	iowrite32_rep(p, v, c)		iowrite32_rep(p, v, c)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">iowrite32_rep</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span>
				 <span class="n">u32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__is_io_address</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>
		<span class="n">outsl</span><span class="p">(</span><span class="n">port</span> <span class="o">&amp;</span> <span class="n">PIO_MASK</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
	<span class="k">else</span>
<span class="cp">#ifndef CONFIG_IXP4XX_INDIRECT_PCI</span>
		<span class="n">__raw_writesl</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="n">__indirect_writesl</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define	ioport_map(port, nr)		((void __iomem*)(port + PIO_OFFSET))</span>
<span class="cp">#define	ioport_unmap(addr)</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_PCI */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __ASM_ARM_ARCH_IO_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
