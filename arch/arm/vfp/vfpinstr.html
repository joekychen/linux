<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › vfp › vfpinstr.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>vfpinstr.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  linux/arch/arm/vfp/vfpinstr.h</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 2004 ARM Limited.</span>
<span class="cm"> *  Written by Deep Blue Solutions Limited.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * VFP instruction masks.</span>
<span class="cm"> */</span>
<span class="cp">#define INST_CPRTDO(inst)	(((inst) &amp; 0x0f000000) == 0x0e000000)</span>
<span class="cp">#define INST_CPRT(inst)		((inst) &amp; (1 &lt;&lt; 4))</span>
<span class="cp">#define INST_CPRT_L(inst)	((inst) &amp; (1 &lt;&lt; 20))</span>
<span class="cp">#define INST_CPRT_Rd(inst)	(((inst) &amp; (15 &lt;&lt; 12)) &gt;&gt; 12)</span>
<span class="cp">#define INST_CPRT_OP(inst)	(((inst) &gt;&gt; 21) &amp; 7)</span>
<span class="cp">#define INST_CPNUM(inst)	((inst) &amp; 0xf00)</span>
<span class="cp">#define CPNUM(cp)		((cp) &lt;&lt; 8)</span>

<span class="cp">#define FOP_MASK	(0x00b00040)</span>
<span class="cp">#define FOP_FMAC	(0x00000000)</span>
<span class="cp">#define FOP_FNMAC	(0x00000040)</span>
<span class="cp">#define FOP_FMSC	(0x00100000)</span>
<span class="cp">#define FOP_FNMSC	(0x00100040)</span>
<span class="cp">#define FOP_FMUL	(0x00200000)</span>
<span class="cp">#define FOP_FNMUL	(0x00200040)</span>
<span class="cp">#define FOP_FADD	(0x00300000)</span>
<span class="cp">#define FOP_FSUB	(0x00300040)</span>
<span class="cp">#define FOP_FDIV	(0x00800000)</span>
<span class="cp">#define FOP_EXT		(0x00b00040)</span>

<span class="cp">#define FOP_TO_IDX(inst)	((inst &amp; 0x00b00000) &gt;&gt; 20 | (inst &amp; (1 &lt;&lt; 6)) &gt;&gt; 4)</span>

<span class="cp">#define FEXT_MASK	(0x000f0080)</span>
<span class="cp">#define FEXT_FCPY	(0x00000000)</span>
<span class="cp">#define FEXT_FABS	(0x00000080)</span>
<span class="cp">#define FEXT_FNEG	(0x00010000)</span>
<span class="cp">#define FEXT_FSQRT	(0x00010080)</span>
<span class="cp">#define FEXT_FCMP	(0x00040000)</span>
<span class="cp">#define FEXT_FCMPE	(0x00040080)</span>
<span class="cp">#define FEXT_FCMPZ	(0x00050000)</span>
<span class="cp">#define FEXT_FCMPEZ	(0x00050080)</span>
<span class="cp">#define FEXT_FCVT	(0x00070080)</span>
<span class="cp">#define FEXT_FUITO	(0x00080000)</span>
<span class="cp">#define FEXT_FSITO	(0x00080080)</span>
<span class="cp">#define FEXT_FTOUI	(0x000c0000)</span>
<span class="cp">#define FEXT_FTOUIZ	(0x000c0080)</span>
<span class="cp">#define FEXT_FTOSI	(0x000d0000)</span>
<span class="cp">#define FEXT_FTOSIZ	(0x000d0080)</span>

<span class="cp">#define FEXT_TO_IDX(inst)	((inst &amp; 0x000f0000) &gt;&gt; 15 | (inst &amp; (1 &lt;&lt; 7)) &gt;&gt; 7)</span>

<span class="cp">#define vfp_get_sd(inst)	((inst &amp; 0x0000f000) &gt;&gt; 11 | (inst &amp; (1 &lt;&lt; 22)) &gt;&gt; 22)</span>
<span class="cp">#define vfp_get_dd(inst)	((inst &amp; 0x0000f000) &gt;&gt; 12 | (inst &amp; (1 &lt;&lt; 22)) &gt;&gt; 18)</span>
<span class="cp">#define vfp_get_sm(inst)	((inst &amp; 0x0000000f) &lt;&lt; 1 | (inst &amp; (1 &lt;&lt; 5)) &gt;&gt; 5)</span>
<span class="cp">#define vfp_get_dm(inst)	((inst &amp; 0x0000000f) | (inst &amp; (1 &lt;&lt; 5)) &gt;&gt; 1)</span>
<span class="cp">#define vfp_get_sn(inst)	((inst &amp; 0x000f0000) &gt;&gt; 15 | (inst &amp; (1 &lt;&lt; 7)) &gt;&gt; 7)</span>
<span class="cp">#define vfp_get_dn(inst)	((inst &amp; 0x000f0000) &gt;&gt; 16 | (inst &amp; (1 &lt;&lt; 7)) &gt;&gt; 3)</span>

<span class="cp">#define vfp_single(inst)	(((inst) &amp; 0x0000f00) == 0xa00)</span>

<span class="cp">#define FPSCR_N	(1 &lt;&lt; 31)</span>
<span class="cp">#define FPSCR_Z	(1 &lt;&lt; 30)</span>
<span class="cp">#define FPSCR_C (1 &lt;&lt; 29)</span>
<span class="cp">#define FPSCR_V	(1 &lt;&lt; 28)</span>

<span class="cm">/*</span>
<span class="cm"> * Since we aren&#39;t building with -mfpu=vfp, we need to code</span>
<span class="cm"> * these instructions using their MRC/MCR equivalents.</span>
<span class="cm"> */</span>
<span class="cp">#define vfpreg(_vfp_) #_vfp_</span>

<span class="cp">#define fmrx(_vfp_) ({			\</span>
<span class="cp">	u32 __v;			\</span>
<span class="cp">	asm(&quot;mrc p10, 7, %0, &quot; vfpreg(_vfp_) &quot;, cr0, 0 @ fmrx	%0, &quot; #_vfp_	\</span>
<span class="cp">	    : &quot;=r&quot; (__v) : : &quot;cc&quot;);	\</span>
<span class="cp">	__v;				\</span>
<span class="cp"> })</span>

<span class="cp">#define fmxr(_vfp_,_var_)		\</span>
<span class="cp">	asm(&quot;mcr p10, 7, %0, &quot; vfpreg(_vfp_) &quot;, cr0, 0 @ fmxr	&quot; #_vfp_ &quot;, %0&quot;	\</span>
<span class="cp">	   : : &quot;r&quot; (_var_) : &quot;cc&quot;)</span>

<span class="n">u32</span> <span class="n">vfp_single_cpdo</span><span class="p">(</span><span class="n">u32</span> <span class="n">inst</span><span class="p">,</span> <span class="n">u32</span> <span class="n">fpscr</span><span class="p">);</span>
<span class="n">u32</span> <span class="n">vfp_single_cprt</span><span class="p">(</span><span class="n">u32</span> <span class="n">inst</span><span class="p">,</span> <span class="n">u32</span> <span class="n">fpscr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>

<span class="n">u32</span> <span class="n">vfp_double_cpdo</span><span class="p">(</span><span class="n">u32</span> <span class="n">inst</span><span class="p">,</span> <span class="n">u32</span> <span class="n">fpscr</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
