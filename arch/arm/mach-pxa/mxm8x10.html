<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-pxa › mxm8x10.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>mxm8x10.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * linux/arch/arm/mach-pxa/mxm8x10.c</span>
<span class="cm"> *</span>
<span class="cm"> * Support for the Embedian MXM-8x10 Computer on Module</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2006 Marvell International Ltd.</span>
<span class="cm"> * Copyright (C) 2009 Embedian Inc.</span>
<span class="cm"> * Copyright (C) 2009 TMT Services &amp; Supplies (Pty) Ltd.</span>
<span class="cm"> *</span>
<span class="cm"> * 2007-09-04: eric miao &lt;eric.y.miao@gmail.com&gt;</span>
<span class="cm"> *             rewrite to align with latest kernel</span>
<span class="cm"> *</span>
<span class="cm"> * 2010-01-09: Edwin Peer &lt;epeer@tmtservices.co.za&gt;</span>
<span class="cm"> * 	       Hennie van der Merwe &lt;hvdmerwe@tmtservices.co.za&gt;</span>
<span class="cm"> *             rework for upstream merge</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/serial_8250.h&gt;</span>
<span class="cp">#include &lt;linux/dm9000.h&gt;</span>
<span class="cp">#include &lt;linux/gpio.h&gt;</span>
<span class="cp">#include &lt;linux/i2c/pxa-i2c.h&gt;</span>

<span class="cp">#include &lt;plat/pxa3xx_nand.h&gt;</span>

<span class="cp">#include &lt;mach/pxafb.h&gt;</span>
<span class="cp">#include &lt;mach/mmc.h&gt;</span>
<span class="cp">#include &lt;mach/ohci.h&gt;</span>
<span class="cp">#include &lt;mach/pxa320.h&gt;</span>

<span class="cp">#include &lt;mach/mxm8x10.h&gt;</span>

<span class="cp">#include &quot;devices.h&quot;</span>
<span class="cp">#include &quot;generic.h&quot;</span>

<span class="cm">/* GPIO pin definition</span>

<span class="cm">External device stuff   - Leave unconfigured for now...</span>
<span class="cm">---------------------</span>
<span class="cm">GPIO0   -   DREQ    (External DMA Request)</span>
<span class="cm">GPIO3   -   nGCS2   (External Chip Select) Where is nGCS0; nGCS1; nGCS4; nGCS5 ?</span>
<span class="cm">GPIO4   -   nGCS3</span>
<span class="cm">GPIO15  -   EXT_GPIO1</span>
<span class="cm">GPIO16  -   EXT_GPIO2</span>
<span class="cm">GPIO17  -   EXT_GPIO3</span>
<span class="cm">GPIO24  -   EXT_GPIO4</span>
<span class="cm">GPIO25  -   EXT_GPIO5</span>
<span class="cm">GPIO26  -   EXT_GPIO6</span>
<span class="cm">GPIO27  -   EXT_GPIO7</span>
<span class="cm">GPIO28  -   EXT_GPIO8</span>
<span class="cm">GPIO29  -   EXT_GPIO9</span>
<span class="cm">GPIO30  -   EXT_GPIO10</span>
<span class="cm">GPIO31  -   EXT_GPIO11</span>
<span class="cm">GPIO57  -   EXT_GPIO12</span>
<span class="cm">GPIO74  -   EXT_IRQ1</span>
<span class="cm">GPIO75  -   EXT_IRQ2</span>
<span class="cm">GPIO76  -   EXT_IRQ3</span>
<span class="cm">GPIO77  -   EXT_IRQ4</span>
<span class="cm">GPIO78  -   EXT_IRQ5</span>
<span class="cm">GPIO79  -   EXT_IRQ6</span>
<span class="cm">GPIO80  -   EXT_IRQ7</span>
<span class="cm">GPIO81  -   EXT_IRQ8</span>
<span class="cm">GPIO87  -   VCCIO_PWREN (External Device PWREN)</span>

<span class="cm">Dallas 1-Wire   - Leave unconfigured for now...</span>
<span class="cm">-------------</span>
<span class="cm">GPIO0_2 -   DS - 1Wire</span>

<span class="cm">Ethernet</span>
<span class="cm">--------</span>
<span class="cm">GPIO1   -   DM9000 PWR</span>
<span class="cm">GPIO9   -   DM9K_nIRQ</span>
<span class="cm">GPIO36  -   DM9K_RESET</span>

<span class="cm">Keypad  - Leave unconfigured by for now...</span>
<span class="cm">------</span>
<span class="cm">GPIO1_2 -   KP_DKIN0</span>
<span class="cm">GPIO5_2 -   KP_MKOUT7</span>
<span class="cm">GPIO82  -   KP_DKIN1</span>
<span class="cm">GPIO85  -   KP_DKIN2</span>
<span class="cm">GPIO86  -   KP_DKIN3</span>
<span class="cm">GPIO113 -   KP_MKIN0</span>
<span class="cm">GPIO114 -   KP_MKIN1</span>
<span class="cm">GPIO115 -   KP_MKIN2</span>
<span class="cm">GPIO116 -   KP_MKIN3</span>
<span class="cm">GPIO117 -   KP_MKIN4</span>
<span class="cm">GPIO118 -   KP_MKIN5</span>
<span class="cm">GPIO119 -   KP_MKIN6</span>
<span class="cm">GPIO120 -   KP_MKIN7</span>
<span class="cm">GPIO121 -   KP_MKOUT0</span>
<span class="cm">GPIO122 -   KP_MKOUT1</span>
<span class="cm">GPIO122 -   KP_MKOUT2</span>
<span class="cm">GPIO123 -   KP_MKOUT3</span>
<span class="cm">GPIO124 -   KP_MKOUT4</span>
<span class="cm">GPIO125 -   KP_MKOUT5</span>
<span class="cm">GPIO127 -   KP_MKOUT6</span>

<span class="cm">Data Bus    - Leave unconfigured for now...</span>
<span class="cm">--------</span>
<span class="cm">GPIO2   -   nWait (Data Bus)</span>

<span class="cm">USB Device</span>
<span class="cm">----------</span>
<span class="cm">GPIO4_2 -   USBD_PULLUP</span>
<span class="cm">GPIO10  -   UTM_CLK (USB Device UTM Clk)</span>
<span class="cm">GPIO49  -   USB 2.0 Device UTM_DATA0</span>
<span class="cm">GPIO50  -   USB 2.0 Device UTM_DATA1</span>
<span class="cm">GPIO51  -   USB 2.0 Device UTM_DATA2</span>
<span class="cm">GPIO52  -   USB 2.0 Device UTM_DATA3</span>
<span class="cm">GPIO53  -   USB 2.0 Device UTM_DATA4</span>
<span class="cm">GPIO54  -   USB 2.0 Device UTM_DATA5</span>
<span class="cm">GPIO55  -   USB 2.0 Device UTM_DATA6</span>
<span class="cm">GPIO56  -   USB 2.0 Device UTM_DATA7</span>
<span class="cm">GPIO58  -   UTM_RXVALID (USB 2.0 Device)</span>
<span class="cm">GPIO59  -   UTM_RXACTIVE (USB 2.0 Device)</span>
<span class="cm">GPIO60  -   UTM_RXERROR</span>
<span class="cm">GPIO61  -   UTM_OPMODE0</span>
<span class="cm">GPIO62  -   UTM_OPMODE1</span>
<span class="cm">GPIO71  -   USBD_INT    (USB Device?)</span>
<span class="cm">GPIO73  -   UTM_TXREADY (USB 2.0 Device)</span>
<span class="cm">GPIO83  -   UTM_TXVALID (USB 2.0 Device)</span>
<span class="cm">GPIO98  -   UTM_RESET   (USB 2.0 device)</span>
<span class="cm">GPIO99  -   UTM_XCVR_SELECT</span>
<span class="cm">GPIO100 -   UTM_TERM_SELECT</span>
<span class="cm">GPIO101 -   UTM_SUSPENDM_X</span>
<span class="cm">GPIO102 -   UTM_LINESTATE0</span>
<span class="cm">GPIO103 -   UTM_LINESTATE1</span>

<span class="cm">Card-Bus Interface  - Leave unconfigured for now...</span>
<span class="cm">------------------</span>
<span class="cm">GPIO5   -   nPIOR (I/O space output enable)</span>
<span class="cm">GPIO6   -   nPIOW (I/O space write enable)</span>
<span class="cm">GPIO7   -   nIOS16 (Input from I/O space telling size of data bus)</span>
<span class="cm">GPIO8   -   nPWAIT (Input for inserting wait states)</span>

<span class="cm">LCD</span>
<span class="cm">---</span>
<span class="cm">GPIO6_2     -   LDD0</span>
<span class="cm">GPIO7_2     -   LDD1</span>
<span class="cm">GPIO8_2     -   LDD2</span>
<span class="cm">GPIO9_2     -   LDD3</span>
<span class="cm">GPIO11_2    -   LDD5</span>
<span class="cm">GPIO12_2    -   LDD6</span>
<span class="cm">GPIO13_2    -   LDD7</span>
<span class="cm">GPIO14_2    -   VSYNC</span>
<span class="cm">GPIO15_2    -   HSYNC</span>
<span class="cm">GPIO16_2    -   VCLK</span>
<span class="cm">GPIO17_2    -   HCLK</span>
<span class="cm">GPIO18_2    -   VDEN</span>
<span class="cm">GPIO63      -   LDD8    (CPU LCD)</span>
<span class="cm">GPIO64      -   LDD9    (CPU LCD)</span>
<span class="cm">GPIO65      -   LDD10   (CPU LCD)</span>
<span class="cm">GPIO66      -   LDD11   (CPU LCD)</span>
<span class="cm">GPIO67      -   LDD12   (CPU LCD)</span>
<span class="cm">GPIO68      -   LDD13   (CPU LCD)</span>
<span class="cm">GPIO69      -   LDD14   (CPU LCD)</span>
<span class="cm">GPIO70      -   LDD15   (CPU LCD)</span>
<span class="cm">GPIO88      -   VCCLCD_PWREN (LCD Panel PWREN)</span>
<span class="cm">GPIO97      -   BACKLIGHT_EN</span>
<span class="cm">GPIO104     -   LCD_PWREN</span>

<span class="cm">PWM   - Leave unconfigured for now...</span>
<span class="cm">---</span>
<span class="cm">GPIO11  -   PWM0</span>
<span class="cm">GPIO12  -   PWM1</span>
<span class="cm">GPIO13  -   PWM2</span>
<span class="cm">GPIO14  -   PWM3</span>

<span class="cm">SD-CARD</span>
<span class="cm">-------</span>
<span class="cm">GPIO18  -   SDDATA0</span>
<span class="cm">GPIO19  -   SDDATA1</span>
<span class="cm">GPIO20  -   SDDATA2</span>
<span class="cm">GPIO21  -   SDDATA3</span>
<span class="cm">GPIO22  -   SDCLK</span>
<span class="cm">GPIO23  -   SDCMD</span>
<span class="cm">GPIO72  -   SD_WP</span>
<span class="cm">GPIO84  -   SD_nIRQ_CD  (SD-Card)</span>

<span class="cm">I2C</span>
<span class="cm">---</span>
<span class="cm">GPIO32  -   I2CSCL</span>
<span class="cm">GPIO33  -   I2CSDA</span>

<span class="cm">AC97</span>
<span class="cm">----</span>
<span class="cm">GPIO35  -   AC97_SDATA_IN</span>
<span class="cm">GPIO37  -   AC97_SDATA_OUT</span>
<span class="cm">GPIO38  -   AC97_SYNC</span>
<span class="cm">GPIO39  -   AC97_BITCLK</span>
<span class="cm">GPIO40  -   AC97_nRESET</span>

<span class="cm">UART1</span>
<span class="cm">-----</span>
<span class="cm">GPIO41  -   UART_RXD1</span>
<span class="cm">GPIO42  -   UART_TXD1</span>
<span class="cm">GPIO43  -   UART_CTS1</span>
<span class="cm">GPIO44  -   UART_DCD1</span>
<span class="cm">GPIO45  -   UART_DSR1</span>
<span class="cm">GPIO46  -   UART_nRI1</span>
<span class="cm">GPIO47  -   UART_DTR1</span>
<span class="cm">GPIO48  -   UART_RTS1</span>

<span class="cm">UART2</span>
<span class="cm">-----</span>
<span class="cm">GPIO109 -   RTS2</span>
<span class="cm">GPIO110 -   RXD2</span>
<span class="cm">GPIO111 -   TXD2</span>
<span class="cm">GPIO112 -   nCTS2</span>

<span class="cm">UART3</span>
<span class="cm">-----</span>
<span class="cm">GPIO105 -   nCTS3</span>
<span class="cm">GPIO106 -   nRTS3</span>
<span class="cm">GPIO107 -   TXD3</span>
<span class="cm">GPIO108 -   RXD3</span>

<span class="cm">SSP3    - Leave unconfigured for now...</span>
<span class="cm">----</span>
<span class="cm">GPIO89  -   SSP3_CLK</span>
<span class="cm">GPIO90  -   SSP3_SFRM</span>
<span class="cm">GPIO91  -   SSP3_TXD</span>
<span class="cm">GPIO92  -   SSP3_RXD</span>

<span class="cm">SSP4</span>
<span class="cm">GPIO93  -   SSP4_CLK</span>
<span class="cm">GPIO94  -   SSP4_SFRM</span>
<span class="cm">GPIO95  -   SSP4_TXD</span>
<span class="cm">GPIO96  -   SSP4_RXD</span>
<span class="cm">*/</span>

<span class="k">static</span> <span class="n">mfp_cfg_t</span> <span class="n">mfp_cfg</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* USB */</span>
	<span class="n">GPIO10_UTM_CLK</span><span class="p">,</span>
	<span class="n">GPIO49_U2D_PHYDATA_0</span><span class="p">,</span>
	<span class="n">GPIO50_U2D_PHYDATA_1</span><span class="p">,</span>
	<span class="n">GPIO51_U2D_PHYDATA_2</span><span class="p">,</span>
	<span class="n">GPIO52_U2D_PHYDATA_3</span><span class="p">,</span>
	<span class="n">GPIO53_U2D_PHYDATA_4</span><span class="p">,</span>
	<span class="n">GPIO54_U2D_PHYDATA_5</span><span class="p">,</span>
	<span class="n">GPIO55_U2D_PHYDATA_6</span><span class="p">,</span>
	<span class="n">GPIO56_U2D_PHYDATA_7</span><span class="p">,</span>
	<span class="n">GPIO58_UTM_RXVALID</span><span class="p">,</span>
	<span class="n">GPIO59_UTM_RXACTIVE</span><span class="p">,</span>
	<span class="n">GPIO60_U2D_RXERROR</span><span class="p">,</span>
	<span class="n">GPIO61_U2D_OPMODE0</span><span class="p">,</span>
	<span class="n">GPIO62_U2D_OPMODE1</span><span class="p">,</span>
	<span class="n">GPIO71_GPIO</span><span class="p">,</span> <span class="cm">/* USBD_INT */</span>
	<span class="n">GPIO73_UTM_TXREADY</span><span class="p">,</span>
	<span class="n">GPIO83_U2D_TXVALID</span><span class="p">,</span>
	<span class="n">GPIO98_U2D_RESET</span><span class="p">,</span>
	<span class="n">GPIO99_U2D_XCVR_SEL</span><span class="p">,</span>
	<span class="n">GPIO100_U2D_TERM_SEL</span><span class="p">,</span>
	<span class="n">GPIO101_U2D_SUSPEND</span><span class="p">,</span>
	<span class="n">GPIO102_UTM_LINESTATE_0</span><span class="p">,</span>
	<span class="n">GPIO103_UTM_LINESTATE_1</span><span class="p">,</span>
	<span class="n">GPIO4_2_GPIO</span> <span class="o">|</span> <span class="n">MFP_PULL_HIGH</span><span class="p">,</span> <span class="cm">/* UTM_PULLUP */</span>

	<span class="cm">/* DM9000 */</span>
	<span class="n">GPIO1_GPIO</span><span class="p">,</span>
	<span class="n">GPIO9_GPIO</span><span class="p">,</span>
	<span class="n">GPIO36_GPIO</span><span class="p">,</span>

	<span class="cm">/* AC97 */</span>
	<span class="n">GPIO35_AC97_SDATA_IN_0</span><span class="p">,</span>
	<span class="n">GPIO37_AC97_SDATA_OUT</span><span class="p">,</span>
	<span class="n">GPIO38_AC97_SYNC</span><span class="p">,</span>
	<span class="n">GPIO39_AC97_BITCLK</span><span class="p">,</span>
	<span class="n">GPIO40_AC97_nACRESET</span><span class="p">,</span>

	<span class="cm">/* UARTS */</span>
	<span class="n">GPIO41_UART1_RXD</span><span class="p">,</span>
	<span class="n">GPIO42_UART1_TXD</span><span class="p">,</span>
	<span class="n">GPIO43_UART1_CTS</span><span class="p">,</span>
	<span class="n">GPIO44_UART1_DCD</span><span class="p">,</span>
	<span class="n">GPIO45_UART1_DSR</span><span class="p">,</span>
	<span class="n">GPIO46_UART1_RI</span><span class="p">,</span>
	<span class="n">GPIO47_UART1_DTR</span><span class="p">,</span>
	<span class="n">GPIO48_UART1_RTS</span><span class="p">,</span>

	<span class="n">GPIO109_UART2_RTS</span><span class="p">,</span>
	<span class="n">GPIO110_UART2_RXD</span><span class="p">,</span>
	<span class="n">GPIO111_UART2_TXD</span><span class="p">,</span>
	<span class="n">GPIO112_UART2_CTS</span><span class="p">,</span>

	<span class="n">GPIO105_UART3_CTS</span><span class="p">,</span>
	<span class="n">GPIO106_UART3_RTS</span><span class="p">,</span>
	<span class="n">GPIO107_UART3_TXD</span><span class="p">,</span>
	<span class="n">GPIO108_UART3_RXD</span><span class="p">,</span>

	<span class="n">GPIO78_GPIO</span><span class="p">,</span>
	<span class="n">GPIO79_GPIO</span><span class="p">,</span>
	<span class="n">GPIO80_GPIO</span><span class="p">,</span>
	<span class="n">GPIO81_GPIO</span><span class="p">,</span>

	<span class="cm">/* I2C */</span>
	<span class="n">GPIO32_I2C_SCL</span><span class="p">,</span>
	<span class="n">GPIO33_I2C_SDA</span><span class="p">,</span>

	<span class="cm">/* MMC */</span>
	<span class="n">GPIO18_MMC1_DAT0</span><span class="p">,</span>
	<span class="n">GPIO19_MMC1_DAT1</span><span class="p">,</span>
	<span class="n">GPIO20_MMC1_DAT2</span><span class="p">,</span>
	<span class="n">GPIO21_MMC1_DAT3</span><span class="p">,</span>
	<span class="n">GPIO22_MMC1_CLK</span><span class="p">,</span>
	<span class="n">GPIO23_MMC1_CMD</span><span class="p">,</span>
	<span class="n">GPIO72_GPIO</span> <span class="o">|</span> <span class="n">MFP_PULL_HIGH</span><span class="p">,</span> <span class="cm">/* Card Detect */</span>
	<span class="n">GPIO84_GPIO</span> <span class="o">|</span> <span class="n">MFP_PULL_LOW</span><span class="p">,</span> <span class="cm">/* Write Protect */</span>

	<span class="cm">/* IRQ */</span>
	<span class="n">GPIO74_GPIO</span> <span class="o">|</span> <span class="n">MFP_LPM_EDGE_RISE</span><span class="p">,</span> <span class="cm">/* EXT_IRQ1 */</span>
	<span class="n">GPIO75_GPIO</span> <span class="o">|</span> <span class="n">MFP_LPM_EDGE_RISE</span><span class="p">,</span> <span class="cm">/* EXT_IRQ2 */</span>
	<span class="n">GPIO76_GPIO</span> <span class="o">|</span> <span class="n">MFP_LPM_EDGE_RISE</span><span class="p">,</span> <span class="cm">/* EXT_IRQ3 */</span>
	<span class="n">GPIO77_GPIO</span> <span class="o">|</span> <span class="n">MFP_LPM_EDGE_RISE</span><span class="p">,</span> <span class="cm">/* EXT_IRQ4 */</span>
	<span class="n">GPIO78_GPIO</span> <span class="o">|</span> <span class="n">MFP_LPM_EDGE_RISE</span><span class="p">,</span> <span class="cm">/* EXT_IRQ5 */</span>
	<span class="n">GPIO79_GPIO</span> <span class="o">|</span> <span class="n">MFP_LPM_EDGE_RISE</span><span class="p">,</span> <span class="cm">/* EXT_IRQ6 */</span>
	<span class="n">GPIO80_GPIO</span> <span class="o">|</span> <span class="n">MFP_LPM_EDGE_RISE</span><span class="p">,</span> <span class="cm">/* EXT_IRQ7 */</span>
	<span class="n">GPIO81_GPIO</span> <span class="o">|</span> <span class="n">MFP_LPM_EDGE_RISE</span>  <span class="cm">/* EXT_IRQ8 */</span>
<span class="p">};</span>

<span class="cm">/* MMC/MCI Support */</span>
<span class="cp">#if defined(CONFIG_MMC)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">pxamci_platform_data</span> <span class="n">mxm_8x10_mci_platform_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ocr_mask</span> <span class="o">=</span> <span class="n">MMC_VDD_32_33</span> <span class="o">|</span> <span class="n">MMC_VDD_33_34</span><span class="p">,</span>
	<span class="p">.</span><span class="n">detect_delay_ms</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_card_detect</span> <span class="o">=</span> <span class="n">MXM_8X10_SD_nCD</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_card_ro</span> <span class="o">=</span> <span class="n">MXM_8X10_SD_WP</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_power</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">mxm_8x10_mmc_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pxa_set_mci_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mxm_8x10_mci_platform_data</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/* USB Open Host Controller Interface */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">pxaohci_platform_data</span> <span class="n">mxm_8x10_ohci_platform_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">port_mode</span> <span class="o">=</span> <span class="n">PMM_NPS_MODE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">ENABLE_PORT_ALL</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">mxm_8x10_usb_host_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pxa_set_ohci_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mxm_8x10_ohci_platform_data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* AC97 Sound Support */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">mxm_8x10_ac97_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;pxa2xx-ac97&quot;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">mxm_8x10_ac97_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">platform_device_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mxm_8x10_ac97_device</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* NAND flash Support */</span>
<span class="cp">#if defined(CONFIG_MTD_NAND_PXA3xx) || defined(CONFIG_MTD_NAND_PXA3xx_MODULE)</span>
<span class="cp">#define NAND_BLOCK_SIZE SZ_128K</span>
<span class="cp">#define NB(x)           (NAND_BLOCK_SIZE * (x))</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mtd_partition</span> <span class="n">mxm_8x10_nand_partitions</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;boot&quot;</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">NB</span><span class="p">(</span><span class="mh">0x002</span><span class="p">),</span>
	       <span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">NB</span><span class="p">(</span><span class="mh">0x000</span><span class="p">),</span>
	       <span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="n">MTD_WRITEABLE</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;kernel&quot;</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">NB</span><span class="p">(</span><span class="mh">0x010</span><span class="p">),</span>
	       <span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">NB</span><span class="p">(</span><span class="mh">0x002</span><span class="p">),</span>
	       <span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="n">MTD_WRITEABLE</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;root&quot;</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">NB</span><span class="p">(</span><span class="mh">0x36c</span><span class="p">),</span>
	       <span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">NB</span><span class="p">(</span><span class="mh">0x012</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bbt&quot;</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">NB</span><span class="p">(</span><span class="mh">0x082</span><span class="p">),</span>
	       <span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">NB</span><span class="p">(</span><span class="mh">0x37e</span><span class="p">),</span>
	       <span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="n">MTD_WRITEABLE</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pxa3xx_nand_platform_data</span> <span class="n">mxm_8x10_nand_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">enable_arbiter</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">keep_config</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_cs</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>	<span class="o">=</span> <span class="n">mxm_8x10_nand_partitions</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nr_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mxm_8x10_nand_partitions</span><span class="p">)</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">mxm_8x10_nand_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pxa3xx_set_nand_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mxm_8x10_nand_info</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">mxm_8x10_nand_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_MTD_NAND_PXA3xx || CONFIG_MTD_NAND_PXA3xx_MODULE */</span><span class="cp"></span>

<span class="cm">/* Ethernet support: Davicom DM9000 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">dm9k_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">MXM_8X10_ETH_PHYS</span> <span class="o">+</span> <span class="mh">0x300</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">MXM_8X10_ETH_PHYS</span> <span class="o">+</span> <span class="mh">0x300</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">MXM_8X10_ETH_PHYS</span> <span class="o">+</span> <span class="mh">0x308</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">MXM_8X10_ETH_PHYS</span> <span class="o">+</span> <span class="mh">0x308</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="n">mfp_to_gpio</span><span class="p">(</span><span class="n">MFP_PIN_GPIO9</span><span class="p">)),</span>
	       <span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="n">mfp_to_gpio</span><span class="p">(</span><span class="n">MFP_PIN_GPIO9</span><span class="p">)),</span>
	       <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span> <span class="o">|</span> <span class="n">IORESOURCE_IRQ_HIGHEDGE</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dm9000_plat_data</span> <span class="n">dm9k_plat_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">DM9000_PLATF_16BITONLY</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">dm9k_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;dm9000&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">dm9k_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">dm9k_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dm9k_plat_data</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">mxm_8x10_ethernet_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">platform_device_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dm9k_device</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* PXA UARTs */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">mxm_8x10_uarts_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pxa_set_ffuart_info</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="n">pxa_set_btuart_info</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="n">pxa_set_stuart_info</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* I2C and Real Time Clock */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">mxm_8x10_i2c_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;ds1337&quot;</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">mxm_8x10_i2c_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mxm_8x10_i2c_devices</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mxm_8x10_i2c_devices</span><span class="p">));</span>
	<span class="n">pxa_set_i2c_info</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">mxm_8x10_barebones_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pxa3xx_mfp_config</span><span class="p">(</span><span class="n">ARRAY_AND_SIZE</span><span class="p">(</span><span class="n">mfp_cfg</span><span class="p">));</span>

	<span class="n">mxm_8x10_uarts_init</span><span class="p">();</span>
	<span class="n">mxm_8x10_nand_init</span><span class="p">();</span>
	<span class="n">mxm_8x10_i2c_init</span><span class="p">();</span>
	<span class="n">mxm_8x10_ethernet_init</span><span class="p">();</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
