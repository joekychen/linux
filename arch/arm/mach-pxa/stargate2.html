<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-pxa › stargate2.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>stargate2.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  linux/arch/arm/mach-pxa/stargate2.c</span>
<span class="cm"> *</span>
<span class="cm"> *  Author:	Ed C. Epp</span>
<span class="cm"> *  Created:	Nov 05, 2002</span>
<span class="cm"> *  Copyright:	Intel Corp.</span>
<span class="cm"> *</span>
<span class="cm"> *  Modified 2009:  Jonathan Cameron &lt;jic23@cam.ac.uk&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> *  published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/bitops.h&gt;</span>
<span class="cp">#include &lt;linux/fb.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/regulator/machine.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/mtd.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/plat-ram.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/partitions.h&gt;</span>

<span class="cp">#include &lt;linux/i2c/pxa-i2c.h&gt;</span>
<span class="cp">#include &lt;linux/i2c/pcf857x.h&gt;</span>
<span class="cp">#include &lt;linux/i2c/at24.h&gt;</span>
<span class="cp">#include &lt;linux/smc91x.h&gt;</span>
<span class="cp">#include &lt;linux/gpio.h&gt;</span>
<span class="cp">#include &lt;linux/leds.h&gt;</span>

<span class="cp">#include &lt;asm/types.h&gt;</span>
<span class="cp">#include &lt;asm/setup.h&gt;</span>
<span class="cp">#include &lt;asm/memory.h&gt;</span>
<span class="cp">#include &lt;asm/mach-types.h&gt;</span>
<span class="cp">#include &lt;asm/irq.h&gt;</span>

<span class="cp">#include &lt;asm/mach/arch.h&gt;</span>
<span class="cp">#include &lt;asm/mach/map.h&gt;</span>
<span class="cp">#include &lt;asm/mach/irq.h&gt;</span>
<span class="cp">#include &lt;asm/mach/flash.h&gt;</span>

<span class="cp">#include &lt;mach/pxa27x.h&gt;</span>
<span class="cp">#include &lt;mach/mmc.h&gt;</span>
<span class="cp">#include &lt;mach/udc.h&gt;</span>
<span class="cp">#include &lt;mach/pxa27x-udc.h&gt;</span>
<span class="cp">#include &lt;mach/smemc.h&gt;</span>

<span class="cp">#include &lt;linux/spi/spi.h&gt;</span>
<span class="cp">#include &lt;linux/spi/pxa2xx_spi.h&gt;</span>
<span class="cp">#include &lt;linux/mfd/da903x.h&gt;</span>
<span class="cp">#include &lt;linux/sht15.h&gt;</span>

<span class="cp">#include &quot;devices.h&quot;</span>
<span class="cp">#include &quot;generic.h&quot;</span>

<span class="cp">#define STARGATE_NR_IRQS	(IRQ_BOARD_START + 8)</span>

<span class="cm">/* Bluetooth */</span>
<span class="cp">#define SG2_BT_RESET		81</span>

<span class="cm">/* SD */</span>
<span class="cp">#define SG2_GPIO_nSD_DETECT	90</span>
<span class="cp">#define SG2_SD_POWER_ENABLE	89</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sg2_im2_unified_pin_config</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Device Identification for wakeup*/</span>
	<span class="n">GPIO102_GPIO</span><span class="p">,</span>
	<span class="cm">/* DA9030 */</span>
	<span class="n">GPIO1_GPIO</span><span class="p">,</span>

	<span class="cm">/* MMC */</span>
	<span class="n">GPIO32_MMC_CLK</span><span class="p">,</span>
	<span class="n">GPIO112_MMC_CMD</span><span class="p">,</span>
	<span class="n">GPIO92_MMC_DAT_0</span><span class="p">,</span>
	<span class="n">GPIO109_MMC_DAT_1</span><span class="p">,</span>
	<span class="n">GPIO110_MMC_DAT_2</span><span class="p">,</span>
	<span class="n">GPIO111_MMC_DAT_3</span><span class="p">,</span>

	<span class="cm">/* 802.15.4 radio - driver out of mainline */</span>
	<span class="n">GPIO22_GPIO</span><span class="p">,</span>			<span class="cm">/* CC_RSTN */</span>
	<span class="n">GPIO114_GPIO</span><span class="p">,</span>			<span class="cm">/* CC_FIFO */</span>
	<span class="n">GPIO116_GPIO</span><span class="p">,</span>			<span class="cm">/* CC_CCA */</span>
	<span class="n">GPIO0_GPIO</span><span class="p">,</span>			<span class="cm">/* CC_FIFOP */</span>
	<span class="n">GPIO16_GPIO</span><span class="p">,</span>			<span class="cm">/* CCSFD */</span>
	<span class="n">GPIO115_GPIO</span><span class="p">,</span>			<span class="cm">/* Power enable */</span>

	<span class="cm">/* I2C */</span>
	<span class="n">GPIO117_I2C_SCL</span><span class="p">,</span>
	<span class="n">GPIO118_I2C_SDA</span><span class="p">,</span>

	<span class="cm">/* SSP 3 - 802.15.4 radio */</span>
	<span class="n">GPIO39_GPIO</span><span class="p">,</span>			<span class="cm">/* Chip Select */</span>
	<span class="n">GPIO34_SSP3_SCLK</span><span class="p">,</span>
	<span class="n">GPIO35_SSP3_TXD</span><span class="p">,</span>
	<span class="n">GPIO41_SSP3_RXD</span><span class="p">,</span>

	<span class="cm">/* SSP 2 to daughter boards */</span>
	<span class="n">GPIO11_SSP2_RXD</span><span class="p">,</span>
	<span class="n">GPIO38_SSP2_TXD</span><span class="p">,</span>
	<span class="n">GPIO36_SSP2_SCLK</span><span class="p">,</span>
	<span class="n">GPIO37_GPIO</span><span class="p">,</span> <span class="cm">/* chip select */</span>

	<span class="cm">/* SSP 1 - to daughter boards */</span>
	<span class="n">GPIO24_GPIO</span><span class="p">,</span>			<span class="cm">/* Chip Select */</span>
	<span class="n">GPIO23_SSP1_SCLK</span><span class="p">,</span>
	<span class="n">GPIO25_SSP1_TXD</span><span class="p">,</span>
	<span class="n">GPIO26_SSP1_RXD</span><span class="p">,</span>

	<span class="cm">/* BTUART Basic Connector*/</span>
	<span class="n">GPIO42_BTUART_RXD</span><span class="p">,</span>
	<span class="n">GPIO43_BTUART_TXD</span><span class="p">,</span>
	<span class="n">GPIO44_BTUART_CTS</span><span class="p">,</span>
	<span class="n">GPIO45_BTUART_RTS</span><span class="p">,</span>

	<span class="cm">/* STUART  - IM2 via debug board not sure on SG2*/</span>
	<span class="n">GPIO46_STUART_RXD</span><span class="p">,</span>
	<span class="n">GPIO47_STUART_TXD</span><span class="p">,</span>

	<span class="cm">/* Basic sensor board */</span>
	<span class="n">GPIO96_GPIO</span><span class="p">,</span>	<span class="cm">/* accelerometer interrupt */</span>
	<span class="n">GPIO99_GPIO</span><span class="p">,</span>	<span class="cm">/* ADC interrupt */</span>

	<span class="cm">/* SHT15 */</span>
	<span class="n">GPIO100_GPIO</span><span class="p">,</span>
	<span class="n">GPIO98_GPIO</span><span class="p">,</span>

	<span class="cm">/* Basic sensor board */</span>
	<span class="n">GPIO96_GPIO</span><span class="p">,</span>	<span class="cm">/* accelerometer interrupt */</span>
	<span class="n">GPIO99_GPIO</span><span class="p">,</span>	<span class="cm">/* ADC interrupt */</span>

	<span class="cm">/* Connector pins specified as gpios */</span>
	<span class="n">GPIO94_GPIO</span><span class="p">,</span> <span class="cm">/* large basic connector pin 14 */</span>
	<span class="n">GPIO10_GPIO</span><span class="p">,</span> <span class="cm">/* large basic connector pin 23 */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sht15_platform_data</span> <span class="n">platform_data_sht15</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">gpio_data</span> <span class="o">=</span>  <span class="mi">100</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_sck</span>  <span class="o">=</span>  <span class="mi">98</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sht15</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;sht15&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">platform_data_sht15</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="n">stargate2_sensor_3_con</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">REGULATOR_SUPPLY</span><span class="p">(</span><span class="s">&quot;vcc&quot;</span><span class="p">,</span> <span class="s">&quot;sht15&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">stargate2_ldos</span><span class="p">{</span>
	<span class="n">vcc_vref</span><span class="p">,</span>
	<span class="n">vcc_cc2420</span><span class="p">,</span>
	<span class="cm">/* a mote connector? */</span>
	<span class="n">vcc_mica</span><span class="p">,</span>
	<span class="cm">/* the CSR bluecore chip */</span>
	<span class="n">vcc_bt</span><span class="p">,</span>
	<span class="cm">/* The two voltages available to sensor boards */</span>
	<span class="n">vcc_sensor_1_8</span><span class="p">,</span>
	<span class="n">vcc_sensor_3</span><span class="p">,</span>
	<span class="cm">/* directly connected to the pxa27x */</span>
	<span class="n">vcc_sram_ext</span><span class="p">,</span>
	<span class="n">vcc_pxa_pll</span><span class="p">,</span>
	<span class="n">vcc_pxa_usim</span><span class="p">,</span> <span class="cm">/* Reference voltage for certain gpios */</span>
	<span class="n">vcc_pxa_mem</span><span class="p">,</span>
	<span class="n">vcc_pxa_flash</span><span class="p">,</span>
	<span class="n">vcc_pxa_core</span><span class="p">,</span> <span class="cm">/*Dc-Dc buck not yet supported */</span>
	<span class="n">vcc_lcd</span><span class="p">,</span>
	<span class="n">vcc_bb</span><span class="p">,</span>
	<span class="n">vcc_bbio</span><span class="p">,</span> <span class="cm">/*not sure!*/</span>
	<span class="n">vcc_io</span><span class="p">,</span> <span class="cm">/* cc2420 802.15.4 radio and pxa vcc_io ?*/</span>
<span class="p">};</span>

<span class="cm">/* The values of the various regulator constraints are obviously dependent</span>
<span class="cm"> * on exactly what is wired to each ldo.  Unfortunately this information is</span>
<span class="cm"> * not generally available.  More information has been requested from Xbow.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="n">stargate2_ldo_init_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">vcc_bbio</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* board default 1.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_bbio&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_bb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* board default 2.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_bb&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">2700000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">3000000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_pxa_flash</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span><span class="cm">/* default is 1.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_pxa_flash&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_cc2420</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* also vcc_io */</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
			<span class="cm">/* board default is 2.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_cc2420&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">2700000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">3300000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_vref</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Reference for what? */</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* default 1.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_vref&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_sram_ext</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* default 2.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_sram_ext&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_mica</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* default 2.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_mica&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_bt</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* default 2.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_bt&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_lcd</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* default 2.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_lcd&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">2700000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">3300000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_io</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* Same or higher than everything</span>
<span class="cm">			  * bar vccbat and vccusb */</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* default 2.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_io&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">2692000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">3300000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_sensor_1_8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* default 1.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_sensor_1_8&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_sensor_3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* curiously default 2.8V */</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_sensor_3&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">2800000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">3000000</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">num_consumer_supplies</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">stargate2_sensor_3_con</span><span class="p">),</span>
		<span class="p">.</span><span class="n">consumer_supplies</span> <span class="o">=</span> <span class="n">stargate2_sensor_3_con</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_pxa_pll</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* 1.17V - 1.43V, default 1.3V*/</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_pxa_pll&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">1170000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">1430000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_pxa_usim</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* default 1.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_pxa_usim&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">1710000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">2160000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">vcc_pxa_mem</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* default 1.8V */</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;vcc_pxa_mem&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">min_uV</span> <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_uV</span> <span class="o">=</span> <span class="mi">1800000</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mtd_partition</span> <span class="n">stargate2flash_partitions</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Bootloader&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x00040000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Kernel&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x00200000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mh">0x00040000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Filesystem&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x01DC0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mh">0x00240000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">flash_resources</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">PXA_CS0_PHYS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">PXA_CS0_PHYS</span> <span class="o">+</span> <span class="n">SZ_32M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">flash_platform_data</span> <span class="n">stargate2_flash_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">map_name</span> <span class="o">=</span> <span class="s">&quot;cfi_probe&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parts</span> <span class="o">=</span> <span class="n">stargate2flash_partitions</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nr_parts</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">stargate2flash_partitions</span><span class="p">),</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PXA27xOnChipROM&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">stargate2_flash_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;pxa2xx-flash&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_flash_data</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">flash_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pxa2xx_spi_master</span> <span class="n">pxa_ssp_master_0_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_chipselect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pxa2xx_spi_master</span> <span class="n">pxa_ssp_master_1_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_chipselect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pxa2xx_spi_master</span> <span class="n">pxa_ssp_master_2_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_chipselect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* An upcoming kernel change will scrap SFRM usage so these</span>
<span class="cm"> * drivers have been moved to use gpio&#39;s via cs_control */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">pxa2xx_spi_chip</span> <span class="n">staccel_chip_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">tx_threshold</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rx_threshold</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_burst_size</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">235</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_cs</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pxa2xx_spi_chip</span> <span class="n">cc2420_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">tx_threshold</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rx_threshold</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_burst_size</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">235</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_cs</span> <span class="o">=</span> <span class="mi">39</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">spi_board_info</span> <span class="n">spi_board_info</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span> <span class="o">=</span> <span class="s">&quot;lis3l02dq&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_speed_hz</span> <span class="o">=</span> <span class="mi">8000000</span><span class="p">,</span><span class="cm">/* 8MHz max spi frequency at 3V */</span>
		<span class="p">.</span><span class="n">bus_num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_select</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">controller_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">staccel_chip_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">96</span><span class="p">),</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span> <span class="o">=</span> <span class="s">&quot;cc2420&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_speed_hz</span> <span class="o">=</span> <span class="mi">6500000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bus_num</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_select</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">controller_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cc2420_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sg2_udc_command</span><span class="p">(</span><span class="kt">int</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">PXA2XX_UDC_CMD_CONNECT</span>:
		<span class="n">UP2OCR</span> <span class="o">|=</span>  <span class="n">UP2OCR_HXOE</span>  <span class="o">|</span> <span class="n">UP2OCR_DPPUE</span> <span class="o">|</span> <span class="n">UP2OCR_DPPUBE</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">PXA2XX_UDC_CMD_DISCONNECT</span>:
		<span class="n">UP2OCR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">UP2OCR_HXOE</span>  <span class="o">|</span> <span class="n">UP2OCR_DPPUE</span> <span class="o">|</span> <span class="n">UP2OCR_DPPUBE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_pxa_platform_data</span> <span class="n">i2c_pwr_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">fast_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_pxa_platform_data</span> <span class="n">i2c_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">fast_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">imote2_stargate2_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">pxa2xx_mfp_config</span><span class="p">(</span><span class="n">ARRAY_AND_SIZE</span><span class="p">(</span><span class="n">sg2_im2_unified_pin_config</span><span class="p">));</span>

	<span class="n">pxa_set_ffuart_info</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="n">pxa_set_btuart_info</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="n">pxa_set_stuart_info</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

	<span class="n">pxa2xx_set_spi_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pxa_ssp_master_0_info</span><span class="p">);</span>
	<span class="n">pxa2xx_set_spi_info</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pxa_ssp_master_1_info</span><span class="p">);</span>
	<span class="n">pxa2xx_set_spi_info</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pxa_ssp_master_2_info</span><span class="p">);</span>
	<span class="n">spi_register_board_info</span><span class="p">(</span><span class="n">spi_board_info</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">spi_board_info</span><span class="p">));</span>


	<span class="n">pxa27x_set_i2c_power_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2c_pwr_pdata</span><span class="p">);</span>
	<span class="n">pxa_set_i2c_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2c_pdata</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_MACH_INTELMOTE2</span>
<span class="cm">/* As the the imote2 doesn&#39;t currently have a conventional SD slot</span>
<span class="cm"> * there is no option to hotplug cards, making all this rather simple</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">imote2_mci_get_ro</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Rather simple case as hotplugging not possible */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">pxamci_platform_data</span> <span class="n">imote2_mci_platform_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ocr_mask</span> <span class="o">=</span> <span class="n">MMC_VDD_32_33</span> <span class="o">|</span> <span class="n">MMC_VDD_33_34</span><span class="p">,</span> <span class="cm">/* default anyway */</span>
	<span class="p">.</span><span class="n">get_ro</span> <span class="o">=</span> <span class="n">imote2_mci_get_ro</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_card_detect</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_card_ro</span>	<span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_power</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_led</span> <span class="n">imote2_led_pins</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>       <span class="o">=</span>  <span class="s">&quot;imote2:red&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>       <span class="o">=</span> <span class="mi">103</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>       <span class="o">=</span> <span class="s">&quot;imote2:green&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>       <span class="o">=</span> <span class="mi">104</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>       <span class="o">=</span> <span class="s">&quot;imote2:blue&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio</span>       <span class="o">=</span> <span class="mi">105</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_led_platform_data</span> <span class="n">imote2_led_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_leds</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">imote2_led_pins</span><span class="p">),</span>
	<span class="p">.</span><span class="n">leds</span>     <span class="o">=</span> <span class="n">imote2_led_pins</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">imote2_leds</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;leds-gpio&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">imote2_led_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">da903x_subdev_info</span> <span class="n">imote2_da9030_subdevs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_bbio</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_bb</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_pxa_flash</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_cc2420</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO6</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_vref</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO7</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_sram_ext</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_mica</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO9</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_bt</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_sensor_1_8</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO11</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_sensor_3</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO12</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_lcd</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO15</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_pxa_pll</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO17</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_pxa_usim</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span> <span class="cm">/*pxa vcc i/o and cc2420 vcc i/o */</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO18</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_io</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO19</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_pxa_mem</span><span class="p">],</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">da903x_platform_data</span> <span class="n">imote2_da9030_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_subdevs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">imote2_da9030_subdevs</span><span class="p">),</span>
	<span class="p">.</span><span class="n">subdevs</span> <span class="o">=</span> <span class="n">imote2_da9030_subdevs</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">imote2_pwr_i2c_board_info</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;da9030&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x49</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">imote2_da9030_pdata</span><span class="p">,</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">imote2_i2c_board_info</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="cm">/* UCAM sensor board */</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;max1239&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x35</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span> <span class="cm">/* ITS400 Sensor board only */</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;max1363&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x34</span><span class="p">,</span>
		<span class="cm">/* Through a nand gate - Also beware, on V2 sensor board the</span>
<span class="cm">		 * pull up resistors are missing.</span>
<span class="cm">		 */</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">99</span><span class="p">),</span>
	<span class="p">},</span> <span class="p">{</span> <span class="cm">/* ITS400 Sensor board only */</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;tsl2561&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x49</span><span class="p">,</span>
		<span class="cm">/* Through a nand gate - Also beware, on V2 sensor board the</span>
<span class="cm">		 * pull up resistors are missing.</span>
<span class="cm">		 */</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">99</span><span class="p">),</span>
	<span class="p">},</span> <span class="p">{</span> <span class="cm">/* ITS400 Sensor board only */</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;tmp175&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x4A</span><span class="p">,</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">96</span><span class="p">),</span>
	<span class="p">},</span> <span class="p">{</span> <span class="cm">/* IMB400 Multimedia board */</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;wm8940&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x1A</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">imote2_pin_config</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>

	<span class="cm">/* Button */</span>
	<span class="n">GPIO91_GPIO</span><span class="p">,</span>

	<span class="cm">/* LEDS */</span>
	<span class="n">GPIO103_GPIO</span><span class="p">,</span> <span class="cm">/* red led */</span>
	<span class="n">GPIO104_GPIO</span><span class="p">,</span> <span class="cm">/* green led */</span>
	<span class="n">GPIO105_GPIO</span><span class="p">,</span> <span class="cm">/* blue led */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pxa2xx_udc_mach_info</span> <span class="n">imote2_udc_info</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">udc_command</span>		<span class="o">=</span> <span class="n">sg2_udc_command</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">imote2_audio_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;imote2-audio&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">imote2_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">stargate2_flash_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">imote2_leds</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sht15</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">imote2_audio_device</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">imote2_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pxa2xx_mfp_config</span><span class="p">(</span><span class="n">ARRAY_AND_SIZE</span><span class="p">(</span><span class="n">imote2_pin_config</span><span class="p">));</span>

	<span class="n">imote2_stargate2_init</span><span class="p">();</span>

	<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">imote2_devices</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">imote2_devices</span><span class="p">));</span>

	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">imote2_i2c_board_info</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">imote2_i2c_board_info</span><span class="p">));</span>
	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">imote2_pwr_i2c_board_info</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">imote2_pwr_i2c_board_info</span><span class="p">));</span>

	<span class="n">pxa_set_mci_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">imote2_mci_platform_data</span><span class="p">);</span>
	<span class="n">pxa_set_udc_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">imote2_udc_info</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_MACH_STARGATE2</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">stargate2_pin_config</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>

	<span class="n">GPIO15_nCS_1</span><span class="p">,</span> <span class="cm">/* SRAM */</span>
	<span class="cm">/* SMC91x */</span>
	<span class="n">GPIO80_nCS_4</span><span class="p">,</span>
	<span class="n">GPIO40_GPIO</span><span class="p">,</span> <span class="cm">/*cable detect?*/</span>

	<span class="cm">/* Button */</span>
	<span class="n">GPIO91_GPIO</span> <span class="o">|</span> <span class="n">WAKEUP_ON_LEVEL_HIGH</span><span class="p">,</span>

	<span class="cm">/* Compact Flash */</span>
	<span class="n">GPIO79_PSKTSEL</span><span class="p">,</span>
	<span class="n">GPIO48_nPOE</span><span class="p">,</span>
	<span class="n">GPIO49_nPWE</span><span class="p">,</span>
	<span class="n">GPIO50_nPIOR</span><span class="p">,</span>
	<span class="n">GPIO51_nPIOW</span><span class="p">,</span>
	<span class="n">GPIO85_nPCE_1</span><span class="p">,</span>
	<span class="n">GPIO54_nPCE_2</span><span class="p">,</span>
	<span class="n">GPIO55_nPREG</span><span class="p">,</span>
	<span class="n">GPIO56_nPWAIT</span><span class="p">,</span>
	<span class="n">GPIO57_nIOIS16</span><span class="p">,</span>
	<span class="n">GPIO120_GPIO</span><span class="p">,</span> <span class="cm">/* Buff ctrl */</span>
	<span class="n">GPIO108_GPIO</span><span class="p">,</span> <span class="cm">/* Power ctrl */</span>
	<span class="n">GPIO82_GPIO</span><span class="p">,</span> <span class="cm">/* Reset */</span>
	<span class="n">GPIO53_GPIO</span><span class="p">,</span> <span class="cm">/* SG2_S0_GPIO_DETECT */</span>

	<span class="cm">/* MMC not shared with imote2 */</span>
	<span class="n">GPIO90_GPIO</span><span class="p">,</span> <span class="cm">/* nSD detect */</span>
	<span class="n">GPIO89_GPIO</span><span class="p">,</span> <span class="cm">/* SD_POWER_ENABLE */</span>

	<span class="cm">/* Bluetooth */</span>
	<span class="n">GPIO81_GPIO</span><span class="p">,</span> <span class="cm">/* reset */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">smc91x_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;smc91x-regs&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">PXA_CS4_PHYS</span> <span class="o">+</span> <span class="mh">0x300</span><span class="p">),</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="n">PXA_CS4_PHYS</span> <span class="o">+</span> <span class="mh">0xfffff</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span> <span class="o">|</span> <span class="n">IORESOURCE_IRQ_HIGHEDGE</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">smc91x_platdata</span> <span class="n">stargate2_smc91x_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">SMC91X_USE_8BIT</span> <span class="o">|</span> <span class="n">SMC91X_USE_16BIT</span> <span class="o">|</span> <span class="n">SMC91X_USE_32BIT</span>
	<span class="o">|</span> <span class="n">SMC91X_NOWAIT</span> <span class="o">|</span> <span class="n">SMC91X_USE_DMA</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">smc91x_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;smc91x&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">smc91x_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">smc91x_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_smc91x_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * The card detect interrupt isn&#39;t debounced so we delay it by 250ms</span>
<span class="cm"> * to give the card a chance to fully insert / eject.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">stargate2_mci_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			      <span class="n">irq_handler_t</span> <span class="n">stargate2_detect_int</span><span class="p">,</span>
			      <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">gpio_request</span><span class="p">(</span><span class="n">SG2_SD_POWER_ENABLE</span><span class="p">,</span> <span class="s">&quot;SG2_sd_power_enable&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;Can&#39;t get the gpio for SD power control&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">return_err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">SG2_SD_POWER_ENABLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">gpio_request</span><span class="p">(</span><span class="n">SG2_GPIO_nSD_DETECT</span><span class="p">,</span> <span class="s">&quot;SG2_sd_detect&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;Can&#39;t get the sd detect gpio&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">free_power_en</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">SG2_GPIO_nSD_DETECT</span><span class="p">);</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">request_irq</span><span class="p">(</span><span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="n">SG2_GPIO_nSD_DETECT</span><span class="p">),</span>
			  <span class="n">stargate2_detect_int</span><span class="p">,</span>
			  <span class="n">IRQ_TYPE_EDGE_BOTH</span><span class="p">,</span>
			  <span class="s">&quot;MMC card detect&quot;</span><span class="p">,</span>
			  <span class="n">data</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;can&#39;t request MMC card detect IRQ</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">free_nsd_detect</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

 <span class="nl">free_nsd_detect:</span>
	<span class="n">gpio_free</span><span class="p">(</span><span class="n">SG2_GPIO_nSD_DETECT</span><span class="p">);</span>
 <span class="nl">free_power_en:</span>
	<span class="n">gpio_free</span><span class="p">(</span><span class="n">SG2_SD_POWER_ENABLE</span><span class="p">);</span>
 <span class="nl">return_err:</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * stargate2_mci_setpower() - set state of mmc power supply</span>
<span class="cm"> *</span>
<span class="cm"> * Very simple control. Either it is on or off and is controlled by</span>
<span class="cm"> * a gpio pin */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">stargate2_mci_setpower</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vdd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">SG2_SD_POWER_ENABLE</span><span class="p">,</span> <span class="o">!!</span><span class="n">vdd</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">stargate2_mci_exit</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">free_irq</span><span class="p">(</span><span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="n">SG2_GPIO_nSD_DETECT</span><span class="p">),</span> <span class="n">data</span><span class="p">);</span>
	<span class="n">gpio_free</span><span class="p">(</span><span class="n">SG2_SD_POWER_ENABLE</span><span class="p">);</span>
	<span class="n">gpio_free</span><span class="p">(</span><span class="n">SG2_GPIO_nSD_DETECT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pxamci_platform_data</span> <span class="n">stargate2_mci_platform_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">detect_delay_ms</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ocr_mask</span> <span class="o">=</span> <span class="n">MMC_VDD_32_33</span> <span class="o">|</span> <span class="n">MMC_VDD_33_34</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">stargate2_mci_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">setpower</span> <span class="o">=</span> <span class="n">stargate2_mci_setpower</span><span class="p">,</span>
	<span class="p">.</span><span class="n">exit</span> <span class="o">=</span> <span class="n">stargate2_mci_exit</span><span class="p">,</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * SRAM - The Stargate 2 has 32MB of SRAM.</span>
<span class="cm"> *</span>
<span class="cm"> * Here it is made available as an MTD. This will then</span>
<span class="cm"> * typically have a cifs filesystem created on it to provide</span>
<span class="cm"> * fast temporary storage.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sram_resources</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">PXA_CS1_PHYS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">PXA_CS1_PHYS</span> <span class="o">+</span> <span class="n">SZ_32M</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platdata_mtd_ram</span> <span class="n">stargate2_sram_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mapname</span> <span class="o">=</span> <span class="s">&quot;Stargate2 SRAM&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bankwidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">stargate2_sram</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;mtd-ram&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sram_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_sram_pdata</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pcf857x_platform_data</span> <span class="n">platform_data_pcf857x</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">gpio_base</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
	<span class="p">.</span><span class="n">n_latch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">setup</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">teardown</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">context</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">at24_platform_data</span> <span class="n">pca9500_eeprom_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">byte_len</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
	<span class="p">.</span><span class="n">page_size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * stargate2_reset_bluetooth() reset the bluecore to ensure consistent state</span>
<span class="cm"> **/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">stargate2_reset_bluetooth</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">gpio_request</span><span class="p">(</span><span class="n">SG2_BT_RESET</span><span class="p">,</span> <span class="s">&quot;SG2_BT_RESET&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;Could not get gpio for bluetooth reset</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">SG2_BT_RESET</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">mdelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
	<span class="cm">/* now reset it - 5 msec minimum */</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">SG2_BT_RESET</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mdelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">SG2_BT_RESET</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">gpio_free</span><span class="p">(</span><span class="n">SG2_BT_RESET</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">led_info</span> <span class="n">stargate2_leds</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;sg2:red&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">DA9030_LED_RATE_ON</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;sg2:blue&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">DA9030_LED_RATE_ON</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;sg2:green&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">DA9030_LED_RATE_ON</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">da903x_subdev_info</span> <span class="n">stargate2_da9030_subdevs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-led&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LED_2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_leds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-led&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LED_3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_leds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-led&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LED_4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_leds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_bbio</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_bb</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_pxa_flash</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_cc2420</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO6</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_vref</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO7</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_sram_ext</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_mica</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO9</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_bt</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_sensor_1_8</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO11</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_sensor_3</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO12</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_lcd</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO15</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_pxa_pll</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO17</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_pxa_usim</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span> <span class="cm">/*pxa vcc i/o and cc2420 vcc i/o */</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO18</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_io</span><span class="p">],</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;da903x-regulator&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">DA9030_ID_LDO19</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_ldo_init_data</span><span class="p">[</span><span class="n">vcc_pxa_mem</span><span class="p">],</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">da903x_platform_data</span> <span class="n">stargate2_da9030_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_subdevs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">stargate2_da9030_subdevs</span><span class="p">),</span>
	<span class="p">.</span><span class="n">subdevs</span> <span class="o">=</span> <span class="n">stargate2_da9030_subdevs</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">stargate2_pwr_i2c_board_info</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;da9030&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x49</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stargate2_da9030_pdata</span><span class="p">,</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">stargate2_i2c_board_info</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Techically this a pca9500 - but it&#39;s compatible with the 8574</span>
<span class="cm">	 * for gpio expansion and the 24c02 for eeprom access.</span>
<span class="cm">	 */</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;pcf8574&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span>  <span class="mh">0x27</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">platform_data_pcf857x</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;24c02&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x57</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pca9500_eeprom_pdata</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;max1238&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x35</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span> <span class="cm">/* ITS400 Sensor board only */</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;max1363&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x34</span><span class="p">,</span>
		<span class="cm">/* Through a nand gate - Also beware, on V2 sensor board the</span>
<span class="cm">		 * pull up resistors are missing.</span>
<span class="cm">		 */</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">99</span><span class="p">),</span>
	<span class="p">},</span> <span class="p">{</span> <span class="cm">/* ITS400 Sensor board only */</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;tsl2561&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x49</span><span class="p">,</span>
		<span class="cm">/* Through a nand gate - Also beware, on V2 sensor board the</span>
<span class="cm">		 * pull up resistors are missing.</span>
<span class="cm">		 */</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">99</span><span class="p">),</span>
	<span class="p">},</span> <span class="p">{</span> <span class="cm">/* ITS400 Sensor board only */</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;tmp175&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x4A</span><span class="p">,</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">PXA_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">96</span><span class="p">),</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Board doesn&#39;t support cable detection - so always lie and say</span>
<span class="cm"> * something is there.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sg2_udc_detect</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pxa2xx_udc_mach_info</span> <span class="n">stargate2_udc_info</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">udc_is_connected</span>	<span class="o">=</span> <span class="n">sg2_udc_detect</span><span class="p">,</span>
	<span class="p">.</span><span class="n">udc_command</span>		<span class="o">=</span> <span class="n">sg2_udc_command</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">stargate2_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">stargate2_flash_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">stargate2_sram</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">smc91x_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sht15</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">stargate2_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* This is probably a board specific hack as this must be set</span>
<span class="cm">	   prior to connecting the MFP stuff up. */</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">__raw_readl</span><span class="p">(</span><span class="n">MECR</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">MECR_NOS</span><span class="p">,</span> <span class="n">MECR</span><span class="p">);</span>

	<span class="n">pxa2xx_mfp_config</span><span class="p">(</span><span class="n">ARRAY_AND_SIZE</span><span class="p">(</span><span class="n">stargate2_pin_config</span><span class="p">));</span>

	<span class="n">imote2_stargate2_init</span><span class="p">();</span>

	<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">ARRAY_AND_SIZE</span><span class="p">(</span><span class="n">stargate2_devices</span><span class="p">));</span>

	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ARRAY_AND_SIZE</span><span class="p">(</span><span class="n">stargate2_i2c_board_info</span><span class="p">));</span>
	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">stargate2_pwr_i2c_board_info</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">stargate2_pwr_i2c_board_info</span><span class="p">));</span>

	<span class="n">pxa_set_mci_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stargate2_mci_platform_data</span><span class="p">);</span>

	<span class="n">pxa_set_udc_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stargate2_udc_info</span><span class="p">);</span>

	<span class="n">stargate2_reset_bluetooth</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_MACH_INTELMOTE2</span>
<span class="n">MACHINE_START</span><span class="p">(</span><span class="n">INTELMOTE2</span><span class="p">,</span> <span class="s">&quot;IMOTE 2&quot;</span><span class="p">)</span>
	<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">pxa27x_map_io</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nr_irqs</span>	<span class="o">=</span> <span class="n">PXA_NR_IRQS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>	<span class="o">=</span> <span class="n">pxa27x_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">handle_irq</span>	<span class="o">=</span> <span class="n">pxa27x_handle_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">timer</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">pxa_timer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span>	<span class="o">=</span> <span class="n">imote2_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">atag_offset</span>	<span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>
	<span class="p">.</span><span class="n">restart</span>	<span class="o">=</span> <span class="n">pxa_restart</span><span class="p">,</span>
<span class="n">MACHINE_END</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_MACH_STARGATE2</span>
<span class="n">MACHINE_START</span><span class="p">(</span><span class="n">STARGATE2</span><span class="p">,</span> <span class="s">&quot;Stargate 2&quot;</span><span class="p">)</span>
	<span class="p">.</span><span class="n">map_io</span> <span class="o">=</span> <span class="n">pxa27x_map_io</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nr_irqs</span> <span class="o">=</span> <span class="n">STARGATE_NR_IRQS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span> <span class="o">=</span> <span class="n">pxa27x_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">handle_irq</span> <span class="o">=</span> <span class="n">pxa27x_handle_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">timer</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pxa_timer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span> <span class="o">=</span> <span class="n">stargate2_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">atag_offset</span> <span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>
	<span class="p">.</span><span class="n">restart</span>	<span class="o">=</span> <span class="n">pxa_restart</span><span class="p">,</span>
<span class="n">MACHINE_END</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
