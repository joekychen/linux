f | xics-common.c | s | 10K | 352 | Grant Likely | grant.likely@secretlab.ca | 1335746726 |  | powerpc/irqdomain: Fix broken NR_IRQ references  The switch from using irq_map to irq_alloc_desc*() for managing irq number allocations introduced new bugs in some of the powerpc interrupt code.  Several functions rely on the value of NR_IRQS to determine the maximum irq number that could get allocated.  However, with sparse_irq and using irq_alloc_desc*() the maximum possible irq number is now specified with 'nr_irqs' which may be a number larger than NR_IRQS.  This has caused breakage on powermac when CONFIG_NR_IRQS is set to 32.  This patch removes most of the direct references to NR_IRQS in the powerpc code and replaces them with either a nr_irqs reference or by using the common for_each_irq_desc() macro.  The powerpc-specific for_each_irq() macro is removed at the same time.  Also, the Cell axon_msi driver is refactored to remove the global build assumption on the size of NR_IRQS and instead add a limit to the maximum irq number when calling irq_domain_add_nomap().  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | icp-hv.c | s | 3.9K | 149 | Anton Blanchard | anton@samba.org | 1323313343 |  | powerpc/xics: Reset the CPPR if H_EOI fails  I have an intermittent kdump fail where the hypervisor fails an H_EOI. As a result our CPPR is never reset to 0xff and we no longer accept interrupts.  This patch calls icp_hv_set_cppr to reset the CPPR if H_EOI fails, fixing the kdump fail.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | icp-native.c | s | 6.6K | 249 | Arnaud Lacombe | lacombar@gmail.com | 1316474402 |  | powerpc/xics: Add __init to marker icp_native_init()  This should fix the following warning:   LD      arch/powerpc/sysdev/xics/built-in.o WARNING: arch/powerpc/sysdev/xics/built-in.o(.text+0x1310): Section mismatch in reference from the function .icp_native_init() to the function .init.text:.icp_native_init_one_node() The function .icp_native_init() references the function __init .icp_native_init_one_node(). This is often because .icp_native_init lacks a __init annotation or the annotation of .icp_native_init_one_node is wrong.  icp_native_init() is only referenced in `arch/powerpc/sysdev/xics/xics-common.c' by xics_init() which is itself marked with __init.  = not built-tested =  Reported-by: Timur Tabi <timur@freescale.com> Signed-off-by: Arnaud Lacombe <lacombar@gmail.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | Makefile | g | 237B |  | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1316498999 |  | powerpc/powernv: Add OPAL ICS backend  OPAL handles HW access to the various ICS or equivalent chips for us (with the exception of p5ioc2 based HEA which uses a  different backend) similarily to what RTAS does on pSeries.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | Kconfig | g | 184B |  | Milton Miller | miltonm@bga.com | 1305783065 |  | powerpc: Add kconfig for muxed smp ipi support  Compile the new smp ipi mux and demux code only if a platform will make use of it.  The new config is selected as required.  The new cause_ipi smp op is only available conditionally to point out configs where the select is required; this makes setting the op an immediate fail instead of a deferred unresolved symbol at link.  This also creates a new config for power surge powermac upgrade support that can be disabled in expert mode but is default on.  I also removed the depends / default y on CONFIG_XICS since it is selected by PSERIES.  Signed-off-by: Milton Miller <miltonm@bga.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | ics-rtas.c | s | 5.9K | 198 | Grant Likely | grant.likely@secretlab.ca | 1304485335 |  | powerpc/irq: Stop exporting irq_map  First step in eliminating irq_map[] table entirely  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | ics-opal.c | s | 5.8K | 201 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1316498999 |  | powerpc/powernv: Add OPAL ICS backend  OPAL handles HW access to the various ICS or equivalent chips for us (with the exception of p5ioc2 based HEA which uses a  different backend) similarily to what RTAS does on pSeries.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
