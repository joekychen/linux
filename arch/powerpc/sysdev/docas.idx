f | cpm2_pic.c | s | 6.9K | 220 | Grant Likely | grant.likely@secretlab.ca | 1335746726 |  | powerpc/irqdomain: Fix broken NR_IRQ references  The switch from using irq_map to irq_alloc_desc*() for managing irq number allocations introduced new bugs in some of the powerpc interrupt code.  Several functions rely on the value of NR_IRQS to determine the maximum irq number that could get allocated.  However, with sparse_irq and using irq_alloc_desc*() the maximum possible irq number is now specified with 'nr_irqs' which may be a number larger than NR_IRQS.  This has caused breakage on powermac when CONFIG_NR_IRQS is set to 32.  This patch removes most of the direct references to NR_IRQS in the powerpc code and replaces them with either a nr_irqs reference or by using the common for_each_irq_desc() macro.  The powerpc-specific for_each_irq() macro is removed at the same time.  Also, the Cell axon_msi driver is refactored to remove the global build assumption on the size of NR_IRQS and instead add a limit to the maximum irq number when calling irq_domain_add_nomap().  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
d | bestcomm |  | 18 items |  | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103844 |  | powerpc: various straight conversions from module.h --> export.h  All these files were including module.h just for the basic EXPORT_SYMBOL infrastructure.  We can shift them off to the export.h header which is a way smaller footprint and thus realize some compile time gains.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | pmi.c | s | 6.6K | 231 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103838 |  | powerpc: Fix up modules that should be including module.h  So that we can clean up the header files and not be relying on implicit includes from device.h ---> module.h  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | of_rtc.c | s | 1.6K | 53 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | Makefile | g | 2.4K |  | Jia Hongtao | B38951@freescale.com | 1331932528 |  | powerpc: add support for MPIC message register API  Some MPIC implementations contain one or more blocks of message registers that are used to send messages between cores via IPIs.  A simple API has been added to access (get/put, read, write, etc ...) these message registers. The available message registers are initially discovered via nodes in the device tree.  A separate commit contains a binding for the message register nodes.  Signed-off-by: Meador Inge <meador_inge@mentor.com> Signed-off-by: Jia Hongtao <B38951@freescale.com> Signed-off-by: Li Yang <leoli@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | ipic.c | s | 19K | 862 | Grant Likely | grant.likely@secretlab.ca | 1329397884 |  | irq_domain/powerpc: Replace custom xlate functions with library functions  This patch converts a number of the powerpc drivers to use the common library of irq_domain xlate functions, dropping a bunch of lines in the process.  v5: - Remove tsi108 changes from patch  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Rob Herring <rob.herring@calxeda.com> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | grackle.c | s | 2.0K | 58 | Rob Herring | rob.herring@calxeda.com | 1310480884 |  | powerpc: rename ppc_pci_*_flags to pci_*_flags  This renames pci flags functions and enums in preparation for creating generic version in asm-generic/pci-bridge.h. The following search and replace is done:  s/ppc_pci_/pci_/ s/PPC_PCI_/PCI_/  Direct accesses to ppc_pci_flag variable are replaced with helper functions.  Signed-off-by: Rob Herring <rob.herring@calxeda.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mackerras <paulus@samba.org>
f | dart.h | s | 2.2K | 59 | Linas Vepstas | linas@austin.ibm.com | 1162353168 |  | [POWERPC] Use 4kB iommu pages even on 64kB-page systems  The 10Gigabit ethernet device drivers appear to be able to chew up all 256MB of TCE mappings on pSeries systems, as evidenced by numerous error messages:   iommu_alloc failed, tbl c0000000010d5c48 vaddr c0000000d875eff0 npages 1  Some experimentation indicates that this is essentially because one 1500 byte ethernet MTU gets mapped as a 64K DMA region when the large 64K pages are enabled. Thus, it doesn't take much to exhaust all of the available DMA mappings for a high-speed card.  This patch changes the iommu allocator to work with its own unique, distinct page size. Although the patch is long, its actually quite simple: it just #defines a distinct IOMMU_PAGE_SIZE and then uses this in all the places that matter.  As a side effect, it also dramatically improves network performance on platforms with H-calls on iommu translation inserts/removes (since we no longer call it 16 times for a 1500 bytes packet when the iommu HW is still 4k).  In the future, we might want to make the IOMMU_PAGE_SIZE a variable in the iommu_table instance, thus allowing support for different HW page sizes in the iommu itself.  Signed-off-by: Linas Vepstas <linas@austin.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Acked-by: Olof Johansson <olof@lixom.net> Acked-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | tsi108_dev.c | s | 3.8K | 133 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | mpc5xxx_clocks.c | s | 733B | 29 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103837 |  | powerpc: add export.h to files making use of EXPORT_SYMBOL  With module.h being implicitly everywhere via device.h, the absence of explicitly including something for EXPORT_SYMBOL went unnoticed. Since we are heading to fix things up and clean module.h from the device.h file, we need to explicitly include these files now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | micropatch.c | s | 11K | 707 | Anton Vorontsov | avorontsov@mvista.com | 1278864246 |  | powerpc/cpm1: Mark micropatch code/data static and __init  This saves runtime memory and fixes lots of sparse warnings like this:      CHECK   arch/powerpc/sysdev/micropatch.c   arch/powerpc/sysdev/micropatch.c:27:6: warning: symbol 'patch_2000'   was not declared. Should it be static?   arch/powerpc/sysdev/micropatch.c:146:6: warning: symbol 'patch_2f00'   was not declared. Should it be static?   ...  Signed-off-by: Anton Vorontsov <avorontsov@mvista.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | 6xx-suspend.S | g | 1.1K |  | Scott Wood | scottwood@freescale.com | 1210944148 |  | [POWERPC] Add 6xx-style HID0_SLEEP support.  This adds a function to put a 6xx/7xx/7xxx/83xx family CPU into sleep mode, and return after an interrupt has occurred.  It expects to be called with interrupts disabled, and returns with interrupts disabled. Interrupts are enabled while the processor is asleep, but the interrupt that wakes the processor is not handled; it is still pending when this function returns.  Signed-off-by: Scott Wood <scottwood@freescale.com> Signed-off-by: Guennadi Liakhovetski <g.liakhovetski@gmx.de> Signed-off-by: Paul Mackerras <paulus@samba.org>
d | ge |  | 3 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1332381310 |  | Merge branch 'next' of git://git.kernel.org/pub/scm/linux/kernel/git/benh/powerpc  Pull powerpc merge from Benjamin Herrenschmidt:  "Here's the powerpc batch for this merge window.  It is going to be a   bit more nasty than usual as in touching things outside of   arch/powerpc mostly due to the big iSeriesectomy :-) We finally got   rid of the bugger (legacy iSeries support) which was a PITA to   maintain and that nobody really used anymore.    Here are some of the highlights:     - Legacy iSeries is gone.  Thanks Stephen ! There's still some bits      and pieces remaining if you do a grep -ir series arch/powerpc but      they are harmless and will be removed in the next few weeks      hopefully.     - The 'fadump' functionality (Firmware Assisted Dump) replaces the      previous (equivalent) "pHyp assisted dump"...  it's a rewrite of a      mechanism to get the hypervisor to do crash dumps on pSeries, the      new implementation hopefully being much more reliable.  Thanks      Mahesh Salgaonkar.     - The "EEH" code (pSeries PCI error handling & recovery) got a big      spring cleaning, motivated by the need to be able to implement a      new backend for it on top of some new different type of firwmare.       The work isn't complete yet, but a good chunk of the cleanups is      there.  Note that this adds a field to struct device_node which is      not very nice and which Grant objects to.  I will have a patch soon      that moves that to a powerpc private data structure (hopefully      before rc1) and we'll improve things further later on (hopefully      getting rid of the need for that pointer completely).  Thanks Gavin      Shan.     - I dug into our exception & interrupt handling code to improve the      way we do lazy interrupt handling (and make it work properly with      "edge" triggered interrupt sources), and while at it found & fixed      a wagon of issues in those areas, including adding support for page      fault retry & fatal signals on page faults.     - Your usual random batch of small fixes & updates, including a bunch      of new embedded boards, both Freescale and APM based ones, etc..."  I fixed up some conflicts with the generalized irq-domain changes from Grant Likely, hopefully correctly.  * 'next' of git://git.kernel.org/pub/scm/linux/kernel/git/benh/powerpc: (141 commits)   powerpc/ps3: Do not adjust the wrapper load address   powerpc: Remove the rest of the legacy iSeries include files   powerpc: Remove the remaining CONFIG_PPC_ISERIES pieces   init: Remove CONFIG_PPC_ISERIES   powerpc: Remove FW_FEATURE ISERIES from arch code   tty/hvc_vio: FW_FEATURE_ISERIES is no longer selectable   powerpc/spufs: Fix double unlocks   powerpc/5200: convert mpc5200 to use of_platform_populate()   powerpc/mpc5200: add options to mpc5200_defconfig   powerpc/mpc52xx: add a4m072 board support   powerpc/mpc5200: update mpc5200_defconfig to fit for charon board   Documentation/powerpc/mpc52xx.txt: Checkpatch cleanup   powerpc/44x: Add additional device support for APM821xx SoC and Bluestone board   powerpc/44x: Add support PCI-E for APM821xx SoC and Bluestone board   MAINTAINERS: Update PowerPC 4xx tree   powerpc/44x: The bug fixed support for APM821xx SoC and Bluestone board   powerpc: document the FSL MPIC message register binding   powerpc: add support for MPIC message register API   powerpc/fsl: Added aliased MSIIR register address to MSI node in dts   powerpc/85xx: mpc8548cds - add 36-bit dts   ...
f | ppc4xx_pci.h | s | 14K | 464 | Tony Breeds | tony@bakeyournoodle.com | 1323435062 |  | powerpc/476fpe: Add 476fpe SoC code  Based on original work by David 'Shaggy' Kleikamp.  Signed-off-by: Tony Breeds <tony@bakeyournoodle.com> Signed-off-by: Josh Boyer <jwboyer@gmail.com>
f | fsl_soc.h | s | 1.3K | 41 | Florian Tobias Schandinat | FlorianSchandinat@gmx.de | 1314609270 |  | Merge branch 'master' of git://git.kernel.org/pub/scm/linux/kernel/git/lethal/fbdev-3.x into fbdev-next  Conflicts: 	drivers/video/atmel_lcdfb.c
f | cpm2.c | s | 8.5K | 325 | Wolfgang Ocker | weo@reccoware.de | 1271736783 |  | powerpc/fsl-cpm: Configure clock correctly for SCC  Some board setup functions call cpm1_clk_setup() or cmp2_clk_setup() to configure the clock source.  If CPM_CLK_RTX has been used for the parameter mode, the clock has been configured only for TX but not for RX.  With this patch CPM_CLK_RTX configures the clock for both directions correctly.  Signed-off-by: Wolfgang Ocker <weo@reccoware.de> Acked-by: Scott Wood <scottwood@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | fsl_msi.h | s | 1.1K | 35 | Grant Likely | grant.likely@secretlab.ca | 1329253610 |  | irq_domain/powerpc: Use common irq_domain structure instead of irq_host  This patch drops the powerpc-specific irq_host structures and uses the common irq_domain strucutres defined in linux/irqdomain.h.  It also fixes all the users to use the new structure names.  Renaming irq_host to irq_domain has been discussed for a long time, and this patch is a step in the process of generalizing the powerpc virq code to be usable by all architecture.  An astute reader will notice that this patch actually removes the irq_host structure instead of renaming it.  This is because the irq_domain structure already exists in include/linux/irqdomain.h and has the needed data members.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | fsl_rio.c | s | 17K | 603 | Liu Gang | Gang.Liu@freescale.com | 1331912790 |  | powerpc/srio: Fix the relocation errors when building with 64bit  For the file "arch/powerpc/sysdev/fsl_rio.c", there will be some relocation errors while using the corenet64_smp_defconfig:  WARNING: modpost: Found 6 section mismatch(es). To see full details build your kernel with: 'make CONFIG_DEBUG_SECTION_MISMATCH=y'   GEN     .version   CHK     include/generated/compile.h   UPD     include/generated/compile.h   CC      init/version.o   LD      init/built-in.o   LD      .tmp_vmlinux1 arch/powerpc/sysdev/built-in.o:(__ex_table+0x0): 	relocation truncated to fit: R_PPC64_ADDR16 against `.text'+3208 arch/powerpc/sysdev/built-in.o:(__ex_table+0x2): 	relocation truncated to fit: R_PPC64_ADDR16 against `.fixup' arch/powerpc/sysdev/built-in.o:(__ex_table+0x4): 	relocation truncated to fit: R_PPC64_ADDR16 against `.text'+3230 arch/powerpc/sysdev/built-in.o:(__ex_table+0x6): 	relocation truncated to fit: R_PPC64_ADDR16 against `.fixup'+c arch/powerpc/sysdev/built-in.o:(__ex_table+0x8): 	relocation truncated to fit: R_PPC64_ADDR16 against `.text'+3250 arch/powerpc/sysdev/built-in.o:(__ex_table+0xa): 	relocation truncated to fit: R_PPC64_ADDR16 against `.fixup'+18  Rewrote the corresponding code with the support of 64bit building.  Signed-off-by: Liu Gang <Gang.Liu@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | mv64x60_udbg.c | s | 3.0K | 120 | Joe Perches | joe@perches.com | 1307710536 |  | treewide: Convert uses of struct resource to resource_size(ptr)  Several fixes as well where the +1 was missing.  Done via coccinelle scripts like:  @@ struct resource *ptr; @@  - ptr->end - ptr->start + 1 + resource_size(ptr)  and some grep and typing.  Mostly uncompiled, no cross-compilers.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | ipic.h | s | 1.5K | 49 | Grant Likely | grant.likely@secretlab.ca | 1329253610 |  | irq_domain/powerpc: Use common irq_domain structure instead of irq_host  This patch drops the powerpc-specific irq_host structures and uses the common irq_domain strucutres defined in linux/irqdomain.h.  It also fixes all the users to use the new structure names.  Renaming irq_host to irq_domain has been discussed for a long time, and this patch is a step in the process of generalizing the powerpc virq code to be usable by all architecture.  An astute reader will notice that this patch actually removes the irq_host structure instead of renaming it.  This is because the irq_domain structure already exists in include/linux/irqdomain.h and has the needed data members.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | cpm1.c | s | 18K | 629 | Grant Likely | grant.likely@secretlab.ca | 1329397884 |  | irq_domain/powerpc: constify irq_domain_ops  Make all the irq_domain_ops structures in powerpc 'static const'  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | fsl_soc.c | s | 5.9K | 227 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | fsl_lbc.c | s | 9.6K | 335 | Jia Hongtao | B38951@freescale.com | 1322121700 |  | powerpc/85xx: Add lbc suspend support for PM  Power supply for LBC registers is off when system go to deep-sleep state. We save the values of registers before suspend and restore to registers after resume.  We removed the last two reservation arrays from struct fsl_lbc_regs for allocating less memory and minimizing the memcpy size.  Signed-off-by: Jiang Yutang <b14898@freescale.com> Signed-off-by: Jia Hongtao <B38951@freescale.com> Signed-off-by: Li Yang <leoli@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | dcr-low.S | g | 983B |  | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1229829675 |  | powerpc/4xx: Extended DCR support v2  This adds supports to the "extended" DCR addressing via the indirect mfdcrx/mtdcrx instructions supported by some 4xx cores (440H6 and later).  I enabled the feature for now only on AMCC 460 chips.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Acked-by: Josh Boyer <jwboyer@linux.vnet.ibm.com> Acked-by: Kumar Gala <galak@kernel.crashing.org> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | mpic.c | s | 48K | 1573 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1335143070 |  | powerpc/mpic: Properly set default triggers  This gets rid of the unused default senses array, and replaces the incorrect use of IRQ_TYPE_NONE with the new IRQ_TYPE_DEFAULT for the initial set_trigger() call when mapping an interrupt.  This in turn makes us read the HW state and update the irq desc accordingly.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | uic.c | s | 8.2K | 279 | Grant Likely | grant.likely@secretlab.ca | 1329397884 |  | irq_domain/powerpc: Replace custom xlate functions with library functions  This patch converts a number of the powerpc drivers to use the common library of irq_domain xlate functions, dropping a bunch of lines in the process.  v5: - Remove tsi108 changes from patch  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Rob Herring <rob.herring@calxeda.com> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | ppc4xx_pci.c | s | 59K | 1842 | Vinh Nguyen Huu Tuong | vhtnguyen@apm.com | 1331988574 |  | powerpc/44x: Add support PCI-E for APM821xx SoC and Bluestone board  This patch extends PCI-E driver to support PCI-E for APM821xx SoC on Bluestone board.  Signed-off-by: Vinh Nguyen Huu Tuong <vhtnguyen@apm.com> Signed-off-by: Josh Boyer <jwboyer@gmail.com>
f | dcr.c | s | 6.0K | 196 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103837 |  | powerpc: add export.h to files making use of EXPORT_SYMBOL  With module.h being implicitly everywhere via device.h, the absence of explicitly including something for EXPORT_SYMBOL went unnoticed. Since we are heading to fix things up and clean module.h from the device.h file, we need to explicitly include these files now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ehv_pic.c | s | 7.3K | 241 | Grant Likely | grant.likely@secretlab.ca | 1329397884 |  | irq_domain/powerpc: constify irq_domain_ops  Make all the irq_domain_ops structures in powerpc 'static const'  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | mpic_pasemi_msi.c | s | 4.4K | 142 | Thomas Gleixner | tglx@linutronix.de | 1301402892 |  | powerpc: Convert to new irq_* function names  Scripted with coccinelle.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
f | ppc4xx_cpm.c | s | 7.6K | 283 | Kay Sievers | kay.sievers@vrfy.org | 1324506582 |  | cpu: convert 'cpu' and 'machinecheck' sysdev_class to a regular subsystem  This moves the 'cpu sysdev_class' over to a regular 'cpu' subsystem and converts the devices to regular devices. The sysdev drivers are implemented as subsystem interfaces now.  After all sysdev classes are ported to regular driver core entities, the sysdev implementation will be entirely removed from the kernel.  Userspace relies on events and generic sysfs subsystem infrastructure from sysdev devices, which are made available with this conversion.  Cc: Haavard Skinnemoen <hskinnemoen@gmail.com> Cc: Hans-Christian Egtvedt <egtvedt@samfundet.no> Cc: Tony Luck <tony.luck@intel.com> Cc: Fenghua Yu <fenghua.yu@intel.com> Cc: Arnd Bergmann <arnd@arndb.de> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mackerras <paulus@samba.org> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: Heiko Carstens <heiko.carstens@de.ibm.com> Cc: Paul Mundt <lethal@linux-sh.org> Cc: "David S. Miller" <davem@davemloft.net> Cc: Chris Metcalf <cmetcalf@tilera.com> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Ingo Molnar <mingo@redhat.com> Cc: "H. Peter Anvin" <hpa@zytor.com> Cc: Borislav Petkov <bp@amd64.org> Cc: Tigran Aivazian <tigran@aivazian.fsnet.co.uk> Cc: Len Brown <lenb@kernel.org> Cc: Zhang Rui <rui.zhang@intel.com> Cc: Dave Jones <davej@redhat.com> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Russell King <rmk+kernel@arm.linux.org.uk> Cc: Andrew Morton <akpm@linux-foundation.org> Cc: Arjan van de Ven <arjan@linux.intel.com> Cc: "Rafael J. Wysocki" <rjw@sisk.pl> Cc: "Srivatsa S. Bhat" <srivatsa.bhat@linux.vnet.ibm.com> Signed-off-by: Kay Sievers <kay.sievers@vrfy.org> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | mpic.h | s | 1.2K | 37 | Lennert Buytenhek | buytenh@wantstofly.org | 1299715436 |  | powerpc: mpic irq_data conversion.  Signed-off-by: Lennert Buytenhek <buytenh@secretlab.ca> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
d | qe_lib |  | 11 items |  | Dave Liu | daveliu@freescale.com | 1333026856 |  | powerpc/qe: Update the SNUM table for MPC8569 Rev2.0  The MPC8569 Rev2.0 has the correct SNUM table as QE Reference Manual, we must follow it.  However the Rev1.0 silicon need the old SNUM table as workaround due to Rev1.0 silicon SNUM erratum.  So, we support both snum table, and choose the one FDT tell us. And u-boot will fixup FDT according to SPRN_SVR.  Signed-off-by: Liu Yu <yu.liu@freescale.com> Signed-off-by: Dave Liu <daveliu@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | tsi108_pci.c | s | 11K | 371 | Grant Likely | grant.likely@secretlab.ca | 1329397883 |  | irq_domain: Add support for base irq and hwirq in legacy mappings  Add support for a legacy mapping where irq = (hwirq - first_hwirq + first_irq) so that a controller driver can allocate a fixed range of irq_descs and use a simple calculation to translate back and forth between linux and hw irq numbers.  This is needed to use an irq_domain with many of the ARM interrupt controller drivers that manage their own irq_desc allocations.  Ultimately the goal is to migrate those drivers to use the linear revmap, but doing it this way allows each driver to be converted separately which makes the migration path easier.  This patch generalizes the IRQ_DOMAIN_MAP_LEGACY method to use (first_irq-first_hwirq) as the offset between hwirq and linux irq number, and adds checks to make sure that the hwirq number does not exceed range assigned to the controller.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Rob Herring <rob.herring@calxeda.com> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | rtc_cmos_setup.c | s | 1.6K | 60 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103838 |  | powerpc: Fix up modules that should be including module.h  So that we can clean up the header files and not be relying on implicit includes from device.h ---> module.h  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | fsl_ifc.c | s | 8.1K | 255 | Prabhakar Kushwaha | prabhakar@freescale.com | 1325713282 |  | powerpc/fsl: Add support for Integrated Flash Controller  Integrated Flash Controller supports various flashes like NOR, NAND and other devices using NOR, NAND and GPCM Machine available on it. IFC supports four chip selects.  Signed-off-by: Dipen Dudhat <Dipen.Dudhat@freescale.com> Signed-off-by: Scott Wood <scottwood@freescale.com> Signed-off-by: Li Yang <leoli@freescale.com> Signed-off-by: Liu Shuo <b35362@freescale.com> Signed-off-by: Prabhakar Kushwaha <prabhakar@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | mpic_msi.c | s | 2.4K | 84 | Linus Torvalds | torvalds@linux-foundation.org | 1332381310 |  | Merge branch 'next' of git://git.kernel.org/pub/scm/linux/kernel/git/benh/powerpc  Pull powerpc merge from Benjamin Herrenschmidt:  "Here's the powerpc batch for this merge window.  It is going to be a   bit more nasty than usual as in touching things outside of   arch/powerpc mostly due to the big iSeriesectomy :-) We finally got   rid of the bugger (legacy iSeries support) which was a PITA to   maintain and that nobody really used anymore.    Here are some of the highlights:     - Legacy iSeries is gone.  Thanks Stephen ! There's still some bits      and pieces remaining if you do a grep -ir series arch/powerpc but      they are harmless and will be removed in the next few weeks      hopefully.     - The 'fadump' functionality (Firmware Assisted Dump) replaces the      previous (equivalent) "pHyp assisted dump"...  it's a rewrite of a      mechanism to get the hypervisor to do crash dumps on pSeries, the      new implementation hopefully being much more reliable.  Thanks      Mahesh Salgaonkar.     - The "EEH" code (pSeries PCI error handling & recovery) got a big      spring cleaning, motivated by the need to be able to implement a      new backend for it on top of some new different type of firwmare.       The work isn't complete yet, but a good chunk of the cleanups is      there.  Note that this adds a field to struct device_node which is      not very nice and which Grant objects to.  I will have a patch soon      that moves that to a powerpc private data structure (hopefully      before rc1) and we'll improve things further later on (hopefully      getting rid of the need for that pointer completely).  Thanks Gavin      Shan.     - I dug into our exception & interrupt handling code to improve the      way we do lazy interrupt handling (and make it work properly with      "edge" triggered interrupt sources), and while at it found & fixed      a wagon of issues in those areas, including adding support for page      fault retry & fatal signals on page faults.     - Your usual random batch of small fixes & updates, including a bunch      of new embedded boards, both Freescale and APM based ones, etc..."  I fixed up some conflicts with the generalized irq-domain changes from Grant Likely, hopefully correctly.  * 'next' of git://git.kernel.org/pub/scm/linux/kernel/git/benh/powerpc: (141 commits)   powerpc/ps3: Do not adjust the wrapper load address   powerpc: Remove the rest of the legacy iSeries include files   powerpc: Remove the remaining CONFIG_PPC_ISERIES pieces   init: Remove CONFIG_PPC_ISERIES   powerpc: Remove FW_FEATURE ISERIES from arch code   tty/hvc_vio: FW_FEATURE_ISERIES is no longer selectable   powerpc/spufs: Fix double unlocks   powerpc/5200: convert mpc5200 to use of_platform_populate()   powerpc/mpc5200: add options to mpc5200_defconfig   powerpc/mpc52xx: add a4m072 board support   powerpc/mpc5200: update mpc5200_defconfig to fit for charon board   Documentation/powerpc/mpc52xx.txt: Checkpatch cleanup   powerpc/44x: Add additional device support for APM821xx SoC and Bluestone board   powerpc/44x: Add support PCI-E for APM821xx SoC and Bluestone board   MAINTAINERS: Update PowerPC 4xx tree   powerpc/44x: The bug fixed support for APM821xx SoC and Bluestone board   powerpc: document the FSL MPIC message register binding   powerpc: add support for MPIC message register API   powerpc/fsl: Added aliased MSIIR register address to MSI node in dts   powerpc/85xx: mpc8548cds - add 36-bit dts   ...
f | scom.c | s | 4.4K | 158 | Paul Gortmaker | paul.gortmaker@windriver.com | 1334787107 |  | powerpc: fix system.h fallout in sysdev/scom.c [chroma_defconfig]  The following shows up in chroma_defconfig:   CC      arch/powerpc/sysdev/scom.o arch/powerpc/sysdev/scom.c: In function 'scom_debug_init': arch/powerpc/sysdev/scom.c:182:36: error: 'powerpc_debugfs_root' undeclared (first use in this function) arch/powerpc/sysdev/scom.c:182:36: note: each undeclared identifier is reported only once for each function it appears in make[2]: *** [arch/powerpc/sysdev/scom.o] Error 1 make[1]: *** [arch/powerpc/sysdev/scom.o] Error 2  A bisect leads to commit 9ffc93f203c18a70623f21950f1dd473c9ec48cd      "Remove all #inclusions of asm/system.h"  Add the debug header which contains powerpc_debugfs_root.  Acked-by: David Howells <dhowells@redhat.com> Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | dart_iommu.c | s | 11K | 388 | Joe Perches | joe@perches.com | 1307710536 |  | treewide: Convert uses of struct resource to resource_size(ptr)  Several fixes as well where the +1 was missing.  Done via coccinelle scripts like:  @@ struct resource *ptr; @@  - ptr->end - ptr->start + 1 + resource_size(ptr)  and some grep and typing.  Mostly uncompiled, no cross-compilers.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | fsl_85xx_cache_ctlr.h | s | 3.8K | 92 | Harninder Rai | harninder.rai@freescale.com | 1287035678 |  | powerpc/85xx: add cache-sram support  It adds cache-sram support in P1/P2 QorIQ platforms as under:  * A small abstraction over powerpc's remote heap allocator * Exports mpc85xx_cache_sram_alloc()/free() APIs * Supports only one contiguous SRAM window * Drivers can do the following in Kconfig to use these APIs     "select FSL_85XX_CACHE_SRAM if MPC85xx" * Required SRAM size and the offset where SRAM should be mapped must be   provided at kernel command line as :     cache-sram-size=<value>     cache-sram-offset=<offset>  Signed-off-by: Harninder Rai <harninder.rai@freescale.com> Signed-off-by: Vivek Mahajan <vivek.mahajan@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | mpic_msgr.c | s | 6.8K | 234 | Mingkai Hu | Mingkai.hu@freescale.com | 1334865356 |  | powerpc/mpic_msgr: fix offset error when setting mer register  Signed-off-by: Mingkai Hu <Mingkai.hu@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | xilinx_intc.c | s | 7.6K | 250 | Grant Likely | grant.likely@secretlab.ca | 1329397882 |  | irq_domain: Replace irq_alloc_host() with revmap-specific initializers  Each revmap type has different arguments for setting up the revmap. This patch splits up the generator functions so that each revmap type can do its own setup and the user doesn't need to keep track of how each revmap type handles the arguments.  This patch also adds a host_data argument to the generators.  There are cases where the host_data pointer will be needed before the function returns. ie. the legacy map calls the .map callback for each irq before returning.  v2: - Add void *host_data argument to irq_domain_add_*() functions     - fixed failure to compile     - Moved IRQ_DOMAIN_MAP_* defines into irqdomain.c  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Rob Herring <rob.herring@calxeda.com> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | mmio_nvram.c | s | 3.7K | 125 | Joe Perches | joe@perches.com | 1307710536 |  | treewide: Convert uses of struct resource to resource_size(ptr)  Several fixes as well where the +1 was missing.  Done via coccinelle scripts like:  @@ struct resource *ptr; @@  - ptr->end - ptr->start + 1 + resource_size(ptr)  and some grep and typing.  Mostly uncompiled, no cross-compilers.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | msi_bitmap.c | s | 6.5K | 193 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | mv64x60_dev.c | s | 11K | 411 | Nicolas Kaiser | nikai@nikai.net | 1299045005 |  | powerpc/mv64x60: Suspected typo in assignment  Untested, but looks like an obvious typo to me.  [BenH: No feedback, but it's obviously wrong]  Signed-off-by: Nicolas Kaiser <nikai@nikai.net> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | mpc8xx_pic.h | s | 401B | 15 | Vitaly Bordug | vitb@kernel.crashing.org | 1184045631 |  | [POWERPC] 8xx: mpc885ads pcmcia support  Adds support for PowerQuicc on-chip PCMCIA.  The driver is implemented as of_device, so only arch/powerpc stuff is capable to use it, which now implies only mpc885ads reference board.  To cope with the code that should be hooked inside driver, but is really board specific (like set_voltage), global structure mpc8xx_pcmcia_ops holds necessary function pointers that are filled in the BSP code.  [akpm@linux-foundation.org: whitespace diddles] Signed-off-by: Vitaly Bordug <vitb@kernel.crashing.org> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Olof Johansson <olof@lixom.net> Cc: Dominik Brodowski <linux@dominikbrodowski.net> Cc: Paul Mackerras <paulus@samba.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | cpm2_pic.h | s | 178B | 5 | Andrea Gelmini | andrea.gelmini@gelma.net | 1267721038 |  | powerpc/cpm2: Checkpatch cleanup  arch/powerpc/sysdev/cpm2_pic.h:6: ERROR: "(foo*)" should be "(foo *)"  Signed-off-by: Andrea Gelmini <andrea.gelmini@gelma.net> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | simple_gpio.h | s | 315B | 9 | Anton Vorontsov | avorontsov@ru.mvista.com | 1230657225 |  | powerpc: Implement GPIO driver for simple memory-mapped banks  The driver supports very simple GPIO controllers, that is, when a controller provides just a 'data' register. Such controllers may be found in various BCSRs (Board's FPGAs used to control board's switches, LEDs, chip-selects, Ethernet/USB PHY power, etc).  So far we support only 1-byte GPIO banks. Support for other widths may be implemented when/if needed.  p.s. To avoid "made up" compatible entries (like compatible = "simple-gpio"), boards must call simple_gpiochip_init() to pass the compatible string.  Signed-off-by: Anton Vorontsov <avorontsov@ru.mvista.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | i8259.c | s | 6.9K | 239 | Grant Likely | grant.likely@secretlab.ca | 1329397883 |  | irq_domain: Add support for base irq and hwirq in legacy mappings  Add support for a legacy mapping where irq = (hwirq - first_hwirq + first_irq) so that a controller driver can allocate a fixed range of irq_descs and use a simple calculation to translate back and forth between linux and hw irq numbers.  This is needed to use an irq_domain with many of the ARM interrupt controller drivers that manage their own irq_desc allocations.  Ultimately the goal is to migrate those drivers to use the linear revmap, but doing it this way allows each driver to be converted separately which makes the migration path easier.  This patch generalizes the IRQ_DOMAIN_MAP_LEGACY method to use (first_irq-first_hwirq) as the offset between hwirq and linux irq number, and adds checks to make sure that the hwirq number does not exceed range assigned to the controller.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Rob Herring <rob.herring@calxeda.com> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | fsl_rmu.c | s | 28K | 942 | Liu Gang | Gang.Liu@freescale.com | 1331912790 |  | powerpc/srio: Fix the compile errors when building with 64bit  For the file "arch/powerpc/sysdev/fsl_rmu.c", there will be some compile errors while using the corenet64_smp_defconfig:  .../fsl_rmu.c:315: error: cast from pointer to integer of different size .../fsl_rmu.c:320: error: cast to pointer from integer of different size .../fsl_rmu.c:320: error: cast to pointer from integer of different size .../fsl_rmu.c:320: error: cast to pointer from integer of different size .../fsl_rmu.c:330: error: cast to pointer from integer of different size .../fsl_rmu.c:332: error: cast to pointer from integer of different size .../fsl_rmu.c:339: error: cast to pointer from integer of different size .../fsl_rmu.c:340: error: cast to pointer from integer of different size .../fsl_rmu.c:341: error: cast to pointer from integer of different size .../fsl_rmu.c:348: error: cast to pointer from integer of different size .../fsl_rmu.c:348: error: cast to pointer from integer of different size .../fsl_rmu.c:348: error: cast to pointer from integer of different size .../fsl_rmu.c:659: error: cast from pointer to integer of different size .../fsl_rmu.c:659: error: format '%8.8x' expects type 'unsigned int',                    but argument 5 has type 'size_t' .../fsl_rmu.c:985: error: cast from pointer to integer of different size .../fsl_rmu.c:997: error: cast to pointer from integer of different size  Rewrote the corresponding code with the support of 64bit building.  Signed-off-by: Liu Gang <Gang.Liu@freescale.com> Signed-off-by: Shaohui Xie <Shaohui.Xie@freescale.com> Reported-by: Paul Gortmaker <paul.gortmaker@windriver.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | fsl_85xx_cache_sram.c | s | 4.3K | 129 | Claudiu Manoil | claudiu.manoil@freescale.com | 1331927425 |  | powerpc/85xx: Fix compiler error with THIS_MODULE and related  CC      arch/powerpc/sysdev/fsl_85xx_l2ctlr.o arch/powerpc/sysdev/fsl_85xx_l2ctlr.c:209:13: error: 'THIS_MODULE' undeclared here (not in a function) arch/powerpc/sysdev/fsl_85xx_l2ctlr.c:229:20: error: expected declaration specifiers or '...' before string constant cc1: warnings being treated as errors arch/powerpc/sysdev/fsl_85xx_l2ctlr.c:229:1: error: data definition has no type or storage class arch/powerpc/sysdev/fsl_85xx_l2ctlr.c:229:1: error: type defaults to 'int' in declaration of 'MODULE_DESCRIPTION' arch/powerpc/sysdev/fsl_85xx_l2ctlr.c:229:20: error: function declaration isn't a prototype arch/powerpc/sysdev/fsl_85xx_l2ctlr.c:230:16: error: expected declaration specifiers or '...' before string constant arch/powerpc/sysdev/fsl_85xx_l2ctlr.c:230:1: error: data definition has no type or storage class arch/powerpc/sysdev/fsl_85xx_l2ctlr.c:230:1: error: type defaults to 'int' in declaration of 'MODULE_LICENSE' arch/powerpc/sysdev/fsl_85xx_l2ctlr.c:230:16: error: function declaration isn't a prototype make[1]: *** [arch/powerpc/sysdev/fsl_85xx_l2ctlr.o] Error 1  ...    CC      arch/powerpc/sysdev/fsl_85xx_cache_sram.o cc1: warnings being treated as errors arch/powerpc/sysdev/fsl_85xx_cache_sram.c:69:1: error: data definition has no type or storage class arch/powerpc/sysdev/fsl_85xx_cache_sram.c:69:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL' arch/powerpc/sysdev/fsl_85xx_cache_sram.c:69:1: error: parameter names (without types) in function declaration arch/powerpc/sysdev/fsl_85xx_cache_sram.c:80:1: error: data definition has no type or storage class arch/powerpc/sysdev/fsl_85xx_cache_sram.c:80:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL' arch/powerpc/sysdev/fsl_85xx_cache_sram.c:80:1: error: parameter names (without types) in function declaration make[1]: *** [arch/powerpc/sysdev/fsl_85xx_cache_sram.o] Error 1  Signed-off-by: Claudiu Manoil <claudiu.manoil@freescale.com> Acked-by: Paul Gortmaker <paul.gortmaker@windriver.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | fsl_gtm.c | s | 11K | 378 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103837 |  | powerpc: add export.h to files making use of EXPORT_SYMBOL  With module.h being implicitly everywhere via device.h, the absence of explicitly including something for EXPORT_SYMBOL went unnoticed. Since we are heading to fix things up and clean module.h from the device.h file, we need to explicitly include these files now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | mpc8xx_pic.c | s | 3.7K | 132 | Grant Likely | grant.likely@secretlab.ca | 1335746725 |  | powerpc/8xx: Fix NR_IRQ bugs and refactor 8xx interrupt controller  The mpc8xx driver uses a reference to NR_IRQS that is buggy.  It uses NR_IRQs for the array size of the ppc_cached_irq_mask bitmap, but NR_IRQs could be smaller than the number of hardware irqs that ppc_cached_irq_mask tracks.  Also, while fixing that problem, it became apparent that the interrupt controller only supports 32 interrupt numbers, but it is written as if it supports multiple register banks which is more complicated.  This patch pulls out the buggy reference to NR_IRQs and fixes the size of the ppc_cached_irq_mask to match the number of HW irqs.  It also drops the now-unnecessary code since ppc_cached_irq_mask is no longer an array.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
d | xics |  | 7 items |  | Grant Likely | grant.likely@secretlab.ca | 1335746726 |  | powerpc/irqdomain: Fix broken NR_IRQ references  The switch from using irq_map to irq_alloc_desc*() for managing irq number allocations introduced new bugs in some of the powerpc interrupt code.  Several functions rely on the value of NR_IRQS to determine the maximum irq number that could get allocated.  However, with sparse_irq and using irq_alloc_desc*() the maximum possible irq number is now specified with 'nr_irqs' which may be a number larger than NR_IRQS.  This has caused breakage on powermac when CONFIG_NR_IRQS is set to 32.  This patch removes most of the direct references to NR_IRQS in the powerpc code and replaces them with either a nr_irqs reference or by using the common for_each_irq_desc() macro.  The powerpc-specific for_each_irq() macro is removed at the same time.  Also, the Cell axon_msi driver is refactored to remove the global build assumption on the size of NR_IRQS and instead add a limit to the maximum irq number when calling irq_domain_add_nomap().  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | fsl_pci.c | s | 21K | 667 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1329369303 |  | powerpc/fsl/pci: Fix PCIe fixup regression  Upstream changes to the way PHB resources are registered broke the resource fixup for FSL boards.  We can no longer rely on the resource pointer array for the PHB's pci_bus structure, so let's leave it alone and go straight for the PHB resources instead. This also makes the code generally more readable.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | mv64x60.h | s | 273B | 8 | Dale Farnsworth | dale@farnsworth.org | 1190436561 |  | [POWERPC] Add Marvell mv64x60 udbg putc/getc functions  Commit 69331af, "Fixes and cleanups for earlyprintk aka boot console", resulted in printk output prior to the initialization of the mpsc console driver not being printed.  That commit causes the mpsc's CON_PRINTBUFFER flag to be cleared since udbg should have printed the previous output.  I guess we can no longer ignore udbg. :)  This patch provides udbg_putc() and udbg_getc() functions for the Marvell mv64x60 chips. These functions are enabled if an mv64x60 port is to be used as the console as determined from the device tree.  Signed-off-by: Dale Farnsworth <dale@farnsworth.org> Acked-by: Mark A. Greer <mgreer@mvista.com> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | Kconfig | g | 570B |  | Martyn Welch | martyn.welch@ge.com | 1331914091 |  | powerpc: Move GE PIC drivers  Move the GE PIC drivers to allow these to be used by non-86xx boards.  Signed-off-by: Martyn Welch <martyn.welch@ge.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | mpic_u3msi.c | s | 5.2K | 169 | Thomas Gleixner | tglx@linutronix.de | 1301402892 |  | powerpc: Convert to new irq_* function names  Scripted with coccinelle.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
f | fsl_pci.h | s | 3.9K | 88 | Prabhakar Kushwaha | prabhakar@freescale.com | 1300199396 |  | powerpc/fsl_pci: Add support for FSL PCIe controllers v2.x  FSL PCIe controller v2.1:      - New MSI inbound window      - Same Inbound windows address as PCIe controller v1.x  Added new pit_t member(pmit) to struct ccsr_pci for MSI inbound window  FSL PCIe controller v2.2 and v2.3:      - Different addresses for PCIe inbound window 3,2,1      - Exposed PCIe inbound window 0      - New PCIe interrupt status register  Added new config and interrupt Status register to struct ccsr_pci & updated pit_t array size to reflect the 4 inbound windows.  Device tree is used to maintain backward compatibility i.e. update inbound window 1 index depending upon "compatible" field witin PCIE node.  Signed-off-by: Prabhakar Kushwaha <prabhakar@freescale.com> Acked-by: Roy Zang <tie-fei.zang@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | xilinx_pci.c | s | 3.6K | 110 | Roderick Colenbrander | thunderbird2k@gmail.com | 1244304862 |  | powerpc/virtex: Add support for Xilinx PCI host bridge  This patch adds support for the Xilinx plbv46-pci-1.03.a PCI host bridge IPcore.  Signed-off-by: Roderick Colenbrander <thunderbird2k@gmail.com> Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | fsl_rio.h | s | 3.9K | 116 | Liu Gang | Gang.Liu@freescale.com | 1322121694 |  | fsl-rio: Add two ports and rapidio message units support  Usually, freescale rapidio endpoint can support one or two 1x or 4X LP-Serial link interfaces, and rapidio message transactions can be implemented by two message units. This adds the support of two rapidio ports and initializes message unit 0 and message unit 1. And these ports and message units can work simultaneously.  Signed-off-by: Li Yang <leoli@freescale.com> Signed-off-by: Jin Qing <b24347@freescale.com> Signed-off-by: Liu Gang <Gang.Liu@freescale.com> Acked-by: Alexandre Bounine <alexandre.bounine@idt.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | simple_gpio.c | s | 3.2K | 126 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103844 |  | powerpc: remove non-required uses of include <linux/module.h>  None of the files touched here are modules, and they are not exporting any symbols either -- so there is no need to be including the module.h.  Builds of all the files remains successful.  Even kernel/module.c does not need to include it, since it includes linux/moduleloader.h instead.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ppc4xx_soc.c | s | 6.0K | 185 | Yong Zhang | yong.zhang0@gmail.com | 1320724306 |  | powerpc/irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Geoff Levand <geoff@infradead.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | indirect_pci.c | s | 4.4K | 149 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | fsl_msi.c | s | 13K | 455 | Linus Torvalds | torvalds@linux-foundation.org | 1332381310 |  | Merge branch 'next' of git://git.kernel.org/pub/scm/linux/kernel/git/benh/powerpc  Pull powerpc merge from Benjamin Herrenschmidt:  "Here's the powerpc batch for this merge window.  It is going to be a   bit more nasty than usual as in touching things outside of   arch/powerpc mostly due to the big iSeriesectomy :-) We finally got   rid of the bugger (legacy iSeries support) which was a PITA to   maintain and that nobody really used anymore.    Here are some of the highlights:     - Legacy iSeries is gone.  Thanks Stephen ! There's still some bits      and pieces remaining if you do a grep -ir series arch/powerpc but      they are harmless and will be removed in the next few weeks      hopefully.     - The 'fadump' functionality (Firmware Assisted Dump) replaces the      previous (equivalent) "pHyp assisted dump"...  it's a rewrite of a      mechanism to get the hypervisor to do crash dumps on pSeries, the      new implementation hopefully being much more reliable.  Thanks      Mahesh Salgaonkar.     - The "EEH" code (pSeries PCI error handling & recovery) got a big      spring cleaning, motivated by the need to be able to implement a      new backend for it on top of some new different type of firwmare.       The work isn't complete yet, but a good chunk of the cleanups is      there.  Note that this adds a field to struct device_node which is      not very nice and which Grant objects to.  I will have a patch soon      that moves that to a powerpc private data structure (hopefully      before rc1) and we'll improve things further later on (hopefully      getting rid of the need for that pointer completely).  Thanks Gavin      Shan.     - I dug into our exception & interrupt handling code to improve the      way we do lazy interrupt handling (and make it work properly with      "edge" triggered interrupt sources), and while at it found & fixed      a wagon of issues in those areas, including adding support for page      fault retry & fatal signals on page faults.     - Your usual random batch of small fixes & updates, including a bunch      of new embedded boards, both Freescale and APM based ones, etc..."  I fixed up some conflicts with the generalized irq-domain changes from Grant Likely, hopefully correctly.  * 'next' of git://git.kernel.org/pub/scm/linux/kernel/git/benh/powerpc: (141 commits)   powerpc/ps3: Do not adjust the wrapper load address   powerpc: Remove the rest of the legacy iSeries include files   powerpc: Remove the remaining CONFIG_PPC_ISERIES pieces   init: Remove CONFIG_PPC_ISERIES   powerpc: Remove FW_FEATURE ISERIES from arch code   tty/hvc_vio: FW_FEATURE_ISERIES is no longer selectable   powerpc/spufs: Fix double unlocks   powerpc/5200: convert mpc5200 to use of_platform_populate()   powerpc/mpc5200: add options to mpc5200_defconfig   powerpc/mpc52xx: add a4m072 board support   powerpc/mpc5200: update mpc5200_defconfig to fit for charon board   Documentation/powerpc/mpc52xx.txt: Checkpatch cleanup   powerpc/44x: Add additional device support for APM821xx SoC and Bluestone board   powerpc/44x: Add support PCI-E for APM821xx SoC and Bluestone board   MAINTAINERS: Update PowerPC 4xx tree   powerpc/44x: The bug fixed support for APM821xx SoC and Bluestone board   powerpc: document the FSL MPIC message register binding   powerpc: add support for MPIC message register API   powerpc/fsl: Added aliased MSIIR register address to MSI node in dts   powerpc/85xx: mpc8548cds - add 36-bit dts   ...
f | fsl_85xx_l2ctlr.c | s | 5.2K | 194 | chenhui zhao | chenhui.zhao@freescale.com | 1331927445 |  | powerpc/85xx: l2sram - Add compatible entry for mpc8548 L2 controller  Signed-off-by: Zhao Chenhui <chenhui.zhao@freescale.com> Signed-off-by: Li Yang <leoli@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | fsl_pmc.c | s | 2.0K | 79 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103837 |  | powerpc: add export.h to files making use of EXPORT_SYMBOL  With module.h being implicitly everywhere via device.h, the absence of explicitly including something for EXPORT_SYMBOL went unnoticed. Since we are heading to fix things up and clean module.h from the device.h file, we need to explicitly include these files now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | mv64x60_pci.c | s | 4.2K | 137 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103839 |  | powerpc: Fix up implicit stat.h users  They get it via module.h (via device.h) but we want to clean that up. When we do, we'll get things like:  ibmebus.c:314: error: 'S_IWUSR' undeclared here (not in a function) vio.c:972: error: 'S_IWUSR' undeclared here (not in a function)  so add in the stat header it is using explicitly in advance.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | mv64x60_pic.c | s | 8.1K | 245 | Grant Likely | grant.likely@secretlab.ca | 1329397882 |  | irq_domain: Replace irq_alloc_host() with revmap-specific initializers  Each revmap type has different arguments for setting up the revmap. This patch splits up the generator functions so that each revmap type can do its own setup and the user doesn't need to keep track of how each revmap type handles the arguments.  This patch also adds a host_data argument to the generators.  There are cases where the host_data pointer will be needed before the function returns. ie. the legacy map calls the .map callback for each irq before returning.  v2: - Add void *host_data argument to irq_domain_add_*() functions     - fixed failure to compile     - Moved IRQ_DOMAIN_MAP_* defines into irqdomain.c  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Rob Herring <rob.herring@calxeda.com> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | cpm_common.c | s | 8.5K | 283 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | axonram.c | s | 9.2K | 310 | Al Viro | viro@zeniv.linux.org.uk | 1325649247 |  | fs: move code out of buffer.c  Move invalidate_bdev, block_sync_page into fs/block_dev.c.  Export kill_bdev as well, so brd doesn't have to open code it.  Reduce buffer_head.h requirement accordingly.  Removed a rather large comment from invalidate_bdev, as it looked a bit obsolete to bother moving.  The small comment replacing it says enough.  Signed-off-by: Nick Piggin <npiggin@suse.de> Cc: Al Viro <viro@ZenIV.linux.org.uk> Cc: Christoph Hellwig <hch@lst.de> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | ppc4xx_gpio.c | s | 5.2K | 177 | Anton Vorontsov | avorontsov@ru.mvista.com | 1278368070 |  | of/gpio: add default of_xlate function if device has a node pointer  Implement generic OF gpio hooks and thus make device-enabled GPIO chips (i.e.  the ones that have gpio_chip->dev specified) automatically attach to the OpenFirmware subsystem.  Which means that now we can handle I2C and SPI GPIO chips almost* transparently.  * "Almost" because some chips still require platform data, and for these   chips OF-glue is still needed, though with this change the glue will   be much smaller.  Signed-off-by: Anton Vorontsov <avorontsov@ru.mvista.com> Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: David Brownell <dbrownell@users.sourceforge.net> Cc: Bill Gatliff <bgat@billgatliff.com> Cc: Dmitry Eremin-Solenikov <dbaryshkov@gmail.com> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Jean Delvare <khali@linux-fr.org> Cc: Andrew Morton <akpm@linux-foundation.org> CC: linux-kernel@vger.kernel.org CC: devicetree-discuss@lists.ozlabs.org
f | ppc4xx_msi.c | s | 7.3K | 246 | Josh Boyer | jwboyer@gmail.com | 1336090393 |  | powerpc/40x: Use {upper,lower}_32_bits for msi_phys  Fix a build error when -Werror is set: 	arch/powerpc/sysdev/ppc4xx_msi.c: In function ‘ppc4xx_setup_pcieh_hw’: 	arch/powerpc/sysdev/ppc4xx_msi.c:178:2: error: right shift count >= width of type [-Werror]  Signed-off-by: Josh Boyer <jwboyer@gmail.com>
