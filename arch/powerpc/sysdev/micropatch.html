<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › sysdev › micropatch.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>micropatch.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* Microcode patches for the CPM as supplied by Motorola.</span>
<span class="cm"> * This is the one for IIC/SPI.  There is a newer one that</span>
<span class="cm"> * also relocates SMC2, but this would require additional changes</span>
<span class="cm"> * to uart.c, so I am holding off on that for a moment.</span>
<span class="cm"> */</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/param.h&gt;</span>
<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#include &lt;linux/mm.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;asm/irq.h&gt;</span>
<span class="cp">#include &lt;asm/mpc8xx.h&gt;</span>
<span class="cp">#include &lt;asm/page.h&gt;</span>
<span class="cp">#include &lt;asm/pgtable.h&gt;</span>
<span class="cp">#include &lt;asm/8xx_immap.h&gt;</span>
<span class="cp">#include &lt;asm/cpm.h&gt;</span>
<span class="cp">#include &lt;asm/cpm1.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * I2C/SPI relocation patch arrays.</span>
<span class="cm"> */</span>

<span class="cp">#ifdef CONFIG_I2C_SPI_UCODE_PATCH</span>

<span class="k">static</span> <span class="n">uint</span> <span class="n">patch_2000</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x7FFFEFD9</span><span class="p">,</span>
	<span class="mh">0x3FFD0000</span><span class="p">,</span>
	<span class="mh">0x7FFB49F7</span><span class="p">,</span>
	<span class="mh">0x7FF90000</span><span class="p">,</span>
	<span class="mh">0x5FEFADF7</span><span class="p">,</span>
	<span class="mh">0x5F89ADF7</span><span class="p">,</span>
	<span class="mh">0x5FEFAFF7</span><span class="p">,</span>
	<span class="mh">0x5F89AFF7</span><span class="p">,</span>
	<span class="mh">0x3A9CFBC8</span><span class="p">,</span>
	<span class="mh">0xE7C0EDF0</span><span class="p">,</span>
	<span class="mh">0x77C1E1BB</span><span class="p">,</span>
	<span class="mh">0xF4DC7F1D</span><span class="p">,</span>
	<span class="mh">0xABAD932F</span><span class="p">,</span>
	<span class="mh">0x4E08FDCF</span><span class="p">,</span>
	<span class="mh">0x6E0FAFF8</span><span class="p">,</span>
	<span class="mh">0x7CCF76CF</span><span class="p">,</span>
	<span class="mh">0xFD1FF9CF</span><span class="p">,</span>
	<span class="mh">0xABF88DC6</span><span class="p">,</span>
	<span class="mh">0xAB5679F7</span><span class="p">,</span>
	<span class="mh">0xB0937383</span><span class="p">,</span>
	<span class="mh">0xDFCE79F7</span><span class="p">,</span>
	<span class="mh">0xB091E6BB</span><span class="p">,</span>
	<span class="mh">0xE5BBE74F</span><span class="p">,</span>
	<span class="mh">0xB3FA6F0F</span><span class="p">,</span>
	<span class="mh">0x6FFB76CE</span><span class="p">,</span>
	<span class="mh">0xEE0DF9CF</span><span class="p">,</span>
	<span class="mh">0x2BFBEFEF</span><span class="p">,</span>
	<span class="mh">0xCFEEF9CF</span><span class="p">,</span>
	<span class="mh">0x76CEAD24</span><span class="p">,</span>
	<span class="mh">0x90B2DF9A</span><span class="p">,</span>
	<span class="mh">0x7FDDD0BF</span><span class="p">,</span>
	<span class="mh">0x4BF847FD</span><span class="p">,</span>
	<span class="mh">0x7CCF76CE</span><span class="p">,</span>
	<span class="mh">0xCFEF7E1F</span><span class="p">,</span>
	<span class="mh">0x7F1D7DFD</span><span class="p">,</span>
	<span class="mh">0xF0B6EF71</span><span class="p">,</span>
	<span class="mh">0x7FC177C1</span><span class="p">,</span>
	<span class="mh">0xFBC86079</span><span class="p">,</span>
	<span class="mh">0xE722FBC8</span><span class="p">,</span>
	<span class="mh">0x5FFFDFFF</span><span class="p">,</span>
	<span class="mh">0x5FB2FFFB</span><span class="p">,</span>
	<span class="mh">0xFBC8F3C8</span><span class="p">,</span>
	<span class="mh">0x94A67F01</span><span class="p">,</span>
	<span class="mh">0x7F1D5F39</span><span class="p">,</span>
	<span class="mh">0xAFE85F5E</span><span class="p">,</span>
	<span class="mh">0xFFDFDF96</span><span class="p">,</span>
	<span class="mh">0xCB9FAF7D</span><span class="p">,</span>
	<span class="mh">0x5FC1AFED</span><span class="p">,</span>
	<span class="mh">0x8C1C5FC1</span><span class="p">,</span>
	<span class="mh">0xAFDD5FC3</span><span class="p">,</span>
	<span class="mh">0xDF9A7EFD</span><span class="p">,</span>
	<span class="mh">0xB0B25FB2</span><span class="p">,</span>
	<span class="mh">0xFFFEABAD</span><span class="p">,</span>
	<span class="mh">0x5FB2FFFE</span><span class="p">,</span>
	<span class="mh">0x5FCE600B</span><span class="p">,</span>
	<span class="mh">0xE6BB600B</span><span class="p">,</span>
	<span class="mh">0x5FCEDFC6</span><span class="p">,</span>
	<span class="mh">0x27FBEFDF</span><span class="p">,</span>
	<span class="mh">0x5FC8CFDE</span><span class="p">,</span>
	<span class="mh">0x3A9CE7C0</span><span class="p">,</span>
	<span class="mh">0xEDF0F3C8</span><span class="p">,</span>
	<span class="mh">0x7F0154CD</span><span class="p">,</span>
	<span class="mh">0x7F1D2D3D</span><span class="p">,</span>
	<span class="mh">0x363A7570</span><span class="p">,</span>
	<span class="mh">0x7E0AF1CE</span><span class="p">,</span>
	<span class="mh">0x37EF2E68</span><span class="p">,</span>
	<span class="mh">0x7FEE10EC</span><span class="p">,</span>
	<span class="mh">0xADF8EFDE</span><span class="p">,</span>
	<span class="mh">0xCFEAE52F</span><span class="p">,</span>
	<span class="mh">0x7D0FE12B</span><span class="p">,</span>
	<span class="mh">0xF1CE5F65</span><span class="p">,</span>
	<span class="mh">0x7E0A4DF8</span><span class="p">,</span>
	<span class="mh">0xCFEA5F72</span><span class="p">,</span>
	<span class="mh">0x7D0BEFEE</span><span class="p">,</span>
	<span class="mh">0xCFEA5F74</span><span class="p">,</span>
	<span class="mh">0xE522EFDE</span><span class="p">,</span>
	<span class="mh">0x5F74CFDA</span><span class="p">,</span>
	<span class="mh">0x0B627385</span><span class="p">,</span>
	<span class="mh">0xDF627E0A</span><span class="p">,</span>
	<span class="mh">0x30D8145B</span><span class="p">,</span>
	<span class="mh">0xBFFFF3C8</span><span class="p">,</span>
	<span class="mh">0x5FFFDFFF</span><span class="p">,</span>
	<span class="mh">0xA7F85F5E</span><span class="p">,</span>
	<span class="mh">0xBFFE7F7D</span><span class="p">,</span>
	<span class="mh">0x10D31450</span><span class="p">,</span>
	<span class="mh">0x5F36BFFF</span><span class="p">,</span>
	<span class="mh">0xAF785F5E</span><span class="p">,</span>
	<span class="mh">0xBFFDA7F8</span><span class="p">,</span>
	<span class="mh">0x5F36BFFE</span><span class="p">,</span>
	<span class="mh">0x77FD30C0</span><span class="p">,</span>
	<span class="mh">0x4E08FDCF</span><span class="p">,</span>
	<span class="mh">0xE5FF6E0F</span><span class="p">,</span>
	<span class="mh">0xAFF87E1F</span><span class="p">,</span>
	<span class="mh">0x7E0FFD1F</span><span class="p">,</span>
	<span class="mh">0xF1CF5F1B</span><span class="p">,</span>
	<span class="mh">0xABF80D5E</span><span class="p">,</span>
	<span class="mh">0x5F5EFFEF</span><span class="p">,</span>
	<span class="mh">0x79F730A2</span><span class="p">,</span>
	<span class="mh">0xAFDD5F34</span><span class="p">,</span>
	<span class="mh">0x47F85F34</span><span class="p">,</span>
	<span class="mh">0xAFED7FDD</span><span class="p">,</span>
	<span class="mh">0x50B24978</span><span class="p">,</span>
	<span class="mh">0x47FD7F1D</span><span class="p">,</span>
	<span class="mh">0x7DFD70AD</span><span class="p">,</span>
	<span class="mh">0xEF717EC1</span><span class="p">,</span>
	<span class="mh">0x6BA47F01</span><span class="p">,</span>
	<span class="mh">0x2D267EFD</span><span class="p">,</span>
	<span class="mh">0x30DE5F5E</span><span class="p">,</span>
	<span class="mh">0xFFFD5F5E</span><span class="p">,</span>
	<span class="mh">0xFFEF5F5E</span><span class="p">,</span>
	<span class="mh">0xFFDF0CA0</span><span class="p">,</span>
	<span class="mh">0xAFED0A9E</span><span class="p">,</span>
	<span class="mh">0xAFDD0C3A</span><span class="p">,</span>
	<span class="mh">0x5F3AAFBD</span><span class="p">,</span>
	<span class="mh">0x7FBDB082</span><span class="p">,</span>
	<span class="mh">0x5F8247F8</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">uint</span> <span class="n">patch_2f00</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x3E303430</span><span class="p">,</span>
	<span class="mh">0x34343737</span><span class="p">,</span>
	<span class="mh">0xABF7BF9B</span><span class="p">,</span>
	<span class="mh">0x994B4FBD</span><span class="p">,</span>
	<span class="mh">0xBD599493</span><span class="p">,</span>
	<span class="mh">0x349FFF37</span><span class="p">,</span>
	<span class="mh">0xFB9B177D</span><span class="p">,</span>
	<span class="mh">0xD9936956</span><span class="p">,</span>
	<span class="mh">0xBBFDD697</span><span class="p">,</span>
	<span class="mh">0xBDD2FD11</span><span class="p">,</span>
	<span class="mh">0x31DB9BB3</span><span class="p">,</span>
	<span class="mh">0x63139637</span><span class="p">,</span>
	<span class="mh">0x93733693</span><span class="p">,</span>
	<span class="mh">0x193137F7</span><span class="p">,</span>
	<span class="mh">0x331737AF</span><span class="p">,</span>
	<span class="mh">0x7BB9B999</span><span class="p">,</span>
	<span class="mh">0xBB197957</span><span class="p">,</span>
	<span class="mh">0x7FDFD3D5</span><span class="p">,</span>
	<span class="mh">0x73B773F7</span><span class="p">,</span>
	<span class="mh">0x37933B99</span><span class="p">,</span>
	<span class="mh">0x1D115316</span><span class="p">,</span>
	<span class="mh">0x99315315</span><span class="p">,</span>
	<span class="mh">0x31694BF4</span><span class="p">,</span>
	<span class="mh">0xFBDBD359</span><span class="p">,</span>
	<span class="mh">0x31497353</span><span class="p">,</span>
	<span class="mh">0x76956D69</span><span class="p">,</span>
	<span class="mh">0x7B9D9693</span><span class="p">,</span>
	<span class="mh">0x13131979</span><span class="p">,</span>
	<span class="mh">0x79376935</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * I2C/SPI/SMC1 relocation patch arrays.</span>
<span class="cm"> */</span>

<span class="cp">#ifdef CONFIG_I2C_SPI_SMC1_UCODE_PATCH</span>

<span class="k">static</span> <span class="n">uint</span> <span class="n">patch_2000</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x3fff0000</span><span class="p">,</span>
	<span class="mh">0x3ffd0000</span><span class="p">,</span>
	<span class="mh">0x3ffb0000</span><span class="p">,</span>
	<span class="mh">0x3ff90000</span><span class="p">,</span>
	<span class="mh">0x5f13eff8</span><span class="p">,</span>
	<span class="mh">0x5eb5eff8</span><span class="p">,</span>
	<span class="mh">0x5f88adf7</span><span class="p">,</span>
	<span class="mh">0x5fefadf7</span><span class="p">,</span>
	<span class="mh">0x3a9cfbc8</span><span class="p">,</span>
	<span class="mh">0x77cae1bb</span><span class="p">,</span>
	<span class="mh">0xf4de7fad</span><span class="p">,</span>
	<span class="mh">0xabae9330</span><span class="p">,</span>
	<span class="mh">0x4e08fdcf</span><span class="p">,</span>
	<span class="mh">0x6e0faff8</span><span class="p">,</span>
	<span class="mh">0x7ccf76cf</span><span class="p">,</span>
	<span class="mh">0xfdaff9cf</span><span class="p">,</span>
	<span class="mh">0xabf88dc8</span><span class="p">,</span>
	<span class="mh">0xab5879f7</span><span class="p">,</span>
	<span class="mh">0xb0925d8d</span><span class="p">,</span>
	<span class="mh">0xdfd079f7</span><span class="p">,</span>
	<span class="mh">0xb090e6bb</span><span class="p">,</span>
	<span class="mh">0xe5bbe74f</span><span class="p">,</span>
	<span class="mh">0x9e046f0f</span><span class="p">,</span>
	<span class="mh">0x6ffb76ce</span><span class="p">,</span>
	<span class="mh">0xee0cf9cf</span><span class="p">,</span>
	<span class="mh">0x2bfbefef</span><span class="p">,</span>
	<span class="mh">0xcfeef9cf</span><span class="p">,</span>
	<span class="mh">0x76cead23</span><span class="p">,</span>
	<span class="mh">0x90b3df99</span><span class="p">,</span>
	<span class="mh">0x7fddd0c1</span><span class="p">,</span>
	<span class="mh">0x4bf847fd</span><span class="p">,</span>
	<span class="mh">0x7ccf76ce</span><span class="p">,</span>
	<span class="mh">0xcfef77ca</span><span class="p">,</span>
	<span class="mh">0x7eaf7fad</span><span class="p">,</span>
	<span class="mh">0x7dfdf0b7</span><span class="p">,</span>
	<span class="mh">0xef7a7fca</span><span class="p">,</span>
	<span class="mh">0x77cafbc8</span><span class="p">,</span>
	<span class="mh">0x6079e722</span><span class="p">,</span>
	<span class="mh">0xfbc85fff</span><span class="p">,</span>
	<span class="mh">0xdfff5fb3</span><span class="p">,</span>
	<span class="mh">0xfffbfbc8</span><span class="p">,</span>
	<span class="mh">0xf3c894a5</span><span class="p">,</span>
	<span class="mh">0xe7c9edf9</span><span class="p">,</span>
	<span class="mh">0x7f9a7fad</span><span class="p">,</span>
	<span class="mh">0x5f36afe8</span><span class="p">,</span>
	<span class="mh">0x5f5bffdf</span><span class="p">,</span>
	<span class="mh">0xdf95cb9e</span><span class="p">,</span>
	<span class="mh">0xaf7d5fc3</span><span class="p">,</span>
	<span class="mh">0xafed8c1b</span><span class="p">,</span>
	<span class="mh">0x5fc3afdd</span><span class="p">,</span>
	<span class="mh">0x5fc5df99</span><span class="p">,</span>
	<span class="mh">0x7efdb0b3</span><span class="p">,</span>
	<span class="mh">0x5fb3fffe</span><span class="p">,</span>
	<span class="mh">0xabae5fb3</span><span class="p">,</span>
	<span class="mh">0xfffe5fd0</span><span class="p">,</span>
	<span class="mh">0x600be6bb</span><span class="p">,</span>
	<span class="mh">0x600b5fd0</span><span class="p">,</span>
	<span class="mh">0xdfc827fb</span><span class="p">,</span>
	<span class="mh">0xefdf5fca</span><span class="p">,</span>
	<span class="mh">0xcfde3a9c</span><span class="p">,</span>
	<span class="mh">0xe7c9edf9</span><span class="p">,</span>
	<span class="mh">0xf3c87f9e</span><span class="p">,</span>
	<span class="mh">0x54ca7fed</span><span class="p">,</span>
	<span class="mh">0x2d3a3637</span><span class="p">,</span>
	<span class="mh">0x756f7e9a</span><span class="p">,</span>
	<span class="mh">0xf1ce37ef</span><span class="p">,</span>
	<span class="mh">0x2e677fee</span><span class="p">,</span>
	<span class="mh">0x10ebadf8</span><span class="p">,</span>
	<span class="mh">0xefdecfea</span><span class="p">,</span>
	<span class="mh">0xe52f7d9f</span><span class="p">,</span>
	<span class="mh">0xe12bf1ce</span><span class="p">,</span>
	<span class="mh">0x5f647e9a</span><span class="p">,</span>
	<span class="mh">0x4df8cfea</span><span class="p">,</span>
	<span class="mh">0x5f717d9b</span><span class="p">,</span>
	<span class="mh">0xefeecfea</span><span class="p">,</span>
	<span class="mh">0x5f73e522</span><span class="p">,</span>
	<span class="mh">0xefde5f73</span><span class="p">,</span>
	<span class="mh">0xcfda0b61</span><span class="p">,</span>
	<span class="mh">0x5d8fdf61</span><span class="p">,</span>
	<span class="mh">0xe7c9edf9</span><span class="p">,</span>
	<span class="mh">0x7e9a30d5</span><span class="p">,</span>
	<span class="mh">0x1458bfff</span><span class="p">,</span>
	<span class="mh">0xf3c85fff</span><span class="p">,</span>
	<span class="mh">0xdfffa7f8</span><span class="p">,</span>
	<span class="mh">0x5f5bbffe</span><span class="p">,</span>
	<span class="mh">0x7f7d10d0</span><span class="p">,</span>
	<span class="mh">0x144d5f33</span><span class="p">,</span>
	<span class="mh">0xbfffaf78</span><span class="p">,</span>
	<span class="mh">0x5f5bbffd</span><span class="p">,</span>
	<span class="mh">0xa7f85f33</span><span class="p">,</span>
	<span class="mh">0xbffe77fd</span><span class="p">,</span>
	<span class="mh">0x30bd4e08</span><span class="p">,</span>
	<span class="mh">0xfdcfe5ff</span><span class="p">,</span>
	<span class="mh">0x6e0faff8</span><span class="p">,</span>
	<span class="mh">0x7eef7e9f</span><span class="p">,</span>
	<span class="mh">0xfdeff1cf</span><span class="p">,</span>
	<span class="mh">0x5f17abf8</span><span class="p">,</span>
	<span class="mh">0x0d5b5f5b</span><span class="p">,</span>
	<span class="mh">0xffef79f7</span><span class="p">,</span>
	<span class="mh">0x309eafdd</span><span class="p">,</span>
	<span class="mh">0x5f3147f8</span><span class="p">,</span>
	<span class="mh">0x5f31afed</span><span class="p">,</span>
	<span class="mh">0x7fdd50af</span><span class="p">,</span>
	<span class="mh">0x497847fd</span><span class="p">,</span>
	<span class="mh">0x7f9e7fed</span><span class="p">,</span>
	<span class="mh">0x7dfd70a9</span><span class="p">,</span>
	<span class="mh">0xef7e7ece</span><span class="p">,</span>
	<span class="mh">0x6ba07f9e</span><span class="p">,</span>
	<span class="mh">0x2d227efd</span><span class="p">,</span>
	<span class="mh">0x30db5f5b</span><span class="p">,</span>
	<span class="mh">0xfffd5f5b</span><span class="p">,</span>
	<span class="mh">0xffef5f5b</span><span class="p">,</span>
	<span class="mh">0xffdf0c9c</span><span class="p">,</span>
	<span class="mh">0xafed0a9a</span><span class="p">,</span>
	<span class="mh">0xafdd0c37</span><span class="p">,</span>
	<span class="mh">0x5f37afbd</span><span class="p">,</span>
	<span class="mh">0x7fbdb081</span><span class="p">,</span>
	<span class="mh">0x5f8147f8</span><span class="p">,</span>
	<span class="mh">0x3a11e710</span><span class="p">,</span>
	<span class="mh">0xedf0ccdd</span><span class="p">,</span>
	<span class="mh">0xf3186d0a</span><span class="p">,</span>
	<span class="mh">0x7f0e5f06</span><span class="p">,</span>
	<span class="mh">0x7fedbb38</span><span class="p">,</span>
	<span class="mh">0x3afe7468</span><span class="p">,</span>
	<span class="mh">0x7fedf4fc</span><span class="p">,</span>
	<span class="mh">0x8ffbb951</span><span class="p">,</span>
	<span class="mh">0xb85f77fd</span><span class="p">,</span>
	<span class="mh">0xb0df5ddd</span><span class="p">,</span>
	<span class="mh">0xdefe7fed</span><span class="p">,</span>
	<span class="mh">0x90e1e74d</span><span class="p">,</span>
	<span class="mh">0x6f0dcbf7</span><span class="p">,</span>
	<span class="mh">0xe7decfed</span><span class="p">,</span>
	<span class="mh">0xcb74cfed</span><span class="p">,</span>
	<span class="mh">0xcfeddf6d</span><span class="p">,</span>
	<span class="mh">0x91714f74</span><span class="p">,</span>
	<span class="mh">0x5dd2deef</span><span class="p">,</span>
	<span class="mh">0x9e04e7df</span><span class="p">,</span>
	<span class="mh">0xefbb6ffb</span><span class="p">,</span>
	<span class="mh">0xe7ef7f0e</span><span class="p">,</span>
	<span class="mh">0x9e097fed</span><span class="p">,</span>
	<span class="mh">0xebdbeffa</span><span class="p">,</span>
	<span class="mh">0xeb54affb</span><span class="p">,</span>
	<span class="mh">0x7fea90d7</span><span class="p">,</span>
	<span class="mh">0x7e0cf0c3</span><span class="p">,</span>
	<span class="mh">0xbffff318</span><span class="p">,</span>
	<span class="mh">0x5fffdfff</span><span class="p">,</span>
	<span class="mh">0xac59efea</span><span class="p">,</span>
	<span class="mh">0x7fce1ee5</span><span class="p">,</span>
	<span class="mh">0xe2ff5ee1</span><span class="p">,</span>
	<span class="mh">0xaffbe2ff</span><span class="p">,</span>
	<span class="mh">0x5ee3affb</span><span class="p">,</span>
	<span class="mh">0xf9cc7d0f</span><span class="p">,</span>
	<span class="mh">0xaef8770f</span><span class="p">,</span>
	<span class="mh">0x7d0fb0c6</span><span class="p">,</span>
	<span class="mh">0xeffbbfff</span><span class="p">,</span>
	<span class="mh">0xcfef5ede</span><span class="p">,</span>
	<span class="mh">0x7d0fbfff</span><span class="p">,</span>
	<span class="mh">0x5ede4cf8</span><span class="p">,</span>
	<span class="mh">0x7fddd0bf</span><span class="p">,</span>
	<span class="mh">0x49f847fd</span><span class="p">,</span>
	<span class="mh">0x7efdf0bb</span><span class="p">,</span>
	<span class="mh">0x7fedfffd</span><span class="p">,</span>
	<span class="mh">0x7dfdf0b7</span><span class="p">,</span>
	<span class="mh">0xef7e7e1e</span><span class="p">,</span>
	<span class="mh">0x5ede7f0e</span><span class="p">,</span>
	<span class="mh">0x3a11e710</span><span class="p">,</span>
	<span class="mh">0xedf0ccab</span><span class="p">,</span>
	<span class="mh">0xfb18ad2e</span><span class="p">,</span>
	<span class="mh">0x1ea9bbb8</span><span class="p">,</span>
	<span class="mh">0x74283b7e</span><span class="p">,</span>
	<span class="mh">0x73c2e4bb</span><span class="p">,</span>
	<span class="mh">0x2ada4fb8</span><span class="p">,</span>
	<span class="mh">0xdc21e4bb</span><span class="p">,</span>
	<span class="mh">0xb2a1ffbf</span><span class="p">,</span>
	<span class="mh">0x5e2c43f8</span><span class="p">,</span>
	<span class="mh">0xfc87e1bb</span><span class="p">,</span>
	<span class="mh">0xe74ffd91</span><span class="p">,</span>
	<span class="mh">0x6f0f4fe8</span><span class="p">,</span>
	<span class="mh">0xc7ba32e2</span><span class="p">,</span>
	<span class="mh">0xf396efeb</span><span class="p">,</span>
	<span class="mh">0x600b4f78</span><span class="p">,</span>
	<span class="mh">0xe5bb760b</span><span class="p">,</span>
	<span class="mh">0x53acaef8</span><span class="p">,</span>
	<span class="mh">0x4ef88b0e</span><span class="p">,</span>
	<span class="mh">0xcfef9e09</span><span class="p">,</span>
	<span class="mh">0xabf8751f</span><span class="p">,</span>
	<span class="mh">0xefef5bac</span><span class="p">,</span>
	<span class="mh">0x741f4fe8</span><span class="p">,</span>
	<span class="mh">0x751e760d</span><span class="p">,</span>
	<span class="mh">0x7fdbf081</span><span class="p">,</span>
	<span class="mh">0x741cafce</span><span class="p">,</span>
	<span class="mh">0xefcc7fce</span><span class="p">,</span>
	<span class="mh">0x751e70ac</span><span class="p">,</span>
	<span class="mh">0x741ce7bb</span><span class="p">,</span>
	<span class="mh">0x3372cfed</span><span class="p">,</span>
	<span class="mh">0xafdbefeb</span><span class="p">,</span>
	<span class="mh">0xe5bb760b</span><span class="p">,</span>
	<span class="mh">0x53f2aef8</span><span class="p">,</span>
	<span class="mh">0xafe8e7eb</span><span class="p">,</span>
	<span class="mh">0x4bf8771e</span><span class="p">,</span>
	<span class="mh">0x7e247fed</span><span class="p">,</span>
	<span class="mh">0x4fcbe2cc</span><span class="p">,</span>
	<span class="mh">0x7fbc30a9</span><span class="p">,</span>
	<span class="mh">0x7b0f7a0f</span><span class="p">,</span>
	<span class="mh">0x34d577fd</span><span class="p">,</span>
	<span class="mh">0x308b5db7</span><span class="p">,</span>
	<span class="mh">0xde553e5f</span><span class="p">,</span>
	<span class="mh">0xaf78741f</span><span class="p">,</span>
	<span class="mh">0x741f30f0</span><span class="p">,</span>
	<span class="mh">0xcfef5e2c</span><span class="p">,</span>
	<span class="mh">0x741f3eac</span><span class="p">,</span>
	<span class="mh">0xafb8771e</span><span class="p">,</span>
	<span class="mh">0x5e677fed</span><span class="p">,</span>
	<span class="mh">0x0bd3e2cc</span><span class="p">,</span>
	<span class="mh">0x741ccfec</span><span class="p">,</span>
	<span class="mh">0xe5ca53cd</span><span class="p">,</span>
	<span class="mh">0x6fcb4f74</span><span class="p">,</span>
	<span class="mh">0x5dadde4b</span><span class="p">,</span>
	<span class="mh">0x2ab63d38</span><span class="p">,</span>
	<span class="mh">0x4bb3de30</span><span class="p">,</span>
	<span class="mh">0x751f741c</span><span class="p">,</span>
	<span class="mh">0x6c42effa</span><span class="p">,</span>
	<span class="mh">0xefea7fce</span><span class="p">,</span>
	<span class="mh">0x6ffc30be</span><span class="p">,</span>
	<span class="mh">0xefec3fca</span><span class="p">,</span>
	<span class="mh">0x30b3de2e</span><span class="p">,</span>
	<span class="mh">0xadf85d9e</span><span class="p">,</span>
	<span class="mh">0xaf7daefd</span><span class="p">,</span>
	<span class="mh">0x5d9ede2e</span><span class="p">,</span>
	<span class="mh">0x5d9eafdd</span><span class="p">,</span>
	<span class="mh">0x761f10ac</span><span class="p">,</span>
	<span class="mh">0x1da07efd</span><span class="p">,</span>
	<span class="mh">0x30adfffe</span><span class="p">,</span>
	<span class="mh">0x4908fb18</span><span class="p">,</span>
	<span class="mh">0x5fffdfff</span><span class="p">,</span>
	<span class="mh">0xafbb709b</span><span class="p">,</span>
	<span class="mh">0x4ef85e67</span><span class="p">,</span>
	<span class="mh">0xadf814ad</span><span class="p">,</span>
	<span class="mh">0x7a0f70ad</span><span class="p">,</span>
	<span class="mh">0xcfef50ad</span><span class="p">,</span>
	<span class="mh">0x7a0fde30</span><span class="p">,</span>
	<span class="mh">0x5da0afed</span><span class="p">,</span>
	<span class="mh">0x3c12780f</span><span class="p">,</span>
	<span class="mh">0xefef780f</span><span class="p">,</span>
	<span class="mh">0xefef790f</span><span class="p">,</span>
	<span class="mh">0xa7f85e0f</span><span class="p">,</span>
	<span class="mh">0xffef790f</span><span class="p">,</span>
	<span class="mh">0xefef790f</span><span class="p">,</span>
	<span class="mh">0x14adde2e</span><span class="p">,</span>
	<span class="mh">0x5d9eadfd</span><span class="p">,</span>
	<span class="mh">0x5e2dfffb</span><span class="p">,</span>
	<span class="mh">0xe79addfd</span><span class="p">,</span>
	<span class="mh">0xeff96079</span><span class="p">,</span>
	<span class="mh">0x607ae79a</span><span class="p">,</span>
	<span class="mh">0xddfceff9</span><span class="p">,</span>
	<span class="mh">0x60795dff</span><span class="p">,</span>
	<span class="mh">0x607acfef</span><span class="p">,</span>
	<span class="mh">0xefefefdf</span><span class="p">,</span>
	<span class="mh">0xefbfef7f</span><span class="p">,</span>
	<span class="mh">0xeeffedff</span><span class="p">,</span>
	<span class="mh">0xebffe7ff</span><span class="p">,</span>
	<span class="mh">0xafefafdf</span><span class="p">,</span>
	<span class="mh">0xafbfaf7f</span><span class="p">,</span>
	<span class="mh">0xaeffadff</span><span class="p">,</span>
	<span class="mh">0xabffa7ff</span><span class="p">,</span>
	<span class="mh">0x6fef6fdf</span><span class="p">,</span>
	<span class="mh">0x6fbf6f7f</span><span class="p">,</span>
	<span class="mh">0x6eff6dff</span><span class="p">,</span>
	<span class="mh">0x6bff67ff</span><span class="p">,</span>
	<span class="mh">0x2fef2fdf</span><span class="p">,</span>
	<span class="mh">0x2fbf2f7f</span><span class="p">,</span>
	<span class="mh">0x2eff2dff</span><span class="p">,</span>
	<span class="mh">0x2bff27ff</span><span class="p">,</span>
	<span class="mh">0x4e08fd1f</span><span class="p">,</span>
	<span class="mh">0xe5ff6e0f</span><span class="p">,</span>
	<span class="mh">0xaff87eef</span><span class="p">,</span>
	<span class="mh">0x7e0ffdef</span><span class="p">,</span>
	<span class="mh">0xf11f6079</span><span class="p">,</span>
	<span class="mh">0xabf8f542</span><span class="p">,</span>
	<span class="mh">0x7e0af11c</span><span class="p">,</span>
	<span class="mh">0x37cfae3a</span><span class="p">,</span>
	<span class="mh">0x7fec90be</span><span class="p">,</span>
	<span class="mh">0xadf8efdc</span><span class="p">,</span>
	<span class="mh">0xcfeae52f</span><span class="p">,</span>
	<span class="mh">0x7d0fe12b</span><span class="p">,</span>
	<span class="mh">0xf11c6079</span><span class="p">,</span>
	<span class="mh">0x7e0a4df8</span><span class="p">,</span>
	<span class="mh">0xcfea5dc4</span><span class="p">,</span>
	<span class="mh">0x7d0befec</span><span class="p">,</span>
	<span class="mh">0xcfea5dc6</span><span class="p">,</span>
	<span class="mh">0xe522efdc</span><span class="p">,</span>
	<span class="mh">0x5dc6cfda</span><span class="p">,</span>
	<span class="mh">0x4e08fd1f</span><span class="p">,</span>
	<span class="mh">0x6e0faff8</span><span class="p">,</span>
	<span class="mh">0x7c1f761f</span><span class="p">,</span>
	<span class="mh">0xfdeff91f</span><span class="p">,</span>
	<span class="mh">0x6079abf8</span><span class="p">,</span>
	<span class="mh">0x761cee24</span><span class="p">,</span>
	<span class="mh">0xf91f2bfb</span><span class="p">,</span>
	<span class="mh">0xefefcfec</span><span class="p">,</span>
	<span class="mh">0xf91f6079</span><span class="p">,</span>
	<span class="mh">0x761c27fb</span><span class="p">,</span>
	<span class="mh">0xefdf5da7</span><span class="p">,</span>
	<span class="mh">0xcfdc7fdd</span><span class="p">,</span>
	<span class="mh">0xd09c4bf8</span><span class="p">,</span>
	<span class="mh">0x47fd7c1f</span><span class="p">,</span>
	<span class="mh">0x761ccfcf</span><span class="p">,</span>
	<span class="mh">0x7eef7fed</span><span class="p">,</span>
	<span class="mh">0x7dfdf093</span><span class="p">,</span>
	<span class="mh">0xef7e7f1e</span><span class="p">,</span>
	<span class="mh">0x771efb18</span><span class="p">,</span>
	<span class="mh">0x6079e722</span><span class="p">,</span>
	<span class="mh">0xe6bbe5bb</span><span class="p">,</span>
	<span class="mh">0xae0ae5bb</span><span class="p">,</span>
	<span class="mh">0x600bae85</span><span class="p">,</span>
	<span class="mh">0xe2bbe2bb</span><span class="p">,</span>
	<span class="mh">0xe2bbe2bb</span><span class="p">,</span>
	<span class="mh">0xaf02e2bb</span><span class="p">,</span>
	<span class="mh">0xe2bb2ff9</span><span class="p">,</span>
	<span class="mh">0x6079e2bb</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">uint</span> <span class="n">patch_2f00</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x30303030</span><span class="p">,</span>
	<span class="mh">0x3e3e3434</span><span class="p">,</span>
	<span class="mh">0xabbf9b99</span><span class="p">,</span>
	<span class="mh">0x4b4fbdbd</span><span class="p">,</span>
	<span class="mh">0x59949334</span><span class="p">,</span>
	<span class="mh">0x9fff37fb</span><span class="p">,</span>
	<span class="mh">0x9b177dd9</span><span class="p">,</span>
	<span class="mh">0x936956bb</span><span class="p">,</span>
	<span class="mh">0xfbdd697b</span><span class="p">,</span>
	<span class="mh">0xdd2fd113</span><span class="p">,</span>
	<span class="mh">0x1db9f7bb</span><span class="p">,</span>
	<span class="mh">0x36313963</span><span class="p">,</span>
	<span class="mh">0x79373369</span><span class="p">,</span>
	<span class="mh">0x3193137f</span><span class="p">,</span>
	<span class="mh">0x7331737a</span><span class="p">,</span>
	<span class="mh">0xf7bb9b99</span><span class="p">,</span>
	<span class="mh">0x9bb19795</span><span class="p">,</span>
	<span class="mh">0x77fdfd3d</span><span class="p">,</span>
	<span class="mh">0x573b773f</span><span class="p">,</span>
	<span class="mh">0x737933f7</span><span class="p">,</span>
	<span class="mh">0xb991d115</span><span class="p">,</span>
	<span class="mh">0x31699315</span><span class="p">,</span>
	<span class="mh">0x31531694</span><span class="p">,</span>
	<span class="mh">0xbf4fbdbd</span><span class="p">,</span>
	<span class="mh">0x35931497</span><span class="p">,</span>
	<span class="mh">0x35376956</span><span class="p">,</span>
	<span class="mh">0xbd697b9d</span><span class="p">,</span>
	<span class="mh">0x96931313</span><span class="p">,</span>
	<span class="mh">0x19797937</span><span class="p">,</span>
	<span class="mh">0x6935af78</span><span class="p">,</span>
	<span class="mh">0xb9b3baa3</span><span class="p">,</span>
	<span class="mh">0xb8788683</span><span class="p">,</span>
	<span class="mh">0x368f78f7</span><span class="p">,</span>
	<span class="mh">0x87778733</span><span class="p">,</span>
	<span class="mh">0x3ffffb3b</span><span class="p">,</span>
	<span class="mh">0x8e8f78b8</span><span class="p">,</span>
	<span class="mh">0x1d118e13</span><span class="p">,</span>
	<span class="mh">0xf3ff3f8b</span><span class="p">,</span>
	<span class="mh">0x6bd8e173</span><span class="p">,</span>
	<span class="mh">0xd1366856</span><span class="p">,</span>
	<span class="mh">0x68d1687b</span><span class="p">,</span>
	<span class="mh">0x3daf78b8</span><span class="p">,</span>
	<span class="mh">0x3a3a3f87</span><span class="p">,</span>
	<span class="mh">0x8f81378f</span><span class="p">,</span>
	<span class="mh">0xf876f887</span><span class="p">,</span>
	<span class="mh">0x77fd8778</span><span class="p">,</span>
	<span class="mh">0x737de8d6</span><span class="p">,</span>
	<span class="mh">0xbbf8bfff</span><span class="p">,</span>
	<span class="mh">0xd8df87f7</span><span class="p">,</span>
	<span class="mh">0xfd876f7b</span><span class="p">,</span>
	<span class="mh">0x8bfff8bd</span><span class="p">,</span>
	<span class="mh">0x8683387d</span><span class="p">,</span>
	<span class="mh">0xb873d87b</span><span class="p">,</span>
	<span class="mh">0x3b8fd7f8</span><span class="p">,</span>
	<span class="mh">0xf7338883</span><span class="p">,</span>
	<span class="mh">0xbb8ee1f8</span><span class="p">,</span>
	<span class="mh">0xef837377</span><span class="p">,</span>
	<span class="mh">0x3337b836</span><span class="p">,</span>
	<span class="mh">0x817d11f8</span><span class="p">,</span>
	<span class="mh">0x7378b878</span><span class="p">,</span>
	<span class="mh">0xd3368b7d</span><span class="p">,</span>
	<span class="mh">0xed731b7d</span><span class="p">,</span>
	<span class="mh">0x833731f3</span><span class="p">,</span>
	<span class="mh">0xf22f3f23</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">uint</span> <span class="n">patch_2e00</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x27eeeeee</span><span class="p">,</span>
	<span class="mh">0xeeeeeeee</span><span class="p">,</span>
	<span class="mh">0xeeeeeeee</span><span class="p">,</span>
	<span class="mh">0xeeeeeeee</span><span class="p">,</span>
	<span class="mh">0xee4bf4fb</span><span class="p">,</span>
	<span class="mh">0xdbd259bb</span><span class="p">,</span>
	<span class="mh">0x1979577f</span><span class="p">,</span>
	<span class="mh">0xdfd2d573</span><span class="p">,</span>
	<span class="mh">0xb773f737</span><span class="p">,</span>
	<span class="mh">0x4b4fbdbd</span><span class="p">,</span>
	<span class="mh">0x25b9b177</span><span class="p">,</span>
	<span class="mh">0xd2d17376</span><span class="p">,</span>
	<span class="mh">0x956bbfdd</span><span class="p">,</span>
	<span class="mh">0x697bdd2f</span><span class="p">,</span>
	<span class="mh">0xff9f79ff</span><span class="p">,</span>
	<span class="mh">0xff9ff22f</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> *  USB SOF patch arrays.</span>
<span class="cm"> */</span>

<span class="cp">#ifdef CONFIG_USB_SOF_UCODE_PATCH</span>

<span class="k">static</span> <span class="n">uint</span> <span class="n">patch_2000</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x7fff0000</span><span class="p">,</span>
	<span class="mh">0x7ffd0000</span><span class="p">,</span>
	<span class="mh">0x7ffb0000</span><span class="p">,</span>
	<span class="mh">0x49f7ba5b</span><span class="p">,</span>
	<span class="mh">0xba383ffb</span><span class="p">,</span>
	<span class="mh">0xf9b8b46d</span><span class="p">,</span>
	<span class="mh">0xe5ab4e07</span><span class="p">,</span>
	<span class="mh">0xaf77bffe</span><span class="p">,</span>
	<span class="mh">0x3f7bbf79</span><span class="p">,</span>
	<span class="mh">0xba5bba38</span><span class="p">,</span>
	<span class="mh">0xe7676076</span><span class="p">,</span>
	<span class="mh">0x60750000</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">uint</span> <span class="n">patch_2f00</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x3030304c</span><span class="p">,</span>
	<span class="mh">0xcab9e441</span><span class="p">,</span>
	<span class="mh">0xa1aaf220</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">cpm_load_patch</span><span class="p">(</span><span class="n">cpm8xx_t</span> <span class="o">*</span><span class="n">cp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">volatile</span> <span class="n">uint</span>		<span class="o">*</span><span class="n">dp</span><span class="p">;</span>		<span class="cm">/* Dual-ported RAM. */</span>
	<span class="k">volatile</span> <span class="n">cpm8xx_t</span>	<span class="o">*</span><span class="n">commproc</span><span class="p">;</span>
<span class="cp">#if defined(CONFIG_I2C_SPI_UCODE_PATCH) || \</span>
<span class="cp">    defined(CONFIG_I2C_SPI_SMC1_UCODE_PATCH)</span>
	<span class="k">volatile</span> <span class="n">iic_t</span>		<span class="o">*</span><span class="n">iip</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="k">struct</span> <span class="n">spi_pram</span> <span class="o">*</span><span class="n">spp</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_I2C_SPI_SMC1_UCODE_PATCH</span>
	<span class="k">volatile</span> <span class="n">smc_uart_t</span>	<span class="o">*</span><span class="n">smp</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>
	<span class="kt">int</span>	<span class="n">i</span><span class="p">;</span>

	<span class="n">commproc</span> <span class="o">=</span> <span class="n">cp</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_USB_SOF_UCODE_PATCH</span>
	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_rccr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">dp</span> <span class="o">=</span> <span class="p">(</span><span class="n">uint</span> <span class="o">*</span><span class="p">)(</span><span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_dpmem</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">patch_2000</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="n">patch_2000</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

	<span class="n">dp</span> <span class="o">=</span> <span class="p">(</span><span class="n">uint</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_dpmem</span><span class="p">[</span><span class="mh">0x0f00</span><span class="p">]);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">patch_2f00</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="n">patch_2f00</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_rccr</span> <span class="o">=</span> <span class="mh">0x0009</span><span class="p">;</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;USB SOF microcode patch installed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_USB_SOF_UCODE_PATCH */</span><span class="cp"></span>

<span class="cp">#if defined(CONFIG_I2C_SPI_UCODE_PATCH) || \</span>
<span class="cp">    defined(CONFIG_I2C_SPI_SMC1_UCODE_PATCH)</span>

	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_rccr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">dp</span> <span class="o">=</span> <span class="p">(</span><span class="n">uint</span> <span class="o">*</span><span class="p">)(</span><span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_dpmem</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">patch_2000</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="n">patch_2000</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

	<span class="n">dp</span> <span class="o">=</span> <span class="p">(</span><span class="n">uint</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_dpmem</span><span class="p">[</span><span class="mh">0x0f00</span><span class="p">]);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">patch_2f00</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="n">patch_2f00</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

	<span class="n">iip</span> <span class="o">=</span> <span class="p">(</span><span class="n">iic_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_dparam</span><span class="p">[</span><span class="n">PROFF_IIC</span><span class="p">];</span>
<span class="cp"># define RPBASE 0x0500</span>
	<span class="n">iip</span><span class="o">-&gt;</span><span class="n">iic_rpbase</span> <span class="o">=</span> <span class="n">RPBASE</span><span class="p">;</span>

	<span class="cm">/* Put SPI above the IIC, also 32-byte aligned.</span>
<span class="cm">	*/</span>
	<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">RPBASE</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">iic_t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">31</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">31</span><span class="p">;</span>
	<span class="n">spp</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">spi_pram</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_dparam</span><span class="p">[</span><span class="n">PROFF_SPI</span><span class="p">];</span>
	<span class="n">spp</span><span class="o">-&gt;</span><span class="n">rpbase</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>

<span class="cp"># if defined(CONFIG_I2C_SPI_UCODE_PATCH)</span>
	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_cpmcr1</span> <span class="o">=</span> <span class="mh">0x802a</span><span class="p">;</span>
	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_cpmcr2</span> <span class="o">=</span> <span class="mh">0x8028</span><span class="p">;</span>
	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_cpmcr3</span> <span class="o">=</span> <span class="mh">0x802e</span><span class="p">;</span>
	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_cpmcr4</span> <span class="o">=</span> <span class="mh">0x802c</span><span class="p">;</span>
	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_rccr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;I2C/SPI microcode patch installed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="cp"># endif </span><span class="cm">/* CONFIG_I2C_SPI_UCODE_PATCH */</span><span class="cp"></span>

<span class="cp"># if defined(CONFIG_I2C_SPI_SMC1_UCODE_PATCH)</span>

	<span class="n">dp</span> <span class="o">=</span> <span class="p">(</span><span class="n">uint</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_dpmem</span><span class="p">[</span><span class="mh">0x0e00</span><span class="p">]);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">patch_2e00</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="n">patch_2e00</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_cpmcr1</span> <span class="o">=</span> <span class="mh">0x8080</span><span class="p">;</span>
	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_cpmcr2</span> <span class="o">=</span> <span class="mh">0x808a</span><span class="p">;</span>
	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_cpmcr3</span> <span class="o">=</span> <span class="mh">0x8028</span><span class="p">;</span>
	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_cpmcr4</span> <span class="o">=</span> <span class="mh">0x802a</span><span class="p">;</span>
	<span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_rccr</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

	<span class="n">smp</span> <span class="o">=</span> <span class="p">(</span><span class="n">smc_uart_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">commproc</span><span class="o">-&gt;</span><span class="n">cp_dparam</span><span class="p">[</span><span class="n">PROFF_SMC1</span><span class="p">];</span>
	<span class="n">smp</span><span class="o">-&gt;</span><span class="n">smc_rpbase</span> <span class="o">=</span> <span class="mh">0x1FC0</span><span class="p">;</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;I2C/SPI/SMC1 microcode patch installed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="cp"># endif </span><span class="cm">/* CONFIG_I2C_SPI_SMC1_UCODE_PATCH) */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* some variation of the I2C/SPI patch was selected */</span><span class="cp"></span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> *  Take this entire routine out, since no one calls it and its</span>
<span class="cm"> * logic is suspect.</span>
<span class="cm"> */</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">void</span>
<span class="c">verify_patch(volatile immap_t *immr)</span>
<span class="c">{</span>
<span class="c">	volatile uint		*dp;</span>
<span class="c">	volatile cpm8xx_t	*commproc;</span>
<span class="c">	int i;</span>

<span class="c">	commproc = (cpm8xx_t *)&amp;immr-&gt;im_cpm;</span>

<span class="c">	printk(&quot;cp_rccr %x\n&quot;, commproc-&gt;cp_rccr);</span>
<span class="c">	commproc-&gt;cp_rccr = 0;</span>

<span class="c">	dp = (uint *)(commproc-&gt;cp_dpmem);</span>
<span class="c">	for (i=0; i&lt;(sizeof(patch_2000)/4); i++)</span>
<span class="c">		if (*dp++ != patch_2000[i]) {</span>
<span class="c">			printk(&quot;patch_2000 bad at %d\n&quot;, i);</span>
<span class="c">			dp--;</span>
<span class="c">			printk(&quot;found 0x%X, wanted 0x%X\n&quot;, *dp, patch_2000[i]);</span>
<span class="c">			break;</span>
<span class="c">		}</span>

<span class="c">	dp = (uint *)&amp;(commproc-&gt;cp_dpmem[0x0f00]);</span>
<span class="c">	for (i=0; i&lt;(sizeof(patch_2f00)/4); i++)</span>
<span class="c">		if (*dp++ != patch_2f00[i]) {</span>
<span class="c">			printk(&quot;patch_2f00 bad at %d\n&quot;, i);</span>
<span class="c">			dp--;</span>
<span class="c">			printk(&quot;found 0x%X, wanted 0x%X\n&quot;, *dp, patch_2f00[i]);</span>
<span class="c">			break;</span>
<span class="c">		}</span>

<span class="c">	commproc-&gt;cp_rccr = 0x0009;</span>
<span class="c">}</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
