d | kernel |  | 136 items |  | Steven Rostedt | rostedt@goodmis.org | 1340944536 |  | powerpc/ftrace: Do not trace restore_interrupts()  As I was adding code that affects all archs, I started testing function tracer against PPC64 and found that it currently locks up with 3.4 kernel. I figured it was due to tracing a function that shouldn't be, so I went through the following process to bisect to find the culprit:   cat /debug/tracing/available_filter_functions > t  num=`wc -l t`  sed -ne "1,${num}p" t > t1  let num=num+1  sed -ne "${num},$p" t > t2  cat t1 > /debug/tracing/set_ftrace_filter  echo function /debug/tracing/current_tracer  <failed? bisect t1, if not bisect t2>  It finally came down to this function: restore_interrupts()  I'm not sure why this locks up the system. It just seems to prevent scheduling from occurring. Interrupts seem to still work, as I can ping the box. But all user processes freeze.  When restore_interrupts() is not traced, function tracing works fine.  Cc: stable@kernel.org Signed-off-by: Steven Rostedt <rostedt@goodmis.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
d | platforms |  | 25 items |  | Michael Neuling | mikey@neuling.org | 1340944537 |  | powerpc/pseries: Fix software invalidate TCE  The following added support for powernv but broke pseries/BML:  1f1616e powerpc/powernv: Add TCE SW invalidation support  TCE_PCI_SW_INVAL was split into FREE and CREATE flags but the tests in the pseries code were not updated to reflect this.  Signed-off-by: Michael Neuling <mikey@neuling.org> cc: stable@kernel.org [v3.3+] Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | Makefile | g | 8.4K |  | Kent Yoder | key@linux.vnet.ibm.com | 1337144745 |  | powerpc/crypto: Build files for the nx device driver  These files support configuring and building the nx device driver.  Signed-off-by: Kent Yoder <key@linux.vnet.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
d | net |  | 4 items |  | Michael Ellerman | michael@ellerman.id.au | 1340944534 |  | powerpc: Fix BPF_JIT code to link with multiple TOCs  If the kernel is big enough (eg. allyesconfig), the linker may need to switch TOCs when calling from the BPF JIT code out to the external helpers (skb_copy_bits() & bpf_internal_load_pointer_neg_helper()).  In order to do that we need to leave space after the bl for the linker to insert a reload of our TOC pointer.  Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Acked-by: Matt Evans <matt@ozlabs.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
d | include |  | 1 items |  | Anton Blanchard | anton@samba.org | 1340944537 |  | powerpc: check_and_cede_processor() never cedes  Commit f948501b36c6 ("Make hard_irq_disable() actually hard-disable interrupts") caused check_and_cede_processor to stop working. ->irq_happened will never be zero right after a hard_irq_disable so the compiler removes the call to cede_processor completely.  The bug was introduced back in the lazy interrupt handling rework of 3.4 but was hidden until recently because hard_irq_disable did nothing.  This issue will eventually appear in 3.4 stable since the hard_irq_disable fix is marked stable, so mark this one for stable too.  Signed-off-by: Anton Blanchard <anton@samba.org> Cc: stable@vger.kernel.org Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
d | boot |  | 120 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1338060147 |  | 
f | Kconfig.debug | g | 10K |  | Grant Likely | grant.likely@secretlab.ca | 1333053062 |  | irqdomain: Remove powerpc dependency from debugfs file  The debugfs code is really generic for all platforms.  This patch removes the powerpc-specific directory reference and makes it available to all architectures.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | relocs_check.pl | s | 1.6K | 52 | Suzuki Poulose | suzuki@in.ibm.com | 1324394468 |  | powerpc: Process dynamic relocations for kernel  The following patch implements the dynamic relocation processing for PPC32 kernel. relocate() accepts the target virtual address and relocates  the kernel image to the same.  Currently the following relocation types are handled :  	R_PPC_RELATIVE 	R_PPC_ADDR16_LO 	R_PPC_ADDR16_HI 	R_PPC_ADDR16_HA  The last 3 relocations in the above list depends on value of Symbol indexed whose index is encoded in the Relocation entry. Hence we need the Symbol Table for processing such relocations.  Note: The GNU ld for ppc32 produces buggy relocations for relocation types that depend on symbols. The value of the symbols with STB_LOCAL scope should be assumed to be zero. - Alan Modra  Signed-off-by: Suzuki K. Poulose <suzuki@in.ibm.com> Signed-off-by: Josh Poimboeuf <jpoimboe@linux.vnet.ibm.com> Cc: Paul Mackerras <paulus@samba.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Alan Modra <amodra@au1.ibm.com> Cc: Kumar Gala <galak@kernel.crashing.org> Cc: linuxppc-dev <linuxppc-dev@lists.ozlabs.org> Signed-off-by: Josh Boyer <jwboyer@gmail.com>
d | lib |  | 25 items |  | Paul Mackerras | paulus@samba.org | 1338177607 |  | powerpc: Use the new generic strncpy_from_user() and strnlen_user()  This is much the same as for SPARC except that we can do the find_zero() function more efficiently using the count-leading-zeroes instructions. Tested on 32-bit and 64-bit PowerPC.  Signed-off-by: Paul Mackerras <paulus@samba.org> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
d | mm |  | 41 items |  | Michael Neuling | mikey@neuling.org | 1340944535 |  | powerpc: Fix uninitialised error in numa.c  chroma_defconfig currently gives me this with gcc 4.6:   arch/powerpc/mm/numa.c:638:13: error: 'dm' may be used uninitialized in this function [-Werror=uninitialized]  It's a bogus warning/error since of_get_drconf_memory() only writes it anyway.  Signed-off-by: Michael Neuling <mikey@neuling.org> cc: <stable@kernel.org> [v3.3+] Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
d | oprofile |  | 10 items |  | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
d | math-emu |  | 45 items |  | Liu Yu | yu.liu@freescale.com | 1317962207 |  | powerpc/math_emu/efp: Look for errata handler when type mismatches  We already have cpu a005 errata handler when instruction cannot be recognized.  Before we lookup the inst, there's type checking, and we also need to handle it in errata handler when the type checking failed.  Signed-off-by: Liu Yu <yu.liu@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
d | kvm |  | 46 items |  | Michael Neuling | mikey@neuling.org | 1341203412 |  | powerpc/kvm: sldi should be sld  Since we are taking a registers, this should never have been an sldi. Talking to paulus offline, this is the correct fix.  Was introduced by:  commit 19ccb76a1938ab364a412253daec64613acbf3df  Author: Paul Mackerras <paulus@samba.org>  Date:   Sat Jul 23 17:42:46 2011 +1000  Talking to paulus, this shouldn't be a literal.  Signed-off-by: Michael Neuling <mikey@neuling.org> CC: <stable@kernel.org> [v3.2+] Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
d | sysdev |  | 73 items |  | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1336618704 |  | Merge remote-tracking branch 'jwb/next' into next  Josh writes: << A few patches from Suzie for 47x kexec/kdump support, and some MSI patches from Mai La. >>
f | Kconfig | g | 25K |  | Paul Mackerras | paulus@samba.org | 1338177607 |  | powerpc: Use the new generic strncpy_from_user() and strnlen_user()  This is much the same as for SPARC except that we can do the find_zero() function more efficiently using the count-leading-zeroes instructions. Tested on 32-bit and 64-bit PowerPC.  Signed-off-by: Paul Mackerras <paulus@samba.org> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
d | perf |  | 12 items |  | Robert Richter | robert.richter@amd.com | 1336569792 |  | perf: Pass last sampling period to perf_sample_data_init()  We always need to pass the last sample period to perf_sample_data_init(), otherwise the event distribution will be wrong. Thus, modifiyng the function interface with the required period as argument. So basically a pattern like this:          perf_sample_data_init(&data, ~0ULL);         data.period = event->hw.last_period;  will now be like that:          perf_sample_data_init(&data, ~0ULL, event->hw.last_period);  Avoids unininitialized data.period and simplifies code.  Signed-off-by: Robert Richter <robert.richter@amd.com> Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Link: http://lkml.kernel.org/r/1333390758-10893-3-git-send-email-robert.richter@amd.com Signed-off-by: Ingo Molnar <mingo@kernel.org>
d | configs |  | 47 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1337803543 |  | 
d | xmon |  | 14 items |  | Anton Blanchard | anton@samba.org | 1341203411 |  | powerpc/xmon: Use cpumask iterator to avoid warning  We have a bug report where the kernel hits a warning in the cpumask code:  WARNING: at include/linux/cpumask.h:107  Which is:         WARN_ON_ONCE(cpu >= nr_cpumask_bits);  The backtrace is:         cpu_cmd         cmds         xmon_core         xmon         die  xmon is iterating through 0 to NR_CPUS. I'm not sure why we are still open coding this but iterating above nr_cpu_ids is definitely a bug.  This patch iterates through all possible cpus, in case we issue a system reset and CPUs in an offline state call in.  Perhaps the old code was trying to handle CPUs that were in the partition but were never started (eg kexec into a kernel with an nr_cpus= boot option). They are going to die way before we get into xmon since we haven't set any kernel state up for them.  Signed-off-by: Anton Blanchard <anton@samba.org> CC: <stable@kernel.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
