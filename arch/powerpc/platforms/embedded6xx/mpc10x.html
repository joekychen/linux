<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › platforms › embedded6xx › mpc10x.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>mpc10x.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Common routines for the Motorola SPS MPC106/8240/107 Host bridge/Mem</span>
<span class="cm"> * ctlr/EPIC/etc.</span>
<span class="cm"> *</span>
<span class="cm"> * Author: Mark A. Greer</span>
<span class="cm"> *         mgreer@mvista.com</span>
<span class="cm"> *</span>
<span class="cm"> * 2001 (c) MontaVista, Software, Inc.  This file is licensed under</span>
<span class="cm"> * the terms of the GNU General Public License version 2.  This program</span>
<span class="cm"> * is licensed &quot;as is&quot; without any warranty of any kind, whether express</span>
<span class="cm"> * or implied.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __PPC_KERNEL_MPC10X_H</span>
<span class="cp">#define __PPC_KERNEL_MPC10X_H</span>

<span class="cp">#include &lt;linux/pci_ids.h&gt;</span>
<span class="cp">#include &lt;asm/pci-bridge.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * The values here don&#39;t completely map everything but should work in most</span>
<span class="cm"> * cases.</span>
<span class="cm"> *</span>
<span class="cm"> * MAP A (PReP Map)</span>
<span class="cm"> *   Processor: 0x80000000 - 0x807fffff -&gt; PCI I/O: 0x00000000 - 0x007fffff</span>
<span class="cm"> *   Processor: 0xc0000000 - 0xdfffffff -&gt; PCI MEM: 0x00000000 - 0x1fffffff</span>
<span class="cm"> *   PCI MEM:   0x80000000 -&gt; Processor System Memory: 0x00000000</span>
<span class="cm"> *   EUMB mapped to: ioremap_base - 0x00100000 (ioremap_base - 1 MB)</span>
<span class="cm"> *</span>
<span class="cm"> * MAP B (CHRP Map)</span>
<span class="cm"> *   Processor: 0xfe000000 - 0xfebfffff -&gt; PCI I/O: 0x00000000 - 0x00bfffff</span>
<span class="cm"> *   Processor: 0x80000000 - 0xbfffffff -&gt; PCI MEM: 0x80000000 - 0xbfffffff</span>
<span class="cm"> *   PCI MEM:   0x00000000 -&gt; Processor System Memory: 0x00000000</span>
<span class="cm"> *   EUMB mapped to: ioremap_base - 0x00100000 (ioremap_base - 1 MB)</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Define the vendor/device IDs for the various bridges--should be added to</span>
<span class="cm"> * &lt;linux/pci_ids.h&gt;</span>
<span class="cm"> */</span>
<span class="cp">#define	MPC10X_BRIDGE_106	((PCI_DEVICE_ID_MOTOROLA_MPC106 &lt;&lt; 16) |  \</span>
<span class="cp">				  PCI_VENDOR_ID_MOTOROLA)</span>
<span class="cp">#define	MPC10X_BRIDGE_8240	((0x0003 &lt;&lt; 16) | PCI_VENDOR_ID_MOTOROLA)</span>
<span class="cp">#define	MPC10X_BRIDGE_107	((0x0004 &lt;&lt; 16) | PCI_VENDOR_ID_MOTOROLA)</span>
<span class="cp">#define	MPC10X_BRIDGE_8245	((0x0006 &lt;&lt; 16) | PCI_VENDOR_ID_MOTOROLA)</span>

<span class="cm">/* Define the type of map to use */</span>
<span class="cp">#define	MPC10X_MEM_MAP_A		1</span>
<span class="cp">#define	MPC10X_MEM_MAP_B		2</span>

<span class="cm">/* Map A (PReP Map) Defines */</span>
<span class="cp">#define	MPC10X_MAPA_CNFG_ADDR		0x80000cf8</span>
<span class="cp">#define	MPC10X_MAPA_CNFG_DATA		0x80000cfc</span>

<span class="cp">#define MPC10X_MAPA_ISA_IO_BASE		0x80000000</span>
<span class="cp">#define MPC10X_MAPA_ISA_MEM_BASE	0xc0000000</span>
<span class="cp">#define	MPC10X_MAPA_DRAM_OFFSET		0x80000000</span>

<span class="cp">#define	MPC10X_MAPA_PCI_INTACK_ADDR	0xbffffff0</span>
<span class="cp">#define	MPC10X_MAPA_PCI_IO_START	0x00000000</span>
<span class="cp">#define	MPC10X_MAPA_PCI_IO_END	       (0x00800000 - 1)</span>
<span class="cp">#define	MPC10X_MAPA_PCI_MEM_START	0x00000000</span>
<span class="cp">#define	MPC10X_MAPA_PCI_MEM_END	       (0x20000000 - 1)</span>

<span class="cp">#define	MPC10X_MAPA_PCI_MEM_OFFSET	(MPC10X_MAPA_ISA_MEM_BASE -	\</span>
<span class="cp">					 MPC10X_MAPA_PCI_MEM_START)</span>

<span class="cm">/* Map B (CHRP Map) Defines */</span>
<span class="cp">#define	MPC10X_MAPB_CNFG_ADDR		0xfec00000</span>
<span class="cp">#define	MPC10X_MAPB_CNFG_DATA		0xfee00000</span>

<span class="cp">#define MPC10X_MAPB_ISA_IO_BASE		0xfe000000</span>
<span class="cp">#define MPC10X_MAPB_ISA_MEM_BASE	0x80000000</span>
<span class="cp">#define	MPC10X_MAPB_DRAM_OFFSET		0x00000000</span>

<span class="cp">#define	MPC10X_MAPB_PCI_INTACK_ADDR	0xfef00000</span>
<span class="cp">#define	MPC10X_MAPB_PCI_IO_START	0x00000000</span>
<span class="cp">#define	MPC10X_MAPB_PCI_IO_END	       (0x00c00000 - 1)</span>
<span class="cp">#define	MPC10X_MAPB_PCI_MEM_START	0x80000000</span>
<span class="cp">#define	MPC10X_MAPB_PCI_MEM_END	       (0xc0000000 - 1)</span>

<span class="cp">#define	MPC10X_MAPB_PCI_MEM_OFFSET	(MPC10X_MAPB_ISA_MEM_BASE -	\</span>
<span class="cp">					 MPC10X_MAPB_PCI_MEM_START)</span>

<span class="cm">/* Set hose members to values appropriate for the mem map used */</span>
<span class="cp">#define	MPC10X_SETUP_HOSE(hose, map) {					\</span>
<span class="cp">	(hose)-&gt;pci_mem_offset = MPC10X_MAP##map##_PCI_MEM_OFFSET;	\</span>
<span class="cp">	(hose)-&gt;io_space.start = MPC10X_MAP##map##_PCI_IO_START;	\</span>
<span class="cp">	(hose)-&gt;io_space.end = MPC10X_MAP##map##_PCI_IO_END;		\</span>
<span class="cp">	(hose)-&gt;mem_space.start = MPC10X_MAP##map##_PCI_MEM_START;	\</span>
<span class="cp">	(hose)-&gt;mem_space.end = MPC10X_MAP##map##_PCI_MEM_END;		\</span>
<span class="cp">	(hose)-&gt;io_base_virt = (void *)MPC10X_MAP##map##_ISA_IO_BASE;	\</span>
<span class="cp">}</span>


<span class="cm">/* Miscellaneous Configuration register offsets */</span>
<span class="cp">#define	MPC10X_CFG_PIR_REG		0x09</span>
<span class="cp">#define	MPC10X_CFG_PIR_HOST_BRIDGE	0x00</span>
<span class="cp">#define	MPC10X_CFG_PIR_AGENT		0x01</span>

<span class="cp">#define	MPC10X_CFG_EUMBBAR		0x78</span>

<span class="cp">#define	MPC10X_CFG_PICR1_REG		0xa8</span>
<span class="cp">#define	MPC10X_CFG_PICR1_ADDR_MAP_MASK	0x00010000</span>
<span class="cp">#define	MPC10X_CFG_PICR1_ADDR_MAP_A	0x00010000</span>
<span class="cp">#define	MPC10X_CFG_PICR1_ADDR_MAP_B	0x00000000</span>
<span class="cp">#define	MPC10X_CFG_PICR1_SPEC_PCI_RD	0x00000004</span>
<span class="cp">#define	MPC10X_CFG_PICR1_ST_GATH_EN	0x00000040</span>

<span class="cp">#define	MPC10X_CFG_PICR2_REG		0xac</span>
<span class="cp">#define	MPC10X_CFG_PICR2_COPYBACK_OPT	0x00000001</span>

<span class="cp">#define	MPC10X_CFG_MAPB_OPTIONS_REG	0xe0</span>
<span class="cp">#define	MPC10X_CFG_MAPB_OPTIONS_CFAE	0x80	</span><span class="cm">/* CPU_FD_ALIAS_EN */</span><span class="cp"></span>
<span class="cp">#define	MPC10X_CFG_MAPB_OPTIONS_PFAE	0x40	</span><span class="cm">/* PCI_FD_ALIAS_EN */</span><span class="cp"></span>
<span class="cp">#define	MPC10X_CFG_MAPB_OPTIONS_DR	0x20	</span><span class="cm">/* DLL_RESET */</span><span class="cp"></span>
<span class="cp">#define	MPC10X_CFG_MAPB_OPTIONS_PCICH	0x08	</span><span class="cm">/* PCI_COMPATIBILITY_HOLE */</span><span class="cp"></span>
<span class="cp">#define	MPC10X_CFG_MAPB_OPTIONS_PROCCH	0x04	</span><span class="cm">/* PROC_COMPATIBILITY_HOLE */</span><span class="cp"></span>

<span class="cm">/* Define offsets for the memory controller registers in the config space */</span>
<span class="cp">#define MPC10X_MCTLR_MEM_START_1	0x80	</span><span class="cm">/* Banks 0-3 */</span><span class="cp"></span>
<span class="cp">#define MPC10X_MCTLR_MEM_START_2	0x84	</span><span class="cm">/* Banks 4-7 */</span><span class="cp"></span>
<span class="cp">#define MPC10X_MCTLR_EXT_MEM_START_1	0x88	</span><span class="cm">/* Banks 0-3 */</span><span class="cp"></span>
<span class="cp">#define MPC10X_MCTLR_EXT_MEM_START_2	0x8c	</span><span class="cm">/* Banks 4-7 */</span><span class="cp"></span>

<span class="cp">#define MPC10X_MCTLR_MEM_END_1		0x90	</span><span class="cm">/* Banks 0-3 */</span><span class="cp"></span>
<span class="cp">#define MPC10X_MCTLR_MEM_END_2		0x94	</span><span class="cm">/* Banks 4-7 */</span><span class="cp"></span>
<span class="cp">#define MPC10X_MCTLR_EXT_MEM_END_1	0x98	</span><span class="cm">/* Banks 0-3 */</span><span class="cp"></span>
<span class="cp">#define MPC10X_MCTLR_EXT_MEM_END_2	0x9c	</span><span class="cm">/* Banks 4-7 */</span><span class="cp"></span>

<span class="cp">#define MPC10X_MCTLR_MEM_BANK_ENABLES	0xa0</span>

<span class="cm">/* Define some offset in the EUMB */</span>
<span class="cp">#define	MPC10X_EUMB_SIZE		0x00100000 </span><span class="cm">/* Total EUMB size (1MB) */</span><span class="cp"></span>

<span class="cp">#define MPC10X_EUMB_MU_OFFSET		0x00000000 </span><span class="cm">/* Msg Unit reg offset */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_MU_SIZE		0x00001000 </span><span class="cm">/* Msg Unit reg size */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_DMA_OFFSET		0x00001000 </span><span class="cm">/* DMA Unit reg offset */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_DMA_SIZE		0x00001000 </span><span class="cm">/* DMA Unit reg size  */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_ATU_OFFSET		0x00002000 </span><span class="cm">/* Addr xlate reg offset */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_ATU_SIZE		0x00001000 </span><span class="cm">/* Addr xlate reg size  */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_I2C_OFFSET		0x00003000 </span><span class="cm">/* I2C Unit reg offset */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_I2C_SIZE		0x00001000 </span><span class="cm">/* I2C Unit reg size  */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_DUART_OFFSET	0x00004000 </span><span class="cm">/* DUART Unit reg offset (8245) */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_DUART_SIZE		0x00001000 </span><span class="cm">/* DUART Unit reg size (8245) */</span><span class="cp"></span>
<span class="cp">#define	MPC10X_EUMB_EPIC_OFFSET		0x00040000 </span><span class="cm">/* EPIC offset in EUMB */</span><span class="cp"></span>
<span class="cp">#define	MPC10X_EUMB_EPIC_SIZE		0x00030000 </span><span class="cm">/* EPIC size */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_PM_OFFSET		0x000fe000 </span><span class="cm">/* Performance Monitor reg offset (8245) */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_PM_SIZE		0x00001000 </span><span class="cm">/* Performance Monitor reg size (8245) */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_WP_OFFSET		0x000ff000 </span><span class="cm">/* Data path diagnostic, watchpoint reg offset */</span><span class="cp"></span>
<span class="cp">#define MPC10X_EUMB_WP_SIZE		0x00001000 </span><span class="cm">/* Data path diagnostic, watchpoint reg size */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Define some recommended places to put the EUMB regs.</span>
<span class="cm"> * For both maps, recommend putting the EUMB from 0xeff00000 to 0xefffffff.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span>			<span class="n">ioremap_base</span><span class="p">;</span>
<span class="cp">#define	MPC10X_MAPA_EUMB_BASE		(ioremap_base - MPC10X_EUMB_SIZE)</span>
<span class="cp">#define	MPC10X_MAPB_EUMB_BASE		MPC10X_MAPA_EUMB_BASE</span>

<span class="k">enum</span> <span class="n">ppc_sys_devices</span> <span class="p">{</span>
	<span class="n">MPC10X_IIC1</span><span class="p">,</span>
	<span class="n">MPC10X_DMA0</span><span class="p">,</span>
	<span class="n">MPC10X_DMA1</span><span class="p">,</span>
	<span class="n">MPC10X_UART0</span><span class="p">,</span>
	<span class="n">MPC10X_UART1</span><span class="p">,</span>
	<span class="n">NUM_PPC_SYS_DEVS</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">mpc10x_bridge_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_controller</span> <span class="o">*</span><span class="n">hose</span><span class="p">,</span>
		       <span class="n">uint</span> <span class="n">current_map</span><span class="p">,</span>
		       <span class="n">uint</span> <span class="n">new_map</span><span class="p">,</span>
		       <span class="n">uint</span> <span class="n">phys_eumb_base</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mpc10x_get_mem_size</span><span class="p">(</span><span class="n">uint</span> <span class="n">mem_map</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mpc10x_enable_store_gathering</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_controller</span> <span class="o">*</span><span class="n">hose</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mpc10x_disable_store_gathering</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_controller</span> <span class="o">*</span><span class="n">hose</span><span class="p">);</span>

<span class="cm">/* For MPC107 boards that use the built-in openpic */</span>
<span class="kt">void</span> <span class="n">mpc10x_set_openpic</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#endif	</span><span class="cm">/* __PPC_KERNEL_MPC10X_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
