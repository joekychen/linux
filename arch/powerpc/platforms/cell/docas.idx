f | spu_base.c | s | 20K | 695 | Greg Kroah-Hartman | gregkh@suse.de | 1325878972 |  | Merge branch 'driver-core-next' into Linux 3.2  This resolves the conflict in the arch/arm/mach-s3c64xx/s3c6400.c file, and it fixes the build error in the arch/x86/kernel/microcode_core.c file, that the merge did not catch.  The microcode_core.c patch was provided by Stephen Rothwell <sfr@canb.auug.org.au> who was invaluable in the merge issues involved with the large sysdev removal process in the driver-core tree.  Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | cbe_powerbutton.c | s | 3.0K | 98 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103838 |  | powerpc: Fix up modules that should be including module.h  So that we can clean up the header files and not be relying on implicit includes from device.h ---> module.h  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | beat_htab.c | s | 11K | 366 | Stephen Rothwell | sfr@canb.auug.org.au | 1332894803 |  | powerpc: Random little legacy iSeries removal tidy ups  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | beat_interrupt.h | s | 1.0K | 27 | Milton Miller | miltonm@bga.com | 1305783059 |  | powerpc: Remove stubbed beat smp support  I have no idea if the beat hypervisor supports multiple cpus in a partition, but the code has not been touched since these stubs were added in February of 2007 except to move them in April of 2008. These are stubs: start_cpu always returns fail (which is dropped), the message passing and reciving are empty functions, and the top of file comment says "Incomplete".  Signed-off-by: Milton Miller <miltonm@bga.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
d | spufs |  | 24 items |  | Jan Kara | jack@suse.cz | 1336283021 |  | vfs: Rename end_writeback() to clear_inode()  After we moved inode_sync_wait() from end_writeback() it doesn't make sense to call the function end_writeback() anymore. Rename it to clear_inode() which well says what the function really does - set I_CLEAR flag.  Signed-off-by: Jan Kara <jack@suse.cz> Signed-off-by: Fengguang Wu <fengguang.wu@intel.com>
f | Makefile | g | 1.5K |  | Milton Miller | miltonm@bga.com | 1305783059 |  | powerpc: Remove stubbed beat smp support  I have no idea if the beat hypervisor supports multiple cpus in a partition, but the code has not been touched since these stubs were added in February of 2007 except to move them in April of 2008. These are stubs: start_cpu always returns fail (which is dropped), the message passing and reciving are empty functions, and the top of file comment says "Incomplete".  Signed-off-by: Milton Miller <miltonm@bga.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | beat_udbg.c | s | 2.4K | 87 | Ingo Molnar | mingo@elte.hu | 1231392316 |  | powerpc/cell: Use correct types in beat files  Only pass the address of a u64 if that is what the function requires.  [Split out of a larger patch - sfr] [update comment - sfr] Signed-off-by: Ingo Molnar <mingo@elte.hu> Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | beat_wrapper.h | s | 7.1K | 242 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103840 |  | powerpc: cell/beat_wrapper.h is implicitly using memcpy functions  This has been relying on the fact that the parent file would have module.h (and thus nearly everything) present.  But once we fix that, we'll get stuck with this failure:  In file included from arch/powerpc/platforms/cell/beat_spu_priv1.c:26: arch/powerpc/platforms/cell/beat_wrapper.h: In function 'beat_eeprom_write': arch/powerpc/platforms/cell/beat_wrapper.h:160: error: implicit declaration of function 'memcpy'  and many more instances of the same.  Fix it in advance.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | qpace_setup.c | s | 3.4K | 126 | Uwe Kleine-König | u.kleine-koenig@pengutronix.de | 1333339203 |  | powerpc: Mark const init data with __initconst instead of __initdata  As long as there is no other non-const variable marked __initdata in the same compilation unit it doesn't hurt. If there were one however compilation would fail with  	error: $variablename causes a section type conflict  because a section containing const variables is marked read only and so cannot contain non-const variables.  Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de> Cc: Josh Boyer <jwboyer@gmail.com> Cc: Matt Porter <mporter@kernel.crashing.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mackerras <paulus@samba.org> Cc: Anatolij Gustschin <agust@denx.de> Cc: Kumar Gala <galak@kernel.crashing.org> Cc: Arnd Bergmann <arnd@arndb.de> Cc: linuxppc-dev@lists.ozlabs.org Cc: cbe-oss-dev@lists.ozlabs.org Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | pmu.c | s | 9.5K | 346 | Yong Zhang | yong.zhang0@gmail.com | 1320724306 |  | powerpc/irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Geoff Levand <geoff@infradead.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | celleb_scc_pciex.c | s | 14K | 467 | Yong Zhang | yong.zhang0@gmail.com | 1320724306 |  | powerpc/irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Geoff Levand <geoff@infradead.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | cbe_cpufreq.h | s | 578B | 20 | Christian Krafft | krafft@de.ibm.com | 1184960498 |  | [CELL] cbe_cpufreq: reorganize code  This patch reorganizes the code of the driver into three files. Two cbe_cpufreq_pmi.c and cbe_cpufreq_pervasive.c care about hardware. cbe_cpufreq.c contains the logic. There is no changed behaviour, except that the PMI related function is now located in a seperate module cbe_cpufreq_pmi. This module will be required by cbe_cpufreq, if CONFIG_CBE_CPUFREQ_PMI has been set.  Signed-off-by: Christian Krafft <krafft@de.ibm.com> Signed-off-by: Arnd Bergmann <arnd.bergmann@de.ibm.com>
f | iommu.c | s | 34K | 1007 | Andrzej Pietrasiewicz | andrzej.p@samsung.com | 1332945393 |  | PowerPC: adapt for dma_map_ops changes  Adapt core PowerPC architecture code for dma_map_ops changes: replace alloc/free_coherent with generic alloc/free methods.  Signed-off-by: Andrzej Pietrasiewicz <andrzej.p@samsung.com> [added missing changes to arch/powerpc/kernel/vio.c] Signed-off-by: Kyungmin Park <kyungmin.park@samsung.com> Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com> Reviewed-by: David Gibson <david@gibson.dropbear.id.au> Reviewed-by: Arnd Bergmann <arnd@arndb.de>
f | interrupt.c | s | 10K | 354 | Grant Likely | grant.likely@secretlab.ca | 1329397884 |  | irq_domain/powerpc: constify irq_domain_ops  Make all the irq_domain_ops structures in powerpc 'static const'  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | celleb_setup.c | s | 5.9K | 205 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103837 |  | powerpc: add export.h to files making use of EXPORT_SYMBOL  With module.h being implicitly everywhere via device.h, the absence of explicitly including something for EXPORT_SYMBOL went unnoticed. Since we are heading to fix things up and clean module.h from the device.h file, we need to explicitly include these files now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | cbe_thermal.c | s | 10K | 326 | Kay Sievers | kay.sievers@vrfy.org | 1324506582 |  | cpu: convert 'cpu' and 'machinecheck' sysdev_class to a regular subsystem  This moves the 'cpu sysdev_class' over to a regular 'cpu' subsystem and converts the devices to regular devices. The sysdev drivers are implemented as subsystem interfaces now.  After all sysdev classes are ported to regular driver core entities, the sysdev implementation will be entirely removed from the kernel.  Userspace relies on events and generic sysfs subsystem infrastructure from sysdev devices, which are made available with this conversion.  Cc: Haavard Skinnemoen <hskinnemoen@gmail.com> Cc: Hans-Christian Egtvedt <egtvedt@samfundet.no> Cc: Tony Luck <tony.luck@intel.com> Cc: Fenghua Yu <fenghua.yu@intel.com> Cc: Arnd Bergmann <arnd@arndb.de> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mackerras <paulus@samba.org> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: Heiko Carstens <heiko.carstens@de.ibm.com> Cc: Paul Mundt <lethal@linux-sh.org> Cc: "David S. Miller" <davem@davemloft.net> Cc: Chris Metcalf <cmetcalf@tilera.com> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Ingo Molnar <mingo@redhat.com> Cc: "H. Peter Anvin" <hpa@zytor.com> Cc: Borislav Petkov <bp@amd64.org> Cc: Tigran Aivazian <tigran@aivazian.fsnet.co.uk> Cc: Len Brown <lenb@kernel.org> Cc: Zhang Rui <rui.zhang@intel.com> Cc: Dave Jones <davej@redhat.com> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Russell King <rmk+kernel@arm.linux.org.uk> Cc: Andrew Morton <akpm@linux-foundation.org> Cc: Arjan van de Ven <arjan@linux.intel.com> Cc: "Rafael J. Wysocki" <rjw@sisk.pl> Cc: "Srivatsa S. Bhat" <srivatsa.bhat@linux.vnet.ibm.com> Signed-off-by: Kay Sievers <kay.sievers@vrfy.org> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | spu_manage.c | s | 13K | 481 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103844 |  | powerpc: various straight conversions from module.h --> export.h  All these files were including module.h just for the basic EXPORT_SYMBOL infrastructure.  We can shift them off to the export.h header which is a way smaller footprint and thus realize some compile time gains.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | beat_spu_priv1.c | s | 5.1K | 180 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103844 |  | powerpc: remove non-required uses of include <linux/module.h>  None of the files touched here are modules, and they are not exporting any symbols either -- so there is no need to be including the module.h.  Builds of all the files remains successful.  Even kernel/module.c does not need to include it, since it includes linux/moduleloader.h instead.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | beat_syscall.h | s | 9.1K | 162 | Ishizaki Kou | kou.ishizaki@toshiba.co.jp | 1209035293 |  | [POWERPC] celleb: Move files for Beat hvcall interfaces  This moves files for Beat hvcall interfaces into platforms/cell/. All files in this patch are used by celleb-beat only.  Signed-off-by: Kou Ishizaki <kou.ishizaki@toshiba.co.jp> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | celleb_scc_sio.c | s | 2.5K | 89 | Ishizaki Kou | kou.ishizaki@toshiba.co.jp | 1209035293 |  | [POWERPC] celleb: Move the SCC related code for celleb  This moves the SCC (Super Companion Chip) related code for celleb into platforms/cell/. All files in this patch are used by celleb-beat and celleb-native commonly.  Signed-off-by: Kou Ishizaki <kou.ishizaki@toshiba.co.jp> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | cbe_cpufreq.c | s | 4.9K | 164 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103838 |  | powerpc: Fix up modules that should be including module.h  So that we can clean up the header files and not be relying on implicit includes from device.h ---> module.h  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | celleb_pci.h | s | 1.4K | 38 | Michael Ellerman | michael@ozlabs.org | 1303877909 |  | powerpc/pci: Move IO workarounds to the common kernel dir  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | beat.h | s | 1.4K | 36 | Ishizaki Kou | kou.ishizaki@toshiba.co.jp | 1209035294 |  | [POWERPC] celleb: Move miscellaneous files for Beat  This moves miscellaneous files for Beat into platforms/cell/. All files in this patch are used by celleb-beat only.  Signed-off-by: Kou Ishizaki <kou.ishizaki@toshiba.co.jp> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | ras.h | s | 261B | 7 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1150866089 |  | [POWERPC] cell: add RAS support  This is a first version of support for the Cell BE "Reliability, Availability and Serviceability" features.  It doesn't yet handle some of the RAS interrupts (the ones described in iic_is/iic_irr), I'm still working on a proper way to expose these. They are essentially a cascaded controller by themselves (sic !) though I may just handle them locally to the iic driver. I need also to sync with David Erb on the way he hooked in the performance monitor interrupt.  So that's all for 2.6.17 and I'll do more work on that with my rework of the powerpc interrupt layer that I'm hacking on at the moment.  Signed-off-by: Arnd Bergmann <arnd.bergmann@de.ibm.com> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | spu_priv1_mmio.c | s | 4.6K | 151 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103844 |  | powerpc: remove non-required uses of include <linux/module.h>  None of the files touched here are modules, and they are not exporting any symbols either -- so there is no need to be including the module.h.  Builds of all the files remains successful.  Even kernel/module.c does not need to include it, since it includes linux/moduleloader.h instead.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | pervasive.c | s | 3.2K | 115 | Christian Krafft | krafft@de.ibm.com | 1216687171 |  | powerpc/cell: Cleanup sysreset_hack for IBM cell blades  This patch adds a config option for the sysreset_hack used for IBM Cell blades. The code is moves from pervasive.c into ras.c and gets it's own init method.  Signed-off-by: Christian Krafft <krafft@de.ibm.com> Signed-off-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | spu_syscalls.c | s | 3.8K | 141 | Al Viro | viro@zeniv.linux.org.uk | 1325649316 |  | switch spu_create(2) to use of SYSCALL_DEFINE4, make it use umode_t  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | beat_hvCall.S | g | 4.5K |  | Ishizaki Kou | kou.ishizaki@toshiba.co.jp | 1209035293 |  | [POWERPC] celleb: Move files for Beat hvcall interfaces  This moves files for Beat hvcall interfaces into platforms/cell/. All files in this patch are used by celleb-beat only.  Signed-off-by: Kou Ishizaki <kou.ishizaki@toshiba.co.jp> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | axon_msi.c | s | 11K | 405 | Grant Likely | grant.likely@secretlab.ca | 1335746726 |  | powerpc/irqdomain: Fix broken NR_IRQ references  The switch from using irq_map to irq_alloc_desc*() for managing irq number allocations introduced new bugs in some of the powerpc interrupt code.  Several functions rely on the value of NR_IRQS to determine the maximum irq number that could get allocated.  However, with sparse_irq and using irq_alloc_desc*() the maximum possible irq number is now specified with 'nr_irqs' which may be a number larger than NR_IRQS.  This has caused breakage on powermac when CONFIG_NR_IRQS is set to 32.  This patch removes most of the direct references to NR_IRQS in the powerpc code and replaces them with either a nr_irqs reference or by using the common for_each_irq_desc() macro.  The powerpc-specific for_each_irq() macro is removed at the same time.  Also, the Cell axon_msi driver is refactored to remove the global build assumption on the size of NR_IRQS and instead add a limit to the maximum irq number when calling irq_domain_add_nomap().  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | celleb_pci.c | s | 11K | 417 | Milton Miller | miltonm@bga.com | 1305783057 |  | powerpc: Remove alloc_maybe_bootmem for zalloc version  Replace all remaining callers of alloc_maybe_bootmem with zalloc_maybe_bootmem.   The callsite in pci_dn is followed with a memset to clear the memory, and not zeroing at the other callsites in the celleb fake pci code could lead to following uninitialized memory as pointers or even freeing said pointers on error paths.  Signed-off-by: Milton Miller <miltonm@bga.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | spu_fault.c | s | 2.3K | 84 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103844 |  | powerpc: various straight conversions from module.h --> export.h  All these files were including module.h just for the basic EXPORT_SYMBOL infrastructure.  We can shift them off to the export.h header which is a way smaller footprint and thus realize some compile time gains.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | cbe_cpufreq_pmi.c | s | 3.6K | 120 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103838 |  | powerpc: Fix up modules that should be including module.h  So that we can clean up the header files and not be relying on implicit includes from device.h ---> module.h  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | setup.c | s | 6.3K | 236 | Uwe Kleine-König | u.kleine-koenig@pengutronix.de | 1333339203 |  | powerpc: Mark const init data with __initconst instead of __initdata  As long as there is no other non-const variable marked __initdata in the same compilation unit it doesn't hurt. If there were one however compilation would fail with  	error: $variablename causes a section type conflict  because a section containing const variables is marked read only and so cannot contain non-const variables.  Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de> Cc: Josh Boyer <jwboyer@gmail.com> Cc: Matt Porter <mporter@kernel.crashing.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mackerras <paulus@samba.org> Cc: Anatolij Gustschin <agust@denx.de> Cc: Kumar Gala <galak@kernel.crashing.org> Cc: Arnd Bergmann <arnd@arndb.de> Cc: linuxppc-dev@lists.ozlabs.org Cc: cbe-oss-dev@lists.ozlabs.org Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | celleb_scc_epci.c | s | 9.8K | 351 | Joe Perches | joe@perches.com | 1307710536 |  | treewide: Convert uses of struct resource to resource_size(ptr)  Several fixes as well where the +1 was missing.  Done via coccinelle scripts like:  @@ struct resource *ptr; @@  - ptr->end - ptr->start + 1 + resource_size(ptr)  and some grep and typing.  Mostly uncompiled, no cross-compilers.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | celleb_scc.h | s | 7.7K | 208 | Ishizaki Kou | kou.ishizaki@toshiba.co.jp | 1209035294 |  | [POWERPC] celleb: Add support for PCI Express  This adds support for PCI Express port on Celleb.  I/O space of this PCI Express port is not mapped in memory space.  So we use the io-workaround mechanism to make accesses indirect.  Signed-off-by: Kou Ishizaki <kou.ishizaki@toshiba.co.jp> Acked-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | pervasive.h | s | 1.3K | 37 | Christian Krafft | krafft@de.ibm.com | 1216687171 |  | powerpc/cell: Cleanup sysreset_hack for IBM cell blades  This patch adds a config option for the sysreset_hack used for IBM Cell blades. The code is moves from pervasive.c into ras.c and gets it's own init method.  Signed-off-by: Christian Krafft <krafft@de.ibm.com> Signed-off-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | smp.c | s | 4.4K | 157 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | Kconfig | g | 4.1K |  | Tony Breeds | tony@bakeyournoodle.com | 1313728429 |  | net: fix IBM EMAC driver after rename.  In commit 9aa3283595451ca093500ff0977b106e1f465586 (ehea/ibm*: Move the IBM drivers) the IBM_NEW_EMAC* were renames to IBM_EMAC*  The conversion was incomplete so that even if the driver was added to the .config it wasn't built, but there were no errors).  In this commit we also update the various defconfigs that use EMAC to use the new Kconfig symbol, and explicitly add the NET_VENDOR_IBM guard.  We do not explicitly select the Kconfig dependencies, as this would force EMAC on.  Doing it in the defconfig allows more flexibility.  Tested on a canyondlands board.  Signed-off-by: Tony Breeds <tony@bakeyournoodle.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | spu_notify.c | s | 2.0K | 59 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103841 |  | powerpc: fix implicit notifier use in converting to export.h  We can convert this file to using export.h since it only wants to export symbols, but when we do we'll see also that it was implicitly getting notifier.h from module.h via this failure:    CC      arch/powerpc/platforms/cell/spu_notify.o arch/powerpc/platforms/cell/spu_notify.c:28: warning: type defaults to 'int' in declaration of 'BLOCKING_NOTIFIER_HEAD' arch/powerpc/platforms/cell/spu_notify.c:28: warning: parameter names (without types) in function declaration arch/powerpc/platforms/cell/spu_notify.c: In function 'spu_switch_notify': arch/powerpc/platforms/cell/spu_notify.c:32: error: implicit declaration of function 'blocking_notifier_call_chain' arch/powerpc/platforms/cell/spu_notify.c:32: error: 'spu_switch_notifier' undeclared (first use in this function)  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | spu_priv1_mmio.h | s | 964B | 23 | Geoff Levand | geoffrey.levand@am.sony.com | 1165225239 |  | [POWERPC] cell: abstract spu management routines  This adds a platform specific spu management abstraction and the coresponding routines to support the IBM Cell Blade.  It also removes the hypervisor only resources that were included in struct spu.  Three new platform specific routines are introduced, spu_enumerate_spus(), spu_create_spu() and spu_destroy_spu().  The underlying design uses a new type, struct spu_management_ops, to hold function pointers that the platform setup code is expected to initialize to instances appropriate to that platform.  For the IBM Cell Blade support, I put the hypervisor only resources that were in struct spu into a platform specific data structure struct spu_pdata.  Signed-off-by: Geoff Levand <geoffrey.levand@am.sony.com> Signed-off-by: Arnd Bergmann <arnd.bergmann@de.ibm.com>
f | spider-pic.c | s | 10K | 314 | Grant Likely | grant.likely@secretlab.ca | 1329397884 |  | irq_domain/powerpc: constify irq_domain_ops  Make all the irq_domain_ops structures in powerpc 'static const'  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | beat_iommu.c | s | 3.0K | 94 | Nishanth Aravamudan | nacc@us.ibm.com | 1291006100 |  | powerpc/cell: Beat dma ops cleanup  direct_dma_ops is the default pci dma ops.  No need to call a function to get the pci dma ops, we know they are the dma_direct_ops.  Signed-off-by: Milton Miller <miltonm@bga.com> Signed-off-by: Nishanth Aravamudan <nacc@us.ibm.com> Acked-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | ras.c | s | 7.8K | 284 | Julia Lawall | julia@diku.dk | 1283400453 |  | powerpc/cell: Add of_node_put to avoid memory leak  Add calls to of_node_put in the error handling code following calls to of_find_node_by_path and of_find_node_by_phandle.  The semantic match that finds this problem is as follows: (http://coccinelle.lip6.fr/)  // <smpl> @r exists@ local idexpression x; expression E,E1; statement S; @@  *x = (of_find_node_by_path ||of_find_node_by_name ||of_find_node_by_phandle ||of_get_parent ||of_get_next_parent ||of_get_next_child ||of_find_compatible_node ||of_match_node )(...); ... if (x == NULL) S <... when != x = E *if (...) {   ... when != of_node_put(x)       when != if (...) { ... of_node_put(x); ... } (   return <+...x...+>; || *  return ...; ) } ...> of_node_put(x); // </smpl>  Signed-off-by: Julia Lawall <julia@diku.dk> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | interrupt.h | s | 2.8K | 79 | Milton Miller | miltonm@bga.com | 1306381138 |  | powerpc/cell: Rename ipi functions to match current abstractions  Rename functions and arguments to reflect current usage.  iic_cause_ipi becomes iic_message_pass and iic_ipi_to_irq becomes iic_msg_to_irq, and iic_request_ipi now takes a message (msg) instead of an ipi number. Also mesg is renamed to msg.  Commit f1072939b6 (powerpc: Remove checks for MSG_ALL and MSG_ALL_BUT_SELF) connected the smp_message_pass hook for cell to the underlying iic_cause_IPI, a platform unique name.  Later 23d72bfd8f (powerpc: Consolidate ipi message mux and demux) added a cause_ipi hook to the smp_ops, also used in message passing, but for controllers that can not send 4 unique messages and require multiplexing.  It is even more confusing that the both take two arguments, but one is the small message ordinal and the other is an opaque long data associated with the cpu.  Since cell iic maps messages one to one to ipi irqs, rename the function and argument to translate from ipi to message.  Also make it clear that iic_request_ipi takes a message number as the argument for which ipi to create and request.  No functionional change, just renames to avoid future confusion.  Signed-off-by: Milton Miller <miltonm@bga.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | cbe_regs.c | s | 6.5K | 233 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103844 |  | powerpc: various straight conversions from module.h --> export.h  All these files were including module.h just for the basic EXPORT_SYMBOL infrastructure.  We can shift them off to the export.h header which is a way smaller footprint and thus realize some compile time gains.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | spu_callbacks.c | s | 2.1K | 62 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103844 |  | powerpc: various straight conversions from module.h --> export.h  All these files were including module.h just for the basic EXPORT_SYMBOL infrastructure.  We can shift them off to the export.h header which is a way smaller footprint and thus realize some compile time gains.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | cbe_cpufreq_pervasive.c | s | 2.9K | 94 | Stephen Rothwell | sfr@canb.auug.org.au | 1231392313 |  | powerpc/cell: local_irq_save takes an unsigned long  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Acked-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | celleb_scc_uhc.c | s | 2.5K | 82 | Ishizaki Kou | kou.ishizaki@toshiba.co.jp | 1209035293 |  | [POWERPC] celleb: Move the SCC related code for celleb  This moves the SCC (Super Companion Chip) related code for celleb into platforms/cell/. All files in this patch are used by celleb-beat and celleb-native commonly.  Signed-off-by: Kou Ishizaki <kou.ishizaki@toshiba.co.jp> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | beat_interrupt.c | s | 6.7K | 217 | Grant Likely | grant.likely@secretlab.ca | 1335746726 |  | powerpc/irqdomain: Fix broken NR_IRQ references  The switch from using irq_map to irq_alloc_desc*() for managing irq number allocations introduced new bugs in some of the powerpc interrupt code.  Several functions rely on the value of NR_IRQS to determine the maximum irq number that could get allocated.  However, with sparse_irq and using irq_alloc_desc*() the maximum possible irq number is now specified with 'nr_irqs' which may be a number larger than NR_IRQS.  This has caused breakage on powermac when CONFIG_NR_IRQS is set to 32.  This patch removes most of the direct references to NR_IRQS in the powerpc code and replaces them with either a nr_irqs reference or by using the common for_each_irq_desc() macro.  The powerpc-specific for_each_irq() macro is removed at the same time.  Also, the Cell axon_msi driver is refactored to remove the global build assumption on the size of NR_IRQS and instead add a limit to the maximum irq number when calling irq_domain_add_nomap().  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | beat.c | s | 5.5K | 223 | Yong Zhang | yong.zhang0@gmail.com | 1320724306 |  | powerpc/irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Geoff Levand <geoff@infradead.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | cpufreq_spudemand.c | s | 4.1K | 136 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103838 |  | powerpc: Fix up modules that should be including module.h  So that we can clean up the header files and not be relying on implicit includes from device.h ---> module.h  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | spider-pci.c | s | 4.9K | 155 | Michael Ellerman | michael@ozlabs.org | 1303877909 |  | powerpc/pci: Move IO workarounds to the common kernel dir  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
