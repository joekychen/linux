<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › feature-fixups.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>feature-fixups.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __ASM_POWERPC_FEATURE_FIXUPS_H</span>
<span class="cp">#define __ASM_POWERPC_FEATURE_FIXUPS_H</span>

<span class="cm">/*</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License</span>
<span class="cm"> * as published by the Free Software Foundation; either version</span>
<span class="cm"> * 2 of the License, or (at your option) any later version.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Feature section common macros</span>
<span class="cm"> *</span>
<span class="cm"> * Note that the entries now contain offsets between the table entry</span>
<span class="cm"> * and the code rather than absolute code pointers in order to be</span>
<span class="cm"> * useable with the vdso shared library. There is also an assumption</span>
<span class="cm"> * that values will be negative, that is, the fixup table has to be</span>
<span class="cm"> * located after the code it fixes up.</span>
<span class="cm"> */</span>
<span class="cp">#if defined(CONFIG_PPC64) &amp;&amp; !defined(__powerpc64__)</span>
<span class="cm">/* 64 bits kernel, 32 bits code (ie. vdso32) */</span>
<span class="cp">#define FTR_ENTRY_LONG		.llong</span>
<span class="cp">#define FTR_ENTRY_OFFSET	.long 0xffffffff; .long</span>
<span class="cp">#elif defined(CONFIG_PPC64)</span>
<span class="cp">#define FTR_ENTRY_LONG		.llong</span>
<span class="cp">#define FTR_ENTRY_OFFSET	.llong</span>
<span class="cp">#else</span>
<span class="cp">#define FTR_ENTRY_LONG		.long</span>
<span class="cp">#define FTR_ENTRY_OFFSET	.long</span>
<span class="cp">#endif</span>

<span class="cp">#define START_FTR_SECTION(label)	label##1:</span>

<span class="cp">#define FTR_SECTION_ELSE_NESTED(label)			\</span>
<span class="cp">label##2:						\</span>
<span class="cp">	.pushsection __ftr_alt_##label,&quot;a&quot;;		\</span>
<span class="cp">	.align 2;					\</span>
<span class="cp">label##3:</span>

<span class="cp">#define MAKE_FTR_SECTION_ENTRY(msk, val, label, sect)		\</span>
<span class="cp">label##4:							\</span>
<span class="cp">	.popsection;						\</span>
<span class="cp">	.pushsection sect,&quot;a&quot;;					\</span>
<span class="cp">	.align 3;						\</span>
<span class="cp">label##5:							\</span>
<span class="cp">	FTR_ENTRY_LONG msk;					\</span>
<span class="cp">	FTR_ENTRY_LONG val;					\</span>
<span class="cp">	FTR_ENTRY_OFFSET label##1b-label##5b;			\</span>
<span class="cp">	FTR_ENTRY_OFFSET label##2b-label##5b;			\</span>
<span class="cp">	FTR_ENTRY_OFFSET label##3b-label##5b;			\</span>
<span class="cp">	FTR_ENTRY_OFFSET label##4b-label##5b;			\</span>
<span class="cp">	.ifgt (label##4b- label##3b)-(label##2b- label##1b);	\</span>
<span class="cp">	.error &quot;Feature section else case larger than body&quot;;	\</span>
<span class="cp">	.endif;							\</span>
<span class="cp">	.popsection;</span>


<span class="cm">/* CPU feature dependent sections */</span>
<span class="cp">#define BEGIN_FTR_SECTION_NESTED(label)	START_FTR_SECTION(label)</span>
<span class="cp">#define BEGIN_FTR_SECTION		START_FTR_SECTION(97)</span>

<span class="cp">#define END_FTR_SECTION_NESTED(msk, val, label) 		\</span>
<span class="cp">	FTR_SECTION_ELSE_NESTED(label)				\</span>
<span class="cp">	MAKE_FTR_SECTION_ENTRY(msk, val, label, __ftr_fixup)</span>

<span class="cp">#define END_FTR_SECTION(msk, val)		\</span>
<span class="cp">	END_FTR_SECTION_NESTED(msk, val, 97)</span>

<span class="cp">#define END_FTR_SECTION_IFSET(msk)	END_FTR_SECTION((msk), (msk))</span>
<span class="cp">#define END_FTR_SECTION_IFCLR(msk)	END_FTR_SECTION((msk), 0)</span>

<span class="cm">/* CPU feature sections with alternatives, use BEGIN_FTR_SECTION to start */</span>
<span class="cp">#define FTR_SECTION_ELSE	FTR_SECTION_ELSE_NESTED(97)</span>
<span class="cp">#define ALT_FTR_SECTION_END_NESTED(msk, val, label)	\</span>
<span class="cp">	MAKE_FTR_SECTION_ENTRY(msk, val, label, __ftr_fixup)</span>
<span class="cp">#define ALT_FTR_SECTION_END_NESTED_IFSET(msk, label)	\</span>
<span class="cp">	ALT_FTR_SECTION_END_NESTED(msk, msk, label)</span>
<span class="cp">#define ALT_FTR_SECTION_END_NESTED_IFCLR(msk, label)	\</span>
<span class="cp">	ALT_FTR_SECTION_END_NESTED(msk, 0, label)</span>
<span class="cp">#define ALT_FTR_SECTION_END(msk, val)	\</span>
<span class="cp">	ALT_FTR_SECTION_END_NESTED(msk, val, 97)</span>
<span class="cp">#define ALT_FTR_SECTION_END_IFSET(msk)	\</span>
<span class="cp">	ALT_FTR_SECTION_END_NESTED_IFSET(msk, 97)</span>
<span class="cp">#define ALT_FTR_SECTION_END_IFCLR(msk)	\</span>
<span class="cp">	ALT_FTR_SECTION_END_NESTED_IFCLR(msk, 97)</span>

<span class="cm">/* MMU feature dependent sections */</span>
<span class="cp">#define BEGIN_MMU_FTR_SECTION_NESTED(label)	START_FTR_SECTION(label)</span>
<span class="cp">#define BEGIN_MMU_FTR_SECTION			START_FTR_SECTION(97)</span>

<span class="cp">#define END_MMU_FTR_SECTION_NESTED(msk, val, label) 		\</span>
<span class="cp">	FTR_SECTION_ELSE_NESTED(label)				\</span>
<span class="cp">	MAKE_FTR_SECTION_ENTRY(msk, val, label, __mmu_ftr_fixup)</span>

<span class="cp">#define END_MMU_FTR_SECTION(msk, val)		\</span>
<span class="cp">	END_MMU_FTR_SECTION_NESTED(msk, val, 97)</span>

<span class="cp">#define END_MMU_FTR_SECTION_IFSET(msk)	END_MMU_FTR_SECTION((msk), (msk))</span>
<span class="cp">#define END_MMU_FTR_SECTION_IFCLR(msk)	END_MMU_FTR_SECTION((msk), 0)</span>

<span class="cm">/* MMU feature sections with alternatives, use BEGIN_FTR_SECTION to start */</span>
<span class="cp">#define MMU_FTR_SECTION_ELSE_NESTED(label)	FTR_SECTION_ELSE_NESTED(label)</span>
<span class="cp">#define MMU_FTR_SECTION_ELSE	MMU_FTR_SECTION_ELSE_NESTED(97)</span>
<span class="cp">#define ALT_MMU_FTR_SECTION_END_NESTED(msk, val, label)	\</span>
<span class="cp">	MAKE_FTR_SECTION_ENTRY(msk, val, label, __mmu_ftr_fixup)</span>
<span class="cp">#define ALT_MMU_FTR_SECTION_END_NESTED_IFSET(msk, label)	\</span>
<span class="cp">	ALT_MMU_FTR_SECTION_END_NESTED(msk, msk, label)</span>
<span class="cp">#define ALT_MMU_FTR_SECTION_END_NESTED_IFCLR(msk, label)	\</span>
<span class="cp">	ALT_MMU_FTR_SECTION_END_NESTED(msk, 0, label)</span>
<span class="cp">#define ALT_MMU_FTR_SECTION_END(msk, val)	\</span>
<span class="cp">	ALT_MMU_FTR_SECTION_END_NESTED(msk, val, 97)</span>
<span class="cp">#define ALT_MMU_FTR_SECTION_END_IFSET(msk)	\</span>
<span class="cp">	ALT_MMU_FTR_SECTION_END_NESTED_IFSET(msk, 97)</span>
<span class="cp">#define ALT_MMU_FTR_SECTION_END_IFCLR(msk)	\</span>
<span class="cp">	ALT_MMU_FTR_SECTION_END_NESTED_IFCLR(msk, 97)</span>

<span class="cm">/* Firmware feature dependent sections */</span>
<span class="cp">#define BEGIN_FW_FTR_SECTION_NESTED(label)	START_FTR_SECTION(label)</span>
<span class="cp">#define BEGIN_FW_FTR_SECTION			START_FTR_SECTION(97)</span>

<span class="cp">#define END_FW_FTR_SECTION_NESTED(msk, val, label) 		\</span>
<span class="cp">	FTR_SECTION_ELSE_NESTED(label)				\</span>
<span class="cp">	MAKE_FTR_SECTION_ENTRY(msk, val, label, __fw_ftr_fixup)</span>

<span class="cp">#define END_FW_FTR_SECTION(msk, val)		\</span>
<span class="cp">	END_FW_FTR_SECTION_NESTED(msk, val, 97)</span>

<span class="cp">#define END_FW_FTR_SECTION_IFSET(msk)	END_FW_FTR_SECTION((msk), (msk))</span>
<span class="cp">#define END_FW_FTR_SECTION_IFCLR(msk)	END_FW_FTR_SECTION((msk), 0)</span>

<span class="cm">/* Firmware feature sections with alternatives */</span>
<span class="cp">#define FW_FTR_SECTION_ELSE_NESTED(label)	FTR_SECTION_ELSE_NESTED(label)</span>
<span class="cp">#define FW_FTR_SECTION_ELSE	FTR_SECTION_ELSE_NESTED(97)</span>
<span class="cp">#define ALT_FW_FTR_SECTION_END_NESTED(msk, val, label)	\</span>
<span class="cp">	MAKE_FTR_SECTION_ENTRY(msk, val, label, __fw_ftr_fixup)</span>
<span class="cp">#define ALT_FW_FTR_SECTION_END_NESTED_IFSET(msk, label)	\</span>
<span class="cp">	ALT_FW_FTR_SECTION_END_NESTED(msk, msk, label)</span>
<span class="cp">#define ALT_FW_FTR_SECTION_END_NESTED_IFCLR(msk, label)	\</span>
<span class="cp">	ALT_FW_FTR_SECTION_END_NESTED(msk, 0, label)</span>
<span class="cp">#define ALT_FW_FTR_SECTION_END(msk, val)	\</span>
<span class="cp">	ALT_FW_FTR_SECTION_END_NESTED(msk, val, 97)</span>
<span class="cp">#define ALT_FW_FTR_SECTION_END_IFSET(msk)	\</span>
<span class="cp">	ALT_FW_FTR_SECTION_END_NESTED_IFSET(msk, 97)</span>
<span class="cp">#define ALT_FW_FTR_SECTION_END_IFCLR(msk)	\</span>
<span class="cp">	ALT_FW_FTR_SECTION_END_NESTED_IFCLR(msk, 97)</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cp">#define ASM_FTR_IF(section_if, section_else, msk, val)	\</span>
<span class="cp">	stringify_in_c(BEGIN_FTR_SECTION)			\</span>
<span class="cp">	section_if &quot;; &quot;						\</span>
<span class="cp">	stringify_in_c(FTR_SECTION_ELSE)			\</span>
<span class="cp">	section_else &quot;; &quot;					\</span>
<span class="cp">	stringify_in_c(ALT_FTR_SECTION_END((msk), (val)))</span>

<span class="cp">#define ASM_FTR_IFSET(section_if, section_else, msk)	\</span>
<span class="cp">	ASM_FTR_IF(section_if, section_else, (msk), (msk))</span>

<span class="cp">#define ASM_FTR_IFCLR(section_if, section_else, msk)	\</span>
<span class="cp">	ASM_FTR_IF(section_if, section_else, (msk), 0)</span>

<span class="cp">#define ASM_MMU_FTR_IF(section_if, section_else, msk, val)	\</span>
<span class="cp">	stringify_in_c(BEGIN_MMU_FTR_SECTION)			\</span>
<span class="cp">	section_if &quot;; &quot;						\</span>
<span class="cp">	stringify_in_c(MMU_FTR_SECTION_ELSE)			\</span>
<span class="cp">	section_else &quot;; &quot;					\</span>
<span class="cp">	stringify_in_c(ALT_MMU_FTR_SECTION_END((msk), (val)))</span>

<span class="cp">#define ASM_MMU_FTR_IFSET(section_if, section_else, msk)	\</span>
<span class="cp">	ASM_MMU_FTR_IF(section_if, section_else, (msk), (msk))</span>

<span class="cp">#define ASM_MMU_FTR_IFCLR(section_if, section_else, msk)	\</span>
<span class="cp">	ASM_MMU_FTR_IF(section_if, section_else, (msk), 0)</span>

<span class="cp">#endif </span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/* LWSYNC feature sections */</span>
<span class="cp">#define START_LWSYNC_SECTION(label)	label##1:</span>
<span class="cp">#define MAKE_LWSYNC_SECTION_ENTRY(label, sect)		\</span>
<span class="cp">label##2:						\</span>
<span class="cp">	.pushsection sect,&quot;a&quot;;				\</span>
<span class="cp">	.align 2;					\</span>
<span class="cp">label##3:					       	\</span>
<span class="cp">	FTR_ENTRY_OFFSET label##1b-label##3b;		\</span>
<span class="cp">	.popsection;</span>

<span class="cp">#endif </span><span class="cm">/* __ASM_POWERPC_FEATURE_FIXUPS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
