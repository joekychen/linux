<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › fsl_lbc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>fsl_lbc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* Freescale Local Bus Controller</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright © 2006-2007, 2010 Freescale Semiconductor</span>
<span class="cm"> *</span>
<span class="cm"> * Authors: Nick Spence &lt;nick.spence@freescale.com&gt;,</span>
<span class="cm"> *          Scott Wood &lt;scottwood@freescale.com&gt;</span>
<span class="cm"> *          Jack Lan &lt;jack.lan@freescale.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASM_FSL_LBC_H</span>
<span class="cp">#define __ASM_FSL_LBC_H</span>

<span class="cp">#include &lt;linux/compiler.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>

<span class="k">struct</span> <span class="n">fsl_lbc_bank</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="n">br</span><span class="p">;</span>             <span class="cm">/**&lt; Base Register  */</span>
<span class="cp">#define BR_BA           0xFFFF8000</span>
<span class="cp">#define BR_BA_SHIFT             15</span>
<span class="cp">#define BR_PS           0x00001800</span>
<span class="cp">#define BR_PS_SHIFT             11</span>
<span class="cp">#define BR_PS_8         0x00000800  </span><span class="cm">/* Port Size 8 bit */</span><span class="cp"></span>
<span class="cp">#define BR_PS_16        0x00001000  </span><span class="cm">/* Port Size 16 bit */</span><span class="cp"></span>
<span class="cp">#define BR_PS_32        0x00001800  </span><span class="cm">/* Port Size 32 bit */</span><span class="cp"></span>
<span class="cp">#define BR_DECC         0x00000600</span>
<span class="cp">#define BR_DECC_SHIFT            9</span>
<span class="cp">#define BR_DECC_OFF     0x00000000  </span><span class="cm">/* HW ECC checking and generation off */</span><span class="cp"></span>
<span class="cp">#define BR_DECC_CHK     0x00000200  </span><span class="cm">/* HW ECC checking on, generation off */</span><span class="cp"></span>
<span class="cp">#define BR_DECC_CHK_GEN 0x00000400  </span><span class="cm">/* HW ECC checking and generation on */</span><span class="cp"></span>
<span class="cp">#define BR_WP           0x00000100</span>
<span class="cp">#define BR_WP_SHIFT              8</span>
<span class="cp">#define BR_MSEL         0x000000E0</span>
<span class="cp">#define BR_MSEL_SHIFT            5</span>
<span class="cp">#define BR_MS_GPCM      0x00000000  </span><span class="cm">/* GPCM */</span><span class="cp"></span>
<span class="cp">#define BR_MS_FCM       0x00000020  </span><span class="cm">/* FCM */</span><span class="cp"></span>
<span class="cp">#define BR_MS_SDRAM     0x00000060  </span><span class="cm">/* SDRAM */</span><span class="cp"></span>
<span class="cp">#define BR_MS_UPMA      0x00000080  </span><span class="cm">/* UPMA */</span><span class="cp"></span>
<span class="cp">#define BR_MS_UPMB      0x000000A0  </span><span class="cm">/* UPMB */</span><span class="cp"></span>
<span class="cp">#define BR_MS_UPMC      0x000000C0  </span><span class="cm">/* UPMC */</span><span class="cp"></span>
<span class="cp">#define BR_V            0x00000001</span>
<span class="cp">#define BR_V_SHIFT               0</span>
<span class="cp">#define BR_RES          ~(BR_BA|BR_PS|BR_DECC|BR_WP|BR_MSEL|BR_V)</span>

	<span class="n">__be32</span> <span class="n">or</span><span class="p">;</span>             <span class="cm">/**&lt; Base Register  */</span>
<span class="cp">#define OR0 0x5004</span>
<span class="cp">#define OR1 0x500C</span>
<span class="cp">#define OR2 0x5014</span>
<span class="cp">#define OR3 0x501C</span>
<span class="cp">#define OR4 0x5024</span>
<span class="cp">#define OR5 0x502C</span>
<span class="cp">#define OR6 0x5034</span>
<span class="cp">#define OR7 0x503C</span>

<span class="cp">#define OR_FCM_AM               0xFFFF8000</span>
<span class="cp">#define OR_FCM_AM_SHIFT                 15</span>
<span class="cp">#define OR_FCM_BCTLD            0x00001000</span>
<span class="cp">#define OR_FCM_BCTLD_SHIFT              12</span>
<span class="cp">#define OR_FCM_PGS              0x00000400</span>
<span class="cp">#define OR_FCM_PGS_SHIFT                10</span>
<span class="cp">#define OR_FCM_CSCT             0x00000200</span>
<span class="cp">#define OR_FCM_CSCT_SHIFT                9</span>
<span class="cp">#define OR_FCM_CST              0x00000100</span>
<span class="cp">#define OR_FCM_CST_SHIFT                 8</span>
<span class="cp">#define OR_FCM_CHT              0x00000080</span>
<span class="cp">#define OR_FCM_CHT_SHIFT                 7</span>
<span class="cp">#define OR_FCM_SCY              0x00000070</span>
<span class="cp">#define OR_FCM_SCY_SHIFT                 4</span>
<span class="cp">#define OR_FCM_SCY_1            0x00000010</span>
<span class="cp">#define OR_FCM_SCY_2            0x00000020</span>
<span class="cp">#define OR_FCM_SCY_3            0x00000030</span>
<span class="cp">#define OR_FCM_SCY_4            0x00000040</span>
<span class="cp">#define OR_FCM_SCY_5            0x00000050</span>
<span class="cp">#define OR_FCM_SCY_6            0x00000060</span>
<span class="cp">#define OR_FCM_SCY_7            0x00000070</span>
<span class="cp">#define OR_FCM_RST              0x00000008</span>
<span class="cp">#define OR_FCM_RST_SHIFT                 3</span>
<span class="cp">#define OR_FCM_TRLX             0x00000004</span>
<span class="cp">#define OR_FCM_TRLX_SHIFT                2</span>
<span class="cp">#define OR_FCM_EHTR             0x00000002</span>
<span class="cp">#define OR_FCM_EHTR_SHIFT                1</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fsl_lbc_regs</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fsl_lbc_bank</span> <span class="n">bank</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">res0</span><span class="p">[</span><span class="mh">0x8</span><span class="p">];</span>
	<span class="n">__be32</span> <span class="n">mar</span><span class="p">;</span>             <span class="cm">/**&lt; UPM Address Register */</span>
	<span class="n">u8</span> <span class="n">res1</span><span class="p">[</span><span class="mh">0x4</span><span class="p">];</span>
	<span class="n">__be32</span> <span class="n">mamr</span><span class="p">;</span>            <span class="cm">/**&lt; UPMA Mode Register */</span>
<span class="cp">#define MxMR_OP_NO	(0 &lt;&lt; 28) </span><span class="cm">/**&lt; normal operation */</span><span class="cp"></span>
<span class="cp">#define MxMR_OP_WA	(1 &lt;&lt; 28) </span><span class="cm">/**&lt; write array */</span><span class="cp"></span>
<span class="cp">#define MxMR_OP_RA	(2 &lt;&lt; 28) </span><span class="cm">/**&lt; read array */</span><span class="cp"></span>
<span class="cp">#define MxMR_OP_RP	(3 &lt;&lt; 28) </span><span class="cm">/**&lt; run pattern */</span><span class="cp"></span>
<span class="cp">#define MxMR_MAD	0x3f      </span><span class="cm">/**&lt; machine address */</span><span class="cp"></span>
	<span class="n">__be32</span> <span class="n">mbmr</span><span class="p">;</span>            <span class="cm">/**&lt; UPMB Mode Register */</span>
	<span class="n">__be32</span> <span class="n">mcmr</span><span class="p">;</span>            <span class="cm">/**&lt; UPMC Mode Register */</span>
	<span class="n">u8</span> <span class="n">res2</span><span class="p">[</span><span class="mh">0x8</span><span class="p">];</span>
	<span class="n">__be32</span> <span class="n">mrtpr</span><span class="p">;</span>           <span class="cm">/**&lt; Memory Refresh Timer Prescaler Register */</span>
	<span class="n">__be32</span> <span class="n">mdr</span><span class="p">;</span>             <span class="cm">/**&lt; UPM Data Register */</span>
	<span class="n">u8</span> <span class="n">res3</span><span class="p">[</span><span class="mh">0x4</span><span class="p">];</span>
	<span class="n">__be32</span> <span class="n">lsor</span><span class="p">;</span>            <span class="cm">/**&lt; Special Operation Initiation Register */</span>
	<span class="n">__be32</span> <span class="n">lsdmr</span><span class="p">;</span>           <span class="cm">/**&lt; SDRAM Mode Register */</span>
	<span class="n">u8</span> <span class="n">res4</span><span class="p">[</span><span class="mh">0x8</span><span class="p">];</span>
	<span class="n">__be32</span> <span class="n">lurt</span><span class="p">;</span>            <span class="cm">/**&lt; UPM Refresh Timer */</span>
	<span class="n">__be32</span> <span class="n">lsrt</span><span class="p">;</span>            <span class="cm">/**&lt; SDRAM Refresh Timer */</span>
	<span class="n">u8</span> <span class="n">res5</span><span class="p">[</span><span class="mh">0x8</span><span class="p">];</span>
	<span class="n">__be32</span> <span class="n">ltesr</span><span class="p">;</span>           <span class="cm">/**&lt; Transfer Error Status Register */</span>
<span class="cp">#define LTESR_BM   0x80000000</span>
<span class="cp">#define LTESR_FCT  0x40000000</span>
<span class="cp">#define LTESR_PAR  0x20000000</span>
<span class="cp">#define LTESR_WP   0x04000000</span>
<span class="cp">#define LTESR_ATMW 0x00800000</span>
<span class="cp">#define LTESR_ATMR 0x00400000</span>
<span class="cp">#define LTESR_CS   0x00080000</span>
<span class="cp">#define LTESR_UPM  0x00000002</span>
<span class="cp">#define LTESR_CC   0x00000001</span>
<span class="cp">#define LTESR_NAND_MASK (LTESR_FCT | LTESR_PAR | LTESR_CC)</span>
<span class="cp">#define LTESR_MASK      (LTESR_BM | LTESR_FCT | LTESR_PAR | LTESR_WP \</span>
<span class="cp">			 | LTESR_ATMW | LTESR_ATMR | LTESR_CS | LTESR_UPM \</span>
<span class="cp">			 | LTESR_CC)</span>
<span class="cp">#define LTESR_CLEAR	0xFFFFFFFF</span>
<span class="cp">#define LTECCR_CLEAR	0xFFFFFFFF</span>
<span class="cp">#define LTESR_STATUS	LTESR_MASK</span>
<span class="cp">#define LTEIR_ENABLE	LTESR_MASK</span>
<span class="cp">#define LTEDR_ENABLE	0x00000000</span>
	<span class="n">__be32</span> <span class="n">ltedr</span><span class="p">;</span>           <span class="cm">/**&lt; Transfer Error Disable Register */</span>
	<span class="n">__be32</span> <span class="n">lteir</span><span class="p">;</span>           <span class="cm">/**&lt; Transfer Error Interrupt Register */</span>
	<span class="n">__be32</span> <span class="n">lteatr</span><span class="p">;</span>          <span class="cm">/**&lt; Transfer Error Attributes Register */</span>
	<span class="n">__be32</span> <span class="n">ltear</span><span class="p">;</span>           <span class="cm">/**&lt; Transfer Error Address Register */</span>
	<span class="n">__be32</span> <span class="n">lteccr</span><span class="p">;</span>          <span class="cm">/**&lt; Transfer Error ECC Register */</span>
	<span class="n">u8</span> <span class="n">res6</span><span class="p">[</span><span class="mh">0x8</span><span class="p">];</span>
	<span class="n">__be32</span> <span class="n">lbcr</span><span class="p">;</span>            <span class="cm">/**&lt; Configuration Register */</span>
<span class="cp">#define LBCR_LDIS  0x80000000</span>
<span class="cp">#define LBCR_LDIS_SHIFT    31</span>
<span class="cp">#define LBCR_BCTLC 0x00C00000</span>
<span class="cp">#define LBCR_BCTLC_SHIFT   22</span>
<span class="cp">#define LBCR_AHD   0x00200000</span>
<span class="cp">#define LBCR_LPBSE 0x00020000</span>
<span class="cp">#define LBCR_LPBSE_SHIFT   17</span>
<span class="cp">#define LBCR_EPAR  0x00010000</span>
<span class="cp">#define LBCR_EPAR_SHIFT    16</span>
<span class="cp">#define LBCR_BMT   0x0000FF00</span>
<span class="cp">#define LBCR_BMT_SHIFT      8</span>
<span class="cp">#define LBCR_BMTPS 0x0000000F</span>
<span class="cp">#define LBCR_BMTPS_SHIFT    0</span>
<span class="cp">#define LBCR_INIT  0x00040000</span>
	<span class="n">__be32</span> <span class="n">lcrr</span><span class="p">;</span>            <span class="cm">/**&lt; Clock Ratio Register */</span>
<span class="cp">#define LCRR_DBYP    0x80000000</span>
<span class="cp">#define LCRR_DBYP_SHIFT      31</span>
<span class="cp">#define LCRR_BUFCMDC 0x30000000</span>
<span class="cp">#define LCRR_BUFCMDC_SHIFT   28</span>
<span class="cp">#define LCRR_ECL     0x03000000</span>
<span class="cp">#define LCRR_ECL_SHIFT       24</span>
<span class="cp">#define LCRR_EADC    0x00030000</span>
<span class="cp">#define LCRR_EADC_SHIFT      16</span>
<span class="cp">#define LCRR_CLKDIV  0x0000000F</span>
<span class="cp">#define LCRR_CLKDIV_SHIFT     0</span>
	<span class="n">u8</span> <span class="n">res7</span><span class="p">[</span><span class="mh">0x8</span><span class="p">];</span>
	<span class="n">__be32</span> <span class="n">fmr</span><span class="p">;</span>             <span class="cm">/**&lt; Flash Mode Register */</span>
<span class="cp">#define FMR_CWTO     0x0000F000</span>
<span class="cp">#define FMR_CWTO_SHIFT       12</span>
<span class="cp">#define FMR_BOOT     0x00000800</span>
<span class="cp">#define FMR_ECCM     0x00000100</span>
<span class="cp">#define FMR_AL       0x00000030</span>
<span class="cp">#define FMR_AL_SHIFT          4</span>
<span class="cp">#define FMR_OP       0x00000003</span>
<span class="cp">#define FMR_OP_SHIFT          0</span>
	<span class="n">__be32</span> <span class="n">fir</span><span class="p">;</span>             <span class="cm">/**&lt; Flash Instruction Register */</span>
<span class="cp">#define FIR_OP0      0xF0000000</span>
<span class="cp">#define FIR_OP0_SHIFT        28</span>
<span class="cp">#define FIR_OP1      0x0F000000</span>
<span class="cp">#define FIR_OP1_SHIFT        24</span>
<span class="cp">#define FIR_OP2      0x00F00000</span>
<span class="cp">#define FIR_OP2_SHIFT        20</span>
<span class="cp">#define FIR_OP3      0x000F0000</span>
<span class="cp">#define FIR_OP3_SHIFT        16</span>
<span class="cp">#define FIR_OP4      0x0000F000</span>
<span class="cp">#define FIR_OP4_SHIFT        12</span>
<span class="cp">#define FIR_OP5      0x00000F00</span>
<span class="cp">#define FIR_OP5_SHIFT         8</span>
<span class="cp">#define FIR_OP6      0x000000F0</span>
<span class="cp">#define FIR_OP6_SHIFT         4</span>
<span class="cp">#define FIR_OP7      0x0000000F</span>
<span class="cp">#define FIR_OP7_SHIFT         0</span>
<span class="cp">#define FIR_OP_NOP   0x0	</span><span class="cm">/* No operation and end of sequence */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_CA    0x1        </span><span class="cm">/* Issue current column address */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_PA    0x2        </span><span class="cm">/* Issue current block+page address */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_UA    0x3        </span><span class="cm">/* Issue user defined address */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_CM0   0x4        </span><span class="cm">/* Issue command from FCR[CMD0] */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_CM1   0x5        </span><span class="cm">/* Issue command from FCR[CMD1] */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_CM2   0x6        </span><span class="cm">/* Issue command from FCR[CMD2] */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_CM3   0x7        </span><span class="cm">/* Issue command from FCR[CMD3] */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_WB    0x8        </span><span class="cm">/* Write FBCR bytes from FCM buffer */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_WS    0x9        </span><span class="cm">/* Write 1 or 2 bytes from MDR[AS] */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_RB    0xA        </span><span class="cm">/* Read FBCR bytes to FCM buffer */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_RS    0xB        </span><span class="cm">/* Read 1 or 2 bytes to MDR[AS] */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_CW0   0xC        </span><span class="cm">/* Wait then issue FCR[CMD0] */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_CW1   0xD        </span><span class="cm">/* Wait then issue FCR[CMD1] */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_RBW   0xE        </span><span class="cm">/* Wait then read FBCR bytes */</span><span class="cp"></span>
<span class="cp">#define FIR_OP_RSW   0xE        </span><span class="cm">/* Wait then read 1 or 2 bytes */</span><span class="cp"></span>
	<span class="n">__be32</span> <span class="n">fcr</span><span class="p">;</span>             <span class="cm">/**&lt; Flash Command Register */</span>
<span class="cp">#define FCR_CMD0     0xFF000000</span>
<span class="cp">#define FCR_CMD0_SHIFT       24</span>
<span class="cp">#define FCR_CMD1     0x00FF0000</span>
<span class="cp">#define FCR_CMD1_SHIFT       16</span>
<span class="cp">#define FCR_CMD2     0x0000FF00</span>
<span class="cp">#define FCR_CMD2_SHIFT        8</span>
<span class="cp">#define FCR_CMD3     0x000000FF</span>
<span class="cp">#define FCR_CMD3_SHIFT        0</span>
	<span class="n">__be32</span> <span class="n">fbar</span><span class="p">;</span>            <span class="cm">/**&lt; Flash Block Address Register */</span>
<span class="cp">#define FBAR_BLK     0x00FFFFFF</span>
	<span class="n">__be32</span> <span class="n">fpar</span><span class="p">;</span>            <span class="cm">/**&lt; Flash Page Address Register */</span>
<span class="cp">#define FPAR_SP_PI   0x00007C00</span>
<span class="cp">#define FPAR_SP_PI_SHIFT     10</span>
<span class="cp">#define FPAR_SP_MS   0x00000200</span>
<span class="cp">#define FPAR_SP_CI   0x000001FF</span>
<span class="cp">#define FPAR_SP_CI_SHIFT      0</span>
<span class="cp">#define FPAR_LP_PI   0x0003F000</span>
<span class="cp">#define FPAR_LP_PI_SHIFT     12</span>
<span class="cp">#define FPAR_LP_MS   0x00000800</span>
<span class="cp">#define FPAR_LP_CI   0x000007FF</span>
<span class="cp">#define FPAR_LP_CI_SHIFT      0</span>
	<span class="n">__be32</span> <span class="n">fbcr</span><span class="p">;</span>            <span class="cm">/**&lt; Flash Byte Count Register */</span>
<span class="cp">#define FBCR_BC      0x00000FFF</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * FSL UPM routines</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fsl_upm</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mxmr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">width</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="n">u32</span> <span class="n">fsl_lbc_addr</span><span class="p">(</span><span class="n">phys_addr_t</span> <span class="n">addr_base</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fsl_lbc_find</span><span class="p">(</span><span class="n">phys_addr_t</span> <span class="n">addr_base</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fsl_upm_find</span><span class="p">(</span><span class="n">phys_addr_t</span> <span class="n">addr_base</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fsl_upm</span> <span class="o">*</span><span class="n">upm</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * fsl_upm_start_pattern - start UPM patterns execution</span>
<span class="cm"> * @upm:	pointer to the fsl_upm structure obtained via fsl_upm_find</span>
<span class="cm"> * @pat_offset:	UPM pattern offset for the command to be executed</span>
<span class="cm"> *</span>
<span class="cm"> * This routine programmes UPM so the next memory access that hits an UPM</span>
<span class="cm"> * will trigger pattern execution, starting at pat_offset.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">fsl_upm_start_pattern</span><span class="p">(</span><span class="k">struct</span> <span class="n">fsl_upm</span> <span class="o">*</span><span class="n">upm</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pat_offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">clrsetbits_be32</span><span class="p">(</span><span class="n">upm</span><span class="o">-&gt;</span><span class="n">mxmr</span><span class="p">,</span> <span class="n">MxMR_MAD</span><span class="p">,</span> <span class="n">MxMR_OP_RP</span> <span class="o">|</span> <span class="n">pat_offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * fsl_upm_end_pattern - end UPM patterns execution</span>
<span class="cm"> * @upm:	pointer to the fsl_upm structure obtained via fsl_upm_find</span>
<span class="cm"> *</span>
<span class="cm"> * This routine reverts UPM to normal operation mode.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">fsl_upm_end_pattern</span><span class="p">(</span><span class="k">struct</span> <span class="n">fsl_upm</span> <span class="o">*</span><span class="n">upm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">clrbits32</span><span class="p">(</span><span class="n">upm</span><span class="o">-&gt;</span><span class="n">mxmr</span><span class="p">,</span> <span class="n">MxMR_OP_RP</span><span class="p">);</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">in_be32</span><span class="p">(</span><span class="n">upm</span><span class="o">-&gt;</span><span class="n">mxmr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">MxMR_OP_RP</span><span class="p">)</span>
		<span class="n">cpu_relax</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/* overview of the fsl lbc controller */</span>

<span class="k">struct</span> <span class="n">fsl_lbc_ctrl</span> <span class="p">{</span>
	<span class="cm">/* device info */</span>
	<span class="k">struct</span> <span class="n">device</span>			<span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fsl_lbc_regs</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">regs</span><span class="p">;</span>
	<span class="kt">int</span>				<span class="n">irq</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span>		<span class="n">irq_wait</span><span class="p">;</span>
	<span class="n">spinlock_t</span>			<span class="n">lock</span><span class="p">;</span>
	<span class="kt">void</span>				<span class="o">*</span><span class="n">nand</span><span class="p">;</span>

	<span class="cm">/* status read from LTESR by irq handler */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>			<span class="n">irq_status</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_SUSPEND</span>
	<span class="cm">/* save regs when system go to deep-sleep */</span>
	<span class="k">struct</span> <span class="n">fsl_lbc_regs</span>		<span class="o">*</span><span class="n">saved_regs</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">fsl_upm_run_pattern</span><span class="p">(</span><span class="k">struct</span> <span class="n">fsl_upm</span> <span class="o">*</span><span class="n">upm</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">io_base</span><span class="p">,</span>
			       <span class="n">u32</span> <span class="n">mar</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">fsl_lbc_ctrl</span> <span class="o">*</span><span class="n">fsl_lbc_ctrl_dev</span><span class="p">;</span>

<span class="cp">#endif </span><span class="cm">/* __ASM_FSL_LBC_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
