<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › cpm.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>cpm.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __CPM_H</span>
<span class="cp">#define __CPM_H</span>

<span class="cp">#include &lt;linux/compiler.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/of.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * SPI Parameter RAM common to QE and CPM.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">spi_pram</span> <span class="p">{</span>
	<span class="n">__be16</span>	<span class="n">rbase</span><span class="p">;</span>	<span class="cm">/* Rx Buffer descriptor base address */</span>
	<span class="n">__be16</span>	<span class="n">tbase</span><span class="p">;</span>	<span class="cm">/* Tx Buffer descriptor base address */</span>
	<span class="n">u8</span>	<span class="n">rfcr</span><span class="p">;</span>	<span class="cm">/* Rx function code */</span>
	<span class="n">u8</span>	<span class="n">tfcr</span><span class="p">;</span>	<span class="cm">/* Tx function code */</span>
	<span class="n">__be16</span>	<span class="n">mrblr</span><span class="p">;</span>	<span class="cm">/* Max receive buffer length */</span>
	<span class="n">__be32</span>	<span class="n">rstate</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">__be32</span>	<span class="n">rdp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">__be16</span>	<span class="n">rbptr</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">__be16</span>	<span class="n">rbc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">__be32</span>	<span class="n">rxtmp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">__be32</span>	<span class="n">tstate</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">__be32</span>	<span class="n">tdp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">__be16</span>	<span class="n">tbptr</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">__be16</span>	<span class="n">tbc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">__be32</span>	<span class="n">txtmp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">__be32</span>	<span class="n">res</span><span class="p">;</span>	<span class="cm">/* Tx temp. */</span>
	<span class="n">__be16</span>  <span class="n">rpbase</span><span class="p">;</span>	<span class="cm">/* Relocation pointer (CPM1 only) */</span>
	<span class="n">__be16</span>	<span class="n">res1</span><span class="p">;</span>	<span class="cm">/* Reserved */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * USB Controller pram common to QE and CPM.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">usb_ctlr</span> <span class="p">{</span>
	<span class="n">u8</span>	<span class="n">usb_usmod</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">usb_usadr</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">usb_uscom</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">res1</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">__be16</span>	<span class="n">usb_usep</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span>	<span class="n">res2</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">__be16</span>	<span class="n">usb_usber</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">res3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">__be16</span>	<span class="n">usb_usbmr</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">res4</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">u8</span>	<span class="n">usb_usbs</span><span class="p">;</span>
	<span class="cm">/* Fields down below are QE-only */</span>
	<span class="n">__be16</span>	<span class="n">usb_ussft</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">res5</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">__be16</span>	<span class="n">usb_usfrn</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">res6</span><span class="p">[</span><span class="mh">0x22</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cm">/*</span>
<span class="cm"> * Function code bits, usually generic to devices.</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_CPM1</span>
<span class="cp">#define CPMFCR_GBL	((u_char)0x00)	</span><span class="cm">/* Flag doesn&#39;t exist in CPM1 */</span><span class="cp"></span>
<span class="cp">#define CPMFCR_TC2	((u_char)0x00)	</span><span class="cm">/* Flag doesn&#39;t exist in CPM1 */</span><span class="cp"></span>
<span class="cp">#define CPMFCR_DTB	((u_char)0x00)	</span><span class="cm">/* Flag doesn&#39;t exist in CPM1 */</span><span class="cp"></span>
<span class="cp">#define CPMFCR_BDB	((u_char)0x00)	</span><span class="cm">/* Flag doesn&#39;t exist in CPM1 */</span><span class="cp"></span>
<span class="cp">#else</span>
<span class="cp">#define CPMFCR_GBL	((u_char)0x20)	</span><span class="cm">/* Set memory snooping */</span><span class="cp"></span>
<span class="cp">#define CPMFCR_TC2	((u_char)0x04)	</span><span class="cm">/* Transfer code 2 value */</span><span class="cp"></span>
<span class="cp">#define CPMFCR_DTB	((u_char)0x02)	</span><span class="cm">/* Use local bus for data when set */</span><span class="cp"></span>
<span class="cp">#define CPMFCR_BDB	((u_char)0x01)	</span><span class="cm">/* Use local bus for BD when set */</span><span class="cp"></span>
<span class="cp">#endif</span>
<span class="cp">#define CPMFCR_EB	((u_char)0x10)	</span><span class="cm">/* Set big endian byte order */</span><span class="cp"></span>

<span class="cm">/* Opcodes common to CPM1 and CPM2</span>
<span class="cm">*/</span>
<span class="cp">#define CPM_CR_INIT_TRX		((ushort)0x0000)</span>
<span class="cp">#define CPM_CR_INIT_RX		((ushort)0x0001)</span>
<span class="cp">#define CPM_CR_INIT_TX		((ushort)0x0002)</span>
<span class="cp">#define CPM_CR_HUNT_MODE	((ushort)0x0003)</span>
<span class="cp">#define CPM_CR_STOP_TX		((ushort)0x0004)</span>
<span class="cp">#define CPM_CR_GRA_STOP_TX	((ushort)0x0005)</span>
<span class="cp">#define CPM_CR_RESTART_TX	((ushort)0x0006)</span>
<span class="cp">#define CPM_CR_CLOSE_RX_BD	((ushort)0x0007)</span>
<span class="cp">#define CPM_CR_SET_GADDR	((ushort)0x0008)</span>
<span class="cp">#define CPM_CR_SET_TIMER	((ushort)0x0008)</span>
<span class="cp">#define CPM_CR_STOP_IDMA	((ushort)0x000b)</span>

<span class="cm">/* Buffer descriptors used by many of the CPM protocols. */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">cpm_buf_desc</span> <span class="p">{</span>
	<span class="n">ushort</span>	<span class="n">cbd_sc</span><span class="p">;</span>		<span class="cm">/* Status and Control */</span>
	<span class="n">ushort</span>	<span class="n">cbd_datlen</span><span class="p">;</span>	<span class="cm">/* Data length in buffer */</span>
	<span class="n">uint</span>	<span class="n">cbd_bufaddr</span><span class="p">;</span>	<span class="cm">/* Buffer address in host memory */</span>
<span class="p">}</span> <span class="n">cbd_t</span><span class="p">;</span>

<span class="cm">/* Buffer descriptor control/status used by serial</span>
<span class="cm"> */</span>

<span class="cp">#define BD_SC_EMPTY	(0x8000)	</span><span class="cm">/* Receive is empty */</span><span class="cp"></span>
<span class="cp">#define BD_SC_READY	(0x8000)	</span><span class="cm">/* Transmit is ready */</span><span class="cp"></span>
<span class="cp">#define BD_SC_WRAP	(0x2000)	</span><span class="cm">/* Last buffer descriptor */</span><span class="cp"></span>
<span class="cp">#define BD_SC_INTRPT	(0x1000)	</span><span class="cm">/* Interrupt on change */</span><span class="cp"></span>
<span class="cp">#define BD_SC_LAST	(0x0800)	</span><span class="cm">/* Last buffer in frame */</span><span class="cp"></span>
<span class="cp">#define BD_SC_TC	(0x0400)	</span><span class="cm">/* Transmit CRC */</span><span class="cp"></span>
<span class="cp">#define BD_SC_CM	(0x0200)	</span><span class="cm">/* Continuous mode */</span><span class="cp"></span>
<span class="cp">#define BD_SC_ID	(0x0100)	</span><span class="cm">/* Rec&#39;d too many idles */</span><span class="cp"></span>
<span class="cp">#define BD_SC_P		(0x0100)	</span><span class="cm">/* xmt preamble */</span><span class="cp"></span>
<span class="cp">#define BD_SC_BR	(0x0020)	</span><span class="cm">/* Break received */</span><span class="cp"></span>
<span class="cp">#define BD_SC_FR	(0x0010)	</span><span class="cm">/* Framing error */</span><span class="cp"></span>
<span class="cp">#define BD_SC_PR	(0x0008)	</span><span class="cm">/* Parity error */</span><span class="cp"></span>
<span class="cp">#define BD_SC_NAK	(0x0004)	</span><span class="cm">/* NAK - did not respond */</span><span class="cp"></span>
<span class="cp">#define BD_SC_OV	(0x0002)	</span><span class="cm">/* Overrun */</span><span class="cp"></span>
<span class="cp">#define BD_SC_UN	(0x0002)	</span><span class="cm">/* Underrun */</span><span class="cp"></span>
<span class="cp">#define BD_SC_CD	(0x0001)	</span><span class="cm">/* */</span><span class="cp"></span>
<span class="cp">#define BD_SC_CL	(0x0001)	</span><span class="cm">/* Collision */</span><span class="cp"></span>

<span class="cm">/* Buffer descriptor control/status used by Ethernet receive.</span>
<span class="cm"> * Common to SCC and FCC.</span>
<span class="cm"> */</span>
<span class="cp">#define BD_ENET_RX_EMPTY	(0x8000)</span>
<span class="cp">#define BD_ENET_RX_WRAP		(0x2000)</span>
<span class="cp">#define BD_ENET_RX_INTR		(0x1000)</span>
<span class="cp">#define BD_ENET_RX_LAST		(0x0800)</span>
<span class="cp">#define BD_ENET_RX_FIRST	(0x0400)</span>
<span class="cp">#define BD_ENET_RX_MISS		(0x0100)</span>
<span class="cp">#define BD_ENET_RX_BC		(0x0080)	</span><span class="cm">/* FCC Only */</span><span class="cp"></span>
<span class="cp">#define BD_ENET_RX_MC		(0x0040)	</span><span class="cm">/* FCC Only */</span><span class="cp"></span>
<span class="cp">#define BD_ENET_RX_LG		(0x0020)</span>
<span class="cp">#define BD_ENET_RX_NO		(0x0010)</span>
<span class="cp">#define BD_ENET_RX_SH		(0x0008)</span>
<span class="cp">#define BD_ENET_RX_CR		(0x0004)</span>
<span class="cp">#define BD_ENET_RX_OV		(0x0002)</span>
<span class="cp">#define BD_ENET_RX_CL		(0x0001)</span>
<span class="cp">#define BD_ENET_RX_STATS	(0x01ff)	</span><span class="cm">/* All status bits */</span><span class="cp"></span>

<span class="cm">/* Buffer descriptor control/status used by Ethernet transmit.</span>
<span class="cm"> * Common to SCC and FCC.</span>
<span class="cm"> */</span>
<span class="cp">#define BD_ENET_TX_READY	(0x8000)</span>
<span class="cp">#define BD_ENET_TX_PAD		(0x4000)</span>
<span class="cp">#define BD_ENET_TX_WRAP		(0x2000)</span>
<span class="cp">#define BD_ENET_TX_INTR		(0x1000)</span>
<span class="cp">#define BD_ENET_TX_LAST		(0x0800)</span>
<span class="cp">#define BD_ENET_TX_TC		(0x0400)</span>
<span class="cp">#define BD_ENET_TX_DEF		(0x0200)</span>
<span class="cp">#define BD_ENET_TX_HB		(0x0100)</span>
<span class="cp">#define BD_ENET_TX_LC		(0x0080)</span>
<span class="cp">#define BD_ENET_TX_RL		(0x0040)</span>
<span class="cp">#define BD_ENET_TX_RCMASK	(0x003c)</span>
<span class="cp">#define BD_ENET_TX_UN		(0x0002)</span>
<span class="cp">#define BD_ENET_TX_CSL		(0x0001)</span>
<span class="cp">#define BD_ENET_TX_STATS	(0x03ff)	</span><span class="cm">/* All status bits */</span><span class="cp"></span>

<span class="cm">/* Buffer descriptor control/status used by Transparent mode SCC.</span>
<span class="cm"> */</span>
<span class="cp">#define BD_SCC_TX_LAST		(0x0800)</span>

<span class="cm">/* Buffer descriptor control/status used by I2C.</span>
<span class="cm"> */</span>
<span class="cp">#define BD_I2C_START		(0x0400)</span>

<span class="kt">int</span> <span class="n">cpm_muram_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#if defined(CONFIG_CPM) || defined(CONFIG_QUICC_ENGINE)</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpm_muram_alloc</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">align</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cpm_muram_free</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpm_muram_alloc_fixed</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">cpm_muram_addr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpm_muram_offset</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="n">dma_addr_t</span> <span class="n">cpm_muram_dma</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">cpm_muram_alloc</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">,</span>
					    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">align</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOSYS</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">cpm_muram_free</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOSYS</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">cpm_muram_alloc_fixed</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">,</span>
						  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOSYS</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">cpm_muram_addr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">cpm_muram_offset</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOSYS</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">dma_addr_t</span> <span class="nf">cpm_muram_dma</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* defined(CONFIG_CPM) || defined(CONFIG_QUICC_ENGINE) */</span><span class="cp"></span>

<span class="cp">#ifdef CONFIG_CPM</span>
<span class="kt">int</span> <span class="n">cpm_command</span><span class="p">(</span><span class="n">u32</span> <span class="n">command</span><span class="p">,</span> <span class="n">u8</span> <span class="n">opcode</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">cpm_command</span><span class="p">(</span><span class="n">u32</span> <span class="n">command</span><span class="p">,</span> <span class="n">u8</span> <span class="n">opcode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOSYS</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_CPM */</span><span class="cp"></span>

<span class="kt">int</span> <span class="n">cpm2_gpiochip_add32</span><span class="p">(</span><span class="k">struct</span> <span class="n">device_node</span> <span class="o">*</span><span class="n">np</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
