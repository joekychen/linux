<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › cpm1.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>cpm1.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * MPC8xx Communication Processor Module.</span>
<span class="cm"> * Copyright (c) 1997 Dan Malek (dmalek@jlc.net)</span>
<span class="cm"> *</span>
<span class="cm"> * This file contains structures and information for the communication</span>
<span class="cm"> * processor channels.  Some CPM control and status is available</span>
<span class="cm"> * through the MPC8xx internal memory map.  See immap.h for details.</span>
<span class="cm"> * This file only contains what I need for the moment, not the total</span>
<span class="cm"> * CPM capabilities.  I (or someone else) will add definitions as they</span>
<span class="cm"> * are needed.  -- Dan</span>
<span class="cm"> *</span>
<span class="cm"> * On the MBX board, EPPC-Bug loads CPM microcode into the first 512</span>
<span class="cm"> * bytes of the DP RAM and relocates the I2C parameter area to the</span>
<span class="cm"> * IDMA1 space.  The remaining DP RAM is available for buffer descriptors</span>
<span class="cm"> * or other use.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __CPM1__</span>
<span class="cp">#define __CPM1__</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;asm/8xx_immap.h&gt;</span>
<span class="cp">#include &lt;asm/ptrace.h&gt;</span>
<span class="cp">#include &lt;asm/cpm.h&gt;</span>

<span class="cm">/* CPM Command register.</span>
<span class="cm">*/</span>
<span class="cp">#define CPM_CR_RST	((ushort)0x8000)</span>
<span class="cp">#define CPM_CR_OPCODE	((ushort)0x0f00)</span>
<span class="cp">#define CPM_CR_CHAN	((ushort)0x00f0)</span>
<span class="cp">#define CPM_CR_FLG	((ushort)0x0001)</span>

<span class="cm">/* Channel numbers.</span>
<span class="cm">*/</span>
<span class="cp">#define CPM_CR_CH_SCC1		((ushort)0x0000)</span>
<span class="cp">#define CPM_CR_CH_I2C		((ushort)0x0001)	</span><span class="cm">/* I2C and IDMA1 */</span><span class="cp"></span>
<span class="cp">#define CPM_CR_CH_SCC2		((ushort)0x0004)</span>
<span class="cp">#define CPM_CR_CH_SPI		((ushort)0x0005)	</span><span class="cm">/* SPI / IDMA2 / Timers */</span><span class="cp"></span>
<span class="cp">#define CPM_CR_CH_TIMER		CPM_CR_CH_SPI</span>
<span class="cp">#define CPM_CR_CH_SCC3		((ushort)0x0008)</span>
<span class="cp">#define CPM_CR_CH_SMC1		((ushort)0x0009)	</span><span class="cm">/* SMC1 / DSP1 */</span><span class="cp"></span>
<span class="cp">#define CPM_CR_CH_SCC4		((ushort)0x000c)</span>
<span class="cp">#define CPM_CR_CH_SMC2		((ushort)0x000d)	</span><span class="cm">/* SMC2 / DSP2 */</span><span class="cp"></span>

<span class="cp">#define mk_cr_cmd(CH, CMD)	((CMD &lt;&lt; 8) | (CH &lt;&lt; 4))</span>

<span class="cm">/* Export the base address of the communication processor registers</span>
<span class="cm"> * and dual port ram.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="n">cpm8xx_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">cpmp</span><span class="p">;</span> <span class="cm">/* Pointer to comm processor */</span>

<span class="cp">#define cpm_dpalloc cpm_muram_alloc</span>
<span class="cp">#define cpm_dpfree cpm_muram_free</span>
<span class="cp">#define cpm_dpram_addr cpm_muram_addr</span>
<span class="cp">#define cpm_dpram_phys cpm_muram_dma</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">cpm_setbrg</span><span class="p">(</span><span class="n">uint</span> <span class="n">brg</span><span class="p">,</span> <span class="n">uint</span> <span class="n">rate</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">cpm_load_patch</span><span class="p">(</span><span class="n">cpm8xx_t</span> <span class="o">*</span><span class="n">cp</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">cpm_reset</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/* Parameter RAM offsets.</span>
<span class="cm">*/</span>
<span class="cp">#define PROFF_SCC1	((uint)0x0000)</span>
<span class="cp">#define PROFF_IIC	((uint)0x0080)</span>
<span class="cp">#define PROFF_SCC2	((uint)0x0100)</span>
<span class="cp">#define PROFF_SPI	((uint)0x0180)</span>
<span class="cp">#define PROFF_SCC3	((uint)0x0200)</span>
<span class="cp">#define PROFF_SMC1	((uint)0x0280)</span>
<span class="cp">#define PROFF_SCC4	((uint)0x0300)</span>
<span class="cp">#define PROFF_SMC2	((uint)0x0380)</span>

<span class="cm">/* Define enough so I can at least use the serial port as a UART.</span>
<span class="cm"> * The MBX uses SMC1 as the host serial port.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">smc_uart</span> <span class="p">{</span>
	<span class="n">ushort</span>	<span class="n">smc_rbase</span><span class="p">;</span>	<span class="cm">/* Rx Buffer descriptor base address */</span>
	<span class="n">ushort</span>	<span class="n">smc_tbase</span><span class="p">;</span>	<span class="cm">/* Tx Buffer descriptor base address */</span>
	<span class="n">u_char</span>	<span class="n">smc_rfcr</span><span class="p">;</span>	<span class="cm">/* Rx function code */</span>
	<span class="n">u_char</span>	<span class="n">smc_tfcr</span><span class="p">;</span>	<span class="cm">/* Tx function code */</span>
	<span class="n">ushort</span>	<span class="n">smc_mrblr</span><span class="p">;</span>	<span class="cm">/* Max receive buffer length */</span>
	<span class="n">uint</span>	<span class="n">smc_rstate</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">smc_idp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">smc_rbptr</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">smc_ibc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">smc_rxtmp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">smc_tstate</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">smc_tdp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">smc_tbptr</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">smc_tbc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">smc_txtmp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">smc_maxidl</span><span class="p">;</span>	<span class="cm">/* Maximum idle characters */</span>
	<span class="n">ushort</span>	<span class="n">smc_tmpidl</span><span class="p">;</span>	<span class="cm">/* Temporary idle counter */</span>
	<span class="n">ushort</span>	<span class="n">smc_brklen</span><span class="p">;</span>	<span class="cm">/* Last received break length */</span>
	<span class="n">ushort</span>	<span class="n">smc_brkec</span><span class="p">;</span>	<span class="cm">/* rcv&#39;d break condition counter */</span>
	<span class="n">ushort</span>	<span class="n">smc_brkcr</span><span class="p">;</span>	<span class="cm">/* xmt break count register */</span>
	<span class="n">ushort</span>	<span class="n">smc_rmask</span><span class="p">;</span>	<span class="cm">/* Temporary bit mask */</span>
	<span class="kt">char</span>	<span class="n">res1</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>	<span class="cm">/* Reserved */</span>
	<span class="n">ushort</span>	<span class="n">smc_rpbase</span><span class="p">;</span>	<span class="cm">/* Relocation pointer */</span>
<span class="p">}</span> <span class="n">smc_uart_t</span><span class="p">;</span>

<span class="cm">/* Function code bits.</span>
<span class="cm">*/</span>
<span class="cp">#define SMC_EB	((u_char)0x10)	</span><span class="cm">/* Set big endian byte order */</span><span class="cp"></span>

<span class="cm">/* SMC uart mode register.</span>
<span class="cm">*/</span>
<span class="cp">#define	SMCMR_REN	((ushort)0x0001)</span>
<span class="cp">#define SMCMR_TEN	((ushort)0x0002)</span>
<span class="cp">#define SMCMR_DM	((ushort)0x000c)</span>
<span class="cp">#define SMCMR_SM_GCI	((ushort)0x0000)</span>
<span class="cp">#define SMCMR_SM_UART	((ushort)0x0020)</span>
<span class="cp">#define SMCMR_SM_TRANS	((ushort)0x0030)</span>
<span class="cp">#define SMCMR_SM_MASK	((ushort)0x0030)</span>
<span class="cp">#define SMCMR_PM_EVEN	((ushort)0x0100)	</span><span class="cm">/* Even parity, else odd */</span><span class="cp"></span>
<span class="cp">#define SMCMR_REVD	SMCMR_PM_EVEN</span>
<span class="cp">#define SMCMR_PEN	((ushort)0x0200)	</span><span class="cm">/* Parity enable */</span><span class="cp"></span>
<span class="cp">#define SMCMR_BS	SMCMR_PEN</span>
<span class="cp">#define SMCMR_SL	((ushort)0x0400)	</span><span class="cm">/* Two stops, else one */</span><span class="cp"></span>
<span class="cp">#define SMCR_CLEN_MASK	((ushort)0x7800)	</span><span class="cm">/* Character length */</span><span class="cp"></span>
<span class="cp">#define smcr_mk_clen(C)	(((C) &lt;&lt; 11) &amp; SMCR_CLEN_MASK)</span>

<span class="cm">/* SMC2 as Centronics parallel printer.  It is half duplex, in that</span>
<span class="cm"> * it can only receive or transmit.  The parameter ram values for</span>
<span class="cm"> * each direction are either unique or properly overlap, so we can</span>
<span class="cm"> * include them in one structure.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">smc_centronics</span> <span class="p">{</span>
	<span class="n">ushort</span>	<span class="n">scent_rbase</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_tbase</span><span class="p">;</span>
	<span class="n">u_char</span>	<span class="n">scent_cfcr</span><span class="p">;</span>
	<span class="n">u_char</span>	<span class="n">scent_smask</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_mrblr</span><span class="p">;</span>
	<span class="n">uint</span>	<span class="n">scent_rstate</span><span class="p">;</span>
	<span class="n">uint</span>	<span class="n">scent_r_ptr</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_rbptr</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_r_cnt</span><span class="p">;</span>
	<span class="n">uint</span>	<span class="n">scent_rtemp</span><span class="p">;</span>
	<span class="n">uint</span>	<span class="n">scent_tstate</span><span class="p">;</span>
	<span class="n">uint</span>	<span class="n">scent_t_ptr</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_tbptr</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_t_cnt</span><span class="p">;</span>
	<span class="n">uint</span>	<span class="n">scent_ttemp</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_max_sl</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_sl_cnt</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_character1</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_character2</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_character3</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_character4</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_character5</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_character6</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_character7</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_character8</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_rccm</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">scent_rccr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">smc_cent_t</span><span class="p">;</span>

<span class="cm">/* Centronics Status Mask Register.</span>
<span class="cm">*/</span>
<span class="cp">#define SMC_CENT_F	((u_char)0x08)</span>
<span class="cp">#define SMC_CENT_PE	((u_char)0x04)</span>
<span class="cp">#define SMC_CENT_S	((u_char)0x02)</span>

<span class="cm">/* SMC Event and Mask register.</span>
<span class="cm">*/</span>
<span class="cp">#define	SMCM_BRKE	((unsigned char)0x40)	</span><span class="cm">/* When in UART Mode */</span><span class="cp"></span>
<span class="cp">#define	SMCM_BRK	((unsigned char)0x10)	</span><span class="cm">/* When in UART Mode */</span><span class="cp"></span>
<span class="cp">#define	SMCM_TXE	((unsigned char)0x10)	</span><span class="cm">/* When in Transparent Mode */</span><span class="cp"></span>
<span class="cp">#define	SMCM_BSY	((unsigned char)0x04)</span>
<span class="cp">#define	SMCM_TX		((unsigned char)0x02)</span>
<span class="cp">#define	SMCM_RX		((unsigned char)0x01)</span>

<span class="cm">/* Baud rate generators.</span>
<span class="cm">*/</span>
<span class="cp">#define CPM_BRG_RST		((uint)0x00020000)</span>
<span class="cp">#define CPM_BRG_EN		((uint)0x00010000)</span>
<span class="cp">#define CPM_BRG_EXTC_INT	((uint)0x00000000)</span>
<span class="cp">#define CPM_BRG_EXTC_CLK2	((uint)0x00004000)</span>
<span class="cp">#define CPM_BRG_EXTC_CLK6	((uint)0x00008000)</span>
<span class="cp">#define CPM_BRG_ATB		((uint)0x00002000)</span>
<span class="cp">#define CPM_BRG_CD_MASK		((uint)0x00001ffe)</span>
<span class="cp">#define CPM_BRG_DIV16		((uint)0x00000001)</span>

<span class="cm">/* SI Clock Route Register</span>
<span class="cm">*/</span>
<span class="cp">#define SICR_RCLK_SCC1_BRG1	((uint)0x00000000)</span>
<span class="cp">#define SICR_TCLK_SCC1_BRG1	((uint)0x00000000)</span>
<span class="cp">#define SICR_RCLK_SCC2_BRG2	((uint)0x00000800)</span>
<span class="cp">#define SICR_TCLK_SCC2_BRG2	((uint)0x00000100)</span>
<span class="cp">#define SICR_RCLK_SCC3_BRG3	((uint)0x00100000)</span>
<span class="cp">#define SICR_TCLK_SCC3_BRG3	((uint)0x00020000)</span>
<span class="cp">#define SICR_RCLK_SCC4_BRG4	((uint)0x18000000)</span>
<span class="cp">#define SICR_TCLK_SCC4_BRG4	((uint)0x03000000)</span>

<span class="cm">/* SCCs.</span>
<span class="cm">*/</span>
<span class="cp">#define SCC_GSMRH_IRP		((uint)0x00040000)</span>
<span class="cp">#define SCC_GSMRH_GDE		((uint)0x00010000)</span>
<span class="cp">#define SCC_GSMRH_TCRC_CCITT	((uint)0x00008000)</span>
<span class="cp">#define SCC_GSMRH_TCRC_BISYNC	((uint)0x00004000)</span>
<span class="cp">#define SCC_GSMRH_TCRC_HDLC	((uint)0x00000000)</span>
<span class="cp">#define SCC_GSMRH_REVD		((uint)0x00002000)</span>
<span class="cp">#define SCC_GSMRH_TRX		((uint)0x00001000)</span>
<span class="cp">#define SCC_GSMRH_TTX		((uint)0x00000800)</span>
<span class="cp">#define SCC_GSMRH_CDP		((uint)0x00000400)</span>
<span class="cp">#define SCC_GSMRH_CTSP		((uint)0x00000200)</span>
<span class="cp">#define SCC_GSMRH_CDS		((uint)0x00000100)</span>
<span class="cp">#define SCC_GSMRH_CTSS		((uint)0x00000080)</span>
<span class="cp">#define SCC_GSMRH_TFL		((uint)0x00000040)</span>
<span class="cp">#define SCC_GSMRH_RFW		((uint)0x00000020)</span>
<span class="cp">#define SCC_GSMRH_TXSY		((uint)0x00000010)</span>
<span class="cp">#define SCC_GSMRH_SYNL16	((uint)0x0000000c)</span>
<span class="cp">#define SCC_GSMRH_SYNL8		((uint)0x00000008)</span>
<span class="cp">#define SCC_GSMRH_SYNL4		((uint)0x00000004)</span>
<span class="cp">#define SCC_GSMRH_RTSM		((uint)0x00000002)</span>
<span class="cp">#define SCC_GSMRH_RSYN		((uint)0x00000001)</span>

<span class="cp">#define SCC_GSMRL_SIR		((uint)0x80000000)	</span><span class="cm">/* SCC2 only */</span><span class="cp"></span>
<span class="cp">#define SCC_GSMRL_EDGE_NONE	((uint)0x60000000)</span>
<span class="cp">#define SCC_GSMRL_EDGE_NEG	((uint)0x40000000)</span>
<span class="cp">#define SCC_GSMRL_EDGE_POS	((uint)0x20000000)</span>
<span class="cp">#define SCC_GSMRL_EDGE_BOTH	((uint)0x00000000)</span>
<span class="cp">#define SCC_GSMRL_TCI		((uint)0x10000000)</span>
<span class="cp">#define SCC_GSMRL_TSNC_3	((uint)0x0c000000)</span>
<span class="cp">#define SCC_GSMRL_TSNC_4	((uint)0x08000000)</span>
<span class="cp">#define SCC_GSMRL_TSNC_14	((uint)0x04000000)</span>
<span class="cp">#define SCC_GSMRL_TSNC_INF	((uint)0x00000000)</span>
<span class="cp">#define SCC_GSMRL_RINV		((uint)0x02000000)</span>
<span class="cp">#define SCC_GSMRL_TINV		((uint)0x01000000)</span>
<span class="cp">#define SCC_GSMRL_TPL_128	((uint)0x00c00000)</span>
<span class="cp">#define SCC_GSMRL_TPL_64	((uint)0x00a00000)</span>
<span class="cp">#define SCC_GSMRL_TPL_48	((uint)0x00800000)</span>
<span class="cp">#define SCC_GSMRL_TPL_32	((uint)0x00600000)</span>
<span class="cp">#define SCC_GSMRL_TPL_16	((uint)0x00400000)</span>
<span class="cp">#define SCC_GSMRL_TPL_8		((uint)0x00200000)</span>
<span class="cp">#define SCC_GSMRL_TPL_NONE	((uint)0x00000000)</span>
<span class="cp">#define SCC_GSMRL_TPP_ALL1	((uint)0x00180000)</span>
<span class="cp">#define SCC_GSMRL_TPP_01	((uint)0x00100000)</span>
<span class="cp">#define SCC_GSMRL_TPP_10	((uint)0x00080000)</span>
<span class="cp">#define SCC_GSMRL_TPP_ZEROS	((uint)0x00000000)</span>
<span class="cp">#define SCC_GSMRL_TEND		((uint)0x00040000)</span>
<span class="cp">#define SCC_GSMRL_TDCR_32	((uint)0x00030000)</span>
<span class="cp">#define SCC_GSMRL_TDCR_16	((uint)0x00020000)</span>
<span class="cp">#define SCC_GSMRL_TDCR_8	((uint)0x00010000)</span>
<span class="cp">#define SCC_GSMRL_TDCR_1	((uint)0x00000000)</span>
<span class="cp">#define SCC_GSMRL_RDCR_32	((uint)0x0000c000)</span>
<span class="cp">#define SCC_GSMRL_RDCR_16	((uint)0x00008000)</span>
<span class="cp">#define SCC_GSMRL_RDCR_8	((uint)0x00004000)</span>
<span class="cp">#define SCC_GSMRL_RDCR_1	((uint)0x00000000)</span>
<span class="cp">#define SCC_GSMRL_RENC_DFMAN	((uint)0x00003000)</span>
<span class="cp">#define SCC_GSMRL_RENC_MANCH	((uint)0x00002000)</span>
<span class="cp">#define SCC_GSMRL_RENC_FM0	((uint)0x00001000)</span>
<span class="cp">#define SCC_GSMRL_RENC_NRZI	((uint)0x00000800)</span>
<span class="cp">#define SCC_GSMRL_RENC_NRZ	((uint)0x00000000)</span>
<span class="cp">#define SCC_GSMRL_TENC_DFMAN	((uint)0x00000600)</span>
<span class="cp">#define SCC_GSMRL_TENC_MANCH	((uint)0x00000400)</span>
<span class="cp">#define SCC_GSMRL_TENC_FM0	((uint)0x00000200)</span>
<span class="cp">#define SCC_GSMRL_TENC_NRZI	((uint)0x00000100)</span>
<span class="cp">#define SCC_GSMRL_TENC_NRZ	((uint)0x00000000)</span>
<span class="cp">#define SCC_GSMRL_DIAG_LE	((uint)0x000000c0)	</span><span class="cm">/* Loop and echo */</span><span class="cp"></span>
<span class="cp">#define SCC_GSMRL_DIAG_ECHO	((uint)0x00000080)</span>
<span class="cp">#define SCC_GSMRL_DIAG_LOOP	((uint)0x00000040)</span>
<span class="cp">#define SCC_GSMRL_DIAG_NORM	((uint)0x00000000)</span>
<span class="cp">#define SCC_GSMRL_ENR		((uint)0x00000020)</span>
<span class="cp">#define SCC_GSMRL_ENT		((uint)0x00000010)</span>
<span class="cp">#define SCC_GSMRL_MODE_ENET	((uint)0x0000000c)</span>
<span class="cp">#define SCC_GSMRL_MODE_QMC	((uint)0x0000000a)</span>
<span class="cp">#define SCC_GSMRL_MODE_DDCMP	((uint)0x00000009)</span>
<span class="cp">#define SCC_GSMRL_MODE_BISYNC	((uint)0x00000008)</span>
<span class="cp">#define SCC_GSMRL_MODE_V14	((uint)0x00000007)</span>
<span class="cp">#define SCC_GSMRL_MODE_AHDLC	((uint)0x00000006)</span>
<span class="cp">#define SCC_GSMRL_MODE_PROFIBUS	((uint)0x00000005)</span>
<span class="cp">#define SCC_GSMRL_MODE_UART	((uint)0x00000004)</span>
<span class="cp">#define SCC_GSMRL_MODE_SS7	((uint)0x00000003)</span>
<span class="cp">#define SCC_GSMRL_MODE_ATALK	((uint)0x00000002)</span>
<span class="cp">#define SCC_GSMRL_MODE_HDLC	((uint)0x00000000)</span>

<span class="cp">#define SCC_TODR_TOD		((ushort)0x8000)</span>

<span class="cm">/* SCC Event and Mask register.</span>
<span class="cm">*/</span>
<span class="cp">#define	SCCM_TXE	((unsigned char)0x10)</span>
<span class="cp">#define	SCCM_BSY	((unsigned char)0x04)</span>
<span class="cp">#define	SCCM_TX		((unsigned char)0x02)</span>
<span class="cp">#define	SCCM_RX		((unsigned char)0x01)</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">scc_param</span> <span class="p">{</span>
	<span class="n">ushort</span>	<span class="n">scc_rbase</span><span class="p">;</span>	<span class="cm">/* Rx Buffer descriptor base address */</span>
	<span class="n">ushort</span>	<span class="n">scc_tbase</span><span class="p">;</span>	<span class="cm">/* Tx Buffer descriptor base address */</span>
	<span class="n">u_char</span>	<span class="n">scc_rfcr</span><span class="p">;</span>	<span class="cm">/* Rx function code */</span>
	<span class="n">u_char</span>	<span class="n">scc_tfcr</span><span class="p">;</span>	<span class="cm">/* Tx function code */</span>
	<span class="n">ushort</span>	<span class="n">scc_mrblr</span><span class="p">;</span>	<span class="cm">/* Max receive buffer length */</span>
	<span class="n">uint</span>	<span class="n">scc_rstate</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">scc_idp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">scc_rbptr</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">scc_ibc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">scc_rxtmp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">scc_tstate</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">scc_tdp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">scc_tbptr</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">scc_tbc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">scc_txtmp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">scc_rcrc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">scc_tcrc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
<span class="p">}</span> <span class="n">sccp_t</span><span class="p">;</span>

<span class="cm">/* Function code bits.</span>
<span class="cm">*/</span>
<span class="cp">#define SCC_EB	((u_char)0x10)	</span><span class="cm">/* Set big endian byte order */</span><span class="cp"></span>

<span class="cm">/* CPM Ethernet through SCCx.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">scc_enet</span> <span class="p">{</span>
	<span class="n">sccp_t</span>	<span class="n">sen_genscc</span><span class="p">;</span>
	<span class="n">uint</span>	<span class="n">sen_cpres</span><span class="p">;</span>	<span class="cm">/* Preset CRC */</span>
	<span class="n">uint</span>	<span class="n">sen_cmask</span><span class="p">;</span>	<span class="cm">/* Constant mask for CRC */</span>
	<span class="n">uint</span>	<span class="n">sen_crcec</span><span class="p">;</span>	<span class="cm">/* CRC Error counter */</span>
	<span class="n">uint</span>	<span class="n">sen_alec</span><span class="p">;</span>	<span class="cm">/* alignment error counter */</span>
	<span class="n">uint</span>	<span class="n">sen_disfc</span><span class="p">;</span>	<span class="cm">/* discard frame counter */</span>
	<span class="n">ushort</span>	<span class="n">sen_pads</span><span class="p">;</span>	<span class="cm">/* Tx short frame pad character */</span>
	<span class="n">ushort</span>	<span class="n">sen_retlim</span><span class="p">;</span>	<span class="cm">/* Retry limit threshold */</span>
	<span class="n">ushort</span>	<span class="n">sen_retcnt</span><span class="p">;</span>	<span class="cm">/* Retry limit counter */</span>
	<span class="n">ushort</span>	<span class="n">sen_maxflr</span><span class="p">;</span>	<span class="cm">/* maximum frame length register */</span>
	<span class="n">ushort</span>	<span class="n">sen_minflr</span><span class="p">;</span>	<span class="cm">/* minimum frame length register */</span>
	<span class="n">ushort</span>	<span class="n">sen_maxd1</span><span class="p">;</span>	<span class="cm">/* maximum DMA1 length */</span>
	<span class="n">ushort</span>	<span class="n">sen_maxd2</span><span class="p">;</span>	<span class="cm">/* maximum DMA2 length */</span>
	<span class="n">ushort</span>	<span class="n">sen_maxd</span><span class="p">;</span>	<span class="cm">/* Rx max DMA */</span>
	<span class="n">ushort</span>	<span class="n">sen_dmacnt</span><span class="p">;</span>	<span class="cm">/* Rx DMA counter */</span>
	<span class="n">ushort</span>	<span class="n">sen_maxb</span><span class="p">;</span>	<span class="cm">/* Max BD byte count */</span>
	<span class="n">ushort</span>	<span class="n">sen_gaddr1</span><span class="p">;</span>	<span class="cm">/* Group address filter */</span>
	<span class="n">ushort</span>	<span class="n">sen_gaddr2</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">sen_gaddr3</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">sen_gaddr4</span><span class="p">;</span>
	<span class="n">uint</span>	<span class="n">sen_tbuf0data0</span><span class="p">;</span>	<span class="cm">/* Save area 0 - current frame */</span>
	<span class="n">uint</span>	<span class="n">sen_tbuf0data1</span><span class="p">;</span>	<span class="cm">/* Save area 1 - current frame */</span>
	<span class="n">uint</span>	<span class="n">sen_tbuf0rba</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">sen_tbuf0crc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">sen_tbuf0bcnt</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">sen_paddrh</span><span class="p">;</span>	<span class="cm">/* physical address (MSB) */</span>
	<span class="n">ushort</span>	<span class="n">sen_paddrm</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">sen_paddrl</span><span class="p">;</span>	<span class="cm">/* physical address (LSB) */</span>
	<span class="n">ushort</span>	<span class="n">sen_pper</span><span class="p">;</span>	<span class="cm">/* persistence */</span>
	<span class="n">ushort</span>	<span class="n">sen_rfbdptr</span><span class="p">;</span>	<span class="cm">/* Rx first BD pointer */</span>
	<span class="n">ushort</span>	<span class="n">sen_tfbdptr</span><span class="p">;</span>	<span class="cm">/* Tx first BD pointer */</span>
	<span class="n">ushort</span>	<span class="n">sen_tlbdptr</span><span class="p">;</span>	<span class="cm">/* Tx last BD pointer */</span>
	<span class="n">uint</span>	<span class="n">sen_tbuf1data0</span><span class="p">;</span>	<span class="cm">/* Save area 0 - current frame */</span>
	<span class="n">uint</span>	<span class="n">sen_tbuf1data1</span><span class="p">;</span>	<span class="cm">/* Save area 1 - current frame */</span>
	<span class="n">uint</span>	<span class="n">sen_tbuf1rba</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">sen_tbuf1crc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">sen_tbuf1bcnt</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">sen_txlen</span><span class="p">;</span>	<span class="cm">/* Tx Frame length counter */</span>
	<span class="n">ushort</span>	<span class="n">sen_iaddr1</span><span class="p">;</span>	<span class="cm">/* Individual address filter */</span>
	<span class="n">ushort</span>	<span class="n">sen_iaddr2</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">sen_iaddr3</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">sen_iaddr4</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">sen_boffcnt</span><span class="p">;</span>	<span class="cm">/* Backoff counter */</span>

	<span class="cm">/* NOTE: Some versions of the manual have the following items</span>
<span class="cm">	 * incorrectly documented.  Below is the proper order.</span>
<span class="cm">	 */</span>
	<span class="n">ushort</span>	<span class="n">sen_taddrh</span><span class="p">;</span>	<span class="cm">/* temp address (MSB) */</span>
	<span class="n">ushort</span>	<span class="n">sen_taddrm</span><span class="p">;</span>
	<span class="n">ushort</span>	<span class="n">sen_taddrl</span><span class="p">;</span>	<span class="cm">/* temp address (LSB) */</span>
<span class="p">}</span> <span class="n">scc_enet_t</span><span class="p">;</span>

<span class="cm">/* SCC Event register as used by Ethernet.</span>
<span class="cm">*/</span>
<span class="cp">#define SCCE_ENET_GRA	((ushort)0x0080)	</span><span class="cm">/* Graceful stop complete */</span><span class="cp"></span>
<span class="cp">#define SCCE_ENET_TXE	((ushort)0x0010)	</span><span class="cm">/* Transmit Error */</span><span class="cp"></span>
<span class="cp">#define SCCE_ENET_RXF	((ushort)0x0008)	</span><span class="cm">/* Full frame received */</span><span class="cp"></span>
<span class="cp">#define SCCE_ENET_BSY	((ushort)0x0004)	</span><span class="cm">/* All incoming buffers full */</span><span class="cp"></span>
<span class="cp">#define SCCE_ENET_TXB	((ushort)0x0002)	</span><span class="cm">/* A buffer was transmitted */</span><span class="cp"></span>
<span class="cp">#define SCCE_ENET_RXB	((ushort)0x0001)	</span><span class="cm">/* A buffer was received */</span><span class="cp"></span>

<span class="cm">/* SCC Mode Register (PMSR) as used by Ethernet.</span>
<span class="cm">*/</span>
<span class="cp">#define SCC_PSMR_HBC	((ushort)0x8000)	</span><span class="cm">/* Enable heartbeat */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_FC	((ushort)0x4000)	</span><span class="cm">/* Force collision */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_RSH	((ushort)0x2000)	</span><span class="cm">/* Receive short frames */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_IAM	((ushort)0x1000)	</span><span class="cm">/* Check individual hash */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_ENCRC	((ushort)0x0800)	</span><span class="cm">/* Ethernet CRC mode */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_PRO	((ushort)0x0200)	</span><span class="cm">/* Promiscuous mode */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_BRO	((ushort)0x0100)	</span><span class="cm">/* Catch broadcast pkts */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_SBT	((ushort)0x0080)	</span><span class="cm">/* Special backoff timer */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_LPB	((ushort)0x0040)	</span><span class="cm">/* Set Loopback mode */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_SIP	((ushort)0x0020)	</span><span class="cm">/* Sample Input Pins */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_LCW	((ushort)0x0010)	</span><span class="cm">/* Late collision window */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_NIB22	((ushort)0x000a)	</span><span class="cm">/* Start frame search */</span><span class="cp"></span>
<span class="cp">#define SCC_PSMR_FDE	((ushort)0x0001)	</span><span class="cm">/* Full duplex enable */</span><span class="cp"></span>

<span class="cm">/* SCC as UART</span>
<span class="cm">*/</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">scc_uart</span> <span class="p">{</span>
	<span class="n">sccp_t</span>	<span class="n">scc_genscc</span><span class="p">;</span>
	<span class="kt">char</span>	<span class="n">res1</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>	<span class="cm">/* Reserved */</span>
	<span class="n">ushort</span>	<span class="n">scc_maxidl</span><span class="p">;</span>	<span class="cm">/* Maximum idle chars */</span>
	<span class="n">ushort</span>	<span class="n">scc_idlc</span><span class="p">;</span>	<span class="cm">/* temp idle counter */</span>
	<span class="n">ushort</span>	<span class="n">scc_brkcr</span><span class="p">;</span>	<span class="cm">/* Break count register */</span>
	<span class="n">ushort</span>	<span class="n">scc_parec</span><span class="p">;</span>	<span class="cm">/* receive parity error counter */</span>
	<span class="n">ushort</span>	<span class="n">scc_frmec</span><span class="p">;</span>	<span class="cm">/* receive framing error counter */</span>
	<span class="n">ushort</span>	<span class="n">scc_nosec</span><span class="p">;</span>	<span class="cm">/* receive noise counter */</span>
	<span class="n">ushort</span>	<span class="n">scc_brkec</span><span class="p">;</span>	<span class="cm">/* receive break condition counter */</span>
	<span class="n">ushort</span>	<span class="n">scc_brkln</span><span class="p">;</span>	<span class="cm">/* last received break length */</span>
	<span class="n">ushort</span>	<span class="n">scc_uaddr1</span><span class="p">;</span>	<span class="cm">/* UART address character 1 */</span>
	<span class="n">ushort</span>	<span class="n">scc_uaddr2</span><span class="p">;</span>	<span class="cm">/* UART address character 2 */</span>
	<span class="n">ushort</span>	<span class="n">scc_rtemp</span><span class="p">;</span>	<span class="cm">/* Temp storage */</span>
	<span class="n">ushort</span>	<span class="n">scc_toseq</span><span class="p">;</span>	<span class="cm">/* Transmit out of sequence char */</span>
	<span class="n">ushort</span>	<span class="n">scc_char1</span><span class="p">;</span>	<span class="cm">/* control character 1 */</span>
	<span class="n">ushort</span>	<span class="n">scc_char2</span><span class="p">;</span>	<span class="cm">/* control character 2 */</span>
	<span class="n">ushort</span>	<span class="n">scc_char3</span><span class="p">;</span>	<span class="cm">/* control character 3 */</span>
	<span class="n">ushort</span>	<span class="n">scc_char4</span><span class="p">;</span>	<span class="cm">/* control character 4 */</span>
	<span class="n">ushort</span>	<span class="n">scc_char5</span><span class="p">;</span>	<span class="cm">/* control character 5 */</span>
	<span class="n">ushort</span>	<span class="n">scc_char6</span><span class="p">;</span>	<span class="cm">/* control character 6 */</span>
	<span class="n">ushort</span>	<span class="n">scc_char7</span><span class="p">;</span>	<span class="cm">/* control character 7 */</span>
	<span class="n">ushort</span>	<span class="n">scc_char8</span><span class="p">;</span>	<span class="cm">/* control character 8 */</span>
	<span class="n">ushort</span>	<span class="n">scc_rccm</span><span class="p">;</span>	<span class="cm">/* receive control character mask */</span>
	<span class="n">ushort</span>	<span class="n">scc_rccr</span><span class="p">;</span>	<span class="cm">/* receive control character register */</span>
	<span class="n">ushort</span>	<span class="n">scc_rlbc</span><span class="p">;</span>	<span class="cm">/* receive last break character */</span>
<span class="p">}</span> <span class="n">scc_uart_t</span><span class="p">;</span>

<span class="cm">/* SCC Event and Mask registers when it is used as a UART.</span>
<span class="cm">*/</span>
<span class="cp">#define UART_SCCM_GLR		((ushort)0x1000)</span>
<span class="cp">#define UART_SCCM_GLT		((ushort)0x0800)</span>
<span class="cp">#define UART_SCCM_AB		((ushort)0x0200)</span>
<span class="cp">#define UART_SCCM_IDL		((ushort)0x0100)</span>
<span class="cp">#define UART_SCCM_GRA		((ushort)0x0080)</span>
<span class="cp">#define UART_SCCM_BRKE		((ushort)0x0040)</span>
<span class="cp">#define UART_SCCM_BRKS		((ushort)0x0020)</span>
<span class="cp">#define UART_SCCM_CCR		((ushort)0x0008)</span>
<span class="cp">#define UART_SCCM_BSY		((ushort)0x0004)</span>
<span class="cp">#define UART_SCCM_TX		((ushort)0x0002)</span>
<span class="cp">#define UART_SCCM_RX		((ushort)0x0001)</span>

<span class="cm">/* The SCC PMSR when used as a UART.</span>
<span class="cm">*/</span>
<span class="cp">#define SCU_PSMR_FLC		((ushort)0x8000)</span>
<span class="cp">#define SCU_PSMR_SL		((ushort)0x4000)</span>
<span class="cp">#define SCU_PSMR_CL		((ushort)0x3000)</span>
<span class="cp">#define SCU_PSMR_UM		((ushort)0x0c00)</span>
<span class="cp">#define SCU_PSMR_FRZ		((ushort)0x0200)</span>
<span class="cp">#define SCU_PSMR_RZS		((ushort)0x0100)</span>
<span class="cp">#define SCU_PSMR_SYN		((ushort)0x0080)</span>
<span class="cp">#define SCU_PSMR_DRT		((ushort)0x0040)</span>
<span class="cp">#define SCU_PSMR_PEN		((ushort)0x0010)</span>
<span class="cp">#define SCU_PSMR_RPM		((ushort)0x000c)</span>
<span class="cp">#define SCU_PSMR_REVP		((ushort)0x0008)</span>
<span class="cp">#define SCU_PSMR_TPM		((ushort)0x0003)</span>
<span class="cp">#define SCU_PSMR_TEVP		((ushort)0x0002)</span>

<span class="cm">/* CPM Transparent mode SCC.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">scc_trans</span> <span class="p">{</span>
	<span class="n">sccp_t</span>	<span class="n">st_genscc</span><span class="p">;</span>
	<span class="n">uint</span>	<span class="n">st_cpres</span><span class="p">;</span>	<span class="cm">/* Preset CRC */</span>
	<span class="n">uint</span>	<span class="n">st_cmask</span><span class="p">;</span>	<span class="cm">/* Constant mask for CRC */</span>
<span class="p">}</span> <span class="n">scc_trans_t</span><span class="p">;</span>

<span class="cm">/* IIC parameter RAM.</span>
<span class="cm">*/</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">iic</span> <span class="p">{</span>
	<span class="n">ushort</span>	<span class="n">iic_rbase</span><span class="p">;</span>	<span class="cm">/* Rx Buffer descriptor base address */</span>
	<span class="n">ushort</span>	<span class="n">iic_tbase</span><span class="p">;</span>	<span class="cm">/* Tx Buffer descriptor base address */</span>
	<span class="n">u_char</span>	<span class="n">iic_rfcr</span><span class="p">;</span>	<span class="cm">/* Rx function code */</span>
	<span class="n">u_char</span>	<span class="n">iic_tfcr</span><span class="p">;</span>	<span class="cm">/* Tx function code */</span>
	<span class="n">ushort</span>	<span class="n">iic_mrblr</span><span class="p">;</span>	<span class="cm">/* Max receive buffer length */</span>
	<span class="n">uint</span>	<span class="n">iic_rstate</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">iic_rdp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">iic_rbptr</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">iic_rbc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">iic_rxtmp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">iic_tstate</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">iic_tdp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">iic_tbptr</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">ushort</span>	<span class="n">iic_tbc</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="n">uint</span>	<span class="n">iic_txtmp</span><span class="p">;</span>	<span class="cm">/* Internal */</span>
	<span class="kt">char</span>	<span class="n">res1</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* Reserved */</span>
	<span class="n">ushort</span>	<span class="n">iic_rpbase</span><span class="p">;</span>	<span class="cm">/* Relocation pointer */</span>
	<span class="kt">char</span>	<span class="n">res2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Reserved */</span>
<span class="p">}</span> <span class="n">iic_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * RISC Controller Configuration Register definitons</span>
<span class="cm"> */</span>
<span class="cp">#define RCCR_TIME	0x8000			</span><span class="cm">/* RISC Timer Enable */</span><span class="cp"></span>
<span class="cp">#define RCCR_TIMEP(t)	(((t) &amp; 0x3F)&lt;&lt;8)	</span><span class="cm">/* RISC Timer Period */</span><span class="cp"></span>
<span class="cp">#define RCCR_TIME_MASK	0x00FF			</span><span class="cm">/* not RISC Timer related bits */</span><span class="cp"></span>

<span class="cm">/* RISC Timer Parameter RAM offset */</span>
<span class="cp">#define PROFF_RTMR	((uint)0x01B0)</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">risc_timer_pram</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">tm_base</span><span class="p">;</span>	<span class="cm">/* RISC Timer Table Base Address */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">tm_ptr</span><span class="p">;</span>		<span class="cm">/* RISC Timer Table Pointer (internal) */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">r_tmr</span><span class="p">;</span>		<span class="cm">/* RISC Timer Mode Register */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">r_tmv</span><span class="p">;</span>		<span class="cm">/* RISC Timer Valid Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">tm_cmd</span><span class="p">;</span>		<span class="cm">/* RISC Timer Command Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">tm_cnt</span><span class="p">;</span>		<span class="cm">/* RISC Timer Internal Count */</span>
<span class="p">}</span> <span class="n">rt_pram_t</span><span class="p">;</span>

<span class="cm">/* Bits in RISC Timer Command Register */</span>
<span class="cp">#define TM_CMD_VALID	0x80000000	</span><span class="cm">/* Valid - Enables the timer */</span><span class="cp"></span>
<span class="cp">#define TM_CMD_RESTART	0x40000000	</span><span class="cm">/* Restart - for automatic restart */</span><span class="cp"></span>
<span class="cp">#define TM_CMD_PWM	0x20000000	</span><span class="cm">/* Run in Pulse Width Modulation Mode */</span><span class="cp"></span>
<span class="cp">#define TM_CMD_NUM(n)	(((n)&amp;0xF)&lt;&lt;16)	</span><span class="cm">/* Timer Number */</span><span class="cp"></span>
<span class="cp">#define TM_CMD_PERIOD(p) ((p)&amp;0xFFFF)	</span><span class="cm">/* Timer Period */</span><span class="cp"></span>

<span class="cm">/* CPM interrupts.  There are nearly 32 interrupts generated by CPM</span>
<span class="cm"> * channels or devices.  All of these are presented to the PPC core</span>
<span class="cm"> * as a single interrupt.  The CPM interrupt handler dispatches its</span>
<span class="cm"> * own handlers, in a similar fashion to the PPC core handler.  We</span>
<span class="cm"> * use the table as defined in the manuals (i.e. no special high</span>
<span class="cm"> * priority and SCC1 == SCCa, etc...).</span>
<span class="cm"> */</span>
<span class="cp">#define CPMVEC_NR		32</span>
<span class="cp">#define	CPMVEC_PIO_PC15		((ushort)0x1f)</span>
<span class="cp">#define	CPMVEC_SCC1		((ushort)0x1e)</span>
<span class="cp">#define	CPMVEC_SCC2		((ushort)0x1d)</span>
<span class="cp">#define	CPMVEC_SCC3		((ushort)0x1c)</span>
<span class="cp">#define	CPMVEC_SCC4		((ushort)0x1b)</span>
<span class="cp">#define	CPMVEC_PIO_PC14		((ushort)0x1a)</span>
<span class="cp">#define	CPMVEC_TIMER1		((ushort)0x19)</span>
<span class="cp">#define	CPMVEC_PIO_PC13		((ushort)0x18)</span>
<span class="cp">#define	CPMVEC_PIO_PC12		((ushort)0x17)</span>
<span class="cp">#define	CPMVEC_SDMA_CB_ERR	((ushort)0x16)</span>
<span class="cp">#define CPMVEC_IDMA1		((ushort)0x15)</span>
<span class="cp">#define CPMVEC_IDMA2		((ushort)0x14)</span>
<span class="cp">#define CPMVEC_TIMER2		((ushort)0x12)</span>
<span class="cp">#define CPMVEC_RISCTIMER	((ushort)0x11)</span>
<span class="cp">#define CPMVEC_I2C		((ushort)0x10)</span>
<span class="cp">#define	CPMVEC_PIO_PC11		((ushort)0x0f)</span>
<span class="cp">#define	CPMVEC_PIO_PC10		((ushort)0x0e)</span>
<span class="cp">#define CPMVEC_TIMER3		((ushort)0x0c)</span>
<span class="cp">#define	CPMVEC_PIO_PC9		((ushort)0x0b)</span>
<span class="cp">#define	CPMVEC_PIO_PC8		((ushort)0x0a)</span>
<span class="cp">#define	CPMVEC_PIO_PC7		((ushort)0x09)</span>
<span class="cp">#define CPMVEC_TIMER4		((ushort)0x07)</span>
<span class="cp">#define	CPMVEC_PIO_PC6		((ushort)0x06)</span>
<span class="cp">#define	CPMVEC_SPI		((ushort)0x05)</span>
<span class="cp">#define	CPMVEC_SMC1		((ushort)0x04)</span>
<span class="cp">#define	CPMVEC_SMC2		((ushort)0x03)</span>
<span class="cp">#define	CPMVEC_PIO_PC5		((ushort)0x02)</span>
<span class="cp">#define	CPMVEC_PIO_PC4		((ushort)0x01)</span>
<span class="cp">#define	CPMVEC_ERROR		((ushort)0x00)</span>

<span class="cm">/* CPM interrupt configuration vector.</span>
<span class="cm">*/</span>
<span class="cp">#define	CICR_SCD_SCC4		((uint)0x00c00000)	</span><span class="cm">/* SCC4 @ SCCd */</span><span class="cp"></span>
<span class="cp">#define	CICR_SCC_SCC3		((uint)0x00200000)	</span><span class="cm">/* SCC3 @ SCCc */</span><span class="cp"></span>
<span class="cp">#define	CICR_SCB_SCC2		((uint)0x00040000)	</span><span class="cm">/* SCC2 @ SCCb */</span><span class="cp"></span>
<span class="cp">#define	CICR_SCA_SCC1		((uint)0x00000000)	</span><span class="cm">/* SCC1 @ SCCa */</span><span class="cp"></span>
<span class="cp">#define CICR_IRL_MASK		((uint)0x0000e000)	</span><span class="cm">/* Core interrupt */</span><span class="cp"></span>
<span class="cp">#define CICR_HP_MASK		((uint)0x00001f00)	</span><span class="cm">/* Hi-pri int. */</span><span class="cp"></span>
<span class="cp">#define CICR_IEN		((uint)0x00000080)	</span><span class="cm">/* Int. enable */</span><span class="cp"></span>
<span class="cp">#define CICR_SPS		((uint)0x00000001)	</span><span class="cm">/* SCC Spread */</span><span class="cp"></span>

<span class="cp">#define CPM_PIN_INPUT     0</span>
<span class="cp">#define CPM_PIN_OUTPUT    1</span>
<span class="cp">#define CPM_PIN_PRIMARY   0</span>
<span class="cp">#define CPM_PIN_SECONDARY 2</span>
<span class="cp">#define CPM_PIN_GPIO      4</span>
<span class="cp">#define CPM_PIN_OPENDRAIN 8</span>

<span class="k">enum</span> <span class="n">cpm_port</span> <span class="p">{</span>
	<span class="n">CPM_PORTA</span><span class="p">,</span>
	<span class="n">CPM_PORTB</span><span class="p">,</span>
	<span class="n">CPM_PORTC</span><span class="p">,</span>
	<span class="n">CPM_PORTD</span><span class="p">,</span>
	<span class="n">CPM_PORTE</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">cpm1_set_pin</span><span class="p">(</span><span class="k">enum</span> <span class="n">cpm_port</span> <span class="n">port</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pin</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>

<span class="k">enum</span> <span class="n">cpm_clk_dir</span> <span class="p">{</span>
	<span class="n">CPM_CLK_RX</span><span class="p">,</span>
	<span class="n">CPM_CLK_TX</span><span class="p">,</span>
	<span class="n">CPM_CLK_RTX</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">cpm_clk_target</span> <span class="p">{</span>
	<span class="n">CPM_CLK_SCC1</span><span class="p">,</span>
	<span class="n">CPM_CLK_SCC2</span><span class="p">,</span>
	<span class="n">CPM_CLK_SCC3</span><span class="p">,</span>
	<span class="n">CPM_CLK_SCC4</span><span class="p">,</span>
	<span class="n">CPM_CLK_SMC1</span><span class="p">,</span>
	<span class="n">CPM_CLK_SMC2</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">cpm_clk</span> <span class="p">{</span>
	<span class="n">CPM_BRG1</span><span class="p">,</span>	<span class="cm">/* Baud Rate Generator  1 */</span>
	<span class="n">CPM_BRG2</span><span class="p">,</span>	<span class="cm">/* Baud Rate Generator  2 */</span>
	<span class="n">CPM_BRG3</span><span class="p">,</span>	<span class="cm">/* Baud Rate Generator  3 */</span>
	<span class="n">CPM_BRG4</span><span class="p">,</span>	<span class="cm">/* Baud Rate Generator  4 */</span>
	<span class="n">CPM_CLK1</span><span class="p">,</span>	<span class="cm">/* Clock  1 */</span>
	<span class="n">CPM_CLK2</span><span class="p">,</span>	<span class="cm">/* Clock  2 */</span>
	<span class="n">CPM_CLK3</span><span class="p">,</span>	<span class="cm">/* Clock  3 */</span>
	<span class="n">CPM_CLK4</span><span class="p">,</span>	<span class="cm">/* Clock  4 */</span>
	<span class="n">CPM_CLK5</span><span class="p">,</span>	<span class="cm">/* Clock  5 */</span>
	<span class="n">CPM_CLK6</span><span class="p">,</span>	<span class="cm">/* Clock  6 */</span>
	<span class="n">CPM_CLK7</span><span class="p">,</span>	<span class="cm">/* Clock  7 */</span>
	<span class="n">CPM_CLK8</span><span class="p">,</span>	<span class="cm">/* Clock  8 */</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">cpm1_clk_setup</span><span class="p">(</span><span class="k">enum</span> <span class="n">cpm_clk_target</span> <span class="n">target</span><span class="p">,</span> <span class="kt">int</span> <span class="n">clock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __CPM1__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
