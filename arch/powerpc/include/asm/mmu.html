<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › mmu.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>mmu.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_POWERPC_MMU_H_</span>
<span class="cp">#define _ASM_POWERPC_MMU_H_</span>
<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#include &lt;asm/asm-compat.h&gt;</span>
<span class="cp">#include &lt;asm/feature-fixups.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * MMU features bit definitions</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * First half is MMU families</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_HPTE_TABLE		ASM_CONST(0x00000001)</span>
<span class="cp">#define MMU_FTR_TYPE_8xx		ASM_CONST(0x00000002)</span>
<span class="cp">#define MMU_FTR_TYPE_40x		ASM_CONST(0x00000004)</span>
<span class="cp">#define MMU_FTR_TYPE_44x		ASM_CONST(0x00000008)</span>
<span class="cp">#define MMU_FTR_TYPE_FSL_E		ASM_CONST(0x00000010)</span>
<span class="cp">#define MMU_FTR_TYPE_3E			ASM_CONST(0x00000020)</span>
<span class="cp">#define MMU_FTR_TYPE_47x		ASM_CONST(0x00000040)</span>

<span class="cm">/*</span>
<span class="cm"> * This is individual features</span>
<span class="cm"> */</span>

<span class="cm">/* Enable use of high BAT registers */</span>
<span class="cp">#define MMU_FTR_USE_HIGH_BATS		ASM_CONST(0x00010000)</span>

<span class="cm">/* Enable &gt;32-bit physical addresses on 32-bit processor, only used</span>
<span class="cm"> * by CONFIG_6xx currently as BookE supports that from day 1</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_BIG_PHYS		ASM_CONST(0x00020000)</span>

<span class="cm">/* Enable use of broadcast TLB invalidations. We don&#39;t always set it</span>
<span class="cm"> * on processors that support it due to other constraints with the</span>
<span class="cm"> * use of such invalidations</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_USE_TLBIVAX_BCAST	ASM_CONST(0x00040000)</span>

<span class="cm">/* Enable use of tlbilx invalidate instructions.</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_USE_TLBILX		ASM_CONST(0x00080000)</span>

<span class="cm">/* This indicates that the processor cannot handle multiple outstanding</span>
<span class="cm"> * broadcast tlbivax or tlbsync. This makes the code use a spinlock</span>
<span class="cm"> * around such invalidate forms.</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_LOCK_BCAST_INVAL	ASM_CONST(0x00100000)</span>

<span class="cm">/* This indicates that the processor doesn&#39;t handle way selection</span>
<span class="cm"> * properly and needs SW to track and update the LRU state.  This</span>
<span class="cm"> * is specific to an errata on e300c2/c3/c4 class parts</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_NEED_DTLB_SW_LRU	ASM_CONST(0x00200000)</span>

<span class="cm">/* Enable use of TLB reservation.  Processor should support tlbsrx.</span>
<span class="cm"> * instruction and MAS0[WQ].</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_USE_TLBRSRV		ASM_CONST(0x00800000)</span>

<span class="cm">/* Use paired MAS registers (MAS7||MAS3, etc.)</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_USE_PAIRED_MAS		ASM_CONST(0x01000000)</span>

<span class="cm">/* MMU is SLB-based</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_SLB			ASM_CONST(0x02000000)</span>

<span class="cm">/* Support 16M large pages</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_16M_PAGE		ASM_CONST(0x04000000)</span>

<span class="cm">/* Supports TLBIEL variant</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_TLBIEL			ASM_CONST(0x08000000)</span>

<span class="cm">/* Supports tlbies w/o locking</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_LOCKLESS_TLBIE		ASM_CONST(0x10000000)</span>

<span class="cm">/* Large pages can be marked CI</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_CI_LARGE_PAGE		ASM_CONST(0x20000000)</span>

<span class="cm">/* 1T segments available</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_1T_SEGMENT		ASM_CONST(0x40000000)</span>

<span class="cm">/* Doesn&#39;t support the B bit (1T segment) in SLBIE</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_FTR_NO_SLBIE_B		ASM_CONST(0x80000000)</span>

<span class="cm">/* MMU feature bit sets for various CPUs */</span>
<span class="cp">#define MMU_FTRS_DEFAULT_HPTE_ARCH_V2	\</span>
<span class="cp">	MMU_FTR_HPTE_TABLE | MMU_FTR_PPCAS_ARCH_V2</span>
<span class="cp">#define MMU_FTRS_POWER4		MMU_FTRS_DEFAULT_HPTE_ARCH_V2</span>
<span class="cp">#define MMU_FTRS_PPC970		MMU_FTRS_POWER4</span>
<span class="cp">#define MMU_FTRS_POWER5		MMU_FTRS_POWER4 | MMU_FTR_LOCKLESS_TLBIE</span>
<span class="cp">#define MMU_FTRS_POWER6		MMU_FTRS_POWER4 | MMU_FTR_LOCKLESS_TLBIE</span>
<span class="cp">#define MMU_FTRS_POWER7		MMU_FTRS_POWER4 | MMU_FTR_LOCKLESS_TLBIE</span>
<span class="cp">#define MMU_FTRS_CELL		MMU_FTRS_DEFAULT_HPTE_ARCH_V2 | \</span>
<span class="cp">				MMU_FTR_CI_LARGE_PAGE</span>
<span class="cp">#define MMU_FTRS_PA6T		MMU_FTRS_DEFAULT_HPTE_ARCH_V2 | \</span>
<span class="cp">				MMU_FTR_CI_LARGE_PAGE | MMU_FTR_NO_SLBIE_B</span>
<span class="cp">#define MMU_FTRS_A2		MMU_FTR_TYPE_3E | MMU_FTR_USE_TLBILX | \</span>
<span class="cp">				MMU_FTR_USE_TLBIVAX_BCAST | \</span>
<span class="cp">				MMU_FTR_LOCK_BCAST_INVAL | \</span>
<span class="cp">				MMU_FTR_USE_TLBRSRV | \</span>
<span class="cp">				MMU_FTR_USE_PAIRED_MAS | \</span>
<span class="cp">				MMU_FTR_TLBIEL | \</span>
<span class="cp">				MMU_FTR_16M_PAGE</span>
<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="cp">#include &lt;asm/cputable.h&gt;</span>

<span class="cp">#ifdef CONFIG_PPC_FSL_BOOK3E</span>
<span class="cp">#include &lt;asm/percpu.h&gt;</span>
<span class="n">DECLARE_PER_CPU</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">next_tlbcam_idx</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mmu_has_feature</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">feature</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">cur_cpu_spec</span><span class="o">-&gt;</span><span class="n">mmu_features</span> <span class="o">&amp;</span> <span class="n">feature</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">mmu_clear_feature</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">feature</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">cur_cpu_spec</span><span class="o">-&gt;</span><span class="n">mmu_features</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">feature</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">__start___mmu_ftr_fixup</span><span class="p">,</span> <span class="n">__stop___mmu_ftr_fixup</span><span class="p">;</span>

<span class="cm">/* MMU initialization */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">early_init_mmu</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">early_init_mmu_secondary</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">setup_initial_memory_limit</span><span class="p">(</span><span class="n">phys_addr_t</span> <span class="n">first_memblock_base</span><span class="p">,</span>
				       <span class="n">phys_addr_t</span> <span class="n">first_memblock_size</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_PPC64</span>
<span class="cm">/* This is our real memory area size on ppc64 server, on embedded, we</span>
<span class="cm"> * make it match the size our of bolted TLB area</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="n">u64</span> <span class="n">ppc64_rma_size</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_PPC64 */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/* The kernel use the constants below to index in the page sizes array.</span>
<span class="cm"> * The use of fixed constants for this purpose is better for performances</span>
<span class="cm"> * of the low level hash refill handlers.</span>
<span class="cm"> *</span>
<span class="cm"> * A non supported page size has a &quot;shift&quot; field set to 0</span>
<span class="cm"> *</span>
<span class="cm"> * Any new page size being implemented can get a new entry in here. Whether</span>
<span class="cm"> * the kernel will use it or not is a different matter though. The actual page</span>
<span class="cm"> * size used by hugetlbfs is not defined here and may be made variable</span>
<span class="cm"> *</span>
<span class="cm"> * Note: This array ended up being a false good idea as it&#39;s growing to the</span>
<span class="cm"> * point where I wonder if we should replace it with something different,</span>
<span class="cm"> * to think about, feedback welcome. --BenH.</span>
<span class="cm"> */</span>

<span class="cm">/* There are #define as they have to be used in assembly</span>
<span class="cm"> *</span>
<span class="cm"> * WARNING: If you change this list, make sure to update the array of</span>
<span class="cm"> * names currently in arch/powerpc/mm/hugetlbpage.c or bad things will</span>
<span class="cm"> * happen</span>
<span class="cm"> */</span>
<span class="cp">#define MMU_PAGE_4K	0</span>
<span class="cp">#define MMU_PAGE_16K	1</span>
<span class="cp">#define MMU_PAGE_64K	2</span>
<span class="cp">#define MMU_PAGE_64K_AP	3	</span><span class="cm">/* &quot;Admixed pages&quot; (hash64 only) */</span><span class="cp"></span>
<span class="cp">#define MMU_PAGE_256K	4</span>
<span class="cp">#define MMU_PAGE_1M	5</span>
<span class="cp">#define MMU_PAGE_4M	6</span>
<span class="cp">#define MMU_PAGE_8M	7</span>
<span class="cp">#define MMU_PAGE_16M	8</span>
<span class="cp">#define MMU_PAGE_64M	9</span>
<span class="cp">#define MMU_PAGE_256M	10</span>
<span class="cp">#define MMU_PAGE_1G	11</span>
<span class="cp">#define MMU_PAGE_16G	12</span>
<span class="cp">#define MMU_PAGE_64G	13</span>

<span class="cp">#define MMU_PAGE_COUNT	14</span>

<span class="cp">#if defined(CONFIG_PPC_STD_MMU_64)</span>
<span class="cm">/* 64-bit classic hash table MMU */</span>
<span class="cp">#  include &lt;asm/mmu-hash64.h&gt;</span>
<span class="cp">#elif defined(CONFIG_PPC_STD_MMU_32)</span>
<span class="cm">/* 32-bit classic hash table MMU */</span>
<span class="cp">#  include &lt;asm/mmu-hash32.h&gt;</span>
<span class="cp">#elif defined(CONFIG_40x)</span>
<span class="cm">/* 40x-style software loaded TLB */</span>
<span class="cp">#  include &lt;asm/mmu-40x.h&gt;</span>
<span class="cp">#elif defined(CONFIG_44x)</span>
<span class="cm">/* 44x-style software loaded TLB */</span>
<span class="cp">#  include &lt;asm/mmu-44x.h&gt;</span>
<span class="cp">#elif defined(CONFIG_PPC_BOOK3E_MMU)</span>
<span class="cm">/* Freescale Book-E software loaded TLB or Book-3e (ISA 2.06+) MMU */</span>
<span class="cp">#  include &lt;asm/mmu-book3e.h&gt;</span>
<span class="cp">#elif defined (CONFIG_PPC_8xx)</span>
<span class="cm">/* Motorola/Freescale 8xx software loaded TLB */</span>
<span class="cp">#  include &lt;asm/mmu-8xx.h&gt;</span>
<span class="cp">#endif</span>


<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* _ASM_POWERPC_MMU_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
