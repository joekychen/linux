<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › dbdma.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>dbdma.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Definitions for using the Apple Descriptor-Based DMA controller</span>
<span class="cm"> * in Power Macintosh computers.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1996 Paul Mackerras.</span>
<span class="cm"> */</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#ifndef _ASM_DBDMA_H_</span>
<span class="cp">#define _ASM_DBDMA_H_</span>
<span class="cm">/*</span>
<span class="cm"> * DBDMA control/status registers.  All little-endian.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">dbdma_regs</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">control</span><span class="p">;</span>	<span class="cm">/* lets you change bits in status */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>	<span class="cm">/* DMA and device status bits (see below) */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmdptr_hi</span><span class="p">;</span>	<span class="cm">/* upper 32 bits of command address */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmdptr</span><span class="p">;</span>	<span class="cm">/* (lower 32 bits of) command address (phys) */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">intr_sel</span><span class="p">;</span>	<span class="cm">/* select interrupt condition bit */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">br_sel</span><span class="p">;</span>	<span class="cm">/* select branch condition bit */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wait_sel</span><span class="p">;</span>	<span class="cm">/* select wait condition bit */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">xfer_mode</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data2ptr_hi</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data2ptr</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res1</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">address_hi</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">br_addr_hi</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Bits in control and status registers */</span>
<span class="cp">#define RUN	0x8000</span>
<span class="cp">#define PAUSE	0x4000</span>
<span class="cp">#define FLUSH	0x2000</span>
<span class="cp">#define WAKE	0x1000</span>
<span class="cp">#define DEAD	0x0800</span>
<span class="cp">#define ACTIVE	0x0400</span>
<span class="cp">#define BT	0x0100</span>
<span class="cp">#define DEVSTAT	0x00ff</span>

<span class="cm">/*</span>
<span class="cm"> * DBDMA command structure.  These fields are all little-endian!</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">dbdma_cmd</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">req_count</span><span class="p">;</span>	<span class="cm">/* requested byte transfer count */</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">command</span><span class="p">;</span>	<span class="cm">/* command word (has bit-fields) */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">phy_addr</span><span class="p">;</span>	<span class="cm">/* physical data address */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">cmd_dep</span><span class="p">;</span>	<span class="cm">/* command-dependent field */</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">res_count</span><span class="p">;</span>	<span class="cm">/* residual count after completion */</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">xfer_status</span><span class="p">;</span>	<span class="cm">/* transfer status */</span>
<span class="p">};</span>

<span class="cm">/* DBDMA command values in command field */</span>
<span class="cp">#define OUTPUT_MORE	0	</span><span class="cm">/* transfer memory data to stream */</span><span class="cp"></span>
<span class="cp">#define OUTPUT_LAST	0x1000	</span><span class="cm">/* ditto followed by end marker */</span><span class="cp"></span>
<span class="cp">#define INPUT_MORE	0x2000	</span><span class="cm">/* transfer stream data to memory */</span><span class="cp"></span>
<span class="cp">#define INPUT_LAST	0x3000	</span><span class="cm">/* ditto, expect end marker */</span><span class="cp"></span>
<span class="cp">#define STORE_WORD	0x4000	</span><span class="cm">/* write word (4 bytes) to device reg */</span><span class="cp"></span>
<span class="cp">#define LOAD_WORD	0x5000	</span><span class="cm">/* read word (4 bytes) from device reg */</span><span class="cp"></span>
<span class="cp">#define DBDMA_NOP	0x6000	</span><span class="cm">/* do nothing */</span><span class="cp"></span>
<span class="cp">#define DBDMA_STOP	0x7000	</span><span class="cm">/* suspend processing */</span><span class="cp"></span>

<span class="cm">/* Key values in command field */</span>
<span class="cp">#define KEY_STREAM0	0	</span><span class="cm">/* usual data stream */</span><span class="cp"></span>
<span class="cp">#define KEY_STREAM1	0x100	</span><span class="cm">/* control/status stream */</span><span class="cp"></span>
<span class="cp">#define KEY_STREAM2	0x200	</span><span class="cm">/* device-dependent stream */</span><span class="cp"></span>
<span class="cp">#define KEY_STREAM3	0x300	</span><span class="cm">/* device-dependent stream */</span><span class="cp"></span>
<span class="cp">#define KEY_REGS	0x500	</span><span class="cm">/* device register space */</span><span class="cp"></span>
<span class="cp">#define KEY_SYSTEM	0x600	</span><span class="cm">/* system memory-mapped space */</span><span class="cp"></span>
<span class="cp">#define KEY_DEVICE	0x700	</span><span class="cm">/* device memory-mapped space */</span><span class="cp"></span>

<span class="cm">/* Interrupt control values in command field */</span>
<span class="cp">#define INTR_NEVER	0	</span><span class="cm">/* don&#39;t interrupt */</span><span class="cp"></span>
<span class="cp">#define INTR_IFSET	0x10	</span><span class="cm">/* intr if condition bit is 1 */</span><span class="cp"></span>
<span class="cp">#define INTR_IFCLR	0x20	</span><span class="cm">/* intr if condition bit is 0 */</span><span class="cp"></span>
<span class="cp">#define INTR_ALWAYS	0x30	</span><span class="cm">/* always interrupt */</span><span class="cp"></span>

<span class="cm">/* Branch control values in command field */</span>
<span class="cp">#define BR_NEVER	0	</span><span class="cm">/* don&#39;t branch */</span><span class="cp"></span>
<span class="cp">#define BR_IFSET	0x4	</span><span class="cm">/* branch if condition bit is 1 */</span><span class="cp"></span>
<span class="cp">#define BR_IFCLR	0x8	</span><span class="cm">/* branch if condition bit is 0 */</span><span class="cp"></span>
<span class="cp">#define BR_ALWAYS	0xc	</span><span class="cm">/* always branch */</span><span class="cp"></span>

<span class="cm">/* Wait control values in command field */</span>
<span class="cp">#define WAIT_NEVER	0	</span><span class="cm">/* don&#39;t wait */</span><span class="cp"></span>
<span class="cp">#define WAIT_IFSET	1	</span><span class="cm">/* wait if condition bit is 1 */</span><span class="cp"></span>
<span class="cp">#define WAIT_IFCLR	2	</span><span class="cm">/* wait if condition bit is 0 */</span><span class="cp"></span>
<span class="cp">#define WAIT_ALWAYS	3	</span><span class="cm">/* always wait */</span><span class="cp"></span>

<span class="cm">/* Align an address for a DBDMA command structure */</span>
<span class="cp">#define DBDMA_ALIGN(x)	(((unsigned long)(x) + sizeof(struct dbdma_cmd) - 1) \</span>
<span class="cp">			 &amp; -sizeof(struct dbdma_cmd))</span>

<span class="cm">/* Useful macros */</span>
<span class="cp">#define DBDMA_DO_STOP(regs) do {				\</span>
<span class="cp">	out_le32(&amp;((regs)-&gt;control), (RUN|FLUSH)&lt;&lt;16);		\</span>
<span class="cp">	while(in_le32(&amp;((regs)-&gt;status)) &amp; (ACTIVE|FLUSH))	\</span>
<span class="cp">		; \</span>
<span class="cp">} while(0)</span>

<span class="cp">#define DBDMA_DO_RESET(regs) do {				\</span>
<span class="cp">	out_le32(&amp;((regs)-&gt;control), (ACTIVE|DEAD|WAKE|FLUSH|PAUSE|RUN)&lt;&lt;16);\</span>
<span class="cp">	while(in_le32(&amp;((regs)-&gt;status)) &amp; (RUN)) \</span>
<span class="cp">		; \</span>
<span class="cp">} while(0)</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_DBDMA_H_ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
