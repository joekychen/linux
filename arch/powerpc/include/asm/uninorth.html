<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › uninorth.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>uninorth.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * uninorth.h: definitions for using the &quot;UniNorth&quot; host bridge chip</span>
<span class="cm"> *             from Apple. This chip is used on &quot;Core99&quot; machines</span>
<span class="cm"> *	       This also includes U2 used on more recent MacRISC2/3</span>
<span class="cm"> *             machines and U3 (G5) </span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#ifndef __ASM_UNINORTH_H__</span>
<span class="cp">#define __ASM_UNINORTH_H__</span>

<span class="cm">/*</span>
<span class="cm"> * Uni-N and U3 config space reg. definitions</span>
<span class="cm"> *</span>
<span class="cm"> * (Little endian)</span>
<span class="cm"> */</span>

<span class="cm">/* Address ranges selection. This one should work with Bandit too */</span>
<span class="cm">/* Not U3 */</span>
<span class="cp">#define UNI_N_ADDR_SELECT		0x48</span>
<span class="cp">#define UNI_N_ADDR_COARSE_MASK		0xffff0000	</span><span class="cm">/* 256Mb regions at *0000000 */</span><span class="cp"></span>
<span class="cp">#define UNI_N_ADDR_FINE_MASK		0x0000ffff	</span><span class="cm">/*  16Mb regions at f*000000 */</span><span class="cp"></span>

<span class="cm">/* AGP registers */</span>
<span class="cm">/* Not U3 */</span>
<span class="cp">#define UNI_N_CFG_GART_BASE		0x8c</span>
<span class="cp">#define UNI_N_CFG_AGP_BASE		0x90</span>
<span class="cp">#define UNI_N_CFG_GART_CTRL		0x94</span>
<span class="cp">#define UNI_N_CFG_INTERNAL_STATUS	0x98</span>
<span class="cp">#define UNI_N_CFG_GART_DUMMY_PAGE	0xa4</span>

<span class="cm">/* UNI_N_CFG_GART_CTRL bits definitions */</span>
<span class="cp">#define UNI_N_CFG_GART_INVAL		0x00000001</span>
<span class="cp">#define UNI_N_CFG_GART_ENABLE		0x00000100</span>
<span class="cp">#define UNI_N_CFG_GART_2xRESET		0x00010000</span>
<span class="cp">#define UNI_N_CFG_GART_DISSBADET	0x00020000</span>
<span class="cm">/* The following seems to only be used only on U3 &lt;j.glisse@gmail.com&gt; */</span>
<span class="cp">#define U3_N_CFG_GART_SYNCMODE		0x00040000</span>
<span class="cp">#define U3_N_CFG_GART_PERFRD		0x00080000</span>
<span class="cp">#define U3_N_CFG_GART_B2BGNT		0x00200000</span>
<span class="cp">#define U3_N_CFG_GART_FASTDDR		0x00400000</span>

<span class="cm">/* My understanding of UniNorth AGP as of UniNorth rev 1.0x,</span>
<span class="cm"> * revision 1.5 (x4 AGP) may need further changes.</span>
<span class="cm"> *</span>
<span class="cm"> * AGP_BASE register contains the base address of the AGP aperture on</span>
<span class="cm"> * the AGP bus. It doesn&#39;t seem to be visible to the CPU as of UniNorth 1.x,</span>
<span class="cm"> * even if decoding of this address range is enabled in the address select</span>
<span class="cm"> * register. Apparently, the only supported bases are 256Mb multiples</span>
<span class="cm"> * (high 4 bits of that register).</span>
<span class="cm"> *</span>
<span class="cm"> * GART_BASE register appear to contain the physical address of the GART</span>
<span class="cm"> * in system memory in the high address bits (page aligned), and the</span>
<span class="cm"> * GART size in the low order bits (number of GART pages)</span>
<span class="cm"> *</span>
<span class="cm"> * The GART format itself is one 32bits word per physical memory page.</span>
<span class="cm"> * This word contains, in little-endian format (!!!), the physical address</span>
<span class="cm"> * of the page in the high bits, and what appears to be an &quot;enable&quot; bit</span>
<span class="cm"> * in the LSB bit (0) that must be set to 1 when the entry is valid.</span>
<span class="cm"> *</span>
<span class="cm"> * Obviously, the GART is not cache coherent and so any change to it</span>
<span class="cm"> * must be flushed to memory (or maybe just make the GART space non</span>
<span class="cm"> * cachable). AGP memory itself doesn&#39;t seem to be cache coherent neither.</span>
<span class="cm"> *</span>
<span class="cm"> * In order to invalidate the GART (which is probably necessary to inval</span>
<span class="cm"> * the bridge internal TLBs), the following sequence has to be written,</span>
<span class="cm"> * in order, to the GART_CTRL register:</span>
<span class="cm"> *</span>
<span class="cm"> *   UNI_N_CFG_GART_ENABLE | UNI_N_CFG_GART_INVAL</span>
<span class="cm"> *   UNI_N_CFG_GART_ENABLE</span>
<span class="cm"> *   UNI_N_CFG_GART_ENABLE | UNI_N_CFG_GART_2xRESET</span>
<span class="cm"> *   UNI_N_CFG_GART_ENABLE</span>
<span class="cm"> *</span>
<span class="cm"> * As far as AGP &quot;features&quot; are concerned, it looks like fast write may</span>
<span class="cm"> * not be supported but this has to be confirmed.</span>
<span class="cm"> *</span>
<span class="cm"> * Turning on AGP seem to require a double invalidate operation, one before</span>
<span class="cm"> * setting the AGP command register, on after.</span>
<span class="cm"> *</span>
<span class="cm"> * Turning off AGP seems to require the following sequence: first wait</span>
<span class="cm"> * for the AGP to be idle by reading the internal status register, then</span>
<span class="cm"> * write in that order to the GART_CTRL register:</span>
<span class="cm"> *</span>
<span class="cm"> *   UNI_N_CFG_GART_ENABLE | UNI_N_CFG_GART_INVAL</span>
<span class="cm"> *   0</span>
<span class="cm"> *   UNI_N_CFG_GART_2xRESET</span>
<span class="cm"> *   0</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Uni-N memory mapped reg. definitions</span>
<span class="cm"> *</span>
<span class="cm"> * Those registers are Big-Endian !!</span>
<span class="cm"> *</span>
<span class="cm"> * Their meaning come from either Darwin and/or from experiments I made with</span>
<span class="cm"> * the bootrom, I&#39;m not sure about their exact meaning yet</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/* Version of the UniNorth chip */</span>
<span class="cp">#define UNI_N_VERSION			0x0000		</span><span class="cm">/* Known versions: 3,7 and 8 */</span><span class="cp"></span>

<span class="cp">#define UNI_N_VERSION_107		0x0003		</span><span class="cm">/* 1.0.7 */</span><span class="cp"></span>
<span class="cp">#define UNI_N_VERSION_10A		0x0007		</span><span class="cm">/* 1.0.10 */</span><span class="cp"></span>
<span class="cp">#define UNI_N_VERSION_150		0x0011		</span><span class="cm">/* 1.5 */</span><span class="cp"></span>
<span class="cp">#define UNI_N_VERSION_200		0x0024		</span><span class="cm">/* 2.0 */</span><span class="cp"></span>
<span class="cp">#define UNI_N_VERSION_PANGEA		0x00C0		</span><span class="cm">/* Integrated U1 + K */</span><span class="cp"></span>
<span class="cp">#define UNI_N_VERSION_INTREPID		0x00D2		</span><span class="cm">/* Integrated U2 + K */</span><span class="cp"></span>
<span class="cp">#define UNI_N_VERSION_300		0x0030		</span><span class="cm">/* 3.0 (U3 on G5) */</span><span class="cp"></span>

<span class="cm">/* This register is used to enable/disable various clocks */</span>
<span class="cp">#define UNI_N_CLOCK_CNTL		0x0020</span>
<span class="cp">#define UNI_N_CLOCK_CNTL_PCI		0x00000001	</span><span class="cm">/* PCI2 clock control */</span><span class="cp"></span>
<span class="cp">#define UNI_N_CLOCK_CNTL_GMAC		0x00000002	</span><span class="cm">/* GMAC clock control */</span><span class="cp"></span>
<span class="cp">#define UNI_N_CLOCK_CNTL_FW		0x00000004	</span><span class="cm">/* FireWire clock control */</span><span class="cp"></span>
<span class="cp">#define UNI_N_CLOCK_CNTL_ATA100		0x00000010	</span><span class="cm">/* ATA-100 clock control (U2) */</span><span class="cp"></span>

<span class="cm">/* Power Management control */</span>
<span class="cp">#define UNI_N_POWER_MGT			0x0030</span>
<span class="cp">#define UNI_N_POWER_MGT_NORMAL		0x00</span>
<span class="cp">#define UNI_N_POWER_MGT_IDLE2		0x01</span>
<span class="cp">#define UNI_N_POWER_MGT_SLEEP		0x02</span>

<span class="cm">/* This register is configured by Darwin depending on the UniN</span>
<span class="cm"> * revision</span>
<span class="cm"> */</span>
<span class="cp">#define UNI_N_ARB_CTRL			0x0040</span>
<span class="cp">#define UNI_N_ARB_CTRL_QACK_DELAY_SHIFT	15</span>
<span class="cp">#define UNI_N_ARB_CTRL_QACK_DELAY_MASK	0x0e1f8000</span>
<span class="cp">#define UNI_N_ARB_CTRL_QACK_DELAY	0x30</span>
<span class="cp">#define UNI_N_ARB_CTRL_QACK_DELAY105	0x00</span>

<span class="cm">/* This one _might_ return the CPU number of the CPU reading it;</span>
<span class="cm"> * the bootROM decides whether to boot or to sleep/spinloop depending</span>
<span class="cm"> * on this register beeing 0 or not</span>
<span class="cm"> */</span>
<span class="cp">#define UNI_N_CPU_NUMBER		0x0050</span>

<span class="cm">/* This register appear to be read by the bootROM to decide what</span>
<span class="cm"> *  to do on a non-recoverable reset (powerup or wakeup)</span>
<span class="cm"> */</span>
<span class="cp">#define UNI_N_HWINIT_STATE		0x0070</span>
<span class="cp">#define UNI_N_HWINIT_STATE_SLEEPING	0x01</span>
<span class="cp">#define UNI_N_HWINIT_STATE_RUNNING	0x02</span>
<span class="cm">/* This last bit appear to be used by the bootROM to know the second</span>
<span class="cm"> * CPU has started and will enter it&#39;s sleep loop with IP=0</span>
<span class="cm"> */</span>
<span class="cp">#define UNI_N_HWINIT_STATE_CPU1_FLAG	0x10000000</span>

<span class="cm">/* This register controls AACK delay, which is set when 2004 iBook/PowerBook</span>
<span class="cm"> * is in low speed mode.</span>
<span class="cm"> */</span>
<span class="cp">#define UNI_N_AACK_DELAY		0x0100</span>
<span class="cp">#define UNI_N_AACK_DELAY_ENABLE		0x00000001</span>

<span class="cm">/* Clock status for Intrepid */</span>
<span class="cp">#define UNI_N_CLOCK_STOP_STATUS0	0x0150</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_EXTAGP	0x00200000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_AGPDEL	0x00100000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_I2S0_45_49	0x00080000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_I2S0_18	0x00040000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_I2S1_45_49	0x00020000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_I2S1_18	0x00010000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_TIMER	0x00008000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_SCC_RTCLK18	0x00004000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_SCC_RTCLK32	0x00002000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_SCC_VIA32	0x00001000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_SCC_SLOT0	0x00000800</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_SCC_SLOT1	0x00000400</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_SCC_SLOT2	0x00000200</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_PCI_FBCLKO	0x00000100</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_VEO0	0x00000080</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_VEO1	0x00000040</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_USB0	0x00000020</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_USB1	0x00000010</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_USB2	0x00000008</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_32		0x00000004</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_45		0x00000002</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_49		0x00000001</span>

<span class="cp">#define UNI_N_CLOCK_STOP_STATUS1	0x0160</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_PLL4REF	0x00080000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_CPUDEL	0x00040000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_CPU		0x00020000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_BUF_REFCKO	0x00010000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_PCI2	0x00008000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_FW		0x00004000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_GB		0x00002000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_ATA66	0x00001000</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_ATA100	0x00000800</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_MAX		0x00000400</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_PCI1	0x00000200</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_KLPCI	0x00000100</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_USB0PCI	0x00000080</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_USB1PCI	0x00000040</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_USB2PCI	0x00000020</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_7PCI1	0x00000008</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_AGP		0x00000004</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_PCI0	0x00000002</span>
<span class="cp">#define UNI_N_CLOCK_STOPPED_18		0x00000001</span>

<span class="cm">/* Intrepid registe to OF do-platform-clockspreading */</span>
<span class="cp">#define UNI_N_CLOCK_SPREADING		0x190</span>

<span class="cm">/* Uninorth 1.5 rev. has additional perf. monitor registers at 0xf00-0xf50 */</span>


<span class="cm">/*</span>
<span class="cm"> * U3 specific registers</span>
<span class="cm"> */</span>


<span class="cm">/* U3 Toggle */</span>
<span class="cp">#define U3_TOGGLE_REG			0x00e0</span>
<span class="cp">#define U3_PMC_START_STOP		0x0001</span>
<span class="cp">#define U3_MPIC_RESET			0x0002</span>
<span class="cp">#define U3_MPIC_OUTPUT_ENABLE		0x0004</span>

<span class="cm">/* U3 API PHY Config 1 */</span>
<span class="cp">#define U3_API_PHY_CONFIG_1		0x23030</span>

<span class="cm">/* U3 HyperTransport registers */</span>
<span class="cp">#define U3_HT_CONFIG_BASE      		0x70000</span>
<span class="cp">#define U3_HT_LINK_COMMAND		0x100</span>
<span class="cp">#define U3_HT_LINK_CONFIG		0x110</span>
<span class="cp">#define U3_HT_LINK_FREQ			0x120</span>

<span class="cp">#endif </span><span class="cm">/* __ASM_UNINORTH_H__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
