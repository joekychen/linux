f | kvm_para.h | s | 4.7K | 175 | Eric B Munson | emunson@mgebm.net | 1333878539 |  | kvmclock: Add functions to check if the host has stopped the vm  When a host stops or suspends a VM it will set a flag to show this.  The watchdog will use these functions to determine if a softlockup is real, or the result of a suspended VM.  Signed-off-by: Eric B Munson <emunson@mgebm.net> asm-generic changes Acked-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com> Signed-off-by: Avi Kivity <avi@redhat.com>
f | perf_event_server.h | s | 4.1K | 101 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1332894804 |  | powerpc/perf: Fix instruction address sampling on 970 and Power4  970 and Power4 don't support "continuous sampling" which means that when we aren't in marked instruction sampling mode (marked events), SIAR isn't updated with the last instruction sampled before the perf interrupt. On those processors, we must thus use the exception SRR0 value as the sampled instruction pointer.  Those processors also don't support the SIPR and SIHV bits in MMCRA which means we need some kind of heuristic to decide if SIAR values represent kernel or user addresses.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | io.h | s | 25K | 691 | Justin P. Mattock | justinmattock@gmail.com | 1322834251 |  | treewide: Fix typos in various parts of the kernel, and fix some comments.  The below patch fixes some typos in various parts of the kernel, as well as fixes some comments. Please let me know if I missed anything, and I will try to get it changed and resent.  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Acked-by: Randy Dunlap <rdunlap@xenotime.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | kmap_types.h | s | 982B | 40 | Jason Wessel | jason.wessel@windriver.com | 1274407461 |  | kdb: core for kgdb back end (2 of 2)  This patch contains the hooks and instrumentation into kernel which live outside the kernel/debug directory, which the kdb core will call to run commands like lsmod, dmesg, bt etc...  CC: linux-arch@vger.kernel.org Signed-off-by: Jason Wessel <jason.wessel@windriver.com> Signed-off-by: Martin Hicks <mort@sgi.com>
f | reg.h | s | 46K | 1025 | Scott Wood | scottwood@freescale.com | 1333878679 |  | KVM: PPC: booke: category E.HV (GS-mode) support  Chips such as e500mc that implement category E.HV in Power ISA 2.06 provide hardware virtualization features, including a new MSR mode for guest state.  The guest OS can perform many operations without trapping into the hypervisor, including transitions to and from guest userspace.  Since we can use SRR1[GS] to reliably tell whether an exception came from guest state, instead of messing around with IVPR, we use DO_KVM similarly to book3s.  Current issues include:  - Machine checks from guest state are not routed to the host handler.  - The guest can cause a host oops by executing an emulated instruction    in a page that lacks read permission.  Existing e500/4xx support has    the same problem.  Includes work by Ashish Kalra <Ashish.Kalra@freescale.com>, Varun Sethi <Varun.Sethi@freescale.com>, and Liu Yu <yu.liu@freescale.com>.  Signed-off-by: Scott Wood <scottwood@freescale.com> [agraf: remove pt_regs usage] Signed-off-by: Alexander Graf <agraf@suse.de> Signed-off-by: Avi Kivity <avi@redhat.com>
f | pci.h | s | 5.5K | 150 | Bjorn Helgaas | bhelgaas@google.com | 1332265304 |  | powerpc/PCI: compute I/O space bus-to-resource offset consistently  Make sure we compute CPU addresses (resource start/end) the same way both when we set up the I/O aperture (hose->io_resource) and when we use pcibios_bus_to_resource() to convert BAR values into resources.  This fixes a build failure ("cast from pointer to integer of different size" in configs where resource_size_t is 64 bits but pointers are 32 bits) I introduced in 6c5705fec63d.  Acked-By: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Bjorn Helgaas <bhelgaas@google.com> Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>
f | mmu-40x.h | s | 1.9K | 53 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1250727909 |  | powerpc: Add TLB management code for 64-bit Book3E  This adds the TLB miss handler assembly, the low level TLB flush routines along with the necessary hook for dealing with our virtual page tables or indirect TLB entries that need to be flushes when PTE pages are freed.  There is currently no support for hugetlbfs  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | immap_cpm2.h | s | 10K | 604 | Anton Vorontsov | avorontsov@ru.mvista.com | 1257997398 |  | powerpc/qe&cpm2: Avoid redefinitions in CPM2 and QE headers  struct mcc defined in both immap_qe.h and immap_cpm2.h, so they will conflic when included in a single file. The mcc struct is easy to deal with, since it isn't used in any driver (yet), so let's just rename QE version to qe_mcc.  The ucb_ctlr is a bit trickier, since it is used by fsl_qe_udc driver, and the driver supports both CPM and QE UDCs, plus the QE version is used to form a bigger immap struct.  I don't want to touch too much of USB code in this series, so for now let's just copy most generic version into the common cpm.h header, later we'll create cpm_usb.h where we'll place common USB structs that are used by QE/CPM UDC and QE Host drivers (FHCI).  And as for the structs in qe.h and cpm2.h, just prefix them with qe_ and cpm_.  Signed-off-by: Anton Vorontsov <avorontsov@ru.mvista.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | spu.h | s | 25K | 651 | Linus Torvalds | torvalds@linux-foundation.org | 1326053997 |  | Merge branch 'for-linus2' of git://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs  * 'for-linus2' of git://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs: (165 commits)   reiserfs: Properly display mount options in /proc/mounts   vfs: prevent remount read-only if pending removes   vfs: count unlinked inodes   vfs: protect remounting superblock read-only   vfs: keep list of mounts for each superblock   vfs: switch ->show_options() to struct dentry *   vfs: switch ->show_path() to struct dentry *   vfs: switch ->show_devname() to struct dentry *   vfs: switch ->show_stats to struct dentry *   switch security_path_chmod() to struct path *   vfs: prefer ->dentry->d_sb to ->mnt->mnt_sb   vfs: trim includes a bit   switch mnt_namespace ->root to struct mount   vfs: take /proc/*/mounts and friends to fs/proc_namespace.c   vfs: opencode mntget() mnt_set_mountpoint()   vfs: spread struct mount - remaining argument of next_mnt()   vfs: move fsnotify junk to struct mount   vfs: move mnt_devname   vfs: move mnt_list to struct mount   vfs: switch pnode.h macros to struct mount *   ...
f | cputime.h | s | 5.2K | 196 | Linus Torvalds | torvalds@linux-foundation.org | 1325901502 |  | Merge branch 'next' of git://git.kernel.org/pub/scm/linux/kernel/git/benh/powerpc  * 'next' of git://git.kernel.org/pub/scm/linux/kernel/git/benh/powerpc: (185 commits)   powerpc: fix compile error with 85xx/p1010rdb.c   powerpc: fix compile error with 85xx/p1023_rds.c   powerpc/fsl: add MSI support for the Freescale hypervisor   arch/powerpc/sysdev/fsl_rmu.c: introduce missing kfree   powerpc/fsl: Add support for Integrated Flash Controller   powerpc/fsl: update compatiable on fsl 16550 uart nodes   powerpc/85xx: fix PCI and localbus properties in p1022ds.dts   powerpc/85xx: re-enable ePAPR byte channel driver in corenet32_smp_defconfig   powerpc/fsl: Update defconfigs to enable some standard FSL HW features   powerpc: Add TBI PHY node to first MDIO bus   sbc834x: put full compat string in board match check   powerpc/fsl-pci: Allow 64-bit PCIe devices to DMA to any memory address   powerpc: Fix unpaired probe_hcall_entry and probe_hcall_exit   offb: Fix setting of the pseudo-palette for >8bpp   offb: Add palette hack for qemu "standard vga" framebuffer   offb: Fix bug in calculating requested vram size   powerpc/boot: Change the WARN to INFO for boot wrapper overlap message   powerpc/44x: Fix build error on currituck platform   powerpc/boot: Change the load address for the wrapper to fit the kernel   powerpc/44x: Enable CRASH_DUMP for 440x   ...  Fix up a trivial conflict in arch/powerpc/include/asm/cputime.h due to the additional sparse-checking code for cputime_t.
f | compat.h | s | 4.7K | 194 | Eric W. Biederman | ebiederm@xmission.com | 1319806733 |  | compat: sync compat_stats with statfs.  This was found by inspection while tracking a similar bug in compat_statfs64, that has been fixed in mainline since decemeber.  - This fixes a bug where not all of the f_spare fields   were cleared on mips and s390. - Add the f_flags field to struct compat_statfs - Copy f_flags to userspace in case someone cares. - Use __clear_user to copy the f_spare field to userspace   to ensure that all of the elements of f_spare are cleared.   On some architectures f_spare is has 5 ints and on some   architectures f_spare only has 4 ints.  Which makes   the previous technique of clearing each int individually   broken.  I don't expect anyone actually uses the old statfs system call anymore but if they do let them benefit from having the compat and the native version working the same.  Signed-off-by: Eric W. Biederman <ebiederm@xmission.com> Signed-off-by: Christoph Hellwig <hch@lst.de>
f | sections.h | s | 833B | 31 | Anton Blanchard | anton@samba.org | 1321415274 |  | powerpc: Copy down exception vectors after feature fixups  kdump fails because we try to execute an HV only instruction. Feature fixups are being applied after we copy the exception vectors down to 0 so they miss out on any updates.  We have always had this issue but it only became critical in v3.0 when we added CFAR support (breaks POWER5) and v3.1 when we added POWERNV (breaks everyone).  Signed-off-by: Anton Blanchard <anton@samba.org> Cc: <stable@kernel.org> [v3.0+] Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | reg_a2.h | s | 6.5K | 145 | Jack Miller | jack@codezen.org | 1304652761 |  | powerpc: Add early debug for WSP platforms  Signed-off-by: Jack Miller <jack@codezen.org> Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | exception-64e.h | s | 7.5K | 205 | Scott Wood | scottwood@freescale.com | 1309333668 |  | powerpc/book3e-64: use a separate TLB handler when linear map is bolted  On MMUs such as FSL where we can guarantee the entire linear mapping is bolted, we don't need to worry about linear TLB misses.  If on top of that we do a full table walk, we get rid of all recursive TLB faults, and can dispense with some state saving.  This gains a few percent on TLB-miss-heavy workloads, and around 50% on a benchmark that had a high rate of virtual page table faults under the normal handler.  While touching the EX_TLB layout, remove EX_TLB_MMUCR0, EX_TLB_SRR0, and EX_TLB_SRR1 as they're not used.  [BenH: Fixed build with 64K pages (wsp config)]  Signed-off-by: Scott Wood <scottwood@freescale.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | agp.h | s | 486B | 14 | David Woodhouse | David.Woodhouse@intel.com | 1249286700 |  | agp: kill phys_to_gart() and gart_to_phys()  There seems to be no reason for these -- they're a 1:1 mapping on all platforms.  Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | debug.h | s | 1.9K | 47 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | edac.h | s | 1.1K | 38 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | irq_regs.h | s | 35B | 1 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | hvconsole.h | s | 1.4K | 37 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | barrier.h | s | 2.5K | 61 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | pte-hash64-64k.h | s | 3.4K | 67 | Justin P. Mattock | justinmattock@gmail.com | 1305015381 |  | treewide: fix a few typos in comments  - kenrel -> kernel - whetehr -> whether - ttt -> tt - sss -> ss  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | delay.h | s | 2.9K | 66 | Grant Likely | grant.likely@secretlab.ca | 1247025024 |  | powerpc: Fix spin_event_timeout() to be robust over context switches  Current implementation of spin_event_timeout can be interrupted by an IRQ or context switch after testing the condition, but before checking the timeout.  This can cause the loop to report a timeout when the condition actually became true in the middle.  This patch adds one final check of the condition upon exit of the loop if the last test of the condition was still false.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Acked-by: Timur Tabi <timur@freescale.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | pasemi_dma.h | s | 23K | 491 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | bootx.h | s | 5.1K | 138 | Jaswinder Singh Rajput | jaswinderrajput@gmail.com | 1233466288 |  | headers_check fix: powerpc, bootx.h  fix the following 'make headers_check' warnings:    usr/include/asm-powerpc/bootx.h:12: include of <linux/types.h> is preferred over <asm/types.h>   usr/include/asm-powerpc/bootx.h:57: found __[us]{8,16,32,64} type without #include <linux/types.h>  Signed-off-by: Jaswinder Singh Rajput <jaswinderrajput@gmail.com>
f | keylargo.h | s | 10K | 232 | Justin P. Mattock | justinmattock@gmail.com | 1329820836 |  | Typos: change aditional to additional.  The below patch fixes some typos "aditional" to "additional", and also fixes a comment with another word mispelled.  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | mmzone.h | s | 994B | 38 | KAMEZAWA Hiroyuki | kamezawa.hiroyu@jp.fujitsu.com | 1309209189 |  | Fix node_start/end_pfn() definition for mm/page_cgroup.c  commit 21a3c96 uses node_start/end_pfn(nid) for detection start/end of nodes. But, it's not defined in linux/mmzone.h but defined in /arch/???/include/mmzone.h which is included only under CONFIG_NEED_MULTIPLE_NODES=y.  Then, we see   mm/page_cgroup.c: In function 'page_cgroup_init':   mm/page_cgroup.c:308: error: implicit declaration of function 'node_start_pfn'   mm/page_cgroup.c:309: error: implicit declaration of function 'node_end_pfn'  So, fixiing page_cgroup.c is an idea...  But node_start_pfn()/node_end_pfn() is a very generic macro and should be implemented in the same manner for all archs. (m32r has different implementation...)  This patch removes definitions of node_start/end_pfn() in each archs and defines a unified one in linux/mmzone.h. It's not under CONFIG_NEED_MULTIPLE_NODES, now.  A result of macro expansion is here (mm/page_cgroup.c)  for !NUMA  start_pfn = ((&contig_page_data)->node_start_pfn);   end_pfn = ({ pg_data_t *__pgdat = (&contig_page_data); __pgdat->node_start_pfn + __pgdat->node_spanned_pages;});  for NUMA (x86-64)   start_pfn = ((node_data[nid])->node_start_pfn);   end_pfn = ({ pg_data_t *__pgdat = (node_data[nid]); __pgdat->node_start_pfn + __pgdat->node_spanned_pages;});  Changelog:  - fixed to avoid using "nid" twice in node_end_pfn() macro.  Reported-and-acked-by: Randy Dunlap <randy.dunlap@oracle.com> Reported-and-tested-by: Ingo Molnar <mingo@elte.hu> Acked-by: Mel Gorman <mgorman@suse.de> Signed-off-by: KAMEZAWA Hiroyuki <kamezawa.hiroyu@jp.fujitsu.com> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | fsl_85xx_cache_sram.h | s | 1.4K | 41 | Harninder Rai | harninder.rai@freescale.com | 1287035678 |  | powerpc/85xx: add cache-sram support  It adds cache-sram support in P1/P2 QorIQ platforms as under:  * A small abstraction over powerpc's remote heap allocator * Exports mpc85xx_cache_sram_alloc()/free() APIs * Supports only one contiguous SRAM window * Drivers can do the following in Kconfig to use these APIs     "select FSL_85XX_CACHE_SRAM if MPC85xx" * Required SRAM size and the offset where SRAM should be mapped must be   provided at kernel command line as :     cache-sram-size=<value>     cache-sram-offset=<offset>  Signed-off-by: Harninder Rai <harninder.rai@freescale.com> Signed-off-by: Vivek Mahajan <vivek.mahajan@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | scom.h | s | 4.7K | 136 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1303282879 |  | powerpc: Add SCOM infrastructure  SCOM is a side-band configuration bus implemented on some processors. This code provides a way for code to map and operate on devices via SCOM, while the details of how that is implemented is left up to a SCOM "controller" in the platform code.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | hw_breakpoint.h | s | 2.5K | 65 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | ide.h | s | 547B | 14 | Adrian Bunk | bunk@kernel.org | 1219088403 |  | cleanup powerpc/include/asm/ide.h  This patch removes code that became unused through IDE changes and the arch/ppc/ removal.  Signed-off-by: Adrian Bunk <bunk@kernel.org> Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | cacheflush.h | s | 2.7K | 63 | Ilya Loginov | isloginov@gmail.com | 1259223379 |  | block: add helpers to run flush_dcache_page() against a bio and a request's pages  Mtdblock driver doesn't call flush_dcache_page for pages in request.  So, this causes problems on architectures where the icache doesn't fill from the dcache or with dcache aliases.  The patch fixes this.  The ARCH_IMPLEMENTS_FLUSH_DCACHE_PAGE symbol was introduced to avoid pointless empty cache-thrashing loops on architectures for which flush_dcache_page() is a no-op.  Every architecture was provided with this flush pages on architectires where ARCH_IMPLEMENTS_FLUSH_DCACHE_PAGE is equal 1 or do nothing otherwise.  See "fix mtd_blkdevs problem with caches on some architectures" discussion on LKML for more information.  Signed-off-by: Ilya Loginov <isloginov@gmail.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: David Woodhouse <dwmw2@infradead.org> Cc: Peter Horton <phorton@bitbox.co.uk> Cc: "Ed L. Cashin" <ecashin@coraid.com> Signed-off-by: Jens Axboe <jens.axboe@oracle.com>
f | mpc6xx.h | s | 104B | 4 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | kvm_book3s_asm.h | s | 3.2K | 111 | Paul Mackerras | paulus@samba.org | 1333882880 |  | KVM: PPC: Book3S HV: Make secondary threads more robust against stray IPIs  Currently on POWER7, if we are running the guest on a core and we don't need all the hardware threads, we do nothing to ensure that the unused threads aren't executing in the kernel (other than checking that they are offline).  We just assume they're napping and we don't do anything to stop them trying to enter the kernel while the guest is running. This means that a stray IPI can wake up the hardware thread and it will then try to enter the kernel, but since the core is in guest context, it will execute code from the guest in hypervisor mode once it turns the MMU on, which tends to lead to crashes or hangs in the host.  This fixes the problem by adding two new one-byte flags in the kvmppc_host_state structure in the PACA which are used to interlock between the primary thread and the unused secondary threads when entering the guest.  With these flags, the primary thread can ensure that the unused secondaries are not already in kernel mode (i.e. handling a stray IPI) and then indicate that they should not try to enter the kernel if they do get woken for any reason.  Instead they will go into KVM code, find that there is no vcpu to run, acknowledge and clear the IPI and go back to nap mode.  Signed-off-by: Paul Mackerras <paulus@samba.org> Signed-off-by: Alexander Graf <agraf@suse.de> Signed-off-by: Avi Kivity <avi@redhat.com>
f | eeh.h | s | 8.8K | 251 | Gavin Shan | shangw@linux.vnet.ibm.com | 1331253591 |  | powerpc/eeh: pseries platform config space access in EEH  With the original EEH implementation, the access to config space of the corresponding PCI device is done by RTAS sensitive function. That depends on pci_dn heavily. That would limit EEH extension to other platforms like powernv because other platforms might have different ways to access PCI config space.  The patch splits those functions used to access PCI config space and implement them in platform related EEH component. It would be helpful to support EEH on multiple platforms simutaneously in future.  Signed-off-by: Gavin Shan <shangw@linux.vnet.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | pSeries_reconfig.h | s | 1.4K | 40 | Kent Yoder | key@linux.vnet.ibm.com | 1336956546 |  | powerpc/pseries: Add pseries update notifier for OFDT prop changes  This adds an update notifier mechanism for changes to properties in the device tree.  One use of this would be a device driver that needs to act on changes to it's properties in the device tree after a live migration or a dynamic activation that is triggered by updates to ofdt properties.  Signed-off-by: Robert Jennings <rcj@linux.vnet.ibm.com> Signed-off-by: Kent Yoder <key@linux.vnet.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | trace.h | s | 2.1K | 87 | Anton Blanchard | anton@samba.org | 1256706784 |  | powerpc: tracing: Give hypervisor call tracepoints access to arguments  While most users of the hcall tracepoints will only want the opcode and return code, some will want all the arguments.  To avoid the complexity of using varargs we pass a pointer to the register save area, which contains all the arguments.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | 8xx_immap.h | s | 13K | 524 | Andrea Galbusera | gizero@gmail.com | 1303430370 |  | powerpc: Fix multicast problem in fs_enet driver  mac-fec.c was setting individual UDP address registers instead of multicast group address registers when joining a multicast group. This prevented from correctly receiving UDP multicast packets. According to datasheet, replaced hash_table_high and hash_table_low with grp_hash_table_high and grp_hash_table_low respectively. Also renamed hash_table_* with grp_hash_table_* in struct fec declaration for 8xx: these registers are used only for multicast there.  Tested on a MPC5121 based board. Build tested also against mpc866_ads_defconfig.  Signed-off-by: Andrea Galbusera <gizero@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ipic.h | s | 3.5K | 76 | Kumar Gala | galak@kernel.crashing.org | 1217819897 |  | powerpc: Remove use of CONFIG_PPC_MERGE  Now that arch/ppc is gone and CONFIG_PPC_MERGE is always set, remove the dead code associated with !CONFIG_PPC_MERGE from arch/powerpc and include/asm-powerpc.  Signed-off-by: Kumar Gala <galak@kernel.crashing.org> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | spu_info.h | s | 1.4K | 49 | Jaswinder Singh Rajput | jaswinderrajput@gmail.com | 1233466289 |  | headers_check fix: powerpc, spu_info.h  fix the following 'make headers_check' warning:    usr/include/asm-powerpc/spu_info.h:27: found __[us]{8,16,32,64} type without #include <linux/types.h>  Signed-off-by: Jaswinder Singh Rajput <jaswinderrajput@gmail.com>
f | hvcserver.h | s | 2.1K | 53 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | kdump.h | s | 1.3K | 35 | Suzuki Poulose | suzuki@in.ibm.com | 1324394419 |  | powerpc: Rename mapping based RELOCATABLE to DYNAMIC_MEMSTART for BookE  The current implementation of CONFIG_RELOCATABLE in BookE is based on mapping the page aligned kernel load address to KERNELBASE. This approach however is not enough for platforms, where the TLB page size is large (e.g, 256M on 44x). So we are renaming the RELOCATABLE used currently in BookE to DYNAMIC_MEMSTART to reflect the actual method.  The CONFIG_RELOCATABLE for PPC32(BookE) based on processing of the dynamic relocations will be introduced in the later in the patch series.  This change would allow the use of the old method of RELOCATABLE for platforms which can afford to enforce the page alignment (platforms with smaller TLB size).  Changes since v3:  * Introduced a new config, NONSTATIC_KERNEL, to denote a kernel which is   either a RELOCATABLE or DYNAMIC_MEMSTART(Suggested by: Josh Boyer)  Suggested-by: Scott Wood <scottwood@freescale.com> Tested-by: Scott Wood <scottwood@freescale.com>  Signed-off-by: Suzuki K. Poulose <suzuki@in.ibm.com> Cc: Scott Wood <scottwood@freescale.com> Cc: Kumar Gala <galak@kernel.crashing.org> Cc: Josh Boyer <jwboyer@gmail.com> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: linux ppc dev <linuxppc-dev@lists.ozlabs.org> Signed-off-by: Josh Boyer <jwboyer@gmail.com>
f | cpm.h | s | 6.1K | 190 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | pte-fsl-booke.h | s | 1.4K | 33 | Kumar Gala | galak@kernel.crashing.org | 1251872441 |  | powerpc/fsl-booke: Use HW PTE format if CONFIG_PTE_64BIT  Switch to using the Power ISA defined PTE format when we have a 64-bit PTE.  This makes the code handling between fsl-booke and book3e-64 similiar for TLB faults.  Additionally this lets use take advantage of the page size encodings and full permissions that the HW PTE defines.  Also defined _PMD_PRESENT, _PMD_PRESENT_MASK, and _PMD_BAD since the 32-bit ppc arch code expects them.  Signed-off-by: Kumar Gala <galak@kernel.crashing.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | current.h | s | 835B | 30 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | kvm_asm.h | s | 4.5K | 118 | Alexander Graf | agraf@suse.de | 1336313948 |  | KVM: PPC: Restrict PPC_[L||ST]D macro to asm code  We only want asm code macros to be accessible from asm code, so #ifdef it depending on it.  Signed-off-by: Alexander Graf <agraf@suse.de>
f | elf.h | s | 17K | 391 | Phil Carmody | ext-phil.2.carmody@nokia.com | 1311250200 |  | treewide: fix potentially dangerous trailing ';' in #defined values/expressions  All these are instances of   #define NAME value; or   #define NAME(params_opt) value;  These of course fail to build when used in contexts like   if(foo $OP NAME)   while(bar $OP NAME) and may silently generate the wrong code in contexts such as   foo = NAME + 1;    /* foo = value; + 1; */   bar = NAME - 1;    /* bar = value; - 1; */   baz = NAME & quux; /* baz = value; & quux; */  Reported on comp.lang.c, Message-ID: <ab0d55fe-25e5-482b-811e-c475aa6065c3@c29g2000yqd.googlegroups.com> Initial analysis of the dangers provided by Keith Thompson in that thread.  There are many more instances of more complicated macros having unnecessary trailing semicolons, but this pile seems to be all of the cases of simple values suffering from the problem. (Thus things that are likely to be found in one of the contexts above, more complicated ones aren't.)  Signed-off-by: Phil Carmody <ext-phil.2.carmody@nokia.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | seccomp.h | s | 455B | 12 | Roland McGrath | roland@redhat.com | 1236037290 |  | x86-64: seccomp: fix 32/64 syscall hole  On x86-64, a 32-bit process (TIF_IA32) can switch to 64-bit mode with ljmp, and then use the "syscall" instruction to make a 64-bit system call.  A 64-bit process make a 32-bit system call with int $0x80.  In both these cases under CONFIG_SECCOMP=y, secure_computing() will use the wrong system call number table.  The fix is simple: test TS_COMPAT instead of TIF_IA32.  Here is an example exploit:  	/* test case for seccomp circumvention on x86-64  	   There are two failure modes: compile with -m64 or compile with -m32.  	   The -m64 case is the worst one, because it does "chmod 777 ." (could 	   be any chmod call).  The -m32 case demonstrates it was able to do 	   stat(), which can glean information but not harm anything directly.  	   A buggy kernel will let the test do something, print, and exit 1; a 	   fixed kernel will make it exit with SIGKILL before it does anything. 	*/  	#define _GNU_SOURCE 	#include <assert.h> 	#include <inttypes.h> 	#include <stdio.h> 	#include <linux/prctl.h> 	#include <sys/stat.h> 	#include <unistd.h> 	#include <asm/unistd.h>  	int 	main (int argc, char **argv) 	{ 	  char buf[100]; 	  static const char dot[] = "."; 	  long ret; 	  unsigned st[24];  	  if (prctl (PR_SET_SECCOMP, 1, 0, 0, 0) != 0) 	    perror ("prctl(PR_SET_SECCOMP) -- not compiled into kernel?");  	#ifdef __x86_64__ 	  assert ((uintptr_t) dot < (1UL << 32)); 	  asm ("int $0x80 # %0 <- %1(%2 %3)" 	       : "=a" (ret) : "0" (15), "b" (dot), "c" (0777)); 	  ret = snprintf (buf, sizeof buf, 			  "result %ld (check mode on .!)\n", ret); 	#elif defined __i386__ 	  asm (".code32\n" 	       "pushl %%cs\n" 	       "pushl $2f\n" 	       "ljmpl $0x33, $1f\n" 	       ".code64\n" 	       "1: syscall # %0 <- %1(%2 %3)\n" 	       "lretl\n" 	       ".code32\n" 	       "2:" 	       : "=a" (ret) : "0" (4), "D" (dot), "S" (&st)); 	  if (ret == 0) 	    ret = snprintf (buf, sizeof buf, 			    "stat . -> st_uid=%u\n", st[7]); 	  else 	    ret = snprintf (buf, sizeof buf, "result %ld\n", ret); 	#else 	# error "not this one" 	#endif  	  write (1, buf, ret);  	  syscall (__NR_exit, 1); 	  return 2; 	}  Signed-off-by: Roland McGrath <roland@redhat.com> [ I don't know if anybody actually uses seccomp, but it's enabled in   at least both Fedora and SuSE kernels, so maybe somebody is. - Linus ] Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | local64.h | s | 33B | 1 | Peter Zijlstra | a.p.zijlstra@chello.nl | 1276074756 |  | arch: Implement local64_t  On 64bit, local_t is of size long, and thus we make local64_t an alias. On 32bit, we fall back to atomic64_t. (architecture can provide optimized 32-bit version)  (This new facility is to be used by perf events optimizations.)  Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Cc: linux-arch@vger.kernel.org Cc: Andrew Morton <akpm@linux-foundation.org> Cc: Linus Torvalds <torvalds@linux-foundation.org> LKML-Reference: <new-submission> Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | ehv_pic.h | s | 963B | 31 | Grant Likely | grant.likely@secretlab.ca | 1329253610 |  | irq_domain/powerpc: Use common irq_domain structure instead of irq_host  This patch drops the powerpc-specific irq_host structures and uses the common irq_domain strucutres defined in linux/irqdomain.h.  It also fixes all the users to use the new structure names.  Renaming irq_host to irq_domain has been discussed for a long time, and this patch is a step in the process of generalizing the powerpc virq code to be usable by all architecture.  An astute reader will notice that this patch actually removes the irq_host structure instead of renaming it.  This is because the irq_domain structure already exists in include/linux/irqdomain.h and has the needed data members.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | tlb.h | s | 1.2K | 41 | Peter Zijlstra | a.p.zijlstra@chello.nl | 1306337956 |  | mm, powerpc: move the RCU page-table freeing into generic code  In case other architectures require RCU freed page-tables to implement gup_fast() and software filled hashes and similar things, provide the means to do so by moving the logic into generic code.  Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Requested-by: David Miller <davem@davemloft.net> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: Russell King <rmk@arm.linux.org.uk> Cc: Paul Mundt <lethal@linux-sh.org> Cc: Jeff Dike <jdike@addtoit.com> Cc: Richard Weinberger <richard@nod.at> Cc: Tony Luck <tony.luck@intel.com> Cc: KAMEZAWA Hiroyuki <kamezawa.hiroyu@jp.fujitsu.com> Cc: Hugh Dickins <hughd@google.com> Cc: Mel Gorman <mel@csn.ul.ie> Cc: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com> Cc: Nick Piggin <npiggin@kernel.dk> Cc: Namhyung Kim <namhyung@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | pgtable-ppc64-64k.h | s | 1.3K | 30 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1250727155 |  | powerpc/mm: Fix misplaced #endif in pgtable-ppc64-64k.h  A misplaced #endif causes more definitions than intended to be protected by #ifndef __ASSEMBLY__. This breaks upcoming 64-bit BookE support patch when using 64k pages.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | btext.h | s | 858B | 24 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | udbg.h | s | 2.1K | 53 | Stephen Rothwell | sfr@canb.auug.org.au | 1332894803 |  | powerpc: Random little legacy iSeries removal tidy ups  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | mmu-44x.h | s | 5.5K | 130 | Dave Kleikamp | shaggy@linux.vnet.ibm.com | 1273065070 |  | powerpc/47x: Base ppc476 support  This patch adds the base support for the 476 processor.  The code was primarily written by Ben Herrenschmidt and Torez Smith, but I've been maintaining it for a while.  The goal is to have a single binary that will run on 44x and 47x, but we still have some details to work out.  The biggest is that the L1 cache line size differs on the two platforms, but it's currently a compile-time option.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Torez Smith  <lnxtorez@linux.vnet.ibm.com> Signed-off-by: Dave Kleikamp <shaggy@linux.vnet.ibm.com> Signed-off-by: Josh Boyer <jwboyer@linux.vnet.ibm.com>
f | ps3av.h | s | 23K | 674 | roel kluin | roel.kluin@gmail.com | 1236751817 |  | powerpc/ps3: Make ps3av_set_video_mode mode ID signed  Change the ps3av_auto_videomode() mode id argument type from unsigned to signed so a negative id can be detected and reported as an -EINVAL failure.  Signed-off-by: Roel Kluin <roel.kluin@gmail.com> Signed-off-by: Geoff Levand <geoffrey.levand@am.sony.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | resource.h | s | 34B | 1 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | cputhreads.h | s | 2.2K | 75 | Anshuman Khandual | khandual@linux.vnet.ibm.com | 1337661420 |  | powerpc: Fixing a cputhread code documentation  -- Signed-off-by: Anshuman Khandual <khandual@linux.vnet.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | unaligned.h | s | 383B | 12 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | serial.h | s | 677B | 20 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | kvm_booke_hv_asm.h | s | 1.5K | 45 | Scott Wood | scottwood@freescale.com | 1333878679 |  | KVM: PPC: booke: category E.HV (GS-mode) support  Chips such as e500mc that implement category E.HV in Power ISA 2.06 provide hardware virtualization features, including a new MSR mode for guest state.  The guest OS can perform many operations without trapping into the hypervisor, including transitions to and from guest userspace.  Since we can use SRR1[GS] to reliably tell whether an exception came from guest state, instead of messing around with IVPR, we use DO_KVM similarly to book3s.  Current issues include:  - Machine checks from guest state are not routed to the host handler.  - The guest can cause a host oops by executing an emulated instruction    in a page that lacks read permission.  Existing e500/4xx support has    the same problem.  Includes work by Ashish Kalra <Ashish.Kalra@freescale.com>, Varun Sethi <Varun.Sethi@freescale.com>, and Liu Yu <yu.liu@freescale.com>.  Signed-off-by: Scott Wood <scottwood@freescale.com> [agraf: remove pt_regs usage] Signed-off-by: Alexander Graf <agraf@suse.de> Signed-off-by: Avi Kivity <avi@redhat.com>
f | paca.h | s | 6.0K | 161 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1331259906 |  | powerpc: Rework lazy-interrupt handling  The current implementation of lazy interrupts handling has some issues that this tries to address.  We don't do the various workarounds we need to do when re-enabling interrupts in some cases such as when returning from an interrupt and thus we may still lose or get delayed decrementer or doorbell interrupts.  The current scheme also makes it much harder to handle the external "edge" interrupts provided by some BookE processors when using the EPR facility (External Proxy) and the Freescale Hypervisor.  Additionally, we tend to keep interrupts hard disabled in a number of cases, such as decrementer interrupts, external interrupts, or when a masked decrementer interrupt is pending. This is sub-optimal.  This is an attempt at fixing it all in one go by reworking the way we do the lazy interrupt disabling from the ground up.  The base idea is to replace the "hard_enabled" field with a "irq_happened" field in which we store a bit mask of what interrupt occurred while soft-disabled.  When re-enabling, either via arch_local_irq_restore() or when returning from an interrupt, we can now decide what to do by testing bits in that field.  We then implement replaying of the missed interrupts either by re-using the existing exception frame (in exception exit case) or via the creation of a new one from an assembly trampoline (in the arch_local_irq_enable case).  This removes the need to play with the decrementer to try to create fake interrupts, among others.  In addition, this adds a few refinements:   - We no longer  hard disable decrementer interrupts that occur while soft-disabled. We now simply bump the decrementer back to max (on BookS) or leave it stopped (on BookE) and continue with hard interrupts enabled, which means that we'll potentially get better sample quality from performance monitor interrupts.   - Timer, decrementer and doorbell interrupts now hard-enable shortly after removing the source of the interrupt, which means they no longer run entirely hard disabled. Again, this will improve perf sample quality.   - On Book3E 64-bit, we now make the performance monitor interrupt act as an NMI like Book3S (the necessary C code for that to work appear to already be present in the FSL perf code, notably calling nmi_enter instead of irq_enter). (This also fixes a bug where BookE perfmon interrupts could clobber r14 ... oops)   - We could make "masked" decrementer interrupts act as NMIs when doing timer-based perf sampling to improve the sample quality.  Signed-off-by-yet: Benjamin Herrenschmidt <benh@kernel.crashing.org> ---  v2:  - Add hard-enable to decrementer, timer and doorbells - Fix CR clobber in masked irq handling on BookE - Make embedded perf interrupt act as an NMI - Add a PACA_HAPPENED_EE_EDGE for use by FSL if they want   to retrigger an interrupt without preventing hard-enable  v3:   - Fix or vs. ori bug on Book3E  - Fix enabling of interrupts for some exceptions on Book3E  v4:   - Fix resend of doorbells on return from interrupt on Book3E  v5:   - Rebased on top of my latest series, which involves some significant rework of some aspects of the patch.  v6:  - 32-bit compile fix  - more compile fixes with various .config combos  - factor out the asm code to soft-disable interrupts  - remove the C wrapper around preempt_schedule_irq  v7:  - Fix a bug with hard irq state tracking on native power7
f | vdso.h | s | 1.5K | 53 | Anton Blanchard | anton@samba.org | 1250727144 |  | powerpc: Move 64bit VDSO to improve context switch performance  On 64bit applications the VDSO is the only thing in segment 0. Since the VDSO is position independent we can remove the hint and let get_unmapped_area pick an area. This will mean the vdso will be near other mmaps and will share an SLB entry:  10000000-10001000 r-xp 00000000 08:06 5778459        /root/context_switch_64 10010000-10011000 r--p 00000000 08:06 5778459        /root/context_switch_64 10011000-10012000 rw-p 00001000 08:06 5778459        /root/context_switch_64 fffa92ae000-fffa92b0000 rw-p 00000000 00:00 0 fffa92b0000-fffa9453000 r-xp 00000000 08:06 4334051  /lib64/power6/libc-2.9.so fffa9453000-fffa9462000 ---p 001a3000 08:06 4334051  /lib64/power6/libc-2.9.so fffa9462000-fffa9466000 r--p 001a2000 08:06 4334051  /lib64/power6/libc-2.9.so fffa9466000-fffa947c000 rw-p 001a6000 08:06 4334051  /lib64/power6/libc-2.9.so fffa947c000-fffa9480000 rw-p 00000000 00:00 0 fffa9480000-fffa94a8000 r-xp 00000000 08:06 4333852  /lib64/ld-2.9.so fffa94b3000-fffa94b4000 rw-p 00000000 00:00 0  fffa94b4000-fffa94b7000 r-xp 00000000 00:00 0        [vdso] <----- here I am  fffa94b7000-fffa94b8000 r--p 00027000 08:06 4333852  /lib64/ld-2.9.so fffa94b8000-fffa94bb000 rw-p 00028000 08:06 4333852  /lib64/ld-2.9.so fffa94bb000-fffa94bc000 rw-p 00000000 00:00 0 fffe4c10000-fffe4c25000 rw-p 00000000 00:00 0        [stack]  On a microbenchmark that bounces a token between two 64bit processes over pipes and calls gettimeofday each iteration (to access the VDSO), our context switch rate goes from 268k to 277k ctx switches/sec (tested on a 4GHz POWER6).  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | dbdma.h | s | 3.7K | 96 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | ucontext.h | s | 912B | 36 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | pte-common.h | s | 5.7K | 170 | Stefan Roese | sr@denx.de | 1303096101 |  | powerpc: Don't write protect kernel text with CONFIG_DYNAMIC_FTRACE enabled  This problem was noticed on an MPC855T platform. Ftrace did oops when trying to write to the kernel text segment.  Many thanks to Joakim for finding the root cause of this problem.  Signed-off-by: Stefan Roese <sr@denx.de> Cc: Joakim Tjernlund <joakim.tjernlund@transmode.se> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Steven Rostedt <rostedt@goodmis.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | pte-book3e.h | s | 2.8K | 77 | Becky Bruce | beckyb@kernel.crashing.org | 1316474380 |  | powerpc: Hugetlb for BookE  Enable hugepages on Freescale BookE processors.  This allows the kernel to use huge TLB entries to map pages, which can greatly reduce the number of TLB misses and the amount of TLB thrashing experienced by applications with large memory footprints.  Care should be taken when using this on FSL processors, as the number of large TLB entries supported by the core is low (16-64) on current processors.  The supported set of hugepage sizes include 4m, 16m, 64m, 256m, and 1g. Page sizes larger than the max zone size are called "gigantic" pages and must be allocated on the command line (and cannot be deallocated).  This is currently only fully implemented for Freescale 32-bit BookE processors, but there is some infrastructure in the code for 64-bit BooKE.  Signed-off-by: Becky Bruce <beckyb@kernel.crashing.org> Signed-off-by: David Gibson <david@gibson.dropbear.id.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | fs_pd.h | s | 1.0K | 40 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | msi_bitmap.h | s | 1008B | 28 | Michael Ellerman | michael@ellerman.id.au | 1219214097 |  | powerpc: Split-out common MSI bitmap logic into msi_bitmap.c  There are now two almost identical implementations of an MSI bitmap allocator, one in mpic_msi.c and the other in fsl_msi.c.  Merge them together and put the result in msi_bitmap.c.  Some of the MPIC bits will remain to provide a nicer interface for the MPIC users.  In the process we fix two buglets.  The first is that the allocation routines, now msi_bitmap_alloc_hwirqs(), returned an unsigned result, even though they use -1 to indicate allocation failure.  Although all the callers were checking correctly, it is much better for the routine to just return an int.  At least until someone wants > ~2 billion MSIs.  The second buglet is that the device tree reservation logic only allowed power-of-two reservations.  AFAICT that didn't effect any existing code but it's nicer if we can reserve arbitrary irqs from MSI use.  We also add some selftests, which exposed the two buglets and now test for them, as well as some basic sanity tests.  The tests are only built when CONFIG_DEBUG_KERNEL=y.  Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | rtas.h | s | 12K | 315 | Linus Torvalds | torvalds@linux-foundation.org | 1332975501 |  | 
f | mpic_msgr.h | s | 3.5K | 120 | Mingkai Hu | Mingkai.hu@freescale.com | 1334865356 |  | powerpc/mpic_msgr: fix compile error when SMP disabled  In file included from arch/powerpc/sysdev/mpic_msgr.c:20:0: ~/arch/powerpc/include/asm/mpic_msgr.h: In function 'mpic_msgr_set_destination': ~/arch/powerpc/include/asm/mpic_msgr.h:117:2: error: implicit declaration of function 'get_hard_smp_processor_id' make[1]: *** [arch/powerpc/sysdev/mpic_msgr.o] Error 1  Signed-off-by: Mingkai Hu <Mingkai.hu@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | termios.h | s | 1.9K | 72 | Arnd Bergmann | arnd@arndb.de | 1244746912 |  | asm-generic: rename termios.h, signal.h and mman.h  The existing asm-generic versions are incomplete and included by some architectures. New architectures should be able to use a generic version, so rename the existing files and change all users, which lets us add the new files.  Signed-off-by: Remis Lima Baima <remis.developer@googlemail.com> Signed-off-by: Arnd Bergmann <arnd@arndb.de>
f | mpc5xxx.h | s | 641B | 18 | Wolfgang Denk | wd@denx.de | 1245220222 |  | powerpc/5xxx: Add common mpc5xxx_get_bus_frequency() function  So far, MPC512x used mpc512x_find_ips_freq() to get the bus frequency, while MPC52xx used mpc52xx_find_ipb_freq().  Despite the different clock names (IPS vs. IPB) the code was identical.  Use common code for both processor families.  Signed-off-by: Wolfgang Denk <wd@denx.de> Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | ppc-opcode.h | s | 7.8K | 192 | Paul Mackerras | paulus@samba.org | 1330951957 |  | KVM: PPC: Implement MMIO emulation support for Book3S HV guests  This provides the low-level support for MMIO emulation in Book3S HV guests.  When the guest tries to map a page which is not covered by any memslot, that page is taken to be an MMIO emulation page.  Instead of inserting a valid HPTE, we insert an HPTE that has the valid bit clear but another hypervisor software-use bit set, which we call HPTE_V_ABSENT, to indicate that this is an absent page.  An absent page is treated much like a valid page as far as guest hcalls (H_ENTER, H_REMOVE, H_READ etc.) are concerned, except of course that an absent HPTE doesn't need to be invalidated with tlbie since it was never valid as far as the hardware is concerned.  When the guest accesses a page for which there is an absent HPTE, it will take a hypervisor data storage interrupt (HDSI) since we now set the VPM1 bit in the LPCR.  Our HDSI handler for HPTE-not-present faults looks up the hash table and if it finds an absent HPTE mapping the requested virtual address, will switch to kernel mode and handle the fault in kvmppc_book3s_hv_page_fault(), which at present just calls kvmppc_hv_emulate_mmio() to set up the MMIO emulation.  This is based on an earlier patch by Benjamin Herrenschmidt, but since heavily reworked.  Signed-off-by: Paul Mackerras <paulus@samba.org> Signed-off-by: Alexander Graf <agraf@suse.de> Signed-off-by: Avi Kivity <avi@redhat.com>
f | page_32.h | s | 1.3K | 40 | FUJITA Tomonori | fujita.tomonori@lab.ntt.co.jp | 1281542361 |  | dma-mapping: rename ARCH_KMALLOC_MINALIGN to ARCH_DMA_MINALIGN  Now each architecture has the own dma_get_cache_alignment implementation.  dma_get_cache_alignment returns the minimum DMA alignment.  Architectures define it as ARCH_KMALLOC_MINALIGN (it's used to make sure that malloc'ed buffer is DMA-safe; the buffer doesn't share a cache with the others).  So we can unify dma_get_cache_alignment implementations.  This patch:  dma_get_cache_alignment() needs to know if an architecture defines ARCH_KMALLOC_MINALIGN or not (needs to know if architecture has DMA alignment restriction).  However, slab.h define ARCH_KMALLOC_MINALIGN if architectures doesn't define it.  Let's rename ARCH_KMALLOC_MINALIGN to ARCH_DMA_MINALIGN. ARCH_KMALLOC_MINALIGN is used only in the internals of slab/slob/slub (except for crypto).  Signed-off-by: FUJITA Tomonori <fujita.tomonori@lab.ntt.co.jp> Cc: <linux-arch@vger.kernel.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | spu_priv1.h | s | 5.7K | 197 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | bitsperlong.h | s | 249B | 9 | Arnd Bergmann | arnd@arndb.de | 1244746934 |  | asm-generic: introduce asm/bitsperlong.h  This provides a reliable way for asm-generic/types.h and other files to find out if it is running on a 32 or 64 bit platform.  We cannot use CONFIG_64BIT for this in headers that are included from user space because CONFIG symbols are not available there. We also cannot do it inside of asm/types.h because some headers need the word size but cannot include types.h.  The solution is to introduce a new header <asm/bitsperlong.h> that defines both __BITS_PER_LONG for user space and BITS_PER_LONG for usage in the kernel. The asm-generic version falls back to 32 bit unless the architecture overrides it, which I did for all 64 bit platforms.  Signed-off-by: Remis Lima Baima <remis.developer@googlemail.com> Signed-off-by: Arnd Bergmann <arnd@arndb.de>
f | smp.h | s | 5.0K | 157 | Stephen Rothwell | sfr@canb.auug.org.au | 1332894803 |  | powerpc: Random little legacy iSeries removal tidy ups  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | ioctls.h | s | 3.8K | 100 | Kay Sievers | kay.sievers@vrfy.org | 1297980990 |  | tty: add TIOCVHANGUP to allow clean tty shutdown of all ttys  This is useful for system management software so that it can kick off things like gettys and everything that's started from a tty, before we reuse it from/for something else or shut it down.  Without this ioctl it would have to temporarily become the owner of the tty, then call vhangup() and then give it up again.  Cc: Lennart Poettering <lennart@poettering.net> Signed-off-by: Kay Sievers <kay.sievers@vrfy.org> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | immap_qe.h | s | 15K | 462 | Timur Tabi | timur@freescale.com | 1294876966 |  | powerpc: fix warning when compiling immap_qe.h  Fix the warnings genereted by arch/powerpc/include/asm/immap_qe.h when CONFIG_PHYS_ADDR_T_64BIT is defined:  immap_qe.h: In function 'immrbar_virt_to_phys': immap_qe.h:472:8: warning: cast from pointer to integer of different size immap_qe.h:472:24: warning: cast from pointer to integer of different size immap_qe.h:473:5: warning: cast from pointer to integer of different size immap_qe.h:473:21: warning: cast from pointer to integer of different size immap_qe.h:474:36: warning: cast from pointer to integer of different size  Note that the QE does not support 36-bit physical addresses, so even when CONFIG_PHYS_ADDR_T_64BIT is defined, the QE MURAM must be located below the 4GB boundary.  Signed-off-by: Timur Tabi <timur@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | cell-regs.h | s | 9.5K | 259 | Geert Uytterhoeven | Geert.Uytterhoeven@sonycom.com | 1250728166 |  | powerpc/cell: Move CBE_IOPTE_* to <asm/cell-regs.h>  As <asm/iommu.h> doesn't contain any other hardware specific definitions but only interfaces.  Reported-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Geert Uytterhoeven <Geert.Uytterhoeven@sonycom.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | mpc5121.h | s | 1.7K | 53 | Anatolij Gustschin | agust@denx.de | 1280704004 |  | powerpc/5121: shared DIU framebuffer support  MPC5121 DIU configuration/setup as initialized by the boot loader currently will get lost while booting Linux. As a result displaying the boot splash is not possible through the boot process.  To prevent this we reserve configured DIU frame buffer address range while booting and preserve AOI descriptor and gamma table so that DIU continues displaying through the whole boot process. On first open from user space DIU frame buffer driver releases the reserved frame buffer area and continues to operate as usual.  Signed-off-by: John Rigby <jcrigby@gmail.com> Signed-off-by: Anatolij Gustschin <agust@denx.de> Acked-by: Timur Tabi <timur@freescale.com> Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | ps3fb.h | s | 1.7K | 39 | Huang Weiyi | weiyi.huang@gmail.com | 1239081538 |  | powerpc: Remove duplicated #include's  Remove duplicated #include's in   - arch/powerpc/include/asm/ps3fb.h   - arch/powerpc/kernel/setup-common.c  Signed-off-by: Huang Weiyi <weiyi.huang@gmail.com> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | siginfo.h | s | 571B | 16 | Srinivasa Ds | srinivasa@in.ibm.com | 1222169212 |  | signals: demultiplexing SIGTRAP signal  Currently a SIGTRAP can denote any one of below reasons. 	- Breakpoint hit 	- H/W debug register hit 	- Single step 	- Signal sent through kill() or rasie()  Architectures like powerpc/parisc provides infrastructure to demultiplex SIGTRAP signal by passing down the information for receiving SIGTRAP through si_code of siginfot_t structure. Here is an attempt is generalise this infrastructure by extending it to x86 and x86_64 archs.  Signed-off-by: Srinivasa DS <srinivasa@in.ibm.com> Cc: Roland McGrath <roland@redhat.com> Cc: akpm@linux-foundation.org Cc: paulus@samba.org Cc: linuxppc-dev@ozlabs.org Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | ucc_slow.h | s | 9.5K | 264 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | eeh_event.h | s | 1.3K | 34 | Gavin Shan | shangw@linux.vnet.ibm.com | 1331253586 |  | powerpc/eeh: Replace pci_dn with eeh_dev for EEH aux components  The original EEH implementation is heavily depending on struct pci_dn. We have to put EEH related information to pci_dn. Actually, we could split struct pci_dn so that the EEH sensitive information to form an individual struct, then EEH looks more independent.  The patch replaces pci_dn with eeh_dev for EEH aux components like event and driver. Also, the eeh_event struct has been adjusted for a little bit since eeh_dev has linked the associated FDT (Flat Device Tree) node and PCI device. It's not necessary for eeh_event struct to trace FDT node and PCI device. We can just simply to trace eeh_dev in eeh_event.  The patch also renames function pcid_name() to eeh_pcid_name(), which should be missed in the previous patch where the EEH aux components have been cleaned up.  Signed-off-by: Gavin Shan <shangw@linux.vnet.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | dma-mapping.h | s | 5.9K | 177 | Andrzej Pietrasiewicz | andrzej.p@samsung.com | 1332945393 |  | PowerPC: adapt for dma_map_ops changes  Adapt core PowerPC architecture code for dma_map_ops changes: replace alloc/free_coherent with generic alloc/free methods.  Signed-off-by: Andrzej Pietrasiewicz <andrzej.p@samsung.com> [added missing changes to arch/powerpc/kernel/vio.c] Signed-off-by: Kyungmin Park <kyungmin.park@samsung.com> Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com> Reviewed-by: David Gibson <david@gibson.dropbear.id.au> Reviewed-by: Arnd Bergmann <arnd@arndb.de>
f | cell-pmu.h | s | 4.0K | 92 | Carl Love | cel@us.ibm.com | 1231426315 |  | powerpc/oprofile: IBM CELL: add SPU event profiling support  This patch adds the SPU event based profiling funcitonality for the IBM Cell processor.  Previously, the CELL OProfile kernel code supported PPU event, PPU cycle profiling and SPU cycle profiling.   The addition of SPU event profiling allows the users to identify where in their SPU code various SPU evnets are occuring.  This should help users further identify issues with their code.  Note, SPU profiling has some limitations due to HW constraints.  Only one event at a time can be used for profiling and SPU event profiling must be time sliced across all of the SPUs in a node.  The patch adds a new arch specific file to the OProfile file system. The file has bit 0 set to indicate that the kernel supports SPU event profiling. The user tool must check this file/bit to make sure the kernel supports SPU event profiling before trying to do SPU event profiling.  The user tool check is part of the user tool patch for SPU event profiling.  Signed-off-by: Carl Love <carll@us.ibm.com> Signed-off-by: Robert Richter <robert.richter@amd.com>
f | pmi.h | s | 1.8K | 56 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | kvm_host.h | s | 12K | 484 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1336313951 |  | kvm/book3s: Make kernel emulated H_PUT_TCE available for "PR" KVM  There is nothing in the code for emulating TCE tables in the kernel that prevents it from working on "PR" KVM... other than ifdef's and location of the code.  This and moves the bulk of the code there to a new file called book3s_64_vio.c.  This speeds things up a bit on my G5.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> [agraf: fix for hv kvm, 32bit, whitespace] Signed-off-by: Alexander Graf <agraf@suse.de>
f | tce.h | s | 1.8K | 46 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1322191977 |  | powerpc/powernv: Add TCE SW invalidation support  This is used for newer IO Hubs such as p7IOC.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | kvm_book3s_32.h | s | 1.4K | 40 | Alexander Graf | agraf@suse.de | 1330951950 |  | KVM: PPC: Use get/set for to_svcpu to help preemption  When running the 64-bit Book3s PR code without CONFIG_PREEMPT_NONE, we were doing a few things wrong, most notably access to PACA fields without making sure that the pointers stay stable accross the access (preempt_disable()).  This patch moves to_svcpu towards a get/put model which allows us to disable preemption while accessing the shadow vcpu fields in the PACA. That way we can run preemptible and everyone's happy!  Reported-by: Jörg Sommer <joerg@alea.gnuu.de> Signed-off-by: Alexander Graf <agraf@suse.de> Signed-off-by: Avi Kivity <avi@redhat.com>
f | pgalloc-32.h | s | 1.6K | 38 | David Gibson | david@gibson.dropbear.id.au | 1256883657 |  | powerpc/mm: Cleanup management of kmem_caches for pagetables  Currently we have a fair bit of rather fiddly code to manage the various kmem_caches used to store page tables of various levels.  We generally have two caches holding some combination of PGD, PUD and PMD tables, plus several more for the special hugepage pagetables.  This patch cleans this all up by taking a different approach.  Rather than the caches being designated as for PUDs or for hugeptes for 16M pages, the caches are simply allocated to be a specific size.  Thus sharing of caches between different types/levels of pagetables happens naturally.  The pagetable size, where needed, is passed around encoded in the same way as {PGD,PUD,PMD}_INDEX_SIZE; that is n where the pagetable contains 2^n pointers.  Signed-off-by: David Gibson <dwg@au1.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | kvm_ppc.h | s | 8.3K | 185 | Alexander Graf | agraf@suse.de | 1336313953 |  | KVM: PPC: Emulator: clean up SPR reads and writes  When reading and writing SPRs, every SPR emulation piece had to read or write the respective GPR the value was read from or stored in itself.  This approach is pretty prone to failure. What if we accidentally implement mfspr emulation where we just do "break" and nothing else? Suddenly we would get a random value in the return register - which is always a bad idea.  So let's consolidate the generic code paths and only give the core specific SPR handling code readily made variables to read/write from/to.  Functionally, this patch doesn't change anything, but it increases the readability of the code and makes is less prone to bugs.  Signed-off-by: Alexander Graf <agraf@suse.de>
f | mpic.h | s | 13K | 408 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1335143070 |  | powerpc/mpic: Properly set default triggers  This gets rid of the unused default senses array, and replaces the incorrect use of IRQ_TYPE_NONE with the new IRQ_TYPE_DEFAULT for the initial set_trigger() call when mapping an interrupt.  This in turn makes us read the HW state and update the irq desc accordingly.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | prom.h | s | 2.2K | 58 | Arun Sharma | asharma@fb.com | 1311724187 |  | atomic: use <linux/atomic.h>  This allows us to move duplicated code in <asm/atomic.h> (atomic_inc_not_zero() for now) to <linux/atomic.h>  Signed-off-by: Arun Sharma <asharma@fb.com> Reviewed-by: Eric Dumazet <eric.dumazet@gmail.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: David Miller <davem@davemloft.net> Cc: Eric Dumazet <eric.dumazet@gmail.com> Acked-by: Mike Frysinger <vapier@gentoo.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | perf_event_fsl_emb.h | s | 1.4K | 41 | Scott Wood | scottwood@freescale.com | 1267779848 |  | powerpc/perf: e500 support  This implements perf_event support for the Freescale embedded performance monitor, based on the existing perf_event.c that supports server/classic chips.  Some limitations: - Performance monitor interrupts are regular EE interrupts, and thus you   can't profile places with interrupts disabled.  We may want to implement   soft IRQ-disabling, with perfmon interrupts exempted and treated as NMIs. - When trying to schedule multiple event groups at once, and using   restricted events, situations could arise where scheduling fails even   though it would be possible.  Consider three groups, each with two events.   One group has restricted events, the others don't.  The two non-restricted   groups are scheduled, then one is removed, which happens to occupy the two   counters that can't do restricted events.  The remaining non-restricted   group will not be moved to the non-restricted-capable counters to make   room if the restricted group tries to be scheduled.  Signed-off-by: Scott Wood <scottwood@freescale.com> Acked-by: Paul Mackerras <paulus@samba.org> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | kvm_book3s.h | s | 12K | 393 | Linus Torvalds | torvalds@linux-foundation.org | 1337901450 |  | Merge branch 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm  Pull KVM changes from Avi Kivity:  "Changes include additional instruction emulation, page-crossing MMIO,   faster dirty logging, preventing the watchdog from killing a stopped   guest, module autoload, a new MSI ABI, and some minor optimizations   and fixes.  Outside x86 we have a small s390 and a very large ppc   update.    Regarding the new (for kvm) rebaseless workflow, some of the patches   that were merged before we switch trees had to be rebased, while   others are true pulls.  In either case the signoffs should be correct   now."  Fix up trivial conflicts in Documentation/feature-removal-schedule.txt arch/powerpc/kvm/book3s_segment.S and arch/x86/include/asm/kvm_para.h.  I suspect the kvm_para.h resolution ends up doing the "do I have cpuid" check effectively twice (it was done differently in two different commits), but better safe than sorry ;)  * 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm: (125 commits)   KVM: make asm-generic/kvm_para.h have an ifdef __KERNEL__ block   KVM: s390: onereg for timer related registers   KVM: s390: epoch difference and TOD programmable field   KVM: s390: KVM_GET/SET_ONEREG for s390   KVM: s390: add capability indicating COW support   KVM: Fix mmu_reload() clash with nested vmx event injection   KVM: MMU: Don't use RCU for lockless shadow walking   KVM: VMX: Optimize %ds, %es reload   KVM: VMX: Fix %ds/%es clobber   KVM: x86 emulator: convert bsf/bsr instructions to emulate_2op_SrcV_nobyte()   KVM: VMX: unlike vmcs on fail path   KVM: PPC: Emulator: clean up SPR reads and writes   KVM: PPC: Emulator: clean up instruction parsing   kvm/powerpc: Add new ioctl to retreive server MMU infos   kvm/book3s: Make kernel emulated H_PUT_TCE available for "PR" KVM   KVM: PPC: bookehv: Fix r8/r13 storing in level exception handler   KVM: PPC: Book3S: Enable IRQs during exit handling   KVM: PPC: Fix PR KVM on POWER7 bare metal   KVM: PPC: Fix stbux emulation   KVM: PPC: bookehv: Use lwz/stw instead of PPC_LL/PPC_STL for 32-bit fields   ...
f | types.h | s | 1.4K | 43 | Linus Torvalds | torvalds@linux-foundation.org | 1326053997 |  | Merge branch 'for-linus2' of git://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs  * 'for-linus2' of git://git.kernel.org/pub/scm/linux/kernel/git/viro/vfs: (165 commits)   reiserfs: Properly display mount options in /proc/mounts   vfs: prevent remount read-only if pending removes   vfs: count unlinked inodes   vfs: protect remounting superblock read-only   vfs: keep list of mounts for each superblock   vfs: switch ->show_options() to struct dentry *   vfs: switch ->show_path() to struct dentry *   vfs: switch ->show_devname() to struct dentry *   vfs: switch ->show_stats to struct dentry *   switch security_path_chmod() to struct path *   vfs: prefer ->dentry->d_sb to ->mnt->mnt_sb   vfs: trim includes a bit   switch mnt_namespace ->root to struct mount   vfs: take /proc/*/mounts and friends to fs/proc_namespace.c   vfs: opencode mntget() mnt_set_mountpoint()   vfs: spread struct mount - remaining argument of next_mnt()   vfs: move fsnotify junk to struct mount   vfs: move mnt_devname   vfs: move mnt_list to struct mount   vfs: switch pnode.h macros to struct mount *   ...
f | kvm_44x.h | s | 1.8K | 54 | Scott Wood | scottwood@freescale.com | 1306068473 |  | KVM: PPC: booke: add sregs support  Signed-off-by: Scott Wood <scottwood@freescale.com> Signed-off-by: Alexander Graf <agraf@suse.de>
f | bugs.h | s | 486B | 14 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | hw_irq.h | s | 4.4K | 165 | Anton Blanchard | anton@samba.org | 1340944537 |  | powerpc: check_and_cede_processor() never cedes  Commit f948501b36c6 ("Make hard_irq_disable() actually hard-disable interrupts") caused check_and_cede_processor to stop working. ->irq_happened will never be zero right after a hard_irq_disable so the compiler removes the call to cede_processor completely.  The bug was introduced back in the lazy interrupt handling rework of 3.4 but was hidden until recently because hard_irq_disable did nothing.  This issue will eventually appear in 3.4 stable since the hard_irq_disable fix is marked stable, so mark this one for stable too.  Signed-off-by: Anton Blanchard <anton@samba.org> Cc: stable@vger.kernel.org Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | io-workarounds.h | s | 1.5K | 41 | Michael Ellerman | michael@ozlabs.org | 1303877911 |  | powerpc/pci: Make IO workarounds init implicit when first bus is registered  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | abs_addr.h | s | 1.3K | 44 | Stephen Rothwell | sfr@canb.auug.org.au | 1332288971 |  | powerpc: Remove FW_FEATURE ISERIES from arch code  This is no longer selectable, so just remove all the dependent code.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | kdebug.h | s | 252B | 13 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | pci-bridge.h | s | 7.0K | 198 | Gavin Shan | shangw@linux.vnet.ibm.com | 1332894717 |  | powerpc/eeh: Remove eeh information from pci_dn  The patch removes the eeh information from pci_dn since the eeh device (struct eeh_dev) already contained those information and the copy in pci_dn is no longer used except for the pseries iommu mapping code, which we change to retrieve the PE address from eeh device instead.  Signed-off-by: Gavin Shan <shangw@linux.vnet.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | vio.h | s | 4.8K | 147 | Kent Yoder | key@linux.vnet.ibm.com | 1336956549 |  | powerpc/pseries: Add PFO support to the VIO bus  Add support for the Platform Facilities Option (PFO) to the VIO bus. These devices have a separate root node in OpenFirmware which requires additional parsing to map into the existing VIO device structure fields. This adds the interface for PFO device drivers to make synchronous hypervisor calls.  Signed-off-by: Robert Jennings <rcj@linux.vnet.ibm.com> Signed-off-by: Kent Yoder <key@linux.vnet.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | tsi108_irq.h | s | 4.5K | 103 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | ohare.h | s | 1.6K | 49 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | dma.h | s | 10K | 315 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | bitops.h | s | 9.1K | 287 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1321507567 |  | powerpc: Fix atomic_xxx_return barrier semantics  The Documentation/memory-barriers.txt document requires that atomic operations that return a value act as a memory barrier both before and after the actual atomic operation.  Our current implementation doesn't guarantee this. More specifically, while a load following the isync can not be issued before stwcx. has completed, that completion doesn't architecturally means that the result of stwcx. is visible to other processors (or any previous stores for that matter) (typically, the other processors L1 caches can still hold the old value).  This has caused an actual crash in RCU torture testing on Power 7  This fixes it by changing those atomic ops to use new macros instead of RELEASE/ACQUIRE barriers, called ATOMIC_ENTRY and ATMOIC_EXIT barriers, which are then defined respectively to lwsync and sync.  I haven't had a chance to measure the performance impact (or rather what I measured with kernel compiles is in the noise, I yet have to find a more precise benchmark)  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Acked-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
f | sparsemem.h | s | 905B | 27 | Anton Blanchard | anton@samba.org | 1316498003 |  | powerpc: Fix oops when echoing bad values to /sys/devices/system/memory/probe  If we echo an address the hypervisor doesn't like to /sys/devices/system/memory/probe we oops the box:  # echo 0x10000000000 > /sys/devices/system/memory/probe  kernel BUG at arch/powerpc/mm/hash_utils_64.c:541!  The backtrace is:  create_section_mapping arch_add_memory add_memory memory_probe_store sysdev_class_store sysfs_write_file vfs_write SyS_write  In create_section_mapping we BUG if htab_bolt_mapping returned an error. A better approach is to return an error which will propagate back to userspace.  Rerunning the test with this patch applied:  # echo 0x10000000000 > /sys/devices/system/memory/probe -bash: echo: write error: Invalid argument  Signed-off-by: Anton Blanchard <anton@samba.org> Cc: stable@kernel.org Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | runlatch.h | s | 1.1K | 40 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | checksum.h | s | 3.8K | 114 | Anton Blanchard | anton@samba.org | 1283400450 |  | powerpc: Add 64bit csum_and_copy_to_user  This adds the equivalent of csum_and_copy_from_user for the receive side so we can copy and checksum in one pass. It is modelled on the generic checksum routine.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | setup.h | s | 966B | 23 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | kprobes.h | s | 3.7K | 106 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | rheap.h | s | 2.4K | 69 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | fixmap.h | s | 3.3K | 95 | Albert Herranz | albert_herranz@yahoo.es | 1260681870 |  | powerpc: reserve fixmap entries for early debug  Add a set of entries to the fixmap table to allow usage of known reserved virtual address space by early debug code.  The address space reserved is the top 128K of the 32-bit address space. This allows, if required, the use of a BAT to do the mappings.  Signed-off-by: Albert Herranz <albert_herranz@yahoo.es> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | errno.h | s | 223B | 7 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | reg_8xx.h | s | 1.6K | 36 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | tsi108_pci.h | s | 1.8K | 40 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | ptrace.h | s | 12K | 376 | Anton Blanchard | anton@samba.org | 1335764248 |  | powerpc: Remove old powerpc specific ptrace getregs/setregs calls  PowerPC has non standard getregs calls that only dump the GPRs or FPRs and have their arguments reversed. commit e17666ba48f7 (ptrace updates & new, better requests) in 2.6.3 deprecated them and introduced more standard versions.  It's been about 5 years and I know of no users of the old calls so lets remove them.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | jump_label.h | s | 1018B | 37 | Ingo Molnar | mingo@elte.hu | 1330074359 |  | static keys: Introduce 'struct static_key', static_key_true()/false() and static_key_slow_[inc||dec]()  So here's a boot tested patch on top of Jason's series that does all the cleanups I talked about and turns jump labels into a more intuitive to use facility. It should also address the various misconceptions and confusions that surround jump labels.  Typical usage scenarios:          #include <linux/static_key.h>          struct static_key key = STATIC_KEY_INIT_TRUE;          if (static_key_false(&key))                 do unlikely code         else                 do likely code  Or:          if (static_key_true(&key))                 do likely code         else                 do unlikely code  The static key is modified via:          static_key_slow_inc(&key);         ...         static_key_slow_dec(&key);  The 'slow' prefix makes it abundantly clear that this is an expensive operation.  I've updated all in-kernel code to use this everywhere. Note that I (intentionally) have not pushed through the rename blindly through to the lowest levels: the actual jump-label patching arch facility should be named like that, so we want to decouple jump labels from the static-key facility a bit.  On non-jump-label enabled architectures static keys default to likely()/unlikely() branches.  Signed-off-by: Ingo Molnar <mingo@elte.hu> Acked-by: Jason Baron <jbaron@redhat.com> Acked-by: Steven Rostedt <rostedt@goodmis.org> Cc: a.p.zijlstra@chello.nl Cc: mathieu.desnoyers@efficios.com Cc: davem@davemloft.net Cc: ddaney.cavm@gmail.com Cc: Linus Torvalds <torvalds@linux-foundation.org> Link: http://lkml.kernel.org/r/20120222085809.GA26397@elte.hu Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | fsl_ifc.h | s | 23K | 776 | Prabhakar Kushwaha | prabhakar@freescale.com | 1325713282 |  | powerpc/fsl: Add support for Integrated Flash Controller  Integrated Flash Controller supports various flashes like NOR, NAND and other devices using NOR, NAND and GPCM Machine available on it. IFC supports four chip selects.  Signed-off-by: Dipen Dudhat <Dipen.Dudhat@freescale.com> Signed-off-by: Scott Wood <scottwood@freescale.com> Signed-off-by: Li Yang <leoli@freescale.com> Signed-off-by: Liu Shuo <b35362@freescale.com> Signed-off-by: Prabhakar Kushwaha <prabhakar@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | ucc.h | s | 1.7K | 52 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | exception-64s.h | s | 10K | 310 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1336520553 |  | powerpc/irq: Make alignment & program interrupt behave the same  Alignment was the last user of the ENABLE_INTS macro, which we can now remove. All non-syscall exceptions now disable interrupts on entry, they get re-enabled conditionally from C code. Don't unconditionally re-enable in program check either, check the original context.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | mmu_context.h | s | 3.2K | 100 | Tseng-Hui (Frank) Lin | thlin@linux.vnet.ibm.com | 1304486366 |  | powerpc: Add Initiate Coprocessor Store Word (icswx) support  Icswx is a PowerPC instruction to send data to a co-processor. On Book-S processors the LPAR_ID and process ID (PID) of the owning process are registered in the window context of the co-processor at initialization time. When the icswx instruction is executed the L2 generates a cop-reg transaction on PowerBus. The transaction has no address and the processor does not perform an MMU access to authenticate the transaction. The co-processor compares the LPAR_ID and the PID included in the transaction and the LPAR_ID and PID held in the window context to determine if the process is authorized to generate the transaction.  The OS needs to assign a 16-bit PID for the process. This cop-PID needs to be updated during context switch. The cop-PID needs to be destroyed when the context is destroyed.  Signed-off-by: Sonny Rao <sonnyrao@linux.vnet.ibm.com> Signed-off-by: Tseng-Hui (Frank) Lin <thlin@linux.vnet.ibm.com> Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | hvsi.h | s | 2.8K | 81 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1309489821 |  | powerpc/hvsi: Fix conflict with old HVSI driver  A mix of think & mismerge on my side caused a problem where both the new hvsi_lib and the old hvsi driver gets compiled and try to define symbols with the same name.  This fixes it by renaming the hvsi_lib exported symbols.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | nvram.h | s | 3.4K | 91 | Jim Keniston | jkenisto@linux.vnet.ibm.com | 1299223144 |  | powerpc/nvram: Generalize code for OS partitions in NVRAM  Adapt the functions used to create and write to the RTAS-log partition to work with any OS-type partition.  Signed-off-by: Jim Keniston <jkenisto@us.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | cache.h | s | 1.6K | 53 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | ftrace.h | s | 1.9K | 66 | Ian Munsie | imunsie@au.ibm.com | 1306381137 |  | powerpc/ftrace: Implement raw syscall tracepoints on PowerPC  This patch implements the raw syscall tracepoints on PowerPC and exports them for ftrace syscalls to use.  To minimise reworking existing code, I slightly re-ordered the thread info flags such that the new TIF_SYSCALL_TRACEPOINT bit would still fit within the 16 bits of the andi. instruction's UI field. The instructions in question are in /arch/powerpc/kernel/entry_{32,64}.S to and the _TIF_SYSCALL_T_OR_A with the thread flags to see if system call tracing is enabled.  In the case of 64bit PowerPC, arch_syscall_addr and arch_syscall_match_sym_name are overridden to allow ftrace syscalls to work given the unusual system call table structure and symbol names that start with a period.  Signed-off-by: Ian Munsie <imunsie@au1.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | pte-hash64.h | s | 2.0K | 46 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1237862854 |  | powerpc/mm: Add option for non-atomic PTE updates to ppc64  ppc32 has it already, add it to ppc64 as a preliminary for adding support for Book3E 64-bit support  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | mc146818rtc.h | s | 943B | 30 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | smu.h | s | 19K | 607 | Phil Carmody | ext-phil.2.carmody@nokia.com | 1311250200 |  | treewide: fix potentially dangerous trailing ';' in #defined values/expressions  All these are instances of   #define NAME value; or   #define NAME(params_opt) value;  These of course fail to build when used in contexts like   if(foo $OP NAME)   while(bar $OP NAME) and may silently generate the wrong code in contexts such as   foo = NAME + 1;    /* foo = value; + 1; */   bar = NAME - 1;    /* bar = value; - 1; */   baz = NAME & quux; /* baz = value; & quux; */  Reported on comp.lang.c, Message-ID: <ab0d55fe-25e5-482b-811e-c475aa6065c3@c29g2000yqd.googlegroups.com> Initial analysis of the dangers provided by Keith Thompson in that thread.  There are many more instances of more complicated macros having unnecessary trailing semicolons, but this pile seems to be all of the cases of simple values suffering from the problem. (Thus things that are likely to be found in one of the contexts above, more complicated ones aren't.)  Signed-off-by: Phil Carmody <ext-phil.2.carmody@nokia.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | asm-compat.h | s | 2.0K | 58 | Anton Blanchard | anton@samba.org | 1335764246 |  | powerpc: Remove CONFIG_POWER4_ONLY  Remove CONFIG_POWER4_ONLY, the option is badly named and only does two things:  - It wraps the MMU segment table code. With feature fixups there is   little downside to compiling this in.  - It uses the newer mtocrf instruction in various assembly functions.   Instead of making this a compile option just do it at runtime via   a feature fixup.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | floppy.h | s | 4.9K | 177 | Yong Zhang | yong.zhang0@gmail.com | 1320724306 |  | powerpc/irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Geoff Levand <geoff@infradead.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | clk_interface.h | s | 683B | 16 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | rio.h | s | 674B | 20 | Kumar Gala | galak@kernel.crashing.org | 1307046548 |  | powerpc/fsl_rio: Fix compile error when CONFIG_FSL_RIO not set  arch/powerpc/kernel/built-in.o: In function `machine_check_e500mc': arch/powerpc/kernel/traps.c:429: undefined reference to `fsl_rio_mcheck_exception' arch/powerpc/kernel/built-in.o: In function `machine_check_e500': arch/powerpc/kernel/traps.c:519: undefined reference to `fsl_rio_mcheck_exception' make: *** [.tmp_vmlinux1] Error 1  Reported-by: Timur Tabi <timur@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | hydra.h | s | 2.9K | 89 | Justin P. Mattock | justinmattock@gmail.com | 1287392601 |  | Update broken web addresses in arch directory.  The patch below updates broken web addresses in the arch directory.  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Signed-off-by: Maciej W. Rozycki <macro@linux-mips.org> Cc: Finn Thain <fthain@telegraphics.com.au> Cc: Randy Dunlap <rdunlap@xenotime.net> Reviewed-by: Finn Thain <fthain@telegraphics.com.au> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | mmu-8xx.h | s | 5.9K | 130 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1250727909 |  | powerpc: Add TLB management code for 64-bit Book3E  This adds the TLB miss handler assembly, the low level TLB flush routines along with the necessary hook for dealing with our virtual page tables or indirect TLB entries that need to be flushes when PTE pages are freed.  There is currently no support for hugetlbfs  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | async_tx.h | s | 1.6K | 41 | Anatolij Gustschin | agust@denx.de | 1260591884 |  | ppc440spe-adma: adds updated ppc440spe adma driver  This patch adds new version of the PPC440SPe ADMA driver.  Signed-off-by: Yuri Tikhonov <yur@emcraft.com> Signed-off-by: Anatolij Gustschin <agust@denx.de> Signed-off-by: Dan Williams <dan.j.williams@intel.com>
f | dcr-regs.h | s | 5.7K | 169 | Anatolij Gustschin | agust@denx.de | 1260591884 |  | ppc440spe-adma: adds updated ppc440spe adma driver  This patch adds new version of the PPC440SPe ADMA driver.  Signed-off-by: Yuri Tikhonov <yur@emcraft.com> Signed-off-by: Anatolij Gustschin <agust@denx.de> Signed-off-by: Dan Williams <dan.j.williams@intel.com>
f | user.h | s | 2.1K | 48 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | io_event_irq.h | s | 1.9K | 45 | Tseng-Hui (Frank) Lin | thlin@linux.vnet.ibm.com | 1304651941 |  | powerpc/pseries: Add support for IO event interrupts  This patch adds support for handling IO Event interrupts which come through at the /event-sources/ibm,io-events device tree node.  The interrupts come through ibm,io-events device tree node are generated by the firmware to report IO events. The firmware uses the same interrupt to report multiple types of events for multiple devices. Each device may have its own event handler. This patch implements a plateform interrupt handler that is triggered by the IO event interrupts come through ibm,io-events device tree node, pull in the IO events from RTAS and call device event handlers registered in the notifier list.  Device event handlers are expected to use atomic_notifier_chain_register() and atomic_notifier_chain_unregister() to register/unregister their event handler in pseries_ioei_notifier_list list with IO event interrupt. Device event handlers are responsible to identify if the event belongs to the device event handler. The device event handle should return NOTIFY_OK after the event is handled if the event belongs to the device event handler, or NOTIFY_DONE otherwise.  Signed-off-by: Tseng-Hui (Frank) Lin <thlin@us.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | exec.h | s | 207B | 7 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | statfs.h | s | 101B | 4 | David Woodhouse | David.Woodhouse@intel.com | 1220725815 |  | PowerPC: Use <asm-generic/statfs.h>  Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | ibmebus.h | s | 2.2K | 54 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | xilinx_intc.h | s | 604B | 17 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | ppc4xx.h | s | 519B | 15 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | kvm_booke.h | s | 2.4K | 85 | Scott Wood | scottwood@freescale.com | 1333878662 |  | KVM: PPC: factor out lpid allocator from book3s_64_mmu_hv  We'll use it on e500mc as well.  Signed-off-by: Scott Wood <scottwood@freescale.com> Signed-off-by: Alexander Graf <agraf@suse.de> Signed-off-by: Avi Kivity <avi@redhat.com>
f | termbits.h | s | 5.0K | 189 | hyc@symas.com | hyc@symas.com | 1281473259 |  | tty: Add EXTPROC support for LINEMODE  This patch is against the 2.6.34 source.  Paraphrased from the 1989 BSD patch by David Borman @ cray.com:       These are the changes needed for the kernel to support      LINEMODE in the server.       There is a new bit in the termios local flag word, EXTPROC.      When this bit is set, several aspects of the terminal driver      are disabled.  Input line editing, character echo, and mapping      of signals are all disabled.  This allows the telnetd to turn      off these functions when in linemode, but still keep track of      what state the user wants the terminal to be in.       New ioctl:          TIOCSIG         Generate a signal to processes in the                          current process group of the pty.       There is a new mode for packet driver, the TIOCPKT_IOCTL bit.      When packet mode is turned on in the pty, and the EXTPROC bit      is set, then whenever the state of the pty is changed, the      next read on the master side of the pty will have the TIOCPKT_IOCTL      bit set.  This allows the process on the server side of the pty      to know when the state of the terminal has changed; it can then      issue the appropriate ioctl to retrieve the new state.  Since the original BSD patches accompanied the source code for telnet I've left that reference here, but obviously the feature is useful for any remote terminal protocol, including ssh.  The corresponding feature has existed in the BSD tty driver since 1989. For historical reference, a good copy of the relevant files can be found here:  http://anonsvn.mit.edu/viewvc/krb5/trunk/src/appl/telnet/?pathrev=17741  Signed-off-by: Howard Chu <hyc@symas.com> Cc: Alan Cox <alan@lxorguk.ukuu.org.uk> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | pte-hash32.h | s | 1.9K | 41 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1251342771 |  | powerpc/mm: Cleanup handling of execute permission  This is an attempt at cleaning up a bit the way we handle execute permission on powerpc. _PAGE_HWEXEC is gone, _PAGE_EXEC is now only defined by CPUs that can do something with it, and the myriad of #ifdef's in the I$/D$ coherency code is reduced to 2 cases that hopefully should cover everything.  The logic on BookE is a little bit different than what it was though not by much. Since now, _PAGE_EXEC will be set by the generic code for executable pages, we need to filter out if they are unclean and recover it. However, I don't expect the code to be more bloated than it already was in that area due to that change.  I could boast that this brings proper enforcing of per-page execute permissions to all BookE and 40x but in fact, we've had that now for some time as a side effect of my previous rework in that area (and I didn't even know it :-) We would only enable execute permission if the page was cache clean and we would only cache clean it if we took and exec fault. Since we now enforce that the later only work if VM_EXEC is part of the VMA flags, we de-fact already enforce per-page execute permissions... Unless I missed something  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | xor.h | s | 29B | 1 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | lppaca.h | s | 4.7K | 137 | Anton Blanchard | anton@samba.org | 1335764236 |  | powerpc: Reformat lppaca.h  Reformat lppaca.h to match Linux coding standards.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | hardirq.h | s | 718B | 21 | Anton Blanchard | anton@samba.org | 1266375769 |  | powerpc: Convert global "BAD" interrupt to per cpu spurious  I often get asked if BAD interrupts are really bad. On some boxes (eg IBM machines running a hypervisor) there are valid cases where are presented with an interrupt that is not for us. These cases are common enough to show up as thousands of BAD interrupts a day.  Tone them down by calling them spurious. Since they can be a significant cause of OS jitter, we may as well log them per cpu so we know where they are occurring.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | ps3gpu.h | s | 2.4K | 69 | Geert Uytterhoeven | Geert.Uytterhoeven@sonycom.com | 1245036381 |  | ps3fb: Tear down FB setup during cleanup  During cleanup, use L1GPU_CONTEXT_ATTRIBUTE_FB_CLOSE to tear down the setup done by L1GPU_CONTEXT_ATTRIBUTE_FB_SETUP.  This allows unloading and reloading of ps3fb while the sound driver keeps the GPU open.  Signed-off-by: Geert Uytterhoeven <Geert.Uytterhoeven@sonycom.com> Cc: linux-fbdev-devel@lists.sourceforge.net Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | sigcontext.h | s | 4.2K | 84 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | bug.h | s | 3.5K | 125 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | parport.h | s | 992B | 37 | Martyn Welch | martyn.welch@ge.com | 1273128566 |  | powerpc: Correct parport interrupt parsing  Currently the parsing of the device tree in arch/powerpc/include/asm/parport.h assumes that the interrupt provided in the parallel port node is a valid virtual irq. The values for the interrupts provided in the device tree should have meaning in the context of the driver for the specific interrupt controller to which the interrupt is connected and irq_of_parse_and_map() should be used to determine the correct virtual irq.  Signed-off-by: Martyn Welch <martyn.welch@ge.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | word-at-a-time.h | s | 997B | 31 | Paul Mackerras | paulus@samba.org | 1338177607 |  | powerpc: Use the new generic strncpy_from_user() and strnlen_user()  This is much the same as for SPARC except that we can do the find_zero() function more efficiently using the count-leading-zeroes instructions. Tested on 32-bit and 64-bit PowerPC.  Signed-off-by: Paul Mackerras <paulus@samba.org> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | setjmp.h | s | 525B | 15 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | synch.h | s | 1.4K | 49 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1321507567 |  | powerpc: Fix atomic_xxx_return barrier semantics  The Documentation/memory-barriers.txt document requires that atomic operations that return a value act as a memory barrier both before and after the actual atomic operation.  Our current implementation doesn't guarantee this. More specifically, while a load following the isync can not be issued before stwcx. has completed, that completion doesn't architecturally means that the result of stwcx. is visible to other processors (or any previous stores for that matter) (typically, the other processors L1 caches can still hold the old value).  This has caused an actual crash in RCU torture testing on Power 7  This fixes it by changing those atomic ops to use new macros instead of RELEASE/ACQUIRE barriers, called ATOMIC_ENTRY and ATMOIC_EXIT barriers, which are then defined respectively to lwsync and sync.  I haven't had a chance to measure the performance impact (or rather what I measured with kernel compiles is in the noise, I yet have to find a more precise benchmark)  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Acked-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
f | macio.h | s | 3.9K | 119 | Joe Perches | joe@perches.com | 1307710536 |  | treewide: Convert uses of struct resource to resource_size(ptr)  Several fixes as well where the +1 was missing.  Done via coccinelle scripts like:  @@ struct resource *ptr; @@  - ptr->end - ptr->start + 1 + resource_size(ptr)  and some grep and typing.  Mostly uncompiled, no cross-compilers.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | Kbuild | g | 788B |  | Richard Kuo | rkuo@qualcomm.com | 1324006788 |  | powerpc: Use rwsem.h from generic location  As of commit dd472da38, rwsem.h was moved into asm-generic. This patch removes the arch file and points the build at its new location.  Signed-off-by: Richard Kuo <rkuo@codeaurora.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | tsi108.h | s | 3.6K | 100 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | mmu-hash64.h | s | 15K | 424 | Linus Torvalds | torvalds@linux-foundation.org | 1332970896 |  | Merge branch 'next' of git://git.kernel.org/pub/scm/linux/kernel/git/benh/powerpc  Pull a few more things for powerpc by Benjamin Herrenschmidt:  - Anton's did some recent improvements to EPOW event reporting on    pSeries (power supply failures and such).  The patches are self    contained enough and replace really nasty code so I felt it should    still go in  - I did the vio driver registration change Greg requested, I don't see    the point of leaving that til the next merge window  - The remaining EEH changes I said were still pending to get rid of the    EEH references from the generic struct device_node  - A few more iSeries removal bits  - A perf bug fix on 970  * 'next' of git://git.kernel.org/pub/scm/linux/kernel/git/benh/powerpc:   powerpc/perf: Fix instruction address sampling on 970 and Power4   powerpc+sparc/vio: Modernize driver registration   powerpc: Random little legacy iSeries removal tidy ups   powerpc: Remove NO_IRQ_IGNORE   powerpc/pseries: Cut down on enthusiastic use of defines in RAS code   powerpc/pseries: Clean up ras_error_interrupt code   powerpc/pseries: Remove RTAS_POWERMGM_EVENTS   powerpc/pseries: Use rtas_get_sensor in RAS code   powerpc/pseries: Parse and handle EPOW interrupts   powerpc: Make function that parses RTAS error logs global   powerpc/eeh: Retrieve PHB from global list   powerpc/eeh: Remove eeh information from pci_dn   powerpc/eeh: Remove eeh device from OF node
f | fsl_lbc.h | s | 10K | 289 | Jia Hongtao | B38951@freescale.com | 1322121700 |  | powerpc/85xx: Add lbc suspend support for PM  Power supply for LBC registers is off when system go to deep-sleep state. We save the values of registers before suspend and restore to registers after resume.  We removed the last two reservation arrays from struct fsl_lbc_regs for allocating less memory and minimizing the memcpy size.  Signed-off-by: Jiang Yutang <b14898@freescale.com> Signed-off-by: Jia Hongtao <B38951@freescale.com> Signed-off-by: Li Yang <leoli@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | mmu.h | s | 6.1K | 176 | Becky Bruce | beckyb@kernel.crashing.org | 1316474380 |  | powerpc: Hugetlb for BookE  Enable hugepages on Freescale BookE processors.  This allows the kernel to use huge TLB entries to map pages, which can greatly reduce the number of TLB misses and the amount of TLB thrashing experienced by applications with large memory footprints.  Care should be taken when using this on FSL processors, as the number of large TLB entries supported by the core is low (16-64) on current processors.  The supported set of hugepage sizes include 4m, 16m, 64m, 256m, and 1g. Page sizes larger than the max zone size are called "gigantic" pages and must be allocated on the command line (and cannot be deallocated).  This is currently only fully implemented for Freescale 32-bit BookE processors, but there is some infrastructure in the code for 64-bit BooKE.  Signed-off-by: Becky Bruce <beckyb@kernel.crashing.org> Signed-off-by: David Gibson <david@gibson.dropbear.id.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | futex.h | s | 2.9K | 107 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1321507567 |  | powerpc: Fix atomic_xxx_return barrier semantics  The Documentation/memory-barriers.txt document requires that atomic operations that return a value act as a memory barrier both before and after the actual atomic operation.  Our current implementation doesn't guarantee this. More specifically, while a load following the isync can not be issued before stwcx. has completed, that completion doesn't architecturally means that the result of stwcx. is visible to other processors (or any previous stores for that matter) (typically, the other processors L1 caches can still hold the old value).  This has caused an actual crash in RCU torture testing on Power 7  This fixes it by changing those atomic ops to use new macros instead of RELEASE/ACQUIRE barriers, called ATOMIC_ENTRY and ATMOIC_EXIT barriers, which are then defined respectively to lwsync and sync.  I haven't had a chance to measure the performance impact (or rather what I measured with kernel compiles is in the noise, I yet have to find a more precise benchmark)  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Acked-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
f | posix_types.h | s | 675B | 20 | Al Viro | viro@zeniv.linux.org.uk | 1338426290 |  | bury __kernel_nlink_t, make internal nlink_t consistent  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | pgtable-ppc32.h | s | 10K | 298 | Peter Zijlstra | a.p.zijlstra@chello.nl | 1288137128 |  | mm: remove pte_*map_nested()  Since we no longer need to provide KM_type, the whole pte_*map_nested() API is now redundant, remove it.  Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Acked-by: Chris Metcalf <cmetcalf@tilera.com> Cc: David Howells <dhowells@redhat.com> Cc: Hugh Dickins <hughd@google.com> Cc: Rik van Riel <riel@redhat.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: "H. Peter Anvin" <hpa@zytor.com> Cc: Steven Rostedt <rostedt@goodmis.org> Cc: Russell King <rmk@arm.linux.org.uk> Cc: Ralf Baechle <ralf@linux-mips.org> Cc: David Miller <davem@davemloft.net> Cc: Paul Mackerras <paulus@samba.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | pte-hash64-4k.h | s | 632B | 13 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1237862853 |  | powerpc/mm: Tweak PTE bit combination definitions  This patch tweaks the way some PTE bit combinations are defined, in such a way that the 32 and 64-bit variant become almost identical and that will make it easier to bring in a new common pte-* file for the new variant of the Book3-E support.  The combination of bits defining access to kernel pages are now clearly separated from the combination used by userspace and the core VM. The resulting generated code should remain identical unless I made a mistake.  Note: While at it, I removed a non-sensical statement related to CONFIG_KGDB in ppc_mmu_32.c which could cause kernel mappings to be user accessible when that option is enabled. Probably something that bitrot.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | disassemble.h | s | 1.7K | 66 | Hollis Blanchard | hollisb@us.ibm.com | 1230735141 |  | ppc: Create disassemble.h to extract instruction fields  This is used in a couple places in KVM, but isn't KVM-specific.  However, this patch doesn't modify other in-kernel emulation code: - xmon uses a direct copy of ppc_opc.c from binutils - emulate_instruction() doesn't need it because it can use a series   of mask tests.  Signed-off-by: Hollis Blanchard <hollisb@us.ibm.com> Acked-by: Paul Mackerras <paulus@samba.org> Signed-off-by: Avi Kivity <avi@redhat.com>
f | device.h | s | 878B | 38 | Gavin Shan | shangw@linux.vnet.ibm.com | 1331253569 |  | powerpc/eeh: Introduce EEH device  Original EEH implementation depends on struct pci_dn heavily. However, EEH shouldn't depend on that actually because EEH needn't share much information with other PCI components. That's to say, EEH should have worked independently.  The patch introduces struct eeh_dev so that EEH core components needn't be working based on struct pci_dn in future. Also, struct pci_dn, struct eeh_dev instances are created in dynamic fasion and the binding with EEH device, OF node, PCI device is implemented as well.  The EEH devices are created after PHBs are detected and initialized, but PCI emunation hasn't started yet. Apart from that, PHB might be created dynamically through DLPAR component and the EEH devices should be creatd as well. Another case might be OF node is created dynamically by DR (Dynamic Reconfiguration), which has been defined by PAPR. For those OF nodes created by DR, EEH devices should be also created accordingly. The binding between EEH device and OF node is done while the EEH device is initially created.  The binding between EEH device and PCI device should be done after PCI emunation is done. Besides, PCI hotplug also needs the binding so that the EEH devices could be traced from the newly coming PCI buses or PCI devices.  Signed-off-by: Gavin Shan <shangw@linux.vnet.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | qe.h | s | 24K | 678 | Paul Bolle | pebolle@tiscali.nl | 1317139684 |  | doc: fix broken references  There are numerous broken references to Documentation files (in other Documentation files, in comments, etc.). These broken references are caused by typo's in the references, and by renames or removals of the Documentation files. Some broken references are simply odd.  Fix these broken references, sometimes by dropping the irrelevant text they were part of.  Signed-off-by: Paul Bolle <pebolle@tiscali.nl> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | pgtable-ppc64-4k.h | s | 2.5K | 60 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1237525017 |  | powerpc/mm: Split the various pgtable-* headers based on MMU type  This patch moves the definition of the PTE format for each MMU type to separate files instead of all in one file. This improves overall maintainability and will make it easier to add new types.  On 64-bit, additionally, I've separated the headers relative to the format of the page table tree (3 vs. 4 levels for 64K vs 4K pages) from the headers specific to the PTE format for hash based processors, this will make it easier to add support for Book3 "E" 64-bit implementations.  There are still some type-related ifdef's in the generic headers, we might remove them in the long run, but this patch shouldn't result in any code change, -hopefully- just definitions being moved around.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | dcr-mmio.h | s | 1.8K | 50 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | atomic.h | s | 10K | 446 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | spinlock_types.h | s | 385B | 14 | Thomas Gleixner | tglx@linutronix.de | 1260831332 |  | locking: Convert raw_rwlock to arch_rwlock  Not strictly necessary for -rt as -rt does not have non sleeping rwlocks, but it's odd to not have a consistent naming convention.  No functional change.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de> Acked-by: Peter Zijlstra <peterz@infradead.org> Acked-by: David S. Miller <davem@davemloft.net> Acked-by: Ingo Molnar <mingo@elte.hu> Cc: linux-arch@vger.kernel.org
f | linkage.h | s | 129B | 4 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | backlight.h | s | 1.1K | 33 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | mpc52xx_psc.h | s | 8.8K | 282 | Eric Millbrandt | emillbrandt@dekaresearch.com | 1281149358 |  | powerpc/5200: add mpc5200_psc_ac97_gpio_reset  Work around a silicon bug in the ac97 reset functionality of the mpc5200(b).  The implementation of the ac97 "cold" reset is flawed. If the sync and output lines are high when reset is asserted the attached ac97 device may go into test mode.  Avoid this by reconfiguring the psc to gpio mode and generating the reset manually.  From MPC5200B User's Manual: "Some AC97 devices goes to a test mode, if the Sync line is high during the Res line is low (reset phase). To avoid this behavior the Sync line must be also forced to zero during the reset phase. To do that, the pin muxing should switch to GPIO mode and the GPIO control register should be used to control the output lines."  Signed-off-by: Eric Millbrandt <emillbrandt@dekaresearch.com> Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | tlbflush.h | s | 4.9K | 140 | Michael Ellerman | michael@ozlabs.org | 1303282760 |  | powerpc/mm: Standardise on MMU_NO_CONTEXT  Use MMU_NO_CONTEXT as the initialiser for mm_context.id on nohash and hash64.  Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | pte-8xx.h | s | 3.0K | 58 | Joakim Tjernlund | joakim.tjernlund@transmode.se | 1260339037 |  | powerpc/8xx: Restore _PAGE_WRITETHRU  8xx has not had WRITETHRU due to lack of bits in the pte. After the recent rewrite of the 8xx TLB code, there are two bits left. Use one of them to WRITETHRU.  Perhaps use the last SW bit to PAGE_SPECIAL or PAGE_FILE?  Signed-off-by: Joakim Tjernlund <Joakim.Tjernlund@transmode.se> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | mutex.h | s | 3.2K | 119 | Anton Blanchard | anton@samba.org | 1266375795 |  | powerpc: Rename LWSYNC_ON_SMP to PPC_RELEASE_BARRIER, ISYNC_ON_SMP to PPC_ACQUIRE_BARRIER  For performance reasons we are about to change ISYNC_ON_SMP to sometimes be lwsync. Now that the macro name doesn't make sense, change it and LWSYNC_ON_SMP to better explain what the barriers are doing.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | hugetlb.h | s | 4.2K | 146 | Becky Bruce | beckyb@kernel.crashing.org | 1323235584 |  | powerpc: Define/use HUGETLB_NEED_PRELOAD insead of complicated #if  Define HUGETLB_NEED_PRELOAD in mmu-book3e.h for CONFIG_PPC64 instead of having a much more complicated #if block.  This is easier to read and maintain.  Signed-off-by: Becky Bruce <beckyb@kernel.crashing.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | local.h | s | 3.8K | 144 | Arun Sharma | asharma@fb.com | 1311724187 |  | atomic: use <linux/atomic.h>  This allows us to move duplicated code in <asm/atomic.h> (atomic_inc_not_zero() for now) to <linux/atomic.h>  Signed-off-by: Arun Sharma <asharma@fb.com> Reviewed-by: Eric Dumazet <eric.dumazet@gmail.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: David Miller <davem@davemloft.net> Cc: Eric Dumazet <eric.dumazet@gmail.com> Acked-by: Mike Frysinger <vapier@gentoo.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | perf_event.h | s | 1.1K | 31 | Frederic Weisbecker | fweisbec@gmail.com | 1276032687 |  | perf: Drop the skip argument from perf_arch_fetch_regs_caller  Drop this argument now that we always want to rewind only to the state of the first caller. It means frame pointers are not necessary anymore to reliably get the source of an event. But this also means we need this helper to be a macro now, as an inline function is not an option since we need to know when to provide a default implentation.  Signed-off-by: Frederic Weisbecker <fweisbec@gmail.com> Signed-off-by: Paul Mackerras <paulus@samba.org> Cc: David Miller <davem@davemloft.net> Cc: Ingo Molnar <mingo@elte.hu> Cc: Peter Zijlstra <a.p.zijlstra@chello.nl> Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
f | ps3.h | s | 15K | 461 | Geert Uytterhoeven | Geert.Uytterhoeven@sonycom.com | 1245048446 |  | ps3: Replace direct file operations by callback  Currently the FLASH database is updated by the kernel using file operations, meant for userspace only. While this works for us because copy_{from,to}_user() on powerpc can handle kernel pointers, this is unportable and a bad example. Replace the file operations by callbacks, registered by the ps3flash driver.  Signed-off-by: Geert Uytterhoeven <Geert.Uytterhoeven@sonycom.com> Cc: Geoff Levand <geoffrey.levand@am.sony.com> Acked-by: Geoff Levand <geoffrey.levand@am.sony.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | ppc_asm.h | s | 18K | 634 | Anton Blanchard | anton@samba.org | 1335764246 |  | powerpc: Remove CONFIG_POWER4_ONLY  Remove CONFIG_POWER4_ONLY, the option is badly named and only does two things:  - It wraps the MMU segment table code. With feature fixups there is   little downside to compiling this in.  - It uses the newer mtocrf instruction in various assembly functions.   Instead of making this a compile option just do it at runtime via   a feature fixup.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | opal.h | s | 17K | 502 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1323241322 |  | powerpc/powernv: Update OPAL interfaces  This adds some more interfaces for OPAL v2  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | epapr_hcalls.h | s | 15K | 442 | Timur Tabi | timur@freescale.com | 1333026854 |  | powerpc/epapr: add "memory" as a clobber to all hypercalls  The "memory" clobber tells the compiler to ensure that all writes to memory are committed before the hypercall is made.  "memory" is only necessary for hcalls where the Hypervisor will read or write guest memory. However, we add it to all hcalls because the impact is minimal, and we want to ensure that it's present for the hcalls that need it.  Signed-off-by: Timur Tabi <timur@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | mpc8260.h | s | 703B | 20 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | topology.h | s | 2.3K | 78 | Peter Zijlstra | a.p.zijlstra@chello.nl | 1336568455 |  | sched/numa: Rewrite the CONFIG_NUMA sched domain support  The current code groups up to 16 nodes in a level and then puts an ALLNODES domain spanning the entire tree on top of that. This doesn't reflect the numa topology and esp for the smaller not-fully-connected machines out there today this might make a difference.  Therefore, build a proper numa topology based on node_distance().  Since there's no fixed numa layers anymore, the static SD_NODE_INIT and SD_ALLNODES_INIT aren't usable anymore, the new code tries to construct something similar and scales some values either on the number of cpus in the domain and/or the node_distance() ratio.  Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Cc: Anton Blanchard <anton@samba.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Chris Metcalf <cmetcalf@tilera.com> Cc: David Howells <dhowells@redhat.com> Cc: "David S. Miller" <davem@davemloft.net> Cc: Fenghua Yu <fenghua.yu@intel.com> Cc: "H. Peter Anvin" <hpa@zytor.com> Cc: Ivan Kokshaysky <ink@jurassic.park.msu.ru> Cc: linux-alpha@vger.kernel.org Cc: linux-ia64@vger.kernel.org Cc: linux-kernel@vger.kernel.org Cc: linux-mips@linux-mips.org Cc: linuxppc-dev@lists.ozlabs.org Cc: linux-sh@vger.kernel.org Cc: Matt Turner <mattst88@gmail.com> Cc: Paul Mackerras <paulus@samba.org> Cc: Paul Mundt <lethal@linux-sh.org> Cc: Ralf Baechle <ralf@linux-mips.org> Cc: Richard Henderson <rth@twiddle.net> Cc: sparclinux@vger.kernel.org Cc: Tony Luck <tony.luck@intel.com> Cc: x86@kernel.org Cc: Dimitri Sivanich <sivanich@sgi.com> Cc: Greg Pearson <greg.pearson@hp.com> Cc: KAMEZAWA Hiroyuki <kamezawa.hiroyu@jp.fujitsu.com> Cc: bob.picco@oracle.com Cc: chris.mason@oracle.com Cc: Linus Torvalds <torvalds@linux-foundation.org> Cc: Andrew Morton <akpm@linux-foundation.org> Link: http://lkml.kernel.org/n/tip-r74n3n8hhuc2ynbrnp3vt954@git.kernel.org Signed-off-by: Ingo Molnar <mingo@kernel.org>
f | kexec.h | s | 3.1K | 91 | Anton Blanchard | anton@samba.org | 1323313343 |  | powerpc: Cleanup crash/kexec code  Remove some unnecessary defines and fix some spelling mistakes.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | irqflags.h | s | 1.6K | 63 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1331259906 |  | powerpc: Rework lazy-interrupt handling  The current implementation of lazy interrupts handling has some issues that this tries to address.  We don't do the various workarounds we need to do when re-enabling interrupts in some cases such as when returning from an interrupt and thus we may still lose or get delayed decrementer or doorbell interrupts.  The current scheme also makes it much harder to handle the external "edge" interrupts provided by some BookE processors when using the EPR facility (External Proxy) and the Freescale Hypervisor.  Additionally, we tend to keep interrupts hard disabled in a number of cases, such as decrementer interrupts, external interrupts, or when a masked decrementer interrupt is pending. This is sub-optimal.  This is an attempt at fixing it all in one go by reworking the way we do the lazy interrupt disabling from the ground up.  The base idea is to replace the "hard_enabled" field with a "irq_happened" field in which we store a bit mask of what interrupt occurred while soft-disabled.  When re-enabling, either via arch_local_irq_restore() or when returning from an interrupt, we can now decide what to do by testing bits in that field.  We then implement replaying of the missed interrupts either by re-using the existing exception frame (in exception exit case) or via the creation of a new one from an assembly trampoline (in the arch_local_irq_enable case).  This removes the need to play with the decrementer to try to create fake interrupts, among others.  In addition, this adds a few refinements:   - We no longer  hard disable decrementer interrupts that occur while soft-disabled. We now simply bump the decrementer back to max (on BookS) or leave it stopped (on BookE) and continue with hard interrupts enabled, which means that we'll potentially get better sample quality from performance monitor interrupts.   - Timer, decrementer and doorbell interrupts now hard-enable shortly after removing the source of the interrupt, which means they no longer run entirely hard disabled. Again, this will improve perf sample quality.   - On Book3E 64-bit, we now make the performance monitor interrupt act as an NMI like Book3S (the necessary C code for that to work appear to already be present in the FSL perf code, notably calling nmi_enter instead of irq_enter). (This also fixes a bug where BookE perfmon interrupts could clobber r14 ... oops)   - We could make "masked" decrementer interrupts act as NMIs when doing timer-based perf sampling to improve the sample quality.  Signed-off-by-yet: Benjamin Herrenschmidt <benh@kernel.crashing.org> ---  v2:  - Add hard-enable to decrementer, timer and doorbells - Fix CR clobber in masked irq handling on BookE - Make embedded perf interrupt act as an NMI - Add a PACA_HAPPENED_EE_EDGE for use by FSL if they want   to retrigger an interrupt without preventing hard-enable  v3:   - Fix or vs. ori bug on Book3E  - Fix enabling of interrupts for some exceptions on Book3E  v4:   - Fix resend of doorbells on return from interrupt on Book3E  v5:   - Rebased on top of my latest series, which involves some significant rework of some aspects of the patch.  v6:  - 32-bit compile fix  - more compile fixes with various .config combos  - factor out the asm code to soft-disable interrupts  - remove the C wrapper around preempt_schedule_irq  v7:  - Fix a bug with hard irq state tracking on native power7
f | mpc8xx.h | s | 469B | 10 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | unistd.h | s | 11K | 423 | Christopher Yeoh | cyeoh@au1.ibm.com | 1320107444 |  | Cross Memory Attach  The basic idea behind cross memory attach is to allow MPI programs doing intra-node communication to do a single copy of the message rather than a double copy of the message via shared memory.  The following patch attempts to achieve this by allowing a destination process, given an address and size from a source process, to copy memory directly from the source process into its own address space via a system call.  There is also a symmetrical ability to copy from the current process's address space into a destination process's address space.  - Use of /proc/pid/mem has been considered, but there are issues with   using it:   - Does not allow for specifying iovecs for both src and dest, assuming     preadv or pwritev was implemented either the area read from or   written to would need to be contiguous.   - Currently mem_read allows only processes who are currently   ptrace'ing the target and are still able to ptrace the target to read   from the target. This check could possibly be moved to the open call,   but its not clear exactly what race this restriction is stopping   (reason  appears to have been lost)   - Having to send the fd of /proc/self/mem via SCM_RIGHTS on unix   domain socket is a bit ugly from a userspace point of view,   especially when you may have hundreds if not (eventually) thousands   of processes  that all need to do this with each other   - Doesn't allow for some future use of the interface we would like to   consider adding in the future (see below)   - Interestingly reading from /proc/pid/mem currently actually   involves two copies! (But this could be fixed pretty easily)  As mentioned previously use of vmsplice instead was considered, but has problems.  Since you need the reader and writer working co-operatively if the pipe is not drained then you block.  Which requires some wrapping to do non blocking on the send side or polling on the receive.  In all to all communication it requires ordering otherwise you can deadlock.  And in the example of many MPI tasks writing to one MPI task vmsplice serialises the copying.  There are some cases of MPI collectives where even a single copy interface does not get us the performance gain we could.  For example in an MPI_Reduce rather than copy the data from the source we would like to instead use it directly in a mathops (say the reduce is doing a sum) as this would save us doing a copy.  We don't need to keep a copy of the data from the source.  I haven't implemented this, but I think this interface could in the future do all this through the use of the flags - eg could specify the math operation and type and the kernel rather than just copying the data would apply the specified operation between the source and destination and store it in the destination.  Although we don't have a "second user" of the interface (though I've had some nibbles from people who may be interested in using it for intra process messaging which is not MPI).  This interface is something which hardware vendors are already doing for their custom drivers to implement fast local communication.  And so in addition to this being useful for OpenMPI it would mean the driver maintainers don't have to fix things up when the mm changes.  There was some discussion about how much faster a true zero copy would go. Here's a link back to the email with some testing I did on that:  http://marc.info/?l=linux-mm&m=130105930902915&w=2  There is a basic man page for the proposed interface here:  http://ozlabs.org/~cyeoh/cma/process_vm_readv.txt  This has been implemented for x86 and powerpc, other architecture should mainly (I think) just need to add syscall numbers for the process_vm_readv and process_vm_writev. There are 32 bit compatibility versions for 64-bit kernels.  For arch maintainers there are some simple tests to be able to quickly verify that the syscalls are working correctly here:  http://ozlabs.org/~cyeoh/cma/cma-test-20110718.tgz  Signed-off-by: Chris Yeoh <yeohc@au1.ibm.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: "H. Peter Anvin" <hpa@zytor.com> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Arnd Bergmann <arnd@arndb.de> Cc: Paul Mackerras <paulus@samba.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: David Howells <dhowells@redhat.com> Cc: James Morris <jmorris@namei.org> Cc: <linux-man@vger.kernel.org> Cc: <linux-arch@vger.kernel.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | dcr-generic.h | s | 1.6K | 39 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | grackle.h | s | 292B | 10 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | libata-portmap.h | s | 334B | 9 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | pgtable-ppc64.h | s | 11K | 330 | Becky Bruce | beckyb@kernel.crashing.org | 1309333696 |  | powerpc: Whitespace fix to include/asm/pgtable-ppc64.h  Signed-off-by: Becky Bruce <beckyb@kernel.crashing.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | syscall.h | s | 2.2K | 78 | Ian Munsie | imunsie@au.ibm.com | 1306381137 |  | powerpc/ftrace: Implement raw syscall tracepoints on PowerPC  This patch implements the raw syscall tracepoints on PowerPC and exports them for ftrace syscalls to use.  To minimise reworking existing code, I slightly re-ordered the thread info flags such that the new TIF_SYSCALL_TRACEPOINT bit would still fit within the 16 bits of the andi. instruction's UI field. The instructions in question are in /arch/powerpc/kernel/entry_{32,64}.S to and the _TIF_SYSCALL_T_OR_A with the thread flags to see if system call tracing is enabled.  In the case of 64bit PowerPC, arch_syscall_addr and arch_syscall_match_sym_name are overridden to allow ftrace syscalls to work given the unusual system call table structure and symbol names that start with a period.  Signed-off-by: Ian Munsie <imunsie@au1.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | pmc.h | s | 1.4K | 39 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1253770299 |  | powerpc/pmc: Don't access lppaca on Book3E  It doesn't exist !  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | string.h | s | 1.0K | 27 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | page_64.h | s | 4.5K | 126 | Becky Bruce | beckyb@kernel.crashing.org | 1323235581 |  | powerpc: Only define HAVE_ARCH_HUGETLB_UNMAPPED_AREA if PPC_MM_SLICES  If we don't have slices, we should be able to use the generic hugetlb_get_unmapped_area() code  Signed-off-by: Becky Bruce <beckyb@kernel.crashing.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | qe_ic.h | s | 4.7K | 120 | Richard Cochran | richardcochran@gmail.com | 1301492282 |  | powerpc: qe_ic: Rename get_irq_desc_data and get_irq_desc_chip  These two functions disappeared in commit      0c6f8a8b917ad361319c8ace3e9f28e69bfdb4c1     "genirq: Remove compat code"  but they still exist in qe_ic.h. This patch renames the function to their new names.  Signed-off-by: Richard Cochran <richard.cochran@omicron.at> Cc: linuxppc-dev@lists.ozlabs.org Cc: Lennert Buytenhek <buytenh@secretlab.ca> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> LKML-Reference: <20110330132504.GA31832@riccoc20.at.omicron.at> Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
f | ioctl.h | s | 239B | 9 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | sstep.h | s | 1.1K | 24 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | cputable.h | s | 21K | 513 | Scott Wood | scottwood@freescale.com | 1334192448 |  | KVM: PPC: add CPU_FTR_EMB_HV to CPU table  e6500 support (commit 10241842fbe900276634fee8d37ec48a7d8a762f, "powerpc: Add initial e6500 cpu support" and the introduction of CPU_FTR_EMB_HV (commit 73196cd364a2d972d73fa08da9d81ca3215bed68, "KVM: PPC: e500mc support") collided during merge, leaving e6500's CPU table entry missing CPU_FTR_EMB_HV.  Signed-off-by: Scott Wood <scottwood@freescale.com> Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
f | module.h | s | 2.4K | 80 | Rusty Russell | rusty@rustcorp.com.au | 1260856714 |  | module: handle ppc64 relocating kcrctabs when CONFIG_RELOCATABLE=y  powerpc applies relocations to the kcrctab.  They're absolute symbols, but it's not completely unreasonable: other archs may too, but the relocation is often 0.  http://lists.ozlabs.org/pipermail/linuxppc-dev/2009-November/077972.html  Inspired-by: Neil Horman <nhorman@tuxdriver.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au> Tested-by: Neil Horman <nhorman@tuxdriver.com> Acked-by: Paul Mackerras <paulus@samba.org>
f | wsp.h | s | 456B | 12 | David Gibson | david@gibson.dropbear.id.au | 1304652755 |  | powerpc: Add WSP platform  Add a platform for the Wire Speed Processor, based on the PPC A2.  This includes code for the ICS & OPB interrupt controllers, as well as a SCOM backend, and SCOM based cpu bringup.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: David Gibson <david@gibson.dropbear.id.au> Signed-off-by: Jack Miller <jack@codezen.org> Signed-off-by: Ian Munsie <imunsie@au1.ibm.com> Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | poll.h | s | 30B | 1 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | processor.h | s | 11K | 346 | Linus Torvalds | torvalds@linux-foundation.org | 1337901450 |  | Merge branch 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm  Pull KVM changes from Avi Kivity:  "Changes include additional instruction emulation, page-crossing MMIO,   faster dirty logging, preventing the watchdog from killing a stopped   guest, module autoload, a new MSI ABI, and some minor optimizations   and fixes.  Outside x86 we have a small s390 and a very large ppc   update.    Regarding the new (for kvm) rebaseless workflow, some of the patches   that were merged before we switch trees had to be rebased, while   others are true pulls.  In either case the signoffs should be correct   now."  Fix up trivial conflicts in Documentation/feature-removal-schedule.txt arch/powerpc/kvm/book3s_segment.S and arch/x86/include/asm/kvm_para.h.  I suspect the kvm_para.h resolution ends up doing the "do I have cpuid" check effectively twice (it was done differently in two different commits), but better safe than sorry ;)  * 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm: (125 commits)   KVM: make asm-generic/kvm_para.h have an ifdef __KERNEL__ block   KVM: s390: onereg for timer related registers   KVM: s390: epoch difference and TOD programmable field   KVM: s390: KVM_GET/SET_ONEREG for s390   KVM: s390: add capability indicating COW support   KVM: Fix mmu_reload() clash with nested vmx event injection   KVM: MMU: Don't use RCU for lockless shadow walking   KVM: VMX: Optimize %ds, %es reload   KVM: VMX: Fix %ds/%es clobber   KVM: x86 emulator: convert bsf/bsr instructions to emulate_2op_SrcV_nobyte()   KVM: VMX: unlike vmcs on fail path   KVM: PPC: Emulator: clean up SPR reads and writes   KVM: PPC: Emulator: clean up instruction parsing   kvm/powerpc: Add new ioctl to retreive server MMU infos   kvm/book3s: Make kernel emulated H_PUT_TCE available for "PR" KVM   KVM: PPC: bookehv: Fix r8/r13 storing in level exception handler   KVM: PPC: Book3S: Enable IRQs during exit handling   KVM: PPC: Fix PR KVM on POWER7 bare metal   KVM: PPC: Fix stbux emulation   KVM: PPC: bookehv: Use lwz/stw instead of PPC_LL/PPC_STL for 32-bit fields   ...
f | oprofile_impl.h | s | 3.0K | 126 | Carl Love | cel@us.ibm.com | 1231426315 |  | powerpc/oprofile: IBM CELL: add SPU event profiling support  This patch adds the SPU event based profiling funcitonality for the IBM Cell processor.  Previously, the CELL OProfile kernel code supported PPU event, PPU cycle profiling and SPU cycle profiling.   The addition of SPU event profiling allows the users to identify where in their SPU code various SPU evnets are occuring.  This should help users further identify issues with their code.  Note, SPU profiling has some limitations due to HW constraints.  Only one event at a time can be used for profiling and SPU event profiling must be time sliced across all of the SPUs in a node.  The patch adds a new arch specific file to the OProfile file system. The file has bit 0 set to indicate that the kernel supports SPU event profiling. The user tool must check this file/bit to make sure the kernel supports SPU event profiling before trying to do SPU event profiling.  The user tool check is part of the user tool patch for SPU event profiling.  Signed-off-by: Carl Love <carll@us.ibm.com> Signed-off-by: Robert Richter <robert.richter@amd.com>
f | mmu-hash32.h | s | 2.4K | 80 | Becky Bruce | beckyb@kernel.crashing.org | 1251433452 |  | powerpc: Name xpn & x fields in HW Hash PTE format  Previously, the 36-bit code was using these bits, but they had never been named in the pte format definition.  This patch just gives those fields their proper names and adds a comment that they are only present on some processors.  There is no functional code change.  Signed-off-by: Becky Bruce <beckyb@kernel.crashing.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | percpu.h | s | 429B | 14 | Anton Blanchard | anton@samba.org | 1278638910 |  | powerpc: Optimise per cpu accesses on 64bit  Now we dynamically allocate the paca array, it takes an extra load whenever we want to access another cpu's paca. One place we do that a lot is per cpu variables. A simple example:  DEFINE_PER_CPU(unsigned long, vara); unsigned long test4(int cpu) { 	return per_cpu(vara, cpu); }  This takes 4 loads, 5 if you include the actual load of the per cpu variable:      ld r11,-32760(r30)  # load address of paca pointer     ld r9,-32768(r30)   # load link address of percpu variable     sldi r3,r29,9       # get offset into paca (each entry is 512 bytes)     ld r0,0(r11)        # load paca pointer     add r3,r0,r3        # paca + offset     ld r11,64(r3)       # load paca[cpu].data_offset      ldx r3,r9,r11       # load per cpu variable  If we remove the ppc64 specific per_cpu_offset(), we get the generic one which indexes into a statically allocated array. This removes one load and one add:      ld r11,-32760(r30)  # load address of __per_cpu_offset     ld r9,-32768(r30)   # load link address of percpu variable     sldi r3,r29,3       # get offset into __per_cpu_offset (each entry 8 bytes)     ldx r11,r11,r3      # load __per_cpu_offset[cpu]      ldx r3,r9,r11       # load per cpu variable  Having all the offsets in one array also helps when iterating over a per cpu variable across a number of cpus, such as in the scheduler. Before we would need to load one paca cacheline when calculating each per cpu offset. Now we have 16 (128 / sizeof(long)) per cpu offsets in each cacheline.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | page.h | s | 11K | 330 | Suzuki Poulose | suzuki@in.ibm.com | 1324394494 |  | powerpc: Define virtual-physical translations for RELOCATABLE  We find the runtime address of _stext and relocate ourselves based on the following calculation.  	virtual_base = ALIGN(KERNELBASE,KERNEL_TLB_PIN_SIZE) + 			MODULO(_stext.run,KERNEL_TLB_PIN_SIZE)  relocate() is called with the Effective Virtual Base Address (as shown below)              || Phys. Addr|| Virt. Addr || Page        ||------------------------|| Boundary    ||           ||            ||             ||           ||            ||             ||           ||            || Kernel Load ||___________||_ __ _ _ _ _||<- Effective Addr(_stext)||           ||      ^     ||Virt. Base Addr             ||           ||      ||     ||             ||           ||      ||     ||             ||           ||reloc_offset||             ||           ||      ||     ||             ||           ||      ||     ||             ||           ||______v_____||<-(KERNELBASE)%TLB_SIZE             ||           ||            ||             ||           ||            ||             ||           ||            || Page        ||-----------||------------|| Boundary    ||           ||            ||  On BookE, we need __va() & __pa() early in the boot process to access the device tree.  Currently this has been defined as :  #define __va(x) ((void *)(unsigned long)((phys_addr_t)(x) - 						PHYSICAL_START + KERNELBASE) where:  PHYSICAL_START is kernstart_addr - a variable updated at runtime.  KERNELBASE	is the compile time Virtual base address of kernel.  This won't work for us, as kernstart_addr is dynamic and will yield different results for __va()/__pa() for same mapping.  e.g.,  Let the kernel be loaded at 64MB and KERNELBASE be 0xc0000000 (same as PAGE_OFFSET).  In this case, we would be mapping 0 to 0xc0000000, and kernstart_addr = 64M  Now __va(1MB) = (0x100000) - (0x4000000) + 0xc0000000 		= 0xbc100000 , which is wrong.  it should be : 0xc0000000 + 0x100000 = 0xc0100000  On platforms which support AMP, like PPC_47x (based on 44x), the kernel could be loaded at highmem. Hence we cannot always depend on the compile time constants for mapping.  Here are the possible solutions:  1) Update kernstart_addr(PHSYICAL_START) to match the Physical address of compile time KERNELBASE value, instead of the actual Physical_Address(_stext).  The disadvantage is that we may break other users of PHYSICAL_START. They could be replaced with __pa(_stext).  2) Redefine __va() & __pa() with relocation offset  #ifdef	CONFIG_RELOCATABLE_PPC32 #define __va(x) ((void *)(unsigned long)((phys_addr_t)(x) - PHYSICAL_START + (KERNELBASE + RELOC_OFFSET))) #define __pa(x) ((unsigned long)(x) + PHYSICAL_START - (KERNELBASE + RELOC_OFFSET)) #endif  where, RELOC_OFFSET could be    a) A variable, say relocation_offset (like kernstart_addr), updated      at boot time. This impacts performance, as we have to load an additional      variable from memory.  		OR    b) #define RELOC_OFFSET ((PHYSICAL_START & PPC_PIN_SIZE_OFFSET_MASK) - \                       (KERNELBASE & PPC_PIN_SIZE_OFFSET_MASK))     This introduces more calculations for doing the translation.  3) Redefine __va() & __pa() with a new variable  i.e,  #define __va(x) ((void *)(unsigned long)((phys_addr_t)(x) + VIRT_PHYS_OFFSET))  where VIRT_PHYS_OFFSET :  #ifdef CONFIG_RELOCATABLE_PPC32 #define VIRT_PHYS_OFFSET virt_phys_offset #else #define VIRT_PHYS_OFFSET (KERNELBASE - PHYSICAL_START) #endif /* CONFIG_RELOCATABLE_PPC32 */  where virt_phy_offset is updated at runtime to :  	Effective KERNELBASE - kernstart_addr.  Taking our example, above:  virt_phys_offset = effective_kernelstart_vaddr - kernstart_addr 		 = 0xc0400000 - 0x400000 		 = 0xc0000000 	and  	__va(0x100000) = 0xc0000000 + 0x100000 = 0xc0100000 	 which is what we want.  I have implemented (3) in the following patch which has same cost of operation as the existing one.  I have tested the patches on 440x platforms only. However this should work fine for PPC_47x also, as we only depend on the runtime address and the current TLB XLAT entry for the startup code, which is available in r25. I don't have access to a 47x board yet. So, it would be great if somebody could test this on 47x.  Signed-off-by: Suzuki K. Poulose <suzuki@in.ibm.com> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Kumar Gala <galak@kernel.crashing.org> Cc: linuxppc-dev <linuxppc-dev@lists.ozlabs.org> Signed-off-by: Josh Boyer <jwboyer@gmail.com>
f | syscalls.h | s | 1.9K | 43 | Christoph Hellwig | hch@lst.de | 1268437952 |  | improve sys_newuname() for compat architectures  On an architecture that supports 32-bit compat we need to override the reported machine in uname with the 32-bit value.  Instead of doing this separately in every architecture introduce a COMPAT_UTS_MACHINE define in <asm/compat.h> and apply it directly in sys_newuname().  Signed-off-by: Christoph Hellwig <hch@lst.de> Cc: Ralf Baechle <ralf@linux-mips.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mundt <lethal@linux-sh.org> Cc: Jeff Dike <jdike@addtoit.com> Cc: Hirokazu Takata <takata@linux-m32r.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Ingo Molnar <mingo@elte.hu> Cc: H. Peter Anvin <hpa@zytor.com> Cc: Al Viro <viro@zeniv.linux.org.uk> Cc: Arnd Bergmann <arnd@arndb.de> Cc: Heiko Carstens <heiko.carstens@de.ibm.com> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: "Luck, Tony" <tony.luck@intel.com> Cc: James Morris <jmorris@namei.org> Cc: Andreas Schwab <schwab@linux-m68k.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | fsl_gtm.h | s | 1.4K | 40 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | pmac_pfunc.h | s | 8.0K | 201 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | i8259.h | s | 322B | 9 | Grant Likely | grant.likely@secretlab.ca | 1329253610 |  | irq_domain/powerpc: Use common irq_domain structure instead of irq_host  This patch drops the powerpc-specific irq_host structures and uses the common irq_domain strucutres defined in linux/irqdomain.h.  It also fixes all the users to use the new structure names.  Renaming irq_host to irq_domain has been discussed for a long time, and this patch is a step in the process of generalizing the powerpc virq code to be usable by all architecture.  An astute reader will notice that this patch actually removes the irq_host structure instead of renaming it.  This is because the irq_domain structure already exists in include/linux/irqdomain.h and has the needed data members.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | cmpxchg.h | s | 6.4K | 271 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | ps3stor.h | s | 2.0K | 58 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | div64.h | s | 31B | 1 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | lv1call.h | s | 18K | 320 | Geoff Levand | geoff@infradead.org | 1335306856 |  | powerpc/ps3: Correct lv1 repository routine names  Rename these repo routines:    modify_repository_node_value => write_repository_node   remove_repository_node => delete_repository_node  Signed-off-by: Geoff Levand <geoff@infradead.org>
f | highmem.h | s | 2.6K | 89 | Cong Wang | amwang@redhat.com | 1332251310 |  | highmem: kill all __kmap_atomic() [swarren@nvidia.com: highmem: Fix ARM build break due to __kmap_atomic rename]  Signed-off-by: Stephen Warren <swarren@nvidia.com> Signed-off-by: Cong Wang <amwang@redhat.com>
f | vdso_datapage.h | s | 4.3K | 106 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | auxvec.h | s | 568B | 17 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for PowerPC  Disintegrate asm/system.h for PowerPC.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> cc: linuxppc-dev@lists.ozlabs.org
f | mpc52xx.h | s | 10K | 300 | Eric Millbrandt | emillbrandt@dekaresearch.com | 1281149358 |  | powerpc/5200: add mpc5200_psc_ac97_gpio_reset  Work around a silicon bug in the ac97 reset functionality of the mpc5200(b).  The implementation of the ac97 "cold" reset is flawed. If the sync and output lines are high when reset is asserted the attached ac97 device may go into test mode.  Avoid this by reconfiguring the psc to gpio mode and generating the reset manually.  From MPC5200B User's Manual: "Some AC97 devices goes to a test mode, if the Sync line is high during the Res line is low (reset phase). To avoid this behavior the Sync line must be also forced to zero during the reset phase. To do that, the pin muxing should switch to GPIO mode and the GPIO control register should be used to control the output lines."  Signed-off-by: Eric Millbrandt <emillbrandt@dekaresearch.com> Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | param.h | s | 31B | 1 | Robert P. J. Day | rpjday@crashcourse.ca | 1265179188 |  | powerpc: Simplify param.h by including <asm-generic/param.h>  Signed-off-by: Robert P. J. Day <rpjday@crashcourse.ca> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | fsl_hcalls.h | s | 17K | 565 | Timur Tabi | timur@freescale.com | 1309181419 |  | powerpc: introduce ePAPR embedded hypervisor hcall interface  ePAPR hypervisors provide operating system services via a "hypercall" interface.  The following steps need to be performed to make an hcall:  1. Load r11 with the hcall number 2. Load specific other registers with parameters 3. Issue instrucion "sc 1" 4. The return code is in r3 5. Other returned parameters are in other registers.  To provide this service to the kernel, these steps are wrapped in inline assembly functions.  Standard ePAPR hcalls are in epapr_hcalls.h, and Freescale extensions are in fsl_hcalls.h.  Signed-off-by: Timur Tabi <timur@freescale.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | xilinx_pci.h | s | 551B | 18 | Roderick Colenbrander | thunderbird2k@gmail.com | 1244304862 |  | powerpc/virtex: Add support for Xilinx PCI host bridge  This patch adds support for the Xilinx plbv46-pci-1.03.a PCI host bridge IPcore.  Signed-off-by: Roderick Colenbrander <thunderbird2k@gmail.com> Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | ppc-pci.h | s | 2.7K | 65 | Linus Torvalds | torvalds@linux-foundation.org | 1332536532 |  | Merge branch 'linux-next' of git://git.kernel.org/pub/scm/linux/kernel/git/jbarnes/pci  Pull PCI changes (including maintainer change) from Jesse Barnes:  "This pull has some good cleanups from Bjorn and Yinghai, as well as   some more code from Yinghai to better handle resource re-allocation   when enabled.    There's also a new initcall_debug feature from Arjan which will print   out quirk timing information to help identify slow quirks for fixing   or refinement (Yinghai sent in a few patches to do just that once the   new debug code landed).    Beyond that, I'm handing off PCI maintainership to Bjorn Helgaas.   He's been a core PCI and Linux contributor for some time now, and has   kindly volunteered to take over.  I just don't feel I have the time   for PCI review and work that it deserves lately (I've taken on some   other projects), and haven't been as responsive lately as I'd like, so   I approached Bjorn asking if he'd like to manage things.  He's going   to give it a try, and I'm confident he'll do at least as well as I   have in keeping the tree managed, patches flowing, and keeping things   stable."  Fix up some fairly trivial conflicts due to other cleanups (mips device resource fixup cleanups clashing with list handling cleanup, ppc iseries removal clashing with pci_probe_only cleanup etc)  * 'linux-next' of git://git.kernel.org/pub/scm/linux/kernel/git/jbarnes/pci: (112 commits)   PCI: Bjorn gets PCI hotplug too   PCI: hand PCI maintenance over to Bjorn Helgaas   unicore32/PCI: move <asm-generic/pci-bridge.h> include to asm/pci.h   sparc/PCI: convert devtree and arch-probed bus addresses to resource   powerpc/PCI: allow reallocation on PA Semi   powerpc/PCI: convert devtree bus addresses to resource   powerpc/PCI: compute I/O space bus-to-resource offset consistently   arm/PCI: don't export pci_flags   PCI: fix bridge I/O window bus-to-resource conversion   x86/PCI: add spinlock held check to 'pcibios_fwaddrmap_lookup()'   PCI / PCIe: Introduce command line option to disable ARI   PCI: make acpihp use __pci_remove_bus_device instead   PCI: export __pci_remove_bus_device   PCI: Rename pci_remove_behind_bridge to pci_stop_and_remove_behind_bridge   PCI: Rename pci_remove_bus_device to pci_stop_and_remove_bus_device   PCI: print out PCI device info along with duration   PCI: Move "pci reassigndev resource alignment" out of quirks.c   PCI: Use class for quirk for usb host controller fixup   PCI: Use class for quirk for ti816x class fixup   PCI: Use class for quirk for intel e100 interrupt fixup   ...
f | kvm.h | s | 7.7K | 284 | Scott Wood | scottwood@freescale.com | 1333878873 |  | KVM: PPC: e500mc support  Add processor support for e500mc, using hardware virtualization support (GS-mode).  Current issues include:  - No support for external proxy (coreint) interrupt mode in the guest.  Includes work by Ashish Kalra <Ashish.Kalra@freescale.com>, Varun Sethi <Varun.Sethi@freescale.com>, and Liu Yu <yu.liu@freescale.com>.  Signed-off-by: Scott Wood <scottwood@freescale.com> Signed-off-by: Alexander Graf <agraf@suse.de> Signed-off-by: Avi Kivity <avi@redhat.com>
f | fadump.h | s | 5.9K | 184 | Mahesh Salgaonkar | mahesh@linux.vnet.ibm.com | 1329954602 |  | fadump: Invalidate registration and release reserved memory for general use.  This patch introduces an sysfs interface '/sys/kernel/fadump_release_mem' to invalidate the last fadump registration, invalidate '/proc/vmcore', release the reserved memory for general use and re-register for future kernel dump. Once the dump is copied to the disk, unlike phyp dump, the userspace tool can release all the memory reserved for dump with one single operation of echo 1 to '/sys/kernel/fadump_release_mem'.  Release the reserved memory region excluding the size of the memory required for future kernel dump registration. And therefore, unlike kdump, Fadump doesn't need a 2nd reboot to get back the system to the production configuration.  Signed-off-by: Mahesh Salgaonkar <mahesh@linux.vnet.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | pmac_feature.h | s | 13K | 344 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | pgalloc.h | s | 1.7K | 57 | Peter Zijlstra | a.p.zijlstra@chello.nl | 1306337956 |  | mm, powerpc: move the RCU page-table freeing into generic code  In case other architectures require RCU freed page-tables to implement gup_fast() and software filled hashes and similar things, provide the means to do so by moving the logic into generic code.  Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Requested-by: David Miller <davem@davemloft.net> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: Russell King <rmk@arm.linux.org.uk> Cc: Paul Mundt <lethal@linux-sh.org> Cc: Jeff Dike <jdike@addtoit.com> Cc: Richard Weinberger <richard@nod.at> Cc: Tony Luck <tony.luck@intel.com> Cc: KAMEZAWA Hiroyuki <kamezawa.hiroyu@jp.fujitsu.com> Cc: Hugh Dickins <hughd@google.com> Cc: Mel Gorman <mel@csn.ul.ie> Cc: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com> Cc: Nick Piggin <npiggin@kernel.dk> Cc: Namhyung Kim <namhyung@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | sfp-machine.h | s | 13K | 339 | Linus Torvalds | torvalds@linux-foundation.org | 1274887815 |  | Revert "endian: #define __BYTE_ORDER"  This reverts commit b3b77c8caef1750ebeea1054e39e358550ea9f55, which was also totally broken (see commit 0d2daf5cc858 that reverted the crc32 version of it).  As reported by Stephen Rothwell, it causes problems on big-endian machines:  > In file included from fs/jfs/jfs_types.h:33, >                  from fs/jfs/jfs_incore.h:26, >                  from fs/jfs/file.c:22: > fs/jfs/endian24.h:36:101: warning: "__LITTLE_ENDIAN" is not defined  The kernel has never had that crazy "__BYTE_ORDER == __LITTLE_ENDIAN" model.  It's not how we do things, and it isn't how we _should_ do things.  So don't go there.  Requested-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | gpio.h | s | 106B | 4 | Mark Brown | broonie@opensource.wolfsonmicro.com | 1336780814 |  | gpiolib/arches: Centralise bolierplate asm/gpio.h  Rather than requiring architectures that use gpiolib but don't have any need to define anything custom to copy an asm/gpio.h provide a Kconfig symbol which architectures must select in order to include gpio.h and for other architectures just provide the trivial implementation directly.  This makes it much easier to do gpiolib updates and is also a step towards making gpiolib APIs available on every architecture.  For architectures with existing boilerplate code leave a stub header in place which warns on direct inclusion of asm/gpio.h and includes linux/gpio.h to catch code that's doing this.  Direct inclusion of asm/gpio.h has long been deprecated.  Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com> Acked-by: Jonas Bonn <jonas@southpole.se> Acked-by: Tony Luck <tony.luck@intel.com> Acked-by: Linus Walleij <linus.walleij@linaro.org> Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | asm-offsets.h | s | 35B | 1 | Sam Ravnborg | sam@ravnborg.org | 1260619694 |  | kbuild: move asm-offsets.h to include/generated  The simplest method was to add an extra asm-offsets.h file in arch/$ARCH/include/asm that references the generated file.  We can now migrate the architectures one-by-one to reference the generated file direct - and when done we can delete the temporary arch/$ARCH/include/asm/asm-offsets.h file.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Michal Marek <mmarek@suse.cz>
f | fsl_guts.h | s | 7.6K | 171 | Timur Tabi | timur@freescale.com | 1333026847 |  | powerpc/8xxx: remove 85xx/86xx restrictions from fsl_guts.h  Remove the check for CONFIG_PPC_85xx and CONFIG_PPC_86xx from fsl_guts.h. The check was originally intended to allow the same header file to be used on 85xx and 86xx systems, even though the Global Utilities register could be different.  It turns out that they're not actually different, and so the check is not necessary.  In addition, neither macro is defined for 64-bit e5500 kernels, so that causes a build break.  Signed-off-by: Timur Tabi <timur@freescale.com> Acked-by: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | scatterlist.h | s | 502B | 14 | FUJITA Tomonori | fujita.tomonori@lab.ntt.co.jp | 1281197750 |  | remove needless ISA_DMA_THRESHOLD  Architectures don't need to define ISA_DMA_THRESHOLD anymore.  Signed-off-by: FUJITA Tomonori <fujita.tomonori@lab.ntt.co.jp> Acked-by: James Bottomley <James.Bottomley@suse.de> Acked-by: David Howells <dhowells@redhat.com> Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
f | spu_csa.h | s | 6.9K | 253 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | xmon.h | s | 876B | 27 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | time.h | s | 4.8K | 174 | Bharat Bhushan | r65777@freescale.com | 1336313947 |  | KVM: PPC: Use clockevent multiplier and shifter for decrementer  Time for which the hrtimer is started for decrementer emulation is calculated using tb_ticks_per_usec. While hrtimer uses the clockevent for DEC reprogramming (if needed) and which calculate timebase ticks using the multiplier and shifter mechanism implemented within clockevent layer.  It was observed that this conversion (timebase->time->timebase) are not correct because the mechanism are not consistent. In our setup it adds 2% jitter.  With this patch clockevent multiplier and shifter mechanism are used when starting hrtimer for decrementer emulation. Now the jitter is < 0.5%.  Signed-off-by: Bharat Bhushan <bharat.bhushan@freescale.com> Signed-off-by: Alexander Graf <agraf@suse.de>
f | code-patching.h | s | 1.7K | 45 | Kumar Gala | galak@kernel.crashing.org | 1235346536 |  | powerpc: Unify opcode definitions and support  Create a new header that becomes a single location for defining PowerPC opcodes used by code that is either generationg instructions at runtime (fixups, debug, etc.), emulating instructions, or just compiling instructions old assemblers don't know about.  We currently don't handle the floating point emulation or alignment decode as both are better handled by the specific decode support they already have.  Added support for the new dcbzl, dcbal, msgsnd, tlbilx, & wait instructions since older assemblers don't know about them.  Signed-off-by: Kumar Gala <galak@kernel.crashing.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | fb.h | s | 444B | 17 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | io-defs.h | s | 3.1K | 54 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | xics.h | s | 3.9K | 128 | Grant Likely | grant.likely@secretlab.ca | 1329253610 |  | irq_domain/powerpc: Use common irq_domain structure instead of irq_host  This patch drops the powerpc-specific irq_host structures and uses the common irq_domain strucutres defined in linux/irqdomain.h.  It also fixes all the users to use the new structure names.  Renaming irq_host to irq_domain has been discussed for a long time, and this patch is a step in the process of generalizing the powerpc virq code to be usable by all architecture.  An astute reader will notice that this patch actually removes the irq_host structure instead of renaming it.  This is because the irq_domain structure already exists in include/linux/irqdomain.h and has the needed data members.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Milton Miller <miltonm@bga.com> Tested-by: Olof Johansson <olof@lixom.net>
f | emulated_ops.h | s | 2.4K | 77 | Arun Sharma | asharma@fb.com | 1311724187 |  | atomic: use <linux/atomic.h>  This allows us to move duplicated code in <asm/atomic.h> (atomic_inc_not_zero() for now) to <linux/atomic.h>  Signed-off-by: Arun Sharma <asharma@fb.com> Reviewed-by: Eric Dumazet <eric.dumazet@gmail.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: David Miller <davem@davemloft.net> Cc: Eric Dumazet <eric.dumazet@gmail.com> Acked-by: Mike Frysinger <vapier@gentoo.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | swab.h | s | 2.0K | 70 | Jaswinder Singh Rajput | jaswinderrajput@gmail.com | 1233466289 |  | headers_check fix: powerpc, swab.h  fix the following 'make headers_check' warning:    usr/include/asm-powerpc/swab.h:11: include of <linux/types.h> is preferred over <asm/types.h>  Signed-off-by: Jaswinder Singh Rajput <jaswinderrajput@gmail.com>
f | heathrow.h | s | 2.5K | 60 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | thread_info.h | s | 5.5K | 152 | Al Viro | viro@zeniv.linux.org.uk | 1338569930 |  | set_restore_sigmask() is never called without SIGPENDING (and never should be)  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | irq.h | s | 1.9K | 60 | Grant Likely | grant.likely@secretlab.ca | 1335746726 |  | powerpc/irqdomain: Fix broken NR_IRQ references  The switch from using irq_map to irq_alloc_desc*() for managing irq number allocations introduced new bugs in some of the powerpc interrupt code.  Several functions rely on the value of NR_IRQS to determine the maximum irq number that could get allocated.  However, with sparse_irq and using irq_alloc_desc*() the maximum possible irq number is now specified with 'nr_irqs' which may be a number larger than NR_IRQS.  This has caused breakage on powermac when CONFIG_NR_IRQS is set to 32.  This patch removes most of the direct references to NR_IRQS in the powerpc code and replaces them with either a nr_irqs reference or by using the common for_each_irq_desc() macro.  The powerpc-specific for_each_irq() macro is removed at the same time.  Also, the Cell axon_msi driver is refactored to remove the global build assumption on the size of NR_IRQS and instead add a limit to the maximum irq number when calling irq_domain_add_nomap().  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | firmware.h | s | 4.5K | 122 | Stephen Rothwell | sfr@canb.auug.org.au | 1332288971 |  | powerpc: Remove FW_FEATURE ISERIES from arch code  This is no longer selectable, so just remove all the dependent code.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | fcntl.h | s | 304B | 8 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | socket.h | s | 1.8K | 62 | Ben Greear | greearb@candelatech.com | 1330076255 |  | net: Add framework to allow sending packets with customized CRC.  This is useful for testing RX handling of frames with bad CRCs.  Requires driver support to actually put the packet on the wire properly.  Signed-off-by: Ben Greear <greearb@candelatech.com> Tested-by: Aaron Brown <aaron.f.brown@intel.com> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
f | pgtable.h | s | 7.9K | 186 | Geoff Thorpe | geoff@geoffthorpe.net | 1322191972 |  | powerpc: Add pgprot_cached_noncoherent()  This adds a pgprot combination required by some cache-enabled IO device mappings, such as Freescale datapath (QMan and BMan) portals.  Signed-off-by: Geoff Thorpe <geoff@geoffthorpe.net> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | mediabay.h | s | 1.3K | 37 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1260338954 |  | powerpc/macio: Rework hotplug media bay support  The hotplug mediabay has tendrils deep into drivers/ide code which makes a libata port reather difficult. In addition it's ugly and could be done better.  This reworks the interface between the mediabay and the rest of the world so that:     - Any macio_driver can now have a mediabay_event callback which will be called when that driver sits on a mediabay and it's been either plugged or unplugged. The device type is passed as an argument. We can now move all the IDE cruft into the IDE driver itself     - A check_media_bay() function can be used to take a peek at the type of device currently in the bay if any, a cleaner variant of the previous function with the same name.     - A pair of lock/unlock functions are exposed to allow the IDE driver to block the hotplug callbacks during the initial setup and probing of the bay in order to avoid nasty race conditions.     - The mediabay code no longer needs to spin on the status register of the IDE interface when it detects an IDE device, this is done just fine by the IDE code itself  Overall, less code, simpler, and allows for another driver than our old drivers/ide based one.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | timex.h | s | 823B | 40 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | stat.h | s | 2.2K | 76 | Anton Blanchard | anton@samba.org | 1338648251 |  | powerpc: Fix size of st_nlink on 64bit  commit e57f93cc53b7 (powerpc: get rid of nlink_t uses, switch to explicitly-sized type) changed the size of st_nlink on ppc64 from a long to a short, resulting in boot failures.  Signed-off-by: Anton Blanchard <anton@samba.org> Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | machdep.h | s | 10K | 280 | Stephen Rothwell | sfr@canb.auug.org.au | 1332894721 |  | powerpc: Remove NO_IRQ_IGNORE  Now that legacy iSeries is gone, this is no longer used.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | kvm_fpu.h | s | 2.7K | 78 | Andreas Schwab | schwab@linux-m68k.org | 1283400452 |  | powerpc: Remove fpscr use from [kvm_]cvt_{fd,df}  Neither lfs nor stfs touch the fpscr, so remove the restore/save of it around them.  Signed-off-by: Andreas Schwab <schwab@linux-m68k.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | ipcbuf.h | s | 993B | 30 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | switch_to.h | s | 1.8K | 61 | Linus Torvalds | torvalds@linux-foundation.org | 1337901450 |  | Merge branch 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm  Pull KVM changes from Avi Kivity:  "Changes include additional instruction emulation, page-crossing MMIO,   faster dirty logging, preventing the watchdog from killing a stopped   guest, module autoload, a new MSI ABI, and some minor optimizations   and fixes.  Outside x86 we have a small s390 and a very large ppc   update.    Regarding the new (for kvm) rebaseless workflow, some of the patches   that were merged before we switch trees had to be rebased, while   others are true pulls.  In either case the signoffs should be correct   now."  Fix up trivial conflicts in Documentation/feature-removal-schedule.txt arch/powerpc/kvm/book3s_segment.S and arch/x86/include/asm/kvm_para.h.  I suspect the kvm_para.h resolution ends up doing the "do I have cpuid" check effectively twice (it was done differently in two different commits), but better safe than sorry ;)  * 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm: (125 commits)   KVM: make asm-generic/kvm_para.h have an ifdef __KERNEL__ block   KVM: s390: onereg for timer related registers   KVM: s390: epoch difference and TOD programmable field   KVM: s390: KVM_GET/SET_ONEREG for s390   KVM: s390: add capability indicating COW support   KVM: Fix mmu_reload() clash with nested vmx event injection   KVM: MMU: Don't use RCU for lockless shadow walking   KVM: VMX: Optimize %ds, %es reload   KVM: VMX: Fix %ds/%es clobber   KVM: x86 emulator: convert bsf/bsr instructions to emulate_2op_SrcV_nobyte()   KVM: VMX: unlike vmcs on fail path   KVM: PPC: Emulator: clean up SPR reads and writes   KVM: PPC: Emulator: clean up instruction parsing   kvm/powerpc: Add new ioctl to retreive server MMU infos   kvm/book3s: Make kernel emulated H_PUT_TCE available for "PR" KVM   KVM: PPC: bookehv: Fix r8/r13 storing in level exception handler   KVM: PPC: Book3S: Enable IRQs during exit handling   KVM: PPC: Fix PR KVM on POWER7 bare metal   KVM: PPC: Fix stbux emulation   KVM: PPC: bookehv: Use lwz/stw instead of PPC_LL/PPC_STL for 32-bit fields   ...
f | systbl.h | s | 8.6K | 357 | Christopher Yeoh | cyeoh@au1.ibm.com | 1320107444 |  | Cross Memory Attach  The basic idea behind cross memory attach is to allow MPI programs doing intra-node communication to do a single copy of the message rather than a double copy of the message via shared memory.  The following patch attempts to achieve this by allowing a destination process, given an address and size from a source process, to copy memory directly from the source process into its own address space via a system call.  There is also a symmetrical ability to copy from the current process's address space into a destination process's address space.  - Use of /proc/pid/mem has been considered, but there are issues with   using it:   - Does not allow for specifying iovecs for both src and dest, assuming     preadv or pwritev was implemented either the area read from or   written to would need to be contiguous.   - Currently mem_read allows only processes who are currently   ptrace'ing the target and are still able to ptrace the target to read   from the target. This check could possibly be moved to the open call,   but its not clear exactly what race this restriction is stopping   (reason  appears to have been lost)   - Having to send the fd of /proc/self/mem via SCM_RIGHTS on unix   domain socket is a bit ugly from a userspace point of view,   especially when you may have hundreds if not (eventually) thousands   of processes  that all need to do this with each other   - Doesn't allow for some future use of the interface we would like to   consider adding in the future (see below)   - Interestingly reading from /proc/pid/mem currently actually   involves two copies! (But this could be fixed pretty easily)  As mentioned previously use of vmsplice instead was considered, but has problems.  Since you need the reader and writer working co-operatively if the pipe is not drained then you block.  Which requires some wrapping to do non blocking on the send side or polling on the receive.  In all to all communication it requires ordering otherwise you can deadlock.  And in the example of many MPI tasks writing to one MPI task vmsplice serialises the copying.  There are some cases of MPI collectives where even a single copy interface does not get us the performance gain we could.  For example in an MPI_Reduce rather than copy the data from the source we would like to instead use it directly in a mathops (say the reduce is doing a sum) as this would save us doing a copy.  We don't need to keep a copy of the data from the source.  I haven't implemented this, but I think this interface could in the future do all this through the use of the flags - eg could specify the math operation and type and the kernel rather than just copying the data would apply the specified operation between the source and destination and store it in the destination.  Although we don't have a "second user" of the interface (though I've had some nibbles from people who may be interested in using it for intra process messaging which is not MPI).  This interface is something which hardware vendors are already doing for their custom drivers to implement fast local communication.  And so in addition to this being useful for OpenMPI it would mean the driver maintainers don't have to fix things up when the mm changes.  There was some discussion about how much faster a true zero copy would go. Here's a link back to the email with some testing I did on that:  http://marc.info/?l=linux-mm&m=130105930902915&w=2  There is a basic man page for the proposed interface here:  http://ozlabs.org/~cyeoh/cma/process_vm_readv.txt  This has been implemented for x86 and powerpc, other architecture should mainly (I think) just need to add syscall numbers for the process_vm_readv and process_vm_writev. There are 32 bit compatibility versions for 64-bit kernels.  For arch maintainers there are some simple tests to be able to quickly verify that the syscalls are working correctly here:  http://ozlabs.org/~cyeoh/cma/cma-test-20110718.tgz  Signed-off-by: Chris Yeoh <yeohc@au1.ibm.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: "H. Peter Anvin" <hpa@zytor.com> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Arnd Bergmann <arnd@arndb.de> Cc: Paul Mackerras <paulus@samba.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: David Howells <dhowells@redhat.com> Cc: James Morris <jmorris@namei.org> Cc: <linux-man@vger.kernel.org> Cc: <linux-arch@vger.kernel.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | pmac_low_i2c.h | s | 3.2K | 86 | Jean Delvare | khali@linux-fr.org | 1260115579 |  | i2c-powermac: Include the i2c_adapter in struct pmac_i2c_bus  Include the i2c_adapter in struct pmac_i2c_bus. This avoids memory fragmentation and allows for several code cleanups.  Signed-off-by: Jean Delvare <khali@linux-fr.org> Tested-by: Michel Daenzer <michel@daenzer.net> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | shmbuf.h | s | 1.6K | 54 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | feature-fixups.h | s | 6.7K | 156 | Michael Neuling | mikey@neuling.org | 1304486366 |  | powerpc: Use new CPU feature bit to select 2.06 tlbie  This removes MMU_FTR_TLBIE_206 as we can now use CPU_FTR_HVMODE_206.  It also changes the logic to select which tlbie to use to be based on this new CPU feature bit.  This also duplicates the ASM_FTR_IF/SET/CLR defines for CPU features (copied from MMU features).  Signed-off-by: Michael Neuling <mikey@neuling.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | cpm1.h | s | 20K | 559 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | pte-40x.h | s | 2.9K | 59 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1253770309 |  | powerpc/mm: Fix 40x and 8xx vs. _PAGE_SPECIAL  The test to check whether we have _PAGE_SPECIAL defined is broken, since we always define it, just not always to a meaninful value :-)  That broke 8xx and 40x under some circumstances.  This fixes it by adding _PAGE_SPECIAL for both of these since they had a free PTE bit, and removing the condition around advertising it.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | uaccess.h | s | 13K | 405 | Paul Mackerras | paulus@samba.org | 1338177607 |  | powerpc: Use the new generic strncpy_from_user() and strnlen_user()  This is much the same as for SPARC except that we can do the find_zero() function more efficiently using the count-leading-zeroes instructions. Tested on 32-bit and 64-bit PowerPC.  Signed-off-by: Paul Mackerras <paulus@samba.org> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | uninorth.h | s | 8.2K | 204 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1303885871 |  | Revert wrong fixes for common misspellings  These changes were incorrectly fixed by codespell. They were now manually corrected.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | swiotlb.h | s | 692B | 18 | FUJITA Tomonori | fujita.tomonori@lab.ntt.co.jp | 1251433450 |  | powerpc: use dma_map_ops struct  This converts uses dma_map_ops struct (in include/linux/dma-mapping.h) instead of POWERPC homegrown dma_mapping_ops.  Signed-off-by: FUJITA Tomonori <fujita.tomonori@lab.ntt.co.jp> Acked-by: Becky Bruce <beckyb@kernel.crashing.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | vga.h | s | 1.1K | 38 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | ucc_fast.h | s | 7.6K | 218 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | dbell.h | s | 1.4K | 38 | Alexander Graf | agraf@suse.de | 1333878890 |  | KVM: PPC: e500mc: Add doorbell emulation support  When one vcpu wants to kick another, it can issue a special IPI instruction called msgsnd. This patch emulates this instruction, its clearing counterpart and the infrastructure required to actually trigger that interrupt inside a guest vcpu.  With this patch, SMP guests on e500mc work.  Signed-off-by: Alexander Graf <agraf@suse.de> Signed-off-by: Avi Kivity <avi@redhat.com>
f | dcr.h | s | 2.7K | 66 | Grant Erickson | gerickson@nuovations.com | 1229829676 |  | powerpc: Const-qualify Device Node Argument to DCR Resource Extent API  Add const qualifier to device_node argument for dcr_resource_{start,len} as of_get_property also const-qualifies this argument.  Signed-off-by: Grant Erickson <gerickson@nuovations.com> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | signal.h | s | 3.4K | 128 | Arnd Bergmann | arnd@arndb.de | 1244746912 |  | asm-generic: rename termios.h, signal.h and mman.h  The existing asm-generic versions are incomplete and included by some architectures. New architectures should be able to use a generic version, so rename the existing files and change all users, which lets us add the new files.  Signed-off-by: Remis Lima Baima <remis.developer@googlemail.com> Signed-off-by: Arnd Bergmann <arnd@arndb.de>
f | uic.h | s | 616B | 18 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | hvcall.h | s | 12K | 358 | Linus Torvalds | torvalds@linux-foundation.org | 1337901450 |  | Merge branch 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm  Pull KVM changes from Avi Kivity:  "Changes include additional instruction emulation, page-crossing MMIO,   faster dirty logging, preventing the watchdog from killing a stopped   guest, module autoload, a new MSI ABI, and some minor optimizations   and fixes.  Outside x86 we have a small s390 and a very large ppc   update.    Regarding the new (for kvm) rebaseless workflow, some of the patches   that were merged before we switch trees had to be rebased, while   others are true pulls.  In either case the signoffs should be correct   now."  Fix up trivial conflicts in Documentation/feature-removal-schedule.txt arch/powerpc/kvm/book3s_segment.S and arch/x86/include/asm/kvm_para.h.  I suspect the kvm_para.h resolution ends up doing the "do I have cpuid" check effectively twice (it was done differently in two different commits), but better safe than sorry ;)  * 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm: (125 commits)   KVM: make asm-generic/kvm_para.h have an ifdef __KERNEL__ block   KVM: s390: onereg for timer related registers   KVM: s390: epoch difference and TOD programmable field   KVM: s390: KVM_GET/SET_ONEREG for s390   KVM: s390: add capability indicating COW support   KVM: Fix mmu_reload() clash with nested vmx event injection   KVM: MMU: Don't use RCU for lockless shadow walking   KVM: VMX: Optimize %ds, %es reload   KVM: VMX: Fix %ds/%es clobber   KVM: x86 emulator: convert bsf/bsr instructions to emulate_2op_SrcV_nobyte()   KVM: VMX: unlike vmcs on fail path   KVM: PPC: Emulator: clean up SPR reads and writes   KVM: PPC: Emulator: clean up instruction parsing   kvm/powerpc: Add new ioctl to retreive server MMU infos   kvm/book3s: Make kernel emulated H_PUT_TCE available for "PR" KVM   KVM: PPC: bookehv: Fix r8/r13 storing in level exception handler   KVM: PPC: Book3S: Enable IRQs during exit handling   KVM: PPC: Fix PR KVM on POWER7 bare metal   KVM: PPC: Fix stbux emulation   KVM: PPC: bookehv: Use lwz/stw instead of PPC_LL/PPC_STL for 32-bit fields   ...
f | mmu-book3e.h | s | 8.7K | 253 | Scott Wood | scottwood@freescale.com | 1333878679 |  | KVM: PPC: booke: category E.HV (GS-mode) support  Chips such as e500mc that implement category E.HV in Power ISA 2.06 provide hardware virtualization features, including a new MSR mode for guest state.  The guest OS can perform many operations without trapping into the hypervisor, including transitions to and from guest userspace.  Since we can use SRR1[GS] to reliably tell whether an exception came from guest state, instead of messing around with IVPR, we use DO_KVM similarly to book3s.  Current issues include:  - Machine checks from guest state are not routed to the host handler.  - The guest can cause a host oops by executing an emulated instruction    in a page that lacks read permission.  Existing e500/4xx support has    the same problem.  Includes work by Ashish Kalra <Ashish.Kalra@freescale.com>, Varun Sethi <Varun.Sethi@freescale.com>, and Liu Yu <yu.liu@freescale.com>.  Signed-off-by: Scott Wood <scottwood@freescale.com> [agraf: remove pt_regs usage] Signed-off-by: Alexander Graf <agraf@suse.de> Signed-off-by: Avi Kivity <avi@redhat.com>
f | reg_fsl_emb.h | s | 2.8K | 60 | Scott Wood | scottwood@freescale.com | 1267779848 |  | powerpc/perf: e500 support  This implements perf_event support for the Freescale embedded performance monitor, based on the existing perf_event.c that supports server/classic chips.  Some limitations: - Performance monitor interrupts are regular EE interrupts, and thus you   can't profile places with interrupts disabled.  We may want to implement   soft IRQ-disabling, with perfmon interrupts exempted and treated as NMIs. - When trying to schedule multiple event groups at once, and using   restricted events, situations could arise where scheduling fails even   though it would be possible.  Consider three groups, each with two events.   One group has restricted events, the others don't.  The two non-restricted   groups are scheduled, then one is removed, which happens to occupy the two   counters that can't do restricted events.  The remaining non-restricted   group will not be moved to the non-restricted-capable counters to make   room if the restricted group tries to be scheduled.  Signed-off-by: Scott Wood <scottwood@freescale.com> Acked-by: Paul Mackerras <paulus@samba.org> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | mman.h | s | 2.1K | 52 | Arnd Bergmann | arnd@arndb.de | 1253629061 |  | mm: add MAP_HUGETLB for mmaping pseudo-anonymous huge page regions  Add a flag for mmap that will be used to request a huge page region that will look like anonymous memory to user space.  This is accomplished by using a file on the internal vfsmount.  MAP_HUGETLB is a modifier of MAP_ANONYMOUS and so must be specified with it.  The region will behave the same as a MAP_ANONYMOUS region using small pages.  The patch also adds the MAP_STACK flag, which was previously defined only on some architectures but not on others.  Since MAP_STACK is meant to be a hint only, architectures can define it without assigning a specific meaning to it.  Signed-off-by: Arnd Bergmann <arnd@arndb.de> Cc: Eric B Munson <ebmunson@us.ibm.com> Cc: Hugh Dickins <hugh.dickins@tiscali.co.uk> Cc: David Rientjes <rientjes@google.com> Cc: <linux-arch@vger.kernel.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | reg_booke.h | s | 33K | 660 | Linus Torvalds | torvalds@linux-foundation.org | 1337901450 |  | Merge branch 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm  Pull KVM changes from Avi Kivity:  "Changes include additional instruction emulation, page-crossing MMIO,   faster dirty logging, preventing the watchdog from killing a stopped   guest, module autoload, a new MSI ABI, and some minor optimizations   and fixes.  Outside x86 we have a small s390 and a very large ppc   update.    Regarding the new (for kvm) rebaseless workflow, some of the patches   that were merged before we switch trees had to be rebased, while   others are true pulls.  In either case the signoffs should be correct   now."  Fix up trivial conflicts in Documentation/feature-removal-schedule.txt arch/powerpc/kvm/book3s_segment.S and arch/x86/include/asm/kvm_para.h.  I suspect the kvm_para.h resolution ends up doing the "do I have cpuid" check effectively twice (it was done differently in two different commits), but better safe than sorry ;)  * 'next' of git://git.kernel.org/pub/scm/virt/kvm/kvm: (125 commits)   KVM: make asm-generic/kvm_para.h have an ifdef __KERNEL__ block   KVM: s390: onereg for timer related registers   KVM: s390: epoch difference and TOD programmable field   KVM: s390: KVM_GET/SET_ONEREG for s390   KVM: s390: add capability indicating COW support   KVM: Fix mmu_reload() clash with nested vmx event injection   KVM: MMU: Don't use RCU for lockless shadow walking   KVM: VMX: Optimize %ds, %es reload   KVM: VMX: Fix %ds/%es clobber   KVM: x86 emulator: convert bsf/bsr instructions to emulate_2op_SrcV_nobyte()   KVM: VMX: unlike vmcs on fail path   KVM: PPC: Emulator: clean up SPR reads and writes   KVM: PPC: Emulator: clean up instruction parsing   kvm/powerpc: Add new ioctl to retreive server MMU infos   kvm/book3s: Make kernel emulated H_PUT_TCE available for "PR" KVM   KVM: PPC: bookehv: Fix r8/r13 storing in level exception handler   KVM: PPC: Book3S: Enable IRQs during exit handling   KVM: PPC: Fix PR KVM on POWER7 bare metal   KVM: PPC: Fix stbux emulation   KVM: PPC: bookehv: Use lwz/stw instead of PPC_LL/PPC_STL for 32-bit fields   ...
f | pgalloc-64.h | s | 4.0K | 115 | Mark Nelson | markn@au1.ibm.com | 1273128567 |  | powerpc/mm: Track backing pages allocated by vmemmap_populate()  We need to keep track of the backing pages that get allocated by vmemmap_populate() so that when we use kdump, the dump-capture kernel knows where these pages are.  We use a simple linked list of structures that contain the physical address of the backing page and corresponding virtual address to track the backing pages. To save space, we just use a pointer to the next struct vmemmap_backing. We can also do this because we never remove nodes.  We call the pointer "list" to be compatible with changes made to the crash utility.  vmemmap_populate() is called either at boot-time or on a memory hotplug operation. We don't have to worry about the boot-time calls because they will be inherently single-threaded, and for a memory hotplug operation vmemmap_populate() is called through: sparse_add_one_section()             ||             V kmalloc_section_memmap()             ||             V sparse_mem_map_populate()             ||             V vmemmap_populate() and in sparse_add_one_section() we're protected by pgdat_resize_lock(). So, we don't need a spinlock to protect the vmemmap_list.  We allocate space for the vmemmap_backing structs by allocating whole pages in vmemmap_list_alloc() and then handing out chunks of this to vmemmap_list_populate().  This means that we waste at most just under one page, but this keeps the code is simple.  Signed-off-by: Mark Nelson <markn@au1.ibm.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | rtc.h | s | 2.0K | 66 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | emergency-restart.h | s | 43B | 1 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | kvm_book3s_64.h | s | 6.2K | 208 | Paul Mackerras | paulus@samba.org | 1330951958 |  | KVM: PPC: Allow for read-only pages backing a Book3S HV guest  With this, if a guest does an H_ENTER with a read/write HPTE on a page which is currently read-only, we make the actual HPTE inserted be a read-only version of the HPTE.  We now intercept protection faults as well as HPTE not found faults, and for a protection fault we work out whether it should be reflected to the guest (e.g. because the guest HPTE didn't allow write access to usermode) or handled by switching to kernel context and calling kvmppc_book3s_hv_page_fault, which will then request write access to the page and update the actual HPTE.  Signed-off-by: Paul Mackerras <paulus@samba.org> Signed-off-by: Alexander Graf <agraf@suse.de> Signed-off-by: Avi Kivity <avi@redhat.com>
f | iommu.h | s | 4.7K | 121 | Stephen Rothwell | sfr@canb.auug.org.au | 1332894803 |  | powerpc: Random little legacy iSeries removal tidy ups  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | kgdb.h | s | 2.1K | 61 | Dongdong Deng | dongdong.deng@windriver.com | 1288376082 |  | kgdb,ppc: Individual register get/set for ppc  commit 534af1082329392bc29f6badf815e69ae2ae0f4c(kgdb,kdb: individual register set and and get API) introduce dbg_get_reg/dbg_set_reg API for individual register get and set.  This patch implement those APIs for ppc.  Signed-off-by: Dongdong Deng <dongdong.deng@windriver.com> Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
f | msgbuf.h | s | 980B | 30 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | cpm2.h | s | 48K | 1054 | Anton Vorontsov | avorontsov@ru.mvista.com | 1257997399 |  | powerpc/cpm: Move CPMFCR_* defines into cpm.h  The bits are generic to CPM devices, so let's move them to the common header file, so drivers won't need to privately reintroduce another bunch of the same bits (as we can't include cpm2.h header together with cpm1.h).  Signed-off-by: Anton Vorontsov <avorontsov@ru.mvista.com> Signed-off-by: Kumar Gala <galak@kernel.crashing.org>
f | dcr-native.h | s | 4.4K | 134 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1229829675 |  | powerpc/4xx: Extended DCR support v2  This adds supports to the "extended" DCR addressing via the indirect mfdcrx/mtdcrx instructions supported by some 4xx cores (440H6 and later).  I enabled the feature for now only on AMCC 460 chips.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Acked-by: Josh Boyer <jwboyer@linux.vnet.ibm.com> Acked-by: Kumar Gala <galak@kernel.crashing.org> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | pte-44x.h | s | 3.8K | 96 | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1251342771 |  | powerpc/mm: Cleanup handling of execute permission  This is an attempt at cleaning up a bit the way we handle execute permission on powerpc. _PAGE_HWEXEC is gone, _PAGE_EXEC is now only defined by CPUs that can do something with it, and the myriad of #ifdef's in the I$/D$ coherency code is reduced to 2 cases that hopefully should cover everything.  The logic on BookE is a little bit different than what it was though not by much. Since now, _PAGE_EXEC will be set by the generic code for executable pages, we need to filter out if they are unclean and recover it. However, I don't expect the code to be more bloated than it already was in that area due to that change.  I could boast that this brings proper enforcing of per-page execute permissions to all BookE and 40x but in fact, we've had that now for some time as a side effect of my previous rework in that area (and I didn't even know it :-) We would only enable execute permission if the page was cache clean and we would only cache clean it if we took and exec fault. Since we now enforce that the later only work if VM_EXEC is part of the VMA flags, we de-fact already enforce per-page execute permissions... Unless I missed something  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | sockios.h | s | 634B | 17 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | spinlock.h | s | 6.8K | 265 | Stephen Rothwell | sfr@canb.auug.org.au | 1332288972 |  | powerpc: Remove the remaining CONFIG_PPC_ISERIES pieces  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | byteorder.h | s | 405B | 10 | Harvey Harrison | harvey.harrison@gmail.com | 1231991810 |  | byteorder: make swab.h include asm/swab.h like a regular header  Add swab.h to kbuild.asm and remove the individual entries from each arch, mark as unifdef as some arches have some kernel-only bits inside.  Signed-off-by: Harvey Harrison <harvey.harrison@gmail.com> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | shmparam.h | s | 167B | 4 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | sembuf.h | s | 1.0K | 32 | Stephen Rothwell | sfr@canb.auug.org.au | 1217815320 |  | powerpc: Move include files to arch/powerpc/include/asm  from include/asm-powerpc.  This is the result of a  mkdir arch/powerpc/include/asm git mv include/asm-powerpc/* arch/powerpc/include/asm  Followed by a few documentation/comment fixups and a couple of places where <asm-powepc/...> was being used explicitly.  Of the latter only one was outside the arch code and it is a driver only built for powerpc.  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Paul Mackerras <paulus@samba.org>
