<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › ps3.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>ps3.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  PS3 platform declarations.</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 2006 Sony Computer Entertainment Inc.</span>
<span class="cm"> *  Copyright 2006 Sony Corp.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; version 2 of the License.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="cm"> */</span>

<span class="cp">#if !defined(_ASM_POWERPC_PS3_H)</span>
<span class="cp">#define _ASM_POWERPC_PS3_H</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &quot;cell-pmu.h&quot;</span>

<span class="k">union</span> <span class="n">ps3_firmware_version</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">raw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">pad</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">major</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">minor</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">rev</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">ps3_get_firmware_version</span><span class="p">(</span><span class="k">union</span> <span class="n">ps3_firmware_version</span> <span class="o">*</span><span class="n">v</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_compare_firmware_version</span><span class="p">(</span><span class="n">u16</span> <span class="n">major</span><span class="p">,</span> <span class="n">u16</span> <span class="n">minor</span><span class="p">,</span> <span class="n">u16</span> <span class="n">rev</span><span class="p">);</span>

<span class="cm">/* &#39;Other OS&#39; area */</span>

<span class="k">enum</span> <span class="n">ps3_param_av_multi_out</span> <span class="p">{</span>
	<span class="n">PS3_PARAM_AV_MULTI_OUT_NTSC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">PS3_PARAM_AV_MULTI_OUT_PAL_RGB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">PS3_PARAM_AV_MULTI_OUT_PAL_YCBCR</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">PS3_PARAM_AV_MULTI_OUT_SECAM</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ps3_param_av_multi_out</span> <span class="n">ps3_os_area_get_av_multi_out</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">extern</span> <span class="n">u64</span> <span class="n">ps3_os_area_get_rtc_diff</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ps3_os_area_set_rtc_diff</span><span class="p">(</span><span class="n">u64</span> <span class="n">rtc_diff</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">ps3_os_area_flash_ops</span> <span class="p">{</span>
	<span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">read</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="n">pos</span><span class="p">);</span>
	<span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">write</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">ps3_os_area_flash_register</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">ps3_os_area_flash_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">);</span>

<span class="cm">/* dma routines */</span>

<span class="k">enum</span> <span class="n">ps3_dma_page_size</span> <span class="p">{</span>
	<span class="n">PS3_DMA_4K</span> <span class="o">=</span> <span class="mi">12U</span><span class="p">,</span>
	<span class="n">PS3_DMA_64K</span> <span class="o">=</span> <span class="mi">16U</span><span class="p">,</span>
	<span class="n">PS3_DMA_1M</span> <span class="o">=</span> <span class="mi">20U</span><span class="p">,</span>
	<span class="n">PS3_DMA_16M</span> <span class="o">=</span> <span class="mi">24U</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ps3_dma_region_type</span> <span class="p">{</span>
	<span class="n">PS3_DMA_OTHER</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">PS3_DMA_INTERNAL</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ps3_dma_region_ops</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * struct ps3_dma_region - A per device dma state variables structure</span>
<span class="cm"> * @did: The HV device id.</span>
<span class="cm"> * @page_size: The ioc pagesize.</span>
<span class="cm"> * @region_type: The HV region type.</span>
<span class="cm"> * @bus_addr: The &#39;translated&#39; bus address of the region.</span>
<span class="cm"> * @len: The length in bytes of the region.</span>
<span class="cm"> * @offset: The offset from the start of memory of the region.</span>
<span class="cm"> * @ioid: The IOID of the device who owns this region</span>
<span class="cm"> * @chunk_list: Opaque variable used by the ioc page manager.</span>
<span class="cm"> * @region_ops: struct ps3_dma_region_ops - dma region operations</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">ps3_dma_region</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="cm">/* device variables */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">ps3_dma_region_ops</span> <span class="o">*</span><span class="n">region_ops</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ioid</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ps3_dma_page_size</span> <span class="n">page_size</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ps3_dma_region_type</span> <span class="n">region_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">;</span>

	<span class="cm">/* driver variables  (set by ps3_dma_region_create) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bus_addr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">list_head</span> <span class="n">head</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">chunk_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ps3_dma_region_ops</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">create</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ps3_dma_region</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">free</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ps3_dma_region</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">map</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ps3_dma_region</span> <span class="o">*</span><span class="p">,</span>
		   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">virt_addr</span><span class="p">,</span>
		   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">,</span>
		   <span class="n">dma_addr_t</span> <span class="o">*</span><span class="n">bus_addr</span><span class="p">,</span>
		   <span class="n">u64</span> <span class="n">iopte_pp</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">unmap</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ps3_dma_region</span> <span class="o">*</span><span class="p">,</span>
		     <span class="n">dma_addr_t</span> <span class="n">bus_addr</span><span class="p">,</span>
		     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">);</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * struct ps3_dma_region_init - Helper to initialize structure variables</span>
<span class="cm"> *</span>
<span class="cm"> * Helper to properly initialize variables prior to calling</span>
<span class="cm"> * ps3_system_bus_device_register.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">ps3_system_bus_device</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">ps3_dma_region_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">ps3_dma_region</span> <span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="k">enum</span> <span class="n">ps3_dma_page_size</span> <span class="n">page_size</span><span class="p">,</span>
	<span class="k">enum</span> <span class="n">ps3_dma_region_type</span> <span class="n">region_type</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_dma_region_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_dma_region</span> <span class="o">*</span><span class="n">r</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_dma_region_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_dma_region</span> <span class="o">*</span><span class="n">r</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_dma_map</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_dma_region</span> <span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">virt_addr</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">,</span> <span class="n">dma_addr_t</span> <span class="o">*</span><span class="n">bus_addr</span><span class="p">,</span>
	<span class="n">u64</span> <span class="n">iopte_pp</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_dma_unmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_dma_region</span> <span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">dma_addr_t</span> <span class="n">bus_addr</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/* mmio routines */</span>

<span class="k">enum</span> <span class="n">ps3_mmio_page_size</span> <span class="p">{</span>
	<span class="n">PS3_MMIO_4K</span> <span class="o">=</span> <span class="mi">12U</span><span class="p">,</span>
	<span class="n">PS3_MMIO_64K</span> <span class="o">=</span> <span class="mi">16U</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ps3_mmio_region_ops</span><span class="p">;</span>
<span class="cm">/**</span>
<span class="cm"> * struct ps3_mmio_region - a per device mmio state variables structure</span>
<span class="cm"> *</span>
<span class="cm"> * Current systems can be supported with a single region per device.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">ps3_mmio_region</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">ps3_mmio_region_ops</span> <span class="o">*</span><span class="n">mmio_ops</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bus_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ps3_mmio_page_size</span> <span class="n">page_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">lpar_addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ps3_mmio_region_ops</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">create</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ps3_mmio_region</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">free</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ps3_mmio_region</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>
<span class="cm">/**</span>
<span class="cm"> * struct ps3_mmio_region_init - Helper to initialize structure variables</span>
<span class="cm"> *</span>
<span class="cm"> * Helper to properly initialize variables prior to calling</span>
<span class="cm"> * ps3_system_bus_device_register.</span>
<span class="cm"> */</span>

<span class="kt">int</span> <span class="n">ps3_mmio_region_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">ps3_mmio_region</span> <span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bus_addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">,</span>
	<span class="k">enum</span> <span class="n">ps3_mmio_page_size</span> <span class="n">page_size</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_mmio_region_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_mmio_region</span> <span class="o">*</span><span class="n">r</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_free_mmio_region</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_mmio_region</span> <span class="o">*</span><span class="n">r</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ps3_mm_phys_to_lpar</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys_addr</span><span class="p">);</span>

<span class="cm">/* inrerrupt routines */</span>

<span class="k">enum</span> <span class="n">ps3_cpu_binding</span> <span class="p">{</span>
	<span class="n">PS3_BINDING_CPU_ANY</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">PS3_BINDING_CPU_0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">PS3_BINDING_CPU_1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">ps3_irq_plug_setup</span><span class="p">(</span><span class="k">enum</span> <span class="n">ps3_cpu_binding</span> <span class="n">cpu</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">outlet</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">virq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_irq_plug_destroy</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">virq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_event_receive_port_setup</span><span class="p">(</span><span class="k">enum</span> <span class="n">ps3_cpu_binding</span> <span class="n">cpu</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">virq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_event_receive_port_destroy</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">virq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_send_event_locally</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">virq</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ps3_io_irq_setup</span><span class="p">(</span><span class="k">enum</span> <span class="n">ps3_cpu_binding</span> <span class="n">cpu</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">interrupt_id</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">virq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_io_irq_destroy</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">virq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_vuart_irq_setup</span><span class="p">(</span><span class="k">enum</span> <span class="n">ps3_cpu_binding</span> <span class="n">cpu</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">virt_addr_bmp</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">virq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_vuart_irq_destroy</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">virq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_spe_irq_setup</span><span class="p">(</span><span class="k">enum</span> <span class="n">ps3_cpu_binding</span> <span class="n">cpu</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">spe_id</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">class</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">virq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_spe_irq_destroy</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">virq</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ps3_sb_event_receive_port_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">enum</span> <span class="n">ps3_cpu_binding</span> <span class="n">cpu</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">virq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_sb_event_receive_port_destroy</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">virq</span><span class="p">);</span>

<span class="cm">/* lv1 result codes */</span>

<span class="k">enum</span> <span class="n">lv1_result</span> <span class="p">{</span>
	<span class="n">LV1_SUCCESS</span>                     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="cm">/* not used                       -1 */</span>
	<span class="n">LV1_RESOURCE_SHORTAGE</span>           <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
	<span class="n">LV1_NO_PRIVILEGE</span>                <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>
	<span class="n">LV1_DENIED_BY_POLICY</span>            <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span>
	<span class="n">LV1_ACCESS_VIOLATION</span>            <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span>
	<span class="n">LV1_NO_ENTRY</span>                    <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span>
	<span class="n">LV1_DUPLICATE_ENTRY</span>             <span class="o">=</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span>
	<span class="n">LV1_TYPE_MISMATCH</span>               <span class="o">=</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span>
	<span class="n">LV1_BUSY</span>                        <span class="o">=</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span>
	<span class="n">LV1_EMPTY</span>                       <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span>
	<span class="n">LV1_WRONG_STATE</span>                 <span class="o">=</span> <span class="o">-</span><span class="mi">11</span><span class="p">,</span>
	<span class="cm">/* not used                       -12 */</span>
	<span class="n">LV1_NO_MATCH</span>                    <span class="o">=</span> <span class="o">-</span><span class="mi">13</span><span class="p">,</span>
	<span class="n">LV1_ALREADY_CONNECTED</span>           <span class="o">=</span> <span class="o">-</span><span class="mi">14</span><span class="p">,</span>
	<span class="n">LV1_UNSUPPORTED_PARAMETER_VALUE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span>
	<span class="n">LV1_CONDITION_NOT_SATISFIED</span>     <span class="o">=</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span>
	<span class="n">LV1_ILLEGAL_PARAMETER_VALUE</span>     <span class="o">=</span> <span class="o">-</span><span class="mi">17</span><span class="p">,</span>
	<span class="n">LV1_BAD_OPTION</span>                  <span class="o">=</span> <span class="o">-</span><span class="mi">18</span><span class="p">,</span>
	<span class="n">LV1_IMPLEMENTATION_LIMITATION</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">19</span><span class="p">,</span>
	<span class="n">LV1_NOT_IMPLEMENTED</span>             <span class="o">=</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span>
	<span class="n">LV1_INVALID_CLASS_ID</span>            <span class="o">=</span> <span class="o">-</span><span class="mi">21</span><span class="p">,</span>
	<span class="n">LV1_CONSTRAINT_NOT_SATISFIED</span>    <span class="o">=</span> <span class="o">-</span><span class="mi">22</span><span class="p">,</span>
	<span class="n">LV1_ALIGNMENT_ERROR</span>             <span class="o">=</span> <span class="o">-</span><span class="mi">23</span><span class="p">,</span>
	<span class="n">LV1_HARDWARE_ERROR</span>              <span class="o">=</span> <span class="o">-</span><span class="mi">24</span><span class="p">,</span>
	<span class="n">LV1_INVALID_DATA_FORMAT</span>         <span class="o">=</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span>
	<span class="n">LV1_INVALID_OPERATION</span>           <span class="o">=</span> <span class="o">-</span><span class="mi">26</span><span class="p">,</span>
	<span class="n">LV1_INTERNAL_ERROR</span>              <span class="o">=</span> <span class="o">-</span><span class="mi">32768</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">ps3_result</span><span class="p">(</span><span class="kt">int</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if defined(DEBUG)</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">LV1_SUCCESS</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_SUCCESS (0)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="o">-</span><span class="mi">1</span>:
		<span class="k">return</span> <span class="s">&quot;** unknown result ** (-1)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_RESOURCE_SHORTAGE</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_RESOURCE_SHORTAGE (-2)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_NO_PRIVILEGE</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_NO_PRIVILEGE (-3)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_DENIED_BY_POLICY</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_DENIED_BY_POLICY (-4)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_ACCESS_VIOLATION</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_ACCESS_VIOLATION (-5)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_NO_ENTRY</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_NO_ENTRY (-6)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_DUPLICATE_ENTRY</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_DUPLICATE_ENTRY (-7)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_TYPE_MISMATCH</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_TYPE_MISMATCH (-8)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_BUSY</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_BUSY (-9)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_EMPTY</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_EMPTY (-10)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_WRONG_STATE</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_WRONG_STATE (-11)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="o">-</span><span class="mi">12</span>:
		<span class="k">return</span> <span class="s">&quot;** unknown result ** (-12)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_NO_MATCH</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_NO_MATCH (-13)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_ALREADY_CONNECTED</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_ALREADY_CONNECTED (-14)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_UNSUPPORTED_PARAMETER_VALUE</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_UNSUPPORTED_PARAMETER_VALUE (-15)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_CONDITION_NOT_SATISFIED</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_CONDITION_NOT_SATISFIED (-16)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_ILLEGAL_PARAMETER_VALUE</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_ILLEGAL_PARAMETER_VALUE (-17)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_BAD_OPTION</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_BAD_OPTION (-18)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_IMPLEMENTATION_LIMITATION</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_IMPLEMENTATION_LIMITATION (-19)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_NOT_IMPLEMENTED</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_NOT_IMPLEMENTED (-20)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_INVALID_CLASS_ID</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_INVALID_CLASS_ID (-21)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_CONSTRAINT_NOT_SATISFIED</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_CONSTRAINT_NOT_SATISFIED (-22)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_ALIGNMENT_ERROR</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_ALIGNMENT_ERROR (-23)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_HARDWARE_ERROR</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_HARDWARE_ERROR (-24)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_INVALID_DATA_FORMAT</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_INVALID_DATA_FORMAT (-25)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_INVALID_OPERATION</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_INVALID_OPERATION (-26)&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LV1_INTERNAL_ERROR</span>:
		<span class="k">return</span> <span class="s">&quot;LV1_INTERNAL_ERROR (-32768)&quot;</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">BUG</span><span class="p">();</span>
		<span class="k">return</span> <span class="s">&quot;** unknown result **&quot;</span><span class="p">;</span>
	<span class="p">};</span>
<span class="cp">#else</span>
	<span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cm">/* system bus routines */</span>

<span class="k">enum</span> <span class="n">ps3_match_id</span> <span class="p">{</span>
	<span class="n">PS3_MATCH_ID_EHCI</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">PS3_MATCH_ID_OHCI</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">PS3_MATCH_ID_GELIC</span>		<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">PS3_MATCH_ID_AV_SETTINGS</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">PS3_MATCH_ID_SYSTEM_MANAGER</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">PS3_MATCH_ID_STOR_DISK</span>		<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">PS3_MATCH_ID_STOR_ROM</span>		<span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">PS3_MATCH_ID_STOR_FLASH</span>		<span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="n">PS3_MATCH_ID_SOUND</span>		<span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
	<span class="n">PS3_MATCH_ID_GPU</span>		<span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
	<span class="n">PS3_MATCH_ID_LPM</span>		<span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ps3_match_sub_id</span> <span class="p">{</span>
	<span class="n">PS3_MATCH_SUB_ID_GPU_FB</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">PS3_MATCH_SUB_ID_GPU_RAMDISK</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define PS3_MODULE_ALIAS_EHCI		&quot;ps3:1:0&quot;</span>
<span class="cp">#define PS3_MODULE_ALIAS_OHCI		&quot;ps3:2:0&quot;</span>
<span class="cp">#define PS3_MODULE_ALIAS_GELIC		&quot;ps3:3:0&quot;</span>
<span class="cp">#define PS3_MODULE_ALIAS_AV_SETTINGS	&quot;ps3:4:0&quot;</span>
<span class="cp">#define PS3_MODULE_ALIAS_SYSTEM_MANAGER	&quot;ps3:5:0&quot;</span>
<span class="cp">#define PS3_MODULE_ALIAS_STOR_DISK	&quot;ps3:6:0&quot;</span>
<span class="cp">#define PS3_MODULE_ALIAS_STOR_ROM	&quot;ps3:7:0&quot;</span>
<span class="cp">#define PS3_MODULE_ALIAS_STOR_FLASH	&quot;ps3:8:0&quot;</span>
<span class="cp">#define PS3_MODULE_ALIAS_SOUND		&quot;ps3:9:0&quot;</span>
<span class="cp">#define PS3_MODULE_ALIAS_GPU_FB		&quot;ps3:10:1&quot;</span>
<span class="cp">#define PS3_MODULE_ALIAS_GPU_RAMDISK	&quot;ps3:10:2&quot;</span>
<span class="cp">#define PS3_MODULE_ALIAS_LPM		&quot;ps3:11:0&quot;</span>

<span class="k">enum</span> <span class="n">ps3_system_bus_device_type</span> <span class="p">{</span>
	<span class="n">PS3_DEVICE_TYPE_IOC0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">PS3_DEVICE_TYPE_SB</span><span class="p">,</span>
	<span class="n">PS3_DEVICE_TYPE_VUART</span><span class="p">,</span>
	<span class="n">PS3_DEVICE_TYPE_LPM</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct ps3_system_bus_device - a device on the system bus</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">ps3_match_id</span> <span class="n">match_id</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ps3_match_sub_id</span> <span class="n">match_sub_id</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ps3_system_bus_device_type</span> <span class="n">dev_type</span><span class="p">;</span>

	<span class="n">u64</span> <span class="n">bus_id</span><span class="p">;</span>                       <span class="cm">/* SB */</span>
	<span class="n">u64</span> <span class="n">dev_id</span><span class="p">;</span>                       <span class="cm">/* SB */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">interrupt_id</span><span class="p">;</span>        <span class="cm">/* SB */</span>
	<span class="k">struct</span> <span class="n">ps3_dma_region</span> <span class="o">*</span><span class="n">d_region</span><span class="p">;</span>  <span class="cm">/* SB, IOC0 */</span>
	<span class="k">struct</span> <span class="n">ps3_mmio_region</span> <span class="o">*</span><span class="n">m_region</span><span class="p">;</span> <span class="cm">/* SB, IOC0*/</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">port_number</span><span class="p">;</span>         <span class="cm">/* VUART */</span>
	<span class="k">struct</span> <span class="p">{</span>                          <span class="cm">/* LPM */</span>
		<span class="n">u64</span> <span class="n">node_id</span><span class="p">;</span>
		<span class="n">u64</span> <span class="n">pu_id</span><span class="p">;</span>
		<span class="n">u64</span> <span class="n">rights</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">lpm</span><span class="p">;</span>

<span class="cm">/*	struct iommu_table *iommu_table; -- waiting for BenH&#39;s cleanups */</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="n">core</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">driver_priv</span><span class="p">;</span> <span class="cm">/* private driver variables */</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">ps3_open_hv_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_close_hv_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * struct ps3_system_bus_driver - a driver for a device on the system bus</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">ps3_system_bus_driver</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">ps3_match_id</span> <span class="n">match_id</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ps3_match_sub_id</span> <span class="n">match_sub_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_driver</span> <span class="n">core</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">probe</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">remove</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">shutdown</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="p">);</span>
<span class="cm">/*	int (*suspend)(struct ps3_system_bus_device *, pm_message_t); */</span>
<span class="cm">/*	int (*resume)(struct ps3_system_bus_device *); */</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">ps3_system_bus_device_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_system_bus_driver_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_system_bus_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_system_bus_driver_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_system_bus_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">ps3_system_bus_driver</span> <span class="o">*</span><span class="nf">ps3_drv_to_system_bus_drv</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">device_driver</span> <span class="o">*</span><span class="n">_drv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">_drv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ps3_system_bus_driver</span><span class="p">,</span> <span class="n">core</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="nf">ps3_dev_to_system_bus_dev</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">_dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ps3_system_bus_device</span><span class="p">,</span> <span class="n">core</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">ps3_system_bus_driver</span> <span class="o">*</span>
	<span class="nf">ps3_system_bus_dev_to_system_bus_drv</span><span class="p">(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">_dev</span><span class="p">);</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">_dev</span><span class="o">-&gt;</span><span class="n">core</span><span class="p">.</span><span class="n">driver</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ps3_drv_to_system_bus_drv</span><span class="p">(</span><span class="n">_dev</span><span class="o">-&gt;</span><span class="n">core</span><span class="p">.</span><span class="n">driver</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * ps3_system_bus_set_drvdata -</span>
<span class="cm"> * @dev: device structure</span>
<span class="cm"> * @data: Data to set</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ps3_system_bus_set_drvdata</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dev_set_drvdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">core</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">ps3_system_bus_get_drvdata</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dev_get_drvdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">core</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* These two need global scope for get_dma_ops(). */</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">bus_type</span> <span class="n">ps3_system_bus_type</span><span class="p">;</span>

<span class="cm">/* system manager */</span>

<span class="k">struct</span> <span class="n">ps3_sys_manager_ops</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">power_off</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">restart</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ps3_system_bus_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">ps3_sys_manager_register_ops</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">ps3_sys_manager_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__noreturn</span> <span class="n">ps3_sys_manager_power_off</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__noreturn</span> <span class="n">ps3_sys_manager_restart</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__noreturn</span> <span class="n">ps3_sys_manager_halt</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_sys_manager_get_wol</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_sys_manager_set_wol</span><span class="p">(</span><span class="kt">int</span> <span class="n">state</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">ps3_prealloc</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">address</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">align</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">ps3_prealloc</span> <span class="n">ps3fb_videomemory</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ps3_prealloc</span> <span class="n">ps3flash_bounce_buffer</span><span class="p">;</span>

<span class="cm">/* logical performance monitor */</span>

<span class="cm">/**</span>
<span class="cm"> * enum ps3_lpm_rights - Rigths granted by the system policy module.</span>
<span class="cm"> *</span>
<span class="cm"> * @PS3_LPM_RIGHTS_USE_LPM: The right to use the lpm.</span>
<span class="cm"> * @PS3_LPM_RIGHTS_USE_TB: The right to use the internal trace buffer.</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="n">ps3_lpm_rights</span> <span class="p">{</span>
	<span class="n">PS3_LPM_RIGHTS_USE_LPM</span> <span class="o">=</span> <span class="mh">0x001</span><span class="p">,</span>
	<span class="n">PS3_LPM_RIGHTS_USE_TB</span> <span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * enum ps3_lpm_tb_type - Type of trace buffer lv1 should use.</span>
<span class="cm"> *</span>
<span class="cm"> * @PS3_LPM_TB_TYPE_NONE: Do not use a trace buffer.</span>
<span class="cm"> * @PS3_LPM_RIGHTS_USE_TB: Use the lv1 internal trace buffer.  Must have</span>
<span class="cm"> *  rights @PS3_LPM_RIGHTS_USE_TB.</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="n">ps3_lpm_tb_type</span> <span class="p">{</span>
	<span class="n">PS3_LPM_TB_TYPE_NONE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">PS3_LPM_TB_TYPE_INTERNAL</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">ps3_lpm_open</span><span class="p">(</span><span class="k">enum</span> <span class="n">ps3_lpm_tb_type</span> <span class="n">tb_type</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">tb_cache</span><span class="p">,</span>
	<span class="n">u64</span> <span class="n">tb_cache_size</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_lpm_close</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_lpm_copy_tb</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">bytes_copied</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_lpm_copy_tb_to_user</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">bytes_copied</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_set_bookmark</span><span class="p">(</span><span class="n">u64</span> <span class="n">bookmark</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_set_pm_bookmark</span><span class="p">(</span><span class="n">u64</span> <span class="n">tag</span><span class="p">,</span> <span class="n">u64</span> <span class="n">incident</span><span class="p">,</span> <span class="n">u64</span> <span class="n">th_id</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ps3_set_signal</span><span class="p">(</span><span class="n">u64</span> <span class="n">rtas_signal_group</span><span class="p">,</span> <span class="n">u8</span> <span class="n">signal_bit</span><span class="p">,</span> <span class="n">u16</span> <span class="n">sub_unit</span><span class="p">,</span>
	<span class="n">u8</span> <span class="n">bus_word</span><span class="p">);</span>

<span class="n">u32</span> <span class="n">ps3_read_phys_ctr</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">u32</span> <span class="n">phys_ctr</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_write_phys_ctr</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">u32</span> <span class="n">phys_ctr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">);</span>
<span class="n">u32</span> <span class="n">ps3_read_ctr</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">u32</span> <span class="n">ctr</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_write_ctr</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">u32</span> <span class="n">ctr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">);</span>

<span class="n">u32</span> <span class="n">ps3_read_pm07_control</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">u32</span> <span class="n">ctr</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_write_pm07_control</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">u32</span> <span class="n">ctr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">);</span>
<span class="n">u32</span> <span class="n">ps3_read_pm</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">,</span> <span class="k">enum</span> <span class="n">pm_reg_name</span> <span class="n">reg</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_write_pm</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">,</span> <span class="k">enum</span> <span class="n">pm_reg_name</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">);</span>

<span class="n">u32</span> <span class="n">ps3_get_ctr_size</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">u32</span> <span class="n">phys_ctr</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_set_ctr_size</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">u32</span> <span class="n">phys_ctr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">ctr_size</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">ps3_enable_pm</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_disable_pm</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_enable_pm_interrupts</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">u32</span> <span class="kr">thread</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_disable_pm_interrupts</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">);</span>

<span class="n">u32</span> <span class="n">ps3_get_and_clear_pm_interrupts</span><span class="p">(</span><span class="n">u32</span> <span class="n">cpu</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ps3_sync_irq</span><span class="p">(</span><span class="kt">int</span> <span class="n">node</span><span class="p">);</span>
<span class="n">u32</span> <span class="n">ps3_get_hw_thread_id</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpu</span><span class="p">);</span>
<span class="n">u64</span> <span class="n">ps3_get_spe_id</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
