<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › hvcall.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>hvcall.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_POWERPC_HVCALL_H</span>
<span class="cp">#define _ASM_POWERPC_HVCALL_H</span>
<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#define HVSC			.long 0x44000022</span>

<span class="cp">#define H_SUCCESS	0</span>
<span class="cp">#define H_BUSY		1	</span><span class="cm">/* Hardware busy -- retry later */</span><span class="cp"></span>
<span class="cp">#define H_CLOSED	2	</span><span class="cm">/* Resource closed */</span><span class="cp"></span>
<span class="cp">#define H_NOT_AVAILABLE 3</span>
<span class="cp">#define H_CONSTRAINED	4	</span><span class="cm">/* Resource request constrained to max allowed */</span><span class="cp"></span>
<span class="cp">#define H_PARTIAL       5</span>
<span class="cp">#define H_IN_PROGRESS	14	</span><span class="cm">/* Kind of like busy */</span><span class="cp"></span>
<span class="cp">#define H_PAGE_REGISTERED 15</span>
<span class="cp">#define H_PARTIAL_STORE   16</span>
<span class="cp">#define H_PENDING	17	</span><span class="cm">/* returned from H_POLL_PENDING */</span><span class="cp"></span>
<span class="cp">#define H_CONTINUE	18	</span><span class="cm">/* Returned from H_Join on success */</span><span class="cp"></span>
<span class="cp">#define H_LONG_BUSY_START_RANGE		9900  </span><span class="cm">/* Start of long busy range */</span><span class="cp"></span>
<span class="cp">#define H_LONG_BUSY_ORDER_1_MSEC	9900  </span><span class="cm">/* Long busy, hint that 1msec \</span>
<span class="cm">						 is a good time to retry */</span><span class="cp"></span>
<span class="cp">#define H_LONG_BUSY_ORDER_10_MSEC	9901  </span><span class="cm">/* Long busy, hint that 10msec \</span>
<span class="cm">						 is a good time to retry */</span><span class="cp"></span>
<span class="cp">#define H_LONG_BUSY_ORDER_100_MSEC 	9902  </span><span class="cm">/* Long busy, hint that 100msec \</span>
<span class="cm">						 is a good time to retry */</span><span class="cp"></span>
<span class="cp">#define H_LONG_BUSY_ORDER_1_SEC		9903  </span><span class="cm">/* Long busy, hint that 1sec \</span>
<span class="cm">						 is a good time to retry */</span><span class="cp"></span>
<span class="cp">#define H_LONG_BUSY_ORDER_10_SEC	9904  </span><span class="cm">/* Long busy, hint that 10sec \</span>
<span class="cm">						 is a good time to retry */</span><span class="cp"></span>
<span class="cp">#define H_LONG_BUSY_ORDER_100_SEC	9905  </span><span class="cm">/* Long busy, hint that 100sec \</span>
<span class="cm">						 is a good time to retry */</span><span class="cp"></span>
<span class="cp">#define H_LONG_BUSY_END_RANGE		9905  </span><span class="cm">/* End of long busy range */</span><span class="cp"></span>

<span class="cm">/* Internal value used in book3s_hv kvm support; not returned to guests */</span>
<span class="cp">#define H_TOO_HARD	9999</span>

<span class="cp">#define H_HARDWARE	-1	</span><span class="cm">/* Hardware error */</span><span class="cp"></span>
<span class="cp">#define H_FUNCTION	-2	</span><span class="cm">/* Function not supported */</span><span class="cp"></span>
<span class="cp">#define H_PRIVILEGE	-3	</span><span class="cm">/* Caller not privileged */</span><span class="cp"></span>
<span class="cp">#define H_PARAMETER	-4	</span><span class="cm">/* Parameter invalid, out-of-range or conflicting */</span><span class="cp"></span>
<span class="cp">#define H_BAD_MODE	-5	</span><span class="cm">/* Illegal msr value */</span><span class="cp"></span>
<span class="cp">#define H_PTEG_FULL	-6	</span><span class="cm">/* PTEG is full */</span><span class="cp"></span>
<span class="cp">#define H_NOT_FOUND	-7	</span><span class="cm">/* PTE was not found&quot; */</span><span class="cp"></span>
<span class="cp">#define H_RESERVED_DABR	-8	</span><span class="cm">/* DABR address is reserved by the hypervisor on this processor&quot; */</span><span class="cp"></span>
<span class="cp">#define H_NO_MEM	-9</span>
<span class="cp">#define H_AUTHORITY	-10</span>
<span class="cp">#define H_PERMISSION	-11</span>
<span class="cp">#define H_DROPPED	-12</span>
<span class="cp">#define H_SOURCE_PARM	-13</span>
<span class="cp">#define H_DEST_PARM	-14</span>
<span class="cp">#define H_REMOTE_PARM	-15</span>
<span class="cp">#define H_RESOURCE	-16</span>
<span class="cp">#define H_ADAPTER_PARM  -17</span>
<span class="cp">#define H_RH_PARM       -18</span>
<span class="cp">#define H_RCQ_PARM      -19</span>
<span class="cp">#define H_SCQ_PARM      -20</span>
<span class="cp">#define H_EQ_PARM       -21</span>
<span class="cp">#define H_RT_PARM       -22</span>
<span class="cp">#define H_ST_PARM       -23</span>
<span class="cp">#define H_SIGT_PARM     -24</span>
<span class="cp">#define H_TOKEN_PARM    -25</span>
<span class="cp">#define H_MLENGTH_PARM  -27</span>
<span class="cp">#define H_MEM_PARM      -28</span>
<span class="cp">#define H_MEM_ACCESS_PARM -29</span>
<span class="cp">#define H_ATTR_PARM     -30</span>
<span class="cp">#define H_PORT_PARM     -31</span>
<span class="cp">#define H_MCG_PARM      -32</span>
<span class="cp">#define H_VL_PARM       -33</span>
<span class="cp">#define H_TSIZE_PARM    -34</span>
<span class="cp">#define H_TRACE_PARM    -35</span>

<span class="cp">#define H_MASK_PARM     -37</span>
<span class="cp">#define H_MCG_FULL      -38</span>
<span class="cp">#define H_ALIAS_EXIST   -39</span>
<span class="cp">#define H_P_COUNTER     -40</span>
<span class="cp">#define H_TABLE_FULL    -41</span>
<span class="cp">#define H_ALT_TABLE     -42</span>
<span class="cp">#define H_MR_CONDITION  -43</span>
<span class="cp">#define H_NOT_ENOUGH_RESOURCES -44</span>
<span class="cp">#define H_R_STATE       -45</span>
<span class="cp">#define H_RESCINDED     -46</span>
<span class="cp">#define H_P2		-55</span>
<span class="cp">#define H_P3		-56</span>
<span class="cp">#define H_P4		-57</span>
<span class="cp">#define H_P5		-58</span>
<span class="cp">#define H_P6		-59</span>
<span class="cp">#define H_P7		-60</span>
<span class="cp">#define H_P8		-61</span>
<span class="cp">#define H_P9		-62</span>
<span class="cp">#define H_TOO_BIG	-64</span>
<span class="cp">#define H_OVERLAP	-68</span>
<span class="cp">#define H_INTERRUPT	-69</span>
<span class="cp">#define H_BAD_DATA	-70</span>
<span class="cp">#define H_NOT_ACTIVE	-71</span>
<span class="cp">#define H_SG_LIST	-72</span>
<span class="cp">#define H_OP_MODE	-73</span>
<span class="cp">#define H_COP_HW	-74</span>
<span class="cp">#define H_UNSUPPORTED_FLAG_START	-256</span>
<span class="cp">#define H_UNSUPPORTED_FLAG_END		-511</span>
<span class="cp">#define H_MULTI_THREADS_ACTIVE	-9005</span>
<span class="cp">#define H_OUTSTANDING_COP_OPS	-9006</span>


<span class="cm">/* Long Busy is a condition that can be returned by the firmware</span>
<span class="cm"> * when a call cannot be completed now, but the identical call</span>
<span class="cm"> * should be retried later.  This prevents calls blocking in the</span>
<span class="cm"> * firmware for long periods of time.  Annoyingly the firmware can return</span>
<span class="cm"> * a range of return codes, hinting at how long we should wait before</span>
<span class="cm"> * retrying.  If you don&#39;t care for the hint, the macro below is a good</span>
<span class="cm"> * way to check for the long_busy return codes</span>
<span class="cm"> */</span>
<span class="cp">#define H_IS_LONG_BUSY(x)  ((x &gt;= H_LONG_BUSY_START_RANGE) \</span>
<span class="cp">			     &amp;&amp; (x &lt;= H_LONG_BUSY_END_RANGE))</span>

<span class="cm">/* Flags */</span>
<span class="cp">#define H_LARGE_PAGE		(1UL&lt;&lt;(63-16))</span>
<span class="cp">#define H_EXACT			(1UL&lt;&lt;(63-24))	</span><span class="cm">/* Use exact PTE or return H_PTEG_FULL */</span><span class="cp"></span>
<span class="cp">#define H_R_XLATE		(1UL&lt;&lt;(63-25))	</span><span class="cm">/* include a valid logical page num in the pte if the valid bit is set */</span><span class="cp"></span>
<span class="cp">#define H_READ_4		(1UL&lt;&lt;(63-26))	</span><span class="cm">/* Return 4 PTEs */</span><span class="cp"></span>
<span class="cp">#define H_PAGE_STATE_CHANGE	(1UL&lt;&lt;(63-28))</span>
<span class="cp">#define H_PAGE_UNUSED		((1UL&lt;&lt;(63-29)) | (1UL&lt;&lt;(63-30)))</span>
<span class="cp">#define H_PAGE_SET_UNUSED	(H_PAGE_STATE_CHANGE | H_PAGE_UNUSED)</span>
<span class="cp">#define H_PAGE_SET_LOANED	(H_PAGE_SET_UNUSED | (1UL&lt;&lt;(63-31)))</span>
<span class="cp">#define H_PAGE_SET_ACTIVE	H_PAGE_STATE_CHANGE</span>
<span class="cp">#define H_AVPN			(1UL&lt;&lt;(63-32))	</span><span class="cm">/* An avpn is provided as a sanity test */</span><span class="cp"></span>
<span class="cp">#define H_ANDCOND		(1UL&lt;&lt;(63-33))</span>
<span class="cp">#define H_LOCAL			(1UL&lt;&lt;(63-35))</span>
<span class="cp">#define H_ICACHE_INVALIDATE	(1UL&lt;&lt;(63-40))	</span><span class="cm">/* icbi, etc.  (ignored for IO pages) */</span><span class="cp"></span>
<span class="cp">#define H_ICACHE_SYNCHRONIZE	(1UL&lt;&lt;(63-41))	</span><span class="cm">/* dcbst, icbi, etc (ignored for IO pages */</span><span class="cp"></span>
<span class="cp">#define H_COALESCE_CAND	(1UL&lt;&lt;(63-42))	</span><span class="cm">/* page is a good candidate for coalescing */</span><span class="cp"></span>
<span class="cp">#define H_ZERO_PAGE		(1UL&lt;&lt;(63-48))	</span><span class="cm">/* zero the page before mapping (ignored for IO pages) */</span><span class="cp"></span>
<span class="cp">#define H_COPY_PAGE		(1UL&lt;&lt;(63-49))</span>
<span class="cp">#define H_N			(1UL&lt;&lt;(63-61))</span>
<span class="cp">#define H_PP1			(1UL&lt;&lt;(63-62))</span>
<span class="cp">#define H_PP2			(1UL&lt;&lt;(63-63))</span>

<span class="cm">/* Flags for H_REGISTER_VPA subfunction field */</span>
<span class="cp">#define H_VPA_FUNC_SHIFT	(63-18)	</span><span class="cm">/* Bit posn of subfunction code */</span><span class="cp"></span>
<span class="cp">#define H_VPA_FUNC_MASK		7UL</span>
<span class="cp">#define H_VPA_REG_VPA		1UL	</span><span class="cm">/* Register Virtual Processor Area */</span><span class="cp"></span>
<span class="cp">#define H_VPA_REG_DTL		2UL	</span><span class="cm">/* Register Dispatch Trace Log */</span><span class="cp"></span>
<span class="cp">#define H_VPA_REG_SLB		3UL	</span><span class="cm">/* Register SLB shadow buffer */</span><span class="cp"></span>
<span class="cp">#define H_VPA_DEREG_VPA		5UL	</span><span class="cm">/* Deregister Virtual Processor Area */</span><span class="cp"></span>
<span class="cp">#define H_VPA_DEREG_DTL		6UL	</span><span class="cm">/* Deregister Dispatch Trace Log */</span><span class="cp"></span>
<span class="cp">#define H_VPA_DEREG_SLB		7UL	</span><span class="cm">/* Deregister SLB shadow buffer */</span><span class="cp"></span>

<span class="cm">/* VASI States */</span>
<span class="cp">#define H_VASI_INVALID          0</span>
<span class="cp">#define H_VASI_ENABLED          1</span>
<span class="cp">#define H_VASI_ABORTED          2</span>
<span class="cp">#define H_VASI_SUSPENDING       3</span>
<span class="cp">#define H_VASI_SUSPENDED        4</span>
<span class="cp">#define H_VASI_RESUMED          5</span>
<span class="cp">#define H_VASI_COMPLETED        6</span>

<span class="cm">/* DABRX flags */</span>
<span class="cp">#define H_DABRX_HYPERVISOR	(1UL&lt;&lt;(63-61))</span>
<span class="cp">#define H_DABRX_KERNEL		(1UL&lt;&lt;(63-62))</span>
<span class="cp">#define H_DABRX_USER		(1UL&lt;&lt;(63-63))</span>

<span class="cm">/* Each control block has to be on a 4K boundary */</span>
<span class="cp">#define H_CB_ALIGNMENT          4096</span>

<span class="cm">/* pSeries hypervisor opcodes */</span>
<span class="cp">#define H_REMOVE		0x04</span>
<span class="cp">#define H_ENTER			0x08</span>
<span class="cp">#define H_READ			0x0c</span>
<span class="cp">#define H_CLEAR_MOD		0x10</span>
<span class="cp">#define H_CLEAR_REF		0x14</span>
<span class="cp">#define H_PROTECT		0x18</span>
<span class="cp">#define H_GET_TCE		0x1c</span>
<span class="cp">#define H_PUT_TCE		0x20</span>
<span class="cp">#define H_SET_SPRG0		0x24</span>
<span class="cp">#define H_SET_DABR		0x28</span>
<span class="cp">#define H_PAGE_INIT		0x2c</span>
<span class="cp">#define H_SET_ASR		0x30</span>
<span class="cp">#define H_ASR_ON		0x34</span>
<span class="cp">#define H_ASR_OFF		0x38</span>
<span class="cp">#define H_LOGICAL_CI_LOAD	0x3c</span>
<span class="cp">#define H_LOGICAL_CI_STORE	0x40</span>
<span class="cp">#define H_LOGICAL_CACHE_LOAD	0x44</span>
<span class="cp">#define H_LOGICAL_CACHE_STORE	0x48</span>
<span class="cp">#define H_LOGICAL_ICBI		0x4c</span>
<span class="cp">#define H_LOGICAL_DCBF		0x50</span>
<span class="cp">#define H_GET_TERM_CHAR		0x54</span>
<span class="cp">#define H_PUT_TERM_CHAR		0x58</span>
<span class="cp">#define H_REAL_TO_LOGICAL	0x5c</span>
<span class="cp">#define H_HYPERVISOR_DATA	0x60</span>
<span class="cp">#define H_EOI			0x64</span>
<span class="cp">#define H_CPPR			0x68</span>
<span class="cp">#define H_IPI			0x6c</span>
<span class="cp">#define H_IPOLL			0x70</span>
<span class="cp">#define H_XIRR			0x74</span>
<span class="cp">#define H_PERFMON		0x7c</span>
<span class="cp">#define H_MIGRATE_DMA		0x78</span>
<span class="cp">#define H_REGISTER_VPA		0xDC</span>
<span class="cp">#define H_CEDE			0xE0</span>
<span class="cp">#define H_CONFER		0xE4</span>
<span class="cp">#define H_PROD			0xE8</span>
<span class="cp">#define H_GET_PPP		0xEC</span>
<span class="cp">#define H_SET_PPP		0xF0</span>
<span class="cp">#define H_PURR			0xF4</span>
<span class="cp">#define H_PIC			0xF8</span>
<span class="cp">#define H_REG_CRQ		0xFC</span>
<span class="cp">#define H_FREE_CRQ		0x100</span>
<span class="cp">#define H_VIO_SIGNAL		0x104</span>
<span class="cp">#define H_SEND_CRQ		0x108</span>
<span class="cp">#define H_COPY_RDMA		0x110</span>
<span class="cp">#define H_REGISTER_LOGICAL_LAN	0x114</span>
<span class="cp">#define H_FREE_LOGICAL_LAN	0x118</span>
<span class="cp">#define H_ADD_LOGICAL_LAN_BUFFER 0x11C</span>
<span class="cp">#define H_SEND_LOGICAL_LAN	0x120</span>
<span class="cp">#define H_BULK_REMOVE		0x124</span>
<span class="cp">#define H_MULTICAST_CTRL	0x130</span>
<span class="cp">#define H_SET_XDABR		0x134</span>
<span class="cp">#define H_STUFF_TCE		0x138</span>
<span class="cp">#define H_PUT_TCE_INDIRECT	0x13C</span>
<span class="cp">#define H_CHANGE_LOGICAL_LAN_MAC 0x14C</span>
<span class="cp">#define H_VTERM_PARTNER_INFO	0x150</span>
<span class="cp">#define H_REGISTER_VTERM	0x154</span>
<span class="cp">#define H_FREE_VTERM		0x158</span>
<span class="cp">#define H_RESET_EVENTS          0x15C</span>
<span class="cp">#define H_ALLOC_RESOURCE        0x160</span>
<span class="cp">#define H_FREE_RESOURCE         0x164</span>
<span class="cp">#define H_MODIFY_QP             0x168</span>
<span class="cp">#define H_QUERY_QP              0x16C</span>
<span class="cp">#define H_REREGISTER_PMR        0x170</span>
<span class="cp">#define H_REGISTER_SMR          0x174</span>
<span class="cp">#define H_QUERY_MR              0x178</span>
<span class="cp">#define H_QUERY_MW              0x17C</span>
<span class="cp">#define H_QUERY_HCA             0x180</span>
<span class="cp">#define H_QUERY_PORT            0x184</span>
<span class="cp">#define H_MODIFY_PORT           0x188</span>
<span class="cp">#define H_DEFINE_AQP1           0x18C</span>
<span class="cp">#define H_GET_TRACE_BUFFER      0x190</span>
<span class="cp">#define H_DEFINE_AQP0           0x194</span>
<span class="cp">#define H_RESIZE_MR             0x198</span>
<span class="cp">#define H_ATTACH_MCQP           0x19C</span>
<span class="cp">#define H_DETACH_MCQP           0x1A0</span>
<span class="cp">#define H_CREATE_RPT            0x1A4</span>
<span class="cp">#define H_REMOVE_RPT            0x1A8</span>
<span class="cp">#define H_REGISTER_RPAGES       0x1AC</span>
<span class="cp">#define H_DISABLE_AND_GETC      0x1B0</span>
<span class="cp">#define H_ERROR_DATA            0x1B4</span>
<span class="cp">#define H_GET_HCA_INFO          0x1B8</span>
<span class="cp">#define H_GET_PERF_COUNT        0x1BC</span>
<span class="cp">#define H_MANAGE_TRACE          0x1C0</span>
<span class="cp">#define H_FREE_LOGICAL_LAN_BUFFER 0x1D4</span>
<span class="cp">#define H_QUERY_INT_STATE       0x1E4</span>
<span class="cp">#define H_POLL_PENDING		0x1D8</span>
<span class="cp">#define H_ILLAN_ATTRIBUTES	0x244</span>
<span class="cp">#define H_MODIFY_HEA_QP		0x250</span>
<span class="cp">#define H_QUERY_HEA_QP		0x254</span>
<span class="cp">#define H_QUERY_HEA		0x258</span>
<span class="cp">#define H_QUERY_HEA_PORT	0x25C</span>
<span class="cp">#define H_MODIFY_HEA_PORT	0x260</span>
<span class="cp">#define H_REG_BCMC		0x264</span>
<span class="cp">#define H_DEREG_BCMC		0x268</span>
<span class="cp">#define H_REGISTER_HEA_RPAGES	0x26C</span>
<span class="cp">#define H_DISABLE_AND_GET_HEA	0x270</span>
<span class="cp">#define H_GET_HEA_INFO		0x274</span>
<span class="cp">#define H_ALLOC_HEA_RESOURCE	0x278</span>
<span class="cp">#define H_ADD_CONN		0x284</span>
<span class="cp">#define H_DEL_CONN		0x288</span>
<span class="cp">#define H_JOIN			0x298</span>
<span class="cp">#define H_VASI_STATE            0x2A4</span>
<span class="cp">#define H_ENABLE_CRQ		0x2B0</span>
<span class="cp">#define H_GET_EM_PARMS		0x2B8</span>
<span class="cp">#define H_SET_MPP		0x2D0</span>
<span class="cp">#define H_GET_MPP		0x2D4</span>
<span class="cp">#define H_HOME_NODE_ASSOCIATIVITY 0x2EC</span>
<span class="cp">#define H_BEST_ENERGY		0x2F4</span>
<span class="cp">#define H_RANDOM		0x300</span>
<span class="cp">#define H_COP			0x304</span>
<span class="cp">#define H_GET_MPP_X		0x314</span>
<span class="cp">#define MAX_HCALL_OPCODE	H_GET_MPP_X</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cm">/**</span>
<span class="cm"> * plpar_hcall_norets: - Make a pseries hypervisor call with no return arguments</span>
<span class="cm"> * @opcode: The hypervisor call to make.</span>
<span class="cm"> *</span>
<span class="cm"> * This call supports up to 7 arguments and only returns the status of</span>
<span class="cm"> * the hcall. Use this version where possible, its slightly faster than</span>
<span class="cm"> * the other plpar_hcalls.</span>
<span class="cm"> */</span>
<span class="kt">long</span> <span class="n">plpar_hcall_norets</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">opcode</span><span class="p">,</span> <span class="p">...);</span>

<span class="cm">/**</span>
<span class="cm"> * plpar_hcall: - Make a pseries hypervisor call</span>
<span class="cm"> * @opcode: The hypervisor call to make.</span>
<span class="cm"> * @retbuf: Buffer to store up to 4 return arguments in.</span>
<span class="cm"> *</span>
<span class="cm"> * This call supports up to 6 arguments and 4 return arguments. Use</span>
<span class="cm"> * PLPAR_HCALL_BUFSIZE to size the return argument buffer.</span>
<span class="cm"> *</span>
<span class="cm"> * Used for all but the craziest of phyp interfaces (see plpar_hcall9)</span>
<span class="cm"> */</span>
<span class="cp">#define PLPAR_HCALL_BUFSIZE 4</span>
<span class="kt">long</span> <span class="n">plpar_hcall</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">opcode</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">retbuf</span><span class="p">,</span> <span class="p">...);</span>

<span class="cm">/**</span>
<span class="cm"> * plpar_hcall_raw: - Make a hypervisor call without calculating hcall stats</span>
<span class="cm"> * @opcode: The hypervisor call to make.</span>
<span class="cm"> * @retbuf: Buffer to store up to 4 return arguments in.</span>
<span class="cm"> *</span>
<span class="cm"> * This call supports up to 6 arguments and 4 return arguments. Use</span>
<span class="cm"> * PLPAR_HCALL_BUFSIZE to size the return argument buffer.</span>
<span class="cm"> *</span>
<span class="cm"> * Used when phyp interface needs to be called in real mode. Similar to</span>
<span class="cm"> * plpar_hcall, but plpar_hcall_raw works in real mode and does not</span>
<span class="cm"> * calculate hypervisor call statistics.</span>
<span class="cm"> */</span>
<span class="kt">long</span> <span class="n">plpar_hcall_raw</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">opcode</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">retbuf</span><span class="p">,</span> <span class="p">...);</span>

<span class="cm">/**</span>
<span class="cm"> * plpar_hcall9: - Make a pseries hypervisor call with up to 9 return arguments</span>
<span class="cm"> * @opcode: The hypervisor call to make.</span>
<span class="cm"> * @retbuf: Buffer to store up to 9 return arguments in.</span>
<span class="cm"> *</span>
<span class="cm"> * This call supports up to 9 arguments and 9 return arguments. Use</span>
<span class="cm"> * PLPAR_HCALL9_BUFSIZE to size the return argument buffer.</span>
<span class="cm"> */</span>
<span class="cp">#define PLPAR_HCALL9_BUFSIZE 9</span>
<span class="kt">long</span> <span class="n">plpar_hcall9</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">opcode</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">retbuf</span><span class="p">,</span> <span class="p">...);</span>
<span class="kt">long</span> <span class="n">plpar_hcall9_raw</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">opcode</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">retbuf</span><span class="p">,</span> <span class="p">...);</span>

<span class="cm">/* For hcall instrumentation.  One structure per-hcall, per-CPU */</span>
<span class="k">struct</span> <span class="n">hcall_stats</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">num_calls</span><span class="p">;</span>	<span class="cm">/* number of calls (on this CPU) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">tb_total</span><span class="p">;</span>	<span class="cm">/* total wall time (mftb) of calls. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">purr_total</span><span class="p">;</span>	<span class="cm">/* total cpu time (PURR) of calls. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">tb_start</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">purr_start</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define HCALL_STAT_ARRAY_SIZE	((MAX_HCALL_OPCODE &gt;&gt; 2) + 1)</span>

<span class="k">struct</span> <span class="n">hvcall_mpp_data</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">entitled_mem</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mapped_mem</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">group_num</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">pool_num</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">mem_weight</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">unallocated_mem_weight</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">unallocated_entitlement</span><span class="p">;</span>  <span class="cm">/* value in bytes */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pool_size</span><span class="p">;</span>
	<span class="kt">signed</span> <span class="kt">long</span> <span class="n">loan_request</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">backing_mem</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">h_get_mpp</span><span class="p">(</span><span class="k">struct</span> <span class="n">hvcall_mpp_data</span> <span class="o">*</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">hvcall_mpp_x_data</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coalesced_bytes</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pool_coalesced_bytes</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pool_purr_cycles</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pool_spurr_cycles</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">h_get_mpp_x</span><span class="p">(</span><span class="k">struct</span> <span class="n">hvcall_mpp_x_data</span> <span class="o">*</span><span class="n">mpp_x_data</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_PPC_PSERIES</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">CMO_PrPSP</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">CMO_SecPSP</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">CMO_PageSize</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">cmo_get_primary_psp</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">CMO_PrPSP</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">cmo_get_secondary_psp</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">CMO_SecPSP</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">cmo_get_page_size</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">CMO_PageSize</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_PPC_PSERIES */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* _ASM_POWERPC_HVCALL_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
