<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › pte-8xx.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>pte-8xx.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_POWERPC_PTE_8xx_H</span>
<span class="cp">#define _ASM_POWERPC_PTE_8xx_H</span>
<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/*</span>
<span class="cm"> * The PowerPC MPC8xx uses a TLB with hardware assisted, software tablewalk.</span>
<span class="cm"> * We also use the two level tables, but we can put the real bits in them</span>
<span class="cm"> * needed for the TLB and tablewalk.  These definitions require Mx_CTR.PPM = 0,</span>
<span class="cm"> * Mx_CTR.PPCS = 0, and MD_CTR.TWAM = 1.  The level 2 descriptor has</span>
<span class="cm"> * additional page protection (when Mx_CTR.PPCS = 1) that allows TLB hit</span>
<span class="cm"> * based upon user/super access.  The TLB does not have accessed nor write</span>
<span class="cm"> * protect.  We assume that if the TLB get loaded with an entry it is</span>
<span class="cm"> * accessed, and overload the changed bit for write protect.  We use</span>
<span class="cm"> * two bits in the software pte that are supposed to be set to zero in</span>
<span class="cm"> * the TLB entry (24 and 25) for these indicators.  Although the level 1</span>
<span class="cm"> * descriptor contains the guarded and writethrough/copyback bits, we can</span>
<span class="cm"> * set these at the page level since they get copied from the Mx_TWC</span>
<span class="cm"> * register when the TLB entry is loaded.  We will use bit 27 for guard, since</span>
<span class="cm"> * that is where it exists in the MD_TWC, and bit 26 for writethrough.</span>
<span class="cm"> * These will get masked from the level 2 descriptor at TLB load time, and</span>
<span class="cm"> * copied to the MD_TWC before it gets loaded.</span>
<span class="cm"> * Large page sizes added.  We currently support two sizes, 4K and 8M.</span>
<span class="cm"> * This also allows a TLB hander optimization because we can directly</span>
<span class="cm"> * load the PMD into MD_TWC.  The 8M pages are only used for kernel</span>
<span class="cm"> * mapping of well known areas.  The PMD (PGD) entries contain control</span>
<span class="cm"> * flags in addition to the address, so care must be taken that the</span>
<span class="cm"> * software no longer assumes these are only pointers.</span>
<span class="cm"> */</span>

<span class="cm">/* Definitions for 8xx embedded chips. */</span>
<span class="cp">#define _PAGE_PRESENT	0x0001	</span><span class="cm">/* Page is valid */</span><span class="cp"></span>
<span class="cp">#define _PAGE_FILE	0x0002	</span><span class="cm">/* when !present: nonlinear file mapping */</span><span class="cp"></span>
<span class="cp">#define _PAGE_NO_CACHE	0x0002	</span><span class="cm">/* I: cache inhibit */</span><span class="cp"></span>
<span class="cp">#define _PAGE_SHARED	0x0004	</span><span class="cm">/* No ASID (context) compare */</span><span class="cp"></span>
<span class="cp">#define _PAGE_SPECIAL	0x0008	</span><span class="cm">/* SW entry, forced to 0 by the TLB miss */</span><span class="cp"></span>
<span class="cp">#define _PAGE_DIRTY	0x0100	</span><span class="cm">/* C: page changed */</span><span class="cp"></span>

<span class="cm">/* These 4 software bits must be masked out when the entry is loaded</span>
<span class="cm"> * into the TLB, 1 SW bit left(0x0080).</span>
<span class="cm"> */</span>
<span class="cp">#define _PAGE_GUARDED	0x0010	</span><span class="cm">/* software: guarded access */</span><span class="cp"></span>
<span class="cp">#define _PAGE_ACCESSED	0x0020	</span><span class="cm">/* software: page referenced */</span><span class="cp"></span>
<span class="cp">#define _PAGE_WRITETHRU	0x0040	</span><span class="cm">/* software: caching is write through */</span><span class="cp"></span>

<span class="cm">/* Setting any bits in the nibble with the follow two controls will</span>
<span class="cm"> * require a TLB exception handler change.  It is assumed unused bits</span>
<span class="cm"> * are always zero.</span>
<span class="cm"> */</span>
<span class="cp">#define _PAGE_RW	0x0400	</span><span class="cm">/* lsb PP bits, inverted in HW */</span><span class="cp"></span>
<span class="cp">#define _PAGE_USER	0x0800	</span><span class="cm">/* msb PP bits */</span><span class="cp"></span>

<span class="cp">#define _PMD_PRESENT	0x0001</span>
<span class="cp">#define _PMD_BAD	0x0ff0</span>
<span class="cp">#define _PMD_PAGE_MASK	0x000c</span>
<span class="cp">#define _PMD_PAGE_8M	0x000c</span>

<span class="cp">#define _PTE_NONE_MASK _PAGE_ACCESSED</span>

<span class="cm">/* Until my rework is finished, 8xx still needs atomic PTE updates */</span>
<span class="cp">#define PTE_ATOMIC_UPDATES	1</span>

<span class="cm">/* We need to add _PAGE_SHARED to kernel pages */</span>
<span class="cp">#define _PAGE_KERNEL_RO	(_PAGE_SHARED)</span>
<span class="cp">#define _PAGE_KERNEL_RW	(_PAGE_DIRTY | _PAGE_RW | _PAGE_HWWRITE)</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/*  _ASM_POWERPC_PTE_8xx_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
