<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › ucc_fast.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>ucc_fast.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Internal header file for UCC FAST unit routines.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2006 Freescale Semicondutor, Inc. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Authors: 	Shlomi Gridish &lt;gridish@freescale.com&gt;</span>
<span class="cm"> * 		Li Yang &lt;leoli@freescale.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute  it and/or modify it</span>
<span class="cm"> * under  the terms of  the GNU General  Public License as published by the</span>
<span class="cm"> * Free Software Foundation;  either version 2 of the  License, or (at your</span>
<span class="cm"> * option) any later version.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __UCC_FAST_H__</span>
<span class="cp">#define __UCC_FAST_H__</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>

<span class="cp">#include &lt;asm/immap_qe.h&gt;</span>
<span class="cp">#include &lt;asm/qe.h&gt;</span>

<span class="cp">#include &quot;ucc.h&quot;</span>

<span class="cm">/* Receive BD&#39;s status */</span>
<span class="cp">#define R_E	0x80000000	</span><span class="cm">/* buffer empty */</span><span class="cp"></span>
<span class="cp">#define R_W	0x20000000	</span><span class="cm">/* wrap bit */</span><span class="cp"></span>
<span class="cp">#define R_I	0x10000000	</span><span class="cm">/* interrupt on reception */</span><span class="cp"></span>
<span class="cp">#define R_L	0x08000000	</span><span class="cm">/* last */</span><span class="cp"></span>
<span class="cp">#define R_F	0x04000000	</span><span class="cm">/* first */</span><span class="cp"></span>

<span class="cm">/* transmit BD&#39;s status */</span>
<span class="cp">#define T_R	0x80000000	</span><span class="cm">/* ready bit */</span><span class="cp"></span>
<span class="cp">#define T_W	0x20000000	</span><span class="cm">/* wrap bit */</span><span class="cp"></span>
<span class="cp">#define T_I	0x10000000	</span><span class="cm">/* interrupt on completion */</span><span class="cp"></span>
<span class="cp">#define T_L	0x08000000	</span><span class="cm">/* last */</span><span class="cp"></span>

<span class="cm">/* Rx Data buffer must be 4 bytes aligned in most cases */</span>
<span class="cp">#define UCC_FAST_RX_ALIGN			4</span>
<span class="cp">#define UCC_FAST_MRBLR_ALIGNMENT		4</span>
<span class="cp">#define UCC_FAST_VIRT_FIFO_REGS_ALIGNMENT	8</span>

<span class="cm">/* Sizes */</span>
<span class="cp">#define UCC_FAST_URFS_MIN_VAL				0x88</span>
<span class="cp">#define UCC_FAST_RECEIVE_VIRTUAL_FIFO_SIZE_FUDGE_FACTOR	8</span>

<span class="cm">/* ucc_fast_channel_protocol_mode - UCC FAST mode */</span>
<span class="k">enum</span> <span class="n">ucc_fast_channel_protocol_mode</span> <span class="p">{</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_HDLC</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED01</span> <span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED_QMC</span> <span class="o">=</span> <span class="mh">0x00000002</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED02</span> <span class="o">=</span> <span class="mh">0x00000003</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED_UART</span> <span class="o">=</span> <span class="mh">0x00000004</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED03</span> <span class="o">=</span> <span class="mh">0x00000005</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED_EX_MAC_1</span> <span class="o">=</span> <span class="mh">0x00000006</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED_EX_MAC_2</span> <span class="o">=</span> <span class="mh">0x00000007</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED_BISYNC</span> <span class="o">=</span> <span class="mh">0x00000008</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED04</span> <span class="o">=</span> <span class="mh">0x00000009</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_ATM</span> <span class="o">=</span> <span class="mh">0x0000000A</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED05</span> <span class="o">=</span> <span class="mh">0x0000000B</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_ETHERNET</span> <span class="o">=</span> <span class="mh">0x0000000C</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED06</span> <span class="o">=</span> <span class="mh">0x0000000D</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_POS</span> <span class="o">=</span> <span class="mh">0x0000000E</span><span class="p">,</span>
	<span class="n">UCC_FAST_PROTOCOL_MODE_RESERVED07</span> <span class="o">=</span> <span class="mh">0x0000000F</span>
<span class="p">};</span>

<span class="cm">/* ucc_fast_transparent_txrx - UCC Fast Transparent TX &amp; RX */</span>
<span class="k">enum</span> <span class="n">ucc_fast_transparent_txrx</span> <span class="p">{</span>
	<span class="n">UCC_FAST_GUMR_TRANSPARENT_TTX_TRX_NORMAL</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
	<span class="n">UCC_FAST_GUMR_TRANSPARENT_TTX_TRX_TRANSPARENT</span> <span class="o">=</span> <span class="mh">0x18000000</span>
<span class="p">};</span>

<span class="cm">/* UCC fast diagnostic mode */</span>
<span class="k">enum</span> <span class="n">ucc_fast_diag_mode</span> <span class="p">{</span>
	<span class="n">UCC_FAST_DIAGNOSTIC_NORMAL</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
	<span class="n">UCC_FAST_DIAGNOSTIC_LOCAL_LOOP_BACK</span> <span class="o">=</span> <span class="mh">0x40000000</span><span class="p">,</span>
	<span class="n">UCC_FAST_DIAGNOSTIC_AUTO_ECHO</span> <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">,</span>
	<span class="n">UCC_FAST_DIAGNOSTIC_LOOP_BACK_AND_ECHO</span> <span class="o">=</span> <span class="mh">0xC0000000</span>
<span class="p">};</span>

<span class="cm">/* UCC fast Sync length (transparent mode only) */</span>
<span class="k">enum</span> <span class="n">ucc_fast_sync_len</span> <span class="p">{</span>
	<span class="n">UCC_FAST_SYNC_LEN_NOT_USED</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
	<span class="n">UCC_FAST_SYNC_LEN_AUTOMATIC</span> <span class="o">=</span> <span class="mh">0x00004000</span><span class="p">,</span>
	<span class="n">UCC_FAST_SYNC_LEN_8_BIT</span> <span class="o">=</span> <span class="mh">0x00008000</span><span class="p">,</span>
	<span class="n">UCC_FAST_SYNC_LEN_16_BIT</span> <span class="o">=</span> <span class="mh">0x0000C000</span>
<span class="p">};</span>

<span class="cm">/* UCC fast RTS mode */</span>
<span class="k">enum</span> <span class="n">ucc_fast_ready_to_send</span> <span class="p">{</span>
	<span class="n">UCC_FAST_SEND_IDLES_BETWEEN_FRAMES</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
	<span class="n">UCC_FAST_SEND_FLAGS_BETWEEN_FRAMES</span> <span class="o">=</span> <span class="mh">0x00002000</span>
<span class="p">};</span>

<span class="cm">/* UCC fast receiver decoding mode */</span>
<span class="k">enum</span> <span class="n">ucc_fast_rx_decoding_method</span> <span class="p">{</span>
	<span class="n">UCC_FAST_RX_ENCODING_NRZ</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
	<span class="n">UCC_FAST_RX_ENCODING_NRZI</span> <span class="o">=</span> <span class="mh">0x00000800</span><span class="p">,</span>
	<span class="n">UCC_FAST_RX_ENCODING_RESERVED0</span> <span class="o">=</span> <span class="mh">0x00001000</span><span class="p">,</span>
	<span class="n">UCC_FAST_RX_ENCODING_RESERVED1</span> <span class="o">=</span> <span class="mh">0x00001800</span>
<span class="p">};</span>

<span class="cm">/* UCC fast transmitter encoding mode */</span>
<span class="k">enum</span> <span class="n">ucc_fast_tx_encoding_method</span> <span class="p">{</span>
	<span class="n">UCC_FAST_TX_ENCODING_NRZ</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
	<span class="n">UCC_FAST_TX_ENCODING_NRZI</span> <span class="o">=</span> <span class="mh">0x00000100</span><span class="p">,</span>
	<span class="n">UCC_FAST_TX_ENCODING_RESERVED0</span> <span class="o">=</span> <span class="mh">0x00000200</span><span class="p">,</span>
	<span class="n">UCC_FAST_TX_ENCODING_RESERVED1</span> <span class="o">=</span> <span class="mh">0x00000300</span>
<span class="p">};</span>

<span class="cm">/* UCC fast CRC length */</span>
<span class="k">enum</span> <span class="n">ucc_fast_transparent_tcrc</span> <span class="p">{</span>
	<span class="n">UCC_FAST_16_BIT_CRC</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
	<span class="n">UCC_FAST_CRC_RESERVED0</span> <span class="o">=</span> <span class="mh">0x00000040</span><span class="p">,</span>
	<span class="n">UCC_FAST_32_BIT_CRC</span> <span class="o">=</span> <span class="mh">0x00000080</span><span class="p">,</span>
	<span class="n">UCC_FAST_CRC_RESERVED1</span> <span class="o">=</span> <span class="mh">0x000000C0</span>
<span class="p">};</span>

<span class="cm">/* Fast UCC initialization structure */</span>
<span class="k">struct</span> <span class="n">ucc_fast_info</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">ucc_num</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">qe_clock</span> <span class="n">rx_clock</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">qe_clock</span> <span class="n">tx_clock</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">regs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">uccm_mask</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bd_mem_part</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">brkpt_support</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">grant_support</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tsa</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">cdp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">cds</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ctsp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ctss</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tci</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">txsy</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rtsm</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">revd</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rsyn</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">max_rx_buf_length</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">urfs</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">urfet</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">urfset</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">utfs</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">utfet</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">utftt</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ufpt</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ucc_fast_channel_protocol_mode</span> <span class="n">mode</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ucc_fast_transparent_txrx</span> <span class="n">ttx_trx</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ucc_fast_tx_encoding_method</span> <span class="n">tenc</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ucc_fast_rx_decoding_method</span> <span class="n">renc</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ucc_fast_transparent_tcrc</span> <span class="n">tcrc</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ucc_fast_sync_len</span> <span class="n">synl</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ucc_fast_private</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ucc_fast_info</span> <span class="o">*</span><span class="n">uf_info</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ucc_fast</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">uf_regs</span><span class="p">;</span> <span class="cm">/* a pointer to the UCC regs. */</span>
	<span class="n">u32</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">p_ucce</span><span class="p">;</span>	<span class="cm">/* a pointer to the event register in memory. */</span>
	<span class="n">u32</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">p_uccm</span><span class="p">;</span>	<span class="cm">/* a pointer to the mask register in memory. */</span>
<span class="cp">#ifdef CONFIG_UGETH_TX_ON_DEMAND</span>
	<span class="n">u16</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">p_utodr</span><span class="p">;</span>	<span class="cm">/* pointer to the transmit on demand register */</span>
<span class="cp">#endif</span>
	<span class="kt">int</span> <span class="n">enabled_tx</span><span class="p">;</span>		<span class="cm">/* Whether channel is enabled for Tx (ENT) */</span>
	<span class="kt">int</span> <span class="n">enabled_rx</span><span class="p">;</span>		<span class="cm">/* Whether channel is enabled for Rx (ENR) */</span>
	<span class="kt">int</span> <span class="n">stopped_tx</span><span class="p">;</span>		<span class="cm">/* Whether channel has been stopped for Tx</span>
<span class="cm">				   (STOP_TX, etc.) */</span>
	<span class="kt">int</span> <span class="n">stopped_rx</span><span class="p">;</span>		<span class="cm">/* Whether channel has been stopped for Rx */</span>
	<span class="n">u32</span> <span class="n">ucc_fast_tx_virtual_fifo_base_offset</span><span class="p">;</span><span class="cm">/* pointer to base of Tx</span>
<span class="cm">						    virtual fifo */</span>
	<span class="n">u32</span> <span class="n">ucc_fast_rx_virtual_fifo_base_offset</span><span class="p">;</span><span class="cm">/* pointer to base of Rx</span>
<span class="cm">						    virtual fifo */</span>
<span class="cp">#ifdef STATISTICS</span>
	<span class="n">u32</span> <span class="n">tx_frames</span><span class="p">;</span>		<span class="cm">/* Transmitted frames counter. */</span>
	<span class="n">u32</span> <span class="n">rx_frames</span><span class="p">;</span>		<span class="cm">/* Received frames counter (only frames</span>
<span class="cm">				   passed to application). */</span>
	<span class="n">u32</span> <span class="n">tx_discarded</span><span class="p">;</span>	<span class="cm">/* Discarded tx frames counter (frames that</span>
<span class="cm">				   were discarded by the driver due to errors).</span>
<span class="cm">				   */</span>
	<span class="n">u32</span> <span class="n">rx_discarded</span><span class="p">;</span>	<span class="cm">/* Discarded rx frames counter (frames that</span>
<span class="cm">				   were discarded by the driver due to errors).</span>
<span class="cm">				   */</span>
<span class="cp">#endif				</span><span class="cm">/* STATISTICS */</span><span class="cp"></span>
	<span class="n">u16</span> <span class="n">mrblr</span><span class="p">;</span>		<span class="cm">/* maximum receive buffer length */</span>
<span class="p">};</span>

<span class="cm">/* ucc_fast_init</span>
<span class="cm"> * Initializes Fast UCC according to user provided parameters.</span>
<span class="cm"> *</span>
<span class="cm"> * uf_info  - (In) pointer to the fast UCC info structure.</span>
<span class="cm"> * uccf_ret - (Out) pointer to the fast UCC structure.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">ucc_fast_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">ucc_fast_info</span> <span class="o">*</span> <span class="n">uf_info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ucc_fast_private</span> <span class="o">**</span> <span class="n">uccf_ret</span><span class="p">);</span>

<span class="cm">/* ucc_fast_free</span>
<span class="cm"> * Frees all resources for fast UCC.</span>
<span class="cm"> *</span>
<span class="cm"> * uccf - (In) pointer to the fast UCC structure.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">ucc_fast_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">ucc_fast_private</span> <span class="o">*</span> <span class="n">uccf</span><span class="p">);</span>

<span class="cm">/* ucc_fast_enable</span>
<span class="cm"> * Enables a fast UCC port.</span>
<span class="cm"> * This routine enables Tx and/or Rx through the General UCC Mode Register.</span>
<span class="cm"> *</span>
<span class="cm"> * uccf - (In) pointer to the fast UCC structure.</span>
<span class="cm"> * mode - (In) TX, RX, or both.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">ucc_fast_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">ucc_fast_private</span> <span class="o">*</span> <span class="n">uccf</span><span class="p">,</span> <span class="k">enum</span> <span class="n">comm_dir</span> <span class="n">mode</span><span class="p">);</span>

<span class="cm">/* ucc_fast_disable</span>
<span class="cm"> * Disables a fast UCC port.</span>
<span class="cm"> * This routine disables Tx and/or Rx through the General UCC Mode Register.</span>
<span class="cm"> *</span>
<span class="cm"> * uccf - (In) pointer to the fast UCC structure.</span>
<span class="cm"> * mode - (In) TX, RX, or both.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">ucc_fast_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">ucc_fast_private</span> <span class="o">*</span> <span class="n">uccf</span><span class="p">,</span> <span class="k">enum</span> <span class="n">comm_dir</span> <span class="n">mode</span><span class="p">);</span>

<span class="cm">/* ucc_fast_irq</span>
<span class="cm"> * Handles interrupts on fast UCC.</span>
<span class="cm"> * Called from the general interrupt routine to handle interrupts on fast UCC.</span>
<span class="cm"> *</span>
<span class="cm"> * uccf - (In) pointer to the fast UCC structure.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">ucc_fast_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">ucc_fast_private</span> <span class="o">*</span> <span class="n">uccf</span><span class="p">);</span>

<span class="cm">/* ucc_fast_transmit_on_demand</span>
<span class="cm"> * Immediately forces a poll of the transmitter for data to be sent.</span>
<span class="cm"> * Typically, the hardware performs a periodic poll for data that the</span>
<span class="cm"> * transmit routine has set up to be transmitted. In cases where</span>
<span class="cm"> * this polling cycle is not soon enough, this optional routine can</span>
<span class="cm"> * be invoked to force a poll right away, instead. Proper use for</span>
<span class="cm"> * each transmission for which this functionality is desired is to</span>
<span class="cm"> * call the transmit routine and then this routine right after.</span>
<span class="cm"> *</span>
<span class="cm"> * uccf - (In) pointer to the fast UCC structure.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">ucc_fast_transmit_on_demand</span><span class="p">(</span><span class="k">struct</span> <span class="n">ucc_fast_private</span> <span class="o">*</span> <span class="n">uccf</span><span class="p">);</span>

<span class="n">u32</span> <span class="n">ucc_fast_get_qe_cr_subblock</span><span class="p">(</span><span class="kt">int</span> <span class="n">uccf_num</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">ucc_fast_dump_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">ucc_fast_private</span> <span class="o">*</span> <span class="n">uccf</span><span class="p">);</span>

<span class="cp">#endif				</span><span class="cm">/* __UCC_FAST_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
