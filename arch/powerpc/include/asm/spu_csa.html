<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › spu_csa.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>spu_csa.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * spu_csa.h: Definitions for SPU context save area (CSA).</span>
<span class="cm"> *</span>
<span class="cm"> * (C) Copyright IBM 2005</span>
<span class="cm"> *</span>
<span class="cm"> * Author: Mark Nutter &lt;mnutter@us.ibm.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2, or (at your option)</span>
<span class="cm"> * any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _SPU_CSA_H_</span>
<span class="cp">#define _SPU_CSA_H_</span>
<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/*</span>
<span class="cm"> * Total number of 128-bit registers.</span>
<span class="cm"> */</span>
<span class="cp">#define NR_SPU_GPRS         	128</span>
<span class="cp">#define NR_SPU_SPRS         	9</span>
<span class="cp">#define NR_SPU_REGS_PAD	    	7</span>
<span class="cp">#define NR_SPU_SPILL_REGS   	144	</span><span class="cm">/* GPRS + SPRS + PAD */</span><span class="cp"></span>
<span class="cp">#define SIZEOF_SPU_SPILL_REGS	NR_SPU_SPILL_REGS * 16</span>

<span class="cp">#define SPU_SAVE_COMPLETE      	0x3FFB</span>
<span class="cp">#define SPU_RESTORE_COMPLETE   	0x3FFC</span>

<span class="cm">/*</span>
<span class="cm"> * Definitions for various &#39;stopped&#39; status conditions,</span>
<span class="cm"> * to be recreated during context restore.</span>
<span class="cm"> */</span>
<span class="cp">#define SPU_STOPPED_STATUS_P    1</span>
<span class="cp">#define SPU_STOPPED_STATUS_I    2</span>
<span class="cp">#define SPU_STOPPED_STATUS_H    3</span>
<span class="cp">#define SPU_STOPPED_STATUS_S    4</span>
<span class="cp">#define SPU_STOPPED_STATUS_S_I  5</span>
<span class="cp">#define SPU_STOPPED_STATUS_S_P  6</span>
<span class="cp">#define SPU_STOPPED_STATUS_P_H  7</span>
<span class="cp">#define SPU_STOPPED_STATUS_P_I  8</span>
<span class="cp">#define SPU_STOPPED_STATUS_R    9</span>

<span class="cm">/*</span>
<span class="cm"> * Definitions for software decrementer status flag.</span>
<span class="cm"> */</span>
<span class="cp">#define SPU_DECR_STATUS_RUNNING 0x1</span>
<span class="cp">#define SPU_DECR_STATUS_WRAPPED 0x2</span>

<span class="cp">#ifndef  __ASSEMBLY__</span>
<span class="cm">/**</span>
<span class="cm"> * spu_reg128 - generic 128-bit register definition.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">spu_reg128</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">slot</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct spu_lscsa - Local Store Context Save Area.</span>
<span class="cm"> * @gprs: Array of saved registers.</span>
<span class="cm"> * @fpcr: Saved floating point status control register.</span>
<span class="cm"> * @decr: Saved decrementer value.</span>
<span class="cm"> * @decr_status: Indicates software decrementer status flags.</span>
<span class="cm"> * @ppu_mb: Saved PPU mailbox data.</span>
<span class="cm"> * @ppuint_mb: Saved PPU interrupting mailbox data.</span>
<span class="cm"> * @tag_mask: Saved tag group mask.</span>
<span class="cm"> * @event_mask: Saved event mask.</span>
<span class="cm"> * @srr0: Saved SRR0.</span>
<span class="cm"> * @stopped_status: Conditions to be recreated by restore.</span>
<span class="cm"> * @ls: Saved contents of Local Storage Area.</span>
<span class="cm"> *</span>
<span class="cm"> * The LSCSA represents state that is primarily saved and</span>
<span class="cm"> * restored by SPU-side code.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">spu_lscsa</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">spu_reg128</span> <span class="n">gprs</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">spu_reg128</span> <span class="n">fpcr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spu_reg128</span> <span class="n">decr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spu_reg128</span> <span class="n">decr_status</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spu_reg128</span> <span class="n">ppu_mb</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spu_reg128</span> <span class="n">ppuint_mb</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spu_reg128</span> <span class="n">tag_mask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spu_reg128</span> <span class="n">event_mask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spu_reg128</span> <span class="n">srr0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spu_reg128</span> <span class="n">stopped_status</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * &#39;ls&#39; must be page-aligned on all configurations.</span>
<span class="cm">	 * Since we don&#39;t want to rely on having the spu-gcc</span>
<span class="cm">	 * installed to build the kernel and this structure</span>
<span class="cm">	 * is used in the SPU-side code, make it 64k-page</span>
<span class="cm">	 * aligned for now.</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ls</span><span class="p">[</span><span class="n">LS_SIZE</span><span class="p">]</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">65536</span><span class="p">)));</span>
<span class="p">};</span>

<span class="cp">#ifndef __SPU__</span>
<span class="cm">/*</span>
<span class="cm"> * struct spu_problem_collapsed - condensed problem state area, w/o pads.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">spu_problem_collapsed</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">spc_mssync_RW</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mfc_lsa_W</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">unused_pad0</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_ea_W</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">mfc_tag_size_class_cmd</span> <span class="n">mfc_union_W</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dma_qstatus_R</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dma_querytype_RW</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dma_querymask_RW</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dma_tagstatus_R</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pu_mb_R</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">spu_mb_W</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mb_stat_R</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">spu_runcntl_RW</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">spu_status_R</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">spu_spc_R</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">spu_npc_RW</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">signal_notify1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">signal_notify2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">unused_pad1</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * struct spu_priv1_collapsed - condensed privileged 1 area, w/o pads.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">spu_priv1_collapsed</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">mfc_sr1_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_lpid_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_idr_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_vr_RO</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_vr_RO</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">int_mask_class0_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">int_mask_class1_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">int_mask_class2_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">int_stat_class0_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">int_stat_class1_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">int_stat_class2_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">int_route_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_atomic_flush_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">resource_allocation_groupID_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">resource_allocation_enable_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_fir_R</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_fir_status_or_W</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_fir_status_and_W</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_fir_mask_R</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_fir_mask_or_W</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_fir_mask_and_W</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_fir_chkstp_enable_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">smf_sbi_signal_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">smf_ato_signal_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tlb_index_hint_RO</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tlb_index_W</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tlb_vpn_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tlb_rpn_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tlb_invalidate_entry_W</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tlb_invalidate_all_W</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">smm_hid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_accr_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_dsisr_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_dar_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">rmt_index_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">rmt_data1_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_dsir_R</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_lsacr_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_lscrr_R</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_tclass_id_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_rm_boundary</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">smf_dma_signal_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">smm_signal_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mfc_cer_R</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">pu_ecc_cntl_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">pu_ecc_stat_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_ecc_addr_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_err_mask_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_trig0_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_trig1_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_trig2_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_trig3_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_trace_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_event0_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_event1_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_event2_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_event3_sel</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_trace_cntl</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * struct spu_priv2_collapsed - condensed privileged 2 area, w/o pads.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">spu_priv2_collapsed</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">slb_index_W</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">slb_esid_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">slb_vsid_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">slb_invalidate_entry_W</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">slb_invalidate_all_W</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mfc_cq_sr</span> <span class="n">spuq</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mfc_cq_sr</span> <span class="n">puq</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">mfc_control_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">puint_mb_R</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_privcntl_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_lslr_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_chnlcntptr_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_chnlcnt_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_chnldata_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_cfg_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_tag_status_query_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_cmd_buf1_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_cmd_buf2_RW</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_atomic_status_RW</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct spu_state</span>
<span class="cm"> * @lscsa: Local Store Context Save Area.</span>
<span class="cm"> * @prob: Collapsed Problem State Area, w/o pads.</span>
<span class="cm"> * @priv1: Collapsed Privileged 1 Area, w/o pads.</span>
<span class="cm"> * @priv2: Collapsed Privileged 2 Area, w/o pads.</span>
<span class="cm"> * @spu_chnlcnt_RW: Array of saved channel counts.</span>
<span class="cm"> * @spu_chnldata_RW: Array of saved channel data.</span>
<span class="cm"> * @suspend_time: Time stamp when decrementer disabled.</span>
<span class="cm"> *</span>
<span class="cm"> * Structure representing the whole of the SPU</span>
<span class="cm"> * context save area (CSA).  This struct contains</span>
<span class="cm"> * all of the state necessary to suspend and then</span>
<span class="cm"> * later optionally resume execution of an SPU</span>
<span class="cm"> * context.</span>
<span class="cm"> *</span>
<span class="cm"> * The @lscsa region is by far the largest, and is</span>
<span class="cm"> * allocated separately so that it may either be</span>
<span class="cm"> * pinned or mapped to/from application memory, as</span>
<span class="cm"> * appropriate for the OS environment.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">spu_state</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">spu_lscsa</span> <span class="o">*</span><span class="n">lscsa</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_SPU_FS_64K_LS</span>
	<span class="kt">int</span>		<span class="n">use_big_pages</span><span class="p">;</span>
	<span class="cm">/* One struct page per 64k page */</span>
<span class="cp">#define SPU_LSCSA_NUM_BIG_PAGES	(sizeof(struct spu_lscsa) / 0x10000)</span>
	<span class="k">struct</span> <span class="n">page</span>	<span class="o">*</span><span class="n">lscsa_pages</span><span class="p">[</span><span class="n">SPU_LSCSA_NUM_BIG_PAGES</span><span class="p">];</span>
<span class="cp">#endif</span>
	<span class="k">struct</span> <span class="n">spu_problem_collapsed</span> <span class="n">prob</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spu_priv1_collapsed</span> <span class="n">priv1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spu_priv2_collapsed</span> <span class="n">priv2</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">spu_chnlcnt_RW</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">spu_chnldata_RW</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">spu_mailbox_data</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">pu_mailbox_data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">class_0_dar</span><span class="p">,</span> <span class="n">class_0_pending</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">class_1_dar</span><span class="p">,</span> <span class="n">class_1_dsisr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">suspend_time</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">register_lock</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="cm">/* !__SPU__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* _SPU_CSA_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
