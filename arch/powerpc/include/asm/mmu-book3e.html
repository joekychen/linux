<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › mmu-book3e.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>mmu-book3e.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_POWERPC_MMU_BOOK3E_H_</span>
<span class="cp">#define _ASM_POWERPC_MMU_BOOK3E_H_</span>
<span class="cm">/*</span>
<span class="cm"> * Freescale Book-E/Book-3e (ISA 2.06+) MMU support</span>
<span class="cm"> */</span>

<span class="cm">/* Book-3e defined page sizes */</span>
<span class="cp">#define BOOK3E_PAGESZ_1K	0</span>
<span class="cp">#define BOOK3E_PAGESZ_2K	1</span>
<span class="cp">#define BOOK3E_PAGESZ_4K	2</span>
<span class="cp">#define BOOK3E_PAGESZ_8K	3</span>
<span class="cp">#define BOOK3E_PAGESZ_16K	4</span>
<span class="cp">#define BOOK3E_PAGESZ_32K	5</span>
<span class="cp">#define BOOK3E_PAGESZ_64K	6</span>
<span class="cp">#define BOOK3E_PAGESZ_128K	7</span>
<span class="cp">#define BOOK3E_PAGESZ_256K	8</span>
<span class="cp">#define BOOK3E_PAGESZ_512K	9</span>
<span class="cp">#define BOOK3E_PAGESZ_1M	10</span>
<span class="cp">#define BOOK3E_PAGESZ_2M	11</span>
<span class="cp">#define BOOK3E_PAGESZ_4M	12</span>
<span class="cp">#define BOOK3E_PAGESZ_8M	13</span>
<span class="cp">#define BOOK3E_PAGESZ_16M	14</span>
<span class="cp">#define BOOK3E_PAGESZ_32M	15</span>
<span class="cp">#define BOOK3E_PAGESZ_64M	16</span>
<span class="cp">#define BOOK3E_PAGESZ_128M	17</span>
<span class="cp">#define BOOK3E_PAGESZ_256M	18</span>
<span class="cp">#define BOOK3E_PAGESZ_512M	19</span>
<span class="cp">#define BOOK3E_PAGESZ_1GB	20</span>
<span class="cp">#define BOOK3E_PAGESZ_2GB	21</span>
<span class="cp">#define BOOK3E_PAGESZ_4GB	22</span>
<span class="cp">#define BOOK3E_PAGESZ_8GB	23</span>
<span class="cp">#define BOOK3E_PAGESZ_16GB	24</span>
<span class="cp">#define BOOK3E_PAGESZ_32GB	25</span>
<span class="cp">#define BOOK3E_PAGESZ_64GB	26</span>
<span class="cp">#define BOOK3E_PAGESZ_128GB	27</span>
<span class="cp">#define BOOK3E_PAGESZ_256GB	28</span>
<span class="cp">#define BOOK3E_PAGESZ_512GB	29</span>
<span class="cp">#define BOOK3E_PAGESZ_1TB	30</span>
<span class="cp">#define BOOK3E_PAGESZ_2TB	31</span>

<span class="cm">/* MAS registers bit definitions */</span>

<span class="cp">#define MAS0_TLBSEL(x)		(((x) &lt;&lt; 28) &amp; 0x30000000)</span>
<span class="cp">#define MAS0_ESEL_MASK		0x0FFF0000</span>
<span class="cp">#define MAS0_ESEL_SHIFT		16</span>
<span class="cp">#define MAS0_ESEL(x)		(((x) &lt;&lt; MAS0_ESEL_SHIFT) &amp; MAS0_ESEL_MASK)</span>
<span class="cp">#define MAS0_NV(x)		((x) &amp; 0x00000FFF)</span>
<span class="cp">#define MAS0_HES		0x00004000</span>
<span class="cp">#define MAS0_WQ_ALLWAYS		0x00000000</span>
<span class="cp">#define MAS0_WQ_COND		0x00001000</span>
<span class="cp">#define MAS0_WQ_CLR_RSRV       	0x00002000</span>

<span class="cp">#define MAS1_VALID		0x80000000</span>
<span class="cp">#define MAS1_IPROT		0x40000000</span>
<span class="cp">#define MAS1_TID(x)		(((x) &lt;&lt; 16) &amp; 0x3FFF0000)</span>
<span class="cp">#define MAS1_IND		0x00002000</span>
<span class="cp">#define MAS1_TS			0x00001000</span>
<span class="cp">#define MAS1_TSIZE_MASK		0x00000f80</span>
<span class="cp">#define MAS1_TSIZE_SHIFT	7</span>
<span class="cp">#define MAS1_TSIZE(x)		(((x) &lt;&lt; MAS1_TSIZE_SHIFT) &amp; MAS1_TSIZE_MASK)</span>

<span class="cp">#define MAS2_EPN		0xFFFFF000</span>
<span class="cp">#define MAS2_X0			0x00000040</span>
<span class="cp">#define MAS2_X1			0x00000020</span>
<span class="cp">#define MAS2_W			0x00000010</span>
<span class="cp">#define MAS2_I			0x00000008</span>
<span class="cp">#define MAS2_M			0x00000004</span>
<span class="cp">#define MAS2_G			0x00000002</span>
<span class="cp">#define MAS2_E			0x00000001</span>
<span class="cp">#define MAS2_WIMGE_MASK		0x0000001f</span>
<span class="cp">#define MAS2_EPN_MASK(size)		(~0 &lt;&lt; (size + 10))</span>
<span class="cp">#define MAS2_VAL(addr, size, flags)	((addr) &amp; MAS2_EPN_MASK(size) | (flags))</span>

<span class="cp">#define MAS3_RPN		0xFFFFF000</span>
<span class="cp">#define MAS3_U0			0x00000200</span>
<span class="cp">#define MAS3_U1			0x00000100</span>
<span class="cp">#define MAS3_U2			0x00000080</span>
<span class="cp">#define MAS3_U3			0x00000040</span>
<span class="cp">#define MAS3_UX			0x00000020</span>
<span class="cp">#define MAS3_SX			0x00000010</span>
<span class="cp">#define MAS3_UW			0x00000008</span>
<span class="cp">#define MAS3_SW			0x00000004</span>
<span class="cp">#define MAS3_UR			0x00000002</span>
<span class="cp">#define MAS3_SR			0x00000001</span>
<span class="cp">#define MAS3_BAP_MASK		0x0000003f</span>
<span class="cp">#define MAS3_SPSIZE		0x0000003e</span>
<span class="cp">#define MAS3_SPSIZE_SHIFT	1</span>

<span class="cp">#define MAS4_TLBSELD(x) 	MAS0_TLBSEL(x)</span>
<span class="cp">#define MAS4_INDD		0x00008000	</span><span class="cm">/* Default IND */</span><span class="cp"></span>
<span class="cp">#define MAS4_TSIZED(x)		MAS1_TSIZE(x)</span>
<span class="cp">#define MAS4_X0D		0x00000040</span>
<span class="cp">#define MAS4_X1D		0x00000020</span>
<span class="cp">#define MAS4_WD			0x00000010</span>
<span class="cp">#define MAS4_ID			0x00000008</span>
<span class="cp">#define MAS4_MD			0x00000004</span>
<span class="cp">#define MAS4_GD			0x00000002</span>
<span class="cp">#define MAS4_ED			0x00000001</span>
<span class="cp">#define MAS4_WIMGED_MASK	0x0000001f	</span><span class="cm">/* Default WIMGE */</span><span class="cp"></span>
<span class="cp">#define MAS4_WIMGED_SHIFT	0</span>
<span class="cp">#define MAS4_VLED		MAS4_X1D	</span><span class="cm">/* Default VLE */</span><span class="cp"></span>
<span class="cp">#define MAS4_ACMD		0x000000c0	</span><span class="cm">/* Default ACM */</span><span class="cp"></span>
<span class="cp">#define MAS4_ACMD_SHIFT		6</span>
<span class="cp">#define MAS4_TSIZED_MASK	0x00000f80	</span><span class="cm">/* Default TSIZE */</span><span class="cp"></span>
<span class="cp">#define MAS4_TSIZED_SHIFT	7</span>

<span class="cp">#define MAS5_SGS		0x80000000</span>

<span class="cp">#define MAS6_SPID0		0x3FFF0000</span>
<span class="cp">#define MAS6_SPID1		0x00007FFE</span>
<span class="cp">#define MAS6_ISIZE(x)		MAS1_TSIZE(x)</span>
<span class="cp">#define MAS6_SAS		0x00000001</span>
<span class="cp">#define MAS6_SPID		MAS6_SPID0</span>
<span class="cp">#define MAS6_SIND 		0x00000002	</span><span class="cm">/* Indirect page */</span><span class="cp"></span>
<span class="cp">#define MAS6_SIND_SHIFT		1</span>
<span class="cp">#define MAS6_SPID_MASK		0x3fff0000</span>
<span class="cp">#define MAS6_SPID_SHIFT		16</span>
<span class="cp">#define MAS6_ISIZE_MASK		0x00000f80</span>
<span class="cp">#define MAS6_ISIZE_SHIFT	7</span>

<span class="cp">#define MAS7_RPN		0xFFFFFFFF</span>

<span class="cp">#define MAS8_TGS		0x80000000 </span><span class="cm">/* Guest space */</span><span class="cp"></span>
<span class="cp">#define MAS8_VF			0x40000000 </span><span class="cm">/* Virtualization Fault */</span><span class="cp"></span>
<span class="cp">#define MAS8_TLPID		0x000000ff</span>

<span class="cm">/* Bit definitions for MMUCFG */</span>
<span class="cp">#define MMUCFG_MAVN	0x00000003	</span><span class="cm">/* MMU Architecture Version Number */</span><span class="cp"></span>
<span class="cp">#define MMUCFG_MAVN_V1	0x00000000	</span><span class="cm">/* v1.0 */</span><span class="cp"></span>
<span class="cp">#define MMUCFG_MAVN_V2	0x00000001	</span><span class="cm">/* v2.0 */</span><span class="cp"></span>
<span class="cp">#define MMUCFG_NTLBS	0x0000000c	</span><span class="cm">/* Number of TLBs */</span><span class="cp"></span>
<span class="cp">#define MMUCFG_PIDSIZE	0x000007c0	</span><span class="cm">/* PID Reg Size */</span><span class="cp"></span>
<span class="cp">#define MMUCFG_TWC	0x00008000	</span><span class="cm">/* TLB Write Conditional (v2.0) */</span><span class="cp"></span>
<span class="cp">#define MMUCFG_LRAT	0x00010000	</span><span class="cm">/* LRAT Supported (v2.0) */</span><span class="cp"></span>
<span class="cp">#define MMUCFG_RASIZE	0x00fe0000	</span><span class="cm">/* Real Addr Size */</span><span class="cp"></span>
<span class="cp">#define MMUCFG_LPIDSIZE	0x0f000000	</span><span class="cm">/* LPID Reg Size */</span><span class="cp"></span>

<span class="cm">/* Bit definitions for MMUCSR0 */</span>
<span class="cp">#define MMUCSR0_TLB1FI	0x00000002	</span><span class="cm">/* TLB1 Flash invalidate */</span><span class="cp"></span>
<span class="cp">#define MMUCSR0_TLB0FI	0x00000004	</span><span class="cm">/* TLB0 Flash invalidate */</span><span class="cp"></span>
<span class="cp">#define MMUCSR0_TLB2FI	0x00000040	</span><span class="cm">/* TLB2 Flash invalidate */</span><span class="cp"></span>
<span class="cp">#define MMUCSR0_TLB3FI	0x00000020	</span><span class="cm">/* TLB3 Flash invalidate */</span><span class="cp"></span>
<span class="cp">#define MMUCSR0_TLBFI	(MMUCSR0_TLB0FI | MMUCSR0_TLB1FI | \</span>
<span class="cp">			 MMUCSR0_TLB2FI | MMUCSR0_TLB3FI)</span>
<span class="cp">#define MMUCSR0_TLB0PS	0x00000780	</span><span class="cm">/* TLB0 Page Size */</span><span class="cp"></span>
<span class="cp">#define MMUCSR0_TLB1PS	0x00007800	</span><span class="cm">/* TLB1 Page Size */</span><span class="cp"></span>
<span class="cp">#define MMUCSR0_TLB2PS	0x00078000	</span><span class="cm">/* TLB2 Page Size */</span><span class="cp"></span>
<span class="cp">#define MMUCSR0_TLB3PS	0x00780000	</span><span class="cm">/* TLB3 Page Size */</span><span class="cp"></span>

<span class="cm">/* MMUCFG bits */</span>
<span class="cp">#define MMUCFG_MAVN_NASK	0x00000003</span>
<span class="cp">#define MMUCFG_MAVN_V1_0	0x00000000</span>
<span class="cp">#define MMUCFG_MAVN_V2_0	0x00000001</span>
<span class="cp">#define MMUCFG_NTLB_MASK	0x0000000c</span>
<span class="cp">#define MMUCFG_NTLB_SHIFT	2</span>
<span class="cp">#define MMUCFG_PIDSIZE_MASK	0x000007c0</span>
<span class="cp">#define MMUCFG_PIDSIZE_SHIFT	6</span>
<span class="cp">#define MMUCFG_TWC		0x00008000</span>
<span class="cp">#define MMUCFG_LRAT		0x00010000</span>
<span class="cp">#define MMUCFG_RASIZE_MASK	0x00fe0000</span>
<span class="cp">#define MMUCFG_RASIZE_SHIFT	17</span>
<span class="cp">#define MMUCFG_LPIDSIZE_MASK	0x0f000000</span>
<span class="cp">#define MMUCFG_LPIDSIZE_SHIFT	24</span>

<span class="cm">/* TLBnCFG encoding */</span>
<span class="cp">#define TLBnCFG_N_ENTRY		0x00000fff	</span><span class="cm">/* number of entries */</span><span class="cp"></span>
<span class="cp">#define TLBnCFG_HES		0x00002000	</span><span class="cm">/* HW select supported */</span><span class="cp"></span>
<span class="cp">#define TLBnCFG_IPROT		0x00008000	</span><span class="cm">/* IPROT supported */</span><span class="cp"></span>
<span class="cp">#define TLBnCFG_GTWE		0x00010000	</span><span class="cm">/* Guest can write */</span><span class="cp"></span>
<span class="cp">#define TLBnCFG_IND		0x00020000	</span><span class="cm">/* IND entries supported */</span><span class="cp"></span>
<span class="cp">#define TLBnCFG_PT		0x00040000	</span><span class="cm">/* Can load from page table */</span><span class="cp"></span>
<span class="cp">#define TLBnCFG_MINSIZE		0x00f00000	</span><span class="cm">/* Minimum Page Size (v1.0) */</span><span class="cp"></span>
<span class="cp">#define TLBnCFG_MINSIZE_SHIFT	20</span>
<span class="cp">#define TLBnCFG_MAXSIZE		0x000f0000	</span><span class="cm">/* Maximum Page Size (v1.0) */</span><span class="cp"></span>
<span class="cp">#define TLBnCFG_MAXSIZE_SHIFT	16</span>
<span class="cp">#define TLBnCFG_ASSOC		0xff000000	</span><span class="cm">/* Associativity */</span><span class="cp"></span>
<span class="cp">#define TLBnCFG_ASSOC_SHIFT	24</span>

<span class="cm">/* TLBnPS encoding */</span>
<span class="cp">#define TLBnPS_4K		0x00000004</span>
<span class="cp">#define TLBnPS_8K		0x00000008</span>
<span class="cp">#define TLBnPS_16K		0x00000010</span>
<span class="cp">#define TLBnPS_32K		0x00000020</span>
<span class="cp">#define TLBnPS_64K		0x00000040</span>
<span class="cp">#define TLBnPS_128K		0x00000080</span>
<span class="cp">#define TLBnPS_256K		0x00000100</span>
<span class="cp">#define TLBnPS_512K		0x00000200</span>
<span class="cp">#define TLBnPS_1M 		0x00000400</span>
<span class="cp">#define TLBnPS_2M 		0x00000800</span>
<span class="cp">#define TLBnPS_4M 		0x00001000</span>
<span class="cp">#define TLBnPS_8M 		0x00002000</span>
<span class="cp">#define TLBnPS_16M		0x00004000</span>
<span class="cp">#define TLBnPS_32M		0x00008000</span>
<span class="cp">#define TLBnPS_64M		0x00010000</span>
<span class="cp">#define TLBnPS_128M		0x00020000</span>
<span class="cp">#define TLBnPS_256M		0x00040000</span>
<span class="cp">#define TLBnPS_512M		0x00080000</span>
<span class="cp">#define TLBnPS_1G		0x00100000</span>
<span class="cp">#define TLBnPS_2G		0x00200000</span>
<span class="cp">#define TLBnPS_4G		0x00400000</span>
<span class="cp">#define TLBnPS_8G		0x00800000</span>
<span class="cp">#define TLBnPS_16G		0x01000000</span>
<span class="cp">#define TLBnPS_32G		0x02000000</span>
<span class="cp">#define TLBnPS_64G		0x04000000</span>
<span class="cp">#define TLBnPS_128G		0x08000000</span>
<span class="cp">#define TLBnPS_256G		0x10000000</span>

<span class="cm">/* tlbilx action encoding */</span>
<span class="cp">#define TLBILX_T_ALL			0</span>
<span class="cp">#define TLBILX_T_TID			1</span>
<span class="cp">#define TLBILX_T_FULLMATCH		3</span>
<span class="cp">#define TLBILX_T_CLASS0			4</span>
<span class="cp">#define TLBILX_T_CLASS1			5</span>
<span class="cp">#define TLBILX_T_CLASS2			6</span>
<span class="cp">#define TLBILX_T_CLASS3			7</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tlbcam_index</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">id</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">active</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">vdso_base</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_PPC_ICSWX</span>
	<span class="k">struct</span> <span class="n">spinlock</span> <span class="o">*</span><span class="n">cop_lockp</span><span class="p">;</span>	<span class="cm">/* guard cop related stuff */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">acop</span><span class="p">;</span>		<span class="cm">/* mask of enabled coprocessor types */</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_PPC_ICSWX */</span><span class="cp"></span>
<span class="cp">#ifdef CONFIG_PPC_MM_SLICES</span>
	<span class="n">u64</span> <span class="n">low_slices_psize</span><span class="p">;</span>   <span class="cm">/* SLB page size encodings */</span>
	<span class="n">u64</span> <span class="n">high_slices_psize</span><span class="p">;</span>  <span class="cm">/* 4 bits per slice for now */</span>
	<span class="n">u16</span> <span class="n">user_psize</span><span class="p">;</span>         <span class="cm">/* page size index */</span>
<span class="cp">#endif</span>
<span class="p">}</span> <span class="n">mm_context_t</span><span class="p">;</span>

<span class="cm">/* Page size definitions, common between 32 and 64-bit</span>
<span class="cm"> *</span>
<span class="cm"> *    shift : is the &quot;PAGE_SHIFT&quot; value for that page size</span>
<span class="cm"> *    penc  : is the pte encoding mask</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">mmu_psize_def</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">shift</span><span class="p">;</span>	<span class="cm">/* number of bits */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">enc</span><span class="p">;</span>	<span class="cm">/* PTE encoding */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>    <span class="n">ind</span><span class="p">;</span>    <span class="cm">/* Corresponding indirect page size shift */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">flags</span><span class="p">;</span>
<span class="cp">#define MMU_PAGE_SIZE_DIRECT	0x1	</span><span class="cm">/* Supported as a direct size */</span><span class="cp"></span>
<span class="cp">#define MMU_PAGE_SIZE_INDIRECT	0x2	</span><span class="cm">/* Supported as an indirect size */</span><span class="cp"></span>
<span class="p">};</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">mmu_psize_def</span> <span class="n">mmu_psize_defs</span><span class="p">[</span><span class="n">MMU_PAGE_COUNT</span><span class="p">];</span>

<span class="cm">/* The page sizes use the same names as 64-bit hash but are</span>
<span class="cm"> * constants</span>
<span class="cm"> */</span>
<span class="cp">#if defined(CONFIG_PPC_4K_PAGES)</span>
<span class="cp">#define mmu_virtual_psize	MMU_PAGE_4K</span>
<span class="cp">#elif defined(CONFIG_PPC_64K_PAGES)</span>
<span class="cp">#define mmu_virtual_psize	MMU_PAGE_64K</span>
<span class="cp">#else</span>
<span class="cp">#error Unsupported page size</span>
<span class="cp">#endif</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">mmu_linear_psize</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mmu_vmemmap_psize</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_PPC64</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">linear_map_top</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * 64-bit booke platforms don&#39;t load the tlb in the tlb miss handler code.</span>
<span class="cm"> * HUGETLB_NEED_PRELOAD handles this - it causes huge_ptep_set_access_flags to</span>
<span class="cm"> * return 1, indicating that the tlb requires preloading.</span>
<span class="cm"> */</span>
<span class="cp">#define HUGETLB_NEED_PRELOAD</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _ASM_POWERPC_MMU_BOOK3E_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
