<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › include › asm › pte-44x.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>pte-44x.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_POWERPC_PTE_44x_H</span>
<span class="cp">#define _ASM_POWERPC_PTE_44x_H</span>
<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/*</span>
<span class="cm"> * Definitions for PPC440</span>
<span class="cm"> *</span>
<span class="cm"> * Because of the 3 word TLB entries to support 36-bit addressing,</span>
<span class="cm"> * the attribute are difficult to map in such a fashion that they</span>
<span class="cm"> * are easily loaded during exception processing.  I decided to</span>
<span class="cm"> * organize the entry so the ERPN is the only portion in the</span>
<span class="cm"> * upper word of the PTE and the attribute bits below are packed</span>
<span class="cm"> * in as sensibly as they can be in the area below a 4KB page size</span>
<span class="cm"> * oriented RPN.  This at least makes it easy to load the RPN and</span>
<span class="cm"> * ERPN fields in the TLB. -Matt</span>
<span class="cm"> *</span>
<span class="cm"> * This isn&#39;t entirely true anymore, at least some bits are now</span>
<span class="cm"> * easier to move into the TLB from the PTE. -BenH.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that these bits preclude future use of a page size</span>
<span class="cm"> * less than 4KB.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * PPC 440 core has following TLB attribute fields;</span>
<span class="cm"> *</span>
<span class="cm"> *   TLB1:</span>
<span class="cm"> *   0  1  2  3  4  ... 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31</span>
<span class="cm"> *   RPN.................................  -  -  -  -  -  - ERPN.......</span>
<span class="cm"> *</span>
<span class="cm"> *   TLB2:</span>
<span class="cm"> *   0  1  2  3  4  ... 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31</span>
<span class="cm"> *   -  -  -  -  -    - U0 U1 U2 U3 W  I  M  G  E   - UX UW UR SX SW SR</span>
<span class="cm"> *</span>
<span class="cm"> * Newer 440 cores (440x6 as used on AMCC 460EX/460GT) have additional</span>
<span class="cm"> * TLB2 storage attibute fields. Those are:</span>
<span class="cm"> *</span>
<span class="cm"> *   TLB2:</span>
<span class="cm"> *   0...10    11   12   13   14   15   16...31</span>
<span class="cm"> *   no change WL1  IL1I IL1D IL2I IL2D no change</span>
<span class="cm"> *</span>
<span class="cm"> * There are some constrains and options, to decide mapping software bits</span>
<span class="cm"> * into TLB entry.</span>
<span class="cm"> *</span>
<span class="cm"> *   - PRESENT *must* be in the bottom three bits because swap cache</span>
<span class="cm"> *     entries use the top 29 bits for TLB2.</span>
<span class="cm"> *</span>
<span class="cm"> *   - FILE *must* be in the bottom three bits because swap cache</span>
<span class="cm"> *     entries use the top 29 bits for TLB2.</span>
<span class="cm"> *</span>
<span class="cm"> *   - CACHE COHERENT bit (M) has no effect on original PPC440 cores,</span>
<span class="cm"> *     because it doesn&#39;t support SMP. However, some later 460 variants</span>
<span class="cm"> *     have -some- form of SMP support and so I keep the bit there for</span>
<span class="cm"> *     future use</span>
<span class="cm"> *</span>
<span class="cm"> * With the PPC 44x Linux implementation, the 0-11th LSBs of the PTE are used</span>
<span class="cm"> * for memory protection related functions (see PTE structure in</span>
<span class="cm"> * include/asm-ppc/mmu.h).  The _PAGE_XXX definitions in this file map to the</span>
<span class="cm"> * above bits.  Note that the bit values are CPU specific, not architecture</span>
<span class="cm"> * specific.</span>
<span class="cm"> *</span>
<span class="cm"> * The kernel PTE entry holds an arch-dependent swp_entry structure under</span>
<span class="cm"> * certain situations. In other words, in such situations some portion of</span>
<span class="cm"> * the PTE bits are used as a swp_entry. In the PPC implementation, the</span>
<span class="cm"> * 3-24th LSB are shared with swp_entry, however the 0-2nd three LSB still</span>
<span class="cm"> * hold protection values. That means the three protection bits are</span>
<span class="cm"> * reserved for both PTE and SWAP entry at the most significant three</span>
<span class="cm"> * LSBs.</span>
<span class="cm"> *</span>
<span class="cm"> * There are three protection bits available for SWAP entry:</span>
<span class="cm"> *	_PAGE_PRESENT</span>
<span class="cm"> *	_PAGE_FILE</span>
<span class="cm"> *	_PAGE_HASHPTE (if HW has)</span>
<span class="cm"> *</span>
<span class="cm"> * So those three bits have to be inside of 0-2nd LSB of PTE.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#define _PAGE_PRESENT	0x00000001		</span><span class="cm">/* S: PTE valid */</span><span class="cp"></span>
<span class="cp">#define _PAGE_RW	0x00000002		</span><span class="cm">/* S: Write permission */</span><span class="cp"></span>
<span class="cp">#define _PAGE_FILE	0x00000004		</span><span class="cm">/* S: nonlinear file mapping */</span><span class="cp"></span>
<span class="cp">#define _PAGE_EXEC	0x00000004		</span><span class="cm">/* H: Execute permission */</span><span class="cp"></span>
<span class="cp">#define _PAGE_ACCESSED	0x00000008		</span><span class="cm">/* S: Page referenced */</span><span class="cp"></span>
<span class="cp">#define _PAGE_DIRTY	0x00000010		</span><span class="cm">/* S: Page dirty */</span><span class="cp"></span>
<span class="cp">#define _PAGE_SPECIAL	0x00000020		</span><span class="cm">/* S: Special page */</span><span class="cp"></span>
<span class="cp">#define _PAGE_USER	0x00000040		</span><span class="cm">/* S: User page */</span><span class="cp"></span>
<span class="cp">#define _PAGE_ENDIAN	0x00000080		</span><span class="cm">/* H: E bit */</span><span class="cp"></span>
<span class="cp">#define _PAGE_GUARDED	0x00000100		</span><span class="cm">/* H: G bit */</span><span class="cp"></span>
<span class="cp">#define _PAGE_COHERENT	0x00000200		</span><span class="cm">/* H: M bit */</span><span class="cp"></span>
<span class="cp">#define _PAGE_NO_CACHE	0x00000400		</span><span class="cm">/* H: I bit */</span><span class="cp"></span>
<span class="cp">#define _PAGE_WRITETHRU	0x00000800		</span><span class="cm">/* H: W bit */</span><span class="cp"></span>

<span class="cm">/* TODO: Add large page lowmem mapping support */</span>
<span class="cp">#define _PMD_PRESENT	0</span>
<span class="cp">#define _PMD_PRESENT_MASK (PAGE_MASK)</span>
<span class="cp">#define _PMD_BAD	(~PAGE_MASK)</span>

<span class="cm">/* ERPN in a PTE never gets cleared, ignore it */</span>
<span class="cp">#define _PTE_NONE_MASK	0xffffffff00000000ULL</span>


<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/*  _ASM_POWERPC_PTE_44x_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
