f | xmon.c | s | 66K | 2863 | Anton Blanchard | anton@samba.org | 1341203411 |  | powerpc/xmon: Use cpumask iterator to avoid warning  We have a bug report where the kernel hits a warning in the cpumask code:  WARNING: at include/linux/cpumask.h:107  Which is:         WARN_ON_ONCE(cpu >= nr_cpumask_bits);  The backtrace is:         cpu_cmd         cmds         xmon_core         xmon         die  xmon is iterating through 0 to NR_CPUS. I'm not sure why we are still open coding this but iterating above nr_cpu_ids is definitely a bug.  This patch iterates through all possible cpus, in case we issue a system reset and CPUs in an offline state call in.  Perhaps the old code was trying to handle CPUs that were in the partition but were never started (eg kexec into a kernel with an nr_cpus= boot option). They are going to die way before we get into xmon since we haven't set any kernel state up for them.  Signed-off-by: Anton Blanchard <anton@samba.org> CC: <stable@kernel.org> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | Makefile | g | 284B |  | matt mooney | mfm@muteddisk.com | 1286947162 |  | powerpc/Makefiles: Change to new flag variables  Replace EXTRA_CFLAGS with ccflags-y and EXTRA_AFLAGS with asflags-y.  Signed-off-by: matt mooney <mfm@muteddisk.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | ppc.h | s | 11K | 244 | Michael Ellerman | michael@ellerman.id.au | 1165225236 |  | [POWERPC] Import updated version of ppc disassembly code for xmon  This includes:  * version 1.24 of ppc-dis.c  * version 1.88 of ppc-opc.c  * version 1.23 of ppc.h  I can't vouch for the accuracy etc. of these changes, but it brings us into line with binutils - and from a cursory test appears to work fine.  Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Arnd Bergmann <arnd.bergmann@de.ibm.com>
f | spu.h | s | 3.6K | 106 | Michael Ellerman | michael@ellerman.id.au | 1165225229 |  | [POWERPC] Import spu disassembly code into xmon  This patch imports and munges the spu disassembly code from binutils.  All files originated from version 1.1 in binutils cvs.  * spu.h, spu-insns.h and spu-opc.c are unchanged except for pathnames.  * spu-dis.c has been edited heavily:    * use printf instead of info->fprintf_func and similar.    * pass the instruction in rather than reading it.    * we have no equivalent to symbol_at_address_func, so we just assume      there is never a symbol at the address given.  Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Arnd Bergmann <arnd.bergmann@de.ibm.com>
f | ppc-opc.c | s | 220K | 4195 | Paul Gortmaker | paul.gortmaker@windriver.com | 1330553708 |  | bug.h: add include of it to various implicit C users  With bug.h currently living right in linux/kernel.h there are files that use BUG_ON and friends but are not including the header explicitly.  Fix them up so we can remove the presence in kernel.h file.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | spu-opc.c | s | 1.7K | 34 | Paul Gortmaker | paul.gortmaker@windriver.com | 1330553708 |  | bug.h: add include of it to various implicit C users  With bug.h currently living right in linux/kernel.h there are files that use BUG_ON and friends but are not including the header explicitly.  Fix them up so we can remove the presence in kernel.h file.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | nonstdio.c | s | 2.5K | 127 | Ishizaki Kou | kou.ishizaki@toshiba.co.jp | 1185103858 |  | [POWERPC] fix showing xmon help  In some configuration, xmon help string is larger than xmon_printf buffer.  We need not to use printf.  This patch adds xmon_puts and change to use it to show help string.  Signed-off-by: Kou Ishizaki <kou.ishizaki@toshiba.co.jp> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | dis-asm.h | s | 895B | 27 | Michael Ellerman | michael@ellerman.id.au | 1165225232 |  | [POWERPC] Make xmon disassembly optional  While adding spu disassembly support it struck me that we're actually carrying quite a lot of code around, just to do disassembly in the case of a crash.  While on large systems it's not an issue, on smaller ones it might be nice to have xmon - but without the weight of the disassembly support. For a Cell build this saves ~230KB (!), and for pSeries ~195KB.  We still support the 'di' and 'sdi' commands, however they just dump the instruction in hex.  Move the definitions into a header to clean xmon.c just a tiny bit.  Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Arnd Bergmann <arnd.bergmann@de.ibm.com>
f | spu-dis.c | s | 6.1K | 223 | Al Viro | viro@ftp.linux.org.uk | 1171041246 |  | [PATCH] arch/powerpc trivial annotations  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | start.c | s | 661B | 30 | Ishizaki Kou | kou.ishizaki@toshiba.co.jp | 1185103858 |  | [POWERPC] Make xmon_write accept a const buffer  Because xmon_write doesn't change the buffer, we should add 'const' qualifier to the argument which points it.  Signed-off-by: Kou Ishizaki <kou.ishizaki@toshiba.co.jp> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | spu-insns.h | s | 29K | 371 | Michael Ellerman | michael@ellerman.id.au | 1165225229 |  | [POWERPC] Import spu disassembly code into xmon  This patch imports and munges the spu disassembly code from binutils.  All files originated from version 1.1 in binutils cvs.  * spu.h, spu-insns.h and spu-opc.c are unchanged except for pathnames.  * spu-dis.c has been edited heavily:    * use printf instead of info->fprintf_func and similar.    * pass the instruction in rather than reading it.    * we have no equivalent to symbol_at_address_func, so we just assume      there is never a symbol at the address given.  Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Arnd Bergmann <arnd.bergmann@de.ibm.com>
f | ansidecl.h | s | 4.3K | 102 | Paul Mackerras | paulus@samba.org | 1130504017 |  | powerpc: Merge xmon  The merged version follows the ppc64 version pretty closely mostly, and in fact ARCH=ppc64 now uses the arch/powerpc/xmon version. The main difference for ppc64 is that the 'p' command to call show_state (which was always pretty dodgy) has been replaced by the ppc32 'p' command, which calls a given procedure (so in fact the old 'p' command behaviour can be achieved with 'p $show_state').  Signed-off-by: Paul Mackerras <paulus@samba.org>
f | nonstdio.h | s | 465B | 13 | Ishizaki Kou | kou.ishizaki@toshiba.co.jp | 1185103858 |  | [POWERPC] fix showing xmon help  In some configuration, xmon help string is larger than xmon_printf buffer.  We need not to use printf.  This patch adds xmon_puts and change to use it to show help string.  Signed-off-by: Kou Ishizaki <kou.ishizaki@toshiba.co.jp> Signed-off-by: Paul Mackerras <paulus@samba.org>
f | ppc-dis.c | s | 5.4K | 164 | Michael Ellerman | michael@ellerman.id.au | 1165225236 |  | [POWERPC] Import updated version of ppc disassembly code for xmon  This includes:  * version 1.24 of ppc-dis.c  * version 1.88 of ppc-opc.c  * version 1.23 of ppc.h  I can't vouch for the accuracy etc. of these changes, but it brings us into line with binutils - and from a cursory test appears to work fine.  Signed-off-by: Michael Ellerman <michael@ellerman.id.au> Signed-off-by: Arnd Bergmann <arnd.bergmann@de.ibm.com>
