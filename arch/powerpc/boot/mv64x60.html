<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › powerpc › boot › mv64x60.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>mv64x60.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Marvell hostbridge routines</span>
<span class="cm"> *</span>
<span class="cm"> * Author: Mark A. Greer &lt;source@mvista.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * 2004, 2005, 2007 (c) MontaVista Software, Inc. This file is licensed under</span>
<span class="cm"> * the terms of the GNU General Public License version 2. This program</span>
<span class="cm"> * is licensed &quot;as is&quot; without any warranty of any kind, whether express</span>
<span class="cm"> * or implied.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;stdarg.h&gt;</span>
<span class="cp">#include &lt;stddef.h&gt;</span>
<span class="cp">#include &quot;types.h&quot;</span>
<span class="cp">#include &quot;elf.h&quot;</span>
<span class="cp">#include &quot;page.h&quot;</span>
<span class="cp">#include &quot;string.h&quot;</span>
<span class="cp">#include &quot;stdio.h&quot;</span>
<span class="cp">#include &quot;io.h&quot;</span>
<span class="cp">#include &quot;ops.h&quot;</span>
<span class="cp">#include &quot;mv64x60.h&quot;</span>

<span class="cp">#define PCI_DEVFN(slot,func)	((((slot) &amp; 0x1f) &lt;&lt; 3) | ((func) &amp; 0x07))</span>

<span class="cp">#define MV64x60_CPU2MEM_WINDOWS			4</span>
<span class="cp">#define MV64x60_CPU2MEM_0_BASE			0x0008</span>
<span class="cp">#define MV64x60_CPU2MEM_0_SIZE			0x0010</span>
<span class="cp">#define MV64x60_CPU2MEM_1_BASE			0x0208</span>
<span class="cp">#define MV64x60_CPU2MEM_1_SIZE			0x0210</span>
<span class="cp">#define MV64x60_CPU2MEM_2_BASE			0x0018</span>
<span class="cp">#define MV64x60_CPU2MEM_2_SIZE			0x0020</span>
<span class="cp">#define MV64x60_CPU2MEM_3_BASE			0x0218</span>
<span class="cp">#define MV64x60_CPU2MEM_3_SIZE			0x0220</span>

<span class="cp">#define MV64x60_ENET2MEM_BAR_ENABLE		0x2290</span>
<span class="cp">#define MV64x60_ENET2MEM_0_BASE			0x2200</span>
<span class="cp">#define MV64x60_ENET2MEM_0_SIZE			0x2204</span>
<span class="cp">#define MV64x60_ENET2MEM_1_BASE			0x2208</span>
<span class="cp">#define MV64x60_ENET2MEM_1_SIZE			0x220c</span>
<span class="cp">#define MV64x60_ENET2MEM_2_BASE			0x2210</span>
<span class="cp">#define MV64x60_ENET2MEM_2_SIZE			0x2214</span>
<span class="cp">#define MV64x60_ENET2MEM_3_BASE			0x2218</span>
<span class="cp">#define MV64x60_ENET2MEM_3_SIZE			0x221c</span>
<span class="cp">#define MV64x60_ENET2MEM_4_BASE			0x2220</span>
<span class="cp">#define MV64x60_ENET2MEM_4_SIZE			0x2224</span>
<span class="cp">#define MV64x60_ENET2MEM_5_BASE			0x2228</span>
<span class="cp">#define MV64x60_ENET2MEM_5_SIZE			0x222c</span>
<span class="cp">#define MV64x60_ENET2MEM_ACC_PROT_0		0x2294</span>
<span class="cp">#define MV64x60_ENET2MEM_ACC_PROT_1		0x2298</span>
<span class="cp">#define MV64x60_ENET2MEM_ACC_PROT_2		0x229c</span>

<span class="cp">#define MV64x60_MPSC2MEM_BAR_ENABLE		0xf250</span>
<span class="cp">#define MV64x60_MPSC2MEM_0_BASE			0xf200</span>
<span class="cp">#define MV64x60_MPSC2MEM_0_SIZE			0xf204</span>
<span class="cp">#define MV64x60_MPSC2MEM_1_BASE			0xf208</span>
<span class="cp">#define MV64x60_MPSC2MEM_1_SIZE			0xf20c</span>
<span class="cp">#define MV64x60_MPSC2MEM_2_BASE			0xf210</span>
<span class="cp">#define MV64x60_MPSC2MEM_2_SIZE			0xf214</span>
<span class="cp">#define MV64x60_MPSC2MEM_3_BASE			0xf218</span>
<span class="cp">#define MV64x60_MPSC2MEM_3_SIZE			0xf21c</span>
<span class="cp">#define MV64x60_MPSC_0_REMAP			0xf240</span>
<span class="cp">#define MV64x60_MPSC_1_REMAP			0xf244</span>
<span class="cp">#define MV64x60_MPSC2MEM_ACC_PROT_0		0xf254</span>
<span class="cp">#define MV64x60_MPSC2MEM_ACC_PROT_1		0xf258</span>
<span class="cp">#define MV64x60_MPSC2REGS_BASE			0xf25c</span>

<span class="cp">#define MV64x60_IDMA2MEM_BAR_ENABLE		0x0a80</span>
<span class="cp">#define MV64x60_IDMA2MEM_0_BASE			0x0a00</span>
<span class="cp">#define MV64x60_IDMA2MEM_0_SIZE			0x0a04</span>
<span class="cp">#define MV64x60_IDMA2MEM_1_BASE			0x0a08</span>
<span class="cp">#define MV64x60_IDMA2MEM_1_SIZE			0x0a0c</span>
<span class="cp">#define MV64x60_IDMA2MEM_2_BASE			0x0a10</span>
<span class="cp">#define MV64x60_IDMA2MEM_2_SIZE			0x0a14</span>
<span class="cp">#define MV64x60_IDMA2MEM_3_BASE			0x0a18</span>
<span class="cp">#define MV64x60_IDMA2MEM_3_SIZE			0x0a1c</span>
<span class="cp">#define MV64x60_IDMA2MEM_4_BASE			0x0a20</span>
<span class="cp">#define MV64x60_IDMA2MEM_4_SIZE			0x0a24</span>
<span class="cp">#define MV64x60_IDMA2MEM_5_BASE			0x0a28</span>
<span class="cp">#define MV64x60_IDMA2MEM_5_SIZE			0x0a2c</span>
<span class="cp">#define MV64x60_IDMA2MEM_6_BASE			0x0a30</span>
<span class="cp">#define MV64x60_IDMA2MEM_6_SIZE			0x0a34</span>
<span class="cp">#define MV64x60_IDMA2MEM_7_BASE			0x0a38</span>
<span class="cp">#define MV64x60_IDMA2MEM_7_SIZE			0x0a3c</span>
<span class="cp">#define MV64x60_IDMA2MEM_ACC_PROT_0		0x0a70</span>
<span class="cp">#define MV64x60_IDMA2MEM_ACC_PROT_1		0x0a74</span>
<span class="cp">#define MV64x60_IDMA2MEM_ACC_PROT_2		0x0a78</span>
<span class="cp">#define MV64x60_IDMA2MEM_ACC_PROT_3		0x0a7c</span>

<span class="cp">#define MV64x60_PCI_ACC_CNTL_WINDOWS		6</span>
<span class="cp">#define MV64x60_PCI0_PCI_DECODE_CNTL		0x0d3c</span>
<span class="cp">#define MV64x60_PCI1_PCI_DECODE_CNTL		0x0dbc</span>

<span class="cp">#define MV64x60_PCI0_BAR_ENABLE			0x0c3c</span>
<span class="cp">#define MV64x60_PCI02MEM_0_SIZE			0x0c08</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_0_BASE_LO		0x1e00</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_0_BASE_HI		0x1e04</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_0_SIZE		0x1e08</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_1_BASE_LO		0x1e10</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_1_BASE_HI		0x1e14</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_1_SIZE		0x1e18</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_2_BASE_LO		0x1e20</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_2_BASE_HI		0x1e24</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_2_SIZE		0x1e28</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_3_BASE_LO		0x1e30</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_3_BASE_HI		0x1e34</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_3_SIZE		0x1e38</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_4_BASE_LO		0x1e40</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_4_BASE_HI		0x1e44</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_4_SIZE		0x1e48</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_5_BASE_LO		0x1e50</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_5_BASE_HI		0x1e54</span>
<span class="cp">#define MV64x60_PCI0_ACC_CNTL_5_SIZE		0x1e58</span>

<span class="cp">#define MV64x60_PCI1_BAR_ENABLE			0x0cbc</span>
<span class="cp">#define MV64x60_PCI12MEM_0_SIZE			0x0c88</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_0_BASE_LO		0x1e80</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_0_BASE_HI		0x1e84</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_0_SIZE		0x1e88</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_1_BASE_LO		0x1e90</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_1_BASE_HI		0x1e94</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_1_SIZE		0x1e98</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_2_BASE_LO		0x1ea0</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_2_BASE_HI		0x1ea4</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_2_SIZE		0x1ea8</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_3_BASE_LO		0x1eb0</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_3_BASE_HI		0x1eb4</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_3_SIZE		0x1eb8</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_4_BASE_LO		0x1ec0</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_4_BASE_HI		0x1ec4</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_4_SIZE		0x1ec8</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_5_BASE_LO		0x1ed0</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_5_BASE_HI		0x1ed4</span>
<span class="cp">#define MV64x60_PCI1_ACC_CNTL_5_SIZE		0x1ed8</span>

<span class="cp">#define MV64x60_CPU2PCI_SWAP_NONE		0x01000000</span>

<span class="cp">#define MV64x60_CPU2PCI0_IO_BASE		0x0048</span>
<span class="cp">#define MV64x60_CPU2PCI0_IO_SIZE		0x0050</span>
<span class="cp">#define MV64x60_CPU2PCI0_IO_REMAP		0x00f0</span>
<span class="cp">#define MV64x60_CPU2PCI0_MEM_0_BASE		0x0058</span>
<span class="cp">#define MV64x60_CPU2PCI0_MEM_0_SIZE		0x0060</span>
<span class="cp">#define MV64x60_CPU2PCI0_MEM_0_REMAP_LO		0x00f8</span>
<span class="cp">#define MV64x60_CPU2PCI0_MEM_0_REMAP_HI		0x0320</span>

<span class="cp">#define MV64x60_CPU2PCI1_IO_BASE		0x0090</span>
<span class="cp">#define MV64x60_CPU2PCI1_IO_SIZE		0x0098</span>
<span class="cp">#define MV64x60_CPU2PCI1_IO_REMAP		0x0108</span>
<span class="cp">#define MV64x60_CPU2PCI1_MEM_0_BASE		0x00a0</span>
<span class="cp">#define MV64x60_CPU2PCI1_MEM_0_SIZE		0x00a8</span>
<span class="cp">#define MV64x60_CPU2PCI1_MEM_0_REMAP_LO		0x0110</span>
<span class="cp">#define MV64x60_CPU2PCI1_MEM_0_REMAP_HI		0x0340</span>

<span class="k">struct</span> <span class="n">mv64x60_mem_win</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">hi</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">lo</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mv64x60_pci_win</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">fcn</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">hi</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">lo</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">size</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* PCI config access routines */</span>
<span class="k">struct</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">addr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span> <span class="k">static</span> <span class="n">mv64x60_pci_cfgio</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="cm">/* hose 0 */</span>
		<span class="p">.</span><span class="n">addr</span>	<span class="o">=</span> <span class="mh">0xcf8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">data</span>	<span class="o">=</span> <span class="mh">0xcfc</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="cm">/* hose 1 */</span>
		<span class="p">.</span><span class="n">addr</span>	<span class="o">=</span> <span class="mh">0xc78</span><span class="p">,</span>
		<span class="p">.</span><span class="n">data</span>	<span class="o">=</span> <span class="mh">0xc7c</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="n">u32</span> <span class="nf">mv64x60_cfg_read</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">bridge_base</span><span class="p">,</span> <span class="n">u8</span> <span class="n">hose</span><span class="p">,</span> <span class="n">u8</span> <span class="n">bus</span><span class="p">,</span> <span class="n">u8</span> <span class="n">devfn</span><span class="p">,</span> <span class="n">u8</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_pci_cfgio</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">addr</span><span class="p">),</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">bus</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">devfn</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">offset</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">in_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_pci_cfgio</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">data</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">mv64x60_cfg_write</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">bridge_base</span><span class="p">,</span> <span class="n">u8</span> <span class="n">hose</span><span class="p">,</span> <span class="n">u8</span> <span class="n">bus</span><span class="p">,</span> <span class="n">u8</span> <span class="n">devfn</span><span class="p">,</span> <span class="n">u8</span> <span class="n">offset</span><span class="p">,</span>
		<span class="n">u32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_pci_cfgio</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">addr</span><span class="p">),</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">bus</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">devfn</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">offset</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_pci_cfgio</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">data</span><span class="p">),</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* I/O ctlr -&gt; system memory setup */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mv64x60_mem_win</span> <span class="n">mv64x60_cpu2mem</span><span class="p">[</span><span class="n">MV64x60_CPU2MEM_WINDOWS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2MEM_0_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2MEM_0_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2MEM_1_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2MEM_1_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2MEM_2_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2MEM_2_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2MEM_3_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2MEM_3_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mv64x60_mem_win</span> <span class="n">mv64x60_enet2mem</span><span class="p">[</span><span class="n">MV64x60_CPU2MEM_WINDOWS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_ENET2MEM_0_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_ENET2MEM_0_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_ENET2MEM_1_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_ENET2MEM_1_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_ENET2MEM_2_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_ENET2MEM_2_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_ENET2MEM_3_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_ENET2MEM_3_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mv64x60_mem_win</span> <span class="n">mv64x60_mpsc2mem</span><span class="p">[</span><span class="n">MV64x60_CPU2MEM_WINDOWS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_MPSC2MEM_0_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_MPSC2MEM_0_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_MPSC2MEM_1_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_MPSC2MEM_1_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_MPSC2MEM_2_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_MPSC2MEM_2_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_MPSC2MEM_3_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_MPSC2MEM_3_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mv64x60_mem_win</span> <span class="n">mv64x60_idma2mem</span><span class="p">[</span><span class="n">MV64x60_CPU2MEM_WINDOWS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_IDMA2MEM_0_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_IDMA2MEM_0_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_IDMA2MEM_1_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_IDMA2MEM_1_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_IDMA2MEM_2_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_IDMA2MEM_2_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_IDMA2MEM_3_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_IDMA2MEM_3_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">u32</span> <span class="n">mv64x60_dram_selects</span><span class="p">[</span><span class="n">MV64x60_CPU2MEM_WINDOWS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0xe</span><span class="p">,</span><span class="mh">0xd</span><span class="p">,</span><span class="mh">0xb</span><span class="p">,</span><span class="mh">0x7</span><span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * ENET, MPSC, and IDMA ctlrs on the MV64x60 have separate windows that</span>
<span class="cm"> * must be set up so that the respective ctlr can access system memory.</span>
<span class="cm"> * Configure them to be same as cpu-&gt;memory windows.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">mv64x60_config_ctlr_windows</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">bridge_base</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">bridge_pbase</span><span class="p">,</span>
		<span class="n">u8</span> <span class="n">is_coherent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">enables</span><span class="p">,</span> <span class="n">prot</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">snoop_bits</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Disable ctlr-&gt;mem windows */</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_ENET2MEM_BAR_ENABLE</span><span class="p">),</span> <span class="mh">0x3f</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_MPSC2MEM_BAR_ENABLE</span><span class="p">),</span> <span class="mh">0xf</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_ENET2MEM_BAR_ENABLE</span><span class="p">),</span> <span class="mh">0xff</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">is_coherent</span><span class="p">)</span>
		<span class="n">snoop_bits</span> <span class="o">=</span> <span class="mh">0x2</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">;</span> <span class="cm">/* Writeback */</span>

	<span class="n">enables</span> <span class="o">=</span> <span class="n">in_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_CPU_BAR_ENABLE</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">MV64x60_CPU2MEM_WINDOWS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">enables</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span> <span class="cm">/* Set means disabled */</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="n">base</span> <span class="o">=</span> <span class="n">in_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_cpu2mem</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lo</span><span class="p">))</span>
			<span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">base</span> <span class="o">|=</span> <span class="n">snoop_bits</span> <span class="o">|</span> <span class="p">(</span><span class="n">mv64x60_dram_selects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
		<span class="n">size</span> <span class="o">=</span> <span class="n">in_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_cpu2mem</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">))</span>
			<span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">prot</span> <span class="o">|=</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span> <span class="cm">/* RW access */</span>

		<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_enet2mem</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lo</span><span class="p">),</span> <span class="n">base</span><span class="p">);</span>
		<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_enet2mem</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">),</span> <span class="n">size</span><span class="p">);</span>
		<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_mpsc2mem</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lo</span><span class="p">),</span> <span class="n">base</span><span class="p">);</span>
		<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_mpsc2mem</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">),</span> <span class="n">size</span><span class="p">);</span>
		<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_idma2mem</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lo</span><span class="p">),</span> <span class="n">base</span><span class="p">);</span>
		<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_idma2mem</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">),</span> <span class="n">size</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_ENET2MEM_ACC_PROT_0</span><span class="p">),</span> <span class="n">prot</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_ENET2MEM_ACC_PROT_1</span><span class="p">),</span> <span class="n">prot</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_ENET2MEM_ACC_PROT_2</span><span class="p">),</span> <span class="n">prot</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_MPSC2MEM_ACC_PROT_0</span><span class="p">),</span> <span class="n">prot</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_MPSC2MEM_ACC_PROT_1</span><span class="p">),</span> <span class="n">prot</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_IDMA2MEM_ACC_PROT_0</span><span class="p">),</span> <span class="n">prot</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_IDMA2MEM_ACC_PROT_1</span><span class="p">),</span> <span class="n">prot</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_IDMA2MEM_ACC_PROT_2</span><span class="p">),</span> <span class="n">prot</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_IDMA2MEM_ACC_PROT_3</span><span class="p">),</span> <span class="n">prot</span><span class="p">);</span>

	<span class="cm">/* Set mpsc-&gt;bridge&#39;s reg window to the bridge&#39;s internal registers. */</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_MPSC2REGS_BASE</span><span class="p">),</span>
			<span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">bridge_pbase</span><span class="p">);</span>

	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_ENET2MEM_BAR_ENABLE</span><span class="p">),</span> <span class="n">enables</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_MPSC2MEM_BAR_ENABLE</span><span class="p">),</span> <span class="n">enables</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_IDMA2MEM_BAR_ENABLE</span><span class="p">),</span> <span class="n">enables</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* PCI MEM -&gt; system memory, et. al. setup */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mv64x60_pci_win</span> <span class="n">mv64x60_pci2mem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="cm">/* hose 0 */</span>
		<span class="p">.</span><span class="n">fcn</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="mh">0x14</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_PCI02MEM_0_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="cm">/* hose 1 */</span>
		<span class="p">.</span><span class="n">fcn</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="mh">0x94</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="mh">0x90</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_PCI12MEM_0_SIZE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span>
<span class="n">mv64x60_mem_win</span> <span class="n">mv64x60_pci_acc</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">MV64x60_PCI_ACC_CNTL_WINDOWS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="cm">/* hose 0 */</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_0_BASE_HI</span><span class="p">,</span>
			<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_0_BASE_LO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_0_SIZE</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_1_BASE_HI</span><span class="p">,</span>
			<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_1_BASE_LO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_1_SIZE</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_2_BASE_HI</span><span class="p">,</span>
			<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_2_BASE_LO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_2_SIZE</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_3_BASE_HI</span><span class="p">,</span>
			<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_3_BASE_LO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_PCI0_ACC_CNTL_3_SIZE</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="cm">/* hose 1 */</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_0_BASE_HI</span><span class="p">,</span>
			<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_0_BASE_LO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_0_SIZE</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_1_BASE_HI</span><span class="p">,</span>
			<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_1_BASE_LO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_1_SIZE</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_2_BASE_HI</span><span class="p">,</span>
			<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_2_BASE_LO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_2_SIZE</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_3_BASE_HI</span><span class="p">,</span>
			<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_3_BASE_LO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="n">MV64x60_PCI1_ACC_CNTL_3_SIZE</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mv64x60_mem_win</span> <span class="n">mv64x60_pci2reg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="mh">0x24</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">hi</span>	<span class="o">=</span> <span class="mh">0xa4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lo</span>	<span class="o">=</span> <span class="mh">0xa0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Only need to use 1 window (per hose) to get access to all of system memory */</span>
<span class="kt">void</span> <span class="nf">mv64x60_config_pci_windows</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">bridge_base</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">bridge_pbase</span><span class="p">,</span> <span class="n">u8</span> <span class="n">hose</span><span class="p">,</span>
		<span class="n">u8</span> <span class="n">bus</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mem_size</span><span class="p">,</span> <span class="n">u32</span> <span class="n">acc_bits</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">bar_enable</span><span class="p">,</span> <span class="n">enables</span><span class="p">;</span>

	<span class="cm">/* Disable all windows but PCI MEM -&gt; Bridge&#39;s regs window */</span>
	<span class="n">enables</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>
	<span class="n">bar_enable</span> <span class="o">=</span> <span class="n">hose</span> <span class="o">?</span> <span class="n">MV64x60_PCI1_BAR_ENABLE</span> <span class="o">:</span> <span class="n">MV64x60_PCI0_BAR_ENABLE</span><span class="p">;</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">bar_enable</span><span class="p">),</span> <span class="n">enables</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">MV64x60_PCI_ACC_CNTL_WINDOWS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_pci_acc</span><span class="p">[</span><span class="n">hose</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">lo</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* If mem_size is 0, leave windows disabled */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mem_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="cm">/* Cause automatic updates of PCI remap regs */</span>
	<span class="n">offset</span> <span class="o">=</span> <span class="n">hose</span> <span class="o">?</span>
		<span class="n">MV64x60_PCI1_PCI_DECODE_CNTL</span> <span class="o">:</span> <span class="n">MV64x60_PCI0_PCI_DECODE_CNTL</span><span class="p">;</span>
	<span class="n">i</span> <span class="o">=</span> <span class="n">in_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">offset</span><span class="p">));</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">offset</span><span class="p">),</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x1</span><span class="p">);</span>

	<span class="n">mem_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">mem_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xfffff000</span><span class="p">;</span>

	<span class="cm">/* Map PCI MEM addr 0 -&gt; System Mem addr 0 */</span>
	<span class="n">mv64x60_cfg_write</span><span class="p">(</span><span class="n">bridge_base</span><span class="p">,</span> <span class="n">hose</span><span class="p">,</span> <span class="n">bus</span><span class="p">,</span>
			<span class="n">PCI_DEVFN</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mv64x60_pci2mem</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">fcn</span><span class="p">),</span>
			<span class="n">mv64x60_pci2mem</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">hi</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mv64x60_cfg_write</span><span class="p">(</span><span class="n">bridge_base</span><span class="p">,</span> <span class="n">hose</span><span class="p">,</span> <span class="n">bus</span><span class="p">,</span>
			<span class="n">PCI_DEVFN</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mv64x60_pci2mem</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">fcn</span><span class="p">),</span>
			<span class="n">mv64x60_pci2mem</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">lo</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_pci2mem</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">size</span><span class="p">),</span><span class="n">mem_size</span><span class="p">);</span>

	<span class="n">acc_bits</span> <span class="o">|=</span> <span class="n">MV64x60_PCI_ACC_CNTL_ENABLE</span><span class="p">;</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_pci_acc</span><span class="p">[</span><span class="n">hose</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">hi</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_pci_acc</span><span class="p">[</span><span class="n">hose</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">lo</span><span class="p">),</span> <span class="n">acc_bits</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">mv64x60_pci_acc</span><span class="p">[</span><span class="n">hose</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span><span class="p">),</span><span class="n">mem_size</span><span class="p">);</span>

	<span class="cm">/* Set PCI MEM-&gt;bridge&#39;s reg window to where they are in CPU mem map */</span>
	<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">bridge_base</span><span class="p">;</span>
	<span class="n">i</span> <span class="o">&amp;=</span> <span class="mh">0xffff0000</span><span class="p">;</span>
	<span class="n">i</span> <span class="o">|=</span> <span class="p">(</span><span class="mh">0x2</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">mv64x60_cfg_write</span><span class="p">(</span><span class="n">bridge_base</span><span class="p">,</span> <span class="n">hose</span><span class="p">,</span> <span class="n">bus</span><span class="p">,</span> <span class="n">PCI_DEVFN</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
			<span class="n">mv64x60_pci2reg</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">hi</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mv64x60_cfg_write</span><span class="p">(</span><span class="n">bridge_base</span><span class="p">,</span> <span class="n">hose</span><span class="p">,</span> <span class="n">bus</span><span class="p">,</span> <span class="n">PCI_DEVFN</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
			<span class="n">mv64x60_pci2reg</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">lo</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>

	<span class="n">enables</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x1</span><span class="p">;</span> <span class="cm">/* Enable PCI MEM -&gt; System Mem window 0 */</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">bar_enable</span><span class="p">),</span> <span class="n">enables</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* CPU -&gt; PCI I/O &amp; MEM setup */</span>
<span class="k">struct</span> <span class="n">mv64x60_cpu2pci_win</span> <span class="n">mv64x60_cpu2pci_io</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="cm">/* hose 0 */</span>
		<span class="p">.</span><span class="n">lo</span>		<span class="o">=</span> <span class="n">MV64x60_CPU2PCI0_IO_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>		<span class="o">=</span> <span class="n">MV64x60_CPU2PCI0_IO_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">remap_hi</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">remap_lo</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2PCI0_IO_REMAP</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="cm">/* hose 1 */</span>
		<span class="p">.</span><span class="n">lo</span>		<span class="o">=</span> <span class="n">MV64x60_CPU2PCI1_IO_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>		<span class="o">=</span> <span class="n">MV64x60_CPU2PCI1_IO_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">remap_hi</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">remap_lo</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2PCI1_IO_REMAP</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mv64x60_cpu2pci_win</span> <span class="n">mv64x60_cpu2pci_mem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="cm">/* hose 0 */</span>
		<span class="p">.</span><span class="n">lo</span>		<span class="o">=</span> <span class="n">MV64x60_CPU2PCI0_MEM_0_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>		<span class="o">=</span> <span class="n">MV64x60_CPU2PCI0_MEM_0_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">remap_hi</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2PCI0_MEM_0_REMAP_HI</span><span class="p">,</span>
		<span class="p">.</span><span class="n">remap_lo</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2PCI0_MEM_0_REMAP_LO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="cm">/* hose 1 */</span>
		<span class="p">.</span><span class="n">lo</span>		<span class="o">=</span> <span class="n">MV64x60_CPU2PCI1_MEM_0_BASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>		<span class="o">=</span> <span class="n">MV64x60_CPU2PCI1_MEM_0_SIZE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">remap_hi</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2PCI1_MEM_0_REMAP_HI</span><span class="p">,</span>
		<span class="p">.</span><span class="n">remap_lo</span>	<span class="o">=</span> <span class="n">MV64x60_CPU2PCI1_MEM_0_REMAP_LO</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Only need to set up 1 window to pci mem space */</span>
<span class="kt">void</span> <span class="nf">mv64x60_config_cpu2pci_window</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">bridge_base</span><span class="p">,</span> <span class="n">u8</span> <span class="n">hose</span><span class="p">,</span> <span class="n">u32</span> <span class="n">pci_base_hi</span><span class="p">,</span>
		<span class="n">u32</span> <span class="n">pci_base_lo</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cpu_base</span><span class="p">,</span> <span class="n">u32</span> <span class="n">size</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">mv64x60_cpu2pci_win</span> <span class="o">*</span><span class="n">offset_tbl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">cpu_base</span> <span class="o">&gt;&gt;=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">cpu_base</span> <span class="o">|=</span> <span class="n">MV64x60_CPU2PCI_SWAP_NONE</span><span class="p">;</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">offset_tbl</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">lo</span><span class="p">),</span> <span class="n">cpu_base</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">offset_tbl</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">remap_hi</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">offset_tbl</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">remap_hi</span><span class="p">),</span>
				<span class="n">pci_base_hi</span><span class="p">);</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">offset_tbl</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">remap_lo</span><span class="p">),</span>
			<span class="n">pci_base_lo</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>

	<span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">out_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">offset_tbl</span><span class="p">[</span><span class="n">hose</span><span class="p">].</span><span class="n">size</span><span class="p">),</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Read mem ctlr to get the amount of mem in system */</span>
<span class="n">u32</span> <span class="nf">mv64x60_get_mem_size</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">bridge_base</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">enables</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">enables</span> <span class="o">=</span> <span class="n">in_le32</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span> <span class="o">+</span> <span class="n">MV64x60_CPU_BAR_ENABLE</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">MV64x60_CPU2MEM_WINDOWS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">enables</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)))</span> <span class="p">{</span>
			<span class="n">v</span> <span class="o">=</span> <span class="n">in_le32</span><span class="p">((</span><span class="n">u32</span><span class="o">*</span><span class="p">)(</span><span class="n">bridge_base</span>
						<span class="o">+</span> <span class="n">mv64x60_cpu2mem</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">));</span>
			<span class="n">v</span> <span class="o">=</span> <span class="p">((</span><span class="n">v</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">;</span>
			<span class="n">mem</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
		<span class="p">}</span>

	<span class="k">return</span> <span class="n">mem</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Get physical address of bridge&#39;s registers */</span>
<span class="n">u8</span> <span class="o">*</span><span class="nf">mv64x60_get_bridge_pbase</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">devp</span><span class="p">;</span>

	<span class="n">devp</span> <span class="o">=</span> <span class="n">find_node_by_compatible</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;marvell,mv64360&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">devp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err_out</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">getprop</span><span class="p">(</span><span class="n">devp</span><span class="p">,</span> <span class="s">&quot;reg&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">err_out</span><span class="p">;</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="nl">err_out:</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Get virtual address of bridge&#39;s registers */</span>
<span class="n">u8</span> <span class="o">*</span><span class="nf">mv64x60_get_bridge_base</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">v</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">devp</span><span class="p">;</span>

	<span class="n">devp</span> <span class="o">=</span> <span class="n">find_node_by_compatible</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;marvell,mv64360&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">devp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err_out</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">getprop</span><span class="p">(</span><span class="n">devp</span><span class="p">,</span> <span class="s">&quot;virtual-reg&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">!=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">err_out</span><span class="p">;</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">v</span><span class="p">;</span>

<span class="nl">err_out:</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u8</span> <span class="nf">mv64x60_is_coherent</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">v</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">devp</span><span class="p">;</span>

	<span class="n">devp</span> <span class="o">=</span> <span class="n">finddevice</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">devp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* Assume coherency on */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">getprop</span><span class="p">(</span><span class="n">devp</span><span class="p">,</span> <span class="s">&quot;coherency-off&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* Coherency on */</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
