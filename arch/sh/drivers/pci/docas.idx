f | pci.c | s | 7.7K | 278 | Linus Torvalds | torvalds@linux-foundation.org | 1332536532 |  | Merge branch 'linux-next' of git://git.kernel.org/pub/scm/linux/kernel/git/jbarnes/pci  Pull PCI changes (including maintainer change) from Jesse Barnes:  "This pull has some good cleanups from Bjorn and Yinghai, as well as   some more code from Yinghai to better handle resource re-allocation   when enabled.    There's also a new initcall_debug feature from Arjan which will print   out quirk timing information to help identify slow quirks for fixing   or refinement (Yinghai sent in a few patches to do just that once the   new debug code landed).    Beyond that, I'm handing off PCI maintainership to Bjorn Helgaas.   He's been a core PCI and Linux contributor for some time now, and has   kindly volunteered to take over.  I just don't feel I have the time   for PCI review and work that it deserves lately (I've taken on some   other projects), and haven't been as responsive lately as I'd like, so   I approached Bjorn asking if he'd like to manage things.  He's going   to give it a try, and I'm confident he'll do at least as well as I   have in keeping the tree managed, patches flowing, and keeping things   stable."  Fix up some fairly trivial conflicts due to other cleanups (mips device resource fixup cleanups clashing with list handling cleanup, ppc iseries removal clashing with pci_probe_only cleanup etc)  * 'linux-next' of git://git.kernel.org/pub/scm/linux/kernel/git/jbarnes/pci: (112 commits)   PCI: Bjorn gets PCI hotplug too   PCI: hand PCI maintenance over to Bjorn Helgaas   unicore32/PCI: move <asm-generic/pci-bridge.h> include to asm/pci.h   sparc/PCI: convert devtree and arch-probed bus addresses to resource   powerpc/PCI: allow reallocation on PA Semi   powerpc/PCI: convert devtree bus addresses to resource   powerpc/PCI: compute I/O space bus-to-resource offset consistently   arm/PCI: don't export pci_flags   PCI: fix bridge I/O window bus-to-resource conversion   x86/PCI: add spinlock held check to 'pcibios_fwaddrmap_lookup()'   PCI / PCIe: Introduce command line option to disable ARI   PCI: make acpihp use __pci_remove_bus_device instead   PCI: export __pci_remove_bus_device   PCI: Rename pci_remove_behind_bridge to pci_stop_and_remove_behind_bridge   PCI: Rename pci_remove_bus_device to pci_stop_and_remove_bus_device   PCI: print out PCI device info along with duration   PCI: Move "pci reassigndev resource alignment" out of quirks.c   PCI: Use class for quirk for usb host controller fixup   PCI: Use class for quirk for ti816x class fixup   PCI: Use class for quirk for intel e100 interrupt fixup   ...
f | Makefile | g | 1.2K |  | Paul Mundt | lethal@linux-sh.org | 1287009421 |  | sh: pci: Support slot 4 routing on SDK7786.  SDK7786 supports connecting either slot3 or 4 to the same PCIe port by way of FPGA muxing. By default the vertical slot 3 on the baseboard is enabled, so this adds in a command line option for forcibly enabling the slot 4 edge connector.  If nothing has been specified on the command line, we fall back to reading the resistor values for card presence to figure out where to route the port to.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | common.c | s | 3.9K | 137 | Paul Mundt | lethal@linux-sh.org | 1265183180 |  | sh: Fix up early PCI PERR/SERR IRQ handling.  This adds support for handling early PERR/SERR triggering in between controller registration and the initial bus scan. Buggy cards end up asserting these as soon as the M66EN scan is undertaken, resulting in an early crash.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | pci-sh5.c | s | 5.8K | 179 | Yong Zhang | yong.zhang0@gmail.com | 1319780368 |  | SH: irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | pci-sh7780.c | s | 11K | 353 | Thomas Schwinge | thomas@codesourcery.com | 1332912510 |  | SH: pci-sh7780: enable big-endian operation.  If in big-endian mode, switch the PCI bus, too.  Tested on both litte-endian and big-endian sh7785lcr.  Signed-off-by: Thomas Schwinge <thomas@codesourcery.com> Cc: Paul Mundt <lethal@linux-sh.org> Cc: linux-sh@vger.kernel.org Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | pci-dreamcast.c | s | 2.4K | 84 | Paul Mundt | lethal@linux-sh.org | 1265022110 |  | sh: Improved multi-resource handling for SH7780 PCI.  The SH7780 PCI controller supports 3 different ranges of PCI memory in addition to its PCI I/O window. In the case of 29-bit mode, only 2 memory windows are supported, while in 32-bit mode all 3 are visible. This attempts to make the resource handling completely dynamic and to permit platforms to map in as many apertures as they can handle.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | pci-sh5.h | s | 5.2K | 93 | Paul Mundt | lethal@linux-sh.org | 1264478320 |  | sh: Mass ctrl_in/outX to __raw_read/writeX conversion.  The old ctrl in/out routines are non-portable and unsuitable for cross-platform use. While drivers/sh has already been sanitized, there is still quite a lot of code that is not. This converts the arch/sh/ bits over, which permits us to flag the routines as deprecated whilst still building with -Werror for the architecture code, and to ensure that future users are not added.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | pci-sh7751.h | s | 7.7K | 121 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | ops-sh7786.c | s | 4.7K | 144 | Paul Mundt | lethal@linux-sh.org | 1284976573 |  | sh: pci: Use a generic raw spinlock for PCI config access locking.  This copies the pci_config_lock idea from x86 over, allowing us to kill off a couple of existing private locks. At the same time, these need to be converted to raw spinlocks for -rt kernels, so we make that change at the same time. This should make it easier for future parts to get the locking right instead of inevitable ending up with lock type mismatches.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | fixups-dreamcast.c | s | 2.1K | 69 | Ralf Baechle | ralf@linux-mips.org | 1311348366 |  | PCI: Make the struct pci_dev * argument of pci_fixup_irqs const.  Aside of the usual motivation for constification,  this function has a history of being abused a hook for interrupt and other fixups so I turned this function const ages ago in the MIPS code but it should be done treewide.  Due to function pointer passing in varous places a few other functions had to be constified as well.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> To: Anton Vorontsov <avorontsov@mvista.com> To: Chris Metcalf <cmetcalf@tilera.com> To: Colin Cross <ccross@android.com> Acked-by: "David S. Miller" <davem@davemloft.net> To: Eric Miao <eric.y.miao@gmail.com> To: Erik Gilling <konkers@android.com> Acked-by: Guan Xuetao <gxt@mprc.pku.edu.cn> To: "H. Peter Anvin" <hpa@zytor.com> To: Imre Kaloz <kaloz@openwrt.org> To: Ingo Molnar <mingo@redhat.com> To: Ivan Kokshaysky <ink@jurassic.park.msu.ru> To: Jesse Barnes <jbarnes@virtuousgeek.org> To: Krzysztof Halasa <khc@pm.waw.pl> To: Lennert Buytenhek <kernel@wantstofly.org> To: Matt Turner <mattst88@gmail.com> To: Nicolas Pitre <nico@fluxnic.net> To: Olof Johansson <olof@lixom.net> Acked-by: Paul Mundt <lethal@linux-sh.org> To: Richard Henderson <rth@twiddle.net> To: Russell King <linux@arm.linux.org.uk> To: Thomas Gleixner <tglx@linutronix.de> Cc: Andrew Morton <akpm@linux-foundation.org> Cc: linux-alpha@vger.kernel.org Cc: linux-arm-kernel@lists.infradead.org Cc: linux-kernel@vger.kernel.org Cc: linux-mips@linux-mips.org Cc: linux-pci@vger.kernel.org Cc: linux-sh@vger.kernel.org Cc: linux-tegra@vger.kernel.org Cc: sparclinux@vger.kernel.org Cc: x86@kernel.org Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>
f | pci-sh4.h | s | 9.5K | 179 | Paul Mundt | lethal@linux-sh.org | 1264783281 |  | sh: Kill off broken type 1 PCI config access checks.  The host controllers only support type 1, so there's not much else to test for. Some of the older controllers also supported type 2 accesses, but we've never supported those, and likely never will. Beyond that, the P1SEG test is meaningless for 32-bit mode, so rather than refactoring it, just kill the type 1 test off completely.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | ops-dreamcast.c | s | 2.6K | 72 | Huang Weiyi | weiyi.huang@gmail.com | 1244969323 |  | sh: pci: remove duplicated #include's  Signed-off-by: Huang Weiyi <weiyi.huang@gmail.com> Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | fixups-snapgear.c | s | 1.1K | 35 | Paul Mundt | lethal@linux-sh.org | 1337330549 |  | sh: legacy PCI evt2irq migration.  This converts over the legacy PCI IRQs to evt2irq() backed hwirq lookups.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | pcie-sh7786.h | s | 25K | 515 | Paul Mundt | lethal@linux-sh.org | 1287090956 |  | sh: pci: Convert to upper/lower_32_bits() helpers.  Instead of hand-rolling our own, just use the generic ones instead.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | fixups-titan.c | s | 930B | 34 | Ralf Baechle | ralf@linux-mips.org | 1311348366 |  | PCI: Make the struct pci_dev * argument of pci_fixup_irqs const.  Aside of the usual motivation for constification,  this function has a history of being abused a hook for interrupt and other fixups so I turned this function const ages ago in the MIPS code but it should be done treewide.  Due to function pointer passing in varous places a few other functions had to be constified as well.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> To: Anton Vorontsov <avorontsov@mvista.com> To: Chris Metcalf <cmetcalf@tilera.com> To: Colin Cross <ccross@android.com> Acked-by: "David S. Miller" <davem@davemloft.net> To: Eric Miao <eric.y.miao@gmail.com> To: Erik Gilling <konkers@android.com> Acked-by: Guan Xuetao <gxt@mprc.pku.edu.cn> To: "H. Peter Anvin" <hpa@zytor.com> To: Imre Kaloz <kaloz@openwrt.org> To: Ingo Molnar <mingo@redhat.com> To: Ivan Kokshaysky <ink@jurassic.park.msu.ru> To: Jesse Barnes <jbarnes@virtuousgeek.org> To: Krzysztof Halasa <khc@pm.waw.pl> To: Lennert Buytenhek <kernel@wantstofly.org> To: Matt Turner <mattst88@gmail.com> To: Nicolas Pitre <nico@fluxnic.net> To: Olof Johansson <olof@lixom.net> Acked-by: Paul Mundt <lethal@linux-sh.org> To: Richard Henderson <rth@twiddle.net> To: Russell King <linux@arm.linux.org.uk> To: Thomas Gleixner <tglx@linutronix.de> Cc: Andrew Morton <akpm@linux-foundation.org> Cc: linux-alpha@vger.kernel.org Cc: linux-arm-kernel@lists.infradead.org Cc: linux-kernel@vger.kernel.org Cc: linux-mips@linux-mips.org Cc: linux-pci@vger.kernel.org Cc: linux-sh@vger.kernel.org Cc: linux-tegra@vger.kernel.org Cc: sparclinux@vger.kernel.org Cc: x86@kernel.org Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>
f | ops-sh5.c | s | 1.5K | 61 | Paul Mundt | lethal@linux-sh.org | 1240224887 |  | sh: pci: Kill off legacy ide quirks.  These fixups seem to have bitrotted a bit since their introduction in the 2.4 days. As we never had much use for them in the first place, and nothing is using them any more, kill them off the rest of the way.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | fixups-sh03.c | s | 826B | 30 | Paul Mundt | lethal@linux-sh.org | 1337330549 |  | sh: legacy PCI evt2irq migration.  This converts over the legacy PCI IRQs to evt2irq() backed hwirq lookups.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | fixups-se7751.c | s | 4.1K | 95 | Paul Mundt | lethal@linux-sh.org | 1337330549 |  | sh: legacy PCI evt2irq migration.  This converts over the legacy PCI IRQs to evt2irq() backed hwirq lookups.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | pci-sh7751.c | s | 5.4K | 156 | Matt Fleming | matt@console-pimps.org | 1277280596 |  | sh: Fix typos in PCI initialization message  This typo seems to have been copy and pasted in the PCI initialization code. Replace 'intialization' with 'initialization'.  Signed-off-by: Matt Fleming <matt@console-pimps.org>
f | fixups-sdk7786.c | s | 1.7K | 58 | Paul Mundt | lethal@linux-sh.org | 1287013495 |  | sh: pci: Support secondary FPGA-driven PCIe clocks on SDK7786.  The SDK7786 FPGA has secondary control over the PCIe clocks, specifically relating to the slots and oscillator. This ties the FPGA clocks in to the clock framework and balances the refcounting similar to how the primary on-chip clocks are managed. While the on-chip clocks are per-port, the FPGA clock enable/disable is global for the entire block.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | fixups-landisk.c | s | 1.5K | 51 | Paul Mundt | lethal@linux-sh.org | 1337330549 |  | sh: legacy PCI evt2irq migration.  This converts over the legacy PCI IRQs to evt2irq() backed hwirq lookups.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | fixups-sdk7780.c | s | 1.3K | 40 | Paul Mundt | lethal@linux-sh.org | 1337330549 |  | sh: legacy PCI evt2irq migration.  This converts over the legacy PCI IRQs to evt2irq() backed hwirq lookups.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | pci-sh7780.h | s | 1.7K | 39 | Paul Mundt | lethal@linux-sh.org | 1284964645 |  | sh: pci: Move Renesas PCI IDs to a better place.  Previously these IDs were only used by one driver, so there was not much need for having them generically defined. Now that this will no longer hold true, move them over.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | ops-sh4.c | s | 2.5K | 96 | Paul Mundt | lethal@linux-sh.org | 1284976573 |  | sh: pci: Use a generic raw spinlock for PCI config access locking.  This copies the pci_config_lock idea from x86 over, allowing us to kill off a couple of existing private locks. At the same time, these need to be converted to raw spinlocks for -rt kernels, so we make that change at the same time. This should make it easier for future parts to get the locking right instead of inevitable ending up with lock type mismatches.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | pcie-sh7786.c | s | 13K | 474 | Nobuhiro Iwamatsu | nobuhiro.iwamatsu.yj@renesas.com | 1340869534 |  | sh: Convert sh_clk_mstp32_register to sh_clk_mstp_register  sh_clk_mstp32_register is deprecated. This convert to sh_clk_mstp_register.  Signed-off-by: Nobuhiro Iwamatsu <nobuhiro.iwamatsu.yj@renesas.com> Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | fixups-r7780rp.c | s | 561B | 20 | Paul Mundt | lethal@linux-sh.org | 1337330549 |  | sh: legacy PCI evt2irq migration.  This converts over the legacy PCI IRQs to evt2irq() backed hwirq lookups.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | fixups-rts7751r2d.c | s | 1.7K | 56 | Ralf Baechle | ralf@linux-mips.org | 1311348366 |  | PCI: Make the struct pci_dev * argument of pci_fixup_irqs const.  Aside of the usual motivation for constification,  this function has a history of being abused a hook for interrupt and other fixups so I turned this function const ages ago in the MIPS code but it should be done treewide.  Due to function pointer passing in varous places a few other functions had to be constified as well.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> To: Anton Vorontsov <avorontsov@mvista.com> To: Chris Metcalf <cmetcalf@tilera.com> To: Colin Cross <ccross@android.com> Acked-by: "David S. Miller" <davem@davemloft.net> To: Eric Miao <eric.y.miao@gmail.com> To: Erik Gilling <konkers@android.com> Acked-by: Guan Xuetao <gxt@mprc.pku.edu.cn> To: "H. Peter Anvin" <hpa@zytor.com> To: Imre Kaloz <kaloz@openwrt.org> To: Ingo Molnar <mingo@redhat.com> To: Ivan Kokshaysky <ink@jurassic.park.msu.ru> To: Jesse Barnes <jbarnes@virtuousgeek.org> To: Krzysztof Halasa <khc@pm.waw.pl> To: Lennert Buytenhek <kernel@wantstofly.org> To: Matt Turner <mattst88@gmail.com> To: Nicolas Pitre <nico@fluxnic.net> To: Olof Johansson <olof@lixom.net> Acked-by: Paul Mundt <lethal@linux-sh.org> To: Richard Henderson <rth@twiddle.net> To: Russell King <linux@arm.linux.org.uk> To: Thomas Gleixner <tglx@linutronix.de> Cc: Andrew Morton <akpm@linux-foundation.org> Cc: linux-alpha@vger.kernel.org Cc: linux-arm-kernel@lists.infradead.org Cc: linux-kernel@vger.kernel.org Cc: linux-mips@linux-mips.org Cc: linux-pci@vger.kernel.org Cc: linux-sh@vger.kernel.org Cc: linux-tegra@vger.kernel.org Cc: sparclinux@vger.kernel.org Cc: x86@kernel.org Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>
f | fixups-cayman.c | s | 2.1K | 66 | Ralf Baechle | ralf@linux-mips.org | 1311348366 |  | PCI: Make the struct pci_dev * argument of pci_fixup_irqs const.  Aside of the usual motivation for constification,  this function has a history of being abused a hook for interrupt and other fixups so I turned this function const ages ago in the MIPS code but it should be done treewide.  Due to function pointer passing in varous places a few other functions had to be constified as well.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> To: Anton Vorontsov <avorontsov@mvista.com> To: Chris Metcalf <cmetcalf@tilera.com> To: Colin Cross <ccross@android.com> Acked-by: "David S. Miller" <davem@davemloft.net> To: Eric Miao <eric.y.miao@gmail.com> To: Erik Gilling <konkers@android.com> Acked-by: Guan Xuetao <gxt@mprc.pku.edu.cn> To: "H. Peter Anvin" <hpa@zytor.com> To: Imre Kaloz <kaloz@openwrt.org> To: Ingo Molnar <mingo@redhat.com> To: Ivan Kokshaysky <ink@jurassic.park.msu.ru> To: Jesse Barnes <jbarnes@virtuousgeek.org> To: Krzysztof Halasa <khc@pm.waw.pl> To: Lennert Buytenhek <kernel@wantstofly.org> To: Matt Turner <mattst88@gmail.com> To: Nicolas Pitre <nico@fluxnic.net> To: Olof Johansson <olof@lixom.net> Acked-by: Paul Mundt <lethal@linux-sh.org> To: Richard Henderson <rth@twiddle.net> To: Russell King <linux@arm.linux.org.uk> To: Thomas Gleixner <tglx@linutronix.de> Cc: Andrew Morton <akpm@linux-foundation.org> Cc: linux-alpha@vger.kernel.org Cc: linux-arm-kernel@lists.infradead.org Cc: linux-kernel@vger.kernel.org Cc: linux-mips@linux-mips.org Cc: linux-pci@vger.kernel.org Cc: linux-sh@vger.kernel.org Cc: linux-tegra@vger.kernel.org Cc: sparclinux@vger.kernel.org Cc: x86@kernel.org Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>
