<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › sh › boards › mach-ecovec24 › setup.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>setup.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) 2009 Renesas Solutions Corp.</span>
<span class="cm"> *</span>
<span class="cm"> * Kuninori Morimoto &lt;morimoto.kuninori@renesas.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/host.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/sh_mmcif.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/sh_mobile_sdhi.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/physmap.h&gt;</span>
<span class="cp">#include &lt;linux/gpio.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/usb/r8a66597.h&gt;</span>
<span class="cp">#include &lt;linux/usb/renesas_usbhs.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/i2c/tsc2007.h&gt;</span>
<span class="cp">#include &lt;linux/spi/spi.h&gt;</span>
<span class="cp">#include &lt;linux/spi/sh_msiof.h&gt;</span>
<span class="cp">#include &lt;linux/spi/mmc_spi.h&gt;</span>
<span class="cp">#include &lt;linux/input.h&gt;</span>
<span class="cp">#include &lt;linux/input/sh_keysc.h&gt;</span>
<span class="cp">#include &lt;linux/sh_eth.h&gt;</span>
<span class="cp">#include &lt;linux/sh_intc.h&gt;</span>
<span class="cp">#include &lt;linux/videodev2.h&gt;</span>
<span class="cp">#include &lt;video/sh_mobile_lcdc.h&gt;</span>
<span class="cp">#include &lt;sound/sh_fsi.h&gt;</span>
<span class="cp">#include &lt;sound/simple_card.h&gt;</span>
<span class="cp">#include &lt;media/sh_mobile_ceu.h&gt;</span>
<span class="cp">#include &lt;media/soc_camera.h&gt;</span>
<span class="cp">#include &lt;media/tw9910.h&gt;</span>
<span class="cp">#include &lt;media/mt9t112.h&gt;</span>
<span class="cp">#include &lt;asm/heartbeat.h&gt;</span>
<span class="cp">#include &lt;asm/clock.h&gt;</span>
<span class="cp">#include &lt;asm/suspend.h&gt;</span>
<span class="cp">#include &lt;cpu/sh7724.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> *  Address      Interface        BusWidth</span>
<span class="cm"> *-----------------------------------------</span>
<span class="cm"> *  0x0000_0000  uboot            16bit</span>
<span class="cm"> *  0x0004_0000  Linux romImage   16bit</span>
<span class="cm"> *  0x0014_0000  MTD for Linux    16bit</span>
<span class="cm"> *  0x0400_0000  Internal I/O     16/32bit</span>
<span class="cm"> *  0x0800_0000  DRAM             32bit</span>
<span class="cm"> *  0x1800_0000  MFI              16bit</span>
<span class="cm"> */</span>

<span class="cm">/* SWITCH</span>
<span class="cm"> *------------------------------</span>
<span class="cm"> * DS2[1] = FlashROM write protect  ON     : write protect</span>
<span class="cm"> *                                  OFF    : No write protect</span>
<span class="cm"> * DS2[2] = RMII / TS, SCIF         ON     : RMII</span>
<span class="cm"> *                                  OFF    : TS, SCIF3</span>
<span class="cm"> * DS2[3] = Camera / Video          ON     : Camera</span>
<span class="cm"> *                                  OFF    : NTSC/PAL (IN)</span>
<span class="cm"> * DS2[5] = NTSC_OUT Clock          ON     : On board OSC</span>
<span class="cm"> *                                  OFF    : SH7724 DV_CLK</span>
<span class="cm"> * DS2[6-7] = MMC / SD              ON-OFF : SD</span>
<span class="cm"> *                                  OFF-ON : MMC</span>
<span class="cm"> */</span>

<span class="cm">/* Heartbeat */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">led_pos</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">heartbeat_data</span> <span class="n">heartbeat_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">nr_bits</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bit_pos</span> <span class="o">=</span> <span class="n">led_pos</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">heartbeat_resource</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="mh">0xA405012C</span><span class="p">,</span> <span class="cm">/* PTG */</span>
	<span class="p">.</span><span class="n">end</span>    <span class="o">=</span> <span class="mh">0xA405012E</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_MEM</span> <span class="o">|</span> <span class="n">IORESOURCE_MEM_8BIT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">heartbeat_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;heartbeat&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>             <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">heartbeat_data</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resource</span>       <span class="o">=</span> <span class="o">&amp;</span><span class="n">heartbeat_resource</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* MTD */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mtd_partition</span> <span class="n">nor_flash_partitions</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;boot loader&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
		<span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="n">MTD_WRITEABLE</span><span class="p">,</span>  <span class="cm">/* force read-only */</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;free-area&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">MTDPART_SIZ_FULL</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">physmap_flash_data</span> <span class="n">nor_flash_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">width</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parts</span>		<span class="o">=</span> <span class="n">nor_flash_partitions</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nr_parts</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">nor_flash_partitions</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">nor_flash_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;NOR Flash&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0x03ffffff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">nor_flash_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;physmap-flash&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">nor_flash_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">nor_flash_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">nor_flash_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* SH Eth */</span>
<span class="cp">#define SH_ETH_ADDR	(0xA4600000)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sh_eth_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">SH_ETH_ADDR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">SH_ETH_ADDR</span> <span class="o">+</span> <span class="mh">0x1FC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xd60</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span> <span class="o">|</span> <span class="n">IORESOURCE_IRQ_HIGHLEVEL</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_eth_plat_data</span> <span class="n">sh_eth_plat</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy</span> <span class="o">=</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="cm">/* SMSC LAN8700 */</span>
	<span class="p">.</span><span class="n">edmac_endian</span> <span class="o">=</span> <span class="n">EDMAC_LITTLE_ENDIAN</span><span class="p">,</span>
	<span class="p">.</span><span class="n">register_type</span> <span class="o">=</span> <span class="n">SH_ETH_REG_FAST_SH4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_interface</span> <span class="o">=</span> <span class="n">PHY_INTERFACE_MODE_MII</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ether_link_active_low</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sh_eth_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;sh-eth&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sh_eth_plat</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sh_eth_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">sh_eth_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* USB0 host */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">usb0_port_power</span><span class="p">(</span><span class="kt">int</span> <span class="n">port</span><span class="p">,</span> <span class="kt">int</span> <span class="n">power</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTB4</span><span class="p">,</span> <span class="n">power</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">r8a66597_platdata</span> <span class="n">usb0_host_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">on_chip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">port_power</span> <span class="o">=</span> <span class="n">usb0_port_power</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">usb0_host_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xa4d80000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xa4d80124</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xa20</span><span class="p">),</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xa20</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span> <span class="o">|</span> <span class="n">IRQF_TRIGGER_LOW</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">usb0_host_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;r8a66597_hcd&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">dma_mask</span>		<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>         <span class="cm">/*  not use dma */</span>
		<span class="p">.</span><span class="n">coherent_dma_mask</span>	<span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">usb0_host_data</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">usb0_host_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">usb0_host_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* USB1 host/function */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">usb1_port_power</span><span class="p">(</span><span class="kt">int</span> <span class="n">port</span><span class="p">,</span> <span class="kt">int</span> <span class="n">power</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTB5</span><span class="p">,</span> <span class="n">power</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">r8a66597_platdata</span> <span class="n">usb1_common_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">on_chip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">port_power</span> <span class="o">=</span> <span class="n">usb1_port_power</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">usb1_common_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xa4d90000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xa4d90124</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xa40</span><span class="p">),</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xa40</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span> <span class="o">|</span> <span class="n">IRQF_TRIGGER_LOW</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">usb1_common_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* .name will be added in arch_setup */</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">dma_mask</span>		<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>         <span class="cm">/*  not use dma */</span>
		<span class="p">.</span><span class="n">coherent_dma_mask</span>	<span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">usb1_common_data</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">usb1_common_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">usb1_common_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * USBHS</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">usbhs_get_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PTB3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">renesas_usbhs_platform_info</span> <span class="n">usbhs_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">platform_callback</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">get_id</span>		<span class="o">=</span> <span class="n">usbhs_get_id</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">driver_param</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">buswait_bwait</span>		<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">detection_delay</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">d0_tx_id</span> <span class="o">=</span> <span class="n">SHDMA_SLAVE_USB1D0_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">d0_rx_id</span> <span class="o">=</span> <span class="n">SHDMA_SLAVE_USB1D0_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">d1_tx_id</span> <span class="o">=</span> <span class="n">SHDMA_SLAVE_USB1D1_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">d1_rx_id</span> <span class="o">=</span> <span class="n">SHDMA_SLAVE_USB1D1_RX</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">usbhs_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xa4d90000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xa4d90124</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xa40</span><span class="p">),</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xa40</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">usbhs_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;renesas_usbhs&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">dma_mask</span>		<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>         <span class="cm">/*  not use dma */</span>
		<span class="p">.</span><span class="n">coherent_dma_mask</span>	<span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">usbhs_info</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">usbhs_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">usbhs_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* LCDC */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">ecovec_lcd_modes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Panel&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xres</span>		<span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
		<span class="p">.</span><span class="n">yres</span>		<span class="o">=</span> <span class="mi">480</span><span class="p">,</span>
		<span class="p">.</span><span class="n">left_margin</span>	<span class="o">=</span> <span class="mi">220</span><span class="p">,</span>
		<span class="p">.</span><span class="n">right_margin</span>	<span class="o">=</span> <span class="mi">110</span><span class="p">,</span>
		<span class="p">.</span><span class="n">hsync_len</span>	<span class="o">=</span> <span class="mi">70</span><span class="p">,</span>
		<span class="p">.</span><span class="n">upper_margin</span>	<span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lower_margin</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vsync_len</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sync</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* hsync and vsync are active low */</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">ecovec_dvi_modes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;DVI&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xres</span>		<span class="o">=</span> <span class="mi">1280</span><span class="p">,</span>
		<span class="p">.</span><span class="n">yres</span>		<span class="o">=</span> <span class="mi">720</span><span class="p">,</span>
		<span class="p">.</span><span class="n">left_margin</span>	<span class="o">=</span> <span class="mi">220</span><span class="p">,</span>
		<span class="p">.</span><span class="n">right_margin</span>	<span class="o">=</span> <span class="mi">110</span><span class="p">,</span>
		<span class="p">.</span><span class="n">hsync_len</span>	<span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
		<span class="p">.</span><span class="n">upper_margin</span>	<span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">lower_margin</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vsync_len</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sync</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* hsync and vsync are active low */</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ecovec24_set_brightness</span><span class="p">(</span><span class="kt">int</span> <span class="n">brightness</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTR1</span><span class="p">,</span> <span class="n">brightness</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ecovec24_get_brightness</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PTR1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_lcdc_info</span> <span class="n">lcdc_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">interface_type</span> <span class="o">=</span> <span class="n">RGB18</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chan</span> <span class="o">=</span> <span class="n">LCDC_CHAN_MAINLCD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fourcc</span> <span class="o">=</span> <span class="n">V4L2_PIX_FMT_RGB565</span><span class="p">,</span>
		<span class="p">.</span><span class="n">panel_cfg</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* 7.0 inch */</span>
			<span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">152</span><span class="p">,</span>
			<span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">91</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">bl_info</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;sh_mobile_lcdc_bl&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">max_brightness</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">set_brightness</span> <span class="o">=</span> <span class="n">ecovec24_set_brightness</span><span class="p">,</span>
			<span class="p">.</span><span class="n">get_brightness</span> <span class="o">=</span> <span class="n">ecovec24_get_brightness</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">lcdc_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;LCDC&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xfe940000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xfe942fff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xf40</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">lcdc_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_lcdc_fb&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">lcdc_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">lcdc_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">lcdc_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* CEU0 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_ceu_info</span> <span class="n">sh_mobile_ceu0_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">SH_CEU_FLAG_USE_8BIT_BUS</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">ceu0_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;CEU0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xfe910000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xfe91009f</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x880</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* place holder for contiguous memory */</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">ceu0_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_ceu&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>             <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* &quot;ceu0&quot; clock */</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ceu0_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">ceu0_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">sh_mobile_ceu0_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* CEU1 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_ceu_info</span> <span class="n">sh_mobile_ceu1_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">SH_CEU_FLAG_USE_8BIT_BUS</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">ceu1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;CEU1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xfe914000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xfe91409f</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x9e0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* place holder for contiguous memory */</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">ceu1_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mobile_ceu&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>             <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="cm">/* &quot;ceu1&quot; clock */</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ceu1_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">ceu1_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">sh_mobile_ceu1_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* I2C device */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">i2c0_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;da7210&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">),</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">i2c1_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;r2025sd&quot;</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">),</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;lis3lv02d&quot;</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">),</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x620</span><span class="p">),</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* KEYSC */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_keysc_info</span> <span class="n">keysc_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mode</span>		<span class="o">=</span> <span class="n">SH_KEYSC_MODE_1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">scan_timing</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">delay</span>		<span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="p">.</span><span class="n">kycr2_delay</span>	<span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
	<span class="p">.</span><span class="n">keycodes</span>	<span class="o">=</span> <span class="p">{</span> <span class="n">KEY_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="n">KEY_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="n">KEY_3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="n">KEY_4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="n">KEY_5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="n">KEY_6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">keysc_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;KEYSC&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="mh">0x044b0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>    <span class="o">=</span> <span class="mh">0x044b000f</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xbe0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">keysc_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;sh_keysc&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>             <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* keysc0 clock */</span>
	<span class="p">.</span><span class="n">num_resources</span>  <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">keysc_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>       <span class="o">=</span> <span class="n">keysc_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">keysc_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* TouchScreen */</span>
<span class="cp">#define IRQ0 evt2irq(0x600)</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ts_get_pendown_state</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">gpio_free</span><span class="p">(</span><span class="n">GPIO_FN_INTC_IRQ0</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTZ0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PTZ0</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PTZ0</span><span class="p">);</span>

	<span class="n">gpio_free</span><span class="p">(</span><span class="n">GPIO_PTZ0</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_INTC_IRQ0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">val</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ts_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_INTC_IRQ0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tsc2007_platform_data</span> <span class="n">tsc2007_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">model</span>			<span class="o">=</span> <span class="mi">2007</span><span class="p">,</span>
	<span class="p">.</span><span class="n">x_plate_ohms</span>		<span class="o">=</span> <span class="mi">180</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_pendown_state</span>	<span class="o">=</span> <span class="n">ts_get_pendown_state</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_platform_hw</span>	<span class="o">=</span> <span class="n">ts_init</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">ts_i2c_clients</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;tsc2007&quot;</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">),</span>
	<span class="p">.</span><span class="n">type</span>		<span class="o">=</span> <span class="s">&quot;tsc2007&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">tsc2007_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq</span>		<span class="o">=</span> <span class="n">IRQ0</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#if defined(CONFIG_MMC_SDHI) || defined(CONFIG_MMC_SDHI_MODULE)</span>
<span class="cm">/* SDHI0 */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">sdhi0_set_pwr</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTB6</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sdhi0_get_cd</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">!</span><span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PTY7</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_sdhi_info</span> <span class="n">sdhi0_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">dma_slave_tx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_SDHI0_TX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_slave_rx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_SDHI0_RX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_pwr</span>	<span class="o">=</span> <span class="n">sdhi0_set_pwr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_caps</span>      <span class="o">=</span> <span class="n">MMC_CAP_SDIO_IRQ</span> <span class="o">|</span> <span class="n">MMC_CAP_POWER_OFF_CARD</span> <span class="o">|</span>
			  <span class="n">MMC_CAP_NEEDS_POLL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_cd</span>		<span class="o">=</span> <span class="n">sdhi0_get_cd</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sdhi0_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;SDHI0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="mh">0x04ce0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>    <span class="o">=</span> <span class="mh">0x04ce00ff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xe80</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sdhi0_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;sh_mobile_sdhi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>  <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sdhi0_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>       <span class="o">=</span> <span class="n">sdhi0_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>             <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">sdhi0_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#if !defined(CONFIG_MMC_SH_MMCIF) &amp;&amp; !defined(CONFIG_MMC_SH_MMCIF_MODULE)</span>
<span class="cm">/* SDHI1 */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">sdhi1_set_pwr</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTB7</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sdhi1_get_cd</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">!</span><span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PTW7</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mobile_sdhi_info</span> <span class="n">sdhi1_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">dma_slave_tx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_SDHI1_TX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_slave_rx</span>	<span class="o">=</span> <span class="n">SHDMA_SLAVE_SDHI1_RX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tmio_caps</span>      <span class="o">=</span> <span class="n">MMC_CAP_SDIO_IRQ</span> <span class="o">|</span> <span class="n">MMC_CAP_POWER_OFF_CARD</span> <span class="o">|</span>
			  <span class="n">MMC_CAP_NEEDS_POLL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_pwr</span>	<span class="o">=</span> <span class="n">sdhi1_set_pwr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_cd</span>		<span class="o">=</span> <span class="n">sdhi1_get_cd</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sdhi1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;SDHI1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="mh">0x04cf0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>    <span class="o">=</span> <span class="mh">0x04cf00ff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x4e0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sdhi1_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;sh_mobile_sdhi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>  <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sdhi1_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>       <span class="o">=</span> <span class="n">sdhi1_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>             <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">sdhi1_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_MMC_SH_MMCIF */</span><span class="cp"></span>

<span class="cp">#else</span>

<span class="cm">/* MMC SPI */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mmc_spi_get_ro</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PTY6</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mmc_spi_get_cd</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">!</span><span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PTY7</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mmc_spi_setpower</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">maskval</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTB6</span><span class="p">,</span> <span class="n">maskval</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mmc_spi_platform_data</span> <span class="n">mmc_spi_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">get_ro</span> <span class="o">=</span> <span class="n">mmc_spi_get_ro</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_cd</span> <span class="o">=</span> <span class="n">mmc_spi_get_cd</span><span class="p">,</span>
	<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">MMC_CAP_NEEDS_POLL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ocr_mask</span> <span class="o">=</span> <span class="n">MMC_VDD_32_33</span> <span class="o">|</span> <span class="n">MMC_VDD_33_34</span><span class="p">,</span> <span class="cm">/* 3.3V only */</span>
	<span class="p">.</span><span class="n">setpower</span> <span class="o">=</span> <span class="n">mmc_spi_setpower</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">spi_board_info</span> <span class="n">spi_bus</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span>	<span class="o">=</span> <span class="s">&quot;mmc_spi&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">mmc_spi_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_speed_hz</span>	<span class="o">=</span> <span class="mi">5000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mode</span>		<span class="o">=</span> <span class="n">SPI_MODE_0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">controller_data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="n">GPIO_PTM4</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* MSIOF0 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_msiof_spi_info</span> <span class="n">msiof0_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_chipselect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">msiof0_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;MSIOF0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xa4c40000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xa4c40063</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xc80</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">msiof0_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;spi_sh_msiof&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* MSIOF0 */</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">msiof0_data</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">msiof0_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">msiof0_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#endif</span>

<span class="cm">/* I2C Video/Camera */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">i2c_camera</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;tw9910&quot;</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">),</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* 1st camera */</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;mt9t112&quot;</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">),</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* 2nd camera */</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;mt9t112&quot;</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">),</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* tw9910 */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">tw9910_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="n">mode</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTU2</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="p">)</span>
		<span class="n">mdelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tw9910_video_info</span> <span class="n">tw9910_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">buswidth</span>	<span class="o">=</span> <span class="n">SOCAM_DATAWIDTH_8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpout</span>		<span class="o">=</span> <span class="n">TW9910_MPO_FIELD</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">soc_camera_link</span> <span class="n">tw9910_link</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_adapter_id</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bus_id</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">power</span>		<span class="o">=</span> <span class="n">tw9910_power</span><span class="p">,</span>
	<span class="p">.</span><span class="n">board_info</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">i2c_camera</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
	<span class="p">.</span><span class="n">priv</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">tw9910_info</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* mt9t112 */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mt9t112_power1</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTA3</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="p">)</span>
		<span class="n">mdelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mt9t112_camera_info</span> <span class="n">mt9t112_info1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">MT9T112_FLAG_PCLK_RISING_EDGE</span> <span class="o">|</span> <span class="n">MT9T112_FLAG_DATAWIDTH_8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">divider</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* for 24MHz */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">soc_camera_link</span> <span class="n">mt9t112_link1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_adapter_id</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">power</span>		<span class="o">=</span> <span class="n">mt9t112_power1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bus_id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">board_info</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">i2c_camera</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
	<span class="p">.</span><span class="n">priv</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">mt9t112_info1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mt9t112_power2</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTA4</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="p">)</span>
		<span class="n">mdelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mt9t112_camera_info</span> <span class="n">mt9t112_info2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">MT9T112_FLAG_PCLK_RISING_EDGE</span> <span class="o">|</span> <span class="n">MT9T112_FLAG_DATAWIDTH_8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">divider</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* for 24MHz */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">soc_camera_link</span> <span class="n">mt9t112_link2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_adapter_id</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">power</span>		<span class="o">=</span> <span class="n">mt9t112_power2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bus_id</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">board_info</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">i2c_camera</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
	<span class="p">.</span><span class="n">priv</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">mt9t112_info2</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">camera_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;soc-camera-pdrv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tw9910_link</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;soc-camera-pdrv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mt9t112_link1</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;soc-camera-pdrv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mt9t112_link2</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* FSI */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_fsi_platform_info</span> <span class="n">fsi_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">port_b</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">SH_FSI_BRS_INV</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">fsi_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;FSI&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xFE3C0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xFE3C021d</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0xf80</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">fsi_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_fsi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">fsi_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">fsi_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">fsi_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">asoc_simple_dai_init_info</span> <span class="n">fsi_da7210_init_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">fmt</span>		<span class="o">=</span> <span class="n">SND_SOC_DAIFMT_I2S</span><span class="p">,</span>
	<span class="p">.</span><span class="n">codec_daifmt</span>	<span class="o">=</span> <span class="n">SND_SOC_DAIFMT_CBM_CFM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cpu_daifmt</span>	<span class="o">=</span> <span class="n">SND_SOC_DAIFMT_CBS_CFS</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">asoc_simple_card_info</span> <span class="n">fsi_da7210_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;DA7210&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">card</span>		<span class="o">=</span> <span class="s">&quot;FSIB-DA7210&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cpu_dai</span>	<span class="o">=</span> <span class="s">&quot;fsib-dai&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">codec</span>		<span class="o">=</span> <span class="s">&quot;da7210.0-001a&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">platform</span>	<span class="o">=</span> <span class="s">&quot;sh_fsi.0&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">codec_dai</span>	<span class="o">=</span> <span class="s">&quot;da7210-hifi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">fsi_da7210_init_info</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">fsi_da7210_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;asoc-simple-card&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">fsi_da7210_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>


<span class="cm">/* IrDA */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">irda_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;IrDA&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="mh">0xA45D0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>    <span class="o">=</span> <span class="mh">0xA45D0049</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x480</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">irda_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;sh_sir&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>  <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">irda_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>       <span class="o">=</span> <span class="n">irda_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#include &lt;media/ak881x.h&gt;</span>
<span class="cp">#include &lt;media/sh_vou.h&gt;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">ak881x_pdata</span> <span class="n">ak881x_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">AK881X_IF_MODE_SLAVE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">ak8813</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;ak8813&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span>
	<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ak881x_pdata</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_vou_pdata</span> <span class="n">sh_vou_pdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">bus_fmt</span>	<span class="o">=</span> <span class="n">SH_VOU_BUS_8BIT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">SH_VOU_HSYNC_LOW</span> <span class="o">|</span> <span class="n">SH_VOU_VSYNC_LOW</span><span class="p">,</span>
	<span class="p">.</span><span class="n">board_info</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">ak8813</span><span class="p">,</span>
	<span class="p">.</span><span class="n">i2c_adap</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sh_vou_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="mh">0xfe960000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>    <span class="o">=</span> <span class="mh">0xfe962043</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x8e0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>  <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">vou_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;sh-vou&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>  <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sh_vou_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>       <span class="o">=</span> <span class="n">sh_vou_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">sh_vou_pdata</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#if defined(CONFIG_MMC_SH_MMCIF) || defined(CONFIG_MMC_SH_MMCIF_MODULE)</span>
<span class="cm">/* SH_MMCIF */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">mmcif_set_pwr</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTB7</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mmcif_down_pwr</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTB7</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sh_mmcif_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;SH_MMCIF&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xA4CA0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xA4CA00FF</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* MMC2I */</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x5a0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* MMC3I */</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">evt2irq</span><span class="p">(</span><span class="mh">0x5c0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_mmcif_plat_data</span> <span class="n">sh_mmcif_plat</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">set_pwr</span>	<span class="o">=</span> <span class="n">mmcif_set_pwr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">down_pwr</span>	<span class="o">=</span> <span class="n">mmcif_down_pwr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sup_pclk</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* SH7724: Max Pclk/2 */</span>
	<span class="p">.</span><span class="n">caps</span>		<span class="o">=</span> <span class="n">MMC_CAP_4_BIT_DATA</span> <span class="o">|</span>
			  <span class="n">MMC_CAP_8_BIT_DATA</span> <span class="o">|</span>
			  <span class="n">MMC_CAP_NEEDS_POLL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ocr</span>		<span class="o">=</span> <span class="n">MMC_VDD_32_33</span> <span class="o">|</span> <span class="n">MMC_VDD_33_34</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">sh_mmcif_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sh_mmcif&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">sh_mmcif_plat</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sh_mmcif_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">sh_mmcif_resources</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">ecovec_devices</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">heartbeat_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">nor_flash_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sh_eth_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">usb0_host_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">usb1_common_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">usbhs_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">lcdc_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">ceu0_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">ceu1_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">keysc_device</span><span class="p">,</span>
<span class="cp">#if defined(CONFIG_MMC_SDHI) || defined(CONFIG_MMC_SDHI_MODULE)</span>
	<span class="o">&amp;</span><span class="n">sdhi0_device</span><span class="p">,</span>
<span class="cp">#if !defined(CONFIG_MMC_SH_MMCIF) &amp;&amp; !defined(CONFIG_MMC_SH_MMCIF_MODULE)</span>
	<span class="o">&amp;</span><span class="n">sdhi1_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#else</span>
	<span class="o">&amp;</span><span class="n">msiof0_device</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="o">&amp;</span><span class="n">camera_devices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
	<span class="o">&amp;</span><span class="n">camera_devices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
	<span class="o">&amp;</span><span class="n">camera_devices</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
	<span class="o">&amp;</span><span class="n">fsi_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">fsi_da7210_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">irda_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">vou_device</span><span class="p">,</span>
<span class="cp">#if defined(CONFIG_MMC_SH_MMCIF) || defined(CONFIG_MMC_SH_MMCIF_MODULE)</span>
	<span class="o">&amp;</span><span class="n">sh_mmcif_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_I2C</span>
<span class="cp">#define EEPROM_ADDR 0x50</span>
<span class="k">static</span> <span class="n">u8</span> <span class="nf">mac_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">u8</span> <span class="n">command</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span>  <span class="o">=</span> <span class="n">EEPROM_ADDR</span><span class="p">;</span>
	<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span>   <span class="o">=</span> <span class="o">&amp;</span><span class="n">command</span><span class="p">;</span>

	<span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">addr</span>  <span class="o">=</span> <span class="n">EEPROM_ADDR</span><span class="p">;</span>
	<span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">flags</span> <span class="o">=</span> <span class="n">I2C_M_RD</span><span class="p">;</span>
	<span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">buf</span>   <span class="o">=</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">i2c_transfer</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;error %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">buf</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">sh_eth_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">sh_eth_plat_data</span> <span class="o">*</span><span class="n">pd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="n">i2c_get_adapter</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;can not get I2C 1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* read MAC address from EEPROM */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pd</span><span class="o">-&gt;</span><span class="n">mac_addr</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pd</span><span class="o">-&gt;</span><span class="n">mac_addr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mac_read</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mh">0x10</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">i2c_put_adapter</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">sh_eth_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">sh_eth_plat_data</span> <span class="o">*</span><span class="n">pd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;unable to read sh_eth MAC address</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#define PORT_HIZA 0xA4050158</span>
<span class="cp">#define IODRIVEA  0xA405018A</span>

<span class="k">extern</span> <span class="kt">char</span> <span class="n">ecovec24_sdram_enter_start</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">char</span> <span class="n">ecovec24_sdram_enter_end</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">char</span> <span class="n">ecovec24_sdram_leave_start</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">char</span> <span class="n">ecovec24_sdram_leave_end</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">arch_setup</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">cn12_enabled</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="cm">/* register board specific self-refresh code */</span>
	<span class="n">sh_mobile_register_self_refresh</span><span class="p">(</span><span class="n">SUSP_SH_STANDBY</span> <span class="o">|</span> <span class="n">SUSP_SH_SF</span> <span class="o">|</span>
					<span class="n">SUSP_SH_RSTANDBY</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">ecovec24_sdram_enter_start</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">ecovec24_sdram_enter_end</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">ecovec24_sdram_leave_start</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">ecovec24_sdram_leave_end</span><span class="p">);</span>

	<span class="cm">/* enable STATUS0, STATUS2 and PDSTATUS */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_STATUS0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_STATUS2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_PDSTATUS</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* enable SCIFA0 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SCIF0_TXD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SCIF0_RXD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* enable debug LED */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTG0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTG1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTG2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTG3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTG0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTG1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTG2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTG3</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">__raw_writew</span><span class="p">((</span><span class="n">__raw_readw</span><span class="p">(</span><span class="n">PORT_HIZA</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">,</span> <span class="n">PORT_HIZA</span><span class="p">);</span>

	<span class="cm">/* enable SH-Eth */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTA1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTA1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">mdelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_RMII_RXD0</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_RMII_RXD1</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_RMII_TXD0</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_RMII_TXD1</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_RMII_REF_CLK</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_RMII_TX_EN</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_RMII_RX_ER</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_RMII_CRS_DV</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MDIO</span><span class="p">,</span>         <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MDC</span><span class="p">,</span>          <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LNKSTA</span><span class="p">,</span>       <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* enable USB */</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0xA4D80000</span><span class="p">);</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0xA4D90000</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTB3</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTB4</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTB5</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PTB3</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTB4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTB5</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="mh">0x0600</span><span class="p">,</span> <span class="mh">0xa40501d4</span><span class="p">);</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="mh">0x0600</span><span class="p">,</span> <span class="mh">0xa4050192</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PTB3</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;USB1 function is selected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">usb1_common_device</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;r8a66597_udc&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;USB1 host is selected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">usb1_common_device</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;r8a66597_hcd&quot;</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* enable LCDC */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD23</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD22</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD21</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD20</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD19</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD18</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD17</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD16</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD15</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD14</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD13</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD12</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD11</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD10</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD9</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD8</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD7</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD6</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD5</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD4</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD3</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD2</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD1</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDD0</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDDISP</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDHSYN</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDDCK</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDVSYN</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDDON</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_LCDLCLK</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">__raw_writew</span><span class="p">((</span><span class="n">__raw_readw</span><span class="p">(</span><span class="n">PORT_HIZA</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x0001</span><span class="p">),</span> <span class="n">PORT_HIZA</span><span class="p">);</span>

	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTE6</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTU1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTR1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTA2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PTE6</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTU1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTR1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTA2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* I/O buffer drive ability is high */</span>
	<span class="n">__raw_writew</span><span class="p">((</span><span class="n">__raw_readw</span><span class="p">(</span><span class="n">IODRIVEA</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x00c0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x0080</span> <span class="p">,</span> <span class="n">IODRIVEA</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gpio_get_value</span><span class="p">(</span><span class="n">GPIO_PTE6</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/* DVI */</span>
		<span class="n">lcdc_info</span><span class="p">.</span><span class="n">clock_source</span>			<span class="o">=</span> <span class="n">LCDC_CLK_EXTERNAL</span><span class="p">;</span>
		<span class="n">lcdc_info</span><span class="p">.</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">clock_divider</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">lcdc_info</span><span class="p">.</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">lcd_modes</span>		<span class="o">=</span> <span class="n">ecovec_dvi_modes</span><span class="p">;</span>
		<span class="n">lcdc_info</span><span class="p">.</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">num_modes</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ecovec_dvi_modes</span><span class="p">);</span>

		<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTA2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTU1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* Panel */</span>
		<span class="n">lcdc_info</span><span class="p">.</span><span class="n">clock_source</span>			<span class="o">=</span> <span class="n">LCDC_CLK_PERIPHERAL</span><span class="p">;</span>
		<span class="n">lcdc_info</span><span class="p">.</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">clock_divider</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">lcdc_info</span><span class="p">.</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">lcd_modes</span>		<span class="o">=</span> <span class="n">ecovec_lcd_modes</span><span class="p">;</span>
		<span class="n">lcdc_info</span><span class="p">.</span><span class="n">ch</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">num_modes</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ecovec_lcd_modes</span><span class="p">);</span>

		<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTR1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

		<span class="cm">/* FIXME</span>
<span class="cm">		 *</span>
<span class="cm">		 * LCDDON control is needed for Panel,</span>
<span class="cm">		 * but current sh_mobile_lcdc driver doesn&#39;t control it.</span>
<span class="cm">		 * It is temporary correspondence</span>
<span class="cm">		 */</span>
		<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTF4</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
		<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTF4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

		<span class="cm">/* enable TouchScreen */</span>
		<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ts_i2c_clients</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">irq_set_irq_type</span><span class="p">(</span><span class="n">IRQ0</span><span class="p">,</span> <span class="n">IRQ_TYPE_LEVEL_LOW</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* enable CEU0 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D15</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D14</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D13</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D12</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D11</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D10</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D9</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D8</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D7</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D6</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D5</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D4</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D3</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D2</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D1</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_D0</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_VD</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_CLK</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_FLD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO0_HD</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">platform_resource_setup_memory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ceu0_device</span><span class="p">,</span> <span class="s">&quot;ceu0&quot;</span><span class="p">,</span> <span class="mi">4</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">);</span>

	<span class="cm">/* enable CEU1 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_D7</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_D6</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_D5</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_D4</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_D3</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_D2</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_D1</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_D0</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_FLD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_HD</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_VD</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_VIO1_CLK</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">platform_resource_setup_memory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ceu1_device</span><span class="p">,</span> <span class="s">&quot;ceu1&quot;</span><span class="p">,</span> <span class="mi">4</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">);</span>

	<span class="cm">/* enable KEYSC */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_KEYOUT5_IN5</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_KEYOUT4_IN6</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_KEYOUT3</span><span class="p">,</span>     <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_KEYOUT2</span><span class="p">,</span>     <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_KEYOUT1</span><span class="p">,</span>     <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_KEYOUT0</span><span class="p">,</span>     <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_KEYIN0</span><span class="p">,</span>      <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* enable user debug switch */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTR0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTR4</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTR5</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTR6</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PTR0</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PTR4</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PTR5</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PTR6</span><span class="p">);</span>

	<span class="cm">/* SD-card slot CN11 */</span>
	<span class="cm">/* Card-detect, used on CN11, either with SDHI0 or with SPI */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTY7</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PTY7</span><span class="p">);</span>

<span class="cp">#if defined(CONFIG_MMC_SDHI) || defined(CONFIG_MMC_SDHI_MODULE)</span>
	<span class="cm">/* enable SDHI0 on CN11 (needs DS2.4 set to ON) */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0WP</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0CMD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0CLK</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0D3</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0D2</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0D1</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI0D0</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTB6</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTB6</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="cp">#else</span>
	<span class="cm">/* enable MSIOF0 on CN11 (needs DS2.4 set to OFF) */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MSIOF0_TXD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MSIOF0_RXD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MSIOF0_TSCK</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTM4</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* software CS control of TSYNC pin */</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTM4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="cm">/* active low CS */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTB6</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* 3.3V power control */</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTB6</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="cm">/* disable power by default */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTY6</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> <span class="cm">/* write protect */</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PTY6</span><span class="p">);</span>

	<span class="n">spi_register_board_info</span><span class="p">(</span><span class="n">spi_bus</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">spi_bus</span><span class="p">));</span>
<span class="cp">#endif</span>

	<span class="cm">/* MMC/SD-card slot CN12 */</span>
<span class="cp">#if defined(CONFIG_MMC_SH_MMCIF) || defined(CONFIG_MMC_SH_MMCIF_MODULE)</span>
	<span class="cm">/* enable MMCIF (needs DS2.6,7 set to OFF,ON) */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC_D7</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC_D6</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC_D5</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC_D4</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC_D3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC_D2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC_D1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC_D0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC_CLK</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_MMC_CMD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTB7</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTB7</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">cn12_enabled</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="cp">#elif defined(CONFIG_MMC_SDHI) || defined(CONFIG_MMC_SDHI_MODULE)</span>
	<span class="cm">/* enable SDHI1 on CN12 (needs DS2.6,7 set to ON,OFF) */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1WP</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1CMD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1CLK</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1D3</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1D2</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1D1</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_SDHI1D0</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTB7</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTB7</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* Card-detect, used on CN12 with SDHI1 */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTW7</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_PTW7</span><span class="p">);</span>

	<span class="n">cn12_enabled</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="cp">#endif</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cn12_enabled</span><span class="p">)</span>
		<span class="cm">/* I/O buffer drive ability is high for CN12 */</span>
		<span class="n">__raw_writew</span><span class="p">((</span><span class="n">__raw_readw</span><span class="p">(</span><span class="n">IODRIVEA</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x3000</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x2000</span><span class="p">,</span>
			     <span class="n">IODRIVEA</span><span class="p">);</span>

	<span class="cm">/* enable Video */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTU2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTU2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* enable Camera */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTA3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTA4</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTA3</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTA4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* enable FSI */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIMCKB</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIIBSD</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIOBSD</span><span class="p">,</span>    <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIIBBCK</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIIBLRCK</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIOBBCK</span><span class="p">,</span>   <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_FSIOBLRCK</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_CLKAUDIOBO</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* set SPU2 clock to 83.4 MHz */</span>
	<span class="n">clk</span> <span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;spu_clk&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">clk</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">clk_set_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">clk_round_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="mi">83333333</span><span class="p">));</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* change parent of FSI B */</span>
	<span class="n">clk</span> <span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;fsib_clk&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">clk</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/* 48kHz dummy clock was used to make sure 1/1 divide */</span>
		<span class="n">clk_set_rate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh7724_fsimckb_clk</span><span class="p">,</span> <span class="mi">48000</span><span class="p">);</span>
		<span class="n">clk_set_parent</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sh7724_fsimckb_clk</span><span class="p">);</span>
		<span class="n">clk_set_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="mi">48000</span><span class="p">);</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTU0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTU0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mdelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

	<span class="cm">/* enable motion sensor */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_INTC_IRQ1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_input</span><span class="p">(</span><span class="n">GPIO_FN_INTC_IRQ1</span><span class="p">);</span>

	<span class="cm">/* set VPU clock to 166 MHz */</span>
	<span class="n">clk</span> <span class="o">=</span> <span class="n">clk_get</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;vpu_clk&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">clk</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">clk_set_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="n">clk_round_rate</span><span class="p">(</span><span class="n">clk</span><span class="p">,</span> <span class="mi">166000000</span><span class="p">));</span>
		<span class="n">clk_put</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* enable IrDA */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_IRDA_OUT</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_IRDA_IN</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTU5</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTU5</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* enable I2C device */</span>
	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i2c0_devices</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">i2c0_devices</span><span class="p">));</span>

	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i2c1_devices</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">i2c1_devices</span><span class="p">));</span>

<span class="cp">#if defined(CONFIG_VIDEO_SH_VOU) || defined(CONFIG_VIDEO_SH_VOU_MODULE)</span>
	<span class="cm">/* VOU */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_D15</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_D14</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_D13</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_D12</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_D11</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_D10</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_D9</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_D8</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_CLKI</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_CLK</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_VSYNC</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_FN_DV_HSYNC</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* AK8813 power / reset sequence */</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTG4</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gpio_request</span><span class="p">(</span><span class="n">GPIO_PTU3</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="cm">/* Reset */</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTG4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="cm">/* Power down */</span>
	<span class="n">gpio_direction_output</span><span class="p">(</span><span class="n">GPIO_PTU3</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

	<span class="cm">/* Power up, reset */</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTU3</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

	<span class="cm">/* Remove reset */</span>
	<span class="n">gpio_set_value</span><span class="p">(</span><span class="n">GPIO_PTG4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="k">return</span> <span class="n">platform_add_devices</span><span class="p">(</span><span class="n">ecovec_devices</span><span class="p">,</span>
				    <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ecovec_devices</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">arch_initcall</span><span class="p">(</span><span class="n">arch_setup</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">devices_setup</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">sh_eth_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sh_eth_plat</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">device_initcall</span><span class="p">(</span><span class="n">devices_setup</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">sh_machine_vector</span> <span class="n">mv_ecovec</span> <span class="n">__initmv</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mv_name</span>	<span class="o">=</span> <span class="s">&quot;R0P7724 (EcoVec)&quot;</span><span class="p">,</span>
<span class="p">};</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
