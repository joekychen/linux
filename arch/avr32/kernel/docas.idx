f | time.c | s | 3.7K | 124 | John Stultz | johnstul@us.ibm.com | 1294947671 |  | avr32: Convert to clocksource_register_hz  This converts the avr32 clocksource to use clocksource_register_hz.  This is untested, so any assistance in testing would be appreciated!  CC: Hans-Christian Egtvedt <hans-christian.egtvedt@atmel.com> CC: Thomas Gleixner <tglx@linutronix.de> Signed-off-by: John Stultz <johnstul@us.ibm.com>
f | Makefile | g | 467B |  | Thomas Gleixner | tglx@linutronix.de | 1336215622 |  | avr32: Use generic init_task  Same code. Use the generic version.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de> Cc: Haavard Skinnemoen <hskinnemoen@gmail.com> Link: http://lkml.kernel.org/r/20120503085034.281527118@linutronix.de
f | asm-offsets.c | s | 766B | 24 | Haavard Skinnemoen | haavard.skinnemoen@atmel.com | 1220267044 |  | avr32: Fix lockup after Java stack underflow in user mode  When using the Java Extension Module hardware, a Java stack underflow or overflow trap may cause the system to enter an infinite exception loop. Although there's no kernel support for the Java hardware yet, we need to be able to recover from this situation and keep the system running.  This patch adds code to detect and fixup this situation in the critical exception handler and terminate the faulting process. We may have to rethink how to handle this more gracefully when the necessary kernel support for hardware-accelerated Java is added.  Reported-by: Guennadi Liakhovetski <g.liakhovetski@gmx.de> Signed-off-by: Haavard Skinnemoen <haavard.skinnemoen@atmel.com>
f | head.S | g | 914B |  | Haavard Skinnemoen | hskinnemoen@atmel.com | 1162806203 |  | AVR32: Get rid of board_early_init  board_early_init() is left over from some early prototyping work where we had to initialize the SDRAM controller ourselves. This depends on the kernel being loaded into static RAM, which just isn't possible on any commercially available products today.  In order to run without a boot loader, we need to create a zImage stub or have the debugger initialize the SDRAM for us (for really low-level debugging)  Signed-off-by: Haavard Skinnemoen <hskinnemoen@atmel.com>
f | traps.c | s | 5.4K | 215 | Joe Perches | joe@perches.com | 1326427983 |  | treewide: remove useless NORET_TYPE macro and uses  It's a very old and now unused prototype marking so just delete it.  Neaten panic pointer argument style to keep checkpatch quiet.  Signed-off-by: Joe Perches <joe@perches.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Haavard Skinnemoen <hskinnemoen@gmail.com> Cc: Hans-Christian Egtvedt <egtvedt@samfundet.no> Cc: Tony Luck <tony.luck@intel.com> Cc: Fenghua Yu <fenghua.yu@intel.com> Acked-by: Geert Uytterhoeven <geert@linux-m68k.org> Acked-by: Ralf Baechle <ralf@linux-mips.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mackerras <paulus@samba.org> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: Heiko Carstens <heiko.carstens@de.ibm.com> Cc: Chris Metcalf <cmetcalf@tilera.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | syscall_table.S | g | 6.8K |  | NeilBrown | neilb@suse.de | 1314396598 |  | All Arch: remove linkage for sys_nfsservctl system call  The nfsservctl system call is now gone, so we should remove all linkage for it.  Signed-off-by: NeilBrown <neilb@suse.de> Signed-off-by: J. Bruce Fields <bfields@redhat.com> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | vmlinux.lds.S | g | 1.7K |  | Nelson Elhage | nelhage@ksplice.com | 1254843562 |  | avr32: clean up linker script using standard macros.  As a side effect, this patch changes the .init.ramfs data to be PAGE_SIZE-aligned, instead of 32-byte aligned.  Also, the init data is moved into its own output sections rather than the .init output section.  There should be no other changes to the resulting vmlinux as a result of this patch.  Signed-off-by: Nelson Elhage <nelhage@ksplice.com> Signed-off-by: Tim Abbott <tabbott@ksplice.com> Cc: Haavard Skinnemoen <hskinnemoen@atmel.com> Signed-off-by: Haavard Skinnemoen <haavard.skinnemoen@atmel.com>
f | syscall-stubs.S | g | 2.1K |  | Al Viro | viro@zeniv.linux.org.uk | 1260531869 |  | Unify sys_mmap*  New helper - sys_mmap_pgoff(); switch syscalls to using it.  Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | sys_avr32.c | s | 674B | 22 | David Howells | dhowells@redhat.com | 1282093663 |  | Make do_execve() take a const filename pointer  Make do_execve() take a const filename pointer so that kernel_execve() compiles correctly on ARM:  arch/arm/kernel/sys_arm.c:88: warning: passing argument 1 of 'do_execve' discards qualifiers from pointer target type  This also requires the argv and envp arguments to be consted twice, once for the pointer array and once for the strings the array points to.  This is because do_execve() passes a pointer to the filename (now const) to copy_strings_kernel().  A simpler alternative would be to cast the filename pointer in do_execve() when it's passed to copy_strings_kernel().  do_execve() may not change any of the strings it is passed as part of the argv or envp lists as they are some of them in .rodata, so marking these strings as const should be fine.  Further kernel_execve() and sys_execve() need to be changed to match.  This has been test built on x86_64, frv, arm and mips.  Signed-off-by: David Howells <dhowells@redhat.com> Tested-by: Ralf Baechle <ralf@linux-mips.org> Acked-by: Russell King <rmk+kernel@arm.linux.org.uk> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | ptrace.c | s | 9.2K | 300 | Namhyung Kim | namhyung@gmail.com | 1288227790 |  | ptrace: cleanup arch_ptrace() on avr32  use new 'datap' variable type of void pointer in order to remove unnecessary castings.  Signed-off-by: Namhyung Kim <namhyung@gmail.com> Acked-by: Haavard Skinnemoen <hskinnemoen@atmel.com> Cc: Hans-Christian Egtvedt <hans-christian.egtvedt@atmel.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | ocd.c | s | 3.8K | 143 | Christoph Hellwig | hch@lst.de | 1202491354 |  | libfs: allow error return from simple attributes  Sometimes simple attributes might need to return an error, e.g. for acquiring a mutex interruptibly.  In fact we have that situation in spufs already which is the original user of the simple attributes.  This patch merged the temporarily forked attributes in spufs back into the main ones and allows to return errors.  [akpm@linux-foundation.org: build fix] Signed-off-by: Christoph Hellwig <hch@lst.de> Cc: <stefano.brivio@polimi.it> Cc: Arnd Bergmann <arnd@arndb.de> Cc: Greg KH <greg@kroah.com> Cc: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | kprobes.c | s | 6.0K | 216 | Haavard Skinnemoen | hskinnemoen@atmel.com | 1201246299 |  | [AVR32] Enable debugging only when needed  Keep track of processes being debugged (including the kernel itself) and turn the OCD system on and off as appropriate. Since enabling debugging turns off some optimizations in the CPU core, this fixes the issue that enabling KProbes support or simply running a program under gdbserver will reduce system performance significantly until the next reboot.  The CPU performance will still be reduced for all processes while a process is being debugged, but this is a lot better than reducing the performance forever.  Signed-off-by: Haavard Skinnemoen <hskinnemoen@atmel.com>
f | irq.c | s | 630B | 24 | Kay Sievers | kay.sievers@vrfy.org | 1324513563 |  | driver-core: remove sysdev.h usage.  The sysdev.h file should not be needed by any in-kernel code, so remove the .h file from these random files that seem to still want to include it.  The sysdev code will be going away soon, so this include needs to be removed no matter what.  Cc: Jiandong Zheng <jdzheng@broadcom.com> Cc: Scott Branden <sbranden@broadcom.com> Cc: Russell King <linux@arm.linux.org.uk> Cc: Kukjin Kim <kgene.kim@samsung.com> Cc: David Brown <davidb@codeaurora.org> Cc: Daniel Walker <dwalker@fifo99.com> Cc: Bryan Huntsman <bryanh@codeaurora.org> Cc: Ben Dooks <ben-linux@fluff.org> Cc: Wan ZongShun <mcuos.com@gmail.com> Cc: Haavard Skinnemoen <hskinnemoen@gmail.com> Cc: Hans-Christian Egtvedt <egtvedt@samfundet.no> Cc: Guan Xuetao <gxt@mprc.pku.edu.cn> Cc: "Venkatesh Pallipadi Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Ingo Molnar <mingo@redhat.com> Cc: "H. Peter Anvin" <hpa@zytor.com> Cc: Grant Likely <grant.likely@secretlab.ca> Cc: Richard Purdie <rpurdie@rpsys.net> Cc: Matthew Garrett <mjg@redhat.com> Signed-off-by: Kay Sievers <kay.sievers@vrfy.org>
f | avr32_ksyms.c | s | 1.8K | 61 | Akinobu Mita | akinobu.mita@gmail.com | 1300934771 |  | asm-generic: rename generic little-endian bitops functions  As a preparation for providing little-endian bitops for all architectures, This renames generic implementation of little-endian bitops.  (remove "generic_" prefix and postfix "_le")  s/generic_find_next_le_bit/find_next_bit_le/ s/generic_find_next_zero_le_bit/find_next_zero_bit_le/ s/generic_find_first_zero_le_bit/find_first_zero_bit_le/ s/generic___test_and_set_le_bit/__test_and_set_bit_le/ s/generic___test_and_clear_le_bit/__test_and_clear_bit_le/ s/generic_test_le_bit/test_bit_le/ s/generic___set_le_bit/__set_bit_le/ s/generic___clear_le_bit/__clear_bit_le/ s/generic_test_and_set_le_bit/test_and_set_bit_le/ s/generic_test_and_clear_le_bit/test_and_clear_bit_le/  Signed-off-by: Akinobu Mita <akinobu.mita@gmail.com> Acked-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Hans-Christian Egtvedt <hans-christian.egtvedt@atmel.com> Cc: Geert Uytterhoeven <geert@linux-m68k.org> Cc: Roman Zippel <zippel@linux-m68k.org> Cc: Andreas Schwab <schwab@linux-m68k.org> Cc: Greg Ungerer <gerg@uclinux.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mackerras <paulus@samba.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | stacktrace.c | s | 1.2K | 48 | Heiko Carstens | heiko.carstens@de.ibm.com | 1216384955 |  | fix core/stacktrace changes on avr32, mips, sh  Fixes this type of problem:    CC      arch/s390/kernel/stacktrace.o arch/s390/kernel/stacktrace.c:84: warning: data definition has no type or storage class arch/s390/kernel/stacktrace.c:84: warning: type defaults to 'int' in declaration of 'EXPORT_SYMBOL_GPL' arch/s390/kernel/stacktrace.c:84: warning: parameter names (without types) in function declaration arch/s390/kernel/stacktrace.c:97: warning: data definition has no type or storage class arch/s390/kernel/stacktrace.c:97: warning: type defaults to 'int' in declaration of 'EXPORT_SYMBOL_GPL' arch/s390/kernel/stacktrace.c:97: warning: parameter names (without types) in function declaration  caused by "stacktrace: export save_stack_trace[_tsk]"  Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com> Cc: Stephen Rothwell <sfr@canb.auug.org.au> Cc: Linus Torvalds <torvalds@linux-foundation.org> Cc: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | switch_to.S | g | 914B |  | Haavard Skinnemoen | hskinnemoen@atmel.com | 1159285734 |  | [PATCH] avr32 architecture  This adds support for the Atmel AVR32 architecture as well as the AT32AP7000 CPU and the AT32STK1000 development board.  AVR32 is a new high-performance 32-bit RISC microprocessor core, designed for cost-sensitive embedded applications, with particular emphasis on low power consumption and high code density.  The AVR32 architecture is not binary compatible with earlier 8-bit AVR architectures.  The AVR32 architecture, including the instruction set, is described by the AVR32 Architecture Manual, available from  http://www.atmel.com/dyn/resources/prod_documents/doc32000.pdf  The Atmel AT32AP7000 is the first CPU implementing the AVR32 architecture.  It features a 7-stage pipeline, 16KB instruction and data caches and a full Memory Management Unit.  It also comes with a large set of integrated peripherals, many of which are shared with the AT91 ARM-based controllers from Atmel.  Full data sheet is available from  http://www.atmel.com/dyn/resources/prod_documents/doc32003.pdf  while the CPU core implementation including caches and MMU is documented by the AVR32 AP Technical Reference, available from  http://www.atmel.com/dyn/resources/prod_documents/doc32001.pdf  Information about the AT32STK1000 development board can be found at  http://www.atmel.com/dyn/products/tools_card.asp?tool_id=3918  including a BSP CD image with an earlier version of this patch, development tools (binaries and source/patches) and a root filesystem image suitable for booting from SD card.  Alternatively, there's a preliminary "getting started" guide available at http://avr32linux.org/twiki/bin/view/Main/GettingStarted which provides links to the sources and patches you will need in order to set up a cross-compiling environment for avr32-linux.  This patch, as well as the other patches included with the BSP and the toolchain patches, is actively supported by Atmel Corporation.  [dmccr@us.ibm.com: Fix more pxx_page macro locations] [bunk@stusta.de: fix `make defconfig'] Signed-off-by: Haavard Skinnemoen <hskinnemoen@atmel.com> Signed-off-by: Adrian Bunk <bunk@stusta.de> Signed-off-by: Dave McCracken <dmccr@us.ibm.com> Signed-off-by: Andrew Morton <akpm@osdl.org> Signed-off-by: Linus Torvalds <torvalds@osdl.org>
f | process.c | s | 10K | 381 | Thomas Gleixner | tglx@linutronix.de | 1330594083 |  | sched/rt: Use schedule_preempt_disabled()  Coccinelle based conversion.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de> Acked-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Link: http://lkml.kernel.org/n/tip-24swm5zut3h9c4a6s46x8rws@git.kernel.org Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | module.c | s | 8.1K | 272 | Jonas Bonn | jonas@southpole.se | 1311510964 |  | modules: make arch's use default loader hooks  This patch removes all the module loader hook implementations in the architecture specific code where the functionality is the same as that now provided by the recently added default hooks.  Signed-off-by: Jonas Bonn <jonas@southpole.se> Acked-by: Mike Frysinger <vapier@gentoo.org> Acked-by: Geert Uytterhoeven <geert@linux-m68k.org> Tested-by: Michal Simek <monstr@monstr.eu> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | setup.c | s | 14K | 516 | Joe Perches | joe@perches.com | 1307710536 |  | treewide: Convert uses of struct resource to resource_size(ptr)  Several fixes as well where the +1 was missing.  Done via coccinelle scripts like:  @@ struct resource *ptr; @@  - ptr->end - ptr->start + 1 + resource_size(ptr)  and some grep and typing.  Mostly uncompiled, no cross-compilers.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | cpu.c | s | 10K | 341 | Kay Sievers | kay.sievers@vrfy.org | 1324506582 |  | cpu: convert 'cpu' and 'machinecheck' sysdev_class to a regular subsystem  This moves the 'cpu sysdev_class' over to a regular 'cpu' subsystem and converts the devices to regular devices. The sysdev drivers are implemented as subsystem interfaces now.  After all sysdev classes are ported to regular driver core entities, the sysdev implementation will be entirely removed from the kernel.  Userspace relies on events and generic sysfs subsystem infrastructure from sysdev devices, which are made available with this conversion.  Cc: Haavard Skinnemoen <hskinnemoen@gmail.com> Cc: Hans-Christian Egtvedt <egtvedt@samfundet.no> Cc: Tony Luck <tony.luck@intel.com> Cc: Fenghua Yu <fenghua.yu@intel.com> Cc: Arnd Bergmann <arnd@arndb.de> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mackerras <paulus@samba.org> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: Heiko Carstens <heiko.carstens@de.ibm.com> Cc: Paul Mundt <lethal@linux-sh.org> Cc: "David S. Miller" <davem@davemloft.net> Cc: Chris Metcalf <cmetcalf@tilera.com> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Ingo Molnar <mingo@redhat.com> Cc: "H. Peter Anvin" <hpa@zytor.com> Cc: Borislav Petkov <bp@amd64.org> Cc: Tigran Aivazian <tigran@aivazian.fsnet.co.uk> Cc: Len Brown <lenb@kernel.org> Cc: Zhang Rui <rui.zhang@intel.com> Cc: Dave Jones <davej@redhat.com> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Russell King <rmk+kernel@arm.linux.org.uk> Cc: Andrew Morton <akpm@linux-foundation.org> Cc: Arjan van de Ven <arjan@linux.intel.com> Cc: "Rafael J. Wysocki" <rjw@sisk.pl> Cc: "Srivatsa S. Bhat" <srivatsa.bhat@linux.vnet.ibm.com> Signed-off-by: Kay Sievers <kay.sievers@vrfy.org> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | signal.c | s | 6.7K | 260 | Al Viro | viro@zeniv.linux.org.uk | 1338846454 |  | fixups for signal breakage  Obvious brainos spotted by Geert.  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | entry-avr32b.S | g | 17K |  | Al Viro | viro@zeniv.linux.org.uk | 1338569930 |  | TIF_RESTORE_SIGMASK can be set only when TIF_SIGPENDING is set  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | nmi_debug.c | s | 1.7K | 69 | Haavard Skinnemoen | hskinnemoen@atmel.com | 1201246303 |  | [AVR32] NMI debugging  Change the NMI handler to use the die notifier chain to signal anyone who cares. Add a simple "nmi debugger" which hooks into this chain and that may dump registers, task state, etc. when it happens.  Signed-off-by: Haavard Skinnemoen <hskinnemoen@atmel.com>
