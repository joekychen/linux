<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › blackfin › mach-bf527 › boards › tll6527m.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>tll6527m.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* File:	arch/blackfin/mach-bf527/boards/tll6527m.c</span>
<span class="cm"> * Based on:	arch/blackfin/mach-bf527/boards/ezkit.c</span>
<span class="cm"> * Author:	Ashish Gupta</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright: 2010 - The Learning Labs Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * Licensed under the GPL-2 or later.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/export.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/mtd.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/partitions.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/physmap.h&gt;</span>
<span class="cp">#include &lt;linux/spi/spi.h&gt;</span>
<span class="cp">#include &lt;linux/spi/flash.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/irq.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/usb/musb.h&gt;</span>
<span class="cp">#include &lt;linux/leds.h&gt;</span>
<span class="cp">#include &lt;linux/input.h&gt;</span>
<span class="cp">#include &lt;asm/dma.h&gt;</span>
<span class="cp">#include &lt;asm/bfin5xx_spi.h&gt;</span>
<span class="cp">#include &lt;asm/reboot.h&gt;</span>
<span class="cp">#include &lt;asm/nand.h&gt;</span>
<span class="cp">#include &lt;asm/portmux.h&gt;</span>
<span class="cp">#include &lt;asm/dpmc.h&gt;</span>

<span class="cp">#if defined(CONFIG_TOUCHSCREEN_AD7879) \</span>
<span class="cp">	|| defined(CONFIG_TOUCHSCREEN_AD7879_MODULE)</span>
<span class="cp">#include &lt;linux/spi/ad7879.h&gt;</span>
<span class="cp">#define LCD_BACKLIGHT_GPIO 0x40</span>
<span class="cm">/* TLL6527M uses TLL7UIQ35 / ADI LCD EZ Extender. AD7879 AUX GPIO is used for</span>
<span class="cm"> * LCD Backlight Enable</span>
<span class="cm"> */</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Name the Board for the /proc/cpuinfo</span>
<span class="cm"> */</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">bfin_board_name</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;TLL6527M&quot;</span><span class="p">;</span>
<span class="cm">/*</span>
<span class="cm"> *  Driver needs to know address, irq and flag pin.</span>
<span class="cm"> */</span>

<span class="cp">#if defined(CONFIG_USB_MUSB_HDRC) || defined(CONFIG_USB_MUSB_HDRC_MODULE)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">musb_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="mh">0xffc03800</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="mh">0xffc03cff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>	<span class="cm">/* general IRQ */</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">IRQ_USB_INT0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="n">IRQ_USB_INT0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span> <span class="o">|</span> <span class="n">IORESOURCE_IRQ_HIGHLEVEL</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>	<span class="cm">/* DMA IRQ */</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">IRQ_USB_DMA</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="n">IRQ_USB_DMA</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span> <span class="o">|</span> <span class="n">IORESOURCE_IRQ_HIGHLEVEL</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">musb_hdrc_config</span> <span class="n">musb_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">multipoint</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dyn_fifo</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">soft_con</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_eps</span>	<span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_channels</span>	<span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="cm">/*.gpio_vrsel	= GPIO_PG13,*/</span>
	<span class="cm">/* Some custom boards need to be active low, just set it to &quot;0&quot;</span>
<span class="cm">	 * if it is the case.</span>
<span class="cm">	 */</span>
	<span class="p">.</span><span class="n">gpio_vrsel_active</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">musb_hdrc_platform_data</span> <span class="n">musb_plat</span> <span class="o">=</span> <span class="p">{</span>
<span class="cp">#if defined(CONFIG_USB_MUSB_OTG)</span>
	<span class="p">.</span><span class="n">mode</span>		<span class="o">=</span> <span class="n">MUSB_OTG</span><span class="p">,</span>
<span class="cp">#elif defined(CONFIG_USB_MUSB_HDRC_HCD)</span>
	<span class="p">.</span><span class="n">mode</span>		<span class="o">=</span> <span class="n">MUSB_HOST</span><span class="p">,</span>
<span class="cp">#elif defined(CONFIG_USB_GADGET_MUSB_HDRC)</span>
	<span class="p">.</span><span class="n">mode</span>		<span class="o">=</span> <span class="n">MUSB_PERIPHERAL</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="p">.</span><span class="n">config</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">musb_config</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">u64</span> <span class="n">musb_dmamask</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">musb_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;musb-blackfin&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">dma_mask</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">musb_dmamask</span><span class="p">,</span>
		<span class="p">.</span><span class="n">coherent_dma_mask</span>	<span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">musb_plat</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">musb_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">musb_resources</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_FB_BFIN_LQ035Q1) || defined(CONFIG_FB_BFIN_LQ035Q1_MODULE)</span>
<span class="cp">#include &lt;asm/bfin-lq035q1.h&gt;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">bfin_lq035q1fb_disp_info</span> <span class="n">bfin_lq035q1_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">LQ035_NORM</span> <span class="o">|</span> <span class="n">LQ035_RGB</span> <span class="o">|</span> <span class="n">LQ035_RL</span> <span class="o">|</span> <span class="n">LQ035_TB</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ppi_mode</span> <span class="o">=</span> <span class="n">USE_RGB565_16_BIT_PPI</span><span class="p">,</span>
	<span class="p">.</span><span class="n">use_bl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_bl</span> <span class="o">=</span> <span class="n">LCD_BACKLIGHT_GPIO</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">bfin_lq035q1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_PPI_ERROR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_PPI_ERROR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_lq035q1_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;bfin-lq035q1&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>		<span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_lq035q1_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>	<span class="o">=</span> <span class="n">bfin_lq035q1_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_lq035q1_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_MTD_GPIO_ADDR) || defined(CONFIG_MTD_GPIO_ADDR_MODULE)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mtd_partition</span> <span class="n">tll6527m_partitions</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>       <span class="o">=</span> <span class="s">&quot;bootloader(nor)&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>       <span class="o">=</span> <span class="mh">0xA0000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>       <span class="o">=</span> <span class="s">&quot;linux kernel(nor)&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>       <span class="o">=</span> <span class="mh">0xD00000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>     <span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>       <span class="o">=</span> <span class="s">&quot;file system(nor)&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span>       <span class="o">=</span> <span class="n">MTDPART_SIZ_FULL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span>     <span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">physmap_flash_data</span> <span class="n">tll6527m_flash_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">width</span>      <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parts</span>      <span class="o">=</span> <span class="n">tll6527m_partitions</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nr_parts</span>   <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tll6527m_partitions</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="n">tll6527m_flash_gpios</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">GPIO_PG11</span><span class="p">,</span> <span class="n">GPIO_PH11</span><span class="p">,</span> <span class="n">GPIO_PH12</span> <span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">tll6527m_flash_resource</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;cfi_probe&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="mh">0x201fffff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">tll6527m_flash_gpios</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tll6527m_flash_gpios</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">tll6527m_flash_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>          <span class="o">=</span> <span class="s">&quot;gpio-addr-flash&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>            <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tll6527m_flash_data</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tll6527m_flash_resource</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>      <span class="o">=</span> <span class="n">tll6527m_flash_resource</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_GPIO_DECODER) || defined(CONFIG_GPIO_DECODER_MODULE)</span>
<span class="cm">/* An SN74LVC138A 3:8 decoder chip has been used to generate 7 augmented</span>
<span class="cm"> * outputs used as SPI CS lines for all SPI SLAVE devices on TLL6527v1-0.</span>
<span class="cm"> * EXP_GPIO_SPISEL_BASE is the base number for the expanded outputs being</span>
<span class="cm"> * used as SPI CS lines, this should be &gt; MAX_BLACKFIN_GPIOS</span>
<span class="cm"> */</span>
<span class="cp">#include &lt;linux/gpio-decoder.h&gt;</span>
<span class="cp">#define EXP_GPIO_SPISEL_BASE 0x64</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="n">gpio_addr_inputs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">GPIO_PG1</span><span class="p">,</span> <span class="n">GPIO_PH9</span><span class="p">,</span> <span class="n">GPIO_PH10</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_decoder_platform_data</span> <span class="n">spi_decoded_cs</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">base</span>		<span class="o">=</span> <span class="n">EXP_GPIO_SPISEL_BASE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">input_addrs</span>	<span class="o">=</span> <span class="n">gpio_addr_inputs</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nr_input_addrs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">gpio_addr_inputs</span><span class="p">),</span>
	<span class="p">.</span><span class="n">default_output</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="cm">/*	.default_output = (1 &lt;&lt; ARRAY_SIZE(gpio_addr_inputs)) - 1 */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">spi_decoded_gpio</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;gpio-decoder&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spi_decoded_cs</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#else</span>
<span class="cp">#define EXP_GPIO_SPISEL_BASE 0x0</span>

<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_INPUT_ADXL34X) || defined(CONFIG_INPUT_ADXL34X_MODULE)</span>
<span class="cp">#include &lt;linux/input/adxl34x.h&gt;</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">adxl34x_platform_data</span> <span class="n">adxl345_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">x_axis_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">y_axis_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">z_axis_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tap_threshold</span> <span class="o">=</span> <span class="mh">0x31</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tap_duration</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tap_latency</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tap_window</span> <span class="o">=</span> <span class="mh">0xF0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tap_axis_control</span> <span class="o">=</span> <span class="n">ADXL_TAP_X_EN</span> <span class="o">|</span> <span class="n">ADXL_TAP_Y_EN</span> <span class="o">|</span> <span class="n">ADXL_TAP_Z_EN</span><span class="p">,</span>
	<span class="p">.</span><span class="n">act_axis_control</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">activity_threshold</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inactivity_threshold</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inactivity_time</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">free_fall_threshold</span> <span class="o">=</span> <span class="mh">0x7</span><span class="p">,</span>
	<span class="p">.</span><span class="n">free_fall_time</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="p">.</span><span class="n">data_rate</span> <span class="o">=</span> <span class="mh">0x8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">data_range</span> <span class="o">=</span> <span class="n">ADXL_FULL_RES</span><span class="p">,</span>

	<span class="p">.</span><span class="n">ev_type</span> <span class="o">=</span> <span class="n">EV_ABS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ev_code_x</span> <span class="o">=</span> <span class="n">ABS_X</span><span class="p">,</span>		<span class="cm">/* EV_REL */</span>
	<span class="p">.</span><span class="n">ev_code_y</span> <span class="o">=</span> <span class="n">ABS_Y</span><span class="p">,</span>		<span class="cm">/* EV_REL */</span>
	<span class="p">.</span><span class="n">ev_code_z</span> <span class="o">=</span> <span class="n">ABS_Z</span><span class="p">,</span>		<span class="cm">/* EV_REL */</span>

	<span class="p">.</span><span class="n">ev_code_tap</span> <span class="o">=</span> <span class="p">{</span><span class="n">BTN_TOUCH</span><span class="p">,</span> <span class="n">BTN_TOUCH</span><span class="p">,</span> <span class="n">BTN_TOUCH</span><span class="p">},</span> <span class="cm">/* EV_KEY x,y,z */</span>

<span class="cm">/*	.ev_code_ff = KEY_F,*/</span>		<span class="cm">/* EV_KEY */</span>
	<span class="p">.</span><span class="n">ev_code_act_inactivity</span> <span class="o">=</span> <span class="n">KEY_A</span><span class="p">,</span>	<span class="cm">/* EV_KEY */</span>
	<span class="p">.</span><span class="n">use_int2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">power_mode</span> <span class="o">=</span> <span class="n">ADXL_AUTO_SLEEP</span> <span class="o">|</span> <span class="n">ADXL_LINK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">fifo_mode</span> <span class="o">=</span> <span class="n">ADXL_FIFO_STREAM</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_RTC_DRV_BFIN) || defined(CONFIG_RTC_DRV_BFIN_MODULE)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">rtc_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;rtc-bfin&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_BFIN_MAC) || defined(CONFIG_BFIN_MAC_MODULE)</span>
<span class="cp">#include &lt;linux/bfin_mac.h&gt;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">bfin_mac_peripherals</span><span class="p">[]</span> <span class="o">=</span> <span class="n">P_RMII0</span><span class="p">;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">bfin_phydev_platform_data</span> <span class="n">bfin_phydev_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">IRQ_MAC_PHYINT</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">bfin_mii_bus_platform_data</span> <span class="n">bfin_mii_bus_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phydev_number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phydev_data</span> <span class="o">=</span> <span class="n">bfin_phydev_data</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_mode</span> <span class="o">=</span> <span class="n">PHY_INTERFACE_MODE_RMII</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mac_peripherals</span> <span class="o">=</span> <span class="n">bfin_mac_peripherals</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_mii_bus</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bfin_mii_bus&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_mii_bus_data</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_mac_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bfin_mac&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_mii_bus</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_MTD_M25P80) \</span>
<span class="cp">	|| defined(CONFIG_MTD_M25P80_MODULE)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mtd_partition</span> <span class="n">bfin_spi_flash_partitions</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bootloader(spi)&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="mh">0x00040000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="n">MTD_CAP_ROM</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;linux kernel(spi)&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">MTDPART_SIZ_FULL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">MTDPART_OFS_APPEND</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">flash_platform_data</span> <span class="n">bfin_spi_flash_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;m25p80&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">parts</span> <span class="o">=</span> <span class="n">bfin_spi_flash_partitions</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nr_parts</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_spi_flash_partitions</span><span class="p">),</span>
	<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;m25p16&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* SPI flash chip (m25p64) */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">bfin5xx_spi_chip</span> <span class="n">spi_flash_chip_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">enable_dma</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>         <span class="cm">/* use dma transfer with this chip*/</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_MMC_SPI) || defined(CONFIG_MMC_SPI_MODULE)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">bfin5xx_spi_chip</span>  <span class="n">mmc_spi_chip_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">enable_dma</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_TOUCHSCREEN_AD7879) \</span>
<span class="cp">	|| defined(CONFIG_TOUCHSCREEN_AD7879_MODULE)</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ad7879_platform_data</span> <span class="n">bfin_ad7879_ts_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">model</span>			<span class="o">=</span> <span class="mi">7879</span><span class="p">,</span>	<span class="cm">/* Model = AD7879 */</span>
	<span class="p">.</span><span class="n">x_plate_ohms</span>		<span class="o">=</span> <span class="mi">620</span><span class="p">,</span>	<span class="cm">/* 620 Ohm from the touch datasheet */</span>
	<span class="p">.</span><span class="n">pressure_max</span>		<span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pressure_min</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">first_conversion_delay</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
				<span class="cm">/* wait 512us before do a first conversion */</span>
	<span class="p">.</span><span class="n">acquisition_time</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* 4us acquisition time per sample */</span>
	<span class="p">.</span><span class="n">median</span>			<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* do 8 measurements */</span>
	<span class="p">.</span><span class="n">averaging</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
				<span class="cm">/* take the average of 4 middle samples */</span>
	<span class="p">.</span><span class="n">pen_down_acc_interval</span>	<span class="o">=</span> <span class="mi">255</span><span class="p">,</span>	<span class="cm">/* 9.4 ms */</span>
	<span class="p">.</span><span class="n">gpio_export</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* configure AUX as GPIO output*/</span>
	<span class="p">.</span><span class="n">gpio_base</span>		<span class="o">=</span> <span class="n">LCD_BACKLIGHT_GPIO</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_SND_BF5XX_I2S) || defined(CONFIG_SND_BF5XX_I2S_MODULE)</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_i2s</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bfin-i2s&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">CONFIG_SND_BF5XX_SPORT_NUM</span><span class="p">,</span>
	<span class="cm">/* TODO: add platform data here */</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_GPIO_MCP23S08) || defined(CONFIG_GPIO_MCP23S08_MODULE)</span>
<span class="cp">#include &lt;linux/spi/mcp23s08.h&gt;</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">mcp23s08_platform_data</span> <span class="n">bfin_mcp23s08_sys_gpio_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">chip</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">is_present</span> <span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
	<span class="p">.</span><span class="n">base</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">mcp23s08_platform_data</span> <span class="n">bfin_mcp23s08_usr_gpio_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">chip</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">is_present</span> <span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
	<span class="p">.</span><span class="n">base</span> <span class="o">=</span> <span class="mh">0x38</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">spi_board_info</span> <span class="n">bfin_spi_board_info</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
<span class="cp">#if defined(CONFIG_MTD_M25P80) \</span>
<span class="cp">	|| defined(CONFIG_MTD_M25P80_MODULE)</span>
	<span class="p">{</span>
		<span class="cm">/* the modalias must be the same as spi device driver name */</span>
		<span class="p">.</span><span class="n">modalias</span> <span class="o">=</span> <span class="s">&quot;m25p80&quot;</span><span class="p">,</span> <span class="cm">/* Name of spi_driver for this device */</span>
		<span class="p">.</span><span class="n">max_speed_hz</span> <span class="o">=</span> <span class="mi">25000000</span><span class="p">,</span>
				<span class="cm">/* max spi clock (SCK) speed in HZ */</span>
		<span class="p">.</span><span class="n">bus_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* Framework bus number */</span>
		<span class="p">.</span><span class="n">chip_select</span> <span class="o">=</span> <span class="n">EXP_GPIO_SPISEL_BASE</span> <span class="o">+</span> <span class="mh">0x04</span> <span class="o">+</span> <span class="n">MAX_CTRL_CS</span><span class="p">,</span>
		<span class="cm">/* Can be connected to TLL6527M GPIO connector */</span>
		<span class="cm">/* Either SPI_ADC or M25P80 FLASH can be installed at a time */</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_spi_flash_data</span><span class="p">,</span>
		<span class="p">.</span><span class="n">controller_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spi_flash_chip_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">SPI_MODE_3</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_MMC_SPI) || defined(CONFIG_MMC_SPI_MODULE)</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span> <span class="o">=</span> <span class="s">&quot;mmc_spi&quot;</span><span class="p">,</span>
<span class="cm">/*</span>
<span class="cm"> * TLL6527M V1.0 does not support SD Card at SPI Clock &gt; 10 MHz due to</span>
<span class="cm"> * SPI buffer limitations</span>
<span class="cm"> */</span>
		<span class="p">.</span><span class="n">max_speed_hz</span> <span class="o">=</span> <span class="mi">10000000</span><span class="p">,</span>
					<span class="cm">/* max spi clock (SCK) speed in HZ */</span>
		<span class="p">.</span><span class="n">bus_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_select</span> <span class="o">=</span> <span class="n">EXP_GPIO_SPISEL_BASE</span> <span class="o">+</span> <span class="mh">0x05</span> <span class="o">+</span> <span class="n">MAX_CTRL_CS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">controller_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mmc_spi_chip_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">SPI_MODE_0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(CONFIG_TOUCHSCREEN_AD7879_SPI) \</span>
<span class="cp">	|| defined(CONFIG_TOUCHSCREEN_AD7879_SPI_MODULE)</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span> <span class="o">=</span> <span class="s">&quot;ad7879&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_ad7879_ts_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">IRQ_PH14</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_speed_hz</span> <span class="o">=</span> <span class="mi">5000000</span><span class="p">,</span>
					<span class="cm">/* max spi clock (SCK) speed in HZ */</span>
		<span class="p">.</span><span class="n">bus_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_select</span> <span class="o">=</span> <span class="n">EXP_GPIO_SPISEL_BASE</span> <span class="o">+</span> <span class="mh">0x07</span> <span class="o">+</span> <span class="n">MAX_CTRL_CS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">SPI_CPHA</span> <span class="o">|</span> <span class="n">SPI_CPOL</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(CONFIG_SPI_SPIDEV) || defined(CONFIG_SPI_SPIDEV_MODULE)</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span> <span class="o">=</span> <span class="s">&quot;spidev&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_speed_hz</span> <span class="o">=</span> <span class="mi">10000000</span><span class="p">,</span>
		<span class="cm">/* TLL6527Mv1-0 supports max spi clock (SCK) speed = 10 MHz */</span>
		<span class="p">.</span><span class="n">bus_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_select</span> <span class="o">=</span> <span class="n">EXP_GPIO_SPISEL_BASE</span> <span class="o">+</span> <span class="mh">0x03</span> <span class="o">+</span> <span class="n">MAX_CTRL_CS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">SPI_CPHA</span> <span class="o">|</span> <span class="n">SPI_CPOL</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(CONFIG_FB_BFIN_LQ035Q1) || defined(CONFIG_FB_BFIN_LQ035Q1_MODULE)</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span> <span class="o">=</span> <span class="s">&quot;bfin-lq035q1-spi&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_speed_hz</span> <span class="o">=</span> <span class="mi">20000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bus_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_select</span> <span class="o">=</span> <span class="n">EXP_GPIO_SPISEL_BASE</span> <span class="o">+</span> <span class="mh">0x06</span> <span class="o">+</span> <span class="n">MAX_CTRL_CS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">SPI_CPHA</span> <span class="o">|</span> <span class="n">SPI_CPOL</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(CONFIG_GPIO_MCP23S08) || defined(CONFIG_GPIO_MCP23S08_MODULE)</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span> <span class="o">=</span> <span class="s">&quot;mcp23s08&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_mcp23s08_sys_gpio_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_speed_hz</span> <span class="o">=</span> <span class="mi">5000000</span><span class="p">,</span> <span class="cm">/* max spi clock (SCK) speed in HZ */</span>
		<span class="p">.</span><span class="n">bus_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_select</span> <span class="o">=</span> <span class="n">EXP_GPIO_SPISEL_BASE</span> <span class="o">+</span> <span class="mh">0x01</span> <span class="o">+</span> <span class="n">MAX_CTRL_CS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">SPI_CPHA</span> <span class="o">|</span> <span class="n">SPI_CPOL</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">modalias</span> <span class="o">=</span> <span class="s">&quot;mcp23s08&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_mcp23s08_usr_gpio_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_speed_hz</span> <span class="o">=</span> <span class="mi">5000000</span><span class="p">,</span> <span class="cm">/* max spi clock (SCK) speed in HZ */</span>
		<span class="p">.</span><span class="n">bus_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_select</span> <span class="o">=</span> <span class="n">EXP_GPIO_SPISEL_BASE</span> <span class="o">+</span> <span class="mh">0x02</span> <span class="o">+</span> <span class="n">MAX_CTRL_CS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">SPI_CPHA</span> <span class="o">|</span> <span class="n">SPI_CPOL</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="cp">#if defined(CONFIG_SPI_BFIN5XX) || defined(CONFIG_SPI_BFIN5XX_MODULE)</span>
<span class="cm">/* SPI controller data */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">bfin5xx_spi_master</span> <span class="n">bfin_spi0_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_chipselect</span> <span class="o">=</span> <span class="n">EXP_GPIO_SPISEL_BASE</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">MAX_CTRL_CS</span><span class="p">,</span>
	<span class="cm">/* EXP_GPIO_SPISEL_BASE will be &gt; MAX_BLACKFIN_GPIOS */</span>
	<span class="p">.</span><span class="n">enable_dma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>  <span class="cm">/* master has the ability to do dma transfer */</span>
	<span class="p">.</span><span class="n">pin_req</span> <span class="o">=</span> <span class="p">{</span><span class="n">P_SPI0_SCK</span><span class="p">,</span> <span class="n">P_SPI0_MISO</span><span class="p">,</span> <span class="n">P_SPI0_MOSI</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* SPI (0) */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">bfin_spi0_resource</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">SPI0_REGBASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">SPI0_REGBASE</span> <span class="o">+</span> <span class="mh">0xFF</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">CH_SPI</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">CH_SPI</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_DMA</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_SPI</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">IRQ_SPI</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_spi0_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bfin-spi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* Bus number */</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_spi0_resource</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">bfin_spi0_resource</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_spi0_info</span><span class="p">,</span> <span class="cm">/* Passed to driver */</span>
	<span class="p">},</span>
<span class="p">};</span>
<span class="cp">#endif  </span><span class="cm">/* spi master and devices */</span><span class="cp"></span>

<span class="cp">#if defined(CONFIG_SERIAL_BFIN) || defined(CONFIG_SERIAL_BFIN_MODULE)</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_UART0</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">bfin_uart0_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">UART0_THR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">UART0_GCTL</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_UART0_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_UART0_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_UART0_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_UART0_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_UART0_ERROR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_UART0_ERROR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">CH_UART0_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">CH_UART0_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_DMA</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">CH_UART0_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">CH_UART0_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_DMA</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">bfin_uart0_peripherals</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">P_UART0_TX</span><span class="p">,</span> <span class="n">P_UART0_RX</span><span class="p">,</span> <span class="mi">0</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_uart0_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bfin-uart&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_uart0_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">bfin_uart0_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_uart0_peripherals</span><span class="p">,</span>
					<span class="cm">/* Passed to driver */</span>
	<span class="p">},</span>
<span class="p">};</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_UART1</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">bfin_uart1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">UART1_THR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">UART1_GCTL</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_UART1_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_UART1_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_UART1_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_UART1_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_UART1_ERROR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_UART1_ERROR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">CH_UART1_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">CH_UART1_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_DMA</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">CH_UART1_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">CH_UART1_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_DMA</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#ifdef CONFIG_BFIN_UART1_CTSRTS</span>
	<span class="p">{</span>	<span class="cm">/* CTS pin */</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">GPIO_PF9</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">GPIO_PF9</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>	<span class="cm">/* RTS pin */</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">GPIO_PF10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">GPIO_PF10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">bfin_uart1_peripherals</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">P_UART1_TX</span><span class="p">,</span> <span class="n">P_UART1_RX</span><span class="p">,</span> <span class="mi">0</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_uart1_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bfin-uart&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_uart1_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">bfin_uart1_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_uart1_peripherals</span><span class="p">,</span>
						<span class="cm">/* Passed to driver */</span>
	<span class="p">},</span>
<span class="p">};</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_BFIN_SIR) || defined(CONFIG_BFIN_SIR_MODULE)</span>
<span class="cp">#ifdef CONFIG_BFIN_SIR0</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">bfin_sir0_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0xFFC00400</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="mh">0xFFC004FF</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_UART0_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_UART0_RX</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">CH_UART0_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">CH_UART0_RX</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_DMA</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_sir0_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bfin_sir&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_sir0_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">bfin_sir0_resources</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_BFIN_SIR1</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">bfin_sir1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0xFFC02000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="mh">0xFFC020FF</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_UART1_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_UART1_RX</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">CH_UART1_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">CH_UART1_RX</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_DMA</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_sir1_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bfin_sir&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_sir1_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">bfin_sir1_resources</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_I2C_BLACKFIN_TWI) || defined(CONFIG_I2C_BLACKFIN_TWI_MODULE)</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">u16</span> <span class="n">bfin_twi0_pins</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">P_TWI0_SCL</span><span class="p">,</span> <span class="n">P_TWI0_SDA</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">bfin_twi0_resource</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">TWI0_REGBASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">TWI0_REGBASE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_TWI</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">IRQ_TWI</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">i2c_bfin_twi_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;i2c-bfin-twi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_twi0_resource</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">bfin_twi0_resource</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_twi0_pins</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">bfin_i2c_board_info</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cp">#if defined(CONFIG_BFIN_TWI_LCD) || defined(CONFIG_BFIN_TWI_LCD_MODULE)</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;pcf8574_lcd&quot;</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">),</span>
	<span class="p">},</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_FB_BFIN_7393) || defined(CONFIG_FB_BFIN_7393_MODULE)</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;bfin-adv7393&quot;</span><span class="p">,</span> <span class="mh">0x2B</span><span class="p">),</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(CONFIG_TOUCHSCREEN_AD7879_I2C) \</span>
<span class="cp">	|| defined(CONFIG_TOUCHSCREEN_AD7879_I2C_MODULE)</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;ad7879&quot;</span><span class="p">,</span> <span class="mh">0x2C</span><span class="p">),</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">IRQ_PH14</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">bfin_ad7879_ts_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="cp">#if defined(CONFIG_SND_SOC_SSM2602) || defined(CONFIG_SND_SOC_SSM2602_MODULE)</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;ssm2602&quot;</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">),</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;adm1192&quot;</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">),</span>
	<span class="p">},</span>

	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;ltc3576&quot;</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">),</span>
	<span class="p">},</span>
<span class="cp">#if defined(CONFIG_INPUT_ADXL34X_I2C) \</span>
<span class="cp">	|| defined(CONFIG_INPUT_ADXL34X_I2C_MODULE)</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;adxl34x&quot;</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">),</span>
		<span class="p">.</span><span class="n">irq</span> <span class="o">=</span> <span class="n">IRQ_PH13</span><span class="p">,</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">adxl345_info</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="cp">#if defined(CONFIG_SERIAL_BFIN_SPORT) \</span>
<span class="cp">	|| defined(CONFIG_SERIAL_BFIN_SPORT_MODULE)</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_SPORT0_UART</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">bfin_sport0_uart_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">SPORT0_TCR1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">SPORT0_MRCS3</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_SPORT0_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_SPORT0_RX</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_SPORT0_ERROR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_SPORT0_ERROR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">bfin_sport0_peripherals</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">P_SPORT0_TFS</span><span class="p">,</span> <span class="n">P_SPORT0_DTPRI</span><span class="p">,</span> <span class="n">P_SPORT0_TSCLK</span><span class="p">,</span> <span class="n">P_SPORT0_RFS</span><span class="p">,</span>
	<span class="n">P_SPORT0_DRPRI</span><span class="p">,</span> <span class="n">P_SPORT0_RSCLK</span><span class="p">,</span> <span class="mi">0</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_sport0_uart_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bfin-sport-uart&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_sport0_uart_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">bfin_sport0_uart_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_sport0_peripherals</span><span class="p">,</span>
		<span class="cm">/* Passed to driver */</span>
	<span class="p">},</span>
<span class="p">};</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_SPORT1_UART</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">bfin_sport1_uart_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">SPORT1_TCR1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">SPORT1_MRCS3</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_SPORT1_RX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_SPORT1_RX</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">IRQ_SPORT1_ERROR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">IRQ_SPORT1_ERROR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">bfin_sport1_peripherals</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">P_SPORT1_TFS</span><span class="p">,</span> <span class="n">P_SPORT1_DTPRI</span><span class="p">,</span> <span class="n">P_SPORT1_TSCLK</span><span class="p">,</span> <span class="n">P_SPORT1_RFS</span><span class="p">,</span>
	<span class="n">P_SPORT1_DRPRI</span><span class="p">,</span> <span class="n">P_SPORT1_RSCLK</span><span class="p">,</span> <span class="mi">0</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_sport1_uart_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bfin-sport-uart&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_sport1_uart_resources</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">bfin_sport1_uart_resources</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_sport1_peripherals</span><span class="p">,</span>
		<span class="cm">/* Passed to driver */</span>
	<span class="p">},</span>
<span class="p">};</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cclk_vlev_datasheet</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">VRPAIR</span><span class="p">(</span><span class="n">VLEV_100</span><span class="p">,</span> <span class="mi">400000000</span><span class="p">),</span>
	<span class="n">VRPAIR</span><span class="p">(</span><span class="n">VLEV_105</span><span class="p">,</span> <span class="mi">426000000</span><span class="p">),</span>
	<span class="n">VRPAIR</span><span class="p">(</span><span class="n">VLEV_110</span><span class="p">,</span> <span class="mi">500000000</span><span class="p">),</span>
	<span class="n">VRPAIR</span><span class="p">(</span><span class="n">VLEV_115</span><span class="p">,</span> <span class="mi">533000000</span><span class="p">),</span>
	<span class="n">VRPAIR</span><span class="p">(</span><span class="n">VLEV_120</span><span class="p">,</span> <span class="mi">600000000</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">bfin_dpmc_platform_data</span> <span class="n">bfin_dmpc_vreg_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">tuple_tab</span> <span class="o">=</span> <span class="n">cclk_vlev_datasheet</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tabsize</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cclk_vlev_datasheet</span><span class="p">),</span>
	<span class="p">.</span><span class="n">vr_settling_time</span> <span class="o">=</span> <span class="mi">25</span> <span class="cm">/* us */</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">bfin_dpmc</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bfin dpmc&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bfin_dmpc_vreg_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">tll6527m_devices</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>

	<span class="o">&amp;</span><span class="n">bfin_dpmc</span><span class="p">,</span>

<span class="cp">#if defined(CONFIG_RTC_DRV_BFIN) || defined(CONFIG_RTC_DRV_BFIN_MODULE)</span>
	<span class="o">&amp;</span><span class="n">rtc_device</span><span class="p">,</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_USB_MUSB_HDRC) || defined(CONFIG_USB_MUSB_HDRC_MODULE)</span>
	<span class="o">&amp;</span><span class="n">musb_device</span><span class="p">,</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_BFIN_MAC) || defined(CONFIG_BFIN_MAC_MODULE)</span>
	<span class="o">&amp;</span><span class="n">bfin_mii_bus</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">bfin_mac_device</span><span class="p">,</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_SPI_BFIN5XX) || defined(CONFIG_SPI_BFIN5XX_MODULE)</span>
	<span class="o">&amp;</span><span class="n">bfin_spi0_device</span><span class="p">,</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_FB_BFIN_LQ035Q1) || defined(CONFIG_FB_BFIN_LQ035Q1_MODULE)</span>
	<span class="o">&amp;</span><span class="n">bfin_lq035q1_device</span><span class="p">,</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_SERIAL_BFIN) || defined(CONFIG_SERIAL_BFIN_MODULE)</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_UART0</span>
	<span class="o">&amp;</span><span class="n">bfin_uart0_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_UART1</span>
	<span class="o">&amp;</span><span class="n">bfin_uart1_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_BFIN_SIR) || defined(CONFIG_BFIN_SIR_MODULE)</span>
<span class="cp">#ifdef CONFIG_BFIN_SIR0</span>
	<span class="o">&amp;</span><span class="n">bfin_sir0_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_BFIN_SIR1</span>
	<span class="o">&amp;</span><span class="n">bfin_sir1_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_I2C_BLACKFIN_TWI) || defined(CONFIG_I2C_BLACKFIN_TWI_MODULE)</span>
	<span class="o">&amp;</span><span class="n">i2c_bfin_twi_device</span><span class="p">,</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_SERIAL_BFIN_SPORT) \</span>
<span class="cp">	|| defined(CONFIG_SERIAL_BFIN_SPORT_MODULE)</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_SPORT0_UART</span>
	<span class="o">&amp;</span><span class="n">bfin_sport0_uart_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_SPORT1_UART</span>
	<span class="o">&amp;</span><span class="n">bfin_sport1_uart_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_MTD_GPIO_ADDR) || defined(CONFIG_MTD_GPIO_ADDR_MODULE)</span>
	<span class="o">&amp;</span><span class="n">tll6527m_flash_device</span><span class="p">,</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_SND_BF5XX_I2S) || defined(CONFIG_SND_BF5XX_I2S_MODULE)</span>
	<span class="o">&amp;</span><span class="n">bfin_i2s</span><span class="p">,</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_GPIO_DECODER) || defined(CONFIG_GPIO_DECODER_MODULE)</span>
	<span class="o">&amp;</span><span class="n">spi_decoded_gpio</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">tll6527m_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s(): registering device resources</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bfin_i2c_board_info</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_i2c_board_info</span><span class="p">));</span>
	<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">tll6527m_devices</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tll6527m_devices</span><span class="p">));</span>
	<span class="n">spi_register_board_info</span><span class="p">(</span><span class="n">bfin_spi_board_info</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bfin_spi_board_info</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">arch_initcall</span><span class="p">(</span><span class="n">tll6527m_init</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">tll6527m_early_devices</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
<span class="cp">#if defined(CONFIG_SERIAL_BFIN_CONSOLE) || defined(CONFIG_EARLY_PRINTK)</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_UART0</span>
	<span class="o">&amp;</span><span class="n">bfin_uart0_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_UART1</span>
	<span class="o">&amp;</span><span class="n">bfin_uart1_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_SERIAL_BFIN_SPORT_CONSOLE)</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_SPORT0_UART</span>
	<span class="o">&amp;</span><span class="n">bfin_sport0_uart_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_SERIAL_BFIN_SPORT1_UART</span>
	<span class="o">&amp;</span><span class="n">bfin_sport1_uart_device</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">native_machine_early_platform_add_devices</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;register early platform devices</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">early_platform_add_devices</span><span class="p">(</span><span class="n">tll6527m_early_devices</span><span class="p">,</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tll6527m_early_devices</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">native_machine_restart</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* workaround reboot hang when booting from SPI */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">bfin_read_SYSCR</span><span class="p">()</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x3</span><span class="p">)</span>
		<span class="n">bfin_reset_boot_spi_cs</span><span class="p">(</span><span class="n">P_DEFAULT_BOOT_SPI_CS</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">bfin_get_ether_addr</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* the MAC is stored in OTP memory page 0xDF */</span>
	<span class="n">u32</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">otp_mac</span><span class="p">;</span>
	<span class="n">u32</span> <span class="p">(</span><span class="o">*</span><span class="n">otp_read</span><span class="p">)(</span><span class="n">u32</span> <span class="n">page</span><span class="p">,</span> <span class="n">u32</span> <span class="n">flags</span><span class="p">,</span>
			<span class="n">u64</span> <span class="o">*</span><span class="n">page_content</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xEF00001A</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">otp_read</span><span class="p">(</span><span class="mh">0xDF</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">otp_mac</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ret</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">char</span> <span class="o">*</span><span class="n">otp_mac_p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">otp_mac</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">ret</span><span class="p">)</span>
			<span class="n">addr</span><span class="p">[</span><span class="n">ret</span><span class="p">]</span> <span class="o">=</span> <span class="n">otp_mac_p</span><span class="p">[</span><span class="mi">5</span> <span class="o">-</span> <span class="n">ret</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">bfin_get_ether_addr</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
