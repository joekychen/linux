<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › blackfin › include › asm › bfin_sport.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>bfin_sport.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * bfin_sport.h - interface to Blackfin SPORTs</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2004-2009 Analog Devices Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * Licensed under the GPL-2 or later.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __BFIN_SPORT_H__</span>
<span class="cp">#define __BFIN_SPORT_H__</span>

<span class="cm">/* Sport mode: it can be set to TDM, i2s or others */</span>
<span class="cp">#define NORM_MODE	0x0</span>
<span class="cp">#define TDM_MODE	0x1</span>
<span class="cp">#define I2S_MODE	0x2</span>
<span class="cp">#define NDSO_MODE	0x3</span>

<span class="cm">/* Data format, normal, a-law or u-law */</span>
<span class="cp">#define NORM_FORMAT	0x0</span>
<span class="cp">#define ALAW_FORMAT	0x2</span>
<span class="cp">#define ULAW_FORMAT	0x3</span>

<span class="cm">/* Function driver which use sport must initialize the structure */</span>
<span class="k">struct</span> <span class="n">sport_config</span> <span class="p">{</span>
	<span class="cm">/* TDM (multichannels), I2S or other mode */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mode</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">polled</span><span class="p">;</span>	<span class="cm">/* use poll instead of irq when set */</span>

	<span class="cm">/* if TDM mode is selected, channels must be set */</span>
	<span class="kt">int</span> <span class="n">channels</span><span class="p">;</span>	<span class="cm">/* Must be in 8 units */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">frame_delay</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>	<span class="cm">/* Delay between frame sync pulse and first bit */</span>

	<span class="cm">/* I2S mode */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">right_first</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Right stereo channel first */</span>

	<span class="cm">/* In mormal mode, the following item need to be set */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lsb_first</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* order of transmit or receive data */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fsync</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Frame sync required */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data_indep</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* data independent frame sync generated */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">act_low</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Active low TFS */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">late_fsync</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Late frame sync */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tckfe</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sec_en</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Secondary side enabled */</span>

	<span class="cm">/* Choose clock source */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">int_clk</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Internal or external clock */</span>

	<span class="cm">/* If external clock is used, the following fields are ignored */</span>
	<span class="kt">int</span> <span class="n">serial_clk</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">fsync_clk</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data_format</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>	<span class="cm">/* Normal, u-law or a-law */</span>

	<span class="kt">int</span> <span class="n">word_len</span><span class="p">;</span>		<span class="cm">/* How length of the word in bits, 3-32 bits */</span>
	<span class="kt">int</span> <span class="n">dma_enabled</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Userspace interface */</span>
<span class="cp">#define SPORT_IOC_MAGIC		&#39;P&#39;</span>
<span class="cp">#define SPORT_IOC_CONFIG	_IOWR(&#39;P&#39;, 0x01, struct sport_config)</span>
<span class="cp">#define SPORT_IOC_GET_SYSTEMCLOCK         _IOR(&#39;P&#39;, 0x02, unsigned long)</span>
<span class="cp">#define SPORT_IOC_SET_BAUDRATE            _IOW(&#39;P&#39;, 0x03, unsigned long)</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * All Blackfin system MMRs are padded to 32bits even if the register</span>
<span class="cm"> * itself is only 16bits.  So use a helper macro to streamline this.</span>
<span class="cm"> */</span>
<span class="cp">#define __BFP(m) u16 m; u16 __pad_##m</span>
<span class="k">struct</span> <span class="n">sport_register</span> <span class="p">{</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">tcr1</span><span class="p">);</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">tcr2</span><span class="p">);</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">tclkdiv</span><span class="p">);</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">tfsdiv</span><span class="p">);</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">tx32</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">tx16</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">u32</span> <span class="n">__pad_tx</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">rx32</span><span class="p">;</span>	<span class="cm">/* use the anomaly wrapper below */</span>
		<span class="n">u16</span> <span class="n">rx16</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">u32</span> <span class="n">__pad_rx</span><span class="p">;</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">rcr1</span><span class="p">);</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">rcr2</span><span class="p">);</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">rclkdiv</span><span class="p">);</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">rfsdiv</span><span class="p">);</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">stat</span><span class="p">);</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">chnl</span><span class="p">);</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">mcmc1</span><span class="p">);</span>
	<span class="n">__BFP</span><span class="p">(</span><span class="n">mcmc2</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">mtcs0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mtcs1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mtcs2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mtcs3</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mrcs0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mrcs1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mrcs2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mrcs3</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#undef __BFP</span>

<span class="k">struct</span> <span class="n">bfin_snd_platform_data</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">pin_req</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define bfin_read_sport_rx32(base) \</span>
<span class="cp">({ \</span>
<span class="cp">	struct sport_register *__mmrs = (void *)base; \</span>
<span class="cp">	u32 __ret; \</span>
<span class="cp">	unsigned long flags; \</span>
<span class="cp">	if (ANOMALY_05000473) \</span>
<span class="cp">		local_irq_save(flags); \</span>
<span class="cp">	__ret = __mmrs-&gt;rx32; \</span>
<span class="cp">	if (ANOMALY_05000473) \</span>
<span class="cp">		local_irq_restore(flags); \</span>
<span class="cp">	__ret; \</span>
<span class="cp">})</span>

<span class="cp">#endif</span>

<span class="cm">/* SPORT_TCR1 Masks */</span>
<span class="cp">#define TSPEN		0x0001	</span><span class="cm">/* TX enable */</span><span class="cp"></span>
<span class="cp">#define ITCLK		0x0002	</span><span class="cm">/* Internal TX Clock Select */</span><span class="cp"></span>
<span class="cp">#define TDTYPE		0x000C	</span><span class="cm">/* TX Data Formatting Select */</span><span class="cp"></span>
<span class="cp">#define DTYPE_NORM	0x0000	</span><span class="cm">/* Data Format Normal */</span><span class="cp"></span>
<span class="cp">#define DTYPE_ULAW	0x0008	</span><span class="cm">/* Compand Using u-Law */</span><span class="cp"></span>
<span class="cp">#define DTYPE_ALAW	0x000C	</span><span class="cm">/* Compand Using A-Law */</span><span class="cp"></span>
<span class="cp">#define TLSBIT		0x0010	</span><span class="cm">/* TX Bit Order */</span><span class="cp"></span>
<span class="cp">#define ITFS		0x0200	</span><span class="cm">/* Internal TX Frame Sync Select */</span><span class="cp"></span>
<span class="cp">#define TFSR		0x0400	</span><span class="cm">/* TX Frame Sync Required Select */</span><span class="cp"></span>
<span class="cp">#define DITFS		0x0800	</span><span class="cm">/* Data Independent TX Frame Sync Select */</span><span class="cp"></span>
<span class="cp">#define LTFS		0x1000	</span><span class="cm">/* Low TX Frame Sync Select */</span><span class="cp"></span>
<span class="cp">#define LATFS		0x2000	</span><span class="cm">/* Late TX Frame Sync Select */</span><span class="cp"></span>
<span class="cp">#define TCKFE		0x4000	</span><span class="cm">/* TX Clock Falling Edge Select */</span><span class="cp"></span>

<span class="cm">/* SPORT_TCR2 Masks */</span>
<span class="cp">#define SLEN		0x001F	</span><span class="cm">/* SPORT TX Word Length (2 - 31) */</span><span class="cp"></span>
<span class="cp">#define DP_SLEN(x)	BFIN_DEPOSIT(SLEN, x)</span>
<span class="cp">#define EX_SLEN(x)	BFIN_EXTRACT(SLEN, x)</span>
<span class="cp">#define TXSE		0x0100	</span><span class="cm">/* TX Secondary Enable */</span><span class="cp"></span>
<span class="cp">#define TSFSE		0x0200	</span><span class="cm">/* TX Stereo Frame Sync Enable */</span><span class="cp"></span>
<span class="cp">#define TRFST		0x0400	</span><span class="cm">/* TX Right-First Data Order */</span><span class="cp"></span>

<span class="cm">/* SPORT_RCR1 Masks */</span>
<span class="cp">#define RSPEN		0x0001	</span><span class="cm">/* RX enable */</span><span class="cp"></span>
<span class="cp">#define IRCLK		0x0002	</span><span class="cm">/* Internal RX Clock Select */</span><span class="cp"></span>
<span class="cp">#define RDTYPE		0x000C	</span><span class="cm">/* RX Data Formatting Select */</span><span class="cp"></span>
<span class="cm">/* DTYPE_* defined above */</span>
<span class="cp">#define RLSBIT		0x0010	</span><span class="cm">/* RX Bit Order */</span><span class="cp"></span>
<span class="cp">#define IRFS		0x0200	</span><span class="cm">/* Internal RX Frame Sync Select */</span><span class="cp"></span>
<span class="cp">#define RFSR		0x0400	</span><span class="cm">/* RX Frame Sync Required Select */</span><span class="cp"></span>
<span class="cp">#define LRFS		0x1000	</span><span class="cm">/* Low RX Frame Sync Select */</span><span class="cp"></span>
<span class="cp">#define LARFS		0x2000	</span><span class="cm">/* Late RX Frame Sync Select */</span><span class="cp"></span>
<span class="cp">#define RCKFE		0x4000	</span><span class="cm">/* RX Clock Falling Edge Select */</span><span class="cp"></span>

<span class="cm">/* SPORT_RCR2 Masks */</span>
<span class="cm">/* SLEN defined above */</span>
<span class="cp">#define RXSE		0x0100	</span><span class="cm">/* RX Secondary Enable */</span><span class="cp"></span>
<span class="cp">#define RSFSE		0x0200	</span><span class="cm">/* RX Stereo Frame Sync Enable */</span><span class="cp"></span>
<span class="cp">#define RRFST		0x0400	</span><span class="cm">/* Right-First Data Order */</span><span class="cp"></span>

<span class="cm">/* SPORT_STAT Masks */</span>
<span class="cp">#define RXNE		0x0001	</span><span class="cm">/* RX FIFO Not Empty Status */</span><span class="cp"></span>
<span class="cp">#define RUVF		0x0002	</span><span class="cm">/* RX Underflow Status */</span><span class="cp"></span>
<span class="cp">#define ROVF		0x0004	</span><span class="cm">/* RX Overflow Status */</span><span class="cp"></span>
<span class="cp">#define TXF		0x0008	</span><span class="cm">/* TX FIFO Full Status */</span><span class="cp"></span>
<span class="cp">#define TUVF		0x0010	</span><span class="cm">/* TX Underflow Status */</span><span class="cp"></span>
<span class="cp">#define TOVF		0x0020	</span><span class="cm">/* TX Overflow Status */</span><span class="cp"></span>
<span class="cp">#define TXHRE		0x0040	</span><span class="cm">/* TX Hold Register Empty */</span><span class="cp"></span>

<span class="cm">/* SPORT_MCMC1 Masks */</span>
<span class="cp">#define SP_WOFF		0x03FF	</span><span class="cm">/* Multichannel Window Offset Field */</span><span class="cp"></span>
<span class="cp">#define DP_SP_WOFF(x)	BFIN_DEPOSIT(SP_WOFF, x)</span>
<span class="cp">#define EX_SP_WOFF(x)	BFIN_EXTRACT(SP_WOFF, x)</span>
<span class="cp">#define SP_WSIZE	0xF000	</span><span class="cm">/* Multichannel Window Size Field */</span><span class="cp"></span>
<span class="cp">#define DP_SP_WSIZE(x)	BFIN_DEPOSIT(SP_WSIZE, x)</span>
<span class="cp">#define EX_SP_WSIZE(x)	BFIN_EXTRACT(SP_WSIZE, x)</span>

<span class="cm">/* SPORT_MCMC2 Masks */</span>
<span class="cp">#define MCCRM		0x0003	</span><span class="cm">/* Multichannel Clock Recovery Mode */</span><span class="cp"></span>
<span class="cp">#define REC_BYPASS	0x0000	</span><span class="cm">/* Bypass Mode (No Clock Recovery) */</span><span class="cp"></span>
<span class="cp">#define REC_2FROM4	0x0002	</span><span class="cm">/* Recover 2 MHz Clock from 4 MHz Clock */</span><span class="cp"></span>
<span class="cp">#define REC_8FROM16	0x0003	</span><span class="cm">/* Recover 8 MHz Clock from 16 MHz Clock */</span><span class="cp"></span>
<span class="cp">#define MCDTXPE		0x0004	</span><span class="cm">/* Multichannel DMA Transmit Packing */</span><span class="cp"></span>
<span class="cp">#define MCDRXPE		0x0008	</span><span class="cm">/* Multichannel DMA Receive Packing */</span><span class="cp"></span>
<span class="cp">#define MCMEN		0x0010	</span><span class="cm">/* Multichannel Frame Mode Enable */</span><span class="cp"></span>
<span class="cp">#define FSDR		0x0080	</span><span class="cm">/* Multichannel Frame Sync to Data Relationship */</span><span class="cp"></span>
<span class="cp">#define MFD		0xF000	</span><span class="cm">/* Multichannel Frame Delay */</span><span class="cp"></span>
<span class="cp">#define DP_MFD(x)	BFIN_DEPOSIT(MFD, x)</span>
<span class="cp">#define EX_MFD(x)	BFIN_EXTRACT(MFD, x)</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
