<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › blackfin › include › asm › bfin_crc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>bfin_crc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * bfin_crc.h - interface to Blackfin CRC controllers</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2012 Analog Devices Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * Licensed under the GPL-2 or later.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __BFIN_CRC_H__</span>
<span class="cp">#define __BFIN_CRC_H__</span>

<span class="cm">/* Function driver which use hardware crc must initialize the structure */</span>
<span class="k">struct</span> <span class="n">crc_info</span> <span class="p">{</span>
	<span class="cm">/* Input data address */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">in_addr</span><span class="p">;</span>
	<span class="cm">/* Output data address */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">out_addr</span><span class="p">;</span>
	<span class="cm">/* Input or output bytes */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">datasize</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
	<span class="cm">/* CRC to compare with that of input buffer */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">crc_compare</span><span class="p">;</span>
	<span class="cm">/* Value to compare with input data */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val_verify</span><span class="p">;</span>
	<span class="cm">/* Value to fill */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val_fill</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="cm">/* Value to program the 32b CRC Polynomial */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">crc_poly</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
	<span class="cm">/* CRC calculated from the input data */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">crc_result</span><span class="p">;</span>
	<span class="cm">/* First failed position to verify input data */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pos_verify</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="cm">/* CRC mirror flags */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bitmirr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bytmirr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">w16swp</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fdsel</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rsltmirr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">polymirr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmpmirr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Userspace interface */</span>
<span class="cp">#define CRC_IOC_MAGIC		&#39;C&#39;</span>
<span class="cp">#define CRC_IOC_CALC_CRC	_IOWR(&#39;C&#39;, 0x01, unsigned int)</span>
<span class="cp">#define CRC_IOC_MEMCPY_CRC	_IOWR(&#39;C&#39;, 0x02, unsigned int)</span>
<span class="cp">#define CRC_IOC_VERIFY_VAL	_IOWR(&#39;C&#39;, 0x03, unsigned int)</span>
<span class="cp">#define CRC_IOC_FILL_VAL	_IOWR(&#39;C&#39;, 0x04, unsigned int)</span>


<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/miscdevice.h&gt;</span>

<span class="k">struct</span> <span class="n">crc_register</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">control</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">datacnt</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">datacntrld</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">__pad_1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">compare</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fillval</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">datafifo</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">intren</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">intrenset</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">intrenclr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">poly</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">__pad_2</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">datacntcap</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">__pad_3</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">result</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">curresult</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">__pad_4</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">revid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bfin_crc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">miscdevice</span> <span class="n">mdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dma_ch_src</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dma_ch_dest</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="k">struct</span> <span class="n">crc_register</span> <span class="o">*</span><span class="n">regs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">crc_info</span> <span class="o">*</span><span class="n">info</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">c</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">opmode</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* CRC_STATUS Masks */</span>
<span class="cp">#define CMPERR			0x00000002	</span><span class="cm">/* Compare error */</span><span class="cp"></span>
<span class="cp">#define DCNTEXP			0x00000010	</span><span class="cm">/* datacnt register expired */</span><span class="cp"></span>
<span class="cp">#define IBR			0x00010000	</span><span class="cm">/* Input buffer ready */</span><span class="cp"></span>
<span class="cp">#define OBR			0x00020000	</span><span class="cm">/* Output buffer ready */</span><span class="cp"></span>
<span class="cp">#define IRR			0x00040000	</span><span class="cm">/* Immediate result readt */</span><span class="cp"></span>
<span class="cp">#define LUTDONE			0x00080000	</span><span class="cm">/* Look-up table generation done */</span><span class="cp"></span>
<span class="cp">#define FSTAT			0x00700000	</span><span class="cm">/* FIFO status */</span><span class="cp"></span>
<span class="cp">#define MAX_FIFO		4		</span><span class="cm">/* Max fifo size */</span><span class="cp"></span>

<span class="cm">/* CRC_CONTROL Masks */</span>
<span class="cp">#define BLKEN			0x00000001	</span><span class="cm">/* Block enable */</span><span class="cp"></span>
<span class="cp">#define OPMODE			0x000000F0	</span><span class="cm">/* Operation mode */</span><span class="cp"></span>
<span class="cp">#define OPMODE_OFFSET		4		</span><span class="cm">/* Operation mode mask offset*/</span><span class="cp"></span>
<span class="cp">#define MODE_DMACPY_CRC		1		</span><span class="cm">/* MTM CRC compute and compare */</span><span class="cp"></span>
<span class="cp">#define MODE_DATA_FILL		2		</span><span class="cm">/* MTM data fill */</span><span class="cp"></span>
<span class="cp">#define MODE_CALC_CRC		3		</span><span class="cm">/* MSM CRC compute and compare */</span><span class="cp"></span>
<span class="cp">#define MODE_DATA_VERIFY	4		</span><span class="cm">/* MSM data verify */</span><span class="cp"></span>
<span class="cp">#define AUTOCLRZ		0x00000100	</span><span class="cm">/* Auto clear to zero */</span><span class="cp"></span>
<span class="cp">#define AUTOCLRF		0x00000200	</span><span class="cm">/* Auto clear to one */</span><span class="cp"></span>
<span class="cp">#define OBRSTALL		0x00001000	</span><span class="cm">/* Stall on output buffer ready */</span><span class="cp"></span>
<span class="cp">#define IRRSTALL		0x00002000	</span><span class="cm">/* Stall on immediate result ready */</span><span class="cp"></span>
<span class="cp">#define BITMIRR			0x00010000	</span><span class="cm">/* Mirror bits within each byte of 32-bit input data */</span><span class="cp"></span>
<span class="cp">#define BITMIRR_OFFSET		16		</span><span class="cm">/* Mirror bits offset */</span><span class="cp"></span>
<span class="cp">#define BYTMIRR			0x00020000	</span><span class="cm">/* Mirror bytes of 32-bit input data */</span><span class="cp"></span>
<span class="cp">#define BYTMIRR_OFFSET		17		</span><span class="cm">/* Mirror bytes offset */</span><span class="cp"></span>
<span class="cp">#define W16SWP			0x00040000	</span><span class="cm">/* Mirror uppper and lower 16-bit word of 32-bit input data */</span><span class="cp"></span>
<span class="cp">#define W16SWP_OFFSET		18		</span><span class="cm">/* Mirror 16-bit word offset */</span><span class="cp"></span>
<span class="cp">#define FDSEL			0x00080000	</span><span class="cm">/* FIFO is written after input data is mirrored */</span><span class="cp"></span>
<span class="cp">#define FDSEL_OFFSET		19		</span><span class="cm">/* Mirror FIFO offset */</span><span class="cp"></span>
<span class="cp">#define RSLTMIRR		0x00100000	</span><span class="cm">/* CRC result registers are mirrored. */</span><span class="cp"></span>
<span class="cp">#define RSLTMIRR_OFFSET		20		</span><span class="cm">/* Mirror CRC result offset. */</span><span class="cp"></span>
<span class="cp">#define POLYMIRR		0x00200000	</span><span class="cm">/* CRC poly register is mirrored. */</span><span class="cp"></span>
<span class="cp">#define POLYMIRR_OFFSET		21		</span><span class="cm">/* Mirror CRC poly offset. */</span><span class="cp"></span>
<span class="cp">#define CMPMIRR			0x00400000	</span><span class="cm">/* CRC compare register is mirrored. */</span><span class="cp"></span>
<span class="cp">#define CMPMIRR_OFFSET		22		</span><span class="cm">/* Mirror CRC compare offset. */</span><span class="cp"></span>

<span class="cm">/* CRC_INTREN Masks */</span>
<span class="cp">#define CMPERRI 		0x02		</span><span class="cm">/* CRC_ERROR_INTR */</span><span class="cp"></span>
<span class="cp">#define DCNTEXPI 		0x10		</span><span class="cm">/* CRC_STATUS_INTR */</span><span class="cp"></span>

<span class="cp">#endif</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
