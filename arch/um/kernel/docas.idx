f | Makefile | g | 1.4K |  | Thomas Gleixner | tglx@linutronix.de | 1336215626 |  | um: Use generic init_task  Same code. Use the generic version.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de> Acked-by: Richard Weinberger <richard@nod.at> Link: http://lkml.kernel.org/r/20120503085035.592937512@linutronix.de
f | internal.h | s | 118B | 1 | Richard Weinberger | richard@nod.at | 1285201359 |  | uml: fix compile warning  This fixes: incompatible pointer type:  => 89        arch/um/kernel/exec.c: warning: passing argument 2 of 'execve1' from incompatible pointer type:  => 69, 85        arch/um/kernel/exec.c: warning: passing argument 3 of 'execve1' from incompatible pointer type:  => 69, 85  which was introduced by d7627467b7a8d ("Make do_execve() take a const filename pointer")  Signed-off-by: Richard Weinberger <richard@nod.at> Cc: David Howells <dhowells@redhat.com> Cc: Jeff Dike <jdike@addtoit.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | sysrq.c | s | 1.7K | 67 | Joe Perches | joe@perches.com | 1247074203 |  | Remove multiple KERN_ prefixes from printk formats  Commit 5fd29d6ccbc98884569d6f3105aeca70858b3e0f ("printk: clean up handling of log-levels and newlines") changed printk semantics.  printk lines with multiple KERN_<level> prefixes are no longer emitted as before the patch.  <level> is now included in the output on each additional use.  Remove all uses of multiple KERN_<level>s in formats.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | sigio.c | s | 1.0K | 41 | Yong Zhang | yong.zhang0@gmail.com | 1332631792 |  | um: irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> Signed-off-by: Richard Weinberger <richard@nod.at>
f | time.c | s | 2.5K | 97 | Yong Zhang | yong.zhang0@gmail.com | 1332631792 |  | um: irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> Signed-off-by: Richard Weinberger <richard@nod.at>
f | syscall.c | s | 1.4K | 58 | Richard Weinberger | richard@nod.at | 1285201359 |  | uml: fix compile warning  This fixes: incompatible pointer type:  => 89        arch/um/kernel/exec.c: warning: passing argument 2 of 'execve1' from incompatible pointer type:  => 69, 85        arch/um/kernel/exec.c: warning: passing argument 3 of 'execve1' from incompatible pointer type:  => 69, 85  which was introduced by d7627467b7a8d ("Make do_execve() take a const filename pointer")  Signed-off-by: Richard Weinberger <richard@nod.at> Cc: David Howells <dhowells@redhat.com> Cc: Jeff Dike <jdike@addtoit.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | umid.c | s | 728B | 30 | Jeff Dike | jdike@addtoit.com | 1202233470 |  | uml: style fixes in arch/um/kernel  Joe Perches noticed some printks in smp.c that needed fixing.  While I was in there, I did the usual tidying in arch/um/kernel, which should be fairly style-clean at this point: 	copyright updates 	emacs formatting comments removal 	include tidying 	style fixes  Cc: Joe Perches <joe@perches.com> Signed-off-by: Jeff Dike <jdike@linux.intel.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | asm-offsets.c | s | 35B | 1 | Jeff Dike | jdike@addtoit.com | 1137033729 |  | [PATCH] uml: fix missing KBUILD_BASENAME  2.6.15-mm1 caused kernel-offsets.c to stop compiling with a syntax error in a header.  The problem was with KBUILD_BASENAME, which didn't get a definition with the by-hand compilation in the main UML Makefile.  This was OK before since the expansion was syntactically the same as the KBUILD_BASENAME token.  With -mm1, the expansion is now a quote-delimited string, so there needs to be a definition of it.  Since kernel-offsets.c is basically the same as other arches' asm-offsets.c, and those seem to build OK, this patch turns kernel-offsets.c into asm-offsets.c.  kernel-offsets.c is in arch/um/sys-$(SUBARCH), i.e.  sys-i386 and sys-x86_64, while kbuild expects it to be in arch/um/kernel. kernel-offsets.c is moved to arch/um/include/sysdep-$(SUBARCH)/kernel-offsets.h, which is included by arch/um/kernel/asm-offsets.c.  With that, include/asm-um/asm-offsets.h is generated automatically.  kernel-offsets.h continues to exist because it needs to be accessible to userspace UML code, and include/asm-um isn't.  So, a symlink is made from arch/um/include/kernel-offsets.h to include/asm-um/asm-offsets.h.  Signed-off-by: Jeff Dike <jdike@addtoit.com> Signed-off-by: Andrew Morton <akpm@osdl.org> Signed-off-by: Linus Torvalds <torvalds@osdl.org>
f | ptrace.c | s | 4.6K | 177 | Eric Paris | eparis@redhat.com | 1326835016 |  | audit: inline audit_syscall_entry to reduce burden on archs  Every arch calls:  if (unlikely(current->audit_context)) 	audit_syscall_entry()  which requires knowledge about audit (the existance of audit_context) in the arch code.  Just do it all in static inline in audit.h so that arch's can remain blissfully ignorant.  Signed-off-by: Eric Paris <eparis@redhat.com>
f | mem.c | s | 7.3K | 273 | Al Viro | viro@ftp.linux.org.uk | 1320239736 |  | um: distribute exports to where exported stuff is defined  ksyms.c is down to the stuff defined in various USER_OBJS  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | vmlinux.lds.S | g | 149B |  | Sam Ravnborg | sam@ravnborg.org | 1253442502 |  | arm, cris, mips, sparc, powerpc, um, xtensa: fix build with bash 4.0  Albin Tonnerre <albin.tonnerre@free-electrons.com> reported:      Bash 4 filters out variables which contain a dot in them.     This happends to be the case of CPPFLAGS_vmlinux.lds.     This is rather unfortunate, as it now causes     build failures when using SHELL=/bin/bash to compile,     or when bash happens to be used by make (eg when it's /bin/sh)  Remove the common definition of CPPFLAGS_vmlinux.lds by pushing relevant stuff to either Makefile.build or the arch specific kernel/Makefile where we build the linker script.  This is also nice cleanup as we move the information out where it is used.  Notes for the different architectures touched:  arm - we use an already exported symbol cris - we use a config symbol aleady available        [Not build tested] mips - the jiffies complexity has moved to vmlinux.lds.S where we need it.        Added a few variables to CPPFLAGS - they are only used by        the linker script.        [Not build tested] powerpc - removed assignment that is not needed           [not build tested] sparc - simplified it using $(BITS) um - introduced a few new exported variables to deal with this xtensa - added options to CPP invocation          [not build tested]  Cc: Albin Tonnerre <albin.tonnerre@free-electrons.com> Cc: Russell King <linux@arm.linux.org.uk> Cc: Mikael Starvik <starvik@axis.com> Cc: Jesper Nilsson <jesper.nilsson@axis.com> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mackerras <paulus@samba.org> Cc: "David S. Miller" <davem@davemloft.net> Cc: Jeff Dike <jdike@addtoit.com> Cc: Chris Zankel <chris@zankel.net> Signed-off-by: Sam Ravnborg <sam@ravnborg.org>
f | gprof_syms.c | s | 184B | 7 | Jeff Dike | jdike@addtoit.com | 1202233470 |  | uml: style fixes in arch/um/kernel  Joe Perches noticed some printks in smp.c that needed fixing.  While I was in there, I did the usual tidying in arch/um/kernel, which should be fairly style-clean at this point: 	copyright updates 	emacs formatting comments removal 	include tidying 	style fixes  Cc: Joe Perches <joe@perches.com> Signed-off-by: Jeff Dike <jdike@linux.intel.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | irq.c | s | 11K | 397 | Richard Weinberger | richard@nod.at | 1337627376 |  | um: Remove usage of irq_chip->release()  UML does no longer need irq_chip->release().  Signed-off-by: Richard Weinberger <richard@nod.at> Reviewed-by: Thomas Gleixner <tglx@linutronix.de>
f | tlb.c | s | 11K | 471 | Richard Weinberger | richard@nod.at | 1337627373 |  | um: Add BUG() to do_ops()'s error path  In case we encounter a bad operation in do_ops() something is really broken and it's better to BUG().  Signed-off-by: Richard Weinberger <richard@nod.at>
f | ksyms.c | s | 1.1K | 40 | Al Viro | viro@ftp.linux.org.uk | 1320239736 |  | um: distribute exports to where exported stuff is defined  ksyms.c is down to the stuff defined in various USER_OBJS  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | exitcode.c | s | 1.6K | 65 | Alexey Dobriyan | adobriyan@gmail.com | 1260896005 |  | uml: convert to seq_file/proc_fops  Convert code away from ->read_proc/->write_proc interfaces.  Switch to proc_create()/proc_create_data() which make addition of proc entries reliable wrt NULL ->proc_fops, NULL ->data and so on.  Problem with ->read_proc et al is described here commit 786d7e1612f0b0adb6046f19b906609e4fe8b1ba "Fix rmmod/read/write races in /proc entries"  Signed-off-by: Alexey Dobriyan <adobriyan@gmail.com> Cc: Jeff Dike <jdike@addtoit.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | dyn.lds.S | g | 5.1K |  | Roland McGrath | roland@redhat.com | 1288137132 |  | uml: fix CONFIG_STATIC_LINK=y build failure with newer glibc  With glibc 2.11 or later that was built with --enable-multi-arch, the UML link fails with undefined references to __rel_iplt_start and similar symbols.  In recent binutils, the default linker script defines these symbols (see ld --verbose).  Fix the UML linker scripts to match the new defaults for these sections.  Signed-off-by: Roland McGrath <roland@redhat.com> Cc: Jeff Dike <jdike@addtoit.com> Cc: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | uml.lds.S | g | 2.3K |  | Roland McGrath | roland@redhat.com | 1288137132 |  | uml: fix CONFIG_STATIC_LINK=y build failure with newer glibc  With glibc 2.11 or later that was built with --enable-multi-arch, the UML link fails with undefined references to __rel_iplt_start and similar symbols.  In recent binutils, the default linker script defines these symbols (see ld --verbose).  Fix the UML linker scripts to match the new defaults for these sections.  Signed-off-by: Roland McGrath <roland@redhat.com> Cc: Jeff Dike <jdike@addtoit.com> Cc: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | physmem.c | s | 5.4K | 177 | Al Viro | viro@ftp.linux.org.uk | 1320239736 |  | um: distribute exports to where exported stuff is defined  ksyms.c is down to the stuff defined in various USER_OBJS  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | gmon_syms.c | s | 224B | 7 | Al Viro | viro@ftp.linux.org.uk | 1320239726 |  | um: fix gcov build breakage  a) exports in gmon_syms.c duplicate kernel/gcov/* ones b) excluding -pg in vdso compile is not enough - -fprofile-arcs and -ftest-coverage also needs to be excluded  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | reboot.c | s | 1.0K | 55 | Anton Vorontsov | anton.vorontsov@linaro.org | 1338511770 |  | um: properly check all process' threads for a live mm  kill_off_processes() might miss a valid process, this is because checking for process->mm is not enough.  Process' main thread may exit or detach its mm via use_mm(), but other threads may still have a valid mm.  To catch this we use find_lock_task_mm(), which walks up all threads and returns an appropriate task (with task lock held).  Suggested-by: Oleg Nesterov <oleg@redhat.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org> Cc: Richard Weinberger <richard@nod.at> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | smp.c | s | 4.8K | 188 | Thomas Gleixner | tglx@linutronix.de | 1335434769 |  | smp: Add task_struct argument to __cpu_up()  Preparatory patch to make the idle thread allocation for secondary cpus generic.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Rusty Russell <rusty@rustcorp.com.au> Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com> Cc: Srivatsa S. Bhat <srivatsa.bhat@linux.vnet.ibm.com> Cc: Matt Turner <mattst88@gmail.com> Cc: Russell King <linux@arm.linux.org.uk> Cc: Mike Frysinger <vapier@gentoo.org> Cc: Jesper Nilsson <jesper.nilsson@axis.com> Cc: Richard Kuo <rkuo@codeaurora.org> Cc: Tony Luck <tony.luck@intel.com> Cc: Hirokazu Takata <takata@linux-m32r.org> Cc: Ralf Baechle <ralf@linux-mips.org> Cc: David Howells <dhowells@redhat.com> Cc: James E.J. Bottomley <jejb@parisc-linux.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: Paul Mundt <lethal@linux-sh.org> Cc: David S. Miller <davem@davemloft.net> Cc: Chris Metcalf <cmetcalf@tilera.com> Cc: Richard Weinberger <richard@nod.at> Cc: x86@kernel.org Link: http://lkml.kernel.org/r/20120420124556.964170564@linutronix.de
f | trap.c | s | 6.8K | 253 | Kautuk Consul | consul.kautuk@gmail.com | 1338511766 |  | um/kernel/trap.c: port OOM changes to handle_page_fault()  Commit d065bd810b6d ("mm: retry page fault when blocking on disk transfer") and commit 37b23e0525d3 ("x86,mm: make pagefault killable") introduced changes into the x86 pagefault handler for making the page fault handler retryable as well as killable.  These changes reduce the mmap_sem hold time, which is crucial during OOM killer invocation.  Port these changes to um.  Signed-off-by: Kautuk Consul <consul.kautuk@gmail.com> Cc: Jeff Dike <jdike@addtoit.com> Cc: Richard Weinberger <richard@nod.at> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | config.c.in | g | 496B |  | WANG Cong | xiyou.wangcong@gmail.com | 1238601557 |  | uml: remove useless comments  These comments are useless now, remove them.  Signed-off-by: WANG Cong <xiyou.wangcong@gmail.com> Cc: Jeff Dike <jdike@addtoit.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | process.c | s | 9.6K | 377 | Al Viro | viro@zeniv.linux.org.uk | 1337825360 |  | move key_repace_session_keyring() into tracehook_notify_resume()  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
d | skas |  | 6 items |  | Al Viro | viro@zeniv.linux.org.uk | 1337632114 |  | um/x86: merge (and trim) 32- and 64-bit variants of ptrace.h  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | exec.c | s | 2.0K | 76 | Al Viro | viro@ftp.linux.org.uk | 1320239736 |  | um: distribute exports to where exported stuff is defined  ksyms.c is down to the stuff defined in various USER_OBJS  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | early_printk.c | s | 740B | 27 | Richard Weinberger | richard@nod.at | 1306337981 |  | um: add earlyprintk support  User Mode Linux can also benefit from earlyprintk.  UML's earlyprintk writes kernel messages directly to stdout.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | signal.c | s | 3.4K | 119 | Al Viro | viro@zeniv.linux.org.uk | 1338569932 |  | new helper: signal_delivered()  Does block_sigmask() + tracehook_signal_handler();  called when sigframe has been successfully built.  All architectures converted to it; block_sigmask() itself is gone now (merged into this one).  I'm still not too happy with the signature, but that's a separate story (IMO we need a structure that would contain signal number + siginfo + k_sigaction, so that get_signal_to_deliver() would fill one, signal_delivered(), handle_signal() and probably setup...frame() - take one).  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | um_arch.c | s | 9.0K | 332 | Thomas Gleixner | tglx@linutronix.de | 1336215626 |  | um: Use generic init_task  Same code. Use the generic version.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de> Acked-by: Richard Weinberger <richard@nod.at> Link: http://lkml.kernel.org/r/20120503085035.592937512@linutronix.de
f | initrd.c | s | 1.7K | 70 | Al Viro | viro@ftp.linux.org.uk | 1320239706 |  | um: make load_initrd() static, kill shared/initrd.h  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
