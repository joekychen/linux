<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › frv › include › asm › math-emu.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>math-emu.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_MATH_EMU_H</span>
<span class="cp">#define _ASM_MATH_EMU_H</span>

<span class="cp">#include &lt;asm/setup.h&gt;</span>
<span class="cp">#include &lt;linux/linkage.h&gt;</span>

<span class="cm">/* Status Register bits */</span>

<span class="cm">/* accrued exception bits */</span>
<span class="cp">#define FPSR_AEXC_INEX	3</span>
<span class="cp">#define FPSR_AEXC_DZ	4</span>
<span class="cp">#define FPSR_AEXC_UNFL	5</span>
<span class="cp">#define FPSR_AEXC_OVFL	6</span>
<span class="cp">#define FPSR_AEXC_IOP	7</span>

<span class="cm">/* exception status bits */</span>
<span class="cp">#define FPSR_EXC_INEX1	8</span>
<span class="cp">#define FPSR_EXC_INEX2	9</span>
<span class="cp">#define FPSR_EXC_DZ	10</span>
<span class="cp">#define FPSR_EXC_UNFL	11</span>
<span class="cp">#define FPSR_EXC_OVFL	12</span>
<span class="cp">#define FPSR_EXC_OPERR	13</span>
<span class="cp">#define FPSR_EXC_SNAN	14</span>
<span class="cp">#define FPSR_EXC_BSUN	15</span>

<span class="cm">/* quotient byte, assumes big-endian, of course */</span>
<span class="cp">#define FPSR_QUOTIENT(fpsr) (*((signed char *) &amp;(fpsr) + 1))</span>

<span class="cm">/* condition code bits */</span>
<span class="cp">#define FPSR_CC_NAN	24</span>
<span class="cp">#define FPSR_CC_INF	25</span>
<span class="cp">#define FPSR_CC_Z	26</span>
<span class="cp">#define FPSR_CC_NEG	27</span>


<span class="cm">/* Control register bits */</span>

<span class="cm">/* rounding mode */</span>
<span class="cp">#define	FPCR_ROUND_RN	0		</span><span class="cm">/* round to nearest/even */</span><span class="cp"></span>
<span class="cp">#define FPCR_ROUND_RZ	1		</span><span class="cm">/* round to zero */</span><span class="cp"></span>
<span class="cp">#define FPCR_ROUND_RM	2		</span><span class="cm">/* minus infinity */</span><span class="cp"></span>
<span class="cp">#define FPCR_ROUND_RP	3		</span><span class="cm">/* plus infinity */</span><span class="cp"></span>

<span class="cm">/* rounding precision */</span>
<span class="cp">#define FPCR_PRECISION_X	0	</span><span class="cm">/* long double */</span><span class="cp"></span>
<span class="cp">#define FPCR_PRECISION_S	1	</span><span class="cm">/* double */</span><span class="cp"></span>
<span class="cp">#define FPCR_PRECISION_D	2	</span><span class="cm">/* float */</span><span class="cp"></span>


<span class="cm">/* Flags to select the debugging output */</span>
<span class="cp">#define PDECODE		0</span>
<span class="cp">#define PEXECUTE	1</span>
<span class="cp">#define PCONV		2</span>
<span class="cp">#define PNORM		3</span>
<span class="cp">#define PREGISTER	4</span>
<span class="cp">#define PINSTR		5</span>
<span class="cp">#define PUNIMPL		6</span>
<span class="cp">#define PMOVEM		7</span>

<span class="cp">#define PMDECODE	(1&lt;&lt;PDECODE)</span>
<span class="cp">#define PMEXECUTE	(1&lt;&lt;PEXECUTE)</span>
<span class="cp">#define PMCONV		(1&lt;&lt;PCONV)</span>
<span class="cp">#define PMNORM		(1&lt;&lt;PNORM)</span>
<span class="cp">#define PMREGISTER	(1&lt;&lt;PREGISTER)</span>
<span class="cp">#define PMINSTR		(1&lt;&lt;PINSTR)</span>
<span class="cp">#define PMUNIMPL	(1&lt;&lt;PUNIMPL)</span>
<span class="cp">#define PMMOVEM		(1&lt;&lt;PMOVEM)</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>

<span class="k">union</span> <span class="n">fp_mant64</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">m64</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">m32</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">fp_mant128</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">m64</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">m32</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* internal representation of extended fp numbers */</span>
<span class="k">struct</span> <span class="n">fp_ext</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">lowmant</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">sign</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">exp</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">fp_mant64</span> <span class="n">mant</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* C representation of FPU registers */</span>
<span class="cm">/* NOTE: if you change this, you have to change the assembler offsets</span>
<span class="cm">   below and the size in &lt;asm/fpu.h&gt;, too */</span>
<span class="k">struct</span> <span class="n">fp_data</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fp_ext</span> <span class="n">fpreg</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fpcr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fpsr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fpiar</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">prec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">rnd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fp_ext</span> <span class="n">temp</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#if FPU_EMU_DEBUG</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fp_debugprint</span><span class="p">;</span>

<span class="cp">#define dprint(bit, fmt, args...) ({			\</span>
<span class="cp">	if (fp_debugprint &amp; (1 &lt;&lt; (bit)))		\</span>
<span class="cp">		printk(fmt, ## args);			\</span>
<span class="cp">})</span>
<span class="cp">#else</span>
<span class="cp">#define dprint(bit, fmt, args...)</span>
<span class="cp">#endif</span>

<span class="cp">#define uprint(str) ({					\</span>
<span class="cp">	static int __count = 3;				\</span>
<span class="cp">							\</span>
<span class="cp">	if (__count &gt; 0) {				\</span>
<span class="cp">		printk(&quot;You just hit an unimplemented &quot;	\</span>
<span class="cp">		       &quot;fpu instruction (%s)\n&quot;, str);	\</span>
<span class="cp">		printk(&quot;Please report this to ....\n&quot;);	\</span>
<span class="cp">		__count--;				\</span>
<span class="cp">	}						\</span>
<span class="cp">})</span>

<span class="cp">#define FPDATA		((struct fp_data *)current-&gt;thread.fp)</span>

<span class="cp">#else	</span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#define FPDATA		%a2</span>

<span class="cm">/* offsets from the base register to the floating point data in the task struct */</span>
<span class="cp">#define FPD_FPREG	(TASK_THREAD+THREAD_FPREG+0)</span>
<span class="cp">#define FPD_FPCR	(TASK_THREAD+THREAD_FPREG+96)</span>
<span class="cp">#define FPD_FPSR	(TASK_THREAD+THREAD_FPREG+100)</span>
<span class="cp">#define FPD_FPIAR	(TASK_THREAD+THREAD_FPREG+104)</span>
<span class="cp">#define FPD_PREC	(TASK_THREAD+THREAD_FPREG+108)</span>
<span class="cp">#define FPD_RND		(TASK_THREAD+THREAD_FPREG+110)</span>
<span class="cp">#define FPD_TEMPFP1	(TASK_THREAD+THREAD_FPREG+112)</span>
<span class="cp">#define FPD_TEMPFP2	(TASK_THREAD+THREAD_FPREG+124)</span>
<span class="cp">#define FPD_SIZEOF	(TASK_THREAD+THREAD_FPREG+136)</span>

<span class="cm">/* offsets on the stack to access saved registers,</span>
<span class="cm"> * these are only used during instruction decoding</span>
<span class="cm"> * where we always know how deep we&#39;re on the stack.</span>
<span class="cm"> */</span>
<span class="cp">#define FPS_DO		(PT_D0)</span>
<span class="cp">#define FPS_D1		(PT_D1)</span>
<span class="cp">#define FPS_D2		(PT_D2)</span>
<span class="cp">#define FPS_A0		(PT_A0)</span>
<span class="cp">#define FPS_A1		(PT_A1)</span>
<span class="cp">#define FPS_A2		(PT_A2)</span>
<span class="cp">#define FPS_SR		(PT_SR)</span>
<span class="cp">#define FPS_PC		(PT_PC)</span>
<span class="cp">#define FPS_EA		(PT_PC+6)</span>
<span class="cp">#define FPS_PC2		(PT_PC+10)</span>

<span class="p">.</span><span class="n">macro</span>	<span class="n">fp_get_fp_reg</span>
	<span class="n">lea</span>	<span class="p">(</span><span class="n">FPD_FPREG</span><span class="p">,</span><span class="n">FPDATA</span><span class="p">,</span><span class="o">%</span><span class="n">d0</span><span class="p">.</span><span class="n">w</span><span class="o">*</span><span class="mi">4</span><span class="p">),</span><span class="o">%</span><span class="n">a0</span>
	<span class="n">lea</span>	<span class="p">(</span><span class="o">%</span><span class="n">a0</span><span class="p">,</span><span class="o">%</span><span class="n">d0</span><span class="p">.</span><span class="n">w</span><span class="o">*</span><span class="mi">8</span><span class="p">),</span><span class="o">%</span><span class="n">a0</span>
<span class="p">.</span><span class="n">endm</span>

<span class="cm">/* Macros used to get/put the current program counter.</span>
<span class="cm"> * 020/030 use a different stack frame then 040/060, for the</span>
<span class="cm"> * 040/060 the return pc points already to the next location,</span>
<span class="cm"> * so this only needs to be modified for jump instructions.</span>
<span class="cm"> */</span>
<span class="p">.</span><span class="n">macro</span>	<span class="n">fp_get_pc</span> <span class="n">dest</span>
	<span class="n">move</span><span class="p">.</span><span class="n">l</span>	<span class="p">(</span><span class="n">FPS_PC</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="o">%</span><span class="n">sp</span><span class="p">),</span><span class="err">\</span><span class="n">dest</span>
<span class="p">.</span><span class="n">endm</span>

<span class="p">.</span><span class="n">macro</span>	<span class="n">fp_put_pc</span> <span class="n">src</span><span class="p">,</span><span class="n">jump</span><span class="o">=</span><span class="mi">0</span>
	<span class="n">move</span><span class="p">.</span><span class="n">l</span>	<span class="err">\</span><span class="n">src</span><span class="p">,(</span><span class="n">FPS_PC</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="o">%</span><span class="n">sp</span><span class="p">)</span>
<span class="p">.</span><span class="n">endm</span>

<span class="p">.</span><span class="n">macro</span>	<span class="n">fp_get_instr_data</span>	<span class="n">f</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">dest</span><span class="p">,</span><span class="n">label</span>
	<span class="n">getuser</span>	<span class="err">\</span><span class="n">f</span><span class="p">,</span><span class="o">%</span><span class="n">sp</span><span class="err">@</span><span class="p">(</span><span class="n">FPS_PC</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="err">@</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="err">\</span><span class="n">dest</span><span class="p">,</span><span class="err">\</span><span class="n">label</span><span class="p">,</span><span class="o">%</span><span class="n">sp</span><span class="err">@</span><span class="p">(</span><span class="n">FPS_PC</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
	<span class="n">addq</span><span class="p">.</span><span class="n">l</span>	<span class="err">#\</span><span class="n">s</span><span class="p">,</span><span class="o">%</span><span class="n">sp</span><span class="err">@</span><span class="p">(</span><span class="n">FPS_PC</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
<span class="p">.</span><span class="n">endm</span>

<span class="p">.</span><span class="n">macro</span>	<span class="n">fp_get_instr_word</span>	<span class="n">dest</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">addr</span>
	<span class="n">fp_get_instr_data</span>	<span class="n">w</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="err">\</span><span class="n">dest</span><span class="p">,</span><span class="err">\</span><span class="n">label</span><span class="p">,</span><span class="err">\</span><span class="n">addr</span>
<span class="p">.</span><span class="n">endm</span>

<span class="p">.</span><span class="n">macro</span>	<span class="n">fp_get_instr_long</span>	<span class="n">dest</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">addr</span>
	<span class="n">fp_get_instr_data</span>	<span class="n">l</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="err">\</span><span class="n">dest</span><span class="p">,</span><span class="err">\</span><span class="n">label</span><span class="p">,</span><span class="err">\</span><span class="n">addr</span>
<span class="p">.</span><span class="n">endm</span>

<span class="cm">/* These macros are used to read from/write to user space</span>
<span class="cm"> * on error we jump to the fixup section, load the fault</span>
<span class="cm"> * address into %a0 and jump to the exit.</span>
<span class="cm"> * (derived from &lt;asm/uaccess.h&gt;)</span>
<span class="cm"> */</span>
<span class="p">.</span><span class="n">macro</span>	<span class="n">getuser</span>	<span class="n">size</span><span class="p">,</span><span class="n">src</span><span class="p">,</span><span class="n">dest</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">addr</span>
<span class="o">|</span>	<span class="n">printf</span>	<span class="p">,</span><span class="s">&quot;[\size&lt;%08x]&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="err">\</span><span class="n">addr</span>
<span class="p">.</span><span class="n">Lu1</span><span class="err">\@</span><span class="o">:</span>	<span class="n">moves</span><span class="err">\</span><span class="n">size</span>	<span class="err">\</span><span class="n">src</span><span class="p">,</span><span class="err">\</span><span class="n">dest</span>

	<span class="p">.</span><span class="n">section</span> <span class="p">.</span><span class="n">fixup</span><span class="p">,</span><span class="s">&quot;ax&quot;</span>
	<span class="p">.</span><span class="n">even</span>
<span class="p">.</span><span class="n">Lu2</span><span class="err">\@</span><span class="o">:</span>	<span class="n">move</span><span class="p">.</span><span class="n">l</span>	<span class="err">\</span><span class="n">addr</span><span class="p">,</span><span class="o">%</span><span class="n">a0</span>
	<span class="n">jra</span>	<span class="err">\</span><span class="n">label</span>
	<span class="p">.</span><span class="n">previous</span>

	<span class="p">.</span><span class="n">section</span> <span class="n">__ex_table</span><span class="p">,</span><span class="s">&quot;a&quot;</span>
	<span class="p">.</span><span class="n">align</span>	<span class="mi">4</span>
	<span class="p">.</span><span class="kt">long</span>	<span class="p">.</span><span class="n">Lu1</span><span class="err">\@</span><span class="p">,.</span><span class="n">Lu2</span><span class="err">\@</span>
	<span class="p">.</span><span class="n">previous</span>
<span class="p">.</span><span class="n">endm</span>

<span class="p">.</span><span class="n">macro</span>	<span class="n">putuser</span>	<span class="n">size</span><span class="p">,</span><span class="n">src</span><span class="p">,</span><span class="n">dest</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">addr</span>
<span class="o">|</span>	<span class="n">printf</span>	<span class="p">,</span><span class="s">&quot;[\size&gt;%08x]&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="err">\</span><span class="n">addr</span>
<span class="p">.</span><span class="n">Lu1</span><span class="err">\@</span><span class="o">:</span>	<span class="n">moves</span><span class="err">\</span><span class="n">size</span>	<span class="err">\</span><span class="n">src</span><span class="p">,</span><span class="err">\</span><span class="n">dest</span>
<span class="p">.</span><span class="n">Lu2</span><span class="err">\@</span><span class="o">:</span>

	<span class="p">.</span><span class="n">section</span> <span class="p">.</span><span class="n">fixup</span><span class="p">,</span><span class="s">&quot;ax&quot;</span>
	<span class="p">.</span><span class="n">even</span>
<span class="p">.</span><span class="n">Lu3</span><span class="err">\@</span><span class="o">:</span>	<span class="n">move</span><span class="p">.</span><span class="n">l</span>	<span class="err">\</span><span class="n">addr</span><span class="p">,</span><span class="o">%</span><span class="n">a0</span>
	<span class="n">jra</span>	<span class="err">\</span><span class="n">label</span>
	<span class="p">.</span><span class="n">previous</span>

	<span class="p">.</span><span class="n">section</span> <span class="n">__ex_table</span><span class="p">,</span><span class="s">&quot;a&quot;</span>
	<span class="p">.</span><span class="n">align</span>	<span class="mi">4</span>
	<span class="p">.</span><span class="kt">long</span>	<span class="p">.</span><span class="n">Lu1</span><span class="err">\@</span><span class="p">,.</span><span class="n">Lu3</span><span class="err">\@</span>
	<span class="p">.</span><span class="kt">long</span>	<span class="p">.</span><span class="n">Lu2</span><span class="err">\@</span><span class="p">,.</span><span class="n">Lu3</span><span class="err">\@</span>
	<span class="p">.</span><span class="n">previous</span>
<span class="p">.</span><span class="n">endm</span>


<span class="p">.</span><span class="n">macro</span>	<span class="n">movestack</span>	<span class="n">nr</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="n">arg3</span><span class="p">,</span><span class="n">arg4</span><span class="p">,</span><span class="n">arg5</span>
	<span class="p">.</span><span class="k">if</span>	<span class="err">\</span><span class="n">nr</span>
	<span class="n">movestack</span>	<span class="p">(</span><span class="err">\</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="err">\</span><span class="n">arg2</span><span class="p">,</span><span class="err">\</span><span class="n">arg3</span><span class="p">,</span><span class="err">\</span><span class="n">arg4</span><span class="p">,</span><span class="err">\</span><span class="n">arg5</span>
	<span class="n">move</span><span class="p">.</span><span class="n">l</span>	<span class="err">\</span><span class="n">arg1</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="o">%</span><span class="n">sp</span><span class="p">)</span>
	<span class="p">.</span><span class="n">endif</span>
<span class="p">.</span><span class="n">endm</span>

<span class="p">.</span><span class="n">macro</span>	<span class="n">printf</span>	<span class="n">bit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">string</span><span class="p">,</span><span class="n">nr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">arg1</span><span class="p">,</span><span class="n">arg2</span><span class="p">,</span><span class="n">arg3</span><span class="p">,</span><span class="n">arg4</span><span class="p">,</span><span class="n">arg5</span>
<span class="cp">#ifdef FPU_EMU_DEBUG</span>
	<span class="p">.</span><span class="n">data</span>
<span class="p">.</span><span class="n">Lpdata</span><span class="err">\@</span><span class="o">:</span>
	<span class="p">.</span><span class="n">string</span>	<span class="s">&quot;\string&quot;</span>
	<span class="p">.</span><span class="n">previous</span>

	<span class="n">movem</span><span class="p">.</span><span class="n">l</span>	<span class="o">%</span><span class="n">d0</span><span class="o">/%</span><span class="n">d1</span><span class="o">/%</span><span class="n">a0</span><span class="o">/%</span><span class="n">a1</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="o">%</span><span class="n">sp</span><span class="p">)</span>
	<span class="p">.</span><span class="k">if</span>	<span class="err">\</span><span class="n">bit</span><span class="o">+</span><span class="mi">1</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	moveq	#\bit,%d0</span>
<span class="c">	andw	#7,%d0</span>
<span class="c">	btst	%d0,fp_debugprint+((31-\bit)/8)</span>
<span class="cp">#else</span>
	<span class="n">btst</span>	<span class="err">#\</span><span class="n">bit</span><span class="p">,</span><span class="n">fp_debugprint</span><span class="o">+</span><span class="p">((</span><span class="mi">31</span><span class="o">-</span><span class="err">\</span><span class="n">bit</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span>
<span class="cp">#endif</span>
	<span class="n">jeq</span>	<span class="p">.</span><span class="n">Lpskip</span><span class="err">\@</span>
	<span class="p">.</span><span class="n">endif</span>
	<span class="n">movestack</span>	<span class="err">\</span><span class="n">nr</span><span class="p">,</span><span class="err">\</span><span class="n">arg1</span><span class="p">,</span><span class="err">\</span><span class="n">arg2</span><span class="p">,</span><span class="err">\</span><span class="n">arg3</span><span class="p">,</span><span class="err">\</span><span class="n">arg4</span><span class="p">,</span><span class="err">\</span><span class="n">arg5</span>
	<span class="n">pea</span>	<span class="p">.</span><span class="n">Lpdata</span><span class="err">\@</span>
	<span class="n">jsr</span>	<span class="n">printk</span>
	<span class="n">lea</span>	<span class="p">((</span><span class="err">\</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span><span class="o">%</span><span class="n">sp</span><span class="p">),</span><span class="o">%</span><span class="n">sp</span>
<span class="p">.</span><span class="n">Lpskip</span><span class="err">\@</span><span class="o">:</span>
	<span class="n">movem</span><span class="p">.</span><span class="n">l</span>	<span class="p">(</span><span class="o">%</span><span class="n">sp</span><span class="p">)</span><span class="o">+</span><span class="p">,</span><span class="o">%</span><span class="n">d0</span><span class="o">/%</span><span class="n">d1</span><span class="o">/%</span><span class="n">a0</span><span class="o">/%</span><span class="n">a1</span>
<span class="cp">#endif</span>
<span class="p">.</span><span class="n">endm</span>

<span class="p">.</span><span class="n">macro</span>	<span class="n">printx</span>	<span class="n">bit</span><span class="p">,</span><span class="n">fp</span>
<span class="cp">#ifdef FPU_EMU_DEBUG</span>
	<span class="n">movem</span><span class="p">.</span><span class="n">l</span>	<span class="o">%</span><span class="n">d0</span><span class="o">/%</span><span class="n">a0</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="o">%</span><span class="n">sp</span><span class="p">)</span>
	<span class="n">lea</span>	<span class="err">\</span><span class="n">fp</span><span class="p">,</span><span class="o">%</span><span class="n">a0</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	moveq	#&#39;+&#39;,%d0</span>
<span class="c">	tst.w	(%a0)</span>
<span class="c">	jeq	.Lx1\@</span>
<span class="c">	moveq	#&#39;-&#39;,%d0</span>
<span class="c">.Lx1\@:	printf	\bit,&quot; %c&quot;,1,%d0</span>
<span class="c">	move.l	(4,%a0),%d0</span>
<span class="c">	bclr	#31,%d0</span>
<span class="c">	jne	.Lx2\@</span>
<span class="c">	printf	\bit,&quot;0.&quot;</span>
<span class="c">	jra	.Lx3\@</span>
<span class="c">.Lx2\@:	printf	\bit,&quot;1.&quot;</span>
<span class="c">.Lx3\@:	printf	\bit,&quot;%08x%08x&quot;,2,%d0,%a0@(8)</span>
<span class="c">	move.w	(2,%a0),%d0</span>
<span class="c">	ext.l	%d0</span>
<span class="c">	printf	\bit,&quot;E%04x&quot;,1,%d0</span>
<span class="cp">#else</span>
	<span class="n">printf</span>	<span class="err">\</span><span class="n">bit</span><span class="p">,</span><span class="s">&quot; %08x%08x%08x&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">%</span><span class="n">a0</span><span class="err">@</span><span class="p">,</span><span class="o">%</span><span class="n">a0</span><span class="err">@</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="o">%</span><span class="n">a0</span><span class="err">@</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="cp">#endif</span>
	<span class="n">movem</span><span class="p">.</span><span class="n">l</span>	<span class="p">(</span><span class="o">%</span><span class="n">sp</span><span class="p">)</span><span class="o">+</span><span class="p">,</span><span class="o">%</span><span class="n">d0</span><span class="o">/%</span><span class="n">a0</span>
<span class="cp">#endif</span>
<span class="p">.</span><span class="n">endm</span>

<span class="p">.</span><span class="n">macro</span>	<span class="n">debug</span>	<span class="n">instr</span><span class="p">,</span><span class="n">args</span>
<span class="cp">#ifdef FPU_EMU_DEBUG</span>
	<span class="err">\</span><span class="n">instr</span>	<span class="err">\</span><span class="n">args</span>
<span class="cp">#endif</span>
<span class="p">.</span><span class="n">endm</span>


<span class="cp">#endif	</span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif	</span><span class="cm">/* _ASM_FRV_MATH_EMU_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
