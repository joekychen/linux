<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › frv › include › asm › registers.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>registers.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* registers.h: register frame declarations</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2003 Red Hat, Inc. All Rights Reserved.</span>
<span class="cm"> * Written by David Howells (dhowells@redhat.com)</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License</span>
<span class="cm"> * as published by the Free Software Foundation; either version</span>
<span class="cm"> * 2 of the License, or (at your option) any later version.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * notes:</span>
<span class="cm"> *</span>
<span class="cm"> * (1) that the members of all these structures are carefully aligned to permit</span>
<span class="cm"> *     usage of STD/STDF instructions</span>
<span class="cm"> *</span>
<span class="cm"> * (2) if you change these structures, you must change the code in</span>
<span class="cm"> *     arch/frvnommu/kernel/{break.S,entry.S,switch_to.S,gdb-stub.c}</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * the kernel stack space block looks like this:</span>
<span class="cm"> *</span>
<span class="cm"> *	+0x2000	+----------------------</span>
<span class="cm"> *		| union {</span>
<span class="cm"> *		|	struct frv_frame0 {</span>
<span class="cm"> *		|		struct user_context {</span>
<span class="cm"> *		|			struct user_int_regs</span>
<span class="cm"> *		|			struct user_fpmedia_regs</span>
<span class="cm"> *		|		}</span>
<span class="cm"> *		|		struct frv_debug_regs</span>
<span class="cm"> *		|	}</span>
<span class="cm"> *		|	struct pt_regs [user exception]</span>
<span class="cm"> *		| }</span>
<span class="cm"> *		+---------------------- &lt;-- __kernel_frame0_ptr (maybe GR28)</span>
<span class="cm"> *		|</span>
<span class="cm"> *		| kernel stack</span>
<span class="cm"> *		|</span>
<span class="cm"> *		|......................</span>
<span class="cm"> *		| struct pt_regs [kernel exception]</span>
<span class="cm"> *		|...................... &lt;-- __kernel_frame0_ptr (maybe GR28)</span>
<span class="cm"> *		|</span>
<span class="cm"> *		| kernel stack</span>
<span class="cm"> *		|</span>
<span class="cm"> *		|...................... &lt;-- stack pointer (GR1)</span>
<span class="cm"> *		|</span>
<span class="cm"> *		| unused stack space</span>
<span class="cm"> *		|</span>
<span class="cm"> *		+----------------------</span>
<span class="cm"> *		| struct thread_info</span>
<span class="cm"> *	+0x0000	+---------------------- &lt;-- __current_thread_info (GR15);</span>
<span class="cm"> *</span>
<span class="cm"> * note that GR28 points to the current exception frame</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _ASM_REGISTERS_H</span>
<span class="cp">#define _ASM_REGISTERS_H</span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="cp">#define __OFFSET(X,N)	((X)+(N)*4)</span>
<span class="cp">#define __OFFSETC(X,N)	xxxxxxxxxxxxxxxxxxxxxxxx</span>
<span class="cp">#else</span>
<span class="cp">#define __OFFSET(X,N)	((X)+(N)*4)</span>
<span class="cp">#define __OFFSETC(X,N)	((X)+(N))</span>
<span class="cp">#endif</span>

<span class="cm">/*****************************************************************************/</span>
<span class="cm">/*</span>
<span class="cm"> * Exception/Interrupt frame</span>
<span class="cm"> * - held on kernel stack</span>
<span class="cm"> * - 8-byte aligned on stack (old SP is saved in frame)</span>
<span class="cm"> * - GR0 is fixed 0, so we don&#39;t save it</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">struct</span> <span class="n">pt_regs</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">psr</span><span class="p">;</span>		<span class="cm">/* Processor Status Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">isr</span><span class="p">;</span>		<span class="cm">/* Integer Status Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">ccr</span><span class="p">;</span>		<span class="cm">/* Condition Code Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">cccr</span><span class="p">;</span>		<span class="cm">/* Condition Code for Conditional Insns Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">lr</span><span class="p">;</span>		<span class="cm">/* Link Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">lcr</span><span class="p">;</span>		<span class="cm">/* Loop Count Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">pc</span><span class="p">;</span>		<span class="cm">/* Program Counter Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">__status</span><span class="p">;</span>	<span class="cm">/* exception status */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">syscallno</span><span class="p">;</span>	<span class="cm">/* syscall number or -1 */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">orig_gr8</span><span class="p">;</span>	<span class="cm">/* original syscall arg #1 */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gner0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gner1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span>	<span class="n">iacc0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">tbr</span><span class="p">;</span>		<span class="cm">/* GR0 is fixed zero, so we use this for TBR */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">sp</span><span class="p">;</span>		<span class="cm">/* GR1: USP/KSP */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">fp</span><span class="p">;</span>		<span class="cm">/* GR2: FP */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr4</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr5</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr6</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr7</span><span class="p">;</span>		<span class="cm">/* syscall number */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr8</span><span class="p">;</span>		<span class="cm">/* 1st syscall param; syscall return */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr9</span><span class="p">;</span>		<span class="cm">/* 2nd syscall param */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr10</span><span class="p">;</span>		<span class="cm">/* 3rd syscall param */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr11</span><span class="p">;</span>		<span class="cm">/* 4th syscall param */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr12</span><span class="p">;</span>		<span class="cm">/* 5th syscall param */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr13</span><span class="p">;</span>		<span class="cm">/* 6th syscall param */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr14</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr15</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr16</span><span class="p">;</span>		<span class="cm">/* GP pointer */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr17</span><span class="p">;</span>		<span class="cm">/* small data */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr18</span><span class="p">;</span>		<span class="cm">/* PIC/PID */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr19</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr20</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr21</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr22</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr23</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr24</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr25</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr26</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr27</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pt_regs</span>		<span class="o">*</span><span class="n">next_frame</span><span class="p">;</span>	<span class="cm">/* GR28 - next exception frame */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr29</span><span class="p">;</span>		<span class="cm">/* GR29 - OS reserved */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr30</span><span class="p">;</span>		<span class="cm">/* GR30 - OS reserved */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gr31</span><span class="p">;</span>		<span class="cm">/* GR31 - OS reserved */</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="cp">#endif</span>

<span class="cp">#define REG__STATUS_STEP	0x00000001	</span><span class="cm">/* - reenable single stepping on return */</span><span class="cp"></span>
<span class="cp">#define REG__STATUS_STEPPED	0x00000002	</span><span class="cm">/* - single step caused exception */</span><span class="cp"></span>
<span class="cp">#define REG__STATUS_BROKE	0x00000004	</span><span class="cm">/* - BREAK insn caused exception */</span><span class="cp"></span>
<span class="cp">#define REG__STATUS_SYSC_ENTRY	0x40000000	</span><span class="cm">/* - T on syscall entry (ptrace.c only) */</span><span class="cp"></span>
<span class="cp">#define REG__STATUS_SYSC_EXIT	0x80000000	</span><span class="cm">/* - T on syscall exit (ptrace.c only) */</span><span class="cp"></span>

<span class="cp">#define REG_GR(R)	__OFFSET(REG_GR0, (R))</span>

<span class="cp">#define REG_SP		REG_GR(1)</span>
<span class="cp">#define REG_FP		REG_GR(2)</span>
<span class="cp">#define REG_PREV_FRAME	REG_GR(28)	</span><span class="cm">/* previous exception frame pointer (old gr28 value) */</span><span class="cp"></span>
<span class="cp">#define REG_CURR_TASK	REG_GR(29)	</span><span class="cm">/* current task */</span><span class="cp"></span>

<span class="cm">/*****************************************************************************/</span>
<span class="cm">/*</span>
<span class="cm"> * debugging registers</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">struct</span> <span class="n">frv_debug_regs</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">dcr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">ibar</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">8</span><span class="p">)));</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">dbar</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">8</span><span class="p">)));</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">dbdr</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">8</span><span class="p">)));</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">dbmr</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">8</span><span class="p">)));</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="cp">#endif</span>

<span class="cm">/*****************************************************************************/</span>
<span class="cm">/*</span>
<span class="cm"> * userspace registers</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">struct</span> <span class="n">user_int_regs</span>
<span class="p">{</span>
	<span class="cm">/* integer registers</span>
<span class="cm">	 * - up to gr[31] mirror pt_regs</span>
<span class="cm">	 * - total size must be multiple of 8 bytes</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">psr</span><span class="p">;</span>		<span class="cm">/* Processor Status Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">isr</span><span class="p">;</span>		<span class="cm">/* Integer Status Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">ccr</span><span class="p">;</span>		<span class="cm">/* Condition Code Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">cccr</span><span class="p">;</span>		<span class="cm">/* Condition Code for Conditional Insns Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">lr</span><span class="p">;</span>		<span class="cm">/* Link Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">lcr</span><span class="p">;</span>		<span class="cm">/* Loop Count Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">pc</span><span class="p">;</span>		<span class="cm">/* Program Counter Register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">__status</span><span class="p">;</span>	<span class="cm">/* exception status */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">syscallno</span><span class="p">;</span>	<span class="cm">/* syscall number or -1 */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">orig_gr8</span><span class="p">;</span>	<span class="cm">/* original syscall arg #1 */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">gner</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span>	<span class="n">iacc</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">tbr</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">gr</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">user_fpmedia_regs</span>
<span class="p">{</span>
	<span class="cm">/* FP/Media registers */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">fr</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">fner</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">msr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">acc</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">accg</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">fsr</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">user_context</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">user_int_regs</span>		<span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">user_fpmedia_regs</span>	<span class="n">f</span><span class="p">;</span>

	<span class="cm">/* we provide a context extension so that we can save the regs for CPUs that</span>
<span class="cm">	 * implement many more of Fujitsu&#39;s lavish register spec</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">extension</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">frv_frame0</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">pt_regs</span>		<span class="n">regs</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">user_context</span>	<span class="n">uc</span><span class="p">;</span>
	<span class="p">};</span>

	<span class="k">struct</span> <span class="n">frv_debug_regs</span>		<span class="n">debug</span><span class="p">;</span>

<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">32</span><span class="p">)));</span>

<span class="cp">#endif</span>

<span class="cp">#define __INT_GR(R)		__OFFSET(__INT_GR0,		(R))</span>

<span class="cp">#define __FPMEDIA_FR(R)		__OFFSET(__FPMEDIA_FR0,		(R))</span>
<span class="cp">#define __FPMEDIA_FNER(R)	__OFFSET(__FPMEDIA_FNER0,	(R))</span>
<span class="cp">#define __FPMEDIA_MSR(R)	__OFFSET(__FPMEDIA_MSR0,	(R))</span>
<span class="cp">#define __FPMEDIA_ACC(R)	__OFFSET(__FPMEDIA_ACC0,	(R))</span>
<span class="cp">#define __FPMEDIA_ACCG(R)	__OFFSETC(__FPMEDIA_ACCG0,	(R))</span>
<span class="cp">#define __FPMEDIA_FSR(R)	__OFFSET(__FPMEDIA_FSR0,	(R))</span>

<span class="cp">#define __THREAD_GR(R)		__OFFSET(__THREAD_GR16,		(R) - 16)</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_REGISTERS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
