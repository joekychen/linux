<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › cpu-features.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>cpu-features.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2003, 2004 Ralf Baechle</span>
<span class="cm"> * Copyright (C) 2004  Maciej W. Rozycki</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __ASM_CPU_FEATURES_H</span>
<span class="cp">#define __ASM_CPU_FEATURES_H</span>

<span class="cp">#include &lt;asm/cpu.h&gt;</span>
<span class="cp">#include &lt;asm/cpu-info.h&gt;</span>
<span class="cp">#include &lt;cpu-feature-overrides.h&gt;</span>

<span class="cp">#ifndef current_cpu_type</span>
<span class="cp">#define current_cpu_type()      current_cpu_data.cputype</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * SMP assumption: Options of CPU 0 are a superset of all processors.</span>
<span class="cm"> * This is true for all known MIPS systems.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef cpu_has_tlb</span>
<span class="cp">#define cpu_has_tlb		(cpu_data[0].options &amp; MIPS_CPU_TLB)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_4kex</span>
<span class="cp">#define cpu_has_4kex		(cpu_data[0].options &amp; MIPS_CPU_4KEX)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_3k_cache</span>
<span class="cp">#define cpu_has_3k_cache	(cpu_data[0].options &amp; MIPS_CPU_3K_CACHE)</span>
<span class="cp">#endif</span>
<span class="cp">#define cpu_has_6k_cache	0</span>
<span class="cp">#define cpu_has_8k_cache	0</span>
<span class="cp">#ifndef cpu_has_4k_cache</span>
<span class="cp">#define cpu_has_4k_cache	(cpu_data[0].options &amp; MIPS_CPU_4K_CACHE)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_tx39_cache</span>
<span class="cp">#define cpu_has_tx39_cache	(cpu_data[0].options &amp; MIPS_CPU_TX39_CACHE)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_octeon_cache</span>
<span class="cp">#define cpu_has_octeon_cache	0</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_fpu</span>
<span class="cp">#define cpu_has_fpu		(current_cpu_data.options &amp; MIPS_CPU_FPU)</span>
<span class="cp">#define raw_cpu_has_fpu		(raw_current_cpu_data.options &amp; MIPS_CPU_FPU)</span>
<span class="cp">#else</span>
<span class="cp">#define raw_cpu_has_fpu		cpu_has_fpu</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_32fpr</span>
<span class="cp">#define cpu_has_32fpr		(cpu_data[0].options &amp; MIPS_CPU_32FPR)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_counter</span>
<span class="cp">#define cpu_has_counter		(cpu_data[0].options &amp; MIPS_CPU_COUNTER)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_watch</span>
<span class="cp">#define cpu_has_watch		(cpu_data[0].options &amp; MIPS_CPU_WATCH)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_divec</span>
<span class="cp">#define cpu_has_divec		(cpu_data[0].options &amp; MIPS_CPU_DIVEC)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_vce</span>
<span class="cp">#define cpu_has_vce		(cpu_data[0].options &amp; MIPS_CPU_VCE)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_cache_cdex_p</span>
<span class="cp">#define cpu_has_cache_cdex_p	(cpu_data[0].options &amp; MIPS_CPU_CACHE_CDEX_P)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_cache_cdex_s</span>
<span class="cp">#define cpu_has_cache_cdex_s	(cpu_data[0].options &amp; MIPS_CPU_CACHE_CDEX_S)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_prefetch</span>
<span class="cp">#define cpu_has_prefetch	(cpu_data[0].options &amp; MIPS_CPU_PREFETCH)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_mcheck</span>
<span class="cp">#define cpu_has_mcheck		(cpu_data[0].options &amp; MIPS_CPU_MCHECK)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_ejtag</span>
<span class="cp">#define cpu_has_ejtag		(cpu_data[0].options &amp; MIPS_CPU_EJTAG)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_llsc</span>
<span class="cp">#define cpu_has_llsc		(cpu_data[0].options &amp; MIPS_CPU_LLSC)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef kernel_uses_llsc</span>
<span class="cp">#define kernel_uses_llsc	cpu_has_llsc</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_mips16</span>
<span class="cp">#define cpu_has_mips16		(cpu_data[0].ases &amp; MIPS_ASE_MIPS16)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_mdmx</span>
<span class="cp">#define cpu_has_mdmx           (cpu_data[0].ases &amp; MIPS_ASE_MDMX)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_mips3d</span>
<span class="cp">#define cpu_has_mips3d         (cpu_data[0].ases &amp; MIPS_ASE_MIPS3D)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_smartmips</span>
<span class="cp">#define cpu_has_smartmips      (cpu_data[0].ases &amp; MIPS_ASE_SMARTMIPS)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef kernel_uses_smartmips_rixi</span>
<span class="cp">#define kernel_uses_smartmips_rixi 0</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_vtag_icache</span>
<span class="cp">#define cpu_has_vtag_icache	(cpu_data[0].icache.flags &amp; MIPS_CACHE_VTAG)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_dc_aliases</span>
<span class="cp">#define cpu_has_dc_aliases	(cpu_data[0].dcache.flags &amp; MIPS_CACHE_ALIASES)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_ic_fills_f_dc</span>
<span class="cp">#define cpu_has_ic_fills_f_dc	(cpu_data[0].icache.flags &amp; MIPS_CACHE_IC_F_DC)</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_has_pindexed_dcache</span>
<span class="cp">#define cpu_has_pindexed_dcache	(cpu_data[0].dcache.flags &amp; MIPS_CACHE_PINDEX)</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * I-Cache snoops remote store.  This only matters on SMP.  Some multiprocessors</span>
<span class="cm"> * such as the R10000 have I-Caches that snoop local stores; the embedded ones</span>
<span class="cm"> * don&#39;t.  For maintaining I-cache coherency this means we need to flush the</span>
<span class="cm"> * D-cache all the way back to whever the I-cache does refills from, so the</span>
<span class="cm"> * I-cache has a chance to see the new data at all.  Then we have to flush the</span>
<span class="cm"> * I-cache also.</span>
<span class="cm"> * Note we may have been rescheduled and may no longer be running on the CPU</span>
<span class="cm"> * that did the store so we can&#39;t optimize this into only doing the flush on</span>
<span class="cm"> * the local CPU.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef cpu_icache_snoops_remote_store</span>
<span class="cp">#ifdef CONFIG_SMP</span>
<span class="cp">#define cpu_icache_snoops_remote_store	(cpu_data[0].icache.flags &amp; MIPS_IC_SNOOPS_REMOTE)</span>
<span class="cp">#else</span>
<span class="cp">#define cpu_icache_snoops_remote_store	1</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cp"># ifndef cpu_has_mips32r1</span>
<span class="cp"># define cpu_has_mips32r1	(cpu_data[0].isa_level &amp; MIPS_CPU_ISA_M32R1)</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_has_mips32r2</span>
<span class="cp"># define cpu_has_mips32r2	(cpu_data[0].isa_level &amp; MIPS_CPU_ISA_M32R2)</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_has_mips64r1</span>
<span class="cp"># define cpu_has_mips64r1	(cpu_data[0].isa_level &amp; MIPS_CPU_ISA_M64R1)</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_has_mips64r2</span>
<span class="cp"># define cpu_has_mips64r2	(cpu_data[0].isa_level &amp; MIPS_CPU_ISA_M64R2)</span>
<span class="cp"># endif</span>

<span class="cm">/*</span>
<span class="cm"> * Shortcuts ...</span>
<span class="cm"> */</span>
<span class="cp">#define cpu_has_mips32	(cpu_has_mips32r1 | cpu_has_mips32r2)</span>
<span class="cp">#define cpu_has_mips64	(cpu_has_mips64r1 | cpu_has_mips64r2)</span>
<span class="cp">#define cpu_has_mips_r1	(cpu_has_mips32r1 | cpu_has_mips64r1)</span>
<span class="cp">#define cpu_has_mips_r2	(cpu_has_mips32r2 | cpu_has_mips64r2)</span>
<span class="cp">#define cpu_has_mips_r	(cpu_has_mips32r1 | cpu_has_mips32r2 | \</span>
<span class="cp">			 cpu_has_mips64r1 | cpu_has_mips64r2)</span>

<span class="cp">#ifndef cpu_has_mips_r2_exec_hazard</span>
<span class="cp">#define cpu_has_mips_r2_exec_hazard cpu_has_mips_r2</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * MIPS32, MIPS64, VR5500, IDT32332, IDT32334 and maybe a few other</span>
<span class="cm"> * pre-MIPS32/MIPS53 processors have CLO, CLZ.  The IDT RC64574 is 64-bit and</span>
<span class="cm"> * has CLO and CLZ but not DCLO nor DCLZ.  For 64-bit kernels</span>
<span class="cm"> * cpu_has_clo_clz also indicates the availability of DCLO and DCLZ.</span>
<span class="cm"> */</span>
<span class="cp"># ifndef cpu_has_clo_clz</span>
<span class="cp"># define cpu_has_clo_clz	cpu_has_mips_r</span>
<span class="cp"># endif</span>

<span class="cp">#ifndef cpu_has_dsp</span>
<span class="cp">#define cpu_has_dsp		(cpu_data[0].ases &amp; MIPS_ASE_DSP)</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef cpu_has_mipsmt</span>
<span class="cp">#define cpu_has_mipsmt		(cpu_data[0].ases &amp; MIPS_ASE_MIPSMT)</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef cpu_has_userlocal</span>
<span class="cp">#define cpu_has_userlocal	(cpu_data[0].options &amp; MIPS_CPU_ULRI)</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_32BIT</span>
<span class="cp"># ifndef cpu_has_nofpuex</span>
<span class="cp"># define cpu_has_nofpuex	(cpu_data[0].options &amp; MIPS_CPU_NOFPUEX)</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_has_64bits</span>
<span class="cp"># define cpu_has_64bits		(cpu_data[0].isa_level &amp; MIPS_CPU_ISA_64BIT)</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_has_64bit_zero_reg</span>
<span class="cp"># define cpu_has_64bit_zero_reg	(cpu_data[0].isa_level &amp; MIPS_CPU_ISA_64BIT)</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_has_64bit_gp_regs</span>
<span class="cp"># define cpu_has_64bit_gp_regs		0</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_has_64bit_addresses</span>
<span class="cp"># define cpu_has_64bit_addresses	0</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_vmbits</span>
<span class="cp"># define cpu_vmbits 31</span>
<span class="cp"># endif</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_64BIT</span>
<span class="cp"># ifndef cpu_has_nofpuex</span>
<span class="cp"># define cpu_has_nofpuex		0</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_has_64bits</span>
<span class="cp"># define cpu_has_64bits			1</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_has_64bit_zero_reg</span>
<span class="cp"># define cpu_has_64bit_zero_reg		1</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_has_64bit_gp_regs</span>
<span class="cp"># define cpu_has_64bit_gp_regs		1</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_has_64bit_addresses</span>
<span class="cp"># define cpu_has_64bit_addresses	1</span>
<span class="cp"># endif</span>
<span class="cp"># ifndef cpu_vmbits</span>
<span class="cp"># define cpu_vmbits cpu_data[0].vmbits</span>
<span class="cp"># define __NEED_VMBITS_PROBE</span>
<span class="cp"># endif</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_CPU_MIPSR2_IRQ_VI) &amp;&amp; !defined(cpu_has_vint)</span>
<span class="cp"># define cpu_has_vint		(cpu_data[0].options &amp; MIPS_CPU_VINT)</span>
<span class="cp">#elif !defined(cpu_has_vint)</span>
<span class="cp"># define cpu_has_vint			0</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_CPU_MIPSR2_IRQ_EI) &amp;&amp; !defined(cpu_has_veic)</span>
<span class="cp"># define cpu_has_veic		(cpu_data[0].options &amp; MIPS_CPU_VEIC)</span>
<span class="cp">#elif !defined(cpu_has_veic)</span>
<span class="cp"># define cpu_has_veic			0</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef cpu_has_inclusive_pcaches</span>
<span class="cp">#define cpu_has_inclusive_pcaches	(cpu_data[0].options &amp; MIPS_CPU_INCLUSIVE_CACHES)</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef cpu_dcache_line_size</span>
<span class="cp">#define cpu_dcache_line_size()	cpu_data[0].dcache.linesz</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_icache_line_size</span>
<span class="cp">#define cpu_icache_line_size()	cpu_data[0].icache.linesz</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef cpu_scache_line_size</span>
<span class="cp">#define cpu_scache_line_size()	cpu_data[0].scache.linesz</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef cpu_hwrena_impl_bits</span>
<span class="cp">#define cpu_hwrena_impl_bits		0</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* __ASM_CPU_FEATURES_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
