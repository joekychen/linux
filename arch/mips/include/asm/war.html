<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › war.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>war.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2002, 2004, 2007 by Ralf Baechle</span>
<span class="cm"> * Copyright (C) 2007  Maciej W. Rozycki</span>
<span class="cm"> */</span>
<span class="cp">#ifndef _ASM_WAR_H</span>
<span class="cp">#define _ASM_WAR_H</span>

<span class="cp">#include &lt;war.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Work around certain R4000 CPU errata (as implemented by GCC):</span>
<span class="cm"> *</span>
<span class="cm"> * - A double-word or a variable shift may give an incorrect result</span>
<span class="cm"> *   if executed immediately after starting an integer division:</span>
<span class="cm"> *   &quot;MIPS R4000PC/SC Errata, Processor Revision 2.2 and 3.0&quot;,</span>
<span class="cm"> *   erratum #28</span>
<span class="cm"> *   &quot;MIPS R4000MC Errata, Processor Revision 2.2 and 3.0&quot;, erratum</span>
<span class="cm"> *   #19</span>
<span class="cm"> *</span>
<span class="cm"> * - A double-word or a variable shift may give an incorrect result</span>
<span class="cm"> *   if executed while an integer multiplication is in progress:</span>
<span class="cm"> *   &quot;MIPS R4000PC/SC Errata, Processor Revision 2.2 and 3.0&quot;,</span>
<span class="cm"> *   errata #16 &amp; #28</span>
<span class="cm"> *</span>
<span class="cm"> * - An integer division may give an incorrect result if started in</span>
<span class="cm"> *   a delay slot of a taken branch or a jump:</span>
<span class="cm"> *   &quot;MIPS R4000PC/SC Errata, Processor Revision 2.2 and 3.0&quot;,</span>
<span class="cm"> *   erratum #52</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_CPU_R4000_WORKAROUNDS</span>
<span class="cp">#define R4000_WAR 1</span>
<span class="cp">#else</span>
<span class="cp">#define R4000_WAR 0</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Work around certain R4400 CPU errata (as implemented by GCC):</span>
<span class="cm"> *</span>
<span class="cm"> * - A double-word or a variable shift may give an incorrect result</span>
<span class="cm"> *   if executed immediately after starting an integer division:</span>
<span class="cm"> *   &quot;MIPS R4400MC Errata, Processor Revision 1.0&quot;, erratum #10</span>
<span class="cm"> *   &quot;MIPS R4400MC Errata, Processor Revision 2.0 &amp; 3.0&quot;, erratum #4</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_CPU_R4400_WORKAROUNDS</span>
<span class="cp">#define R4400_WAR 1</span>
<span class="cp">#else</span>
<span class="cp">#define R4400_WAR 0</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Work around the &quot;daddi&quot; and &quot;daddiu&quot; CPU errata:</span>
<span class="cm"> *</span>
<span class="cm"> * - The `daddi&#39; instruction fails to trap on overflow.</span>
<span class="cm"> *   &quot;MIPS R4000PC/SC Errata, Processor Revision 2.2 and 3.0&quot;,</span>
<span class="cm"> *   erratum #23</span>
<span class="cm"> *</span>
<span class="cm"> * - The `daddiu&#39; instruction can produce an incorrect result.</span>
<span class="cm"> *   &quot;MIPS R4000PC/SC Errata, Processor Revision 2.2 and 3.0&quot;,</span>
<span class="cm"> *   erratum #41</span>
<span class="cm"> *   &quot;MIPS R4000MC Errata, Processor Revision 2.2 and 3.0&quot;, erratum</span>
<span class="cm"> *   #15</span>
<span class="cm"> *   &quot;MIPS R4400PC/SC Errata, Processor Revision 1.0&quot;, erratum #7</span>
<span class="cm"> *   &quot;MIPS R4400MC Errata, Processor Revision 1.0&quot;, erratum #5</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_CPU_DADDI_WORKAROUNDS</span>
<span class="cp">#define DADDI_WAR 1</span>
<span class="cp">#else</span>
<span class="cp">#define DADDI_WAR 0</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Another R4600 erratum.  Due to the lack of errata information the exact</span>
<span class="cm"> * technical details aren&#39;t known.  I&#39;ve experimentally found that disabling</span>
<span class="cm"> * interrupts during indexed I-cache flushes seems to be sufficient to deal</span>
<span class="cm"> * with the issue.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef R4600_V1_INDEX_ICACHEOP_WAR</span>
<span class="cp">#error Check setting of R4600_V1_INDEX_ICACHEOP_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Pleasures of the R4600 V1.x.  Cite from the IDT R4600 V1.7 errata:</span>
<span class="cm"> *</span>
<span class="cm"> *  18. The CACHE instructions Hit_Writeback_Invalidate_D, Hit_Writeback_D,</span>
<span class="cm"> *      Hit_Invalidate_D and Create_Dirty_Excl_D should only be</span>
<span class="cm"> *      executed if there is no other dcache activity. If the dcache is</span>
<span class="cm"> *      accessed for another instruction immeidately preceding when these</span>
<span class="cm"> *      cache instructions are executing, it is possible that the dcache</span>
<span class="cm"> *      tag match outputs used by these cache instructions will be</span>
<span class="cm"> *      incorrect. These cache instructions should be preceded by at least</span>
<span class="cm"> *      four instructions that are not any kind of load or store</span>
<span class="cm"> *      instruction.</span>
<span class="cm"> *</span>
<span class="cm"> *      This is not allowed:    lw</span>
<span class="cm"> *                              nop</span>
<span class="cm"> *                              nop</span>
<span class="cm"> *                              nop</span>
<span class="cm"> *                              cache       Hit_Writeback_Invalidate_D</span>
<span class="cm"> *</span>
<span class="cm"> *      This is allowed:        lw</span>
<span class="cm"> *                              nop</span>
<span class="cm"> *                              nop</span>
<span class="cm"> *                              nop</span>
<span class="cm"> *                              nop</span>
<span class="cm"> *                              cache       Hit_Writeback_Invalidate_D</span>
<span class="cm"> */</span>
<span class="cp">#ifndef R4600_V1_HIT_CACHEOP_WAR</span>
<span class="cp">#error Check setting of R4600_V1_HIT_CACHEOP_WAR for your platform</span>
<span class="cp">#endif</span>


<span class="cm">/*</span>
<span class="cm"> * Writeback and invalidate the primary cache dcache before DMA.</span>
<span class="cm"> *</span>
<span class="cm"> * R4600 v2.0 bug: &quot;The CACHE instructions Hit_Writeback_Inv_D,</span>
<span class="cm"> * Hit_Writeback_D, Hit_Invalidate_D and Create_Dirty_Exclusive_D will only</span>
<span class="cm"> * operate correctly if the internal data cache refill buffer is empty.  These</span>
<span class="cm"> * CACHE instructions should be separated from any potential data cache miss</span>
<span class="cm"> * by a load instruction to an uncached address to empty the response buffer.&quot;</span>
<span class="cm"> * (Revision 2.0 device errata from IDT available on http://www.idt.com/</span>
<span class="cm"> * in .pdf format.)</span>
<span class="cm"> */</span>
<span class="cp">#ifndef R4600_V2_HIT_CACHEOP_WAR</span>
<span class="cp">#error Check setting of R4600_V2_HIT_CACHEOP_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * When an interrupt happens on a CP0 register read instruction, CPU may</span>
<span class="cm"> * lock up or read corrupted values of CP0 registers after it enters</span>
<span class="cm"> * the exception handler.</span>
<span class="cm"> *</span>
<span class="cm"> * This workaround makes sure that we read a &quot;safe&quot; CP0 register as the</span>
<span class="cm"> * first thing in the exception handler, which breaks one of the</span>
<span class="cm"> * pre-conditions for this problem.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef R5432_CP0_INTERRUPT_WAR</span>
<span class="cp">#error Check setting of R5432_CP0_INTERRUPT_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Workaround for the Sibyte M3 errata the text of which can be found at</span>
<span class="cm"> *</span>
<span class="cm"> *   http://sibyte.broadcom.com/hw/bcm1250/docs/pass2errata.txt</span>
<span class="cm"> *</span>
<span class="cm"> * This will enable the use of a special TLB refill handler which does a</span>
<span class="cm"> * consistency check on the information in c0_badvaddr and c0_entryhi and</span>
<span class="cm"> * will just return and take the exception again if the information was</span>
<span class="cm"> * found to be inconsistent.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef BCM1250_M3_WAR</span>
<span class="cp">#error Check setting of BCM1250_M3_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * This is a DUART workaround related to glitches around register accesses</span>
<span class="cm"> */</span>
<span class="cp">#ifndef SIBYTE_1956_WAR</span>
<span class="cp">#error Check setting of SIBYTE_1956_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Fill buffers not flushed on CACHE instructions</span>
<span class="cm"> *</span>
<span class="cm"> * Hit_Invalidate_I cacheops invalidate an icache line but the refill</span>
<span class="cm"> * for that line can get stale data from the fill buffer instead of</span>
<span class="cm"> * accessing memory if the previous icache miss was also to that line.</span>
<span class="cm"> *</span>
<span class="cm"> * Workaround: generate an icache refill from a different line</span>
<span class="cm"> *</span>
<span class="cm"> * Affects:</span>
<span class="cm"> *  MIPS 4K		RTL revision &lt;3.0, PRID revision &lt;4</span>
<span class="cm"> */</span>
<span class="cp">#ifndef MIPS4K_ICACHE_REFILL_WAR</span>
<span class="cp">#error Check setting of MIPS4K_ICACHE_REFILL_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Missing implicit forced flush of evictions caused by CACHE</span>
<span class="cm"> * instruction</span>
<span class="cm"> *</span>
<span class="cm"> * Evictions caused by a CACHE instructions are not forced on to the</span>
<span class="cm"> * bus. The BIU gives higher priority to fetches than to the data from</span>
<span class="cm"> * the eviction buffer and no collision detection is performed between</span>
<span class="cm"> * fetches and pending data from the eviction buffer.</span>
<span class="cm"> *</span>
<span class="cm"> * Workaround: Execute a SYNC instruction after the cache instruction</span>
<span class="cm"> *</span>
<span class="cm"> * Affects:</span>
<span class="cm"> *   MIPS 5Kc,5Kf	RTL revision &lt;2.3, PRID revision &lt;8</span>
<span class="cm"> *   MIPS 20Kc		RTL revision &lt;4.0, PRID revision &lt;?</span>
<span class="cm"> */</span>
<span class="cp">#ifndef MIPS_CACHE_SYNC_WAR</span>
<span class="cp">#error Check setting of MIPS_CACHE_SYNC_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * From TX49/H2 manual: &quot;If the instruction (i.e. CACHE) is issued for</span>
<span class="cm"> * the line which this instruction itself exists, the following</span>
<span class="cm"> * operation is not guaranteed.&quot;</span>
<span class="cm"> *</span>
<span class="cm"> * Workaround: do two phase flushing for Index_Invalidate_I</span>
<span class="cm"> */</span>
<span class="cp">#ifndef TX49XX_ICACHE_INDEX_INV_WAR</span>
<span class="cp">#error Check setting of TX49XX_ICACHE_INDEX_INV_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * On the RM9000 there is a problem which makes the CreateDirtyExclusive</span>
<span class="cm"> * eache operation unusable on SMP systems.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef RM9000_CDEX_SMP_WAR</span>
<span class="cp">#error Check setting of RM9000_CDEX_SMP_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * The RM7000 processors and the E9000 cores have a bug (though PMC-Sierra</span>
<span class="cm"> * opposes it being called that) where invalid instructions in the same</span>
<span class="cm"> * I-cache line worth of instructions being fetched may case spurious</span>
<span class="cm"> * exceptions.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef ICACHE_REFILLS_WORKAROUND_WAR</span>
<span class="cp">#error Check setting of ICACHE_REFILLS_WORKAROUND_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * On the R10000 up to version 2.6 (not sure about 2.7) there is a bug that</span>
<span class="cm"> * may cause ll / sc and lld / scd sequences to execute non-atomically.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef R10000_LLSC_WAR</span>
<span class="cp">#error Check setting of R10000_LLSC_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * 34K core erratum: &quot;Problems Executing the TLBR Instruction&quot;</span>
<span class="cm"> */</span>
<span class="cp">#ifndef MIPS34K_MISSED_ITLB_WAR</span>
<span class="cp">#error Check setting of MIPS34K_MISSED_ITLB_WAR for your platform</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_WAR_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
