<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › pci › bridge.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>bridge.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * bridge.h - bridge chip header file, derived from IRIX &lt;sys/PCI/bridge.h&gt;,</span>
<span class="cm"> * revision 1.76.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1996, 1999 Silcon Graphics, Inc.</span>
<span class="cm"> * Copyright (C) 1999 Ralf Baechle (ralf@gnu.org)</span>
<span class="cm"> */</span>
<span class="cp">#ifndef _ASM_PCI_BRIDGE_H</span>
<span class="cp">#define _ASM_PCI_BRIDGE_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;asm/xtalk/xwidget.h&gt;		</span><span class="cm">/* generic widget header */</span><span class="cp"></span>
<span class="cp">#include &lt;asm/sn/types.h&gt;</span>

<span class="cm">/* I/O page size */</span>

<span class="cp">#define IOPFNSHIFT		12	</span><span class="cm">/* 4K per mapped page */</span><span class="cp"></span>

<span class="cp">#define IOPGSIZE		(1 &lt;&lt; IOPFNSHIFT)</span>
<span class="cp">#define IOPG(x)			((x) &gt;&gt; IOPFNSHIFT)</span>
<span class="cp">#define IOPGOFF(x)		((x) &amp; (IOPGSIZE-1))</span>

<span class="cm">/* Bridge RAM sizes */</span>

<span class="cp">#define BRIDGE_ATE_RAM_SIZE	0x00000400	</span><span class="cm">/* 1kB ATE RAM */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_CONFIG_BASE	0x20000</span>
<span class="cp">#define BRIDGE_CONFIG1_BASE	0x28000</span>
<span class="cp">#define BRIDGE_CONFIG_END	0x30000</span>
<span class="cp">#define BRIDGE_CONFIG_SLOT_SIZE 0x1000</span>

<span class="cp">#define BRIDGE_SSRAM_512K	0x00080000	</span><span class="cm">/* 512kB */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_SSRAM_128K	0x00020000	</span><span class="cm">/* 128kB */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_SSRAM_64K	0x00010000	</span><span class="cm">/* 64kB */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_SSRAM_0K		0x00000000	</span><span class="cm">/* 0kB */</span><span class="cp"></span>

<span class="cm">/* ========================================================================</span>
<span class="cm"> *    Bridge address map</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cm">/*</span>
<span class="cm"> * All accesses to bridge hardware registers must be done</span>
<span class="cm"> * using 32-bit loads and stores.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="n">u32</span>	<span class="n">bridgereg_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">u64</span>	<span class="n">bridge_ate_t</span><span class="p">;</span>

<span class="cm">/* pointers to bridge ATEs</span>
<span class="cm"> * are always &quot;pointer to volatile&quot;</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">volatile</span> <span class="n">bridge_ate_t</span>  <span class="o">*</span><span class="n">bridge_ate_p</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * It is generally preferred that hardware registers on the bridge</span>
<span class="cm"> * are located from C code via this structure.</span>
<span class="cm"> *</span>
<span class="cm"> * Generated from Bridge spec dated 04oct95</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">volatile</span> <span class="k">struct</span> <span class="n">bridge_s</span> <span class="p">{</span>
	<span class="cm">/* Local Registers			       0x000000-0x00FFFF */</span>

	<span class="cm">/* standard widget configuration	       0x000000-0x000057 */</span>
	<span class="n">widget_cfg_t</span>	    <span class="n">b_widget</span><span class="p">;</span>			<span class="cm">/* 0x000000 */</span>

	<span class="cm">/* helper fieldnames for accessing bridge widget */</span>

<span class="cp">#define b_wid_id			b_widget.w_id</span>
<span class="cp">#define b_wid_stat			b_widget.w_status</span>
<span class="cp">#define b_wid_err_upper			b_widget.w_err_upper_addr</span>
<span class="cp">#define b_wid_err_lower			b_widget.w_err_lower_addr</span>
<span class="cp">#define b_wid_control			b_widget.w_control</span>
<span class="cp">#define b_wid_req_timeout		b_widget.w_req_timeout</span>
<span class="cp">#define b_wid_int_upper			b_widget.w_intdest_upper_addr</span>
<span class="cp">#define b_wid_int_lower			b_widget.w_intdest_lower_addr</span>
<span class="cp">#define b_wid_err_cmdword		b_widget.w_err_cmd_word</span>
<span class="cp">#define b_wid_llp			b_widget.w_llp_cfg</span>
<span class="cp">#define b_wid_tflush			b_widget.w_tflush</span>

	<span class="cm">/* bridge-specific widget configuration	0x000058-0x00007F */</span>
	<span class="n">bridgereg_t</span>	    <span class="n">_pad_000058</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	    <span class="n">b_wid_aux_err</span><span class="p">;</span>		<span class="cm">/* 0x00005C */</span>
	<span class="n">bridgereg_t</span>	    <span class="n">_pad_000060</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	    <span class="n">b_wid_resp_upper</span><span class="p">;</span>		<span class="cm">/* 0x000064 */</span>
	<span class="n">bridgereg_t</span>	    <span class="n">_pad_000068</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	    <span class="n">b_wid_resp_lower</span><span class="p">;</span>		<span class="cm">/* 0x00006C */</span>
	<span class="n">bridgereg_t</span>	    <span class="n">_pad_000070</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	    <span class="n">b_wid_tst_pin_ctrl</span><span class="p">;</span>		<span class="cm">/* 0x000074 */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000078</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* PMU &amp; Map 0x000080-0x00008F */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000080</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_dir_map</span><span class="p">;</span>			<span class="cm">/* 0x000084 */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000088</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* SSRAM 0x000090-0x00009F */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000090</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_ram_perr</span><span class="p">;</span>			<span class="cm">/* 0x000094 */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000098</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* Arbitration 0x0000A0-0x0000AF */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_0000A0</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_arb</span><span class="p">;</span>				<span class="cm">/* 0x0000A4 */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_0000A8</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* Number In A Can 0x0000B0-0x0000BF */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_0000B0</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_nic</span><span class="p">;</span>				<span class="cm">/* 0x0000B4 */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_0000B8</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* PCI/GIO 0x0000C0-0x0000FF */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_0000C0</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_bus_timeout</span><span class="p">;</span>			<span class="cm">/* 0x0000C4 */</span>
<span class="cp">#define b_pci_bus_timeout b_bus_timeout</span>

	<span class="n">bridgereg_t</span>	<span class="n">_pad_0000C8</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_pci_cfg</span><span class="p">;</span>			<span class="cm">/* 0x0000CC */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_0000D0</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_pci_err_upper</span><span class="p">;</span>		<span class="cm">/* 0x0000D4 */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_0000D8</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_pci_err_lower</span><span class="p">;</span>		<span class="cm">/* 0x0000DC */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_0000E0</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="cp">#define b_gio_err_lower b_pci_err_lower</span>
<span class="cp">#define b_gio_err_upper b_pci_err_upper</span>

	<span class="cm">/* Interrupt 0x000100-0x0001FF */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000100</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_int_status</span><span class="p">;</span>			<span class="cm">/* 0x000104 */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000108</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_int_enable</span><span class="p">;</span>			<span class="cm">/* 0x00010C */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000110</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_int_rst_stat</span><span class="p">;</span>			<span class="cm">/* 0x000114 */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000118</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_int_mode</span><span class="p">;</span>			<span class="cm">/* 0x00011C */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000120</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_int_device</span><span class="p">;</span>			<span class="cm">/* 0x000124 */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000128</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_int_host_err</span><span class="p">;</span>			<span class="cm">/* 0x00012C */</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">bridgereg_t</span>	<span class="n">__pad</span><span class="p">;</span>			<span class="cm">/* 0x0001{30,,,68} */</span>
		<span class="n">bridgereg_t</span>	<span class="n">addr</span><span class="p">;</span>			<span class="cm">/* 0x0001{34,,,6C} */</span>
	<span class="p">}</span> <span class="n">b_int_addr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>				<span class="cm">/* 0x000130 */</span>

	<span class="n">bridgereg_t</span>	<span class="n">_pad_000170</span><span class="p">[</span><span class="mi">36</span><span class="p">];</span>

	<span class="cm">/* Device 0x000200-0x0003FF */</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">bridgereg_t</span>	<span class="n">__pad</span><span class="p">;</span>			<span class="cm">/* 0x0002{00,,,38} */</span>
		<span class="n">bridgereg_t</span>	<span class="n">reg</span><span class="p">;</span>			<span class="cm">/* 0x0002{04,,,3C} */</span>
	<span class="p">}</span> <span class="n">b_device</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>					<span class="cm">/* 0x000200 */</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">bridgereg_t</span>	<span class="n">__pad</span><span class="p">;</span>			<span class="cm">/* 0x0002{40,,,78} */</span>
		<span class="n">bridgereg_t</span>	<span class="n">reg</span><span class="p">;</span>			<span class="cm">/* 0x0002{44,,,7C} */</span>
	<span class="p">}</span> <span class="n">b_wr_req_buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>				<span class="cm">/* 0x000240 */</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">bridgereg_t</span>	<span class="n">__pad</span><span class="p">;</span>			<span class="cm">/* 0x0002{80,,,88} */</span>
		<span class="n">bridgereg_t</span>	<span class="n">reg</span><span class="p">;</span>			<span class="cm">/* 0x0002{84,,,8C} */</span>
	<span class="p">}</span> <span class="n">b_rrb_map</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>					<span class="cm">/* 0x000280 */</span>
<span class="cp">#define	b_even_resp	b_rrb_map[0].reg		</span><span class="cm">/* 0x000284 */</span><span class="cp"></span>
<span class="cp">#define	b_odd_resp	b_rrb_map[1].reg		</span><span class="cm">/* 0x00028C */</span><span class="cp"></span>

	<span class="n">bridgereg_t</span>	<span class="n">_pad_000290</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_resp_status</span><span class="p">;</span>			<span class="cm">/* 0x000294 */</span>
	<span class="n">bridgereg_t</span>	<span class="n">_pad_000298</span><span class="p">;</span>
	<span class="n">bridgereg_t</span>	<span class="n">b_resp_clear</span><span class="p">;</span>			<span class="cm">/* 0x00029C */</span>

	<span class="n">bridgereg_t</span>	<span class="n">_pad_0002A0</span><span class="p">[</span><span class="mi">24</span><span class="p">];</span>

	<span class="kt">char</span>		<span class="n">_pad_000300</span><span class="p">[</span><span class="mh">0x10000</span> <span class="o">-</span> <span class="mh">0x000300</span><span class="p">];</span>

	<span class="cm">/* Internal Address Translation Entry RAM 0x010000-0x0103FF */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">bridge_ate_t</span>	<span class="n">wr</span><span class="p">;</span>			<span class="cm">/* write-only */</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">bridgereg_t</span>	<span class="n">_p_pad</span><span class="p">;</span>
			<span class="n">bridgereg_t</span>	<span class="n">rd</span><span class="p">;</span>		<span class="cm">/* read-only */</span>
		<span class="p">}</span>			<span class="n">hi</span><span class="p">;</span>
	<span class="p">}</span>			    <span class="n">b_int_ate_ram</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>

	<span class="kt">char</span>	<span class="n">_pad_010400</span><span class="p">[</span><span class="mh">0x11000</span> <span class="o">-</span> <span class="mh">0x010400</span><span class="p">];</span>

	<span class="cm">/* Internal Address Translation Entry RAM LOW 0x011000-0x0113FF */</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">bridgereg_t</span>	<span class="n">_p_pad</span><span class="p">;</span>
		<span class="n">bridgereg_t</span>	<span class="n">rd</span><span class="p">;</span>		<span class="cm">/* read-only */</span>
	<span class="p">}</span> <span class="n">b_int_ate_ram_lo</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>

	<span class="kt">char</span>	<span class="n">_pad_011400</span><span class="p">[</span><span class="mh">0x20000</span> <span class="o">-</span> <span class="mh">0x011400</span><span class="p">];</span>

	<span class="cm">/* PCI Device Configuration Spaces 0x020000-0x027FFF */</span>
	<span class="k">union</span> <span class="p">{</span>				<span class="cm">/* make all access sizes available. */</span>
		<span class="n">u8</span>	<span class="n">c</span><span class="p">[</span><span class="mh">0x1000</span> <span class="o">/</span> <span class="mi">1</span><span class="p">];</span>
		<span class="n">u16</span>	<span class="n">s</span><span class="p">[</span><span class="mh">0x1000</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
		<span class="n">u32</span>	<span class="n">l</span><span class="p">[</span><span class="mh">0x1000</span> <span class="o">/</span> <span class="mi">4</span><span class="p">];</span>
		<span class="n">u64</span>	<span class="n">d</span><span class="p">[</span><span class="mh">0x1000</span> <span class="o">/</span> <span class="mi">8</span><span class="p">];</span>
		<span class="k">union</span> <span class="p">{</span>
			<span class="n">u8</span>	<span class="n">c</span><span class="p">[</span><span class="mh">0x100</span> <span class="o">/</span> <span class="mi">1</span><span class="p">];</span>
			<span class="n">u16</span>	<span class="n">s</span><span class="p">[</span><span class="mh">0x100</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
			<span class="n">u32</span>	<span class="n">l</span><span class="p">[</span><span class="mh">0x100</span> <span class="o">/</span> <span class="mi">4</span><span class="p">];</span>
			<span class="n">u64</span>	<span class="n">d</span><span class="p">[</span><span class="mh">0x100</span> <span class="o">/</span> <span class="mi">8</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">f</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">b_type0_cfg_dev</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>					<span class="cm">/* 0x020000 */</span>

    <span class="cm">/* PCI Type 1 Configuration Space 0x028000-0x028FFF */</span>
	<span class="k">union</span> <span class="p">{</span>				<span class="cm">/* make all access sizes available. */</span>
		<span class="n">u8</span>	<span class="n">c</span><span class="p">[</span><span class="mh">0x1000</span> <span class="o">/</span> <span class="mi">1</span><span class="p">];</span>
		<span class="n">u16</span>	<span class="n">s</span><span class="p">[</span><span class="mh">0x1000</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
		<span class="n">u32</span>	<span class="n">l</span><span class="p">[</span><span class="mh">0x1000</span> <span class="o">/</span> <span class="mi">4</span><span class="p">];</span>
		<span class="n">u64</span>	<span class="n">d</span><span class="p">[</span><span class="mh">0x1000</span> <span class="o">/</span> <span class="mi">8</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">b_type1_cfg</span><span class="p">;</span>					<span class="cm">/* 0x028000-0x029000 */</span>

	<span class="kt">char</span>	<span class="n">_pad_029000</span><span class="p">[</span><span class="mh">0x007000</span><span class="p">];</span>			<span class="cm">/* 0x029000-0x030000 */</span>

	<span class="cm">/* PCI Interrupt Acknowledge Cycle 0x030000 */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">u8</span>	<span class="n">c</span><span class="p">[</span><span class="mi">8</span> <span class="o">/</span> <span class="mi">1</span><span class="p">];</span>
		<span class="n">u16</span>	<span class="n">s</span><span class="p">[</span><span class="mi">8</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
		<span class="n">u32</span>	<span class="n">l</span><span class="p">[</span><span class="mi">8</span> <span class="o">/</span> <span class="mi">4</span><span class="p">];</span>
		<span class="n">u64</span>	<span class="n">d</span><span class="p">[</span><span class="mi">8</span> <span class="o">/</span> <span class="mi">8</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">b_pci_iack</span><span class="p">;</span>						<span class="cm">/* 0x030000 */</span>

	<span class="n">u8</span>	<span class="n">_pad_030007</span><span class="p">[</span><span class="mh">0x04fff8</span><span class="p">];</span>			<span class="cm">/* 0x030008-0x07FFFF */</span>

	<span class="cm">/* External Address Translation Entry RAM 0x080000-0x0FFFFF */</span>
	<span class="n">bridge_ate_t</span>    <span class="n">b_ext_ate_ram</span><span class="p">[</span><span class="mh">0x10000</span><span class="p">];</span>

	<span class="cm">/* Reserved 0x100000-0x1FFFFF */</span>
	<span class="kt">char</span>	<span class="n">_pad_100000</span><span class="p">[</span><span class="mh">0x200000</span><span class="o">-</span><span class="mh">0x100000</span><span class="p">];</span>

	<span class="cm">/* PCI/GIO Device Spaces 0x200000-0xBFFFFF */</span>
	<span class="k">union</span> <span class="p">{</span>				<span class="cm">/* make all access sizes available. */</span>
		<span class="n">u8</span>	<span class="n">c</span><span class="p">[</span><span class="mh">0x100000</span> <span class="o">/</span> <span class="mi">1</span><span class="p">];</span>
		<span class="n">u16</span>	<span class="n">s</span><span class="p">[</span><span class="mh">0x100000</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>
		<span class="n">u32</span>	<span class="n">l</span><span class="p">[</span><span class="mh">0x100000</span> <span class="o">/</span> <span class="mi">4</span><span class="p">];</span>
		<span class="n">u64</span>	<span class="n">d</span><span class="p">[</span><span class="mh">0x100000</span> <span class="o">/</span> <span class="mi">8</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">b_devio_raw</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>				<span class="cm">/* 0x200000 */</span>

	<span class="cm">/* b_devio macro is a bit strange; it reflects the</span>
<span class="cm">	 * fact that the Bridge ASIC provides 2M for the</span>
<span class="cm">	 * first two DevIO windows and 1M for the other six.</span>
<span class="cm">	 */</span>
<span class="cp">#define b_devio(n)	b_devio_raw[((n)&lt;2)?(n*2):(n+2)]</span>

	<span class="cm">/* External Flash Proms 1,0 0xC00000-0xFFFFFF */</span>
	<span class="k">union</span> <span class="p">{</span>		<span class="cm">/* make all access sizes available. */</span>
		<span class="n">u8</span>	<span class="n">c</span><span class="p">[</span><span class="mh">0x400000</span> <span class="o">/</span> <span class="mi">1</span><span class="p">];</span>	<span class="cm">/* read-only */</span>
		<span class="n">u16</span>	<span class="n">s</span><span class="p">[</span><span class="mh">0x400000</span> <span class="o">/</span> <span class="mi">2</span><span class="p">];</span>	<span class="cm">/* read-write */</span>
		<span class="n">u32</span>	<span class="n">l</span><span class="p">[</span><span class="mh">0x400000</span> <span class="o">/</span> <span class="mi">4</span><span class="p">];</span>	<span class="cm">/* read-only */</span>
		<span class="n">u64</span>	<span class="n">d</span><span class="p">[</span><span class="mh">0x400000</span> <span class="o">/</span> <span class="mi">8</span><span class="p">];</span>	<span class="cm">/* read-only */</span>
	<span class="p">}</span> <span class="n">b_external_flash</span><span class="p">;</span>			<span class="cm">/* 0xC00000 */</span>
<span class="p">}</span> <span class="n">bridge_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Field formats for Error Command Word and Auxiliary Error Command Word</span>
<span class="cm"> * of bridge.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">bridge_err_cmdword_s</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">u32</span>		<span class="n">cmd_word</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u32</span>	<span class="n">didn</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span>		<span class="cm">/* Destination ID */</span>
				<span class="nl">sidn:</span><span class="mi">4</span><span class="p">,</span>		<span class="cm">/* Source ID	  */</span>
				<span class="nl">pactyp:</span><span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Packet type	  */</span>
				<span class="nl">tnum:</span><span class="mi">5</span><span class="p">,</span>		<span class="cm">/* Trans Number	  */</span>
				<span class="nl">coh:</span><span class="mi">1</span><span class="p">,</span>		<span class="cm">/* Coh Transacti  */</span>
				<span class="nl">ds:</span><span class="mi">2</span><span class="p">,</span>		<span class="cm">/* Data size	  */</span>
				<span class="nl">gbr:</span><span class="mi">1</span><span class="p">,</span>		<span class="cm">/* GBR enable	  */</span>
				<span class="nl">vbpm:</span><span class="mi">1</span><span class="p">,</span>		<span class="cm">/* VBPM message	  */</span>
				<span class="nl">error:</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Error occurred  */</span>
				<span class="nl">barr:</span><span class="mi">1</span><span class="p">,</span>		<span class="cm">/* Barrier op	  */</span>
				<span class="nl">rsvd:</span><span class="mi">8</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">berr_st</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">berr_un</span><span class="p">;</span>
<span class="p">}</span> <span class="n">bridge_err_cmdword_t</span><span class="p">;</span>

<span class="cp">#define berr_field	berr_un.berr_st</span>
<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * The values of these macros can and should be crosschecked</span>
<span class="cm"> * regularly against the offsets of the like-named fields</span>
<span class="cm"> * within the &quot;bridge_t&quot; structure above.</span>
<span class="cm"> */</span>

<span class="cm">/* Byte offset macros for Bridge internal registers */</span>

<span class="cp">#define BRIDGE_WID_ID		WIDGET_ID</span>
<span class="cp">#define BRIDGE_WID_STAT		WIDGET_STATUS</span>
<span class="cp">#define BRIDGE_WID_ERR_UPPER	WIDGET_ERR_UPPER_ADDR</span>
<span class="cp">#define BRIDGE_WID_ERR_LOWER	WIDGET_ERR_LOWER_ADDR</span>
<span class="cp">#define BRIDGE_WID_CONTROL	WIDGET_CONTROL</span>
<span class="cp">#define BRIDGE_WID_REQ_TIMEOUT	WIDGET_REQ_TIMEOUT</span>
<span class="cp">#define BRIDGE_WID_INT_UPPER	WIDGET_INTDEST_UPPER_ADDR</span>
<span class="cp">#define BRIDGE_WID_INT_LOWER	WIDGET_INTDEST_LOWER_ADDR</span>
<span class="cp">#define BRIDGE_WID_ERR_CMDWORD	WIDGET_ERR_CMD_WORD</span>
<span class="cp">#define BRIDGE_WID_LLP		WIDGET_LLP_CFG</span>
<span class="cp">#define BRIDGE_WID_TFLUSH	WIDGET_TFLUSH</span>

<span class="cp">#define BRIDGE_WID_AUX_ERR	0x00005C	</span><span class="cm">/* Aux Error Command Word */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_WID_RESP_UPPER	0x000064	</span><span class="cm">/* Response Buf Upper Addr */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_WID_RESP_LOWER	0x00006C	</span><span class="cm">/* Response Buf Lower Addr */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_WID_TST_PIN_CTRL 0x000074	</span><span class="cm">/* Test pin control */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_DIR_MAP		0x000084	</span><span class="cm">/* Direct Map reg */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_RAM_PERR		0x000094	</span><span class="cm">/* SSRAM Parity Error */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_ARB		0x0000A4	</span><span class="cm">/* Arbitration Priority reg */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_NIC		0x0000B4	</span><span class="cm">/* Number In A Can */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_BUS_TIMEOUT	0x0000C4	</span><span class="cm">/* Bus Timeout Register */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_PCI_BUS_TIMEOUT	BRIDGE_BUS_TIMEOUT</span>
<span class="cp">#define BRIDGE_PCI_CFG		0x0000CC	</span><span class="cm">/* PCI Type 1 Config reg */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_PCI_ERR_UPPER	0x0000D4	</span><span class="cm">/* PCI error Upper Addr */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_PCI_ERR_LOWER	0x0000DC	</span><span class="cm">/* PCI error Lower Addr */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_INT_STATUS	0x000104	</span><span class="cm">/* Interrupt Status */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_INT_ENABLE	0x00010C	</span><span class="cm">/* Interrupt Enables */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_INT_RST_STAT	0x000114	</span><span class="cm">/* Reset Intr Status */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_INT_MODE		0x00011C	</span><span class="cm">/* Interrupt Mode */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_INT_DEVICE	0x000124	</span><span class="cm">/* Interrupt Device */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_INT_HOST_ERR	0x00012C	</span><span class="cm">/* Host Error Field */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_INT_ADDR0	0x000134	</span><span class="cm">/* Host Address Reg */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_INT_ADDR_OFF	0x000008	</span><span class="cm">/* Host Addr offset (1..7) */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_INT_ADDR(x)	(BRIDGE_INT_ADDR0+(x)*BRIDGE_INT_ADDR_OFF)</span>

<span class="cp">#define BRIDGE_DEVICE0		0x000204	</span><span class="cm">/* Device 0 */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_DEVICE_OFF	0x000008	</span><span class="cm">/* Device offset (1..7) */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_DEVICE(x)	(BRIDGE_DEVICE0+(x)*BRIDGE_DEVICE_OFF)</span>

<span class="cp">#define BRIDGE_WR_REQ_BUF0	0x000244	</span><span class="cm">/* Write Request Buffer 0 */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_WR_REQ_BUF_OFF	0x000008	</span><span class="cm">/* Buffer Offset (1..7) */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_WR_REQ_BUF(x)	(BRIDGE_WR_REQ_BUF0+(x)*BRIDGE_WR_REQ_BUF_OFF)</span>

<span class="cp">#define BRIDGE_EVEN_RESP	0x000284	</span><span class="cm">/* Even Device Response Buf */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_ODD_RESP		0x00028C	</span><span class="cm">/* Odd Device Response Buf */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_RESP_STATUS	0x000294	</span><span class="cm">/* Read Response Status reg */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_RESP_CLEAR	0x00029C	</span><span class="cm">/* Read Response Clear reg */</span><span class="cp"></span>

<span class="cm">/* Byte offset macros for Bridge I/O space */</span>

<span class="cp">#define BRIDGE_ATE_RAM		0x00010000	</span><span class="cm">/* Internal Addr Xlat Ram */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_TYPE0_CFG_DEV0	0x00020000	</span><span class="cm">/* Type 0 Cfg, Device 0 */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_TYPE0_CFG_SLOT_OFF	0x00001000	</span><span class="cm">/* Type 0 Cfg Slot Offset (1..7) */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_TYPE0_CFG_FUNC_OFF	0x00000100	</span><span class="cm">/* Type 0 Cfg Func Offset (1..7) */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_TYPE0_CFG_DEV(s)		(BRIDGE_TYPE0_CFG_DEV0+\</span>
<span class="cp">					 (s)*BRIDGE_TYPE0_CFG_SLOT_OFF)</span>
<span class="cp">#define BRIDGE_TYPE0_CFG_DEVF(s, f)	(BRIDGE_TYPE0_CFG_DEV0+\</span>
<span class="cp">					 (s)*BRIDGE_TYPE0_CFG_SLOT_OFF+\</span>
<span class="cp">					 (f)*BRIDGE_TYPE0_CFG_FUNC_OFF)</span>

<span class="cp">#define BRIDGE_TYPE1_CFG	0x00028000	</span><span class="cm">/* Type 1 Cfg space */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_PCI_IACK		0x00030000	</span><span class="cm">/* PCI Interrupt Ack */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_EXT_SSRAM	0x00080000	</span><span class="cm">/* Extern SSRAM (ATE) */</span><span class="cp"></span>

<span class="cm">/* Byte offset macros for Bridge device IO spaces */</span>

<span class="cp">#define BRIDGE_DEV_CNT		8	</span><span class="cm">/* Up to 8 devices per bridge */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_DEVIO0		0x00200000	</span><span class="cm">/* Device IO 0 Addr */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_DEVIO1		0x00400000	</span><span class="cm">/* Device IO 1 Addr */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_DEVIO2		0x00600000	</span><span class="cm">/* Device IO 2 Addr */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_DEVIO_OFF	0x00100000	</span><span class="cm">/* Device IO Offset (3..7) */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_DEVIO_2MB	0x00200000	</span><span class="cm">/* Device IO Offset (0..1) */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_DEVIO_1MB	0x00100000	</span><span class="cm">/* Device IO Offset (2..7) */</span><span class="cp"></span>

<span class="cp">#define BRIDGE_DEVIO(x)		((x)&lt;=1 ? BRIDGE_DEVIO0+(x)*BRIDGE_DEVIO_2MB : BRIDGE_DEVIO2+((x)-2)*BRIDGE_DEVIO_1MB)</span>

<span class="cp">#define BRIDGE_EXTERNAL_FLASH	0x00C00000	</span><span class="cm">/* External Flash PROMS */</span><span class="cp"></span>

<span class="cm">/* ========================================================================</span>
<span class="cm"> *    Bridge register bit field definitions</span>
<span class="cm"> */</span>

<span class="cm">/* Widget part number of bridge */</span>
<span class="cp">#define BRIDGE_WIDGET_PART_NUM		0xc002</span>
<span class="cp">#define XBRIDGE_WIDGET_PART_NUM		0xd002</span>

<span class="cm">/* Manufacturer of bridge */</span>
<span class="cp">#define BRIDGE_WIDGET_MFGR_NUM		0x036</span>
<span class="cp">#define XBRIDGE_WIDGET_MFGR_NUM		0x024</span>

<span class="cm">/* Revision numbers for known Bridge revisions */</span>
<span class="cp">#define BRIDGE_REV_A			0x1</span>
<span class="cp">#define BRIDGE_REV_B			0x2</span>
<span class="cp">#define BRIDGE_REV_C			0x3</span>
<span class="cp">#define	BRIDGE_REV_D			0x4</span>

<span class="cm">/* Bridge widget status register bits definition */</span>

<span class="cp">#define BRIDGE_STAT_LLP_REC_CNT		(0xFFu &lt;&lt; 24)</span>
<span class="cp">#define BRIDGE_STAT_LLP_TX_CNT		(0xFF &lt;&lt; 16)</span>
<span class="cp">#define BRIDGE_STAT_FLASH_SELECT	(0x1 &lt;&lt; 6)</span>
<span class="cp">#define BRIDGE_STAT_PCI_GIO_N		(0x1 &lt;&lt; 5)</span>
<span class="cp">#define BRIDGE_STAT_PENDING		(0x1F &lt;&lt; 0)</span>

<span class="cm">/* Bridge widget control register bits definition */</span>
<span class="cp">#define BRIDGE_CTRL_FLASH_WR_EN		(0x1ul &lt;&lt; 31)</span>
<span class="cp">#define BRIDGE_CTRL_EN_CLK50		(0x1 &lt;&lt; 30)</span>
<span class="cp">#define BRIDGE_CTRL_EN_CLK40		(0x1 &lt;&lt; 29)</span>
<span class="cp">#define BRIDGE_CTRL_EN_CLK33		(0x1 &lt;&lt; 28)</span>
<span class="cp">#define BRIDGE_CTRL_RST(n)		((n) &lt;&lt; 24)</span>
<span class="cp">#define BRIDGE_CTRL_RST_MASK		(BRIDGE_CTRL_RST(0xF))</span>
<span class="cp">#define BRIDGE_CTRL_RST_PIN(x)		(BRIDGE_CTRL_RST(0x1 &lt;&lt; (x)))</span>
<span class="cp">#define BRIDGE_CTRL_IO_SWAP		(0x1 &lt;&lt; 23)</span>
<span class="cp">#define BRIDGE_CTRL_MEM_SWAP		(0x1 &lt;&lt; 22)</span>
<span class="cp">#define BRIDGE_CTRL_PAGE_SIZE		(0x1 &lt;&lt; 21)</span>
<span class="cp">#define BRIDGE_CTRL_SS_PAR_BAD		(0x1 &lt;&lt; 20)</span>
<span class="cp">#define BRIDGE_CTRL_SS_PAR_EN		(0x1 &lt;&lt; 19)</span>
<span class="cp">#define BRIDGE_CTRL_SSRAM_SIZE(n)	((n) &lt;&lt; 17)</span>
<span class="cp">#define BRIDGE_CTRL_SSRAM_SIZE_MASK	(BRIDGE_CTRL_SSRAM_SIZE(0x3))</span>
<span class="cp">#define BRIDGE_CTRL_SSRAM_512K		(BRIDGE_CTRL_SSRAM_SIZE(0x3))</span>
<span class="cp">#define BRIDGE_CTRL_SSRAM_128K		(BRIDGE_CTRL_SSRAM_SIZE(0x2))</span>
<span class="cp">#define BRIDGE_CTRL_SSRAM_64K		(BRIDGE_CTRL_SSRAM_SIZE(0x1))</span>
<span class="cp">#define BRIDGE_CTRL_SSRAM_1K		(BRIDGE_CTRL_SSRAM_SIZE(0x0))</span>
<span class="cp">#define BRIDGE_CTRL_F_BAD_PKT		(0x1 &lt;&lt; 16)</span>
<span class="cp">#define BRIDGE_CTRL_LLP_XBAR_CRD(n)	((n) &lt;&lt; 12)</span>
<span class="cp">#define BRIDGE_CTRL_LLP_XBAR_CRD_MASK	(BRIDGE_CTRL_LLP_XBAR_CRD(0xf))</span>
<span class="cp">#define BRIDGE_CTRL_CLR_RLLP_CNT	(0x1 &lt;&lt; 11)</span>
<span class="cp">#define BRIDGE_CTRL_CLR_TLLP_CNT	(0x1 &lt;&lt; 10)</span>
<span class="cp">#define BRIDGE_CTRL_SYS_END		(0x1 &lt;&lt; 9)</span>
<span class="cp">#define BRIDGE_CTRL_MAX_TRANS(n)	((n) &lt;&lt; 4)</span>
<span class="cp">#define BRIDGE_CTRL_MAX_TRANS_MASK	(BRIDGE_CTRL_MAX_TRANS(0x1f))</span>
<span class="cp">#define BRIDGE_CTRL_WIDGET_ID(n)	((n) &lt;&lt; 0)</span>
<span class="cp">#define BRIDGE_CTRL_WIDGET_ID_MASK	(BRIDGE_CTRL_WIDGET_ID(0xf))</span>

<span class="cm">/* Bridge Response buffer Error Upper Register bit fields definition */</span>
<span class="cp">#define BRIDGE_RESP_ERRUPPR_DEVNUM_SHFT (20)</span>
<span class="cp">#define BRIDGE_RESP_ERRUPPR_DEVNUM_MASK (0x7 &lt;&lt; BRIDGE_RESP_ERRUPPR_DEVNUM_SHFT)</span>
<span class="cp">#define BRIDGE_RESP_ERRUPPR_BUFNUM_SHFT (16)</span>
<span class="cp">#define BRIDGE_RESP_ERRUPPR_BUFNUM_MASK (0xF &lt;&lt; BRIDGE_RESP_ERRUPPR_BUFNUM_SHFT)</span>
<span class="cp">#define BRIDGE_RESP_ERRRUPPR_BUFMASK	(0xFFFF)</span>

<span class="cp">#define BRIDGE_RESP_ERRUPPR_BUFNUM(x)	\</span>
<span class="cp">			(((x) &amp; BRIDGE_RESP_ERRUPPR_BUFNUM_MASK) &gt;&gt; \</span>
<span class="cp">				BRIDGE_RESP_ERRUPPR_BUFNUM_SHFT)</span>

<span class="cp">#define BRIDGE_RESP_ERRUPPR_DEVICE(x)	\</span>
<span class="cp">			(((x) &amp;	 BRIDGE_RESP_ERRUPPR_DEVNUM_MASK) &gt;&gt; \</span>
<span class="cp">				 BRIDGE_RESP_ERRUPPR_DEVNUM_SHFT)</span>

<span class="cm">/* Bridge direct mapping register bits definition */</span>
<span class="cp">#define BRIDGE_DIRMAP_W_ID_SHFT		20</span>
<span class="cp">#define BRIDGE_DIRMAP_W_ID		(0xf &lt;&lt; BRIDGE_DIRMAP_W_ID_SHFT)</span>
<span class="cp">#define BRIDGE_DIRMAP_RMF_64		(0x1 &lt;&lt; 18)</span>
<span class="cp">#define BRIDGE_DIRMAP_ADD512		(0x1 &lt;&lt; 17)</span>
<span class="cp">#define BRIDGE_DIRMAP_OFF		(0x1ffff &lt;&lt; 0)</span>
<span class="cp">#define BRIDGE_DIRMAP_OFF_ADDRSHFT	(31)	</span><span class="cm">/* lsbit of DIRMAP_OFF is xtalk address bit 31 */</span><span class="cp"></span>

<span class="cm">/* Bridge Arbitration register bits definition */</span>
<span class="cp">#define BRIDGE_ARB_REQ_WAIT_TICK(x)	((x) &lt;&lt; 16)</span>
<span class="cp">#define BRIDGE_ARB_REQ_WAIT_TICK_MASK	BRIDGE_ARB_REQ_WAIT_TICK(0x3)</span>
<span class="cp">#define BRIDGE_ARB_REQ_WAIT_EN(x)	((x) &lt;&lt; 8)</span>
<span class="cp">#define BRIDGE_ARB_REQ_WAIT_EN_MASK	BRIDGE_ARB_REQ_WAIT_EN(0xff)</span>
<span class="cp">#define BRIDGE_ARB_FREEZE_GNT		(1 &lt;&lt; 6)</span>
<span class="cp">#define BRIDGE_ARB_HPRI_RING_B2		(1 &lt;&lt; 5)</span>
<span class="cp">#define BRIDGE_ARB_HPRI_RING_B1		(1 &lt;&lt; 4)</span>
<span class="cp">#define BRIDGE_ARB_HPRI_RING_B0		(1 &lt;&lt; 3)</span>
<span class="cp">#define BRIDGE_ARB_LPRI_RING_B2		(1 &lt;&lt; 2)</span>
<span class="cp">#define BRIDGE_ARB_LPRI_RING_B1		(1 &lt;&lt; 1)</span>
<span class="cp">#define BRIDGE_ARB_LPRI_RING_B0		(1 &lt;&lt; 0)</span>

<span class="cm">/* Bridge Bus time-out register bits definition */</span>
<span class="cp">#define BRIDGE_BUS_PCI_RETRY_HLD(x)	((x) &lt;&lt; 16)</span>
<span class="cp">#define BRIDGE_BUS_PCI_RETRY_HLD_MASK	BRIDGE_BUS_PCI_RETRY_HLD(0x1f)</span>
<span class="cp">#define BRIDGE_BUS_GIO_TIMEOUT		(1 &lt;&lt; 12)</span>
<span class="cp">#define BRIDGE_BUS_PCI_RETRY_CNT(x)	((x) &lt;&lt; 0)</span>
<span class="cp">#define BRIDGE_BUS_PCI_RETRY_MASK	BRIDGE_BUS_PCI_RETRY_CNT(0x3ff)</span>

<span class="cm">/* Bridge interrupt status register bits definition */</span>
<span class="cp">#define BRIDGE_ISR_MULTI_ERR		(0x1u &lt;&lt; 31)</span>
<span class="cp">#define BRIDGE_ISR_PMU_ESIZE_FAULT	(0x1 &lt;&lt; 30)</span>
<span class="cp">#define BRIDGE_ISR_UNEXP_RESP		(0x1 &lt;&lt; 29)</span>
<span class="cp">#define BRIDGE_ISR_BAD_XRESP_PKT	(0x1 &lt;&lt; 28)</span>
<span class="cp">#define BRIDGE_ISR_BAD_XREQ_PKT		(0x1 &lt;&lt; 27)</span>
<span class="cp">#define BRIDGE_ISR_RESP_XTLK_ERR	(0x1 &lt;&lt; 26)</span>
<span class="cp">#define BRIDGE_ISR_REQ_XTLK_ERR		(0x1 &lt;&lt; 25)</span>
<span class="cp">#define BRIDGE_ISR_INVLD_ADDR		(0x1 &lt;&lt; 24)</span>
<span class="cp">#define BRIDGE_ISR_UNSUPPORTED_XOP	(0x1 &lt;&lt; 23)</span>
<span class="cp">#define BRIDGE_ISR_XREQ_FIFO_OFLOW	(0x1 &lt;&lt; 22)</span>
<span class="cp">#define BRIDGE_ISR_LLP_REC_SNERR	(0x1 &lt;&lt; 21)</span>
<span class="cp">#define BRIDGE_ISR_LLP_REC_CBERR	(0x1 &lt;&lt; 20)</span>
<span class="cp">#define BRIDGE_ISR_LLP_RCTY		(0x1 &lt;&lt; 19)</span>
<span class="cp">#define BRIDGE_ISR_LLP_TX_RETRY		(0x1 &lt;&lt; 18)</span>
<span class="cp">#define BRIDGE_ISR_LLP_TCTY		(0x1 &lt;&lt; 17)</span>
<span class="cp">#define BRIDGE_ISR_SSRAM_PERR		(0x1 &lt;&lt; 16)</span>
<span class="cp">#define BRIDGE_ISR_PCI_ABORT		(0x1 &lt;&lt; 15)</span>
<span class="cp">#define BRIDGE_ISR_PCI_PARITY		(0x1 &lt;&lt; 14)</span>
<span class="cp">#define BRIDGE_ISR_PCI_SERR		(0x1 &lt;&lt; 13)</span>
<span class="cp">#define BRIDGE_ISR_PCI_PERR		(0x1 &lt;&lt; 12)</span>
<span class="cp">#define BRIDGE_ISR_PCI_MST_TIMEOUT	(0x1 &lt;&lt; 11)</span>
<span class="cp">#define BRIDGE_ISR_GIO_MST_TIMEOUT	BRIDGE_ISR_PCI_MST_TIMEOUT</span>
<span class="cp">#define BRIDGE_ISR_PCI_RETRY_CNT	(0x1 &lt;&lt; 10)</span>
<span class="cp">#define BRIDGE_ISR_XREAD_REQ_TIMEOUT	(0x1 &lt;&lt; 9)</span>
<span class="cp">#define BRIDGE_ISR_GIO_B_ENBL_ERR	(0x1 &lt;&lt; 8)</span>
<span class="cp">#define BRIDGE_ISR_INT_MSK		(0xff &lt;&lt; 0)</span>
<span class="cp">#define BRIDGE_ISR_INT(x)		(0x1 &lt;&lt; (x))</span>

<span class="cp">#define BRIDGE_ISR_LINK_ERROR		\</span>
<span class="cp">		(BRIDGE_ISR_LLP_REC_SNERR|BRIDGE_ISR_LLP_REC_CBERR|	\</span>
<span class="cp">		 BRIDGE_ISR_LLP_RCTY|BRIDGE_ISR_LLP_TX_RETRY|		\</span>
<span class="cp">		 BRIDGE_ISR_LLP_TCTY)</span>

<span class="cp">#define BRIDGE_ISR_PCIBUS_PIOERR	\</span>
<span class="cp">		(BRIDGE_ISR_PCI_MST_TIMEOUT|BRIDGE_ISR_PCI_ABORT)</span>

<span class="cp">#define BRIDGE_ISR_PCIBUS_ERROR		\</span>
<span class="cp">		(BRIDGE_ISR_PCIBUS_PIOERR|BRIDGE_ISR_PCI_PERR|		\</span>
<span class="cp">		 BRIDGE_ISR_PCI_SERR|BRIDGE_ISR_PCI_RETRY_CNT|		\</span>
<span class="cp">		 BRIDGE_ISR_PCI_PARITY)</span>

<span class="cp">#define BRIDGE_ISR_XTALK_ERROR		\</span>
<span class="cp">		(BRIDGE_ISR_XREAD_REQ_TIMEOUT|BRIDGE_ISR_XREQ_FIFO_OFLOW|\</span>
<span class="cp">		 BRIDGE_ISR_UNSUPPORTED_XOP|BRIDGE_ISR_INVLD_ADDR|	\</span>
<span class="cp">		 BRIDGE_ISR_REQ_XTLK_ERR|BRIDGE_ISR_RESP_XTLK_ERR|	\</span>
<span class="cp">		 BRIDGE_ISR_BAD_XREQ_PKT|BRIDGE_ISR_BAD_XRESP_PKT|	\</span>
<span class="cp">		 BRIDGE_ISR_UNEXP_RESP)</span>

<span class="cp">#define BRIDGE_ISR_ERRORS		\</span>
<span class="cp">		(BRIDGE_ISR_LINK_ERROR|BRIDGE_ISR_PCIBUS_ERROR|		\</span>
<span class="cp">		 BRIDGE_ISR_XTALK_ERROR|BRIDGE_ISR_SSRAM_PERR|		\</span>
<span class="cp">		 BRIDGE_ISR_PMU_ESIZE_FAULT)</span>

<span class="cm">/*</span>
<span class="cm"> * List of Errors which are fatal and kill the system</span>
<span class="cm"> */</span>
<span class="cp">#define BRIDGE_ISR_ERROR_FATAL		\</span>
<span class="cp">		((BRIDGE_ISR_XTALK_ERROR &amp; ~BRIDGE_ISR_XREAD_REQ_TIMEOUT)|\</span>
<span class="cp">		 BRIDGE_ISR_PCI_SERR|BRIDGE_ISR_PCI_PARITY )</span>

<span class="cp">#define BRIDGE_ISR_ERROR_DUMP		\</span>
<span class="cp">		(BRIDGE_ISR_PCIBUS_ERROR|BRIDGE_ISR_PMU_ESIZE_FAULT|	\</span>
<span class="cp">		 BRIDGE_ISR_XTALK_ERROR|BRIDGE_ISR_SSRAM_PERR)</span>

<span class="cm">/* Bridge interrupt enable register bits definition */</span>
<span class="cp">#define BRIDGE_IMR_UNEXP_RESP		BRIDGE_ISR_UNEXP_RESP</span>
<span class="cp">#define BRIDGE_IMR_PMU_ESIZE_FAULT	BRIDGE_ISR_PMU_ESIZE_FAULT</span>
<span class="cp">#define BRIDGE_IMR_BAD_XRESP_PKT	BRIDGE_ISR_BAD_XRESP_PKT</span>
<span class="cp">#define BRIDGE_IMR_BAD_XREQ_PKT		BRIDGE_ISR_BAD_XREQ_PKT</span>
<span class="cp">#define BRIDGE_IMR_RESP_XTLK_ERR	BRIDGE_ISR_RESP_XTLK_ERR</span>
<span class="cp">#define BRIDGE_IMR_REQ_XTLK_ERR		BRIDGE_ISR_REQ_XTLK_ERR</span>
<span class="cp">#define BRIDGE_IMR_INVLD_ADDR		BRIDGE_ISR_INVLD_ADDR</span>
<span class="cp">#define BRIDGE_IMR_UNSUPPORTED_XOP	BRIDGE_ISR_UNSUPPORTED_XOP</span>
<span class="cp">#define BRIDGE_IMR_XREQ_FIFO_OFLOW	BRIDGE_ISR_XREQ_FIFO_OFLOW</span>
<span class="cp">#define BRIDGE_IMR_LLP_REC_SNERR	BRIDGE_ISR_LLP_REC_SNERR</span>
<span class="cp">#define BRIDGE_IMR_LLP_REC_CBERR	BRIDGE_ISR_LLP_REC_CBERR</span>
<span class="cp">#define BRIDGE_IMR_LLP_RCTY		BRIDGE_ISR_LLP_RCTY</span>
<span class="cp">#define BRIDGE_IMR_LLP_TX_RETRY		BRIDGE_ISR_LLP_TX_RETRY</span>
<span class="cp">#define BRIDGE_IMR_LLP_TCTY		BRIDGE_ISR_LLP_TCTY</span>
<span class="cp">#define BRIDGE_IMR_SSRAM_PERR		BRIDGE_ISR_SSRAM_PERR</span>
<span class="cp">#define BRIDGE_IMR_PCI_ABORT		BRIDGE_ISR_PCI_ABORT</span>
<span class="cp">#define BRIDGE_IMR_PCI_PARITY		BRIDGE_ISR_PCI_PARITY</span>
<span class="cp">#define BRIDGE_IMR_PCI_SERR		BRIDGE_ISR_PCI_SERR</span>
<span class="cp">#define BRIDGE_IMR_PCI_PERR		BRIDGE_ISR_PCI_PERR</span>
<span class="cp">#define BRIDGE_IMR_PCI_MST_TIMEOUT	BRIDGE_ISR_PCI_MST_TIMEOUT</span>
<span class="cp">#define BRIDGE_IMR_GIO_MST_TIMEOUT	BRIDGE_ISR_GIO_MST_TIMEOUT</span>
<span class="cp">#define BRIDGE_IMR_PCI_RETRY_CNT	BRIDGE_ISR_PCI_RETRY_CNT</span>
<span class="cp">#define BRIDGE_IMR_XREAD_REQ_TIMEOUT	BRIDGE_ISR_XREAD_REQ_TIMEOUT</span>
<span class="cp">#define BRIDGE_IMR_GIO_B_ENBL_ERR	BRIDGE_ISR_GIO_B_ENBL_ERR</span>
<span class="cp">#define BRIDGE_IMR_INT_MSK		BRIDGE_ISR_INT_MSK</span>
<span class="cp">#define BRIDGE_IMR_INT(x)		BRIDGE_ISR_INT(x)</span>

<span class="cm">/* Bridge interrupt reset register bits definition */</span>
<span class="cp">#define BRIDGE_IRR_MULTI_CLR		(0x1 &lt;&lt; 6)</span>
<span class="cp">#define BRIDGE_IRR_CRP_GRP_CLR		(0x1 &lt;&lt; 5)</span>
<span class="cp">#define BRIDGE_IRR_RESP_BUF_GRP_CLR	(0x1 &lt;&lt; 4)</span>
<span class="cp">#define BRIDGE_IRR_REQ_DSP_GRP_CLR	(0x1 &lt;&lt; 3)</span>
<span class="cp">#define BRIDGE_IRR_LLP_GRP_CLR		(0x1 &lt;&lt; 2)</span>
<span class="cp">#define BRIDGE_IRR_SSRAM_GRP_CLR	(0x1 &lt;&lt; 1)</span>
<span class="cp">#define BRIDGE_IRR_PCI_GRP_CLR		(0x1 &lt;&lt; 0)</span>
<span class="cp">#define BRIDGE_IRR_GIO_GRP_CLR		(0x1 &lt;&lt; 0)</span>
<span class="cp">#define BRIDGE_IRR_ALL_CLR		0x7f</span>

<span class="cp">#define BRIDGE_IRR_CRP_GRP		(BRIDGE_ISR_UNEXP_RESP | \</span>
<span class="cp">					 BRIDGE_ISR_XREQ_FIFO_OFLOW)</span>
<span class="cp">#define BRIDGE_IRR_RESP_BUF_GRP		(BRIDGE_ISR_BAD_XRESP_PKT | \</span>
<span class="cp">					 BRIDGE_ISR_RESP_XTLK_ERR | \</span>
<span class="cp">					 BRIDGE_ISR_XREAD_REQ_TIMEOUT)</span>
<span class="cp">#define BRIDGE_IRR_REQ_DSP_GRP		(BRIDGE_ISR_UNSUPPORTED_XOP | \</span>
<span class="cp">					 BRIDGE_ISR_BAD_XREQ_PKT | \</span>
<span class="cp">					 BRIDGE_ISR_REQ_XTLK_ERR | \</span>
<span class="cp">					 BRIDGE_ISR_INVLD_ADDR)</span>
<span class="cp">#define BRIDGE_IRR_LLP_GRP		(BRIDGE_ISR_LLP_REC_SNERR | \</span>
<span class="cp">					 BRIDGE_ISR_LLP_REC_CBERR | \</span>
<span class="cp">					 BRIDGE_ISR_LLP_RCTY | \</span>
<span class="cp">					 BRIDGE_ISR_LLP_TX_RETRY | \</span>
<span class="cp">					 BRIDGE_ISR_LLP_TCTY)</span>
<span class="cp">#define BRIDGE_IRR_SSRAM_GRP		(BRIDGE_ISR_SSRAM_PERR | \</span>
<span class="cp">					 BRIDGE_ISR_PMU_ESIZE_FAULT)</span>
<span class="cp">#define BRIDGE_IRR_PCI_GRP		(BRIDGE_ISR_PCI_ABORT | \</span>
<span class="cp">					 BRIDGE_ISR_PCI_PARITY | \</span>
<span class="cp">					 BRIDGE_ISR_PCI_SERR | \</span>
<span class="cp">					 BRIDGE_ISR_PCI_PERR | \</span>
<span class="cp">					 BRIDGE_ISR_PCI_MST_TIMEOUT | \</span>
<span class="cp">					 BRIDGE_ISR_PCI_RETRY_CNT)</span>

<span class="cp">#define BRIDGE_IRR_GIO_GRP		(BRIDGE_ISR_GIO_B_ENBL_ERR | \</span>
<span class="cp">					 BRIDGE_ISR_GIO_MST_TIMEOUT)</span>

<span class="cm">/* Bridge INT_DEV register bits definition */</span>
<span class="cp">#define BRIDGE_INT_DEV_SHFT(n)		((n)*3)</span>
<span class="cp">#define BRIDGE_INT_DEV_MASK(n)		(0x7 &lt;&lt; BRIDGE_INT_DEV_SHFT(n))</span>
<span class="cp">#define BRIDGE_INT_DEV_SET(_dev, _line) (_dev &lt;&lt; BRIDGE_INT_DEV_SHFT(_line))</span>

<span class="cm">/* Bridge interrupt(x) register bits definition */</span>
<span class="cp">#define BRIDGE_INT_ADDR_HOST		0x0003FF00</span>
<span class="cp">#define BRIDGE_INT_ADDR_FLD		0x000000FF</span>

<span class="cp">#define BRIDGE_TMO_PCI_RETRY_HLD_MASK	0x1f0000</span>
<span class="cp">#define BRIDGE_TMO_GIO_TIMEOUT_MASK	0x001000</span>
<span class="cp">#define BRIDGE_TMO_PCI_RETRY_CNT_MASK	0x0003ff</span>

<span class="cp">#define BRIDGE_TMO_PCI_RETRY_CNT_MAX	0x3ff</span>

<span class="cm">/*</span>
<span class="cm"> * The NASID should be shifted by this amount and stored into the</span>
<span class="cm"> * interrupt(x) register.</span>
<span class="cm"> */</span>
<span class="cp">#define BRIDGE_INT_ADDR_NASID_SHFT	8</span>

<span class="cm">/*</span>
<span class="cm"> * The BRIDGE_INT_ADDR_DEST_IO bit should be set to send an interrupt to</span>
<span class="cm"> * memory.</span>
<span class="cm"> */</span>
<span class="cp">#define BRIDGE_INT_ADDR_DEST_IO		(1 &lt;&lt; 17)</span>
<span class="cp">#define BRIDGE_INT_ADDR_DEST_MEM	0</span>
<span class="cp">#define BRIDGE_INT_ADDR_MASK		(1 &lt;&lt; 17)</span>

<span class="cm">/* Bridge device(x) register bits definition */</span>
<span class="cp">#define BRIDGE_DEV_ERR_LOCK_EN		0x10000000</span>
<span class="cp">#define BRIDGE_DEV_PAGE_CHK_DIS		0x08000000</span>
<span class="cp">#define BRIDGE_DEV_FORCE_PCI_PAR	0x04000000</span>
<span class="cp">#define BRIDGE_DEV_VIRTUAL_EN		0x02000000</span>
<span class="cp">#define BRIDGE_DEV_PMU_WRGA_EN		0x01000000</span>
<span class="cp">#define BRIDGE_DEV_DIR_WRGA_EN		0x00800000</span>
<span class="cp">#define BRIDGE_DEV_DEV_SIZE		0x00400000</span>
<span class="cp">#define BRIDGE_DEV_RT			0x00200000</span>
<span class="cp">#define BRIDGE_DEV_SWAP_PMU		0x00100000</span>
<span class="cp">#define BRIDGE_DEV_SWAP_DIR		0x00080000</span>
<span class="cp">#define BRIDGE_DEV_PREF			0x00040000</span>
<span class="cp">#define BRIDGE_DEV_PRECISE		0x00020000</span>
<span class="cp">#define BRIDGE_DEV_COH			0x00010000</span>
<span class="cp">#define BRIDGE_DEV_BARRIER		0x00008000</span>
<span class="cp">#define BRIDGE_DEV_GBR			0x00004000</span>
<span class="cp">#define BRIDGE_DEV_DEV_SWAP		0x00002000</span>
<span class="cp">#define BRIDGE_DEV_DEV_IO_MEM		0x00001000</span>
<span class="cp">#define BRIDGE_DEV_OFF_MASK		0x00000fff</span>
<span class="cp">#define BRIDGE_DEV_OFF_ADDR_SHFT	20</span>

<span class="cp">#define BRIDGE_DEV_PMU_BITS		(BRIDGE_DEV_PMU_WRGA_EN		| \</span>
<span class="cp">					 BRIDGE_DEV_SWAP_PMU)</span>
<span class="cp">#define BRIDGE_DEV_D32_BITS		(BRIDGE_DEV_DIR_WRGA_EN		| \</span>
<span class="cp">					 BRIDGE_DEV_SWAP_DIR		| \</span>
<span class="cp">					 BRIDGE_DEV_PREF		| \</span>
<span class="cp">					 BRIDGE_DEV_PRECISE		| \</span>
<span class="cp">					 BRIDGE_DEV_COH			| \</span>
<span class="cp">					 BRIDGE_DEV_BARRIER)</span>
<span class="cp">#define BRIDGE_DEV_D64_BITS		(BRIDGE_DEV_DIR_WRGA_EN		| \</span>
<span class="cp">					 BRIDGE_DEV_SWAP_DIR		| \</span>
<span class="cp">					 BRIDGE_DEV_COH			| \</span>
<span class="cp">					 BRIDGE_DEV_BARRIER)</span>

<span class="cm">/* Bridge Error Upper register bit field definition */</span>
<span class="cp">#define BRIDGE_ERRUPPR_DEVMASTER	(0x1 &lt;&lt; 20)	</span><span class="cm">/* Device was master */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_ERRUPPR_PCIVDEV		(0x1 &lt;&lt; 19)	</span><span class="cm">/* Virtual Req value */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_ERRUPPR_DEVNUM_SHFT	(16)</span>
<span class="cp">#define BRIDGE_ERRUPPR_DEVNUM_MASK	(0x7 &lt;&lt; BRIDGE_ERRUPPR_DEVNUM_SHFT)</span>
<span class="cp">#define BRIDGE_ERRUPPR_DEVICE(err)	(((err) &gt;&gt; BRIDGE_ERRUPPR_DEVNUM_SHFT) &amp; 0x7)</span>
<span class="cp">#define BRIDGE_ERRUPPR_ADDRMASK		(0xFFFF)</span>

<span class="cm">/* Bridge interrupt mode register bits definition */</span>
<span class="cp">#define BRIDGE_INTMODE_CLR_PKT_EN(x)	(0x1 &lt;&lt; (x))</span>

<span class="cm">/* this should be written to the xbow&#39;s link_control(x) register */</span>
<span class="cp">#define BRIDGE_CREDIT	3</span>

<span class="cm">/* RRB assignment register */</span>
<span class="cp">#define	BRIDGE_RRB_EN	0x8	</span><span class="cm">/* after shifting down */</span><span class="cp"></span>
<span class="cp">#define	BRIDGE_RRB_DEV	0x7	</span><span class="cm">/* after shifting down */</span><span class="cp"></span>
<span class="cp">#define	BRIDGE_RRB_VDEV	0x4	</span><span class="cm">/* after shifting down */</span><span class="cp"></span>
<span class="cp">#define	BRIDGE_RRB_PDEV	0x3	</span><span class="cm">/* after shifting down */</span><span class="cp"></span>

<span class="cm">/* RRB status register */</span>
<span class="cp">#define	BRIDGE_RRB_VALID(r)	(0x00010000&lt;&lt;(r))</span>
<span class="cp">#define	BRIDGE_RRB_INUSE(r)	(0x00000001&lt;&lt;(r))</span>

<span class="cm">/* RRB clear register */</span>
<span class="cp">#define	BRIDGE_RRB_CLEAR(r)	(0x00000001&lt;&lt;(r))</span>

<span class="cm">/* xbox system controller declarations */</span>
<span class="cp">#define XBOX_BRIDGE_WID         8</span>
<span class="cp">#define FLASH_PROM1_BASE        0xE00000 </span><span class="cm">/* To read the xbox sysctlr status */</span><span class="cp"></span>
<span class="cp">#define XBOX_RPS_EXISTS		1 &lt;&lt; 6	 </span><span class="cm">/* RPS bit in status register */</span><span class="cp"></span>
<span class="cp">#define XBOX_RPS_FAIL		1 &lt;&lt; 4	 </span><span class="cm">/* RPS status bit in register */</span><span class="cp"></span>

<span class="cm">/* ========================================================================</span>
<span class="cm"> */</span>
<span class="cm">/*</span>
<span class="cm"> * Macros for Xtalk to Bridge bus (PCI/GIO) PIO</span>
<span class="cm"> * refer to section 4.2.1 of Bridge Spec for xtalk to PCI/GIO PIO mappings</span>
<span class="cm"> */</span>
<span class="cm">/* XTALK addresses that map into Bridge Bus addr space */</span>
<span class="cp">#define BRIDGE_PIO32_XTALK_ALIAS_BASE	0x000040000000L</span>
<span class="cp">#define BRIDGE_PIO32_XTALK_ALIAS_LIMIT	0x00007FFFFFFFL</span>
<span class="cp">#define BRIDGE_PIO64_XTALK_ALIAS_BASE	0x000080000000L</span>
<span class="cp">#define BRIDGE_PIO64_XTALK_ALIAS_LIMIT	0x0000BFFFFFFFL</span>
<span class="cp">#define BRIDGE_PCIIO_XTALK_ALIAS_BASE	0x000100000000L</span>
<span class="cp">#define BRIDGE_PCIIO_XTALK_ALIAS_LIMIT	0x0001FFFFFFFFL</span>

<span class="cm">/* Ranges of PCI bus space that can be accessed via PIO from xtalk */</span>
<span class="cp">#define BRIDGE_MIN_PIO_ADDR_MEM		0x00000000	</span><span class="cm">/* 1G PCI memory space */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_MAX_PIO_ADDR_MEM		0x3fffffff</span>
<span class="cp">#define BRIDGE_MIN_PIO_ADDR_IO		0x00000000	</span><span class="cm">/* 4G PCI IO space */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_MAX_PIO_ADDR_IO		0xffffffff</span>

<span class="cm">/* XTALK addresses that map into PCI addresses */</span>
<span class="cp">#define BRIDGE_PCI_MEM32_BASE		BRIDGE_PIO32_XTALK_ALIAS_BASE</span>
<span class="cp">#define BRIDGE_PCI_MEM32_LIMIT		BRIDGE_PIO32_XTALK_ALIAS_LIMIT</span>
<span class="cp">#define BRIDGE_PCI_MEM64_BASE		BRIDGE_PIO64_XTALK_ALIAS_BASE</span>
<span class="cp">#define BRIDGE_PCI_MEM64_LIMIT		BRIDGE_PIO64_XTALK_ALIAS_LIMIT</span>
<span class="cp">#define BRIDGE_PCI_IO_BASE		BRIDGE_PCIIO_XTALK_ALIAS_BASE</span>
<span class="cp">#define BRIDGE_PCI_IO_LIMIT		BRIDGE_PCIIO_XTALK_ALIAS_LIMIT</span>

<span class="cm">/*</span>
<span class="cm"> * Macros for Bridge bus (PCI/GIO) to Xtalk DMA</span>
<span class="cm"> */</span>
<span class="cm">/* Bridge Bus DMA addresses */</span>
<span class="cp">#define BRIDGE_LOCAL_BASE		0</span>
<span class="cp">#define BRIDGE_DMA_MAPPED_BASE		0x40000000</span>
<span class="cp">#define BRIDGE_DMA_MAPPED_SIZE		0x40000000	</span><span class="cm">/* 1G Bytes */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_DMA_DIRECT_BASE		0x80000000</span>
<span class="cp">#define BRIDGE_DMA_DIRECT_SIZE		0x80000000	</span><span class="cm">/* 2G Bytes */</span><span class="cp"></span>

<span class="cp">#define PCI32_LOCAL_BASE		BRIDGE_LOCAL_BASE</span>

<span class="cm">/* PCI addresses of regions decoded by Bridge for DMA */</span>
<span class="cp">#define PCI32_MAPPED_BASE		BRIDGE_DMA_MAPPED_BASE</span>
<span class="cp">#define PCI32_DIRECT_BASE		BRIDGE_DMA_DIRECT_BASE</span>

<span class="cp">#define IS_PCI32_LOCAL(x)	((ulong_t)(x) &lt; PCI32_MAPPED_BASE)</span>
<span class="cp">#define IS_PCI32_MAPPED(x)	((ulong_t)(x) &lt; PCI32_DIRECT_BASE &amp;&amp; \</span>
<span class="cp">					(ulong_t)(x) &gt;= PCI32_MAPPED_BASE)</span>
<span class="cp">#define IS_PCI32_DIRECT(x)	((ulong_t)(x) &gt;= PCI32_MAPPED_BASE)</span>
<span class="cp">#define IS_PCI64(x)		((ulong_t)(x) &gt;= PCI64_BASE)</span>

<span class="cm">/*</span>
<span class="cm"> * The GIO address space.</span>
<span class="cm"> */</span>
<span class="cm">/* Xtalk to GIO PIO */</span>
<span class="cp">#define BRIDGE_GIO_MEM32_BASE		BRIDGE_PIO32_XTALK_ALIAS_BASE</span>
<span class="cp">#define BRIDGE_GIO_MEM32_LIMIT		BRIDGE_PIO32_XTALK_ALIAS_LIMIT</span>

<span class="cp">#define GIO_LOCAL_BASE			BRIDGE_LOCAL_BASE</span>

<span class="cm">/* GIO addresses of regions decoded by Bridge for DMA */</span>
<span class="cp">#define GIO_MAPPED_BASE			BRIDGE_DMA_MAPPED_BASE</span>
<span class="cp">#define GIO_DIRECT_BASE			BRIDGE_DMA_DIRECT_BASE</span>

<span class="cp">#define IS_GIO_LOCAL(x)		((ulong_t)(x) &lt; GIO_MAPPED_BASE)</span>
<span class="cp">#define IS_GIO_MAPPED(x)	((ulong_t)(x) &lt; GIO_DIRECT_BASE &amp;&amp; \</span>
<span class="cp">					(ulong_t)(x) &gt;= GIO_MAPPED_BASE)</span>
<span class="cp">#define IS_GIO_DIRECT(x)	((ulong_t)(x) &gt;= GIO_MAPPED_BASE)</span>

<span class="cm">/* PCI to xtalk mapping */</span>

<span class="cm">/* given a DIR_OFF value and a pci/gio 32 bits direct address, determine</span>
<span class="cm"> * which xtalk address is accessed</span>
<span class="cm"> */</span>
<span class="cp">#define BRIDGE_DIRECT_32_SEG_SIZE	BRIDGE_DMA_DIRECT_SIZE</span>
<span class="cp">#define BRIDGE_DIRECT_32_TO_XTALK(dir_off,adr)		\</span>
<span class="cp">	((dir_off) * BRIDGE_DIRECT_32_SEG_SIZE +	\</span>
<span class="cp">		((adr) &amp; (BRIDGE_DIRECT_32_SEG_SIZE - 1)) + PHYS_RAMBASE)</span>

<span class="cm">/* 64-bit address attribute masks */</span>
<span class="cp">#define PCI64_ATTR_TARG_MASK	0xf000000000000000</span>
<span class="cp">#define PCI64_ATTR_TARG_SHFT	60</span>
<span class="cp">#define PCI64_ATTR_PREF		0x0800000000000000</span>
<span class="cp">#define PCI64_ATTR_PREC		0x0400000000000000</span>
<span class="cp">#define PCI64_ATTR_VIRTUAL	0x0200000000000000</span>
<span class="cp">#define PCI64_ATTR_BAR		0x0100000000000000</span>
<span class="cp">#define PCI64_ATTR_RMF_MASK	0x00ff000000000000</span>
<span class="cp">#define PCI64_ATTR_RMF_SHFT	48</span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="cm">/* Address translation entry for mapped pci32 accesses */</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">ate_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">ent</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ate_s</span> <span class="p">{</span>
		<span class="n">u64</span>	<span class="n">rmf</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">addr</span><span class="o">:</span><span class="mi">36</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">targ</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">reserved</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">barrier</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">prefetch</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">precise</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">coherent</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">valid</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">field</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ate_t</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#define ATE_V		0x01</span>
<span class="cp">#define ATE_CO		0x02</span>
<span class="cp">#define ATE_PREC	0x04</span>
<span class="cp">#define ATE_PREF	0x08</span>
<span class="cp">#define ATE_BAR		0x10</span>

<span class="cp">#define ATE_PFNSHIFT		12</span>
<span class="cp">#define ATE_TIDSHIFT		8</span>
<span class="cp">#define ATE_RMFSHIFT		48</span>

<span class="cp">#define mkate(xaddr, xid, attr) ((xaddr) &amp; 0x0000fffffffff000ULL) | \</span>
<span class="cp">				((xid)&lt;&lt;ATE_TIDSHIFT) | \</span>
<span class="cp">				(attr)</span>

<span class="cp">#define BRIDGE_INTERNAL_ATES	128</span>

<span class="k">struct</span> <span class="n">bridge_controller</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pci_controller</span>	<span class="n">pc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">resource</span>		<span class="n">mem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">resource</span>		<span class="n">io</span><span class="p">;</span>
	<span class="n">bridge_t</span>		<span class="o">*</span><span class="n">base</span><span class="p">;</span>
	<span class="n">nasid_t</span>			<span class="n">nasid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">widget_id</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> 		<span class="n">irq_cpu</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">baddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">pci_int</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define BRIDGE_CONTROLLER(bus) \</span>
<span class="cp">	((struct bridge_controller *)((bus)-&gt;sysdata))</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">register_bridge_irq</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">request_bridge_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">bridge_controller</span> <span class="o">*</span><span class="n">bc</span><span class="p">);</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">pci_ops</span> <span class="n">bridge_pci_ops</span><span class="p">;</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_PCI_BRIDGE_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
