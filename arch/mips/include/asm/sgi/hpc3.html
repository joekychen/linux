<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › sgi › hpc3.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>hpc3.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License. See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * hpc3.h: Definitions for SGI HPC3 controller</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1996 David S. Miller</span>
<span class="cm"> * Copyright (C) 1998 Ralf Baechle</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _SGI_HPC3_H</span>
<span class="cp">#define _SGI_HPC3_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;asm/page.h&gt;</span>

<span class="cm">/* An HPC DMA descriptor. */</span>
<span class="k">struct</span> <span class="n">hpc_dma_desc</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">pbuf</span><span class="p">;</span>	<span class="cm">/* physical address of data buffer */</span>
	<span class="n">u32</span> <span class="n">cntinfo</span><span class="p">;</span>	<span class="cm">/* counter and info bits */</span>
<span class="cp">#define HPCDMA_EOX	0x80000000 </span><span class="cm">/* last desc in chain for tx */</span><span class="cp"></span>
<span class="cp">#define HPCDMA_EOR	0x80000000 </span><span class="cm">/* last desc in chain for rx */</span><span class="cp"></span>
<span class="cp">#define HPCDMA_EOXP	0x40000000 </span><span class="cm">/* end of packet for tx */</span><span class="cp"></span>
<span class="cp">#define HPCDMA_EORP	0x40000000 </span><span class="cm">/* end of packet for rx */</span><span class="cp"></span>
<span class="cp">#define HPCDMA_XIE	0x20000000 </span><span class="cm">/* irq generated when at end of this desc */</span><span class="cp"></span>
<span class="cp">#define HPCDMA_XIU	0x01000000 </span><span class="cm">/* Tx buffer in use by CPU. */</span><span class="cp"></span>
<span class="cp">#define HPCDMA_EIPC	0x00ff0000 </span><span class="cm">/* SEEQ ethernet special xternal bytecount */</span><span class="cp"></span>
<span class="cp">#define HPCDMA_ETXD	0x00008000 </span><span class="cm">/* set to one by HPC when packet tx&#39;d */</span><span class="cp"></span>
<span class="cp">#define HPCDMA_OWN	0x00004000 </span><span class="cm">/* Denotes ring buffer ownership on rx */</span><span class="cp"></span>
<span class="cp">#define HPCDMA_BCNT	0x00003fff </span><span class="cm">/* size in bytes of this dma buffer */</span><span class="cp"></span>

	<span class="n">u32</span> <span class="n">pnext</span><span class="p">;</span>	<span class="cm">/* paddr of next hpc_dma_desc if any */</span>
<span class="p">};</span>

<span class="cm">/* The set of regs for each HPC3 PBUS DMA channel. */</span>
<span class="k">struct</span> <span class="n">hpc3_pbus_dmacregs</span> <span class="p">{</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">pbdma_bptr</span><span class="p">;</span>	<span class="cm">/* pbus dma channel buffer ptr */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">pbdma_dptr</span><span class="p">;</span>	<span class="cm">/* pbus dma channel desc ptr */</span>
	<span class="n">u32</span> <span class="n">_unused0</span><span class="p">[</span><span class="mh">0x1000</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">2</span><span class="p">];</span>	<span class="cm">/* padding */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">pbdma_ctrl</span><span class="p">;</span>	<span class="cm">/* pbus dma channel control register has</span>
<span class="cm">					 * copletely different meaning for read</span>
<span class="cm">					 * compared with write */</span>
	<span class="cm">/* read */</span>
<span class="cp">#define HPC3_PDMACTRL_INT	0x00000001 </span><span class="cm">/* interrupt (cleared after read) */</span><span class="cp"></span>
<span class="cp">#define HPC3_PDMACTRL_ISACT	0x00000002 </span><span class="cm">/* channel active */</span><span class="cp"></span>
	<span class="cm">/* write */</span>
<span class="cp">#define HPC3_PDMACTRL_SEL	0x00000002 </span><span class="cm">/* little endian transfer */</span><span class="cp"></span>
<span class="cp">#define HPC3_PDMACTRL_RCV	0x00000004 </span><span class="cm">/* direction is receive */</span><span class="cp"></span>
<span class="cp">#define HPC3_PDMACTRL_FLSH	0x00000008 </span><span class="cm">/* enable flush for receive DMA */</span><span class="cp"></span>
<span class="cp">#define HPC3_PDMACTRL_ACT	0x00000010 </span><span class="cm">/* start dma transfer */</span><span class="cp"></span>
<span class="cp">#define HPC3_PDMACTRL_LD	0x00000020 </span><span class="cm">/* load enable for ACT */</span><span class="cp"></span>
<span class="cp">#define HPC3_PDMACTRL_RT	0x00000040 </span><span class="cm">/* Use realtime GIO bus servicing */</span><span class="cp"></span>
<span class="cp">#define HPC3_PDMACTRL_HW	0x0000ff00 </span><span class="cm">/* DMA High-water mark */</span><span class="cp"></span>
<span class="cp">#define HPC3_PDMACTRL_FB	0x003f0000 </span><span class="cm">/* Ptr to beginning of fifo */</span><span class="cp"></span>
<span class="cp">#define HPC3_PDMACTRL_FE	0x3f000000 </span><span class="cm">/* Ptr to end of fifo */</span><span class="cp"></span>

	<span class="n">u32</span> <span class="n">_unused1</span><span class="p">[</span><span class="mh">0x1000</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>	<span class="cm">/* padding */</span>
<span class="p">};</span>

<span class="cm">/* The HPC3 SCSI registers, this does not include external ones. */</span>
<span class="k">struct</span> <span class="n">hpc3_scsiregs</span> <span class="p">{</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">cbptr</span><span class="p">;</span>	<span class="cm">/* current dma buffer ptr, diagnostic use only */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">ndptr</span><span class="p">;</span>	<span class="cm">/* next dma descriptor ptr */</span>
	<span class="n">u32</span> <span class="n">_unused0</span><span class="p">[</span><span class="mh">0x1000</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">2</span><span class="p">];</span>	<span class="cm">/* padding */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">bcd</span><span class="p">;</span>	<span class="cm">/* byte count info */</span>
<span class="cp">#define HPC3_SBCD_BCNTMSK 0x00003fff </span><span class="cm">/* bytes to transfer from/to memory */</span><span class="cp"></span>
<span class="cp">#define HPC3_SBCD_XIE     0x00004000 </span><span class="cm">/* Send IRQ when done with cur buf */</span><span class="cp"></span>
<span class="cp">#define HPC3_SBCD_EOX     0x00008000 </span><span class="cm">/* Indicates this is last buf in chain */</span><span class="cp"></span>

	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">ctrl</span><span class="p">;</span>    <span class="cm">/* control register */</span>
<span class="cp">#define HPC3_SCTRL_IRQ    0x01 </span><span class="cm">/* IRQ asserted, either dma done or parity */</span><span class="cp"></span>
<span class="cp">#define HPC3_SCTRL_ENDIAN 0x02 </span><span class="cm">/* DMA endian mode, 0=big 1=little */</span><span class="cp"></span>
<span class="cp">#define HPC3_SCTRL_DIR    0x04 </span><span class="cm">/* DMA direction, 1=dev2mem 0=mem2dev */</span><span class="cp"></span>
<span class="cp">#define HPC3_SCTRL_FLUSH  0x08 </span><span class="cm">/* Tells HPC3 to flush scsi fifos */</span><span class="cp"></span>
<span class="cp">#define HPC3_SCTRL_ACTIVE 0x10 </span><span class="cm">/* SCSI DMA channel is active */</span><span class="cp"></span>
<span class="cp">#define HPC3_SCTRL_AMASK  0x20 </span><span class="cm">/* DMA active inhibits PIO */</span><span class="cp"></span>
<span class="cp">#define HPC3_SCTRL_CRESET 0x40 </span><span class="cm">/* Resets dma channel and external controller */</span><span class="cp"></span>
<span class="cp">#define HPC3_SCTRL_PERR   0x80 </span><span class="cm">/* Bad parity on HPC3 iface to scsi controller */</span><span class="cp"></span>

	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">gfptr</span><span class="p">;</span>	<span class="cm">/* current GIO fifo ptr */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">dfptr</span><span class="p">;</span>	<span class="cm">/* current device fifo ptr */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">dconfig</span><span class="p">;</span>	<span class="cm">/* DMA configuration register */</span>
<span class="cp">#define HPC3_SDCFG_HCLK 0x00001 </span><span class="cm">/* Enable DMA half clock mode */</span><span class="cp"></span>
<span class="cp">#define HPC3_SDCFG_D1   0x00006 </span><span class="cm">/* Cycles to spend in D1 state */</span><span class="cp"></span>
<span class="cp">#define HPC3_SDCFG_D2   0x00038 </span><span class="cm">/* Cycles to spend in D2 state */</span><span class="cp"></span>
<span class="cp">#define HPC3_SDCFG_D3   0x001c0 </span><span class="cm">/* Cycles to spend in D3 state */</span><span class="cp"></span>
<span class="cp">#define HPC3_SDCFG_HWAT 0x00e00 </span><span class="cm">/* DMA high water mark */</span><span class="cp"></span>
<span class="cp">#define HPC3_SDCFG_HW   0x01000 </span><span class="cm">/* Enable 16-bit halfword DMA accesses to scsi */</span><span class="cp"></span>
<span class="cp">#define HPC3_SDCFG_SWAP 0x02000 </span><span class="cm">/* Byte swap all DMA accesses */</span><span class="cp"></span>
<span class="cp">#define HPC3_SDCFG_EPAR 0x04000 </span><span class="cm">/* Enable parity checking for DMA */</span><span class="cp"></span>
<span class="cp">#define HPC3_SDCFG_POLL 0x08000 </span><span class="cm">/* hd_dreq polarity control */</span><span class="cp"></span>
<span class="cp">#define HPC3_SDCFG_ERLY 0x30000 </span><span class="cm">/* hd_dreq behavior control bits */</span><span class="cp"></span>

	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">pconfig</span><span class="p">;</span>	<span class="cm">/* PIO configuration register */</span>
<span class="cp">#define HPC3_SPCFG_P3   0x0003 </span><span class="cm">/* Cycles to spend in P3 state */</span><span class="cp"></span>
<span class="cp">#define HPC3_SPCFG_P2W  0x001c </span><span class="cm">/* Cycles to spend in P2 state for writes */</span><span class="cp"></span>
<span class="cp">#define HPC3_SPCFG_P2R  0x01e0 </span><span class="cm">/* Cycles to spend in P2 state for reads */</span><span class="cp"></span>
<span class="cp">#define HPC3_SPCFG_P1   0x0e00 </span><span class="cm">/* Cycles to spend in P1 state */</span><span class="cp"></span>
<span class="cp">#define HPC3_SPCFG_HW   0x1000 </span><span class="cm">/* Enable 16-bit halfword PIO accesses to scsi */</span><span class="cp"></span>
<span class="cp">#define HPC3_SPCFG_SWAP 0x2000 </span><span class="cm">/* Byte swap all PIO accesses */</span><span class="cp"></span>
<span class="cp">#define HPC3_SPCFG_EPAR 0x4000 </span><span class="cm">/* Enable parity checking for PIO */</span><span class="cp"></span>
<span class="cp">#define HPC3_SPCFG_FUJI 0x8000 </span><span class="cm">/* Fujitsu scsi controller mode for faster dma/pio */</span><span class="cp"></span>

	<span class="n">u32</span> <span class="n">_unused1</span><span class="p">[</span><span class="mh">0x1000</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">6</span><span class="p">];</span>	<span class="cm">/* padding */</span>
<span class="p">};</span>

<span class="cm">/* SEEQ ethernet HPC3 registers, only one seeq per HPC3. */</span>
<span class="k">struct</span> <span class="n">hpc3_ethregs</span> <span class="p">{</span>
	<span class="cm">/* Receiver registers. */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">rx_cbptr</span><span class="p">;</span>   <span class="cm">/* current dma buffer ptr, diagnostic use only */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">rx_ndptr</span><span class="p">;</span>   <span class="cm">/* next dma descriptor ptr */</span>
	<span class="n">u32</span> <span class="n">_unused0</span><span class="p">[</span><span class="mh">0x1000</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">2</span><span class="p">];</span>	<span class="cm">/* padding */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">rx_bcd</span><span class="p">;</span>	<span class="cm">/* byte count info */</span>
<span class="cp">#define HPC3_ERXBCD_BCNTMSK 0x00003fff </span><span class="cm">/* bytes to be sent to memory */</span><span class="cp"></span>
<span class="cp">#define HPC3_ERXBCD_XIE     0x20000000 </span><span class="cm">/* HPC3 interrupts cpu at end of this buf */</span><span class="cp"></span>
<span class="cp">#define HPC3_ERXBCD_EOX     0x80000000 </span><span class="cm">/* flags this as end of descriptor chain */</span><span class="cp"></span>

	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">rx_ctrl</span><span class="p">;</span>	<span class="cm">/* control register */</span>
<span class="cp">#define HPC3_ERXCTRL_STAT50 0x0000003f </span><span class="cm">/* Receive status reg bits of Seeq8003 */</span><span class="cp"></span>
<span class="cp">#define HPC3_ERXCTRL_STAT6  0x00000040 </span><span class="cm">/* Rdonly irq status */</span><span class="cp"></span>
<span class="cp">#define HPC3_ERXCTRL_STAT7  0x00000080 </span><span class="cm">/* Rdonlt old/new status bit from Seeq */</span><span class="cp"></span>
<span class="cp">#define HPC3_ERXCTRL_ENDIAN 0x00000100 </span><span class="cm">/* Endian for dma channel, little=1 big=0 */</span><span class="cp"></span>
<span class="cp">#define HPC3_ERXCTRL_ACTIVE 0x00000200 </span><span class="cm">/* Tells if DMA transfer is in progress */</span><span class="cp"></span>
<span class="cp">#define HPC3_ERXCTRL_AMASK  0x00000400 </span><span class="cm">/* Tells if ACTIVE inhibits PIO&#39;s to hpc3 */</span><span class="cp"></span>
<span class="cp">#define HPC3_ERXCTRL_RBO    0x00000800 </span><span class="cm">/* Receive buffer overflow if set to 1 */</span><span class="cp"></span>

	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">rx_gfptr</span><span class="p">;</span>	<span class="cm">/* current GIO fifo ptr */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">rx_dfptr</span><span class="p">;</span>	<span class="cm">/* current device fifo ptr */</span>
	<span class="n">u32</span> <span class="n">_unused1</span><span class="p">;</span>		<span class="cm">/* padding */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">reset</span><span class="p">;</span>	<span class="cm">/* reset register */</span>
<span class="cp">#define HPC3_ERST_CRESET 0x1	</span><span class="cm">/* Reset dma channel and external controller */</span><span class="cp"></span>
<span class="cp">#define HPC3_ERST_CLRIRQ 0x2	</span><span class="cm">/* Clear channel interrupt */</span><span class="cp"></span>
<span class="cp">#define HPC3_ERST_LBACK  0x4	</span><span class="cm">/* Enable diagnostic loopback mode of Seeq8003 */</span><span class="cp"></span>

	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">dconfig</span><span class="p">;</span>    <span class="cm">/* DMA configuration register */</span>
<span class="cp">#define HPC3_EDCFG_D1    0x0000f </span><span class="cm">/* Cycles to spend in D1 state for PIO */</span><span class="cp"></span>
<span class="cp">#define HPC3_EDCFG_D2    0x000f0 </span><span class="cm">/* Cycles to spend in D2 state for PIO */</span><span class="cp"></span>
<span class="cp">#define HPC3_EDCFG_D3    0x00f00 </span><span class="cm">/* Cycles to spend in D3 state for PIO */</span><span class="cp"></span>
<span class="cp">#define HPC3_EDCFG_WCTRL 0x01000 </span><span class="cm">/* Enable writes of desc into ex ctrl port */</span><span class="cp"></span>
<span class="cp">#define HPC3_EDCFG_FRXDC 0x02000 </span><span class="cm">/* Clear eop stat bits upon rxdc, hw seeq fix */</span><span class="cp"></span>
<span class="cp">#define HPC3_EDCFG_FEOP  0x04000 </span><span class="cm">/* Bad packet marker timeout enable */</span><span class="cp"></span>
<span class="cp">#define HPC3_EDCFG_FIRQ  0x08000 </span><span class="cm">/* Another bad packet timeout enable */</span><span class="cp"></span>
<span class="cp">#define HPC3_EDCFG_PTO   0x30000 </span><span class="cm">/* Programmed timeout value for above two */</span><span class="cp"></span>

	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">pconfig</span><span class="p">;</span>   <span class="cm">/* PIO configuration register */</span>
<span class="cp">#define HPC3_EPCFG_P1    0x000f </span><span class="cm">/* Cycles to spend in P1 state for PIO */</span><span class="cp"></span>
<span class="cp">#define HPC3_EPCFG_P2    0x00f0 </span><span class="cm">/* Cycles to spend in P2 state for PIO */</span><span class="cp"></span>
<span class="cp">#define HPC3_EPCFG_P3    0x0f00 </span><span class="cm">/* Cycles to spend in P3 state for PIO */</span><span class="cp"></span>
<span class="cp">#define HPC3_EPCFG_TST   0x1000 </span><span class="cm">/* Diagnistic ram test feature bit */</span><span class="cp"></span>

	<span class="n">u32</span> <span class="n">_unused2</span><span class="p">[</span><span class="mh">0x1000</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">8</span><span class="p">];</span>	<span class="cm">/* padding */</span>

	<span class="cm">/* Transmitter registers. */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">tx_cbptr</span><span class="p">;</span>	<span class="cm">/* current dma buffer ptr, diagnostic use only */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">tx_ndptr</span><span class="p">;</span>	<span class="cm">/* next dma descriptor ptr */</span>
	<span class="n">u32</span> <span class="n">_unused3</span><span class="p">[</span><span class="mh">0x1000</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">2</span><span class="p">];</span>	<span class="cm">/* padding */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">tx_bcd</span><span class="p">;</span>		<span class="cm">/* byte count info */</span>
<span class="cp">#define HPC3_ETXBCD_BCNTMSK 0x00003fff	</span><span class="cm">/* bytes to be read from memory */</span><span class="cp"></span>
<span class="cp">#define HPC3_ETXBCD_ESAMP   0x10000000	</span><span class="cm">/* if set, too late to add descriptor */</span><span class="cp"></span>
<span class="cp">#define HPC3_ETXBCD_XIE     0x20000000	</span><span class="cm">/* Interrupt cpu at end of cur desc */</span><span class="cp"></span>
<span class="cp">#define HPC3_ETXBCD_EOP     0x40000000	</span><span class="cm">/* Last byte of cur buf is end of packet */</span><span class="cp"></span>
<span class="cp">#define HPC3_ETXBCD_EOX     0x80000000	</span><span class="cm">/* This buf is the end of desc chain */</span><span class="cp"></span>

	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">tx_ctrl</span><span class="p">;</span>		<span class="cm">/* control register */</span>
<span class="cp">#define HPC3_ETXCTRL_STAT30 0x0000000f	</span><span class="cm">/* Rdonly copy of seeq tx stat reg */</span><span class="cp"></span>
<span class="cp">#define HPC3_ETXCTRL_STAT4  0x00000010	</span><span class="cm">/* Indicate late collision occurred */</span><span class="cp"></span>
<span class="cp">#define HPC3_ETXCTRL_STAT75 0x000000e0	</span><span class="cm">/* Rdonly irq status from seeq */</span><span class="cp"></span>
<span class="cp">#define HPC3_ETXCTRL_ENDIAN 0x00000100	</span><span class="cm">/* DMA channel endian mode, 1=little 0=big */</span><span class="cp"></span>
<span class="cp">#define HPC3_ETXCTRL_ACTIVE 0x00000200	</span><span class="cm">/* DMA tx channel is active */</span><span class="cp"></span>
<span class="cp">#define HPC3_ETXCTRL_AMASK  0x00000400	</span><span class="cm">/* Indicates ACTIVE inhibits PIO&#39;s */</span><span class="cp"></span>

	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">tx_gfptr</span><span class="p">;</span>		<span class="cm">/* current GIO fifo ptr */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">tx_dfptr</span><span class="p">;</span>		<span class="cm">/* current device fifo ptr */</span>
	<span class="n">u32</span> <span class="n">_unused4</span><span class="p">[</span><span class="mh">0x1000</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">4</span><span class="p">];</span>	<span class="cm">/* padding */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hpc3_regs</span> <span class="p">{</span>
	<span class="cm">/* First regs for the PBUS 8 dma channels. */</span>
	<span class="k">struct</span> <span class="n">hpc3_pbus_dmacregs</span> <span class="n">pbdma</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>

	<span class="cm">/* Now the HPC scsi registers, we get two scsi reg sets. */</span>
	<span class="k">struct</span> <span class="n">hpc3_scsiregs</span> <span class="n">scsi_chan0</span><span class="p">,</span> <span class="n">scsi_chan1</span><span class="p">;</span>

	<span class="cm">/* The SEEQ hpc3 ethernet dma/control registers. */</span>
	<span class="k">struct</span> <span class="n">hpc3_ethregs</span> <span class="n">ethregs</span><span class="p">;</span>

	<span class="cm">/* Here are where the hpc3 fifo&#39;s can be directly accessed</span>
<span class="cm">	 * via PIO accesses.  Under normal operation we never stick</span>
<span class="cm">	 * our grubby paws in here so it&#39;s just padding. */</span>
	<span class="n">u32</span> <span class="n">_unused0</span><span class="p">[</span><span class="mh">0x18000</span><span class="o">/</span><span class="mi">4</span><span class="p">];</span>

	<span class="cm">/* HPC3 irq status regs.  Due to a peculiar bug you need to</span>
<span class="cm">	 * look at two different register addresses to get at all of</span>
<span class="cm">	 * the status bits.  The first reg can only reliably report</span>
<span class="cm">	 * bits 4:0 of the status, and the second reg can only</span>
<span class="cm">	 * reliably report bits 9:5 of the hpc3 irq status.  I told</span>
<span class="cm">	 * you it was a peculiar bug. ;-)</span>
<span class="cm">	 */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">istat0</span><span class="p">;</span>		<span class="cm">/* Irq status, only bits &lt;4:0&gt; reliable. */</span>
<span class="cp">#define HPC3_ISTAT_PBIMASK	0x0ff	</span><span class="cm">/* irq bits for pbus devs 0 --&gt; 7 */</span><span class="cp"></span>
<span class="cp">#define HPC3_ISTAT_SC0MASK	0x100	</span><span class="cm">/* irq bit for scsi channel 0 */</span><span class="cp"></span>
<span class="cp">#define HPC3_ISTAT_SC1MASK	0x200	</span><span class="cm">/* irq bit for scsi channel 1 */</span><span class="cp"></span>

	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">gio_misc</span><span class="p">;</span>		<span class="cm">/* GIO misc control bits. */</span>
<span class="cp">#define HPC3_GIOMISC_ERTIME	0x1	</span><span class="cm">/* Enable external timer real time. */</span><span class="cp"></span>
<span class="cp">#define HPC3_GIOMISC_DENDIAN	0x2	</span><span class="cm">/* dma descriptor endian, 1=lit 0=big */</span><span class="cp"></span>

	<span class="n">u32</span> <span class="n">eeprom</span><span class="p">;</span>			<span class="cm">/* EEPROM data reg. */</span>
<span class="cp">#define HPC3_EEPROM_EPROT	0x01	</span><span class="cm">/* Protect register enable */</span><span class="cp"></span>
<span class="cp">#define HPC3_EEPROM_CSEL	0x02	</span><span class="cm">/* Chip select */</span><span class="cp"></span>
<span class="cp">#define HPC3_EEPROM_ECLK	0x04	</span><span class="cm">/* EEPROM clock */</span><span class="cp"></span>
<span class="cp">#define HPC3_EEPROM_DATO	0x08	</span><span class="cm">/* Data out */</span><span class="cp"></span>
<span class="cp">#define HPC3_EEPROM_DATI	0x10	</span><span class="cm">/* Data in */</span><span class="cp"></span>

	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">istat1</span><span class="p">;</span>		<span class="cm">/* Irq status, only bits &lt;9:5&gt; reliable. */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">bestat</span><span class="p">;</span>		<span class="cm">/* Bus error interrupt status reg. */</span>
<span class="cp">#define HPC3_BESTAT_BLMASK	0x000ff	</span><span class="cm">/* Bus lane where bad parity occurred */</span><span class="cp"></span>
<span class="cp">#define HPC3_BESTAT_CTYPE	0x00100	</span><span class="cm">/* Bus cycle type, 0=PIO 1=DMA */</span><span class="cp"></span>
<span class="cp">#define HPC3_BESTAT_PIDSHIFT	9</span>
<span class="cp">#define HPC3_BESTAT_PIDMASK	0x3f700	</span><span class="cm">/* DMA channel parity identifier */</span><span class="cp"></span>

	<span class="n">u32</span> <span class="n">_unused1</span><span class="p">[</span><span class="mh">0x14000</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">5</span><span class="p">];</span>	<span class="cm">/* padding */</span>

	<span class="cm">/* Now direct PIO per-HPC3 peripheral access to external regs. */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">scsi0_ext</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>	<span class="cm">/* SCSI channel 0 external regs */</span>
	<span class="n">u32</span> <span class="n">_unused2</span><span class="p">[</span><span class="mh">0x7c00</span><span class="o">/</span><span class="mi">4</span><span class="p">];</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">scsi1_ext</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>	<span class="cm">/* SCSI channel 1 external regs */</span>
	<span class="n">u32</span> <span class="n">_unused3</span><span class="p">[</span><span class="mh">0x7c00</span><span class="o">/</span><span class="mi">4</span><span class="p">];</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">eth_ext</span><span class="p">[</span><span class="mi">320</span><span class="p">];</span>	<span class="cm">/* Ethernet external registers */</span>
	<span class="n">u32</span> <span class="n">_unused4</span><span class="p">[</span><span class="mh">0x3b00</span><span class="o">/</span><span class="mi">4</span><span class="p">];</span>

	<span class="cm">/* Per-peripheral device external registers and DMA/PIO control. */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">pbus_extregs</span><span class="p">[</span><span class="mi">16</span><span class="p">][</span><span class="mi">256</span><span class="p">];</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">pbus_dmacfg</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">128</span><span class="p">];</span>
	<span class="cm">/* Cycles to spend in D3 for reads */</span>
<span class="cp">#define HPC3_DMACFG_D3R_MASK		0x00000001</span>
<span class="cp">#define HPC3_DMACFG_D3R_SHIFT		0</span>
	<span class="cm">/* Cycles to spend in D4 for reads */</span>
<span class="cp">#define HPC3_DMACFG_D4R_MASK		0x0000001e</span>
<span class="cp">#define HPC3_DMACFG_D4R_SHIFT		1</span>
	<span class="cm">/* Cycles to spend in D5 for reads */</span>
<span class="cp">#define HPC3_DMACFG_D5R_MASK		0x000001e0</span>
<span class="cp">#define HPC3_DMACFG_D5R_SHIFT		5</span>
	<span class="cm">/* Cycles to spend in D3 for writes */</span>
<span class="cp">#define HPC3_DMACFG_D3W_MASK		0x00000200</span>
<span class="cp">#define HPC3_DMACFG_D3W_SHIFT		9</span>
	<span class="cm">/* Cycles to spend in D4 for writes */</span>
<span class="cp">#define HPC3_DMACFG_D4W_MASK		0x00003c00</span>
<span class="cp">#define HPC3_DMACFG_D4W_SHIFT		10</span>
	<span class="cm">/* Cycles to spend in D5 for writes */</span>
<span class="cp">#define HPC3_DMACFG_D5W_MASK		0x0003c000</span>
<span class="cp">#define HPC3_DMACFG_D5W_SHIFT		14</span>
	<span class="cm">/* Enable 16-bit DMA access mode */</span>
<span class="cp">#define HPC3_DMACFG_DS16		0x00040000</span>
	<span class="cm">/* Places halfwords on high 16 bits of bus */</span>
<span class="cp">#define HPC3_DMACFG_EVENHI		0x00080000</span>
	<span class="cm">/* Make this device real time */</span>
<span class="cp">#define HPC3_DMACFG_RTIME		0x00200000</span>
	<span class="cm">/* 5 bit burst count for DMA device */</span>
<span class="cp">#define HPC3_DMACFG_BURST_MASK		0x07c00000</span>
<span class="cp">#define HPC3_DMACFG_BURST_SHIFT	22</span>
	<span class="cm">/* Use live pbus_dreq unsynchronized signal */</span>
<span class="cp">#define HPC3_DMACFG_DRQLIVE		0x08000000</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">pbus_piocfg</span><span class="p">[</span><span class="mi">16</span><span class="p">][</span><span class="mi">64</span><span class="p">];</span>
	<span class="cm">/* Cycles to spend in P2 state for reads */</span>
<span class="cp">#define HPC3_PIOCFG_P2R_MASK		0x00001</span>
<span class="cp">#define HPC3_PIOCFG_P2R_SHIFT		0</span>
	<span class="cm">/* Cycles to spend in P3 state for reads */</span>
<span class="cp">#define HPC3_PIOCFG_P3R_MASK		0x0001e</span>
<span class="cp">#define HPC3_PIOCFG_P3R_SHIFT		1</span>
	<span class="cm">/* Cycles to spend in P4 state for reads */</span>
<span class="cp">#define HPC3_PIOCFG_P4R_MASK		0x001e0</span>
<span class="cp">#define HPC3_PIOCFG_P4R_SHIFT		5</span>
	<span class="cm">/* Cycles to spend in P2 state for writes */</span>
<span class="cp">#define HPC3_PIOCFG_P2W_MASK		0x00200</span>
<span class="cp">#define HPC3_PIOCFG_P2W_SHIFT		9</span>
	<span class="cm">/* Cycles to spend in P3 state for writes */</span>
<span class="cp">#define HPC3_PIOCFG_P3W_MASK		0x03c00</span>
<span class="cp">#define HPC3_PIOCFG_P3W_SHIFT		10</span>
	<span class="cm">/* Cycles to spend in P4 state for writes */</span>
<span class="cp">#define HPC3_PIOCFG_P4W_MASK		0x3c000</span>
<span class="cp">#define HPC3_PIOCFG_P4W_SHIFT		14</span>
	<span class="cm">/* Enable 16-bit PIO accesses */</span>
<span class="cp">#define HPC3_PIOCFG_DS16		0x40000</span>
	<span class="cm">/* Place even address bits in bits &lt;15:8&gt; */</span>
<span class="cp">#define HPC3_PIOCFG_EVENHI		0x80000</span>

	<span class="cm">/* PBUS PROM control regs. */</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">pbus_promwe</span><span class="p">;</span>	<span class="cm">/* PROM write enable register */</span>
<span class="cp">#define HPC3_PROM_WENAB	0x1	</span><span class="cm">/* Enable writes to the PROM */</span><span class="cp"></span>

	<span class="n">u32</span> <span class="n">_unused5</span><span class="p">[</span><span class="mh">0x0800</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">pbus_promswap</span><span class="p">;</span>	<span class="cm">/* Chip select swap reg */</span>
<span class="cp">#define HPC3_PROM_SWAP	0x1	</span><span class="cm">/* invert GIO addr bit to select prom0 or prom1 */</span><span class="cp"></span>

	<span class="n">u32</span> <span class="n">_unused6</span><span class="p">[</span><span class="mh">0x0800</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">pbus_gout</span><span class="p">;</span>	<span class="cm">/* PROM general purpose output reg */</span>
<span class="cp">#define HPC3_PROM_STAT	0x1	</span><span class="cm">/* General purpose status bit in gout */</span><span class="cp"></span>

	<span class="n">u32</span> <span class="n">_unused7</span><span class="p">[</span><span class="mh">0x1000</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">rtcregs</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>	<span class="cm">/* Dallas clock registers */</span>
	<span class="n">u32</span> <span class="n">_unused8</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
	<span class="k">volatile</span> <span class="n">u32</span> <span class="n">bbram</span><span class="p">[</span><span class="mi">8192</span><span class="o">-</span><span class="mi">50</span><span class="o">-</span><span class="mi">14</span><span class="p">];</span>	<span class="cm">/* Battery backed ram */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * It is possible to have two HPC3&#39;s within the address space on</span>
<span class="cm"> * one machine, though only having one is more likely on an Indy.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">hpc3_regs</span> <span class="o">*</span><span class="n">hpc3c0</span><span class="p">,</span> <span class="o">*</span><span class="n">hpc3c1</span><span class="p">;</span>
<span class="cp">#define HPC3_CHIP0_BASE		0x1fb80000	</span><span class="cm">/* physical */</span><span class="cp"></span>
<span class="cp">#define HPC3_CHIP1_BASE		0x1fb00000	</span><span class="cm">/* physical */</span><span class="cp"></span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">sgihpc_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* _SGI_HPC3_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
