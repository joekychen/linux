<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › mach-loongson › loongson.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>loongson.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) 2009 Lemote, Inc.</span>
<span class="cm"> * Author: Wu Zhangjin &lt;wuzhangjin@gmail.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute  it and/or modify it</span>
<span class="cm"> * under  the terms of  the GNU General  Public License as published by the</span>
<span class="cm"> * Free Software Foundation;  either version 2 of the  License, or (at your</span>
<span class="cm"> * option) any later version.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASM_MACH_LOONGSON_LOONGSON_H</span>
<span class="cp">#define __ASM_MACH_LOONGSON_LOONGSON_H</span>

<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/irq.h&gt;</span>

<span class="cm">/* loongson internal northbridge initialization */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">bonito_irq_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/* machine-specific reboot/halt operation */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mach_prepare_reboot</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mach_prepare_shutdown</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/* environment arguments from bootloader */</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cpu_clock_freq</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">memsize</span><span class="p">,</span> <span class="n">highmemsize</span><span class="p">;</span>

<span class="cm">/* loongson-specific command line, env and memory initialization */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">prom_init_memory</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">prom_init_cmdline</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">prom_init_machtype</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">prom_init_env</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_LOONGSON_UART_BASE</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">_loongson_uart_base</span><span class="p">,</span> <span class="n">loongson_uart_base</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">prom_init_loongson_uart_base</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">prom_init_uart_base</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_LOONGSON_UART_BASE</span>
	<span class="n">prom_init_loongson_uart_base</span><span class="p">();</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cm">/* irq operation functions */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">bonito_irqdispatch</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">bonito_irq_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">mach_init_irq</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mach_irq_dispatch</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pending</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mach_i8259_irq</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/* We need this in some places... */</span>
<span class="cp">#define delay()	({		\</span>
<span class="cp">	int x;				\</span>
<span class="cp">	for (x = 0; x &lt; 100000; x++)	\</span>
<span class="cp">		__asm__ __volatile__(&quot;&quot;); \</span>
<span class="cp">})</span>

<span class="cp">#define LOONGSON_REG(x) \</span>
<span class="cp">	(*(volatile u32 *)((char *)CKSEG1ADDR(LOONGSON_REG_BASE) + (x)))</span>

<span class="cp">#define LOONGSON_IRQ_BASE	32</span>
<span class="cp">#define LOONGSON2_PERFCNT_IRQ	(MIPS_CPU_IRQ_BASE + 6) </span><span class="cm">/* cpu perf counter */</span><span class="cp"></span>

<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">do_perfcnt_IRQ</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if defined(CONFIG_OPROFILE) || defined(CONFIG_OPROFILE_MODULE)</span>
	<span class="n">do_IRQ</span><span class="p">(</span><span class="n">LOONGSON2_PERFCNT_IRQ</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define LOONGSON_FLASH_BASE	0x1c000000</span>
<span class="cp">#define LOONGSON_FLASH_SIZE	0x02000000	</span><span class="cm">/* 32M */</span><span class="cp"></span>
<span class="cp">#define LOONGSON_FLASH_TOP	(LOONGSON_FLASH_BASE+LOONGSON_FLASH_SIZE-1)</span>

<span class="cp">#define LOONGSON_LIO0_BASE	0x1e000000</span>
<span class="cp">#define LOONGSON_LIO0_SIZE	0x01C00000	</span><span class="cm">/* 28M */</span><span class="cp"></span>
<span class="cp">#define LOONGSON_LIO0_TOP	(LOONGSON_LIO0_BASE+LOONGSON_LIO0_SIZE-1)</span>

<span class="cp">#define LOONGSON_BOOT_BASE	0x1fc00000</span>
<span class="cp">#define LOONGSON_BOOT_SIZE	0x00100000	</span><span class="cm">/* 1M */</span><span class="cp"></span>
<span class="cp">#define LOONGSON_BOOT_TOP 	(LOONGSON_BOOT_BASE+LOONGSON_BOOT_SIZE-1)</span>
<span class="cp">#define LOONGSON_REG_BASE 	0x1fe00000</span>
<span class="cp">#define LOONGSON_REG_SIZE 	0x00100000	</span><span class="cm">/* 256Bytes + 256Bytes + ??? */</span><span class="cp"></span>
<span class="cp">#define LOONGSON_REG_TOP	(LOONGSON_REG_BASE+LOONGSON_REG_SIZE-1)</span>

<span class="cp">#define LOONGSON_LIO1_BASE 	0x1ff00000</span>
<span class="cp">#define LOONGSON_LIO1_SIZE 	0x00100000	</span><span class="cm">/* 1M */</span><span class="cp"></span>
<span class="cp">#define LOONGSON_LIO1_TOP	(LOONGSON_LIO1_BASE+LOONGSON_LIO1_SIZE-1)</span>

<span class="cp">#define LOONGSON_PCILO0_BASE	0x10000000</span>
<span class="cp">#define LOONGSON_PCILO1_BASE	0x14000000</span>
<span class="cp">#define LOONGSON_PCILO2_BASE	0x18000000</span>
<span class="cp">#define LOONGSON_PCILO_BASE	LOONGSON_PCILO0_BASE</span>
<span class="cp">#define LOONGSON_PCILO_SIZE	0x0c000000	</span><span class="cm">/* 64M * 3 */</span><span class="cp"></span>
<span class="cp">#define LOONGSON_PCILO_TOP	(LOONGSON_PCILO0_BASE+LOONGSON_PCILO_SIZE-1)</span>

<span class="cp">#define LOONGSON_PCICFG_BASE	0x1fe80000</span>
<span class="cp">#define LOONGSON_PCICFG_SIZE	0x00000800	</span><span class="cm">/* 2K */</span><span class="cp"></span>
<span class="cp">#define LOONGSON_PCICFG_TOP	(LOONGSON_PCICFG_BASE+LOONGSON_PCICFG_SIZE-1)</span>
<span class="cp">#define LOONGSON_PCIIO_BASE	0x1fd00000</span>
<span class="cp">#define LOONGSON_PCIIO_SIZE	0x00100000	</span><span class="cm">/* 1M */</span><span class="cp"></span>
<span class="cp">#define LOONGSON_PCIIO_TOP	(LOONGSON_PCIIO_BASE+LOONGSON_PCIIO_SIZE-1)</span>

<span class="cm">/* Loongson Register Bases */</span>

<span class="cp">#define LOONGSON_PCICONFIGBASE	0x00</span>
<span class="cp">#define LOONGSON_REGBASE	0x100</span>

<span class="cm">/* PCI Configuration Registers */</span>

<span class="cp">#define LOONGSON_PCI_REG(x)	LOONGSON_REG(LOONGSON_PCICONFIGBASE + (x))</span>
<span class="cp">#define LOONGSON_PCIDID		LOONGSON_PCI_REG(0x00)</span>
<span class="cp">#define LOONGSON_PCICMD		LOONGSON_PCI_REG(0x04)</span>
<span class="cp">#define LOONGSON_PCICLASS 	LOONGSON_PCI_REG(0x08)</span>
<span class="cp">#define LOONGSON_PCILTIMER	LOONGSON_PCI_REG(0x0c)</span>
<span class="cp">#define LOONGSON_PCIBASE0 	LOONGSON_PCI_REG(0x10)</span>
<span class="cp">#define LOONGSON_PCIBASE1 	LOONGSON_PCI_REG(0x14)</span>
<span class="cp">#define LOONGSON_PCIBASE2 	LOONGSON_PCI_REG(0x18)</span>
<span class="cp">#define LOONGSON_PCIBASE3 	LOONGSON_PCI_REG(0x1c)</span>
<span class="cp">#define LOONGSON_PCIBASE4 	LOONGSON_PCI_REG(0x20)</span>
<span class="cp">#define LOONGSON_PCIEXPRBASE	LOONGSON_PCI_REG(0x30)</span>
<span class="cp">#define LOONGSON_PCIINT		LOONGSON_PCI_REG(0x3c)</span>

<span class="cp">#define LOONGSON_PCI_ISR4C	LOONGSON_PCI_REG(0x4c)</span>

<span class="cp">#define LOONGSON_PCICMD_PERR_CLR	0x80000000</span>
<span class="cp">#define LOONGSON_PCICMD_SERR_CLR	0x40000000</span>
<span class="cp">#define LOONGSON_PCICMD_MABORT_CLR	0x20000000</span>
<span class="cp">#define LOONGSON_PCICMD_MTABORT_CLR	0x10000000</span>
<span class="cp">#define LOONGSON_PCICMD_TABORT_CLR	0x08000000</span>
<span class="cp">#define LOONGSON_PCICMD_MPERR_CLR 	0x01000000</span>
<span class="cp">#define LOONGSON_PCICMD_PERRRESPEN	0x00000040</span>
<span class="cp">#define LOONGSON_PCICMD_ASTEPEN		0x00000080</span>
<span class="cp">#define LOONGSON_PCICMD_SERREN		0x00000100</span>
<span class="cp">#define LOONGSON_PCILTIMER_BUSLATENCY	0x0000ff00</span>
<span class="cp">#define LOONGSON_PCILTIMER_BUSLATENCY_SHIFT	8</span>

<span class="cm">/* Loongson h/w Configuration */</span>

<span class="cp">#define LOONGSON_GENCFG_OFFSET		0x4</span>
<span class="cp">#define LOONGSON_GENCFG	LOONGSON_REG(LOONGSON_REGBASE + LOONGSON_GENCFG_OFFSET)</span>

<span class="cp">#define LOONGSON_GENCFG_DEBUGMODE	0x00000001</span>
<span class="cp">#define LOONGSON_GENCFG_SNOOPEN		0x00000002</span>
<span class="cp">#define LOONGSON_GENCFG_CPUSELFRESET	0x00000004</span>

<span class="cp">#define LOONGSON_GENCFG_FORCE_IRQA	0x00000008</span>
<span class="cp">#define LOONGSON_GENCFG_IRQA_ISOUT	0x00000010</span>
<span class="cp">#define LOONGSON_GENCFG_IRQA_FROM_INT1	0x00000020</span>
<span class="cp">#define LOONGSON_GENCFG_BYTESWAP	0x00000040</span>

<span class="cp">#define LOONGSON_GENCFG_UNCACHED	0x00000080</span>
<span class="cp">#define LOONGSON_GENCFG_PREFETCHEN	0x00000100</span>
<span class="cp">#define LOONGSON_GENCFG_WBEHINDEN	0x00000200</span>
<span class="cp">#define LOONGSON_GENCFG_CACHEALG	0x00000c00</span>
<span class="cp">#define LOONGSON_GENCFG_CACHEALG_SHIFT	10</span>
<span class="cp">#define LOONGSON_GENCFG_PCIQUEUE	0x00001000</span>
<span class="cp">#define LOONGSON_GENCFG_CACHESTOP	0x00002000</span>
<span class="cp">#define LOONGSON_GENCFG_MSTRBYTESWAP	0x00004000</span>
<span class="cp">#define LOONGSON_GENCFG_BUSERREN	0x00008000</span>
<span class="cp">#define LOONGSON_GENCFG_NORETRYTIMEOUT	0x00010000</span>
<span class="cp">#define LOONGSON_GENCFG_SHORTCOPYTIMEOUT	0x00020000</span>

<span class="cm">/* PCI address map control */</span>

<span class="cp">#define LOONGSON_PCIMAP			LOONGSON_REG(LOONGSON_REGBASE + 0x10)</span>
<span class="cp">#define LOONGSON_PCIMEMBASECFG		LOONGSON_REG(LOONGSON_REGBASE + 0x14)</span>
<span class="cp">#define LOONGSON_PCIMAP_CFG		LOONGSON_REG(LOONGSON_REGBASE + 0x18)</span>

<span class="cm">/* GPIO Regs - r/w */</span>

<span class="cp">#define LOONGSON_GPIODATA 		LOONGSON_REG(LOONGSON_REGBASE + 0x1c)</span>
<span class="cp">#define LOONGSON_GPIOIE			LOONGSON_REG(LOONGSON_REGBASE + 0x20)</span>

<span class="cm">/* ICU Configuration Regs - r/w */</span>

<span class="cp">#define LOONGSON_INTEDGE		LOONGSON_REG(LOONGSON_REGBASE + 0x24)</span>
<span class="cp">#define LOONGSON_INTSTEER 		LOONGSON_REG(LOONGSON_REGBASE + 0x28)</span>
<span class="cp">#define LOONGSON_INTPOL			LOONGSON_REG(LOONGSON_REGBASE + 0x2c)</span>

<span class="cm">/* ICU Enable Regs - IntEn &amp; IntISR are r/o. */</span>

<span class="cp">#define LOONGSON_INTENSET 		LOONGSON_REG(LOONGSON_REGBASE + 0x30)</span>
<span class="cp">#define LOONGSON_INTENCLR 		LOONGSON_REG(LOONGSON_REGBASE + 0x34)</span>
<span class="cp">#define LOONGSON_INTEN			LOONGSON_REG(LOONGSON_REGBASE + 0x38)</span>
<span class="cp">#define LOONGSON_INTISR			LOONGSON_REG(LOONGSON_REGBASE + 0x3c)</span>

<span class="cm">/* ICU */</span>
<span class="cp">#define LOONGSON_ICU_MBOXES		0x0000000f</span>
<span class="cp">#define LOONGSON_ICU_MBOXES_SHIFT 	0</span>
<span class="cp">#define LOONGSON_ICU_DMARDY		0x00000010</span>
<span class="cp">#define LOONGSON_ICU_DMAEMPTY		0x00000020</span>
<span class="cp">#define LOONGSON_ICU_COPYRDY		0x00000040</span>
<span class="cp">#define LOONGSON_ICU_COPYEMPTY		0x00000080</span>
<span class="cp">#define LOONGSON_ICU_COPYERR		0x00000100</span>
<span class="cp">#define LOONGSON_ICU_PCIIRQ		0x00000200</span>
<span class="cp">#define LOONGSON_ICU_MASTERERR		0x00000400</span>
<span class="cp">#define LOONGSON_ICU_SYSTEMERR		0x00000800</span>
<span class="cp">#define LOONGSON_ICU_DRAMPERR		0x00001000</span>
<span class="cp">#define LOONGSON_ICU_RETRYERR		0x00002000</span>
<span class="cp">#define LOONGSON_ICU_GPIOS		0x01ff0000</span>
<span class="cp">#define LOONGSON_ICU_GPIOS_SHIFT		16</span>
<span class="cp">#define LOONGSON_ICU_GPINS		0x7e000000</span>
<span class="cp">#define LOONGSON_ICU_GPINS_SHIFT		25</span>
<span class="cp">#define LOONGSON_ICU_MBOX(N)		(1&lt;&lt;(LOONGSON_ICU_MBOXES_SHIFT+(N)))</span>
<span class="cp">#define LOONGSON_ICU_GPIO(N)		(1&lt;&lt;(LOONGSON_ICU_GPIOS_SHIFT+(N)))</span>
<span class="cp">#define LOONGSON_ICU_GPIN(N)		(1&lt;&lt;(LOONGSON_ICU_GPINS_SHIFT+(N)))</span>

<span class="cm">/* PCI prefetch window base &amp; mask */</span>

<span class="cp">#define LOONGSON_MEM_WIN_BASE_L 	LOONGSON_REG(LOONGSON_REGBASE + 0x40)</span>
<span class="cp">#define LOONGSON_MEM_WIN_BASE_H 	LOONGSON_REG(LOONGSON_REGBASE + 0x44)</span>
<span class="cp">#define LOONGSON_MEM_WIN_MASK_L 	LOONGSON_REG(LOONGSON_REGBASE + 0x48)</span>
<span class="cp">#define LOONGSON_MEM_WIN_MASK_H 	LOONGSON_REG(LOONGSON_REGBASE + 0x4c)</span>

<span class="cm">/* PCI_Hit*_Sel_* */</span>

<span class="cp">#define LOONGSON_PCI_HIT0_SEL_L		LOONGSON_REG(LOONGSON_REGBASE + 0x50)</span>
<span class="cp">#define LOONGSON_PCI_HIT0_SEL_H		LOONGSON_REG(LOONGSON_REGBASE + 0x54)</span>
<span class="cp">#define LOONGSON_PCI_HIT1_SEL_L		LOONGSON_REG(LOONGSON_REGBASE + 0x58)</span>
<span class="cp">#define LOONGSON_PCI_HIT1_SEL_H		LOONGSON_REG(LOONGSON_REGBASE + 0x5c)</span>
<span class="cp">#define LOONGSON_PCI_HIT2_SEL_L		LOONGSON_REG(LOONGSON_REGBASE + 0x60)</span>
<span class="cp">#define LOONGSON_PCI_HIT2_SEL_H		LOONGSON_REG(LOONGSON_REGBASE + 0x64)</span>

<span class="cm">/* PXArb Config &amp; Status */</span>

<span class="cp">#define LOONGSON_PXARB_CFG		LOONGSON_REG(LOONGSON_REGBASE + 0x68)</span>
<span class="cp">#define LOONGSON_PXARB_STATUS		LOONGSON_REG(LOONGSON_REGBASE + 0x6c)</span>

<span class="cm">/* pcimap */</span>

<span class="cp">#define LOONGSON_PCIMAP_PCIMAP_LO0	0x0000003f</span>
<span class="cp">#define LOONGSON_PCIMAP_PCIMAP_LO0_SHIFT	0</span>
<span class="cp">#define LOONGSON_PCIMAP_PCIMAP_LO1	0x00000fc0</span>
<span class="cp">#define LOONGSON_PCIMAP_PCIMAP_LO1_SHIFT	6</span>
<span class="cp">#define LOONGSON_PCIMAP_PCIMAP_LO2	0x0003f000</span>
<span class="cp">#define LOONGSON_PCIMAP_PCIMAP_LO2_SHIFT	12</span>
<span class="cp">#define LOONGSON_PCIMAP_PCIMAP_2	0x00040000</span>
<span class="cp">#define LOONGSON_PCIMAP_WIN(WIN, ADDR)	\</span>
<span class="cp">	((((ADDR)&gt;&gt;26) &amp; LOONGSON_PCIMAP_PCIMAP_LO0) &lt;&lt; ((WIN)*6))</span>

<span class="cp">#ifdef CONFIG_CPU_SUPPORTS_CPUFREQ</span>
<span class="cp">#include &lt;linux/cpufreq.h&gt;</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">loongson2_cpu_wait</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">cpufreq_frequency_table</span> <span class="n">loongson2_clockmod_table</span><span class="p">[];</span>

<span class="cm">/* Chip Config */</span>
<span class="cp">#define LOONGSON_CHIPCFG0		LOONGSON_REG(LOONGSON_REGBASE + 0x80)</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * address windows configuration module</span>
<span class="cm"> *</span>
<span class="cm"> * loongson2e do not have this module</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_CPU_SUPPORTS_ADDRWINCFG</span>

<span class="cm">/* address window config module base address */</span>
<span class="cp">#define LOONGSON_ADDRWINCFG_BASE		0x3ff00000ul</span>
<span class="cp">#define LOONGSON_ADDRWINCFG_SIZE		0x180</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">_loongson_addrwincfg_base</span><span class="p">;</span>
<span class="cp">#define LOONGSON_ADDRWINCFG(offset) \</span>
<span class="cp">	(*(volatile u64 *)(_loongson_addrwincfg_base + (offset)))</span>

<span class="cp">#define CPU_WIN0_BASE	LOONGSON_ADDRWINCFG(0x00)</span>
<span class="cp">#define CPU_WIN1_BASE	LOONGSON_ADDRWINCFG(0x08)</span>
<span class="cp">#define CPU_WIN2_BASE	LOONGSON_ADDRWINCFG(0x10)</span>
<span class="cp">#define CPU_WIN3_BASE	LOONGSON_ADDRWINCFG(0x18)</span>

<span class="cp">#define CPU_WIN0_MASK	LOONGSON_ADDRWINCFG(0x20)</span>
<span class="cp">#define CPU_WIN1_MASK	LOONGSON_ADDRWINCFG(0x28)</span>
<span class="cp">#define CPU_WIN2_MASK	LOONGSON_ADDRWINCFG(0x30)</span>
<span class="cp">#define CPU_WIN3_MASK	LOONGSON_ADDRWINCFG(0x38)</span>

<span class="cp">#define CPU_WIN0_MMAP	LOONGSON_ADDRWINCFG(0x40)</span>
<span class="cp">#define CPU_WIN1_MMAP	LOONGSON_ADDRWINCFG(0x48)</span>
<span class="cp">#define CPU_WIN2_MMAP	LOONGSON_ADDRWINCFG(0x50)</span>
<span class="cp">#define CPU_WIN3_MMAP	LOONGSON_ADDRWINCFG(0x58)</span>

<span class="cp">#define PCIDMA_WIN0_BASE	LOONGSON_ADDRWINCFG(0x60)</span>
<span class="cp">#define PCIDMA_WIN1_BASE	LOONGSON_ADDRWINCFG(0x68)</span>
<span class="cp">#define PCIDMA_WIN2_BASE	LOONGSON_ADDRWINCFG(0x70)</span>
<span class="cp">#define PCIDMA_WIN3_BASE	LOONGSON_ADDRWINCFG(0x78)</span>

<span class="cp">#define PCIDMA_WIN0_MASK	LOONGSON_ADDRWINCFG(0x80)</span>
<span class="cp">#define PCIDMA_WIN1_MASK	LOONGSON_ADDRWINCFG(0x88)</span>
<span class="cp">#define PCIDMA_WIN2_MASK	LOONGSON_ADDRWINCFG(0x90)</span>
<span class="cp">#define PCIDMA_WIN3_MASK	LOONGSON_ADDRWINCFG(0x98)</span>

<span class="cp">#define PCIDMA_WIN0_MMAP	LOONGSON_ADDRWINCFG(0xa0)</span>
<span class="cp">#define PCIDMA_WIN1_MMAP	LOONGSON_ADDRWINCFG(0xa8)</span>
<span class="cp">#define PCIDMA_WIN2_MMAP	LOONGSON_ADDRWINCFG(0xb0)</span>
<span class="cp">#define PCIDMA_WIN3_MMAP	LOONGSON_ADDRWINCFG(0xb8)</span>

<span class="cp">#define ADDRWIN_WIN0	0</span>
<span class="cp">#define ADDRWIN_WIN1	1</span>
<span class="cp">#define ADDRWIN_WIN2	2</span>
<span class="cp">#define ADDRWIN_WIN3	3</span>

<span class="cp">#define ADDRWIN_MAP_DST_DDR	0</span>
<span class="cp">#define ADDRWIN_MAP_DST_PCI	1</span>
<span class="cp">#define ADDRWIN_MAP_DST_LIO	1</span>

<span class="cm">/*</span>
<span class="cm"> * s: CPU, PCIDMA</span>
<span class="cm"> * d: DDR, PCI, LIO</span>
<span class="cm"> * win: 0, 1, 2, 3</span>
<span class="cm"> * src: map source</span>
<span class="cm"> * dst: map destination</span>
<span class="cm"> * size: ~mask + 1</span>
<span class="cm"> */</span>
<span class="cp">#define LOONGSON_ADDRWIN_CFG(s, d, w, src, dst, size) do {\</span>
<span class="cp">	s##_WIN##w##_BASE = (src); \</span>
<span class="cp">	s##_WIN##w##_MMAP = (dst) | ADDRWIN_MAP_DST_##d; \</span>
<span class="cp">	s##_WIN##w##_MASK = ~(size-1); \</span>
<span class="cp">} while (0)</span>

<span class="cp">#define LOONGSON_ADDRWIN_CPUTOPCI(win, src, dst, size) \</span>
<span class="cp">	LOONGSON_ADDRWIN_CFG(CPU, PCI, win, src, dst, size)</span>
<span class="cp">#define LOONGSON_ADDRWIN_CPUTODDR(win, src, dst, size) \</span>
<span class="cp">	LOONGSON_ADDRWIN_CFG(CPU, DDR, win, src, dst, size)</span>
<span class="cp">#define LOONGSON_ADDRWIN_PCITODDR(win, src, dst, size) \</span>
<span class="cp">	LOONGSON_ADDRWIN_CFG(PCIDMA, DDR, win, src, dst, size)</span>

<span class="cp">#endif	</span><span class="cm">/* ! CONFIG_CPU_SUPPORTS_ADDRWINCFG */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __ASM_MACH_LOONGSON_LOONGSON_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
