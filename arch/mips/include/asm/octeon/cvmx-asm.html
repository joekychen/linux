<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › octeon › cvmx-asm.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>cvmx-asm.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/***********************license start***************</span>
<span class="cm"> * Author: Cavium Networks</span>
<span class="cm"> *</span>
<span class="cm"> * Contact: support@caviumnetworks.com</span>
<span class="cm"> * This file is part of the OCTEON SDK</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2003-2008 Cavium Networks</span>
<span class="cm"> *</span>
<span class="cm"> * This file is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License, Version 2, as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed in the hope that it will be useful, but</span>
<span class="cm"> * AS-IS and WITHOUT ANY WARRANTY; without even the implied warranty</span>
<span class="cm"> * of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE, TITLE, or</span>
<span class="cm"> * NONINFRINGEMENT.  See the GNU General Public License for more</span>
<span class="cm"> * details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this file; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA</span>
<span class="cm"> * or visit http://www.gnu.org/licenses/.</span>
<span class="cm"> *</span>
<span class="cm"> * This file may also be available under a different license from Cavium.</span>
<span class="cm"> * Contact Cavium Networks for more information</span>
<span class="cm"> ***********************license end**************************************/</span>

<span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * This is file defines ASM primitives for the executive.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __CVMX_ASM_H__</span>
<span class="cp">#define __CVMX_ASM_H__</span>

<span class="cp">#include &quot;octeon-model.h&quot;</span>

<span class="cm">/* other useful stuff */</span>
<span class="cp">#define CVMX_SYNC asm volatile (&quot;sync&quot; : : : &quot;memory&quot;)</span>
<span class="cm">/* String version of SYNCW macro for using in inline asm constructs */</span>
<span class="cp">#define CVMX_SYNCW_STR &quot;syncw\nsyncw\n&quot;</span>
<span class="cp">#ifdef __OCTEON__</span>

<span class="cm">/* Deprecated, will be removed in future release */</span>
<span class="cp">#define CVMX_SYNCIO asm volatile (&quot;nop&quot;)</span>

<span class="cp">#define CVMX_SYNCIOBDMA asm volatile (&quot;synciobdma&quot; : : : &quot;memory&quot;)</span>

<span class="cm">/* Deprecated, will be removed in future release */</span>
<span class="cp">#define CVMX_SYNCIOALL asm volatile (&quot;nop&quot;)</span>

<span class="cm">/*</span>
<span class="cm"> * We actually use two syncw instructions in a row when we need a write</span>
<span class="cm"> * memory barrier. This is because the CN3XXX series of Octeons have</span>
<span class="cm"> * errata Core-401. This can cause a single syncw to not enforce</span>
<span class="cm"> * ordering under very rare conditions. Even if it is rare, better safe</span>
<span class="cm"> * than sorry.</span>
<span class="cm"> */</span>
<span class="cp">#define CVMX_SYNCW asm volatile (&quot;syncw\n\tsyncw&quot; : : : &quot;memory&quot;)</span>

<span class="cm">/*</span>
<span class="cm"> * Define new sync instructions to be normal SYNC instructions for</span>
<span class="cm"> * operating systems that use threads.</span>
<span class="cm"> */</span>
<span class="cp">#define CVMX_SYNCWS CVMX_SYNCW</span>
<span class="cp">#define CVMX_SYNCS  CVMX_SYNC</span>
<span class="cp">#define CVMX_SYNCWS_STR CVMX_SYNCW_STR</span>
<span class="cp">#else</span>
<span class="cm">/*</span>
<span class="cm"> * Not using a Cavium compiler, always use the slower sync so the</span>
<span class="cm"> * assembler stays happy.</span>
<span class="cm"> */</span>
<span class="cm">/* Deprecated, will be removed in future release */</span>
<span class="cp">#define CVMX_SYNCIO asm volatile (&quot;nop&quot;)</span>

<span class="cp">#define CVMX_SYNCIOBDMA asm volatile (&quot;sync&quot; : : : &quot;memory&quot;)</span>

<span class="cm">/* Deprecated, will be removed in future release */</span>
<span class="cp">#define CVMX_SYNCIOALL asm volatile (&quot;nop&quot;)</span>

<span class="cp">#define CVMX_SYNCW asm volatile (&quot;sync&quot; : : : &quot;memory&quot;)</span>
<span class="cp">#define CVMX_SYNCWS CVMX_SYNCW</span>
<span class="cp">#define CVMX_SYNCS  CVMX_SYNC</span>
<span class="cp">#define CVMX_SYNCWS_STR CVMX_SYNCW_STR</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * CVMX_PREPARE_FOR_STORE makes each byte of the block unpredictable</span>
<span class="cm"> * (actually old value or zero) until that byte is stored to (by this or</span>
<span class="cm"> * another processor. Note that the value of each byte is not only</span>
<span class="cm"> * unpredictable, but may also change again - up until the point when one</span>
<span class="cm"> * of the cores stores to the byte.</span>
<span class="cm"> */</span>
<span class="cp">#define CVMX_PREPARE_FOR_STORE(address, offset) \</span>
<span class="cp">	asm volatile (&quot;pref 30, &quot; CVMX_TMP_STR(offset) &quot;(%[rbase])&quot; : : \</span>
<span class="cp">	[rbase] &quot;d&quot; (address))</span>
<span class="cm">/*</span>
<span class="cm"> * This is a command headed to the L2 controller to tell it to clear</span>
<span class="cm"> * its dirty bit for a block. Basically, SW is telling HW that the</span>
<span class="cm"> * current version of the block will not be used.</span>
<span class="cm"> */</span>
<span class="cp">#define CVMX_DONT_WRITE_BACK(address, offset) \</span>
<span class="cp">	asm volatile (&quot;pref 29, &quot; CVMX_TMP_STR(offset) &quot;(%[rbase])&quot; : : \</span>
<span class="cp">	[rbase] &quot;d&quot; (address))</span>

<span class="cm">/* flush stores, invalidate entire icache */</span>
<span class="cp">#define CVMX_ICACHE_INVALIDATE \</span>
<span class="cp">	{ CVMX_SYNC; asm volatile (&quot;synci 0($0)&quot; : : ); }</span>

<span class="cm">/* flush stores, invalidate entire icache */</span>
<span class="cp">#define CVMX_ICACHE_INVALIDATE2 \</span>
<span class="cp">	{ CVMX_SYNC; asm volatile (&quot;cache 0, 0($0)&quot; : : ); }</span>

<span class="cm">/* complete prefetches, invalidate entire dcache */</span>
<span class="cp">#define CVMX_DCACHE_INVALIDATE \</span>
<span class="cp">	{ CVMX_SYNC; asm volatile (&quot;cache 9, 0($0)&quot; : : ); }</span>

<span class="cp">#define CVMX_CACHE(op, address, offset)					\</span>
<span class="cp">	asm volatile (&quot;cache &quot; CVMX_TMP_STR(op) &quot;, &quot; CVMX_TMP_STR(offset) &quot;(%[rbase])&quot; \</span>
<span class="cp">		: : [rbase] &quot;d&quot; (address) )</span>
<span class="cm">/* fetch and lock the state. */</span>
<span class="cp">#define CVMX_CACHE_LCKL2(address, offset) CVMX_CACHE(31, address, offset)</span>
<span class="cm">/* unlock the state. */</span>
<span class="cp">#define CVMX_CACHE_WBIL2(address, offset) CVMX_CACHE(23, address, offset)</span>
<span class="cm">/* invalidate the cache block and clear the USED bits for the block */</span>
<span class="cp">#define CVMX_CACHE_WBIL2I(address, offset) CVMX_CACHE(3, address, offset)</span>
<span class="cm">/* load virtual tag and data for the L2 cache block into L2C_TAD0_TAG register */</span>
<span class="cp">#define CVMX_CACHE_LTGL2I(address, offset) CVMX_CACHE(7, address, offset)</span>

<span class="cp">#define CVMX_POP(result, input) \</span>
<span class="cp">	asm (&quot;pop %[rd],%[rs]&quot; : [rd] &quot;=d&quot; (result) : [rs] &quot;d&quot; (input))</span>
<span class="cp">#define CVMX_DPOP(result, input) \</span>
<span class="cp">	asm (&quot;dpop %[rd],%[rs]&quot; : [rd] &quot;=d&quot; (result) : [rs] &quot;d&quot; (input))</span>

<span class="cm">/* some new cop0-like stuff */</span>
<span class="cp">#define CVMX_RDHWR(result, regstr) \</span>
<span class="cp">	asm volatile (&quot;rdhwr %[rt],$&quot; CVMX_TMP_STR(regstr) : [rt] &quot;=d&quot; (result))</span>
<span class="cp">#define CVMX_RDHWRNV(result, regstr) \</span>
<span class="cp">	asm (&quot;rdhwr %[rt],$&quot; CVMX_TMP_STR(regstr) : [rt] &quot;=d&quot; (result))</span>
<span class="cp">#endif </span><span class="cm">/* __CVMX_ASM_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
