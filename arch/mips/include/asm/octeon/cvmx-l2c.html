<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › octeon › cvmx-l2c.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>cvmx-l2c.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/***********************license start***************</span>
<span class="cm"> * Author: Cavium Networks</span>
<span class="cm"> *</span>
<span class="cm"> * Contact: support@caviumnetworks.com</span>
<span class="cm"> * This file is part of the OCTEON SDK</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2003-2010 Cavium Networks</span>
<span class="cm"> *</span>
<span class="cm"> * This file is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License, Version 2, as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is distributed in the hope that it will be useful, but</span>
<span class="cm"> * AS-IS and WITHOUT ANY WARRANTY; without even the implied warranty</span>
<span class="cm"> * of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE, TITLE, or</span>
<span class="cm"> * NONINFRINGEMENT.  See the GNU General Public License for more</span>
<span class="cm"> * details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this file; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA</span>
<span class="cm"> * or visit http://www.gnu.org/licenses/.</span>
<span class="cm"> *</span>
<span class="cm"> * This file may also be available under a different license from Cavium.</span>
<span class="cm"> * Contact Cavium Networks for more information</span>
<span class="cm"> ***********************license end**************************************/</span>

<span class="cm">/*</span>
<span class="cm"> * Interface to the Level 2 Cache (L2C) control, measurement, and debugging</span>
<span class="cm"> * facilities.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __CVMX_L2C_H__</span>
<span class="cp">#define __CVMX_L2C_H__</span>

<span class="cp">#define CVMX_L2_ASSOC     cvmx_l2c_get_num_assoc()   </span><span class="cm">/* Deprecated macro, use function */</span><span class="cp"></span>
<span class="cp">#define CVMX_L2_SET_BITS  cvmx_l2c_get_set_bits()    </span><span class="cm">/* Deprecated macro, use function */</span><span class="cp"></span>
<span class="cp">#define CVMX_L2_SETS      cvmx_l2c_get_num_sets()    </span><span class="cm">/* Deprecated macro, use function */</span><span class="cp"></span>


<span class="cp">#define CVMX_L2C_IDX_ADDR_SHIFT 7  </span><span class="cm">/* based on 128 byte cache line size */</span><span class="cp"></span>
<span class="cp">#define CVMX_L2C_IDX_MASK       (cvmx_l2c_get_num_sets() - 1)</span>

<span class="cm">/* Defines for index aliasing computations */</span>
<span class="cp">#define CVMX_L2C_TAG_ADDR_ALIAS_SHIFT (CVMX_L2C_IDX_ADDR_SHIFT + cvmx_l2c_get_set_bits())</span>
<span class="cp">#define CVMX_L2C_ALIAS_MASK (CVMX_L2C_IDX_MASK &lt;&lt; CVMX_L2C_TAG_ADDR_ALIAS_SHIFT)</span>
<span class="cp">#define CVMX_L2C_MEMBANK_SELECT_SIZE  4096</span>

<span class="cm">/* Defines for Virtualizations, valid only from Octeon II onwards. */</span>
<span class="cp">#define CVMX_L2C_VRT_MAX_VIRTID_ALLOWED ((OCTEON_IS_MODEL(OCTEON_CN63XX)) ? 64 : 0)</span>
<span class="cp">#define CVMX_L2C_VRT_MAX_MEMSZ_ALLOWED ((OCTEON_IS_MODEL(OCTEON_CN63XX)) ? 32 : 0)</span>

<span class="k">union</span> <span class="n">cvmx_l2c_tag</span> <span class="p">{</span>
	<span class="kt">uint64_t</span> <span class="n">u64</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">uint64_t</span> <span class="n">reserved</span><span class="o">:</span><span class="mi">28</span><span class="p">;</span>
		<span class="kt">uint64_t</span> <span class="n">V</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Line valid */</span>
		<span class="kt">uint64_t</span> <span class="n">D</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Line dirty */</span>
		<span class="kt">uint64_t</span> <span class="n">L</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Line locked */</span>
		<span class="kt">uint64_t</span> <span class="n">U</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Use, LRU eviction */</span>
		<span class="kt">uint64_t</span> <span class="n">addr</span><span class="o">:</span><span class="mi">32</span><span class="p">;</span>	<span class="cm">/* Phys mem (not all bits valid) */</span>
	<span class="p">}</span> <span class="n">s</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Number of L2C Tag-and-data sections (TADs) that are connected to LMC. */</span>
<span class="cp">#define CVMX_L2C_TADS  1</span>

  <span class="cm">/* L2C Performance Counter events. */</span>
<span class="k">enum</span> <span class="n">cvmx_l2c_event</span> <span class="p">{</span>
	<span class="n">CVMX_L2C_EVENT_CYCLES</span>           <span class="o">=</span>  <span class="mi">0</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_INSTRUCTION_MISS</span> <span class="o">=</span>  <span class="mi">1</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_INSTRUCTION_HIT</span>  <span class="o">=</span>  <span class="mi">2</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_DATA_MISS</span>        <span class="o">=</span>  <span class="mi">3</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_DATA_HIT</span>         <span class="o">=</span>  <span class="mi">4</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_MISS</span>             <span class="o">=</span>  <span class="mi">5</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_HIT</span>              <span class="o">=</span>  <span class="mi">6</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_VICTIM_HIT</span>       <span class="o">=</span>  <span class="mi">7</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_INDEX_CONFLICT</span>   <span class="o">=</span>  <span class="mi">8</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_TAG_PROBE</span>        <span class="o">=</span>  <span class="mi">9</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_TAG_UPDATE</span>       <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_TAG_COMPLETE</span>     <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_TAG_DIRTY</span>        <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_DATA_STORE_NOP</span>   <span class="o">=</span> <span class="mi">13</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_DATA_STORE_READ</span>  <span class="o">=</span> <span class="mi">14</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_DATA_STORE_WRITE</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_FILL_DATA_VALID</span>  <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_WRITE_REQUEST</span>    <span class="o">=</span> <span class="mi">17</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_READ_REQUEST</span>     <span class="o">=</span> <span class="mi">18</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_WRITE_DATA_VALID</span> <span class="o">=</span> <span class="mi">19</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_NOP</span>          <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_LDT</span>          <span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_LDI</span>          <span class="o">=</span> <span class="mi">22</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_LDD</span>          <span class="o">=</span> <span class="mi">23</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_STF</span>          <span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_STT</span>          <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_STP</span>          <span class="o">=</span> <span class="mi">26</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_STC</span>          <span class="o">=</span> <span class="mi">27</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_DWB</span>          <span class="o">=</span> <span class="mi">28</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_PL2</span>          <span class="o">=</span> <span class="mi">29</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_PSL1</span>         <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_IOBLD</span>        <span class="o">=</span> <span class="mi">31</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_IOBST</span>        <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_IOBDMA</span>       <span class="o">=</span> <span class="mi">33</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_IOBRSP</span>       <span class="o">=</span> <span class="mi">34</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_BUS_VALID</span>    <span class="o">=</span> <span class="mi">35</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_MEM_DATA</span>     <span class="o">=</span> <span class="mi">36</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_REFL_DATA</span>    <span class="o">=</span> <span class="mi">37</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_XMC_IOBRSP_DATA</span>  <span class="o">=</span> <span class="mi">38</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_NOP</span>          <span class="o">=</span> <span class="mi">39</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_STDN</span>         <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_FILL</span>         <span class="o">=</span> <span class="mi">41</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_REFL</span>         <span class="o">=</span> <span class="mi">42</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_STIN</span>         <span class="o">=</span> <span class="mi">43</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_SCIN</span>         <span class="o">=</span> <span class="mi">44</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_SCFL</span>         <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_SCDN</span>         <span class="o">=</span> <span class="mi">46</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_DATA_VALID</span>   <span class="o">=</span> <span class="mi">47</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_VALID_FILL</span>   <span class="o">=</span> <span class="mi">48</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_VALID_STRSP</span>  <span class="o">=</span> <span class="mi">49</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_RSC_VALID_REFL</span>   <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_LRF_REQ</span>          <span class="o">=</span> <span class="mi">51</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_DT_RD_ALLOC</span>      <span class="o">=</span> <span class="mi">52</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_DT_WR_INVAL</span>      <span class="o">=</span> <span class="mi">53</span><span class="p">,</span>
	<span class="n">CVMX_L2C_EVENT_MAX</span>
<span class="p">};</span>

<span class="cm">/* L2C Performance Counter events for Octeon2. */</span>
<span class="k">enum</span> <span class="n">cvmx_l2c_tad_event</span> <span class="p">{</span>
	<span class="n">CVMX_L2C_TAD_EVENT_NONE</span>          <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_TAG_HIT</span>       <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_TAG_MISS</span>      <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_TAG_NOALLOC</span>   <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_TAG_VICTIM</span>    <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_SC_FAIL</span>       <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_SC_PASS</span>       <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_LFB_VALID</span>     <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_LFB_WAIT_LFB</span>  <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_LFB_WAIT_VAB</span>  <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD0_INDEX</span>   <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD0_READ</span>    <span class="o">=</span> <span class="mi">129</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD0_BANK</span>    <span class="o">=</span> <span class="mi">130</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD0_WDAT</span>    <span class="o">=</span> <span class="mi">131</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD1_INDEX</span>   <span class="o">=</span> <span class="mi">144</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD1_READ</span>    <span class="o">=</span> <span class="mi">145</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD1_BANK</span>    <span class="o">=</span> <span class="mi">146</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD1_WDAT</span>    <span class="o">=</span> <span class="mi">147</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD2_INDEX</span>   <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD2_READ</span>    <span class="o">=</span> <span class="mi">161</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD2_BANK</span>    <span class="o">=</span> <span class="mi">162</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD2_WDAT</span>    <span class="o">=</span> <span class="mi">163</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD3_INDEX</span>   <span class="o">=</span> <span class="mi">176</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD3_READ</span>    <span class="o">=</span> <span class="mi">177</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD3_BANK</span>    <span class="o">=</span> <span class="mi">178</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_QUAD3_WDAT</span>    <span class="o">=</span> <span class="mi">179</span><span class="p">,</span>
	<span class="n">CVMX_L2C_TAD_EVENT_MAX</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * Configure one of the four L2 Cache performance counters to capture event</span>
<span class="cm"> * occurrences.</span>
<span class="cm"> *</span>
<span class="cm"> * @counter:        The counter to configure. Range 0..3.</span>
<span class="cm"> * @event:          The type of L2 Cache event occurrence to count.</span>
<span class="cm"> * @clear_on_read:  When asserted, any read of the performance counter</span>
<span class="cm"> *                       clears the counter.</span>
<span class="cm"> *</span>
<span class="cm"> * @note The routine does not clear the counter.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">cvmx_l2c_config_perf</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">counter</span><span class="p">,</span> <span class="k">enum</span> <span class="n">cvmx_l2c_event</span> <span class="n">event</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">clear_on_read</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Read the given L2 Cache performance counter. The counter must be configured</span>
<span class="cm"> * before reading, but this routine does not enforce this requirement.</span>
<span class="cm"> *</span>
<span class="cm"> * @counter:  The counter to configure. Range 0..3.</span>
<span class="cm"> *</span>
<span class="cm"> * Returns The current counter value.</span>
<span class="cm"> */</span>
<span class="kt">uint64_t</span> <span class="n">cvmx_l2c_read_perf</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">counter</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Return the L2 Cache way partitioning for a given core.</span>
<span class="cm"> *</span>
<span class="cm"> * @core:  The core processor of interest.</span>
<span class="cm"> *</span>
<span class="cm"> * Returns    The mask specifying the partitioning. 0 bits in mask indicates</span>
<span class="cm"> *              the cache &#39;ways&#39; that a core can evict from.</span>
<span class="cm"> *            -1 on error</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_get_core_way_partition</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">core</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Partitions the L2 cache for a core</span>
<span class="cm"> *</span>
<span class="cm"> * @core: The core that the partitioning applies to.</span>
<span class="cm"> * @mask: The partitioning of the ways expressed as a binary</span>
<span class="cm"> *             mask. A 0 bit allows the core to evict cache lines from</span>
<span class="cm"> *             a way, while a 1 bit blocks the core from evicting any</span>
<span class="cm"> *             lines from that way. There must be at least one allowed</span>
<span class="cm"> *             way (0 bit) in the mask.</span>
<span class="cm"> *</span>

<span class="cm"> * @note If any ways are blocked for all cores and the HW blocks, then</span>
<span class="cm"> *       those ways will never have any cache lines evicted from them.</span>
<span class="cm"> *       All cores and the hardware blocks are free to read from all</span>
<span class="cm"> *       ways regardless of the partitioning.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_set_core_way_partition</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">core</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">mask</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Return the L2 Cache way partitioning for the hw blocks.</span>
<span class="cm"> *</span>
<span class="cm"> * Returns    The mask specifying the reserved way. 0 bits in mask indicates</span>
<span class="cm"> *              the cache &#39;ways&#39; that a core can evict from.</span>
<span class="cm"> *            -1 on error</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_get_hw_way_partition</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Partitions the L2 cache for the hardware blocks.</span>
<span class="cm"> *</span>
<span class="cm"> * @mask: The partitioning of the ways expressed as a binary</span>
<span class="cm"> *             mask. A 0 bit allows the core to evict cache lines from</span>
<span class="cm"> *             a way, while a 1 bit blocks the core from evicting any</span>
<span class="cm"> *             lines from that way. There must be at least one allowed</span>
<span class="cm"> *             way (0 bit) in the mask.</span>
<span class="cm"> *</span>

<span class="cm"> * @note If any ways are blocked for all cores and the HW blocks, then</span>
<span class="cm"> *       those ways will never have any cache lines evicted from them.</span>
<span class="cm"> *       All cores and the hardware blocks are free to read from all</span>
<span class="cm"> *       ways regardless of the partitioning.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_set_hw_way_partition</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">mask</span><span class="p">);</span>


<span class="cm">/**</span>
<span class="cm"> * Locks a line in the L2 cache at the specified physical address</span>
<span class="cm"> *</span>
<span class="cm"> * @addr:   physical address of line to lock</span>
<span class="cm"> *</span>
<span class="cm"> * Returns 0 on success,</span>
<span class="cm"> *         1 if line not locked.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_lock_line</span><span class="p">(</span><span class="kt">uint64_t</span> <span class="n">addr</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Locks a specified memory region in the L2 cache.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that if not all lines can be locked, that means that all</span>
<span class="cm"> * but one of the ways (associations) available to the locking</span>
<span class="cm"> * core are locked.  Having only 1 association available for</span>
<span class="cm"> * normal caching may have a significant adverse affect on performance.</span>
<span class="cm"> * Care should be taken to ensure that enough of the L2 cache is left</span>
<span class="cm"> * unlocked to allow for normal caching of DRAM.</span>
<span class="cm"> *</span>
<span class="cm"> * @start:  Physical address of the start of the region to lock</span>
<span class="cm"> * @len:    Length (in bytes) of region to lock</span>
<span class="cm"> *</span>
<span class="cm"> * Returns Number of requested lines that where not locked.</span>
<span class="cm"> *         0 on success (all locked)</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_lock_mem_region</span><span class="p">(</span><span class="kt">uint64_t</span> <span class="n">start</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Unlock and flush a cache line from the L2 cache.</span>
<span class="cm"> * IMPORTANT: Must only be run by one core at a time due to use</span>
<span class="cm"> * of L2C debug features.</span>
<span class="cm"> * Note that this function will flush a matching but unlocked cache line.</span>
<span class="cm"> * (If address is not in L2, no lines are flushed.)</span>
<span class="cm"> *</span>
<span class="cm"> * @address: Physical address to unlock</span>
<span class="cm"> *</span>
<span class="cm"> * Returns 0: line not unlocked</span>
<span class="cm"> *         1: line unlocked</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_unlock_line</span><span class="p">(</span><span class="kt">uint64_t</span> <span class="n">address</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Unlocks a region of memory that is locked in the L2 cache</span>
<span class="cm"> *</span>
<span class="cm"> * @start:  start physical address</span>
<span class="cm"> * @len:    length (in bytes) to unlock</span>
<span class="cm"> *</span>
<span class="cm"> * Returns Number of locked lines that the call unlocked</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_unlock_mem_region</span><span class="p">(</span><span class="kt">uint64_t</span> <span class="n">start</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Read the L2 controller tag for a given location in L2</span>
<span class="cm"> *</span>
<span class="cm"> * @association:</span>
<span class="cm"> *               Which association to read line from</span>
<span class="cm"> * @index:  Which way to read from.</span>
<span class="cm"> *</span>
<span class="cm"> * Returns l2c tag structure for line requested.</span>
<span class="cm"> */</span>
<span class="k">union</span> <span class="n">cvmx_l2c_tag</span> <span class="n">cvmx_l2c_get_tag</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">association</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">index</span><span class="p">);</span>

<span class="cm">/* Wrapper providing a deprecated old function name */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">union</span> <span class="n">cvmx_l2c_tag</span> <span class="n">cvmx_get_l2c_tag</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">association</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">index</span><span class="p">)</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">deprecated</span><span class="p">));</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">union</span> <span class="n">cvmx_l2c_tag</span> <span class="nf">cvmx_get_l2c_tag</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">association</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">index</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cvmx_l2c_get_tag</span><span class="p">(</span><span class="n">association</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/**</span>
<span class="cm"> * Returns the cache index for a given physical address</span>
<span class="cm"> *</span>
<span class="cm"> * @addr:   physical address</span>
<span class="cm"> *</span>
<span class="cm"> * Returns L2 cache index</span>
<span class="cm"> */</span>
<span class="kt">uint32_t</span> <span class="n">cvmx_l2c_address_to_index</span><span class="p">(</span><span class="kt">uint64_t</span> <span class="n">addr</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Flushes (and unlocks) the entire L2 cache.</span>
<span class="cm"> * IMPORTANT: Must only be run by one core at a time due to use</span>
<span class="cm"> * of L2C debug features.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">cvmx_l2c_flush</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> *</span>
<span class="cm"> * Returns Returns the size of the L2 cache in bytes,</span>
<span class="cm"> * -1 on error (unrecognized model)</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_get_cache_size_bytes</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Return the number of sets in the L2 Cache</span>
<span class="cm"> *</span>
<span class="cm"> * Returns</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_get_num_sets</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Return log base 2 of the number of sets in the L2 cache</span>
<span class="cm"> * Returns</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_get_set_bits</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cm">/**</span>
<span class="cm"> * Return the number of associations in the L2 Cache</span>
<span class="cm"> *</span>
<span class="cm"> * Returns</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cvmx_l2c_get_num_assoc</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Flush a line from the L2 cache</span>
<span class="cm"> * This should only be called from one core at a time, as this routine</span>
<span class="cm"> * sets the core to the &#39;debug&#39; core in order to flush the line.</span>
<span class="cm"> *</span>
<span class="cm"> * @assoc:  Association (or way) to flush</span>
<span class="cm"> * @index:  Index to flush</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">cvmx_l2c_flush_line</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">assoc</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">index</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __CVMX_L2C_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
