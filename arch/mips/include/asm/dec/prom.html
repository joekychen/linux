<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › dec › prom.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>prom.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *	include/asm-mips/dec/prom.h</span>
<span class="cm"> *</span>
<span class="cm"> *	DECstation PROM interface.</span>
<span class="cm"> *</span>
<span class="cm"> *	Copyright (C) 2002  Maciej W. Rozycki</span>
<span class="cm"> *</span>
<span class="cm"> *	This program is free software; you can redistribute it and/or</span>
<span class="cm"> *	modify it under the terms of the GNU General Public License</span>
<span class="cm"> *	as published by the Free Software Foundation; either version</span>
<span class="cm"> *	2 of the License, or (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *	Based on arch/mips/dec/prom/prom.h by the Anonymous.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef _ASM_DEC_PROM_H</span>
<span class="cp">#define _ASM_DEC_PROM_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#include &lt;asm/addrspace.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * PMAX/3MAX PROM entry points for DS2100/3100&#39;s and DS5000/2xx&#39;s.</span>
<span class="cm"> * Many of these will work for MIPSen as well!</span>
<span class="cm"> */</span>
<span class="cp">#define VEC_RESET		(u64 *)CKSEG1ADDR(0x1fc00000)</span>
							<span class="cm">/* Prom base address */</span>

<span class="cp">#define PMAX_PROM_ENTRY(x)	(VEC_RESET + (x))	</span><span class="cm">/* Prom jump table */</span><span class="cp"></span>

<span class="cp">#define PMAX_PROM_HALT		PMAX_PROM_ENTRY(2)	</span><span class="cm">/* valid on MIPSen */</span><span class="cp"></span>
<span class="cp">#define PMAX_PROM_AUTOBOOT	PMAX_PROM_ENTRY(5)	</span><span class="cm">/* valid on MIPSen */</span><span class="cp"></span>
<span class="cp">#define PMAX_PROM_OPEN		PMAX_PROM_ENTRY(6)</span>
<span class="cp">#define PMAX_PROM_READ		PMAX_PROM_ENTRY(7)</span>
<span class="cp">#define PMAX_PROM_CLOSE		PMAX_PROM_ENTRY(10)</span>
<span class="cp">#define PMAX_PROM_LSEEK		PMAX_PROM_ENTRY(11)</span>
<span class="cp">#define PMAX_PROM_GETCHAR	PMAX_PROM_ENTRY(12)</span>
<span class="cp">#define PMAX_PROM_PUTCHAR	PMAX_PROM_ENTRY(13)	</span><span class="cm">/* 12 on MIPSen */</span><span class="cp"></span>
<span class="cp">#define PMAX_PROM_GETS		PMAX_PROM_ENTRY(15)</span>
<span class="cp">#define PMAX_PROM_PRINTF	PMAX_PROM_ENTRY(17)</span>
<span class="cp">#define PMAX_PROM_GETENV	PMAX_PROM_ENTRY(33)	</span><span class="cm">/* valid on MIPSen */</span><span class="cp"></span>


<span class="cm">/*</span>
<span class="cm"> * Magic number indicating REX PROM available on DECstation.  Found in</span>
<span class="cm"> * register a2 on transfer of control to program from PROM.</span>
<span class="cm"> */</span>
<span class="cp">#define REX_PROM_MAGIC		0x30464354</span>

<span class="cp">#ifdef CONFIG_64BIT</span>

<span class="cp">#define prom_is_rex(magic)	1	</span><span class="cm">/* KN04 and KN05 are REX PROMs.  */</span><span class="cp"></span>

<span class="cp">#else </span><span class="cm">/* !CONFIG_64BIT */</span><span class="cp"></span>

<span class="cp">#define prom_is_rex(magic)	((magic) == REX_PROM_MAGIC)</span>

<span class="cp">#endif </span><span class="cm">/* !CONFIG_64BIT */</span><span class="cp"></span>


<span class="cm">/*</span>
<span class="cm"> * 3MIN/MAXINE PROM entry points for DS5000/1xx&#39;s, DS5000/xx&#39;s and</span>
<span class="cm"> * DS5000/2x0.</span>
<span class="cm"> */</span>
<span class="cp">#define REX_PROM_GETBITMAP	0x84/4	</span><span class="cm">/* get mem bitmap */</span><span class="cp"></span>
<span class="cp">#define REX_PROM_GETCHAR	0x24/4	</span><span class="cm">/* getch() */</span><span class="cp"></span>
<span class="cp">#define REX_PROM_GETENV		0x64/4	</span><span class="cm">/* get env. variable */</span><span class="cp"></span>
<span class="cp">#define REX_PROM_GETSYSID	0x80/4	</span><span class="cm">/* get system id */</span><span class="cp"></span>
<span class="cp">#define REX_PROM_GETTCINFO	0xa4/4</span>
<span class="cp">#define REX_PROM_PRINTF		0x30/4	</span><span class="cm">/* printf() */</span><span class="cp"></span>
<span class="cp">#define REX_PROM_SLOTADDR	0x6c/4	</span><span class="cm">/* slotaddr */</span><span class="cp"></span>
<span class="cp">#define REX_PROM_BOOTINIT	0x54/4	</span><span class="cm">/* open() */</span><span class="cp"></span>
<span class="cp">#define REX_PROM_BOOTREAD	0x58/4	</span><span class="cm">/* read() */</span><span class="cp"></span>
<span class="cp">#define REX_PROM_CLEARCACHE	0x7c/4</span>


<span class="cm">/*</span>
<span class="cm"> * Used by rex_getbitmap().</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">pagesize</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span> <span class="n">memmap</span><span class="p">;</span>


<span class="cm">/*</span>
<span class="cm"> * Function pointers as read from a PROM&#39;s callback vector.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">__rex_bootinit</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">__rex_bootread</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">__rex_getbitmap</span><span class="p">)(</span><span class="n">memmap</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">__rex_slot_address</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">__rex_gettcinfo</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">__rex_getsysid</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">__rex_clear_cache</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">__prom_getchar</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">__prom_getenv</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">__prom_printf</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="p">...);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">__pmax_open</span><span class="p">)(</span><span class="kt">char</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">__pmax_lseek</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">long</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">__pmax_read</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">__pmax_close</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>


<span class="cp">#ifdef CONFIG_64BIT</span>

<span class="cm">/*</span>
<span class="cm"> * On MIPS64 we have to call PROM functions via a helper</span>
<span class="cm"> * dispatcher to accommodate ABI incompatibilities.</span>
<span class="cm"> */</span>
<span class="cp">#define __DEC_PROM_O32(fun, arg) fun arg __asm__(#fun); \</span>
<span class="cp">				 __asm__(#fun &quot; = call_o32&quot;)</span>

<span class="kt">int</span> <span class="n">__DEC_PROM_O32</span><span class="p">(</span><span class="n">_rex_bootinit</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="p">)));</span>
<span class="kt">int</span> <span class="n">__DEC_PROM_O32</span><span class="p">(</span><span class="n">_rex_bootread</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="p">)));</span>
<span class="kt">int</span> <span class="n">__DEC_PROM_O32</span><span class="p">(</span><span class="n">_rex_getbitmap</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">memmap</span> <span class="o">*</span><span class="p">),</span> <span class="n">memmap</span> <span class="o">*</span><span class="p">));</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">__DEC_PROM_O32</span><span class="p">(</span><span class="n">_rex_slot_address</span><span class="p">,</span>
			     <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">int</span><span class="p">),</span> <span class="kt">int</span><span class="p">));</span>
<span class="kt">void</span> <span class="o">*</span><span class="n">__DEC_PROM_O32</span><span class="p">(</span><span class="n">_rex_gettcinfo</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="p">)));</span>
<span class="kt">int</span> <span class="n">__DEC_PROM_O32</span><span class="p">(</span><span class="n">_rex_getsysid</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="p">)));</span>
<span class="kt">void</span> <span class="n">__DEC_PROM_O32</span><span class="p">(</span><span class="n">_rex_clear_cache</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="p">)));</span>

<span class="kt">int</span> <span class="n">__DEC_PROM_O32</span><span class="p">(</span><span class="n">_prom_getchar</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">void</span><span class="p">)));</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">__DEC_PROM_O32</span><span class="p">(</span><span class="n">_prom_getenv</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="p">),</span> <span class="kt">char</span> <span class="o">*</span><span class="p">));</span>
<span class="kt">int</span> <span class="n">__DEC_PROM_O32</span><span class="p">(</span><span class="n">_prom_printf</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="p">...),</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="p">...));</span>


<span class="cp">#define rex_bootinit()		_rex_bootinit(__rex_bootinit)</span>
<span class="cp">#define rex_bootread()		_rex_bootread(__rex_bootread)</span>
<span class="cp">#define rex_getbitmap(x)	_rex_getbitmap(__rex_getbitmap, x)</span>
<span class="cp">#define rex_slot_address(x)	_rex_slot_address(__rex_slot_address, x)</span>
<span class="cp">#define rex_gettcinfo()		_rex_gettcinfo(__rex_gettcinfo)</span>
<span class="cp">#define rex_getsysid()		_rex_getsysid(__rex_getsysid)</span>
<span class="cp">#define rex_clear_cache()	_rex_clear_cache(__rex_clear_cache)</span>

<span class="cp">#define prom_getchar()		_prom_getchar(__prom_getchar)</span>
<span class="cp">#define prom_getenv(x)		_prom_getenv(__prom_getenv, x)</span>
<span class="cp">#define prom_printf(x...)	_prom_printf(__prom_printf, x)</span>

<span class="cp">#else </span><span class="cm">/* !CONFIG_64BIT */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * On plain MIPS we just call PROM functions directly.</span>
<span class="cm"> */</span>
<span class="cp">#define rex_bootinit		__rex_bootinit</span>
<span class="cp">#define rex_bootread		__rex_bootread</span>
<span class="cp">#define rex_getbitmap		__rex_getbitmap</span>
<span class="cp">#define rex_slot_address	__rex_slot_address</span>
<span class="cp">#define rex_gettcinfo		__rex_gettcinfo</span>
<span class="cp">#define rex_getsysid		__rex_getsysid</span>
<span class="cp">#define rex_clear_cache		__rex_clear_cache</span>

<span class="cp">#define prom_getchar		__prom_getchar</span>
<span class="cp">#define prom_getenv		__prom_getenv</span>
<span class="cp">#define prom_printf		__prom_printf</span>

<span class="cp">#define pmax_open		__pmax_open</span>
<span class="cp">#define pmax_lseek		__pmax_lseek</span>
<span class="cp">#define pmax_read		__pmax_read</span>
<span class="cp">#define pmax_close		__pmax_close</span>

<span class="cp">#endif </span><span class="cm">/* !CONFIG_64BIT */</span><span class="cp"></span>


<span class="k">extern</span> <span class="kt">void</span> <span class="n">prom_meminit</span><span class="p">(</span><span class="n">u32</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">prom_identify_arch</span><span class="p">(</span><span class="n">u32</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">prom_init_cmdline</span><span class="p">(</span><span class="n">s32</span><span class="p">,</span> <span class="n">s32</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">register_prom_console</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">unregister_prom_console</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_DEC_PROM_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
