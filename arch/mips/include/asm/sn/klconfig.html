<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › sn › klconfig.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>klconfig.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * Derived from IRIX &lt;sys/SN/klconfig.h&gt;.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1992 - 1997, 1999, 2000 Silicon Graphics, Inc.</span>
<span class="cm"> * Copyright (C) 1999, 2000 by Ralf Baechle</span>
<span class="cm"> */</span>
<span class="cp">#ifndef	_ASM_SN_KLCONFIG_H</span>
<span class="cp">#define	_ASM_SN_KLCONFIG_H</span>

<span class="cm">/*</span>
<span class="cm"> * The KLCONFIG structures store info about the various BOARDs found</span>
<span class="cm"> * during Hardware Discovery. In addition, it stores info about the</span>
<span class="cm"> * components found on the BOARDs.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * WARNING:</span>
<span class="cm"> *	Certain assembly language routines (notably xxxxx.s) in the IP27PROM</span>
<span class="cm"> *	will depend on the format of the data structures in this file.  In</span>
<span class="cm"> *      most cases, rearranging the fields can seriously break things.</span>
<span class="cm"> *      Adding fields in the beginning or middle can also break things.</span>
<span class="cm"> *      Add fields if necessary, to the end of a struct in such a way</span>
<span class="cm"> *      that offsets of existing fields do not change.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;asm/sn/types.h&gt;</span>

<span class="cp">#if defined(CONFIG_SGI_IP27)</span>

<span class="cp">#include &lt;asm/sn/sn0/addrs.h&gt;</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><h1>include <sys/SN/router.h></h1>

<p>XXX Stolen from <sys/SN/router.h>:</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define MAX_ROUTER_PORTS (6)    </span><span class="cm">/* Max. number of ports on a router */</span><span class="cp"></span>
<span class="cp">#include &lt;asm/sn/fru.h&gt;</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><h1>include <sys/graph.h></h1>

<h1>include <sys/xtalk/xbow.h></h1></td><td class="code"><div class="highlight"><pre><span class="cp">#elif defined(CONFIG_SGI_IP35)</span>

<span class="cp">#include &lt;asm/sn/sn1/addrs.h&gt;</span>
<span class="cp">#include &lt;sys/sn/router.h&gt;</span>
<span class="cp">#include &lt;sys/graph.h&gt;</span>
<span class="cp">#include &lt;asm/xtalk/xbow.h&gt;</span>

<span class="cp">#endif </span><span class="cm">/* !CONFIG_SGI_IP27 &amp;&amp; !CONFIG_SGI_IP35 */</span><span class="cp"></span>

<span class="cp">#if defined(CONFIG_SGI_IP27) || defined(CONFIG_SGI_IP35)</span>
<span class="cp">#include &lt;asm/sn/agent.h&gt;</span>
<span class="cp">#include &lt;asm/fw/arc/types.h&gt;</span>
<span class="cp">#include &lt;asm/fw/arc/hinv.h&gt;</span>
<span class="cp">#if defined(CONFIG_SGI_IP35)</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>The hack file has to be before vector and after sn0_fru....</p></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;asm/hack.h&gt;</span>
<span class="cp">#include &lt;asm/sn/vector.h&gt;</span>
<span class="cp">#include &lt;asm/xtalk/xtalk.h&gt;</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_SGI_IP35 */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_SGI_IP27 || CONFIG_SGI_IP35 */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="n">u64</span>  <span class="n">nic_t</span><span class="p">;</span>

<span class="cp">#define KLCFGINFO_MAGIC	0xbeedbabe</span>

<span class="k">typedef</span> <span class="n">s32</span> <span class="n">klconf_off_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Some IMPORTANT OFFSETS. These are the offsets on all NODES.</span>
<span class="cm"> */</span>
<span class="cp">#define	MAX_MODULE_ID		255</span>
<span class="cp">#define SIZE_PAD		4096 </span><span class="cm">/* 4k padding for structures */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm"> * 1 NODE brd, 2 Router brd (1 8p, 1 meta), 6 Widgets,</span>
<span class="cm"> * 2 Midplanes assuming no pci card cages</span>
<span class="cm"> */</span>
<span class="cp">#define MAX_SLOTS_PER_NODE	(1 + 2 + 6 + 2)</span>

<span class="cm">/* XXX if each node is guaranteed to have some memory */</span>

<span class="cp">#define MAX_PCI_DEVS		8</span>

<span class="cm">/* lboard_t-&gt;brd_flags fields */</span>
<span class="cm">/* All bits in this field are currently used. Try the pad fields if</span>
<span class="cm">   you need more flag bits */</span>

<span class="cp">#define ENABLE_BOARD 		0x01</span>
<span class="cp">#define FAILED_BOARD  		0x02</span>
<span class="cp">#define DUPLICATE_BOARD 	0x04    </span><span class="cm">/* Boards like midplanes/routers which</span>
<span class="cm">					   are discovered twice. Use one of them */</span><span class="cp"></span>
<span class="cp">#define VISITED_BOARD		0x08	</span><span class="cm">/* Used for compact hub numbering. */</span><span class="cp"></span>
<span class="cp">#define LOCAL_MASTER_IO6	0x10 	</span><span class="cm">/* master io6 for that node */</span><span class="cp"></span>
<span class="cp">#define GLOBAL_MASTER_IO6	0x20</span>
<span class="cp">#define THIRD_NIC_PRESENT 	0x40  	</span><span class="cm">/* for future use */</span><span class="cp"></span>
<span class="cp">#define SECOND_NIC_PRESENT 	0x80 	</span><span class="cm">/* addons like MIO are present */</span><span class="cp"></span>

<span class="cm">/* klinfo-&gt;flags fields */</span>

<span class="cp">#define KLINFO_ENABLE 		0x01    </span><span class="cm">/* This component is enabled */</span><span class="cp"></span>
<span class="cp">#define KLINFO_FAILED   	0x02 	</span><span class="cm">/* This component failed */</span><span class="cp"></span>
<span class="cp">#define KLINFO_DEVICE   	0x04 	</span><span class="cm">/* This component is a device */</span><span class="cp"></span>
<span class="cp">#define KLINFO_VISITED  	0x08 	</span><span class="cm">/* This component has been visited */</span><span class="cp"></span>
<span class="cp">#define KLINFO_CONTROLLER   	0x10 	</span><span class="cm">/* This component is a device controller */</span><span class="cp"></span>
<span class="cp">#define KLINFO_INSTALL   	0x20  	</span><span class="cm">/* Install a driver */</span><span class="cp"></span>
<span class="cp">#define	KLINFO_HEADLESS		0x40	</span><span class="cm">/* Headless (or hubless) component */</span><span class="cp"></span>
<span class="cp">#define IS_CONSOLE_IOC3(i)	((((klinfo_t *)i)-&gt;flags) &amp; KLINFO_INSTALL)</span>

<span class="cp">#define GB2		0x80000000</span>

<span class="cp">#define MAX_RSV_PTRS	32</span>

<span class="cm">/* Structures to manage various data storage areas */</span>
<span class="cm">/* The numbers must be contiguous since the array index i</span>
<span class="cm">   is used in the code to allocate various areas.</span>
<span class="cm">*/</span>

<span class="cp">#define BOARD_STRUCT 		0</span>
<span class="cp">#define COMPONENT_STRUCT 	1</span>
<span class="cp">#define ERRINFO_STRUCT 		2</span>
<span class="cp">#define KLMALLOC_TYPE_MAX 	(ERRINFO_STRUCT + 1)</span>
<span class="cp">#define DEVICE_STRUCT 		3</span>


<span class="k">typedef</span> <span class="k">struct</span> <span class="n">console_s</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> 	<span class="n">uart_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> 	<span class="n">config_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> 	<span class="n">memory_base</span><span class="p">;</span>
	<span class="kt">short</span>		<span class="n">baud</span><span class="p">;</span>
	<span class="kt">short</span>		<span class="n">flag</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">type</span><span class="p">;</span>
	<span class="n">nasid_t</span>		<span class="n">nasid</span><span class="p">;</span>
	<span class="kt">char</span>		<span class="n">wid</span><span class="p">;</span>
	<span class="kt">char</span> 		<span class="n">npci</span><span class="p">;</span>
	<span class="n">nic_t</span>		<span class="n">baseio_nic</span><span class="p">;</span>
<span class="p">}</span> <span class="n">console_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klc_malloc_hdr</span> <span class="p">{</span>
        <span class="n">klconf_off_t</span> <span class="n">km_base</span><span class="p">;</span>
        <span class="n">klconf_off_t</span> <span class="n">km_limit</span><span class="p">;</span>
        <span class="n">klconf_off_t</span> <span class="n">km_current</span><span class="p">;</span>
<span class="p">}</span> <span class="n">klc_malloc_hdr_t</span><span class="p">;</span>

<span class="cm">/* Functions/macros needed to use this structure */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">kl_config_hdr</span> <span class="p">{</span>
	<span class="n">u64</span>		<span class="n">ch_magic</span><span class="p">;</span>	<span class="cm">/* set this to KLCFGINFO_MAGIC */</span>
	<span class="n">u32</span>		<span class="n">ch_version</span><span class="p">;</span>    <span class="cm">/* structure version number */</span>
	<span class="n">klconf_off_t</span>	<span class="n">ch_malloc_hdr_off</span><span class="p">;</span> <span class="cm">/* offset of ch_malloc_hdr */</span>
	<span class="n">klconf_off_t</span>	<span class="n">ch_cons_off</span><span class="p">;</span>       <span class="cm">/* offset of ch_cons */</span>
	<span class="n">klconf_off_t</span>	<span class="n">ch_board_info</span><span class="p">;</span>	<span class="cm">/* the link list of boards */</span>
	<span class="n">console_t</span>	<span class="n">ch_cons_info</span><span class="p">;</span>	<span class="cm">/* address info of the console */</span>
	<span class="n">klc_malloc_hdr_t</span> <span class="n">ch_malloc_hdr</span><span class="p">[</span><span class="n">KLMALLOC_TYPE_MAX</span><span class="p">];</span>
	<span class="n">confidence_t</span>	<span class="n">ch_sw_belief</span><span class="p">;</span>	<span class="cm">/* confidence that software is bad*/</span>
	<span class="n">confidence_t</span>	<span class="n">ch_sn0net_belief</span><span class="p">;</span> <span class="cm">/* confidence that sn0net is bad */</span>
<span class="p">}</span> <span class="n">kl_config_hdr_t</span><span class="p">;</span>


<span class="cp">#define KL_CONFIG_HDR(_nasid) 	((kl_config_hdr_t *)(KLCONFIG_ADDR(_nasid)))</span>
<span class="cp">#define KL_CONFIG_INFO_OFFSET(_nasid)					\</span>
<span class="cp">        (KL_CONFIG_HDR(_nasid)-&gt;ch_board_info)</span>
<span class="cp">#define KL_CONFIG_INFO_SET_OFFSET(_nasid, _off)				\</span>
<span class="cp">        (KL_CONFIG_HDR(_nasid)-&gt;ch_board_info = (_off))</span>

<span class="cp">#define KL_CONFIG_INFO(_nasid) 						\</span>
<span class="cp">        (lboard_t *)((KL_CONFIG_HDR(_nasid)-&gt;ch_board_info) ?		\</span>
<span class="cp">	 NODE_OFFSET_TO_K1((_nasid), KL_CONFIG_HDR(_nasid)-&gt;ch_board_info) : \</span>
<span class="cp">	 0)</span>
<span class="cp">#define KL_CONFIG_MAGIC(_nasid)		(KL_CONFIG_HDR(_nasid)-&gt;ch_magic)</span>

<span class="cp">#define KL_CONFIG_CHECK_MAGIC(_nasid)					\</span>
<span class="cp">        (KL_CONFIG_HDR(_nasid)-&gt;ch_magic == KLCFGINFO_MAGIC)</span>

<span class="cp">#define KL_CONFIG_HDR_INIT_MAGIC(_nasid)	\</span>
<span class="cp">                  (KL_CONFIG_HDR(_nasid)-&gt;ch_magic = KLCFGINFO_MAGIC)</span>

<span class="cm">/* --- New Macros for the changed kl_config_hdr_t structure --- */</span>

<span class="cp">#define PTR_CH_MALLOC_HDR(_k)   ((klc_malloc_hdr_t *)\</span>
<span class="cp">			((unsigned long)_k + (_k-&gt;ch_malloc_hdr_off)))</span>

<span class="cp">#define KL_CONFIG_CH_MALLOC_HDR(_n)   PTR_CH_MALLOC_HDR(KL_CONFIG_HDR(_n))</span>

<span class="cp">#define PTR_CH_CONS_INFO(_k)	((console_t *)\</span>
<span class="cp">			((unsigned long)_k + (_k-&gt;ch_cons_off)))</span>

<span class="cp">#define KL_CONFIG_CH_CONS_INFO(_n)   PTR_CH_CONS_INFO(KL_CONFIG_HDR(_n))</span>

<span class="cm">/* ------------------------------------------------------------- */</span>

<span class="cp">#define KL_CONFIG_INFO_START(_nasid)	\</span>
<span class="cp">        (klconf_off_t)(KLCONFIG_OFFSET(_nasid) + sizeof(kl_config_hdr_t))</span>

<span class="cp">#define KL_CONFIG_BOARD_NASID(_brd)	((_brd)-&gt;brd_nasid)</span>
<span class="cp">#define KL_CONFIG_BOARD_SET_NEXT(_brd, _off)	((_brd)-&gt;brd_next = (_off))</span>

<span class="cp">#define KL_CONFIG_DUPLICATE_BOARD(_brd)	((_brd)-&gt;brd_flags &amp; DUPLICATE_BOARD)</span>

<span class="cp">#define XBOW_PORT_TYPE_HUB(_xbowp, _link) 	\</span>
<span class="cp">               ((_xbowp)-&gt;xbow_port_info[(_link) - BASE_XBOW_PORT].port_flag &amp; XBOW_PORT_HUB)</span>
<span class="cp">#define XBOW_PORT_TYPE_IO(_xbowp, _link) 	\</span>
<span class="cp">               ((_xbowp)-&gt;xbow_port_info[(_link) - BASE_XBOW_PORT].port_flag &amp; XBOW_PORT_IO)</span>

<span class="cp">#define XBOW_PORT_IS_ENABLED(_xbowp, _link) 	\</span>
<span class="cp">               ((_xbowp)-&gt;xbow_port_info[(_link) - BASE_XBOW_PORT].port_flag &amp; XBOW_PORT_ENABLE)</span>
<span class="cp">#define XBOW_PORT_NASID(_xbowp, _link) 	\</span>
<span class="cp">               ((_xbowp)-&gt;xbow_port_info[(_link) - BASE_XBOW_PORT].port_nasid)</span>

<span class="cp">#define XBOW_PORT_IO     0x1</span>
<span class="cp">#define XBOW_PORT_HUB    0x2</span>
<span class="cp">#define XBOW_PORT_ENABLE 0x4</span>

<span class="cp">#define	SN0_PORT_FENCE_SHFT	0</span>
<span class="cp">#define	SN0_PORT_FENCE_MASK	(1 &lt;&lt; SN0_PORT_FENCE_SHFT)</span>

<span class="cm">/*</span>
<span class="cm"> * The KLCONFIG area is organized as a LINKED LIST of BOARDs. A BOARD</span>
<span class="cm"> * can be either &#39;LOCAL&#39; or &#39;REMOTE&#39;. LOCAL means it is attached to</span>
<span class="cm"> * the LOCAL/current NODE. REMOTE means it is attached to a different</span>
<span class="cm"> * node.(TBD - Need a way to treat ROUTER boards.)</span>
<span class="cm"> *</span>
<span class="cm"> * There are 2 different structures to represent these boards -</span>
<span class="cm"> * lboard - Local board, rboard - remote board. These 2 structures</span>
<span class="cm"> * can be arbitrarily mixed in the LINKED LIST of BOARDs. (Refer</span>
<span class="cm"> * Figure below). The first byte of the rboard or lboard structure</span>
<span class="cm"> * is used to find out its type - no unions are used.</span>
<span class="cm"> * If it is a lboard, then the config info of this board will be found</span>
<span class="cm"> * on the local node. (LOCAL NODE BASE + offset value gives pointer to</span>
<span class="cm"> * the structure.</span>
<span class="cm"> * If it is a rboard, the local structure contains the node number</span>
<span class="cm"> * and the offset of the beginning of the LINKED LIST on the remote node.</span>
<span class="cm"> * The details of the hardware on a remote node can be built locally,</span>
<span class="cm"> * if required, by reading the LINKED LIST on the remote node and</span>
<span class="cm"> * ignoring all the rboards on that node.</span>
<span class="cm"> *</span>
<span class="cm"> * The local node uses the REMOTE NODE NUMBER + OFFSET to point to the</span>
<span class="cm"> * First board info on the remote node. The remote node list is</span>
<span class="cm"> * traversed as the local list, using the REMOTE BASE ADDRESS and not</span>
<span class="cm"> * the local base address and ignoring all rboard values.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> KLCONFIG</span>

<span class="cm"> +------------+      +------------+      +------------+      +------------+</span>
<span class="cm"> |  lboard    |  +--&gt;|   lboard   |  +--&gt;|   rboard   |  +--&gt;|   lboard   |</span>
<span class="cm"> +------------+  |   +------------+  |   +------------+  |   +------------+</span>
<span class="cm"> | board info |  |   | board info |  |   |errinfo,bptr|  |   | board info |</span>
<span class="cm"> +------------+  |   +------------+  |   +------------+  |   +------------+</span>
<span class="cm"> | offset     |--+   |  offset    |--+   |  offset    |--+   |offset=NULL |</span>
<span class="cm"> +------------+      +------------+      +------------+      +------------+</span>


<span class="cm"> +------------+</span>
<span class="cm"> | board info |</span>
<span class="cm"> +------------+       +--------------------------------+</span>
<span class="cm"> | compt 1    |------&gt;| type, rev, diaginfo, size ...  |  (CPU)</span>
<span class="cm"> +------------+       +--------------------------------+</span>
<span class="cm"> | compt 2    |--+</span>
<span class="cm"> +------------+  |    +--------------------------------+</span>
<span class="cm"> |  ...       |  +---&gt;| type, rev, diaginfo, size ...  |  (MEM_BANK)</span>
<span class="cm"> +------------+       +--------------------------------+</span>
<span class="cm"> | errinfo    |--+</span>
<span class="cm"> +------------+  |    +--------------------------------+</span>
<span class="cm">                 +---&gt;|r/l brd errinfo,compt err flags |</span>
<span class="cm">                      +--------------------------------+</span>

<span class="cm"> *</span>
<span class="cm"> * Each BOARD consists of COMPONENTs and the BOARD structure has</span>
<span class="cm"> * pointers (offsets) to its COMPONENT structure.</span>
<span class="cm"> * The COMPONENT structure has version info, size and speed info, revision,</span>
<span class="cm"> * error info and the NIC info. This structure can accommodate any</span>
<span class="cm"> * BOARD with arbitrary COMPONENT composition.</span>
<span class="cm"> *</span>
<span class="cm"> * The ERRORINFO part of each BOARD has error information</span>
<span class="cm"> * that describes errors about the BOARD itself. It also has flags to</span>
<span class="cm"> * indicate the COMPONENT(s) on the board that have errors. The error</span>
<span class="cm"> * information specific to the COMPONENT is present in the respective</span>
<span class="cm"> * COMPONENT structure.</span>
<span class="cm"> *</span>
<span class="cm"> * The ERRORINFO structure is also treated like a COMPONENT, ie. the</span>
<span class="cm"> * BOARD has pointers(offset) to the ERRORINFO structure. The rboard</span>
<span class="cm"> * structure also has a pointer to the ERRORINFO structure. This is</span>
<span class="cm"> * the place to store ERRORINFO about a REMOTE NODE, if the HUB on</span>
<span class="cm"> * that NODE is not working or if the REMOTE MEMORY is BAD. In cases where</span>
<span class="cm"> * only the CPU of the REMOTE NODE is disabled, the ERRORINFO pointer can</span>
<span class="cm"> * be a NODE NUMBER, REMOTE OFFSET combination, pointing to error info</span>
<span class="cm"> * which is present on the REMOTE NODE.(TBD)</span>
<span class="cm"> * REMOTE ERRINFO can be stored on any of the nearest nodes</span>
<span class="cm"> * or on all the nearest nodes.(TBD)</span>
<span class="cm"> * Like BOARD structures, REMOTE ERRINFO structures can be built locally</span>
<span class="cm"> * using the rboard errinfo pointer.</span>
<span class="cm"> *</span>
<span class="cm"> * In order to get useful information from this Data organization, a set of</span>
<span class="cm"> * interface routines are provided (TBD). The important thing to remember while</span>
<span class="cm"> * manipulating the structures, is that, the NODE number information should</span>
<span class="cm"> * be used. If the NODE is non-zero (remote) then each offset should</span>
<span class="cm"> * be added to the REMOTE BASE ADDR else it should be added to the LOCAL BASE ADDR.</span>
<span class="cm"> * This includes offsets for BOARDS, COMPONENTS and ERRORINFO.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that these structures do not provide much info about connectivity.</span>
<span class="cm"> * That info will be part of HWGRAPH, which is an extension of the cfg_t</span>
<span class="cm"> * data structure. (ref IP27prom/cfg.h) It has to be extended to include</span>
<span class="cm"> * the IO part of the Network(TBD).</span>
<span class="cm"> *</span>
<span class="cm"> * The data structures below define the above concepts.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Values for CPU types</span>
<span class="cm"> */</span>
<span class="cp">#define KL_CPU_R4000		0x1	</span><span class="cm">/* Standard R4000 */</span><span class="cp"></span>
<span class="cp">#define KL_CPU_TFP		0x2	</span><span class="cm">/* TFP processor */</span><span class="cp"></span>
<span class="cp">#define	KL_CPU_R10000		0x3	</span><span class="cm">/* R10000 (T5) */</span><span class="cp"></span>
<span class="cp">#define KL_CPU_NONE		(-1)	</span><span class="cm">/* no cpu present in slot */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * IP27 BOARD classes</span>
<span class="cm"> */</span>

<span class="cp">#define KLCLASS_MASK	0xf0</span>
<span class="cp">#define KLCLASS_NONE	0x00</span>
<span class="cp">#define KLCLASS_NODE	0x10             </span><span class="cm">/* CPU, Memory and HUB board */</span><span class="cp"></span>
<span class="cp">#define KLCLASS_CPU	KLCLASS_NODE</span>
<span class="cp">#define KLCLASS_IO	0x20             </span><span class="cm">/* BaseIO, 4 ch SCSI, ethernet, FDDI</span>
<span class="cm">					    and the non-graphics widget boards */</span><span class="cp"></span>
<span class="cp">#define KLCLASS_ROUTER	0x30             </span><span class="cm">/* Router board */</span><span class="cp"></span>
<span class="cp">#define KLCLASS_MIDPLANE 0x40            </span><span class="cm">/* We need to treat this as a board</span>
<span class="cm">                                            so that we can record error info */</span><span class="cp"></span>
<span class="cp">#define KLCLASS_GFX	0x50		</span><span class="cm">/* graphics boards */</span><span class="cp"></span>

<span class="cp">#define KLCLASS_PSEUDO_GFX	0x60	</span><span class="cm">/* HDTV type cards that use a gfx</span>
<span class="cm">					 * hw ifc to xtalk and are not gfx</span>
<span class="cm">					 * class for sw purposes */</span><span class="cp"></span>

<span class="cp">#define KLCLASS_MAX	7		</span><span class="cm">/* Bump this if a new CLASS is added */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_MAX	10		</span><span class="cm">/* Bump this if a new CLASS is added */</span><span class="cp"></span>

<span class="cp">#define KLCLASS_UNKNOWN	0xf0</span>

<span class="cp">#define KLCLASS(_x) ((_x) &amp; KLCLASS_MASK)</span>

<span class="cm">/*</span>
<span class="cm"> * IP27 board types</span>
<span class="cm"> */</span>

<span class="cp">#define KLTYPE_MASK	0x0f</span>
<span class="cp">#define KLTYPE_NONE	0x00</span>
<span class="cp">#define KLTYPE_EMPTY	0x00</span>

<span class="cp">#define KLTYPE_WEIRDCPU (KLCLASS_CPU | 0x0)</span>
<span class="cp">#define KLTYPE_IP27	(KLCLASS_CPU | 0x1) </span><span class="cm">/* 2 CPUs(R10K) per board */</span><span class="cp"></span>

<span class="cp">#define KLTYPE_WEIRDIO	(KLCLASS_IO  | 0x0)</span>
<span class="cp">#define KLTYPE_BASEIO	(KLCLASS_IO  | 0x1) </span><span class="cm">/* IOC3, SuperIO, Bridge, SCSI */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_IO6	KLTYPE_BASEIO       </span><span class="cm">/* Additional name */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_4CHSCSI	(KLCLASS_IO  | 0x2)</span>
<span class="cp">#define KLTYPE_MSCSI	KLTYPE_4CHSCSI      </span><span class="cm">/* Additional name */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_ETHERNET	(KLCLASS_IO  | 0x3)</span>
<span class="cp">#define KLTYPE_MENET	KLTYPE_ETHERNET     </span><span class="cm">/* Additional name */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_FDDI  	(KLCLASS_IO  | 0x4)</span>
<span class="cp">#define KLTYPE_UNUSED	(KLCLASS_IO  | 0x5) </span><span class="cm">/* XXX UNUSED */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_HAROLD   (KLCLASS_IO  | 0x6) </span><span class="cm">/* PCI SHOE BOX */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_PCI	KLTYPE_HAROLD</span>
<span class="cp">#define KLTYPE_VME      (KLCLASS_IO  | 0x7) </span><span class="cm">/* Any 3rd party VME card */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_MIO   	(KLCLASS_IO  | 0x8)</span>
<span class="cp">#define KLTYPE_FC    	(KLCLASS_IO  | 0x9)</span>
<span class="cp">#define KLTYPE_LINC    	(KLCLASS_IO  | 0xA)</span>
<span class="cp">#define KLTYPE_TPU    	(KLCLASS_IO  | 0xB) </span><span class="cm">/* Tensor Processing Unit */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_GSN_A   	(KLCLASS_IO  | 0xC) </span><span class="cm">/* Main GSN board */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_GSN_B   	(KLCLASS_IO  | 0xD) </span><span class="cm">/* Auxiliary GSN board */</span><span class="cp"></span>

<span class="cp">#define KLTYPE_GFX	(KLCLASS_GFX | 0x0) </span><span class="cm">/* unknown graphics type */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_GFX_KONA (KLCLASS_GFX | 0x1) </span><span class="cm">/* KONA graphics on IP27 */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_GFX_MGRA (KLCLASS_GFX | 0x3) </span><span class="cm">/* MGRAS graphics on IP27 */</span><span class="cp"></span>

<span class="cp">#define KLTYPE_WEIRDROUTER (KLCLASS_ROUTER | 0x0)</span>
<span class="cp">#define KLTYPE_ROUTER     (KLCLASS_ROUTER | 0x1)</span>
<span class="cp">#define KLTYPE_ROUTER2    KLTYPE_ROUTER		</span><span class="cm">/* Obsolete! */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_NULL_ROUTER (KLCLASS_ROUTER | 0x2)</span>
<span class="cp">#define KLTYPE_META_ROUTER (KLCLASS_ROUTER | 0x3)</span>

<span class="cp">#define KLTYPE_WEIRDMIDPLANE (KLCLASS_MIDPLANE | 0x0)</span>
<span class="cp">#define KLTYPE_MIDPLANE8  (KLCLASS_MIDPLANE | 0x1) </span><span class="cm">/* 8 slot backplane */</span><span class="cp"></span>
<span class="cp">#define KLTYPE_MIDPLANE    KLTYPE_MIDPLANE8</span>
<span class="cp">#define KLTYPE_PBRICK_XBOW	(KLCLASS_MIDPLANE | 0x2)</span>

<span class="cp">#define KLTYPE_IOBRICK		(KLCLASS_IOBRICK | 0x0)</span>
<span class="cp">#define KLTYPE_IBRICK		(KLCLASS_IOBRICK | 0x1)</span>
<span class="cp">#define KLTYPE_PBRICK		(KLCLASS_IOBRICK | 0x2)</span>
<span class="cp">#define KLTYPE_XBRICK		(KLCLASS_IOBRICK | 0x3)</span>

<span class="cp">#define KLTYPE_PBRICK_BRIDGE	KLTYPE_PBRICK</span>

<span class="cm">/* The value of type should be more than 8 so that hinv prints</span>
<span class="cm"> * out the board name from the NIC string. For values less than</span>
<span class="cm"> * 8 the name of the board needs to be hard coded in a few places.</span>
<span class="cm"> * When bringup started nic names had not standardized and so we</span>
<span class="cm"> * had to hard code. (For people interested in history.)</span>
<span class="cm"> */</span>
<span class="cp">#define KLTYPE_XTHD   	(KLCLASS_PSEUDO_GFX | 0x9)</span>

<span class="cp">#define KLTYPE_UNKNOWN	(KLCLASS_UNKNOWN | 0xf)</span>

<span class="cp">#define KLTYPE(_x) 	((_x) &amp; KLTYPE_MASK)</span>
<span class="cp">#define IS_MIO_PRESENT(l)	((l-&gt;brd_type == KLTYPE_BASEIO) &amp;&amp; \</span>
<span class="cp">				 (l-&gt;brd_flags &amp; SECOND_NIC_PRESENT))</span>
<span class="cp">#define IS_MIO_IOC3(l, n)	(IS_MIO_PRESENT(l) &amp;&amp; (n &gt; 2))</span>

<span class="cm">/*</span>
<span class="cm"> * board structures</span>
<span class="cm"> */</span>

<span class="cp">#define MAX_COMPTS_PER_BRD 24</span>

<span class="cp">#define LOCAL_BOARD 1</span>
<span class="cp">#define REMOTE_BOARD 2</span>

<span class="cp">#define LBOARD_STRUCT_VERSION 	2</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">lboard_s</span> <span class="p">{</span>
	<span class="n">klconf_off_t</span> 	<span class="n">brd_next</span><span class="p">;</span>         <span class="cm">/* Next BOARD */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">struct_type</span><span class="p">;</span>      <span class="cm">/* type of structure, local or remote */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_type</span><span class="p">;</span>         <span class="cm">/* type+class */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_sversion</span><span class="p">;</span>     <span class="cm">/* version of this structure */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_brevision</span><span class="p">;</span>    <span class="cm">/* board revision */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_promver</span><span class="p">;</span>      <span class="cm">/* board prom version, if any */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_flags</span><span class="p">;</span>        <span class="cm">/* Enabled, Disabled etc */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_slot</span><span class="p">;</span>         <span class="cm">/* slot number */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">brd_debugsw</span><span class="p">;</span>      <span class="cm">/* Debug switches */</span>
	<span class="n">moduleid_t</span>	<span class="n">brd_module</span><span class="p">;</span>       <span class="cm">/* module to which it belongs */</span>
	<span class="n">partid_t</span> 	<span class="n">brd_partition</span><span class="p">;</span>    <span class="cm">/* Partition number */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span> 	<span class="n">brd_diagval</span><span class="p">;</span>      <span class="cm">/* diagnostic value */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span> 	<span class="n">brd_diagparm</span><span class="p">;</span>     <span class="cm">/* diagnostic parameter */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_inventory</span><span class="p">;</span>    <span class="cm">/* inventory history */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_numcompts</span><span class="p">;</span>    <span class="cm">/* Number of components */</span>
        <span class="n">nic_t</span>         	<span class="n">brd_nic</span><span class="p">;</span>          <span class="cm">/* Number in CAN */</span>
	<span class="n">nasid_t</span>		<span class="n">brd_nasid</span><span class="p">;</span>        <span class="cm">/* passed parameter */</span>
	<span class="n">klconf_off_t</span> 	<span class="n">brd_compts</span><span class="p">[</span><span class="n">MAX_COMPTS_PER_BRD</span><span class="p">];</span> <span class="cm">/* pointers to COMPONENTS */</span>
	<span class="n">klconf_off_t</span> 	<span class="n">brd_errinfo</span><span class="p">;</span>      <span class="cm">/* Board&#39;s error information */</span>
	<span class="k">struct</span> <span class="n">lboard_s</span> <span class="o">*</span><span class="n">brd_parent</span><span class="p">;</span>	  <span class="cm">/* Logical parent for this brd */</span>
	<span class="n">vertex_hdl_t</span>	<span class="n">brd_graph_link</span><span class="p">;</span>   <span class="cm">/* vertex hdl to connect extern compts */</span>
	<span class="n">confidence_t</span>	<span class="n">brd_confidence</span><span class="p">;</span>	  <span class="cm">/* confidence that the board is bad */</span>
	<span class="n">nasid_t</span>		<span class="n">brd_owner</span><span class="p">;</span>        <span class="cm">/* who owns this board */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_nic_flags</span><span class="p">;</span>    <span class="cm">/* To handle 8 more NICs */</span>
	<span class="kt">char</span>		<span class="n">brd_name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="p">}</span> <span class="n">lboard_t</span><span class="p">;</span>


<span class="cm">/*</span>
<span class="cm"> *	Make sure we pass back the calias space address for local boards.</span>
<span class="cm"> *	klconfig board traversal and error structure extraction defines.</span>
<span class="cm"> */</span>

<span class="cp">#define BOARD_SLOT(_brd)	((_brd)-&gt;brd_slot)</span>

<span class="cp">#define KLCF_CLASS(_brd)	KLCLASS((_brd)-&gt;brd_type)</span>
<span class="cp">#define KLCF_TYPE(_brd)		KLTYPE((_brd)-&gt;brd_type)</span>
<span class="cp">#define KLCF_REMOTE(_brd)  	(((_brd)-&gt;struct_type &amp; LOCAL_BOARD) ? 0 : 1)</span>
<span class="cp">#define KLCF_NUM_COMPS(_brd)	((_brd)-&gt;brd_numcompts)</span>
<span class="cp">#define KLCF_MODULE_ID(_brd)	((_brd)-&gt;brd_module)</span>

<span class="cp">#define KLCF_NEXT(_brd) 	\</span>
<span class="cp">        ((_brd)-&gt;brd_next ? 	\</span>
<span class="cp">	 (lboard_t *)(NODE_OFFSET_TO_K1(NASID_GET(_brd), (_brd)-&gt;brd_next)):\</span>
<span class="cp">	 NULL)</span>
<span class="cp">#define KLCF_COMP(_brd, _ndx)   \</span>
<span class="cp">                (klinfo_t *)(NODE_OFFSET_TO_K1(NASID_GET(_brd),	\</span>
<span class="cp">					       (_brd)-&gt;brd_compts[(_ndx)]))</span>

<span class="cp">#define KLCF_COMP_ERROR(_brd, _comp)	\</span>
<span class="cp">               (NODE_OFFSET_TO_K1(NASID_GET(_brd), (_comp)-&gt;errinfo))</span>

<span class="cp">#define KLCF_COMP_TYPE(_comp)	((_comp)-&gt;struct_type)</span>
<span class="cp">#define KLCF_BRIDGE_W_ID(_comp)	((_comp)-&gt;physid)	</span><span class="cm">/* Widget ID */</span><span class="cp"></span>



<span class="cm">/*</span>
<span class="cm"> * Generic info structure. This stores common info about a</span>
<span class="cm"> * component.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klinfo_s</span> <span class="p">{</span>                  <span class="cm">/* Generic info */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">struct_type</span><span class="p">;</span>       <span class="cm">/* type of this structure */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">struct_version</span><span class="p">;</span>    <span class="cm">/* version of this structure */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">flags</span><span class="p">;</span>            <span class="cm">/* Enabled, disabled etc */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">revision</span><span class="p">;</span>         <span class="cm">/* component revision */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">diagval</span><span class="p">;</span>          <span class="cm">/* result of diagnostics */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">diagparm</span><span class="p">;</span>         <span class="cm">/* diagnostic parameter */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">inventory</span><span class="p">;</span>        <span class="cm">/* previous inventory status */</span>
	<span class="n">nic_t</span> 		<span class="n">nic</span><span class="p">;</span>              <span class="cm">/* MUst be aligned properly */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">physid</span><span class="p">;</span>           <span class="cm">/* physical id of component */</span>
        <span class="kt">unsigned</span> <span class="kt">int</span>    <span class="n">virtid</span><span class="p">;</span>           <span class="cm">/* virtual id as seen by system */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">widid</span><span class="p">;</span>	          <span class="cm">/* Widget id - if applicable */</span>
	<span class="n">nasid_t</span>		<span class="n">nasid</span><span class="p">;</span>            <span class="cm">/* node number - from parent */</span>
	<span class="kt">char</span>		<span class="n">pad1</span><span class="p">;</span>		  <span class="cm">/* pad out structure. */</span>
	<span class="kt">char</span>		<span class="n">pad2</span><span class="p">;</span>		  <span class="cm">/* pad out structure. */</span>
	<span class="n">COMPONENT</span>	<span class="o">*</span><span class="n">arcs_compt</span><span class="p">;</span>      <span class="cm">/* ptr to the arcs struct for ease*/</span>
        <span class="n">klconf_off_t</span>	<span class="n">errinfo</span><span class="p">;</span>          <span class="cm">/* component specific errors */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">pad3</span><span class="p">;</span>             <span class="cm">/* pci fields have moved over to */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">pad4</span><span class="p">;</span>             <span class="cm">/* klbri_t */</span>
<span class="p">}</span> <span class="n">klinfo_t</span> <span class="p">;</span>

<span class="cp">#define KLCONFIG_INFO_ENABLED(_i)	((_i)-&gt;flags &amp; KLINFO_ENABLE)</span>
<span class="cm">/*</span>
<span class="cm"> * Component structures.</span>
<span class="cm"> * Following are the currently identified components:</span>
<span class="cm"> * 	CPU, HUB, MEM_BANK,</span>
<span class="cm"> * 	XBOW(consists of 16 WIDGETs, each of which can be HUB or GRAPHICS or BRIDGE)</span>
<span class="cm"> * 	BRIDGE, IOC3, SuperIO, SCSI, FDDI</span>
<span class="cm"> * 	ROUTER</span>
<span class="cm"> * 	GRAPHICS</span>
<span class="cm"> */</span>
<span class="cp">#define KLSTRUCT_UNKNOWN	0</span>
<span class="cp">#define KLSTRUCT_CPU  		1</span>
<span class="cp">#define KLSTRUCT_HUB  		2</span>
<span class="cp">#define KLSTRUCT_MEMBNK 	3</span>
<span class="cp">#define KLSTRUCT_XBOW 		4</span>
<span class="cp">#define KLSTRUCT_BRI 		5</span>
<span class="cp">#define KLSTRUCT_IOC3 		6</span>
<span class="cp">#define KLSTRUCT_PCI 		7</span>
<span class="cp">#define KLSTRUCT_VME 		8</span>
<span class="cp">#define KLSTRUCT_ROU		9</span>
<span class="cp">#define KLSTRUCT_GFX 		10</span>
<span class="cp">#define KLSTRUCT_SCSI 		11</span>
<span class="cp">#define KLSTRUCT_FDDI 		12</span>
<span class="cp">#define KLSTRUCT_MIO 		13</span>
<span class="cp">#define KLSTRUCT_DISK 		14</span>
<span class="cp">#define KLSTRUCT_TAPE 		15</span>
<span class="cp">#define KLSTRUCT_CDROM 		16</span>
<span class="cp">#define KLSTRUCT_HUB_UART 	17</span>
<span class="cp">#define KLSTRUCT_IOC3ENET 	18</span>
<span class="cp">#define KLSTRUCT_IOC3UART 	19</span>
<span class="cp">#define KLSTRUCT_UNUSED		20 </span><span class="cm">/* XXX UNUSED */</span><span class="cp"></span>
<span class="cp">#define KLSTRUCT_IOC3PCKM       21</span>
<span class="cp">#define KLSTRUCT_RAD        	22</span>
<span class="cp">#define KLSTRUCT_HUB_TTY        23</span>
<span class="cp">#define KLSTRUCT_IOC3_TTY 	24</span>

<span class="cm">/* Early Access IO proms are compatible</span>
<span class="cm">   only with KLSTRUCT values up to 24. */</span>

<span class="cp">#define KLSTRUCT_FIBERCHANNEL 	25</span>
<span class="cp">#define KLSTRUCT_MOD_SERIAL_NUM 26</span>
<span class="cp">#define KLSTRUCT_IOC3MS         27</span>
<span class="cp">#define KLSTRUCT_TPU            28</span>
<span class="cp">#define KLSTRUCT_GSN_A          29</span>
<span class="cp">#define KLSTRUCT_GSN_B          30</span>
<span class="cp">#define KLSTRUCT_XTHD           31</span>

<span class="cm">/*</span>
<span class="cm"> * These are the indices of various components within a lboard structure.</span>
<span class="cm"> */</span>

<span class="cp">#define IP27_CPU0_INDEX 0</span>
<span class="cp">#define IP27_CPU1_INDEX 1</span>
<span class="cp">#define IP27_HUB_INDEX 2</span>
<span class="cp">#define IP27_MEM_INDEX 3</span>

<span class="cp">#define BASEIO_BRIDGE_INDEX 0</span>
<span class="cp">#define BASEIO_IOC3_INDEX 1</span>
<span class="cp">#define BASEIO_SCSI1_INDEX 2</span>
<span class="cp">#define BASEIO_SCSI2_INDEX 3</span>

<span class="cp">#define MIDPLANE_XBOW_INDEX 0</span>
<span class="cp">#define ROUTER_COMPONENT_INDEX 0</span>

<span class="cp">#define CH4SCSI_BRIDGE_INDEX 0</span>

<span class="cm">/* Info holders for various hardware components */</span>

<span class="k">typedef</span> <span class="n">u64</span> <span class="o">*</span><span class="n">pci_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">u64</span> <span class="o">*</span><span class="n">vmeb_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">u64</span> <span class="o">*</span><span class="n">vmed_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">u64</span> <span class="o">*</span><span class="n">fddi_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">u64</span> <span class="o">*</span><span class="n">scsi_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">u64</span> <span class="o">*</span><span class="n">mio_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">u64</span> <span class="o">*</span><span class="n">graphics_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">u64</span> <span class="o">*</span><span class="n">router_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * The port info in ip27_cfg area translates to a lboart_t in the</span>
<span class="cm"> * KLCONFIG area. But since KLCONFIG does not use pointers, lboart_t</span>
<span class="cm"> * is stored in terms of a nasid and a offset from start of KLCONFIG</span>
<span class="cm"> * area  on that nasid.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klport_s</span> <span class="p">{</span>
	<span class="n">nasid_t</span>		<span class="n">port_nasid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">port_flag</span><span class="p">;</span>
	<span class="n">klconf_off_t</span>	<span class="n">port_offset</span><span class="p">;</span>
<span class="p">}</span> <span class="n">klport_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klcpu_s</span> <span class="p">{</span>                          <span class="cm">/* CPU */</span>
	<span class="n">klinfo_t</span> 	<span class="n">cpu_info</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> 	<span class="n">cpu_prid</span><span class="p">;</span>	<span class="cm">/* Processor PRID value */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> 	<span class="n">cpu_fpirr</span><span class="p">;</span>	<span class="cm">/* FPU IRR value */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> 	<span class="n">cpu_speed</span><span class="p">;</span>	<span class="cm">/* Speed in MHZ */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> 	<span class="n">cpu_scachesz</span><span class="p">;</span>	<span class="cm">/* secondary cache size in MB */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> 	<span class="n">cpu_scachespeed</span><span class="p">;</span><span class="cm">/* secondary cache speed in MHz */</span>
<span class="p">}</span> <span class="n">klcpu_t</span> <span class="p">;</span>

<span class="cp">#define CPU_STRUCT_VERSION   2</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klhub_s</span> <span class="p">{</span>			<span class="cm">/* HUB */</span>
	<span class="n">klinfo_t</span> 	<span class="n">hub_info</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> 		<span class="n">hub_flags</span><span class="p">;</span>		<span class="cm">/* PCFG_HUB_xxx flags */</span>
	<span class="n">klport_t</span>	<span class="n">hub_port</span><span class="p">;</span>		<span class="cm">/* hub is connected to this */</span>
	<span class="n">nic_t</span>		<span class="n">hub_box_nic</span><span class="p">;</span>		<span class="cm">/* nic of containing box */</span>
	<span class="n">klconf_off_t</span>	<span class="n">hub_mfg_nic</span><span class="p">;</span>		<span class="cm">/* MFG NIC string */</span>
	<span class="n">u64</span>		<span class="n">hub_speed</span><span class="p">;</span>		<span class="cm">/* Speed of hub in HZ */</span>
<span class="p">}</span> <span class="n">klhub_t</span> <span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klhub_uart_s</span> <span class="p">{</span>			<span class="cm">/* HUB */</span>
	<span class="n">klinfo_t</span> 	<span class="n">hubuart_info</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> 		<span class="n">hubuart_flags</span><span class="p">;</span>		<span class="cm">/* PCFG_HUB_xxx flags */</span>
	<span class="n">nic_t</span>		<span class="n">hubuart_box_nic</span><span class="p">;</span>	<span class="cm">/* nic of containing box */</span>
<span class="p">}</span> <span class="n">klhub_uart_t</span> <span class="p">;</span>

<span class="cp">#define MEMORY_STRUCT_VERSION   2</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klmembnk_s</span> <span class="p">{</span>			<span class="cm">/* MEMORY BANK */</span>
	<span class="n">klinfo_t</span> 	<span class="n">membnk_info</span><span class="p">;</span>
	<span class="kt">short</span> 		<span class="n">membnk_memsz</span><span class="p">;</span>		<span class="cm">/* Total memory in megabytes */</span>
	<span class="kt">short</span>		<span class="n">membnk_dimm_select</span><span class="p">;</span> <span class="cm">/* bank to physical addr mapping*/</span>
	<span class="kt">short</span>		<span class="n">membnk_bnksz</span><span class="p">[</span><span class="n">MD_MEM_BANKS</span><span class="p">];</span> <span class="cm">/* Memory bank sizes */</span>
	<span class="kt">short</span>		<span class="n">membnk_attr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">klmembnk_t</span> <span class="p">;</span>

<span class="cp">#define KLCONFIG_MEMBNK_SIZE(_info, _bank)	\</span>
<span class="cp">                            ((_info)-&gt;membnk_bnksz[(_bank)])</span>


<span class="cp">#define MEMBNK_PREMIUM 1</span>
<span class="cp">#define KLCONFIG_MEMBNK_PREMIUM(_info, _bank)	\</span>
<span class="cp">                            ((_info)-&gt;membnk_attr &amp; (MEMBNK_PREMIUM &lt;&lt; (_bank)))</span>

<span class="cp">#define MAX_SERIAL_NUM_SIZE 10</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klmod_serial_num_s</span> <span class="p">{</span>
      <span class="n">klinfo_t</span>        <span class="n">snum_info</span><span class="p">;</span>
      <span class="k">union</span> <span class="p">{</span>
              <span class="kt">char</span> <span class="n">snum_str</span><span class="p">[</span><span class="n">MAX_SERIAL_NUM_SIZE</span><span class="p">];</span>
              <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span>       <span class="n">snum_int</span><span class="p">;</span>
      <span class="p">}</span> <span class="n">snum</span><span class="p">;</span>
<span class="p">}</span> <span class="n">klmod_serial_num_t</span><span class="p">;</span>

<span class="cm">/* Macros needed to access serial number structure in lboard_t.</span>
<span class="cm">   Hard coded values are necessary since we cannot treat</span>
<span class="cm">   serial number struct as a component without losing compatibility</span>
<span class="cm">   between prom versions. */</span>

<span class="cp">#define GET_SNUM_COMP(_l) 	((klmod_serial_num_t *)\</span>
<span class="cp">				KLCF_COMP(_l, _l-&gt;brd_numcompts))</span>

<span class="cp">#define MAX_XBOW_LINKS 16</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klxbow_s</span> <span class="p">{</span>                          <span class="cm">/* XBOW */</span>
	<span class="n">klinfo_t</span> 	<span class="n">xbow_info</span> <span class="p">;</span>
	<span class="n">klport_t</span>	<span class="n">xbow_port_info</span><span class="p">[</span><span class="n">MAX_XBOW_LINKS</span><span class="p">]</span> <span class="p">;</span> <span class="cm">/* Module number */</span>
        <span class="kt">int</span>		<span class="n">xbow_master_hub_link</span><span class="p">;</span>
        <span class="cm">/* type of brd connected+component struct ptr+flags */</span>
<span class="p">}</span> <span class="n">klxbow_t</span> <span class="p">;</span>

<span class="cp">#define MAX_PCI_SLOTS 8</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klpci_device_s</span> <span class="p">{</span>
	<span class="n">s32</span>	<span class="n">pci_device_id</span><span class="p">;</span>	<span class="cm">/* 32 bits of vendor/device ID. */</span>
	<span class="n">s32</span>	<span class="n">pci_device_pad</span><span class="p">;</span>	<span class="cm">/* 32 bits of padding. */</span>
<span class="p">}</span> <span class="n">klpci_device_t</span><span class="p">;</span>

<span class="cp">#define BRIDGE_STRUCT_VERSION	2</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klbri_s</span> <span class="p">{</span>                          <span class="cm">/* BRIDGE */</span>
	<span class="n">klinfo_t</span> 	<span class="n">bri_info</span> <span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">bri_eprominfo</span> <span class="p">;</span>    <span class="cm">/* IO6prom connected to bridge */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">bri_bustype</span> <span class="p">;</span>      <span class="cm">/* PCI/VME BUS bridge/GIO */</span>
	<span class="n">pci_t</span>    	<span class="n">pci_specific</span>  <span class="p">;</span>    <span class="cm">/* PCI Board config info */</span>
	<span class="n">klpci_device_t</span>	<span class="n">bri_devices</span><span class="p">[</span><span class="n">MAX_PCI_DEVS</span><span class="p">]</span> <span class="p">;</span>	<span class="cm">/* PCI IDs */</span>
	<span class="n">klconf_off_t</span>	<span class="n">bri_mfg_nic</span> <span class="p">;</span>
<span class="p">}</span> <span class="n">klbri_t</span> <span class="p">;</span>

<span class="cp">#define MAX_IOC3_TTY	2</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klioc3_s</span> <span class="p">{</span>                          <span class="cm">/* IOC3 */</span>
	<span class="n">klinfo_t</span> 	<span class="n">ioc3_info</span> <span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">ioc3_ssram</span> <span class="p">;</span>        <span class="cm">/* Info about ssram */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">ioc3_nvram</span> <span class="p">;</span>        <span class="cm">/* Info about nvram */</span>
	<span class="n">klinfo_t</span>	<span class="n">ioc3_superio</span> <span class="p">;</span>      <span class="cm">/* Info about superio */</span>
	<span class="n">klconf_off_t</span>	<span class="n">ioc3_tty_off</span> <span class="p">;</span>
	<span class="n">klinfo_t</span>	<span class="n">ioc3_enet</span> <span class="p">;</span>
	<span class="n">klconf_off_t</span>	<span class="n">ioc3_enet_off</span> <span class="p">;</span>
	<span class="n">klconf_off_t</span>	<span class="n">ioc3_kbd_off</span> <span class="p">;</span>
<span class="p">}</span> <span class="n">klioc3_t</span> <span class="p">;</span>

<span class="cp">#define MAX_VME_SLOTS 8</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klvmeb_s</span> <span class="p">{</span>                          <span class="cm">/* VME BRIDGE - PCI CTLR */</span>
	<span class="n">klinfo_t</span> 	<span class="n">vmeb_info</span> <span class="p">;</span>
	<span class="n">vmeb_t</span>		<span class="n">vmeb_specific</span> <span class="p">;</span>
	<span class="n">klconf_off_t</span>   	<span class="n">vmeb_brdinfo</span><span class="p">[</span><span class="n">MAX_VME_SLOTS</span><span class="p">]</span>   <span class="p">;</span>    <span class="cm">/* VME Board config info */</span>
<span class="p">}</span> <span class="n">klvmeb_t</span> <span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klvmed_s</span> <span class="p">{</span>                          <span class="cm">/* VME DEVICE - VME BOARD */</span>
	<span class="n">klinfo_t</span>	<span class="n">vmed_info</span> <span class="p">;</span>
	<span class="n">vmed_t</span>		<span class="n">vmed_specific</span> <span class="p">;</span>
	<span class="n">klconf_off_t</span>   	<span class="n">vmed_brdinfo</span><span class="p">[</span><span class="n">MAX_VME_SLOTS</span><span class="p">]</span>   <span class="p">;</span>    <span class="cm">/* VME Board config info */</span>
<span class="p">}</span> <span class="n">klvmed_t</span> <span class="p">;</span>

<span class="cp">#define ROUTER_VECTOR_VERS	2</span>

<span class="cm">/* XXX - Don&#39;t we need the number of ports here?!? */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klrou_s</span> <span class="p">{</span>                          <span class="cm">/* ROUTER */</span>
	<span class="n">klinfo_t</span> 	<span class="n">rou_info</span> <span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">rou_flags</span> <span class="p">;</span>           <span class="cm">/* PCFG_ROUTER_xxx flags */</span>
	<span class="n">nic_t</span>		<span class="n">rou_box_nic</span> <span class="p">;</span>         <span class="cm">/* nic of the containing module */</span>
	<span class="n">klport_t</span> 	<span class="n">rou_port</span><span class="p">[</span><span class="n">MAX_ROUTER_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="p">;</span> <span class="cm">/* array index 1 to 6 */</span>
	<span class="n">klconf_off_t</span>	<span class="n">rou_mfg_nic</span> <span class="p">;</span>     <span class="cm">/* MFG NIC string */</span>
	<span class="n">u64</span>	<span class="n">rou_vector</span><span class="p">;</span>	  <span class="cm">/* vector from master node */</span>
<span class="p">}</span> <span class="n">klrou_t</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> *  Graphics Controller/Device</span>
<span class="cm"> *</span>
<span class="cm"> *  (IP27/IO6) Prom versions 6.13 (and 6.5.1 kernels) and earlier</span>
<span class="cm"> *  used a couple different structures to store graphics information.</span>
<span class="cm"> *  For compatibility reasons, the newer data structure preserves some</span>
<span class="cm"> *  of the layout so that fields that are used in the old versions remain</span>
<span class="cm"> *  in the same place (with the same info).  Determination of what version</span>
<span class="cm"> *  of this structure we have is done by checking the cookie field.</span>
<span class="cm"> */</span>
<span class="cp">#define KLGFX_COOKIE	0x0c0de000</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klgfx_s</span> <span class="p">{</span>		<span class="cm">/* GRAPHICS Device */</span>
	<span class="n">klinfo_t</span> 	<span class="n">gfx_info</span><span class="p">;</span>
	<span class="n">klconf_off_t</span>    <span class="n">old_gndevs</span><span class="p">;</span>	<span class="cm">/* for compatibility with older proms */</span>
	<span class="n">klconf_off_t</span>    <span class="n">old_gdoff0</span><span class="p">;</span>	<span class="cm">/* for compatibility with older proms */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">cookie</span><span class="p">;</span>		<span class="cm">/* for compatibility with older proms */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">moduleslot</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">klgfx_s</span>	<span class="o">*</span><span class="n">gfx_next_pipe</span><span class="p">;</span>
	<span class="n">graphics_t</span>	<span class="n">gfx_specific</span><span class="p">;</span>
	<span class="n">klconf_off_t</span>    <span class="n">pad0</span><span class="p">;</span>		<span class="cm">/* for compatibility with older proms */</span>
	<span class="n">klconf_off_t</span>    <span class="n">gfx_mfg_nic</span><span class="p">;</span>
<span class="p">}</span> <span class="n">klgfx_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klxthd_s</span> <span class="p">{</span>
	<span class="n">klinfo_t</span> 	<span class="n">xthd_info</span> <span class="p">;</span>
	<span class="n">klconf_off_t</span>	<span class="n">xthd_mfg_nic</span> <span class="p">;</span>        <span class="cm">/* MFG NIC string */</span>
<span class="p">}</span> <span class="n">klxthd_t</span> <span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">kltpu_s</span> <span class="p">{</span>                     <span class="cm">/* TPU board */</span>
	<span class="n">klinfo_t</span> 	<span class="n">tpu_info</span> <span class="p">;</span>
	<span class="n">klconf_off_t</span>	<span class="n">tpu_mfg_nic</span> <span class="p">;</span>        <span class="cm">/* MFG NIC string */</span>
<span class="p">}</span> <span class="n">kltpu_t</span> <span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klgsn_s</span> <span class="p">{</span>                     <span class="cm">/* GSN board */</span>
	<span class="n">klinfo_t</span> 	<span class="n">gsn_info</span> <span class="p">;</span>
	<span class="n">klconf_off_t</span>	<span class="n">gsn_mfg_nic</span> <span class="p">;</span>        <span class="cm">/* MFG NIC string */</span>
<span class="p">}</span> <span class="n">klgsn_t</span> <span class="p">;</span>

<span class="cp">#define MAX_SCSI_DEVS 16</span>

<span class="cm">/*</span>
<span class="cm"> * NOTE: THis is the max sized kl* structure and is used in klmalloc.c</span>
<span class="cm"> * to allocate space of type COMPONENT. Make sure that if the size of</span>
<span class="cm"> * any other component struct becomes more than this, then redefine</span>
<span class="cm"> * that as the size to be klmalloced.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klscsi_s</span> <span class="p">{</span>                          <span class="cm">/* SCSI Controller */</span>
	<span class="n">klinfo_t</span> 	<span class="n">scsi_info</span> <span class="p">;</span>
	<span class="n">scsi_t</span>       	<span class="n">scsi_specific</span>   <span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">scsi_numdevs</span> <span class="p">;</span>
	<span class="n">klconf_off_t</span>	<span class="n">scsi_devinfo</span><span class="p">[</span><span class="n">MAX_SCSI_DEVS</span><span class="p">]</span> <span class="p">;</span>
<span class="p">}</span> <span class="n">klscsi_t</span> <span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klscdev_s</span> <span class="p">{</span>                          <span class="cm">/* SCSI device */</span>
	<span class="n">klinfo_t</span> 	<span class="n">scdev_info</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsidisk_data</span> <span class="o">*</span><span class="n">scdev_cfg</span> <span class="p">;</span> <span class="cm">/* driver fills up this */</span>
<span class="p">}</span> <span class="n">klscdev_t</span> <span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klttydev_s</span> <span class="p">{</span>                          <span class="cm">/* TTY device */</span>
	<span class="n">klinfo_t</span> 	<span class="n">ttydev_info</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">terminal_data</span> <span class="o">*</span><span class="n">ttydev_cfg</span> <span class="p">;</span> <span class="cm">/* driver fills up this */</span>
<span class="p">}</span> <span class="n">klttydev_t</span> <span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klenetdev_s</span> <span class="p">{</span>                          <span class="cm">/* ENET device */</span>
	<span class="n">klinfo_t</span> 	<span class="n">enetdev_info</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_data</span> <span class="o">*</span><span class="n">enetdev_cfg</span> <span class="p">;</span> <span class="cm">/* driver fills up this */</span>
<span class="p">}</span> <span class="n">klenetdev_t</span> <span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klkbddev_s</span> <span class="p">{</span>                          <span class="cm">/* KBD device */</span>
	<span class="n">klinfo_t</span> 	<span class="n">kbddev_info</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">keyboard_data</span> <span class="o">*</span><span class="n">kbddev_cfg</span> <span class="p">;</span> <span class="cm">/* driver fills up this */</span>
<span class="p">}</span> <span class="n">klkbddev_t</span> <span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klmsdev_s</span> <span class="p">{</span>                          <span class="cm">/* mouse device */</span>
        <span class="n">klinfo_t</span>        <span class="n">msdev_info</span> <span class="p">;</span>
        <span class="kt">void</span> 		<span class="o">*</span><span class="n">msdev_cfg</span> <span class="p">;</span>
<span class="p">}</span> <span class="n">klmsdev_t</span> <span class="p">;</span>

<span class="cp">#define MAX_FDDI_DEVS 10 </span><span class="cm">/* XXX Is this true */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klfddi_s</span> <span class="p">{</span>                          <span class="cm">/* FDDI */</span>
	<span class="n">klinfo_t</span> 	<span class="n">fddi_info</span> <span class="p">;</span>
	<span class="n">fddi_t</span>        	<span class="n">fddi_specific</span> <span class="p">;</span>
	<span class="n">klconf_off_t</span>	<span class="n">fddi_devinfo</span><span class="p">[</span><span class="n">MAX_FDDI_DEVS</span><span class="p">]</span> <span class="p">;</span>
<span class="p">}</span> <span class="n">klfddi_t</span> <span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klmio_s</span> <span class="p">{</span>                          <span class="cm">/* MIO */</span>
	<span class="n">klinfo_t</span> 	<span class="n">mio_info</span> <span class="p">;</span>
	<span class="n">mio_t</span>       	<span class="n">mio_specific</span>   <span class="p">;</span>
<span class="p">}</span> <span class="n">klmio_t</span> <span class="p">;</span>


<span class="k">typedef</span> <span class="k">union</span> <span class="n">klcomp_s</span> <span class="p">{</span>
	<span class="n">klcpu_t</span>		<span class="n">kc_cpu</span><span class="p">;</span>
	<span class="n">klhub_t</span>		<span class="n">kc_hub</span><span class="p">;</span>
	<span class="n">klmembnk_t</span> 	<span class="n">kc_mem</span><span class="p">;</span>
	<span class="n">klxbow_t</span>  	<span class="n">kc_xbow</span><span class="p">;</span>
	<span class="n">klbri_t</span>		<span class="n">kc_bri</span><span class="p">;</span>
	<span class="n">klioc3_t</span>	<span class="n">kc_ioc3</span><span class="p">;</span>
	<span class="n">klvmeb_t</span>	<span class="n">kc_vmeb</span><span class="p">;</span>
	<span class="n">klvmed_t</span>	<span class="n">kc_vmed</span><span class="p">;</span>
	<span class="n">klrou_t</span>		<span class="n">kc_rou</span><span class="p">;</span>
	<span class="n">klgfx_t</span>		<span class="n">kc_gfx</span><span class="p">;</span>
	<span class="n">klscsi_t</span>	<span class="n">kc_scsi</span><span class="p">;</span>
	<span class="n">klscdev_t</span>	<span class="n">kc_scsi_dev</span><span class="p">;</span>
	<span class="n">klfddi_t</span>	<span class="n">kc_fddi</span><span class="p">;</span>
	<span class="n">klmio_t</span>		<span class="n">kc_mio</span><span class="p">;</span>
	<span class="n">klmod_serial_num_t</span> <span class="n">kc_snum</span> <span class="p">;</span>
<span class="p">}</span> <span class="n">klcomp_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">kldev_s</span> <span class="p">{</span>      <span class="cm">/* for device structure allocation */</span>
	<span class="n">klscdev_t</span>	<span class="n">kc_scsi_dev</span> <span class="p">;</span>
	<span class="n">klttydev_t</span>	<span class="n">kc_tty_dev</span> <span class="p">;</span>
	<span class="n">klenetdev_t</span>	<span class="n">kc_enet_dev</span> <span class="p">;</span>
	<span class="n">klkbddev_t</span> 	<span class="n">kc_kbd_dev</span> <span class="p">;</span>
<span class="p">}</span> <span class="n">kldev_t</span> <span class="p">;</span>

<span class="cm">/* Data structure interface routines. TBD */</span>

<span class="cm">/* Include launch info in this file itself? TBD */</span>

<span class="cm">/*</span>
<span class="cm"> * TBD - Can the ARCS and device driver related info also be included in the</span>
<span class="cm"> * KLCONFIG area. On the IO4PROM, prom device driver info is part of cfgnode_t</span>
<span class="cm"> * structure, viz private to the IO4prom.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * TBD - Allocation issues.</span>
<span class="cm"> *</span>
<span class="cm"> * Do we need to Mark off sepatate heaps for lboard_t, rboard_t, component,</span>
<span class="cm"> * errinfo and allocate from them, or have a single heap and allocate all</span>
<span class="cm"> * structures from it. Debug is easier in the former method since we can</span>
<span class="cm"> * dump all similar structs in one command, but there will be lots of holes,</span>
<span class="cm"> * in memory and max limits are needed for number of structures.</span>
<span class="cm"> * Another way to make it organized, is to have a union of all components</span>
<span class="cm"> * and allocate a aligned chunk of memory greater than the biggest</span>
<span class="cm"> * component.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
	<span class="n">lboard_t</span> <span class="o">*</span><span class="n">lbinfo</span> <span class="p">;</span>
<span class="p">}</span> <span class="n">biptr_t</span> <span class="p">;</span>


<span class="cp">#define BRI_PER_XBOW 6</span>
<span class="cp">#define PCI_PER_BRI  8</span>
<span class="cp">#define DEV_PER_PCI  16</span>


<span class="cm">/* Virtual dipswitch values (starting from switch &quot;7&quot;): */</span>

<span class="cp">#define VDS_NOGFX		0x8000	</span><span class="cm">/* Don&#39;t enable gfx and autoboot */</span><span class="cp"></span>
<span class="cp">#define VDS_NOMP		0x100	</span><span class="cm">/* Don&#39;t start slave processors */</span><span class="cp"></span>
<span class="cp">#define VDS_MANUMODE		0x80	</span><span class="cm">/* Manufacturing mode */</span><span class="cp"></span>
<span class="cp">#define VDS_NOARB		0x40	</span><span class="cm">/* No bootmaster arbitration */</span><span class="cp"></span>
<span class="cp">#define VDS_PODMODE		0x20	</span><span class="cm">/* Go straight to POD mode */</span><span class="cp"></span>
<span class="cp">#define VDS_NO_DIAGS		0x10	</span><span class="cm">/* Don&#39;t run any diags after BM arb */</span><span class="cp"></span>
<span class="cp">#define VDS_DEFAULTS		0x08	</span><span class="cm">/* Use default environment values */</span><span class="cp"></span>
<span class="cp">#define VDS_NOMEMCLEAR		0x04	</span><span class="cm">/* Don&#39;t run mem cfg code */</span><span class="cp"></span>
<span class="cp">#define VDS_2ND_IO4		0x02	</span><span class="cm">/* Boot from the second IO4 */</span><span class="cp"></span>
<span class="cp">#define VDS_DEBUG_PROM		0x01	</span><span class="cm">/* Print PROM debugging messages */</span><span class="cp"></span>

<span class="cm">/* external declarations of Linux kernel functions. */</span>

<span class="k">extern</span> <span class="n">lboard_t</span> <span class="o">*</span><span class="n">find_lboard</span><span class="p">(</span><span class="n">lboard_t</span> <span class="o">*</span><span class="n">start</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">type</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">klinfo_t</span> <span class="o">*</span><span class="n">find_component</span><span class="p">(</span><span class="n">lboard_t</span> <span class="o">*</span><span class="n">brd</span><span class="p">,</span> <span class="n">klinfo_t</span> <span class="o">*</span><span class="n">kli</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">type</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">klinfo_t</span> <span class="o">*</span><span class="n">find_first_component</span><span class="p">(</span><span class="n">lboard_t</span> <span class="o">*</span><span class="n">brd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">type</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">klcpu_t</span> <span class="o">*</span><span class="n">nasid_slice_to_cpuinfo</span><span class="p">(</span><span class="n">nasid_t</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">lboard_t</span> <span class="o">*</span><span class="n">find_lboard_class</span><span class="p">(</span><span class="n">lboard_t</span> <span class="o">*</span><span class="n">start</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">brd_class</span><span class="p">);</span>


<span class="k">extern</span> <span class="n">klcpu_t</span> <span class="o">*</span><span class="n">sn_get_cpuinfo</span><span class="p">(</span><span class="n">cpuid_t</span> <span class="n">cpu</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_SN_KLCONFIG_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
