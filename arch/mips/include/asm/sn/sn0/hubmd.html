<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › sn › sn0 › hubmd.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../../index.html"></a><h1>hubmd.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * Derived from IRIX &lt;sys/SN/SN0/hubmd.h&gt;, revision 1.59.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1992 - 1997, 1999 Silicon Graphics, Inc.</span>
<span class="cm"> * Copyright (C) 1999 by Ralf Baechle</span>
<span class="cm"> */</span>
<span class="cp">#ifndef	_ASM_SN_SN0_HUBMD_H</span>
<span class="cp">#define	_ASM_SN_SN0_HUBMD_H</span>


<span class="cm">/*</span>
<span class="cm"> * Hub Memory/Directory interface registers</span>
<span class="cm"> */</span>
<span class="cp">#define CACHE_SLINE_SIZE        128	</span><span class="cm">/* Secondary cache line size on SN0 */</span><span class="cp"></span>

<span class="cp">#define	MAX_REGIONS		64</span>

<span class="cm">/* Hardware page size and shift */</span>

<span class="cp">#define MD_PAGE_SIZE		4096	 </span><span class="cm">/* Page size in bytes		    */</span><span class="cp"></span>
<span class="cp">#define MD_PAGE_NUM_SHFT	12	 </span><span class="cm">/* Address to page number shift    */</span><span class="cp"></span>

<span class="cm">/* Register offsets from LOCAL_HUB or REMOTE_HUB */</span>

<span class="cp">#define MD_BASE			0x200000</span>
<span class="cp">#define MD_BASE_PERF		0x210000</span>
<span class="cp">#define MD_BASE_JUNK		0x220000</span>

<span class="cp">#define MD_IO_PROTECT		0x200000 </span><span class="cm">/* MD and core register protection */</span><span class="cp"></span>
<span class="cp">#define MD_IO_PROT_OVRRD	0x200008 </span><span class="cm">/* Clear my bit in MD_IO_PROTECT   */</span><span class="cp"></span>
<span class="cp">#define MD_HSPEC_PROTECT	0x200010 </span><span class="cm">/* BDDIR, LBOOT, RBOOT protection  */</span><span class="cp"></span>
<span class="cp">#define MD_MEMORY_CONFIG	0x200018 </span><span class="cm">/* Memory/Directory DIMM control   */</span><span class="cp"></span>
<span class="cp">#define	MD_REFRESH_CONTROL	0x200020 </span><span class="cm">/* Memory/Directory refresh ctrl   */</span><span class="cp"></span>
<span class="cp">#define	MD_FANDOP_CAC_STAT	0x200028 </span><span class="cm">/* Fetch-and-op cache status 	    */</span><span class="cp"></span>
<span class="cp">#define	MD_MIG_DIFF_THRESH	0x200030 </span><span class="cm">/* Page migr. count diff thresh.   */</span><span class="cp"></span>
<span class="cp">#define	MD_MIG_VALUE_THRESH	0x200038 </span><span class="cm">/* Page migr. count abs. thresh.   */</span><span class="cp"></span>
<span class="cp">#define	MD_MIG_CANDIDATE	0x200040 </span><span class="cm">/* Latest page migration candidate */</span><span class="cp"></span>
<span class="cp">#define	MD_MIG_CANDIDATE_CLR	0x200048 </span><span class="cm">/* Clear page migration candidate  */</span><span class="cp"></span>
<span class="cp">#define MD_DIR_ERROR		0x200050 </span><span class="cm">/* Directory DIMM error 	    */</span><span class="cp"></span>
<span class="cp">#define MD_DIR_ERROR_CLR	0x200058 </span><span class="cm">/* Directory DIMM error clear 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PROTOCOL_ERROR	0x200060 </span><span class="cm">/* Directory protocol error 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PROTOCOL_ERROR_CLR	0x200068 </span><span class="cm">/* Directory protocol error clear  */</span><span class="cp"></span>
<span class="cp">#define MD_MEM_ERROR		0x200070 </span><span class="cm">/* Memory DIMM error 		    */</span><span class="cp"></span>
<span class="cp">#define MD_MEM_ERROR_CLR	0x200078 </span><span class="cm">/* Memory DIMM error clear 	    */</span><span class="cp"></span>
<span class="cp">#define MD_MISC_ERROR		0x200080 </span><span class="cm">/* Miscellaneous MD error 	    */</span><span class="cp"></span>
<span class="cp">#define MD_MISC_ERROR_CLR	0x200088 </span><span class="cm">/* Miscellaneous MD error clear    */</span><span class="cp"></span>
<span class="cp">#define MD_MEM_DIMM_INIT	0x200090 </span><span class="cm">/* Memory DIMM mode initization.   */</span><span class="cp"></span>
<span class="cp">#define MD_DIR_DIMM_INIT	0x200098 </span><span class="cm">/* Directory DIMM mode init. 	    */</span><span class="cp"></span>
<span class="cp">#define MD_MOQ_SIZE		0x2000a0 </span><span class="cm">/* MD outgoing queue size 	    */</span><span class="cp"></span>
<span class="cp">#define MD_MLAN_CTL		0x2000a8 </span><span class="cm">/* NIC (Microlan) control register */</span><span class="cp"></span>

<span class="cp">#define MD_PERF_SEL		0x210000 </span><span class="cm">/* Select perf monitor events 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PERF_CNT0		0x210010 </span><span class="cm">/* Performance counter 0 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PERF_CNT1		0x210018 </span><span class="cm">/* Performance counter 1 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PERF_CNT2		0x210020 </span><span class="cm">/* Performance counter 2 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PERF_CNT3		0x210028 </span><span class="cm">/* Performance counter 3 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PERF_CNT4		0x210030 </span><span class="cm">/* Performance counter 4 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PERF_CNT5		0x210038 </span><span class="cm">/* Performance counter 5 	    */</span><span class="cp"></span>

<span class="cp">#define MD_UREG0_0		0x220000 </span><span class="cm">/* uController/UART 0 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG0_1		0x220008 </span><span class="cm">/* uController/UART 0 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG0_2		0x220010 </span><span class="cm">/* uController/UART 0 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG0_3		0x220018 </span><span class="cm">/* uController/UART 0 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG0_4		0x220020 </span><span class="cm">/* uController/UART 0 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG0_5		0x220028 </span><span class="cm">/* uController/UART 0 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG0_6		0x220030 </span><span class="cm">/* uController/UART 0 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG0_7		0x220038 </span><span class="cm">/* uController/UART 0 register     */</span><span class="cp"></span>

<span class="cp">#define MD_SLOTID_USTAT		0x220048 </span><span class="cm">/* Hub slot ID &amp; UART/uCtlr status */</span><span class="cp"></span>
<span class="cp">#define MD_LED0			0x220050 </span><span class="cm">/* Eight-bit LED for CPU A 	    */</span><span class="cp"></span>
<span class="cp">#define MD_LED1			0x220058 </span><span class="cm">/* Eight-bit LED for CPU B 	    */</span><span class="cp"></span>

<span class="cp">#define MD_UREG1_0		0x220080 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_1		0x220088 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_2		0x220090 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_3		0x220098 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_4		0x2200a0 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_5		0x2200a8 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_6		0x2200b0 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_7		0x2200b8 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_8		0x2200c0 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_9		0x2200c8 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_10		0x2200d0 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_11		0x2200d8 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_12		0x2200e0 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_13		0x2200e8 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_14		0x2200f0 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>
<span class="cp">#define MD_UREG1_15		0x2200f8 </span><span class="cm">/* uController/UART 1 register     */</span><span class="cp"></span>

<span class="cp">#ifdef CONFIG_SGI_SN_N_MODE</span>
<span class="cp">#define MD_MEM_BANKS		4	 </span><span class="cm">/* 4 banks of memory max in N mode */</span><span class="cp"></span>
<span class="cp">#else</span>
<span class="cp">#define MD_MEM_BANKS		8	 </span><span class="cm">/* 8 banks of memory max in M mode */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * MD_MEMORY_CONFIG fields</span>
<span class="cm"> *</span>
<span class="cm"> *   MD_SIZE_xxx are useful for representing the size of a SIMM or bank</span>
<span class="cm"> *   (SIMM pair).  They correspond to the values needed for the bit</span>
<span class="cm"> *   triplets (MMC_BANK_MASK) in the MD_MEMORY_CONFIG register for bank size.</span>
<span class="cm"> *   Bits not used by the MD are used by software.</span>
<span class="cm"> */</span>

<span class="cp">#define MD_SIZE_EMPTY		0	</span><span class="cm">/* Valid in MEMORY_CONFIG           */</span><span class="cp"></span>
<span class="cp">#define MD_SIZE_8MB		1</span>
<span class="cp">#define MD_SIZE_16MB		2</span>
<span class="cp">#define MD_SIZE_32MB		3	</span><span class="cm">/* Broken in Hub 1		    */</span><span class="cp"></span>
<span class="cp">#define MD_SIZE_64MB		4	</span><span class="cm">/* Valid in MEMORY_CONFIG           */</span><span class="cp"></span>
<span class="cp">#define MD_SIZE_128MB		5	</span><span class="cm">/* Valid in MEMORY_CONFIG           */</span><span class="cp"></span>
<span class="cp">#define MD_SIZE_256MB		6</span>
<span class="cp">#define MD_SIZE_512MB		7	</span><span class="cm">/* Valid in MEMORY_CONFIG           */</span><span class="cp"></span>
<span class="cp">#define MD_SIZE_1GB		8</span>
<span class="cp">#define MD_SIZE_2GB		9</span>
<span class="cp">#define MD_SIZE_4GB		10</span>

<span class="cp">#define MD_SIZE_BYTES(size)	((size) == 0 ? 0 : 0x400000L &lt;&lt; (size))</span>
<span class="cp">#define MD_SIZE_MBYTES(size)	((size) == 0 ? 0 :   4	     &lt;&lt; (size))</span>

<span class="cp">#define MMC_FPROM_CYC_SHFT	49	</span><span class="cm">/* Have to use UINT64_CAST, instead */</span><span class="cp"></span>
<span class="cp">#define MMC_FPROM_CYC_MASK	(UINT64_CAST 31 &lt;&lt; 49)	</span><span class="cm">/* of &#39;L&#39; suffix,   */</span><span class="cp"></span>
<span class="cp">#define MMC_FPROM_WR_SHFT	44			</span><span class="cm">/* for assembler    */</span><span class="cp"></span>
<span class="cp">#define MMC_FPROM_WR_MASK	(UINT64_CAST 31 &lt;&lt; 44)</span>
<span class="cp">#define MMC_UCTLR_CYC_SHFT	39</span>
<span class="cp">#define MMC_UCTLR_CYC_MASK	(UINT64_CAST 31 &lt;&lt; 39)</span>
<span class="cp">#define MMC_UCTLR_WR_SHFT	34</span>
<span class="cp">#define MMC_UCTLR_WR_MASK	(UINT64_CAST 31 &lt;&lt; 34)</span>
<span class="cp">#define MMC_DIMM0_SEL_SHFT	32</span>
<span class="cp">#define MMC_DIMM0_SEL_MASK	(UINT64_CAST 3 &lt;&lt; 32)</span>
<span class="cp">#define MMC_IO_PROT_EN_SHFT	31</span>
<span class="cp">#define MMC_IO_PROT_EN_MASK	(UINT64_CAST 1 &lt;&lt; 31)</span>
<span class="cp">#define MMC_IO_PROT		(UINT64_CAST 1 &lt;&lt; 31)</span>
<span class="cp">#define MMC_ARB_MLSS_SHFT	30</span>
<span class="cp">#define MMC_ARB_MLSS_MASK	(UINT64_CAST 1 &lt;&lt; 30)</span>
<span class="cp">#define MMC_ARB_MLSS		(UINT64_CAST 1 &lt;&lt; 30)</span>
<span class="cp">#define MMC_IGNORE_ECC_SHFT	29</span>
<span class="cp">#define MMC_IGNORE_ECC_MASK	(UINT64_CAST 1 &lt;&lt; 29)</span>
<span class="cp">#define MMC_IGNORE_ECC		(UINT64_CAST 1 &lt;&lt; 29)</span>
<span class="cp">#define MMC_DIR_PREMIUM_SHFT	28</span>
<span class="cp">#define MMC_DIR_PREMIUM_MASK	(UINT64_CAST 1 &lt;&lt; 28)</span>
<span class="cp">#define MMC_DIR_PREMIUM		(UINT64_CAST 1 &lt;&lt; 28)</span>
<span class="cp">#define MMC_REPLY_GUAR_SHFT	24</span>
<span class="cp">#define MMC_REPLY_GUAR_MASK	(UINT64_CAST 15 &lt;&lt; 24)</span>
<span class="cp">#define MMC_BANK_SHFT(_b)	((_b) * 3)</span>
<span class="cp">#define MMC_BANK_MASK(_b)	(UINT64_CAST 7 &lt;&lt; MMC_BANK_SHFT(_b))</span>
<span class="cp">#define MMC_BANK_ALL_MASK	0xffffff</span>
<span class="cp">#define MMC_RESET_DEFAULTS	(UINT64_CAST 0x0f &lt;&lt; MMC_FPROM_CYC_SHFT | \</span>
<span class="cp">				 UINT64_CAST 0x07 &lt;&lt; MMC_FPROM_WR_SHFT | \</span>
<span class="cp">				 UINT64_CAST 0x1f &lt;&lt; MMC_UCTLR_CYC_SHFT | \</span>
<span class="cp">				 UINT64_CAST 0x0f &lt;&lt; MMC_UCTLR_WR_SHFT | \</span>
<span class="cp">				 MMC_IGNORE_ECC | MMC_DIR_PREMIUM | \</span>
<span class="cp">				 UINT64_CAST 0x0f &lt;&lt; MMC_REPLY_GUAR_SHFT | \</span>
<span class="cp">				 MMC_BANK_ALL_MASK)</span>

<span class="cm">/* MD_REFRESH_CONTROL fields */</span>

<span class="cp">#define MRC_ENABLE_SHFT		63</span>
<span class="cp">#define MRC_ENABLE_MASK		(UINT64_CAST 1 &lt;&lt; 63)</span>
<span class="cp">#define MRC_ENABLE		(UINT64_CAST 1 &lt;&lt; 63)</span>
<span class="cp">#define MRC_COUNTER_SHFT	12</span>
<span class="cp">#define MRC_COUNTER_MASK	(UINT64_CAST 0xfff &lt;&lt; 12)</span>
<span class="cp">#define MRC_CNT_THRESH_MASK	0xfff</span>
<span class="cp">#define MRC_RESET_DEFAULTS	(UINT64_CAST 0x400)</span>

<span class="cm">/* MD_MEM_DIMM_INIT and MD_DIR_DIMM_INIT fields */</span>

<span class="cp">#define MDI_SELECT_SHFT		32</span>
<span class="cp">#define MDI_SELECT_MASK		(UINT64_CAST 0x0f &lt;&lt; 32)</span>
<span class="cp">#define MDI_DIMM_MODE_MASK	(UINT64_CAST 0xfff)</span>

<span class="cm">/* MD_MOQ_SIZE fields */</span>

<span class="cp">#define MMS_RP_SIZE_SHFT	8</span>
<span class="cp">#define MMS_RP_SIZE_MASK	(UINT64_CAST 0x3f &lt;&lt; 8)</span>
<span class="cp">#define MMS_RQ_SIZE_SHFT	0</span>
<span class="cp">#define MMS_RQ_SIZE_MASK	(UINT64_CAST 0x1f)</span>
<span class="cp">#define MMS_RESET_DEFAULTS	(0x32 &lt;&lt; 8 | 0x12)</span>

<span class="cm">/* MD_FANDOP_CAC_STAT fields */</span>

<span class="cp">#define MFC_VALID_SHFT		63</span>
<span class="cp">#define MFC_VALID_MASK		(UINT64_CAST 1 &lt;&lt; 63)</span>
<span class="cp">#define MFC_VALID		(UINT64_CAST 1 &lt;&lt; 63)</span>
<span class="cp">#define MFC_ADDR_SHFT		6</span>
<span class="cp">#define MFC_ADDR_MASK		(UINT64_CAST 0x3ffffff)</span>

<span class="cm">/* MD_MLAN_CTL fields */</span>

<span class="cp">#define MLAN_PHI1_SHFT		27</span>
<span class="cp">#define MLAN_PHI1_MASK		(UINT64_CAST 0x7f &lt;&lt; 27)</span>
<span class="cp">#define MLAN_PHI0_SHFT		20</span>
<span class="cp">#define MLAN_PHI0_MASK		(UINT64_CAST 0x7f &lt;&lt; 27)</span>
<span class="cp">#define MLAN_PULSE_SHFT		10</span>
<span class="cp">#define MLAN_PULSE_MASK		(UINT64_CAST 0x3ff &lt;&lt; 10)</span>
<span class="cp">#define MLAN_SAMPLE_SHFT	2</span>
<span class="cp">#define MLAN_SAMPLE_MASK	(UINT64_CAST 0xff &lt;&lt; 2)</span>
<span class="cp">#define MLAN_DONE_SHFT		1</span>
<span class="cp">#define MLAN_DONE_MASK		2</span>
<span class="cp">#define MLAN_DONE		(UINT64_CAST 0x02)</span>
<span class="cp">#define MLAN_RD_DATA		(UINT64_CAST 0x01)</span>
<span class="cp">#define MLAN_RESET_DEFAULTS	(UINT64_CAST 0x31 &lt;&lt; MLAN_PHI1_SHFT | \</span>
<span class="cp">				 UINT64_CAST 0x31 &lt;&lt; MLAN_PHI0_SHFT)</span>

<span class="cm">/* MD_SLOTID_USTAT bit definitions */</span>

<span class="cp">#define MSU_CORECLK_TST_SHFT	7	</span><span class="cm">/* You don&#39;t wanna know             */</span><span class="cp"></span>
<span class="cp">#define MSU_CORECLK_TST_MASK	(UINT64_CAST 1 &lt;&lt; 7)</span>
<span class="cp">#define MSU_CORECLK_TST		(UINT64_CAST 1 &lt;&lt; 7)</span>
<span class="cp">#define MSU_CORECLK_SHFT	6	</span><span class="cm">/* You don&#39;t wanna know             */</span><span class="cp"></span>
<span class="cp">#define MSU_CORECLK_MASK	(UINT64_CAST 1 &lt;&lt; 6)</span>
<span class="cp">#define MSU_CORECLK		(UINT64_CAST 1 &lt;&lt; 6)</span>
<span class="cp">#define MSU_NETSYNC_SHFT	5	</span><span class="cm">/* You don&#39;t wanna know             */</span><span class="cp"></span>
<span class="cp">#define MSU_NETSYNC_MASK	(UINT64_CAST 1 &lt;&lt; 5)</span>
<span class="cp">#define MSU_NETSYNC		(UINT64_CAST 1 &lt;&lt; 5)</span>
<span class="cp">#define MSU_FPROMRDY_SHFT	4	</span><span class="cm">/* Flash PROM ready bit 	    */</span><span class="cp"></span>
<span class="cp">#define MSU_FPROMRDY_MASK	(UINT64_CAST 1 &lt;&lt; 4)</span>
<span class="cp">#define MSU_FPROMRDY		(UINT64_CAST 1 &lt;&lt; 4)</span>
<span class="cp">#define MSU_I2CINTR_SHFT		3	</span><span class="cm">/* I2C interrupt bit   */</span><span class="cp"></span>
<span class="cp">#define MSU_I2CINTR_MASK		(UINT64_CAST 1 &lt;&lt; 3)</span>
<span class="cp">#define MSU_I2CINTR		(UINT64_CAST 1 &lt;&lt; 3)</span>
<span class="cp">#define MSU_SLOTID_MASK		0xff</span>
<span class="cp">#define MSU_SN0_SLOTID_SHFT	0	</span><span class="cm">/* Slot ID			    */</span><span class="cp"></span>
<span class="cp">#define MSU_SN0_SLOTID_MASK	(UINT64_CAST 7)</span>
<span class="cp">#define MSU_SN00_SLOTID_SHFT	7</span>
<span class="cp">#define MSU_SN00_SLOTID_MASK	(UINT64_CAST 0x80)</span>

<span class="cp">#define	MSU_PIMM_PSC_SHFT	4</span>
<span class="cp">#define	MSU_PIMM_PSC_MASK	(0xf &lt;&lt; MSU_PIMM_PSC_SHFT)</span>

<span class="cm">/* MD_MIG_DIFF_THRESH bit definitions */</span>

<span class="cp">#define MD_MIG_DIFF_THRES_VALID_MASK (UINT64_CAST 0x1 &lt;&lt; 63)</span>
<span class="cp">#define MD_MIG_DIFF_THRES_VALID_SHFT 63</span>
<span class="cp">#define MD_MIG_DIFF_THRES_VALUE_MASK (UINT64_CAST 0xfffff)</span>

<span class="cm">/* MD_MIG_VALUE_THRESH bit definitions */</span>

<span class="cp">#define MD_MIG_VALUE_THRES_VALID_MASK (UINT64_CAST 0x1 &lt;&lt; 63)</span>
<span class="cp">#define MD_MIG_VALUE_THRES_VALID_SHFT 63</span>
<span class="cp">#define MD_MIG_VALUE_THRES_VALUE_MASK (UINT64_CAST 0xfffff)</span>

<span class="cm">/* MD_MIG_CANDIDATE bit definitions */</span>

<span class="cp">#define MD_MIG_CANDIDATE_VALID_MASK (UINT64_CAST 0x1 &lt;&lt; 63)</span>
<span class="cp">#define MD_MIG_CANDIDATE_VALID_SHFT 63</span>
<span class="cp">#define MD_MIG_CANDIDATE_TYPE_MASK (UINT64_CAST 0x1 &lt;&lt; 30)</span>
<span class="cp">#define MD_MIG_CANDIDATE_TYPE_SHFT 30</span>
<span class="cp">#define MD_MIG_CANDIDATE_OVERRUN_MASK (UINT64_CAST 0x1 &lt;&lt; 29)</span>
<span class="cp">#define MD_MIG_CANDIDATE_OVERRUN_SHFT 29</span>
<span class="cp">#define MD_MIG_CANDIDATE_INITIATOR_MASK (UINT64_CAST 0x7ff &lt;&lt; 18)</span>
<span class="cp">#define MD_MIG_CANDIDATE_INITIATOR_SHFT 18</span>
<span class="cp">#define MD_MIG_CANDIDATE_NODEID_MASK (UINT64_CAST 0x1ff &lt;&lt; 20)</span>
<span class="cp">#define MD_MIG_CANDIDATE_NODEID_SHFT 20</span>
<span class="cp">#define MD_MIG_CANDIDATE_ADDR_MASK (UINT64_CAST 0x3ffff)</span>
<span class="cp">#define MD_MIG_CANDIDATE_ADDR_SHFT 14  </span><span class="cm">/* The address starts at bit 14 */</span><span class="cp"></span>

<span class="cm">/* Other MD definitions */</span>

<span class="cp">#define MD_BANK_SHFT		29			</span><span class="cm">/* log2(512 MB)     */</span><span class="cp"></span>
<span class="cp">#define MD_BANK_MASK		(UINT64_CAST 7 &lt;&lt; 29)</span>
<span class="cp">#define MD_BANK_SIZE		(UINT64_CAST 1 &lt;&lt; MD_BANK_SHFT)	  </span><span class="cm">/* 512 MB */</span><span class="cp"></span>
<span class="cp">#define MD_BANK_OFFSET(_b)	(UINT64_CAST (_b) &lt;&lt; MD_BANK_SHFT)</span>

<span class="cm">/*</span>
<span class="cm"> * The following definitions cover the bit field definitions for the</span>
<span class="cm"> * various MD registers.  For multi-bit registers, we define both</span>
<span class="cm"> * a shift amount and a mask value.  By convention, if you want to</span>
<span class="cm"> * isolate a field, you should mask the field and then shift it down,</span>
<span class="cm"> * since this makes the masks useful without a shift.</span>
<span class="cm"> */</span>

<span class="cm">/* Directory entry states for both premium and standard SIMMs. */</span>

<span class="cp">#define MD_DIR_SHARED		(UINT64_CAST 0x0)	</span><span class="cm">/* 000 */</span><span class="cp"></span>
<span class="cp">#define MD_DIR_POISONED		(UINT64_CAST 0x1)	</span><span class="cm">/* 001 */</span><span class="cp"></span>
<span class="cp">#define MD_DIR_EXCLUSIVE	(UINT64_CAST 0x2)	</span><span class="cm">/* 010 */</span><span class="cp"></span>
<span class="cp">#define MD_DIR_BUSY_SHARED	(UINT64_CAST 0x3)	</span><span class="cm">/* 011 */</span><span class="cp"></span>
<span class="cp">#define MD_DIR_BUSY_EXCL	(UINT64_CAST 0x4)	</span><span class="cm">/* 100 */</span><span class="cp"></span>
<span class="cp">#define MD_DIR_WAIT		(UINT64_CAST 0x5)	</span><span class="cm">/* 101 */</span><span class="cp"></span>
<span class="cp">#define MD_DIR_UNOWNED		(UINT64_CAST 0x7)	</span><span class="cm">/* 111 */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * The MD_DIR_FORCE_ECC bit can be added directory entry write data</span>
<span class="cm"> * to forcing the ECC to be written as-is instead of recalculated.</span>
<span class="cm"> */</span>

<span class="cp">#define MD_DIR_FORCE_ECC	(UINT64_CAST 1 &lt;&lt; 63)</span>

<span class="cm">/*</span>
<span class="cm"> * Premium SIMM directory entry shifts and masks.  Each is valid only in the</span>
<span class="cm"> * context(s) indicated, where A, B, and C indicate the directory entry format</span>
<span class="cm"> * as shown, and low and/or high indicates which double-word of the entry.</span>
<span class="cm"> *</span>
<span class="cm"> * Format A:  STATE = shared, FINE = 1</span>
<span class="cm"> * Format B:  STATE = shared, FINE = 0</span>
<span class="cm"> * Format C:  STATE != shared (FINE must be 0)</span>
<span class="cm"> */</span>

<span class="cp">#define MD_PDIR_MASK		0xffffffffffff		</span><span class="cm">/* Whole entry 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_ECC_SHFT	0			</span><span class="cm">/* ABC low or high  */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_ECC_MASK	0x7f</span>
<span class="cp">#define MD_PDIR_PRIO_SHFT	8			</span><span class="cm">/* ABC low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_PRIO_MASK	(0xf &lt;&lt; 8)</span>
<span class="cp">#define MD_PDIR_AX_SHFT		7			</span><span class="cm">/* ABC low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_AX_MASK		(1 &lt;&lt; 7)</span>
<span class="cp">#define MD_PDIR_AX		(1 &lt;&lt; 7)</span>
<span class="cp">#define MD_PDIR_FINE_SHFT	12			</span><span class="cm">/* ABC low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_FINE_MASK	(1 &lt;&lt; 12)</span>
<span class="cp">#define MD_PDIR_FINE		(1 &lt;&lt; 12)</span>
<span class="cp">#define MD_PDIR_OCT_SHFT	13			</span><span class="cm">/* A low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_OCT_MASK	(7 &lt;&lt; 13)</span>
<span class="cp">#define MD_PDIR_STATE_SHFT	13			</span><span class="cm">/* BC low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_STATE_MASK	(7 &lt;&lt; 13)</span>
<span class="cp">#define MD_PDIR_ONECNT_SHFT	16			</span><span class="cm">/* BC low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_ONECNT_MASK	(0x3f &lt;&lt; 16)</span>
<span class="cp">#define MD_PDIR_PTR_SHFT	22			</span><span class="cm">/* C low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_PTR_MASK	(UINT64_CAST 0x7ff &lt;&lt; 22)</span>
<span class="cp">#define MD_PDIR_VECMSB_SHFT	22			</span><span class="cm">/* AB low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_VECMSB_BITMASK	0x3ffffff</span>
<span class="cp">#define MD_PDIR_VECMSB_BITSHFT	27</span>
<span class="cp">#define MD_PDIR_VECMSB_MASK	(UINT64_CAST MD_PDIR_VECMSB_BITMASK &lt;&lt; 22)</span>
<span class="cp">#define MD_PDIR_CWOFF_SHFT	7			</span><span class="cm">/* C high 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_CWOFF_MASK	(7 &lt;&lt; 7)</span>
<span class="cp">#define MD_PDIR_VECLSB_SHFT	10			</span><span class="cm">/* AB high 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PDIR_VECLSB_BITMASK	(UINT64_CAST 0x3fffffffff)</span>
<span class="cp">#define MD_PDIR_VECLSB_BITSHFT	0</span>
<span class="cp">#define MD_PDIR_VECLSB_MASK	(MD_PDIR_VECLSB_BITMASK &lt;&lt; 10)</span>

<span class="cm">/*</span>
<span class="cm"> * Directory initialization values</span>
<span class="cm"> */</span>

<span class="cp">#define MD_PDIR_INIT_LO		(MD_DIR_UNOWNED &lt;&lt; MD_PDIR_STATE_SHFT | \</span>
<span class="cp">				 MD_PDIR_AX)</span>
<span class="cp">#define MD_PDIR_INIT_HI		0</span>
<span class="cp">#define MD_PDIR_INIT_PROT	(MD_PROT_RW &lt;&lt; MD_PPROT_IO_SHFT | \</span>
<span class="cp">				 MD_PROT_RW &lt;&lt; MD_PPROT_SHFT)</span>

<span class="cm">/*</span>
<span class="cm"> * Standard SIMM directory entry shifts and masks.  Each is valid only in the</span>
<span class="cm"> * context(s) indicated, where A and C indicate the directory entry format</span>
<span class="cm"> * as shown, and low and/or high indicates which double-word of the entry.</span>
<span class="cm"> *</span>
<span class="cm"> * Format A:  STATE == shared</span>
<span class="cm"> * Format C:  STATE != shared</span>
<span class="cm"> */</span>

<span class="cp">#define MD_SDIR_MASK		0xffff			</span><span class="cm">/* Whole entry 	    */</span><span class="cp"></span>
<span class="cp">#define MD_SDIR_ECC_SHFT	0			</span><span class="cm">/* AC low or high   */</span><span class="cp"></span>
<span class="cp">#define MD_SDIR_ECC_MASK	0x1f</span>
<span class="cp">#define MD_SDIR_PRIO_SHFT	6			</span><span class="cm">/* AC low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_SDIR_PRIO_MASK	(1 &lt;&lt; 6)</span>
<span class="cp">#define MD_SDIR_AX_SHFT		5			</span><span class="cm">/* AC low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_SDIR_AX_MASK		(1 &lt;&lt; 5)</span>
<span class="cp">#define MD_SDIR_AX		(1 &lt;&lt; 5)</span>
<span class="cp">#define MD_SDIR_STATE_SHFT	7			</span><span class="cm">/* AC low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_SDIR_STATE_MASK	(7 &lt;&lt; 7)</span>
<span class="cp">#define MD_SDIR_PTR_SHFT	10			</span><span class="cm">/* C low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_SDIR_PTR_MASK	(0x3f &lt;&lt; 10)</span>
<span class="cp">#define MD_SDIR_CWOFF_SHFT	5			</span><span class="cm">/* C high 	    */</span><span class="cp"></span>
<span class="cp">#define MD_SDIR_CWOFF_MASK	(7 &lt;&lt; 5)</span>
<span class="cp">#define MD_SDIR_VECMSB_SHFT	11			</span><span class="cm">/* A low 	    */</span><span class="cp"></span>
<span class="cp">#define MD_SDIR_VECMSB_BITMASK	0x1f</span>
<span class="cp">#define MD_SDIR_VECMSB_BITSHFT	7</span>
<span class="cp">#define MD_SDIR_VECMSB_MASK	(MD_SDIR_VECMSB_BITMASK &lt;&lt; 11)</span>
<span class="cp">#define MD_SDIR_VECLSB_SHFT	5			</span><span class="cm">/* A high 	    */</span><span class="cp"></span>
<span class="cp">#define MD_SDIR_VECLSB_BITMASK	0x7ff</span>
<span class="cp">#define MD_SDIR_VECLSB_BITSHFT	0</span>
<span class="cp">#define MD_SDIR_VECLSB_MASK	(MD_SDIR_VECLSB_BITMASK &lt;&lt; 5)</span>

<span class="cm">/*</span>
<span class="cm"> * Directory initialization values</span>
<span class="cm"> */</span>

<span class="cp">#define MD_SDIR_INIT_LO		(MD_DIR_UNOWNED &lt;&lt; MD_SDIR_STATE_SHFT | \</span>
<span class="cp">				 MD_SDIR_AX)</span>
<span class="cp">#define MD_SDIR_INIT_HI		0</span>
<span class="cp">#define MD_SDIR_INIT_PROT	(MD_PROT_RW &lt;&lt; MD_SPROT_SHFT)</span>

<span class="cm">/* Protection and migration field values */</span>

<span class="cp">#define MD_PROT_RW		(UINT64_CAST 0x6)</span>
<span class="cp">#define MD_PROT_RO		(UINT64_CAST 0x3)</span>
<span class="cp">#define MD_PROT_NO		(UINT64_CAST 0x0)</span>
<span class="cp">#define MD_PROT_BAD		(UINT64_CAST 0x5)</span>

<span class="cm">/* Premium SIMM protection entry shifts and masks. */</span>

<span class="cp">#define MD_PPROT_SHFT		0			</span><span class="cm">/* Prot. field 	    */</span><span class="cp"></span>
<span class="cp">#define MD_PPROT_MASK		7</span>
<span class="cp">#define MD_PPROT_MIGMD_SHFT	3			</span><span class="cm">/* Migration mode   */</span><span class="cp"></span>
<span class="cp">#define MD_PPROT_MIGMD_MASK	(3 &lt;&lt; 3)</span>
<span class="cp">#define MD_PPROT_REFCNT_SHFT	5			</span><span class="cm">/* Reference count  */</span><span class="cp"></span>
<span class="cp">#define MD_PPROT_REFCNT_WIDTH	0x7ffff</span>
<span class="cp">#define MD_PPROT_REFCNT_MASK	(MD_PPROT_REFCNT_WIDTH &lt;&lt; 5)</span>

<span class="cp">#define MD_PPROT_IO_SHFT	45			</span><span class="cm">/* I/O Prot field   */</span><span class="cp"></span>
<span class="cp">#define MD_PPROT_IO_MASK	(UINT64_CAST 7 &lt;&lt; 45)</span>

<span class="cm">/* Standard SIMM protection entry shifts and masks. */</span>

<span class="cp">#define MD_SPROT_SHFT		0			</span><span class="cm">/* Prot. field 	    */</span><span class="cp"></span>
<span class="cp">#define MD_SPROT_MASK		7</span>
<span class="cp">#define MD_SPROT_MIGMD_SHFT	3			</span><span class="cm">/* Migration mode   */</span><span class="cp"></span>
<span class="cp">#define MD_SPROT_MIGMD_MASK	(3 &lt;&lt; 3)</span>
<span class="cp">#define MD_SPROT_REFCNT_SHFT	5			</span><span class="cm">/* Reference count  */</span><span class="cp"></span>
<span class="cp">#define MD_SPROT_REFCNT_WIDTH	0x7ff</span>
<span class="cp">#define MD_SPROT_REFCNT_MASK	(MD_SPROT_REFCNT_WIDTH &lt;&lt; 5)</span>

<span class="cm">/* Migration modes used in protection entries */</span>

<span class="cp">#define MD_PROT_MIGMD_IREL	(UINT64_CAST 0x3 &lt;&lt; 3)</span>
<span class="cp">#define MD_PROT_MIGMD_IABS	(UINT64_CAST 0x2 &lt;&lt; 3)</span>
<span class="cp">#define MD_PROT_MIGMD_PREL	(UINT64_CAST 0x1 &lt;&lt; 3)</span>
<span class="cp">#define MD_PROT_MIGMD_OFF	(UINT64_CAST 0x0 &lt;&lt; 3)</span>


<span class="cm">/*</span>
<span class="cm"> * Operations on page migration threshold register</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cm">/*</span>
<span class="cm"> * LED register macros</span>
<span class="cm"> */</span>

<span class="cp">#define CPU_LED_ADDR(_nasid, _slice)					   \</span>
<span class="cp">	(private.p_sn00 ?						   \</span>
<span class="cp">	 REMOTE_HUB_ADDR((_nasid), MD_UREG1_0 +	((_slice) &lt;&lt; 5)) :	   \</span>
<span class="cp">	 REMOTE_HUB_ADDR((_nasid), MD_LED0    + ((_slice) &lt;&lt; 3)))</span>

<span class="cp">#define SET_CPU_LEDS(_nasid, _slice,  _val)				   \</span>
<span class="cp">	(HUB_S(CPU_LED_ADDR(_nasid, _slice), (_val)))</span>

<span class="cp">#define SET_MY_LEDS(_v) 						   \</span>
<span class="cp">	SET_CPU_LEDS(get_nasid(), get_slice(), (_v))</span>

<span class="cm">/*</span>
<span class="cm"> * Operations on Memory/Directory DIMM control register</span>
<span class="cm"> */</span>

<span class="cp">#define DIRTYPE_PREMIUM 1</span>
<span class="cp">#define DIRTYPE_STANDARD 0</span>
<span class="cp">#define MD_MEMORY_CONFIG_DIR_TYPE_GET(region) (\</span>
<span class="cp">	(REMOTE_HUB_L(region, MD_MEMORY_CONFIG) &amp; MMC_DIR_PREMIUM_MASK) &gt;&gt; \</span>
<span class="cp">	MMC_DIR_PREMIUM_SHFT)</span>


<span class="cm">/*</span>
<span class="cm"> * Operations on page migration count difference and absolute threshold</span>
<span class="cm"> * registers</span>
<span class="cm"> */</span>

<span class="cp">#define MD_MIG_DIFF_THRESH_GET(region) ( \</span>
<span class="cp">	REMOTE_HUB_L((region), MD_MIG_DIFF_THRESH) &amp; \</span>
<span class="cp">	MD_MIG_DIFF_THRES_VALUE_MASK)</span>

<span class="cp">#define MD_MIG_DIFF_THRESH_SET(region, value) (				\</span>
<span class="cp">	REMOTE_HUB_S((region), MD_MIG_DIFF_THRESH,			\</span>
<span class="cp">		MD_MIG_DIFF_THRES_VALID_MASK | (value)))</span>

<span class="cp">#define MD_MIG_DIFF_THRESH_DISABLE(region) (			\</span>
<span class="cp">	REMOTE_HUB_S((region), MD_MIG_DIFF_THRESH,			\</span>
<span class="cp">		REMOTE_HUB_L((region), MD_MIG_DIFF_THRESH)		\</span>
<span class="cp">			     &amp; ~MD_MIG_DIFF_THRES_VALID_MASK))</span>

<span class="cp">#define MD_MIG_DIFF_THRESH_ENABLE(region) (			\</span>
<span class="cp">	REMOTE_HUB_S((region), MD_MIG_DIFF_THRESH,			\</span>
<span class="cp">		REMOTE_HUB_L((region), MD_MIG_DIFF_THRESH)		\</span>
<span class="cp">			     | MD_MIG_DIFF_THRES_VALID_MASK))</span>

<span class="cp">#define MD_MIG_DIFF_THRESH_IS_ENABLED(region) (				\</span>
<span class="cp">	REMOTE_HUB_L((region), MD_MIG_DIFF_THRESH) &amp;			\</span>
<span class="cp">	       MD_MIG_DIFF_THRES_VALID_MASK)</span>

<span class="cp">#define MD_MIG_VALUE_THRESH_GET(region) (				\</span>
<span class="cp">	REMOTE_HUB_L((region), MD_MIG_VALUE_THRESH) &amp;  \</span>
<span class="cp">	MD_MIG_VALUE_THRES_VALUE_MASK)</span>

<span class="cp">#define MD_MIG_VALUE_THRESH_SET(region, value) (			\</span>
<span class="cp">	REMOTE_HUB_S((region), MD_MIG_VALUE_THRESH,			\</span>
<span class="cp">		MD_MIG_VALUE_THRES_VALID_MASK | (value)))</span>

<span class="cp">#define MD_MIG_VALUE_THRESH_DISABLE(region) (			\</span>
<span class="cp">	REMOTE_HUB_S((region), MD_MIG_VALUE_THRESH,			\</span>
<span class="cp">		REMOTE_HUB_L(region, MD_MIG_VALUE_THRESH)		\</span>
<span class="cp">			     &amp; ~MD_MIG_VALUE_THRES_VALID_MASK))</span>

<span class="cp">#define MD_MIG_VALUE_THRESH_ENABLE(region) (			\</span>
<span class="cp">	REMOTE_HUB_S((region), MD_MIG_VALUE_THRESH,			\</span>
<span class="cp">		REMOTE_HUB_L((region), MD_MIG_VALUE_THRESH)		\</span>
<span class="cp">			     | MD_MIG_VALUE_THRES_VALID_MASK))</span>

<span class="cp">#define MD_MIG_VALUE_THRESH_IS_ENABLED(region) (			\</span>
<span class="cp">	REMOTE_HUB_L((region), MD_MIG_VALUE_THRESH) &amp;			 \</span>
<span class="cp">	       MD_MIG_VALUE_THRES_VALID_MASK)</span>

<span class="cm">/*</span>
<span class="cm"> * Operations on page migration candidate register</span>
<span class="cm"> */</span>

<span class="cp">#define MD_MIG_CANDIDATE_GET(my_region_id) ( \</span>
<span class="cp">	REMOTE_HUB_L((my_region_id), MD_MIG_CANDIDATE_CLR))</span>

<span class="cp">#define MD_MIG_CANDIDATE_HWPFN(value) ((value) &amp; MD_MIG_CANDIDATE_ADDR_MASK)</span>

<span class="cp">#define MD_MIG_CANDIDATE_NODEID(value) ( \</span>
<span class="cp">	((value) &amp; MD_MIG_CANDIDATE_NODEID_MASK) &gt;&gt; MD_MIG_CANDIDATE_NODEID_SHFT)</span>

<span class="cp">#define MD_MIG_CANDIDATE_TYPE(value) ( \</span>
<span class="cp">	((value) &amp; MD_MIG_CANDIDATE_TYPE_MASK) &gt;&gt; MD_MIG_CANDIDATE_TYPE_SHFT)</span>

<span class="cp">#define MD_MIG_CANDIDATE_VALID(value) ( \</span>
<span class="cp">	((value) &amp; MD_MIG_CANDIDATE_VALID_MASK) &gt;&gt; MD_MIG_CANDIDATE_VALID_SHFT)</span>

<span class="cm">/*</span>
<span class="cm"> * Macros to retrieve fields in the protection entry</span>
<span class="cm"> */</span>

<span class="cm">/* for Premium SIMM */</span>
<span class="cp">#define MD_PPROT_REFCNT_GET(value) ( \</span>
<span class="cp">	((value) &amp; MD_PPROT_REFCNT_MASK) &gt;&gt; MD_PPROT_REFCNT_SHFT)</span>

<span class="cp">#define MD_PPROT_MIGMD_GET(value) ( \</span>
<span class="cp">	((value) &amp; MD_PPROT_MIGMD_MASK) &gt;&gt; MD_PPROT_MIGMD_SHFT)</span>

<span class="cm">/* for Standard SIMM */</span>
<span class="cp">#define MD_SPROT_REFCNT_GET(value) ( \</span>
<span class="cp">	((value) &amp; MD_SPROT_REFCNT_MASK) &gt;&gt; MD_SPROT_REFCNT_SHFT)</span>

<span class="cp">#define MD_SPROT_MIGMD_GET(value) ( \</span>
<span class="cp">	((value) &amp; MD_SPROT_MIGMD_MASK) &gt;&gt; MD_SPROT_MIGMD_SHFT)</span>

<span class="cm">/*</span>
<span class="cm"> * Format of dir_error, mem_error, protocol_error and misc_error registers</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">dir_error_reg</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">uce_vld</span><span class="o">:</span>   <span class="mi">1</span><span class="p">,</span>	<span class="cm">/*    63: valid directory uce 	*/</span>
		<span class="nl">ae_vld:</span>	   <span class="mi">1</span><span class="p">,</span>	<span class="cm">/*    62: valid dir prot ecc error */</span>
		<span class="nl">ce_vld:</span>	   <span class="mi">1</span><span class="p">,</span>	<span class="cm">/*    61: valid correctable ECC err*/</span>
		<span class="nl">rsvd1:</span>	  <span class="mi">19</span><span class="p">,</span>	<span class="cm">/* 60-42: reserved		*/</span>
		<span class="nl">bad_prot:</span>  <span class="mi">3</span><span class="p">,</span>	<span class="cm">/* 41-39: encoding, bad access rights*/</span>
		<span class="nl">bad_syn:</span>   <span class="mi">7</span><span class="p">,</span>	<span class="cm">/* 38-32: bad dir syndrome	*/</span>
		<span class="nl">rsvd2:</span>	   <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* 31-30: reserved		*/</span>
		<span class="nl">hspec_addr:</span><span class="mi">27</span><span class="p">,</span>	<span class="cm">/* 29-03: bddir space bad entry */</span>
		<span class="nl">uce_ovr:</span>   <span class="mi">1</span><span class="p">,</span>	<span class="cm">/*     2: multiple dir uce&#39;s	*/</span>
		<span class="nl">ae_ovr:</span>	   <span class="mi">1</span><span class="p">,</span>	<span class="cm">/*     1: multiple prot ecc errs*/</span>
		<span class="nl">ce_ovr:</span>	   <span class="mi">1</span><span class="p">;</span>	<span class="cm">/*     0: multiple correctable errs */</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">md_dir_error</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">derr_reg</span><span class="p">;</span>	<span class="cm">/* the entire register 		*/</span>
	<span class="k">struct</span> <span class="n">dir_error_reg</span> <span class="n">derr_fmt</span><span class="p">;</span>	<span class="cm">/* the register format		*/</span>
<span class="p">}</span> <span class="n">md_dir_error_t</span><span class="p">;</span>


<span class="k">struct</span> <span class="n">mem_error_reg</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">uce_vld</span><span class="o">:</span>   <span class="mi">1</span><span class="p">,</span>	<span class="cm">/*    63: valid memory uce 	*/</span>
		<span class="nl">ce_vld:</span>	   <span class="mi">1</span><span class="p">,</span>	<span class="cm">/*    62: valid correctable ECC err*/</span>
		<span class="nl">rsvd1:</span>	  <span class="mi">22</span><span class="p">,</span>	<span class="cm">/* 61-40: reserved		*/</span>
		<span class="nl">bad_syn:</span>   <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 39-32: bad mem ecc syndrome	*/</span>
		<span class="nl">address:</span>  <span class="mi">29</span><span class="p">,</span>	<span class="cm">/* 31-03: bad entry pointer	*/</span>
		<span class="nl">rsvd2:</span>	   <span class="mi">1</span><span class="p">,</span>	<span class="cm">/*     2: reserved		*/</span>
		<span class="nl">uce_ovr:</span>   <span class="mi">1</span><span class="p">,</span>	<span class="cm">/*     1: multiple mem uce&#39;s	*/</span>
		<span class="nl">ce_ovr:</span>	   <span class="mi">1</span><span class="p">;</span>	<span class="cm">/*     0: multiple correctable errs */</span>
<span class="p">};</span>


<span class="k">typedef</span> <span class="k">union</span> <span class="n">md_mem_error</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">merr_reg</span><span class="p">;</span>	<span class="cm">/* the entire register 		*/</span>
	<span class="k">struct</span> <span class="n">mem_error_reg</span>  <span class="n">merr_fmt</span><span class="p">;</span> <span class="cm">/* format of the mem_error reg  */</span>
<span class="p">}</span> <span class="n">md_mem_error_t</span><span class="p">;</span>


<span class="k">struct</span> <span class="n">proto_error_reg</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">valid</span><span class="o">:</span>	   <span class="mi">1</span><span class="p">,</span>	<span class="cm">/*    63: valid protocol error	*/</span>
		<span class="nl">rsvd1:</span>	   <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* 62-61: reserved		*/</span>
		<span class="nl">initiator:</span><span class="mi">11</span><span class="p">,</span>	<span class="cm">/* 60-50: id of request initiator*/</span>
		<span class="nl">backoff:</span>   <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* 49-48: backoff control	*/</span>
		<span class="nl">msg_type:</span>  <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 47-40: type of request	*/</span>
		<span class="nl">access:</span>	   <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* 39-38: access rights of initiator*/</span>
		<span class="nl">priority:</span>  <span class="mi">1</span><span class="p">,</span>	<span class="cm">/*    37: priority level of requestor*/</span>
		<span class="nl">dir_state:</span> <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* 36-33: state of directory	*/</span>
		<span class="nl">pointer_me:</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/*    32: initiator same as dir ptr */</span>
		<span class="nl">address:</span>  <span class="mi">29</span><span class="p">,</span>	<span class="cm">/* 31-03: request address	*/</span>
		<span class="nl">rsvd2:</span>	   <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* 02-01: reserved		*/</span>
		<span class="nl">overrun:</span>   <span class="mi">1</span><span class="p">;</span>	<span class="cm">/*     0: multiple protocol errs */</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">md_proto_error</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">perr_reg</span><span class="p">;</span>	<span class="cm">/* the entire register 		*/</span>
	<span class="k">struct</span> <span class="n">proto_error_reg</span>	<span class="n">perr_fmt</span><span class="p">;</span> <span class="cm">/* format of the register	*/</span>
<span class="p">}</span> <span class="n">md_proto_error_t</span><span class="p">;</span>


<span class="k">struct</span> <span class="n">md_sdir_high_fmt</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">sd_hi_bvec</span> <span class="o">:</span> <span class="mi">11</span><span class="p">,</span>
		       <span class="n">sd_hi_ecc</span>  <span class="o">:</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">typedef</span> <span class="k">union</span> <span class="n">md_sdir_high</span> <span class="p">{</span>
	<span class="cm">/* The 16 bits of standard directory, upper word */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">sd_hi_val</span><span class="p">;</span>
	<span class="k">struct</span>	<span class="n">md_sdir_high_fmt</span> <span class="n">sd_hi_fmt</span><span class="p">;</span>
<span class="p">}</span><span class="n">md_sdir_high_t</span><span class="p">;</span>


<span class="k">struct</span> <span class="n">md_sdir_low_shared_fmt</span> <span class="p">{</span>
	<span class="cm">/* The meaning of lower directory, shared */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">sds_lo_bvec</span>  <span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
			<span class="nl">sds_lo_unused:</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">sds_lo_state</span> <span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
			<span class="n">sds_lo_prio</span>  <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">sds_lo_ax</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">sds_lo_ecc</span>   <span class="o">:</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">md_sdir_low_exclusive_fmt</span> <span class="p">{</span>
	<span class="cm">/* The meaning of lower directory, exclusive */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">sde_lo_ptr</span>   <span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
			<span class="n">sde_lo_state</span> <span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
			<span class="n">sde_lo_prio</span>  <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">sde_lo_ax</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">sde_lo_ecc</span>   <span class="o">:</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">typedef</span> <span class="k">union</span> <span class="n">md_sdir_low</span> <span class="p">{</span>
	<span class="cm">/* The 16 bits of standard directory, lower word */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">sd_lo_val</span><span class="p">;</span>
	<span class="k">struct</span>	<span class="n">md_sdir_low_exclusive_fmt</span> <span class="n">sde_lo_fmt</span><span class="p">;</span>
	<span class="k">struct</span>	<span class="n">md_sdir_low_shared_fmt</span> <span class="n">sds_lo_fmt</span><span class="p">;</span>
<span class="p">}</span><span class="n">md_sdir_low_t</span><span class="p">;</span>



<span class="k">struct</span> <span class="n">md_pdir_high_fmt</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">pd_hi_unused</span>   <span class="o">:</span> <span class="mi">16</span><span class="p">,</span>
		<span class="n">pd_hi_bvec</span>     <span class="o">:</span> <span class="mi">38</span><span class="p">,</span>
		<span class="n">pd_hi_unused1</span>  <span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
		<span class="n">pd_hi_ecc</span>      <span class="o">:</span> <span class="mi">7</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">typedef</span> <span class="k">union</span> <span class="n">md_pdir_high</span> <span class="p">{</span>
	<span class="cm">/* The 48 bits of standard directory, upper word */</span>
	<span class="n">u64</span>	<span class="n">pd_hi_val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">md_pdir_high_fmt</span> <span class="n">pd_hi_fmt</span><span class="p">;</span>
<span class="p">}</span><span class="n">md_pdir_high_t</span><span class="p">;</span>


<span class="k">struct</span> <span class="n">md_pdir_low_shared_fmt</span> <span class="p">{</span>
	<span class="cm">/* The meaning of lower directory, shared */</span>
	<span class="n">u64</span>	<span class="n">pds_lo_unused</span>	<span class="o">:</span> <span class="mi">16</span><span class="p">,</span>
		<span class="n">pds_lo_bvec</span>	<span class="o">:</span> <span class="mi">26</span><span class="p">,</span>
		<span class="n">pds_lo_cnt</span>	<span class="o">:</span>  <span class="mi">6</span><span class="p">,</span>
		<span class="n">pds_lo_state</span>	<span class="o">:</span>  <span class="mi">3</span><span class="p">,</span>
		<span class="n">pds_lo_ste</span>	<span class="o">:</span>  <span class="mi">1</span><span class="p">,</span>
		<span class="n">pds_lo_prio</span>	<span class="o">:</span>  <span class="mi">4</span><span class="p">,</span>
		<span class="n">pds_lo_ax</span>	<span class="o">:</span>  <span class="mi">1</span><span class="p">,</span>
		<span class="n">pds_lo_ecc</span>	<span class="o">:</span>  <span class="mi">7</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">md_pdir_low_exclusive_fmt</span> <span class="p">{</span>
	<span class="cm">/* The meaning of lower directory, exclusive */</span>
	<span class="n">u64</span>	<span class="n">pde_lo_unused</span>	<span class="o">:</span> <span class="mi">31</span><span class="p">,</span>
		<span class="n">pde_lo_ptr</span>	<span class="o">:</span> <span class="mi">11</span><span class="p">,</span>
		<span class="n">pde_lo_unused1</span>	<span class="o">:</span>  <span class="mi">6</span><span class="p">,</span>
		<span class="n">pde_lo_state</span>	<span class="o">:</span>  <span class="mi">3</span><span class="p">,</span>
		<span class="n">pde_lo_ste</span>	<span class="o">:</span>  <span class="mi">1</span><span class="p">,</span>
		<span class="n">pde_lo_prio</span>	<span class="o">:</span>  <span class="mi">4</span><span class="p">,</span>
		<span class="n">pde_lo_ax</span>	<span class="o">:</span>  <span class="mi">1</span><span class="p">,</span>
		<span class="n">pde_lo_ecc</span>	<span class="o">:</span>  <span class="mi">7</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">typedef</span> <span class="k">union</span> <span class="n">md_pdir_loent</span> <span class="p">{</span>
	<span class="cm">/* The 48 bits of premium directory, lower word */</span>
	<span class="n">u64</span>	<span class="n">pd_lo_val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">md_pdir_low_exclusive_fmt</span> <span class="n">pde_lo_fmt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">md_pdir_low_shared_fmt</span>	<span class="n">pds_lo_fmt</span><span class="p">;</span>
<span class="p">}</span><span class="n">md_pdir_low_t</span><span class="p">;</span>


<span class="cm">/*</span>
<span class="cm"> *   the following two &quot;union&quot; definitions and two</span>
<span class="cm"> *   &quot;struct&quot; definitions are used in vmdump.c to</span>
<span class="cm"> *   represent directory memory information.</span>
<span class="cm"> */</span>

<span class="k">typedef</span>	<span class="k">union</span>	<span class="n">md_dir_high</span>	<span class="p">{</span>
        <span class="n">md_sdir_high_t</span>	<span class="n">md_sdir_high</span><span class="p">;</span>
        <span class="n">md_pdir_high_t</span>	<span class="n">md_pdir_high</span><span class="p">;</span>
<span class="p">}</span> <span class="n">md_dir_high_t</span><span class="p">;</span>

<span class="k">typedef</span>	<span class="k">union</span>	<span class="n">md_dir_low</span>	<span class="p">{</span>
        <span class="n">md_sdir_low_t</span>	<span class="n">md_sdir_low</span><span class="p">;</span>
        <span class="n">md_pdir_low_t</span>	<span class="n">md_pdir_low</span><span class="p">;</span>
<span class="p">}</span> <span class="n">md_dir_low_t</span><span class="p">;</span>

<span class="k">typedef</span>	<span class="k">struct</span>	<span class="n">bddir_entry</span>	<span class="p">{</span>
        <span class="n">md_dir_low_t</span>	<span class="n">md_dir_low</span><span class="p">;</span>
        <span class="n">md_dir_high_t</span>	<span class="n">md_dir_high</span><span class="p">;</span>
<span class="p">}</span> <span class="n">bddir_entry_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>	<span class="n">dir_mem_entry</span>	<span class="p">{</span>
        <span class="n">u64</span>		<span class="n">prcpf</span><span class="p">[</span><span class="n">MAX_REGIONS</span><span class="p">];</span>
        <span class="n">bddir_entry_t</span>	<span class="n">directory_words</span><span class="p">[</span><span class="n">MD_PAGE_SIZE</span><span class="o">/</span><span class="n">CACHE_SLINE_SIZE</span><span class="p">];</span>
<span class="p">}</span> <span class="n">dir_mem_entry_t</span><span class="p">;</span>



<span class="k">typedef</span> <span class="k">union</span> <span class="n">md_perf_sel</span> <span class="p">{</span>
	<span class="n">u64</span> 	<span class="n">perf_sel_reg</span><span class="p">;</span>
	<span class="k">struct</span>	<span class="p">{</span>
		<span class="n">u64</span>	<span class="n">perf_rsvd</span> <span class="o">:</span> <span class="mi">60</span><span class="p">,</span>
		        <span class="n">perf_en</span>   <span class="o">:</span>  <span class="mi">1</span><span class="p">,</span>
			<span class="n">perf_sel</span>  <span class="o">:</span>  <span class="mi">3</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">perf_sel_bits</span><span class="p">;</span>
<span class="p">}</span> <span class="n">md_perf_sel_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">md_perf_cnt</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">perf_cnt</span><span class="p">;</span>
	<span class="k">struct</span>	<span class="p">{</span>
		<span class="n">u64</span>	<span class="n">perf_rsvd</span> <span class="o">:</span> <span class="mi">44</span><span class="p">,</span>
	                <span class="n">perf_cnt</span>  <span class="o">:</span> <span class="mi">20</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">perf_cnt_bits</span><span class="p">;</span>
<span class="p">}</span> <span class="n">md_perf_cnt_t</span><span class="p">;</span>


<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>


<span class="cp">#define DIR_ERROR_VALID_MASK	0xe000000000000000</span>
<span class="cp">#define DIR_ERROR_VALID_SHFT	61</span>
<span class="cp">#define DIR_ERROR_VALID_UCE	0x8000000000000000</span>
<span class="cp">#define DIR_ERROR_VALID_AE	0x4000000000000000</span>
<span class="cp">#define DIR_ERROR_VALID_CE	0x2000000000000000</span>

<span class="cp">#define MEM_ERROR_VALID_MASK	0xc000000000000000</span>
<span class="cp">#define MEM_ERROR_VALID_SHFT	62</span>
<span class="cp">#define MEM_ERROR_VALID_UCE	0x8000000000000000</span>
<span class="cp">#define MEM_ERROR_VALID_CE	0x4000000000000000</span>

<span class="cp">#define PROTO_ERROR_VALID_MASK	0x8000000000000000</span>

<span class="cp">#define MISC_ERROR_VALID_MASK	0x3ff</span>

<span class="cm">/*</span>
<span class="cm"> * Mask for hspec address that is stored in the dir error register.</span>
<span class="cm"> * This represents bits 29 through 3.</span>
<span class="cm"> */</span>
<span class="cp">#define DIR_ERR_HSPEC_MASK	0x3ffffff8</span>
<span class="cp">#define ERROR_HSPEC_MASK	0x3ffffff8</span>
<span class="cp">#define ERROR_HSPEC_SHFT	3</span>
<span class="cp">#define ERROR_ADDR_MASK		0xfffffff8</span>
<span class="cp">#define ERROR_ADDR_SHFT		3</span>

<span class="cm">/*</span>
<span class="cm"> * MD_MISC_ERROR register defines.</span>
<span class="cm"> */</span>

<span class="cp">#define MMCE_VALID_MASK		0x3ff</span>
<span class="cp">#define MMCE_ILL_MSG_SHFT	8</span>
<span class="cp">#define MMCE_ILL_MSG_MASK	(UINT64_CAST 0x03 &lt;&lt; MMCE_ILL_MSG_SHFT)</span>
<span class="cp">#define MMCE_ILL_REV_SHFT	6</span>
<span class="cp">#define MMCE_ILL_REV_MASK	(UINT64_CAST 0x03 &lt;&lt; MMCE_ILL_REV_SHFT)</span>
<span class="cp">#define MMCE_LONG_PACK_SHFT	4</span>
<span class="cp">#define MMCE_LONG_PACK_MASK	(UINT64_CAST 0x03 &lt;&lt; MMCE_lONG_PACK_SHFT)</span>
<span class="cp">#define MMCE_SHORT_PACK_SHFT	2</span>
<span class="cp">#define MMCE_SHORT_PACK_MASK	(UINT64_CAST 0x03 &lt;&lt; MMCE_SHORT_PACK_SHFT)</span>
<span class="cp">#define MMCE_BAD_DATA_SHFT	0</span>
<span class="cp">#define MMCE_BAD_DATA_MASK	(UINT64_CAST 0x03 &lt;&lt; MMCE_BAD_DATA_SHFT)</span>


<span class="cp">#define MD_PERF_COUNTERS	6</span>
<span class="cp">#define MD_PERF_SETS		6</span>

<span class="cp">#define MEM_DIMM_MASK				0xe0000000</span>
<span class="cp">#define MEM_DIMM_SHFT				29</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_SN_SN0_HUBMD_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:6}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../../javascript/docco.min.js"></script>
</html>
