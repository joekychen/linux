<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › sn › sn0 › hubio.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../../index.html"></a><h1>hubio.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * Derived from IRIX &lt;sys/SN/SN0/hubio.h&gt;, Revision 1.80.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1992 - 1997, 1999 Silicon Graphics, Inc.</span>
<span class="cm"> * Copyright (C) 1999 by Ralf Baechle</span>
<span class="cm"> */</span>
<span class="cp">#ifndef	_ASM_SGI_SN_SN0_HUBIO_H</span>
<span class="cp">#define	_ASM_SGI_SN_SN0_HUBIO_H</span>

<span class="cm">/*</span>
<span class="cm"> * Hub I/O interface registers</span>
<span class="cm"> *</span>
<span class="cm"> * All registers in this file are subject to change until Hub chip tapeout.</span>
<span class="cm"> * In general, the longer software name should be used when available.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Slightly friendlier names for some common registers.</span>
<span class="cm"> * The hardware definitions follow.</span>
<span class="cm"> */</span>
<span class="cp">#define IIO_WIDGET		IIO_WID      </span><span class="cm">/* Widget identification */</span><span class="cp"></span>
<span class="cp">#define IIO_WIDGET_STAT		IIO_WSTAT    </span><span class="cm">/* Widget status register */</span><span class="cp"></span>
<span class="cp">#define IIO_WIDGET_CTRL		IIO_WCR	     </span><span class="cm">/* Widget control register */</span><span class="cp"></span>
<span class="cp">#define IIO_WIDGET_TOUT		IIO_WRTO     </span><span class="cm">/* Widget request timeout */</span><span class="cp"></span>
<span class="cp">#define IIO_WIDGET_FLUSH	IIO_WTFR     </span><span class="cm">/* Widget target flush */</span><span class="cp"></span>
<span class="cp">#define IIO_PROTECT		IIO_ILAPR    </span><span class="cm">/* IO interface protection */</span><span class="cp"></span>
<span class="cp">#define IIO_PROTECT_OVRRD	IIO_ILAPO    </span><span class="cm">/* IO protect override */</span><span class="cp"></span>
<span class="cp">#define IIO_OUTWIDGET_ACCESS	IIO_IOWA     </span><span class="cm">/* Outbound widget access */</span><span class="cp"></span>
<span class="cp">#define IIO_INWIDGET_ACCESS	IIO_IIWA     </span><span class="cm">/* Inbound widget access */</span><span class="cp"></span>
<span class="cp">#define IIO_INDEV_ERR_MASK	IIO_IIDEM    </span><span class="cm">/* Inbound device error mask */</span><span class="cp"></span>
<span class="cp">#define IIO_LLP_CSR		IIO_ILCSR    </span><span class="cm">/* LLP control and status */</span><span class="cp"></span>
<span class="cp">#define IIO_LLP_LOG		IIO_ILLR     </span><span class="cm">/* LLP log */</span><span class="cp"></span>
<span class="cp">#define IIO_XTALKCC_TOUT	IIO_IXCC     </span><span class="cm">/* Xtalk credit count timeout*/</span><span class="cp"></span>
<span class="cp">#define IIO_XTALKTT_TOUT	IIO_IXTT     </span><span class="cm">/* Xtalk tail timeout */</span><span class="cp"></span>
<span class="cp">#define IIO_IO_ERR_CLR		IIO_IECLR    </span><span class="cm">/* IO error clear */</span><span class="cp"></span>
<span class="cp">#define IIO_BTE_CRB_CNT         IIO_IBCN     </span><span class="cm">/* IO BTE CRB count */</span><span class="cp"></span>

<span class="cp">#define IIO_LLP_CSR_IS_UP		0x00002000</span>
<span class="cp">#define	IIO_LLP_CSR_LLP_STAT_MASK	0x00003000</span>
<span class="cp">#define	IIO_LLP_CSR_LLP_STAT_SHFT	12</span>

<span class="cm">/* key to IIO_PROTECT_OVRRD */</span>
<span class="cp">#define IIO_PROTECT_OVRRD_KEY	0x53474972756c6573ull	</span><span class="cm">/* &quot;SGIrules&quot; */</span><span class="cp"></span>

<span class="cm">/* BTE register names */</span>
<span class="cp">#define IIO_BTE_STAT_0		IIO_IBLS_0   </span><span class="cm">/* Also BTE length/status 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_BTE_SRC_0		IIO_IBSA_0   </span><span class="cm">/* Also BTE source address  0 */</span><span class="cp"></span>
<span class="cp">#define IIO_BTE_DEST_0		IIO_IBDA_0   </span><span class="cm">/* Also BTE dest. address 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_BTE_CTRL_0		IIO_IBCT_0   </span><span class="cm">/* Also BTE control/terminate 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_BTE_NOTIFY_0 	IIO_IBNA_0   </span><span class="cm">/* Also BTE notification 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_BTE_INT_0		IIO_IBIA_0   </span><span class="cm">/* Also BTE interrupt 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_BTE_OFF_0		0	     </span><span class="cm">/* Base offset from BTE 0 regs. */</span><span class="cp"></span>
<span class="cp">#define IIO_BTE_OFF_1	IIO_IBLS_1 - IIO_IBLS_0 </span><span class="cm">/* Offset from base to BTE 1 */</span><span class="cp"></span>

<span class="cm">/* BTE register offsets from base */</span>
<span class="cp">#define BTEOFF_STAT		0</span>
<span class="cp">#define BTEOFF_SRC		(IIO_BTE_SRC_0 - IIO_BTE_STAT_0)</span>
<span class="cp">#define BTEOFF_DEST		(IIO_BTE_DEST_0 - IIO_BTE_STAT_0)</span>
<span class="cp">#define BTEOFF_CTRL		(IIO_BTE_CTRL_0 - IIO_BTE_STAT_0)</span>
<span class="cp">#define BTEOFF_NOTIFY		(IIO_BTE_NOTIFY_0 - IIO_BTE_STAT_0)</span>
<span class="cp">#define BTEOFF_INT		(IIO_BTE_INT_0 - IIO_BTE_STAT_0)</span>


<span class="cm">/*</span>
<span class="cm"> * The following definitions use the names defined in the IO interface</span>
<span class="cm"> * document for ease of reference.  When possible, software should</span>
<span class="cm"> * generally use the longer but clearer names defined above.</span>
<span class="cm"> */</span>

<span class="cp">#define IIO_BASE	0x400000</span>
<span class="cp">#define IIO_BASE_BTE0	0x410000</span>
<span class="cp">#define IIO_BASE_BTE1	0x420000</span>
<span class="cp">#define IIO_BASE_PERF	0x430000</span>
<span class="cp">#define IIO_PERF_CNT	0x430008</span>

<span class="cp">#define IO_PERF_SETS	32</span>

<span class="cp">#define IIO_WID		0x400000	</span><span class="cm">/* Widget identification */</span><span class="cp"></span>
<span class="cp">#define IIO_WSTAT	0x400008	</span><span class="cm">/* Widget status */</span><span class="cp"></span>
<span class="cp">#define IIO_WCR		0x400020	</span><span class="cm">/* Widget control */</span><span class="cp"></span>

<span class="cp">#define	IIO_WSTAT_ECRAZY	(1ULL &lt;&lt; 32)	</span><span class="cm">/* Hub gone crazy */</span><span class="cp"></span>
<span class="cp">#define	IIO_WSTAT_TXRETRY	(1ULL &lt;&lt; 9)	</span><span class="cm">/* Hub Tx Retry timeout */</span><span class="cp"></span>
<span class="cp">#define	IIO_WSTAT_TXRETRY_MASK	(0x7F)</span>
<span class="cp">#define	IIO_WSTAT_TXRETRY_SHFT	(16)</span>
<span class="cp">#define	IIO_WSTAT_TXRETRY_CNT(w)	(((w) &gt;&gt; IIO_WSTAT_TXRETRY_SHFT) &amp; \</span>
<span class="cp">					  IIO_WSTAT_TXRETRY_MASK)</span>

<span class="cp">#define IIO_ILAPR	0x400100	</span><span class="cm">/* Local Access Protection */</span><span class="cp"></span>
<span class="cp">#define IIO_ILAPO	0x400108	</span><span class="cm">/* Protection override */</span><span class="cp"></span>
<span class="cp">#define IIO_IOWA	0x400110	</span><span class="cm">/* outbound widget access */</span><span class="cp"></span>
<span class="cp">#define IIO_IIWA	0x400118	</span><span class="cm">/* inbound widget access */</span><span class="cp"></span>
<span class="cp">#define IIO_IIDEM	0x400120	</span><span class="cm">/* Inbound Device Error Mask */</span><span class="cp"></span>
<span class="cp">#define IIO_ILCSR	0x400128	</span><span class="cm">/* LLP control and status */</span><span class="cp"></span>
<span class="cp">#define IIO_ILLR	0x400130	</span><span class="cm">/* LLP Log */</span><span class="cp"></span>
<span class="cp">#define IIO_IIDSR	0x400138	</span><span class="cm">/* Interrupt destination */</span><span class="cp"></span>

<span class="cp">#define IIO_IIBUSERR	0x1400208	</span><span class="cm">/* Reads here cause a bus error. */</span><span class="cp"></span>

<span class="cm">/* IO Interrupt Destination Register */</span>
<span class="cp">#define IIO_IIDSR_SENT_SHIFT	28</span>
<span class="cp">#define IIO_IIDSR_SENT_MASK	0x10000000</span>
<span class="cp">#define IIO_IIDSR_ENB_SHIFT	24</span>
<span class="cp">#define IIO_IIDSR_ENB_MASK	0x01000000</span>
<span class="cp">#define IIO_IIDSR_NODE_SHIFT	8</span>
<span class="cp">#define IIO_IIDSR_NODE_MASK	0x0000ff00</span>
<span class="cp">#define IIO_IIDSR_LVL_SHIFT	0</span>
<span class="cp">#define IIO_IIDSR_LVL_MASK	0x0000003f</span>


<span class="cm">/* GFX Flow Control Node/Widget Register */</span>
<span class="cp">#define IIO_IGFX_0	0x400140	</span><span class="cm">/* gfx node/widget register 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_IGFX_1	0x400148	</span><span class="cm">/* gfx node/widget register 1 */</span><span class="cp"></span>
<span class="cp">#define IIO_IGFX_W_NUM_BITS	4	</span><span class="cm">/* size of widget num field */</span><span class="cp"></span>
<span class="cp">#define IIO_IGFX_W_NUM_MASK	((1&lt;&lt;IIO_IGFX_W_NUM_BITS)-1)</span>
<span class="cp">#define IIO_IGFX_W_NUM_SHIFT	0</span>
<span class="cp">#define IIO_IGFX_N_NUM_BITS	9	</span><span class="cm">/* size of node num field */</span><span class="cp"></span>
<span class="cp">#define IIO_IGFX_N_NUM_MASK	((1&lt;&lt;IIO_IGFX_N_NUM_BITS)-1)</span>
<span class="cp">#define IIO_IGFX_N_NUM_SHIFT	4</span>
<span class="cp">#define IIO_IGFX_P_NUM_BITS	1	</span><span class="cm">/* size of processor num field */</span><span class="cp"></span>
<span class="cp">#define IIO_IGFX_P_NUM_MASK	((1&lt;&lt;IIO_IGFX_P_NUM_BITS)-1)</span>
<span class="cp">#define IIO_IGFX_P_NUM_SHIFT	16</span>
<span class="cp">#define IIO_IGFX_VLD_BITS	1	</span><span class="cm">/* size of valid field */</span><span class="cp"></span>
<span class="cp">#define IIO_IGFX_VLD_MASK	((1&lt;&lt;IIO_IGFX_VLD_BITS)-1)</span>
<span class="cp">#define IIO_IGFX_VLD_SHIFT	20</span>
<span class="cp">#define IIO_IGFX_INIT(widget, node, cpu, valid)				(\</span>
<span class="cp">	(((widget) &amp; IIO_IGFX_W_NUM_MASK) &lt;&lt; IIO_IGFX_W_NUM_SHIFT) |	 \</span>
<span class="cp">	(((node)   &amp; IIO_IGFX_N_NUM_MASK) &lt;&lt; IIO_IGFX_N_NUM_SHIFT) |	 \</span>
<span class="cp">	(((cpu)    &amp; IIO_IGFX_P_NUM_MASK) &lt;&lt; IIO_IGFX_P_NUM_SHIFT) |	 \</span>
<span class="cp">	(((valid)  &amp; IIO_IGFX_VLD_MASK)   &lt;&lt; IIO_IGFX_VLD_SHIFT)	 )</span>

<span class="cm">/* Scratch registers (not all bits available) */</span>
<span class="cp">#define IIO_SCRATCH_REG0	0x400150</span>
<span class="cp">#define	IIO_SCRATCH_REG1	0x400158</span>
<span class="cp">#define IIO_SCRATCH_MASK	0x0000000f00f11fff</span>

<span class="cp">#define IIO_SCRATCH_BIT0_0	0x0000000800000000</span>
<span class="cp">#define IIO_SCRATCH_BIT0_1	0x0000000400000000</span>
<span class="cp">#define IIO_SCRATCH_BIT0_2	0x0000000200000000</span>
<span class="cp">#define IIO_SCRATCH_BIT0_3	0x0000000100000000</span>
<span class="cp">#define IIO_SCRATCH_BIT0_4	0x0000000000800000</span>
<span class="cp">#define IIO_SCRATCH_BIT0_5	0x0000000000400000</span>
<span class="cp">#define IIO_SCRATCH_BIT0_6	0x0000000000200000</span>
<span class="cp">#define IIO_SCRATCH_BIT0_7	0x0000000000100000</span>
<span class="cp">#define IIO_SCRATCH_BIT0_8	0x0000000000010000</span>
<span class="cp">#define IIO_SCRATCH_BIT0_9	0x0000000000001000</span>
<span class="cp">#define IIO_SCRATCH_BIT0_R	0x0000000000000fff</span>

<span class="cm">/* IO Translation Table Entries */</span>
<span class="cp">#define IIO_NUM_ITTES	7		</span><span class="cm">/* ITTEs numbered 0..6 */</span><span class="cp"></span>
					<span class="cm">/* Hw manuals number them 1..7! */</span>

<span class="cm">/*</span>
<span class="cm"> * As a permanent workaround for a bug in the PI side of the hub, we&#39;ve</span>
<span class="cm"> * redefined big window 7 as small window 0.</span>
<span class="cm"> */</span>
<span class="cp">#define HUB_NUM_BIG_WINDOW	IIO_NUM_ITTES - 1</span>

<span class="cm">/*</span>
<span class="cm"> * Use the top big window as a surrogate for the first small window</span>
<span class="cm"> */</span>
<span class="cp">#define SWIN0_BIGWIN		HUB_NUM_BIG_WINDOW</span>

<span class="cp">#define ILCSR_WARM_RESET	0x100</span>
<span class="cm">/*</span>
<span class="cm"> * The IO LLP control status register and widget control register</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">hubii_wid_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">wid_reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> 	<span class="n">wid_rsvd</span><span class="o">:</span> 	<span class="mi">32</span><span class="p">,</span>	<span class="cm">/* unused */</span>
			<span class="nl">wid_rev_num:</span>	 <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* revision number */</span>
			<span class="nl">wid_part_num:</span>	<span class="mi">16</span><span class="p">,</span>	<span class="cm">/* the widget type: hub=c101 */</span>
			<span class="nl">wid_mfg_num:</span>	<span class="mi">11</span><span class="p">,</span>	<span class="cm">/* Manufacturer id (IBM) */</span>
			<span class="nl">wid_rsvd1:</span>	 <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Reserved */</span>
        <span class="p">}</span> <span class="n">wid_fields_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">hubii_wid_t</span><span class="p">;</span>


<span class="k">typedef</span> <span class="k">union</span> <span class="n">hubii_wcr_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">wcr_reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> 	<span class="n">wcr_rsvd</span><span class="o">:</span> 	<span class="mi">41</span><span class="p">,</span>	<span class="cm">/* unused */</span>
			<span class="nl">wcr_e_thresh:</span>	 <span class="mi">5</span><span class="p">,</span>	<span class="cm">/* elasticity threshold */</span>
			<span class="nl">wcr_dir_con:</span>	 <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* widget direct connect */</span>
			<span class="nl">wcr_f_bad_pkt:</span>	 <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Force bad llp pkt enable */</span>
			<span class="nl">wcr_xbar_crd:</span>	 <span class="mi">3</span><span class="p">,</span>	<span class="cm">/* LLP crossbar credit */</span>
			<span class="nl">wcr_rsvd1:</span>	 <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Reserved */</span>
			<span class="nl">wcr_tag_mode:</span>    <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Tag mode */</span>
			<span class="nl">wcr_widget_id:</span>	 <span class="mi">4</span><span class="p">;</span>	<span class="cm">/* LLP crossbar credit */</span>
        <span class="p">}</span> <span class="n">wcr_fields_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">hubii_wcr_t</span><span class="p">;</span>

<span class="cp">#define	iwcr_dir_con	wcr_fields_s.wcr_dir_con</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">hubii_wstat_u</span> <span class="p">{</span>
	<span class="n">u64</span>      <span class="n">reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>	<span class="n">rsvd1</span><span class="o">:</span>		<span class="mi">31</span><span class="p">,</span>
			<span class="nl">crazy:</span>		 <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Crazy bit		*/</span>
			<span class="nl">rsvd2:</span>		 <span class="mi">8</span><span class="p">,</span>
			<span class="nl">llp_tx_cnt:</span>	 <span class="mi">8</span><span class="p">,</span> 	<span class="cm">/* LLP Xmit retry counter */</span>
			<span class="nl">rsvd3:</span>		 <span class="mi">6</span><span class="p">,</span>
			<span class="nl">tx_max_rtry:</span>	 <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* LLP Retry Timeout Signal */</span>
			<span class="nl">rsvd4:</span>		 <span class="mi">2</span><span class="p">,</span>
			<span class="nl">xt_tail_to:</span>	 <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Xtalk Tail Timeout	*/</span>
			<span class="nl">xt_crd_to:</span>	 <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Xtalk Credit Timeout	*/</span>
			<span class="nl">pending:</span>	 <span class="mi">4</span><span class="p">;</span>	<span class="cm">/* Pending Requests	*/</span>
	<span class="p">}</span> <span class="n">wstat_fields_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">hubii_wstat_t</span><span class="p">;</span>


<span class="k">typedef</span> <span class="k">union</span> <span class="n">hubii_ilcsr_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">icsr_reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> 	<span class="n">icsr_rsvd</span><span class="o">:</span> 	<span class="mi">22</span><span class="p">,</span>	<span class="cm">/* unused */</span>
			<span class="nl">icsr_max_burst:</span>	<span class="mi">10</span><span class="p">,</span>	<span class="cm">/* max burst */</span>
                        <span class="nl">icsr_rsvd4:</span>	 <span class="mi">6</span><span class="p">,</span>	<span class="cm">/* reserved */</span>
			<span class="nl">icsr_max_retry:</span>	<span class="mi">10</span><span class="p">,</span>	<span class="cm">/* max retry */</span>
                        <span class="nl">icsr_rsvd3:</span>	 <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* reserved */</span>
                        <span class="nl">icsr_lnk_stat:</span>	 <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* link status */</span>
                        <span class="nl">icsr_bm8:</span>	 <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Bit mode 8 */</span>
                        <span class="nl">icsr_llp_en:</span>	 <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* LLP enable bit */</span>
			<span class="nl">icsr_rsvd2:</span>	 <span class="mi">1</span><span class="p">,</span>     <span class="cm">/* reserver */</span>
                        <span class="nl">icsr_wrm_reset:</span>	 <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Warm reset bit */</span>
			<span class="nl">icsr_rsvd1:</span>	 <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Data ready offset */</span>
                        <span class="nl">icsr_null_to:</span>	 <span class="mi">6</span><span class="p">;</span>	<span class="cm">/* Null timeout   */</span>

        <span class="p">}</span> <span class="n">icsr_fields_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">hubii_ilcsr_t</span><span class="p">;</span>


<span class="k">typedef</span> <span class="k">union</span> <span class="n">hubii_iowa_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">iowa_reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> 	<span class="n">iowa_rsvd</span><span class="o">:</span> 	<span class="mi">48</span><span class="p">,</span>	<span class="cm">/* unused */</span>
			<span class="nl">iowa_wxoac:</span>	 <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* xtalk widget access bits */</span>
			<span class="nl">iowa_rsvd1:</span>	 <span class="mi">7</span><span class="p">,</span>	<span class="cm">/* xtalk widget access bits */</span>
			<span class="nl">iowa_w0oac:</span>	 <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* xtalk widget access bits */</span>
        <span class="p">}</span> <span class="n">iowa_fields_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">hubii_iowa_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">hubii_iiwa_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">iiwa_reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> 	<span class="n">iiwa_rsvd</span><span class="o">:</span> 	<span class="mi">48</span><span class="p">,</span>	<span class="cm">/* unused */</span>
			<span class="nl">iiwa_wxiac:</span>	 <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* hub wid access bits */</span>
			<span class="nl">iiwa_rsvd1:</span>	 <span class="mi">7</span><span class="p">,</span>	<span class="cm">/* reserved */</span>
			<span class="nl">iiwa_w0iac:</span>	 <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* hub wid0 access */</span>
        <span class="p">}</span> <span class="n">iiwa_fields_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">hubii_iiwa_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span>	<span class="n">hubii_illr_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">illr_reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> 	<span class="n">illr_rsvd</span><span class="o">:</span> 	<span class="mi">32</span><span class="p">,</span>	<span class="cm">/* unused */</span>
			<span class="nl">illr_cb_cnt:</span>	<span class="mi">16</span><span class="p">,</span>	<span class="cm">/* checkbit error count */</span>
			<span class="nl">illr_sn_cnt:</span>	<span class="mi">16</span><span class="p">;</span>	<span class="cm">/* sequence number count */</span>
        <span class="p">}</span> <span class="n">illr_fields_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">hubii_illr_t</span><span class="p">;</span>

<span class="cm">/* The structures below are defined to extract and modify the ii</span>
<span class="cm">performance registers */</span>

<span class="cm">/* io_perf_sel allows the caller to specify what tests will be</span>
<span class="cm">   performed */</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">io_perf_sel</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">perf_sel_reg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> 	<span class="n">perf_rsvd</span>  <span class="o">:</span> <span class="mi">48</span><span class="p">,</span>
			<span class="n">perf_icct</span>  <span class="o">:</span>  <span class="mi">8</span><span class="p">,</span>
			<span class="n">perf_ippr1</span> <span class="o">:</span>  <span class="mi">4</span><span class="p">,</span>
			<span class="n">perf_ippr0</span> <span class="o">:</span>  <span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">perf_sel_bits</span><span class="p">;</span>
<span class="p">}</span> <span class="n">io_perf_sel_t</span><span class="p">;</span>

<span class="cm">/* io_perf_cnt is to extract the count from the hub registers. Due to</span>
<span class="cm">   hardware problems there is only one counter, not two. */</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">io_perf_cnt</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">perf_cnt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>	<span class="n">perf_rsvd1</span> <span class="o">:</span> <span class="mi">32</span><span class="p">,</span>
			<span class="n">perf_rsvd2</span> <span class="o">:</span> <span class="mi">12</span><span class="p">,</span>
			<span class="n">perf_cnt</span>   <span class="o">:</span> <span class="mi">20</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">perf_cnt_bits</span><span class="p">;</span>
<span class="p">}</span> <span class="n">io_perf_cnt_t</span><span class="p">;</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>


<span class="cp">#define LNK_STAT_WORKING	0x2</span>

<span class="cp">#define IIO_LLP_CB_MAX	0xffff</span>
<span class="cp">#define IIO_LLP_SN_MAX	0xffff</span>

<span class="cm">/* IO PRB Entries */</span>
<span class="cp">#define	IIO_NUM_IPRBS	(9)</span>
<span class="cp">#define IIO_IOPRB_0	0x400198	</span><span class="cm">/* PRB entry 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_IOPRB_8	0x4001a0	</span><span class="cm">/* PRB entry 8 */</span><span class="cp"></span>
<span class="cp">#define IIO_IOPRB_9	0x4001a8	</span><span class="cm">/* PRB entry 9 */</span><span class="cp"></span>
<span class="cp">#define IIO_IOPRB_A	0x4001b0	</span><span class="cm">/* PRB entry a */</span><span class="cp"></span>
<span class="cp">#define IIO_IOPRB_B	0x4001b8	</span><span class="cm">/* PRB entry b */</span><span class="cp"></span>
<span class="cp">#define IIO_IOPRB_C	0x4001c0	</span><span class="cm">/* PRB entry c */</span><span class="cp"></span>
<span class="cp">#define IIO_IOPRB_D	0x4001c8	</span><span class="cm">/* PRB entry d */</span><span class="cp"></span>
<span class="cp">#define IIO_IOPRB_E	0x4001d0	</span><span class="cm">/* PRB entry e */</span><span class="cp"></span>
<span class="cp">#define IIO_IOPRB_F	0x4001d8	</span><span class="cm">/* PRB entry f */</span><span class="cp"></span>


<span class="cp">#define IIO_IXCC	0x4001e0	</span><span class="cm">/* Crosstalk credit count timeout */</span><span class="cp"></span>
<span class="cp">#define IIO_IXTCC	IIO_IXCC</span>
<span class="cp">#define IIO_IMEM	0x4001e8	</span><span class="cm">/* Miscellaneous Enable Mask */</span><span class="cp"></span>
<span class="cp">#define IIO_IXTT	0x4001f0	</span><span class="cm">/* Crosstalk tail timeout */</span><span class="cp"></span>
<span class="cp">#define IIO_IECLR	0x4001f8	</span><span class="cm">/* IO error clear */</span><span class="cp"></span>
<span class="cp">#define IIO_IBCN        0x400200        </span><span class="cm">/* IO BTE CRB count */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * IIO_IMEM Register fields.</span>
<span class="cm"> */</span>
<span class="cp">#define IIO_IMEM_W0ESD  0x1             </span><span class="cm">/* Widget 0 shut down due to error */</span><span class="cp"></span>
<span class="cp">#define IIO_IMEM_B0ESD  (1 &lt;&lt; 4)        </span><span class="cm">/* BTE 0 shut down due to error */</span><span class="cp"></span>
<span class="cp">#define IIO_IMEM_B1ESD  (1 &lt;&lt; 8)        </span><span class="cm">/* BTE 1 Shut down due to error */</span><span class="cp"></span>

<span class="cm">/* PIO Read address Table Entries */</span>
<span class="cp">#define IIO_IPCA	0x400300	</span><span class="cm">/* PRB Counter adjust */</span><span class="cp"></span>
<span class="cp">#define IIO_NUM_PRTES	8		</span><span class="cm">/* Total number of PRB table entries */</span><span class="cp"></span>
<span class="cp">#define IIO_PRTE_0	0x400308	</span><span class="cm">/* PIO Read address table entry 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_PRTE(_x)	(IIO_PRTE_0 + (8 * (_x)))</span>
<span class="cp">#define	IIO_WIDPRTE(x)	IIO_PRTE(((x) - 8)) </span><span class="cm">/* widget ID to its PRTE num */</span><span class="cp"></span>
<span class="cp">#define IIO_IPDR	0x400388	</span><span class="cm">/* PIO table entry deallocation */</span><span class="cp"></span>
<span class="cp">#define IIO_ICDR	0x400390	</span><span class="cm">/* CRB Entry Deallocation */</span><span class="cp"></span>
<span class="cp">#define IIO_IFDR	0x400398	</span><span class="cm">/* IOQ FIFO Depth */</span><span class="cp"></span>
<span class="cp">#define IIO_IIAP	0x4003a0	</span><span class="cm">/* IIQ Arbitration Parameters */</span><span class="cp"></span>
<span class="cp">#define IIO_IMMR	IIO_IIAP</span>
<span class="cp">#define IIO_ICMR	0x4003a8	</span><span class="cm">/* CRB Management Register */</span><span class="cp"></span>
<span class="cp">#define IIO_ICCR	0x4003b0	</span><span class="cm">/* CRB Control Register */</span><span class="cp"></span>
<span class="cp">#define IIO_ICTO	0x4003b8	</span><span class="cm">/* CRB Time Out Register */</span><span class="cp"></span>
<span class="cp">#define IIO_ICTP	0x4003c0	</span><span class="cm">/* CRB Time Out Prescalar */</span><span class="cp"></span>


<span class="cm">/*</span>
<span class="cm"> * ICMR register fields</span>
<span class="cm"> */</span>
<span class="cp">#define IIO_ICMR_PC_VLD_SHFT	36</span>
<span class="cp">#define IIO_ICMR_PC_VLD_MASK	(0x7fffUL &lt;&lt; IIO_ICMR_PC_VLD_SHFT)</span>

<span class="cp">#define IIO_ICMR_CRB_VLD_SHFT	20</span>
<span class="cp">#define IIO_ICMR_CRB_VLD_MASK	(0x7fffUL &lt;&lt; IIO_ICMR_CRB_VLD_SHFT)</span>

<span class="cp">#define IIO_ICMR_FC_CNT_SHFT	16</span>
<span class="cp">#define IIO_ICMR_FC_CNT_MASK	(0xf &lt;&lt; IIO_ICMR_FC_CNT_SHFT)</span>

<span class="cp">#define IIO_ICMR_C_CNT_SHFT	4</span>
<span class="cp">#define IIO_ICMR_C_CNT_MASK	(0xf &lt;&lt; IIO_ICMR_C_CNT_SHFT)</span>

<span class="cp">#define IIO_ICMR_P_CNT_SHFT	0</span>
<span class="cp">#define IIO_ICMR_P_CNT_MASK	(0xf &lt;&lt; IIO_ICMR_P_CNT_SHFT)</span>

<span class="cp">#define IIO_ICMR_PRECISE	(1UL &lt;&lt; 52)</span>
<span class="cp">#define IIO_ICMR_CLR_RPPD	(1UL &lt;&lt; 13)</span>
<span class="cp">#define IIO_ICMR_CLR_RQPD	(1UL &lt;&lt; 12)</span>

<span class="cm">/*</span>
<span class="cm"> * IIO PIO Deallocation register field masks : (IIO_IPDR)</span>
<span class="cm"> */</span>
<span class="cp">#define	IIO_IPDR_PND	(1 &lt;&lt; 4)</span>

<span class="cm">/*</span>
<span class="cm"> * IIO CRB deallocation register field masks: (IIO_ICDR)</span>
<span class="cm"> */</span>
<span class="cp">#define	IIO_ICDR_PND	(1 &lt;&lt; 4)</span>

<span class="cm">/*</span>
<span class="cm"> * IIO CRB control register Fields: IIO_ICCR</span>
<span class="cm"> */</span>
<span class="cp">#define	IIO_ICCR_PENDING	(0x10000)</span>
<span class="cp">#define	IIO_ICCR_CMD_MASK	(0xFF)</span>
<span class="cp">#define	IIO_ICCR_CMD_SHFT	(7)</span>
<span class="cp">#define	IIO_ICCR_CMD_NOP	(0x0)	</span><span class="cm">/* No Op */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICCR_CMD_WAKE	(0x100) </span><span class="cm">/* Reactivate CRB entry and process */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICCR_CMD_TIMEOUT	(0x200)	</span><span class="cm">/* Make CRB timeout &amp; mark invalid */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICCR_CMD_EJECT	(0x400)	</span><span class="cm">/* Contents of entry written to memory</span>
<span class="cm">					 * via a WB</span>
<span class="cm">					 */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICCR_CMD_FLUSH	(0x800)</span>

<span class="cm">/*</span>
<span class="cm"> * CRB manipulation macros</span>
<span class="cm"> *	The CRB macros are slightly complicated, since there are up to</span>
<span class="cm"> * 	four registers associated with each CRB entry.</span>
<span class="cm"> */</span>
<span class="cp">#define IIO_NUM_CRBS		15	</span><span class="cm">/* Number of CRBs */</span><span class="cp"></span>
<span class="cp">#define IIO_NUM_NORMAL_CRBS     12	</span><span class="cm">/* Number of regular CRB entries */</span><span class="cp"></span>
<span class="cp">#define IIO_NUM_PC_CRBS 	4	</span><span class="cm">/* Number of partial cache CRBs */</span><span class="cp"></span>
<span class="cp">#define IIO_ICRB_OFFSET		8</span>
<span class="cp">#define IIO_ICRB_0		0x400400</span>
<span class="cm">/* XXX - This is now tuneable:</span>
<span class="cm">	#define IIO_FIRST_PC_ENTRY 12</span>
<span class="cm"> */</span>

<span class="cp">#define IIO_ICRB_A(_x)	(IIO_ICRB_0 + (4 * IIO_ICRB_OFFSET * (_x)))</span>
<span class="cp">#define IIO_ICRB_B(_x)  (IIO_ICRB_A(_x) + 1*IIO_ICRB_OFFSET)</span>
<span class="cp">#define IIO_ICRB_C(_x)	(IIO_ICRB_A(_x) + 2*IIO_ICRB_OFFSET)</span>
<span class="cp">#define IIO_ICRB_D(_x)  (IIO_ICRB_A(_x) + 3*IIO_ICRB_OFFSET)</span>

<span class="cm">/* XXX - IBUE register coming for Hub 2 */</span>

<span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * CRB Register description.</span>
<span class="cm"> *</span>
<span class="cm"> * WARNING * WARNING * WARNING * WARNING * WARNING * WARNING * WARNING</span>
<span class="cm"> * WARNING * WARNING * WARNING * WARNING * WARNING * WARNING * WARNING</span>
<span class="cm"> * WARNING * WARNING * WARNING * WARNING * WARNING * WARNING * WARNING</span>
<span class="cm"> * WARNING * WARNING * WARNING * WARNING * WARNING * WARNING * WARNING</span>
<span class="cm"> * WARNING * WARNING * WARNING * WARNING * WARNING * WARNING * WARNING</span>
<span class="cm"> *</span>
<span class="cm"> * Many of the fields in CRB are status bits used by hardware</span>
<span class="cm"> * for implementation of the protocol. It&#39;s very dangerous to</span>
<span class="cm"> * mess around with the CRB registers.</span>
<span class="cm"> *</span>
<span class="cm"> * It&#39;s OK to read the CRB registers and try to make sense out of the</span>
<span class="cm"> * fields in CRB.</span>
<span class="cm"> *</span>
<span class="cm"> * Updating CRB requires all activities in Hub IIO to be quiesced.</span>
<span class="cm"> * otherwise, a write to CRB could corrupt other CRB entries.</span>
<span class="cm"> * CRBs are here only as a back door peek to hub IIO&#39;s status.</span>
<span class="cm"> * Quiescing implies  no dmas no PIOs</span>
<span class="cm"> * either directly from the cpu or from sn0net.</span>
<span class="cm"> * this is not something that can be done easily. So, AVOID updating</span>
<span class="cm"> * CRBs.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Fields in CRB Register A</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">icrba_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> 	<span class="n">resvd</span><span class="o">:</span> 	<span class="mi">6</span><span class="p">,</span>
			<span class="nl">stall_bte0:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Stall BTE 0 */</span>
			<span class="nl">stall_bte1:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Stall BTE 1 */</span>
			<span class="nl">error:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* CRB has an error	*/</span>
			<span class="nl">ecode:</span>	<span class="mi">3</span><span class="p">,</span>	<span class="cm">/* Error Code 		*/</span>
			<span class="nl">lnetuce:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* SN0net Uncorrectable error */</span>
			<span class="nl">mark:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* CRB Has been marked 	*/</span>
			<span class="nl">xerr:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Error bit set in xtalk header */</span>
			<span class="nl">sidn:</span>	<span class="mi">4</span><span class="p">,</span>	<span class="cm">/* SIDN field from xtalk	*/</span>
			<span class="nl">tnum:</span> 	<span class="mi">5</span><span class="p">,</span>	<span class="cm">/* TNUM field in xtalk		*/</span>
			<span class="nl">addr:</span>	<span class="mi">38</span><span class="p">,</span>	<span class="cm">/* Address of request	*/</span>
			<span class="nl">valid:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Valid status		*/</span>
			<span class="nl">iow:</span>	<span class="mi">1</span><span class="p">;</span>	<span class="cm">/* IO Write operation	*/</span>
	<span class="p">}</span> <span class="n">icrba_fields_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">icrba_t</span><span class="p">;</span>

<span class="cm">/* This is an alternate typedef for the HUB1 CRB A in order to allow</span>
<span class="cm">   runtime selection of the format based on the REV_ID field of the</span>
<span class="cm">   NI_STATUS_REV_ID register. */</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">h1_icrba_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">reg_value</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> 	<span class="n">resvd</span><span class="o">:</span> 	<span class="mi">6</span><span class="p">,</span>
			<span class="nl">unused:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Unused but RW!!	*/</span>
			<span class="nl">error:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* CRB has an error	*/</span>
			<span class="nl">ecode:</span>	<span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Error Code 		*/</span>
			<span class="nl">lnetuce:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* SN0net Uncorrectable error */</span>
			<span class="nl">mark:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* CRB Has been marked 	*/</span>
			<span class="nl">xerr:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Error bit set in xtalk header */</span>
			<span class="nl">sidn:</span>	<span class="mi">4</span><span class="p">,</span>	<span class="cm">/* SIDN field from xtalk	*/</span>
			<span class="nl">tnum:</span> 	<span class="mi">5</span><span class="p">,</span>	<span class="cm">/* TNUM field in xtalk		*/</span>
			<span class="nl">addr:</span>	<span class="mi">38</span><span class="p">,</span>	<span class="cm">/* Address of request	*/</span>
			<span class="nl">valid:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Valid status		*/</span>
			<span class="nl">iow:</span>	<span class="mi">1</span><span class="p">;</span>	<span class="cm">/* IO Write operation	*/</span>
	<span class="p">}</span> <span class="n">h1_icrba_fields_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">h1_icrba_t</span><span class="p">;</span>

<span class="cm">/* XXX - Is this still right?  Check the spec. */</span>
<span class="cp">#define ICRBN_A_CERR_SHFT	54</span>
<span class="cp">#define ICRBN_A_ERR_MASK	0x3ff</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#define	IIO_ICRB_ADDR_SHFT	2	</span><span class="cm">/* Shift to get proper address */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * values for &quot;ecode&quot; field</span>
<span class="cm"> */</span>
<span class="cp">#define	IIO_ICRB_ECODE_DERR	0	</span><span class="cm">/* Directory error due to IIO access */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_ECODE_PERR	1	</span><span class="cm">/* Poison error on IO access */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_ECODE_WERR	2	</span><span class="cm">/* Write error by IIO access</span>
<span class="cm">					 * e.g. WINV to a Read only line.</span>
<span class="cm">					 */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_ECODE_AERR	3	</span><span class="cm">/* Access error caused by IIO access */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_ECODE_PWERR	4	</span><span class="cm">/* Error on partial write	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_ECODE_PRERR	5	</span><span class="cm">/* Error on partial read	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_ECODE_TOUT	6	</span><span class="cm">/* CRB timeout before deallocating */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_ECODE_XTERR	7	</span><span class="cm">/* Incoming xtalk pkt had error bit */</span><span class="cp"></span>



<span class="cm">/*</span>
<span class="cm"> * Fields in CRB Register B</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">icrbb_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
	    <span class="n">u64</span>	<span class="n">rsvd1</span><span class="o">:</span>	<span class="mi">5</span><span class="p">,</span>
		<span class="nl">btenum:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* BTE to which entry belongs to */</span>
		<span class="nl">cohtrans:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Coherent transaction	*/</span>
		<span class="nl">xtsize:</span>	<span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Xtalk operation size</span>
<span class="cm">				 * 0: Double Word</span>
<span class="cm">				 * 1: 32 Bytes.</span>
<span class="cm">				 * 2: 128 Bytes,</span>
<span class="cm">				 * 3: Reserved.</span>
<span class="cm">				 */</span>
		<span class="nl">srcnode:</span> <span class="mi">9</span><span class="p">,</span>	<span class="cm">/* Source Node ID		*/</span>
		<span class="nl">srcinit:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Source Initiator:</span>
<span class="cm">				 * See below for field values.</span>
<span class="cm">				 */</span>
		<span class="nl">useold:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Use OLD command for processing */</span>
		<span class="nl">imsgtype:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Incoming message type</span>
<span class="cm">				 * see below for field values</span>
<span class="cm">				 */</span>
		<span class="nl">imsg:</span> 	<span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Incoming message 	*/</span>
		<span class="nl">initator:</span> <span class="mi">3</span><span class="p">,</span>	<span class="cm">/* Initiator of original request</span>
<span class="cm">				 * See below for field values.</span>
<span class="cm">				 */</span>
		<span class="nl">reqtype:</span> <span class="mi">5</span><span class="p">,</span>	<span class="cm">/* Identifies type of request</span>
<span class="cm">				 * See below for field values.</span>
<span class="cm">				 */</span>
		<span class="nl">rsvd2:</span>	<span class="mi">7</span><span class="p">,</span>
		<span class="nl">ackcnt:</span>	<span class="mi">11</span><span class="p">,</span>	<span class="cm">/* Invalidate ack count	*/</span>
		<span class="nl">resp:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* data response  given to processor */</span>
		<span class="nl">ack:</span> 	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* indicates data ack received 	*/</span>
		<span class="nl">hold:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* entry is gathering inval acks */</span>
		<span class="nl">wb_pend:</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/* waiting for writeback to complete */</span>
		<span class="nl">intvn:</span> 	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Intervention */</span>
		<span class="nl">stall_ib:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Stall Ibuf (from crosstalk) */</span>
		<span class="nl">stall_intr:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Stall internal interrupts */</span>
	<span class="p">}</span> <span class="n">icrbb_field_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">icrbb_t</span><span class="p">;</span>

<span class="cm">/* This is an alternate typedef for the HUB1 CRB B in order to allow</span>
<span class="cm">   runtime selection of the format based on the REV_ID field of the</span>
<span class="cm">   NI_STATUS_REV_ID register. */</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">h1_icrbb_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>	<span class="n">rsvd1</span><span class="o">:</span>	<span class="mi">5</span><span class="p">,</span>
			<span class="nl">btenum:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* BTE to which entry belongs to */</span>
			<span class="nl">cohtrans:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Coherent transaction	*/</span>
			<span class="nl">xtsize:</span>	<span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Xtalk operation size</span>
<span class="cm">					 * 0: Double Word</span>
<span class="cm">					 * 1: 32 Bytes.</span>
<span class="cm">					 * 2: 128 Bytes,</span>
<span class="cm">					 * 3: Reserved.</span>
<span class="cm">					 */</span>
			<span class="nl">srcnode:</span> <span class="mi">9</span><span class="p">,</span>	<span class="cm">/* Source Node ID		*/</span>
			<span class="nl">srcinit:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Source Initiator:</span>
<span class="cm">					 * See below for field values.</span>
<span class="cm">					 */</span>
			<span class="nl">useold:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Use OLD command for processing */</span>
			<span class="nl">imsgtype:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Incoming message type</span>
<span class="cm">					 * see below for field values</span>
<span class="cm">					 */</span>
			<span class="nl">imsg:</span> 	<span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Incoming message 	*/</span>
			<span class="nl">initator:</span> <span class="mi">3</span><span class="p">,</span>	<span class="cm">/* Initiator of original request</span>
<span class="cm">					 * See below for field values.</span>
<span class="cm">					 */</span>
			<span class="nl">rsvd2:</span> 	<span class="mi">1</span><span class="p">,</span>
			<span class="nl">pcache:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* entry belongs to partial cache */</span>
			<span class="nl">reqtype:</span> <span class="mi">5</span><span class="p">,</span>	<span class="cm">/* Identifies type of request</span>
<span class="cm">					 * See below for field values.</span>
<span class="cm">					 */</span>
			<span class="nl">stl_ib:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* stall Ibus coming from xtalk	*/</span>
			<span class="nl">stl_intr:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Stall internal interrupts */</span>
			<span class="nl">stl_bte0:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Stall BTE 0 	*/</span>
			<span class="nl">stl_bte1:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Stall BTE 1	*/</span>
			<span class="nl">intrvn:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Req was target of intervention */</span>
			<span class="nl">ackcnt:</span>	<span class="mi">11</span><span class="p">,</span>	<span class="cm">/* Invalidate ack count	*/</span>
			<span class="nl">resp:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* data response  given to processor */</span>
			<span class="nl">ack:</span> 	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* indicates data ack received 	*/</span>
			<span class="nl">hold:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* entry is gathering inval acks */</span>
			<span class="nl">wb_pend:</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/* waiting for writeback to complete */</span>
			<span class="nl">sleep:</span> 	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* xtalk req sleeping till IO-sync */</span>
			<span class="nl">pnd_reply:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* replies not issed due to IOQ full */</span>
			<span class="nl">pnd_req:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* reqs not issued due to IOQ full */</span>
	<span class="p">}</span> <span class="n">h1_icrbb_field_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">h1_icrbb_t</span><span class="p">;</span>


<span class="cp">#define	b_imsgtype	icrbb_field_s.imsgtype</span>
<span class="cp">#define	b_btenum	icrbb_field_s.btenum</span>
<span class="cp">#define	b_cohtrans	icrbb_field_s.cohtrans</span>
<span class="cp">#define	b_xtsize	icrbb_field_s.xtsize</span>
<span class="cp">#define	b_srcnode	icrbb_field_s.srcnode</span>
<span class="cp">#define	b_srcinit	icrbb_field_s.srcinit</span>
<span class="cp">#define	b_imsgtype	icrbb_field_s.imsgtype</span>
<span class="cp">#define	b_imsg		icrbb_field_s.imsg</span>
<span class="cp">#define	b_initiator	icrbb_field_s.initiator</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * values for field xtsize</span>
<span class="cm"> */</span>
<span class="cp">#define	IIO_ICRB_XTSIZE_DW	0	</span><span class="cm">/* Xtalk operation size is 8 bytes  */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_XTSIZE_32	1	</span><span class="cm">/* Xtalk operation size is 32 bytes */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_XTSIZE_128	2	</span><span class="cm">/* Xtalk operation size is 128 bytes */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * values for field srcinit</span>
<span class="cm"> */</span>
<span class="cp">#define	IIO_ICRB_PROC0		0	</span><span class="cm">/* Source of request is Proc 0 */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_PROC1		1	</span><span class="cm">/* Source of request is Proc 1 */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_GB_REQ		2	</span><span class="cm">/* Source is Guaranteed BW request */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_IO_REQ		3	</span><span class="cm">/* Source is Normal IO request	*/</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Values for field imsgtype</span>
<span class="cm"> */</span>
<span class="cp">#define	IIO_ICRB_IMSGT_XTALK	0	</span><span class="cm">/* Incoming Meessage from Xtalk	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_IMSGT_BTE	1	</span><span class="cm">/* Incoming message from BTE 	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_IMSGT_SN0NET	2	</span><span class="cm">/* Incoming message from SN0 net */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_IMSGT_CRB	3	</span><span class="cm">/* Incoming message from CRB ???  */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * values for field initiator.</span>
<span class="cm"> */</span>
<span class="cp">#define	IIO_ICRB_INIT_XTALK	0	</span><span class="cm">/* Message originated in xtalk	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_INIT_BTE0	0x1	</span><span class="cm">/* Message originated in BTE 0	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_INIT_SN0NET	0x2	</span><span class="cm">/* Message originated in SN0net */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_INIT_CRB	0x3	</span><span class="cm">/* Message originated in CRB ? 	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_INIT_BTE1	0x5	</span><span class="cm">/* MEssage originated in BTE 1	*/</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Values for field reqtype.</span>
<span class="cm"> */</span>
<span class="cm">/* XXX - Need to fix this for Hub 2 */</span>
<span class="cp">#define	IIO_ICRB_REQ_DWRD	0	</span><span class="cm">/* Request type double word	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_QCLRD	1	</span><span class="cm">/* Request is Qrtr Caceh line Rd */</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_BLKRD	2	</span><span class="cm">/* Request is block read	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_RSHU	6	</span><span class="cm">/* Request is BTE block read	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_REXU	7	</span><span class="cm">/* request is BTE Excl Read	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_RDEX	8	</span><span class="cm">/* Request is Read Exclusive	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_WINC	9	</span><span class="cm">/* Request is Write Invalidate 	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_BWINV	10	</span><span class="cm">/* Request is BTE Winv		*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_PIORD	11	</span><span class="cm">/* Request is PIO read		*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_PIOWR	12	</span><span class="cm">/* Request is PIO Write 	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_PRDM	13	</span><span class="cm">/* Request is Fetch&amp;Op		*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_PWRM	14	</span><span class="cm">/* Request is Store &amp;Op		*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_PTPWR	15	</span><span class="cm">/* Request is Peer to peer	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_WB		16	</span><span class="cm">/* Request is Write back	*/</span><span class="cp"></span>
<span class="cp">#define	IIO_ICRB_REQ_DEX	17	</span><span class="cm">/* Retained DEX Cache line	*/</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Fields in CRB Register C</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">icrbc_s</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>	<span class="n">rsvd</span><span class="o">:</span>	<span class="mi">6</span><span class="p">,</span>
			<span class="nl">sleep:</span>	<span class="mi">1</span><span class="p">,</span>
			<span class="nl">pricnt:</span> <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Priority count sent with Read req */</span>
			<span class="nl">pripsc:</span> <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Priority Pre scalar 	*/</span>
			<span class="nl">bteop:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* BTE Operation 	*/</span>
			<span class="nl">push_be:</span> <span class="mi">34</span><span class="p">,</span>	<span class="cm">/* Push address Byte enable</span>
<span class="cm">					 * Holds push addr, if CRB is for BTE</span>
<span class="cm">					 * If CRB belongs to Partial cache,</span>
<span class="cm">					 * this contains byte enables bits</span>
<span class="cm">					 * ([47:46] = 0)</span>
<span class="cm">					 */</span>
			<span class="nl">suppl:</span>	<span class="mi">11</span><span class="p">,</span>	<span class="cm">/* Supplemental field	*/</span>
			<span class="nl">barrop:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Barrier Op bit set in xtalk req */</span>
			<span class="nl">doresp:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Xtalk req needs a response 	*/</span>
			<span class="nl">gbr:</span>	<span class="mi">1</span><span class="p">;</span>	<span class="cm">/* GBR bit set in xtalk packet 	*/</span>
	<span class="p">}</span> <span class="n">icrbc_field_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">icrbc_t</span><span class="p">;</span>

<span class="cp">#define	c_pricnt	icrbc_field_s.pricnt</span>
<span class="cp">#define	c_pripsc	icrbc_field_s.pripsc</span>
<span class="cp">#define	c_bteop		icrbc_field_s.bteop</span>
<span class="cp">#define	c_bteaddr	icrbc_field_s.push_be	</span><span class="cm">/* push_be field has 2 names */</span><span class="cp"></span>
<span class="cp">#define c_benable 	icrbc_field_s.push_be	</span><span class="cm">/* push_be field has 2 names */</span><span class="cp"></span>
<span class="cp">#define	c_suppl		icrbc_field_s.suppl</span>
<span class="cp">#define	c_barrop	icrbc_field_s.barrop</span>
<span class="cp">#define	c_doresp	icrbc_field_s.doresp</span>
<span class="cp">#define	c_gbr	icrbc_field_s.gbr</span>
<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Fields in CRB Register D</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">icrbd_s</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
	    <span class="n">u64</span>	<span class="n">rsvd</span><span class="o">:</span>	<span class="mi">38</span><span class="p">,</span>
		<span class="nl">toutvld:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Timeout in progress for this CRB */</span>
		<span class="nl">ctxtvld:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Context field below is valid	*/</span>
		<span class="nl">rsvd2:</span>	<span class="mi">1</span><span class="p">,</span>
		<span class="nl">context:</span> <span class="mi">15</span><span class="p">,</span> 	<span class="cm">/* Bit vector:</span>
<span class="cm">				 * Has a bit set for each CRB entry</span>
<span class="cm">				 * which needs to be deallocated</span>
<span class="cm">				 * before this CRB entry is processed.</span>
<span class="cm">				 * Set only for barrier operations.</span>
<span class="cm">				 */</span>
		<span class="nl">timeout:</span> <span class="mi">8</span><span class="p">;</span>	<span class="cm">/* Timeout Upper 8 bits	*/</span>
	<span class="p">}</span> <span class="n">icrbd_field_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">icrbd_t</span><span class="p">;</span>

<span class="cp">#define	icrbd_toutvld	icrbd_field_s.toutvld</span>
<span class="cp">#define	icrbd_ctxtvld	icrbd_field_s.ctxtvld</span>
<span class="cp">#define	icrbd_context	icrbd_field_s.context</span>


<span class="k">typedef</span> <span class="k">union</span> <span class="n">hubii_ifdr_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">hi_ifdr_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>	<span class="n">ifdr_rsvd</span><span class="o">:</span>	<span class="mi">49</span><span class="p">,</span>
	                <span class="nl">ifdr_maxrp:</span>	 <span class="mi">7</span><span class="p">,</span>
	                <span class="nl">ifdr_rsvd1:</span>	 <span class="mi">1</span><span class="p">,</span>
			<span class="nl">ifdr_maxrq:</span>	 <span class="mi">7</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">hi_ifdr_fields</span><span class="p">;</span>
<span class="p">}</span> <span class="n">hubii_ifdr_t</span><span class="p">;</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Hardware designed names for the BTE control registers.</span>
<span class="cm"> */</span>
<span class="cp">#define IIO_IBLS_0	0x410000	</span><span class="cm">/* BTE length/status 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_IBSA_0	0x410008	</span><span class="cm">/* BTE source address 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_IBDA_0	0x410010	</span><span class="cm">/* BTE destination address 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_IBCT_0	0x410018	</span><span class="cm">/* BTE control/terminate 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_IBNA_0	0x410020	</span><span class="cm">/* BTE notification address 0 */</span><span class="cp"></span>
<span class="cp">#define IIO_IBNR_0	IIO_IBNA_0</span>
<span class="cp">#define IIO_IBIA_0	0x410028	</span><span class="cm">/* BTE interrupt address 0 */</span><span class="cp"></span>

<span class="cp">#define IIO_IBLS_1	0x420000	</span><span class="cm">/* BTE length/status 1 */</span><span class="cp"></span>
<span class="cp">#define IIO_IBSA_1	0x420008	</span><span class="cm">/* BTE source address 1 */</span><span class="cp"></span>
<span class="cp">#define IIO_IBDA_1	0x420010	</span><span class="cm">/* BTE destination address 1 */</span><span class="cp"></span>
<span class="cp">#define IIO_IBCT_1	0x420018	</span><span class="cm">/* BTE control/terminate 1 */</span><span class="cp"></span>
<span class="cp">#define IIO_IBNA_1	0x420020	</span><span class="cm">/* BTE notification address 1 */</span><span class="cp"></span>
<span class="cp">#define IIO_IBNR_1	IIO_IBNA_1</span>
<span class="cp">#define IIO_IBIA_1	0x420028	</span><span class="cm">/* BTE interrupt address 1 */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * More miscellaneous registers</span>
<span class="cm"> */</span>
<span class="cp">#define IIO_IPCR	0x430000	</span><span class="cm">/* Performance Control */</span><span class="cp"></span>
<span class="cp">#define IIO_IPPR	0x430008	</span><span class="cm">/* Performance Profiling */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * IO Error Clear register bit field definitions</span>
<span class="cm"> */</span>
<span class="cp">#define IECLR_BTE1		(1 &lt;&lt; 18)  </span><span class="cm">/* clear bte error 1 ??? */</span><span class="cp"></span>
<span class="cp">#define IECLR_BTE0		(1 &lt;&lt; 17)  </span><span class="cm">/* clear bte error 0 ??? */</span><span class="cp"></span>
<span class="cp">#define IECLR_CRAZY		(1 &lt;&lt; 16)  </span><span class="cm">/* clear crazy bit in wstat reg */</span><span class="cp"></span>
<span class="cp">#define IECLR_PRB_F		(1 &lt;&lt; 15)  </span><span class="cm">/* clear err bit in PRB_F reg */</span><span class="cp"></span>
<span class="cp">#define IECLR_PRB_E		(1 &lt;&lt; 14)  </span><span class="cm">/* clear err bit in PRB_E reg */</span><span class="cp"></span>
<span class="cp">#define IECLR_PRB_D		(1 &lt;&lt; 13)  </span><span class="cm">/* clear err bit in PRB_D reg */</span><span class="cp"></span>
<span class="cp">#define IECLR_PRB_C		(1 &lt;&lt; 12)  </span><span class="cm">/* clear err bit in PRB_C reg */</span><span class="cp"></span>
<span class="cp">#define IECLR_PRB_B		(1 &lt;&lt; 11)  </span><span class="cm">/* clear err bit in PRB_B reg */</span><span class="cp"></span>
<span class="cp">#define IECLR_PRB_A		(1 &lt;&lt; 10)  </span><span class="cm">/* clear err bit in PRB_A reg */</span><span class="cp"></span>
<span class="cp">#define IECLR_PRB_9		(1 &lt;&lt; 9)   </span><span class="cm">/* clear err bit in PRB_9 reg */</span><span class="cp"></span>
<span class="cp">#define IECLR_PRB_8		(1 &lt;&lt; 8)   </span><span class="cm">/* clear err bit in PRB_8 reg */</span><span class="cp"></span>
<span class="cp">#define IECLR_PRB_0		(1 &lt;&lt; 0)   </span><span class="cm">/* clear err bit in PRB_0 reg */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * IO PIO Read Table Entry format</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">iprte_a</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">entry</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
	    <span class="n">u64</span>	<span class="n">rsvd1</span>     <span class="o">:</span> <span class="mi">7</span><span class="p">,</span>  <span class="cm">/* Reserved field 		*/</span>
		<span class="n">valid</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Maps to a timeout entry	*/</span>
		<span class="n">rsvd2</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		<span class="n">srcnode</span>   <span class="o">:</span> <span class="mi">9</span><span class="p">,</span>	<span class="cm">/* Node which did this PIO	*/</span>
		<span class="n">initiator</span> <span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* If T5A or T5B or IO 		*/</span>
		<span class="n">rsvd3</span>     <span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
		<span class="n">addr</span>      <span class="o">:</span> <span class="mi">38</span><span class="p">,</span>	<span class="cm">/* Physical address of PIO	*/</span>
		<span class="n">rsvd4</span>     <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">iprte_fields</span><span class="p">;</span>
<span class="p">}</span> <span class="n">iprte_a_t</span><span class="p">;</span>

<span class="cp">#define	iprte_valid	iprte_fields.valid</span>
<span class="cp">#define	iprte_timeout	iprte_fields.timeout</span>
<span class="cp">#define	iprte_srcnode	iprte_fields.srcnode</span>
<span class="cp">#define	iprte_init	iprte_fields.initiator</span>
<span class="cp">#define	iprte_addr	iprte_fields.addr</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#define	IPRTE_ADDRSHFT	3</span>

<span class="cm">/*</span>
<span class="cm"> * Hub IIO PRB Register format.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="cm">/*</span>
<span class="cm"> * Note: Fields bnakctr, anakctr, xtalkctrmode, ovflow fields are</span>
<span class="cm"> * &quot;Status&quot; fields, and should only be used in case of clean up after errors.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">iprb_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">reg_value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
	    <span class="n">u64</span>	<span class="n">rsvd1</span><span class="o">:</span>	<span class="mi">15</span><span class="p">,</span>
		<span class="nl">error:</span>	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Widget rcvd wr resp pkt w/ error */</span>
		<span class="nl">ovflow:</span>	<span class="mi">5</span><span class="p">,</span>	<span class="cm">/* Overflow count. perf measurement */</span>
		<span class="nl">fire_and_forget:</span> <span class="mi">1</span><span class="p">,</span> <span class="cm">/* Launch Write without response */</span>
		<span class="nl">mode:</span>	<span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Widget operation Mode	*/</span>
		<span class="nl">rsvd2:</span>	<span class="mi">2</span><span class="p">,</span>
		<span class="nl">bnakctr:</span> <span class="mi">14</span><span class="p">,</span>
		<span class="nl">rsvd3:</span> 	<span class="mi">2</span><span class="p">,</span>
		<span class="nl">anakctr:</span> <span class="mi">14</span><span class="p">,</span>
		<span class="nl">xtalkctr:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">iprb_fields_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">iprb_t</span><span class="p">;</span>

<span class="cp">#define iprb_regval	reg_value</span>

<span class="cp">#define	iprb_error	iprb_fields_s.error</span>
<span class="cp">#define	iprb_ovflow	iprb_fields_s.ovflow</span>
<span class="cp">#define	iprb_ff		iprb_fields_s.fire_and_forget</span>
<span class="cp">#define	iprb_mode	iprb_fields_s.mode</span>
<span class="cp">#define	iprb_bnakctr	iprb_fields_s.bnakctr</span>
<span class="cp">#define	iprb_anakctr	iprb_fields_s.anakctr</span>
<span class="cp">#define	iprb_xtalkctr	iprb_fields_s.xtalkctr</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * values for mode field in iprb_t.</span>
<span class="cm"> * For details of the meanings of NAK and Accept, refer the PIO flow</span>
<span class="cm"> * document</span>
<span class="cm"> */</span>
<span class="cp">#define	IPRB_MODE_NORMAL	(0)</span>
<span class="cp">#define	IPRB_MODE_COLLECT_A	(1)	</span><span class="cm">/* PRB in collect A mode */</span><span class="cp"></span>
<span class="cp">#define	IPRB_MODE_SERVICE_A	(2)	</span><span class="cm">/* NAK B and Accept A */</span><span class="cp"></span>
<span class="cp">#define	IPRB_MODE_SERVICE_B	(3)	</span><span class="cm">/* NAK A and Accept B */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * IO CRB entry C_A to E_A : Partial (cache) CRBS</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">icrbp_a</span> <span class="p">{</span>
	<span class="n">u64</span>   <span class="n">ip_reg</span><span class="p">;</span>	    <span class="cm">/* the entire register value	*/</span>
	<span class="k">struct</span> <span class="p">{</span>
	     <span class="n">u64</span> <span class="n">error</span><span class="o">:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    63, error occurred		*/</span>
		<span class="nl">ln_uce:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    62: uncorrectable memory 	*/</span>
		<span class="nl">ln_ae:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    61: protection violation 	*/</span>
		<span class="nl">ln_werr:</span><span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    60: write access error 	*/</span>
		<span class="nl">ln_aerr:</span><span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    59: sn0net: Address error	*/</span>
		<span class="nl">ln_perr:</span><span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    58: sn0net: poison error	*/</span>
		<span class="nl">timeout:</span><span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    57: CRB timed out		*/</span>
		<span class="nl">l_bdpkt:</span><span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    56: truncated pkt on sn0net	*/</span>
		<span class="nl">c_bdpkt:</span><span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    55: truncated pkt on xtalk	*/</span>
		<span class="nl">c_err:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    54: incoming xtalk req, err set*/</span>
		<span class="nl">rsvd1:</span> <span class="mi">12</span><span class="p">,</span>  <span class="cm">/* 53-42: reserved			*/</span>
		<span class="nl">valid:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    41: Valid status		*/</span>
		<span class="nl">sidn:</span>	<span class="mi">4</span><span class="p">,</span>  <span class="cm">/* 40-37: SIDN field of xtalk rqst	*/</span>
		<span class="nl">tnum:</span>	<span class="mi">5</span><span class="p">,</span>  <span class="cm">/* 36-32: TNUM of xtalk request	*/</span>
		<span class="nl">bo:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    31: barrier op set in xtalk rqst*/</span>
		<span class="nl">resprqd:</span><span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    30: xtalk rqst requires response*/</span>
		<span class="nl">gbr:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    29: gbr bit set in xtalk rqst	*/</span>
		<span class="nl">size:</span>	<span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 28-27: size of xtalk request	*/</span>
		<span class="nl">excl:</span>	<span class="mi">4</span><span class="p">,</span>  <span class="cm">/* 26-23: exclusive bit(s)		*/</span>
		<span class="nl">stall:</span>	<span class="mi">3</span><span class="p">,</span>  <span class="cm">/* 22-20: stall (xtalk, bte 0/1)	*/</span>
		<span class="nl">intvn:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    19: rqst target of intervention*/</span>
		<span class="nl">resp:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    18: Data response given to t5	*/</span>
		<span class="nl">ack:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    17: Data ack received.	*/</span>
		<span class="nl">hold:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    16: crb gathering invalidate acks*/</span>
		<span class="nl">wb:</span>	<span class="mi">1</span><span class="p">,</span>  <span class="cm">/*    15: writeback pending.	*/</span>
		<span class="nl">ack_cnt:</span><span class="mi">11</span><span class="p">,</span> <span class="cm">/* 14-04: counter of invalidate acks*/</span>
		<span class="nl">tscaler:</span><span class="mi">4</span><span class="p">;</span>  <span class="cm">/* 03-00: Timeout prescaler		*/</span>
	<span class="p">}</span> <span class="n">ip_fmt</span><span class="p">;</span>
<span class="p">}</span> <span class="n">icrbp_a_t</span><span class="p">;</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * A couple of defines to go with the above structure.</span>
<span class="cm"> */</span>
<span class="cp">#define ICRBP_A_CERR_SHFT	54</span>
<span class="cp">#define ICRBP_A_ERR_MASK	0x3ff</span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">hubii_idsr</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">iin_reg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">rsvd1</span> <span class="o">:</span> <span class="mi">35</span><span class="p">,</span>
	            <span class="n">isent</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
	            <span class="n">rsvd2</span> <span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
	            <span class="nl">ienable:</span> <span class="mi">1</span><span class="p">,</span>
	            <span class="n">rsvd</span>  <span class="o">:</span> <span class="mi">7</span><span class="p">,</span>
	            <span class="n">node</span>  <span class="o">:</span> <span class="mi">9</span><span class="p">,</span>
	            <span class="n">rsvd4</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
	            <span class="n">level</span> <span class="o">:</span> <span class="mi">7</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">iin_fmt</span><span class="p">;</span>
<span class="p">}</span> <span class="n">hubii_idsr_t</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * IO BTE Length/Status (IIO_IBLS) register bit field definitions</span>
<span class="cm"> */</span>
<span class="cp">#define IBLS_BUSY		(0x1 &lt;&lt; 20)</span>
<span class="cp">#define IBLS_ERROR_SHFT		16</span>
<span class="cp">#define IBLS_ERROR		(0x1 &lt;&lt; IBLS_ERROR_SHFT)</span>
<span class="cp">#define IBLS_LENGTH_MASK	0xffff</span>

<span class="cm">/*</span>
<span class="cm"> * IO BTE Control/Terminate register (IBCT) register bit field definitions</span>
<span class="cm"> */</span>
<span class="cp">#define IBCT_POISON		(0x1 &lt;&lt; 8)</span>
<span class="cp">#define IBCT_NOTIFY		(0x1 &lt;&lt; 4)</span>
<span class="cp">#define IBCT_ZFIL_MODE		(0x1 &lt;&lt; 0)</span>

<span class="cm">/*</span>
<span class="cm"> * IO BTE Interrupt Address Register (IBIA) register bit field definitions</span>
<span class="cm"> */</span>
<span class="cp">#define IBIA_LEVEL_SHFT		16</span>
<span class="cp">#define IBIA_LEVEL_MASK		(0x7f &lt;&lt; IBIA_LEVEL_SHFT)</span>
<span class="cp">#define IBIA_NODE_ID_SHFT	0</span>
<span class="cp">#define IBIA_NODE_ID_MASK	(0x1ff)</span>

<span class="cm">/*</span>
<span class="cm"> * Miscellaneous hub constants</span>
<span class="cm"> */</span>

<span class="cm">/* Number of widgets supported by hub */</span>
<span class="cp">#define HUB_NUM_WIDGET		9</span>
<span class="cp">#define HUB_WIDGET_ID_MIN	0x8</span>
<span class="cp">#define HUB_WIDGET_ID_MAX	0xf</span>

<span class="cp">#define HUB_WIDGET_PART_NUM	0xc101</span>
<span class="cp">#define MAX_HUBS_PER_XBOW	2</span>

<span class="cm">/*</span>
<span class="cm"> * Get a hub&#39;s widget id from widget control register</span>
<span class="cm"> */</span>
<span class="cp">#define IIO_WCR_WID_GET(nasid)	(REMOTE_HUB_L(nasid, III_WCR) &amp; 0xf)</span>
<span class="cp">#define IIO_WST_ERROR_MASK	(UINT64_CAST 1 &lt;&lt; 32) </span><span class="cm">/* Widget status error */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Number of credits Hub widget has while sending req/response to</span>
<span class="cm"> * xbow.</span>
<span class="cm"> * Value of 3 is required by Xbow 1.1</span>
<span class="cm"> * We may be able to increase this to 4 with Xbow 1.2.</span>
<span class="cm"> */</span>
<span class="cp">#define       HUBII_XBOW_CREDIT       3</span>
<span class="cp">#define	      HUBII_XBOW_REV2_CREDIT  4</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_SGI_SN_SN0_HUBIO_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:6}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../../javascript/docco.min.js"></script>
</html>
