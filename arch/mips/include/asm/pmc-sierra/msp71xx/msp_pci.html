<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › pmc-sierra › msp71xx › msp_pci.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../../index.html"></a><h1>msp_pci.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2000-2006 PMC-Sierra INC.</span>
<span class="cm"> *</span>
<span class="cm"> *     This program is free software; you can redistribute it</span>
<span class="cm"> *     and/or modify it under the terms of the GNU General</span>
<span class="cm"> *     Public License as published by the Free Software</span>
<span class="cm"> *     Foundation; either version 2 of the License, or (at your</span>
<span class="cm"> *     option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *     This program is distributed in the hope that it will be</span>
<span class="cm"> *     useful, but WITHOUT ANY WARRANTY; without even the implied</span>
<span class="cm"> *     warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span>
<span class="cm"> *     PURPOSE.  See the GNU General Public License for more</span>
<span class="cm"> *     details.</span>
<span class="cm"> *</span>
<span class="cm"> *     You should have received a copy of the GNU General Public</span>
<span class="cm"> *     License along with this program; if not, write to the Free</span>
<span class="cm"> *     Software Foundation, Inc., 675 Mass Ave, Cambridge, MA</span>
<span class="cm"> *     02139, USA.</span>
<span class="cm"> *</span>
<span class="cm"> * PMC-SIERRA INC. DISCLAIMS ANY LIABILITY OF ANY KIND</span>
<span class="cm"> * FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS</span>
<span class="cm"> * SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _MSP_PCI_H_</span>
<span class="cp">#define _MSP_PCI_H_</span>

<span class="cp">#define MSP_HAS_PCI(ID)	(((u32)(ID) &lt;= 0x4236) &amp;&amp; ((u32)(ID) &gt;= 0x4220))</span>

<span class="cm">/*</span>
<span class="cm"> * It is convenient to program the OATRAN register so that</span>
<span class="cm"> * Athena virtual address space and PCI address space are</span>
<span class="cm"> * the same. This is not a requirement, just a convenience.</span>
<span class="cm"> *</span>
<span class="cm"> * The only hard restrictions on the value of OATRAN is that</span>
<span class="cm"> * OATRAN must not be programmed to allow translated memory</span>
<span class="cm"> * addresses to fall within the lowest 512MB of</span>
<span class="cm"> * PCI address space. This region is hardcoded</span>
<span class="cm"> * for use as Athena PCI Host Controller target</span>
<span class="cm"> * access memory space to the Athena&#39;s SDRAM.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that OATRAN applies only to memory accesses, not</span>
<span class="cm"> * to I/O accesses.</span>
<span class="cm"> *</span>
<span class="cm"> * To program OATRAN to make Athena virtual address space</span>
<span class="cm"> * and PCI address space have the same values, OATRAN</span>
<span class="cm"> * is to be programmed to 0xB8000000. The top seven</span>
<span class="cm"> * bits of the value mimic the seven bits clipped off</span>
<span class="cm"> * by the PCI Host controller.</span>
<span class="cm"> *</span>
<span class="cm"> * With OATRAN at the said value, when the CPU does</span>
<span class="cm"> * an access to its virtual address at, say 0xB900_5000,</span>
<span class="cm"> * the address appearing on the PCI bus will be</span>
<span class="cm"> * 0xB900_5000.</span>
<span class="cm"> *    - Michael Penner</span>
<span class="cm"> */</span>
<span class="cp">#define MSP_PCI_OATRAN		0xB8000000UL</span>

<span class="cp">#define MSP_PCI_SPACE_BASE	(MSP_PCI_OATRAN + 0x1002000UL)</span>
<span class="cp">#define MSP_PCI_SPACE_SIZE	(0x3000000UL - 0x2000)</span>
<span class="cp">#define MSP_PCI_SPACE_END \</span>
<span class="cp">		(MSP_PCI_SPACE_BASE + MSP_PCI_SPACE_SIZE - 1)</span>
<span class="cp">#define MSP_PCI_IOSPACE_BASE	(MSP_PCI_OATRAN + 0x1001000UL)</span>
<span class="cp">#define MSP_PCI_IOSPACE_SIZE	0x1000</span>
<span class="cp">#define MSP_PCI_IOSPACE_END  \</span>
<span class="cp">		(MSP_PCI_IOSPACE_BASE + MSP_PCI_IOSPACE_SIZE - 1)</span>

<span class="cm">/* IRQ for PCI status interrupts */</span>
<span class="cp">#define PCI_STAT_IRQ	20</span>

<span class="cp">#define QFLUSH_REG_1	0xB7F40000</span>

<span class="k">typedef</span> <span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pcireg</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="o">*</span> <span class="k">volatile</span> <span class="n">ppcireg</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">pci_block_copy</span>
<span class="p">{</span>
    <span class="n">pcireg</span>   <span class="n">unused1</span><span class="p">;</span> <span class="cm">/* +0x00 */</span>
    <span class="n">pcireg</span>   <span class="n">unused2</span><span class="p">;</span> <span class="cm">/* +0x04 */</span>
    <span class="n">ppcireg</span>  <span class="n">unused3</span><span class="p">;</span> <span class="cm">/* +0x08 */</span>
    <span class="n">ppcireg</span>  <span class="n">unused4</span><span class="p">;</span> <span class="cm">/* +0x0C */</span>
    <span class="n">pcireg</span>   <span class="n">unused5</span><span class="p">;</span> <span class="cm">/* +0x10 */</span>
    <span class="n">pcireg</span>   <span class="n">unused6</span><span class="p">;</span> <span class="cm">/* +0x14 */</span>
    <span class="n">pcireg</span>   <span class="n">unused7</span><span class="p">;</span> <span class="cm">/* +0x18 */</span>
    <span class="n">ppcireg</span>  <span class="n">unused8</span><span class="p">;</span> <span class="cm">/* +0x1C */</span>
    <span class="n">ppcireg</span>  <span class="n">unused9</span><span class="p">;</span> <span class="cm">/* +0x20 */</span>
    <span class="n">pcireg</span>   <span class="n">unusedA</span><span class="p">;</span> <span class="cm">/* +0x24 */</span>
    <span class="n">ppcireg</span>  <span class="n">unusedB</span><span class="p">;</span> <span class="cm">/* +0x28 */</span>
    <span class="n">ppcireg</span>  <span class="n">unusedC</span><span class="p">;</span> <span class="cm">/* +0x2C */</span>
<span class="p">};</span>

<span class="k">enum</span>
<span class="p">{</span>
    <span class="n">config_device_vendor</span><span class="p">,</span>  <span class="cm">/* 0 */</span>
    <span class="n">config_status_command</span><span class="p">,</span> <span class="cm">/* 1 */</span>
    <span class="n">config_class_revision</span><span class="p">,</span> <span class="cm">/* 2 */</span>
    <span class="n">config_BIST_header_latency_cache</span><span class="p">,</span> <span class="cm">/* 3 */</span>
    <span class="n">config_BAR0</span><span class="p">,</span>           <span class="cm">/* 4 */</span>
    <span class="n">config_BAR1</span><span class="p">,</span>           <span class="cm">/* 5 */</span>
    <span class="n">config_BAR2</span><span class="p">,</span>           <span class="cm">/* 6 */</span>
    <span class="n">config_not_used7</span><span class="p">,</span>      <span class="cm">/* 7 */</span>
    <span class="n">config_not_used8</span><span class="p">,</span>      <span class="cm">/* 8 */</span>
    <span class="n">config_not_used9</span><span class="p">,</span>      <span class="cm">/* 9 */</span>
    <span class="n">config_CIS</span><span class="p">,</span>            <span class="cm">/* 10 */</span>
    <span class="n">config_subsystem</span><span class="p">,</span>      <span class="cm">/* 11 */</span>
    <span class="n">config_not_used12</span><span class="p">,</span>     <span class="cm">/* 12 */</span>
    <span class="n">config_capabilities</span><span class="p">,</span>   <span class="cm">/* 13 */</span>
    <span class="n">config_not_used14</span><span class="p">,</span>     <span class="cm">/* 14 */</span>
    <span class="n">config_lat_grant_irq</span><span class="p">,</span>  <span class="cm">/* 15 */</span>
    <span class="n">config_message_control</span><span class="p">,</span><span class="cm">/* 16 */</span>
    <span class="n">config_message_addr</span><span class="p">,</span>   <span class="cm">/* 17 */</span>
    <span class="n">config_message_data</span><span class="p">,</span>   <span class="cm">/* 18 */</span>
    <span class="n">config_VPD_addr</span><span class="p">,</span>       <span class="cm">/* 19 */</span>
    <span class="n">config_VPD_data</span><span class="p">,</span>       <span class="cm">/* 20 */</span>
    <span class="n">config_maxregs</span>         <span class="cm">/* 21 - number of registers */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">msp_pci_regs</span>
<span class="p">{</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_00</span><span class="p">;</span> <span class="cm">/* +0x00 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_04</span><span class="p">;</span> <span class="cm">/* +0x04 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_08</span><span class="p">;</span> <span class="cm">/* +0x08 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_0C</span><span class="p">;</span> <span class="cm">/* +0x0C */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_10</span><span class="p">;</span> <span class="cm">/* +0x10 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_14</span><span class="p">;</span> <span class="cm">/* +0x14 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_18</span><span class="p">;</span> <span class="cm">/* +0x18 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_1C</span><span class="p">;</span> <span class="cm">/* +0x1C */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_20</span><span class="p">;</span> <span class="cm">/* +0x20 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_24</span><span class="p">;</span> <span class="cm">/* +0x24 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_28</span><span class="p">;</span> <span class="cm">/* +0x28 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_2C</span><span class="p">;</span> <span class="cm">/* +0x2C */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_30</span><span class="p">;</span> <span class="cm">/* +0x30 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_34</span><span class="p">;</span> <span class="cm">/* +0x34 */</span>
    <span class="n">pcireg</span> <span class="n">if_control</span><span class="p">;</span>    <span class="cm">/* +0x38 */</span>
    <span class="n">pcireg</span> <span class="n">oatran</span><span class="p">;</span>        <span class="cm">/* +0x3C */</span>
    <span class="n">pcireg</span> <span class="n">reset_ctl</span><span class="p">;</span>     <span class="cm">/* +0x40 */</span>
    <span class="n">pcireg</span> <span class="n">config_addr</span><span class="p">;</span>   <span class="cm">/* +0x44 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_48</span><span class="p">;</span> <span class="cm">/* +0x48 */</span>
    <span class="n">pcireg</span> <span class="n">msg_signaled_int_status</span><span class="p">;</span> <span class="cm">/* +0x4C */</span>
    <span class="n">pcireg</span> <span class="n">msg_signaled_int_mask</span><span class="p">;</span>   <span class="cm">/* +0x50 */</span>
    <span class="n">pcireg</span> <span class="n">if_status</span><span class="p">;</span>     <span class="cm">/* +0x54 */</span>
    <span class="n">pcireg</span> <span class="n">if_mask</span><span class="p">;</span>       <span class="cm">/* +0x58 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_5C</span><span class="p">;</span> <span class="cm">/* +0x5C */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_60</span><span class="p">;</span> <span class="cm">/* +0x60 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_64</span><span class="p">;</span> <span class="cm">/* +0x64 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_68</span><span class="p">;</span> <span class="cm">/* +0x68 */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_6C</span><span class="p">;</span> <span class="cm">/* +0x6C */</span>
    <span class="n">pcireg</span> <span class="n">hop_unused_70</span><span class="p">;</span> <span class="cm">/* +0x70 */</span>

    <span class="k">struct</span> <span class="n">pci_block_copy</span> <span class="n">pci_bc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">64</span><span class="p">)));</span>

    <span class="n">pcireg</span> <span class="n">error_hdr1</span><span class="p">;</span> <span class="cm">/* +0xE0 */</span>
    <span class="n">pcireg</span> <span class="n">error_hdr2</span><span class="p">;</span> <span class="cm">/* +0xE4 */</span>

    <span class="n">pcireg</span> <span class="n">config</span><span class="p">[</span><span class="n">config_maxregs</span><span class="p">]</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">256</span><span class="p">)));</span>

<span class="p">};</span>

<span class="cp">#define BPCI_CFGADDR_BUSNUM_SHF 16</span>
<span class="cp">#define BPCI_CFGADDR_FUNCTNUM_SHF 8</span>
<span class="cp">#define BPCI_CFGADDR_REGNUM_SHF 2</span>
<span class="cp">#define BPCI_CFGADDR_ENABLE (1&lt;&lt;31)</span>

<span class="cp">#define BPCI_IFCONTROL_RTO (1&lt;&lt;20) </span><span class="cm">/* Retry timeout */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFCONTROL_HCE (1&lt;&lt;16) </span><span class="cm">/* Host configuration enable */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFCONTROL_CTO_SHF 12  </span><span class="cm">/* Shift count for CTO bits */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFCONTROL_SE  (1&lt;&lt;5)  </span><span class="cm">/* Enable exceptions on errors */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFCONTROL_BIST (1&lt;&lt;4) </span><span class="cm">/* Use BIST in per. mode */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFCONTROL_CAP (1&lt;&lt;3)  </span><span class="cm">/* Enable capabilities */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFCONTROL_MMC_SHF 0   </span><span class="cm">/* Shift count for MMC bits */</span><span class="cp"></span>

<span class="cp">#define BPCI_IFSTATUS_MGT  (1&lt;&lt;8)  </span><span class="cm">/* Master Grant timeout */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_MTT  (1&lt;&lt;9)  </span><span class="cm">/* Master TRDY timeout */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_MRT  (1&lt;&lt;10) </span><span class="cm">/* Master retry timeout */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_BC0F (1&lt;&lt;13) </span><span class="cm">/* Block copy 0 fault */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_BC1F (1&lt;&lt;14) </span><span class="cm">/* Block copy 1 fault */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_PCIU (1&lt;&lt;15) </span><span class="cm">/* PCI unable to respond */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_BSIZ (1&lt;&lt;16) </span><span class="cm">/* PCI access with illegal size */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_BADD (1&lt;&lt;17) </span><span class="cm">/* PCI access with illegal addr */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_RTO  (1&lt;&lt;18) </span><span class="cm">/* Retry time out */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_SER  (1&lt;&lt;19) </span><span class="cm">/* System error */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_PER  (1&lt;&lt;20) </span><span class="cm">/* Parity error */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_LCA  (1&lt;&lt;21) </span><span class="cm">/* Local CPU abort */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_MEM  (1&lt;&lt;22) </span><span class="cm">/* Memory prot. violation */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_ARB  (1&lt;&lt;23) </span><span class="cm">/* Arbiter timed out */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_STA  (1&lt;&lt;27) </span><span class="cm">/* Signaled target abort */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_TA   (1&lt;&lt;28) </span><span class="cm">/* Target abort */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_MA   (1&lt;&lt;29) </span><span class="cm">/* Master abort */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_PEI  (1&lt;&lt;30) </span><span class="cm">/* Parity error as initiator */</span><span class="cp"></span>
<span class="cp">#define BPCI_IFSTATUS_PET  (1&lt;&lt;31) </span><span class="cm">/* Parity error as target */</span><span class="cp"></span>

<span class="cp">#define BPCI_RESETCTL_PR (1&lt;&lt;0)    </span><span class="cm">/* True if reset asserted */</span><span class="cp"></span>
<span class="cp">#define BPCI_RESETCTL_RT (1&lt;&lt;4)    </span><span class="cm">/* Release time */</span><span class="cp"></span>
<span class="cp">#define BPCI_RESETCTL_CT (1&lt;&lt;8)    </span><span class="cm">/* Config time */</span><span class="cp"></span>
<span class="cp">#define BPCI_RESETCTL_PE (1&lt;&lt;12)   </span><span class="cm">/* PCI enabled */</span><span class="cp"></span>
<span class="cp">#define BPCI_RESETCTL_HM (1&lt;&lt;13)   </span><span class="cm">/* PCI host mode */</span><span class="cp"></span>
<span class="cp">#define BPCI_RESETCTL_RI (1&lt;&lt;14)   </span><span class="cm">/* PCI reset in */</span><span class="cp"></span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">msp_pci_regs</span> <span class="n">msp_pci_regs</span>
			<span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;.register&quot;</span><span class="p">)));</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">msp_pci_config_space</span>
			<span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s">&quot;.register&quot;</span><span class="p">)));</span>

<span class="cp">#endif </span><span class="cm">/* !_MSP_PCI_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:6}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../../javascript/docco.min.js"></script>
</html>
