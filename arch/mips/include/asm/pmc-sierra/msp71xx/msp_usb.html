<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mips › include › asm › pmc-sierra › msp71xx › msp_usb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../../index.html"></a><h1>msp_usb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/******************************************************************</span>
<span class="cm"> * Copyright (c) 2000-2007 PMC-Sierra INC.</span>
<span class="cm"> *</span>
<span class="cm"> *     This program is free software; you can redistribute it</span>
<span class="cm"> *     and/or modify it under the terms of the GNU General</span>
<span class="cm"> *     Public License as published by the Free Software</span>
<span class="cm"> *     Foundation; either version 2 of the License, or (at your</span>
<span class="cm"> *     option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *     This program is distributed in the hope that it will be</span>
<span class="cm"> *     useful, but WITHOUT ANY WARRANTY; without even the implied</span>
<span class="cm"> *     warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span>
<span class="cm"> *     PURPOSE.  See the GNU General Public License for more</span>
<span class="cm"> *     details.</span>
<span class="cm"> *</span>
<span class="cm"> *     You should have received a copy of the GNU General Public</span>
<span class="cm"> *     License along with this program; if not, write to the Free</span>
<span class="cm"> *     Software Foundation, Inc., 675 Mass Ave, Cambridge, MA</span>
<span class="cm"> *     02139, USA.</span>
<span class="cm"> *</span>
<span class="cm"> * PMC-SIERRA INC. DISCLAIMS ANY LIABILITY OF ANY KIND</span>
<span class="cm"> * FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS</span>
<span class="cm"> * SOFTWARE.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef MSP_USB_H_</span>
<span class="cp">#define MSP_USB_H_</span>

<span class="cp">#ifdef CONFIG_MSP_HAS_DUAL_USB</span>
<span class="cp">#define NUM_USB_DEVS   2</span>
<span class="cp">#else</span>
<span class="cp">#define NUM_USB_DEVS   1</span>
<span class="cp">#endif</span>

<span class="cm">/* Register spaces for USB host 0 */</span>
<span class="cp">#define MSP_USB0_MAB_START	(MSP_USB0_BASE + 0x0)</span>
<span class="cp">#define MSP_USB0_MAB_END	(MSP_USB0_BASE + 0x17)</span>
<span class="cp">#define MSP_USB0_ID_START	(MSP_USB0_BASE + 0x40000)</span>
<span class="cp">#define MSP_USB0_ID_END		(MSP_USB0_BASE + 0x4008f)</span>
<span class="cp">#define MSP_USB0_HS_START	(MSP_USB0_BASE + 0x40100)</span>
<span class="cp">#define MSP_USB0_HS_END		(MSP_USB0_BASE + 0x401FF)</span>

<span class="cm">/* Register spaces for USB host 1 */</span>
<span class="cp">#define	MSP_USB1_MAB_START	(MSP_USB1_BASE + 0x0)</span>
<span class="cp">#define MSP_USB1_MAB_END	(MSP_USB1_BASE + 0x17)</span>
<span class="cp">#define MSP_USB1_ID_START	(MSP_USB1_BASE + 0x40000)</span>
<span class="cp">#define MSP_USB1_ID_END		(MSP_USB1_BASE + 0x4008f)</span>
<span class="cp">#define MSP_USB1_HS_START	(MSP_USB1_BASE + 0x40100)</span>
<span class="cp">#define MSP_USB1_HS_END		(MSP_USB1_BASE + 0x401ff)</span>

<span class="cm">/* USB Identification registers */</span>
<span class="k">struct</span> <span class="n">msp_usbid_regs</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">id</span><span class="p">;</span>		<span class="cm">/* 0x0: Identification register */</span>
	<span class="n">u32</span> <span class="n">hwgen</span><span class="p">;</span>	<span class="cm">/* 0x4: General HW params */</span>
	<span class="n">u32</span> <span class="n">hwhost</span><span class="p">;</span>	<span class="cm">/* 0x8: Host HW params */</span>
	<span class="n">u32</span> <span class="n">hwdev</span><span class="p">;</span>	<span class="cm">/* 0xc: Device HW params */</span>
	<span class="n">u32</span> <span class="n">hwtxbuf</span><span class="p">;</span>	<span class="cm">/* 0x10: Tx buffer HW params */</span>
	<span class="n">u32</span> <span class="n">hwrxbuf</span><span class="p">;</span>	<span class="cm">/* 0x14: Rx buffer HW params */</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">26</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">timer0_load</span><span class="p">;</span> <span class="cm">/* 0x80: General-purpose timer 0 load*/</span>
	<span class="n">u32</span> <span class="n">timer0_ctrl</span><span class="p">;</span> <span class="cm">/* 0x84: General-purpose timer 0 control */</span>
	<span class="n">u32</span> <span class="n">timer1_load</span><span class="p">;</span> <span class="cm">/* 0x88: General-purpose timer 1 load*/</span>
	<span class="n">u32</span> <span class="n">timer1_ctrl</span><span class="p">;</span> <span class="cm">/* 0x8c: General-purpose timer 1 control */</span>
<span class="p">};</span>

<span class="cm">/* MSBus to AMBA registers */</span>
<span class="k">struct</span> <span class="n">msp_mab_regs</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">isr</span><span class="p">;</span>	<span class="cm">/* 0x0: Interrupt status */</span>
	<span class="n">u32</span> <span class="n">imr</span><span class="p">;</span>	<span class="cm">/* 0x4: Interrupt mask */</span>
	<span class="n">u32</span> <span class="n">thcr0</span><span class="p">;</span>	<span class="cm">/* 0x8: Transaction header capture 0 */</span>
	<span class="n">u32</span> <span class="n">thcr1</span><span class="p">;</span>	<span class="cm">/* 0xc: Transaction header capture 1 */</span>
	<span class="n">u32</span> <span class="n">int_stat</span><span class="p">;</span>	<span class="cm">/* 0x10: Interrupt status summary */</span>
	<span class="n">u32</span> <span class="n">phy_cfg</span><span class="p">;</span>	<span class="cm">/* 0x14: USB phy config */</span>
<span class="p">};</span>

<span class="cm">/* EHCI registers */</span>
<span class="k">struct</span> <span class="n">msp_usbhs_regs</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">hciver</span><span class="p">;</span>	<span class="cm">/* 0x0: Version and offset to operational regs */</span>
	<span class="n">u32</span> <span class="n">hcsparams</span><span class="p">;</span>	<span class="cm">/* 0x4: Host control structural parameters */</span>
	<span class="n">u32</span> <span class="n">hccparams</span><span class="p">;</span>	<span class="cm">/* 0x8: Host control capability parameters */</span>
	<span class="n">u32</span> <span class="n">reserved0</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">dciver</span><span class="p">;</span>	<span class="cm">/* 0x20: Device interface version */</span>
	<span class="n">u32</span> <span class="n">dccparams</span><span class="p">;</span>	<span class="cm">/* 0x24: Device control capability parameters */</span>
	<span class="n">u32</span> <span class="n">reserved1</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">cmd</span><span class="p">;</span>	<span class="cm">/* 0x40: USB command */</span>
	<span class="n">u32</span> <span class="n">sts</span><span class="p">;</span>	<span class="cm">/* 0x44: USB status */</span>
	<span class="n">u32</span> <span class="n">int_ena</span><span class="p">;</span>	<span class="cm">/* 0x48: USB interrupt enable */</span>
	<span class="n">u32</span> <span class="n">frindex</span><span class="p">;</span>	<span class="cm">/* 0x4c: Frame index */</span>
	<span class="n">u32</span> <span class="n">reserved3</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u32</span> <span class="n">flb_addr</span><span class="p">;</span> <span class="cm">/* 0x54: Frame list base address */</span>
			<span class="n">u32</span> <span class="n">next_async_addr</span><span class="p">;</span> <span class="cm">/* 0x58: next asynchronous addr */</span>
			<span class="n">u32</span> <span class="n">ttctrl</span><span class="p">;</span> <span class="cm">/* 0x5c: embedded transaction translator</span>
<span class="cm">							async buffer status */</span>
			<span class="n">u32</span> <span class="n">burst_size</span><span class="p">;</span> <span class="cm">/* 0x60: Controller burst size */</span>
			<span class="n">u32</span> <span class="n">tx_fifo_ctrl</span><span class="p">;</span> <span class="cm">/* 0x64: Tx latency FIFO tuning */</span>
			<span class="n">u32</span> <span class="n">reserved0</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
			<span class="n">u32</span> <span class="n">endpt_nak</span><span class="p">;</span> <span class="cm">/* 0x78: Endpoint NAK */</span>
			<span class="n">u32</span> <span class="n">endpt_nak_ena</span><span class="p">;</span> <span class="cm">/* 0x7c: Endpoint NAK enable */</span>
			<span class="n">u32</span> <span class="n">cfg_flag</span><span class="p">;</span> <span class="cm">/* 0x80: Config flag */</span>
			<span class="n">u32</span> <span class="n">port_sc1</span><span class="p">;</span> <span class="cm">/* 0x84: Port status &amp; control 1 */</span>
			<span class="n">u32</span> <span class="n">reserved1</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
			<span class="n">u32</span> <span class="n">otgsc</span><span class="p">;</span>	<span class="cm">/* 0xa4: OTG status &amp; control */</span>
			<span class="n">u32</span> <span class="n">mode</span><span class="p">;</span>	<span class="cm">/* 0xa8: USB controller mode */</span>
		<span class="p">}</span> <span class="n">host</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u32</span> <span class="n">dev_addr</span><span class="p">;</span> <span class="cm">/* 0x54: Device address */</span>
			<span class="n">u32</span> <span class="n">endpt_list_addr</span><span class="p">;</span> <span class="cm">/* 0x58: Endpoint list address */</span>
			<span class="n">u32</span> <span class="n">reserved0</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
			<span class="n">u32</span> <span class="n">endpt_nak</span><span class="p">;</span>	<span class="cm">/* 0x74 */</span>
			<span class="n">u32</span> <span class="n">endpt_nak_ctrl</span><span class="p">;</span> <span class="cm">/* 0x78 */</span>
			<span class="n">u32</span> <span class="n">cfg_flag</span><span class="p">;</span> <span class="cm">/* 0x80 */</span>
			<span class="n">u32</span> <span class="n">port_sc1</span><span class="p">;</span> <span class="cm">/* 0x84: Port status &amp; control 1 */</span>
			<span class="n">u32</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
			<span class="n">u32</span> <span class="n">otgsc</span><span class="p">;</span>	<span class="cm">/* 0xa4: OTG status &amp; control */</span>
			<span class="n">u32</span> <span class="n">mode</span><span class="p">;</span>	<span class="cm">/* 0xa8: USB controller mode */</span>
			<span class="n">u32</span> <span class="n">endpt_setup_stat</span><span class="p">;</span> <span class="cm">/* 0xac */</span>
			<span class="n">u32</span> <span class="n">endpt_prime</span><span class="p">;</span> <span class="cm">/* 0xb0 */</span>
			<span class="n">u32</span> <span class="n">endpt_flush</span><span class="p">;</span> <span class="cm">/* 0xb4 */</span>
			<span class="n">u32</span> <span class="n">endpt_stat</span><span class="p">;</span> <span class="cm">/* 0xb8 */</span>
			<span class="n">u32</span> <span class="n">endpt_complete</span><span class="p">;</span> <span class="cm">/* 0xbc */</span>
			<span class="n">u32</span> <span class="n">endpt_ctrl0</span><span class="p">;</span> <span class="cm">/* 0xc0 */</span>
			<span class="n">u32</span> <span class="n">endpt_ctrl1</span><span class="p">;</span> <span class="cm">/* 0xc4 */</span>
			<span class="n">u32</span> <span class="n">endpt_ctrl2</span><span class="p">;</span> <span class="cm">/* 0xc8 */</span>
			<span class="n">u32</span> <span class="n">endpt_ctrl3</span><span class="p">;</span> <span class="cm">/* 0xcc */</span>
		<span class="p">}</span> <span class="n">device</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/*</span>
<span class="cm"> * Container for the more-generic platform_device.</span>
<span class="cm"> * This exists mainly as a way to map the non-standard register</span>
<span class="cm"> * spaces and make them accessible to the USB ISR.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">mspusb_device</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">msp_mab_regs</span>   <span class="n">__iomem</span> <span class="o">*</span><span class="n">mab_regs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">msp_usbid_regs</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">usbid_regs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">msp_usbhs_regs</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">usbhs_regs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">platform_device</span> <span class="n">dev</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define to_mspusb_device(x) container_of((x), struct mspusb_device, dev)</span>
<span class="cp">#define TO_HOST_ID(x) ((x) &amp; 0x3)</span>
<span class="cp">#endif </span><span class="cm">/*MSP_USB_H_*/</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:6}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../../javascript/docco.min.js"></script>
</html>
