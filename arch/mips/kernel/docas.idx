f | signal32.c | s | 20K | 676 | Al Viro | viro@zeniv.linux.org.uk | 1338569931 |  | most of set_current_blocked() callers want SIGKILL/SIGSTOP removed from set  Only 3 out of 63 do not.  Renamed the current variant to __set_current_blocked(), added set_current_blocked() that will exclude unblockable signals, switched open-coded instances to it.  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | scall32-o32.S | g | 14K |  | David Daney | david.daney@cavium.com | 1320797276 |  | MIPS: Hook up process_vm_readv and process_vm_writev system calls.  Signed-off-by: David Daney <david.daney@cavium.com> To: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2918/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | irq-rm7000.c | s | 1.3K | 42 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | 8250-platform.c | s | 1.0K | 40 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103857 |  | mips: remove needless include of module.h from core kernel files.  None of these files are using modular infrastructure, and build tests reveal that none of these files are really relying on any implicit inclusions via. module.h either.  So delete them.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | Makefile | g | 4.1K |  | Thomas Gleixner | tglx@linutronix.de | 1336215624 |  | mips: Use generic init_task  Same code. Use the generic version. The special Makefile treatment is pointless anyway as init_task.o contains only data which is handled by the linker script. So no point on being treated like head text.  Make the linker script align the task on THREAD_SIZE and not on PAGE_SIZE, as PAGE_SIZE might be smaller than THREAD_SIZE.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de> Cc: Ralf Baechle <ralf@linux-mips.org> Link: http://lkml.kernel.org/r/20120503085034.941344764@linutronix.de
f | syscall.c | s | 7.8K | 305 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | csrc-bcm1480.c | s | 1.6K | 46 | John Stultz | johnstul@us.ibm.com | 1298324030 |  | mips: convert to clocksource_register_hz/khz  This converts the mips clocksources to use clocksource_register_hz/khz  CC: Ralf Baechle <ralf@linux-mips.org> CC: Thomas Gleixner <tglx@linutronix.de> Signed-off-by: John Stultz <johnstul@us.ibm.com>
f | r4k_fpu.S | g | 4.9K |  | Justin P. Mattock | justinmattock@gmail.com | 1302095978 |  | update David Miller's old email address  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | time.c | s | 2.9K | 109 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103856 |  | mips: migrate core kernel file from module.h --> export.h  These files are not modules, but were including module.h only for EXPORT_SYMBOL and/or THIS_MODULE.  Now that we have the lightweight export.h, use it in these kinds of cases.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | branch.c | s | 6.7K | 268 | Maneesh Soni | manesoni@cisco.com | 1323295443 |  | MIPS Kprobes: Refactor branch emulation  This patch refactors MIPS branch emulation code so as to allow skipping delay slot instruction in case of branch likely instructions when branch is not taken. This is useful for keeping the code common for use cases like kprobes where one would like to handle the branch instructions keeping the delay slot instuction also in picture for branch likely instructions. Also allow emulation when instruction to be decoded is not at pt_regs->cp0_epc as in case of kprobes where pt_regs->cp0_epc points to the breakpoint instruction.  The patch also exports the function for modules.  Signed-off-by: Maneesh Soni <manesoni@cisco.com> Signed-off-by: Victor Kamensky <kamensky@cisco.com> Cc: David Daney <david.daney@cavium.com> Cc: ananth@in.ibm.com Cc: linux-kernel@vger.kernel.org Cc: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2913/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | relocate_kernel.S | g | 1.6K |  | Ralf Baechle | ralf@linux-mips.org | 1185914136 |  | [MIPS] Kexec: Fix several 64-bit bugs.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | topology.c | s | 627B | 25 | Ralf Baechle | ralf@linux-mips.org | 1245864880 |  | MIPS: Add arch generic CPU hotplug  Each platform has to add support for CPU hotplugging itself by providing suitable definitions for the cpu_disable and cpu_die of the smp_ops methods and setting SYS_SUPPORTS_HOTPLUG_CPU.  A platform should only set SYS_SUPPORTS_HOTPLUG_CPU once all it's smp_ops definitions have the necessary changes.  This patch contains the changes to the dummy smp_ops definition for uni-processor systems.  Parts of the code contributed by Cavium Inc.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | irq_txx9.c | s | 4.8K | 167 | Thomas Gleixner | tglx@linutronix.de | 1301402887 |  | MIPS: Convert the irq functions to the new names  Scripted with coccinelle.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
f | head.S | g | 5.9K |  | Ralf Baechle | ralf@linux-mips.org | 1257159607 |  | MIPS: Avoid potential hazard on Context register  set_saved_sp reads Context register. Avoid reading stale value from earlier incomplete write.  Issue found and fixed for head.S by Chris Dearman <chris@mips.com>.  Signed-off-by: Chris Dearman <chris@mips.com> Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | smp-up.c | s | 1.7K | 73 | Rusty Russell | rusty@rustcorp.com.au | 1253750685 |  | cpumask: arch_send_call_function_ipi_mask: mips  We're weaning the core code off handing cpumask's around on-stack. This introduces arch_send_call_function_ipi_mask(), and by defining it, the old arch_send_call_function_ipi is defined by the core code.  We also take the chance to wean the implementations off the obsolescent for_each_cpu_mask(): making send_ipi_mask take the pointer seemed the most natural way to ensure all implementations used for_each_cpu.  Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | reset.c | s | 955B | 38 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103856 |  | mips: migrate core kernel file from module.h --> export.h  These files are not modules, but were including module.h only for EXPORT_SYMBOL and/or THIS_MODULE.  Now that we have the lightweight export.h, use it in these kinds of cases.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | scall64-n32.S | g | 10K |  | David Daney | david.daney@cavium.com | 1320797276 |  | MIPS: Hook up process_vm_readv and process_vm_writev system calls.  Signed-off-by: David Daney <david.daney@cavium.com> To: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2918/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | signal-common.h | s | 1.1K | 33 | Al Viro | viro@zeniv.linux.org.uk | 1338569931 |  | most of set_current_blocked() callers want SIGKILL/SIGSTOP removed from set  Only 3 out of 63 do not.  Renamed the current variant to __set_current_blocked(), added set_current_blocked() that will exclude unblockable signals, switched open-coded instances to it.  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | cevt-bcm1480.c | s | 4.4K | 127 | Yong Zhang | yong.zhang0@gmail.com | 1323295425 |  | MIPS: irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  [ralf@linux-mips.org: Fixed up conflicts in arch/mips/alchemy/common/dbdma.c, arch/mips/cavium-octeon/smp.c and arch/mips/kernel/perf_event.c.]  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> To: linux-kernel@vger.kernel.org Cc: tglx@linutronix.de linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2835/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | asm-offsets.c | s | 10K | 326 | David Daney | ddaney@caviumnetworks.com | 1281011190 |  | MIPS: Remove unused task_struct.trap_no field.  It is initialized to zero and only ever read.  Remove it, and pass zero in its place.  Signed-off-by: David Daney <ddaney@caviumnetworks.com> To: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/1531/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | proc.c | s | 3.1K | 100 | Steven J. Hill | sjhill@mips.com | 1337096919 |  | MIPS: Code formatting fixes.  Signed-off-by: Steven J. Hill <sjhill@mips.com> Cc: linux-mips@linux-mips.org Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | scall64-64.S | g | 9.7K |  | David Daney | david.daney@cavium.com | 1320797276 |  | MIPS: Hook up process_vm_readv and process_vm_writev system calls.  Signed-off-by: David Daney <david.daney@cavium.com> To: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2918/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | smp-cmp.c | s | 5.2K | 172 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | watch.c | s | 4.5K | 170 | David Daney | ddaney@avtrex.com | 1223738336 |  | MIPS: Add HARDWARE_WATCHPOINTS definitions and support code.  This is the main support code for the patch.  Here we just add the code, the following patches hook it up.  Signed-off-by: David Daney <ddaney@avtrex.com> Signed-off-by: Ralf Baechle <ralf@linux-mips.org>   create mode 100644 arch/mips/include/asm/watch.h  create mode 100644 arch/mips/kernel/watch.c
f | smtc-proc.c | s | 2.0K | 76 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | kspd.c | s | 9.3K | 347 | David Howells | dhowells@redhat.com | 1330088690 |  | fs: Remove missed ->fds_bits from cessation use of fd_set structs internally  Stephen Rothwell reported that the following commit broke the linux-next build:    1fd36adcd98c: Replace the fd_sets in struct fdtable with an array of unsigned longs  Fix places where ->fds_bits needed to be removed as the core kernel no longer uses fd_set internally for file descriptor table management.  There are two places:   (1) drivers/staging/android/binder.c   (2) arch/mips/kernel/kspd.c       Question: Should sp_cleanup() in the MIPS arch be using find_next_bit()      or fls()?  Reported-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: David Howells <dhowells@redhat.com> cc: Ralf Bächle <ralf@linux-mips.org> cc: Arve Hjønnevåg <arve@android.com> Link: http://lkml.kernel.org/r/20120224105707.32170.11550.stgit@warthog.procyon.org.uk Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | cpu-bugs64.c | s | 7.4K | 281 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | kgdb.c | s | 10K | 338 | Andrea Gelmini | andrea.gelmini@gelma.net | 1286213634 |  | MIPS: Fix a typo.  "Userpace" -> "Userspace"  Signed-off-by: Andrea Gelmini <andrea.gelmini@gelma.net> Cc: Andrea Gelmini <andrea.gelmini@gelma.net> Cc: Jason Wessel <jason.wessel@windriver.com> Cc: Martin Hicks <mort@sgi.com> Cc: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/1536/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | traps.c | s | 43K | 1550 | Ralf Baechle | ralf@linux-mips.org | 1338058548 |  | Merge branches 'fixes-for-linus', 'generic', 'cavium', 'module.h-fixes', 'next/ath79' and 'next/lantiq' into mips-for-linux-next
f | vmlinux.lds.S | g | 3.1K |  | Tony Wu | tung7970@gmail.com | 1329759198 |  | MIPS: vmlinux.lds.S: remove duplicate _sdata symbol  _sdata is defined twice in vmlinux.lds.S. According to vmlinux.ld.h in asm-generic, _sdata should be marked at the beginning RO_DATA_SECTION.   *      _sdata = .;  *      RO_DATA_SECTION(PAGE_SIZE)  *      RW_DATA_SECTION(...)  *      _edata = .;  Remove the one that is marked at RW_DATA_SECTION.  Signed-off-by: Tony Wu <tung7970@gmail.com> Cc: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/3215/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | cevt-gt641xx.c | s | 3.6K | 111 | Yong Zhang | yong.zhang0@gmail.com | 1323295425 |  | MIPS: irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  [ralf@linux-mips.org: Fixed up conflicts in arch/mips/alchemy/common/dbdma.c, arch/mips/cavium-octeon/smp.c and arch/mips/kernel/perf_event.c.]  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> To: linux-kernel@vger.kernel.org Cc: tglx@linutronix.de linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2835/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | smtc-asm.S | g | 3.5K |  | Ralf Baechle | ralf@linux-mips.org | 1181582453 |  | [MIPS] SMTC: Don't set and restore irqregs ptr from self_ipi.  This did corrupt register s0 which the caller of self_ipi expects to be unchanged.  This is a kernel bug which will only be triggered with the compilers which compile __smtc_ipi_replay to use s0 across the invocation of self_ipi. Gcc 4.1.2 does this, for example.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | perf_event_mipsxx.c | s | 40K | 1418 | Linus Torvalds | torvalds@linux-foundation.org | 1338341239 |  | Merge branch 'upstream' of git://git.linux-mips.org/pub/scm/ralf/upstream-linus  Pull MIPS updates from Ralf Baechle:  "The whole series has been sitting in -next for quite a while with no   complaints.  The last change to the series was before the weekend the   removal of an SPI patch which Grant - even though previously acked by   himself - appeared to raise objections.  So I removed it until the   situation is clarified.  Other than that all the patches have the acks   from their respective maintainers, all MIPS and x86 defconfigs are   building fine and I'm not aware of any problems introduced by this   series.    Among the key features for this patch series is a sizable patchset for   Lantiq which among other things introduces support for Lantiq's   flagship product, the FALCON SOC.  It also means that the opensource   developers behind this patchset have overtaken Lantiq's competing   inhouse development team that was working behind closed doors.    Less noteworthy the ath79 patchset which adds support for a few more   chip variants, cleanups and fixes.  Finally the usual dose of tweaking   of generic code."  Fix up trivial conflicts in arch/mips/lantiq/xway/gpio_{ebu,stp}.c where printk spelling fixes clashed with file move and eventual removal of the printk.  * 'upstream' of git://git.linux-mips.org/pub/scm/ralf/upstream-linus: (81 commits)   MIPS: lantiq: remove orphaned code   MIPS: Remove all -Wall and almost all -Werror usage from arch/mips.   MIPS: lantiq: implement support for FALCON soc   MTD: MIPS: lantiq: verify that the NOR interface is available on falcon soc   MTD: MIPS: lantiq: implement OF support   watchdog: MIPS: lantiq: implement OF support and minor fixes   SERIAL: MIPS: lantiq: implement OF support   GPIO: MIPS: lantiq: convert gpio-stp-xway to OF   GPIO: MIPS: lantiq: convert gpio-mm-lantiq to OF and of_mm_gpio   GPIO: MIPS: lantiq: move gpio-stp and gpio-ebu to the subsystem folder   MIPS: pci: convert lantiq driver to OF   MIPS: lantiq: convert dma to platform driver   MIPS: lantiq: implement support for clkdev api   MIPS: lantiq: drop ltq_gpio_request() and gpio_to_irq()   OF: MIPS: lantiq: implement irq_domain support   OF: MIPS: lantiq: implement OF support   MIPS: lantiq: drop mips_machine support   OF: PCI: const usage needed by MIPS   MIPS: Cavium: Remove smp_reserve_lock.   MIPS: Move cache setup to setup_arch().   ...
f | smtc.c | s | 37K | 1280 | Rusty Russell | rusty@rustcorp.com.au | 1332997710 |  | remove references to cpu_*_map in arch/  This has been obsolescent for a while; time for the final push.  In adjacent context, replaced old cpus_* with cpumask_*.  Signed-off-by: Rusty Russell <rusty@rustcorp.com.au> Acked-by: David S. Miller <davem@davemloft.net> (arch/sparc) Acked-by: Chris Metcalf <cmetcalf@tilera.com> (arch/tile) Cc: user-mode-linux-devel@lists.sourceforge.net Cc: Russell King <linux@arm.linux.org.uk> Cc: linux-arm-kernel@lists.infradead.org Cc: Richard Kuo <rkuo@codeaurora.org> Cc: linux-hexagon@vger.kernel.org Cc: Ralf Baechle <ralf@linux-mips.org> Cc: linux-mips@linux-mips.org Cc: Kyle McMartin <kyle@mcmartin.ca> Cc: Helge Deller <deller@gmx.de> Cc: sparclinux@vger.kernel.org
f | ptrace.c | s | 13K | 524 | Will Drewry | wad@chromium.org | 1334715890 |  | seccomp: ignore secure_computing return values  This change is inspired by   https://lkml.org/lkml/2012/4/16/14 which fixes the build warnings for arches that don't support CONFIG_HAVE_ARCH_SECCOMP_FILTER.  In particular, there is no requirement for the return value of secure_computing() to be checked unless the architecture supports seccomp filter.  Instead of silencing the warnings with (void) a new static inline is added to encode the expected behavior in a compiler and human friendly way.  v2: - cleans things up with a static inline     - removes sfr's signed-off-by since it is a different approach v1: - matches sfr's original change  Reported-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Will Drewry <wad@chromium.org> Acked-by: Kees Cook <keescook@chromium.org> Signed-off-by: James Morris <james.l.morris@oracle.com>
f | irq-gic.c | s | 6.6K | 211 | Thomas Gleixner | tglx@linutronix.de | 1301402887 |  | MIPS: Convert the irq functions to the new names  Scripted with coccinelle.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
f | perf_event.c | s | 1.8K | 61 | David Daney | david.daney@cavium.com | 1319495666 |  | MIPS: perf: Reorganize contents of perf support files.  The contents of arch/mips/kernel/perf_event.c and arch/mips/kernel/perf_event_mipsxx.c were divided in a seemingly ad hoc manner, with the first including the second.  I moved all the hardware counter support code to perf_event_mipsxx.c and removed the gating #ifdefs to the Kconfig and Makefile.  Now perf_event.c contains only the callchain support, everything else is in perf_event_mipsxx.c  There are no code changes, only moving of functions from one file to the other, or removing empty unneeded functions.  Signed-off-by: David Daney <david.daney@cavium.com> Cc: Peter Zijlstra <a.p.zijlstra@chello.nl> Cc: Paul Mackerras <paulus@samba.org> Cc: Ingo Molnar <mingo@elte.hu> Cc: Arnaldo Carvalho de Melo <acme@redhat.com> Cc: Dezhong Diao <dediao@cisco.com> Cc: Gabor Juhos <juhosg@openwrt.org> Cc: Deng-Cheng Zhu <dengcheng.zhu@gmail.com> To: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2791/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | vdso.c | s | 2.4K | 87 | Jason Baron | jbaron@redhat.com | 1332547122 |  | coredump: remove VM_ALWAYSDUMP flag  The motivation for this patchset was that I was looking at a way for a qemu-kvm process, to exclude the guest memory from its core dump, which can be quite large.  There are already a number of filter flags in /proc/<pid>/coredump_filter, however, these allow one to specify 'types' of kernel memory, not specific address ranges (which is needed in this case).  Since there are no more vma flags available, the first patch eliminates the need for the 'VM_ALWAYSDUMP' flag.  The flag is used internally by the kernel to mark vdso and vsyscall pages.  However, it is simple enough to check if a vma covers a vdso or vsyscall page without the need for this flag.  The second patch then replaces the 'VM_ALWAYSDUMP' flag with a new 'VM_NODUMP' flag, which can be set by userspace using new madvise flags: 'MADV_DONTDUMP', and unset via 'MADV_DODUMP'.  The core dump filters continue to work the same as before unless 'MADV_DONTDUMP' is set on the region.  The qemu code which implements this features is at:    http://people.redhat.com/~jbaron/qemu-dump/qemu-dump.patch  In my testing the qemu core dump shrunk from 383MB -> 13MB with this patch.  I also believe that the 'MADV_DONTDUMP' flag might be useful for security sensitive apps, which might want to select which areas are dumped.  This patch:  The VM_ALWAYSDUMP flag is currently used by the coredump code to indicate that a vma is part of a vsyscall or vdso section.  However, we can determine if a vma is in one these sections by checking it against the gate_vma and checking for a non-NULL return value from arch_vma_name().  Thus, freeing a valuable vma bit.  Signed-off-by: Jason Baron <jbaron@redhat.com> Acked-by: Roland McGrath <roland@hack.frob.com> Cc: Chris Metcalf <cmetcalf@tilera.com> Cc: Avi Kivity <avi@redhat.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | sync-r4k.c | s | 3.9K | 133 | Arun Sharma | asharma@fb.com | 1311724187 |  | atomic: use <linux/atomic.h>  This allows us to move duplicated code in <asm/atomic.h> (atomic_inc_not_zero() for now) to <linux/atomic.h>  Signed-off-by: Arun Sharma <asharma@fb.com> Reviewed-by: Eric Dumazet <eric.dumazet@gmail.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: David Miller <davem@davemloft.net> Cc: Eric Dumazet <eric.dumazet@gmail.com> Acked-by: Mike Frysinger <vapier@gentoo.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | mips_machine.c | s | 1.8K | 67 | Gabor Juhos | juhosg@openwrt.org | 1295375421 |  | MIPS: Add generic support for multiple machines within a single kernel  This patch adds a generic solution to support multiple machines based on a given SoC within a single kernel image. It is implemented already for several other architectures but MIPS has no generic support for that yet.  [Ralf: This competes with DT but DT is a much more complex solution and this code has been used by OpenWRT for a long time so for now DT is a bad reason to stop the merge but longer term this should be migrated to DT.]  Signed-off-by: Gabor Juhos <juhosg@openwrt.org> Cc: linux-mips@linux-mips.org Cc: kaloz@openwrt.org Cc: Luis R. Rodriguez <lrodriguez@atheros.com> Cc: Cliff Holden <Cliff.Holden@Atheros.com> Patchwork: https://patchwork.linux-mips.org/patch/1814/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | irq_cpu.c | s | 3.2K | 101 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | mcount.S | g | 3.9K |  | Wu Zhangjin | wuzhangjin@gmail.com | 1281011166 |  | MIPS: tracing: Fix the indentation of mcount.S  The commit "MIPS: Tracing: Cleanup the arguments passing of prepare_ftrace_return" has moved the "jal     prepare_ftrace_return" instruction after the handling of the 3rd argument but forgot to remove the superfluous space before the related instructions.  Signed-off-by: Wu Zhangjin <wuzhangjin@gmail.com> Cc: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/1475/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | spram.c | s | 4.6K | 181 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | r2300_fpu.S | g | 3.6K |  | Justin P. Mattock | justinmattock@gmail.com | 1302095978 |  | update David Miller's old email address  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | kprobes.c | s | 16K | 581 | Maneesh Soni | manesoni@cisco.com | 1323295443 |  | MIPS Kprobes: Support branch instructions probing  This patch provides support for kprobes on branch instructions. The branch instruction at the probed address is actually emulated and not executed out-of-line like other normal instructions. Instead the delay-slot instruction is copied and single stepped out of line.  At the time of probe hit, the original branch instruction is evaluated and the target cp0_epc is computed similar to compute_retrun_epc(). It is also checked if the delay slot instruction can be skipped, which is true if there is a NOP in delay slot or branch is taken in case of branch likely instructions. Once the delay slot instruction is single stepped the normal execution resume with the cp0_epc updated the earlier computed cp0_epc as per the branch instructions.  Signed-off-by: Maneesh Soni <manesoni@cisco.com> Signed-off-by: Victor Kamensky <kamensky@cisco.com> Cc: David Daney <david.daney@cavium.com> Cc: ananth@in.ibm.com Cc: linux-kernel@vger.kernel.org Cc: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2914/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | cevt-sb1250.c | s | 4.3K | 127 | Yong Zhang | yong.zhang0@gmail.com | 1323295425 |  | MIPS: irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  [ralf@linux-mips.org: Fixed up conflicts in arch/mips/alchemy/common/dbdma.c, arch/mips/cavium-octeon/smp.c and arch/mips/kernel/perf_event.c.]  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> To: linux-kernel@vger.kernel.org Cc: tglx@linutronix.de linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2835/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | cevt-txx9.c | s | 5.5K | 170 | Yong Zhang | yong.zhang0@gmail.com | 1323295425 |  | MIPS: irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  [ralf@linux-mips.org: Fixed up conflicts in arch/mips/alchemy/common/dbdma.c, arch/mips/cavium-octeon/smp.c and arch/mips/kernel/perf_event.c.]  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> To: linux-kernel@vger.kernel.org Cc: tglx@linutronix.de linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2835/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | cevt-smtc.c | s | 8.7K | 289 | David Howells | dhowells@redhat.com | 1286456934 |  | MIPS: Add missing #inclusions of <linux/irq.h>  Add missing #inclusions of <linux/irq.h> to a whole bunch of files that should really include it.  Note that this can replace #inclusions of <asm/irq.h>.  This is required for the patch to sort out irqflags handling function naming to compile on MIPS.  The problem is that these files require access to things like setup_irq() - which isn't available by #including <linux/interrupt.h>  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org>
f | rtlx.c | s | 12K | 448 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | mips-mt-fpaff.c | s | 5.0K | 186 | Rusty Russell | rusty@rustcorp.com.au | 1332997710 |  | remove references to cpu_*_map in arch/  This has been obsolescent for a while; time for the final push.  In adjacent context, replaced old cpus_* with cpumask_*.  Signed-off-by: Rusty Russell <rusty@rustcorp.com.au> Acked-by: David S. Miller <davem@davemloft.net> (arch/sparc) Acked-by: Chris Metcalf <cmetcalf@tilera.com> (arch/tile) Cc: user-mode-linux-devel@lists.sourceforge.net Cc: Russell King <linux@arm.linux.org.uk> Cc: linux-arm-kernel@lists.infradead.org Cc: Richard Kuo <rkuo@codeaurora.org> Cc: linux-hexagon@vger.kernel.org Cc: Ralf Baechle <ralf@linux-mips.org> Cc: linux-mips@linux-mips.org Cc: Kyle McMartin <kyle@mcmartin.ca> Cc: Helge Deller <deller@gmx.de> Cc: sparclinux@vger.kernel.org
f | ptrace32.c | s | 7.9K | 305 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | machine_kexec.c | s | 1.9K | 69 | Nicolas Schichan | nschichan@freebox.fr | 1188177419 |  | [MIPS] Unconditionally writeback and invalidate caches on kexec.  Signed-off-by: Nicolas Schichan <nschichan@freebox.fr> Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | irq.c | s | 3.3K | 136 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | irq-gt641xx.c | s | 3.3K | 111 | Thomas Gleixner | tglx@linutronix.de | 1301402887 |  | MIPS: Convert the irq functions to the new names  Scripted with coccinelle.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
f | octeon_switch.S | g | 12K |  | Justin P. Mattock | justinmattock@gmail.com | 1302095978 |  | update David Miller's old email address  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | jump_label.c | s | 1.3K | 42 | David Daney | ddaney@caviumnetworks.com | 1295375424 |  | MIPS: jump label: Add MIPS support.  In order not to be left behind, we add jump label support for MIPS.  Tested on 64-bit big endian (Octeon), and 32-bit little endian (malta/qemu).  Signed-off-by: David Daney <ddaney@caviumnetworks.com> To: linux-mips@linux-mips.org Cc: Steven Rostedt <rostedt@goodmis.org> Cc: Jason Baron <jbaron@redhat.com> Patchwork: https://patchwork.linux-mips.org/patch/1923/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | smp-mt.c | s | 7.1K | 226 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | spinlock_test.c | s | 2.3K | 104 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103856 |  | mips: migrate core kernel file from module.h --> export.h  These files are not modules, but were including module.h only for EXPORT_SYMBOL and/or THIS_MODULE.  Now that we have the lightweight export.h, use it in these kinds of cases.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | csrc-powertv.c | s | 3.9K | 124 | John Stultz | johnstul@us.ibm.com | 1298324030 |  | mips: convert to clocksource_register_hz/khz  This converts the mips clocksources to use clocksource_register_hz/khz  CC: Ralf Baechle <ralf@linux-mips.org> CC: Thomas Gleixner <tglx@linutronix.de> Signed-off-by: John Stultz <johnstul@us.ibm.com>
f | genex.S | g | 11K |  | David Daney | ddaney@caviumnetworks.com | 1233351178 |  | MIPS: Read watch registers with interrupts disabled.  If a context switch occurred between the watch exception and reading the watch registers, it would be possible for the new process to corrupt their state.  Enabling interrupts only after the watch registers are read avoids this race.  Signed-off-by: David Daney <ddaney@caviumnetworks.com> Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | i8259.c | s | 9.0K | 291 | Liming Wang | liming.wang@windriver.com | 1316620348 |  | MIPS: i8259: Mark cascade interrupt non-threaded  Cascade interrupts cannot be threaded.  Signed-off-by: Liming Wang <liming.wang@windriver.com> Signed-off-by: Bruce Ashfield <bruce.ashfield@windriver.com> Cc: Peter Zijlstra <a.p.zijlstra@chello.nl> Link: http://lkml.kernel.org/r/1314370804-21266-1-git-send-email-liming.wang@windriver.com Signed-off-by: Thomas Gleixner <tglx@linutronix.de> Cc: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2770/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | module.c | s | 9.6K | 322 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103857 |  | mips: remove needless include of module.h from core kernel files.  None of these files are using modular infrastructure, and build tests reveal that none of these files are really relying on any implicit inclusions via. module.h either.  So delete them.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
d | cpufreq |  | 4 items |  | Aaro Koskinen | aaro.koskinen@iki.fi | 1320947985 |  | MIPS: errloongson2_clock: Fix build error by including linux/module.h  Fix the following compilation failure with v3.2-rc1 by including module.h:    CC [M]  arch/mips/kernel/cpufreq/loongson2_clock.o arch/mips/kernel/cpufreq/loongson2_clock.c:39:1: error: data definition has no type or storage class [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:39:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL_GPL' [-Werror=implicit-int] arch/mips/kernel/cpufreq/loongson2_clock.c:39:1: error: parameter names (without types) in function declaration [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:51:1: error: data definition has no type or storage class [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:51:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL' [-Werror=implicit-int] arch/mips/kernel/cpufreq/loongson2_clock.c:51:1: error: parameter names (without types) in function declaration [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:71:1: error: data definition has no type or storage class [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:71:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL' [-Werror=implicit-int] arch/mips/kernel/cpufreq/loongson2_clock.c:71:1: error: parameter names (without types) in function declaration [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:76:1: error: data definition has no type or storage class [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:76:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL' [-Werror=implicit-int] arch/mips/kernel/cpufreq/loongson2_clock.c:76:1: error: parameter names (without types) in function declaration [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:82:1: error: data definition has no type or storage class [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:82:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL' [-Werror=implicit-int] arch/mips/kernel/cpufreq/loongson2_clock.c:82:1: error: parameter names (without types) in function declaration [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:87:1: error: data definition has no type or storage class [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:87:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL' [-Werror=implicit-int] arch/mips/kernel/cpufreq/loongson2_clock.c:87:1: error: parameter names (without types) in function declaration [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:93:1: error: data definition has no type or storage class [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:93:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL_GPL' [-Werror=implicit-int] arch/mips/kernel/cpufreq/loongson2_clock.c:93:1: error: parameter names (without types) in function declaration [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:131:1: error: data definition has no type or storage class [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:131:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL_GPL' [-Werror=implicit-int] arch/mips/kernel/cpufreq/loongson2_clock.c:131:1: error: parameter names (without types) in function declaration [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:147:1: error: data definition has no type or storage class [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:147:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL_GPL' [-Werror=implicit-int] arch/mips/kernel/cpufreq/loongson2_clock.c:147:1: error: parameter names (without types) in function declaration [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:166:1: error: data definition has no type or storage class [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:166:1: error: type defaults to 'int' in declaration of 'EXPORT_SYMBOL_GPL' [-Werror=implicit-int] arch/mips/kernel/cpufreq/loongson2_clock.c:166:1: error: parameter names (without types) in function declaration [-Werror] arch/mips/kernel/cpufreq/loongson2_clock.c:168:15: error: expected declaration specifiers or '...' before string constant arch/mips/kernel/cpufreq/loongson2_clock.c:169:20: error: expected declaration specifiers or '...' before string constant arch/mips/kernel/cpufreq/loongson2_clock.c:170:16: error: expected declaration specifiers or '...' before string constant  Signed-off-by: Aaro Koskinen <aaro.koskinen@iki.fi> To: linux-mips@linux-mips.org To: linux-kernel@vger.kernel.org Patchwork: https://patchwork.linux-mips.org/patch/2922/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | stacktrace.c | s | 2.0K | 79 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103856 |  | mips: migrate core kernel file from module.h --> export.h  These files are not modules, but were including module.h only for EXPORT_SYMBOL and/or THIS_MODULE.  Now that we have the lightweight export.h, use it in these kinds of cases.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | prom.c | s | 2.6K | 88 | John Crispin | blogic@openwrt.org | 1337096960 |  | MIPS: parse chosen node on boot  Call early_init_devtree from inside __dt_setup_arch to allow parsing of the chosen node.  Signed-off-by: John Crispin <blogic@openwrt.org> Cc: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/3718/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | setup.c | s | 14K | 528 | David Daney | david.daney@cavium.com | 1337204074 |  | MIPS: Move cache setup to setup_arch().  commit 97ce2c88f9ad42e3c60a9beb9fca87abf3639faa (jump-label: initialize jump-label subsystem much earlier) breaks MIPS.  The jump_label_init() call was moved before trap_init() which is where we initialize flush_icache_range().  In order to be good citizens, we move cache initialization earlier so that we don't jump through a null flush_icache_range function pointer when doing the jump label initialization.  Signed-off-by: David Daney <david.daney@cavium.com> Cc: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/3822/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | i8253.c | s | 734B | 32 | Yong Zhang | yong.zhang0@gmail.com | 1323295425 |  | MIPS: irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  [ralf@linux-mips.org: Fixed up conflicts in arch/mips/alchemy/common/dbdma.c, arch/mips/cavium-octeon/smp.c and arch/mips/kernel/perf_event.c.]  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> To: linux-kernel@vger.kernel.org Cc: tglx@linutronix.de linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2835/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | mips_ksyms.c | s | 1.7K | 52 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103856 |  | mips: migrate core kernel file from module.h --> export.h  These files are not modules, but were including module.h only for EXPORT_SYMBOL and/or THIS_MODULE.  Now that we have the lightweight export.h, use it in these kinds of cases.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | signal_n32.c | s | 5.9K | 183 | Al Viro | viro@zeniv.linux.org.uk | 1338569931 |  | most of set_current_blocked() callers want SIGKILL/SIGSTOP removed from set  Only 3 out of 63 do not.  Renamed the current variant to __set_current_blocked(), added set_current_blocked() that will exclude unblockable signals, switched open-coded instances to it.  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | unaligned.c | s | 13K | 523 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | csrc-ioasic.c | s | 1.7K | 52 | John Stultz | johnstul@us.ibm.com | 1298324030 |  | mips: convert to clocksource_register_hz/khz  This converts the mips clocksources to use clocksource_register_hz/khz  CC: Ralf Baechle <ralf@linux-mips.org> CC: Thomas Gleixner <tglx@linutronix.de> Signed-off-by: John Stultz <johnstul@us.ibm.com>
f | csrc-r4k.c | s | 844B | 29 | John Stultz | johnstul@us.ibm.com | 1298324030 |  | mips: convert to clocksource_register_hz/khz  This converts the mips clocksources to use clocksource_register_hz/khz  CC: Ralf Baechle <ralf@linux-mips.org> CC: Thomas Gleixner <tglx@linutronix.de> Signed-off-by: John Stultz <johnstul@us.ibm.com>
f | smp.c | s | 8.8K | 314 | Linus Torvalds | torvalds@linux-foundation.org | 1338341239 |  | Merge branch 'upstream' of git://git.linux-mips.org/pub/scm/ralf/upstream-linus  Pull MIPS updates from Ralf Baechle:  "The whole series has been sitting in -next for quite a while with no   complaints.  The last change to the series was before the weekend the   removal of an SPI patch which Grant - even though previously acked by   himself - appeared to raise objections.  So I removed it until the   situation is clarified.  Other than that all the patches have the acks   from their respective maintainers, all MIPS and x86 defconfigs are   building fine and I'm not aware of any problems introduced by this   series.    Among the key features for this patch series is a sizable patchset for   Lantiq which among other things introduces support for Lantiq's   flagship product, the FALCON SOC.  It also means that the opensource   developers behind this patchset have overtaken Lantiq's competing   inhouse development team that was working behind closed doors.    Less noteworthy the ath79 patchset which adds support for a few more   chip variants, cleanups and fixes.  Finally the usual dose of tweaking   of generic code."  Fix up trivial conflicts in arch/mips/lantiq/xway/gpio_{ebu,stp}.c where printk spelling fixes clashed with file move and eventual removal of the printk.  * 'upstream' of git://git.linux-mips.org/pub/scm/ralf/upstream-linus: (81 commits)   MIPS: lantiq: remove orphaned code   MIPS: Remove all -Wall and almost all -Werror usage from arch/mips.   MIPS: lantiq: implement support for FALCON soc   MTD: MIPS: lantiq: verify that the NOR interface is available on falcon soc   MTD: MIPS: lantiq: implement OF support   watchdog: MIPS: lantiq: implement OF support and minor fixes   SERIAL: MIPS: lantiq: implement OF support   GPIO: MIPS: lantiq: convert gpio-stp-xway to OF   GPIO: MIPS: lantiq: convert gpio-mm-lantiq to OF and of_mm_gpio   GPIO: MIPS: lantiq: move gpio-stp and gpio-ebu to the subsystem folder   MIPS: pci: convert lantiq driver to OF   MIPS: lantiq: convert dma to platform driver   MIPS: lantiq: implement support for clkdev api   MIPS: lantiq: drop ltq_gpio_request() and gpio_to_irq()   OF: MIPS: lantiq: implement irq_domain support   OF: MIPS: lantiq: implement OF support   MIPS: lantiq: drop mips_machine support   OF: PCI: const usage needed by MIPS   MIPS: Cavium: Remove smp_reserve_lock.   MIPS: Move cache setup to setup_arch().   ...
f | cpu-probe.c | s | 27K | 1080 | Steven J. Hill | sjhill@mips.com | 1337096919 |  | MIPS: Code formatting fixes.  Signed-off-by: Steven J. Hill <sjhill@mips.com> Cc: linux-mips@linux-mips.org Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | irq-rm9000.c | s | 2.5K | 87 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | csrc-sb1250.c | s | 2.1K | 59 | John Stultz | johnstul@us.ibm.com | 1298324030 |  | mips: convert to clocksource_register_hz/khz  This converts the mips clocksources to use clocksource_register_hz/khz  CC: Ralf Baechle <ralf@linux-mips.org> CC: Thomas Gleixner <tglx@linutronix.de> Signed-off-by: John Stultz <johnstul@us.ibm.com>
f | scall64-o32.S | g | 13K |  | David Daney | david.daney@cavium.com | 1320797276 |  | MIPS: Hook up process_vm_readv and process_vm_writev system calls.  Signed-off-by: David Daney <david.daney@cavium.com> To: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2918/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | linux32.c | s | 9.1K | 311 | Yong Zhang | yong.zhang@windriver.com | 1316620424 |  | MIPS: Compat: Use 32-bit wrapper for compat_sys_futex.  We can't trust userspace to pass signed-extend arguments.  Not correctly sign-extended arguments to futex-wait result in architecturally undefined operation of 32-bit arithmetic instructions.  For example, if 'val' is too big and bit-31 is 1, the caller may enter endless loop at:  futex_wait_setup() { 	...  	if (uval != val) { 		queue_unlock(q, *hb); 		ret = -EWOULDBLOCK;  	... }  Signed-off-by: Yong Zhang <yong.zhang@windriver.com> To: linux-mips@linux-mips.org To: linux-kernel@vger.kernel.org Patchwork: https://patchwork.linux-mips.org/patch/2714/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | binfmt_elfn32.c | s | 3.3K | 106 | Roman Zippel | zippel@linux-m68k.org | 1209654238 |  | remove div_long_long_rem  x86 is the only arch right now, which provides an optimized for div_long_long_rem and it has the downside that one has to be very careful that the divide doesn't overflow.  The API is a little akward, as the arguments for the unsigned divide are signed.  The signed version also doesn't handle a negative divisor and produces worse code on 64bit archs.  There is little incentive to keep this API alive, so this converts the few users to the new API.  Signed-off-by: Roman Zippel <zippel@linux-m68k.org> Cc: Ralf Baechle <ralf@linux-mips.org> Cc: Ingo Molnar <mingo@elte.hu> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: john stultz <johnstul@us.ibm.com> Cc: Christoph Lameter <clameter@sgi.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | bmips_vec.S | g | 5.4K |  | Kevin Cernekee | cernekee@gmail.com | 1323295398 |  | MIPS: BMIPS: Add SMP support code for BMIPS43xx/BMIPS5000  Initial commit of BMIPS SMP support code.  Smoke-tested on a variety of BMIPS4350, BMIPS4380, and BMIPS5000 platforms.  Signed-off-by: Kevin Cernekee <cernekee@gmail.com> Cc: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2977/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | mips-mt.c | s | 7.7K | 289 | Jiri Kosina | jkosina@suse.cz | 1333914532 |  | Merge branch 'master' into for-next  Merge with latest Linus' tree, as I have incoming patches that fix code that is newer than current HEAD of for-next.  Conflicts: 	drivers/net/ethernet/realtek/r8169.c
f | process.c | s | 11K | 421 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | cevt-r4k.c | s | 5.0K | 175 | Yong Zhang | yong.zhang0@gmail.com | 1323295425 |  | MIPS: irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  [ralf@linux-mips.org: Fixed up conflicts in arch/mips/alchemy/common/dbdma.c, arch/mips/cavium-octeon/smp.c and arch/mips/kernel/perf_event.c.]  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> To: linux-kernel@vger.kernel.org Cc: tglx@linutronix.de linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2835/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | early_printk.c | s | 1000B | 37 | Dmitri Vorobiev | dmitri.vorobiev@movial.fi | 1216143869 |  | [MIPS] fix sparse warning about setup_early_printk()  This patch fixes the following sparse warning:  <<<<<<<<  arch/mips/kernel/early_printk.c:35:13: warning: symbol 'setup_early_printk' was not declared. Should it be static?  <<<<<<<<  The fix is to define a prototype of the setup_early_printk() function and to include the appropriate header into arch/mips/kernel/early_printk.c.  [Ralf: Sorted includes again]  Signed-off-by: Dmitri Vorobiev <dmitri.vorobiev@movial.fi> Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | vpe.c | s | 36K | 1290 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for MIPS  Disintegrate asm/system.h for MIPS.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Ralf Baechle <ralf@linux-mips.org> cc: linux-mips@linux-mips.org
f | irq-msc01.c | s | 4.0K | 139 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103857 |  | mips: remove needless include of module.h from core kernel files.  None of these files are using modular infrastructure, and build tests reveal that none of these files are really relying on any implicit inclusions via. module.h either.  So delete them.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | r4k_switch.S | g | 5.1K |  | Justin P. Mattock | justinmattock@gmail.com | 1302095978 |  | update David Miller's old email address  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | r6000_fpu.S | g | 2.2K |  | Justin P. Mattock | justinmattock@gmail.com | 1302095978 |  | update David Miller's old email address  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | signal.c | s | 16K | 560 | Al Viro | viro@zeniv.linux.org.uk | 1338569932 |  | new helper: signal_delivered()  Does block_sigmask() + tracehook_signal_handler();  called when sigframe has been successfully built.  All architectures converted to it; block_sigmask() itself is gone now (merged into this one).  I'm still not too happy with the signature, but that's a separate story (IMO we need a structure that would contain signal number + siginfo + k_sigaction, so that get_signal_to_deliver() would fill one, signal_delivered(), handle_signal() and probably setup...frame() - take one).  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | entry.S | g | 4.4K |  | Ralf Baechle | ralf@linux-mips.org | 1305795344 |  | MIPS: Split do_syscall_trace into two functions.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | gpio_txx9.c | s | 2.2K | 79 | Atsushi Nemoto | anemo@mba.ocn.ne.jp | 1216143874 |  | [MIPS] txx9: Make gpio_txx9 entirely spinlock-safe  TXx9 GPIO set/get routines are spinlock-safe.  This patch make gpio_direction_{input,output} routines also spinlock-safe so that they can be used during early board setup.  Signed-off-by: Atsushi Nemoto <anemo@mba.ocn.ne.jp> Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | binfmt_elfo32.c | s | 4.4K | 141 | Yong Zhang | yong.zhang@windriver.com | 1246632327 |  | MIPS: 64-bit: Fix o32 core dump  If an o32 process generates a core dump on a 64 bit kernel, the core file will not be correctly recognized. This is because ELF_CORE_COPY_REGS and ELF_CORE_COPY_TASK_REGS are not correctly defined for o32 and will use the default register set which would be CONFIG_64BIT in asm/elf.h.  So we'll switch to use the right register defines in this situation by checking for WANT_COMPAT_REG_H and use the right defines of ELF_CORE_COPY_REGS and ELF_CORE_COPY_TASK_REGS.  [Ralf: made ELF_CORE_COPY_TASK_REGS() bullet-proof against funny arguments.]  Signed-off-by: Yong Zhang <yong.zhang@windriver.com> Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | smp-bmips.c | s | 11K | 381 | Rusty Russell | rusty@rustcorp.com.au | 1332997710 |  | remove references to cpu_*_map in arch/  This has been obsolescent for a while; time for the final push.  In adjacent context, replaced old cpus_* with cpumask_*.  Signed-off-by: Rusty Russell <rusty@rustcorp.com.au> Acked-by: David S. Miller <davem@davemloft.net> (arch/sparc) Acked-by: Chris Metcalf <cmetcalf@tilera.com> (arch/tile) Cc: user-mode-linux-devel@lists.sourceforge.net Cc: Russell King <linux@arm.linux.org.uk> Cc: linux-arm-kernel@lists.infradead.org Cc: Richard Kuo <rkuo@codeaurora.org> Cc: linux-hexagon@vger.kernel.org Cc: Ralf Baechle <ralf@linux-mips.org> Cc: linux-mips@linux-mips.org Cc: Kyle McMartin <kyle@mcmartin.ca> Cc: Helge Deller <deller@gmx.de> Cc: sparclinux@vger.kernel.org
f | ftrace.c | s | 8.5K | 269 | Thomas Gleixner | tglx@linutronix.de | 1316620324 |  | MIPS: Ftrace: Fix the CONFIG_DYNAMIC_FTRACE=n compile  arch/mips/kernel/ftrace.c: In function ‘ftrace_get_parent_ra_addr’: arch/mips/kernel/ftrace.c:212: error: implicit declaration of function ‘in_kernel_space’ arch/mips/kernel/ftrace.c: In function ‘prepare_ftrace_return’: arch/mips/kernel/ftrace.c:314: error: ‘MCOUNT_OFFSET_INSNS’ undeclared (first use in this function) arch/mips/kernel/ftrace.c:314: error: (Each undeclared identifier is reported only once arch/mips/kernel/ftrace.c:314: error: for each function it appears in.)  Signed-off-by: Thomas Gleixner <tglx@linutronix.de> To: linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2634/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | cevt-ds1287.c | s | 2.8K | 106 | Yong Zhang | yong.zhang0@gmail.com | 1323295425 |  | MIPS: irq: Remove IRQF_DISABLED  Since commit [e58aa3d2: genirq: Run irq handlers with interrupts disabled], We run all interrupt handlers with interrupts disabled and we even check and yell when an interrupt handler returns with interrupts enabled (see commit [b738a50a: genirq: Warn when handler enables interrupts]).  So now this flag is a NOOP and can be removed.  [ralf@linux-mips.org: Fixed up conflicts in arch/mips/alchemy/common/dbdma.c, arch/mips/cavium-octeon/smp.c and arch/mips/kernel/perf_event.c.]  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> To: linux-kernel@vger.kernel.org Cc: tglx@linutronix.de linux-mips@linux-mips.org Patchwork: https://patchwork.linux-mips.org/patch/2835/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>
f | r2300_switch.S | g | 3.3K |  | Justin P. Mattock | justinmattock@gmail.com | 1302095978 |  | update David Miller's old email address  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
