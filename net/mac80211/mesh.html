<!DOCTYPE html>
<html><head><title>joekychen/linux » net › mac80211 › mesh.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>mesh.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2008, 2009 open80211s Ltd.</span>
<span class="cm"> * Authors:    Luis Carlos Cobo &lt;luisca@cozybit.com&gt;</span>
<span class="cm"> *             Javier Cardona &lt;javier@cozybit.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef IEEE80211S_H</span>
<span class="cp">#define IEEE80211S_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/jhash.h&gt;</span>
<span class="cp">#include &quot;ieee80211_i.h&quot;</span>


<span class="cm">/* Data structures */</span>

<span class="cm">/**</span>
<span class="cm"> * enum mesh_config_capab_flags - mesh config IE capability flags</span>
<span class="cm"> *</span>
<span class="cm"> * @MESHCONF_CAPAB_ACCEPT_PLINKS: STA is willing to establish</span>
<span class="cm"> * additional mesh peerings with other mesh STAs</span>
<span class="cm"> * @MESHCONF_CAPAB_FORWARDING: the STA forwards MSDUs</span>
<span class="cm"> * @MESHCONF_CAPAB_TBTT_ADJUSTING: TBTT adjustment procedure is ongoing</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">mesh_config_capab_flags</span> <span class="p">{</span>
	<span class="n">MESHCONF_CAPAB_ACCEPT_PLINKS</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
	<span class="n">MESHCONF_CAPAB_FORWARDING</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
	<span class="n">MESHCONF_CAPAB_TBTT_ADJUSTING</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * enum mesh_path_flags - mac80211 mesh path flags</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * @MESH_PATH_ACTIVE: the mesh path can be used for forwarding</span>
<span class="cm"> * @MESH_PATH_RESOLVING: the discovery process is running for this mesh path</span>
<span class="cm"> * @MESH_PATH_SN_VALID: the mesh path contains a valid destination sequence</span>
<span class="cm"> * 	number</span>
<span class="cm"> * @MESH_PATH_FIXED: the mesh path has been manually set and should not be</span>
<span class="cm"> * 	modified</span>
<span class="cm"> * @MESH_PATH_RESOLVED: the mesh path can has been resolved</span>
<span class="cm"> * @MESH_PATH_REQ_QUEUED: there is an unsent path request for this destination</span>
<span class="cm"> * already queued up, waiting for the discovery process to start.</span>
<span class="cm"> *</span>
<span class="cm"> * MESH_PATH_RESOLVED is used by the mesh path timer to</span>
<span class="cm"> * decide when to stop or cancel the mesh path discovery.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">mesh_path_flags</span> <span class="p">{</span>
	<span class="n">MESH_PATH_ACTIVE</span> <span class="o">=</span>	<span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
	<span class="n">MESH_PATH_RESOLVING</span> <span class="o">=</span>	<span class="n">BIT</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
	<span class="n">MESH_PATH_SN_VALID</span> <span class="o">=</span>	<span class="n">BIT</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
	<span class="n">MESH_PATH_FIXED</span>	<span class="o">=</span>	<span class="n">BIT</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
	<span class="n">MESH_PATH_RESOLVED</span> <span class="o">=</span>	<span class="n">BIT</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
	<span class="n">MESH_PATH_REQ_QUEUED</span> <span class="o">=</span>	<span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * enum mesh_deferred_task_flags - mac80211 mesh deferred tasks</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * @MESH_WORK_HOUSEKEEPING: run the periodic mesh housekeeping tasks</span>
<span class="cm"> * @MESH_WORK_GROW_MPATH_TABLE: the mesh path table is full and needs</span>
<span class="cm"> * to grow.</span>
<span class="cm"> * @MESH_WORK_GROW_MPP_TABLE: the mesh portals table is full and needs to</span>
<span class="cm"> * grow</span>
<span class="cm"> * @MESH_WORK_ROOT: the mesh root station needs to send a frame</span>
<span class="cm"> * @MESH_WORK_DRIFT_ADJUST: time to compensate for clock drift relative to other</span>
<span class="cm"> * mesh nodes</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">mesh_deferred_task_flags</span> <span class="p">{</span>
	<span class="n">MESH_WORK_HOUSEKEEPING</span><span class="p">,</span>
	<span class="n">MESH_WORK_GROW_MPATH_TABLE</span><span class="p">,</span>
	<span class="n">MESH_WORK_GROW_MPP_TABLE</span><span class="p">,</span>
	<span class="n">MESH_WORK_ROOT</span><span class="p">,</span>
	<span class="n">MESH_WORK_DRIFT_ADJUST</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct mesh_path - mac80211 mesh path structure</span>
<span class="cm"> *</span>
<span class="cm"> * @dst: mesh path destination mac address</span>
<span class="cm"> * @sdata: mesh subif</span>
<span class="cm"> * @next_hop: mesh neighbor to which frames for this destination will be</span>
<span class="cm"> * 	forwarded</span>
<span class="cm"> * @timer: mesh path discovery timer</span>
<span class="cm"> * @frame_queue: pending queue for frames sent to this destination while the</span>
<span class="cm"> * 	path is unresolved</span>
<span class="cm"> * @sn: target sequence number</span>
<span class="cm"> * @metric: current metric to this destination</span>
<span class="cm"> * @hop_count: hops to destination</span>
<span class="cm"> * @exp_time: in jiffies, when the path will expire or when it expired</span>
<span class="cm"> * @discovery_timeout: timeout (lapse in jiffies) used for the last discovery</span>
<span class="cm"> * 	retry</span>
<span class="cm"> * @discovery_retries: number of discovery retries</span>
<span class="cm"> * @flags: mesh path flags, as specified on &amp;enum mesh_path_flags</span>
<span class="cm"> * @state_lock: mesh path state lock used to protect changes to the</span>
<span class="cm"> * mpath itself.  No need to take this lock when adding or removing</span>
<span class="cm"> * an mpath to a hash bucket on a path table.</span>
<span class="cm"> * @rann_snd_addr: the RANN sender address</span>
<span class="cm"> * @rann_metric: the aggregated path metric towards the root node</span>
<span class="cm"> * @is_root: the destination station of this path is a root node</span>
<span class="cm"> * @is_gate: the destination station of this path is a mesh gate</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * The combination of dst and sdata is unique in the mesh path table. Since the</span>
<span class="cm"> * next_hop STA is only protected by RCU as well, deleting the STA must also</span>
<span class="cm"> * remove/substitute the mesh_path structure and wait until that is no longer</span>
<span class="cm"> * reachable before destroying the STA completely.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">mesh_path</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">dst</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">mpp</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>	<span class="cm">/* used for MPP or MAP */</span>
	<span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sta_info</span> <span class="n">__rcu</span> <span class="o">*</span><span class="n">next_hop</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">timer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">frame_queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rcu_head</span> <span class="n">rcu</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sn</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">metric</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">hop_count</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">exp_time</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">discovery_timeout</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">discovery_retries</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">mesh_path_flags</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">state_lock</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rann_snd_addr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">rann_metric</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">is_root</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">is_gate</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct mesh_table</span>
<span class="cm"> *</span>
<span class="cm"> * @hash_buckets: array of hash buckets of the table</span>
<span class="cm"> * @hashwlock: array of locks to protect write operations, one per bucket</span>
<span class="cm"> * @hash_mask: 2^size_order - 1, used to compute hash idx</span>
<span class="cm"> * @hash_rnd: random value used for hash computations</span>
<span class="cm"> * @entries: number of entries in the table</span>
<span class="cm"> * @free_node: function to free nodes of the table</span>
<span class="cm"> * @copy_node: function to copy nodes of the table</span>
<span class="cm"> * @size_order: determines size of the table, there will be 2^size_order hash</span>
<span class="cm"> *	buckets</span>
<span class="cm"> * @mean_chain_len: maximum average length for the hash buckets&#39; list, if it is</span>
<span class="cm"> *	reached, the table will grow</span>
<span class="cm"> * @known_gates: list of known mesh gates and their mpaths by the station. The</span>
<span class="cm"> * gate&#39;s mpath may or may not be resolved and active.</span>
<span class="cm"> *</span>
<span class="cm"> * rcu_head: RCU head to free the table</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">mesh_table</span> <span class="p">{</span>
	<span class="cm">/* Number of buckets will be 2^N */</span>
	<span class="k">struct</span> <span class="n">hlist_head</span> <span class="o">*</span><span class="n">hash_buckets</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="o">*</span><span class="n">hashwlock</span><span class="p">;</span>		<span class="cm">/* One per bucket, for add/del */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hash_mask</span><span class="p">;</span>		<span class="cm">/* (2^size_order) - 1 */</span>
	<span class="n">__u32</span> <span class="n">hash_rnd</span><span class="p">;</span>			<span class="cm">/* Used for hash generation */</span>
	<span class="n">atomic_t</span> <span class="n">entries</span><span class="p">;</span>		<span class="cm">/* Up to MAX_MESH_NEIGHBOURS */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">free_node</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">hlist_node</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">bool</span> <span class="n">free_leafs</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">copy_node</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">hlist_node</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mesh_table</span> <span class="o">*</span><span class="n">newtbl</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">size_order</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mean_chain_len</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hlist_head</span> <span class="o">*</span><span class="n">known_gates</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">gates_lock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">rcu_head</span> <span class="n">rcu_head</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Recent multicast cache */</span>
<span class="cm">/* RMC_BUCKETS must be a power of 2, maximum 256 */</span>
<span class="cp">#define RMC_BUCKETS		256</span>
<span class="cp">#define RMC_QUEUE_MAX_LEN	4</span>
<span class="cp">#define RMC_TIMEOUT		(3 * HZ)</span>

<span class="cm">/**</span>
<span class="cm"> * struct rmc_entry - entry in the Recent Multicast Cache</span>
<span class="cm"> *</span>
<span class="cm"> * @seqnum: mesh sequence number of the frame</span>
<span class="cm"> * @exp_time: expiration time of the entry, in jiffies</span>
<span class="cm"> * @sa: source address of the frame</span>
<span class="cm"> *</span>
<span class="cm"> * The Recent Multicast Cache keeps track of the latest multicast frames that</span>
<span class="cm"> * have been received by a mesh interface and discards received multicast frames</span>
<span class="cm"> * that are found in the cache.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">rmc_entry</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">seqnum</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">exp_time</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sa</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mesh_rmc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">rmc_entry</span> <span class="n">bucket</span><span class="p">[</span><span class="n">RMC_BUCKETS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">idx_mask</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define IEEE80211_MESH_PEER_INACTIVITY_LIMIT (1800 * HZ)</span>
<span class="cp">#define IEEE80211_MESH_HOUSEKEEPING_INTERVAL (60 * HZ)</span>

<span class="cp">#define MESH_DEFAULT_BEACON_INTERVAL		1000 	</span><span class="cm">/* in 1024 us units */</span><span class="cp"></span>

<span class="cp">#define MESH_PATH_EXPIRE (600 * HZ)</span>

<span class="cm">/* Default maximum number of plinks per interface */</span>
<span class="cp">#define MESH_MAX_PLINKS		256</span>

<span class="cm">/* Maximum number of paths per interface */</span>
<span class="cp">#define MESH_MAX_MPATHS		1024</span>

<span class="cm">/* Public interfaces */</span>
<span class="cm">/* Various */</span>
<span class="kt">int</span> <span class="n">ieee80211_fill_mesh_addresses</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">,</span> <span class="n">__le16</span> <span class="o">*</span><span class="n">fc</span><span class="p">,</span>
				  <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">da</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">sa</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ieee80211_new_mesh_header</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211s_hdr</span> <span class="o">*</span><span class="n">meshhdr</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">addr4or5</span><span class="p">,</span>
		<span class="kt">char</span> <span class="o">*</span><span class="n">addr6</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_rmc_check</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ieee80211s_hdr</span> <span class="o">*</span><span class="n">mesh_hdr</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="n">bool</span> <span class="n">mesh_matches_local</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">ieee802_11_elems</span> <span class="o">*</span><span class="n">ie</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_ids_set_default</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_if_mesh</span> <span class="o">*</span><span class="n">mesh</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_mgmt_ies_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_add_meshconf_ie</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_add_meshid_ie</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_add_rsn_ie</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_add_vendor_ies</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_add_ds_params_ie</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_add_ht_cap_ie</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_add_ht_oper_ie</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_rmc_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_rmc_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ieee80211s_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ieee80211s_update_metric</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_local</span> <span class="o">*</span><span class="n">local</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">stainfo</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ieee80211s_stop</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ieee80211_mesh_init_sdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ieee80211_start_mesh</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ieee80211_stop_mesh</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ieee80211_mesh_root_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_if_mesh</span> <span class="o">*</span><span class="n">ifmsh</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">ieee80211_mesh_sync_ops</span> <span class="o">*</span><span class="n">ieee80211_mesh_sync_ops_get</span><span class="p">(</span><span class="n">u8</span> <span class="n">method</span><span class="p">);</span>

<span class="cm">/* Mesh paths */</span>
<span class="kt">int</span> <span class="n">mesh_nexthop_lookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_nexthop_resolve</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_start_discovery</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">mesh_path</span> <span class="o">*</span><span class="n">mesh_path_lookup</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">mesh_path</span> <span class="o">*</span><span class="n">mpp_path_lookup</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mpp_path_add</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">mpp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">mesh_path</span> <span class="o">*</span><span class="n">mesh_path_lookup_by_idx</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_fix_nexthop</span><span class="p">(</span><span class="k">struct</span> <span class="n">mesh_path</span> <span class="o">*</span><span class="n">mpath</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">next_hop</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_expire</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_rx_path_sel_frame</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ieee80211_mgmt</span> <span class="o">*</span><span class="n">mgmt</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_path_add</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mesh_path_add_gate</span><span class="p">(</span><span class="k">struct</span> <span class="n">mesh_path</span> <span class="o">*</span><span class="n">mpath</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_path_send_to_gates</span><span class="p">(</span><span class="k">struct</span> <span class="n">mesh_path</span> <span class="o">*</span><span class="n">mpath</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_gate_num</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="cm">/* Mesh plinks */</span>
<span class="kt">void</span> <span class="n">mesh_neighbour_update</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">,</span>
			   <span class="n">u8</span> <span class="o">*</span><span class="n">hw_addr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">ieee802_11_elems</span> <span class="o">*</span><span class="n">ie</span><span class="p">);</span>
<span class="n">bool</span> <span class="n">mesh_peer_accepts_plinks</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee802_11_elems</span> <span class="o">*</span><span class="n">ie</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_accept_plinks_update</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_plink_broken</span><span class="p">(</span><span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">sta</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_plink_deactivate</span><span class="p">(</span><span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">sta</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_plink_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">sta</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_plink_block</span><span class="p">(</span><span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">sta</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_rx_plink_frame</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">ieee80211_mgmt</span> <span class="o">*</span><span class="n">mgmt</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">ieee80211_rx_status</span> <span class="o">*</span><span class="n">rx_status</span><span class="p">);</span>

<span class="cm">/* Private interfaces */</span>
<span class="cm">/* Mesh tables */</span>
<span class="kt">void</span> <span class="n">mesh_mpath_table_grow</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_mpp_table_grow</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cm">/* Mesh paths */</span>
<span class="kt">int</span> <span class="n">mesh_path_error_tx</span><span class="p">(</span><span class="n">u8</span> <span class="n">ttl</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span> <span class="n">__le32</span> <span class="n">target_sn</span><span class="p">,</span> <span class="n">__le16</span> <span class="n">target_rcode</span><span class="p">,</span>
		       <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">ra</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_assign_nexthop</span><span class="p">(</span><span class="k">struct</span> <span class="n">mesh_path</span> <span class="o">*</span><span class="n">mpath</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">sta</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_flush_pending</span><span class="p">(</span><span class="k">struct</span> <span class="n">mesh_path</span> <span class="o">*</span><span class="n">mpath</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_tx_pending</span><span class="p">(</span><span class="k">struct</span> <span class="n">mesh_path</span> <span class="o">*</span><span class="n">mpath</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_pathtbl_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_pathtbl_unregister</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mesh_path_del</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_timer</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">data</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_flush_by_nexthop</span><span class="p">(</span><span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">sta</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_discard_frame</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_quiesce</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_restart</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_tx_root_frame</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>

<span class="n">bool</span> <span class="n">mesh_action_is_path_sel</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_mgmt</span> <span class="o">*</span><span class="n">mgmt</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mesh_paths_generation</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_MAC80211_MESH</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mesh_allocated</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mesh_plink_free_count</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">sdata</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="n">mshcfg</span><span class="p">.</span><span class="n">dot11MeshMaxPeerLinks</span> <span class="o">-</span>
	       <span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sdata</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="n">mshstats</span><span class="p">.</span><span class="n">estab_plinks</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">mesh_plink_availables</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">min_t</span><span class="p">(</span><span class="kt">long</span><span class="p">,</span> <span class="n">mesh_plink_free_count</span><span class="p">(</span><span class="n">sdata</span><span class="p">),</span>
		   <span class="n">MESH_MAX_PLINKS</span> <span class="o">-</span> <span class="n">sdata</span><span class="o">-&gt;</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">num_sta</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">mesh_path_activate</span><span class="p">(</span><span class="k">struct</span> <span class="n">mesh_path</span> <span class="o">*</span><span class="n">mpath</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mpath</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">MESH_PATH_ACTIVE</span> <span class="o">|</span> <span class="n">MESH_PATH_RESOLVED</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">mesh_path_sel_is_hwmp</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">sdata</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="n">mesh_pp_id</span> <span class="o">==</span> <span class="n">IEEE80211_PATH_PROTOCOL_HWMP</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ieee80211_mesh_notify_scan_completed</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_local</span> <span class="o">*</span><span class="n">local</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">ieee80211_mesh_quiesce</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ieee80211_mesh_restart</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_plink_quiesce</span><span class="p">(</span><span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">sta</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_plink_restart</span><span class="p">(</span><span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">sta</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_path_flush_by_iface</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mesh_sync_adjust_tbtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="cp">#define mesh_allocated	0</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">ieee80211_mesh_notify_scan_completed</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_local</span> <span class="o">*</span><span class="n">local</span><span class="p">)</span> <span class="p">{}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ieee80211_mesh_quiesce</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">)</span>
<span class="p">{}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ieee80211_mesh_restart</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">)</span>
<span class="p">{}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">mesh_plink_quiesce</span><span class="p">(</span><span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">sta</span><span class="p">)</span> <span class="p">{}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">mesh_plink_restart</span><span class="p">(</span><span class="k">struct</span> <span class="n">sta_info</span> <span class="o">*</span><span class="n">sta</span><span class="p">)</span> <span class="p">{}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">mesh_path_sel_is_hwmp</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">)</span>
<span class="p">{</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">mesh_path_flush_by_iface</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_sub_if_data</span> <span class="o">*</span><span class="n">sdata</span><span class="p">)</span>
<span class="p">{}</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* IEEE80211S_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
