<!DOCTYPE html>
<html><head><title>joekychen/linux » net › mac80211 › debugfs.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>debugfs.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * mac80211 debugfs for wireless PHYs</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2007	Johannes Berg &lt;johannes@sipsolutions.net&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * GPLv2</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/debugfs.h&gt;</span>
<span class="cp">#include &lt;linux/rtnetlink.h&gt;</span>
<span class="cp">#include &quot;ieee80211_i.h&quot;</span>
<span class="cp">#include &quot;driver-ops.h&quot;</span>
<span class="cp">#include &quot;rate.h&quot;</span>
<span class="cp">#include &quot;debugfs.h&quot;</span>

<span class="cp">#define DEBUGFS_FORMAT_BUFFER_SIZE 100</span>

<span class="kt">int</span> <span class="nf">mac80211_format_buffer</span><span class="p">(</span><span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">userbuf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span>
				  <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
	<span class="kt">va_list</span> <span class="n">args</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">DEBUGFS_FORMAT_BUFFER_SIZE</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">res</span><span class="p">;</span>

	<span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
	<span class="n">res</span> <span class="o">=</span> <span class="n">vscnprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
	<span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">userbuf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define DEBUGFS_READONLY_FILE_FN(name, fmt, value...)			\</span>
<span class="cp">static ssize_t name## _read(struct file *file, char __user *userbuf,	\</span>
<span class="cp">			    size_t count, loff_t *ppos)			\</span>
<span class="cp">{									\</span>
<span class="cp">	struct ieee80211_local *local = file-&gt;private_data;		\</span>
<span class="cp">									\</span>
<span class="cp">	return mac80211_format_buffer(userbuf, count, ppos, 		\</span>
<span class="cp">				      fmt &quot;\n&quot;, ##value);		\</span>
<span class="cp">}</span>

<span class="cp">#define DEBUGFS_READONLY_FILE_OPS(name)			\</span>
<span class="cp">static const struct file_operations name## _ops = {			\</span>
<span class="cp">	.read = name## _read,						\</span>
<span class="cp">	.open = simple_open,						\</span>
<span class="cp">	.llseek = generic_file_llseek,					\</span>
<span class="cp">};</span>

<span class="cp">#define DEBUGFS_READONLY_FILE(name, fmt, value...)		\</span>
<span class="cp">	DEBUGFS_READONLY_FILE_FN(name, fmt, value)		\</span>
<span class="cp">	DEBUGFS_READONLY_FILE_OPS(name)</span>

<span class="cp">#define DEBUGFS_ADD(name)						\</span>
<span class="cp">	debugfs_create_file(#name, 0400, phyd, local, &amp;name## _ops);</span>

<span class="cp">#define DEBUGFS_ADD_MODE(name, mode)					\</span>
<span class="cp">	debugfs_create_file(#name, mode, phyd, local, &amp;name## _ops);</span>


<span class="n">DEBUGFS_READONLY_FILE</span><span class="p">(</span><span class="n">user_power</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span>
		      <span class="n">local</span><span class="o">-&gt;</span><span class="n">user_power_level</span><span class="p">);</span>
<span class="n">DEBUGFS_READONLY_FILE</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span>
		      <span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">power_level</span><span class="p">);</span>
<span class="n">DEBUGFS_READONLY_FILE</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span>
		      <span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">channel</span><span class="o">-&gt;</span><span class="n">center_freq</span><span class="p">);</span>
<span class="n">DEBUGFS_READONLY_FILE</span><span class="p">(</span><span class="n">total_ps_buffered</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span>
		      <span class="n">local</span><span class="o">-&gt;</span><span class="n">total_ps_buffered</span><span class="p">);</span>
<span class="n">DEBUGFS_READONLY_FILE</span><span class="p">(</span><span class="n">wep_iv</span><span class="p">,</span> <span class="s">&quot;%#08x&quot;</span><span class="p">,</span>
		      <span class="n">local</span><span class="o">-&gt;</span><span class="n">wep_iv</span> <span class="o">&amp;</span> <span class="mh">0xffffff</span><span class="p">);</span>
<span class="n">DEBUGFS_READONLY_FILE</span><span class="p">(</span><span class="n">rate_ctrl_alg</span><span class="p">,</span> <span class="s">&quot;%s&quot;</span><span class="p">,</span>
	<span class="n">local</span><span class="o">-&gt;</span><span class="n">rate_ctrl</span> <span class="o">?</span> <span class="n">local</span><span class="o">-&gt;</span><span class="n">rate_ctrl</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">:</span> <span class="s">&quot;hw/driver&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">reset_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			   <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_local</span> <span class="o">*</span><span class="n">local</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>

	<span class="n">rtnl_lock</span><span class="p">();</span>
	<span class="n">__ieee80211_suspend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">__ieee80211_resume</span><span class="p">(</span><span class="o">&amp;</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">);</span>
	<span class="n">rtnl_unlock</span><span class="p">();</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">reset_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">reset_write</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">noop_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">channel_type_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
		       <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_local</span> <span class="o">*</span><span class="n">local</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">channel_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">NL80211_CHAN_NO_HT</span>:
		<span class="n">buf</span> <span class="o">=</span> <span class="s">&quot;no ht</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">NL80211_CHAN_HT20</span>:
		<span class="n">buf</span> <span class="o">=</span> <span class="s">&quot;ht20</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">NL80211_CHAN_HT40MINUS</span>:
		<span class="n">buf</span> <span class="o">=</span> <span class="s">&quot;ht40-</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">NL80211_CHAN_HT40PLUS</span>:
		<span class="n">buf</span> <span class="o">=</span> <span class="s">&quot;ht40+</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">buf</span> <span class="o">=</span> <span class="s">&quot;???&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">hwflags_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			    <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_local</span> <span class="o">*</span><span class="n">local</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mxln</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">rv</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">mxln</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">sf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* how many written so far */</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_HAS_RATE_CONTROL</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;HAS_RATE_CONTROL</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_RX_INCLUDES_FCS</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;RX_INCLUDES_FCS</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_HOST_BROADCAST_PS_BUFFERING</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span>
			       <span class="s">&quot;HOST_BCAST_PS_BUFFERING</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_2GHZ_SHORT_SLOT_INCAPABLE</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span>
			       <span class="s">&quot;2GHZ_SHORT_SLOT_INCAPABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_2GHZ_SHORT_PREAMBLE_INCAPABLE</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span>
			       <span class="s">&quot;2GHZ_SHORT_PREAMBLE_INCAPABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_SIGNAL_UNSPEC</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;SIGNAL_UNSPEC</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_SIGNAL_DBM</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;SIGNAL_DBM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_NEED_DTIM_PERIOD</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;NEED_DTIM_PERIOD</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_SPECTRUM_MGMT</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;SPECTRUM_MGMT</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_AMPDU_AGGREGATION</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;AMPDU_AGGREGATION</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_SUPPORTS_PS</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;SUPPORTS_PS</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_PS_NULLFUNC_STACK</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;PS_NULLFUNC_STACK</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_SUPPORTS_DYNAMIC_PS</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;SUPPORTS_DYNAMIC_PS</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_MFP_CAPABLE</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;MFP_CAPABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_SUPPORTS_STATIC_SMPS</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;SUPPORTS_STATIC_SMPS</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_SUPPORTS_DYNAMIC_SMPS</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;SUPPORTS_DYNAMIC_SMPS</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_SUPPORTS_UAPSD</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;SUPPORTS_UAPSD</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_REPORTS_TX_ACK_STATUS</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;REPORTS_TX_ACK_STATUS</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_CONNECTION_MONITOR</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;CONNECTION_MONITOR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_SUPPORTS_PER_STA_GTK</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;SUPPORTS_PER_STA_GTK</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_AP_LINK_PS</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;AP_LINK_PS</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_TX_AMPDU_SETUP_IN_HW</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;TX_AMPDU_SETUP_IN_HW</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_HW_SCAN_WHILE_IDLE</span><span class="p">)</span>
		<span class="n">sf</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">sf</span><span class="p">,</span> <span class="n">mxln</span> <span class="o">-</span> <span class="n">sf</span><span class="p">,</span> <span class="s">&quot;SCAN_WHILE_IDLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">rv</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">rv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">queues_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			   <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_local</span> <span class="o">*</span><span class="n">local</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">IEEE80211_MAX_QUEUES</span> <span class="o">*</span> <span class="mi">20</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">q</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">queue_stop_reason_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">q</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">queues</span><span class="p">;</span> <span class="n">q</span><span class="o">++</span><span class="p">)</span>
		<span class="n">res</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">res</span><span class="p">,</span> <span class="s">&quot;%02d: %#.8lx/%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span>
				<span class="n">local</span><span class="o">-&gt;</span><span class="n">queue_stop_reasons</span><span class="p">[</span><span class="n">q</span><span class="p">],</span>
				<span class="n">skb_queue_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">pending</span><span class="p">[</span><span class="n">q</span><span class="p">]));</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">queue_stop_reason_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">DEBUGFS_READONLY_FILE_OPS</span><span class="p">(</span><span class="n">hwflags</span><span class="p">);</span>
<span class="n">DEBUGFS_READONLY_FILE_OPS</span><span class="p">(</span><span class="n">channel_type</span><span class="p">);</span>
<span class="n">DEBUGFS_READONLY_FILE_OPS</span><span class="p">(</span><span class="n">queues</span><span class="p">);</span>

<span class="cm">/* statistics stuff */</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">format_devstat_counter</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_local</span> <span class="o">*</span><span class="n">local</span><span class="p">,</span>
	<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">userbuf</span><span class="p">,</span>
	<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">,</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">printvalue</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ieee80211_low_level_stats</span> <span class="o">*</span><span class="n">stats</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
			  <span class="kt">int</span> <span class="n">buflen</span><span class="p">))</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_low_level_stats</span> <span class="n">stats</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">res</span><span class="p">;</span>

	<span class="n">rtnl_lock</span><span class="p">();</span>
	<span class="n">res</span> <span class="o">=</span> <span class="n">drv_get_stats</span><span class="p">(</span><span class="n">local</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stats</span><span class="p">);</span>
	<span class="n">rtnl_unlock</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
	<span class="n">res</span> <span class="o">=</span> <span class="n">printvalue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stats</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">userbuf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define DEBUGFS_DEVSTATS_FILE(name)					\</span>
<span class="cp">static int print_devstats_##name(struct ieee80211_low_level_stats *stats,\</span>
<span class="cp">				 char *buf, int buflen)			\</span>
<span class="cp">{									\</span>
<span class="cp">	return scnprintf(buf, buflen, &quot;%u\n&quot;, stats-&gt;name);		\</span>
<span class="cp">}									\</span>
<span class="cp">static ssize_t stats_ ##name## _read(struct file *file,			\</span>
<span class="cp">				     char __user *userbuf,		\</span>
<span class="cp">				     size_t count, loff_t *ppos)	\</span>
<span class="cp">{									\</span>
<span class="cp">	return format_devstat_counter(file-&gt;private_data,		\</span>
<span class="cp">				      userbuf,				\</span>
<span class="cp">				      count,				\</span>
<span class="cp">				      ppos,				\</span>
<span class="cp">				      print_devstats_##name);		\</span>
<span class="cp">}									\</span>
<span class="cp">									\</span>
<span class="cp">static const struct file_operations stats_ ##name## _ops = {		\</span>
<span class="cp">	.read = stats_ ##name## _read,					\</span>
<span class="cp">	.open = simple_open,						\</span>
<span class="cp">	.llseek = generic_file_llseek,					\</span>
<span class="cp">};</span>

<span class="cp">#define DEBUGFS_STATS_ADD(name, field)					\</span>
<span class="cp">	debugfs_create_u32(#name, 0400, statsd, (u32 *) &amp;field);</span>
<span class="cp">#define DEBUGFS_DEVSTATS_ADD(name)					\</span>
<span class="cp">	debugfs_create_file(#name, 0400, statsd, local, &amp;stats_ ##name## _ops);</span>

<span class="n">DEBUGFS_DEVSTATS_FILE</span><span class="p">(</span><span class="n">dot11ACKFailureCount</span><span class="p">);</span>
<span class="n">DEBUGFS_DEVSTATS_FILE</span><span class="p">(</span><span class="n">dot11RTSFailureCount</span><span class="p">);</span>
<span class="n">DEBUGFS_DEVSTATS_FILE</span><span class="p">(</span><span class="n">dot11FCSErrorCount</span><span class="p">);</span>
<span class="n">DEBUGFS_DEVSTATS_FILE</span><span class="p">(</span><span class="n">dot11RTSSuccessCount</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">debugfs_hw_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_local</span> <span class="o">*</span><span class="n">local</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">phyd</span> <span class="o">=</span> <span class="n">local</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">wiphy</span><span class="o">-&gt;</span><span class="n">debugfsdir</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">statsd</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">phyd</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">local</span><span class="o">-&gt;</span><span class="n">debugfs</span><span class="p">.</span><span class="n">keys</span> <span class="o">=</span> <span class="n">debugfs_create_dir</span><span class="p">(</span><span class="s">&quot;keys&quot;</span><span class="p">,</span> <span class="n">phyd</span><span class="p">);</span>

	<span class="n">DEBUGFS_ADD</span><span class="p">(</span><span class="n">frequency</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD</span><span class="p">(</span><span class="n">total_ps_buffered</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD</span><span class="p">(</span><span class="n">wep_iv</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD</span><span class="p">(</span><span class="n">queues</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_MODE</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="mo">0200</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD</span><span class="p">(</span><span class="n">channel_type</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD</span><span class="p">(</span><span class="n">hwflags</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD</span><span class="p">(</span><span class="n">user_power</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD</span><span class="p">(</span><span class="n">power</span><span class="p">);</span>

	<span class="n">statsd</span> <span class="o">=</span> <span class="n">debugfs_create_dir</span><span class="p">(</span><span class="s">&quot;statistics&quot;</span><span class="p">,</span> <span class="n">phyd</span><span class="p">);</span>

	<span class="cm">/* if the dir failed, don&#39;t put all the other things into the root! */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">statsd</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">transmitted_fragment_count</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">dot11TransmittedFragmentCount</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">multicast_transmitted_frame_count</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">dot11MulticastTransmittedFrameCount</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">failed_count</span><span class="p">,</span> <span class="n">local</span><span class="o">-&gt;</span><span class="n">dot11FailedCount</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">retry_count</span><span class="p">,</span> <span class="n">local</span><span class="o">-&gt;</span><span class="n">dot11RetryCount</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">multiple_retry_count</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">dot11MultipleRetryCount</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">frame_duplicate_count</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">dot11FrameDuplicateCount</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">received_fragment_count</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">dot11ReceivedFragmentCount</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">multicast_received_frame_count</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">dot11MulticastReceivedFrameCount</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">transmitted_frame_count</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">dot11TransmittedFrameCount</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_MAC80211_DEBUG_COUNTERS</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">tx_handlers_drop</span><span class="p">,</span> <span class="n">local</span><span class="o">-&gt;</span><span class="n">tx_handlers_drop</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">tx_handlers_queued</span><span class="p">,</span> <span class="n">local</span><span class="o">-&gt;</span><span class="n">tx_handlers_queued</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">tx_handlers_drop_unencrypted</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">tx_handlers_drop_unencrypted</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">tx_handlers_drop_fragment</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">tx_handlers_drop_fragment</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">tx_handlers_drop_wep</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">tx_handlers_drop_wep</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">tx_handlers_drop_not_assoc</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">tx_handlers_drop_not_assoc</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">tx_handlers_drop_unauth_port</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">tx_handlers_drop_unauth_port</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">rx_handlers_drop</span><span class="p">,</span> <span class="n">local</span><span class="o">-&gt;</span><span class="n">rx_handlers_drop</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">rx_handlers_queued</span><span class="p">,</span> <span class="n">local</span><span class="o">-&gt;</span><span class="n">rx_handlers_queued</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">rx_handlers_drop_nullfunc</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">rx_handlers_drop_nullfunc</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">rx_handlers_drop_defrag</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">rx_handlers_drop_defrag</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">rx_handlers_drop_short</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">rx_handlers_drop_short</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">rx_handlers_drop_passive_scan</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">rx_handlers_drop_passive_scan</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">tx_expand_skb_head</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">tx_expand_skb_head</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">tx_expand_skb_head_cloned</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">tx_expand_skb_head_cloned</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">rx_expand_skb_head</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">rx_expand_skb_head</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">rx_expand_skb_head2</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">rx_expand_skb_head2</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">rx_handlers_fragments</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">rx_handlers_fragments</span><span class="p">);</span>
	<span class="n">DEBUGFS_STATS_ADD</span><span class="p">(</span><span class="n">tx_status_drop</span><span class="p">,</span>
		<span class="n">local</span><span class="o">-&gt;</span><span class="n">tx_status_drop</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="n">DEBUGFS_DEVSTATS_ADD</span><span class="p">(</span><span class="n">dot11ACKFailureCount</span><span class="p">);</span>
	<span class="n">DEBUGFS_DEVSTATS_ADD</span><span class="p">(</span><span class="n">dot11RTSFailureCount</span><span class="p">);</span>
	<span class="n">DEBUGFS_DEVSTATS_ADD</span><span class="p">(</span><span class="n">dot11FCSErrorCount</span><span class="p">);</span>
	<span class="n">DEBUGFS_DEVSTATS_ADD</span><span class="p">(</span><span class="n">dot11RTSSuccessCount</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
