f | nf_conntrack_ecache.c | s | 6.5K | 222 | Tony Zelenoff | antonz@parallels.com | 1336497443 |  | netfilter: nf_ct_ecache: refactor notifier registration  * ret variable initialization removed as useless * similar code strings concatenated and functions code   flow became more plain  Signed-off-by: Tony Zelenoff <antonz@parallels.com> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | xt_TCPOPTSTRIP.c | s | 3.7K | 125 | Igor MaraviÄ‡ | igorm@etf.rs | 1324068592 |  | net:netfilter: use IS_ENABLED  Use IS_ENABLED(CONFIG_FOO) instead of defined(CONFIG_FOO) |||| defined (CONFIG_FOO_MODULE)  Signed-off-by: Igor MaraviÄ‡ <igorm@etf.rs> Signed-off-by: David S. Miller <davem@davemloft.net>
f | nf_conntrack_netlink.c | s | 58K | 2057 | Kelvie Wong | kelvie@ieee.org | 1336498859 |  | netfilter: nf_ct_expect: partially implement ctnetlink_change_expect  This refreshes the "timeout" attribute in existing expectations if one is given.  The use case for this would be for userspace helpers to extend the lifetime of the expectation when requested, as this is not possible right now without deleting/recreating the expectation.  I use this specifically for forwarding DCERPC traffic through:  DCERPC has a port mapper daemon that chooses a (seemingly) random port for future traffic to go to. We expect this traffic (with a reasonable timeout), but sometimes the port mapper will tell the client to continue using the same port. This allows us to extend the expectation accordingly.  Signed-off-by: Kelvie Wong <kelvie@ieee.org> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_conntrack_extend.c | s | 4.8K | 160 | Eric Dumazet | eric.dumazet@gmail.com | 1326400016 |  | net: reintroduce missing rcu_assign_pointer() calls  commit a9b3cd7f32 (rcu: convert uses of rcu_assign_pointer(x, NULL) to RCU_INIT_POINTER) did a lot of incorrect changes, since it did a complete conversion of rcu_assign_pointer(x, y) to RCU_INIT_POINTER(x, y).  We miss needed barriers, even on x86, when y is not NULL.  Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> CC: Stephen Hemminger <shemminger@vyatta.com> CC: Paul E. McKenney <paulmck@linux.vnet.ibm.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | nf_conntrack_proto_sctp.c | s | 23K | 726 | David S. Miller | davem@davemloft.net | 1333320699 |  | nf_conntrack_proto_sctp: Stop using NLA_PUT*().  These macros contain a hidden goto, and are thus extremely error prone and make code hard to audit.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | nf_conntrack_expect.c | s | 16K | 556 | Joe Perches | joe@perches.com | 1337103903 |  | net: Convert net_ratelimit uses to net_<level>_ratelimited  Standardize the net core ratelimited logging functions.  Coalesce formats, align arguments. Change a printk then vprintk sequence to use printf extension %pV.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_connbytes.c | s | 4.4K | 138 | David S. Miller | davem@davemloft.net | 1324797705 |  | Merge branch 'nf-next' of git://1984.lsi.us.es/net-next
f | xt_mac.c | s | 1.7K | 56 | Joe Perches | joe@perches.com | 1336610958 |  | netfilter: Convert compare_ether_addr to ether_addr_equal  Use the new bool function ether_addr_equal to add some clarity and reduce the likelihood for misuse of compare_ether_addr for sorting.  Done via cocci script:  $ cat compare_ether_addr.cocci @@ expression a,b; @@ -	!compare_ether_addr(a, b) +	ether_addr_equal(a, b)  @@ expression a,b; @@ -	compare_ether_addr(a, b) +	!ether_addr_equal(a, b)  @@ expression a,b; @@ -	!ether_addr_equal(a, b) == 0 +	ether_addr_equal(a, b)  @@ expression a,b; @@ -	!ether_addr_equal(a, b) != 0 +	!ether_addr_equal(a, b)  @@ expression a,b; @@ -	ether_addr_equal(a, b) == 0 +	!ether_addr_equal(a, b)  @@ expression a,b; @@ -	ether_addr_equal(a, b) != 0 +	ether_addr_equal(a, b)  @@ expression a,b; @@ -	!!ether_addr_equal(a, b) +	ether_addr_equal(a, b)  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | nf_conntrack_helper.c | s | 11K | 376 | Pablo Neira Ayuso | pablo@netfilter.org | 1336499082 |  | netfilter: nf_conntrack: fix explicit helper attachment and NAT  Explicit helper attachment via the CT target is broken with NAT if non-standard ports are used. This problem was hidden behind the automatic helper assignment routine. Thus, it becomes more noticeable now that we can disable the automatic helper assignment with Eric Leblond's:  9e8ac5a netfilter: nf_ct_helper: allow to disable automatic helper assignment  Basically, nf_conntrack_alter_reply asks for looking up the helper up if NAT is enabled. Unfortunately, we don't have the conntrack template at that point anymore.  Since we don't want to rely on the automatic helper assignment, we can skip the second look-up and stick to the helper that was attached by iptables. With the CT target, the user is in full control of helper attachment, thus, the policy is to trust what the user explicitly configures via iptables (no automatic magic anymore).  Interestingly, this bug was hidden by the automatic helper look-up code. But it can be easily trigger if you attach the helper in a non-standard port, eg.  iptables -I PREROUTING -t raw -p tcp --dport 8888 \ 	-j CT --helper ftp  And you disabled the automatic helper assignment.  I added the IPS_HELPER_BIT that allows us to differenciate between a helper that has been explicitly attached and those that have been automatically assigned. I didn't come up with a better solution (having backward compatibility in mind).  Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | Makefile | g | 5.6K |  | Hans Schillstrom | hans.schillstrom@ericsson.com | 1336560845 |  | netfilter: add xt_hmark target for hash-based skb marking  The target allows you to create rules in the "raw" and "mangle" tables which set the skbuff mark by means of hash calculation within a given range. The nfmark can influence the routing method (see "Use netfilter MARK value as routing key") and can also be used by other subsystems to change their behaviour.  [ Part of this patch has been refactorized and modified by Pablo Neira Ayuso ]  Signed-off-by: Hans Schillstrom <hans.schillstrom@ericsson.com> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_conntrack_timestamp.c | s | 2.7K | 99 | Eric W. Biederman | ebiederm@xmission.com | 1334971350 |  | net: Convert all sysctl registrations to register_net_sysctl  This results in code with less boiler plate that is a bit easier to read.  Additionally stops us from using compatibility code in the sysctl core, hastening the day when the compatibility code can be removed.  Signed-off-by: Eric W. Biederman <ebiederm@xmission.com> Acked-by: Pavel Emelyanov <xemul@parallels.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_CHECKSUM.c | s | 1.8K | 60 | Michael S. Tsirkin | mst@redhat.com | 1279207246 |  | netfilter: add CHECKSUM target  This adds a `CHECKSUM' target, which can be used in the iptables mangle table.  You can use this target to compute and fill in the checksum in a packet that lacks a checksum.  This is particularly useful, if you need to work around old applications such as dhcp clients, that do not work well with checksum offloads, but don't want to disable checksum offload in your device.  The problem happens in the field with virtualized applications. For reference, see Red Hat bz 605555, as well as http://www.spinics.net/lists/kvm/msg37660.html  Typical expected use (helps old dhclient binary running in a VM): iptables -A POSTROUTING -t mangle -p udp --dport bootpc \ 	-j CHECKSUM --checksum-fill  Includes fixes by Jan Engelhardt <jengelh@medozas.de>  Signed-off-by: Michael S. Tsirkin <mst@redhat.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | xt_SECMARK.c | s | 3.2K | 123 | Eric Paris | eparis@redhat.com | 1287616368 |  | secmark: make secmark object handling generic  Right now secmark has lots of direct selinux calls.  Use all LSM calls and remove all SELinux specific knowledge.  The only SELinux specific knowledge we leave is the mode.  The only point is to make sure that other LSMs at least test this generic code before they assume it works.  (They may also have to make changes if they do not represent labels as strings)  Signed-off-by: Eric Paris <eparis@redhat.com> Acked-by: Paul Moore <paul.moore@hp.com> Acked-by: Patrick McHardy <kaber@trash.net> Signed-off-by: James Morris <jmorris@namei.org>
f | xt_length.c | s | 1.8K | 59 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_mark.c | s | 2.0K | 71 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_cluster.c | s | 5.0K | 156 | Eric Dumazet | eric.dumazet@gmail.com | 1276006192 |  | netfilter: nf_conntrack: IPS_UNTRACKED bit  NOTRACK makes all cpus share a cache line on nf_conntrack_untracked twice per packet. This is bad for performance. __read_mostly annotation is also a bad choice.  This patch introduces IPS_UNTRACKED bit so that we can use later a per_cpu untrack structure more easily.  A new helper, nf_ct_untracked_get() returns a pointer to nf_conntrack_untracked.  Another one, nf_ct_untracked_status_or() is used by nf_nat_init() to add IPS_NAT_DONE_MASK bits to untracked status.  nf_ct_is_untracked() prototype is changed to work on a nf_conn pointer.  Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | xt_pkttype.c | s | 1.6K | 55 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_physdev.c | s | 4.0K | 111 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_policy.c | s | 4.7K | 163 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | nf_conntrack_broadcast.c | s | 2.1K | 69 | Jiri Olsa | jolsa@redhat.com | 1295370744 |  | netfilter: nf_conntrack: nf_conntrack snmp helper  Adding support for SNMP broadcast connection tracking. The SNMP broadcast requests are now paired with the SNMP responses. Thus allowing using SNMP broadcasts with firewall enabled.  Please refer to the following conversation: http://marc.info/?l=netfilter-devel&m=125992205006600&w=2  Patrick McHardy wrote: > > The best solution would be to add generic broadcast tracking, the > > use of expectations for this is a bit of abuse. > > The second best choice I guess would be to move the help() function > > to a shared module and generalize it so it can be used for both. This patch implements the "second best choice".  Since the netbios-ns conntrack module uses the same helper functionality as the snmp, only one helper function is added for both snmp and netbios-ns modules into the new object - nf_conntrack_broadcast.  Signed-off-by: Jiri Olsa <jolsa@redhat.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | xt_LOG.c | s | 22K | 786 | Pablo Neira Ayuso | pablo@netfilter.org | 1332413456 |  | netfilter: xt_LOG: use CONFIG_IP6_NF_IPTABLES instead of CONFIG_IPV6  This fixes the following linking error:  xt_LOG.c:(.text+0x789b1): undefined reference to `ip6t_ext_hdr'  ifdefs have to use CONFIG_IP6_NF_IPTABLES instead of CONFIG_IPV6.  Acked-by: Randy Dunlap <rdunlap@xenotime.net> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | xt_addrtype.c | s | 6.4K | 209 | Igor MaraviÄ‡ | igorm@etf.rs | 1324068592 |  | net:netfilter: use IS_ENABLED  Use IS_ENABLED(CONFIG_FOO) instead of defined(CONFIG_FOO) |||| defined (CONFIG_FOO_MODULE)  Signed-off-by: Igor MaraviÄ‡ <igorm@etf.rs> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_cpu.c | s | 1.5K | 53 | Jan Engelhardt | jengelh@medozas.de | 1295328834 |  | netfilter: xtables: add missing aliases for autoloading via iptables  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_comment.c | s | 1.0K | 38 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_connlimit.c | s | 8.0K | 273 | Changli Gao | xiaosuo@gmail.com | 1300191992 |  | netfilter: xt_connlimit: remove connlimit_rnd_inited  A potential race condition when generating connlimit_rnd is also fixed.  Signed-off-by: Changli Gao <xiaosuo@gmail.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | xt_iprange.c | s | 3.8K | 129 | David S. Miller | davem@davemloft.net | 1296858538 |  | Merge branch 'master' of master.kernel.org:/pub/scm/linux/kernel/git/davem/net-2.6
f | xt_multiport.c | s | 4.6K | 143 | Jan Engelhardt | jengelh@medozas.de | 1273595727 |  | netfilter: xtables: change hotdrop pointer to direct modification  Since xt_action_param is writable, let's use it. The pointer to 'bool hotdrop' always worried (8 bytes (64-bit) to write 1 byte!). Surprisingly results in a reduction in size:     text    data     bss filename 5457066  692730  357892 vmlinux.o-prev 5456554  692730  357892 vmlinux.o  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_limit.c | s | 5.8K | 176 | Florian Westphal | fw@strlen.de | 1336560846 |  | netfilter: limit, hashlimit: avoid duplicated inline  credit_cap can be set to credit, which avoids inlining user2credits twice. Also, remove inline keyword and let compiler decide.  old:     684     192       0     876     36c net/netfilter/xt_limit.o    4927     344      32    5303    14b7 net/netfilter/xt_hashlimit.o now:     668     192       0     860     35c net/netfilter/xt_limit.o    4793     344      32    5169    1431 net/netfilter/xt_hashlimit.o  Signed-off-by: Florian Westphal <fw@strlen.de> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_conntrack_standalone.c | s | 13K | 495 | Eric W. Biederman | ebiederm@xmission.com | 1334971350 |  | net: Convert all sysctl registrations to register_net_sysctl  This results in code with less boiler plate that is a bit easier to read.  Additionally stops us from using compatibility code in the sysctl core, hastening the day when the compatibility code can be removed.  Signed-off-by: Eric W. Biederman <ebiederm@xmission.com> Acked-by: Pavel Emelyanov <xemul@parallels.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_TEE.c | s | 7.4K | 275 | Alex Shi | alex.shi@intel.com | 1337030131 |  | net: replace percpu_xxx funcs with this_cpu_xxx or __this_cpu_xxx  percpu_xxx funcs are duplicated with this_cpu_xxx funcs, so replace them for further code clean up.  And in preempt safe scenario, __this_cpu_xxx funcs may has a bit better performance since __this_cpu_xxx has no redundant preempt_enable/preempt_disable on some architectures.  Signed-off-by: Alex Shi <alex.shi@intel.com> Acked-by: Eric Dumazet <eric.dumazet@gmail.com> Acked-by: David S. Miller <davem@davemloft.net> Cc: Patrick McHardy <kaber@trash.net> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Tejun Heo <tj@kernel.org>
f | nf_conntrack_irc.c | s | 7.9K | 246 | Joe Perches | joe@perches.com | 1337103903 |  | net: Convert net_ratelimit uses to net_<level>_ratelimited  Standardize the net core ratelimited logging functions.  Coalesce formats, align arguments. Change a printk then vprintk sequence to use printf extension %pV.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_time.c | s | 7.5K | 233 | Joe Perches | joe@perches.com | 1273756587 |  | netfilter: remove unnecessary returns from void function()s  This patch removes from net/ netfilter files all the unnecessary return; statements that precede the last closing brace of void functions.  It does not remove the returns that are immediately preceded by a label as gcc doesn't like that.  Done via: $ grep -rP --include=*.[ch] -l "return;\n}" net/ || \   xargs perl -i -e 'local $/ ; while (<>) { s/\n[ \t\n]+return;\n}/\n}/g; print; }'  Signed-off-by: Joe Perches <joe@perches.com> [Patrick: changed to keep return statements in otherwise empty function bodies] Signed-off-by: Patrick McHardy <kaber@trash.net>
f | nf_queue.c | s | 9.3K | 360 | Florian Westphal | fw@strlen.de | 1328816873 |  | netfilter: nf_queue: fix queueing of bridged gro skbs  When trying to nf_queue GRO/GSO skbs, nf_queue uses skb_gso_segment to split the skb.  However, if nf_queue is called via bridge netfilter, the mac header won't be preserved -- packets will thus contain a bogus mac header.  Fix this by setting skb->data to the mac header when skb->nf_bridge is set and restoring skb->data afterwards for all segments.  Signed-off-by: Florian Westphal <fw@strlen.de> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | xt_TPROXY.c | s | 12K | 372 | Hans Schillstrom | hans.schillstrom@ericsson.com | 1336560827 |  | netfilter: ip6_tables: add flags parameter to ipv6_find_hdr()  This patch adds the flags parameter to ipv6_find_hdr. This flags allows us to:  * know if this is a fragment. * stop at the AH header, so the information contained in that header   can be used for some specific packet handling.  This patch also adds the offset parameter for inspection of one inner IPv6 header that is contained in error messages.  Signed-off-by: Hans Schillstrom <hans.schillstrom@ericsson.com> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | xt_quota.c | s | 1.9K | 74 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103828 |  | net: Fix files explicitly needing to include module.h  With calls to modular infrastructure, these files really needs the full module.h header.  Call it out so some of the cleanups of implicit and unrequired includes elsewhere can be cleaned up.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | xt_devgroup.c | s | 2.2K | 66 | Patrick McHardy | kaber@trash.net | 1296687943 |  | netfilter: xtables: add device group match  Add a new 'devgroup' match to match on the device group of the incoming and outgoing network device of a packet.  Signed-off-by: Patrick McHardy <kaber@trash.net>
f | nfnetlink_cttimeout.c | s | 10K | 362 | David S. Miller | davem@davemloft.net | 1333320360 |  | nfnetlink_cttimeout: Stop using NLA_PUT*().  These macros contain a hidden goto, and are thus extremely error prone and make code hard to audit.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | nf_conntrack_proto_udplite.c | s | 9.1K | 289 | David S. Miller | davem@davemloft.net | 1333320486 |  | nf_conntrack_proto_udp{,lite}: Stop using NLA_PUT*().  These macros contain a hidden goto, and are thus extremely error prone and make code hard to audit.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_AUDIT.c | s | 5.1K | 188 | Jesse Gross | jesse@nicira.com | 1322933710 |  | ipv6: Add fragment reporting to ipv6_skip_exthdr().  While parsing through IPv6 extension headers, fragment headers are skipped making them invisible to the caller.  This reports the fragment offset of the last header in order to make it possible to determine whether the packet is fragmented and, if so whether it is a first or last fragment.  Signed-off-by: Jesse Gross <jesse@nicira.com>
f | xt_TRACE.c | s | 852B | 33 | Jan Engelhardt | jengelh@medozas.de | 1273595477 |  | netfilter: xtables: substitute temporary defines by final name  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_hashlimit.c | s | 23K | 803 | Florian Westphal | fw@strlen.de | 1337208991 |  | netfilter: xt_hashlimit: use _ALL macro to reject unknown flag bits  David Miller says:      The canonical way to validate if the set bits are in a valid      range is to have a "_ALL" macro, and test:      if (val & ~XT_HASHLIMIT_ALL)          goto err;"  make it so.  Signed-off-by: Florian Westphal <fw@strlen.de> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_conntrack_pptp.c | s | 18K | 543 | Sanket Shah | sanket.shah@elitecore.com | 1314710583 |  | netfilter: nf_ct_pptp: fix DNATed PPTP connection address translation  When both the server and the client are NATed, the set-link-info control packet containing the peer's call-id field is not properly translated.  I have verified that it was working in 2.6.16.13 kernel previously but due to rewrite, this scenario stopped working (Not knowing exact version when it stopped working).  Signed-off-by: Sanket Shah <sanket.shah@elitecore.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | xt_DSCP.c | s | 4.0K | 141 | Fernando Luis Vazquez Cao | fernando@oss.ntt.co.jp | 1305014421 |  | netfilter: IPv6: fix DSCP mangle code  The mask indicates the bits one wants to zero out, so it needs to be inverted before applying to the original TOS field.  Signed-off-by: Fernando Luis Vazquez Cao <fernando@oss.ntt.co.jp> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | xt_statistic.c | s | 2.5K | 84 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103828 |  | net: Fix files explicitly needing to include module.h  With calls to modular infrastructure, these files really needs the full module.h header.  Call it out so some of the cleanups of implicit and unrequired includes elsewhere can be cleaned up.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | nf_conntrack_acct.c | s | 3.1K | 112 | Eric W. Biederman | ebiederm@xmission.com | 1334971350 |  | net: Convert all sysctl registrations to register_net_sysctl  This results in code with less boiler plate that is a bit easier to read.  Additionally stops us from using compatibility code in the sysctl core, hastening the day when the compatibility code can be removed.  Signed-off-by: Eric W. Biederman <ebiederm@xmission.com> Acked-by: Pavel Emelyanov <xemul@parallels.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_esp.c | s | 2.6K | 91 | Jan Engelhardt | jengelh@medozas.de | 1273595727 |  | netfilter: xtables: change hotdrop pointer to direct modification  Since xt_action_param is writable, let's use it. The pointer to 'bool hotdrop' always worried (8 bytes (64-bit) to write 1 byte!). Surprisingly results in a reduction in size:     text    data     bss filename 5457066  692730  357892 vmlinux.o-prev 5456554  692730  357892 vmlinux.o  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | nf_internals.h | s | 922B | 31 | Stephen Hemminger | shemminger@vyatta.com | 1273755728 |  | netfilter: cleanup printk messages  Make sure all printk messages have a severity level.  Signed-off-by: Stephen Hemminger <shemminger@vyatta.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | xt_repldata.h | s | 1.2K | 34 | Jan Engelhardt | jengelh@medozas.de | 1265820647 |  | netfilter: xtables: generate initial table on-demand  The static initial tables are pretty large, and after the net namespace has been instantiated, they just hang around for nothing. This commit removes them and creates tables on-demand at runtime when needed.  Size shrinks by 7735 bytes (x86_64).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_TCPMSS.c | s | 8.0K | 279 | Joe Perches | joe@perches.com | 1337103903 |  | net: Convert net_ratelimit uses to net_<level>_ratelimited  Standardize the net core ratelimited logging functions.  Coalesce formats, align arguments. Change a printk then vprintk sequence to use printf extension %pV.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | nf_conntrack_netbios_ns.c | s | 2.2K | 61 | Jiri Olsa | jolsa@redhat.com | 1295370744 |  | netfilter: nf_conntrack: nf_conntrack snmp helper  Adding support for SNMP broadcast connection tracking. The SNMP broadcast requests are now paired with the SNMP responses. Thus allowing using SNMP broadcasts with firewall enabled.  Please refer to the following conversation: http://marc.info/?l=netfilter-devel&m=125992205006600&w=2  Patrick McHardy wrote: > > The best solution would be to add generic broadcast tracking, the > > use of expectations for this is a bit of abuse. > > The second best choice I guess would be to move the help() function > > to a shared module and generalize it so it can be used for both. This patch implements the "second best choice".  Since the netbios-ns conntrack module uses the same helper functionality as the snmp, only one helper function is added for both snmp and netbios-ns modules into the new object - nf_conntrack_broadcast.  Signed-off-by: Jiri Olsa <jolsa@redhat.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | xt_CLASSIFY.c | s | 2.0K | 63 | Frédéric Leroy | fredo@starox.org | 1289825876 |  | netfilter: xt_CLASSIFY: add ARP support, allow CLASSIFY target on any table  Signed-off-by: Frédéric Leroy <fredo@starox.org> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | xt_RATEEST.c | s | 4.6K | 165 | Paul E. McKenney | paulmck@linux.vnet.ibm.com | 1311196219 |  | net,rcu: Convert call_rcu(xt_rateest_free_rcu) to kfree_rcu()  The RCU callback xt_rateest_free_rcu() just calls kfree(), so we can use kfree_rcu() instead of call_rcu().  This also allows us to dispense with an rcu_barrier() call, speeding up unloading of this module.  Signed-off-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com> Cc: Patrick McHardy <kaber@trash.net> Reviewed-by: Josh Triplett <josh@joshtriplett.org>
f | xt_conntrack.c | s | 9.6K | 283 | Pablo Neira Ayuso | pablo@netfilter.org | 1305022416 |  | netfilter: revert a2361c8735e07322023aedc36e4938b35af31eb0  This patch reverts a2361c8735e07322023aedc36e4938b35af31eb0: "[PATCH] netfilter: xt_conntrack: warn about use in raw table"  Florian Wesphal says: "... when the packet was sent from the local machine the skb already has ->nfct attached, and -m conntrack seems to do the right thing."  Acked-by: Jan Engelhardt <jengelh@medozas.de> Reported-by: Florian Wesphal <fw@strlen.de> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | xt_IDLETIMER.c | s | 7.5K | 250 | Joe Perches | joe@perches.com | 1320135589 |  | netfilter: Remove unnecessary OOM logging messages  Site specific OOM messages are duplications of a generic MM out of memory message and aren't really useful, so just delete them.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: Patrick McHardy <kaber@trash.net> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_sockopt.c | s | 3.9K | 145 | David S. Miller | davem@davemloft.net | 1254352340 |  | net: Make setsockopt() optlen be unsigned.  This provides safety against negative optlen at the type level instead of depending upon (sometimes non-trivial) checks against this sprinkled all over the the place, in each and every implementation.  Based upon work done by Arjan van de Ven and feedback from Linus Torvalds.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | nf_conntrack_timeout.c | s | 1.6K | 51 | Pablo Neira Ayuso | pablo@netfilter.org | 1331138485 |  | netfilter: nf_ct_ext: add timeout extension  This patch adds the timeout extension, which allows you to attach specific timeout policies to flows.  This extension is only used by the template conntrack.  Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_conntrack_proto_tcp.c | s | 49K | 1500 | Pablo Neira Ayuso | pablo@netfilter.org | 1337208998 |  | netfilter: nf_ct_tcp: extend log message for invalid ignored packets  Extend log message if packets are ignored to include the TCP state, ie. replace:  [ 3968.070196] nf_ct_tcp: invalid packet ignored IN= OUT= SRC=...  by:  [ 3968.070196] nf_ct_tcp: invalid packet ignored in state ESTABLISHED IN= OUT= SRC=...  This information is useful to know in what state we were while ignoring the packet.  Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org> Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu>
f | xt_NFLOG.c | s | 1.8K | 60 | Jan Engelhardt | jengelh@medozas.de | 1273595477 |  | netfilter: xtables: substitute temporary defines by final name  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_HL.c | s | 3.7K | 147 | Joe Perches | joe@perches.com | 1309561875 |  | netfilter: Reduce switch/case indent  Make the case labels the same indent as the switch.  git diff -w shows miscellaneous 80 column wrapping, comment reflowing and a comment for a useless gcc warning for an otherwise unused default: case.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_u32.c | s | 2.7K | 107 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_CT.c | s | 9.1K | 344 | Eldad Zack | eldad@fogrefinery.com | 1337209202 |  | netfilter: xt_CT: remove redundant header include  nf_conntrack_l4proto.h is included twice.  Signed-off-by: Eldad Zack <eldad@fogrefinery.com> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nfnetlink_log.c | s | 24K | 862 | David S. Miller | davem@davemloft.net | 1333320224 |  | nfnetlink_log: Stop using NLA_PUT*().  These macros contain a hidden goto, and are thus extremely error prone and make code hard to audit.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_hl.c | s | 2.3K | 83 | Joe Perches | joe@perches.com | 1309561875 |  | netfilter: Reduce switch/case indent  Make the case labels the same indent as the switch.  git diff -w shows miscellaneous 80 column wrapping, comment reflowing and a comment for a useless gcc warning for an otherwise unused default: case.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_sctp.c | s | 5.0K | 172 | Shan Wei | shanwei@cn.fujitsu.com | 1276087660 |  | netfilter: xt_sctp: use WORD_ROUND macro to calculate length of multiple of 4 bytes  Use  WORD_ROUND to round an int up to the next multiple of 4.  Signed-off-by: Shan Wei <shanwei@cn.fujitsu.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
d | ipset |  | 16 items |  | Tomasz Bursztyka | tomasz.bursztyka@linux.intel.com | 1340967844 |  | netfilter: ipset: fix crash if IPSET_CMD_NONE command is sent  This patch fixes a crash if that ipset command is sent over nfnetlink.  Signed-off-by: Tomasz Bursztyka <tomasz.bursztyka@linux.intel.com> Acked-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | xt_recent.c | s | 16K | 589 | Eric Dumazet | eric.dumazet@gmail.com | 1334508280 |  | net: cleanup unsigned to unsigned int  Use of "unsigned int" is preferred to bare "unsigned" in net tree.  Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_owner.c | s | 2.2K | 72 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_dscp.c | s | 2.8K | 100 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_NFQUEUE.c | s | 4.0K | 137 | Igor MaraviÄ‡ | igorm@etf.rs | 1324068592 |  | net:netfilter: use IS_ENABLED  Use IS_ENABLED(CONFIG_FOO) instead of defined(CONFIG_FOO) |||| defined (CONFIG_FOO_MODULE)  Signed-off-by: Igor MaraviÄ‡ <igorm@etf.rs> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_LED.c | s | 5.5K | 171 | Jan Engelhardt | jengelh@medozas.de | 1295328834 |  | netfilter: xtables: add missing aliases for autoloading via iptables  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_ipvs.c | s | 4.2K | 161 | Hans Schillstrom | hans.schillstrom@ericsson.com | 1294882227 |  | IPVS: netns, use ip_vs_proto_data as param.  ip_vs_protocol *pp is replaced by ip_vs_proto_data *pd in function call in ip_vs_protocol struct i.e. :,  - timeout_change()  - state_transition()  ip_vs_protocol_timeout_change() got ipvs as param, due to above and a upcoming patch - defence work  Most of this changes are triggered by Julians comment: "tcp_timeout_change should work with the new struct ip_vs_proto_data         so that tcp_state_table will go to pd->state_table         and set_tcp_state will get pd instead of pp"  *v3 Mostly comments from Julian The pp -> pd conversion should start from functions like ip_vs_out() that use pp = ip_vs_proto_get(iph.protocol), now they should use ip_vs_proto_data_get(net, iph.protocol). conn_in_get() and conn_out_get() unused param *pp, removed.  *v4 ip_vs_protocol_timeout_change() walk the proto_data path.  Signed-off-by: Hans Schillstrom <hans.schillstrom@ericsson.com> Acked-by: Julian Anastasov <ja@ssi.bg> Signed-off-by: Simon Horman <horms@verge.net.au>
f | nf_conntrack_h323_types.c | s | 87K | 1749 | Jan Engelhardt | jengelh@computergmbh.de | 1201836487 |  | [NETFILTER]: nf_conntrack_h323: constify and annotate H.323 helper  Constify data tables (predominantly in nf_conntrack_h323_types.c, but also a few in nf_conntrack_h323_asn1.c) and use const qualifiers on variables where possible in the h323 sources.  Signed-off-by: Jan Engelhardt <jengelh@computergmbh.de> Signed-off-by: Patrick McHardy <kaber@trash.net> Signed-off-by: David S. Miller <davem@davemloft.net>
f | nf_conntrack_proto_udp.c | s | 8.8K | 283 | David S. Miller | davem@davemloft.net | 1333320486 |  | nf_conntrack_proto_udp{,lite}: Stop using NLA_PUT*().  These macros contain a hidden goto, and are thus extremely error prone and make code hard to audit.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | nf_conntrack_proto_dccp.c | s | 28K | 896 | Eric W. Biederman | ebiederm@xmission.com | 1334971350 |  | net: Convert all sysctl registrations to register_net_sysctl  This results in code with less boiler plate that is a bit easier to read.  Additionally stops us from using compatibility code in the sysctl core, hastening the day when the compatibility code can be removed.  Signed-off-by: Eric W. Biederman <ebiederm@xmission.com> Acked-by: Pavel Emelyanov <xemul@parallels.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_dccp.c | s | 4.4K | 159 | Jan Engelhardt | jengelh@medozas.de | 1273595727 |  | netfilter: xtables: change hotdrop pointer to direct modification  Since xt_action_param is writable, let's use it. The pointer to 'bool hotdrop' always worried (8 bytes (64-bit) to write 1 byte!). Surprisingly results in a reduction in size:     text    data     bss filename 5457066  692730  357892 vmlinux.o-prev 5456554  692730  357892 vmlinux.o  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | nf_conntrack_sane.c | s | 6.1K | 196 | Eric Dumazet | eric.dumazet@gmail.com | 1307316910 |  | netfilter: add more values to enum ip_conntrack_info  Following error is raised (and other similar ones) :  net/ipv4/netfilter/nf_nat_standalone.c: In function â€˜nf_nat_fnâ€™: net/ipv4/netfilter/nf_nat_standalone.c:119:2: warning: case value â€˜4â€™ not in enumerated type â€˜enum ip_conntrack_infoâ€™  gcc barfs on adding two enum values and getting a not enumerated result :  case IP_CT_RELATED+IP_CT_IS_REPLY:  Add missing enum values  Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> CC: David Miller <davem@davemloft.net> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_conntrack_ftp.c | s | 15K | 512 | Rusty Russell | rusty@rustcorp.com.au | 1324351649 |  | module_param: make bool parameters really bool (net & drivers/net)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  (Thanks to Joe Perches for suggesting coccinelle for 0/1 -> true/false).  Cc: "David S. Miller" <davem@davemloft.net> Cc: netdev@vger.kernel.org Signed-off-by: Rusty Russell <rusty@rustcorp.com.au> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_osf.c | s | 9.8K | 347 | Lai Jiangshan | laijs@cn.fujitsu.com | 1304833872 |  | net,rcu: convert call_rcu(xt_osf_finger_free_rcu) to kfree_rcu()  The rcu callback xt_osf_finger_free_rcu() just calls a kfree(), so we use kfree_rcu() instead of the call_rcu(xt_osf_finger_free_rcu).  Signed-off-by: Lai Jiangshan <laijs@cn.fujitsu.com> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com> Reviewed-by: Josh Triplett <josh@joshtriplett.org>
f | xt_rateest.c | s | 3.7K | 136 | Eric Dumazet | eric.dumazet@gmail.com | 1311949486 |  | netfilter: xt_rateest: fix xt_rateest_mt_checkentry()  commit 4a5a5c73b7cfee (slightly better error reporting) added some useless code in xt_rateest_mt_checkentry().  Fix this so that different error codes can really be returned.  Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> CC: Jan Engelhardt <jengelh@medozas.de> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | xt_nfacct.c | s | 1.9K | 63 | Pablo Neira Ayuso | pablo@netfilter.org | 1324777397 |  | netfilter: xtables: add nfacct match to support extended accounting  This patch adds the match that allows to perform extended accounting. It requires the new nfnetlink_acct infrastructure.   # iptables -I INPUT -p tcp --sport 80 -m nfacct --nfacct-name http-traffic  # iptables -I OUTPUT -p tcp --dport 80 -m nfacct --nfacct-name http-traffic  Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_conntrack_core.c | s | 44K | 1416 | Joe Perches | joe@perches.com | 1337103903 |  | net: Convert net_ratelimit uses to net_<level>_ratelimited  Standardize the net core ratelimited logging functions.  Coalesce formats, align arguments. Change a printk then vprintk sequence to use printf extension %pV.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | Kconfig | g | 39K |  | Hans Schillstrom | hans.schillstrom@ericsson.com | 1336560845 |  | netfilter: add xt_hmark target for hash-based skb marking  The target allows you to create rules in the "raw" and "mangle" tables which set the skbuff mark by means of hash calculation within a given range. The nfmark can influence the routing method (see "Use netfilter MARK value as routing key") and can also be used by other subsystems to change their behaviour.  [ Part of this patch has been refactorized and modified by Pablo Neira Ayuso ]  Signed-off-by: Hans Schillstrom <hans.schillstrom@ericsson.com> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | xt_realm.c | s | 1.4K | 45 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | nf_conntrack_snmp.c | s | 2.2K | 63 | Jiri Olsa | jolsa@redhat.com | 1295370744 |  | netfilter: nf_conntrack: nf_conntrack snmp helper  Adding support for SNMP broadcast connection tracking. The SNMP broadcast requests are now paired with the SNMP responses. Thus allowing using SNMP broadcasts with firewall enabled.  Please refer to the following conversation: http://marc.info/?l=netfilter-devel&m=125992205006600&w=2  Patrick McHardy wrote: > > The best solution would be to add generic broadcast tracking, the > > use of expectations for this is a bit of abuse. > > The second best choice I guess would be to move the help() function > > to a shared module and generalize it so it can be used for both. This patch implements the "second best choice".  Since the netbios-ns conntrack module uses the same helper functionality as the snmp, only one helper function is added for both snmp and netbios-ns modules into the new object - nf_conntrack_broadcast.  Signed-off-by: Jiri Olsa <jolsa@redhat.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | nf_conntrack_proto.c | s | 10K | 337 | Eric W. Biederman | ebiederm@xmission.com | 1334971350 |  | net: Convert nf_conntrack_proto to use register_net_sysctl  There isn't much advantage here except that strings paths are a bit easier to read, and converting everything to them allows me to kill off ctl_path.  Signed-off-by: Eric W. Biederman <ebiederm@xmission.com> Acked-by: Pavel Emelyanov <xemul@parallels.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | x_tables.c | s | 32K | 1185 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103828 |  | net: Fix files explicitly needing to include module.h  With calls to modular infrastructure, these files really needs the full module.h header.  Call it out so some of the cleanups of implicit and unrequired includes elsewhere can be cleaned up.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | xt_NOTRACK.c | s | 1.3K | 44 | Eric Dumazet | eric.dumazet@gmail.com | 1276006192 |  | netfilter: nf_conntrack: IPS_UNTRACKED bit  NOTRACK makes all cpus share a cache line on nf_conntrack_untracked twice per packet. This is bad for performance. __read_mostly annotation is also a bad choice.  This patch introduces IPS_UNTRACKED bit so that we can use later a per_cpu untrack structure more easily.  A new helper, nf_ct_untracked_get() returns a pointer to nf_conntrack_untracked.  Another one, nf_ct_untracked_status_or() is used by nf_nat_init() to add IPS_NAT_DONE_MASK bits to untracked status.  nf_ct_is_untracked() prototype is changed to work on a nf_conn pointer.  Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | nf_tproxy_core.c | s | 1.4K | 51 | Florian Westphal | fwestphal@astaro.com | 1297938758 |  | netfilter: tproxy: do not assign timewait sockets to skb->sk  Assigning a socket in timewait state to skb->sk can trigger kernel oops, e.g. in nfnetlink_log, which does:  if (skb->sk) {         read_lock_bh(&skb->sk->sk_callback_lock);         if (skb->sk->sk_socket && skb->sk->sk_socket->file) ...  in the timewait case, accessing sk->sk_callback_lock and sk->sk_socket is invalid.  Either all of these spots will need to add a test for sk->sk_state != TCP_TIME_WAIT, or xt_TPROXY must not assign a timewait socket to skb->sk.  This does the latter.  If a TW socket is found, assign the tproxy nfmark, but skip the skb->sk assignment, thus mimicking behaviour of a '-m socket .. -j MARK/ACCEPT' re-routing rule.  The 'SYN to TW socket' case is left unchanged -- we try to redirect to the listener socket.  Cc: Balazs Scheidler <bazsi@balabit.hu> Cc: KOVACS Krisztian <hidden@balabit.hu> Signed-off-by: Florian Westphal <fwestphal@astaro.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | nfnetlink.c | s | 6.0K | 210 | Tomasz Bursztyka | tomasz.bursztyka@linux.intel.com | 1340967856 |  | netfilter: nfnetlink: fix missing rcu_read_unlock in nfnetlink_rcv_msg  Bug added in commit 6b75e3e8d664a9a (netfilter: nfnetlink: add RCU in nfnetlink_rcv_msg())  Signed-off-by: Tomasz Bursztyka <tomasz.bursztyka@linux.intel.com> Acked-by: Eric Dumazet <edumazet@google.com> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_conntrack_h323_main.c | s | 52K | 1594 | Pablo Neira Ayuso | pablo@netfilter.org | 1339073597 |  | netfilter: nf_ct_h323: fix bug in rtcp natting  The nat_rtp_rtcp hook takes two separate parameters port and rtp_port.  port is expected to be the real h245 address (found inside the packet). rtp_port is the even number closest to port (RTP ports are even and RTCP ports are odd).  However currently, both port and rtp_port are having same value (both are rounded to nearest even numbers).  This works well in case of openlogicalchannel with media (RTP/even) port.  But in case of openlogicalchannel for media control (RTCP/odd) port, h245 address in the packet is wrongly modified to have an even port.  I am attaching a pcap demonstrating the problem, for any further analysis.  This behavior was introduced around v2.6.19 while rewriting the helper.  Signed-off-by: Jagdish Motwani <jagdish.motwani@elitecore.com> Signed-off-by: Sanket Shah <sanket.shah@elitecore.com> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_log.c | s | 7.1K | 259 | Eric W. Biederman | ebiederm@xmission.com | 1334971350 |  | net: Convert all sysctl registrations to register_net_sysctl  This results in code with less boiler plate that is a bit easier to read.  Additionally stops us from using compatibility code in the sysctl core, hastening the day when the compatibility code can be removed.  Signed-off-by: Eric W. Biederman <ebiederm@xmission.com> Acked-by: Pavel Emelyanov <xemul@parallels.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | nf_conntrack_tftp.c | s | 4.1K | 131 | Stephen Hemminger | shemminger@vyatta.com | 1273755728 |  | netfilter: cleanup printk messages  Make sure all printk messages have a severity level.  Signed-off-by: Stephen Hemminger <shemminger@vyatta.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | nfnetlink_queue.c | s | 24K | 871 | Joe Perches | joe@perches.com | 1337103903 |  | net: Convert net_ratelimit uses to net_<level>_ratelimited  Standardize the net core ratelimited logging functions.  Coalesce formats, align arguments. Change a printk then vprintk sequence to use printf extension %pV.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_ecn.c | s | 4.4K | 148 | Jan Engelhardt | jengelh@medozas.de | 1325015125 |  | netfilter: xtables: collapse conditions in xt_ecn  One simplification of an if clause.  Signed-off-by: Jan Engelhardt <jengelh@medozas.de> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | xt_string.c | s | 2.6K | 82 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_tcpudp.c | s | 5.7K | 208 | Jan Engelhardt | jengelh@medozas.de | 1273595727 |  | netfilter: xtables: change hotdrop pointer to direct modification  Since xt_action_param is writable, let's use it. The pointer to 'bool hotdrop' always worried (8 bytes (64-bit) to write 1 byte!). Surprisingly results in a reduction in size:     text    data     bss filename 5457066  692730  357892 vmlinux.o-prev 5456554  692730  357892 vmlinux.o  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
d | ipvs |  | 29 items |  | Eric Dumazet | edumazet@google.com | 1340618829 |  | netfilter: ipvs: fix dst leak in __ip_vs_addr_is_local_v6  After call to ip6_route_output() we must release dst or we leak it.  Also should test dst->error, as ip6_route_output() never returns NULL.  Use boolean while we are at it.  Signed-off-by: Eric Dumazet <edumazet@google.com> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | core.c | s | 7.1K | 253 | Eric W. Biederman | ebiederm@xmission.com | 1334971350 |  | net: Delete all remaining instances of ctl_path  We don't use struct ctl_path anymore so delete the exported constants.  Signed-off-by: Eric W. Biederman <ebiederm@xmission.com> Acked-by: Pavel Emelyanov <xemul@parallels.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_set.c | s | 11K | 376 | Jozsef Kadlecsik | kadlec@blackhole.kfki.hu | 1337209001 |  | netfilter: ipset: fix timeout value overflow bug  Large timeout parameters could result wrong timeout values due to an overflow at msec to jiffies conversion (reported by Andreas Herz)  [ This patch was mangled by Pablo Neira Ayuso since David Laight and   Eric Dumazet noticed that we were using hardcoded 1000 instead of   MSEC_PER_SEC to calculate the timeout ]  Signed-off-by: Jozsef Kadlecsik <kadlec@blackhole.kfki.hu> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | xt_state.c | s | 2.0K | 67 | Eric Dumazet | eric.dumazet@gmail.com | 1276006192 |  | netfilter: nf_conntrack: IPS_UNTRACKED bit  NOTRACK makes all cpus share a cache line on nf_conntrack_untracked twice per packet. This is bad for performance. __read_mostly annotation is also a bad choice.  This patch introduces IPS_UNTRACKED bit so that we can use later a per_cpu untrack structure more easily.  A new helper, nf_ct_untracked_get() returns a pointer to nf_conntrack_untracked.  Another one, nf_ct_untracked_status_or() is used by nf_nat_init() to add IPS_NAT_DONE_MASK bits to untracked status.  nf_ct_is_untracked() prototype is changed to work on a nf_conn pointer.  Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | nf_conntrack_proto_generic.c | s | 4.1K | 139 | David S. Miller | davem@davemloft.net | 1333320751 |  | nf_conntrack_proto_generic: Stop using NLA_PUT*().  These macros contain a hidden goto, and are thus extremely error prone and make code hard to audit.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | nfnetlink_acct.c | s | 8.6K | 306 | David S. Miller | davem@davemloft.net | 1333320389 |  | nfnetlink_acct: Stop using NLA_PUT*().  These macros contain a hidden goto, and are thus extremely error prone and make code hard to audit.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | nf_conntrack_sip.c | s | 44K | 1402 | Eric Dumazet | eric.dumazet@gmail.com | 1307316910 |  | netfilter: add more values to enum ip_conntrack_info  Following error is raised (and other similar ones) :  net/ipv4/netfilter/nf_nat_standalone.c: In function â€˜nf_nat_fnâ€™: net/ipv4/netfilter/nf_nat_standalone.c:119:2: warning: case value â€˜4â€™ not in enumerated type â€˜enum ip_conntrack_infoâ€™  gcc barfs on adding two enum values and getting a not enumerated result :  case IP_CT_RELATED+IP_CT_IS_REPLY:  Add missing enum values  Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> CC: David Miller <davem@davemloft.net> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_conntrack_amanda.c | s | 5.9K | 208 | Joe Perches | joe@perches.com | 1337103903 |  | net: Convert net_ratelimit uses to net_<level>_ratelimited  Standardize the net core ratelimited logging functions.  Coalesce formats, align arguments. Change a printk then vprintk sequence to use printf extension %pV.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_socket.c | s | 9.5K | 328 | Hans Schillstrom | hans.schillstrom@ericsson.com | 1336560827 |  | netfilter: ip6_tables: add flags parameter to ipv6_find_hdr()  This patch adds the flags parameter to ipv6_find_hdr. This flags allows us to:  * know if this is a fragment. * stop at the AH header, so the information contained in that header   can be used for some specific packet handling.  This patch also adds the offset parameter for inspection of one inner IPv6 header that is contained in error messages.  Signed-off-by: Hans Schillstrom <hans.schillstrom@ericsson.com> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | xt_helper.c | s | 2.4K | 85 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | nf_conntrack_l3proto_generic.c | s | 2.1K | 64 | Jan Engelhardt | jengelh@computergmbh.de | 1208164552 |  | [NETFILTER]: nf_conntrack: use bool type in struct nf_conntrack_l3proto  Signed-off-by: Jan Engelhardt <jengelh@computergmbh.de> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | nf_conntrack_h323_asn1.c | s | 19K | 758 | David Sterba | dsterba@suse.cz | 1301923262 |  | netfilter: h323: bug in parsing of ASN1 SEQOF field  Static analyzer of clang found a dead store which appears to be a bug in reading count of items in SEQOF field, only the lower byte of word is stored. This may lead to corrupted read and communication shutdown.  The bug has been in the module since it's first inclusion into linux kernel.  [Patrick: the bug is real, but without practical consequence since the  largest amount of sequence-of members we parse is 30.]  Signed-off-by: David Sterba <dsterba@suse.cz> Signed-off-by: Patrick McHardy <kaber@trash.net>
f | xt_HMARK.c | s | 9.1K | 311 | Hans Schillstrom | hans@schillstrom.com | 1339073581 |  | netfilter: xt_HMARK: fix endianness and provide consistent hashing  This patch addresses two issues:  a) Fix usage of u32 and __be32 that causes endianess warnings via sparse. b) Ensure consistent hashing in a cluster that is composed of big and    little endian systems. Thus, we obtain the same hash mark in an    heterogeneous cluster.  Reported-by: Dan Carpenter <dan.carpenter@oracle.com> Signed-off-by: Hans Schillstrom <hans@schillstrom.com> Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
f | nf_conntrack_proto_gre.c | s | 11K | 359 | David S. Miller | davem@davemloft.net | 1333320723 |  | nf_conntrack_proto_gre: Stop using NLA_PUT*().  These macros contain a hidden goto, and are thus extremely error prone and make code hard to audit.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | xt_tcpmss.c | s | 2.5K | 92 | Jan Engelhardt | jengelh@medozas.de | 1273595727 |  | netfilter: xtables: change hotdrop pointer to direct modification  Since xt_action_param is writable, let's use it. The pointer to 'bool hotdrop' always worried (8 bytes (64-bit) to write 1 byte!). Surprisingly results in a reduction in size:     text    data     bss filename 5457066  692730  357892 vmlinux.o-prev 5456554  692730  357892 vmlinux.o  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_connmark.c | s | 4.4K | 146 | Jan Engelhardt | jengelh@medozas.de | 1273595617 |  | netfilter: xtables: deconstify struct xt_action_param for matches  In future, layer-3 matches will be an xt module of their own, and need to set the fragoff and thoff fields. Adding more pointers would needlessy increase memory requirements (esp. so for 64-bit, where pointers are wider).  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
f | xt_CONNSECMARK.c | s | 3.6K | 123 | Jan Engelhardt | jengelh@medozas.de | 1273595477 |  | netfilter: xtables: substitute temporary defines by final name  Signed-off-by: Jan Engelhardt <jengelh@medozas.de>
