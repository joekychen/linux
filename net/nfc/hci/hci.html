<!DOCTYPE html>
<html><head><title>joekychen/linux » net › nfc › hci › hci.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>hci.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) 2012  Intel Corporation. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the</span>
<span class="cm"> * Free Software Foundation, Inc.,</span>
<span class="cm"> * 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __LOCAL_HCI_H</span>
<span class="cp">#define __LOCAL_HCI_H</span>

<span class="k">struct</span> <span class="n">gate_pipe_map</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">gate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pipe</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hcp_message</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">header</span><span class="p">;</span>		<span class="cm">/* type -cmd,evt,rsp- + instruction */</span>
	<span class="n">u8</span> <span class="n">data</span><span class="p">[];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">hcp_packet</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">header</span><span class="p">;</span>		<span class="cm">/* cbit+pipe */</span>
	<span class="k">struct</span> <span class="n">hcp_message</span> <span class="n">message</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * HCI command execution completion callback.</span>
<span class="cm"> * result will be one of the HCI response codes.</span>
<span class="cm"> * skb contains the response data and must be disposed.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">hci_cmd_cb_t</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">nfc_hci_dev</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">result</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">cb_data</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">hcp_exec_waiter</span> <span class="p">{</span>
	<span class="n">wait_queue_head_t</span> <span class="o">*</span><span class="n">wq</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">exec_complete</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">exec_result</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">result_skb</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hci_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">msg_l</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">msg_frags</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">wait_response</span><span class="p">;</span>
	<span class="n">hci_cmd_cb_t</span> <span class="n">cb</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">cb_context</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">completion_delay</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hci_create_pipe_params</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">src_gate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dest_host</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dest_gate</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">hci_create_pipe_resp</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">src_host</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">src_gate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dest_host</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dest_gate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pipe</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cp">#define NFC_HCI_FRAGMENT	0x7f</span>

<span class="cp">#define HCP_HEADER(type, instr) ((((type) &amp; 0x03) &lt;&lt; 6) | ((instr) &amp; 0x3f))</span>
<span class="cp">#define HCP_MSG_GET_TYPE(header) ((header &amp; 0xc0) &gt;&gt; 6)</span>
<span class="cp">#define HCP_MSG_GET_CMD(header) (header &amp; 0x3f)</span>

<span class="kt">int</span> <span class="n">nfc_hci_hcp_message_tx</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfc_hci_dev</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pipe</span><span class="p">,</span>
			   <span class="n">u8</span> <span class="n">type</span><span class="p">,</span> <span class="n">u8</span> <span class="n">instruction</span><span class="p">,</span>
			   <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">payload</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">payload_len</span><span class="p">,</span>
			   <span class="n">hci_cmd_cb_t</span> <span class="n">cb</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">cb_data</span><span class="p">,</span>
			   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">completion_delay</span><span class="p">);</span>

<span class="n">u8</span> <span class="n">nfc_hci_pipe2gate</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfc_hci_dev</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pipe</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">nfc_hci_hcp_message_rx</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfc_hci_dev</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pipe</span><span class="p">,</span> <span class="n">u8</span> <span class="n">type</span><span class="p">,</span>
			    <span class="n">u8</span> <span class="n">instruction</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">);</span>

<span class="cm">/* HCP headers */</span>
<span class="cp">#define NFC_HCI_HCP_PACKET_HEADER_LEN	1</span>
<span class="cp">#define NFC_HCI_HCP_MESSAGE_HEADER_LEN	1</span>
<span class="cp">#define NFC_HCI_HCP_HEADER_LEN		2</span>

<span class="cm">/* HCP types */</span>
<span class="cp">#define NFC_HCI_HCP_COMMAND	0x00</span>
<span class="cp">#define NFC_HCI_HCP_EVENT	0x01</span>
<span class="cp">#define NFC_HCI_HCP_RESPONSE	0x02</span>

<span class="cm">/* Generic commands */</span>
<span class="cp">#define NFC_HCI_ANY_SET_PARAMETER	0x01</span>
<span class="cp">#define NFC_HCI_ANY_GET_PARAMETER	0x02</span>
<span class="cp">#define NFC_HCI_ANY_OPEN_PIPE		0x03</span>
<span class="cp">#define NFC_HCI_ANY_CLOSE_PIPE		0x04</span>

<span class="cm">/* Reader RF commands */</span>
<span class="cp">#define NFC_HCI_WR_XCHG_DATA		0x10</span>

<span class="cm">/* Admin commands */</span>
<span class="cp">#define NFC_HCI_ADM_CREATE_PIPE			0x10</span>
<span class="cp">#define NFC_HCI_ADM_DELETE_PIPE			0x11</span>
<span class="cp">#define NFC_HCI_ADM_NOTIFY_PIPE_CREATED		0x12</span>
<span class="cp">#define NFC_HCI_ADM_NOTIFY_PIPE_DELETED		0x13</span>
<span class="cp">#define NFC_HCI_ADM_CLEAR_ALL_PIPE		0x14</span>
<span class="cp">#define NFC_HCI_ADM_NOTIFY_ALL_PIPE_CLEARED	0x15</span>

<span class="cm">/* Generic responses */</span>
<span class="cp">#define NFC_HCI_ANY_OK				0x00</span>
<span class="cp">#define NFC_HCI_ANY_E_NOT_CONNECTED		0x01</span>
<span class="cp">#define NFC_HCI_ANY_E_CMD_PAR_UNKNOWN		0x02</span>
<span class="cp">#define NFC_HCI_ANY_E_NOK			0x03</span>
<span class="cp">#define NFC_HCI_ANY_E_PIPES_FULL		0x04</span>
<span class="cp">#define NFC_HCI_ANY_E_REG_PAR_UNKNOWN		0x05</span>
<span class="cp">#define NFC_HCI_ANY_E_PIPE_NOT_OPENED		0x06</span>
<span class="cp">#define NFC_HCI_ANY_E_CMD_NOT_SUPPORTED		0x07</span>
<span class="cp">#define NFC_HCI_ANY_E_INHIBITED			0x08</span>
<span class="cp">#define NFC_HCI_ANY_E_TIMEOUT			0x09</span>
<span class="cp">#define NFC_HCI_ANY_E_REG_ACCESS_DENIED		0x0a</span>
<span class="cp">#define NFC_HCI_ANY_E_PIPE_ACCESS_DENIED	0x0b</span>

<span class="cm">/* Pipes */</span>
<span class="cp">#define NFC_HCI_INVALID_PIPE	0x80</span>
<span class="cp">#define NFC_HCI_LINK_MGMT_PIPE	0x00</span>
<span class="cp">#define NFC_HCI_ADMIN_PIPE	0x01</span>

<span class="cp">#endif </span><span class="cm">/* __LOCAL_HCI_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
