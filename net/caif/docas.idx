f | caif_usb.c | s | 5.4K | 167 | sjur.brandeland@stericsson.com | sjur.brandeland@stericsson.com | 1326815215 |  | caif: Fix typo in Vendor/Product-ID for CAIF modems  Fix typo for the Vendor/Product Id for ST-Ericsson CAIF modems. Discovery is based on fixed USB vendor 0x04cc (ST-Ericsson), product-id 0x230f (NCM).  Signed-off-by: Sjur Brændeland <sjur.brandeland@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cfrfml.c | s | 6.4K | 230 | Dmitry Tarnyagin | dmitry.tarnyagin@stericsson.com | 1331505496 |  | caif: Fix for a race in socket transmit with flow control.  Kill faulty checks on flow-off leading to connection drop at race conditions. caif_socket checks for flow-on before transmitting and goes to sleep or return -EAGAIN upon flow stop. Remove faulty subsequent checks on flow-off leading to connection drop. Also fix memory leaks on some of the errors paths.  Signed-off-by: Sjur Brændeland <sjur.brandeland@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cfserl.c | s | 4.4K | 166 | sjur.brandeland@stericsson.com | sjur.brandeland@stericsson.com | 1322713848 |  | caif: Remove unused enum and parameter in cfserl  Remove unused enum cfcnfg_phy_type and the parameter to cfserl_create.  Signed-off-by: Sjur Brændeland <sjur.brandeland@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | Makefile | g | 374B |  | sjur.brandeland@stericsson.com | sjur.brandeland@stericsson.com | 1323127676 |  | caif: Add support for CAIF over CDC NCM USB interface  NCM 1.0 does not support anything but Ethernet framing, hence CAIF payload will be put into Ethernet frames.  Discovery is based on fixed USB vendor 0x04cc (ST-Ericsson), product-id 0x230f (NCM). In this variant only CAIF payload is sent over the NCM interface.  The CAIF stack (cfusbl.c) will when USB interface register first check if we got a CDC NCM USB interface with the right VID, PID. It will then read the device's Ethernet address and create a 'template' Ethernet TX header, using a broadcast address as the destination address, and EthType 0x88b5 (802.1 Local Experimental - vendor specific).  A protocol handler for 0x88b5 is setup for reception of CAIF frames from the CDC NCM USB interface.  Signed-off-by: Sjur Brændeland <sjur.brandeland@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | caif_socket.c | s | 26K | 962 | Sjur Brændeland | sjur.brandeland@stericsson.com | 1340665642 |  | caif: Clear shutdown mask to zero at reconnect.  Clear caif sockets's shutdown mask at (re)connect.  Signed-off-by: Sjur Brændeland <sjur.brandeland@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cfsrvl.c | s | 5.5K | 199 | Dmitry Tarnyagin | dmitry.tarnyagin@stericsson.com | 1334331456 |  | caif: set traffic class for caif packets  Set traffic class for CAIF packets, based on socket priority, CAIF protocol type, or type of message.  Traffic class mapping for different packet types:  - control:       TC_PRIO_CONTROL;  - flow control:  TC_PRIO_CONTROL;  - at:            TC_PRIO_CONTROL;  - rfm:           TC_PRIO_INTERACTIVE_BULK;  - other sockets: equals to socket's TC;  - network data:  no change.  Signed-off-by: Dmitry Tarnyagin <dmitry.tarnyagin@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cfpkt_skbuff.c | s | 8.7K | 342 | Dmitry Tarnyagin | dmitry.tarnyagin@stericsson.com | 1334331456 |  | caif: set traffic class for caif packets  Set traffic class for CAIF packets, based on socket priority, CAIF protocol type, or type of message.  Traffic class mapping for different packet types:  - control:       TC_PRIO_CONTROL;  - flow control:  TC_PRIO_CONTROL;  - at:            TC_PRIO_CONTROL;  - rfm:           TC_PRIO_INTERACTIVE_BULK;  - other sockets: equals to socket's TC;  - network data:  no change.  Signed-off-by: Dmitry Tarnyagin <dmitry.tarnyagin@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cfvidl.c | s | 1.8K | 55 | Dmitry Tarnyagin | dmitry.tarnyagin@stericsson.com | 1331505496 |  | caif: Fix for a race in socket transmit with flow control.  Kill faulty checks on flow-off leading to connection drop at race conditions. caif_socket checks for flow-on before transmitting and goes to sleep or return -EAGAIN upon flow stop. Remove faulty subsequent checks on flow-off leading to connection drop. Also fix memory leaks on some of the errors paths.  Signed-off-by: Sjur Brændeland <sjur.brandeland@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | chnl_net.c | s | 13K | 473 | David S. Miller | davem@davemloft.net | 1334331408 |  | Merge git://git.kernel.org/pub/scm/linux/kernel/git/davem/net  Pull in the 'net' tree to get CAIF bug fixes upon which the following set of CAIF feature patches depend.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | caif_dev.c | s | 12K | 468 | Rémi Denis-Courmont | remi.denis-courmont@nokia.com | 1339975778 |  | net: remove my future former mail address  Signed-off-by: Rémi Denis-Courmont <remi@remlab.net> Cc: Sakari Ailus <sakari.ailus@nokia.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cfdgml.c | s | 2.9K | 98 | Dmitry Tarnyagin | dmitry.tarnyagin@stericsson.com | 1331505496 |  | caif: Fix for a race in socket transmit with flow control.  Kill faulty checks on flow-off leading to connection drop at race conditions. caif_socket checks for flow-on before transmitting and goes to sleep or return -EAGAIN upon flow stop. Remove faulty subsequent checks on flow-off leading to connection drop. Also fix memory leaks on some of the errors paths.  Signed-off-by: Sjur Brændeland <sjur.brandeland@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cfctrl.c | s | 15K | 583 | Dmitry Tarnyagin | dmitry.tarnyagin@stericsson.com | 1334331456 |  | caif: set traffic class for caif packets  Set traffic class for CAIF packets, based on socket priority, CAIF protocol type, or type of message.  Traffic class mapping for different packet types:  - control:       TC_PRIO_CONTROL;  - flow control:  TC_PRIO_CONTROL;  - at:            TC_PRIO_CONTROL;  - rfm:           TC_PRIO_INTERACTIVE_BULK;  - other sockets: equals to socket's TC;  - network data:  no change.  Signed-off-by: Dmitry Tarnyagin <dmitry.tarnyagin@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cfcnfg.c | s | 14K | 523 | Eric W. Biederman | ebiederm@xmission.com | 1327716363 |  | net caif: Register properly as a pernet subsystem.  caif is a subsystem and as such it needs to register with register_pernet_subsys instead of register_pernet_device.  Among other problems using register_pernet_device was resulting in net_generic being called before the caif_net structure was allocated. Which has been causing net_generic to fail with either BUG_ON's or by return NULL pointers.  A more ugly problem that could be caused is packets in flight why the subsystem is shutting down.  To remove confusion also remove the cruft cause by inappropriately trying to fix this bug.  With the aid of the previous patch I have tested this patch and confirmed that using register_pernet_subsys makes the failure go away as it should.  Signed-off-by: Eric W. Biederman <ebiederm@xmission.com> Acked-by: Sjur Brændeland <sjur.brandeland@stericsson.com> Tested-by: Sasha Levin <levinsasha928@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cfutill.c | s | 2.8K | 94 | Dmitry Tarnyagin | dmitry.tarnyagin@stericsson.com | 1331505496 |  | caif: Fix for a race in socket transmit with flow control.  Kill faulty checks on flow-off leading to connection drop at race conditions. caif_socket checks for flow-on before transmitting and goes to sleep or return -EAGAIN upon flow stop. Remove faulty subsequent checks on flow-off leading to connection drop. Also fix memory leaks on some of the errors paths.  Signed-off-by: Sjur Brændeland <sjur.brandeland@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cfmuxl.c | s | 6.3K | 221 | sjur.brandeland@stericsson.com | sjur.brandeland@stericsson.com | 1328211312 |  | caif: Bugfix list_del_rcu race in cfmuxl_ctrlcmd.  Always use cfmuxl_remove_uplayer when removing a up-layer. cfmuxl_ctrlcmd() can be called independently and in parallel with cfmuxl_remove_uplayer(). The race between them could cause list_del_rcu to be called on a node which has been already taken out from the list. That lead to a (rare) crash on accessing poisoned node->prev inside list_del_rcu.  This fix ensures that deletion are done holding the same lock.  Reported-by: Dmitry Tarnyagin <dmitry.tarnyagin@stericsson.com> Signed-off-by: Sjur Brændeland <sjur.brandeland@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cfveil.c | s | 2.6K | 89 | Joe Perches | joe@perches.com | 1314566173 |  | caif: Remove OOM messages, use kzalloc  Remove per site OOM messages because they duplicate the generic mm subsystem OOM message.  Use kzalloc instead of kmalloc/memset when next to the OOM message removals.  Reduces object size (allyesconfig ~2%)  $ size -t drivers/net/caif/built-in.o.old net/caif/built-in.o.old    text	   data	    bss	    dec	    hex	filename   32297	    700	   8224	  41221	   a105	drivers/net/caif/built-in.o.old   72159	   1317	  20552	  94028	  16f4c	net/caif/built-in.o.old  104456	   2017	  28776	 135249	  21051	(TOTALS) $ size -t drivers/net/caif/built-in.o.new net/caif/built-in.o.new    text	   data	    bss	    dec	    hex	filename   31975	    700	   8184	  40859	   9f9b	drivers/net/caif/built-in.o.new   70748	   1317	  20152	  92217	  16839	net/caif/built-in.o.new  102723	   2017	  28336	 133076	  207d4	(TOTALS)  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | Kconfig | g | 1.5K |  | Paul Bolle | pebolle@tiscali.nl | 1336395682 |  | Kconfig: replace "--- help ---" with "---help---"  There are three Kconfig entries with "--- help ---" attributes, and over 2000 Kconfig entries with "---help---" attributes.  Apparently the three attributes with embedded spaces are valid. Still, I see little reason for using this obscure variant. And replacing those three attributes with the common variant makes grepping Kconfig files for help texts a bit easier too.  Signed-off-by: Paul Bolle <pebolle@tiscali.nl> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | cffrml.c | s | 4.5K | 171 | Christoph Lameter | cl@linux.com | 1324579220 |  | percpu: Remove irqsafe_cpu_xxx variants  We simply say that regular this_cpu use must be safe regardless of preemption and interrupt state.  That has no material change for x86 and s390 implementations of this_cpu operations.  However, arches that do not provide their own implementation for this_cpu operations will now get code generated that disables interrupts instead of preemption.  -tj: This is part of on-going percpu API cleanup.  For detailed      discussion of the subject, please refer to the following thread.       http://thread.gmane.org/gmane.linux.kernel/1222078  Signed-off-by: Christoph Lameter <cl@linux.com> Signed-off-by: Tejun Heo <tj@kernel.org> LKML-Reference: <alpine.DEB.2.00.1112221154380.11787@router.home>
f | cfdbgl.c | s | 1.5K | 45 | Dmitry Tarnyagin | dmitry.tarnyagin@stericsson.com | 1331505496 |  | caif: Fix for a race in socket transmit with flow control.  Kill faulty checks on flow-off leading to connection drop at race conditions. caif_socket checks for flow-on before transmitting and goes to sleep or return -EAGAIN upon flow stop. Remove faulty subsequent checks on flow-off leading to connection drop. Also fix memory leaks on some of the errors paths.  Signed-off-by: Sjur Brændeland <sjur.brandeland@stericsson.com> Signed-off-by: David S. Miller <davem@davemloft.net>
