f | svcauth_unix.c | s | 21K | 802 | Linus Torvalds | torvalds@linux-foundation.org | 1338564778 |  | Merge branch 'for-3.5' of git://linux-nfs.org/~bfields/linux  Pull the rest of the nfsd commits from Bruce Fields:  "... and then I cherry-picked the remainder of the patches from the   head of my previous branch"  This is the rest of the original nfsd branch, rebased without the delegation stuff that I thought really needed to be redone.  I don't like rebasing things like this in general, but in this situation this was the lesser of two evils.  * 'for-3.5' of git://linux-nfs.org/~bfields/linux: (50 commits)   nfsd4: fix, consolidate client_has_state   nfsd4: don't remove rebooted client record until confirmation   nfsd4: remove some dprintk's and a comment   nfsd4: return "real" sequence id in confirmed case   nfsd4: fix exchange_id to return confirm flag   nfsd4: clarify that renewing expired client is a bug   nfsd4: simpler ordering of setclientid_confirm checks   nfsd4: setclientid: remove pointless assignment   nfsd4: fix error return in non-matching-creds case   nfsd4: fix setclientid_confirm same_cred check   nfsd4: merge 3 setclientid cases to 2   nfsd4: pull out common code from setclientid cases   nfsd4: merge last two setclientid cases   nfsd4: setclientid/confirm comment cleanup   nfsd4: setclientid remove unnecessary terms from a logical expression   nfsd4: move rq_flavor into svc_cred   nfsd4: stricter cred comparison for setclientid/exchange_id   nfsd4: move principal name into svc_cred   nfsd4: allow removing clients not holding state   nfsd4: rearrange exchange_id logic to simplify   ...
f | auth_generic.c | s | 4.9K | 169 | Eric W. Biederman | ebiederm@xmission.com | 1336040841 |  | userns: Convert group_info values from gid_t to kgid_t.  As a first step to converting struct cred to be all kuid_t and kgid_t values convert the group values stored in group_info to always be kgid_t values.   Unless user namespaces are used this change should have no effect.  Acked-by: Serge Hallyn <serge.hallyn@canonical.com> Signed-off-by: Eric W. Biederman <ebiederm@xmission.com>
f | sched.c | s | 26K | 950 | Trond Myklebust | Trond.Myklebust@netapp.com | 1332180902 |  | SUNRPC: We must not use list_for_each_entry_safe() in rpc_wake_up()  The problem is that for the case of priority queues, we have to assume that __rpc_remove_wait_queue_priority will move new elements from the tk_wait.links lists into the queue->tasks[] list. We therefore cannot use list_for_each_entry_safe() on queue->tasks[], since that will skip these new tasks that __rpc_remove_wait_queue_priority is adding.  Without this fix, rpc_wake_up and rpc_wake_up_status will both fail to wake up all functions on priority wait queues, which can result in some nasty hangs.  Reported-by: Andy Adamson <andros@netapp.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com> Cc: stable@vger.kernel.org
f | Makefile | g | 551B |  | Trond Myklebust | Trond.Myklebust@netapp.com | 1310735543 |  | SUNRPC: sunrpc should not explicitly depend on NFS config options  Change explicit references to CONFIG_NFS_V4_1 to implicit ones Get rid of the unnecessary defines in backchannel_rqst.c and bc_svc.c: the Makefile takes care of those dependency.  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
d | xprtrdma |  | 10 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1333058005 |  | Merge branch 'for-3.4' of git://linux-nfs.org/~bfields/linux  Pull nfsd changes from Bruce Fields:  Highlights:  - Benny Halevy and Tigran Mkrtchyan implemented some more 4.1 features,    moving us closer to a complete 4.1 implementation.  - Bernd Schubert fixed a long-standing problem with readdir cookies on    ext2/3/4.  - Jeff Layton performed a long-overdue overhaul of the server reboot    recovery code which will allow us to deprecate the current code (a    rather unusual user of the vfs), and give us some needed flexibility    for further improvements.  - Like the client, we now support numeric uid's and gid's in the    auth_sys case, allowing easier upgrades from NFSv2/v3 to v4.x.  Plus miscellaneous bugfixes and cleanup.  Thanks to everyone!  There are also some delegation fixes waiting on vfs review that I suppose will have to wait for 3.5.  With that done I think we'll finally turn off the "EXPERIMENTAL" dependency for v4 (though that's mostly symbolic as it's been on by default in distro's for a while).  And the list of 4.1 todo's should be achievable for 3.5 as well:     http://wiki.linux-nfs.org/wiki/index.php/Server_4.0_and_4.1_issues  though we may still want a bit more experience with it before turning it on by default.  * 'for-3.4' of git://linux-nfs.org/~bfields/linux: (55 commits)   nfsd: only register cld pipe notifier when CONFIG_NFSD_V4 is enabled   nfsd4: use auth_unix unconditionally on backchannel   nfsd: fix NULL pointer dereference in cld_pipe_downcall   nfsd4: memory corruption in numeric_name_to_id()   sunrpc: skip portmap calls on sessions backchannel   nfsd4: allow numeric idmapping   nfsd: don't allow legacy client tracker init for anything but init_net   nfsd: add notifier to handle mount/unmount of rpc_pipefs sb   nfsd: add the infrastructure to handle the cld upcall   nfsd: add a header describing upcall to nfsdcld   nfsd: add a per-net-namespace struct for nfsd   sunrpc: create nfsd dir in rpc_pipefs   nfsd: add nfsd4_client_tracking_ops struct and a way to set it   nfsd: convert nfs4_client->cl_cb_flags to a generic flags field   NFSD: Fix nfs4_verifier memory alignment   NFSD: Fix warnings when NFSD_DEBUG is not defined   nfsd: vfs_llseek() with 32 or 64 bit offsets (hashes)   nfsd: rename 'int access' to 'int may_flags' in nfsd_open()   ext4: return 32/64-bit dir name hash according to usage type   fs: add new FMODE flags: FMODE_32bithash and FMODE_64bithash   ...
f | clnt.c | s | 53K | 1992 | Linus Torvalds | torvalds@linux-foundation.org | 1338313431 |  | 
f | addr.c | s | 8.8K | 303 | Stanislav Kinsbursky | skinsbursky@parallels.com | 1328056092 |  | SUNRPC: parametrize rpc_uaddr2sockaddr() by network context  Parametrize rpc_uaddr2sockaddr() by network context and thus force it's callers to pass in network context instead of using hard-coded "init_net".  Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | sunrpc_syms.c | s | 2.4K | 108 | Stanislav Kinsbursky | skinsbursky@parallels.com | 1334761548 |  | SUNRPC: register PipeFS file system after pernet sybsystem  PipeFS superblock creation routine relays on SUNRPC pernet data presense, which is created on register_pernet_subsys() call in SUNRPC module init function. Registering of PipeFS filesystem prior to registering of per-net subsystem leads to races (mount of PipeFS can dereference uninitialized data).  Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | rpc_pipe.c | s | 28K | 1085 | Jeff Layton | jlayton@redhat.com | 1339450027 |  | rpc_pipefs: allow rpc_purge_list to take a NULL waitq pointer  In the event that we don't have a dentry for a rpc_pipefs pipe, we still need to allow the queue_timeout job to clean out the queue. There's just no waitq to wake up in that event.  Cc: stable@kernel.org Reported-by: Hans de Bruin <jmdebruin@xmsnet.nl> Reported-by: Joerg Platte <jplatte@naasa.net> Signed-off-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
d | auth_gss |  | 12 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1338564778 |  | Merge branch 'for-3.5' of git://linux-nfs.org/~bfields/linux  Pull the rest of the nfsd commits from Bruce Fields:  "... and then I cherry-picked the remainder of the patches from the   head of my previous branch"  This is the rest of the original nfsd branch, rebased without the delegation stuff that I thought really needed to be redone.  I don't like rebasing things like this in general, but in this situation this was the lesser of two evils.  * 'for-3.5' of git://linux-nfs.org/~bfields/linux: (50 commits)   nfsd4: fix, consolidate client_has_state   nfsd4: don't remove rebooted client record until confirmation   nfsd4: remove some dprintk's and a comment   nfsd4: return "real" sequence id in confirmed case   nfsd4: fix exchange_id to return confirm flag   nfsd4: clarify that renewing expired client is a bug   nfsd4: simpler ordering of setclientid_confirm checks   nfsd4: setclientid: remove pointless assignment   nfsd4: fix error return in non-matching-creds case   nfsd4: fix setclientid_confirm same_cred check   nfsd4: merge 3 setclientid cases to 2   nfsd4: pull out common code from setclientid cases   nfsd4: merge last two setclientid cases   nfsd4: setclientid/confirm comment cleanup   nfsd4: setclientid remove unnecessary terms from a logical expression   nfsd4: move rq_flavor into svc_cred   nfsd4: stricter cred comparison for setclientid/exchange_id   nfsd4: move principal name into svc_cred   nfsd4: allow removing clients not holding state   nfsd4: rearrange exchange_id logic to simplify   ...
f | svcsock.c | s | 42K | 1453 | Joe Perches | joe@perches.com | 1337103903 |  | net: Convert net_ratelimit uses to net_<level>_ratelimited  Standardize the net core ratelimited logging functions.  Coalesce formats, align arguments. Change a printk then vprintk sequence to use printf extension %pV.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | backchannel_rqst.c | s | 8.8K | 245 | Trond Myklebust | Trond.Myklebust@netapp.com | 1331508602 |  | SUNRPC: Fix a few sparse warnings  net/sunrpc/svcsock.c:412:22: warning: incorrect type in assignment (different address spaces)  - svc_partial_recvfrom now takes a struct kvec, so the variable    save_iovbase needs to be an ordinary (void *)  Make a bunch of variables in net/sunrpc/xprtsock.c static  Fix a couple of "warning: symbol 'foo' was not declared. Should it be static?" reports.  Fix a couple of conflicting function declarations.  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | rpcb_clnt.c | s | 29K | 978 | Linus Torvalds | torvalds@linux-foundation.org | 1338564778 |  | Merge branch 'for-3.5' of git://linux-nfs.org/~bfields/linux  Pull the rest of the nfsd commits from Bruce Fields:  "... and then I cherry-picked the remainder of the patches from the   head of my previous branch"  This is the rest of the original nfsd branch, rebased without the delegation stuff that I thought really needed to be redone.  I don't like rebasing things like this in general, but in this situation this was the lesser of two evils.  * 'for-3.5' of git://linux-nfs.org/~bfields/linux: (50 commits)   nfsd4: fix, consolidate client_has_state   nfsd4: don't remove rebooted client record until confirmation   nfsd4: remove some dprintk's and a comment   nfsd4: return "real" sequence id in confirmed case   nfsd4: fix exchange_id to return confirm flag   nfsd4: clarify that renewing expired client is a bug   nfsd4: simpler ordering of setclientid_confirm checks   nfsd4: setclientid: remove pointless assignment   nfsd4: fix error return in non-matching-creds case   nfsd4: fix setclientid_confirm same_cred check   nfsd4: merge 3 setclientid cases to 2   nfsd4: pull out common code from setclientid cases   nfsd4: merge last two setclientid cases   nfsd4: setclientid/confirm comment cleanup   nfsd4: setclientid remove unnecessary terms from a logical expression   nfsd4: move rq_flavor into svc_cred   nfsd4: stricter cred comparison for setclientid/exchange_id   nfsd4: move principal name into svc_cred   nfsd4: allow removing clients not holding state   nfsd4: rearrange exchange_id logic to simplify   ...
f | socklib.c | s | 4.5K | 172 | Cong Wang | amwang@redhat.com | 1332251308 |  | sunrpc: remove the second argument of k[un]map_atomic()  Signed-off-by: Cong Wang <amwang@redhat.com>
f | bc_svc.c | s | 2.0K | 50 | Trond Myklebust | Trond.Myklebust@netapp.com | 1310735543 |  | SUNRPC: sunrpc should not explicitly depend on NFS config options  Change explicit references to CONFIG_NFS_V4_1 to implicit ones Get rid of the unnecessary defines in backchannel_rqst.c and bc_svc.c: the Makefile takes care of those dependency.  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | auth_null.c | s | 2.5K | 123 | Trond Myklebust | Trond.Myklebust@netapp.com | 1280926449 |  | SUNRPC: Move the bound cred to struct rpc_rqst  This will allow us to save the original generic cred in rpc_message, so that if we migrate from one server to another, we can generate a new bound cred without having to punt back to the NFS layer.  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | svc.c | s | 32K | 1192 | Linus Torvalds | torvalds@linux-foundation.org | 1339807043 |  | 
f | auth_unix.c | s | 5.7K | 214 | Eric W. Biederman | ebiederm@xmission.com | 1336040841 |  | userns: Convert group_info values from gid_t to kgid_t.  As a first step to converting struct cred to be all kuid_t and kgid_t values convert the group values stored in group_info to always be kgid_t values.   Unless user namespaces are used this change should have no effect.  Acked-by: Serge Hallyn <serge.hallyn@canonical.com> Signed-off-by: Eric W. Biederman <ebiederm@xmission.com>
f | sysctl.c | s | 3.6K | 161 | Stanislav Kinsbursky | skinsbursky@parallels.com | 1328052025 |  | SUNRPC: make SUNPRC clients list per network namespace context  This patch moves static SUNRPC clients list and it's lock to sunrpc_net structure. Currently this list is used only for debug purposes. But later it will be used also for selecting clients by networks namespace on PipeFS mount/umount events. Per-network namespace lists will make this faster and simplier.  Note: client list is taken from "init_net" network namespace context in rpc_show_tasks(). This will be changed some day later with making SUNRPC sysctl's per network namespace context.  Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | svcauth.c | s | 3.7K | 139 | Shan Wei | shanwei@cn.fujitsu.com | 1292618901 |  | net: sunrpc: kill unused macros  These macros never be used for several years.  Signed-off-by: Shan Wei <shanwei@cn.fujitsu.com> Signed-off-by: J. Bruce Fields <bfields@redhat.com>
f | xprt.c | s | 33K | 1155 | Linus Torvalds | torvalds@linux-foundation.org | 1338313431 |  | 
f | xprtsock.c | s | 77K | 2605 | J. Bruce Fields | bfields@redhat.com | 1332776988 |  | sunrpc: skip portmap calls on sessions backchannel  There's obviously no point to doing portmap calls over the sessions backchannel.  Signed-off-by: J. Bruce Fields <bfields@redhat.com>
f | stats.c | s | 6.9K | 241 | Trond Myklebust | Trond.Myklebust@netapp.com | 1330720598 |  | SUNRPC: Use RCU to dereference the rpc_clnt.cl_xprt field  A migration event will replace the rpc_xprt used by an rpc_clnt.  To ensure this can be done safely, all references to cl_xprt must now use a form of rcu_dereference().  Special care is taken with rpc_peeraddr2str(), which returns a pointer to memory whose lifetime is the same as the rpc_xprt.  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com> [ cel: fix lockdep splats and layering violations ] [ cel: forward ported to 3.4 ] [ cel: remove rpc_max_reqs(), add rpc_net_ns() ] Signed-off-by: Chuck Lever <chuck.lever@oracle.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | timer.c | s | 2.9K | 103 | Eric Dumazet | eric.dumazet@gmail.com | 1334508280 |  | net: cleanup unsigned to unsigned int  Use of "unsigned int" is preferred to bare "unsigned" in net tree.  Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | Kconfig | g | 1.5K |  | Trond Myklebust | Trond.Myklebust@netapp.com | 1332263306 |  | SUNRPC/NFS: Add Kbuild dependencies for NFS_DEBUG/RPC_DEBUG  This allows us to turn on/off the dprintk() debugging interfaces for those distributions that don't ship the 'rpcdebug' utility. It also allows us to add Kbuild dependencies. Specifically, we already know that dprintk() in general relies on CONFIG_SYSCTL. Now it turns out that the NFS dprintks depend on CONFIG_CRC32 after we added support for the filehandle hash.  Reported-by: Paul Gortmaker <paul.gortmaker@windriver.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | cache.c | s | 43K | 1572 | Eric Dumazet | eric.dumazet@gmail.com | 1334508280 |  | net: cleanup unsigned to unsigned int  Use of "unsigned int" is preferred to bare "unsigned" in net tree.  Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | xdr.c | s | 30K | 1135 | Eric Dumazet | eric.dumazet@gmail.com | 1334508280 |  | net: cleanup unsigned to unsigned int  Use of "unsigned int" is preferred to bare "unsigned" in net tree.  Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | sunrpc.h | s | 1.8K | 41 | Stanislav Kinsbursky | skinsbursky@parallels.com | 1328052025 |  | SUNRPC: subscribe RPC clients to pipefs notifications  This patch subscribes RPC clients to RPC pipefs notifications. RPC clients notifier block is registering with pipefs initialization during SUNRPC module init. This notifier callback is responsible for RPC client PipeFS directory and GSS pipes creation. For pipes creation and destruction two additional callbacks were added to struct rpc_authops. Note that no locking required in notifier callback because PipeFS superblock pointer is passed as an argument from it's creation or destruction routine and thus we can be sure about it's validity.  Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | svc_xprt.c | s | 33K | 1120 | Linus Torvalds | torvalds@linux-foundation.org | 1338564778 |  | Merge branch 'for-3.5' of git://linux-nfs.org/~bfields/linux  Pull the rest of the nfsd commits from Bruce Fields:  "... and then I cherry-picked the remainder of the patches from the   head of my previous branch"  This is the rest of the original nfsd branch, rebased without the delegation stuff that I thought really needed to be redone.  I don't like rebasing things like this in general, but in this situation this was the lesser of two evils.  * 'for-3.5' of git://linux-nfs.org/~bfields/linux: (50 commits)   nfsd4: fix, consolidate client_has_state   nfsd4: don't remove rebooted client record until confirmation   nfsd4: remove some dprintk's and a comment   nfsd4: return "real" sequence id in confirmed case   nfsd4: fix exchange_id to return confirm flag   nfsd4: clarify that renewing expired client is a bug   nfsd4: simpler ordering of setclientid_confirm checks   nfsd4: setclientid: remove pointless assignment   nfsd4: fix error return in non-matching-creds case   nfsd4: fix setclientid_confirm same_cred check   nfsd4: merge 3 setclientid cases to 2   nfsd4: pull out common code from setclientid cases   nfsd4: merge last two setclientid cases   nfsd4: setclientid/confirm comment cleanup   nfsd4: setclientid remove unnecessary terms from a logical expression   nfsd4: move rq_flavor into svc_cred   nfsd4: stricter cred comparison for setclientid/exchange_id   nfsd4: move principal name into svc_cred   nfsd4: allow removing clients not holding state   nfsd4: rearrange exchange_id logic to simplify   ...
f | netns.h | s | 707B | 24 | Stanislav Kinsbursky | skinsbursky@parallels.com | 1328056095 |  | SUNRPC: create GSS auth cache per network namespace  This patch makes GSS auth cache details allocated and registered per network namespace context. Thus with this patch rsi_cache and rsc_cache contents for network namespace "X" are controlled from proc file system mount for the same network namespace "X".  Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com> Acked-by: J. Bruce Fields <bfields@redhat.com>
f | auth.c | s | 15K | 599 | Joe Perches | joe@perches.com | 1307309619 |  | net: Remove unnecessary semicolons  Semicolons are not necessary after switch/while/for/if braces so remove them.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
