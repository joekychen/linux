<!DOCTYPE html>
<html><head><title>joekychen/linux » scripts › kconfig › gconf.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>gconf.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* Hey EMACS -*- linux-c -*- */</span>
<span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2002-2003 Romain Lievin &lt;roms@tilp.info&gt;</span>
<span class="cm"> * Released under the terms of the GNU GPL v2.0.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifdef HAVE_CONFIG_H</span>
<span class="cp">#  include &lt;config.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#include &quot;lkc.h&quot;</span>
<span class="cp">#include &quot;images.c&quot;</span>

<span class="cp">#include &lt;glade/glade.h&gt;</span>
<span class="cp">#include &lt;gtk/gtk.h&gt;</span>
<span class="cp">#include &lt;glib.h&gt;</span>
<span class="cp">#include &lt;gdk/gdkkeysyms.h&gt;</span>

<span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>
<span class="cp">#include &lt;unistd.h&gt;</span>
<span class="cp">#include &lt;time.h&gt;</span>
<span class="cp">#include &lt;stdlib.h&gt;</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><h1>define DEBUG</h1></td><td class="code"><div class="highlight"><pre><span class="k">enum</span> <span class="p">{</span>
	<span class="n">SINGLE_VIEW</span><span class="p">,</span> <span class="n">SPLIT_VIEW</span><span class="p">,</span> <span class="n">FULL_VIEW</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">OPT_NORMAL</span><span class="p">,</span> <span class="n">OPT_ALL</span><span class="p">,</span> <span class="n">OPT_PROMPT</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">gint</span> <span class="n">view_mode</span> <span class="o">=</span> <span class="n">FULL_VIEW</span><span class="p">;</span>
<span class="k">static</span> <span class="n">gboolean</span> <span class="n">show_name</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="k">static</span> <span class="n">gboolean</span> <span class="n">show_range</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="k">static</span> <span class="n">gboolean</span> <span class="n">show_value</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="k">static</span> <span class="n">gboolean</span> <span class="n">resizeable</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">opt_mode</span> <span class="o">=</span> <span class="n">OPT_NORMAL</span><span class="p">;</span>

<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">main_wnd</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">tree1_w</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>	<span class="c1">// left  frame</span>
<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">tree2_w</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>	<span class="c1">// right frame</span>
<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">text_w</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">hpaned</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">vpaned</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">back_btn</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">save_btn</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">save_menu_item</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

<span class="n">GtkTextTag</span> <span class="o">*</span><span class="n">tag1</span><span class="p">,</span> <span class="o">*</span><span class="n">tag2</span><span class="p">;</span>
<span class="n">GdkColor</span> <span class="n">color</span><span class="p">;</span>

<span class="n">GtkTreeStore</span> <span class="o">*</span><span class="n">tree1</span><span class="p">,</span> <span class="o">*</span><span class="n">tree2</span><span class="p">,</span> <span class="o">*</span><span class="n">tree</span><span class="p">;</span>
<span class="n">GtkTreeModel</span> <span class="o">*</span><span class="n">model1</span><span class="p">,</span> <span class="o">*</span><span class="n">model2</span><span class="p">;</span>
<span class="k">static</span> <span class="n">GtkTreeIter</span> <span class="o">*</span><span class="n">parents</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<span class="k">static</span> <span class="n">gint</span> <span class="n">indent</span><span class="p">;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">current</span><span class="p">;</span> <span class="c1">// current node for SINGLE view</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">browsed</span><span class="p">;</span> <span class="c1">// browsed node for SPLIT view</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">COL_OPTION</span><span class="p">,</span> <span class="n">COL_NAME</span><span class="p">,</span> <span class="n">COL_NO</span><span class="p">,</span> <span class="n">COL_MOD</span><span class="p">,</span> <span class="n">COL_YES</span><span class="p">,</span> <span class="n">COL_VALUE</span><span class="p">,</span>
	<span class="n">COL_MENU</span><span class="p">,</span> <span class="n">COL_COLOR</span><span class="p">,</span> <span class="n">COL_EDIT</span><span class="p">,</span> <span class="n">COL_PIXBUF</span><span class="p">,</span>
	<span class="n">COL_PIXVIS</span><span class="p">,</span> <span class="n">COL_BTNVIS</span><span class="p">,</span> <span class="n">COL_BTNACT</span><span class="p">,</span> <span class="n">COL_BTNINC</span><span class="p">,</span> <span class="n">COL_BTNRAD</span><span class="p">,</span>
	<span class="n">COL_NUMBER</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">display_list</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">display_tree</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">display_tree_part</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">update_tree</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="n">GtkTreeIter</span> <span class="o">*</span> <span class="n">dst</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">set_node</span><span class="p">(</span><span class="n">GtkTreeIter</span> <span class="o">*</span> <span class="n">node</span><span class="p">,</span> <span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">,</span> <span class="n">gchar</span> <span class="o">**</span> <span class="n">row</span><span class="p">);</span>
<span class="k">static</span> <span class="n">gchar</span> <span class="o">**</span><span class="n">fill_row</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">conf_changed</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/* Helping/Debugging Functions */</span>

<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">dbg_sym_flags</span><span class="p">(</span><span class="kt">int</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>

	<span class="n">bzero</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SYMBOL_CONST</span><span class="p">)</span>
		<span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;const/&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SYMBOL_CHECK</span><span class="p">)</span>
		<span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;check/&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SYMBOL_CHOICE</span><span class="p">)</span>
		<span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;choice/&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SYMBOL_CHOICEVAL</span><span class="p">)</span>
		<span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;choiceval/&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SYMBOL_VALID</span><span class="p">)</span>
		<span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;valid/&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SYMBOL_OPTIONAL</span><span class="p">)</span>
		<span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;optional/&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SYMBOL_WRITE</span><span class="p">)</span>
		<span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;write/&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SYMBOL_CHANGED</span><span class="p">)</span>
		<span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;changed/&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">SYMBOL_AUTO</span><span class="p">)</span>
		<span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;auto/&quot;</span><span class="p">);</span>

	<span class="n">buf</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">replace_button_icon</span><span class="p">(</span><span class="n">GladeXML</span> <span class="o">*</span> <span class="n">xml</span><span class="p">,</span> <span class="n">GdkDrawable</span> <span class="o">*</span> <span class="n">window</span><span class="p">,</span>
			 <span class="n">GtkStyle</span> <span class="o">*</span> <span class="n">style</span><span class="p">,</span> <span class="n">gchar</span> <span class="o">*</span> <span class="n">btn_name</span><span class="p">,</span> <span class="n">gchar</span> <span class="o">**</span> <span class="n">xpm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GdkPixmap</span> <span class="o">*</span><span class="n">pixmap</span><span class="p">;</span>
	<span class="n">GdkBitmap</span> <span class="o">*</span><span class="n">mask</span><span class="p">;</span>
	<span class="n">GtkToolButton</span> <span class="o">*</span><span class="n">button</span><span class="p">;</span>
	<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">image</span><span class="p">;</span>

	<span class="n">pixmap</span> <span class="o">=</span> <span class="n">gdk_pixmap_create_from_xpm_d</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mask</span><span class="p">,</span>
					      <span class="o">&amp;</span><span class="n">style</span><span class="o">-&gt;</span><span class="n">bg</span><span class="p">[</span><span class="n">GTK_STATE_NORMAL</span><span class="p">],</span>
					      <span class="n">xpm</span><span class="p">);</span>

	<span class="n">button</span> <span class="o">=</span> <span class="n">GTK_TOOL_BUTTON</span><span class="p">(</span><span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="n">btn_name</span><span class="p">));</span>
	<span class="n">image</span> <span class="o">=</span> <span class="n">gtk_image_new_from_pixmap</span><span class="p">(</span><span class="n">pixmap</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
	<span class="n">gtk_widget_show</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
	<span class="n">gtk_tool_button_set_icon_widget</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Main Window Initialization */</span>
<span class="kt">void</span> <span class="nf">init_main_window</span><span class="p">(</span><span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span> <span class="n">glade_file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GladeXML</span> <span class="o">*</span><span class="n">xml</span><span class="p">;</span>
	<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">widget</span><span class="p">;</span>
	<span class="n">GtkTextBuffer</span> <span class="o">*</span><span class="n">txtbuf</span><span class="p">;</span>
	<span class="n">GtkStyle</span> <span class="o">*</span><span class="n">style</span><span class="p">;</span>

	<span class="n">xml</span> <span class="o">=</span> <span class="n">glade_xml_new</span><span class="p">(</span><span class="n">glade_file</span><span class="p">,</span> <span class="s">&quot;window1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">xml</span><span class="p">)</span>
		<span class="n">g_error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;GUI loading failed !</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
	<span class="n">glade_xml_signal_autoconnect</span><span class="p">(</span><span class="n">xml</span><span class="p">);</span>

	<span class="n">main_wnd</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;window1&quot;</span><span class="p">);</span>
	<span class="n">hpaned</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;hpaned1&quot;</span><span class="p">);</span>
	<span class="n">vpaned</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;vpaned1&quot;</span><span class="p">);</span>
	<span class="n">tree1_w</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;treeview1&quot;</span><span class="p">);</span>
	<span class="n">tree2_w</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;treeview2&quot;</span><span class="p">);</span>
	<span class="n">text_w</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;textview3&quot;</span><span class="p">);</span>

	<span class="n">back_btn</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;button1&quot;</span><span class="p">);</span>
	<span class="n">gtk_widget_set_sensitive</span><span class="p">(</span><span class="n">back_btn</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>

	<span class="n">widget</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;show_name1&quot;</span><span class="p">);</span>
	<span class="n">gtk_check_menu_item_set_active</span><span class="p">((</span><span class="n">GtkCheckMenuItem</span> <span class="o">*</span><span class="p">)</span> <span class="n">widget</span><span class="p">,</span>
				       <span class="n">show_name</span><span class="p">);</span>

	<span class="n">widget</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;show_range1&quot;</span><span class="p">);</span>
	<span class="n">gtk_check_menu_item_set_active</span><span class="p">((</span><span class="n">GtkCheckMenuItem</span> <span class="o">*</span><span class="p">)</span> <span class="n">widget</span><span class="p">,</span>
				       <span class="n">show_range</span><span class="p">);</span>

	<span class="n">widget</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;show_data1&quot;</span><span class="p">);</span>
	<span class="n">gtk_check_menu_item_set_active</span><span class="p">((</span><span class="n">GtkCheckMenuItem</span> <span class="o">*</span><span class="p">)</span> <span class="n">widget</span><span class="p">,</span>
				       <span class="n">show_value</span><span class="p">);</span>

	<span class="n">save_btn</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;button3&quot;</span><span class="p">);</span>
	<span class="n">save_menu_item</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;save1&quot;</span><span class="p">);</span>
	<span class="n">conf_set_changed_callback</span><span class="p">(</span><span class="n">conf_changed</span><span class="p">);</span>

	<span class="n">style</span> <span class="o">=</span> <span class="n">gtk_widget_get_style</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">);</span>
	<span class="n">widget</span> <span class="o">=</span> <span class="n">glade_xml_get_widget</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="s">&quot;toolbar1&quot;</span><span class="p">);</span>

<span class="cp">#if 0</span><span class="c">	/* Use stock Gtk icons instead */</span>
<span class="c">	replace_button_icon(xml, main_wnd-&gt;window, style,</span>
<span class="c">			    &quot;button1&quot;, (gchar **) xpm_back);</span>
<span class="c">	replace_button_icon(xml, main_wnd-&gt;window, style,</span>
<span class="c">			    &quot;button2&quot;, (gchar **) xpm_load);</span>
<span class="c">	replace_button_icon(xml, main_wnd-&gt;window, style,</span>
<span class="c">			    &quot;button3&quot;, (gchar **) xpm_save);</span>
<span class="cp">#endif</span>
	<span class="n">replace_button_icon</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="n">main_wnd</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span>
			    <span class="s">&quot;button4&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">gchar</span> <span class="o">**</span><span class="p">)</span> <span class="n">xpm_single_view</span><span class="p">);</span>
	<span class="n">replace_button_icon</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="n">main_wnd</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span>
			    <span class="s">&quot;button5&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">gchar</span> <span class="o">**</span><span class="p">)</span> <span class="n">xpm_split_view</span><span class="p">);</span>
	<span class="n">replace_button_icon</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="n">main_wnd</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span>
			    <span class="s">&quot;button6&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">gchar</span> <span class="o">**</span><span class="p">)</span> <span class="n">xpm_tree_view</span><span class="p">);</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	switch (view_mode) {</span>
<span class="c">	case SINGLE_VIEW:</span>
<span class="c">		widget = glade_xml_get_widget(xml, &quot;button4&quot;);</span>
<span class="c">		g_signal_emit_by_name(widget, &quot;clicked&quot;);</span>
<span class="c">		break;</span>
<span class="c">	case SPLIT_VIEW:</span>
<span class="c">		widget = glade_xml_get_widget(xml, &quot;button5&quot;);</span>
<span class="c">		g_signal_emit_by_name(widget, &quot;clicked&quot;);</span>
<span class="c">		break;</span>
<span class="c">	case FULL_VIEW:</span>
<span class="c">		widget = glade_xml_get_widget(xml, &quot;button6&quot;);</span>
<span class="c">		g_signal_emit_by_name(widget, &quot;clicked&quot;);</span>
<span class="c">		break;</span>
<span class="c">	}</span>
<span class="cp">#endif</span>
	<span class="n">txtbuf</span> <span class="o">=</span> <span class="n">gtk_text_view_get_buffer</span><span class="p">(</span><span class="n">GTK_TEXT_VIEW</span><span class="p">(</span><span class="n">text_w</span><span class="p">));</span>
	<span class="n">tag1</span> <span class="o">=</span> <span class="n">gtk_text_buffer_create_tag</span><span class="p">(</span><span class="n">txtbuf</span><span class="p">,</span> <span class="s">&quot;mytag1&quot;</span><span class="p">,</span>
					  <span class="s">&quot;foreground&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">,</span>
					  <span class="s">&quot;weight&quot;</span><span class="p">,</span> <span class="n">PANGO_WEIGHT_BOLD</span><span class="p">,</span>
					  <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">tag2</span> <span class="o">=</span> <span class="n">gtk_text_buffer_create_tag</span><span class="p">(</span><span class="n">txtbuf</span><span class="p">,</span> <span class="s">&quot;mytag2&quot;</span><span class="p">,</span>
					  <span class="cm">/*&quot;style&quot;, PANGO_STYLE_OBLIQUE, */</span>
					  <span class="nb">NULL</span><span class="p">);</span>

	<span class="n">gtk_window_set_title</span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">),</span> <span class="n">rootmenu</span><span class="p">.</span><span class="n">prompt</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">);</span>

	<span class="n">gtk_widget_show</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">init_tree_model</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gint</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">tree</span> <span class="o">=</span> <span class="n">tree2</span> <span class="o">=</span> <span class="n">gtk_tree_store_new</span><span class="p">(</span><span class="n">COL_NUMBER</span><span class="p">,</span>
					  <span class="n">G_TYPE_STRING</span><span class="p">,</span> <span class="n">G_TYPE_STRING</span><span class="p">,</span>
					  <span class="n">G_TYPE_STRING</span><span class="p">,</span> <span class="n">G_TYPE_STRING</span><span class="p">,</span>
					  <span class="n">G_TYPE_STRING</span><span class="p">,</span> <span class="n">G_TYPE_STRING</span><span class="p">,</span>
					  <span class="n">G_TYPE_POINTER</span><span class="p">,</span> <span class="n">GDK_TYPE_COLOR</span><span class="p">,</span>
					  <span class="n">G_TYPE_BOOLEAN</span><span class="p">,</span> <span class="n">GDK_TYPE_PIXBUF</span><span class="p">,</span>
					  <span class="n">G_TYPE_BOOLEAN</span><span class="p">,</span> <span class="n">G_TYPE_BOOLEAN</span><span class="p">,</span>
					  <span class="n">G_TYPE_BOOLEAN</span><span class="p">,</span> <span class="n">G_TYPE_BOOLEAN</span><span class="p">,</span>
					  <span class="n">G_TYPE_BOOLEAN</span><span class="p">);</span>
	<span class="n">model2</span> <span class="o">=</span> <span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">tree2</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">parents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">GtkTreeIter</span> <span class="o">*</span><span class="p">)</span> <span class="n">g_malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">GtkTreeIter</span><span class="p">));</span>

	<span class="n">tree1</span> <span class="o">=</span> <span class="n">gtk_tree_store_new</span><span class="p">(</span><span class="n">COL_NUMBER</span><span class="p">,</span>
				   <span class="n">G_TYPE_STRING</span><span class="p">,</span> <span class="n">G_TYPE_STRING</span><span class="p">,</span>
				   <span class="n">G_TYPE_STRING</span><span class="p">,</span> <span class="n">G_TYPE_STRING</span><span class="p">,</span>
				   <span class="n">G_TYPE_STRING</span><span class="p">,</span> <span class="n">G_TYPE_STRING</span><span class="p">,</span>
				   <span class="n">G_TYPE_POINTER</span><span class="p">,</span> <span class="n">GDK_TYPE_COLOR</span><span class="p">,</span>
				   <span class="n">G_TYPE_BOOLEAN</span><span class="p">,</span> <span class="n">GDK_TYPE_PIXBUF</span><span class="p">,</span>
				   <span class="n">G_TYPE_BOOLEAN</span><span class="p">,</span> <span class="n">G_TYPE_BOOLEAN</span><span class="p">,</span>
				   <span class="n">G_TYPE_BOOLEAN</span><span class="p">,</span> <span class="n">G_TYPE_BOOLEAN</span><span class="p">,</span>
				   <span class="n">G_TYPE_BOOLEAN</span><span class="p">);</span>
	<span class="n">model1</span> <span class="o">=</span> <span class="n">GTK_TREE_MODEL</span><span class="p">(</span><span class="n">tree1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">init_left_tree</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreeView</span> <span class="o">*</span><span class="n">view</span> <span class="o">=</span> <span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree1_w</span><span class="p">);</span>
	<span class="n">GtkCellRenderer</span> <span class="o">*</span><span class="n">renderer</span><span class="p">;</span>
	<span class="n">GtkTreeSelection</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="n">GtkTreeViewColumn</span> <span class="o">*</span><span class="n">column</span><span class="p">;</span>

	<span class="n">gtk_tree_view_set_model</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">model1</span><span class="p">);</span>
	<span class="n">gtk_tree_view_set_headers_visible</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
	<span class="n">gtk_tree_view_set_rules_hint</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>

	<span class="n">column</span> <span class="o">=</span> <span class="n">gtk_tree_view_column_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_append_column</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">column</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_title</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Options&quot;</span><span class="p">));</span>

	<span class="n">renderer</span> <span class="o">=</span> <span class="n">gtk_cell_renderer_toggle_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">GTK_TREE_VIEW_COLUMN</span><span class="p">(</span><span class="n">column</span><span class="p">),</span>
					<span class="n">renderer</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_attributes</span><span class="p">(</span><span class="n">GTK_TREE_VIEW_COLUMN</span><span class="p">(</span><span class="n">column</span><span class="p">),</span>
					    <span class="n">renderer</span><span class="p">,</span>
					    <span class="s">&quot;active&quot;</span><span class="p">,</span> <span class="n">COL_BTNACT</span><span class="p">,</span>
					    <span class="s">&quot;inconsistent&quot;</span><span class="p">,</span> <span class="n">COL_BTNINC</span><span class="p">,</span>
					    <span class="s">&quot;visible&quot;</span><span class="p">,</span> <span class="n">COL_BTNVIS</span><span class="p">,</span>
					    <span class="s">&quot;radio&quot;</span><span class="p">,</span> <span class="n">COL_BTNRAD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">renderer</span> <span class="o">=</span> <span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">GTK_TREE_VIEW_COLUMN</span><span class="p">(</span><span class="n">column</span><span class="p">),</span>
					<span class="n">renderer</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_attributes</span><span class="p">(</span><span class="n">GTK_TREE_VIEW_COLUMN</span><span class="p">(</span><span class="n">column</span><span class="p">),</span>
					    <span class="n">renderer</span><span class="p">,</span>
					    <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">COL_OPTION</span><span class="p">,</span>
					    <span class="s">&quot;foreground-gdk&quot;</span><span class="p">,</span>
					    <span class="n">COL_COLOR</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="n">sel</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_selection</span><span class="p">(</span><span class="n">view</span><span class="p">);</span>
	<span class="n">gtk_tree_selection_set_mode</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">GTK_SELECTION_SINGLE</span><span class="p">);</span>
	<span class="n">gtk_widget_realize</span><span class="p">(</span><span class="n">tree1_w</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">renderer_edited</span><span class="p">(</span><span class="n">GtkCellRendererText</span> <span class="o">*</span> <span class="n">cell</span><span class="p">,</span>
			    <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span> <span class="n">path_string</span><span class="p">,</span>
			    <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span> <span class="n">new_text</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">init_right_tree</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreeView</span> <span class="o">*</span><span class="n">view</span> <span class="o">=</span> <span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">);</span>
	<span class="n">GtkCellRenderer</span> <span class="o">*</span><span class="n">renderer</span><span class="p">;</span>
	<span class="n">GtkTreeSelection</span> <span class="o">*</span><span class="n">sel</span><span class="p">;</span>
	<span class="n">GtkTreeViewColumn</span> <span class="o">*</span><span class="n">column</span><span class="p">;</span>
	<span class="n">gint</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">gtk_tree_view_set_model</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">model2</span><span class="p">);</span>
	<span class="n">gtk_tree_view_set_headers_visible</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
	<span class="n">gtk_tree_view_set_rules_hint</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>

	<span class="n">column</span> <span class="o">=</span> <span class="n">gtk_tree_view_column_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_append_column</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">column</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_title</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Options&quot;</span><span class="p">));</span>

	<span class="n">renderer</span> <span class="o">=</span> <span class="n">gtk_cell_renderer_pixbuf_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">GTK_TREE_VIEW_COLUMN</span><span class="p">(</span><span class="n">column</span><span class="p">),</span>
					<span class="n">renderer</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_attributes</span><span class="p">(</span><span class="n">GTK_TREE_VIEW_COLUMN</span><span class="p">(</span><span class="n">column</span><span class="p">),</span>
					    <span class="n">renderer</span><span class="p">,</span>
					    <span class="s">&quot;pixbuf&quot;</span><span class="p">,</span> <span class="n">COL_PIXBUF</span><span class="p">,</span>
					    <span class="s">&quot;visible&quot;</span><span class="p">,</span> <span class="n">COL_PIXVIS</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">renderer</span> <span class="o">=</span> <span class="n">gtk_cell_renderer_toggle_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">GTK_TREE_VIEW_COLUMN</span><span class="p">(</span><span class="n">column</span><span class="p">),</span>
					<span class="n">renderer</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_attributes</span><span class="p">(</span><span class="n">GTK_TREE_VIEW_COLUMN</span><span class="p">(</span><span class="n">column</span><span class="p">),</span>
					    <span class="n">renderer</span><span class="p">,</span>
					    <span class="s">&quot;active&quot;</span><span class="p">,</span> <span class="n">COL_BTNACT</span><span class="p">,</span>
					    <span class="s">&quot;inconsistent&quot;</span><span class="p">,</span> <span class="n">COL_BTNINC</span><span class="p">,</span>
					    <span class="s">&quot;visible&quot;</span><span class="p">,</span> <span class="n">COL_BTNVIS</span><span class="p">,</span>
					    <span class="s">&quot;radio&quot;</span><span class="p">,</span> <span class="n">COL_BTNRAD</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">renderer</span> <span class="o">=</span> <span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_column_pack_start</span><span class="p">(</span><span class="n">GTK_TREE_VIEW_COLUMN</span><span class="p">(</span><span class="n">column</span><span class="p">),</span>
					<span class="n">renderer</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_attributes</span><span class="p">(</span><span class="n">GTK_TREE_VIEW_COLUMN</span><span class="p">(</span><span class="n">column</span><span class="p">),</span>
					    <span class="n">renderer</span><span class="p">,</span>
					    <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">COL_OPTION</span><span class="p">,</span>
					    <span class="s">&quot;foreground-gdk&quot;</span><span class="p">,</span>
					    <span class="n">COL_COLOR</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="n">renderer</span> <span class="o">=</span> <span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_insert_column_with_attributes</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
						    <span class="n">_</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">),</span> <span class="n">renderer</span><span class="p">,</span>
						    <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">COL_NAME</span><span class="p">,</span>
						    <span class="s">&quot;foreground-gdk&quot;</span><span class="p">,</span>
						    <span class="n">COL_COLOR</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">renderer</span> <span class="o">=</span> <span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_insert_column_with_attributes</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
						    <span class="s">&quot;N&quot;</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span>
						    <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">COL_NO</span><span class="p">,</span>
						    <span class="s">&quot;foreground-gdk&quot;</span><span class="p">,</span>
						    <span class="n">COL_COLOR</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">renderer</span> <span class="o">=</span> <span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_insert_column_with_attributes</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
						    <span class="s">&quot;M&quot;</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span>
						    <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">COL_MOD</span><span class="p">,</span>
						    <span class="s">&quot;foreground-gdk&quot;</span><span class="p">,</span>
						    <span class="n">COL_COLOR</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">renderer</span> <span class="o">=</span> <span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_insert_column_with_attributes</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
						    <span class="s">&quot;Y&quot;</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span>
						    <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">COL_YES</span><span class="p">,</span>
						    <span class="s">&quot;foreground-gdk&quot;</span><span class="p">,</span>
						    <span class="n">COL_COLOR</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">renderer</span> <span class="o">=</span> <span class="n">gtk_cell_renderer_text_new</span><span class="p">();</span>
	<span class="n">gtk_tree_view_insert_column_with_attributes</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
						    <span class="n">_</span><span class="p">(</span><span class="s">&quot;Value&quot;</span><span class="p">),</span> <span class="n">renderer</span><span class="p">,</span>
						    <span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">COL_VALUE</span><span class="p">,</span>
						    <span class="s">&quot;editable&quot;</span><span class="p">,</span>
						    <span class="n">COL_EDIT</span><span class="p">,</span>
						    <span class="s">&quot;foreground-gdk&quot;</span><span class="p">,</span>
						    <span class="n">COL_COLOR</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">g_signal_connect</span><span class="p">(</span><span class="n">G_OBJECT</span><span class="p">(</span><span class="n">renderer</span><span class="p">),</span> <span class="s">&quot;edited&quot;</span><span class="p">,</span>
			 <span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">renderer_edited</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="n">column</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">COL_NAME</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_visible</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">show_name</span><span class="p">);</span>
	<span class="n">column</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">COL_NO</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_visible</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">show_range</span><span class="p">);</span>
	<span class="n">column</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">COL_MOD</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_visible</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">show_range</span><span class="p">);</span>
	<span class="n">column</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">COL_YES</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_visible</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">show_range</span><span class="p">);</span>
	<span class="n">column</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">COL_VALUE</span><span class="p">);</span>
	<span class="n">gtk_tree_view_column_set_visible</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">show_value</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">resizeable</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">COL_VALUE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">column</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
			<span class="n">gtk_tree_view_column_set_resizable</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">sel</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_selection</span><span class="p">(</span><span class="n">view</span><span class="p">);</span>
	<span class="n">gtk_tree_selection_set_mode</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">GTK_SELECTION_SINGLE</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* Utility Functions */</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">text_insert_help</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTextBuffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
	<span class="n">GtkTextIter</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">));</span>
	<span class="k">struct</span> <span class="n">gstr</span> <span class="n">help</span> <span class="o">=</span> <span class="n">str_new</span><span class="p">();</span>

	<span class="n">menu_get_ext_help</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">help</span><span class="p">);</span>

	<span class="n">buffer</span> <span class="o">=</span> <span class="n">gtk_text_view_get_buffer</span><span class="p">(</span><span class="n">GTK_TEXT_VIEW</span><span class="p">(</span><span class="n">text_w</span><span class="p">));</span>
	<span class="n">gtk_text_buffer_get_bounds</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">start</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">);</span>
	<span class="n">gtk_text_buffer_delete</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">start</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">);</span>
	<span class="n">gtk_text_view_set_left_margin</span><span class="p">(</span><span class="n">GTK_TEXT_VIEW</span><span class="p">(</span><span class="n">text_w</span><span class="p">),</span> <span class="mi">15</span><span class="p">);</span>

	<span class="n">gtk_text_buffer_get_end_iter</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">);</span>
	<span class="n">gtk_text_buffer_insert_with_tags</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tag1</span><span class="p">,</span>
					 <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gtk_text_buffer_insert_at_cursor</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">gtk_text_buffer_get_end_iter</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">);</span>
	<span class="n">gtk_text_buffer_insert_with_tags</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">,</span> <span class="n">str_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">help</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tag2</span><span class="p">,</span>
					 <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">str_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">help</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">text_insert_msg</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">title</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTextBuffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
	<span class="n">GtkTextIter</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">msg</span> <span class="o">=</span> <span class="n">message</span><span class="p">;</span>

	<span class="n">buffer</span> <span class="o">=</span> <span class="n">gtk_text_view_get_buffer</span><span class="p">(</span><span class="n">GTK_TEXT_VIEW</span><span class="p">(</span><span class="n">text_w</span><span class="p">));</span>
	<span class="n">gtk_text_buffer_get_bounds</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">start</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">);</span>
	<span class="n">gtk_text_buffer_delete</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">start</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">);</span>
	<span class="n">gtk_text_view_set_left_margin</span><span class="p">(</span><span class="n">GTK_TEXT_VIEW</span><span class="p">(</span><span class="n">text_w</span><span class="p">),</span> <span class="mi">15</span><span class="p">);</span>

	<span class="n">gtk_text_buffer_get_end_iter</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">);</span>
	<span class="n">gtk_text_buffer_insert_with_tags</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tag1</span><span class="p">,</span>
					 <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gtk_text_buffer_insert_at_cursor</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">gtk_text_buffer_get_end_iter</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">);</span>
	<span class="n">gtk_text_buffer_insert_with_tags</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tag2</span><span class="p">,</span>
					 <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* Main Windows Callbacks */</span>

<span class="kt">void</span> <span class="n">on_save_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span> <span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">);</span>
<span class="n">gboolean</span> <span class="nf">on_window1_delete_event</span><span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span> <span class="n">widget</span><span class="p">,</span> <span class="n">GdkEvent</span> <span class="o">*</span> <span class="n">event</span><span class="p">,</span>
				 <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">dialog</span><span class="p">,</span> <span class="o">*</span><span class="n">label</span><span class="p">;</span>
	<span class="n">gint</span> <span class="n">result</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">conf_get_changed</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

	<span class="n">dialog</span> <span class="o">=</span> <span class="n">gtk_dialog_new_with_buttons</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Warning !&quot;</span><span class="p">),</span>
					     <span class="n">GTK_WINDOW</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">),</span>
					     <span class="p">(</span><span class="n">GtkDialogFlags</span><span class="p">)</span>
					     <span class="p">(</span><span class="n">GTK_DIALOG_MODAL</span> <span class="o">|</span>
					      <span class="n">GTK_DIALOG_DESTROY_WITH_PARENT</span><span class="p">),</span>
					     <span class="n">GTK_STOCK_OK</span><span class="p">,</span>
					     <span class="n">GTK_RESPONSE_YES</span><span class="p">,</span>
					     <span class="n">GTK_STOCK_NO</span><span class="p">,</span>
					     <span class="n">GTK_RESPONSE_NO</span><span class="p">,</span>
					     <span class="n">GTK_STOCK_CANCEL</span><span class="p">,</span>
					     <span class="n">GTK_RESPONSE_CANCEL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">gtk_dialog_set_default_response</span><span class="p">(</span><span class="n">GTK_DIALOG</span><span class="p">(</span><span class="n">dialog</span><span class="p">),</span>
					<span class="n">GTK_RESPONSE_CANCEL</span><span class="p">);</span>

	<span class="n">label</span> <span class="o">=</span> <span class="n">gtk_label_new</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Save configuration ?</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
	<span class="n">gtk_container_add</span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="p">(</span><span class="n">GTK_DIALOG</span><span class="p">(</span><span class="n">dialog</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">vbox</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>
	<span class="n">gtk_widget_show</span><span class="p">(</span><span class="n">label</span><span class="p">);</span>

	<span class="n">result</span> <span class="o">=</span> <span class="n">gtk_dialog_run</span><span class="p">(</span><span class="n">GTK_DIALOG</span><span class="p">(</span><span class="n">dialog</span><span class="p">));</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">GTK_RESPONSE_YES</span>:
		<span class="n">on_save_activate</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GTK_RESPONSE_NO</span>:
		<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GTK_RESPONSE_CANCEL</span>:
	<span class="k">case</span> <span class="n">GTK_RESPONSE_DELETE_EVENT</span>:
	<span class="nl">default:</span>
		<span class="n">gtk_widget_destroy</span><span class="p">(</span><span class="n">dialog</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_window1_destroy</span><span class="p">(</span><span class="n">GtkObject</span> <span class="o">*</span> <span class="n">object</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gtk_main_quit</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span>
<span class="nf">on_window1_size_request</span><span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span> <span class="n">widget</span><span class="p">,</span>
			<span class="n">GtkRequisition</span> <span class="o">*</span> <span class="n">requisition</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="n">gint</span> <span class="n">old_h</span><span class="p">;</span>
	<span class="n">gint</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">widget</span><span class="o">-&gt;</span><span class="n">window</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="n">gtk_window_get_default_size</span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">w</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">gdk_window_get_size</span><span class="p">(</span><span class="n">widget</span><span class="o">-&gt;</span><span class="n">window</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">w</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="n">old_h</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">old_h</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>

	<span class="n">gtk_paned_set_position</span><span class="p">(</span><span class="n">GTK_PANED</span><span class="p">(</span><span class="n">vpaned</span><span class="p">),</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* Menu &amp; Toolbar Callbacks */</span>


<span class="k">static</span> <span class="kt">void</span>
<span class="nf">load_filename</span><span class="p">(</span><span class="n">GtkFileSelection</span> <span class="o">*</span> <span class="n">file_selector</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">fn</span><span class="p">;</span>

	<span class="n">fn</span> <span class="o">=</span> <span class="n">gtk_file_selection_get_filename</span><span class="p">(</span><span class="n">GTK_FILE_SELECTION</span>
					     <span class="p">(</span><span class="n">user_data</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">conf_read</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
		<span class="n">text_insert_msg</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Error&quot;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Unable to load configuration !&quot;</span><span class="p">));</span>
	<span class="k">else</span>
		<span class="n">display_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">on_load1_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span> <span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">fs</span><span class="p">;</span>

	<span class="n">fs</span> <span class="o">=</span> <span class="n">gtk_file_selection_new</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Load file...&quot;</span><span class="p">));</span>
	<span class="n">g_signal_connect</span><span class="p">(</span><span class="n">GTK_OBJECT</span><span class="p">(</span><span class="n">GTK_FILE_SELECTION</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ok_button</span><span class="p">),</span>
			 <span class="s">&quot;clicked&quot;</span><span class="p">,</span>
			 <span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">load_filename</span><span class="p">),</span> <span class="p">(</span><span class="n">gpointer</span><span class="p">)</span> <span class="n">fs</span><span class="p">);</span>
	<span class="n">g_signal_connect_swapped</span><span class="p">(</span><span class="n">GTK_OBJECT</span>
				 <span class="p">(</span><span class="n">GTK_FILE_SELECTION</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ok_button</span><span class="p">),</span>
				 <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">gtk_widget_destroy</span><span class="p">),</span>
				 <span class="p">(</span><span class="n">gpointer</span><span class="p">)</span> <span class="n">fs</span><span class="p">);</span>
	<span class="n">g_signal_connect_swapped</span><span class="p">(</span><span class="n">GTK_OBJECT</span>
				 <span class="p">(</span><span class="n">GTK_FILE_SELECTION</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">cancel_button</span><span class="p">),</span>
				 <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">gtk_widget_destroy</span><span class="p">),</span>
				 <span class="p">(</span><span class="n">gpointer</span><span class="p">)</span> <span class="n">fs</span><span class="p">);</span>
	<span class="n">gtk_widget_show</span><span class="p">(</span><span class="n">fs</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_save_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span> <span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">conf_write</span><span class="p">(</span><span class="nb">NULL</span><span class="p">))</span>
		<span class="n">text_insert_msg</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Error&quot;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Unable to save configuration !&quot;</span><span class="p">));</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span>
<span class="nf">store_filename</span><span class="p">(</span><span class="n">GtkFileSelection</span> <span class="o">*</span> <span class="n">file_selector</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">fn</span><span class="p">;</span>

	<span class="n">fn</span> <span class="o">=</span> <span class="n">gtk_file_selection_get_filename</span><span class="p">(</span><span class="n">GTK_FILE_SELECTION</span>
					     <span class="p">(</span><span class="n">user_data</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">conf_write</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
		<span class="n">text_insert_msg</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Error&quot;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Unable to save configuration !&quot;</span><span class="p">));</span>

	<span class="n">gtk_widget_destroy</span><span class="p">(</span><span class="n">GTK_WIDGET</span><span class="p">(</span><span class="n">user_data</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">on_save_as1_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span> <span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">fs</span><span class="p">;</span>

	<span class="n">fs</span> <span class="o">=</span> <span class="n">gtk_file_selection_new</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Save file as...&quot;</span><span class="p">));</span>
	<span class="n">g_signal_connect</span><span class="p">(</span><span class="n">GTK_OBJECT</span><span class="p">(</span><span class="n">GTK_FILE_SELECTION</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ok_button</span><span class="p">),</span>
			 <span class="s">&quot;clicked&quot;</span><span class="p">,</span>
			 <span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">store_filename</span><span class="p">),</span> <span class="p">(</span><span class="n">gpointer</span><span class="p">)</span> <span class="n">fs</span><span class="p">);</span>
	<span class="n">g_signal_connect_swapped</span><span class="p">(</span><span class="n">GTK_OBJECT</span>
				 <span class="p">(</span><span class="n">GTK_FILE_SELECTION</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ok_button</span><span class="p">),</span>
				 <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">gtk_widget_destroy</span><span class="p">),</span>
				 <span class="p">(</span><span class="n">gpointer</span><span class="p">)</span> <span class="n">fs</span><span class="p">);</span>
	<span class="n">g_signal_connect_swapped</span><span class="p">(</span><span class="n">GTK_OBJECT</span>
				 <span class="p">(</span><span class="n">GTK_FILE_SELECTION</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">cancel_button</span><span class="p">),</span>
				 <span class="s">&quot;clicked&quot;</span><span class="p">,</span> <span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">gtk_widget_destroy</span><span class="p">),</span>
				 <span class="p">(</span><span class="n">gpointer</span><span class="p">)</span> <span class="n">fs</span><span class="p">);</span>
	<span class="n">gtk_widget_show</span><span class="p">(</span><span class="n">fs</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_quit1_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span> <span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">on_window1_delete_event</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span>
		<span class="n">gtk_widget_destroy</span><span class="p">(</span><span class="n">GTK_WIDGET</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">));</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_show_name1_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span> <span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreeViewColumn</span> <span class="o">*</span><span class="n">col</span><span class="p">;</span>

	<span class="n">show_name</span> <span class="o">=</span> <span class="n">GTK_CHECK_MENU_ITEM</span><span class="p">(</span><span class="n">menuitem</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">;</span>
	<span class="n">col</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">),</span> <span class="n">COL_NAME</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="p">)</span>
		<span class="n">gtk_tree_view_column_set_visible</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">show_name</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_show_range1_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span> <span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreeViewColumn</span> <span class="o">*</span><span class="n">col</span><span class="p">;</span>

	<span class="n">show_range</span> <span class="o">=</span> <span class="n">GTK_CHECK_MENU_ITEM</span><span class="p">(</span><span class="n">menuitem</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">;</span>
	<span class="n">col</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">),</span> <span class="n">COL_NO</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="p">)</span>
		<span class="n">gtk_tree_view_column_set_visible</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">show_range</span><span class="p">);</span>
	<span class="n">col</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">),</span> <span class="n">COL_MOD</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="p">)</span>
		<span class="n">gtk_tree_view_column_set_visible</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">show_range</span><span class="p">);</span>
	<span class="n">col</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">),</span> <span class="n">COL_YES</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="p">)</span>
		<span class="n">gtk_tree_view_column_set_visible</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">show_range</span><span class="p">);</span>

<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_show_data1_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span> <span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreeViewColumn</span> <span class="o">*</span><span class="n">col</span><span class="p">;</span>

	<span class="n">show_value</span> <span class="o">=</span> <span class="n">GTK_CHECK_MENU_ITEM</span><span class="p">(</span><span class="n">menuitem</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">active</span><span class="p">;</span>
	<span class="n">col</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">),</span> <span class="n">COL_VALUE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="p">)</span>
		<span class="n">gtk_tree_view_column_set_visible</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">show_value</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span>
<span class="nf">on_set_option_mode1_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span><span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">opt_mode</span> <span class="o">=</span> <span class="n">OPT_NORMAL</span><span class="p">;</span>
	<span class="n">gtk_tree_store_clear</span><span class="p">(</span><span class="n">tree2</span><span class="p">);</span>
	<span class="n">display_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">);</span>	<span class="cm">/* instead of update_tree to speed-up */</span>
<span class="p">}</span>


<span class="kt">void</span>
<span class="nf">on_set_option_mode2_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span><span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">opt_mode</span> <span class="o">=</span> <span class="n">OPT_ALL</span><span class="p">;</span>
	<span class="n">gtk_tree_store_clear</span><span class="p">(</span><span class="n">tree2</span><span class="p">);</span>
	<span class="n">display_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">);</span>	<span class="cm">/* instead of update_tree to speed-up */</span>
<span class="p">}</span>


<span class="kt">void</span>
<span class="nf">on_set_option_mode3_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span><span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">opt_mode</span> <span class="o">=</span> <span class="n">OPT_PROMPT</span><span class="p">;</span>
	<span class="n">gtk_tree_store_clear</span><span class="p">(</span><span class="n">tree2</span><span class="p">);</span>
	<span class="n">display_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">);</span>	<span class="cm">/* instead of update_tree to speed-up */</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_introduction1_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span> <span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">dialog</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">intro_text</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span>
	    <span class="s">&quot;Welcome to gkc, the GTK+ graphical configuration tool</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;For each option, a blank box indicates the feature is disabled, a</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;check indicates it is enabled, and a dot indicates that it is to</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;be compiled as a module.  Clicking on the box will cycle through the three states.</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;If you do not see an option (e.g., a device driver) that you</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;believe should be present, try turning on Show All Options</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;under the Options menu.</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;Although there is no cross reference yet to help you figure out</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;what other options must be enabled to support the option you</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;are interested in, you can still view the help of a grayed-out</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;option.</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;Toggling Show Debug Info under the Options menu will show </span><span class="se">\n</span><span class="s">&quot;</span>
	    <span class="s">&quot;the dependencies, which you can then match by examining other options.&quot;</span><span class="p">);</span>

	<span class="n">dialog</span> <span class="o">=</span> <span class="n">gtk_message_dialog_new</span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">),</span>
					<span class="n">GTK_DIALOG_DESTROY_WITH_PARENT</span><span class="p">,</span>
					<span class="n">GTK_MESSAGE_INFO</span><span class="p">,</span>
					<span class="n">GTK_BUTTONS_CLOSE</span><span class="p">,</span> <span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">intro_text</span><span class="p">);</span>
	<span class="n">g_signal_connect_swapped</span><span class="p">(</span><span class="n">GTK_OBJECT</span><span class="p">(</span><span class="n">dialog</span><span class="p">),</span> <span class="s">&quot;response&quot;</span><span class="p">,</span>
				 <span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">gtk_widget_destroy</span><span class="p">),</span>
				 <span class="n">GTK_OBJECT</span><span class="p">(</span><span class="n">dialog</span><span class="p">));</span>
	<span class="n">gtk_widget_show_all</span><span class="p">(</span><span class="n">dialog</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_about1_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span> <span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">dialog</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">about_text</span> <span class="o">=</span>
	    <span class="n">_</span><span class="p">(</span><span class="s">&quot;gkc is copyright (c) 2002 Romain Lievin &lt;roms@lpg.ticalc.org&gt;.</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;Based on the source code from Roman Zippel.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">dialog</span> <span class="o">=</span> <span class="n">gtk_message_dialog_new</span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">),</span>
					<span class="n">GTK_DIALOG_DESTROY_WITH_PARENT</span><span class="p">,</span>
					<span class="n">GTK_MESSAGE_INFO</span><span class="p">,</span>
					<span class="n">GTK_BUTTONS_CLOSE</span><span class="p">,</span> <span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">about_text</span><span class="p">);</span>
	<span class="n">g_signal_connect_swapped</span><span class="p">(</span><span class="n">GTK_OBJECT</span><span class="p">(</span><span class="n">dialog</span><span class="p">),</span> <span class="s">&quot;response&quot;</span><span class="p">,</span>
				 <span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">gtk_widget_destroy</span><span class="p">),</span>
				 <span class="n">GTK_OBJECT</span><span class="p">(</span><span class="n">dialog</span><span class="p">));</span>
	<span class="n">gtk_widget_show_all</span><span class="p">(</span><span class="n">dialog</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_license1_activate</span><span class="p">(</span><span class="n">GtkMenuItem</span> <span class="o">*</span> <span class="n">menuitem</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkWidget</span> <span class="o">*</span><span class="n">dialog</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">license_text</span> <span class="o">=</span>
	    <span class="n">_</span><span class="p">(</span><span class="s">&quot;gkc is released under the terms of the GNU GPL v2.</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;For more information, please see the source code or</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;visit http://www.fsf.org/licenses/licenses.html</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">dialog</span> <span class="o">=</span> <span class="n">gtk_message_dialog_new</span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">),</span>
					<span class="n">GTK_DIALOG_DESTROY_WITH_PARENT</span><span class="p">,</span>
					<span class="n">GTK_MESSAGE_INFO</span><span class="p">,</span>
					<span class="n">GTK_BUTTONS_CLOSE</span><span class="p">,</span> <span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">license_text</span><span class="p">);</span>
	<span class="n">g_signal_connect_swapped</span><span class="p">(</span><span class="n">GTK_OBJECT</span><span class="p">(</span><span class="n">dialog</span><span class="p">),</span> <span class="s">&quot;response&quot;</span><span class="p">,</span>
				 <span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">gtk_widget_destroy</span><span class="p">),</span>
				 <span class="n">GTK_OBJECT</span><span class="p">(</span><span class="n">dialog</span><span class="p">));</span>
	<span class="n">gtk_widget_show_all</span><span class="p">(</span><span class="n">dialog</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_back_clicked</span><span class="p">(</span><span class="n">GtkButton</span> <span class="o">*</span> <span class="n">button</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">enum</span> <span class="n">prop_type</span> <span class="n">ptype</span><span class="p">;</span>

	<span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">;</span>
	<span class="n">ptype</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">prompt</span> <span class="o">?</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">prompt</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">:</span> <span class="n">P_UNKNOWN</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="o">!=</span> <span class="n">P_MENU</span><span class="p">)</span>
		<span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">;</span>
	<span class="n">display_tree_part</span><span class="p">();</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">current</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">)</span>
		<span class="n">gtk_widget_set_sensitive</span><span class="p">(</span><span class="n">back_btn</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_load_clicked</span><span class="p">(</span><span class="n">GtkButton</span> <span class="o">*</span> <span class="n">button</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">on_load1_activate</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">user_data</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_single_clicked</span><span class="p">(</span><span class="n">GtkButton</span> <span class="o">*</span> <span class="n">button</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">view_mode</span> <span class="o">=</span> <span class="n">SINGLE_VIEW</span><span class="p">;</span>
	<span class="n">gtk_widget_hide</span><span class="p">(</span><span class="n">tree1_w</span><span class="p">);</span>
	<span class="n">current</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">;</span>
	<span class="n">display_tree_part</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_split_clicked</span><span class="p">(</span><span class="n">GtkButton</span> <span class="o">*</span> <span class="n">button</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gint</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">;</span>
	<span class="n">view_mode</span> <span class="o">=</span> <span class="n">SPLIT_VIEW</span><span class="p">;</span>
	<span class="n">gtk_widget_show</span><span class="p">(</span><span class="n">tree1_w</span><span class="p">);</span>
	<span class="n">gtk_window_get_default_size</span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="p">(</span><span class="n">main_wnd</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">w</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">);</span>
	<span class="n">gtk_paned_set_position</span><span class="p">(</span><span class="n">GTK_PANED</span><span class="p">(</span><span class="n">hpaned</span><span class="p">),</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tree2</span><span class="p">)</span>
		<span class="n">gtk_tree_store_clear</span><span class="p">(</span><span class="n">tree2</span><span class="p">);</span>
	<span class="n">display_list</span><span class="p">();</span>

	<span class="cm">/* Disable back btn, like in full mode. */</span>
	<span class="n">gtk_widget_set_sensitive</span><span class="p">(</span><span class="n">back_btn</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_full_clicked</span><span class="p">(</span><span class="n">GtkButton</span> <span class="o">*</span> <span class="n">button</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">view_mode</span> <span class="o">=</span> <span class="n">FULL_VIEW</span><span class="p">;</span>
	<span class="n">gtk_widget_hide</span><span class="p">(</span><span class="n">tree1_w</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tree2</span><span class="p">)</span>
		<span class="n">gtk_tree_store_clear</span><span class="p">(</span><span class="n">tree2</span><span class="p">);</span>
	<span class="n">display_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">);</span>
	<span class="n">gtk_widget_set_sensitive</span><span class="p">(</span><span class="n">back_btn</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_collapse_clicked</span><span class="p">(</span><span class="n">GtkButton</span> <span class="o">*</span> <span class="n">button</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gtk_tree_view_collapse_all</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">));</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">on_expand_clicked</span><span class="p">(</span><span class="n">GtkButton</span> <span class="o">*</span> <span class="n">button</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gtk_tree_view_expand_all</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">));</span>
<span class="p">}</span>


<span class="cm">/* CTree Callbacks */</span>

<span class="cm">/* Change hex/int/string value in the cell */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">renderer_edited</span><span class="p">(</span><span class="n">GtkCellRendererText</span> <span class="o">*</span> <span class="n">cell</span><span class="p">,</span>
			    <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span> <span class="n">path_string</span><span class="p">,</span>
			    <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span> <span class="n">new_text</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreePath</span> <span class="o">*</span><span class="n">path</span> <span class="o">=</span> <span class="n">gtk_tree_path_new_from_string</span><span class="p">(</span><span class="n">path_string</span><span class="p">);</span>
	<span class="n">GtkTreeIter</span> <span class="n">iter</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">old_def</span><span class="p">,</span> <span class="o">*</span><span class="n">new_def</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">symbol</span> <span class="o">*</span><span class="n">sym</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">gtk_tree_model_get_iter</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="n">COL_MENU</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">menu</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">sym</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">;</span>

	<span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="n">COL_VALUE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">old_def</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">new_def</span> <span class="o">=</span> <span class="n">new_text</span><span class="p">;</span>

	<span class="n">sym_set_string_value</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">new_def</span><span class="p">);</span>

	<span class="n">update_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="n">gtk_tree_path_free</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Change the value of a symbol and update the tree */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">change_sym_value</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">,</span> <span class="n">gint</span> <span class="n">col</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">symbol</span> <span class="o">*</span><span class="n">sym</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">;</span>
	<span class="n">tristate</span> <span class="n">newval</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sym</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="n">COL_NO</span><span class="p">)</span>
		<span class="n">newval</span> <span class="o">=</span> <span class="n">no</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="n">COL_MOD</span><span class="p">)</span>
		<span class="n">newval</span> <span class="o">=</span> <span class="n">mod</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="n">COL_YES</span><span class="p">)</span>
		<span class="n">newval</span> <span class="o">=</span> <span class="n">yes</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sym_get_type</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">S_BOOLEAN</span>:
	<span class="k">case</span> <span class="n">S_TRISTATE</span>:
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sym_tristate_within_range</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">newval</span><span class="p">))</span>
			<span class="n">newval</span> <span class="o">=</span> <span class="n">yes</span><span class="p">;</span>
		<span class="n">sym_set_tristate_value</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">newval</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">FULL_VIEW</span><span class="p">)</span>
			<span class="n">update_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SPLIT_VIEW</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">update_tree</span><span class="p">(</span><span class="n">browsed</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
			<span class="n">display_list</span><span class="p">();</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SINGLE_VIEW</span><span class="p">)</span>
			<span class="n">display_tree_part</span><span class="p">();</span>	<span class="c1">//fixme: keep exp/coll</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">S_INT</span>:
	<span class="k">case</span> <span class="n">S_HEX</span>:
	<span class="k">case</span> <span class="n">S_STRING</span>:
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">toggle_sym_value</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">menu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">sym_toggle_tristate_value</span><span class="p">(</span><span class="n">menu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">FULL_VIEW</span><span class="p">)</span>
		<span class="n">update_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SPLIT_VIEW</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">update_tree</span><span class="p">(</span><span class="n">browsed</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
		<span class="n">display_list</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SINGLE_VIEW</span><span class="p">)</span>
		<span class="n">display_tree_part</span><span class="p">();</span>	<span class="c1">//fixme: keep exp/coll</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">gint</span> <span class="nf">column2index</span><span class="p">(</span><span class="n">GtkTreeViewColumn</span> <span class="o">*</span> <span class="n">column</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gint</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">COL_NUMBER</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">GtkTreeViewColumn</span> <span class="o">*</span><span class="n">col</span><span class="p">;</span>

		<span class="n">col</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_column</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">),</span> <span class="n">i</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="n">column</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">i</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* User click: update choice (full) or goes down (single) */</span>
<span class="n">gboolean</span>
<span class="nf">on_treeview2_button_press_event</span><span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span> <span class="n">widget</span><span class="p">,</span>
				<span class="n">GdkEventButton</span> <span class="o">*</span> <span class="n">event</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreeView</span> <span class="o">*</span><span class="n">view</span> <span class="o">=</span> <span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>
	<span class="n">GtkTreePath</span> <span class="o">*</span><span class="n">path</span><span class="p">;</span>
	<span class="n">GtkTreeViewColumn</span> <span class="o">*</span><span class="n">column</span><span class="p">;</span>
	<span class="n">GtkTreeIter</span> <span class="n">iter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">;</span>
	<span class="n">gint</span> <span class="n">col</span><span class="p">;</span>

<span class="cp">#if GTK_CHECK_VERSION(2,1,4) </span><span class="c1">// bug in ctree with earlier version of GTK</span>
	<span class="n">gint</span> <span class="n">tx</span> <span class="o">=</span> <span class="p">(</span><span class="n">gint</span><span class="p">)</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">;</span>
	<span class="n">gint</span> <span class="n">ty</span> <span class="o">=</span> <span class="p">(</span><span class="n">gint</span><span class="p">)</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">;</span>
	<span class="n">gint</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">;</span>

	<span class="n">gtk_tree_view_get_path_at_pos</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">column</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cx</span><span class="p">,</span>
				      <span class="o">&amp;</span><span class="n">cy</span><span class="p">);</span>
<span class="cp">#else</span>
	<span class="n">gtk_tree_view_get_cursor</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">column</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">gtk_tree_model_get_iter</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
	<span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="n">COL_MENU</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">menu</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

	<span class="n">col</span> <span class="o">=</span> <span class="n">column2index</span><span class="p">(</span><span class="n">column</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">GDK_2BUTTON_PRESS</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">enum</span> <span class="n">prop_type</span> <span class="n">ptype</span><span class="p">;</span>
		<span class="n">ptype</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">prompt</span> <span class="o">?</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">prompt</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">:</span> <span class="n">P_UNKNOWN</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="o">==</span> <span class="n">P_MENU</span> <span class="o">&amp;&amp;</span> <span class="n">view_mode</span> <span class="o">!=</span> <span class="n">FULL_VIEW</span> <span class="o">&amp;&amp;</span> <span class="n">col</span> <span class="o">==</span> <span class="n">COL_OPTION</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>goes down into menu</p></td><td class="code"><div class="highlight"><pre>			<span class="n">current</span> <span class="o">=</span> <span class="n">menu</span><span class="p">;</span>
			<span class="n">display_tree_part</span><span class="p">();</span>
			<span class="n">gtk_widget_set_sensitive</span><span class="p">(</span><span class="n">back_btn</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">col</span> <span class="o">==</span> <span class="n">COL_OPTION</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">toggle_sym_value</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
			<span class="n">gtk_tree_view_expand_row</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="n">COL_VALUE</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">toggle_sym_value</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
			<span class="n">gtk_tree_view_expand_row</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="n">COL_NO</span> <span class="o">||</span> <span class="n">col</span> <span class="o">==</span> <span class="n">COL_MOD</span>
			   <span class="o">||</span> <span class="n">col</span> <span class="o">==</span> <span class="n">COL_YES</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">change_sym_value</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>
			<span class="n">gtk_tree_view_expand_row</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Key pressed: update choice */</span>
<span class="n">gboolean</span>
<span class="nf">on_treeview2_key_press_event</span><span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span> <span class="n">widget</span><span class="p">,</span>
			     <span class="n">GdkEventKey</span> <span class="o">*</span> <span class="n">event</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreeView</span> <span class="o">*</span><span class="n">view</span> <span class="o">=</span> <span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>
	<span class="n">GtkTreePath</span> <span class="o">*</span><span class="n">path</span><span class="p">;</span>
	<span class="n">GtkTreeViewColumn</span> <span class="o">*</span><span class="n">column</span><span class="p">;</span>
	<span class="n">GtkTreeIter</span> <span class="n">iter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">;</span>
	<span class="n">gint</span> <span class="n">col</span><span class="p">;</span>

	<span class="n">gtk_tree_view_get_cursor</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">column</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">keyval</span> <span class="o">==</span> <span class="n">GDK_space</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">gtk_tree_view_row_expanded</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
			<span class="n">gtk_tree_view_collapse_row</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">gtk_tree_view_expand_row</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">keyval</span> <span class="o">==</span> <span class="n">GDK_KP_Enter</span><span class="p">)</span> <span class="p">{</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">widget</span> <span class="o">==</span> <span class="n">tree1_w</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

	<span class="n">gtk_tree_model_get_iter</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
	<span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="n">COL_MENU</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">menu</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">string</span><span class="p">,</span> <span class="s">&quot;n&quot;</span><span class="p">))</span>
		<span class="n">col</span> <span class="o">=</span> <span class="n">COL_NO</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">string</span><span class="p">,</span> <span class="s">&quot;m&quot;</span><span class="p">))</span>
		<span class="n">col</span> <span class="o">=</span> <span class="n">COL_MOD</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">string</span><span class="p">,</span> <span class="s">&quot;y&quot;</span><span class="p">))</span>
		<span class="n">col</span> <span class="o">=</span> <span class="n">COL_YES</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">col</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">change_sym_value</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="n">col</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Row selection changed: update help */</span>
<span class="kt">void</span>
<span class="nf">on_treeview2_cursor_changed</span><span class="p">(</span><span class="n">GtkTreeView</span> <span class="o">*</span> <span class="n">treeview</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreeSelection</span> <span class="o">*</span><span class="n">selection</span><span class="p">;</span>
	<span class="n">GtkTreeIter</span> <span class="n">iter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">;</span>

	<span class="n">selection</span> <span class="o">=</span> <span class="n">gtk_tree_view_get_selection</span><span class="p">(</span><span class="n">treeview</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gtk_tree_selection_get_selected</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">model2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="n">COL_MENU</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">menu</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
		<span class="n">text_insert_help</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="cm">/* User click: display sub-tree in the right frame. */</span>
<span class="n">gboolean</span>
<span class="nf">on_treeview1_button_press_event</span><span class="p">(</span><span class="n">GtkWidget</span> <span class="o">*</span> <span class="n">widget</span><span class="p">,</span>
				<span class="n">GdkEventButton</span> <span class="o">*</span> <span class="n">event</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreeView</span> <span class="o">*</span><span class="n">view</span> <span class="o">=</span> <span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>
	<span class="n">GtkTreePath</span> <span class="o">*</span><span class="n">path</span><span class="p">;</span>
	<span class="n">GtkTreeViewColumn</span> <span class="o">*</span><span class="n">column</span><span class="p">;</span>
	<span class="n">GtkTreeIter</span> <span class="n">iter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">;</span>

	<span class="n">gint</span> <span class="n">tx</span> <span class="o">=</span> <span class="p">(</span><span class="n">gint</span><span class="p">)</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">;</span>
	<span class="n">gint</span> <span class="n">ty</span> <span class="o">=</span> <span class="p">(</span><span class="n">gint</span><span class="p">)</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">;</span>
	<span class="n">gint</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">;</span>

	<span class="n">gtk_tree_view_get_path_at_pos</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">column</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cx</span><span class="p">,</span>
				      <span class="o">&amp;</span><span class="n">cy</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>

	<span class="n">gtk_tree_model_get_iter</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
	<span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">,</span> <span class="n">COL_MENU</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">menu</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">GDK_2BUTTON_PRESS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">toggle_sym_value</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
		<span class="n">current</span> <span class="o">=</span> <span class="n">menu</span><span class="p">;</span>
		<span class="n">display_tree_part</span><span class="p">();</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">browsed</span> <span class="o">=</span> <span class="n">menu</span><span class="p">;</span>
		<span class="n">display_tree_part</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="n">gtk_widget_realize</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">);</span>
	<span class="n">gtk_tree_view_set_cursor</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
	<span class="n">gtk_widget_grab_focus</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Fill a row of strings */</span>
<span class="k">static</span> <span class="n">gchar</span> <span class="o">**</span><span class="nf">fill_row</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="n">COL_NUMBER</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">symbol</span> <span class="o">*</span><span class="n">sym</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">def</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">stype</span><span class="p">;</span>
	<span class="n">tristate</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">prop_type</span> <span class="n">ptype</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">COL_OPTION</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">COL_COLOR</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">g_free</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="n">bzero</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">row</span><span class="p">));</span>

	<span class="n">row</span><span class="p">[</span><span class="n">COL_OPTION</span><span class="p">]</span> <span class="o">=</span>
	    <span class="n">g_strdup_printf</span><span class="p">(</span><span class="s">&quot;%s %s&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">)),</span>
			    <span class="n">sym</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">sym_has_value</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;(NEW)&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">opt_mode</span> <span class="o">==</span> <span class="n">OPT_ALL</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">menu_is_visible</span><span class="p">(</span><span class="n">menu</span><span class="p">))</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_COLOR</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;DarkGray&quot;</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">opt_mode</span> <span class="o">==</span> <span class="n">OPT_PROMPT</span> <span class="o">&amp;&amp;</span>
			<span class="n">menu_has_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">menu_is_visible</span><span class="p">(</span><span class="n">menu</span><span class="p">))</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_COLOR</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;DarkGray&quot;</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_COLOR</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;Black&quot;</span><span class="p">);</span>

	<span class="n">ptype</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">prompt</span> <span class="o">?</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">prompt</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">:</span> <span class="n">P_UNKNOWN</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ptype</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">P_MENU</span>:
		<span class="n">row</span><span class="p">[</span><span class="n">COL_PIXBUF</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gchar</span> <span class="o">*</span><span class="p">)</span> <span class="n">xpm_menu</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SINGLE_VIEW</span><span class="p">)</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_PIXVIS</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNVIS</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">P_COMMENT</span>:
		<span class="n">row</span><span class="p">[</span><span class="n">COL_PIXBUF</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gchar</span> <span class="o">*</span><span class="p">)</span> <span class="n">xpm_void</span><span class="p">;</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_PIXVIS</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNVIS</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_PIXBUF</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gchar</span> <span class="o">*</span><span class="p">)</span> <span class="n">xpm_void</span><span class="p">;</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_PIXVIS</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNVIS</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sym</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">row</span><span class="p">;</span>
	<span class="n">row</span><span class="p">[</span><span class="n">COL_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="n">sym</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">sym_calc_value</span><span class="p">(</span><span class="n">sym</span><span class="p">);</span>
	<span class="n">sym</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SYMBOL_CHANGED</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sym_is_choice</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span> <span class="p">{</span>	<span class="c1">// parse childs for getting final value</span>
		<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">child</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">symbol</span> <span class="o">*</span><span class="n">def_sym</span> <span class="o">=</span> <span class="n">sym_get_choice_value</span><span class="p">(</span><span class="n">sym</span><span class="p">);</span>
		<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">def_menu</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

		<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNVIS</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">child</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">;</span> <span class="n">child</span><span class="p">;</span> <span class="n">child</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">menu_is_visible</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
			    <span class="o">&amp;&amp;</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">sym</span> <span class="o">==</span> <span class="n">def_sym</span><span class="p">)</span>
				<span class="n">def_menu</span> <span class="o">=</span> <span class="n">child</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">def_menu</span><span class="p">)</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_VALUE</span><span class="p">]</span> <span class="o">=</span>
			    <span class="n">g_strdup</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">def_menu</span><span class="p">)));</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sym</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SYMBOL_CHOICEVAL</span><span class="p">)</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNRAD</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>

	<span class="n">stype</span> <span class="o">=</span> <span class="n">sym_get_type</span><span class="p">(</span><span class="n">sym</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">stype</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">S_BOOLEAN</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">GPOINTER_TO_INT</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">COL_PIXVIS</span><span class="p">])</span> <span class="o">==</span> <span class="n">FALSE</span><span class="p">)</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNVIS</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sym_is_choice</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="cm">/* fall through */</span>
	<span class="k">case</span> <span class="n">S_TRISTATE</span>:
		<span class="n">val</span> <span class="o">=</span> <span class="n">sym_get_tristate_value</span><span class="p">(</span><span class="n">sym</span><span class="p">);</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">no</span>:
			<span class="n">row</span><span class="p">[</span><span class="n">COL_NO</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">);</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_VALUE</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;N&quot;</span><span class="p">);</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNACT</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNINC</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">mod</span>:
			<span class="n">row</span><span class="p">[</span><span class="n">COL_MOD</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">);</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_VALUE</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">);</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNINC</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">yes</span>:
			<span class="n">row</span><span class="p">[</span><span class="n">COL_YES</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;Y&quot;</span><span class="p">);</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_VALUE</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;Y&quot;</span><span class="p">);</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNACT</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNINC</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">!=</span> <span class="n">no</span> <span class="o">&amp;&amp;</span> <span class="n">sym_tristate_within_range</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">no</span><span class="p">))</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_NO</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">!=</span> <span class="n">mod</span> <span class="o">&amp;&amp;</span> <span class="n">sym_tristate_within_range</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">mod</span><span class="p">))</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_MOD</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">!=</span> <span class="n">yes</span> <span class="o">&amp;&amp;</span> <span class="n">sym_tristate_within_range</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">yes</span><span class="p">))</span>
			<span class="n">row</span><span class="p">[</span><span class="n">COL_YES</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">S_INT</span>:
	<span class="k">case</span> <span class="n">S_HEX</span>:
	<span class="k">case</span> <span class="n">S_STRING</span>:
		<span class="n">def</span> <span class="o">=</span> <span class="n">sym_get_string_value</span><span class="p">(</span><span class="n">sym</span><span class="p">);</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_VALUE</span><span class="p">]</span> <span class="o">=</span> <span class="n">g_strdup</span><span class="p">(</span><span class="n">def</span><span class="p">);</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_EDIT</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">TRUE</span><span class="p">);</span>
		<span class="n">row</span><span class="p">[</span><span class="n">COL_BTNVIS</span><span class="p">]</span> <span class="o">=</span> <span class="n">GINT_TO_POINTER</span><span class="p">(</span><span class="n">FALSE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">row</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Set the node content with a row of strings */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">set_node</span><span class="p">(</span><span class="n">GtkTreeIter</span> <span class="o">*</span> <span class="n">node</span><span class="p">,</span> <span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">,</span> <span class="n">gchar</span> <span class="o">**</span> <span class="n">row</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GdkColor</span> <span class="n">color</span><span class="p">;</span>
	<span class="n">gboolean</span> <span class="n">success</span><span class="p">;</span>
	<span class="n">GdkPixbuf</span> <span class="o">*</span><span class="n">pix</span><span class="p">;</span>

	<span class="n">pix</span> <span class="o">=</span> <span class="n">gdk_pixbuf_new_from_xpm_data</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="p">)</span>
					   <span class="n">row</span><span class="p">[</span><span class="n">COL_PIXBUF</span><span class="p">]);</span>

	<span class="n">gdk_color_parse</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">COL_COLOR</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">color</span><span class="p">);</span>
	<span class="n">gdk_colormap_alloc_colors</span><span class="p">(</span><span class="n">gdk_colormap_get_system</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">color</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				  <span class="n">FALSE</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">success</span><span class="p">);</span>

	<span class="n">gtk_tree_store_set</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span>
			   <span class="n">COL_OPTION</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">COL_OPTION</span><span class="p">],</span>
			   <span class="n">COL_NAME</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">COL_NAME</span><span class="p">],</span>
			   <span class="n">COL_NO</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">COL_NO</span><span class="p">],</span>
			   <span class="n">COL_MOD</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">COL_MOD</span><span class="p">],</span>
			   <span class="n">COL_YES</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">COL_YES</span><span class="p">],</span>
			   <span class="n">COL_VALUE</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">COL_VALUE</span><span class="p">],</span>
			   <span class="n">COL_MENU</span><span class="p">,</span> <span class="p">(</span><span class="n">gpointer</span><span class="p">)</span> <span class="n">menu</span><span class="p">,</span>
			   <span class="n">COL_COLOR</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">color</span><span class="p">,</span>
			   <span class="n">COL_EDIT</span><span class="p">,</span> <span class="n">GPOINTER_TO_INT</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">COL_EDIT</span><span class="p">]),</span>
			   <span class="n">COL_PIXBUF</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span>
			   <span class="n">COL_PIXVIS</span><span class="p">,</span> <span class="n">GPOINTER_TO_INT</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">COL_PIXVIS</span><span class="p">]),</span>
			   <span class="n">COL_BTNVIS</span><span class="p">,</span> <span class="n">GPOINTER_TO_INT</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">COL_BTNVIS</span><span class="p">]),</span>
			   <span class="n">COL_BTNACT</span><span class="p">,</span> <span class="n">GPOINTER_TO_INT</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">COL_BTNACT</span><span class="p">]),</span>
			   <span class="n">COL_BTNINC</span><span class="p">,</span> <span class="n">GPOINTER_TO_INT</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">COL_BTNINC</span><span class="p">]),</span>
			   <span class="n">COL_BTNRAD</span><span class="p">,</span> <span class="n">GPOINTER_TO_INT</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">COL_BTNRAD</span><span class="p">]),</span>
			   <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

	<span class="n">g_object_unref</span><span class="p">(</span><span class="n">pix</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* Add a node to the tree */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">place_node</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">row</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreeIter</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parents</span><span class="p">[</span><span class="n">indent</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
	<span class="n">GtkTreeIter</span> <span class="o">*</span><span class="n">node</span> <span class="o">=</span> <span class="n">parents</span><span class="p">[</span><span class="n">indent</span><span class="p">];</span>

	<span class="n">gtk_tree_store_append</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">parent</span><span class="p">);</span>
	<span class="n">set_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">menu</span><span class="p">,</span> <span class="n">row</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* Find a node in the GTK+ tree */</span>
<span class="k">static</span> <span class="n">GtkTreeIter</span> <span class="n">found</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Find a menu in the GtkTree starting at parent.</span>
<span class="cm"> */</span>
<span class="n">GtkTreeIter</span> <span class="o">*</span><span class="nf">gtktree_iter_find_node</span><span class="p">(</span><span class="n">GtkTreeIter</span> <span class="o">*</span> <span class="n">parent</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">tofind</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">GtkTreeIter</span> <span class="n">iter</span><span class="p">;</span>
	<span class="n">GtkTreeIter</span> <span class="o">*</span><span class="n">child</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">;</span>
	<span class="n">gboolean</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">GtkTreeIter</span> <span class="o">*</span><span class="n">ret</span><span class="p">;</span>

	<span class="n">valid</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_children</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">parent</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">;</span>

		<span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">menu</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">menu</span> <span class="o">==</span> <span class="n">tofind</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">found</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">GtkTreeIter</span><span class="p">));</span>
			<span class="k">return</span> <span class="o">&amp;</span><span class="n">found</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">ret</span> <span class="o">=</span> <span class="n">gtktree_iter_find_node</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">tofind</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

		<span class="n">valid</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_next</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">child</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * Update the tree by adding/removing entries</span>
<span class="cm"> * Does not change other nodes</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">update_tree</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="n">GtkTreeIter</span> <span class="o">*</span> <span class="n">dst</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">child1</span><span class="p">;</span>
	<span class="n">GtkTreeIter</span> <span class="n">iter</span><span class="p">,</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="n">GtkTreeIter</span> <span class="o">*</span><span class="n">child2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">iter</span><span class="p">;</span>
	<span class="n">gboolean</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">GtkTreeIter</span> <span class="o">*</span><span class="n">sibling</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">symbol</span> <span class="o">*</span><span class="n">sym</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu1</span><span class="p">,</span> <span class="o">*</span><span class="n">menu2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">src</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">)</span>
		<span class="n">indent</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">valid</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_children</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">child2</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">child1</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">;</span> <span class="n">child1</span><span class="p">;</span> <span class="n">child1</span> <span class="o">=</span> <span class="n">child1</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">sym</span> <span class="o">=</span> <span class="n">child1</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">;</span>

	      <span class="nl">reparse:</span>
		<span class="n">menu1</span> <span class="o">=</span> <span class="n">child1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">valid</span><span class="p">)</span>
			<span class="n">gtk_tree_model_get</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">child2</span><span class="p">,</span> <span class="n">COL_MENU</span><span class="p">,</span>
					   <span class="o">&amp;</span><span class="n">menu2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">menu2</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>	<span class="c1">// force adding of a first child</span>

<span class="cp">#ifdef DEBUG</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%*c%s | %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">,</span>
		       <span class="n">menu1</span> <span class="o">?</span> <span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu1</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;nil&quot;</span><span class="p">,</span>
		       <span class="n">menu2</span> <span class="o">?</span> <span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu2</span><span class="p">)</span> <span class="o">:</span> <span class="s">&quot;nil&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">opt_mode</span> <span class="o">==</span> <span class="n">OPT_NORMAL</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">menu_is_visible</span><span class="p">(</span><span class="n">child1</span><span class="p">))</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">opt_mode</span> <span class="o">==</span> <span class="n">OPT_PROMPT</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">menu_has_prompt</span><span class="p">(</span><span class="n">child1</span><span class="p">))</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">opt_mode</span> <span class="o">==</span> <span class="n">OPT_ALL</span>    <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">child1</span><span class="p">)))</span> <span class="p">{</span>

			<span class="cm">/* remove node */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">gtktree_iter_find_node</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">menu1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="n">child2</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">GtkTreeIter</span><span class="p">));</span>
				<span class="n">valid</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_next</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span>
								 <span class="n">child2</span><span class="p">);</span>
				<span class="n">gtk_tree_store_remove</span><span class="p">(</span><span class="n">tree2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">valid</span><span class="p">)</span>
					<span class="k">return</span><span class="p">;</span>		<span class="cm">/* next parent */</span>
				<span class="k">else</span>
					<span class="k">goto</span> <span class="n">reparse</span><span class="p">;</span>	<span class="cm">/* next child */</span>
			<span class="p">}</span> <span class="k">else</span>
				<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">menu1</span> <span class="o">!=</span> <span class="n">menu2</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">gtktree_iter_find_node</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">menu1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>	<span class="c1">// add node</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">valid</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">menu2</span><span class="p">)</span>
					<span class="n">sibling</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
				<span class="k">else</span>
					<span class="n">sibling</span> <span class="o">=</span> <span class="n">child2</span><span class="p">;</span>
				<span class="n">gtk_tree_store_insert_before</span><span class="p">(</span><span class="n">tree2</span><span class="p">,</span>
							     <span class="n">child2</span><span class="p">,</span>
							     <span class="n">dst</span><span class="p">,</span> <span class="n">sibling</span><span class="p">);</span>
				<span class="n">set_node</span><span class="p">(</span><span class="n">child2</span><span class="p">,</span> <span class="n">menu1</span><span class="p">,</span> <span class="n">fill_row</span><span class="p">(</span><span class="n">menu1</span><span class="p">));</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">menu2</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
					<span class="n">valid</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>	<span class="c1">// remove node</span>
				<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="n">child2</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">GtkTreeIter</span><span class="p">));</span>
				<span class="n">valid</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_next</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span>
								 <span class="n">child2</span><span class="p">);</span>
				<span class="n">gtk_tree_store_remove</span><span class="p">(</span><span class="n">tree2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">valid</span><span class="p">)</span>
					<span class="k">return</span><span class="p">;</span>	<span class="c1">// next parent</span>
				<span class="k">else</span>
					<span class="k">goto</span> <span class="n">reparse</span><span class="p">;</span>	<span class="c1">// next child</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sym</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">sym</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SYMBOL_CHANGED</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">set_node</span><span class="p">(</span><span class="n">child2</span><span class="p">,</span> <span class="n">menu1</span><span class="p">,</span> <span class="n">fill_row</span><span class="p">(</span><span class="n">menu1</span><span class="p">));</span>
		<span class="p">}</span>

		<span class="n">indent</span><span class="o">++</span><span class="p">;</span>
		<span class="n">update_tree</span><span class="p">(</span><span class="n">child1</span><span class="p">,</span> <span class="n">child2</span><span class="p">);</span>
		<span class="n">indent</span><span class="o">--</span><span class="p">;</span>

		<span class="n">valid</span> <span class="o">=</span> <span class="n">gtk_tree_model_iter_next</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="n">child2</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="cm">/* Display the whole tree (single/split/full view) */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">display_tree</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">symbol</span> <span class="o">*</span><span class="n">sym</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">property</span> <span class="o">*</span><span class="n">prop</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">child</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">prop_type</span> <span class="n">ptype</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">menu</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">indent</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">current</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">child</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">;</span> <span class="n">child</span><span class="p">;</span> <span class="n">child</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">prop</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">prompt</span><span class="p">;</span>
		<span class="n">sym</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">;</span>
		<span class="n">ptype</span> <span class="o">=</span> <span class="n">prop</span> <span class="o">?</span> <span class="n">prop</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">:</span> <span class="n">P_UNKNOWN</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">sym</span><span class="p">)</span>
			<span class="n">sym</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SYMBOL_CHANGED</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SPLIT_VIEW</span><span class="p">)</span>
		    <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MENU_ROOT</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tree</span> <span class="o">==</span> <span class="n">tree1</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SPLIT_VIEW</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MENU_ROOT</span><span class="p">)</span>
		    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tree</span> <span class="o">==</span> <span class="n">tree2</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">opt_mode</span> <span class="o">==</span> <span class="n">OPT_NORMAL</span> <span class="o">&amp;&amp;</span> <span class="n">menu_is_visible</span><span class="p">(</span><span class="n">child</span><span class="p">))</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">opt_mode</span> <span class="o">==</span> <span class="n">OPT_PROMPT</span> <span class="o">&amp;&amp;</span> <span class="n">menu_has_prompt</span><span class="p">(</span><span class="n">child</span><span class="p">))</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">opt_mode</span> <span class="o">==</span> <span class="n">OPT_ALL</span>    <span class="o">&amp;&amp;</span> <span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">child</span><span class="p">)))</span>
			<span class="n">place_node</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">fill_row</span><span class="p">(</span><span class="n">child</span><span class="p">));</span>
<span class="cp">#ifdef DEBUG</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%*c%s: &quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">child</span><span class="p">));</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MENU_ROOT</span> <span class="o">?</span> <span class="s">&quot;rootmenu | &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">prop_get_type_name</span><span class="p">(</span><span class="n">ptype</span><span class="p">));</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">&quot; | &quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">sym_type_name</span><span class="p">(</span><span class="n">sym</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">));</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot; | &quot;</span><span class="p">);</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">dbg_sym_flags</span><span class="p">(</span><span class="n">sym</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">));</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">view_mode</span> <span class="o">!=</span> <span class="n">FULL_VIEW</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ptype</span> <span class="o">==</span> <span class="n">P_MENU</span><span class="p">)</span>
		    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tree</span> <span class="o">==</span> <span class="n">tree2</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>
<span class="cm">/*</span>
<span class="cm">                if (((menu != &amp;rootmenu) &amp;&amp; !(menu-&gt;flags &amp; MENU_ROOT))</span>
<span class="cm">		    || (view_mode == FULL_VIEW)</span>
<span class="cm">		    || (view_mode == SPLIT_VIEW))*/</span>

		<span class="cm">/* Change paned position if the view is not in &#39;split mode&#39; */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SINGLE_VIEW</span> <span class="o">||</span> <span class="n">view_mode</span> <span class="o">==</span> <span class="n">FULL_VIEW</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">gtk_paned_set_position</span><span class="p">(</span><span class="n">GTK_PANED</span><span class="p">(</span><span class="n">hpaned</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(((</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SINGLE_VIEW</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">menu</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">MENU_ROOT</span><span class="p">))</span>
		    <span class="o">||</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">FULL_VIEW</span><span class="p">)</span>
		    <span class="o">||</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SPLIT_VIEW</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">indent</span><span class="o">++</span><span class="p">;</span>
			<span class="n">display_tree</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
			<span class="n">indent</span><span class="o">--</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Display a part of the tree starting at current node (single/split view) */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">display_tree_part</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tree2</span><span class="p">)</span>
		<span class="n">gtk_tree_store_clear</span><span class="p">(</span><span class="n">tree2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SINGLE_VIEW</span><span class="p">)</span>
		<span class="n">display_tree</span><span class="p">(</span><span class="n">current</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">view_mode</span> <span class="o">==</span> <span class="n">SPLIT_VIEW</span><span class="p">)</span>
		<span class="n">display_tree</span><span class="p">(</span><span class="n">browsed</span><span class="p">);</span>
	<span class="n">gtk_tree_view_expand_all</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree2_w</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/* Display the list in the left frame (split view) */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">display_list</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tree1</span><span class="p">)</span>
		<span class="n">gtk_tree_store_clear</span><span class="p">(</span><span class="n">tree1</span><span class="p">);</span>

	<span class="n">tree</span> <span class="o">=</span> <span class="n">tree1</span><span class="p">;</span>
	<span class="n">display_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">);</span>
	<span class="n">gtk_tree_view_expand_all</span><span class="p">(</span><span class="n">GTK_TREE_VIEW</span><span class="p">(</span><span class="n">tree1_w</span><span class="p">));</span>
	<span class="n">tree</span> <span class="o">=</span> <span class="n">tree2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">fixup_rootmenu</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">child</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">int</span> <span class="n">menu_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">menu</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">MENU_ROOT</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">child</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">;</span> <span class="n">child</span><span class="p">;</span> <span class="n">child</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">prompt</span> <span class="o">&amp;&amp;</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">prompt</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">P_MENU</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">menu_cnt</span><span class="o">++</span><span class="p">;</span>
			<span class="n">fixup_rootmenu</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
			<span class="n">menu_cnt</span><span class="o">--</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">menu_cnt</span><span class="p">)</span>
			<span class="n">fixup_rootmenu</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="cm">/* Main */</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">ac</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">av</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">env</span><span class="p">;</span>
	<span class="n">gchar</span> <span class="o">*</span><span class="n">glade_file</span><span class="p">;</span>

	<span class="n">bindtextdomain</span><span class="p">(</span><span class="n">PACKAGE</span><span class="p">,</span> <span class="n">LOCALEDIR</span><span class="p">);</span>
	<span class="n">bind_textdomain_codeset</span><span class="p">(</span><span class="n">PACKAGE</span><span class="p">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="p">);</span>
	<span class="n">textdomain</span><span class="p">(</span><span class="n">PACKAGE</span><span class="p">);</span>

	<span class="cm">/* GTK stuffs */</span>
	<span class="n">gtk_set_locale</span><span class="p">();</span>
	<span class="n">gtk_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ac</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">av</span><span class="p">);</span>
	<span class="n">glade_init</span><span class="p">();</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>add<em>pixmap</em>directory (PACKAGE<em>DATA</em>DIR "/" PACKAGE "/pixmaps");
add<em>pixmap</em>directory (PACKAGE<em>SOURCE</em>DIR "/pixmaps");</p></td><td class="code"><div class="highlight"><pre>	<span class="cm">/* Determine GUI path */</span>
	<span class="n">env</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="n">SRCTREE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">env</span><span class="p">)</span>
		<span class="n">glade_file</span> <span class="o">=</span> <span class="n">g_strconcat</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s">&quot;/scripts/kconfig/gconf.glade&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">av</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span><span class="p">)</span>
		<span class="n">glade_file</span> <span class="o">=</span> <span class="n">g_strconcat</span><span class="p">(</span><span class="n">av</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;.glade&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">glade_file</span> <span class="o">=</span> <span class="n">g_strconcat</span><span class="p">(</span><span class="n">g_get_current_dir</span><span class="p">(),</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">av</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;.glade&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* Conf stuffs */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ac</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">av</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">av</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="sc">&#39;a&#39;</span>:</pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>showAll = 1;</p></td><td class="code"><div class="highlight"><pre>			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="sc">&#39;h&#39;</span>:
		<span class="k">case</span> <span class="sc">&#39;?&#39;</span>:
			<span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s &lt;config&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">av</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
			<span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">av</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">av</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

	<span class="n">conf_parse</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
	<span class="n">fixup_rootmenu</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">);</span>
	<span class="n">conf_read</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* Load the interface and connect signals */</span>
	<span class="n">init_main_window</span><span class="p">(</span><span class="n">glade_file</span><span class="p">);</span>
	<span class="n">init_tree_model</span><span class="p">();</span>
	<span class="n">init_left_tree</span><span class="p">();</span>
	<span class="n">init_right_tree</span><span class="p">();</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">view_mode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SINGLE_VIEW</span>:
		<span class="n">display_tree_part</span><span class="p">();</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SPLIT_VIEW</span>:
		<span class="n">display_list</span><span class="p">();</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">FULL_VIEW</span>:
		<span class="n">display_tree</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">gtk_main</span><span class="p">();</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">conf_changed</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">changed</span> <span class="o">=</span> <span class="n">conf_get_changed</span><span class="p">();</span>
	<span class="n">gtk_widget_set_sensitive</span><span class="p">(</span><span class="n">save_btn</span><span class="p">,</span> <span class="n">changed</span><span class="p">);</span>
	<span class="n">gtk_widget_set_sensitive</span><span class="p">(</span><span class="n">save_menu_item</span><span class="p">,</span> <span class="n">changed</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
