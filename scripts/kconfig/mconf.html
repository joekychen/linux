<!DOCTYPE html>
<html><head><title>joekychen/linux » scripts › kconfig › mconf.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>mconf.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) 2002 Roman Zippel &lt;zippel@linux-m68k.org&gt;</span>
<span class="cm"> * Released under the terms of the GNU GPL v2.0.</span>
<span class="cm"> *</span>
<span class="cm"> * Introduced single menu mode (show all sub-menus in one large tree).</span>
<span class="cm"> * 2002-11-06 Petr Baudis &lt;pasky@ucw.cz&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * i18n, 2005, Arnaldo Carvalho de Melo &lt;acme@conectiva.com.br&gt;</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;ctype.h&gt;</span>
<span class="cp">#include &lt;errno.h&gt;</span>
<span class="cp">#include &lt;fcntl.h&gt;</span>
<span class="cp">#include &lt;limits.h&gt;</span>
<span class="cp">#include &lt;stdarg.h&gt;</span>
<span class="cp">#include &lt;stdlib.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>
<span class="cp">#include &lt;signal.h&gt;</span>
<span class="cp">#include &lt;unistd.h&gt;</span>
<span class="cp">#include &lt;locale.h&gt;</span>

<span class="cp">#include &quot;lkc.h&quot;</span>
<span class="cp">#include &quot;lxdialog/dialog.h&quot;</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">mconf_readme</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
<span class="s">&quot;Overview</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;--------</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;This interface let you select features and parameters for the build.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Features can either be built-in, modularized, or ignored. Parameters</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;must be entered in as decimal or hexadecimal numbers or text.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Menu items beginning with following braces represent features that</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;  [ ] can be built in or removed</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;  &lt; &gt; can be built in, modularized or removed</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;  { } can be built in or modularized (selected by other feature)</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;  - - are selected by other feature,</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;while *, M or whitespace inside braces means to build in, build as</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;a module or to exclude the feature respectively.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;To change any of these features, highlight it with the cursor</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;keys and press &lt;Y&gt; to build it in, &lt;M&gt; to make it a module or</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;&lt;N&gt; to removed it.  You may also press the &lt;Space Bar&gt; to cycle</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;through the available options (ie. Y-&gt;N-&gt;M-&gt;Y).</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Some additional keyboard hints:</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Menus</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;----------</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;o  Use the Up/Down arrow keys (cursor keys) to highlight the item</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   you wish to change or submenu wish to select and press &lt;Enter&gt;.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   Submenus are designated by </span><span class="se">\&quot;</span><span class="s">---&gt;</span><span class="se">\&quot;</span><span class="s">.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   Shortcut: Press the option&#39;s highlighted letter (hotkey).</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;             Pressing a hotkey more than once will sequence</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;             through all visible items which use that hotkey.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   You may also use the &lt;PAGE UP&gt; and &lt;PAGE DOWN&gt; keys to scroll</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   unseen options into view.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;o  To exit a menu use the cursor keys to highlight the &lt;Exit&gt; button</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   and press &lt;ENTER&gt;.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   Shortcut: Press &lt;ESC&gt;&lt;ESC&gt; or &lt;E&gt; or &lt;X&gt; if there is no hotkey</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;             using those letters.  You may press a single &lt;ESC&gt;, but</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;             there is a delayed response which you may find annoying.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   Also, the &lt;TAB&gt; and cursor keys will cycle between &lt;Select&gt;,</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   &lt;Exit&gt; and &lt;Help&gt;.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;o  To get help with an item, use the cursor keys to highlight &lt;Help&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   and press &lt;ENTER&gt;.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   Shortcut: Press &lt;H&gt; or &lt;?&gt;.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;o  To toggle the display of hidden options, press &lt;Z&gt;.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Radiolists  (Choice lists)</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;-----------</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;o  Use the cursor keys to select the option you wish to set and press</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   &lt;S&gt; or the &lt;SPACE BAR&gt;.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   Shortcut: Press the first letter of the option you wish to set then</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;             press &lt;S&gt; or &lt;SPACE BAR&gt;.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;o  To see available help for the item, use the cursor keys to highlight</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   &lt;Help&gt; and Press &lt;ENTER&gt;.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   Shortcut: Press &lt;H&gt; or &lt;?&gt;.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   Also, the &lt;TAB&gt; and cursor keys will cycle between &lt;Select&gt; and</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   &lt;Help&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Data Entry</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;-----------</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;o  Enter the requested information and press &lt;ENTER&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   If you are entering hexadecimal values, it is not necessary to</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   add the &#39;0x&#39; prefix to the entry.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;o  For help, use the &lt;TAB&gt; or cursor keys to highlight the help option</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   and press &lt;ENTER&gt;.  You can try &lt;TAB&gt;&lt;H&gt; as well.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Text Box    (Help Window)</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;--------</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;o  Use the cursor keys to scroll up/down/left/right.  The VI editor</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   keys h,j,k,l function here as do &lt;SPACE BAR&gt; and &lt;B&gt; for those</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;   who are familiar with less and lynx.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;o  Press &lt;E&gt;, &lt;X&gt;, &lt;Enter&gt; or &lt;Esc&gt;&lt;Esc&gt; to exit.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Alternate Configuration Files</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;-----------------------------</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Menuconfig supports the use of alternate configuration files for</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;those who, for various reasons, find it necessary to switch</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;between different configurations.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;At the end of the main menu you will find two options.  One is</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;for saving the current configuration to a file of your choosing.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;The other option is for loading a previously saved alternate</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;configuration.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Even if you don&#39;t use alternate configuration files, but you</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;find during a Menuconfig session that you have completely messed</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;up your settings, you may use the </span><span class="se">\&quot;</span><span class="s">Load Alternate...</span><span class="se">\&quot;</span><span class="s"> option to</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;restore your previously saved settings from </span><span class="se">\&quot;</span><span class="s">.config</span><span class="se">\&quot;</span><span class="s"> without</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;restarting Menuconfig.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Other information</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;-----------------</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;If you use Menuconfig in an XTERM window make sure you have your</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;$TERM variable set to point to a xterm definition which supports color.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Otherwise, Menuconfig will look rather bad.  Menuconfig will not</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;display correctly in a RXVT window because rxvt displays only one</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;intensity of color, bright.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Menuconfig will display larger menus on screens or xterms which are</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;set to display more than the standard 25 row by 80 column geometry.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;In order for this to work, the </span><span class="se">\&quot;</span><span class="s">stty size</span><span class="se">\&quot;</span><span class="s"> command must be able to</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;display the screen&#39;s current row and column geometry.  I STRONGLY</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;RECOMMEND that you make sure you do NOT have the shell variables</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;LINES and COLUMNS exported into your environment.  Some distributions</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;export those variables via /etc/profile.  Some ncurses programs can</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;become confused when those variables (LINES &amp; COLUMNS) don&#39;t reflect</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;the true screen size.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Optional personality available</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;------------------------------</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;If you prefer to have all of the options listed in a single menu, rather</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;than the default multimenu hierarchy, run the menuconfig with</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;MENUCONFIG_MODE environment variable set to single_menu. Example:</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;make MENUCONFIG_MODE=single_menu menuconfig</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;&lt;Enter&gt; will then unroll the appropriate category, or enfold it if it</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;is already unrolled.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Note that this mode can eventually be a little more CPU expensive</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;(especially with a larger number of unrolled categories) than the</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;default mode.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Different color themes available</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;--------------------------------</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;It is possible to select different color themes using the variable</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;MENUCONFIG_COLOR. To select a theme use:</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;make MENUCONFIG_COLOR=&lt;theme&gt; menuconfig</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;Available themes are</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot; mono       =&gt; selects colors suitable for monochrome displays</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot; blackbg    =&gt; selects a color scheme with black background</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot; classic    =&gt; theme with blue background. The classic look</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot; bluetitle  =&gt; a LCD friendly version of classic. (default)</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">),</span>
<span class="n">menu_instructions</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
	<span class="s">&quot;Arrow keys navigate the menu.  &quot;</span>
	<span class="s">&quot;&lt;Enter&gt; selects submenus ---&gt;.  &quot;</span>
	<span class="s">&quot;Highlighted letters are hotkeys.  &quot;</span>
	<span class="s">&quot;Pressing &lt;Y&gt; includes, &lt;N&gt; excludes, &lt;M&gt; modularizes features.  &quot;</span>
	<span class="s">&quot;Press &lt;Esc&gt;&lt;Esc&gt; to exit, &lt;?&gt; for Help, &lt;/&gt; for Search.  &quot;</span>
	<span class="s">&quot;Legend: [*] built-in  [ ] excluded  &lt;M&gt; module  &lt; &gt; module capable&quot;</span><span class="p">),</span>
<span class="n">radiolist_instructions</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
	<span class="s">&quot;Use the arrow keys to navigate this window or &quot;</span>
	<span class="s">&quot;press the hotkey of the item you wish to select &quot;</span>
	<span class="s">&quot;followed by the &lt;SPACE BAR&gt;. &quot;</span>
	<span class="s">&quot;Press &lt;?&gt; for additional information about this option.&quot;</span><span class="p">),</span>
<span class="n">inputbox_instructions_int</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
	<span class="s">&quot;Please enter a decimal value. &quot;</span>
	<span class="s">&quot;Fractions will not be accepted.  &quot;</span>
	<span class="s">&quot;Use the &lt;TAB&gt; key to move from the input field to the buttons below it.&quot;</span><span class="p">),</span>
<span class="n">inputbox_instructions_hex</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
	<span class="s">&quot;Please enter a hexadecimal value. &quot;</span>
	<span class="s">&quot;Use the &lt;TAB&gt; key to move from the input field to the buttons below it.&quot;</span><span class="p">),</span>
<span class="n">inputbox_instructions_string</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
	<span class="s">&quot;Please enter a string value. &quot;</span>
	<span class="s">&quot;Use the &lt;TAB&gt; key to move from the input field to the buttons below it.&quot;</span><span class="p">),</span>
<span class="n">setmod_text</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
	<span class="s">&quot;This feature depends on another which has been configured as a module.</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;As a result, this feature will be built as a module.&quot;</span><span class="p">),</span>
<span class="n">load_config_text</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
	<span class="s">&quot;Enter the name of the configuration file you wish to load.  &quot;</span>
	<span class="s">&quot;Accept the name shown to restore the configuration you &quot;</span>
	<span class="s">&quot;last retrieved.  Leave blank to abort.&quot;</span><span class="p">),</span>
<span class="n">load_config_help</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
	<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;For various reasons, one may wish to keep several different</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;configurations available on a single machine.</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;If you have saved a previous configuration in a file other than the</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;default one, entering its name here will allow you to modify that</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;configuration.</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;If you are uncertain, then you have probably never used alternate</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;configuration files. You should therefore leave this blank to abort.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">),</span>
<span class="n">save_config_text</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
	<span class="s">&quot;Enter a filename to which this configuration should be saved &quot;</span>
	<span class="s">&quot;as an alternate.  Leave blank to abort.&quot;</span><span class="p">),</span>
<span class="n">save_config_help</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
	<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;For various reasons, one may wish to keep different configurations</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;available on a single machine.</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Entering a file name here will allow you to later retrieve, modify</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;and use the current configuration as an alternate to whatever</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;configuration options you have selected at that time.</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;If you are uncertain what all this means then you should probably</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;leave this blank.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">),</span>
<span class="n">search_help</span><span class="p">[]</span> <span class="o">=</span> <span class="n">N_</span><span class="p">(</span>
	<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Search for symbols and display their relations.</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Regular expressions are allowed.</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Example: search for </span><span class="se">\&quot;</span><span class="s">^FOO</span><span class="se">\&quot;\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Result:</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Symbol: FOO [=m]</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Prompt: Foo bus is used to drive the bar HW</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Defined at drivers/pci/Kconfig:47</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Depends on: X86_LOCAL_APIC &amp;&amp; X86_IO_APIC || IA64</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Location:</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;  -&gt; Bus options (PCI, PCMCIA, EISA, ISA)</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;    -&gt; PCI support (PCI [=y])</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;      -&gt; PCI access mode (&lt;choice&gt; [=y])</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Selects: LIBCRC32</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Selected by: BAR</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;o The line &#39;Prompt:&#39; shows the text used in the menu structure for</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;  this symbol</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;o The &#39;Defined at&#39; line tell at what file / line number the symbol</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;  is defined</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;o The &#39;Depends on:&#39; line tell what symbols needs to be defined for</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;  this symbol to be visible in the menu (selectable)</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;o The &#39;Location:&#39; lines tell where in the menu structure this symbol</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;  is located</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;    A location followed by a [=y] indicate that this is a selectable</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;    menu item - and current value is displayed inside brackets.</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;o The &#39;Selects:&#39; line tell what symbol will be automatically</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;  selected if this symbol is selected (y or m)</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;o The &#39;Selected by&#39; line tell what symbol has selected this symbol</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Only relevant lines are shown.</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Search examples:</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;Examples: USB	=&gt; find all symbols containing USB</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;          ^USB =&gt; find all symbols starting with USB</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;          USB$ =&gt; find all symbols ending with USB</span><span class="se">\n</span><span class="s">&quot;</span>
	<span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">indent</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">current_menu</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">child_count</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">single_menu_mode</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">show_all_options</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">saved_x</span><span class="p">,</span> <span class="n">saved_y</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">conf</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">conf_choice</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">conf_string</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">conf_load</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">conf_save</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">show_textbox</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">title</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">text</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">show_helptext</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">title</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">text</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">show_help</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">filename</span><span class="p">[</span><span class="n">PATH_MAX</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">set_config_filename</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">config_filename</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="n">menu_backtitle</span><span class="p">[</span><span class="n">PATH_MAX</span><span class="o">+</span><span class="mi">128</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">size</span> <span class="o">=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">menu_backtitle</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">menu_backtitle</span><span class="p">),</span>
	                <span class="s">&quot;%s - %s&quot;</span><span class="p">,</span> <span class="n">config_filename</span><span class="p">,</span> <span class="n">rootmenu</span><span class="p">.</span><span class="n">prompt</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">menu_backtitle</span><span class="p">))</span>
		<span class="n">menu_backtitle</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">menu_backtitle</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
	<span class="n">set_dialog_backtitle</span><span class="p">(</span><span class="n">menu_backtitle</span><span class="p">);</span>

	<span class="n">size</span> <span class="o">=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">config_filename</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
		<span class="n">filename</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">search_conf</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">symbol</span> <span class="o">**</span><span class="n">sym_arr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gstr</span> <span class="n">res</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dialog_input</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dres</span><span class="p">;</span>
<span class="nl">again:</span>
	<span class="n">dialog_clear</span><span class="p">();</span>
	<span class="n">dres</span> <span class="o">=</span> <span class="n">dialog_inputbox</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Search Configuration Parameter&quot;</span><span class="p">),</span>
			      <span class="n">_</span><span class="p">(</span><span class="s">&quot;Enter &quot;</span> <span class="n">CONFIG_</span> <span class="s">&quot; (sub)string to search for &quot;</span>
				<span class="s">&quot;(with or without </span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="n">CONFIG_</span> <span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">)&quot;</span><span class="p">),</span>
			      <span class="mi">10</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">dres</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">show_helptext</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Search Configuration&quot;</span><span class="p">),</span> <span class="n">search_help</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">again</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* strip the prefix if necessary */</span>
	<span class="n">dialog_input</span> <span class="o">=</span> <span class="n">dialog_input_result</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">strncasecmp</span><span class="p">(</span><span class="n">dialog_input_result</span><span class="p">,</span> <span class="n">CONFIG_</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">CONFIG_</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">dialog_input</span> <span class="o">+=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">CONFIG_</span><span class="p">);</span>

	<span class="n">sym_arr</span> <span class="o">=</span> <span class="n">sym_re_search</span><span class="p">(</span><span class="n">dialog_input</span><span class="p">);</span>
	<span class="n">res</span> <span class="o">=</span> <span class="n">get_relations_str</span><span class="p">(</span><span class="n">sym_arr</span><span class="p">);</span>
	<span class="n">free</span><span class="p">(</span><span class="n">sym_arr</span><span class="p">);</span>
	<span class="n">show_textbox</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Search Results&quot;</span><span class="p">),</span> <span class="n">str_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">str_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">build_conf</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">symbol</span> <span class="o">*</span><span class="n">sym</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">property</span> <span class="o">*</span><span class="n">prop</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">child</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">doint</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">tristate</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">visible</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * note: menu_is_visible() has side effect that it will</span>
<span class="cm">	 * recalc the value of the symbol.</span>
<span class="cm">	 */</span>
	<span class="n">visible</span> <span class="o">=</span> <span class="n">menu_is_visible</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">show_all_options</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">menu_has_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">show_all_options</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">visible</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">sym</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">;</span>
	<span class="n">prop</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">prompt</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sym</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">prop</span> <span class="o">&amp;&amp;</span> <span class="n">menu</span> <span class="o">!=</span> <span class="n">current_menu</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">prop</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="n">P_MENU</span>:
				<span class="n">child_count</span><span class="o">++</span><span class="p">;</span>
				<span class="n">prompt</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">prompt</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">single_menu_mode</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;%s%*c%s&quot;</span><span class="p">,</span>
						  <span class="n">menu</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">?</span> <span class="s">&quot;--&gt;&quot;</span> <span class="o">:</span> <span class="s">&quot;++&gt;&quot;</span><span class="p">,</span>
						  <span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">prompt</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;   %*c%s  ---&gt;&quot;</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">prompt</span><span class="p">);</span>

				<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;m&#39;</span><span class="p">);</span>
				<span class="n">item_set_data</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">single_menu_mode</span> <span class="o">&amp;&amp;</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span>
					<span class="k">goto</span> <span class="n">conf_childs</span><span class="p">;</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">P_COMMENT</span>:
				<span class="k">if</span> <span class="p">(</span><span class="n">prompt</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">child_count</span><span class="o">++</span><span class="p">;</span>
					<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;   %*c*** %s ***&quot;</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="n">prompt</span><span class="p">));</span>
					<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;:&#39;</span><span class="p">);</span>
					<span class="n">item_set_data</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="nl">default:</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">prompt</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">child_count</span><span class="o">++</span><span class="p">;</span>
					<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;---%*c%s&quot;</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="n">prompt</span><span class="p">));</span>
					<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;:&#39;</span><span class="p">);</span>
					<span class="n">item_set_data</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">doint</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">conf_childs</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">type</span> <span class="o">=</span> <span class="n">sym_get_type</span><span class="p">(</span><span class="n">sym</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sym_is_choice</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">symbol</span> <span class="o">*</span><span class="n">def_sym</span> <span class="o">=</span> <span class="n">sym_get_choice_value</span><span class="p">(</span><span class="n">sym</span><span class="p">);</span>
		<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">def_menu</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

		<span class="n">child_count</span><span class="o">++</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">child</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">;</span> <span class="n">child</span><span class="p">;</span> <span class="n">child</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">menu_is_visible</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">sym</span> <span class="o">==</span> <span class="n">def_sym</span><span class="p">)</span>
				<span class="n">def_menu</span> <span class="o">=</span> <span class="n">child</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">val</span> <span class="o">=</span> <span class="n">sym_get_tristate_value</span><span class="p">(</span><span class="n">sym</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sym_is_changable</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="n">S_BOOLEAN</span>:
				<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;[%c]&quot;</span><span class="p">,</span> <span class="n">val</span> <span class="o">==</span> <span class="n">no</span> <span class="o">?</span> <span class="sc">&#39; &#39;</span> <span class="o">:</span> <span class="sc">&#39;*&#39;</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">S_TRISTATE</span>:
				<span class="k">switch</span> <span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">case</span> <span class="n">yes</span>: <span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39;*&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="n">mod</span>: <span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39;M&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
				<span class="nl">default:</span>  <span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;&lt;%c&gt;&quot;</span><span class="p">,</span> <span class="n">ch</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;t&#39;</span><span class="p">);</span>
			<span class="n">item_set_data</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">);</span>
			<span class="n">item_set_tag</span><span class="p">(</span><span class="n">def_menu</span> <span class="o">?</span> <span class="sc">&#39;t&#39;</span> <span class="o">:</span> <span class="sc">&#39;:&#39;</span><span class="p">);</span>
			<span class="n">item_set_data</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">item_add_str</span><span class="p">(</span><span class="s">&quot;%*c%s&quot;</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">)));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">yes</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">def_menu</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">item_add_str</span><span class="p">(</span><span class="s">&quot; (%s)&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">def_menu</span><span class="p">)));</span>
				<span class="n">item_add_str</span><span class="p">(</span><span class="s">&quot;  ---&gt;&quot;</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">def_menu</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">indent</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
					<span class="n">build_conf</span><span class="p">(</span><span class="n">def_menu</span><span class="p">);</span>
					<span class="n">indent</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">menu</span> <span class="o">==</span> <span class="n">current_menu</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;---%*c%s&quot;</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">)));</span>
			<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;:&#39;</span><span class="p">);</span>
			<span class="n">item_set_data</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">conf_childs</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">child_count</span><span class="o">++</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">sym_get_tristate_value</span><span class="p">(</span><span class="n">sym</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sym_is_choice_value</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">val</span> <span class="o">==</span> <span class="n">yes</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;   &quot;</span><span class="p">);</span>
			<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;:&#39;</span><span class="p">);</span>
			<span class="n">item_set_data</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="n">S_BOOLEAN</span>:
				<span class="k">if</span> <span class="p">(</span><span class="n">sym_is_changable</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span>
					<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;[%c]&quot;</span><span class="p">,</span> <span class="n">val</span> <span class="o">==</span> <span class="n">no</span> <span class="o">?</span> <span class="sc">&#39; &#39;</span> <span class="o">:</span> <span class="sc">&#39;*&#39;</span><span class="p">);</span>
				<span class="k">else</span>
					<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;-%c-&quot;</span><span class="p">,</span> <span class="n">val</span> <span class="o">==</span> <span class="n">no</span> <span class="o">?</span> <span class="sc">&#39; &#39;</span> <span class="o">:</span> <span class="sc">&#39;*&#39;</span><span class="p">);</span>
				<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;t&#39;</span><span class="p">);</span>
				<span class="n">item_set_data</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">S_TRISTATE</span>:
				<span class="k">switch</span> <span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">case</span> <span class="n">yes</span>: <span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39;*&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="n">mod</span>: <span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39;M&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
				<span class="nl">default:</span>  <span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">sym_is_changable</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">sym</span><span class="o">-&gt;</span><span class="n">rev_dep</span><span class="p">.</span><span class="n">tri</span> <span class="o">==</span> <span class="n">mod</span><span class="p">)</span>
						<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;{%c}&quot;</span><span class="p">,</span> <span class="n">ch</span><span class="p">);</span>
					<span class="k">else</span>
						<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;&lt;%c&gt;&quot;</span><span class="p">,</span> <span class="n">ch</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;-%c-&quot;</span><span class="p">,</span> <span class="n">ch</span><span class="p">);</span>
				<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;t&#39;</span><span class="p">);</span>
				<span class="n">item_set_data</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="nl">default:</span>
				<span class="n">tmp</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">sym_get_string_value</span><span class="p">(</span><span class="n">sym</span><span class="p">));</span> <span class="cm">/* () = 2 */</span>
				<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;(%s)&quot;</span><span class="p">,</span> <span class="n">sym_get_string_value</span><span class="p">(</span><span class="n">sym</span><span class="p">));</span>
				<span class="n">tmp</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">-</span> <span class="n">tmp</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
					<span class="n">tmp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">item_add_str</span><span class="p">(</span><span class="s">&quot;%*c%s%s&quot;</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">)),</span>
					     <span class="p">(</span><span class="n">sym_has_value</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">sym_is_changable</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span> <span class="o">?</span>
					     <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot; (NEW)&quot;</span><span class="p">));</span>
				<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;s&#39;</span><span class="p">);</span>
				<span class="n">item_set_data</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
				<span class="k">goto</span> <span class="n">conf_childs</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">item_add_str</span><span class="p">(</span><span class="s">&quot;%*c%s%s&quot;</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">)),</span>
			  <span class="p">(</span><span class="n">sym_has_value</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">sym_is_changable</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span> <span class="o">?</span>
			  <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot; (NEW)&quot;</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">menu</span><span class="o">-&gt;</span><span class="n">prompt</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">P_MENU</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">item_add_str</span><span class="p">(</span><span class="s">&quot;  ---&gt;&quot;</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

<span class="nl">conf_childs:</span>
	<span class="n">indent</span> <span class="o">+=</span> <span class="n">doint</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">child</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">;</span> <span class="n">child</span><span class="p">;</span> <span class="n">child</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
		<span class="n">build_conf</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
	<span class="n">indent</span> <span class="o">-=</span> <span class="n">doint</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">conf</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">submenu</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">symbol</span> <span class="o">*</span><span class="n">sym</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">active_menu</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">res</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">s_scroll</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">item_reset</span><span class="p">();</span>
		<span class="n">current_menu</span> <span class="o">=</span> <span class="n">menu</span><span class="p">;</span>
		<span class="n">build_conf</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">child_count</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">menu</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;--- &quot;</span><span class="p">);</span>
			<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;:&#39;</span><span class="p">);</span>
			<span class="n">item_make</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;    Load an Alternate Configuration File&quot;</span><span class="p">));</span>
			<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;L&#39;</span><span class="p">);</span>
			<span class="n">item_make</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;    Save an Alternate Configuration File&quot;</span><span class="p">));</span>
			<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;S&#39;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">dialog_clear</span><span class="p">();</span>
		<span class="n">res</span> <span class="o">=</span> <span class="n">dialog_menu</span><span class="p">(</span><span class="n">prompt</span> <span class="o">?</span> <span class="n">_</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span> <span class="o">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Main Menu&quot;</span><span class="p">),</span>
				  <span class="n">_</span><span class="p">(</span><span class="n">menu_instructions</span><span class="p">),</span>
				  <span class="n">active_menu</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s_scroll</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">res</span> <span class="o">==</span> <span class="n">KEY_ESC</span> <span class="o">||</span> <span class="n">res</span> <span class="o">==</span> <span class="o">-</span><span class="n">ERRDISPLAYTOOSMALL</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">item_activate_selected</span><span class="p">())</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">item_tag</span><span class="p">())</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="n">submenu</span> <span class="o">=</span> <span class="n">item_data</span><span class="p">();</span>
		<span class="n">active_menu</span> <span class="o">=</span> <span class="n">item_data</span><span class="p">();</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">submenu</span><span class="p">)</span>
			<span class="n">sym</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">sym</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="k">switch</span> <span class="p">(</span><span class="n">item_tag</span><span class="p">())</span> <span class="p">{</span>
			<span class="k">case</span> <span class="sc">&#39;m&#39;</span>:
				<span class="k">if</span> <span class="p">(</span><span class="n">single_menu_mode</span><span class="p">)</span>
					<span class="n">submenu</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="o">!</span><span class="n">submenu</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
				<span class="k">else</span>
					<span class="n">conf</span><span class="p">(</span><span class="n">submenu</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">&#39;t&#39;</span>:
				<span class="k">if</span> <span class="p">(</span><span class="n">sym_is_choice</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">sym_get_tristate_value</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">==</span> <span class="n">yes</span><span class="p">)</span>
					<span class="n">conf_choice</span><span class="p">(</span><span class="n">submenu</span><span class="p">);</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">submenu</span><span class="o">-&gt;</span><span class="n">prompt</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">P_MENU</span><span class="p">)</span>
					<span class="n">conf</span><span class="p">(</span><span class="n">submenu</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">&#39;s&#39;</span>:
				<span class="n">conf_string</span><span class="p">(</span><span class="n">submenu</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">&#39;L&#39;</span>:
				<span class="n">conf_load</span><span class="p">();</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">&#39;S&#39;</span>:
				<span class="n">conf_save</span><span class="p">();</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">sym</span><span class="p">)</span>
				<span class="n">show_help</span><span class="p">(</span><span class="n">submenu</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">show_helptext</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;README&quot;</span><span class="p">),</span> <span class="n">_</span><span class="p">(</span><span class="n">mconf_readme</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">item_is_tag</span><span class="p">(</span><span class="sc">&#39;t&#39;</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">sym_set_tristate_value</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">yes</span><span class="p">))</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">sym_set_tristate_value</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">mod</span><span class="p">))</span>
					<span class="n">show_textbox</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">setmod_text</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">74</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">4</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">item_is_tag</span><span class="p">(</span><span class="sc">&#39;t&#39;</span><span class="p">))</span>
				<span class="n">sym_set_tristate_value</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">no</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">5</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">item_is_tag</span><span class="p">(</span><span class="sc">&#39;t&#39;</span><span class="p">))</span>
				<span class="n">sym_set_tristate_value</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">mod</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">6</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">item_is_tag</span><span class="p">(</span><span class="sc">&#39;t&#39;</span><span class="p">))</span>
				<span class="n">sym_toggle_tristate_value</span><span class="p">(</span><span class="n">sym</span><span class="p">);</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">item_is_tag</span><span class="p">(</span><span class="sc">&#39;m&#39;</span><span class="p">))</span>
				<span class="n">conf</span><span class="p">(</span><span class="n">submenu</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">7</span>:
			<span class="n">search_conf</span><span class="p">();</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">8</span>:
			<span class="n">show_all_options</span> <span class="o">=</span> <span class="o">!</span><span class="n">show_all_options</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">show_textbox</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">title</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">text</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dialog_clear</span><span class="p">();</span>
	<span class="n">dialog_textbox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">show_helptext</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">title</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">text</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">show_textbox</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">show_help</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">gstr</span> <span class="n">help</span> <span class="o">=</span> <span class="n">str_new</span><span class="p">();</span>

	<span class="n">help</span><span class="p">.</span><span class="n">max_width</span> <span class="o">=</span> <span class="n">getmaxx</span><span class="p">(</span><span class="n">stdscr</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">;</span>
	<span class="n">menu_get_ext_help</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">help</span><span class="p">);</span>

	<span class="n">show_helptext</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">)),</span> <span class="n">str_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">help</span><span class="p">));</span>
	<span class="n">str_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">help</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">conf_choice</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">));</span>
	<span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">child</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">symbol</span> <span class="o">*</span><span class="n">active</span><span class="p">;</span>

	<span class="n">active</span> <span class="o">=</span> <span class="n">sym_get_choice_value</span><span class="p">(</span><span class="n">menu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">res</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">selected</span><span class="p">;</span>
		<span class="n">item_reset</span><span class="p">();</span>

		<span class="n">current_menu</span> <span class="o">=</span> <span class="n">menu</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">child</span> <span class="o">=</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">;</span> <span class="n">child</span><span class="p">;</span> <span class="n">child</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">menu_is_visible</span><span class="p">(</span><span class="n">child</span><span class="p">))</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">)</span>
				<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">child</span><span class="p">)));</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">item_make</span><span class="p">(</span><span class="s">&quot;*** %s ***&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">child</span><span class="p">)));</span>
				<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;:&#39;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">item_set_data</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">sym</span> <span class="o">==</span> <span class="n">active</span><span class="p">)</span>
				<span class="n">item_set_selected</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">sym</span> <span class="o">==</span> <span class="n">sym_get_choice_value</span><span class="p">(</span><span class="n">menu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">))</span>
				<span class="n">item_set_tag</span><span class="p">(</span><span class="sc">&#39;X&#39;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">dialog_clear</span><span class="p">();</span>
		<span class="n">res</span> <span class="o">=</span> <span class="n">dialog_checklist</span><span class="p">(</span><span class="n">prompt</span> <span class="o">?</span> <span class="n">_</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span> <span class="o">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Main Menu&quot;</span><span class="p">),</span>
					<span class="n">_</span><span class="p">(</span><span class="n">radiolist_instructions</span><span class="p">),</span>
					 <span class="mi">15</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
		<span class="n">selected</span> <span class="o">=</span> <span class="n">item_activate_selected</span><span class="p">();</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">selected</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">child</span> <span class="o">=</span> <span class="n">item_data</span><span class="p">();</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">)</span>
					<span class="k">break</span><span class="p">;</span>

				<span class="n">sym_set_tristate_value</span><span class="p">(</span><span class="n">child</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">,</span> <span class="n">yes</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">selected</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">child</span> <span class="o">=</span> <span class="n">item_data</span><span class="p">();</span>
				<span class="n">show_help</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
				<span class="n">active</span> <span class="o">=</span> <span class="n">child</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span>
				<span class="n">show_help</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">KEY_ESC</span>:
			<span class="k">return</span><span class="p">;</span>
		<span class="k">case</span> <span class="o">-</span><span class="n">ERRDISPLAYTOOSMALL</span>:
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">conf_string</span><span class="p">(</span><span class="k">struct</span> <span class="n">menu</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">menu_get_prompt</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>

	<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">res</span><span class="p">;</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">heading</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">sym_get_type</span><span class="p">(</span><span class="n">menu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">S_INT</span>:
			<span class="n">heading</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">inputbox_instructions_int</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">S_HEX</span>:
			<span class="n">heading</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">inputbox_instructions_hex</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">S_STRING</span>:
			<span class="n">heading</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">inputbox_instructions_string</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">heading</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Internal mconf error!&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">dialog_clear</span><span class="p">();</span>
		<span class="n">res</span> <span class="o">=</span> <span class="n">dialog_inputbox</span><span class="p">(</span><span class="n">prompt</span> <span class="o">?</span> <span class="n">_</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span> <span class="o">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Main Menu&quot;</span><span class="p">),</span>
				      <span class="n">heading</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span>
				      <span class="n">sym_get_string_value</span><span class="p">(</span><span class="n">menu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">));</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">sym_set_string_value</span><span class="p">(</span><span class="n">menu</span><span class="o">-&gt;</span><span class="n">sym</span><span class="p">,</span> <span class="n">dialog_input_result</span><span class="p">))</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="n">show_textbox</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;You have made an invalid entry.&quot;</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">43</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">show_help</span><span class="p">(</span><span class="n">menu</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">KEY_ESC</span>:
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">conf_load</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">res</span><span class="p">;</span>
		<span class="n">dialog_clear</span><span class="p">();</span>
		<span class="n">res</span> <span class="o">=</span> <span class="n">dialog_inputbox</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">load_config_text</span><span class="p">,</span>
				      <span class="mi">11</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>
		<span class="k">switch</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dialog_input_result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">conf_read</span><span class="p">(</span><span class="n">dialog_input_result</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">set_config_filename</span><span class="p">(</span><span class="n">dialog_input_result</span><span class="p">);</span>
				<span class="n">sym_set_change_count</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">show_textbox</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;File does not exist!&quot;</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">38</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">show_helptext</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Load Alternate Configuration&quot;</span><span class="p">),</span> <span class="n">load_config_help</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">KEY_ESC</span>:
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">conf_save</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">res</span><span class="p">;</span>
		<span class="n">dialog_clear</span><span class="p">();</span>
		<span class="n">res</span> <span class="o">=</span> <span class="n">dialog_inputbox</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">save_config_text</span><span class="p">,</span>
				      <span class="mi">11</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="n">filename</span><span class="p">);</span>
		<span class="k">switch</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dialog_input_result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">conf_write</span><span class="p">(</span><span class="n">dialog_input_result</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">set_config_filename</span><span class="p">(</span><span class="n">dialog_input_result</span><span class="p">);</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">show_textbox</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Can&#39;t create file!  Probably a nonexistent directory.&quot;</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">60</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">show_helptext</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Save Alternate Configuration&quot;</span><span class="p">),</span> <span class="n">save_config_help</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">KEY_ESC</span>:
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">handle_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">res</span><span class="p">;</span>

	<span class="n">dialog_clear</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">conf_get_changed</span><span class="p">())</span>
		<span class="n">res</span> <span class="o">=</span> <span class="n">dialog_yesno</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span>
				   <span class="n">_</span><span class="p">(</span><span class="s">&quot;Do you wish to save your new configuration ?</span><span class="se">\n</span><span class="s">&quot;</span>
				     <span class="s">&quot;&lt;ESC&gt;&lt;ESC&gt; to continue.&quot;</span><span class="p">),</span>
				   <span class="mi">6</span><span class="p">,</span> <span class="mi">60</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">end_dialog</span><span class="p">(</span><span class="n">saved_x</span><span class="p">,</span> <span class="n">saved_y</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">conf_write</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span>
					  <span class="s">&quot;Error while writing of the configuration.</span><span class="se">\n</span><span class="s">&quot;</span>
					  <span class="s">&quot;Your configuration changes were NOT saved.&quot;</span>
					  <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">));</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="cm">/* fall through */</span>
	<span class="k">case</span> <span class="o">-</span><span class="mi">1</span>:
		<span class="n">printf</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span>
			 <span class="s">&quot;*** End of the configuration.</span><span class="se">\n</span><span class="s">&quot;</span>
			 <span class="s">&quot;*** Execute &#39;make&#39; to start the build or try &#39;make help&#39;.&quot;</span>
			 <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">));</span>
		<span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span>
				  <span class="s">&quot;Your configuration changes were NOT saved.&quot;</span>
				  <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">!=</span> <span class="n">KEY_ESC</span><span class="p">)</span>
			<span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sig_handler</span><span class="p">(</span><span class="kt">int</span> <span class="n">signo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">exit</span><span class="p">(</span><span class="n">handle_exit</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">ac</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">av</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">mode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">res</span><span class="p">;</span>

	<span class="n">setlocale</span><span class="p">(</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
	<span class="n">bindtextdomain</span><span class="p">(</span><span class="n">PACKAGE</span><span class="p">,</span> <span class="n">LOCALEDIR</span><span class="p">);</span>
	<span class="n">textdomain</span><span class="p">(</span><span class="n">PACKAGE</span><span class="p">);</span>

	<span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">sig_handler</span><span class="p">);</span>

	<span class="n">conf_parse</span><span class="p">(</span><span class="n">av</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">conf_read</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

	<span class="n">mode</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s">&quot;MENUCONFIG_MODE&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="s">&quot;single_menu&quot;</span><span class="p">))</span>
			<span class="n">single_menu_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">initscr</span><span class="p">();</span>

	<span class="n">getyx</span><span class="p">(</span><span class="n">stdscr</span><span class="p">,</span> <span class="n">saved_y</span><span class="p">,</span> <span class="n">saved_x</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">init_dialog</span><span class="p">(</span><span class="nb">NULL</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">N_</span><span class="p">(</span><span class="s">&quot;Your display is too small to run Menuconfig!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
		<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">N_</span><span class="p">(</span><span class="s">&quot;It must be at least 19 lines by 80 columns.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">set_config_filename</span><span class="p">(</span><span class="n">conf_get_configname</span><span class="p">());</span>
	<span class="k">do</span> <span class="p">{</span>
		<span class="n">conf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rootmenu</span><span class="p">);</span>
		<span class="n">res</span> <span class="o">=</span> <span class="n">handle_exit</span><span class="p">();</span>
	<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="n">KEY_ESC</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
