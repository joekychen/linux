<!DOCTYPE html>
<html><head><title>joekychen/linux » scripts › get_maintainer.pl

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../index.html"></a><h1>get_maintainer.pl</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="c1">#!/usr/bin/perl -w</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>(c) 2007, Joe Perches <a href="&#109;&#97;&#105;&#x6C;&#116;&#111;:&#x6A;&#111;&#x65;&#64;&#x70;&#101;&#x72;c&#x68;&#x65;&#x73;&#x2E;&#99;&#x6F;&#x6D;">&#x6A;&#111;&#x65;&#64;&#x70;&#101;&#x72;c&#x68;&#x65;&#x73;&#x2E;&#99;&#x6F;&#x6D;</a>
          created from checkpatch.pl</p>

<p>Print selected MAINTAINERS information for
the files modified in a patch or for a file</p>

<p>usage: perl scripts/get<em>maintainer.pl [OPTIONS] <patch>
       perl scripts/get</em>maintainer.pl [OPTIONS] -f <file></p>

<p>Licensed under the terms of the GNU GPL License version 2</p></td><td class="code"><div class="highlight"><pre><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$P</span> <span class="o">=</span> <span class="nv">$0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$V</span> <span class="o">=</span> <span class="s">&#39;0.26&#39;</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">Getopt::</span><span class="n">Long</span> <span class="sx">qw(:config no_auto_abbrev)</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$lk_path</span> <span class="o">=</span> <span class="s">&quot;./&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_usename</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_maintainer</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_list</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_subscriber_list</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_git_penguin_chiefs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_git</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_git_all_signature_types</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_git_blame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_git_blame_signatures</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_git_fallback</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_git_min_signatures</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_git_max_maintainers</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_git_min_percent</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_git_since</span> <span class="o">=</span> <span class="s">&quot;1-year-ago&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_hg_since</span> <span class="o">=</span> <span class="s">&quot;-365&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$interactive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_remove_duplicates</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$email_use_mailmap</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$output_multiline</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$output_separator</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$output_roles</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$output_rolestats</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$scm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$web</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$subsystem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$keywords</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$sections</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$file_emails</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$from_filename</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$pattern_depth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$version</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$help</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$vcs_used</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$exit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">%commit_author_hash</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">%commit_signer_hash</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">@penguin_chief</span> <span class="o">=</span> <span class="p">();</span>
<span class="nb">push</span><span class="p">(</span><span class="nv">@penguin_chief</span><span class="p">,</span> <span class="s">&quot;Linus Torvalds:torvalds\@linux-foundation.org&quot;</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Andrew wants in on most everything - 2009/01/14
push(@penguin_chief, "Andrew Morton:akpm\@linux-foundation.org");</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">@penguin_chief_names</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$chief</span> <span class="p">(</span><span class="nv">@penguin_chief</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$chief</span> <span class="o">=~</span> <span class="sr">m/^(.*):(.*)/</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$chief_name</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$chief_addr</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	<span class="nb">push</span><span class="p">(</span><span class="nv">@penguin_chief_names</span><span class="p">,</span> <span class="nv">$chief_name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">my</span> <span class="nv">$penguin_chiefs</span> <span class="o">=</span> <span class="s">&quot;\(&quot;</span> <span class="o">.</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="p">,</span> <span class="nv">@penguin_chief_names</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;\)&quot;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Signature types of people who are either
    a) responsible for the code in question, or
    b) familiar enough with it to give relevant feedback</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">@signature_tags</span> <span class="o">=</span> <span class="p">();</span>
<span class="nb">push</span><span class="p">(</span><span class="nv">@signature_tags</span><span class="p">,</span> <span class="s">&quot;Signed-off-by:&quot;</span><span class="p">);</span>
<span class="nb">push</span><span class="p">(</span><span class="nv">@signature_tags</span><span class="p">,</span> <span class="s">&quot;Reviewed-by:&quot;</span><span class="p">);</span>
<span class="nb">push</span><span class="p">(</span><span class="nv">@signature_tags</span><span class="p">,</span> <span class="s">&quot;Acked-by:&quot;</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">$signature_pattern</span> <span class="o">=</span> <span class="s">&quot;\(&quot;</span> <span class="o">.</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="p">,</span> <span class="nv">@signature_tags</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;\)&quot;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>rfc822 email address - preloaded methods go here.</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">$rfc822_lwsp</span> <span class="o">=</span> <span class="s">&quot;(?:(?:\\r\\n)?[ \\t])&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$rfc822_char</span> <span class="o">=</span> <span class="s">&#39;[\\000-\\377]&#39;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>VCS command support: class-like functions and strings</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">%VCS_cmds</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">%VCS_cmds_git</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&quot;execute_cmd&quot;</span> <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">git_execute_cmd</span><span class="p">,</span>
    <span class="s">&quot;available&quot;</span> <span class="o">=&gt;</span> <span class="s">&#39;(which(&quot;git&quot;) ne &quot;&quot;) &amp;&amp; (-d &quot;.git&quot;)&#39;</span><span class="p">,</span>
    <span class="s">&quot;find_signers_cmd&quot;</span> <span class="o">=&gt;</span>
	<span class="s">&quot;git log --no-color --follow --since=\$email_git_since &quot;</span> <span class="o">.</span>
	    <span class="s">&#39;--format=&quot;GitCommit: %H%n&#39;</span> <span class="o">.</span>
		      <span class="s">&#39;GitAuthor: %an &lt;%ae&gt;%n&#39;</span> <span class="o">.</span>
		      <span class="s">&#39;GitDate: %aD%n&#39;</span> <span class="o">.</span>
		      <span class="s">&#39;GitSubject: %s%n&#39;</span> <span class="o">.</span>
		      <span class="s">&#39;%b%n&quot;&#39;</span> <span class="o">.</span>
	    <span class="s">&quot; -- \$file&quot;</span><span class="p">,</span>
    <span class="s">&quot;find_commit_signers_cmd&quot;</span> <span class="o">=&gt;</span>
	<span class="s">&quot;git log --no-color &quot;</span> <span class="o">.</span>
	    <span class="s">&#39;--format=&quot;GitCommit: %H%n&#39;</span> <span class="o">.</span>
		      <span class="s">&#39;GitAuthor: %an &lt;%ae&gt;%n&#39;</span> <span class="o">.</span>
		      <span class="s">&#39;GitDate: %aD%n&#39;</span> <span class="o">.</span>
		      <span class="s">&#39;GitSubject: %s%n&#39;</span> <span class="o">.</span>
		      <span class="s">&#39;%b%n&quot;&#39;</span> <span class="o">.</span>
	    <span class="s">&quot; -1 \$commit&quot;</span><span class="p">,</span>
    <span class="s">&quot;find_commit_author_cmd&quot;</span> <span class="o">=&gt;</span>
	<span class="s">&quot;git log --no-color &quot;</span> <span class="o">.</span>
	    <span class="s">&#39;--format=&quot;GitCommit: %H%n&#39;</span> <span class="o">.</span>
		      <span class="s">&#39;GitAuthor: %an &lt;%ae&gt;%n&#39;</span> <span class="o">.</span>
		      <span class="s">&#39;GitDate: %aD%n&#39;</span> <span class="o">.</span>
		      <span class="s">&#39;GitSubject: %s%n&quot;&#39;</span> <span class="o">.</span>
	    <span class="s">&quot; -1 \$commit&quot;</span><span class="p">,</span>
    <span class="s">&quot;blame_range_cmd&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;git blame -l -L \$diff_start,+\$diff_length \$file&quot;</span><span class="p">,</span>
    <span class="s">&quot;blame_file_cmd&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;git blame -l \$file&quot;</span><span class="p">,</span>
    <span class="s">&quot;commit_pattern&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;^GitCommit: ([0-9a-f]{40,40})&quot;</span><span class="p">,</span>
    <span class="s">&quot;blame_commit_pattern&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;^([0-9a-f]+) &quot;</span><span class="p">,</span>
    <span class="s">&quot;author_pattern&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;^GitAuthor: (.*)&quot;</span><span class="p">,</span>
    <span class="s">&quot;subject_pattern&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;^GitSubject: (.*)&quot;</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">my</span> <span class="nv">%VCS_cmds_hg</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&quot;execute_cmd&quot;</span> <span class="o">=&gt;</span> <span class="o">\&amp;</span><span class="n">hg_execute_cmd</span><span class="p">,</span>
    <span class="s">&quot;available&quot;</span> <span class="o">=&gt;</span> <span class="s">&#39;(which(&quot;hg&quot;) ne &quot;&quot;) &amp;&amp; (-d &quot;.hg&quot;)&#39;</span><span class="p">,</span>
    <span class="s">&quot;find_signers_cmd&quot;</span> <span class="o">=&gt;</span>
	<span class="s">&quot;hg log --date=\$email_hg_since &quot;</span> <span class="o">.</span>
	    <span class="s">&quot;--template=&#39;HgCommit: {node}\\n&quot;</span> <span class="o">.</span>
	                <span class="s">&quot;HgAuthor: {author}\\n&quot;</span> <span class="o">.</span>
			<span class="s">&quot;HgSubject: {desc}\\n&#39;&quot;</span> <span class="o">.</span>
	    <span class="s">&quot; -- \$file&quot;</span><span class="p">,</span>
    <span class="s">&quot;find_commit_signers_cmd&quot;</span> <span class="o">=&gt;</span>
	<span class="s">&quot;hg log &quot;</span> <span class="o">.</span>
	    <span class="s">&quot;--template=&#39;HgSubject: {desc}\\n&#39;&quot;</span> <span class="o">.</span>
	    <span class="s">&quot; -r \$commit&quot;</span><span class="p">,</span>
    <span class="s">&quot;find_commit_author_cmd&quot;</span> <span class="o">=&gt;</span>
	<span class="s">&quot;hg log &quot;</span> <span class="o">.</span>
	    <span class="s">&quot;--template=&#39;HgCommit: {node}\\n&quot;</span> <span class="o">.</span>
		        <span class="s">&quot;HgAuthor: {author}\\n&quot;</span> <span class="o">.</span>
			<span class="s">&quot;HgSubject: {desc|firstline}\\n&#39;&quot;</span> <span class="o">.</span>
	    <span class="s">&quot; -r \$commit&quot;</span><span class="p">,</span>
    <span class="s">&quot;blame_range_cmd&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;&quot;</span><span class="p">,</span>		<span class="c1"># not supported</span>
    <span class="s">&quot;blame_file_cmd&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;hg blame -n \$file&quot;</span><span class="p">,</span>
    <span class="s">&quot;commit_pattern&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;^HgCommit: ([0-9a-f]{40,40})&quot;</span><span class="p">,</span>
    <span class="s">&quot;blame_commit_pattern&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;^([ 0-9a-f]+):&quot;</span><span class="p">,</span>
    <span class="s">&quot;author_pattern&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;^HgAuthor: (.*)&quot;</span><span class="p">,</span>
    <span class="s">&quot;subject_pattern&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;^HgSubject: (.*)&quot;</span><span class="p">,</span>
<span class="p">);</span>

<span class="k">my</span> <span class="nv">$conf</span> <span class="o">=</span> <span class="n">which_conf</span><span class="p">(</span><span class="s">&quot;.get_maintainer.conf&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="nv">$conf</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">@conf_args</span><span class="p">;</span>
    <span class="nb">open</span><span class="p">(</span><span class="k">my</span> <span class="nv">$conffile</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&quot;$conf&quot;</span><span class="p">)</span>
	<span class="ow">or</span> <span class="nb">warn</span> <span class="s">&quot;$P: Can&#39;t find a readable .get_maintainer.conf file $!\n&quot;</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="sr">&lt;$conffile&gt;</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$_</span><span class="p">;</span>

	<span class="nv">$line</span> <span class="o">=~</span> <span class="sr">s/\s*\n?$//g</span><span class="p">;</span>
	<span class="nv">$line</span> <span class="o">=~</span> <span class="sr">s/^\s*//g</span><span class="p">;</span>
	<span class="nv">$line</span> <span class="o">=~</span> <span class="sr">s/\s+/ /g</span><span class="p">;</span>

	<span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/^\s*#/</span><span class="p">);</span>
	<span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/^\s*$/</span><span class="p">);</span>

	<span class="k">my</span> <span class="nv">@words</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$word</span> <span class="p">(</span><span class="nv">@words</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">last</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$word</span> <span class="o">=~</span> <span class="sr">m/^#/</span><span class="p">);</span>
	    <span class="nb">push</span> <span class="p">(</span><span class="nv">@conf_args</span><span class="p">,</span> <span class="nv">$word</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="nb">close</span><span class="p">(</span><span class="nv">$conffile</span><span class="p">);</span>
    <span class="nb">unshift</span><span class="p">(</span><span class="nv">@ARGV</span><span class="p">,</span> <span class="nv">@conf_args</span><span class="p">)</span> <span class="k">if</span> <span class="nv">@conf_args</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">GetOptions</span><span class="p">(</span>
		<span class="s">&#39;email!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email</span><span class="p">,</span>
		<span class="s">&#39;git!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_git</span><span class="p">,</span>
		<span class="s">&#39;git-all-signature-types!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_git_all_signature_types</span><span class="p">,</span>
		<span class="s">&#39;git-blame!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_git_blame</span><span class="p">,</span>
		<span class="s">&#39;git-blame-signatures!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_git_blame_signatures</span><span class="p">,</span>
		<span class="s">&#39;git-fallback!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_git_fallback</span><span class="p">,</span>
		<span class="s">&#39;git-chief-penguins!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_git_penguin_chiefs</span><span class="p">,</span>
		<span class="s">&#39;git-min-signatures=i&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_git_min_signatures</span><span class="p">,</span>
		<span class="s">&#39;git-max-maintainers=i&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_git_max_maintainers</span><span class="p">,</span>
		<span class="s">&#39;git-min-percent=i&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_git_min_percent</span><span class="p">,</span>
		<span class="s">&#39;git-since=s&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_git_since</span><span class="p">,</span>
		<span class="s">&#39;hg-since=s&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_hg_since</span><span class="p">,</span>
		<span class="s">&#39;i|interactive!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$interactive</span><span class="p">,</span>
		<span class="s">&#39;remove-duplicates!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_remove_duplicates</span><span class="p">,</span>
		<span class="s">&#39;mailmap!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_use_mailmap</span><span class="p">,</span>
		<span class="s">&#39;m!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_maintainer</span><span class="p">,</span>
		<span class="s">&#39;n!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_usename</span><span class="p">,</span>
		<span class="s">&#39;l!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_list</span><span class="p">,</span>
		<span class="s">&#39;s!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$email_subscriber_list</span><span class="p">,</span>
		<span class="s">&#39;multiline!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$output_multiline</span><span class="p">,</span>
		<span class="s">&#39;roles!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$output_roles</span><span class="p">,</span>
		<span class="s">&#39;rolestats!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$output_rolestats</span><span class="p">,</span>
		<span class="s">&#39;separator=s&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$output_separator</span><span class="p">,</span>
		<span class="s">&#39;subsystem!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$subsystem</span><span class="p">,</span>
		<span class="s">&#39;status!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$status</span><span class="p">,</span>
		<span class="s">&#39;scm!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$scm</span><span class="p">,</span>
		<span class="s">&#39;web!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$web</span><span class="p">,</span>
		<span class="s">&#39;pattern-depth=i&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$pattern_depth</span><span class="p">,</span>
		<span class="s">&#39;k|keywords!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$keywords</span><span class="p">,</span>
		<span class="s">&#39;sections!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$sections</span><span class="p">,</span>
		<span class="s">&#39;fe|file-emails!&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$file_emails</span><span class="p">,</span>
		<span class="s">&#39;f|file&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$from_filename</span><span class="p">,</span>
		<span class="s">&#39;v|version&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$version</span><span class="p">,</span>
		<span class="s">&#39;h|help|usage&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$help</span><span class="p">,</span>
		<span class="p">))</span> <span class="p">{</span>
    <span class="nb">die</span> <span class="s">&quot;$P: invalid argument - use --help if necessary\n&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$help</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">usage</span><span class="p">();</span>
    <span class="nb">exit</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$version</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;${P} ${V}\n&quot;</span><span class="p">);</span>
    <span class="nb">exit</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="n">t</span> <span class="bp">STDIN</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">@ARGV</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>We're talking to a terminal, but have no command line arguments.</p></td><td class="code"><div class="highlight"><pre>    <span class="nb">die</span> <span class="s">&quot;$P: missing patchfile or -f file - use --help if necessary\n&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$output_multiline</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$output_separator</span> <span class="ow">ne</span> <span class="s">&quot;, &quot;</span><span class="p">);</span>
<span class="nv">$output_rolestats</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$interactive</span><span class="p">);</span>
<span class="nv">$output_roles</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$output_rolestats</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$sections</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$email</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$email_list</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$scm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$subsystem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$web</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$keywords</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$interactive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$selections</span> <span class="o">=</span> <span class="nv">$email</span> <span class="o">+</span> <span class="nv">$scm</span> <span class="o">+</span> <span class="nv">$status</span> <span class="o">+</span> <span class="nv">$subsystem</span> <span class="o">+</span> <span class="nv">$web</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$selections</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="nb">die</span> <span class="s">&quot;$P:  Missing required option: email, scm, status, subsystem or web\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$email</span> <span class="o">&amp;&amp;</span>
    <span class="p">(</span><span class="nv">$email_maintainer</span> <span class="o">+</span> <span class="nv">$email_list</span> <span class="o">+</span> <span class="nv">$email_subscriber_list</span> <span class="o">+</span>
     <span class="nv">$email_git</span> <span class="o">+</span> <span class="nv">$email_git_penguin_chiefs</span> <span class="o">+</span> <span class="nv">$email_git_blame</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">die</span> <span class="s">&quot;$P: Please select at least 1 email option\n&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">top_of_kernel_tree</span><span class="p">(</span><span class="nv">$lk_path</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">die</span> <span class="s">&quot;$P: The current directory does not appear to be &quot;</span>
	<span class="o">.</span> <span class="s">&quot;a linux kernel source tree.\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><h1>Read MAINTAINERS for type/value pairs</h1></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">@typevalue</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">%keyword_hash</span><span class="p">;</span>

<span class="nb">open</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$maint</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&quot;${lk_path}MAINTAINERS&quot;</span><span class="p">)</span>
    <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;$P: Can&#39;t open MAINTAINERS: $!\n&quot;</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="sr">&lt;$maint&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$_</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/^(\C):\s*(.*)/</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><h1>Filename pattern matching</h1></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&quot;F&quot;</span> <span class="o">||</span> <span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&quot;X&quot;</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$value</span> <span class="o">=~</span> <span class="sr">s@\.@\\\.@g</span><span class="p">;</span>       <span class="c1">##Convert . to \.</span>
	    <span class="nv">$value</span> <span class="o">=~</span> <span class="sr">s/\*/\.\*/g</span><span class="p">;</span>       <span class="c1">##Convert * to .*</span>
	    <span class="nv">$value</span> <span class="o">=~</span> <span class="sr">s/\?/\./g</span><span class="p">;</span>         <span class="c1">##Convert ? to .</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><h1>if pattern is a directory and it lacks a trailing slash, add one</h1></td><td class="code"><div class="highlight"><pre>	    <span class="k">if</span> <span class="p">((</span><span class="o">-</span><span class="n">d</span> <span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
		<span class="nv">$value</span> <span class="o">=~</span> <span class="sr">s@([^/])$@$1/@</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&quot;K&quot;</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$keyword_hash</span><span class="p">{</span><span class="nv">@typevalue</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nb">push</span><span class="p">(</span><span class="nv">@typevalue</span><span class="p">,</span> <span class="s">&quot;$type:$value&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="o">!</span><span class="sr">/^(\s)*$/</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$line</span> <span class="o">=~</span> <span class="sr">s/\n$//g</span><span class="p">;</span>
	<span class="nb">push</span><span class="p">(</span><span class="nv">@typevalue</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nb">close</span><span class="p">(</span><span class="nv">$maint</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Read mail address map</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">$mailmap</span><span class="p">;</span>

<span class="n">read_mailmap</span><span class="p">();</span>

<span class="k">sub </span><span class="nf">read_mailmap</span> <span class="p">{</span>
    <span class="nv">$mailmap</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">names</span> <span class="o">=&gt;</span> <span class="p">{},</span>
	<span class="n">addresses</span> <span class="o">=&gt;</span> <span class="p">{}</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$email_use_mailmap</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="s">&quot;${lk_path}.mailmap&quot;</span><span class="p">));</span>

    <span class="nb">open</span><span class="p">(</span><span class="k">my</span> <span class="nv">$mailmap_file</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&quot;${lk_path}.mailmap&quot;</span><span class="p">)</span>
	<span class="ow">or</span> <span class="nb">warn</span> <span class="s">&quot;$P: Can&#39;t open .mailmap: $!\n&quot;</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="sr">&lt;$mailmap_file&gt;</span><span class="p">)</span> <span class="p">{</span>
	<span class="sr">s/#.*$//</span><span class="p">;</span> <span class="c1">#strip comments</span>
	<span class="sr">s/^\s+|\s+$//g</span><span class="p">;</span> <span class="c1">#trim</span>

	<span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="sr">/^\s*$/</span><span class="p">);</span> <span class="c1">#skip empty lines</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>entries have one of the following formats:
name1 <mail1>
<mail1> <mail2>
name1 <mail1> <mail2>
name1 <mail1> name2 <mail2>
(see man git-shortlog)</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">(</span><span class="sr">/^([^&lt;]+)&lt;([^&gt;]+)&gt;$/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$real_name</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$address</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>

	    <span class="nv">$real_name</span> <span class="o">=~</span> <span class="sr">s/\s+$//</span><span class="p">;</span>
	    <span class="p">(</span><span class="nv">$real_name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="s">&quot;$real_name &lt;$address&gt;&quot;</span><span class="p">);</span>
	    <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">names</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$address</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$real_name</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="sr">/^&lt;([^&gt;]+)&gt;\s*&lt;([^&gt;]+)&gt;$/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$real_address</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$wrong_address</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>

	    <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">addresses</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$wrong_address</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$real_address</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="sr">/^(.+)&lt;([^&gt;]+)&gt;\s*&lt;([^&gt;]+)&gt;$/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$real_name</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$real_address</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$wrong_address</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>

	    <span class="nv">$real_name</span> <span class="o">=~</span> <span class="sr">s/\s+$//</span><span class="p">;</span>
	    <span class="p">(</span><span class="nv">$real_name</span><span class="p">,</span> <span class="nv">$real_address</span><span class="p">)</span> <span class="o">=</span>
		<span class="n">parse_email</span><span class="p">(</span><span class="s">&quot;$real_name &lt;$real_address&gt;&quot;</span><span class="p">);</span>
	    <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">names</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$wrong_address</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$real_name</span><span class="p">;</span>
	    <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">addresses</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$wrong_address</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$real_address</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="sr">/^(.+)&lt;([^&gt;]+)&gt;\s*(.+)\s*&lt;([^&gt;]+)&gt;$/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$real_name</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$real_address</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$wrong_name</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$wrong_address</span> <span class="o">=</span> <span class="nv">$4</span><span class="p">;</span>

	    <span class="nv">$real_name</span> <span class="o">=~</span> <span class="sr">s/\s+$//</span><span class="p">;</span>
	    <span class="p">(</span><span class="nv">$real_name</span><span class="p">,</span> <span class="nv">$real_address</span><span class="p">)</span> <span class="o">=</span>
		<span class="n">parse_email</span><span class="p">(</span><span class="s">&quot;$real_name &lt;$real_address&gt;&quot;</span><span class="p">);</span>

	    <span class="nv">$wrong_name</span> <span class="o">=~</span> <span class="sr">s/\s+$//</span><span class="p">;</span>
	    <span class="p">(</span><span class="nv">$wrong_name</span><span class="p">,</span> <span class="nv">$wrong_address</span><span class="p">)</span> <span class="o">=</span>
		<span class="n">parse_email</span><span class="p">(</span><span class="s">&quot;$wrong_name &lt;$wrong_address&gt;&quot;</span><span class="p">);</span>

	    <span class="k">my</span> <span class="nv">$wrong_email</span> <span class="o">=</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$wrong_name</span><span class="p">,</span> <span class="nv">$wrong_address</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	    <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">names</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$wrong_email</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$real_name</span><span class="p">;</span>
	    <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">addresses</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$wrong_email</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$real_address</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="nb">close</span><span class="p">(</span><span class="nv">$mailmap_file</span><span class="p">);</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><h1>use the filenames on the command line or find the filenames in the patchfiles</h1></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">@files</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">@range</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">@keyword_tvi</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">@file_emails</span> <span class="o">=</span> <span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">@ARGV</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">push</span><span class="p">(</span><span class="nv">@ARGV</span><span class="p">,</span> <span class="s">&quot;&amp;STDIN&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$file</span> <span class="p">(</span><span class="nv">@ARGV</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="ow">ne</span> <span class="s">&quot;&amp;STDIN&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><h1>if $file is a directory and it lacks a trailing slash, add one</h1></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">((</span><span class="o">-</span><span class="n">d</span> <span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
	    <span class="nv">$file</span> <span class="o">=~</span> <span class="sr">s@([^/])$@$1/@</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="nv">$file</span><span class="p">))</span> <span class="p">{</span>
	    <span class="nb">die</span> <span class="s">&quot;$P: file &#39;${file}&#39; not found\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$from_filename</span><span class="p">)</span> <span class="p">{</span>
	<span class="nb">push</span><span class="p">(</span><span class="nv">@files</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="ow">ne</span> <span class="s">&quot;MAINTAINERS&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">-</span><span class="n">f</span> <span class="nv">$file</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$keywords</span> <span class="o">||</span> <span class="nv">$file_emails</span><span class="p">))</span> <span class="p">{</span>
	    <span class="nb">open</span><span class="p">(</span><span class="k">my</span> <span class="nv">$f</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)</span>
		<span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;$P: Can&#39;t open $file: $!\n&quot;</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$text</span> <span class="o">=</span> <span class="k">do</span> <span class="p">{</span> <span class="nb">local</span><span class="p">(</span><span class="vg">$/</span><span class="p">)</span> <span class="p">;</span> <span class="sr">&lt;$f&gt;</span> <span class="p">};</span>
	    <span class="nb">close</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$keywords</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nb">keys</span> <span class="nv">%keyword_hash</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$text</span> <span class="o">=~</span> <span class="sr">m/$keyword_hash{$line}/x</span><span class="p">)</span> <span class="p">{</span>
			<span class="nb">push</span><span class="p">(</span><span class="nv">@keyword_tvi</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
		    <span class="p">}</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$file_emails</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="nv">@poss_addr</span> <span class="o">=</span> <span class="nv">$text</span> <span class="o">=~</span> <span class="sr">m$[A-Za-zÀ-ÿ\&quot;\&#39; \,\.\+-]*\s*[\,]*\s*[\(\&lt;\{]{0,1}[A-Za-z0-9_\.\+-]+\@[A-Za-z0-9\.-]+\.[A-Za-z0-9]+[\)\&gt;\}]{0,1}$g</span><span class="p">;</span>
		<span class="nb">push</span><span class="p">(</span><span class="nv">@file_emails</span><span class="p">,</span> <span class="n">clean_file_emails</span><span class="p">(</span><span class="nv">@poss_addr</span><span class="p">));</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$file_cnt</span> <span class="o">=</span> <span class="nv">@files</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$lastfile</span><span class="p">;</span>

	<span class="nb">open</span><span class="p">(</span><span class="k">my</span> <span class="nv">$patch</span><span class="p">,</span> <span class="s">&quot;&lt; $file&quot;</span><span class="p">)</span>
	    <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;$P: Can&#39;t open $file: $!\n&quot;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>We can check arbitrary information before the patch
like the commit message, mail headers, etc...
This allows us to match arbitrary keywords against any part
of a git format-patch generated file (subject tags, etc...)</p></td><td class="code"><div class="highlight"><pre>	<span class="k">my</span> <span class="nv">$patch_prefix</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>			<span class="c1">#Parsing the intro</span>

	<span class="k">while</span> <span class="p">(</span><span class="sr">&lt;$patch&gt;</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$patch_line</span> <span class="o">=</span> <span class="nv">$_</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="sr">m/^\+\+\+\s+(\S+)/</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		<span class="nv">$filename</span> <span class="o">=~</span> <span class="sr">s@^[^/]*/@@</span><span class="p">;</span>
		<span class="nv">$filename</span> <span class="o">=~</span> <span class="sr">s@\n@@</span><span class="p">;</span>
		<span class="nv">$lastfile</span> <span class="o">=</span> <span class="nv">$filename</span><span class="p">;</span>
		<span class="nb">push</span><span class="p">(</span><span class="nv">@files</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">);</span>
		<span class="nv">$patch_prefix</span> <span class="o">=</span> <span class="s">&quot;^[+-].*&quot;</span><span class="p">;</span>	<span class="c1">#Now parsing the actual patch</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="sr">m/^\@\@ -(\d+),(\d+)/</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$email_git_blame</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nb">push</span><span class="p">(</span><span class="nv">@range</span><span class="p">,</span> <span class="s">&quot;$lastfile:$1:$2&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$keywords</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nb">keys</span> <span class="nv">%keyword_hash</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$patch_line</span> <span class="o">=~</span> <span class="sr">m/${patch_prefix}$keyword_hash{$line}/x</span><span class="p">)</span> <span class="p">{</span>
			<span class="nb">push</span><span class="p">(</span><span class="nv">@keyword_tvi</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
		    <span class="p">}</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	<span class="p">}</span>
	<span class="nb">close</span><span class="p">(</span><span class="nv">$patch</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="nv">$file_cnt</span> <span class="o">==</span> <span class="nv">@files</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nb">warn</span> <span class="s">&quot;$P: file &#39;${file}&#39; doesn&#39;t appear to be a patch.  &quot;</span>
		<span class="o">.</span> <span class="s">&quot;Add -f to options?\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nv">@files</span> <span class="o">=</span> <span class="n">sort_and_uniq</span><span class="p">(</span><span class="nv">@files</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">@file_emails</span> <span class="o">=</span> <span class="n">uniq</span><span class="p">(</span><span class="nv">@file_emails</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">%email_hash_name</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">%email_hash_address</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@email_to</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">%hash_list_to</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@list_to</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">@scm</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">@web</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">@subsystem</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">@status</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">%deduplicate_name_hash</span> <span class="o">=</span> <span class="p">();</span>
<span class="k">my</span> <span class="nv">%deduplicate_address_hash</span> <span class="o">=</span> <span class="p">();</span>

<span class="k">my</span> <span class="nv">@maintainers</span> <span class="o">=</span> <span class="n">get_maintainers</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">@maintainers</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">@maintainers</span> <span class="o">=</span> <span class="n">merge_email</span><span class="p">(</span><span class="nv">@maintainers</span><span class="p">);</span>
    <span class="n">output</span><span class="p">(</span><span class="nv">@maintainers</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$scm</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">@scm</span> <span class="o">=</span> <span class="n">uniq</span><span class="p">(</span><span class="nv">@scm</span><span class="p">);</span>
    <span class="n">output</span><span class="p">(</span><span class="nv">@scm</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$status</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">@status</span> <span class="o">=</span> <span class="n">uniq</span><span class="p">(</span><span class="nv">@status</span><span class="p">);</span>
    <span class="n">output</span><span class="p">(</span><span class="nv">@status</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$subsystem</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">@subsystem</span> <span class="o">=</span> <span class="n">uniq</span><span class="p">(</span><span class="nv">@subsystem</span><span class="p">);</span>
    <span class="n">output</span><span class="p">(</span><span class="nv">@subsystem</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$web</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">@web</span> <span class="o">=</span> <span class="n">uniq</span><span class="p">(</span><span class="nv">@web</span><span class="p">);</span>
    <span class="n">output</span><span class="p">(</span><span class="nv">@web</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">exit</span><span class="p">(</span><span class="nv">$exit</span><span class="p">);</span>

<span class="k">sub </span><span class="nf">range_is_maintained</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$start</span><span class="p">,</span> <span class="nv">$end</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="nv">$start</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$end</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/^(\C):\s*(.*)/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&#39;S&#39;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$value</span> <span class="o">=~</span><span class="sr"> /(maintain|support)/i</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">range_has_maintainer</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$start</span><span class="p">,</span> <span class="nv">$end</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="nv">$start</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$end</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/^(\C):\s*(.*)/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&#39;M&#39;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">get_maintainers</span> <span class="p">{</span>
    <span class="nv">%email_hash_name</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">%email_hash_address</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">%commit_author_hash</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">%commit_signer_hash</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">@email_to</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">%hash_list_to</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">@list_to</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">@scm</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">@web</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">@subsystem</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">@status</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">%deduplicate_name_hash</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">%deduplicate_address_hash</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$email_git_all_signature_types</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$signature_pattern</span> <span class="o">=</span> <span class="s">&quot;(.+?)[Bb][Yy]:&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="nv">$signature_pattern</span> <span class="o">=</span> <span class="s">&quot;\(&quot;</span> <span class="o">.</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="p">,</span> <span class="nv">@signature_tags</span><span class="p">)</span> <span class="o">.</span> <span class="s">&quot;\)&quot;</span><span class="p">;</span>
    <span class="p">}</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>Find responsible parties</p></td><td class="code"><div class="highlight"><pre>    <span class="k">my</span> <span class="nv">%exact_pattern_match_hash</span> <span class="o">=</span> <span class="p">();</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$file</span> <span class="p">(</span><span class="nv">@files</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">my</span> <span class="nv">%hash</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$tvi</span> <span class="o">=</span> <span class="n">find_first_section</span><span class="p">();</span>
	<span class="k">while</span> <span class="p">(</span><span class="nv">$tvi</span> <span class="o">&lt;</span> <span class="nv">@typevalue</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$start</span> <span class="o">=</span> <span class="n">find_starting_index</span><span class="p">(</span><span class="nv">$tvi</span><span class="p">);</span>
	    <span class="k">my</span> <span class="nv">$end</span> <span class="o">=</span> <span class="n">find_ending_index</span><span class="p">(</span><span class="nv">$tvi</span><span class="p">);</span>
	    <span class="k">my</span> <span class="nv">$exclude</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$i</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Do not match excluded file patterns</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="nv">$start</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$end</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/^(\C):\s*(.*)/</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">my</span> <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		    <span class="k">my</span> <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&#39;X&#39;</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">file_match_pattern</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
			    <span class="nv">$exclude</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			    <span class="k">last</span><span class="p">;</span>
			<span class="p">}</span>
		    <span class="p">}</span>
		<span class="p">}</span>
	    <span class="p">}</span>

	    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$exclude</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="nv">$start</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$end</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/^(\C):\s*(.*)/</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">my</span> <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
			<span class="k">my</span> <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&#39;F&#39;</span><span class="p">)</span> <span class="p">{</span>
			    <span class="k">if</span> <span class="p">(</span><span class="n">file_match_pattern</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">my</span> <span class="nv">$value_pd</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$value</span> <span class="o">=~</span> <span class="nb">tr</span><span class="nv">@</span><span class="err">/@@</span><span class="p">);</span>
				<span class="k">my</span> <span class="nv">$file_pd</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$file</span>  <span class="o">=~</span> <span class="nb">tr</span><span class="nv">@</span><span class="err">/@@</span><span class="p">);</span>
				<span class="nv">$value_pd</span><span class="o">++</span> <span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="ow">ne</span> <span class="s">&quot;/&quot;</span><span class="p">);</span>
				<span class="nv">$value_pd</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$value</span> <span class="o">=~</span><span class="sr"> /^\.\*/</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="nv">$value_pd</span> <span class="o">&gt;=</span> <span class="nv">$file_pd</span> <span class="o">&amp;&amp;</span>
				    <span class="n">range_is_maintained</span><span class="p">(</span><span class="nv">$start</span><span class="p">,</span> <span class="nv">$end</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
				    <span class="n">range_has_maintainer</span><span class="p">(</span><span class="nv">$start</span><span class="p">,</span> <span class="nv">$end</span><span class="p">))</span> <span class="p">{</span>
				    <span class="nv">$exact_pattern_match_hash</span><span class="p">{</span><span class="nv">$file</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">(</span><span class="nv">$pattern_depth</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span>
				    <span class="p">((</span><span class="nv">$file_pd</span> <span class="o">-</span> <span class="nv">$value_pd</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nv">$pattern_depth</span><span class="p">))</span> <span class="p">{</span>
				    <span class="nv">$hash</span><span class="p">{</span><span class="nv">$tvi</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$value_pd</span><span class="p">;</span>
				<span class="p">}</span>
			    <span class="p">}</span>
			<span class="p">}</span>
		    <span class="p">}</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	    <span class="nv">$tvi</span> <span class="o">=</span> <span class="nv">$end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nb">sort</span> <span class="p">{</span><span class="nv">$hash</span><span class="p">{</span><span class="nv">$b</span><span class="p">}</span> <span class="sr">&lt;=&gt;</span> <span class="nv">$hash</span><span class="p">{</span><span class="nv">$a</span><span class="p">}}</span> <span class="nb">keys</span> <span class="nv">%hash</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">add_categories</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$sections</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="nv">$i</span><span class="p">;</span>
		<span class="k">my</span> <span class="nv">$start</span> <span class="o">=</span> <span class="n">find_starting_index</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
		<span class="k">my</span> <span class="nv">$end</span> <span class="o">=</span> <span class="n">find_ending_index</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="nv">$start</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$end</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /^[FX]:/</span><span class="p">)</span> <span class="p">{</span>		<span class="c1">##Restore file patterns</span>
			<span class="nv">$line</span> <span class="o">=~</span> <span class="sr">s/([^\\])\.([^\*])/$1\?$2/g</span><span class="p">;</span>
			<span class="nv">$line</span> <span class="o">=~</span> <span class="sr">s/([^\\])\.$/$1\?/g</span><span class="p">;</span>	<span class="c1">##Convert . back to ?</span>
			<span class="nv">$line</span> <span class="o">=~</span> <span class="sr">s/\\\./\./g</span><span class="p">;</span>       	<span class="c1">##Convert \. to .</span>
			<span class="nv">$line</span> <span class="o">=~</span> <span class="sr">s/\.\*/\*/g</span><span class="p">;</span>       	<span class="c1">##Convert .* to *</span>
		    <span class="p">}</span>
		    <span class="nv">$line</span> <span class="o">=~</span> <span class="sr">s/^([A-Z]):/$1:\t/g</span><span class="p">;</span>
		    <span class="k">print</span><span class="p">(</span><span class="s">&quot;$line\n&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">);</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$keywords</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">@keyword_tvi</span> <span class="o">=</span> <span class="n">sort_and_uniq</span><span class="p">(</span><span class="nv">@keyword_tvi</span><span class="p">);</span>
	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nv">@keyword_tvi</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">add_categories</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$email</span> <span class="p">(</span><span class="nv">@email_to</span><span class="p">,</span> <span class="nv">@list_to</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$email</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">deduplicate_email</span><span class="p">(</span><span class="nv">$email</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$file</span> <span class="p">(</span><span class="nv">@files</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$email</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="nv">$email_git</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$email_git_fallback</span> <span class="o">&amp;&amp;</span>
			    <span class="o">!</span><span class="nv">$exact_pattern_match_hash</span><span class="p">{</span><span class="nv">$file</span><span class="p">})))</span> <span class="p">{</span>
	    <span class="n">vcs_file_signoffs</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$email</span> <span class="o">&amp;&amp;</span> <span class="nv">$email_git_blame</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">vcs_file_blame</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$email</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$chief</span> <span class="p">(</span><span class="nv">@penguin_chief</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$chief</span> <span class="o">=~</span> <span class="sr">m/^(.*):(.*)/</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="nv">$email_address</span><span class="p">;</span>

		<span class="nv">$email_address</span> <span class="o">=</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$1</span><span class="p">,</span> <span class="nv">$2</span><span class="p">,</span> <span class="nv">$email_usename</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$email_git_penguin_chiefs</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nb">push</span><span class="p">(</span><span class="nv">@email_to</span><span class="p">,</span> <span class="p">[</span><span class="nv">$email_address</span><span class="p">,</span> <span class="s">&#39;chief penguin&#39;</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="nv">@email_to</span> <span class="o">=</span> <span class="nb">grep</span><span class="p">(</span><span class="nv">$_</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!~</span> <span class="sr">/${email_address}/</span><span class="p">,</span> <span class="nv">@email_to</span><span class="p">);</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	<span class="p">}</span>

	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$email</span> <span class="p">(</span><span class="nv">@file_emails</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>

	    <span class="k">my</span> <span class="nv">$tmp_email</span> <span class="o">=</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="nv">$email_usename</span><span class="p">);</span>
	    <span class="n">push_email_address</span><span class="p">(</span><span class="nv">$tmp_email</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">);</span>
	    <span class="n">add_role</span><span class="p">(</span><span class="nv">$tmp_email</span><span class="p">,</span> <span class="s">&#39;in file&#39;</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">my</span> <span class="nv">@to</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$email</span> <span class="o">||</span> <span class="nv">$email_list</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$email</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">@to</span> <span class="o">=</span> <span class="p">(</span><span class="nv">@to</span><span class="p">,</span> <span class="nv">@email_to</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$email_list</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">@to</span> <span class="o">=</span> <span class="p">(</span><span class="nv">@to</span><span class="p">,</span> <span class="nv">@list_to</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$interactive</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">@to</span> <span class="o">=</span> <span class="n">interactive_get_maintainers</span><span class="p">(</span><span class="o">\</span><span class="nv">@to</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">@to</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">file_match_pattern</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$pattern</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$pattern</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">=~</span> <span class="sr">m@^$pattern@</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">=~</span> <span class="sr">m@^$pattern@</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$s1</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">=~</span> <span class="nb">tr</span><span class="nv">@</span><span class="err">/@@</span><span class="p">);</span>
	    <span class="k">my</span> <span class="nv">$s2</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$pattern</span> <span class="o">=~</span> <span class="nb">tr</span><span class="nv">@</span><span class="err">/@@</span><span class="p">);</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$s1</span> <span class="o">==</span> <span class="nv">$s2</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">usage</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s">&lt;&lt;EOT;</span>
<span class="s">usage: $P [options] patchfile</span>
<span class="s">       $P [options] -f file|directory</span>
<span class="s">version: $V</span>

<span class="s">MAINTAINER field selection options:</span>
<span class="s">  --email =&gt; print email address(es) if any</span>
<span class="s">    --git =&gt; include recent git \*-by: signers</span>
<span class="s">    --git-all-signature-types =&gt; include signers regardless of signature type</span>
<span class="s">        or use only ${signature_pattern} signers (default: $email_git_all_signature_types)</span>
<span class="s">    --git-fallback =&gt; use git when no exact MAINTAINERS pattern (default: $email_git_fallback)</span>
<span class="s">    --git-chief-penguins =&gt; include ${penguin_chiefs}</span>
<span class="s">    --git-min-signatures =&gt; number of signatures required (default: $email_git_min_signatures)</span>
<span class="s">    --git-max-maintainers =&gt; maximum maintainers to add (default: $email_git_max_maintainers)</span>
<span class="s">    --git-min-percent =&gt; minimum percentage of commits required (default: $email_git_min_percent)</span>
<span class="s">    --git-blame =&gt; use git blame to find modified commits for patch or file</span>
<span class="s">    --git-since =&gt; git history to use (default: $email_git_since)</span>
<span class="s">    --hg-since =&gt; hg history to use (default: $email_hg_since)</span>
<span class="s">    --interactive =&gt; display a menu (mostly useful if used with the --git option)</span>
<span class="s">    --m =&gt; include maintainer(s) if any</span>
<span class="s">    --n =&gt; include name &#39;Full Name &lt;addr\@domain.tld&gt;&#39;</span>
<span class="s">    --l =&gt; include list(s) if any</span>
<span class="s">    --s =&gt; include subscriber only list(s) if any</span>
<span class="s">    --remove-duplicates =&gt; minimize duplicate email names/addresses</span>
<span class="s">    --roles =&gt; show roles (status:subsystem, git-signer, list, etc...)</span>
<span class="s">    --rolestats =&gt; show roles and statistics (commits/total_commits, %)</span>
<span class="s">    --file-emails =&gt; add email addresses found in -f file (default: 0 (off))</span>
<span class="s">  --scm =&gt; print SCM tree(s) if any</span>
<span class="s">  --status =&gt; print status if any</span>
<span class="s">  --subsystem =&gt; print subsystem name if any</span>
<span class="s">  --web =&gt; print website(s) if any</span>

<span class="s">Output type options:</span>
<span class="s">  --separator [, ] =&gt; separator for multiple entries on 1 line</span>
<span class="s">    using --separator also sets --nomultiline if --separator is not [, ]</span>
<span class="s">  --multiline =&gt; print 1 entry per line</span>

<span class="s">Other options:</span>
<span class="s">  --pattern-depth =&gt; Number of pattern directory traversals (default: 0 (all))</span>
<span class="s">  --keywords =&gt; scan patch for keywords (default: $keywords)</span>
<span class="s">  --sections =&gt; print all of the subsystem sections with pattern matches</span>
<span class="s">  --mailmap =&gt; use .mailmap file (default: $email_use_mailmap)</span>
<span class="s">  --version =&gt; show version</span>
<span class="s">  --help =&gt; show this help information</span>

<span class="s">Default options:</span>
<span class="s">  [--email --nogit --git-fallback --m --n --l --multiline -pattern-depth=0</span>
<span class="s">   --remove-duplicates --rolestats]</span>

<span class="s">Notes:</span>
<span class="s">  Using &quot;-f directory&quot; may give unexpected results:</span>
<span class="s">      Used with &quot;--git&quot;, git signators for _all_ files in and below</span>
<span class="s">          directory are examined as git recurses directories.</span>
<span class="s">          Any specified X: (exclude) pattern matches are _not_ ignored.</span>
<span class="s">      Used with &quot;--nogit&quot;, directory is used as a pattern match,</span>
<span class="s">          no individual file within the directory or subdirectory</span>
<span class="s">          is matched.</span>
<span class="s">      Used with &quot;--git-blame&quot;, does not iterate all files in directory</span>
<span class="s">  Using &quot;--git-blame&quot; is slow and may add old committers and authors</span>
<span class="s">      that are no longer active maintainers to the output.</span>
<span class="s">  Using &quot;--roles&quot; or &quot;--rolestats&quot; with git send-email --cc-cmd or any</span>
<span class="s">      other automated tools that expect only [&quot;name&quot;] &lt;email address&gt;</span>
<span class="s">      may not work because of additional output after &lt;email address&gt;.</span>
<span class="s">  Using &quot;--rolestats&quot; and &quot;--git-blame&quot; shows the #/total=% commits,</span>
<span class="s">      not the percentage of the entire file authored.  # of commits is</span>
<span class="s">      not a good measure of amount of code authored.  1 major commit may</span>
<span class="s">      contain a thousand lines, 5 trivial commits may modify a single line.</span>
<span class="s">  If git is not installed, but mercurial (hg) is installed and an .hg</span>
<span class="s">      repository exists, the following options apply to mercurial:</span>
<span class="s">          --git,</span>
<span class="s">          --git-min-signatures, --git-max-maintainers, --git-min-percent, and</span>
<span class="s">          --git-blame</span>
<span class="s">      Use --hg-since not --git-since to control date selection</span>
<span class="s">  File &quot;.get_maintainer.conf&quot;, if it exists in the linux kernel source root</span>
<span class="s">      directory, can change whatever get_maintainer defaults are desired.</span>
<span class="s">      Entries in this file can be any command line argument.</span>
<span class="s">      This file is prepended to any additional command line arguments.</span>
<span class="s">      Multiple lines and # comments are allowed.</span>
<span class="s">EOT</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">top_of_kernel_tree</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$lk_path</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$lk_path</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$lk_path</span><span class="p">,</span><span class="nb">length</span><span class="p">(</span><span class="nv">$lk_path</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="ow">ne</span> <span class="s">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$lk_path</span> <span class="o">.=</span> <span class="s">&quot;/&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span>   <span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="s">&quot;${lk_path}COPYING&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="s">&quot;${lk_path}CREDITS&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="s">&quot;${lk_path}Kbuild&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="s">&quot;${lk_path}MAINTAINERS&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="s">&quot;${lk_path}Makefile&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="s">&quot;${lk_path}README&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="s">&quot;${lk_path}Documentation&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="s">&quot;${lk_path}arch&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="s">&quot;${lk_path}include&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="s">&quot;${lk_path}drivers&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="s">&quot;${lk_path}fs&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="s">&quot;${lk_path}init&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="s">&quot;${lk_path}ipc&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="s">&quot;${lk_path}kernel&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="s">&quot;${lk_path}lib&quot;</span><span class="p">)</span>
	<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="s">&quot;${lk_path}scripts&quot;</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">parse_email</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$formatted_email</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$address</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$formatted_email</span> <span class="o">=~</span><span class="sr"> /^([^&lt;]+)&lt;(.+\@.*)&gt;.*$/</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	<span class="nv">$address</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$formatted_email</span> <span class="o">=~</span><span class="sr"> /^\s*&lt;(.+\@\S*)&gt;.*$/</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$address</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$formatted_email</span> <span class="o">=~</span><span class="sr"> /^(.+\@\S*).*$/</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$address</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$name</span> <span class="o">=~</span> <span class="sr">s/^\s+|\s+$//g</span><span class="p">;</span>
    <span class="nv">$name</span> <span class="o">=~</span> <span class="sr">s/^\&quot;|\&quot;$//g</span><span class="p">;</span>
    <span class="nv">$address</span> <span class="o">=~</span> <span class="sr">s/^\s+|\s+$//g</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$name</span> <span class="o">=~</span><span class="sr"> /[^\w \-]/i</span><span class="p">)</span> <span class="p">{</span>  	 <span class="c1">##has &quot;must quote&quot; chars</span>
	<span class="nv">$name</span> <span class="o">=~</span> <span class="sr">s/(?&lt;!\\)&quot;/\\&quot;/g</span><span class="p">;</span>       <span class="c1">##escape quotes</span>
	<span class="nv">$name</span> <span class="o">=</span> <span class="s">&quot;\&quot;$name\&quot;&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">format_email</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="nv">$usename</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$formatted_email</span><span class="p">;</span>

    <span class="nv">$name</span> <span class="o">=~</span> <span class="sr">s/^\s+|\s+$//g</span><span class="p">;</span>
    <span class="nv">$name</span> <span class="o">=~</span> <span class="sr">s/^\&quot;|\&quot;$//g</span><span class="p">;</span>
    <span class="nv">$address</span> <span class="o">=~</span> <span class="sr">s/^\s+|\s+$//g</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$name</span> <span class="o">=~</span><span class="sr"> /[^\w \-]/i</span><span class="p">)</span> <span class="p">{</span>          <span class="c1">##has &quot;must quote&quot; chars</span>
	<span class="nv">$name</span> <span class="o">=~</span> <span class="sr">s/(?&lt;!\\)&quot;/\\&quot;/g</span><span class="p">;</span>       <span class="c1">##escape quotes</span>
	<span class="nv">$name</span> <span class="o">=</span> <span class="s">&quot;\&quot;$name\&quot;&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$usename</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="s">&quot;$name&quot;</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$formatted_email</span> <span class="o">=</span> <span class="s">&quot;$address&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="nv">$formatted_email</span> <span class="o">=</span> <span class="s">&quot;$name &lt;$address&gt;&quot;</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="nv">$formatted_email</span> <span class="o">=</span> <span class="nv">$address</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$formatted_email</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">find_first_section</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="nv">$index</span> <span class="o">&lt;</span> <span class="nv">@typevalue</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$tv</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$index</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">((</span><span class="nv">$tv</span> <span class="o">=~</span> <span class="sr">m/^(\C):\s*(.*)/</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">last</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nv">$index</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$index</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">find_starting_index</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$index</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="nv">$index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$tv</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$index</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$tv</span> <span class="o">=~</span> <span class="sr">m/^(\C):\s*(.*)/</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">last</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nv">$index</span><span class="o">--</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$index</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">find_ending_index</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$index</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="nv">$index</span> <span class="o">&lt;</span> <span class="nv">@typevalue</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$tv</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$index</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$tv</span> <span class="o">=~</span> <span class="sr">m/^(\C):\s*(.*)/</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">last</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nv">$index</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$index</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">get_maintainer_role</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$index</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$i</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$start</span> <span class="o">=</span> <span class="n">find_starting_index</span><span class="p">(</span><span class="nv">$index</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$end</span> <span class="o">=</span> <span class="n">find_ending_index</span><span class="p">(</span><span class="nv">$index</span><span class="p">);</span>

    <span class="k">my</span> <span class="nv">$role</span> <span class="o">=</span> <span class="s">&quot;unknown&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$subsystem</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$start</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="nv">$subsystem</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$subsystem</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$subsystem</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="p">);</span>
	<span class="nv">$subsystem</span> <span class="o">=~</span> <span class="sr">s/\s*$//</span><span class="p">;</span>
	<span class="nv">$subsystem</span> <span class="o">=</span> <span class="nv">$subsystem</span> <span class="o">.</span> <span class="s">&quot;...&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="nv">$start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$end</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$tv</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$tv</span> <span class="o">=~</span> <span class="sr">m/^(\C):\s*(.*)/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$ptype</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$pvalue</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$ptype</span> <span class="ow">eq</span> <span class="s">&quot;S&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$role</span> <span class="o">=</span> <span class="nv">$pvalue</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="nv">$role</span> <span class="o">=</span> <span class="nb">lc</span><span class="p">(</span><span class="nv">$role</span><span class="p">);</span>
    <span class="k">if</span>      <span class="p">(</span><span class="nv">$role</span> <span class="ow">eq</span> <span class="s">&quot;supported&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$role</span> <span class="o">=</span> <span class="s">&quot;supporter&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$role</span> <span class="ow">eq</span> <span class="s">&quot;maintained&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$role</span> <span class="o">=</span> <span class="s">&quot;maintainer&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$role</span> <span class="ow">eq</span> <span class="s">&quot;odd fixes&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$role</span> <span class="o">=</span> <span class="s">&quot;odd fixer&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$role</span> <span class="ow">eq</span> <span class="s">&quot;orphan&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$role</span> <span class="o">=</span> <span class="s">&quot;orphan minder&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$role</span> <span class="ow">eq</span> <span class="s">&quot;obsolete&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$role</span> <span class="o">=</span> <span class="s">&quot;obsolete minder&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$role</span> <span class="ow">eq</span> <span class="s">&quot;buried alive in reporters&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$role</span> <span class="o">=</span> <span class="s">&quot;chief penguin&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$role</span> <span class="o">.</span> <span class="s">&quot;:&quot;</span> <span class="o">.</span> <span class="nv">$subsystem</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">get_list_role</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$index</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$i</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$start</span> <span class="o">=</span> <span class="n">find_starting_index</span><span class="p">(</span><span class="nv">$index</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$end</span> <span class="o">=</span> <span class="n">find_ending_index</span><span class="p">(</span><span class="nv">$index</span><span class="p">);</span>

    <span class="k">my</span> <span class="nv">$subsystem</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$start</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="nv">$subsystem</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$subsystem</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$subsystem</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">17</span><span class="p">);</span>
	<span class="nv">$subsystem</span> <span class="o">=~</span> <span class="sr">s/\s*$//</span><span class="p">;</span>
	<span class="nv">$subsystem</span> <span class="o">=</span> <span class="nv">$subsystem</span> <span class="o">.</span> <span class="s">&quot;...&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$subsystem</span> <span class="ow">eq</span> <span class="s">&quot;THE REST&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$subsystem</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$subsystem</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">add_categories</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$index</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$i</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$start</span> <span class="o">=</span> <span class="n">find_starting_index</span><span class="p">(</span><span class="nv">$index</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$end</span> <span class="o">=</span> <span class="n">find_ending_index</span><span class="p">(</span><span class="nv">$index</span><span class="p">);</span>

    <span class="nb">push</span><span class="p">(</span><span class="nv">@subsystem</span><span class="p">,</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$start</span><span class="p">]);</span>

    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="nv">$start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$end</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$tv</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$tv</span> <span class="o">=~</span> <span class="sr">m/^(\C):\s*(.*)/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$ptype</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$pvalue</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$ptype</span> <span class="ow">eq</span> <span class="s">&quot;L&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="nv">$list_address</span> <span class="o">=</span> <span class="nv">$pvalue</span><span class="p">;</span>
		<span class="k">my</span> <span class="nv">$list_additional</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
		<span class="k">my</span> <span class="nv">$list_role</span> <span class="o">=</span> <span class="n">get_list_role</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="nv">$list_role</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$list_role</span> <span class="o">=</span> <span class="s">&quot;:&quot;</span> <span class="o">.</span> <span class="nv">$list_role</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$list_address</span> <span class="o">=~</span> <span class="sr">m/([^\s]+)\s+(.*)$/</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$list_address</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		    <span class="nv">$list_additional</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$list_additional</span> <span class="o">=~</span> <span class="sr">m/subscribers-only/</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$email_subscriber_list</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$hash_list_to</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$list_address</span><span class="p">)})</span> <span class="p">{</span>
			    <span class="nv">$hash_list_to</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$list_address</span><span class="p">)}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			    <span class="nb">push</span><span class="p">(</span><span class="nv">@list_to</span><span class="p">,</span> <span class="p">[</span><span class="nv">$list_address</span><span class="p">,</span>
					    <span class="s">&quot;subscriber list${list_role}&quot;</span><span class="p">]);</span>
			<span class="p">}</span>
		    <span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$email_list</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$hash_list_to</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$list_address</span><span class="p">)})</span> <span class="p">{</span>
			    <span class="nv">$hash_list_to</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$list_address</span><span class="p">)}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			    <span class="k">if</span> <span class="p">(</span><span class="nv">$list_additional</span> <span class="o">=~</span> <span class="sr">m/moderated/</span><span class="p">)</span> <span class="p">{</span>
				<span class="nb">push</span><span class="p">(</span><span class="nv">@list_to</span><span class="p">,</span> <span class="p">[</span><span class="nv">$list_address</span><span class="p">,</span>
						<span class="s">&quot;moderated list${list_role}&quot;</span><span class="p">]);</span>
			    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nb">push</span><span class="p">(</span><span class="nv">@list_to</span><span class="p">,</span> <span class="p">[</span><span class="nv">$list_address</span><span class="p">,</span>
						<span class="s">&quot;open list${list_role}&quot;</span><span class="p">]);</span>
			    <span class="p">}</span>
			<span class="p">}</span>
		    <span class="p">}</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ptype</span> <span class="ow">eq</span> <span class="s">&quot;M&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="nv">$pvalue</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$name</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">my</span> <span class="nv">$tv</span> <span class="o">=</span> <span class="nv">$typevalue</span><span class="p">[</span><span class="nv">$i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
			<span class="k">if</span> <span class="p">(</span><span class="nv">$tv</span> <span class="o">=~</span> <span class="sr">m/^(\C):\s*(.*)/</span><span class="p">)</span> <span class="p">{</span>
			    <span class="k">if</span> <span class="p">(</span><span class="nv">$1</span> <span class="ow">eq</span> <span class="s">&quot;P&quot;</span><span class="p">)</span> <span class="p">{</span>
				<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
				<span class="nv">$pvalue</span> <span class="o">=</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="nv">$email_usename</span><span class="p">);</span>
			    <span class="p">}</span>
			<span class="p">}</span>
		    <span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$email_maintainer</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">my</span> <span class="nv">$role</span> <span class="o">=</span> <span class="n">get_maintainer_role</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
		    <span class="n">push_email_addresses</span><span class="p">(</span><span class="nv">$pvalue</span><span class="p">,</span> <span class="nv">$role</span><span class="p">);</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ptype</span> <span class="ow">eq</span> <span class="s">&quot;T&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nb">push</span><span class="p">(</span><span class="nv">@scm</span><span class="p">,</span> <span class="nv">$pvalue</span><span class="p">);</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ptype</span> <span class="ow">eq</span> <span class="s">&quot;W&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nb">push</span><span class="p">(</span><span class="nv">@web</span><span class="p">,</span> <span class="nv">$pvalue</span><span class="p">);</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$ptype</span> <span class="ow">eq</span> <span class="s">&quot;S&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nb">push</span><span class="p">(</span><span class="nv">@status</span><span class="p">,</span> <span class="nv">$pvalue</span><span class="p">);</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">email_inuse</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">((</span><span class="nv">$name</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$address</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">));</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">((</span><span class="nv">$name</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">exists</span><span class="p">(</span><span class="nv">$email_hash_name</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$name</span><span class="p">)}));</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">((</span><span class="nv">$address</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">exists</span><span class="p">(</span><span class="nv">$email_hash_address</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$address</span><span class="p">)}));</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">push_email_address</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="nv">$role</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$address</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$email_remove_duplicates</span><span class="p">)</span> <span class="p">{</span>
	<span class="nb">push</span><span class="p">(</span><span class="nv">@email_to</span><span class="p">,</span> <span class="p">[</span><span class="n">format_email</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="nv">$email_usename</span><span class="p">),</span> <span class="nv">$role</span><span class="p">]);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="o">!</span><span class="n">email_inuse</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">))</span> <span class="p">{</span>
	<span class="nb">push</span><span class="p">(</span><span class="nv">@email_to</span><span class="p">,</span> <span class="p">[</span><span class="n">format_email</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="nv">$email_usename</span><span class="p">),</span> <span class="nv">$role</span><span class="p">]);</span>
	<span class="nv">$email_hash_name</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$name</span><span class="p">)}</span><span class="o">++</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$name</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
	<span class="nv">$email_hash_address</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$address</span><span class="p">)}</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">push_email_addresses</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$address</span><span class="p">,</span> <span class="nv">$role</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">@address_list</span> <span class="o">=</span> <span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">rfc822_valid</span><span class="p">(</span><span class="nv">$address</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">push_email_address</span><span class="p">(</span><span class="nv">$address</span><span class="p">,</span> <span class="nv">$role</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">@address_list</span> <span class="o">=</span> <span class="n">rfc822_validlist</span><span class="p">(</span><span class="nv">$address</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$array_count</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">(</span><span class="nv">@address_list</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$entry</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">(</span><span class="nv">@address_list</span><span class="p">))</span> <span class="p">{</span>
	    <span class="n">push_email_address</span><span class="p">(</span><span class="nv">$entry</span><span class="p">,</span> <span class="nv">$role</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">push_email_address</span><span class="p">(</span><span class="nv">$address</span><span class="p">,</span> <span class="nv">$role</span><span class="p">))</span> <span class="p">{</span>
	    <span class="nb">warn</span><span class="p">(</span><span class="s">&quot;Invalid MAINTAINERS address: &#39;&quot;</span> <span class="o">.</span> <span class="nv">$address</span> <span class="o">.</span> <span class="s">&quot;&#39;\n&quot;</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">add_role</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="nv">$role</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$email</span> <span class="o">=</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="nv">$email_usename</span><span class="p">);</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$entry</span> <span class="p">(</span><span class="nv">@email_to</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$email_remove_duplicates</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="p">(</span><span class="nv">$entry_name</span><span class="p">,</span> <span class="nv">$entry_address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	    <span class="k">if</span> <span class="p">((</span><span class="nv">$name</span> <span class="ow">eq</span> <span class="nv">$entry_name</span> <span class="o">||</span> <span class="nv">$address</span> <span class="ow">eq</span> <span class="nv">$entry_address</span><span class="p">)</span>
		<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$role</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span> <span class="sr">m/$role/</span><span class="p">))</span>
	    <span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;$role&quot;</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;$entry-&gt;[1],$role&quot;</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$email</span> <span class="ow">eq</span> <span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$role</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span> <span class="sr">m/$role/</span><span class="p">))</span>
	    <span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;$role&quot;</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;$entry-&gt;[1],$role&quot;</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">which</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$bin</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$path</span> <span class="p">(</span><span class="nb">split</span><span class="p">(</span><span class="sr">/:/</span><span class="p">,</span> <span class="nv">$ENV</span><span class="p">{</span><span class="n">PATH</span><span class="p">}))</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="n">e</span> <span class="s">&quot;$path/$bin&quot;</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="s">&quot;$path/$bin&quot;</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">which_conf</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$conf</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$path</span> <span class="p">(</span><span class="nb">split</span><span class="p">(</span><span class="sr">/:/</span><span class="p">,</span> <span class="s">&quot;.:$ENV{HOME}:.scripts&quot;</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="n">e</span> <span class="s">&quot;$path/$conf&quot;</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="s">&quot;$path/$conf&quot;</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">mailmap_email</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$line</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$email</span> <span class="o">=</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$real_name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$real_address</span> <span class="o">=</span> <span class="nv">$address</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">exists</span> <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">names</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$email</span><span class="p">}</span> <span class="o">||</span>
	<span class="nb">exists</span> <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">addresses</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$email</span><span class="p">})</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">exists</span> <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">names</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$email</span><span class="p">})</span> <span class="p">{</span>
	    <span class="nv">$real_name</span> <span class="o">=</span> <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">names</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$email</span><span class="p">};</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">exists</span> <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">addresses</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$email</span><span class="p">})</span> <span class="p">{</span>
	    <span class="nv">$real_address</span> <span class="o">=</span> <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">addresses</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$email</span><span class="p">};</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">exists</span> <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">names</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$address</span><span class="p">})</span> <span class="p">{</span>
	    <span class="nv">$real_name</span> <span class="o">=</span> <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">names</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$address</span><span class="p">};</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">exists</span> <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">addresses</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$address</span><span class="p">})</span> <span class="p">{</span>
	    <span class="nv">$real_address</span> <span class="o">=</span> <span class="nv">$mailmap</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">addresses</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$address</span><span class="p">};</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$real_name</span><span class="p">,</span> <span class="nv">$real_address</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">mailmap</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">@addresses</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">@mapped_emails</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nv">@addresses</span><span class="p">)</span> <span class="p">{</span>
	<span class="nb">push</span><span class="p">(</span><span class="nv">@mapped_emails</span><span class="p">,</span> <span class="n">mailmap_email</span><span class="p">(</span><span class="nv">$line</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">merge_by_realname</span><span class="p">(</span><span class="nv">@mapped_emails</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$email_use_mailmap</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">@mapped_emails</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">merge_by_realname</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%address_map</span><span class="p">;</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">@emails</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$email</span> <span class="p">(</span><span class="nv">@emails</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">exists</span> <span class="nv">$address_map</span><span class="p">{</span><span class="nv">$name</span><span class="p">})</span> <span class="p">{</span>
	    <span class="nv">$address</span> <span class="o">=</span> <span class="nv">$address_map</span><span class="p">{</span><span class="nv">$name</span><span class="p">};</span>
	    <span class="nv">$email</span> <span class="o">=</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="nv">$address_map</span><span class="p">{</span><span class="nv">$name</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$address</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">git_execute_cmd</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$cmd</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="p">();</span>

    <span class="k">my</span> <span class="nv">$output</span> <span class="o">=</span> <span class="sb">`$cmd`</span><span class="p">;</span>
    <span class="nv">$output</span> <span class="o">=~</span> <span class="sr">s/^\s*//gm</span><span class="p">;</span>
    <span class="nv">@lines</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="nv">$output</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">@lines</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">hg_execute_cmd</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$cmd</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="p">();</span>

    <span class="k">my</span> <span class="nv">$output</span> <span class="o">=</span> <span class="sb">`$cmd`</span><span class="p">;</span>
    <span class="nv">@lines</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="nv">$output</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">@lines</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">extract_formatted_signatures</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">@signature_lines</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">@type</span> <span class="o">=</span> <span class="nv">@signature_lines</span><span class="p">;</span>

    <span class="sr">s/\s*(.*):.*/$1/</span> <span class="k">for</span> <span class="p">(</span><span class="nv">@type</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>cut -f2- -d":"</p></td><td class="code"><div class="highlight"><pre>    <span class="sr">s/\s*.*:\s*(.+)\s*/$1/</span> <span class="k">for</span> <span class="p">(</span><span class="nv">@signature_lines</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><h1>Reformat email addresses (with names) to avoid badly written signatures</h1></td><td class="code"><div class="highlight"><pre>    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$signer</span> <span class="p">(</span><span class="nv">@signature_lines</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$signer</span> <span class="o">=</span> <span class="n">deduplicate_email</span><span class="p">(</span><span class="nv">$signer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span><span class="o">\</span><span class="nv">@type</span><span class="p">,</span> <span class="o">\</span><span class="nv">@signature_lines</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">vcs_find_signers</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$cmd</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$commits</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">my</span> <span class="nv">@signatures</span> <span class="o">=</span> <span class="p">();</span>

    <span class="nv">@lines</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">{</span><span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;execute_cmd&quot;</span><span class="p">}}(</span><span class="nv">$cmd</span><span class="p">);</span>

    <span class="k">my</span> <span class="nv">$pattern</span> <span class="o">=</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;commit_pattern&quot;</span><span class="p">};</span>

    <span class="nv">$commits</span> <span class="o">=</span> <span class="nb">grep</span><span class="p">(</span><span class="sr">/$pattern/</span><span class="p">,</span> <span class="nv">@lines</span><span class="p">);</span>	<span class="c1"># of commits</span>

    <span class="nv">@signatures</span> <span class="o">=</span> <span class="nb">grep</span><span class="p">(</span><span class="sr">/^[ \t]*${signature_pattern}.*\@.*$/</span><span class="p">,</span> <span class="nv">@lines</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">@signatures</span><span class="p">)</span> <span class="k">if</span> <span class="o">!</span><span class="nv">@signatures</span><span class="p">;</span>

    <span class="n">save_commits_by_author</span><span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$interactive</span><span class="p">);</span>
    <span class="n">save_commits_by_signer</span><span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$interactive</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$email_git_penguin_chiefs</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">@signatures</span> <span class="o">=</span> <span class="nb">grep</span><span class="p">(</span><span class="o">!</span><span class="sr">/${penguin_chiefs}/i</span><span class="p">,</span> <span class="nv">@signatures</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">my</span> <span class="p">(</span><span class="nv">$types_ref</span><span class="p">,</span> <span class="nv">$signers_ref</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_formatted_signatures</span><span class="p">(</span><span class="nv">@signatures</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">(</span><span class="nv">$commits</span><span class="p">,</span> <span class="nv">@$signers_ref</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">vcs_find_author</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$cmd</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="p">();</span>

    <span class="nv">@lines</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">{</span><span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;execute_cmd&quot;</span><span class="p">}}(</span><span class="nv">$cmd</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$email_git_penguin_chiefs</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">@lines</span> <span class="o">=</span> <span class="nb">grep</span><span class="p">(</span><span class="o">!</span><span class="sr">/${penguin_chiefs}/i</span><span class="p">,</span> <span class="nv">@lines</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">@lines</span> <span class="k">if</span> <span class="o">!</span><span class="nv">@lines</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">@authors</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/$VCS_cmds{&quot;author_pattern&quot;}/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$author</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="nv">$author</span><span class="p">);</span>
	    <span class="nv">$author</span> <span class="o">=</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	    <span class="nb">push</span><span class="p">(</span><span class="nv">@authors</span><span class="p">,</span> <span class="nv">$author</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="n">save_commits_by_author</span><span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$interactive</span><span class="p">);</span>
    <span class="n">save_commits_by_signer</span><span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$interactive</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">@authors</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">vcs_save_commits</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$cmd</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">my</span> <span class="nv">@commits</span> <span class="o">=</span> <span class="p">();</span>

    <span class="nv">@lines</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">{</span><span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;execute_cmd&quot;</span><span class="p">}}(</span><span class="nv">$cmd</span><span class="p">);</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/$VCS_cmds{&quot;blame_commit_pattern&quot;}/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nb">push</span><span class="p">(</span><span class="nv">@commits</span><span class="p">,</span> <span class="nv">$1</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">@commits</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">vcs_blame</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$cmd</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@commits</span> <span class="o">=</span> <span class="p">();</span>

    <span class="k">return</span> <span class="nv">@commits</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="nv">$file</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">@range</span> <span class="o">&amp;&amp;</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;blame_range_cmd&quot;</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">@all_commits</span> <span class="o">=</span> <span class="p">();</span>

	<span class="nv">$cmd</span> <span class="o">=</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;blame_file_cmd&quot;</span><span class="p">};</span>
	<span class="nv">$cmd</span> <span class="o">=~</span> <span class="sr">s/(\$\w+)/$1/eeg</span><span class="p">;</span>		<span class="c1">#interpolate $cmd</span>
	<span class="nv">@all_commits</span> <span class="o">=</span> <span class="n">vcs_save_commits</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>

	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$file_range_diff</span> <span class="p">(</span><span class="nv">@range</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$file_range_diff</span> <span class="o">=~</span> <span class="sr">m/(.+):(.+):(.+)/</span><span class="p">));</span>
	    <span class="k">my</span> <span class="nv">$diff_file</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$diff_start</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$diff_length</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>
	    <span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="s">&quot;$file&quot;</span> <span class="ow">ne</span> <span class="s">&quot;$diff_file&quot;</span><span class="p">);</span>
	    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="nv">$diff_start</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$diff_start</span> <span class="o">+</span> <span class="nv">$diff_length</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="nb">push</span><span class="p">(</span><span class="nv">@commits</span><span class="p">,</span> <span class="nv">$all_commits</span><span class="p">[</span><span class="nv">$i</span><span class="p">]);</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">@range</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$file_range_diff</span> <span class="p">(</span><span class="nv">@range</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$file_range_diff</span> <span class="o">=~</span> <span class="sr">m/(.+):(.+):(.+)/</span><span class="p">));</span>
	    <span class="k">my</span> <span class="nv">$diff_file</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$diff_start</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">$diff_length</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>
	    <span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="s">&quot;$file&quot;</span> <span class="ow">ne</span> <span class="s">&quot;$diff_file&quot;</span><span class="p">);</span>
	    <span class="nv">$cmd</span> <span class="o">=</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;blame_range_cmd&quot;</span><span class="p">};</span>
	    <span class="nv">$cmd</span> <span class="o">=~</span> <span class="sr">s/(\$\w+)/$1/eeg</span><span class="p">;</span>		<span class="c1">#interpolate $cmd</span>
	    <span class="nb">push</span><span class="p">(</span><span class="nv">@commits</span><span class="p">,</span> <span class="n">vcs_save_commits</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">));</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="nv">$cmd</span> <span class="o">=</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;blame_file_cmd&quot;</span><span class="p">};</span>
	<span class="nv">$cmd</span> <span class="o">=~</span> <span class="sr">s/(\$\w+)/$1/eeg</span><span class="p">;</span>		<span class="c1">#interpolate $cmd</span>
	<span class="nv">@commits</span> <span class="o">=</span> <span class="n">vcs_save_commits</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$commit</span> <span class="p">(</span><span class="nv">@commits</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$commit</span> <span class="o">=~</span> <span class="sr">s/^\^//g</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">@commits</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$printed_novcs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">sub </span><span class="nf">vcs_exists</span> <span class="p">{</span>
    <span class="nv">%VCS_cmds</span> <span class="o">=</span> <span class="nv">%VCS_cmds_git</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">eval</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;available&quot;</span><span class="p">};</span>
    <span class="nv">%VCS_cmds</span> <span class="o">=</span> <span class="nv">%VCS_cmds_hg</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="k">if</span> <span class="nb">eval</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;available&quot;</span><span class="p">};</span>
    <span class="nv">%VCS_cmds</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$printed_novcs</span><span class="p">)</span> <span class="p">{</span>
	<span class="nb">warn</span><span class="p">(</span><span class="s">&quot;$P: No supported VCS found.  Add --nogit to options?\n&quot;</span><span class="p">);</span>
	<span class="nb">warn</span><span class="p">(</span><span class="s">&quot;Using a git repository produces better results.\n&quot;</span><span class="p">);</span>
	<span class="nb">warn</span><span class="p">(</span><span class="s">&quot;Try Linus Torvalds&#39; latest git repository using:\n&quot;</span><span class="p">);</span>
	<span class="nb">warn</span><span class="p">(</span><span class="s">&quot;git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git\n&quot;</span><span class="p">);</span>
	<span class="nv">$printed_novcs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">vcs_is_git</span> <span class="p">{</span>
    <span class="n">vcs_exists</span><span class="p">();</span>
    <span class="k">return</span> <span class="nv">$vcs_used</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">vcs_is_hg</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$vcs_used</span> <span class="o">==</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">interactive_get_maintainers</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$list_ref</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="nv">@$list_ref</span><span class="p">;</span>

    <span class="n">vcs_exists</span><span class="p">();</span>

    <span class="k">my</span> <span class="nv">%selected</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">%authored</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">%signed</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$maintained</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$entry</span> <span class="p">(</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$maintained</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /^(maintainer|supporter)/i</span><span class="p">);</span>
	<span class="nv">$selected</span><span class="p">{</span><span class="nv">$count</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="nv">$authored</span><span class="p">{</span><span class="nv">$count</span><span class="p">}</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="nv">$signed</span><span class="p">{</span><span class="nv">$count</span><span class="p">}</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>menu loop</p></td><td class="code"><div class="highlight"><pre>    <span class="k">my</span> <span class="nv">$done</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$print_options</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$redraw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nv">$done</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$redraw</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nb">printf</span> <span class="bp">STDERR</span> <span class="s">&quot;\n%1s %2s %-65s&quot;</span><span class="p">,</span>
			  <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="s">&quot;#&quot;</span><span class="p">,</span> <span class="s">&quot;email/list and role:stats&quot;</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$email_git</span> <span class="o">||</span>
		<span class="p">(</span><span class="nv">$email_git_fallback</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$maintained</span><span class="p">)</span> <span class="o">||</span>
		<span class="nv">$email_git_blame</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;auth sign&quot;</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
	    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$entry</span> <span class="p">(</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="nv">$email</span> <span class="o">=</span> <span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="k">my</span> <span class="nv">$role</span> <span class="o">=</span> <span class="nv">$entry</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
		<span class="k">my</span> <span class="nv">$sel</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
		<span class="nv">$sel</span> <span class="o">=</span> <span class="s">&quot;*&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$selected</span><span class="p">{</span><span class="nv">$count</span><span class="p">});</span>
		<span class="k">my</span> <span class="nv">$commit_author</span> <span class="o">=</span> <span class="nv">$commit_author_hash</span><span class="p">{</span><span class="nv">$email</span><span class="p">};</span>
		<span class="k">my</span> <span class="nv">$commit_signer</span> <span class="o">=</span> <span class="nv">$commit_signer_hash</span><span class="p">{</span><span class="nv">$email</span><span class="p">};</span>
		<span class="k">my</span> <span class="nv">$authored</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">my</span> <span class="nv">$signed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="nv">$authored</span><span class="o">++</span> <span class="k">for</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$commit_author</span><span class="p">});</span>
		<span class="nv">$signed</span><span class="o">++</span> <span class="k">for</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$commit_signer</span><span class="p">});</span>
		<span class="nb">printf</span> <span class="bp">STDERR</span> <span class="s">&quot;%1s %2d %-65s&quot;</span><span class="p">,</span> <span class="nv">$sel</span><span class="p">,</span> <span class="nv">$count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">$email</span><span class="p">;</span>
		<span class="nb">printf</span> <span class="bp">STDERR</span> <span class="s">&quot;%4d %4d&quot;</span><span class="p">,</span> <span class="nv">$authored</span><span class="p">,</span> <span class="nv">$signed</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$authored</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nv">$signed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="nb">printf</span> <span class="bp">STDERR</span> <span class="s">&quot;\n     %s\n&quot;</span><span class="p">,</span> <span class="nv">$role</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$authored</span><span class="p">{</span><span class="nv">$count</span><span class="p">})</span> <span class="p">{</span>
		    <span class="k">my</span> <span class="nv">$commit_author</span> <span class="o">=</span> <span class="nv">$commit_author_hash</span><span class="p">{</span><span class="nv">$email</span><span class="p">};</span>
		    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$ref</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$commit_author</span><span class="p">})</span> <span class="p">{</span>
			<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;     Author: @{$ref}[1]\n&quot;</span><span class="p">;</span>
		    <span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$signed</span><span class="p">{</span><span class="nv">$count</span><span class="p">})</span> <span class="p">{</span>
		    <span class="k">my</span> <span class="nv">$commit_signer</span> <span class="o">=</span> <span class="nv">$commit_signer_hash</span><span class="p">{</span><span class="nv">$email</span><span class="p">};</span>
		    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$ref</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$commit_signer</span><span class="p">})</span> <span class="p">{</span>
			<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;     @{$ref}[2]: @{$ref}[1]\n&quot;</span><span class="p">;</span>
		    <span class="p">}</span>
		<span class="p">}</span>

		<span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
	<span class="k">my</span> <span class="nv">$date_ref</span> <span class="o">=</span> <span class="o">\</span><span class="nv">$email_git_since</span><span class="p">;</span>
	<span class="nv">$date_ref</span> <span class="o">=</span> <span class="o">\</span><span class="nv">$email_hg_since</span> <span class="k">if</span> <span class="p">(</span><span class="n">vcs_is_hg</span><span class="p">());</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$print_options</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$print_options</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">vcs_exists</span><span class="p">())</span> <span class="p">{</span>
		<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&lt;&lt;EOT</span>

<span class="s">Version Control options:</span>
<span class="s">g  use git history      [$email_git]</span>
<span class="s">gf use git-fallback     [$email_git_fallback]</span>
<span class="s">b  use git blame        [$email_git_blame]</span>
<span class="s">bs use blame signatures [$email_git_blame_signatures]</span>
<span class="s">c# minimum commits      [$email_git_min_signatures]</span>
<span class="s">%# min percent          [$email_git_min_percent]</span>
<span class="s">d# history to use       [$$date_ref]</span>
<span class="s">x# max maintainers      [$email_git_max_maintainers]</span>
<span class="s">t  all signature types  [$email_git_all_signature_types]</span>
<span class="s">m  use .mailmap         [$email_use_mailmap]</span>
<span class="s">EOT</span>
	    <span class="p">}</span>
	    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&lt;&lt;EOT</span>

<span class="s">Additional options:</span>
<span class="s">0  toggle all</span>
<span class="s">tm toggle maintainers</span>
<span class="s">tg toggle git entries</span>
<span class="s">tl toggle open list entries</span>
<span class="s">ts toggle subscriber list entries</span>
<span class="s">f  emails in file       [$file_emails]</span>
<span class="s">k  keywords in file     [$keywords]</span>
<span class="s">r  remove duplicates    [$email_remove_duplicates]</span>
<span class="s">p# pattern match depth  [$pattern_depth]</span>
<span class="s">EOT</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="bp">STDERR</span>
<span class="s">&quot;\n#(toggle), A#(author), S#(signed) *(all), ^(none), O(options), Y(approve): &quot;</span><span class="p">;</span>

	<span class="k">my</span> <span class="nv">$input</span> <span class="o">=</span> <span class="sr">&lt;STDIN&gt;</span><span class="p">;</span>
	<span class="nb">chomp</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>

	<span class="nv">$redraw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">@wish</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/[, ]+/</span><span class="p">,</span> <span class="nv">$input</span><span class="p">);</span>
	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$nr</span> <span class="p">(</span><span class="nv">@wish</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$nr</span> <span class="o">=</span> <span class="nb">lc</span><span class="p">(</span><span class="nv">$nr</span><span class="p">);</span>
	    <span class="k">my</span> <span class="nv">$sel</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$nr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	    <span class="k">my</span> <span class="nv">$str</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$nr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	    <span class="k">my</span> <span class="nv">$val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="nv">$val</span> <span class="o">=</span> <span class="nv">$1</span> <span class="k">if</span> <span class="nv">$str</span> <span class="o">=~</span><span class="sr"> /^(\d+)$/</span><span class="p">;</span>

	    <span class="k">if</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;y&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$interactive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="nv">$done</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="nv">$output_rolestats</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="nv">$output_roles</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">last</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$nr</span> <span class="o">=~</span><span class="sr"> /^\d+$/</span> <span class="o">&amp;&amp;</span> <span class="nv">$nr</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$nr</span> <span class="o">&lt;=</span> <span class="nv">$count</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$selected</span><span class="p">{</span><span class="nv">$nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}</span> <span class="o">=</span> <span class="o">!</span><span class="nv">$selected</span><span class="p">{</span><span class="nv">$nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">};</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;*&quot;</span> <span class="o">||</span> <span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&#39;^&#39;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="nv">$toggle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="nv">$toggle</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&#39;*&#39;</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$count</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$selected</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$toggle</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;0&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$count</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$selected</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span> <span class="o">=</span> <span class="o">!</span><span class="nv">$selected</span><span class="p">{</span><span class="nv">$i</span><span class="p">};</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;t&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;m&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$count</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$selected</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span> <span class="o">=</span> <span class="o">!</span><span class="nv">$selected</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span>
			    <span class="k">if</span> <span class="p">(</span><span class="nv">$list</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /^(maintainer|supporter)/i</span><span class="p">);</span>
		    <span class="p">}</span>
		<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;g&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$count</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$selected</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span> <span class="o">=</span> <span class="o">!</span><span class="nv">$selected</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span>
			    <span class="k">if</span> <span class="p">(</span><span class="nv">$list</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /^(author|commit|signer)/i</span><span class="p">);</span>
		    <span class="p">}</span>
		<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;l&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$count</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$selected</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span> <span class="o">=</span> <span class="o">!</span><span class="nv">$selected</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span>
			    <span class="k">if</span> <span class="p">(</span><span class="nv">$list</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /^(open list)/i</span><span class="p">);</span>
		    <span class="p">}</span>
		<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;s&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$count</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$selected</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span> <span class="o">=</span> <span class="o">!</span><span class="nv">$selected</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span>
			    <span class="k">if</span> <span class="p">(</span><span class="nv">$list</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /^(subscriber list)/i</span><span class="p">);</span>
		    <span class="p">}</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$val</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$val</span> <span class="o">&lt;=</span> <span class="nv">$count</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$authored</span><span class="p">{</span><span class="nv">$val</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}</span> <span class="o">=</span> <span class="o">!</span><span class="nv">$authored</span><span class="p">{</span><span class="nv">$val</span> <span class="o">-</span> <span class="mi">1</span><span class="p">};</span>
		<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$str</span> <span class="ow">eq</span> <span class="s">&#39;*&#39;</span> <span class="o">||</span> <span class="nv">$str</span> <span class="ow">eq</span> <span class="s">&#39;^&#39;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">my</span> <span class="nv">$toggle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		    <span class="nv">$toggle</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$str</span> <span class="ow">eq</span> <span class="s">&#39;*&#39;</span><span class="p">);</span>
		    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$count</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$authored</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$toggle</span><span class="p">;</span>
		    <span class="p">}</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;s&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$val</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$val</span> <span class="o">&lt;=</span> <span class="nv">$count</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$signed</span><span class="p">{</span><span class="nv">$val</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}</span> <span class="o">=</span> <span class="o">!</span><span class="nv">$signed</span><span class="p">{</span><span class="nv">$val</span> <span class="o">-</span> <span class="mi">1</span><span class="p">};</span>
		<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$str</span> <span class="ow">eq</span> <span class="s">&#39;*&#39;</span> <span class="o">||</span> <span class="nv">$str</span> <span class="ow">eq</span> <span class="s">&#39;^&#39;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">my</span> <span class="nv">$toggle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		    <span class="nv">$toggle</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$str</span> <span class="ow">eq</span> <span class="s">&#39;*&#39;</span><span class="p">);</span>
		    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$count</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$signed</span><span class="p">{</span><span class="nv">$i</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$toggle</span><span class="p">;</span>
		    <span class="p">}</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;o&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$print_options</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="nv">$redraw</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;g&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$str</span> <span class="ow">eq</span> <span class="s">&quot;f&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">bool_invert</span><span class="p">(</span><span class="o">\</span><span class="nv">$email_git_fallback</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="n">bool_invert</span><span class="p">(</span><span class="o">\</span><span class="nv">$email_git</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;b&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$str</span> <span class="ow">eq</span> <span class="s">&quot;s&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">bool_invert</span><span class="p">(</span><span class="o">\</span><span class="nv">$email_git_blame_signatures</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="n">bool_invert</span><span class="p">(</span><span class="o">\</span><span class="nv">$email_git_blame</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;c&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$email_git_min_signatures</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">;</span>
		    <span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;x&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$email_git_max_maintainers</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">;</span>
		    <span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;%&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$str</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">$val</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$email_git_min_percent</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">;</span>
		    <span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;d&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vcs_is_git</span><span class="p">())</span> <span class="p">{</span>
		    <span class="nv">$email_git_since</span> <span class="o">=</span> <span class="nv">$str</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="n">vcs_is_hg</span><span class="p">())</span> <span class="p">{</span>
		    <span class="nv">$email_hg_since</span> <span class="o">=</span> <span class="nv">$str</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;t&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bool_invert</span><span class="p">(</span><span class="o">\</span><span class="nv">$email_git_all_signature_types</span><span class="p">);</span>
		<span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;f&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bool_invert</span><span class="p">(</span><span class="o">\</span><span class="nv">$file_emails</span><span class="p">);</span>
		<span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bool_invert</span><span class="p">(</span><span class="o">\</span><span class="nv">$email_remove_duplicates</span><span class="p">);</span>
		<span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;m&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bool_invert</span><span class="p">(</span><span class="o">\</span><span class="nv">$email_use_mailmap</span><span class="p">);</span>
		<span class="n">read_mailmap</span><span class="p">();</span>
		<span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;k&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bool_invert</span><span class="p">(</span><span class="o">\</span><span class="nv">$keywords</span><span class="p">);</span>
		<span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;p&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$str</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">$val</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$pattern_depth</span> <span class="o">=</span> <span class="nv">$val</span><span class="p">;</span>
		    <span class="nv">$rerun</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;h&quot;</span> <span class="o">||</span> <span class="nv">$sel</span> <span class="ow">eq</span> <span class="s">&quot;?&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&lt;&lt;EOT</span>

<span class="s">Interactive mode allows you to select the various maintainers, submitters,</span>
<span class="s">commit signers and mailing lists that could be CC&#39;d on a patch.</span>

<span class="s">Any *&#39;d entry is selected.</span>

<span class="s">If you have git or hg installed, you can choose to summarize the commit</span>
<span class="s">history of files in the patch.  Also, each line of the current file can</span>
<span class="s">be matched to its commit author and that commits signers with blame.</span>

<span class="s">Various knobs exist to control the length of time for active commit</span>
<span class="s">tracking, the maximum number of commit authors and signers to add,</span>
<span class="s">and such.</span>

<span class="s">Enter selections at the prompt until you are satisfied that the selected</span>
<span class="s">maintainers are appropriate.  You may enter multiple selections separated</span>
<span class="s">by either commas or spaces.</span>

<span class="s">EOT</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;invalid option: &#39;$nr&#39;\n&quot;</span><span class="p">;</span>
		<span class="nv">$redraw</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$rerun</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;git-blame can be very slow, please have patience...&quot;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$email_git_blame</span><span class="p">);</span>
	    <span class="nb">goto</span> <span class="o">&amp;</span><span class="n">get_maintainers</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>drop not selected entries</p></td><td class="code"><div class="highlight"><pre>    <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@new_emailto</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$entry</span> <span class="p">(</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$selected</span><span class="p">{</span><span class="nv">$count</span><span class="p">})</span> <span class="p">{</span>
	    <span class="nb">push</span><span class="p">(</span><span class="nv">@new_emailto</span><span class="p">,</span> <span class="nv">$list</span><span class="p">[</span><span class="nv">$count</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">@new_emailto</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">bool_invert</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$bool_ref</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$$bool_ref</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$$bool_ref</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="nv">$$bool_ref</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">deduplicate_email</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$email</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$matched</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>
    <span class="nv">$email</span> <span class="o">=</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nv">$email</span> <span class="o">=</span> <span class="n">mailmap_email</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$email</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$email_remove_duplicates</span><span class="p">);</span>

    <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$name</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">$deduplicate_name_hash</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$name</span><span class="p">)})</span> <span class="p">{</span>
	<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$deduplicate_name_hash</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$name</span><span class="p">)}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nv">$address</span> <span class="o">=</span> <span class="nv">$deduplicate_name_hash</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$name</span><span class="p">)}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="nv">$matched</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$deduplicate_address_hash</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$address</span><span class="p">)})</span> <span class="p">{</span>
	<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$deduplicate_address_hash</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$address</span><span class="p">)}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nv">$address</span> <span class="o">=</span> <span class="nv">$deduplicate_address_hash</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$address</span><span class="p">)}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="nv">$matched</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$matched</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$deduplicate_name_hash</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$name</span><span class="p">)}</span> <span class="o">=</span> <span class="p">[</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span> <span class="p">];</span>
	<span class="nv">$deduplicate_address_hash</span><span class="p">{</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$address</span><span class="p">)}</span> <span class="o">=</span> <span class="p">[</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span> <span class="p">];</span>
    <span class="p">}</span>
    <span class="nv">$email</span> <span class="o">=</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nv">$email</span> <span class="o">=</span> <span class="n">mailmap_email</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$email</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">save_commits_by_author</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">@authors</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">my</span> <span class="nv">@commits</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">my</span> <span class="nv">@subjects</span> <span class="o">=</span> <span class="p">();</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/$VCS_cmds{&quot;author_pattern&quot;}/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$author</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="nv">$author</span> <span class="o">=</span> <span class="n">deduplicate_email</span><span class="p">(</span><span class="nv">$author</span><span class="p">);</span>
	    <span class="nb">push</span><span class="p">(</span><span class="nv">@authors</span><span class="p">,</span> <span class="nv">$author</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="nb">push</span><span class="p">(</span><span class="nv">@commits</span><span class="p">,</span> <span class="nv">$1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/$VCS_cmds{&quot;commit_pattern&quot;}/</span><span class="p">);</span>
	<span class="nb">push</span><span class="p">(</span><span class="nv">@subjects</span><span class="p">,</span> <span class="nv">$1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/$VCS_cmds{&quot;subject_pattern&quot;}/</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">@authors</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$exists</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$ref</span><span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$commit_author_hash</span><span class="p">{</span><span class="nv">$authors</span><span class="p">[</span><span class="nv">$i</span><span class="p">]}})</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$ref</span><span class="p">}[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="nv">$commits</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
		<span class="nv">@</span><span class="p">{</span><span class="nv">$ref</span><span class="p">}[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">eq</span> <span class="nv">$subjects</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="p">{</span>
		<span class="nv">$exists</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">last</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$exists</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nb">push</span><span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$commit_author_hash</span><span class="p">{</span><span class="nv">$authors</span><span class="p">[</span><span class="nv">$i</span><span class="p">]}},</span>
		 <span class="p">[</span> <span class="p">(</span><span class="nv">$commits</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span> <span class="nv">$subjects</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="p">]);</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">save_commits_by_signer</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$commit</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$subject</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$commit</span> <span class="o">=</span> <span class="nv">$1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/$VCS_cmds{&quot;commit_pattern&quot;}/</span><span class="p">);</span>
	<span class="nv">$subject</span> <span class="o">=</span> <span class="nv">$1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/$VCS_cmds{&quot;subject_pattern&quot;}/</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /^[ \t]*${signature_pattern}.*\@.*$/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">@signatures</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
	    <span class="k">my</span> <span class="p">(</span><span class="nv">$types_ref</span><span class="p">,</span> <span class="nv">$signers_ref</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_formatted_signatures</span><span class="p">(</span><span class="nv">@signatures</span><span class="p">);</span>
	    <span class="k">my</span> <span class="nv">@types</span> <span class="o">=</span> <span class="nv">@$types_ref</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">@signers</span> <span class="o">=</span> <span class="nv">@$signers_ref</span><span class="p">;</span>

	    <span class="k">my</span> <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$types</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	    <span class="k">my</span> <span class="nv">$signer</span> <span class="o">=</span> <span class="nv">$signers</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	    <span class="nv">$signer</span> <span class="o">=</span> <span class="n">deduplicate_email</span><span class="p">(</span><span class="nv">$signer</span><span class="p">);</span>

	    <span class="k">my</span> <span class="nv">$exists</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$ref</span><span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$commit_signer_hash</span><span class="p">{</span><span class="nv">$signer</span><span class="p">}})</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$ref</span><span class="p">}[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="nv">$commit</span> <span class="o">&amp;&amp;</span>
		    <span class="nv">@</span><span class="p">{</span><span class="nv">$ref</span><span class="p">}[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">eq</span> <span class="nv">$subject</span> <span class="o">&amp;&amp;</span>
		    <span class="nv">@</span><span class="p">{</span><span class="nv">$ref</span><span class="p">}[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">eq</span> <span class="nv">$type</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$exists</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		    <span class="k">last</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$exists</span><span class="p">)</span> <span class="p">{</span>
		<span class="nb">push</span><span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$commit_signer_hash</span><span class="p">{</span><span class="nv">$signer</span><span class="p">}},</span>
		     <span class="p">[</span> <span class="p">(</span><span class="nv">$commit</span><span class="p">,</span> <span class="nv">$subject</span><span class="p">,</span> <span class="nv">$type</span><span class="p">)</span> <span class="p">]);</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">vcs_assign</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$role</span><span class="p">,</span> <span class="nv">$divisor</span><span class="p">,</span> <span class="nv">@lines</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">%hash</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="nv">@lines</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$divisor</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="nb">warn</span><span class="p">(</span><span class="s">&quot;Bad divisor in &quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nb">caller</span><span class="p">(</span><span class="mi">0</span><span class="p">))[</span><span class="mi">3</span><span class="p">]</span> <span class="o">.</span> <span class="s">&quot;: $divisor\n&quot;</span><span class="p">);</span>
	<span class="nv">$divisor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">@lines</span> <span class="o">=</span> <span class="n">mailmap</span><span class="p">(</span><span class="nv">@lines</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="nv">@lines</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">);</span>

    <span class="nv">@lines</span> <span class="o">=</span> <span class="nb">sort</span><span class="p">(</span><span class="nv">@lines</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>uniq -c</p></td><td class="code"><div class="highlight"><pre>    <span class="nv">$hash</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span><span class="o">++</span> <span class="k">for</span> <span class="nv">@lines</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>sort -rn</p></td><td class="code"><div class="highlight"><pre>    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nb">sort</span> <span class="p">{</span><span class="nv">$hash</span><span class="p">{</span><span class="nv">$b</span><span class="p">}</span> <span class="sr">&lt;=&gt;</span> <span class="nv">$hash</span><span class="p">{</span><span class="nv">$a</span><span class="p">}}</span> <span class="nb">keys</span> <span class="nv">%hash</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$sign_offs</span> <span class="o">=</span> <span class="nv">$hash</span><span class="p">{</span><span class="nv">$line</span><span class="p">};</span>
	<span class="k">my</span> <span class="nv">$percent</span> <span class="o">=</span> <span class="nv">$sign_offs</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="nv">$divisor</span><span class="p">;</span>

	<span class="nv">$percent</span> <span class="o">=</span> <span class="mi">100</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$percent</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">);</span>
	<span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
	<span class="k">last</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$sign_offs</span> <span class="o">&lt;</span> <span class="nv">$email_git_min_signatures</span> <span class="o">||</span>
		 <span class="nv">$count</span> <span class="o">&gt;</span> <span class="nv">$email_git_max_maintainers</span> <span class="o">||</span>
		 <span class="nv">$percent</span> <span class="o">&lt;</span> <span class="nv">$email_git_min_percent</span><span class="p">);</span>
	<span class="n">push_email_address</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$output_rolestats</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$fmt_percent</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s">&quot;%.0f&quot;</span><span class="p">,</span> <span class="nv">$percent</span><span class="p">);</span>
	    <span class="n">add_role</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="s">&quot;$role:$sign_offs/$divisor=$fmt_percent%&quot;</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="n">add_role</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="nv">$role</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">vcs_file_signoffs</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">@signers</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">my</span> <span class="nv">$commits</span><span class="p">;</span>

    <span class="nv">$vcs_used</span> <span class="o">=</span> <span class="n">vcs_exists</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$vcs_used</span><span class="p">);</span>

    <span class="k">my</span> <span class="nv">$cmd</span> <span class="o">=</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;find_signers_cmd&quot;</span><span class="p">};</span>
    <span class="nv">$cmd</span> <span class="o">=~</span> <span class="sr">s/(\$\w+)/$1/eeg</span><span class="p">;</span>		<span class="c1"># interpolate $cmd</span>

    <span class="p">(</span><span class="nv">$commits</span><span class="p">,</span> <span class="nv">@signers</span><span class="p">)</span> <span class="o">=</span> <span class="n">vcs_find_signers</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$signer</span> <span class="p">(</span><span class="nv">@signers</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$signer</span> <span class="o">=</span> <span class="n">deduplicate_email</span><span class="p">(</span><span class="nv">$signer</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">vcs_assign</span><span class="p">(</span><span class="s">&quot;commit_signer&quot;</span><span class="p">,</span> <span class="nv">$commits</span><span class="p">,</span> <span class="nv">@signers</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">vcs_file_blame</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">@signers</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">my</span> <span class="nv">@all_commits</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">my</span> <span class="nv">@commits</span> <span class="o">=</span> <span class="p">();</span>
    <span class="k">my</span> <span class="nv">$total_commits</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$total_lines</span><span class="p">;</span>

    <span class="nv">$vcs_used</span> <span class="o">=</span> <span class="n">vcs_exists</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$vcs_used</span><span class="p">);</span>

    <span class="nv">@all_commits</span> <span class="o">=</span> <span class="n">vcs_blame</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="nv">@commits</span> <span class="o">=</span> <span class="n">uniq</span><span class="p">(</span><span class="nv">@all_commits</span><span class="p">);</span>
    <span class="nv">$total_commits</span> <span class="o">=</span> <span class="nv">@commits</span><span class="p">;</span>
    <span class="nv">$total_lines</span> <span class="o">=</span> <span class="nv">@all_commits</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$email_git_blame_signatures</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vcs_is_hg</span><span class="p">())</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$commit_count</span><span class="p">;</span>
	    <span class="k">my</span> <span class="nv">@commit_signers</span> <span class="o">=</span> <span class="p">();</span>
	    <span class="k">my</span> <span class="nv">$commit</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot; -r &quot;</span><span class="p">,</span> <span class="nv">@commits</span><span class="p">);</span>
	    <span class="k">my</span> <span class="nv">$cmd</span><span class="p">;</span>

	    <span class="nv">$cmd</span> <span class="o">=</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;find_commit_signers_cmd&quot;</span><span class="p">};</span>
	    <span class="nv">$cmd</span> <span class="o">=~</span> <span class="sr">s/(\$\w+)/$1/eeg</span><span class="p">;</span>	<span class="c1">#substitute variables in $cmd</span>

	    <span class="p">(</span><span class="nv">$commit_count</span><span class="p">,</span> <span class="nv">@commit_signers</span><span class="p">)</span> <span class="o">=</span> <span class="n">vcs_find_signers</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>

	    <span class="nb">push</span><span class="p">(</span><span class="nv">@signers</span><span class="p">,</span> <span class="nv">@commit_signers</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$commit</span> <span class="p">(</span><span class="nv">@commits</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="nv">$commit_count</span><span class="p">;</span>
		<span class="k">my</span> <span class="nv">@commit_signers</span> <span class="o">=</span> <span class="p">();</span>
		<span class="k">my</span> <span class="nv">$cmd</span><span class="p">;</span>

		<span class="nv">$cmd</span> <span class="o">=</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;find_commit_signers_cmd&quot;</span><span class="p">};</span>
		<span class="nv">$cmd</span> <span class="o">=~</span> <span class="sr">s/(\$\w+)/$1/eeg</span><span class="p">;</span>	<span class="c1">#substitute variables in $cmd</span>

		<span class="p">(</span><span class="nv">$commit_count</span><span class="p">,</span> <span class="nv">@commit_signers</span><span class="p">)</span> <span class="o">=</span> <span class="n">vcs_find_signers</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>

		<span class="nb">push</span><span class="p">(</span><span class="nv">@signers</span><span class="p">,</span> <span class="nv">@commit_signers</span><span class="p">);</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$from_filename</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$output_rolestats</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">@blame_signers</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">vcs_is_hg</span><span class="p">())</span> <span class="p">{{</span>		<span class="c1"># Double brace for last exit</span>
		<span class="k">my</span> <span class="nv">$commit_count</span><span class="p">;</span>
		<span class="k">my</span> <span class="nv">@commit_signers</span> <span class="o">=</span> <span class="p">();</span>
		<span class="nv">@commits</span> <span class="o">=</span> <span class="n">uniq</span><span class="p">(</span><span class="nv">@commits</span><span class="p">);</span>
		<span class="nv">@commits</span> <span class="o">=</span> <span class="nb">sort</span><span class="p">(</span><span class="nv">@commits</span><span class="p">);</span>
		<span class="k">my</span> <span class="nv">$commit</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot; -r &quot;</span><span class="p">,</span> <span class="nv">@commits</span><span class="p">);</span>
		<span class="k">my</span> <span class="nv">$cmd</span><span class="p">;</span>

		<span class="nv">$cmd</span> <span class="o">=</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;find_commit_author_cmd&quot;</span><span class="p">};</span>
		<span class="nv">$cmd</span> <span class="o">=~</span> <span class="sr">s/(\$\w+)/$1/eeg</span><span class="p">;</span>	<span class="c1">#substitute variables in $cmd</span>

		<span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="p">();</span>

		<span class="nv">@lines</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">{</span><span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;execute_cmd&quot;</span><span class="p">}}(</span><span class="nv">$cmd</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$email_git_penguin_chiefs</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">@lines</span> <span class="o">=</span> <span class="nb">grep</span><span class="p">(</span><span class="o">!</span><span class="sr">/${penguin_chiefs}/i</span><span class="p">,</span> <span class="nv">@lines</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">last</span> <span class="k">if</span> <span class="o">!</span><span class="nv">@lines</span><span class="p">;</span>

		<span class="k">my</span> <span class="nv">@authors</span> <span class="o">=</span> <span class="p">();</span>
		<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/$VCS_cmds{&quot;author_pattern&quot;}/</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">my</span> <span class="nv">$author</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
			<span class="nv">$author</span> <span class="o">=</span> <span class="n">deduplicate_email</span><span class="p">(</span><span class="nv">$author</span><span class="p">);</span>
			<span class="nb">push</span><span class="p">(</span><span class="nv">@authors</span><span class="p">,</span> <span class="nv">$author</span><span class="p">);</span>
		    <span class="p">}</span>
		<span class="p">}</span>

		<span class="n">save_commits_by_author</span><span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$interactive</span><span class="p">);</span>
		<span class="n">save_commits_by_signer</span><span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$interactive</span><span class="p">);</span>

		<span class="nb">push</span><span class="p">(</span><span class="nv">@signers</span><span class="p">,</span> <span class="nv">@authors</span><span class="p">);</span>
	    <span class="p">}}</span>
	    <span class="k">else</span> <span class="p">{</span>
		<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$commit</span> <span class="p">(</span><span class="nv">@commits</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">my</span> <span class="nv">$i</span><span class="p">;</span>
		    <span class="k">my</span> <span class="nv">$cmd</span> <span class="o">=</span> <span class="nv">$VCS_cmds</span><span class="p">{</span><span class="s">&quot;find_commit_author_cmd&quot;</span><span class="p">};</span>
		    <span class="nv">$cmd</span> <span class="o">=~</span> <span class="sr">s/(\$\w+)/$1/eeg</span><span class="p">;</span>	<span class="c1">#interpolate $cmd</span>
		    <span class="k">my</span> <span class="nv">@author</span> <span class="o">=</span> <span class="n">vcs_find_author</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>
		    <span class="k">next</span> <span class="k">if</span> <span class="o">!</span><span class="nv">@author</span><span class="p">;</span>

		    <span class="k">my</span> <span class="nv">$formatted_author</span> <span class="o">=</span> <span class="n">deduplicate_email</span><span class="p">(</span><span class="nv">$author</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

		    <span class="k">my</span> <span class="nv">$count</span> <span class="o">=</span> <span class="nb">grep</span><span class="p">(</span><span class="sr">/$commit/</span><span class="p">,</span> <span class="nv">@all_commits</span><span class="p">);</span>
		    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$count</span> <span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nb">push</span><span class="p">(</span><span class="nv">@blame_signers</span><span class="p">,</span> <span class="nv">$formatted_author</span><span class="p">);</span>
		    <span class="p">}</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">@blame_signers</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">vcs_assign</span><span class="p">(</span><span class="s">&quot;authored lines&quot;</span><span class="p">,</span> <span class="nv">$total_lines</span><span class="p">,</span> <span class="nv">@blame_signers</span><span class="p">);</span>
	    <span class="p">}</span>
	<span class="p">}</span>
	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$signer</span> <span class="p">(</span><span class="nv">@signers</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$signer</span> <span class="o">=</span> <span class="n">deduplicate_email</span><span class="p">(</span><span class="nv">$signer</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">vcs_assign</span><span class="p">(</span><span class="s">&quot;commits&quot;</span><span class="p">,</span> <span class="nv">$total_commits</span><span class="p">,</span> <span class="nv">@signers</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$signer</span> <span class="p">(</span><span class="nv">@signers</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$signer</span> <span class="o">=</span> <span class="n">deduplicate_email</span><span class="p">(</span><span class="nv">$signer</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">vcs_assign</span><span class="p">(</span><span class="s">&quot;modified commits&quot;</span><span class="p">,</span> <span class="nv">$total_commits</span><span class="p">,</span> <span class="nv">@signers</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">uniq</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">@parms</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">%saw</span><span class="p">;</span>
    <span class="nv">@parms</span> <span class="o">=</span> <span class="nb">grep</span><span class="p">(</span><span class="o">!</span><span class="nv">$saw</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span><span class="o">++</span><span class="p">,</span> <span class="nv">@parms</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">@parms</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">sort_and_uniq</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">@parms</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">%saw</span><span class="p">;</span>
    <span class="nv">@parms</span> <span class="o">=</span> <span class="nb">sort</span> <span class="nv">@parms</span><span class="p">;</span>
    <span class="nv">@parms</span> <span class="o">=</span> <span class="nb">grep</span><span class="p">(</span><span class="o">!</span><span class="nv">$saw</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span><span class="o">++</span><span class="p">,</span> <span class="nv">@parms</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">@parms</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">clean_file_emails</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">@file_emails</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@fmt_emails</span> <span class="o">=</span> <span class="p">();</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$email</span> <span class="p">(</span><span class="nv">@file_emails</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$email</span> <span class="o">=~</span> <span class="sr">s/[\(\&lt;\{]{0,1}([A-Za-z0-9_\.\+-]+\@[A-Za-z0-9\.-]+)[\)\&gt;\}]{0,1}/\&lt;$1\&gt;/g</span><span class="p">;</span>
	<span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_email</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$name</span> <span class="ow">eq</span> <span class="s">&#39;&quot;[,\.]&quot;&#39;</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">my</span> <span class="nv">@nw</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/[^A-Za-zÀ-ÿ\&#39;\,\.\+-]/</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">@nw</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$first</span> <span class="o">=</span> <span class="nv">$nw</span><span class="p">[</span><span class="nv">@nw</span> <span class="o">-</span> <span class="mi">3</span><span class="p">];</span>
	    <span class="k">my</span> <span class="nv">$middle</span> <span class="o">=</span> <span class="nv">$nw</span><span class="p">[</span><span class="nv">@nw</span> <span class="o">-</span> <span class="mi">2</span><span class="p">];</span>
	    <span class="k">my</span> <span class="nv">$last</span> <span class="o">=</span> <span class="nv">$nw</span><span class="p">[</span><span class="nv">@nw</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>

	    <span class="k">if</span> <span class="p">(((</span><span class="nb">length</span><span class="p">(</span><span class="nv">$first</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$first</span> <span class="o">=~</span> <span class="sr">m/[A-Za-z]/</span><span class="p">)</span> <span class="o">||</span>
		 <span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="nv">$first</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$first</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;.&quot;</span><span class="p">))</span> <span class="o">||</span>
		<span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="nv">$middle</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span>
		 <span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="nv">$middle</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$middle</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;.&quot;</span><span class="p">)))</span> <span class="p">{</span>
		<span class="nv">$name</span> <span class="o">=</span> <span class="s">&quot;$first $middle $last&quot;</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nv">$name</span> <span class="o">=</span> <span class="s">&quot;$middle $last&quot;</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">=~</span><span class="sr"> /[,\.]/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$name</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">=~</span><span class="sr"> /[,\.]&quot;/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$name</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="s">&#39;&quot;&#39;</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=~</span><span class="sr"> /[,\.]/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$name</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=~</span><span class="sr"> /&quot;[,\.]/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$name</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span> <span class="o">.</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">my</span> <span class="nv">$fmt_email</span> <span class="o">=</span> <span class="n">format_email</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$address</span><span class="p">,</span> <span class="nv">$email_usename</span><span class="p">);</span>
	<span class="nb">push</span><span class="p">(</span><span class="nv">@fmt_emails</span><span class="p">,</span> <span class="nv">$fmt_email</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">@fmt_emails</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">merge_email</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">@lines</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">%saw</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nv">@_</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="p">(</span><span class="nv">$address</span><span class="p">,</span> <span class="nv">$role</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@$_</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$saw</span><span class="p">{</span><span class="nv">$address</span><span class="p">})</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$output_roles</span><span class="p">)</span> <span class="p">{</span>
		<span class="nb">push</span><span class="p">(</span><span class="nv">@lines</span><span class="p">,</span> <span class="s">&quot;$address ($role)&quot;</span><span class="p">);</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nb">push</span><span class="p">(</span><span class="nv">@lines</span><span class="p">,</span> <span class="nv">$address</span><span class="p">);</span>
	    <span class="p">}</span>
	    <span class="nv">$saw</span><span class="p">{</span><span class="nv">$address</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">@lines</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">output</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">@parms</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$output_multiline</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nv">@parms</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">print</span><span class="p">(</span><span class="s">&quot;${line}\n&quot;</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span><span class="p">(</span><span class="nb">join</span><span class="p">(</span><span class="nv">$output_separator</span><span class="p">,</span> <span class="nv">@parms</span><span class="p">));</span>
	<span class="k">print</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$rfc822re</span><span class="p">;</span>

<span class="k">sub </span><span class="nf">make_rfc822re</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>Basic lexical tokens are specials, domain<em>literal, quoted</em>string, atom, and
  comment.  We must allow for rfc822<em>lwsp (or comments) after each of these.
  This regexp will only work on addresses which have had comments stripped
  and replaced with rfc822</em>lwsp.</p></td><td class="code"><div class="highlight"><pre>    <span class="k">my</span> <span class="nv">$specials</span> <span class="o">=</span> <span class="s">&#39;()&lt;&gt;@,;:\\\\&quot;.\\[\\]&#39;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$controls</span> <span class="o">=</span> <span class="s">&#39;\\000-\\037\\177&#39;</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$dtext</span> <span class="o">=</span> <span class="s">&quot;[^\\[\\]\\r\\\\]&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$domain_literal</span> <span class="o">=</span> <span class="s">&quot;\\[(?:$dtext|\\\\.)*\\]$rfc822_lwsp*&quot;</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$quoted_string</span> <span class="o">=</span> <span class="s">&quot;\&quot;(?:[^\\\&quot;\\r\\\\]|\\\\.|$rfc822_lwsp)*\&quot;$rfc822_lwsp*&quot;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>Use zero-width assertion to spot the limit of an atom.  A simple
  $rfc822_lwsp* causes the regexp engine to hang occasionally.</p></td><td class="code"><div class="highlight"><pre>    <span class="k">my</span> <span class="nv">$atom</span> <span class="o">=</span> <span class="s">&quot;[^$specials $controls]+(?:$rfc822_lwsp+|\\Z|(?=[\\[\&quot;$specials]))&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$word</span> <span class="o">=</span> <span class="s">&quot;(?:$atom|$quoted_string)&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$localpart</span> <span class="o">=</span> <span class="s">&quot;$word(?:\\.$rfc822_lwsp*$word)*&quot;</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$sub_domain</span> <span class="o">=</span> <span class="s">&quot;(?:$atom|$domain_literal)&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$domain</span> <span class="o">=</span> <span class="s">&quot;$sub_domain(?:\\.$rfc822_lwsp*$sub_domain)*&quot;</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$addr_spec</span> <span class="o">=</span> <span class="s">&quot;$localpart\@$rfc822_lwsp*$domain&quot;</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$phrase</span> <span class="o">=</span> <span class="s">&quot;$word*&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$route</span> <span class="o">=</span> <span class="s">&quot;(?:\@$domain(?:,\@$rfc822_lwsp*$domain)*:$rfc822_lwsp*)&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$route_addr</span> <span class="o">=</span> <span class="s">&quot;\\&lt;$rfc822_lwsp*$route?$addr_spec\\&gt;$rfc822_lwsp*&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$mailbox</span> <span class="o">=</span> <span class="s">&quot;(?:$addr_spec|$phrase$route_addr)&quot;</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$group</span> <span class="o">=</span> <span class="s">&quot;$phrase:$rfc822_lwsp*(?:$mailbox(?:,\\s*$mailbox)*)?;\\s*&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$address</span> <span class="o">=</span> <span class="s">&quot;(?:$mailbox|$group)&quot;</span><span class="p">;</span>

    <span class="k">return</span> <span class="s">&quot;$rfc822_lwsp*$address&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">rfc822_strip_comments</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>Recursively remove comments, and replace with a single space.  The simpler
  regexps in the Email Addressing FAQ are imperfect - they will miss escaped
  chars in atoms, for example.</p></td><td class="code"><div class="highlight"><pre>    <span class="k">while</span> <span class="p">(</span><span class="nv">$s</span> <span class="o">=~</span> <span class="sr">s/^((?:[^&quot;\\]|\\.)*</span>
<span class="sr">                    (?:&quot;(?:[^&quot;\\]|\\.)*&quot;(?:[^&quot;\\]|\\.)*)*)</span>
<span class="sr">                    \((?:[^()\\]|\\.)*\)/$1 /osx</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="nv">$s</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>valid: returns true if the parameter is an RFC822 valid address</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">rfc822_valid</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="n">rfc822_strip_comments</span><span class="p">(</span><span class="nb">shift</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$rfc822re</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$rfc822re</span> <span class="o">=</span> <span class="n">make_rfc822re</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$s</span> <span class="o">=~</span> <span class="sr">m/^$rfc822re$/so</span> <span class="o">&amp;&amp;</span> <span class="nv">$s</span> <span class="o">=~</span> <span class="sr">m/^$rfc822_char*$/</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>validlist: In scalar context, returns true if the parameter is an RFC822
             valid list of addresses.</p>

<pre><code>         In list context, returns an empty list on failure (an invalid
         address was found); otherwise a list whose first element is the
         number of addresses found and whose remaining elements are the
         addresses.  This is needed to disambiguate failure (invalid)
         from success with no addresses found, because an empty string is
         a valid list.
</code></pre></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">rfc822_validlist</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="n">rfc822_strip_comments</span><span class="p">(</span><span class="nb">shift</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$rfc822re</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$rfc822re</span> <span class="o">=</span> <span class="n">make_rfc822re</span><span class="p">();</span>
    <span class="p">}</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><ul>
<li>null list items are valid according to the RFC</li>
<li>the '1' business is to aid in distinguishing failure from no results</li>
</ul></td><td class="code"><div class="highlight"><pre>    <span class="k">my</span> <span class="nv">@r</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$s</span> <span class="o">=~</span> <span class="sr">m/^(?:$rfc822re)?(?:,(?:$rfc822re)?)*$/so</span> <span class="o">&amp;&amp;</span>
	<span class="nv">$s</span> <span class="o">=~</span> <span class="sr">m/^$rfc822_char*$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nv">$s</span> <span class="o">=~</span> <span class="sr">m/(?:^|,$rfc822_lwsp*)($rfc822re)/gos</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">push</span><span class="p">(</span><span class="nv">@r</span><span class="p">,</span> <span class="nv">$1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">wantarray</span> <span class="p">?</span> <span class="p">(</span><span class="nb">scalar</span><span class="p">(</span><span class="nv">@r</span><span class="p">),</span> <span class="nv">@r</span><span class="p">)</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">wantarray</span> <span class="p">?</span> <span class="p">()</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:1}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../javascript/docco.min.js"></script>
</html>
