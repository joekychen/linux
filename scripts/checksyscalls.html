<!DOCTYPE html>
<html><head><title>joekychen/linux » scripts › checksyscalls.sh

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../index.html"></a><h1>checksyscalls.sh</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/bin/sh</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Check if current architecture are missing any function calls compared
to i386.
i386 define a number of legacy system calls that are i386 specific
and listed below so they are ignored.</p>

<p>Usage:
checksyscalls.sh gcc gcc-options</p></td><td class="code"><div class="highlight"><pre>ignore_list<span class="o">()</span> <span class="o">{</span>
cat <span class="s">&lt;&lt; EOF</span>

<span class="s">#DIVIDER</span>

<span class="s">/* *at */</span>

<span class="s">#DIVIDER</span>

<span class="s">/* CLOEXEC flag */</span>

<span class="s">#DIVIDER</span>

<span class="s">/* MMU */</span>

<span class="s">#DIVIDER</span>

<span class="s">/* System calls for 32-bit kernels only */</span>

<span class="s">#DIVIDER</span>

<span class="s">/* i386-specific or historical system calls */</span>

<span class="s">#DIVIDER</span>

<span class="s">/* ... including the &quot;new&quot; 32-bit uid syscalls */</span>

<span class="s">#DIVIDER</span>

<span class="s">/* these can be expressed using other calls */</span>

<span class="s">#DIVIDER</span>

<span class="s">/* sync_file_range had a stupid ABI. Allow sync_file_range2 instead */</span>

<span class="s">#DIVIDER</span>

<span class="s">/* Unmerged syscalls for AFS, STREAMS, etc. */</span>

<span class="s">#DIVIDER</span>
<span class="s">EOF</span>
<span class="o">}</span>

syscall_list<span class="o">()</span> <span class="o">{</span>
    grep <span class="s1">&#39;^[0-9]&#39;</span> <span class="s2">&quot;$1&quot;</span> | sort -n | <span class="o">(</span>
	<span class="k">while </span><span class="nb">read </span>nr abi name entry ; <span class="k">do</span>
<span class="k">	    </span><span class="nb">echo</span> <span class="s">&lt;&lt;EOF</span>

<span class="s">#DIVIDER</span>
<span class="s">EOF</span>
	<span class="k">done</span>
    <span class="o">)</span>
<span class="o">}</span>

<span class="o">(</span>ignore_list <span class="o">&amp;&amp;</span> syscall_list <span class="k">$(</span>dirname <span class="nv">$0</span><span class="k">)</span>/../arch/x86/syscalls/syscall_32.tbl<span class="o">)</span> | <span class="se">\</span>
<span class="nv">$*</span> -E -x c - &gt; /dev/null

</pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>include <asm/types.h>
include <asm/unistd.h></p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>define <em>_IGNORE</em>open        /* openat <em>/
define __IGNORE_link        /</em> linkat <em>/
define __IGNORE_unlink        /</em> unlinkat <em>/
define __IGNORE_mknod        /</em> mknodat <em>/
define __IGNORE_chmod        /</em> fchmodat <em>/
define __IGNORE_chown        /</em> fchownat <em>/
define __IGNORE_mkdir        /</em> mkdirat <em>/
define __IGNORE_rmdir        /</em> unlinkat <em>/
define __IGNORE_lchown        /</em> fchownat <em>/
define __IGNORE_access        /</em> faccessat <em>/
define __IGNORE_rename        /</em> renameat <em>/
define __IGNORE_readlink    /</em> readlinkat <em>/
define __IGNORE_symlink    /</em> symlinkat <em>/
define __IGNORE_utimes        /</em> futimesat <em>/
if BITS_PER_LONG == 64
define __IGNORE_stat        /</em> fstatat <em>/
define __IGNORE_lstat        /</em> fstatat <em>/
else
define __IGNORE_stat64        /</em> fstatat64 <em>/
define __IGNORE_lstat64    /</em> fstatat64 */
endif</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>define <em>_IGNORE</em>pipe        /* pipe2 <em>/
define __IGNORE_dup2        /</em> dup3 <em>/
define __IGNORE_epoll_create    /</em> epoll<em>create1 */
define _</em>IGNORE<em>inotify</em>init    /* inotify<em>init1 */
define _</em>IGNORE<em>eventfd    /* eventfd2 */
define _</em>IGNORE_signalfd    /* signalfd4 */</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>ifndef CONFIG<em>MMU
define _</em>IGNORE<em>madvise
define _</em>IGNORE<em>mbind
define _</em>IGNORE<em>mincore
define _</em>IGNORE<em>mlock
define _</em>IGNORE<em>mlockall
define _</em>IGNORE<em>munlock
define _</em>IGNORE<em>munlockall
define _</em>IGNORE<em>mprotect
define _</em>IGNORE<em>msync
define _</em>IGNORE<em>migrate</em>pages
define <em>_IGNORE</em>move<em>pages
define _</em>IGNORE<em>remap</em>file<em>pages
define _</em>IGNORE<em>get</em>mempolicy
define <em>_IGNORE</em>set<em>mempolicy
define _</em>IGNORE<em>swapoff
define _</em>IGNORE_swapon
endif</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>if BITS<em>PER</em>LONG == 64
define <em>_IGNORE</em>sendfile64
define <em>_IGNORE</em>ftruncate64
define <em>_IGNORE</em>truncate64
define <em>_IGNORE</em>stat64
define <em>_IGNORE</em>lstat64
define <em>_IGNORE</em>fstat64
define <em>_IGNORE</em>fcntl64
define <em>_IGNORE</em>fadvise64<em>64
define _</em>IGNORE<em>fstatat64
define _</em>IGNORE<em>fstatfs64
define _</em>IGNORE<em>statfs64
define _</em>IGNORE<em>llseek
define _</em>IGNORE<em>mmap2
else
define _</em>IGNORE<em>sendfile
define _</em>IGNORE<em>ftruncate
define _</em>IGNORE<em>truncate
define _</em>IGNORE<em>stat
define _</em>IGNORE<em>lstat
define _</em>IGNORE<em>fstat
define _</em>IGNORE<em>fcntl
define _</em>IGNORE<em>fadvise64
define _</em>IGNORE<em>newfstatat
define _</em>IGNORE<em>fstatfs
define _</em>IGNORE<em>statfs
define _</em>IGNORE<em>lseek
define _</em>IGNORE_mmap
endif</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>define <strong>IGNORE<em>break
define _</em>IGNORE<em>stty
define _</em>IGNORE<em>gtty
define _</em>IGNORE<em>ftime
define _</em>IGNORE<em>prof
define _</em>IGNORE<em>lock
define _</em>IGNORE<em>mpx
define _</em>IGNORE<em>ulimit
define _</em>IGNORE<em>profil
define _</em>IGNORE<em>ioperm
define _</em>IGNORE<em>iopl
define _</em>IGNORE<em>idle
define _</em>IGNORE<em>modify</em>ldt
define <em>_IGNORE</em>ugetrlimit
define <em>_IGNORE</em>vm86
define <em>_IGNORE</em>vm86old
define <em>_IGNORE</em>set<em>thread</em>area
define <em>_IGNORE</em>get<em>thread</em>area
define <em>_IGNORE</em>madvise1
define <em>_IGNORE</em>oldstat
define <em>_IGNORE</em>oldfstat
define <em>_IGNORE</em>oldlstat
define <em>_IGNORE</em>oldolduname
define <em>_IGNORE</em>olduname
define <em>_IGNORE</em>umount
define <em>_IGNORE</em>waitpid
define <em>_IGNORE</em>stime
define <em>_IGNORE</em>nice
define <em>_IGNORE</em>signal
define <em>_IGNORE</em>sigaction
define <em>_IGNORE</em>sgetmask
define <em>_IGNORE</em>sigsuspend
define <em>_IGNORE</em>sigpending
define <em>_IGNORE</em>ssetmask
define <em>_IGNORE</em>readdir
define <em>_IGNORE</em>socketcall
define <em>_IGNORE</em>ipc
define <em>_IGNORE</em>sigreturn
define <em>_IGNORE</em>sigprocmask
define <em>_IGNORE</em>bdflush
define <em>_IGNORE</strong>llseek
define <strong>IGNORE</strong>newselect
define <strong>IGNORE</em>create<em>module
define _</em>IGNORE<em>query</em>module
define <em>_IGNORE</em>get<em>kernel</em>syms
define <em>_IGNORE</em>sysfs
define <em>_IGNORE</em>uselib
define __IGNORE</strong>sysctl</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>define <em>_IGNORE</em>lchown32
define <em>_IGNORE</em>getuid32
define <em>_IGNORE</em>getgid32
define <em>_IGNORE</em>geteuid32
define <em>_IGNORE</em>getegid32
define <em>_IGNORE</em>setreuid32
define <em>_IGNORE</em>setregid32
define <em>_IGNORE</em>getgroups32
define <em>_IGNORE</em>setgroups32
define <em>_IGNORE</em>fchown32
define <em>_IGNORE</em>setresuid32
define <em>_IGNORE</em>getresuid32
define <em>_IGNORE</em>setresgid32
define <em>_IGNORE</em>getresgid32
define <em>_IGNORE</em>chown32
define <em>_IGNORE</em>setuid32
define <em>_IGNORE</em>setgid32
define <em>_IGNORE</em>setfsuid32
define <em>_IGNORE</em>setfsgid32</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>define <em>_IGNORE</em>alarm        /* setitimer <em>/
define __IGNORE_creat        /</em> open <em>/
define __IGNORE_fork        /</em> clone <em>/
define __IGNORE_futimesat    /</em> utimensat <em>/
define __IGNORE_getpgrp    /</em> getpgid <em>/
define __IGNORE_getdents    /</em> getdents64 <em>/
define __IGNORE_pause        /</em> sigsuspend <em>/
define __IGNORE_poll        /</em> ppoll <em>/
define __IGNORE_select        /</em> pselect6 <em>/
define __IGNORE_epoll_wait    /</em> epoll<em>pwait */
define _</em>IGNORE<em>time        /* gettimeofday */
define _</em>IGNORE<em>uname        /* newuname */
define _</em>IGNORE<em>ustat        /* statfs */
define _</em>IGNORE<em>utime        /* utimes */
define _</em>IGNORE_vfork        /* clone */</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>ifdef <em>_NR</em>sync<em>file</em>range2
define <em>_IGNORE</em>sync<em>file</em>range
endif</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>define <em>_IGNORE</em>afs<em>syscall
define _</em>IGNORE<em>getpmsg
define _</em>IGNORE<em>putpmsg
define _</em>IGNORE_vserver</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>if !defined(<strong>NR<em>${name}) &amp;&amp; !defined(</strong>IGNORE</em>${name})
warning syscall ${name} not implemented
endif</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:1}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../javascript/docco.min.js"></script>
</html>
