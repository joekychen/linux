<!DOCTYPE html>
<html><head><title>joekychen/linux » scripts › kernel-doc

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../index.html"></a><h1>kernel-doc</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div><h1>Copyright (c) 1998 Michael Zucchi, All Rights Reserved</h1>

<h1>Copyright (C) 2000, 1  Tim Waugh <a href="&#x6D;&#x61;&#x69;&#x6C;&#116;&#x6F;:t&#x77;&#97;&#117;&#103;&#x68;&#x40;&#x72;&#101;&#100;&#x68;&#x61;&#x74;&#x2E;&#x63;om">t&#x77;&#97;&#117;&#103;&#x68;&#x40;&#x72;&#101;&#100;&#x68;&#x61;&#x74;&#x2E;&#x63;om</a></h1>

<h1>Copyright (C) 2001  Simon Huggins</h1>

<h1>Copyright (C) 2005-2012  Randy Dunlap</h1>

<h1>#</h1>

<h1>#define enhancements by Armin Kuster <a href="&#109;&#97;&#x69;&#108;&#116;&#111;:a&#107;&#117;&#115;&#116;e&#114;&#x40;&#109;&#118;&#x69;&#x73;&#116;&#97;&#x2E;&#x63;o&#x6D;">a&#107;&#117;&#115;&#116;e&#114;&#x40;&#109;&#118;&#x69;&#x73;&#116;&#97;&#x2E;&#x63;o&#x6D;</a></h1>

<h1>Copyright (c) 2000 MontaVista Software, Inc.</h1>

<h1>#</h1>

<h1>This software falls under the GNU General Public License.</h1>

<h1>Please read the COPYING file for more information</h1></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div></td><td class="code"><div class="highlight shebang"><pre><span>#!/usr/bin/perl</span> <span>-w

use</span> <span>strict;

</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>18/01/2001 -     Cleanups
        Functions prototyped as foo(void) same as foo()
        Stop eval'ing where we don't need to.
-- huggie@earth.li</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>27/06/2001 -  Allowed whitespace after initial "/**" and
              allowed comments before function declarations.
-- Christian Kreibich <a href="&#x6D;&#x61;&#105;&#108;&#116;&#x6F;:&#99;k&#64;&#x77;&#104;&#111;&#111;&#x70;&#46;&#111;&#x72;&#103;">&#99;k&#64;&#x77;&#104;&#111;&#111;&#x70;&#46;&#111;&#x72;&#103;</a></p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Still to do:
    - add perldoc documentation
    - Look more closely at some of the scarier bits :)</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>26/05/2001 -     Support for separate source and object trees.
    Return error code.
        Keith Owens <a href="&#x6D;&#x61;&#105;&#108;&#x74;o:&#x6B;a&#111;&#x73;&#64;o&#99;&#x73;&#46;&#x63;&#x6F;m.a&#x75;">&#x6B;a&#111;&#x73;&#64;o&#99;&#x73;&#46;&#x63;&#x6F;m.a&#x75;</a></p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>23/09/2001 - Added support for typedefs, structs, enums and unions
             Support for Context section; can be terminated using empty line
             Small fixes (like spaces vs. \s in regex)
-- Tim Jansen <a href="&#109;&#x61;&#x69;&#108;&#116;&#111;:&#116;&#105;&#x6D;&#x40;&#x74;&#106;&#97;&#110;&#115;&#101;&#110;&#46;&#x64;&#x65;">&#116;&#105;&#x6D;&#x40;&#x74;&#106;&#97;&#110;&#115;&#101;&#110;&#46;&#x64;&#x65;</a></p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>This will read a 'c' file and scan for embedded comments in the
style of gnome comments (+minor extensions - see below).</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Note: This only supports 'c'.</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>usage:
kernel-doc [ -docbook | -html | -text | -man | -list ] [ -no-doc-sections ]
          [ -function funcname [ -function funcname ...] ] c file(s)s > outputfile
or
          [ -nofunction funcname [ -function funcname ...] ] c file(s)s > outputfile</p>

<p>Set output format using one of -docbook -html -text or -man.  Default is man.
 The -list format is for internal use by docproc.</p>

<p>-no-doc-sections
Do not output DOC: sections</p>

<p>-function funcname
If set, then only generate documentation for the given function(s) or
DOC: section titles.  All other functions and DOC: sections are ignored.</p>

<p>-nofunction funcname
If set, then only generate documentation for the other function(s)/DOC:
sections. Cannot be used together with -function (yes, that's a bug --
perl hackers can fix it 8))</p>

<p>c files - list of 'c' files to process</p>

<p>All output goes to stdout, with errors to stderr.</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>format of comments.
In the following table, (...)? signifies optional structure.
                        (...)* signifies 0 or more structure elements
/<em>*
 * function_name(:)? (- short description)?
(</em> @parameterx: (description of parameter x)?)*
(* a blank line)?
 * (Description:)? (Description of function)?
 * (section header: (section description)? )*
 (<em>)?</em>/</p>

<p>So .. the trivial example would be:</p>

<p>/**
 * my_function
 */</p>

<p>If the Description: header tag is omitted, then there must be a blank line
after the last parameter specification.
e.g.
/**
 * my<em>function - does my stuff
 * @my</em>arg: its mine damnit
 *
 * Does my stuff explained.
 */</p>

<p>or, could also use:
/**
 * my<em>function - does my stuff
 * @my</em>arg: its mine damnit
 * Description: Does my stuff explained.
 */
etc.</p>

<p>Besides functions you can also write documentation for structs, unions,
enums and typedefs. Instead of the function name you must write the name
of the declaration;  the struct/union/enum/typedef must always precede
the name. Nesting of declarations is not supported.
Use the argument mechanism to document members or constants.
e.g.
/<em>*
 * struct my_struct - short description
 * @a: first member
 * @b: second member
 *
 * Longer description
 */
struct my_struct {
    int a;
    int b;
/</em> private: */
    int c;
};</p>

<p>All descriptions can be multiline, except the short function description.</p>

<p>You can also add additional sections. When documenting kernel functions you
should document the "Context:" of the function, e.g. whether the functions
can be called form interrupts. Unlike other sections you can end it with an
empty line.
Example-sections should contain the string EXAMPLE so that they are marked
appropriately in DocBook.</p>

<p>Example:
/**
 * user<em>function - function that can only be called in user context
 * @a: some argument
 * Context: !in</em>interrupt()
 *
 * Some description
 * Example:
 *    user_function(22);
 */
...</p>

<p>All descriptive text is further processed, scanning for the following special
patterns, which are highlighted appropriately.</p>

<p>'funcname()' - function
'$ENVVAR' - environmental variable
'&amp;struct_name' - name of a structure (up to two words including 'struct')
'@parameter' - name of a parameter
'%CONST' - name of a constant.</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><h1>init lots of data</h1></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">$errors</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$warnings</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$anon_struct_union</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>match expressions used to find embedded type information</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">$type_constant</span> <span class="o">=</span> <span class="s">&#39;\%([-_\w]+)&#39;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$type_func</span> <span class="o">=</span> <span class="s">&#39;(\w+)\(\)&#39;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$type_param</span> <span class="o">=</span> <span class="s">&#39;\@(\w+)&#39;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$type_struct</span> <span class="o">=</span> <span class="s">&#39;\&amp;((struct\s*)*[_\w]+)&#39;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$type_struct_xml</span> <span class="o">=</span> <span class="s">&#39;\\&amp;amp;((struct\s*)*[_\w]+)&#39;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$type_env</span> <span class="o">=</span> <span class="s">&#39;(\$\w+)&#39;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>Output conversion substitutions.
 One for each output format</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>these work fairly well</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">%highlights_html</span> <span class="o">=</span> <span class="p">(</span> <span class="nv">$type_constant</span><span class="p">,</span> <span class="s">&quot;&lt;i&gt;\$1&lt;/i&gt;&quot;</span><span class="p">,</span>
			<span class="nv">$type_func</span><span class="p">,</span> <span class="s">&quot;&lt;b&gt;\$1&lt;/b&gt;&quot;</span><span class="p">,</span>
			<span class="nv">$type_struct_xml</span><span class="p">,</span> <span class="s">&quot;&lt;i&gt;\$1&lt;/i&gt;&quot;</span><span class="p">,</span>
			<span class="nv">$type_env</span><span class="p">,</span> <span class="s">&quot;&lt;b&gt;&lt;i&gt;\$1&lt;/i&gt;&lt;/b&gt;&quot;</span><span class="p">,</span>
			<span class="nv">$type_param</span><span class="p">,</span> <span class="s">&quot;&lt;tt&gt;&lt;b&gt;\$1&lt;/b&gt;&lt;/tt&gt;&quot;</span> <span class="p">);</span>
<span class="k">my</span> <span class="nv">$local_lt</span> <span class="o">=</span> <span class="s">&quot;\\\\\\\\lt:&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$local_gt</span> <span class="o">=</span> <span class="s">&quot;\\\\\\\\gt:&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$blankline_html</span> <span class="o">=</span> <span class="nv">$local_lt</span> <span class="o">.</span> <span class="s">&quot;p&quot;</span> <span class="o">.</span> <span class="nv">$local_gt</span><span class="p">;</span>	<span class="c1"># was &quot;&lt;p&gt;&quot;</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>XML, docbook format</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">%highlights_xml</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&quot;([^=])\\\&quot;([^\\\&quot;&lt;]+)\\\&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;\$1&lt;quote&gt;\$2&lt;/quote&gt;&quot;</span><span class="p">,</span>
			<span class="nv">$type_constant</span><span class="p">,</span> <span class="s">&quot;&lt;constant&gt;\$1&lt;/constant&gt;&quot;</span><span class="p">,</span>
			<span class="nv">$type_func</span><span class="p">,</span> <span class="s">&quot;&lt;function&gt;\$1&lt;/function&gt;&quot;</span><span class="p">,</span>
			<span class="nv">$type_struct_xml</span><span class="p">,</span> <span class="s">&quot;&lt;structname&gt;\$1&lt;/structname&gt;&quot;</span><span class="p">,</span>
			<span class="nv">$type_env</span><span class="p">,</span> <span class="s">&quot;&lt;envar&gt;\$1&lt;/envar&gt;&quot;</span><span class="p">,</span>
			<span class="nv">$type_param</span><span class="p">,</span> <span class="s">&quot;&lt;parameter&gt;\$1&lt;/parameter&gt;&quot;</span> <span class="p">);</span>
<span class="k">my</span> <span class="nv">$blankline_xml</span> <span class="o">=</span> <span class="nv">$local_lt</span> <span class="o">.</span> <span class="s">&quot;/para&quot;</span> <span class="o">.</span> <span class="nv">$local_gt</span> <span class="o">.</span> <span class="nv">$local_lt</span> <span class="o">.</span> <span class="s">&quot;para&quot;</span> <span class="o">.</span> <span class="nv">$local_gt</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>gnome, docbook format</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">%highlights_gnome</span> <span class="o">=</span> <span class="p">(</span> <span class="nv">$type_constant</span><span class="p">,</span> <span class="s">&quot;&lt;replaceable class=\&quot;option\&quot;&gt;\$1&lt;/replaceable&gt;&quot;</span><span class="p">,</span>
			 <span class="nv">$type_func</span><span class="p">,</span> <span class="s">&quot;&lt;function&gt;\$1&lt;/function&gt;&quot;</span><span class="p">,</span>
			 <span class="nv">$type_struct</span><span class="p">,</span> <span class="s">&quot;&lt;structname&gt;\$1&lt;/structname&gt;&quot;</span><span class="p">,</span>
			 <span class="nv">$type_env</span><span class="p">,</span> <span class="s">&quot;&lt;envar&gt;\$1&lt;/envar&gt;&quot;</span><span class="p">,</span>
			 <span class="nv">$type_param</span><span class="p">,</span> <span class="s">&quot;&lt;parameter&gt;\$1&lt;/parameter&gt;&quot;</span> <span class="p">);</span>
<span class="k">my</span> <span class="nv">$blankline_gnome</span> <span class="o">=</span> <span class="s">&quot;&lt;/para&gt;&lt;para&gt;\n&quot;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>these are pretty rough</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">%highlights_man</span> <span class="o">=</span> <span class="p">(</span> <span class="nv">$type_constant</span><span class="p">,</span> <span class="s">&quot;\$1&quot;</span><span class="p">,</span>
		       <span class="nv">$type_func</span><span class="p">,</span> <span class="s">&quot;\\\\fB\$1\\\\fP&quot;</span><span class="p">,</span>
		       <span class="nv">$type_struct</span><span class="p">,</span> <span class="s">&quot;\\\\fI\$1\\\\fP&quot;</span><span class="p">,</span>
		       <span class="nv">$type_param</span><span class="p">,</span> <span class="s">&quot;\\\\fI\$1\\\\fP&quot;</span> <span class="p">);</span>
<span class="k">my</span> <span class="nv">$blankline_man</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>text-mode</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">%highlights_text</span> <span class="o">=</span> <span class="p">(</span> <span class="nv">$type_constant</span><span class="p">,</span> <span class="s">&quot;\$1&quot;</span><span class="p">,</span>
			<span class="nv">$type_func</span><span class="p">,</span> <span class="s">&quot;\$1&quot;</span><span class="p">,</span>
			<span class="nv">$type_struct</span><span class="p">,</span> <span class="s">&quot;\$1&quot;</span><span class="p">,</span>
			<span class="nv">$type_param</span><span class="p">,</span> <span class="s">&quot;\$1&quot;</span> <span class="p">);</span>
<span class="k">my</span> <span class="nv">$blankline_text</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>list mode</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">%highlights_list</span> <span class="o">=</span> <span class="p">(</span> <span class="nv">$type_constant</span><span class="p">,</span> <span class="s">&quot;\$1&quot;</span><span class="p">,</span>
			<span class="nv">$type_func</span><span class="p">,</span> <span class="s">&quot;\$1&quot;</span><span class="p">,</span>
			<span class="nv">$type_struct</span><span class="p">,</span> <span class="s">&quot;\$1&quot;</span><span class="p">,</span>
			<span class="nv">$type_param</span><span class="p">,</span> <span class="s">&quot;\$1&quot;</span> <span class="p">);</span>
<span class="k">my</span> <span class="nv">$blankline_list</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>read arguments</p></td><td class="code"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nv">$#ARGV</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">usage</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$kernelversion</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$dohighlight</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$output_mode</span> <span class="o">=</span> <span class="s">&quot;man&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$no_doc_sections</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">%highlights</span> <span class="o">=</span> <span class="nv">%highlights_man</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$blankline</span> <span class="o">=</span> <span class="nv">$blankline_man</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$modulename</span> <span class="o">=</span> <span class="s">&quot;Kernel API&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$function_only</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$man_date</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;January&#39;</span><span class="p">,</span> <span class="s">&#39;February&#39;</span><span class="p">,</span> <span class="s">&#39;March&#39;</span><span class="p">,</span> <span class="s">&#39;April&#39;</span><span class="p">,</span> <span class="s">&#39;May&#39;</span><span class="p">,</span> <span class="s">&#39;June&#39;</span><span class="p">,</span>
		<span class="s">&#39;July&#39;</span><span class="p">,</span> <span class="s">&#39;August&#39;</span><span class="p">,</span> <span class="s">&#39;September&#39;</span><span class="p">,</span> <span class="s">&#39;October&#39;</span><span class="p">,</span>
		<span class="s">&#39;November&#39;</span><span class="p">,</span> <span class="s">&#39;December&#39;</span><span class="p">)[(</span><span class="nb">localtime</span><span class="p">)[</span><span class="mi">4</span><span class="p">]]</span> <span class="o">.</span>
  <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="p">((</span><span class="nb">localtime</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="mi">1900</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>Essentially these are globals.
They probably want to be tidied up, made more localised or something.
CAVEAT EMPTOR!  Some of the others I localised may not want to be, which
could cause "use of undefined value" or other bugs.</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="p">(</span><span class="nv">$function</span><span class="p">,</span> <span class="nv">%function_table</span><span class="p">,</span> <span class="nv">%parametertypes</span><span class="p">,</span> <span class="nv">$declaration_purpose</span><span class="p">);</span>
<span class="k">my</span> <span class="p">(</span><span class="nv">$type</span><span class="p">,</span> <span class="nv">$declaration_name</span><span class="p">,</span> <span class="nv">$return_type</span><span class="p">);</span>
<span class="k">my</span> <span class="p">(</span><span class="nv">$newsection</span><span class="p">,</span> <span class="nv">$newcontents</span><span class="p">,</span> <span class="nv">$prototype</span><span class="p">,</span> <span class="nv">$brcount</span><span class="p">,</span> <span class="nv">%source_map</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$ENV</span><span class="p">{</span><span class="s">&#39;KBUILD_VERBOSE&#39;</span><span class="p">}))</span> <span class="p">{</span>
	<span class="nv">$verbose</span> <span class="o">=</span> <span class="s">&quot;$ENV{&#39;KBUILD_VERBOSE&#39;}&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>Generated docbook code is inserted in a template at a point where
docbook v3.1 requires a non-zero sequence of RefEntry's; see:
http://www.oasis-open.org/docbook/documentation/reference/html/refentry.html
We keep track of number of generated entries and generate a dummy
if needs be to ensure the expanded template can be postprocessed
into html.</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">$section_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$lineprefix</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>states
0 - normal code
1 - looking for function name
2 - scanning field start.
3 - scanning prototype.
4 - documentation block</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">$state</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$in_doc_sect</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>declaration types: can be
'function', 'struct', 'union', 'enum', 'typedef'</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">$decl_type</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$doc_special</span> <span class="o">=</span> <span class="s">&quot;\@\%\$\&amp;&quot;</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$doc_start</span> <span class="o">=</span> <span class="s">&#39;^/\*\*\s*$&#39;</span><span class="p">;</span> <span class="c1"># Allow whitespace at end of comment start.</span>
<span class="k">my</span> <span class="nv">$doc_end</span> <span class="o">=</span> <span class="s">&#39;\*/&#39;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$doc_com</span> <span class="o">=</span> <span class="s">&#39;\s*\*\s*&#39;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$doc_decl</span> <span class="o">=</span> <span class="nv">$doc_com</span> <span class="o">.</span> <span class="s">&#39;(\w+)&#39;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$doc_sect</span> <span class="o">=</span> <span class="nv">$doc_com</span> <span class="o">.</span> <span class="s">&#39;([&#39;</span> <span class="o">.</span> <span class="nv">$doc_special</span> <span class="o">.</span> <span class="s">&#39;]?[\w\s]+):(.*)&#39;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$doc_content</span> <span class="o">=</span> <span class="nv">$doc_com</span> <span class="o">.</span> <span class="s">&#39;(.*)&#39;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$doc_block</span> <span class="o">=</span> <span class="nv">$doc_com</span> <span class="o">.</span> <span class="s">&#39;DOC:\s*(.*)?&#39;</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">%constants</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">%parameterdescs</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@parameterlist</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">%sections</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@sectionlist</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$sectcheck</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$struct_actual</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$contents</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$section_default</span> <span class="o">=</span> <span class="s">&quot;Description&quot;</span><span class="p">;</span>	<span class="c1"># default section</span>
<span class="k">my</span> <span class="nv">$section_intro</span> <span class="o">=</span> <span class="s">&quot;Introduction&quot;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$section</span> <span class="o">=</span> <span class="nv">$section_default</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$section_context</span> <span class="o">=</span> <span class="s">&quot;Context&quot;</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$undescribed</span> <span class="o">=</span> <span class="s">&quot;-- undescribed --&quot;</span><span class="p">;</span>

<span class="n">reset_state</span><span class="p">();</span>

<span class="k">while</span> <span class="p">(</span><span class="nv">$ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=~</span> <span class="sr">m/^-(.*)/</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$cmd</span> <span class="o">=</span> <span class="nb">shift</span> <span class="nv">@ARGV</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;-html&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$output_mode</span> <span class="o">=</span> <span class="s">&quot;html&quot;</span><span class="p">;</span>
	<span class="nv">%highlights</span> <span class="o">=</span> <span class="nv">%highlights_html</span><span class="p">;</span>
	<span class="nv">$blankline</span> <span class="o">=</span> <span class="nv">$blankline_html</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;-man&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$output_mode</span> <span class="o">=</span> <span class="s">&quot;man&quot;</span><span class="p">;</span>
	<span class="nv">%highlights</span> <span class="o">=</span> <span class="nv">%highlights_man</span><span class="p">;</span>
	<span class="nv">$blankline</span> <span class="o">=</span> <span class="nv">$blankline_man</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;-text&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$output_mode</span> <span class="o">=</span> <span class="s">&quot;text&quot;</span><span class="p">;</span>
	<span class="nv">%highlights</span> <span class="o">=</span> <span class="nv">%highlights_text</span><span class="p">;</span>
	<span class="nv">$blankline</span> <span class="o">=</span> <span class="nv">$blankline_text</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;-docbook&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$output_mode</span> <span class="o">=</span> <span class="s">&quot;xml&quot;</span><span class="p">;</span>
	<span class="nv">%highlights</span> <span class="o">=</span> <span class="nv">%highlights_xml</span><span class="p">;</span>
	<span class="nv">$blankline</span> <span class="o">=</span> <span class="nv">$blankline_xml</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;-list&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$output_mode</span> <span class="o">=</span> <span class="s">&quot;list&quot;</span><span class="p">;</span>
	<span class="nv">%highlights</span> <span class="o">=</span> <span class="nv">%highlights_list</span><span class="p">;</span>
	<span class="nv">$blankline</span> <span class="o">=</span> <span class="nv">$blankline_list</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;-gnome&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$output_mode</span> <span class="o">=</span> <span class="s">&quot;gnome&quot;</span><span class="p">;</span>
	<span class="nv">%highlights</span> <span class="o">=</span> <span class="nv">%highlights_gnome</span><span class="p">;</span>
	<span class="nv">$blankline</span> <span class="o">=</span> <span class="nv">$blankline_gnome</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;-module&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># not needed for XML, inherits from calling document</span>
	<span class="nv">$modulename</span> <span class="o">=</span> <span class="nb">shift</span> <span class="nv">@ARGV</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;-function&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># to only output specific functions</span>
	<span class="nv">$function_only</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="nv">$function</span> <span class="o">=</span> <span class="nb">shift</span> <span class="nv">@ARGV</span><span class="p">;</span>
	<span class="nv">$function_table</span><span class="p">{</span><span class="nv">$function</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;-nofunction&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># to only output specific functions</span>
	<span class="nv">$function_only</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="nv">$function</span> <span class="o">=</span> <span class="nb">shift</span> <span class="nv">@ARGV</span><span class="p">;</span>
	<span class="nv">$function_table</span><span class="p">{</span><span class="nv">$function</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;-v&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$verbose</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">((</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;-h&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&quot;--help&quot;</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">usage</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$cmd</span> <span class="ow">eq</span> <span class="s">&#39;-no-doc-sections&#39;</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$no_doc_sections</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>continue execution near EOF;</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">usage</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s">&quot;Usage: $0 [ -v ] [ -docbook | -html | -text | -man | -list ]\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;         [ -no-doc-sections ]\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;         [ -function funcname [ -function funcname ...] ]\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;         [ -nofunction funcname [ -nofunction funcname ...] ]\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;         c source file(s) &gt; outputfile\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;         -v : verbose output, more warnings &amp; other info listed\n&quot;</span><span class="p">;</span>
    <span class="nb">exit</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>get kernel version from env</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">get_kernel_version</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$version</span> <span class="o">=</span> <span class="s">&#39;unknown kernel version&#39;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$ENV</span><span class="p">{</span><span class="s">&#39;KERNELVERSION&#39;</span><span class="p">}))</span> <span class="p">{</span>
	<span class="nv">$version</span> <span class="o">=</span> <span class="nv">$ENV</span><span class="p">{</span><span class="s">&#39;KERNELVERSION&#39;</span><span class="p">};</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$version</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>#
dumps section contents to arrays/hashes intended for that purpose.</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">dump_section</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$contents</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$name</span> <span class="o">=~</span> <span class="sr">m/$type_constant/</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><p>print STDERR "constant section '$1' = '$contents'\n";</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$constants</span><span class="p">{</span><span class="nv">$name</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$contents</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$name</span> <span class="o">=~</span> <span class="sr">m/$type_param/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-30"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-30">&#182;</a></div><p>print STDERR "parameter def '$1' = '$contents'\n";</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	<span class="nv">$parameterdescs</span><span class="p">{</span><span class="nv">$name</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$contents</span><span class="p">;</span>
	<span class="nv">$sectcheck</span> <span class="o">=</span> <span class="nv">$sectcheck</span> <span class="o">.</span> <span class="nv">$name</span> <span class="o">.</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$name</span> <span class="ow">eq</span> <span class="s">&quot;@\.\.\.&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-31"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-31">&#182;</a></div><p>print STDERR "parameter def '...' = '$contents'\n";</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$name</span> <span class="o">=</span> <span class="s">&quot;...&quot;</span><span class="p">;</span>
	<span class="nv">$parameterdescs</span><span class="p">{</span><span class="nv">$name</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$contents</span><span class="p">;</span>
	<span class="nv">$sectcheck</span> <span class="o">=</span> <span class="nv">$sectcheck</span> <span class="o">.</span> <span class="nv">$name</span> <span class="o">.</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-32"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-32">&#182;</a></div><p>print STDERR "other section '$name' = '$contents'\n";</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">(</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$sections</span><span class="p">{</span><span class="nv">$name</span><span class="p">})</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$sections</span><span class="p">{</span><span class="nv">$name</span><span class="p">}</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Error(${file}:$.): duplicate section name &#39;$name&#39;\n&quot;</span><span class="p">;</span>
		<span class="o">++</span><span class="nv">$errors</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nv">$sections</span><span class="p">{</span><span class="nv">$name</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$contents</span><span class="p">;</span>
	<span class="nb">push</span> <span class="nv">@sectionlist</span><span class="p">,</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-33"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-33">&#182;</a></div><p>#
dump DOC: section after checking that it should go out</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">dump_doc_section</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$contents</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$no_doc_sections</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">((</span><span class="nv">$function_only</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
	<span class="p">(</span> <span class="nv">$function_only</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nb">defined</span><span class="p">(</span><span class="nv">$function_table</span><span class="p">{</span><span class="nv">$name</span><span class="p">}))</span> <span class="o">||</span>
	<span class="p">(</span> <span class="nv">$function_only</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$function_table</span><span class="p">{</span><span class="nv">$name</span><span class="p">})))</span>
    <span class="p">{</span>
	<span class="n">dump_section</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$contents</span><span class="p">);</span>
	<span class="n">output_blockhead</span><span class="p">({</span><span class="s">&#39;sectionlist&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@sectionlist</span><span class="p">,</span>
			  <span class="s">&#39;sections&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%sections</span><span class="p">,</span>
			  <span class="s">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="nv">$modulename</span><span class="p">,</span>
			  <span class="s">&#39;content-only&#39;</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nv">$function_only</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-34"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-34">&#182;</a></div><p>#
output function</p>

<p>parameterdescs, a hash.
 function => "function name"
 parameterlist => @list of parameters
 parameterdescs => %parameter descriptions
 sectionlist => @list of sections
 sections => %section descriptions</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_highlight</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$contents</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&quot;\n&quot;</span><span class="p">,</span><span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$line</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-35"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-35">&#182;</a></div><p>DEBUG
  if (!defined $contents) {
use Carp;
confess "output_highlight got called with no args?\n";
  }</p></td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nv">$output_mode</span> <span class="ow">eq</span> <span class="s">&quot;html&quot;</span> <span class="o">||</span> <span class="nv">$output_mode</span> <span class="ow">eq</span> <span class="s">&quot;xml&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$contents</span> <span class="o">=</span> <span class="n">local_unescape</span><span class="p">(</span><span class="nv">$contents</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-36"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-36">&#182;</a></div><p>convert data read &amp; converted thru xml_escape() into &xyz; format:</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$contents</span> <span class="o">=~</span> <span class="sr">s/\\\\\\/\&amp;/g</span><span class="p">;</span>
    <span class="p">}</span></pre></div></td></tr>


<tr id="section-37"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-37">&#182;</a></div><p>print STDERR "contents b4:$contents\n";</p></td><td class="code"><div class="highlight"><pre>    <span class="nb">eval</span> <span class="nv">$dohighlight</span><span class="p">;</span>
    <span class="nb">die</span> <span class="vg">$@</span> <span class="k">if</span> <span class="vg">$@</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-38"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-38">&#182;</a></div><p>print STDERR "contents af:$contents\n";</p></td><td class="code"><div class="highlight"><pre>    <span class="k">foreach</span> <span class="nv">$line</span> <span class="p">(</span><span class="nb">split</span> <span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="nv">$contents</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">){</span>
	    <span class="k">print</span> <span class="nv">$lineprefix</span><span class="p">,</span> <span class="n">local_unescape</span><span class="p">(</span><span class="nv">$blankline</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="nv">$line</span> <span class="o">=~</span> <span class="sr">s/\\\\\\/\&amp;/g</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$output_mode</span> <span class="ow">eq</span> <span class="s">&quot;man&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;.&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">print</span> <span class="s">&quot;\\&amp;$line&quot;</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">print</span> <span class="nv">$lineprefix</span><span class="p">,</span> <span class="nv">$line</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-39"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-39">&#182;</a></div><p>output sections in html</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_section_html</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="nv">$section</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;&lt;h3&gt;$section&lt;/h3&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;blockquote&gt;\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
	<span class="k">print</span> <span class="s">&quot;&lt;/blockquote&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-40"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-40">&#182;</a></div><p>output enum in html</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_enum_html</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;h2&gt;enum &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;enum&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/h2&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;b&gt;enum &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;enum&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/b&gt; {&lt;br&gt;\n&quot;</span><span class="p">;</span>
    <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot; &lt;b&gt;&quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;&lt;/b&gt;&quot;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">!=</span> <span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	    <span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;,\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="s">&quot;&lt;br&gt;&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;};&lt;br&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;h3&gt;Constants&lt;/h3&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;dl&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;&lt;dt&gt;&lt;b&gt;&quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;&lt;/b&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;dd&gt;&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/dl&gt;\n&quot;</span><span class="p">;</span>
    <span class="n">output_section_html</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
    <span class="k">print</span> <span class="s">&quot;&lt;hr&gt;\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-41"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-41">&#182;</a></div><p>output typedef in html</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_typedef_html</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;h2&gt;typedef &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;typedef&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/h2&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;b&gt;typedef &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;typedef&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/b&gt;\n&quot;</span><span class="p">;</span>
    <span class="n">output_section_html</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
    <span class="k">print</span> <span class="s">&quot;&lt;hr&gt;\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-42"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-42">&#182;</a></div><p>output struct in html</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_struct_html</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">);</span>

    <span class="k">print</span> <span class="s">&quot;&lt;h2&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; - &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/h2&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;b&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/b&gt; {&lt;br&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$parameter</span> <span class="o">=~</span><span class="sr"> /^#/</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">print</span> <span class="s">&quot;$parameter&lt;br&gt;\n&quot;</span><span class="p">;</span>
		<span class="k">next</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">}</span> <span class="ow">ne</span> <span class="nv">$undescribed</span><span class="p">)</span> <span class="o">||</span> <span class="k">next</span><span class="p">;</span>
	<span class="nv">$type</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parametertypes&#39;</span><span class="p">}{</span><span class="nv">$parameter</span><span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/([^\(]*\(\*)\s*\)\s*\(([^\)]*)\)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-43"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-43">&#182;</a></div><p>pointer-to-function</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="s">&quot;&amp;nbsp; &amp;nbsp; &lt;i&gt;$1&lt;/i&gt;&lt;b&gt;$parameter&lt;/b&gt;) &lt;i&gt;($2)&lt;/i&gt;;&lt;br&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/^(.*?)\s*(:.*)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-44"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-44">&#182;</a></div><p>bitfield</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="s">&quot;&amp;nbsp; &amp;nbsp; &lt;i&gt;$1&lt;/i&gt; &lt;b&gt;$parameter&lt;/b&gt;$2;&lt;br&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&amp;nbsp; &amp;nbsp; &lt;i&gt;$type&lt;/i&gt; &lt;b&gt;$parameter&lt;/b&gt;;&lt;br&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;};&lt;br&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;h3&gt;Members&lt;/h3&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;dl&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="p">(</span><span class="nv">$parameter</span> <span class="o">=~</span><span class="sr"> /^#/</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">next</span><span class="p">;</span>

	<span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">}</span> <span class="ow">ne</span> <span class="nv">$undescribed</span><span class="p">)</span> <span class="o">||</span> <span class="k">next</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;dt&gt;&lt;b&gt;&quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;&lt;/b&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;dd&gt;&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/dl&gt;\n&quot;</span><span class="p">;</span>
    <span class="n">output_section_html</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
    <span class="k">print</span> <span class="s">&quot;&lt;hr&gt;\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-45"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-45">&#182;</a></div><p>output function in html</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_function_html</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;h2&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; - &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/h2&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;i&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;functiontype&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/i&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;b&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/b&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;(&quot;</span><span class="p">;</span>
    <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="nv">$type</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parametertypes&#39;</span><span class="p">}{</span><span class="nv">$parameter</span><span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/([^\(]*\(\*)\s*\)\s*\(([^\)]*)\)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-46"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-46">&#182;</a></div><p>pointer-to-function</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="s">&quot;&lt;i&gt;$1&lt;/i&gt;&lt;b&gt;$parameter&lt;/b&gt;) &lt;i&gt;($2)&lt;/i&gt;&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;i&gt;&quot;</span> <span class="o">.</span> <span class="nv">$type</span> <span class="o">.</span> <span class="s">&quot;&lt;/i&gt; &lt;b&gt;&quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;&lt;/b&gt;&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">!=</span> <span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	    <span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;,\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;)\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;h3&gt;Arguments&lt;/h3&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;dl&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">}</span> <span class="ow">ne</span> <span class="nv">$undescribed</span><span class="p">)</span> <span class="o">||</span> <span class="k">next</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;dt&gt;&lt;b&gt;&quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;&lt;/b&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;dd&gt;&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/dl&gt;\n&quot;</span><span class="p">;</span>
    <span class="n">output_section_html</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
    <span class="k">print</span> <span class="s">&quot;&lt;hr&gt;\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-47"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-47">&#182;</a></div><p>output DOC: block header in html</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_blockhead_html</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;&lt;h3&gt;$section&lt;/h3&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;ul&gt;\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
	<span class="k">print</span> <span class="s">&quot;&lt;/ul&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;&lt;hr&gt;\n&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">output_section_xml</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="nv">$section</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-48"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-48">&#182;</a></div><p>print out each section</p></td><td class="code"><div class="highlight"><pre>    <span class="nv">$lineprefix</span><span class="o">=</span><span class="s">&quot;   &quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;&lt;refsect1&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;title&gt;$section&lt;/title&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$section</span> <span class="o">=~</span> <span class="sr">m/EXAMPLE/i</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;informalexample&gt;&lt;programlisting&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;para&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$section</span> <span class="o">=~</span> <span class="sr">m/EXAMPLE/i</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;/programlisting&gt;&lt;/informalexample&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;/para&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="s">&quot;&lt;/refsect1&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-49"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-49">&#182;</a></div><p>output function in XML DocBook</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_function_xml</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="nv">$id</span> <span class="o">=</span> <span class="s">&quot;API-&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">};</span>
    <span class="nv">$id</span> <span class="o">=~</span> <span class="sr">s/[^A-Za-z0-9]/-/g</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;refentry id=\&quot;$id\&quot;&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refentryinfo&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;title&gt;LINUX&lt;/title&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;productname&gt;Kernel Hackers Manual&lt;/productname&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;date&gt;$man_date&lt;/date&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refentryinfo&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refmeta&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refentrytitle&gt;&lt;phrase&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/phrase&gt;&lt;/refentrytitle&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;manvolnum&gt;9&lt;/manvolnum&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refmiscinfo class=\&quot;version\&quot;&gt;&quot;</span> <span class="o">.</span> <span class="nv">$kernelversion</span> <span class="o">.</span> <span class="s">&quot;&lt;/refmiscinfo&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refmeta&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refnamediv&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refname&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/refname&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refpurpose&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &quot;</span><span class="p">;</span>
    <span class="n">output_highlight</span> <span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">});</span>
    <span class="k">print</span> <span class="s">&quot; &lt;/refpurpose&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refnamediv&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;refsynopsisdiv&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;title&gt;Synopsis&lt;/title&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;funcsynopsis&gt;&lt;funcprototype&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;   &lt;funcdef&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;functiontype&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;function&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &lt;/function&gt;&lt;/funcdef&gt;\n&quot;</span><span class="p">;</span>

    <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}}</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	    <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parametertypes&#39;</span><span class="p">}{</span><span class="nv">$parameter</span><span class="p">};</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/([^\(]*\(\*)\s*\)\s*\(([^\)]*)\)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-50"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-50">&#182;</a></div><p>pointer-to-function</p></td><td class="code"><div class="highlight"><pre>		<span class="k">print</span> <span class="s">&quot;   &lt;paramdef&gt;$1&lt;parameter&gt;$parameter&lt;/parameter&gt;)\n&quot;</span><span class="p">;</span>
		<span class="k">print</span> <span class="s">&quot;     &lt;funcparams&gt;$2&lt;/funcparams&gt;&lt;/paramdef&gt;\n&quot;</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">print</span> <span class="s">&quot;   &lt;paramdef&gt;&quot;</span> <span class="o">.</span> <span class="nv">$type</span><span class="p">;</span>
		<span class="k">print</span> <span class="s">&quot; &lt;parameter&gt;$parameter&lt;/parameter&gt;&lt;/paramdef&gt;\n&quot;</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;  &lt;void/&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;/funcprototype&gt;&lt;/funcsynopsis&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refsynopsisdiv&gt;\n&quot;</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-51"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-51">&#182;</a></div><p>print parameters</p></td><td class="code"><div class="highlight"><pre>    <span class="k">print</span> <span class="s">&quot;&lt;refsect1&gt;\n &lt;title&gt;Arguments&lt;/title&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}}</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot; &lt;variablelist&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	    <span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	    <span class="k">print</span> <span class="s">&quot;  &lt;varlistentry&gt;\n   &lt;term&gt;&lt;parameter&gt;$parameter&lt;/parameter&gt;&lt;/term&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;   &lt;listitem&gt;\n    &lt;para&gt;\n&quot;</span><span class="p">;</span>
	    <span class="nv">$lineprefix</span><span class="o">=</span><span class="s">&quot;     &quot;</span><span class="p">;</span>
	    <span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">});</span>
	    <span class="k">print</span> <span class="s">&quot;    &lt;/para&gt;\n   &lt;/listitem&gt;\n  &lt;/varlistentry&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="s">&quot; &lt;/variablelist&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot; &lt;para&gt;\n  None\n &lt;/para&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refsect1&gt;\n&quot;</span><span class="p">;</span>

    <span class="n">output_section_xml</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refentry&gt;\n\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-52"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-52">&#182;</a></div><p>output struct in XML DocBook</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_struct_xml</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="nv">$id</span> <span class="o">=</span> <span class="s">&quot;API-struct-&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">};</span>
    <span class="nv">$id</span> <span class="o">=~</span> <span class="sr">s/[^A-Za-z0-9]/-/g</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;refentry id=\&quot;$id\&quot;&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refentryinfo&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;title&gt;LINUX&lt;/title&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;productname&gt;Kernel Hackers Manual&lt;/productname&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;date&gt;$man_date&lt;/date&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refentryinfo&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refmeta&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refentrytitle&gt;&lt;phrase&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/phrase&gt;&lt;/refentrytitle&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;manvolnum&gt;9&lt;/manvolnum&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refmiscinfo class=\&quot;version\&quot;&gt;&quot;</span> <span class="o">.</span> <span class="nv">$kernelversion</span> <span class="o">.</span> <span class="s">&quot;&lt;/refmiscinfo&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refmeta&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refnamediv&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refname&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/refname&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refpurpose&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &quot;</span><span class="p">;</span>
    <span class="n">output_highlight</span> <span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">});</span>
    <span class="k">print</span> <span class="s">&quot; &lt;/refpurpose&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refnamediv&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;refsynopsisdiv&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;title&gt;Synopsis&lt;/title&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;programlisting&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; {\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$parameter</span> <span class="o">=~</span><span class="sr"> /^#/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$prm</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-53"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-53">&#182;</a></div><p>convert data read &amp; converted thru xml_escape() into &xyz; format:
This allows us to have #define macros interspersed in a struct.</p></td><td class="code"><div class="highlight"><pre>	    <span class="nv">$prm</span> <span class="o">=~</span> <span class="sr">s/\\\\\\/\&amp;/g</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;$prm\n&quot;</span><span class="p">;</span>
	    <span class="k">next</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="nb">defined</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">})</span> <span class="o">||</span> <span class="k">next</span><span class="p">;</span>
	<span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">}</span> <span class="ow">ne</span> <span class="nv">$undescribed</span><span class="p">)</span> <span class="o">||</span> <span class="k">next</span><span class="p">;</span>
	<span class="nv">$type</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parametertypes&#39;</span><span class="p">}{</span><span class="nv">$parameter</span><span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/([^\(]*\(\*)\s*\)\s*\(([^\)]*)\)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-54"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-54">&#182;</a></div><p>pointer-to-function</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="s">&quot;  $1 $parameter) ($2);\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/^(.*?)\s*(:.*)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-55"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-55">&#182;</a></div><p>bitfield</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="s">&quot;  $1 $parameter$2;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;  &quot;</span> <span class="o">.</span> <span class="nv">$type</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;};&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;/programlisting&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refsynopsisdiv&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot; &lt;refsect1&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;title&gt;Members&lt;/title&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}}</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;variablelist&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
      <span class="p">(</span><span class="nv">$parameter</span> <span class="o">=~</span><span class="sr"> /^#/</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">next</span><span class="p">;</span>

      <span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
      <span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

      <span class="nb">defined</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">})</span> <span class="o">||</span> <span class="k">next</span><span class="p">;</span>
      <span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">}</span> <span class="ow">ne</span> <span class="nv">$undescribed</span><span class="p">)</span> <span class="o">||</span> <span class="k">next</span><span class="p">;</span>
      <span class="k">print</span> <span class="s">&quot;    &lt;varlistentry&gt;&quot;</span><span class="p">;</span>
      <span class="k">print</span> <span class="s">&quot;      &lt;term&gt;$parameter&lt;/term&gt;\n&quot;</span><span class="p">;</span>
      <span class="k">print</span> <span class="s">&quot;      &lt;listitem&gt;&lt;para&gt;\n&quot;</span><span class="p">;</span>
      <span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">});</span>
      <span class="k">print</span> <span class="s">&quot;      &lt;/para&gt;&lt;/listitem&gt;\n&quot;</span><span class="p">;</span>
      <span class="k">print</span> <span class="s">&quot;    &lt;/varlistentry&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;/variablelist&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot; &lt;para&gt;\n  None\n &lt;/para&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot; &lt;/refsect1&gt;\n&quot;</span><span class="p">;</span>

    <span class="n">output_section_xml</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>

    <span class="k">print</span> <span class="s">&quot;&lt;/refentry&gt;\n\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-56"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-56">&#182;</a></div><p>output enum in XML DocBook</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_enum_xml</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="nv">$id</span> <span class="o">=</span> <span class="s">&quot;API-enum-&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;enum&#39;</span><span class="p">};</span>
    <span class="nv">$id</span> <span class="o">=~</span> <span class="sr">s/[^A-Za-z0-9]/-/g</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;refentry id=\&quot;$id\&quot;&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refentryinfo&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;title&gt;LINUX&lt;/title&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;productname&gt;Kernel Hackers Manual&lt;/productname&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;date&gt;$man_date&lt;/date&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refentryinfo&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refmeta&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refentrytitle&gt;&lt;phrase&gt;enum &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;enum&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/phrase&gt;&lt;/refentrytitle&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;manvolnum&gt;9&lt;/manvolnum&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refmiscinfo class=\&quot;version\&quot;&gt;&quot;</span> <span class="o">.</span> <span class="nv">$kernelversion</span> <span class="o">.</span> <span class="s">&quot;&lt;/refmiscinfo&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refmeta&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refnamediv&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refname&gt;enum &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;enum&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/refname&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refpurpose&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &quot;</span><span class="p">;</span>
    <span class="n">output_highlight</span> <span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">});</span>
    <span class="k">print</span> <span class="s">&quot; &lt;/refpurpose&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refnamediv&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;refsynopsisdiv&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;title&gt;Synopsis&lt;/title&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;programlisting&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;enum &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;enum&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; {\n&quot;</span><span class="p">;</span>
    <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;  $parameter&quot;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">!=</span> <span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	    <span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;,&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;};&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;/programlisting&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refsynopsisdiv&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;refsect1&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;title&gt;Constants&lt;/title&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;variablelist&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
      <span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
      <span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

      <span class="k">print</span> <span class="s">&quot;    &lt;varlistentry&gt;&quot;</span><span class="p">;</span>
      <span class="k">print</span> <span class="s">&quot;      &lt;term&gt;$parameter&lt;/term&gt;\n&quot;</span><span class="p">;</span>
      <span class="k">print</span> <span class="s">&quot;      &lt;listitem&gt;&lt;para&gt;\n&quot;</span><span class="p">;</span>
      <span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">});</span>
      <span class="k">print</span> <span class="s">&quot;      &lt;/para&gt;&lt;/listitem&gt;\n&quot;</span><span class="p">;</span>
      <span class="k">print</span> <span class="s">&quot;    &lt;/varlistentry&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;/variablelist&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refsect1&gt;\n&quot;</span><span class="p">;</span>

    <span class="n">output_section_xml</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>

    <span class="k">print</span> <span class="s">&quot;&lt;/refentry&gt;\n\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-57"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-57">&#182;</a></div><p>output typedef in XML DocBook</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_typedef_xml</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="nv">$id</span> <span class="o">=</span> <span class="s">&quot;API-typedef-&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;typedef&#39;</span><span class="p">};</span>
    <span class="nv">$id</span> <span class="o">=~</span> <span class="sr">s/[^A-Za-z0-9]/-/g</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;refentry id=\&quot;$id\&quot;&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refentryinfo&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;title&gt;LINUX&lt;/title&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;productname&gt;Kernel Hackers Manual&lt;/productname&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;date&gt;$man_date&lt;/date&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refentryinfo&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refmeta&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refentrytitle&gt;&lt;phrase&gt;typedef &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;typedef&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/phrase&gt;&lt;/refentrytitle&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;manvolnum&gt;9&lt;/manvolnum&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refmeta&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;refnamediv&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refname&gt;typedef &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;typedef&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/refname&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;refpurpose&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &quot;</span><span class="p">;</span>
    <span class="n">output_highlight</span> <span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">});</span>
    <span class="k">print</span> <span class="s">&quot; &lt;/refpurpose&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refnamediv&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;refsynopsisdiv&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;title&gt;Synopsis&lt;/title&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;synopsis&gt;typedef &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;typedef&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;;&lt;/synopsis&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/refsynopsisdiv&gt;\n&quot;</span><span class="p">;</span>

    <span class="n">output_section_xml</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>

    <span class="k">print</span> <span class="s">&quot;&lt;/refentry&gt;\n\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-58"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-58">&#182;</a></div><p>output in XML DocBook</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_blockhead_xml</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;module&#39;</span><span class="p">};</span>
    <span class="nv">$id</span> <span class="o">=~</span> <span class="sr">s/[^A-Za-z0-9]/-/g</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-59"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-59">&#182;</a></div><p>print out each section</p></td><td class="code"><div class="highlight"><pre>    <span class="nv">$lineprefix</span><span class="o">=</span><span class="s">&quot;   &quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;content-only&#39;</span><span class="p">})</span> <span class="p">{</span>
		<span class="k">print</span> <span class="s">&quot;&lt;refsect1&gt;\n &lt;title&gt;$section&lt;/title&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$section</span> <span class="o">=~</span> <span class="sr">m/EXAMPLE/i</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;example&gt;&lt;para&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;para&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$section</span> <span class="o">=~</span> <span class="sr">m/EXAMPLE/i</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;/para&gt;&lt;/example&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;/para&gt;&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;content-only&#39;</span><span class="p">})</span> <span class="p">{</span>
		<span class="k">print</span> <span class="s">&quot;\n&lt;/refsect1&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">print</span> <span class="s">&quot;\n\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-60"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-60">&#182;</a></div><p>output in XML DocBook</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_function_gnome</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;module&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;-&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">};</span>
    <span class="nv">$id</span> <span class="o">=~</span> <span class="sr">s/[^A-Za-z0-9]/-/g</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;&lt;sect2&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot; &lt;title id=\&quot;$id\&quot;&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;&lt;/title&gt;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;  &lt;funcsynopsis&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;   &lt;funcdef&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;functiontype&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;function&gt;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/function&gt;&lt;/funcdef&gt;\n&quot;</span><span class="p">;</span>

    <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}}</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	    <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parametertypes&#39;</span><span class="p">}{</span><span class="nv">$parameter</span><span class="p">};</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/([^\(]*\(\*)\s*\)\s*\(([^\)]*)\)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-61"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-61">&#182;</a></div><p>pointer-to-function</p></td><td class="code"><div class="highlight"><pre>		<span class="k">print</span> <span class="s">&quot;   &lt;paramdef&gt;$1 &lt;parameter&gt;$parameter&lt;/parameter&gt;)\n&quot;</span><span class="p">;</span>
		<span class="k">print</span> <span class="s">&quot;     &lt;funcparams&gt;$2&lt;/funcparams&gt;&lt;/paramdef&gt;\n&quot;</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">print</span> <span class="s">&quot;   &lt;paramdef&gt;&quot;</span> <span class="o">.</span> <span class="nv">$type</span><span class="p">;</span>
		<span class="k">print</span> <span class="s">&quot; &lt;parameter&gt;$parameter&lt;/parameter&gt;&lt;/paramdef&gt;\n&quot;</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;  &lt;void&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;  &lt;/funcsynopsis&gt;\n&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}}</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot; &lt;informaltable pgwide=\&quot;1\&quot; frame=\&quot;none\&quot; role=\&quot;params\&quot;&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;tgroup cols=\&quot;2\&quot;&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;colspec colwidth=\&quot;2*\&quot;&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;colspec colwidth=\&quot;8*\&quot;&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;&lt;tbody&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	    <span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	    <span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	    <span class="k">print</span> <span class="s">&quot;  &lt;row&gt;&lt;entry align=\&quot;right\&quot;&gt;&lt;parameter&gt;$parameter&lt;/parameter&gt;&lt;/entry&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;   &lt;entry&gt;\n&quot;</span><span class="p">;</span>
	    <span class="nv">$lineprefix</span><span class="o">=</span><span class="s">&quot;     &quot;</span><span class="p">;</span>
	    <span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">});</span>
	    <span class="k">print</span> <span class="s">&quot;    &lt;/entry&gt;&lt;/row&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="s">&quot; &lt;/tbody&gt;&lt;/tgroup&gt;&lt;/informaltable&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot; &lt;para&gt;\n  None\n &lt;/para&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span></pre></div></td></tr>


<tr id="section-62"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-62">&#182;</a></div><p>print out each section</p></td><td class="code"><div class="highlight"><pre>    <span class="nv">$lineprefix</span><span class="o">=</span><span class="s">&quot;   &quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;&lt;simplesect&gt;\n &lt;title&gt;$section&lt;/title&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$section</span> <span class="o">=~</span> <span class="sr">m/EXAMPLE/i</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;example&gt;&lt;programlisting&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="s">&quot;&lt;para&gt;\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
	<span class="k">print</span> <span class="s">&quot;&lt;/para&gt;\n&quot;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$section</span> <span class="o">=~</span> <span class="sr">m/EXAMPLE/i</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;/programlisting&gt;&lt;/example&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="s">&quot; &lt;/simplesect&gt;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">print</span> <span class="s">&quot;&lt;/sect2&gt;\n\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-63"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-63">&#182;</a></div><p>#
output function in man</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_function_man</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;.TH \&quot;$args{&#39;function&#39;}\&quot; 9 \&quot;$args{&#39;function&#39;}\&quot; \&quot;$man_date\&quot; \&quot;Kernel Hacker&#39;s Manual\&quot; LINUX\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;.SH NAME\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; \\- &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;.SH SYNOPSIS\n&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;functiontype&#39;</span><span class="p">}</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;.B \&quot;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;functiontype&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;.B \&quot;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$parenth</span> <span class="o">=</span> <span class="s">&quot;(&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$post</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">==</span> <span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	    <span class="nv">$post</span> <span class="o">=</span> <span class="s">&quot;);&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nv">$type</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parametertypes&#39;</span><span class="p">}{</span><span class="nv">$parameter</span><span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/([^\(]*\(\*)\s*\)\s*\(([^\)]*)\)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-64"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-64">&#182;</a></div><p>pointer-to-function</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="s">&quot;.BI \&quot;&quot;</span> <span class="o">.</span> <span class="nv">$parenth</span> <span class="o">.</span> <span class="nv">$1</span> <span class="o">.</span> <span class="s">&quot;\&quot; &quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot; \&quot;) (&quot;</span> <span class="o">.</span> <span class="nv">$2</span> <span class="o">.</span> <span class="s">&quot;)&quot;</span> <span class="o">.</span> <span class="nv">$post</span> <span class="o">.</span> <span class="s">&quot;\&quot;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="nv">$type</span> <span class="o">=~</span> <span class="sr">s/([^\*])$/$1 /</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;.BI \&quot;&quot;</span> <span class="o">.</span> <span class="nv">$parenth</span> <span class="o">.</span> <span class="nv">$type</span> <span class="o">.</span> <span class="s">&quot;\&quot; &quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot; \&quot;&quot;</span> <span class="o">.</span> <span class="nv">$post</span> <span class="o">.</span> <span class="s">&quot;\&quot;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
	<span class="nv">$parenth</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">print</span> <span class="s">&quot;.SH ARGUMENTS\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="k">print</span> <span class="s">&quot;.IP \&quot;&quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;\&quot; 12\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;.SH \&quot;&quot;</span><span class="p">,</span> <span class="nb">uc</span> <span class="nv">$section</span><span class="p">,</span> <span class="s">&quot;\&quot;\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-65"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-65">&#182;</a></div><p>#
output enum in man</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_enum_man</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;.TH \&quot;$args{&#39;module&#39;}\&quot; 9 \&quot;enum $args{&#39;enum&#39;}\&quot; \&quot;$man_date\&quot; \&quot;API Manual\&quot; LINUX\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;.SH NAME\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;enum &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;enum&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; \\- &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;.SH SYNOPSIS\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;enum &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;enum&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; {\n&quot;</span><span class="p">;</span>
    <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;.br\n.BI \&quot;    $parameter\&quot;\n&quot;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">==</span> <span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;\n};\n&quot;</span><span class="p">;</span>
	    <span class="k">last</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;, \n.br\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">print</span> <span class="s">&quot;.SH Constants\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="k">print</span> <span class="s">&quot;.IP \&quot;&quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;\&quot; 12\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;.SH \&quot;$section\&quot;\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-66"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-66">&#182;</a></div><p>#
output struct in man</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_struct_man</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>

    <span class="k">print</span> <span class="s">&quot;.TH \&quot;$args{&#39;module&#39;}\&quot; 9 \&quot;&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\&quot; \&quot;$man_date\&quot; \&quot;API Manual\&quot; LINUX\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;.SH NAME\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; \\- &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;.SH SYNOPSIS\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; {\n.br\n&quot;</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$parameter</span> <span class="o">=~</span><span class="sr"> /^#/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;.BI \&quot;$parameter\&quot;\n.br\n&quot;</span><span class="p">;</span>
	    <span class="k">next</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">}</span> <span class="ow">ne</span> <span class="nv">$undescribed</span><span class="p">)</span> <span class="o">||</span> <span class="k">next</span><span class="p">;</span>
	<span class="nv">$type</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parametertypes&#39;</span><span class="p">}{</span><span class="nv">$parameter</span><span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/([^\(]*\(\*)\s*\)\s*\(([^\)]*)\)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-67"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-67">&#182;</a></div><p>pointer-to-function</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="s">&quot;.BI \&quot;    &quot;</span> <span class="o">.</span> <span class="nv">$1</span> <span class="o">.</span> <span class="s">&quot;\&quot; &quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot; \&quot;) (&quot;</span> <span class="o">.</span> <span class="nv">$2</span> <span class="o">.</span> <span class="s">&quot;)&quot;</span> <span class="o">.</span> <span class="s">&quot;\&quot;\n;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/^(.*?)\s*(:.*)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-68"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-68">&#182;</a></div><p>bitfield</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="s">&quot;.BI \&quot;    &quot;</span> <span class="o">.</span> <span class="nv">$1</span> <span class="o">.</span> <span class="s">&quot;\ \&quot; &quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="nv">$2</span> <span class="o">.</span> <span class="s">&quot; \&quot;&quot;</span> <span class="o">.</span> <span class="s">&quot;\&quot;\n;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="nv">$type</span> <span class="o">=~</span> <span class="sr">s/([^\*])$/$1 /</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;.BI \&quot;    &quot;</span> <span class="o">.</span> <span class="nv">$type</span> <span class="o">.</span> <span class="s">&quot;\&quot; &quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot; \&quot;&quot;</span> <span class="o">.</span> <span class="s">&quot;\&quot;\n;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="s">&quot;\n.br\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;};\n.br\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;.SH Members\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="p">(</span><span class="nv">$parameter</span> <span class="o">=~</span><span class="sr"> /^#/</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">next</span><span class="p">;</span>

	<span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">}</span> <span class="ow">ne</span> <span class="nv">$undescribed</span><span class="p">)</span> <span class="o">||</span> <span class="k">next</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;.IP \&quot;&quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;\&quot; 12\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;.SH \&quot;$section\&quot;\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-69"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-69">&#182;</a></div><p>#
output typedef in man</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_typedef_man</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>

    <span class="k">print</span> <span class="s">&quot;.TH \&quot;$args{&#39;module&#39;}\&quot; 9 \&quot;$args{&#39;typedef&#39;}\&quot; \&quot;$man_date\&quot; \&quot;API Manual\&quot; LINUX\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;.SH NAME\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;typedef &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;typedef&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; \\- &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;.SH \&quot;$section\&quot;\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">output_blockhead_man</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;.TH \&quot;$args{&#39;module&#39;}\&quot; 9 \&quot;$args{&#39;module&#39;}\&quot; \&quot;$man_date\&quot; \&quot;API Manual\&quot; LINUX\n&quot;</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;.SH \&quot;$section\&quot;\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-70"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-70">&#182;</a></div><p>#
output in text</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_function_text</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$start</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;Name:\n\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; - &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;\nSynopsis:\n\n&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;functiontype&#39;</span><span class="p">}</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$start</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;functiontype&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; (&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="nv">$start</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; (&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="nv">$start</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="nv">$type</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parametertypes&#39;</span><span class="p">}{</span><span class="nv">$parameter</span><span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/([^\(]*\(\*)\s*\)\s*\(([^\)]*)\)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-71"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-71">&#182;</a></div><p>pointer-to-function</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="nv">$1</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;) (&quot;</span> <span class="o">.</span> <span class="nv">$2</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="nv">$type</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">!=</span> <span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	    <span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;,\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot; &quot;</span> <span class="n">x</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$start</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;);\n\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="k">print</span> <span class="s">&quot;Arguments:\n\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="k">print</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;\n\t&quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">output_section_text</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-72"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-72">&#182;</a></div><p>output sections in text</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_section_text</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="nv">$section</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;$section:\n\n&quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;\n\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-73"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-73">&#182;</a></div><p>output enum in text</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_enum_text</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;Enum:\n\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;enum &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;enum&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; - &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;enum &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;enum&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; {\n&quot;</span><span class="p">;</span>
    <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;\t$parameter&quot;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">!=</span> <span class="nv">$#</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	    <span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;,&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">print</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;};\n\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;Constants:\n\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;$parameter\n\t&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">output_section_text</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-74"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-74">&#182;</a></div><p>output typedef in text</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_typedef_text</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;Typedef:\n\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;typedef &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;typedef&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; - &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="n">output_section_text</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-75"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-75">&#182;</a></div><p>output struct as text</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_struct_text</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">);</span>

    <span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; - &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;purpose&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot; {\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$parameter</span> <span class="o">=~</span><span class="sr"> /^#/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;$parameter\n&quot;</span><span class="p">;</span>
	    <span class="k">next</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">}</span> <span class="ow">ne</span> <span class="nv">$undescribed</span><span class="p">)</span> <span class="o">||</span> <span class="k">next</span><span class="p">;</span>
	<span class="nv">$type</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parametertypes&#39;</span><span class="p">}{</span><span class="nv">$parameter</span><span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/([^\(]*\(\*)\s*\)\s*\(([^\)]*)\)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-76"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-76">&#182;</a></div><p>pointer-to-function</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="s">&quot;\t$1 $parameter) ($2);\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">=~</span> <span class="sr">m/^(.*?)\s*(:.*)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-77"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-77">&#182;</a></div><p>bitfield</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="s">&quot;\t$1 $parameter$2;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">print</span> <span class="s">&quot;\t&quot;</span> <span class="o">.</span> <span class="nv">$type</span> <span class="o">.</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$parameter</span> <span class="o">.</span> <span class="s">&quot;;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;};\n\n&quot;</span><span class="p">;</span>

    <span class="k">print</span> <span class="s">&quot;Members:\n\n&quot;</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="nv">$parameter</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="p">(</span><span class="nv">$parameter</span> <span class="o">=~</span><span class="sr"> /^#/</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">next</span><span class="p">;</span>

	<span class="k">my</span> <span class="nv">$parameter_name</span> <span class="o">=</span> <span class="nv">$parameter</span><span class="p">;</span>
	<span class="nv">$parameter_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">}</span> <span class="ow">ne</span> <span class="nv">$undescribed</span><span class="p">)</span> <span class="o">||</span> <span class="k">next</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;$parameter\n\t&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;parameterdescs&#39;</span><span class="p">}{</span><span class="nv">$parameter_name</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
    <span class="n">output_section_text</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">output_blockhead_text</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>

    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot; $section:\n&quot;</span><span class="p">;</span>
	<span class="k">print</span> <span class="s">&quot;    -&gt; &quot;</span><span class="p">;</span>
	<span class="n">output_highlight</span><span class="p">(</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sections&#39;</span><span class="p">}{</span><span class="nv">$section</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-78"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-78">&#182;</a></div><h1>list mode output functions</h1></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_function_list</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>

    <span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;function&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-79"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-79">&#182;</a></div><p>output enum in list</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_enum_list</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;enum&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-80"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-80">&#182;</a></div><p>output typedef in list</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_typedef_list</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;typedef&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-81"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-81">&#182;</a></div><p>output struct as list</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_struct_list</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>

    <span class="k">print</span> <span class="nv">$args</span><span class="p">{</span><span class="s">&#39;struct&#39;</span><span class="p">}</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">output_blockhead_list</span><span class="p">(%)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%args</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">]};</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$parameter</span><span class="p">,</span> <span class="nv">$section</span><span class="p">);</span>

    <span class="k">foreach</span> <span class="nv">$section</span> <span class="p">(</span><span class="nv">@</span><span class="p">{</span><span class="nv">$args</span><span class="p">{</span><span class="s">&#39;sectionlist&#39;</span><span class="p">}})</span> <span class="p">{</span>
	<span class="k">print</span> <span class="s">&quot;DOC: $section\n&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-82"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-82">&#182;</a></div><p>#
generic output function for all types (function, struct/union, typedef, enum);
calls the generated, variable output_ function name based on
functype and output_mode</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_declaration</span> <span class="p">{</span>
    <span class="nb">no</span> <span class="n">strict</span> <span class="s">&#39;refs&#39;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$functype</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$func</span> <span class="o">=</span> <span class="s">&quot;output_${functype}_$output_mode&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="nv">$function_only</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
	<span class="p">(</span> <span class="nv">$function_only</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nb">defined</span><span class="p">(</span><span class="nv">$function_table</span><span class="p">{</span><span class="nv">$name</span><span class="p">}))</span> <span class="o">||</span>
	<span class="p">(</span> <span class="nv">$function_only</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$function_table</span><span class="p">{</span><span class="nv">$name</span><span class="p">})))</span>
    <span class="p">{</span>
	<span class="o">&amp;</span><span class="nv">$func</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
	<span class="nv">$section_counter</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-83"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-83">&#182;</a></div><p>#
generic output function - calls the right one based on current output mode.</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">output_blockhead</span> <span class="p">{</span>
    <span class="nb">no</span> <span class="n">strict</span> <span class="s">&#39;refs&#39;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$func</span> <span class="o">=</span> <span class="s">&quot;output_blockhead_&quot;</span> <span class="o">.</span> <span class="nv">$output_mode</span><span class="p">;</span>
    <span class="o">&amp;</span><span class="nv">$func</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
    <span class="nv">$section_counter</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-84"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-84">&#182;</a></div><p>#
takes a declaration (struct, union, enum, typedef) and
invokes the right handler. NOT called for functions.</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">dump_declaration</span><span class="p">($$)</span> <span class="p">{</span>
    <span class="nb">no</span> <span class="n">strict</span> <span class="s">&#39;refs&#39;</span><span class="p">;</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$prototype</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$func</span> <span class="o">=</span> <span class="s">&quot;dump_&quot;</span> <span class="o">.</span> <span class="nv">$decl_type</span><span class="p">;</span>
    <span class="o">&amp;</span><span class="nv">$func</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">dump_union</span><span class="p">($$)</span> <span class="p">{</span>
    <span class="n">dump_struct</span><span class="p">(</span><span class="nv">@_</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">dump_struct</span><span class="p">($$)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$nested</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=~</span><span class="sr"> /(struct|union)\s+(\w+)\s*{(.*)}/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-85"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-85">&#182;</a></div><p>my $decl_type = $1;</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$declaration_name</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$members</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-86"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-86">&#182;</a></div><p>ignore embedded structs or unions</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$members</span> <span class="o">=~</span> <span class="sr">s/({.*})//g</span><span class="p">;</span>
	<span class="nv">$nested</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-87"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-87">&#182;</a></div><p>ignore members marked private:</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$members</span> <span class="o">=~</span> <span class="sr">s/\/\*\s*private:.*?\/\*\s*public:.*?\*\///gos</span><span class="p">;</span>
	<span class="nv">$members</span> <span class="o">=~</span> <span class="sr">s/\/\*\s*private:.*//gos</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-88"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-88">&#182;</a></div><p>strip comments:</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$members</span> <span class="o">=~</span> <span class="sr">s/\/\*.*?\*\///gos</span><span class="p">;</span>
	<span class="nv">$nested</span> <span class="o">=~</span> <span class="sr">s/\/\*.*?\*\///gos</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-89"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-89">&#182;</a></div><p>strip kmemcheck<em>bitfield</em>{begin,end}.*;</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$members</span> <span class="o">=~</span> <span class="sr">s/kmemcheck_bitfield_.*?;//gos</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-90"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-90">&#182;</a></div><p>strip attributes</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$members</span> <span class="o">=~</span> <span class="sr">s/__aligned\s*\(\d+\)//gos</span><span class="p">;</span>

	<span class="n">create_parameterlist</span><span class="p">(</span><span class="nv">$members</span><span class="p">,</span> <span class="s">&#39;;&#39;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
	<span class="n">check_sections</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$declaration_name</span><span class="p">,</span> <span class="s">&quot;struct&quot;</span><span class="p">,</span> <span class="nv">$sectcheck</span><span class="p">,</span> <span class="nv">$struct_actual</span><span class="p">,</span> <span class="nv">$nested</span><span class="p">);</span>

	<span class="n">output_declaration</span><span class="p">(</span><span class="nv">$declaration_name</span><span class="p">,</span>
			   <span class="s">&#39;struct&#39;</span><span class="p">,</span>
			   <span class="p">{</span><span class="s">&#39;struct&#39;</span> <span class="o">=&gt;</span> <span class="nv">$declaration_name</span><span class="p">,</span>
			    <span class="s">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="nv">$modulename</span><span class="p">,</span>
			    <span class="s">&#39;parameterlist&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@parameterlist</span><span class="p">,</span>
			    <span class="s">&#39;parameterdescs&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%parameterdescs</span><span class="p">,</span>
			    <span class="s">&#39;parametertypes&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%parametertypes</span><span class="p">,</span>
			    <span class="s">&#39;sectionlist&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@sectionlist</span><span class="p">,</span>
			    <span class="s">&#39;sections&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%sections</span><span class="p">,</span>
			    <span class="s">&#39;purpose&#39;</span> <span class="o">=&gt;</span> <span class="nv">$declaration_purpose</span><span class="p">,</span>
			    <span class="s">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nv">$decl_type</span>
			   <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Error(${file}:$.): Cannot parse struct or union!\n&quot;</span><span class="p">;</span>
	<span class="o">++</span><span class="nv">$errors</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">dump_enum</span><span class="p">($$)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

    <span class="nv">$x</span> <span class="o">=~</span> <span class="sr">s@/\*.*?\*/@@gos</span><span class="p">;</span>	<span class="c1"># strip comments.</span>
    <span class="nv">$x</span> <span class="o">=~</span> <span class="sr">s/^#\s*define\s+.*$//</span><span class="p">;</span> <span class="c1"># strip #define macros inside enums</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=~</span><span class="sr"> /enum\s+(\w+)\s*{(.*)}/</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$declaration_name</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$members</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>

	<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$arg</span> <span class="p">(</span><span class="nb">split</span> <span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$members</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$arg</span> <span class="o">=~</span> <span class="sr">s/^\s*(\w+).*/$1/</span><span class="p">;</span>
	    <span class="nb">push</span> <span class="nv">@parameterlist</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$parameterdescs</span><span class="p">{</span><span class="nv">$arg</span><span class="p">})</span> <span class="p">{</span>
		<span class="nv">$parameterdescs</span><span class="p">{</span><span class="nv">$arg</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$undescribed</span><span class="p">;</span>
		<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}:$.): Enum value &#39;$arg&#39; &quot;</span><span class="o">.</span>
		    <span class="s">&quot;not described in enum &#39;$declaration_name&#39;\n&quot;</span><span class="p">;</span>
	    <span class="p">}</span>

	<span class="p">}</span>

	<span class="n">output_declaration</span><span class="p">(</span><span class="nv">$declaration_name</span><span class="p">,</span>
			   <span class="s">&#39;enum&#39;</span><span class="p">,</span>
			   <span class="p">{</span><span class="s">&#39;enum&#39;</span> <span class="o">=&gt;</span> <span class="nv">$declaration_name</span><span class="p">,</span>
			    <span class="s">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="nv">$modulename</span><span class="p">,</span>
			    <span class="s">&#39;parameterlist&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@parameterlist</span><span class="p">,</span>
			    <span class="s">&#39;parameterdescs&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%parameterdescs</span><span class="p">,</span>
			    <span class="s">&#39;sectionlist&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@sectionlist</span><span class="p">,</span>
			    <span class="s">&#39;sections&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%sections</span><span class="p">,</span>
			    <span class="s">&#39;purpose&#39;</span> <span class="o">=&gt;</span> <span class="nv">$declaration_purpose</span>
			   <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Error(${file}:$.): Cannot parse enum!\n&quot;</span><span class="p">;</span>
	<span class="o">++</span><span class="nv">$errors</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">dump_typedef</span><span class="p">($$)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

    <span class="nv">$x</span> <span class="o">=~</span> <span class="sr">s@/\*.*?\*/@@gos</span><span class="p">;</span>	<span class="c1"># strip comments.</span>
    <span class="k">while</span> <span class="p">((</span><span class="nv">$x</span> <span class="o">=~</span><span class="sr"> /\(*.\)\s*;$/</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=~</span><span class="sr"> /\[*.\]\s*;$/</span><span class="p">))</span> <span class="p">{</span>
	<span class="nv">$x</span> <span class="o">=~</span> <span class="sr">s/\(*.\)\s*;$/;/</span><span class="p">;</span>
	<span class="nv">$x</span> <span class="o">=~</span> <span class="sr">s/\[*.\]\s*;$/;/</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=~</span><span class="sr"> /typedef.*\s+(\w+)\s*;/</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$declaration_name</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>

	<span class="n">output_declaration</span><span class="p">(</span><span class="nv">$declaration_name</span><span class="p">,</span>
			   <span class="s">&#39;typedef&#39;</span><span class="p">,</span>
			   <span class="p">{</span><span class="s">&#39;typedef&#39;</span> <span class="o">=&gt;</span> <span class="nv">$declaration_name</span><span class="p">,</span>
			    <span class="s">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="nv">$modulename</span><span class="p">,</span>
			    <span class="s">&#39;sectionlist&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@sectionlist</span><span class="p">,</span>
			    <span class="s">&#39;sections&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%sections</span><span class="p">,</span>
			    <span class="s">&#39;purpose&#39;</span> <span class="o">=&gt;</span> <span class="nv">$declaration_purpose</span>
			   <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Error(${file}:$.): Cannot parse typedef!\n&quot;</span><span class="p">;</span>
	<span class="o">++</span><span class="nv">$errors</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">save_struct_actual</span><span class="p">($)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$actual</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-91"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-91">&#182;</a></div><p>strip all spaces from the actual param so that it looks like one string item</p></td><td class="code"><div class="highlight"><pre>    <span class="nv">$actual</span> <span class="o">=~</span> <span class="sr">s/\s*//g</span><span class="p">;</span>
    <span class="nv">$struct_actual</span> <span class="o">=</span> <span class="nv">$struct_actual</span> <span class="o">.</span> <span class="nv">$actual</span> <span class="o">.</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">create_parameterlist</span><span class="p">($$$)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$args</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$splitter</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$type</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$param</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-92"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-92">&#182;</a></div><p>temporarily replace commas inside function pointer definition</p></td><td class="code"><div class="highlight"><pre>    <span class="k">while</span> <span class="p">(</span><span class="nv">$args</span> <span class="o">=~</span><span class="sr"> /(\([^\),]+),/</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$args</span> <span class="o">=~</span> <span class="sr">s/(\([^\),]+),/$1#/g</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="nv">$arg</span> <span class="p">(</span><span class="nb">split</span><span class="p">(</span><span class="nv">$splitter</span><span class="p">,</span> <span class="nv">$args</span><span class="p">))</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-93"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-93">&#182;</a></div><p>strip comments</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$arg</span> <span class="o">=~</span> <span class="sr">s/\/\*.*\*\///</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-94"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-94">&#182;</a></div><p>strip leading/trailing spaces</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$arg</span> <span class="o">=~</span> <span class="sr">s/^\s*//</span><span class="p">;</span>
	<span class="nv">$arg</span> <span class="o">=~</span> <span class="sr">s/\s*$//</span><span class="p">;</span>
	<span class="nv">$arg</span> <span class="o">=~</span> <span class="sr">s/\s+/ /</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="nv">$arg</span> <span class="o">=~</span><span class="sr"> /^#/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-95"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-95">&#182;</a></div><p>Treat preprocessor directive as a typeless variable just to fill
corresponding data structures "correctly". Catch it later in
output_* subs.</p></td><td class="code"><div class="highlight"><pre>	    <span class="n">push_parameter</span><span class="p">(</span><span class="nv">$arg</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arg</span> <span class="o">=~</span> <span class="sr">m/\(.+\)\s*\(/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-96"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-96">&#182;</a></div><p>pointer-to-function</p></td><td class="code"><div class="highlight"><pre>	    <span class="nv">$arg</span> <span class="o">=~</span> <span class="nb">tr</span><span class="sr">/#/</span><span class="p">,</span><span class="o">/</span><span class="p">;</span>
	    <span class="nv">$arg</span> <span class="o">=~</span> <span class="sr">m/[^\(]+\(\*?\s*(\w*)\s*\)/</span><span class="p">;</span>
	    <span class="nv">$param</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	    <span class="nv">$type</span> <span class="o">=</span> <span class="nv">$arg</span><span class="p">;</span>
	    <span class="nv">$type</span> <span class="o">=~</span> <span class="sr">s/([^\(]+\(\*?)\s*$param/$1/</span><span class="p">;</span>
	    <span class="n">save_struct_actual</span><span class="p">(</span><span class="nv">$param</span><span class="p">);</span>
	    <span class="n">push_parameter</span><span class="p">(</span><span class="nv">$param</span><span class="p">,</span> <span class="nv">$type</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$arg</span> <span class="o">=~</span> <span class="sr">s/\s*:\s*/:/g</span><span class="p">;</span>
	    <span class="nv">$arg</span> <span class="o">=~</span> <span class="sr">s/\s*\[/\[/g</span><span class="p">;</span>

	    <span class="k">my</span> <span class="nv">@args</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;\s*,\s*&#39;</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">);</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=~</span> <span class="sr">m/\*/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=~</span> <span class="sr">s/(\*+)\s*/ $1/</span><span class="p">;</span>
	    <span class="p">}</span>

	    <span class="k">my</span> <span class="nv">@first_arg</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /^(.*\s+)(.*?\[.*\].*)$/</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nb">shift</span> <span class="nv">@args</span><span class="p">;</span>
		    <span class="nb">push</span><span class="p">(</span><span class="nv">@first_arg</span><span class="p">,</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;\s+&#39;</span><span class="p">,</span> <span class="nv">$1</span><span class="p">));</span>
		    <span class="nb">push</span><span class="p">(</span><span class="nv">@first_arg</span><span class="p">,</span> <span class="nv">$2</span><span class="p">);</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="nv">@first_arg</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&#39;\s+&#39;</span><span class="p">,</span> <span class="nb">shift</span> <span class="nv">@args</span><span class="p">);</span>
	    <span class="p">}</span>

	    <span class="nb">unshift</span><span class="p">(</span><span class="nv">@args</span><span class="p">,</span> <span class="nb">pop</span> <span class="nv">@first_arg</span><span class="p">);</span>
	    <span class="nv">$type</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nv">@first_arg</span><span class="p">;</span>

	    <span class="k">foreach</span> <span class="nv">$param</span> <span class="p">(</span><span class="nv">@args</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$param</span> <span class="o">=~</span> <span class="sr">m/^(\*+)\s*(.*)/</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">save_struct_actual</span><span class="p">(</span><span class="nv">$2</span><span class="p">);</span>
		    <span class="n">push_parameter</span><span class="p">(</span><span class="nv">$2</span><span class="p">,</span> <span class="s">&quot;$type $1&quot;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">elsif</span> <span class="p">(</span><span class="nv">$param</span> <span class="o">=~</span> <span class="sr">m/(.*?):(\d+)/</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># skip unnamed bit-fields</span>
			<span class="n">save_struct_actual</span><span class="p">(</span><span class="nv">$1</span><span class="p">);</span>
			<span class="n">push_parameter</span><span class="p">(</span><span class="nv">$1</span><span class="p">,</span> <span class="s">&quot;$type:$2&quot;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)</span>
		    <span class="p">}</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
		    <span class="n">save_struct_actual</span><span class="p">(</span><span class="nv">$param</span><span class="p">);</span>
		    <span class="n">push_parameter</span><span class="p">(</span><span class="nv">$param</span><span class="p">,</span> <span class="nv">$type</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">push_parameter</span><span class="p">($$$)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$param</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$type</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="nv">$anon_struct_union</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="nv">$param</span> <span class="ow">eq</span> <span class="s">&quot;}&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">return</span><span class="p">;</span>		<span class="c1"># ignore the ending }; from anon. struct/union</span>
	<span class="p">}</span>

	<span class="nv">$anon_struct_union</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$param_name</span> <span class="o">=</span> <span class="nv">$param</span><span class="p">;</span>
	<span class="nv">$param_name</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">$param</span> <span class="o">=~</span><span class="sr"> /\.\.\.$/</span><span class="p">)</span>
	<span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span> <span class="nv">$parameterdescs</span><span class="p">{</span><span class="nv">$param</span><span class="p">}</span> <span class="o">||</span> <span class="nv">$parameterdescs</span><span class="p">{</span><span class="nv">$param</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$parameterdescs</span><span class="p">{</span><span class="nv">$param</span><span class="p">}</span> <span class="o">=</span> <span class="s">&quot;variable arguments&quot;</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
	<span class="k">elsif</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$param</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span> <span class="ow">or</span> <span class="nv">$param</span> <span class="ow">eq</span> <span class="s">&quot;void&quot;</span><span class="p">))</span>
	<span class="p">{</span>
	    <span class="nv">$param</span><span class="o">=</span><span class="s">&quot;void&quot;</span><span class="p">;</span>
	    <span class="nv">$parameterdescs</span><span class="p">{</span><span class="n">void</span><span class="p">}</span> <span class="o">=</span> <span class="s">&quot;no arguments&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">elsif</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$param</span> <span class="ow">eq</span> <span class="s">&quot;struct&quot;</span> <span class="ow">or</span> <span class="nv">$param</span> <span class="ow">eq</span> <span class="s">&quot;union&quot;</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-97"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-97">&#182;</a></div><p>handle unnamed (anonymous) union or struct:</p></td><td class="code"><div class="highlight"><pre>	<span class="p">{</span>
		<span class="nv">$type</span> <span class="o">=</span> <span class="nv">$param</span><span class="p">;</span>
		<span class="nv">$param</span> <span class="o">=</span> <span class="s">&quot;{unnamed_&quot;</span> <span class="o">.</span> <span class="nv">$param</span> <span class="o">.</span> <span class="s">&quot;}&quot;</span><span class="p">;</span>
		<span class="nv">$parameterdescs</span><span class="p">{</span><span class="nv">$param</span><span class="p">}</span> <span class="o">=</span> <span class="s">&quot;anonymous\n&quot;</span><span class="p">;</span>
		<span class="nv">$anon_struct_union</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-98"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-98">&#182;</a></div><p>warn if parameter has no description
(but ignore ones starting with # as these are not parameters
but inline preprocessor statements);
also ignore unnamed structs/unions;</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$anon_struct_union</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span> <span class="nv">$parameterdescs</span><span class="p">{</span><span class="nv">$param_name</span><span class="p">}</span> <span class="o">&amp;&amp;</span> <span class="nv">$param_name</span> <span class="o">!~</span> <span class="sr">/^#/</span><span class="p">)</span> <span class="p">{</span>

	    <span class="nv">$parameterdescs</span><span class="p">{</span><span class="nv">$param_name</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$undescribed</span><span class="p">;</span>

	    <span class="k">if</span> <span class="p">((</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&#39;function&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$type</span> <span class="ow">eq</span> <span class="s">&#39;enum&#39;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}:$.): Function parameter &quot;</span><span class="o">.</span>
		    <span class="s">&quot;or member &#39;$param&#39; not &quot;</span> <span class="o">.</span>
		    <span class="s">&quot;described in &#39;$declaration_name&#39;\n&quot;</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}:$.):&quot;</span> <span class="o">.</span>
			 <span class="s">&quot; No description found for parameter &#39;$param&#39;\n&quot;</span><span class="p">;</span>
	    <span class="o">++</span><span class="nv">$warnings</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="p">}</span>

	<span class="nv">$param</span> <span class="o">=</span> <span class="n">xml_escape</span><span class="p">(</span><span class="nv">$param</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-99"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-99">&#182;</a></div><p>strip spaces from $param so that it is one continuous string
on @parameterlist;
this fixes a problem where check<em>sections() cannot find
a parameter like "addr[6 + 2]" because it actually appears
as "addr[6", "+", "2]" on the parameter list;
but it's better to maintain the param string unchanged for output,
so just weaken the string compare in check</em>sections() to ignore
"[blah" in a parameter string;</p>

<h2>$param =~ s/\s*//g;</h2></td><td class="code"><div class="highlight"><pre>	<span class="nb">push</span> <span class="nv">@parameterlist</span><span class="p">,</span> <span class="nv">$param</span><span class="p">;</span>
	<span class="nv">$parametertypes</span><span class="p">{</span><span class="nv">$param</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$type</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">check_sections</span><span class="p">($$$$$$)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$decl_name</span><span class="p">,</span> <span class="nv">$decl_type</span><span class="p">,</span> <span class="nv">$sectcheck</span><span class="p">,</span> <span class="nv">$prmscheck</span><span class="p">,</span> <span class="nv">$nested</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">@sects</span> <span class="o">=</span> <span class="nb">split</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nv">$sectcheck</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">@prms</span> <span class="o">=</span> <span class="nb">split</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nv">$prmscheck</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$err</span><span class="p">;</span>
	<span class="k">my</span> <span class="p">(</span><span class="nv">$px</span><span class="p">,</span> <span class="nv">$sx</span><span class="p">);</span>
	<span class="k">my</span> <span class="nv">$prm_clean</span><span class="p">;</span>		<span class="c1"># strip trailing &quot;[array size]&quot; and/or beginning &quot;*&quot;</span>

	<span class="k">foreach</span> <span class="nv">$sx</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="nv">$#sects</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$err</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">foreach</span> <span class="nv">$px</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="nv">$#prms</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$prm_clean</span> <span class="o">=</span> <span class="nv">$prms</span><span class="p">[</span><span class="nv">$px</span><span class="p">];</span>
			<span class="nv">$prm_clean</span> <span class="o">=~</span> <span class="sr">s/\[.*\]//</span><span class="p">;</span>
			<span class="nv">$prm_clean</span> <span class="o">=~</span> <span class="sr">s/__attribute__\s*\(\([a-z,_\*\s\(\)]*\)\)//i</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-100"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-100">&#182;</a></div><p>ignore array size in a parameter string;
however, the original param string may contain
spaces, e.g.:  addr[6 + 2]
and this appears in @prms as "addr[6" since the
parameter list is split at spaces;
hence just ignore "[..." for the sections check;</p></td><td class="code"><div class="highlight"><pre>			<span class="nv">$prm_clean</span> <span class="o">=~</span> <span class="sr">s/\[.*//</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-101"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-101">&#182;</a></div><h1>$prm_clean =~ s/^**//;</h1></td><td class="code"><div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="nv">$prm_clean</span> <span class="ow">eq</span> <span class="nv">$sects</span><span class="p">[</span><span class="nv">$sx</span><span class="p">])</span> <span class="p">{</span>
				<span class="nv">$err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">last</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$err</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nv">$decl_type</span> <span class="ow">eq</span> <span class="s">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}:$.): &quot;</span> <span class="o">.</span>
					<span class="s">&quot;Excess function parameter &quot;</span> <span class="o">.</span>
					<span class="s">&quot;&#39;$sects[$sx]&#39; &quot;</span> <span class="o">.</span>
					<span class="s">&quot;description in &#39;$decl_name&#39;\n&quot;</span><span class="p">;</span>
				<span class="o">++</span><span class="nv">$warnings</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="nv">$nested</span> <span class="o">!~</span> <span class="sr">m/\Q$sects[$sx]\E/</span><span class="p">)</span> <span class="p">{</span>
				    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}:$.): &quot;</span> <span class="o">.</span>
					<span class="s">&quot;Excess struct/union/enum/typedef member &quot;</span> <span class="o">.</span>
					<span class="s">&quot;&#39;$sects[$sx]&#39; &quot;</span> <span class="o">.</span>
					<span class="s">&quot;description in &#39;$decl_name&#39;\n&quot;</span><span class="p">;</span>
				    <span class="o">++</span><span class="nv">$warnings</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-102"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-102">&#182;</a></div><p>#
takes a function prototype and the name of the current file being
processed and spits out all the details stored in the global
arrays/hashes.</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">dump_function</span><span class="p">($$)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$prototype</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/^static +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/^extern +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/^asmlinkage +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/^inline +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/^__inline__ +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/^__inline +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/^__always_inline +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/^noinline +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/__devinit +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/__init +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/__init_or_module +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/__must_check +//</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/^#\s*define\s+//</span><span class="p">;</span> <span class="c1">#ak added</span>
    <span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/__attribute__\s*\(\([a-z,]*\)\)//</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-103"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-103">&#182;</a></div><p>Yes, this truly is vile.  We are looking for:
1. Return type (may be nothing if we're looking at a macro)
2. Function name
3. Function parameters.</p>

<p>All the while we have to watch out for function pointer parameters
(which IIRC is what the two sections are for), C types (these
regexps don't even start to express all the possibilities), and
so on.</p>

<p>If you mess with these regexps, it's a good idea to check that
the following functions' documentation still comes out right:
- parport<em>register</em>device (function pointer parameters)
- atomic<em>set (macro)
- pci</em>match<em>device, _</em>copy<em>to</em>user (long return type)</p></td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^()([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s*\*)\s*([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s+\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s+\w+\s*\*+)\s*([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s+\w+\s+\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s+\w+\s+\w+\s*\*)\s*([a-zA-Z0-9_~:]+)\s*\(([^\(]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^()([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s*\*)\s*([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s+\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s+\w+\s*\*)\s*([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s+\w+\s+\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s+\w+\s+\w+\s*\*)\s*([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s+\w+\s+\w+\s+\w+)\s+([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s+\w+\s+\w+\s+\w+\s*\*)\s*([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)/</span> <span class="o">||</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/^(\w+\s+\w+\s*\*\s*\w+\s*\*\s*)\s*([a-zA-Z0-9_~:]+)\s*\(([^\{]*)\)/</span><span class="p">)</span>  <span class="p">{</span>
	<span class="nv">$return_type</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	<span class="nv">$declaration_name</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$args</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>

	<span class="n">create_parameterlist</span><span class="p">(</span><span class="nv">$args</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Error(${file}:$.): cannot understand prototype: &#39;$prototype&#39;\n&quot;</span><span class="p">;</span>
	<span class="o">++</span><span class="nv">$errors</span><span class="p">;</span>
	<span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

	<span class="k">my</span> <span class="nv">$prms</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nv">@parameterlist</span><span class="p">;</span>
	<span class="n">check_sections</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$declaration_name</span><span class="p">,</span> <span class="s">&quot;function&quot;</span><span class="p">,</span> <span class="nv">$sectcheck</span><span class="p">,</span> <span class="nv">$prms</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>

    <span class="n">output_declaration</span><span class="p">(</span><span class="nv">$declaration_name</span><span class="p">,</span>
		       <span class="s">&#39;function&#39;</span><span class="p">,</span>
		       <span class="p">{</span><span class="s">&#39;function&#39;</span> <span class="o">=&gt;</span> <span class="nv">$declaration_name</span><span class="p">,</span>
			<span class="s">&#39;module&#39;</span> <span class="o">=&gt;</span> <span class="nv">$modulename</span><span class="p">,</span>
			<span class="s">&#39;functiontype&#39;</span> <span class="o">=&gt;</span> <span class="nv">$return_type</span><span class="p">,</span>
			<span class="s">&#39;parameterlist&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@parameterlist</span><span class="p">,</span>
			<span class="s">&#39;parameterdescs&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%parameterdescs</span><span class="p">,</span>
			<span class="s">&#39;parametertypes&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%parametertypes</span><span class="p">,</span>
			<span class="s">&#39;sectionlist&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@sectionlist</span><span class="p">,</span>
			<span class="s">&#39;sections&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%sections</span><span class="p">,</span>
			<span class="s">&#39;purpose&#39;</span> <span class="o">=&gt;</span> <span class="nv">$declaration_purpose</span>
		       <span class="p">});</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">reset_state</span> <span class="p">{</span>
    <span class="nv">$function</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="nv">%constants</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">%parameterdescs</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">%parametertypes</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">@parameterlist</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">%sections</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">@sectionlist</span> <span class="o">=</span> <span class="p">();</span>
    <span class="nv">$sectcheck</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="nv">$struct_actual</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="nv">$prototype</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>

    <span class="nv">$state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">tracepoint_munge</span><span class="p">($)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$tracepointname</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$tracepointargs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/TRACE_EVENT\((.*?),/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$tracepointname</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/DEFINE_SINGLE_EVENT\((.*?),/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$tracepointname</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/DEFINE_EVENT\((.*?),(.*?),/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$tracepointname</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nv">$tracepointname</span> <span class="o">=~</span> <span class="sr">s/^\s+//</span><span class="p">;</span> <span class="c1">#strip leading whitespace</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/TP_PROTO\((.*?)\)/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$tracepointargs</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">((</span><span class="nv">$tracepointname</span> <span class="ow">eq</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$tracepointargs</span> <span class="ow">eq</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}:$.): Unrecognized tracepoint format: \n&quot;</span><span class="o">.</span>
			     <span class="s">&quot;$prototype\n&quot;</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nv">$prototype</span> <span class="o">=</span> <span class="s">&quot;static inline void trace_$tracepointname($tracepointargs)&quot;</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">syscall_munge</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$void</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s@[\r\n\t]+@ @gos</span><span class="p">;</span> <span class="c1"># strip newlines/CR&#39;s/tabs</span></pre></div></td></tr>


<tr id="section-104"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-104">&#182;</a></div><h1>if ($prototype =~ m/SYSCALL<em>DEFINE0\s*(\s*(a-zA-Z0-9</em>)<em>\s</em>)/) {</h1></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">(</span><span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/SYSCALL_DEFINE0/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$void</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-105"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-105">&#182;</a></div><h1>$prototype = "long sys_$1(void)";</h1></td><td class="code"><div class="highlight"><pre>	<span class="p">}</span>

	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/SYSCALL_DEFINE.*\(/long sys_/</span><span class="p">;</span> <span class="c1"># fix return type &amp; func name</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">m/long (sys_.*?),/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/,/\(/</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$void</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s/\)/\(void\)/</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-106"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-106">&#182;</a></div><p>now delete all of the odd-number commas in $prototype
so that arg types &amp; arg names don't have a comma between them</p></td><td class="code"><div class="highlight"><pre>	<span class="k">my</span> <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$len</span> <span class="o">=</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$prototype</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$void</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>	<span class="c1"># skip the for-loop</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$ix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$ix</span> <span class="o">&lt;</span> <span class="nv">$len</span><span class="p">;</span> <span class="nv">$ix</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$prototype</span><span class="p">,</span> <span class="nv">$ix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="nv">%</span> <span class="nv">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="nb">substr</span><span class="p">(</span><span class="nv">$prototype</span><span class="p">,</span> <span class="nv">$ix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">process_state3_function</span><span class="p">($$)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

    <span class="nv">$x</span> <span class="o">=~</span> <span class="sr">s@\/\/.*$@@gos</span><span class="p">;</span> <span class="c1"># strip C99-style comments to end of line</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=~</span> <span class="n">m</span><span class="c1">#\s*/\*\s+MACDOC\s*#io || ($x =~ /^#/ &amp;&amp; $x !~ /^#\s*define/)) {</span></pre></div></td></tr>


<tr id="section-107"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-107">&#182;</a></div><p>do nothing</p></td><td class="code"><div class="highlight"><pre>    <span class="p">}</span>
    <span class="k">elsif</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=~</span><span class="sr"> /([^\{]*)/</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$prototype</span> <span class="o">.=</span> <span class="nv">$1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">((</span><span class="nv">$x</span> <span class="o">=~</span><span class="sr"> /\{/</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=~</span><span class="sr"> /\#\s*define/</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=~</span><span class="sr"> /;/</span><span class="p">))</span> <span class="p">{</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s@/\*.*?\*/@@gos</span><span class="p">;</span>	<span class="c1"># strip comments.</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s@[\r\n]+@ @gos</span><span class="p">;</span> <span class="c1"># strip newlines/cr&#39;s.</span>
	<span class="nv">$prototype</span> <span class="o">=~</span> <span class="sr">s@^\s+@@gos</span><span class="p">;</span> <span class="c1"># strip leading spaces</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$prototype</span> <span class="o">=~</span><span class="sr"> /SYSCALL_DEFINE/</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">syscall_munge</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$prototype</span> <span class="o">=~</span><span class="sr"> /TRACE_EVENT/</span> <span class="o">||</span> <span class="nv">$prototype</span> <span class="o">=~</span><span class="sr"> /DEFINE_EVENT/</span> <span class="o">||</span>
	    <span class="nv">$prototype</span> <span class="o">=~</span><span class="sr"> /DEFINE_SINGLE_EVENT/</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">tracepoint_munge</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">dump_function</span><span class="p">(</span><span class="nv">$prototype</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
	<span class="n">reset_state</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">process_state3_type</span><span class="p">($$)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

    <span class="nv">$x</span> <span class="o">=~</span> <span class="sr">s@[\r\n]+@ @gos</span><span class="p">;</span> <span class="c1"># strip newlines/cr&#39;s.</span>
    <span class="nv">$x</span> <span class="o">=~</span> <span class="sr">s@^\s+@@gos</span><span class="p">;</span> <span class="c1"># strip leading spaces</span>
    <span class="nv">$x</span> <span class="o">=~</span> <span class="sr">s@\s+$@@gos</span><span class="p">;</span> <span class="c1"># strip trailing spaces</span>
    <span class="nv">$x</span> <span class="o">=~</span> <span class="sr">s@\/\/.*$@@gos</span><span class="p">;</span> <span class="c1"># strip C99-style comments to end of line</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=~</span><span class="sr"> /^#/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-108"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-108">&#182;</a></div><p>To distinguish preprocessor directive from regular declaration later.</p></td><td class="code"><div class="highlight"><pre>	<span class="nv">$x</span> <span class="o">.=</span> <span class="s">&quot;;&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span> <span class="nv">$x</span> <span class="o">=~</span><span class="sr"> /([^{};]*)([{};])(.*)/</span> <span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$prototype</span> <span class="o">.=</span> <span class="nv">$1</span> <span class="o">.</span> <span class="nv">$2</span><span class="p">;</span>
	    <span class="p">(</span><span class="nv">$2</span> <span class="ow">eq</span> <span class="s">&#39;{&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$brcount</span><span class="o">++</span><span class="p">;</span>
	    <span class="p">(</span><span class="nv">$2</span> <span class="ow">eq</span> <span class="s">&#39;}&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$brcount</span><span class="o">--</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">((</span><span class="nv">$2</span> <span class="ow">eq</span> <span class="s">&#39;;&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$brcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">dump_declaration</span><span class="p">(</span><span class="nv">$prototype</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
		<span class="n">reset_state</span><span class="p">();</span>
		<span class="k">last</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="nv">$x</span> <span class="o">=</span> <span class="nv">$3</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="nv">$prototype</span> <span class="o">.=</span> <span class="nv">$x</span><span class="p">;</span>
	    <span class="k">last</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-109"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-109">&#182;</a></div><p>xml_escape: replace &lt;, >, and &amp; in the text stream;</p>

<p>however, formatting controls that are generated internally/locally in the
kernel-doc script are not escaped here; instead, they begin life like
$blankline<em>html (4 of '\' followed by a mnemonic + ':'), then these strings
are converted to their mnemonic-expected output, without the 4 * '\' &amp; ':',
just before actual output; (this is done by local</em>unescape())</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">xml_escape</span><span class="p">($)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$text</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="nv">$output_mode</span> <span class="ow">eq</span> <span class="s">&quot;text&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$output_mode</span> <span class="ow">eq</span> <span class="s">&quot;man&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nv">$text</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nv">$text</span> <span class="o">=~</span> <span class="sr">s/\&amp;/\\\\\\amp;/g</span><span class="p">;</span>
	<span class="nv">$text</span> <span class="o">=~</span> <span class="sr">s/\&lt;/\\\\\\lt;/g</span><span class="p">;</span>
	<span class="nv">$text</span> <span class="o">=~</span> <span class="sr">s/\&gt;/\\\\\\gt;/g</span><span class="p">;</span>
	<span class="k">return</span> <span class="nv">$text</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-110"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-110">&#182;</a></div><p>convert local escape strings to html
local escape strings look like:  '\\menmonic:' (that's 4 backslashes)</p></td><td class="code"><div class="highlight"><pre><span class="k">sub </span><span class="nf">local_unescape</span><span class="p">($)</span> <span class="p">{</span>
	<span class="k">my</span> <span class="nv">$text</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="nv">$output_mode</span> <span class="ow">eq</span> <span class="s">&quot;text&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$output_mode</span> <span class="ow">eq</span> <span class="s">&quot;man&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nv">$text</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nv">$text</span> <span class="o">=~</span> <span class="sr">s/\\\\\\\\lt:/&lt;/g</span><span class="p">;</span>
	<span class="nv">$text</span> <span class="o">=~</span> <span class="sr">s/\\\\\\\\gt:/&gt;/g</span><span class="p">;</span>
	<span class="k">return</span> <span class="nv">$text</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub </span><span class="nf">process_file</span><span class="p">($)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$file</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$identifier</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$func</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$descr</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$in_purpose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$initial_section_counter</span> <span class="o">=</span> <span class="nv">$section_counter</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$ENV</span><span class="p">{</span><span class="s">&#39;SRCTREE&#39;</span><span class="p">}))</span> <span class="p">{</span>
	<span class="nv">$file</span> <span class="o">=</span> <span class="s">&quot;$ENV{&#39;SRCTREE&#39;}&quot;</span> <span class="o">.</span> <span class="s">&quot;/&quot;</span> <span class="o">.</span> <span class="s">&quot;@_&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
	<span class="nv">$file</span> <span class="o">=</span> <span class="s">&quot;@_&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$source_map</span><span class="p">{</span><span class="nv">$file</span><span class="p">}))</span> <span class="p">{</span>
	<span class="nv">$file</span> <span class="o">=</span> <span class="nv">$source_map</span><span class="p">{</span><span class="nv">$file</span><span class="p">};</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">open</span><span class="p">(</span><span class="n">IN</span><span class="p">,</span><span class="s">&quot;&lt;$file&quot;</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Error: Cannot open file $file\n&quot;</span><span class="p">;</span>
	<span class="o">++</span><span class="nv">$errors</span><span class="p">;</span>
	<span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="vg">$.</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="nv">$section_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="sr">&lt;IN&gt;</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="sr">/$doc_start/o</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>		<span class="c1"># next line is always the function name</span>
		<span class="nv">$in_doc_sect</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>	<span class="c1"># this line is the function name (always)</span>
	    <span class="k">if</span> <span class="p">(</span><span class="sr">/$doc_block/o</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$state</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="nv">$contents</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span> <span class="nv">$1</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nv">$section</span> <span class="o">=</span> <span class="nv">$section_intro</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nv">$section</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	    <span class="k">elsif</span> <span class="p">(</span><span class="sr">/$doc_decl/o</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$identifier</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="sr">/\s*([\w\s]+?)\s*-/</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$identifier</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="nv">$state</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="sr">/-(.*)/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-111"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-111">&#182;</a></div><p>strip leading/trailing/multiple spaces</p></td><td class="code"><div class="highlight"><pre>		    <span class="nv">$descr</span><span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		    <span class="nv">$descr</span> <span class="o">=~</span> <span class="sr">s/^\s*//</span><span class="p">;</span>
		    <span class="nv">$descr</span> <span class="o">=~</span> <span class="sr">s/\s*$//</span><span class="p">;</span>
		    <span class="nv">$descr</span> <span class="o">=~</span> <span class="sr">s/\s+/ /</span><span class="p">;</span>
		    <span class="nv">$declaration_purpose</span> <span class="o">=</span> <span class="n">xml_escape</span><span class="p">(</span><span class="nv">$descr</span><span class="p">);</span>
		    <span class="nv">$in_purpose</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="nv">$declaration_purpose</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">((</span><span class="nv">$declaration_purpose</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$verbose</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}:$.): missing initial short description on line:\n&quot;</span><span class="p">;</span>
			<span class="k">print</span> <span class="bp">STDERR</span> <span class="nv">$_</span><span class="p">;</span>
			<span class="o">++</span><span class="nv">$warnings</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="nv">$identifier</span> <span class="o">=~</span> <span class="sr">m/^struct/</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$decl_type</span> <span class="o">=</span> <span class="s">&#39;struct&#39;</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$identifier</span> <span class="o">=~</span> <span class="sr">m/^union/</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$decl_type</span> <span class="o">=</span> <span class="s">&#39;union&#39;</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$identifier</span> <span class="o">=~</span> <span class="sr">m/^enum/</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$decl_type</span> <span class="o">=</span> <span class="s">&#39;enum&#39;</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$identifier</span> <span class="o">=~</span> <span class="sr">m/^typedef/</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$decl_type</span> <span class="o">=</span> <span class="s">&#39;typedef&#39;</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="nv">$decl_type</span> <span class="o">=</span> <span class="s">&#39;function&#39;</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="nv">$verbose</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Info(${file}:$.): Scanning doc for $identifier\n&quot;</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}:$.): Cannot understand $_ on line $.&quot;</span><span class="p">,</span>
		<span class="s">&quot; - I thought it was a doc line\n&quot;</span><span class="p">;</span>
		<span class="o">++</span><span class="nv">$warnings</span><span class="p">;</span>
		<span class="nv">$state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$state</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>	<span class="c1"># look for head: lines, and include content</span>
	    <span class="k">if</span> <span class="p">(</span><span class="sr">/$doc_sect/o</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$newsection</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		<span class="nv">$newcontents</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="nv">$contents</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$contents</span> <span class="ow">ne</span> <span class="s">&quot;\n&quot;</span><span class="p">))</span> <span class="p">{</span>
		    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$in_doc_sect</span> <span class="o">&amp;&amp;</span> <span class="nv">$verbose</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}:$.): contents before sections\n&quot;</span><span class="p">;</span>
			<span class="o">++</span><span class="nv">$warnings</span><span class="p">;</span>
		    <span class="p">}</span>
		    <span class="n">dump_section</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$section</span><span class="p">,</span> <span class="n">xml_escape</span><span class="p">(</span><span class="nv">$contents</span><span class="p">));</span>
		    <span class="nv">$section</span> <span class="o">=</span> <span class="nv">$section_default</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="nv">$in_doc_sect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="nv">$in_purpose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="nv">$contents</span> <span class="o">=</span> <span class="nv">$newcontents</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$contents</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">while</span> <span class="p">((</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$contents</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot; &quot;</span><span class="p">)</span> <span class="o">||</span>
			<span class="nb">substr</span><span class="p">(</span><span class="nv">$contents</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;\t&quot;</span><span class="p">)</span> <span class="p">{</span>
			    <span class="nv">$contents</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$contents</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		    <span class="p">}</span>
		    <span class="nv">$contents</span> <span class="o">.=</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="nv">$section</span> <span class="o">=</span> <span class="nv">$newsection</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="sr">/$doc_end/</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">if</span> <span class="p">((</span><span class="nv">$contents</span> <span class="ow">ne</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$contents</span> <span class="ow">ne</span> <span class="s">&quot;\n&quot;</span><span class="p">))</span> <span class="p">{</span>
		    <span class="n">dump_section</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$section</span><span class="p">,</span> <span class="n">xml_escape</span><span class="p">(</span><span class="nv">$contents</span><span class="p">));</span>
		    <span class="nv">$section</span> <span class="o">=</span> <span class="nv">$section_default</span><span class="p">;</span>
		    <span class="nv">$contents</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
		<span class="p">}</span></pre></div></td></tr>


<tr id="section-112"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-112">&#182;</a></div><p>look for doc<em>com + <text> + doc</em>end:</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">=~</span> <span class="n">m</span><span class="s">&#39;\s*\*\s*[a-zA-Z_0-9:\.]+\*/&#39;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}:$.): suspicious ending line: $_&quot;</span><span class="p">;</span>
		    <span class="o">++</span><span class="nv">$warnings</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="nv">$prototype</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
		<span class="nv">$state</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="nv">$brcount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-113"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-113">&#182;</a></div><pre><code>print STDERR "end of doc comment, looking for prototype\n";
</code></pre></td><td class="code"><div class="highlight"><pre>	    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="sr">/$doc_content/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-114"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-114">&#182;</a></div><p>miguel-style comment kludge, look for blank lines after
@parameter line to signify start of description</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="nv">$1</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span> <span class="p">(</span><span class="nv">$section</span> <span class="o">=~</span> <span class="sr">m/^@/</span> <span class="o">||</span> <span class="nv">$section</span> <span class="ow">eq</span> <span class="nv">$section_context</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dump_section</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$section</span><span class="p">,</span> <span class="n">xml_escape</span><span class="p">(</span><span class="nv">$contents</span><span class="p">));</span>
			<span class="nv">$section</span> <span class="o">=</span> <span class="nv">$section_default</span><span class="p">;</span>
			<span class="nv">$contents</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
		    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nv">$contents</span> <span class="o">.=</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
		    <span class="p">}</span>
		    <span class="nv">$in_purpose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$in_purpose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-115"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-115">&#182;</a></div><p>Continued declaration purpose</p></td><td class="code"><div class="highlight"><pre>		    <span class="nb">chomp</span><span class="p">(</span><span class="nv">$declaration_purpose</span><span class="p">);</span>
		    <span class="nv">$declaration_purpose</span> <span class="o">.=</span> <span class="s">&quot; &quot;</span> <span class="o">.</span> <span class="n">xml_escape</span><span class="p">(</span><span class="nv">$1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="nv">$contents</span> <span class="o">.=</span> <span class="nv">$1</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
		<span class="p">}</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-116"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-116">&#182;</a></div><p>i dont know - bad line?  ignore.</p></td><td class="code"><div class="highlight"><pre>		<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}:$.): bad line: $_&quot;</span><span class="p">;</span>
		<span class="o">++</span><span class="nv">$warnings</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$state</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>	<span class="c1"># scanning for function &#39;{&#39; (end of prototype)</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$decl_type</span> <span class="ow">eq</span> <span class="s">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">process_state3_function</span><span class="p">(</span><span class="nv">$_</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">process_state3_type</span><span class="p">(</span><span class="nv">$_</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
	    <span class="p">}</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$state</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-117"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-117">&#182;</a></div><p>Documentation block</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="sr">/$doc_block/</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dump_doc_section</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$section</span><span class="p">,</span> <span class="n">xml_escape</span><span class="p">(</span><span class="nv">$contents</span><span class="p">));</span>
			<span class="nv">$contents</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
			<span class="nv">$function</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
			<span class="nv">%constants</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">%parameterdescs</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">%parametertypes</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">@parameterlist</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">%sections</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">@sectionlist</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">$prototype</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nv">$1</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nv">$section</span> <span class="o">=</span> <span class="nv">$section_intro</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nv">$section</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">elsif</span> <span class="p">(</span><span class="sr">/$doc_end/</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">dump_doc_section</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$section</span><span class="p">,</span> <span class="n">xml_escape</span><span class="p">(</span><span class="nv">$contents</span><span class="p">));</span>
			<span class="nv">$contents</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
			<span class="nv">$function</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
			<span class="nv">%constants</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">%parameterdescs</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">%parametertypes</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">@parameterlist</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">%sections</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">@sectionlist</span> <span class="o">=</span> <span class="p">();</span>
			<span class="nv">$prototype</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
			<span class="nv">$state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">elsif</span> <span class="p">(</span><span class="sr">/$doc_content/</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nv">$1</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span> <span class="p">)</span>
			<span class="p">{</span>
				<span class="nv">$contents</span> <span class="o">.=</span> <span class="nv">$blankline</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="nv">$contents</span> <span class="o">.=</span> <span class="nv">$1</span> <span class="o">.</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$initial_section_counter</span> <span class="o">==</span> <span class="nv">$section_counter</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;Warning(${file}): no structured comments found\n&quot;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$output_mode</span> <span class="ow">eq</span> <span class="s">&quot;xml&quot;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-118"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-118">&#182;</a></div><p>The template wants at least one RefEntry here; make one.</p></td><td class="code"><div class="highlight"><pre>	    <span class="k">print</span> <span class="s">&quot;&lt;refentry&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot; &lt;refnamediv&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;  &lt;refname&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;   ${file}\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;  &lt;/refname&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;  &lt;refpurpose&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;   Document generation inconsistency\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;  &lt;/refpurpose&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot; &lt;/refnamediv&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot; &lt;refsect1&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;  &lt;title&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;   Oops\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;  &lt;/title&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;  &lt;warning&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;   &lt;para&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;    The template for this document tried to insert\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;    the structured comment from the file\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;    &lt;filename&gt;${file}&lt;/filename&gt; at this point,\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;    but none was found.\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;    This dummy section is inserted to allow\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;    generation to continue.\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;   &lt;/para&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;  &lt;/warning&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot; &lt;/refsect1&gt;\n&quot;</span><span class="p">;</span>
	    <span class="k">print</span> <span class="s">&quot;&lt;/refentry&gt;\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="nv">$kernelversion</span> <span class="o">=</span> <span class="n">get_kernel_version</span><span class="p">();</span></pre></div></td></tr>


<tr id="section-119"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-119">&#182;</a></div><p>generate a sequence of code that will splice in highlighting information
using the s// operator.</p></td><td class="code"><div class="highlight"><pre><span class="k">foreach</span> <span class="k">my</span> <span class="nv">$pattern</span> <span class="p">(</span><span class="nb">keys</span> <span class="nv">%highlights</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-120"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-120">&#182;</a></div><p>print STDERR "scanning pattern:$pattern, highlight:($highlights{$pattern})\n";</p></td><td class="code"><div class="highlight"><pre>    <span class="nv">$dohighlight</span> <span class="o">.=</span>  <span class="s">&quot;\$contents =~ s:$pattern:$highlights{$pattern}:gs;\n&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-121"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-121">&#182;</a></div><p>Read the file that maps relative names to absolute names for
separate source and object directories and for shadow trees.</p></td><td class="code"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">SOURCE_MAP</span><span class="p">,</span> <span class="s">&quot;&lt;.tmp_filelist.txt&quot;</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">my</span> <span class="p">(</span><span class="nv">$relname</span><span class="p">,</span> <span class="nv">$absname</span><span class="p">);</span>
	<span class="k">while</span><span class="p">(</span><span class="sr">&lt;SOURCE_MAP&gt;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nb">chop</span><span class="p">();</span>
		<span class="p">(</span><span class="nv">$relname</span><span class="p">,</span> <span class="nv">$absname</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nb">split</span><span class="p">())[</span><span class="mi">0</span><span class="o">..</span><span class="mi">1</span><span class="p">];</span>
		<span class="nv">$relname</span> <span class="o">=~</span> <span class="n">s:</span><span class="o">^/+::</span><span class="p">;</span>
		<span class="nv">$source_map</span><span class="p">{</span><span class="nv">$relname</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$absname</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nb">close</span><span class="p">(</span><span class="n">SOURCE_MAP</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">@ARGV</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">chomp</span><span class="p">;</span>
    <span class="n">process_file</span><span class="p">(</span><span class="nv">$_</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$verbose</span> <span class="o">&amp;&amp;</span> <span class="nv">$errors</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;$errors errors\n&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$verbose</span> <span class="o">&amp;&amp;</span> <span class="nv">$warnings</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">print</span> <span class="bp">STDERR</span> <span class="s">&quot;$warnings warnings\n&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">exit</span><span class="p">(</span><span class="nv">$errors</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:1}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../javascript/docco.min.js"></script>
</html>
