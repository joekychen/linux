<!DOCTYPE html>
<html><head><title>joekychen/linux » scripts › makelst

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../index.html"></a><h1>makelst</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div><p>A script to dump mixed source code &amp; assembly
with correct relocations from System.map
Requires the following lines in makefile:
%.lst: %.c
$(CC) $(c_flags) -g -c -o $<em>.o $&lt; &amp;&amp;
$(srctree)/scripts/makelst $</em>.o System.map $(OBJDUMP) > $@</p>

<p>Copyright (C) 2000 IBM Corporation
Author(s): DJ Barrow (djbarrow@de.ibm.com,barrow_dj@yahoo.com)
           William Stearns <a href="&#x6D;&#x61;&#x69;&#108;&#x74;o:&#x77;&#115;&#x74;&#101;&#x61;&#114;n&#x73;&#64;&#112;&#x6F;&#x62;&#x6F;&#x78;&#x2E;&#x63;om">&#x77;&#115;&#x74;&#101;&#x61;&#114;n&#x73;&#64;&#112;&#x6F;&#x62;&#x6F;&#x78;&#x2E;&#x63;om</a></p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div></td><td class="code"><div class="highlight shebang"><pre><span>#!/bin/sh
</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>awk style field access</p></td><td class="code"><div class="highlight"><pre>field<span class="o">()</span> <span class="o">{</span>
  <span class="nb">shift</span> <span class="nv">$1</span> ; <span class="nb">echo</span> <span class="nv">$1</span>
<span class="o">}</span>

<span class="nv">t1</span><span class="o">=</span><span class="sb">`</span><span class="nv">$3</span> --syms <span class="nv">$1</span> | grep .text | grep -m1 <span class="s2">&quot; F &quot;</span><span class="sb">`</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&quot;$t1&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">  </span><span class="nv">t2</span><span class="o">=</span><span class="sb">`</span>field 6 <span class="nv">$t1</span><span class="sb">`</span>
  <span class="k">if</span> <span class="o">[</span> ! -r <span class="nv">$2</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;No System.map&quot;</span> &gt;&amp;2
  <span class="k">else</span>
<span class="k">    </span><span class="nv">t3</span><span class="o">=</span><span class="sb">`</span>grep <span class="nv">$t2</span> <span class="nv">$2</span><span class="sb">`</span>
    <span class="nv">t4</span><span class="o">=</span><span class="sb">`</span>field 1 <span class="nv">$t3</span><span class="sb">`</span>
    <span class="nv">t5</span><span class="o">=</span><span class="sb">`</span>field 1 <span class="nv">$t1</span><span class="sb">`</span>
    <span class="nv">t6</span><span class="o">=</span><span class="sb">`</span><span class="nb">printf</span> <span class="s2">&quot;%lu&quot;</span> <span class="k">$((</span><span class="m">0</span>x<span class="nv">$t4</span> <span class="o">-</span> <span class="m">0</span>x<span class="nv">$t5</span><span class="k">))</span><span class="sb">`</span>
  <span class="k">fi</span>
<span class="k">fi</span>
<span class="nv">$3</span> -r --source --adjust-vma<span class="o">=</span><span class="k">${</span><span class="nv">t6</span><span class="k">:-</span><span class="nv">0</span><span class="k">}</span> <span class="nv">$1</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:1}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../javascript/docco.min.js"></script>
</html>
