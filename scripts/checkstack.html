<!DOCTYPE html>
<html><head><title>joekychen/linux » scripts › checkstack.pl

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../index.html"></a><h1>checkstack.pl</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="c1">#!/usr/bin/perl</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Check the stack usage of functions</p>

<p>Copyright Joern Engel <a href="&#x6D;&#x61;&#x69;l&#x74;&#111;:&#106;&#111;&#x65;&#114;n&#64;&#108;&#97;&#122;&#121;&#x62;&#97;&#x73;&#x74;&#97;&#x72;&#x64;.&#111;r&#103;">&#106;&#111;&#x65;&#114;n&#64;&#108;&#97;&#122;&#121;&#x62;&#97;&#x73;&#x74;&#97;&#x72;&#x64;.&#111;r&#103;</a>
Inspired by Linus Torvalds
Original idea maybe from Keith Owens
s390 port and big speedup by Arnd Bergmann <a href="&#109;&#97;&#105;&#108;&#x74;&#x6F;:a&#114;n&#100;&#x40;&#x62;&#101;&#x72;&#x67;&#x6D;&#97;&#x6E;n&#x2D;&#100;a&#108;&#108;&#100;&#x6F;&#x72;&#x66;&#x2E;&#x64;&#x65;">a&#114;n&#100;&#x40;&#x62;&#101;&#x72;&#x67;&#x6D;&#97;&#x6E;n&#x2D;&#100;a&#108;&#108;&#100;&#x6F;&#x72;&#x66;&#x2E;&#x64;&#x65;</a>
Mips port by Juan Quintela <a href="&#x6D;&#x61;&#105;&#x6C;&#x74;&#111;:&#113;&#117;&#x69;&#x6E;&#116;e&#108;&#x61;&#64;&#109;an&#100;&#x72;&#97;&#107;&#101;&#115;&#x6F;&#x66;&#x74;&#46;&#99;&#111;&#x6D;">&#113;&#117;&#x69;&#x6E;&#116;e&#108;&#x61;&#64;&#109;an&#100;&#x72;&#97;&#107;&#101;&#115;&#x6F;&#x66;&#x74;&#46;&#99;&#111;&#x6D;</a>
IA64 port via Andreas Dilger
Arm port by Holger Schurig
sh64 port by Paul Mundt
Random bits by Matt Mackall <a href="&#109;&#x61;&#105;l&#x74;&#x6F;:&#x6D;&#x70;&#109;&#x40;&#x73;&#x65;&#x6C;&#101;&#x6E;&#105;&#99;&#x2E;&#99;&#x6F;&#x6D;">&#x6D;&#x70;&#109;&#x40;&#x73;&#x65;&#x6C;&#101;&#x6E;&#105;&#99;&#x2E;&#99;&#x6F;&#x6D;</a>
M68k port by Geert Uytterhoeven and Andreas Schwab
AVR32 port by Haavard Skinnemoen (Atmel)
PARISC port by Kyle McMartin <a href="&#x6D;&#x61;&#105;&#x6C;&#116;&#x6F;:&#107;&#x79;&#108;&#101;&#64;&#x70;&#97;&#x72;&#x69;&#x73;&#x63;&#x2D;&#108;&#105;&#x6E;&#x75;x&#x2E;&#111;&#x72;g">&#107;&#x79;&#108;&#101;&#64;&#x70;&#97;&#x72;&#x69;&#x73;&#x63;&#x2D;&#108;&#105;&#x6E;&#x75;x&#x2E;&#111;&#x72;g</a>
sparc port by Martin Habets <errandir_news@mph.eclipse.co.uk></p>

<p>Usage:
objdump -d vmlinux | scripts/checkstack.pl [arch]</p>

<p>TODO :    Port to all architectures (one regex per arch)</p></td><td class="code"><div class="highlight"><pre><span class="k">use</span> <span class="n">strict</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>check for arch</p>

<p>$re is used for two matches:
$&amp; (whole re) matches the complete objdump line with the stack growth
$1 (first bracket) matches the size of the stack growth</p>

<p>$dre is similar, but for dynamic stack redutions:
$&amp; (whole re) matches the complete objdump line with the stack growth
$1 (first bracket) matches the dynamic amount of the stack growth</p>

<p>use anything else and feel the pain ;)</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="p">(</span><span class="nv">@stack</span><span class="p">,</span> <span class="nv">$re</span><span class="p">,</span> <span class="nv">$dre</span><span class="p">,</span> <span class="nv">$x</span><span class="p">,</span> <span class="nv">$xs</span><span class="p">);</span>
<span class="p">{</span>
	<span class="k">my</span> <span class="nv">$arch</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$arch</span> <span class="o">=</span> <span class="sb">`uname -m`</span><span class="p">;</span>
		<span class="nb">chomp</span><span class="p">(</span><span class="nv">$arch</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="nv">$x</span>	<span class="o">=</span> <span class="s">&quot;[0-9a-f]&quot;</span><span class="p">;</span>	<span class="c1"># hex character</span>
	<span class="nv">$xs</span>	<span class="o">=</span> <span class="s">&quot;[0-9a-f ]&quot;</span><span class="p">;</span>	<span class="c1"># hex character or space</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;arm&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>c0008ffc:    e24dd064    sub sp, sp, #100    ; 0x64</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*sub.*sp, sp, #(([0-9]{2}|[3-9])[0-9]{2})/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;avr32&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>8000008a:       20 1d           sub sp,4
80000ca8:       fa cd 05 b0     sub sp,sp,1456</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/^.*sub.*sp.*,([0-9]{1,8})/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="o">=~</span><span class="sr"> /^i[3456]86$/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>c0105234:       81 ec ac 05 00 00       sub    $0x5ac,%esp</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/^.*[as][du][db]    \$(0x$x{1,8}),\%esp$/</span><span class="n">o</span><span class="p">;</span>
		<span class="nv">$dre</span> <span class="o">=</span> <span class="sx">qr/^.*[as][du][db]    (%.*),\%esp$/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;x86_64&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>2f60:    48 81 ec e8 05 00 00    sub    $0x5e8,%rsp</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/^.*[as][du][db]    \$(0x$x{1,8}),\%rsp$/</span><span class="n">o</span><span class="p">;</span>
		<span class="nv">$dre</span> <span class="o">=</span> <span class="sx">qr/^.*[as][du][db]    (\%.*),\%rsp$/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;ia64&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>e0000000044011fc:       01 0f fc 8c     adds r12=-384,r12</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*adds.*r12=-(([0-9]{2}|[3-9])[0-9]{2}),r12/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;m68k&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>2b6c:       4e56 fb70       linkw %fp,#-1168
 1df770:       defc ffe4       addaw #-28,%sp</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*(?:linkw %fp,|addaw )#-([0-9]{1,4})(?:,%sp)?$/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;mips64&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>8800402c:       67bdfff0        daddiu  sp,sp,-16</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*daddiu.*sp,sp,-(([0-9]{2}|[3-9])[0-9]{2})/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;mips&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>88003254:       27bdffe0        addiu   sp,sp,-32</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*addiu.*sp,sp,-(([0-9]{2}|[3-9])[0-9]{2})/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;parisc&#39;</span> <span class="o">||</span> <span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;parisc64&#39;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*ldo ($x{1,8})\(sp\),sp/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;ppc&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>c00029f4:       94 21 ff 30     stwu    r1,-208(r1)</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*stwu.*r1,-($x{1,8})\(r1\)/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;ppc64&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>XXX</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*stdu.*r1,-($x{1,8})\(r1\)/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;powerpc&#39;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*st[dw]u.*r1,-($x{1,8})\(r1\)/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="o">=~</span><span class="sr"> /^s390x?$/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>11160:       a7 fb ff 60             aghi   %r15,-160
or
 100092:     e3 f0 ff c8 ff 71   lay     %r15,-56(%r15)</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*(?:lay|ag?hi).*\%r15,-(([0-9]{2}|[3-9])[0-9]{2})</span>
<span class="sx">		      (?:\(\%r15\))?$/</span><span class="n">ox</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="o">=~</span><span class="sr"> /^sh64$/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>XXX: we only check for the immediate case presently,
    though we will want to check for the movi/sub
    pair for larger users. -- PFM.
a00048e0:       d4fc40f0        addi.l  r15,-240,r15</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*addi\.l.*r15,-(([0-9]{2}|[3-9])[0-9]{2}),r15/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="o">=~</span><span class="sr"> /^blackfin$/</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>0:   00 e8 38 01     LINK 0x4e0;</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*[[:space:]]LINK[[:space:]]*(0x$x{1,8})/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;sparc&#39;</span> <span class="o">||</span> <span class="nv">$arch</span> <span class="ow">eq</span> <span class="s">&#39;sparc64&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>f0019d10:       9d e3 bf 90     save  %sp, -112, %sp</p></td><td class="code"><div class="highlight"><pre>		<span class="nv">$re</span> <span class="o">=</span> <span class="sx">qr/.*save.*%sp, -(([0-9]{2}|[3-9])[0-9]{2}), %sp/</span><span class="n">o</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&quot;wrong or unknown architecture \&quot;$arch\&quot;\n&quot;</span><span class="p">);</span>
		<span class="nb">exit</span>
	<span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>main()</p></td><td class="code"><div class="highlight"><pre><span class="k">my</span> <span class="nv">$funcre</span> <span class="o">=</span> <span class="sx">qr/^$x* &lt;(.*)&gt;:$/</span><span class="p">;</span>
<span class="k">my</span> <span class="p">(</span><span class="nv">$func</span><span class="p">,</span> <span class="nv">$file</span><span class="p">,</span> <span class="nv">$lastslash</span><span class="p">);</span>

<span class="k">while</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span> <span class="sr">&lt;STDIN&gt;</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/$funcre/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$func</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">elsif</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/(.*):\s*file format/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$file</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		<span class="nv">$file</span> <span class="o">=~</span> <span class="sr">s/\.ko//</span><span class="p">;</span>
		<span class="nv">$lastslash</span> <span class="o">=</span> <span class="nb">rindex</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$lastslash</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$file</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$lastslash</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">elsif</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/$re/</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="nv">$size</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		<span class="nv">$size</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="nv">$size</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$size</span> <span class="o">=~</span><span class="sr"> /^0x/</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="nv">$size</span> <span class="o">&gt;</span> <span class="mh">0xf0000000</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$size</span> <span class="o">=</span> <span class="o">-</span> <span class="nv">$size</span><span class="p">;</span>
			<span class="nv">$size</span> <span class="o">+=</span> <span class="mh">0x80000000</span><span class="p">;</span>
			<span class="nv">$size</span> <span class="o">+=</span> <span class="mh">0x80000000</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$size</span> <span class="o">&gt;</span> <span class="mh">0x10000000</span><span class="p">);</span>

		<span class="k">next</span> <span class="k">if</span> <span class="nv">$line</span> <span class="o">!~</span> <span class="sr">m/^($xs*)/</span><span class="p">;</span>
		<span class="k">my</span> <span class="nv">$addr</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		<span class="nv">$addr</span> <span class="o">=~</span> <span class="sr">s/ /0/g</span><span class="p">;</span>
		<span class="nv">$addr</span> <span class="o">=</span> <span class="s">&quot;0x$addr&quot;</span><span class="p">;</span>

		<span class="k">my</span> <span class="nv">$intro</span> <span class="o">=</span> <span class="s">&quot;$addr $func [$file]:&quot;</span><span class="p">;</span>
		<span class="k">my</span> <span class="nv">$padlen</span> <span class="o">=</span> <span class="mi">56</span> <span class="o">-</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$intro</span><span class="p">);</span>
		<span class="k">while</span> <span class="p">(</span><span class="nv">$padlen</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$intro</span> <span class="o">.=</span> <span class="s">&#39;	&#39;</span><span class="p">;</span>
			<span class="nv">$padlen</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">next</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$size</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">);</span>
		<span class="nb">push</span> <span class="nv">@stack</span><span class="p">,</span> <span class="s">&quot;$intro$size\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">elsif</span> <span class="p">(</span><span class="nb">defined</span> <span class="nv">$dre</span> <span class="o">&amp;&amp;</span> <span class="nv">$line</span> <span class="o">=~</span> <span class="sr">m/$dre/</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">my</span> <span class="nv">$size</span> <span class="o">=</span> <span class="s">&quot;Dynamic ($1)&quot;</span><span class="p">;</span>

		<span class="k">next</span> <span class="k">if</span> <span class="nv">$line</span> <span class="o">!~</span> <span class="sr">m/^($xs*)/</span><span class="p">;</span>
		<span class="k">my</span> <span class="nv">$addr</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		<span class="nv">$addr</span> <span class="o">=~</span> <span class="sr">s/ /0/g</span><span class="p">;</span>
		<span class="nv">$addr</span> <span class="o">=</span> <span class="s">&quot;0x$addr&quot;</span><span class="p">;</span>

		<span class="k">my</span> <span class="nv">$intro</span> <span class="o">=</span> <span class="s">&quot;$addr $func [$file]:&quot;</span><span class="p">;</span>
		<span class="k">my</span> <span class="nv">$padlen</span> <span class="o">=</span> <span class="mi">56</span> <span class="o">-</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$intro</span><span class="p">);</span>
		<span class="k">while</span> <span class="p">(</span><span class="nv">$padlen</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$intro</span> <span class="o">.=</span> <span class="s">&#39;	&#39;</span><span class="p">;</span>
			<span class="nv">$padlen</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="nb">push</span> <span class="nv">@stack</span><span class="p">,</span> <span class="s">&quot;$intro$size\n&quot;</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>Sort output by size (last field)</p></td><td class="code"><div class="highlight"><pre><span class="k">print</span> <span class="nb">sort</span> <span class="p">{</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">=~</span><span class="sr"> /:\t*(\d+)$/</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="sr">&lt;=&gt;</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">=~</span><span class="sr"> /:\t*(\d+)$/</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">}</span> <span class="nv">@stack</span><span class="p">;</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:1}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../javascript/docco.min.js"></script>
</html>
