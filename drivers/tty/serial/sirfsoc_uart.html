<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › tty › serial › sirfsoc_uart.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>sirfsoc_uart.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Drivers for CSR SiRFprimaII onboard UARTs.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2011 Cambridge Silicon Radio Limited, a CSR plc group company.</span>
<span class="cm"> *</span>
<span class="cm"> * Licensed under GPLv2 or later.</span>
<span class="cm"> */</span>
<span class="cp">#include &lt;linux/bitops.h&gt;</span>

<span class="cm">/* UART Register Offset Define */</span>
<span class="cp">#define SIRFUART_LINE_CTRL			0x0040</span>
<span class="cp">#define SIRFUART_TX_RX_EN			0x004c</span>
<span class="cp">#define SIRFUART_DIVISOR			0x0050</span>
<span class="cp">#define SIRFUART_INT_EN				0x0054</span>
<span class="cp">#define SIRFUART_INT_STATUS			0x0058</span>
<span class="cp">#define SIRFUART_TX_DMA_IO_CTRL			0x0100</span>
<span class="cp">#define SIRFUART_TX_DMA_IO_LEN			0x0104</span>
<span class="cp">#define SIRFUART_TX_FIFO_CTRL			0x0108</span>
<span class="cp">#define SIRFUART_TX_FIFO_LEVEL_CHK		0x010C</span>
<span class="cp">#define SIRFUART_TX_FIFO_OP			0x0110</span>
<span class="cp">#define SIRFUART_TX_FIFO_STATUS			0x0114</span>
<span class="cp">#define SIRFUART_TX_FIFO_DATA			0x0118</span>
<span class="cp">#define SIRFUART_RX_DMA_IO_CTRL			0x0120</span>
<span class="cp">#define SIRFUART_RX_DMA_IO_LEN			0x0124</span>
<span class="cp">#define SIRFUART_RX_FIFO_CTRL			0x0128</span>
<span class="cp">#define SIRFUART_RX_FIFO_LEVEL_CHK		0x012C</span>
<span class="cp">#define SIRFUART_RX_FIFO_OP			0x0130</span>
<span class="cp">#define SIRFUART_RX_FIFO_STATUS			0x0134</span>
<span class="cp">#define SIRFUART_RX_FIFO_DATA			0x0138</span>
<span class="cp">#define SIRFUART_AFC_CTRL			0x0140</span>
<span class="cp">#define SIRFUART_SWH_DMA_IO			0x0148</span>

<span class="cm">/* UART Line Control Register */</span>
<span class="cp">#define SIRFUART_DATA_BIT_LEN_MASK		0x3</span>
<span class="cp">#define SIRFUART_DATA_BIT_LEN_5			BIT(0)</span>
<span class="cp">#define SIRFUART_DATA_BIT_LEN_6			1</span>
<span class="cp">#define SIRFUART_DATA_BIT_LEN_7			2</span>
<span class="cp">#define SIRFUART_DATA_BIT_LEN_8			3</span>
<span class="cp">#define SIRFUART_STOP_BIT_LEN_1			0</span>
<span class="cp">#define SIRFUART_STOP_BIT_LEN_2			BIT(2)</span>
<span class="cp">#define SIRFUART_PARITY_EN			BIT(3)</span>
<span class="cp">#define SIRFUART_EVEN_BIT			BIT(4)</span>
<span class="cp">#define SIRFUART_STICK_BIT_MASK			(7 &lt;&lt; 3)</span>
<span class="cp">#define SIRFUART_STICK_BIT_NONE			(0 &lt;&lt; 3)</span>
<span class="cp">#define SIRFUART_STICK_BIT_EVEN			BIT(3)</span>
<span class="cp">#define SIRFUART_STICK_BIT_ODD			(3 &lt;&lt; 3)</span>
<span class="cp">#define SIRFUART_STICK_BIT_MARK			(5 &lt;&lt; 3)</span>
<span class="cp">#define SIRFUART_STICK_BIT_SPACE		(7 &lt;&lt; 3)</span>
<span class="cp">#define SIRFUART_SET_BREAK			BIT(6)</span>
<span class="cp">#define SIRFUART_LOOP_BACK			BIT(7)</span>
<span class="cp">#define SIRFUART_PARITY_MASK			(7 &lt;&lt; 3)</span>
<span class="cp">#define SIRFUART_DUMMY_READ			BIT(16)</span>

<span class="cp">#define SIRFSOC_UART_RX_TIMEOUT(br, to)	(((br) * (((to) + 999) / 1000)) / 1000)</span>
<span class="cp">#define SIRFUART_RECV_TIMEOUT_MASK	(0xFFFF &lt;&lt; 16)</span>
<span class="cp">#define SIRFUART_RECV_TIMEOUT(x)	(((x) &amp; 0xFFFF) &lt;&lt; 16)</span>

<span class="cm">/* UART Auto Flow Control */</span>
<span class="cp">#define SIRFUART_AFC_RX_THD_MASK		0x000000FF</span>
<span class="cp">#define SIRFUART_AFC_RX_EN			BIT(8)</span>
<span class="cp">#define SIRFUART_AFC_TX_EN			BIT(9)</span>
<span class="cp">#define SIRFUART_CTS_CTRL			BIT(10)</span>
<span class="cp">#define SIRFUART_RTS_CTRL			BIT(11)</span>
<span class="cp">#define SIRFUART_CTS_IN_STATUS			BIT(12)</span>
<span class="cp">#define SIRFUART_RTS_OUT_STATUS			BIT(13)</span>

<span class="cm">/* UART Interrupt Enable Register */</span>
<span class="cp">#define SIRFUART_RX_DONE_INT			BIT(0)</span>
<span class="cp">#define SIRFUART_TX_DONE_INT			BIT(1)</span>
<span class="cp">#define SIRFUART_RX_OFLOW_INT			BIT(2)</span>
<span class="cp">#define SIRFUART_TX_ALLOUT_INT			BIT(3)</span>
<span class="cp">#define SIRFUART_RX_IO_DMA_INT			BIT(4)</span>
<span class="cp">#define SIRFUART_TX_IO_DMA_INT			BIT(5)</span>
<span class="cp">#define SIRFUART_RXFIFO_FULL_INT		BIT(6)</span>
<span class="cp">#define SIRFUART_TXFIFO_EMPTY_INT		BIT(7)</span>
<span class="cp">#define SIRFUART_RXFIFO_THD_INT			BIT(8)</span>
<span class="cp">#define SIRFUART_TXFIFO_THD_INT			BIT(9)</span>
<span class="cp">#define SIRFUART_FRM_ERR_INT			BIT(10)</span>
<span class="cp">#define SIRFUART_RXD_BREAK_INT			BIT(11)</span>
<span class="cp">#define SIRFUART_RX_TIMEOUT_INT			BIT(12)</span>
<span class="cp">#define SIRFUART_PARITY_ERR_INT			BIT(13)</span>
<span class="cp">#define SIRFUART_CTS_INT_EN			BIT(14)</span>
<span class="cp">#define SIRFUART_RTS_INT_EN			BIT(15)</span>

<span class="cm">/* UART Interrupt Status Register */</span>
<span class="cp">#define SIRFUART_RX_DONE			BIT(0)</span>
<span class="cp">#define SIRFUART_TX_DONE			BIT(1)</span>
<span class="cp">#define SIRFUART_RX_OFLOW			BIT(2)</span>
<span class="cp">#define SIRFUART_TX_ALL_EMPTY			BIT(3)</span>
<span class="cp">#define SIRFUART_DMA_IO_RX_DONE			BIT(4)</span>
<span class="cp">#define SIRFUART_DMA_IO_TX_DONE			BIT(5)</span>
<span class="cp">#define SIRFUART_RXFIFO_FULL			BIT(6)</span>
<span class="cp">#define SIRFUART_TXFIFO_EMPTY			BIT(7)</span>
<span class="cp">#define SIRFUART_RXFIFO_THD_REACH		BIT(8)</span>
<span class="cp">#define SIRFUART_TXFIFO_THD_REACH		BIT(9)</span>
<span class="cp">#define SIRFUART_FRM_ERR			BIT(10)</span>
<span class="cp">#define SIRFUART_RXD_BREAK			BIT(11)</span>
<span class="cp">#define SIRFUART_RX_TIMEOUT			BIT(12)</span>
<span class="cp">#define SIRFUART_PARITY_ERR			BIT(13)</span>
<span class="cp">#define SIRFUART_CTS_CHANGE			BIT(14)</span>
<span class="cp">#define SIRFUART_RTS_CHANGE			BIT(15)</span>
<span class="cp">#define SIRFUART_PLUG_IN			BIT(16)</span>

<span class="cp">#define SIRFUART_ERR_INT_STAT					\</span>
<span class="cp">				(SIRFUART_RX_OFLOW |		\</span>
<span class="cp">				SIRFUART_FRM_ERR |		\</span>
<span class="cp">				SIRFUART_RXD_BREAK |		\</span>
<span class="cp">				SIRFUART_PARITY_ERR)</span>
<span class="cp">#define SIRFUART_ERR_INT_EN					\</span>
<span class="cp">				(SIRFUART_RX_OFLOW_INT |	\</span>
<span class="cp">				SIRFUART_FRM_ERR_INT |		\</span>
<span class="cp">				SIRFUART_RXD_BREAK_INT |	\</span>
<span class="cp">				SIRFUART_PARITY_ERR_INT)</span>
<span class="cp">#define SIRFUART_TX_INT_EN	SIRFUART_TXFIFO_EMPTY_INT</span>
<span class="cp">#define SIRFUART_RX_IO_INT_EN					\</span>
<span class="cp">				(SIRFUART_RX_TIMEOUT_INT |	\</span>
<span class="cp">				SIRFUART_RXFIFO_THD_INT |	\</span>
<span class="cp">				SIRFUART_RXFIFO_FULL_INT |	\</span>
<span class="cp">				SIRFUART_ERR_INT_EN)</span>

<span class="cm">/* UART FIFO Register */</span>
<span class="cp">#define SIRFUART_TX_FIFO_STOP			0x0</span>
<span class="cp">#define SIRFUART_TX_FIFO_RESET			0x1</span>
<span class="cp">#define SIRFUART_TX_FIFO_START			0x2</span>
<span class="cp">#define SIRFUART_RX_FIFO_STOP			0x0</span>
<span class="cp">#define SIRFUART_RX_FIFO_RESET			0x1</span>
<span class="cp">#define SIRFUART_RX_FIFO_START			0x2</span>
<span class="cp">#define SIRFUART_TX_MODE_DMA			0</span>
<span class="cp">#define SIRFUART_TX_MODE_IO			1</span>
<span class="cp">#define SIRFUART_RX_MODE_DMA			0</span>
<span class="cp">#define SIRFUART_RX_MODE_IO			1</span>

<span class="cp">#define SIRFUART_RX_EN				0x1</span>
<span class="cp">#define SIRFUART_TX_EN				0x2</span>

<span class="cm">/* Generic Definitions */</span>
<span class="cp">#define SIRFSOC_UART_NAME			&quot;ttySiRF&quot;</span>
<span class="cp">#define SIRFSOC_UART_MAJOR			0</span>
<span class="cp">#define SIRFSOC_UART_MINOR			0</span>
<span class="cp">#define SIRFUART_PORT_NAME			&quot;sirfsoc-uart&quot;</span>
<span class="cp">#define SIRFUART_MAP_SIZE			0x200</span>
<span class="cp">#define SIRFSOC_UART_NR				3</span>
<span class="cp">#define SIRFSOC_PORT_TYPE			0xa5</span>

<span class="cm">/* Baud Rate Calculation */</span>
<span class="cp">#define SIRF_MIN_SAMPLE_DIV			0xf</span>
<span class="cp">#define SIRF_MAX_SAMPLE_DIV			0x3f</span>
<span class="cp">#define SIRF_IOCLK_DIV_MAX			0xffff</span>
<span class="cp">#define SIRF_SAMPLE_DIV_SHIFT			16</span>
<span class="cp">#define SIRF_IOCLK_DIV_MASK			0xffff</span>
<span class="cp">#define SIRF_SAMPLE_DIV_MASK			0x3f0000</span>
<span class="cp">#define SIRF_BAUD_RATE_SUPPORT_NR		18</span>

<span class="cm">/* For Fast Baud Rate Calculation */</span>
<span class="k">struct</span> <span class="n">sirfsoc_baudrate_to_regv</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">baud_rate</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg_val</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sirfsoc_uart_port</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>			<span class="n">hw_flow_ctrl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>			<span class="n">ms_enabled</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">uart_port</span>		<span class="n">port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pinctrl</span>			<span class="o">*</span><span class="n">p</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Hardware Flow Control */</span>
<span class="cp">#define SIRFUART_AFC_CTRL_RX_THD	0x70</span>

<span class="cm">/* Register Access Control */</span>
<span class="cp">#define portaddr(port, reg)		((port)-&gt;membase + (reg))</span>
<span class="cp">#define rd_regb(port, reg)		(__raw_readb(portaddr(port, reg)))</span>
<span class="cp">#define rd_regl(port, reg)		(__raw_readl(portaddr(port, reg)))</span>
<span class="cp">#define wr_regb(port, reg, val)		__raw_writeb(val, portaddr(port, reg))</span>
<span class="cp">#define wr_regl(port, reg, val)		__raw_writel(val, portaddr(port, reg))</span>

<span class="cm">/* UART Port Mask */</span>
<span class="cp">#define SIRFUART_FIFOLEVEL_MASK(port)	((port-&gt;line == 1) ? (0x1f) : (0x7f))</span>
<span class="cp">#define SIRFUART_FIFOFULL_MASK(port)	((port-&gt;line == 1) ? (0x20) : (0x80))</span>
<span class="cp">#define SIRFUART_FIFOEMPTY_MASK(port)	((port-&gt;line == 1) ? (0x40) : (0x100))</span>

<span class="cm">/* I/O Mode */</span>
<span class="cp">#define SIRFSOC_UART_IO_RX_MAX_CNT		256</span>
<span class="cp">#define SIRFSOC_UART_IO_TX_REASONABLE_CNT	6</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
