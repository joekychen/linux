<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › tty › serial › pmac_zilog.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>pmac_zilog.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __PMAC_ZILOG_H__</span>
<span class="cp">#define __PMAC_ZILOG_H__</span>

<span class="cm">/*</span>
<span class="cm"> * At most 2 ESCCs with 2 ports each</span>
<span class="cm"> */</span>
<span class="cp">#define MAX_ZS_PORTS	4</span>

<span class="cm">/* </span>
<span class="cm"> * We wrap our port structure around the generic uart_port.</span>
<span class="cm"> */</span>
<span class="cp">#define NUM_ZSREGS    17</span>

<span class="k">struct</span> <span class="n">uart_pmac_port</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">uart_port</span>		<span class="n">port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">uart_pmac_port</span>		<span class="o">*</span><span class="n">mate</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_PPC_PMAC</span>
	<span class="cm">/* macio_dev for the escc holding this port (maybe be null on</span>
<span class="cm">	 * early inited port)</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">macio_dev</span>		<span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="cm">/* device node to this port, this points to one of 2 childs</span>
<span class="cm">	 * of &quot;escc&quot; node (ie. ch-a or ch-b)</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">device_node</span>		<span class="o">*</span><span class="n">node</span><span class="p">;</span>
<span class="cp">#else</span>
	<span class="k">struct</span> <span class="n">platform_device</span>		<span class="o">*</span><span class="n">pdev</span><span class="p">;</span>
<span class="cp">#endif</span>

	<span class="cm">/* Port type as obtained from device tree (IRDA, modem, ...) */</span>
	<span class="kt">int</span>				<span class="n">port_type</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">curregs</span><span class="p">[</span><span class="n">NUM_ZSREGS</span><span class="p">];</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>			<span class="n">flags</span><span class="p">;</span>
<span class="cp">#define PMACZILOG_FLAG_IS_CONS		0x00000001</span>
<span class="cp">#define PMACZILOG_FLAG_IS_KGDB		0x00000002</span>
<span class="cp">#define PMACZILOG_FLAG_MODEM_STATUS	0x00000004</span>
<span class="cp">#define PMACZILOG_FLAG_IS_CHANNEL_A	0x00000008</span>
<span class="cp">#define PMACZILOG_FLAG_REGS_HELD	0x00000010</span>
<span class="cp">#define PMACZILOG_FLAG_TX_STOPPED	0x00000020</span>
<span class="cp">#define PMACZILOG_FLAG_TX_ACTIVE	0x00000040</span>
<span class="cp">#define PMACZILOG_FLAG_IS_IRDA		0x00000100</span>
<span class="cp">#define PMACZILOG_FLAG_IS_INTMODEM	0x00000200</span>
<span class="cp">#define PMACZILOG_FLAG_HAS_DMA		0x00000400</span>
<span class="cp">#define PMACZILOG_FLAG_RSRC_REQUESTED	0x00000800</span>
<span class="cp">#define PMACZILOG_FLAG_IS_OPEN		0x00002000</span>
<span class="cp">#define PMACZILOG_FLAG_IS_EXTCLK	0x00008000</span>
<span class="cp">#define PMACZILOG_FLAG_BREAK		0x00010000</span>

	<span class="kt">unsigned</span> <span class="kt">char</span>			<span class="n">parity_mask</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>			<span class="n">prev_status</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">u8</span>			<span class="n">__iomem</span> <span class="o">*</span><span class="n">control_reg</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span>			<span class="n">__iomem</span> <span class="o">*</span><span class="n">data_reg</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_PPC_PMAC</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>			<span class="n">tx_dma_irq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>			<span class="n">rx_dma_irq</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="k">struct</span> <span class="n">dbdma_regs</span>	<span class="n">__iomem</span> <span class="o">*</span><span class="n">tx_dma_regs</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="k">struct</span> <span class="n">dbdma_regs</span>	<span class="n">__iomem</span> <span class="o">*</span><span class="n">rx_dma_regs</span><span class="p">;</span>
<span class="cp">#endif</span>

	<span class="kt">unsigned</span> <span class="kt">char</span>			<span class="n">irq_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">ktermios</span>			<span class="n">termios_cache</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define to_pmz(p) ((struct uart_pmac_port *)(p))</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">uart_pmac_port</span> <span class="o">*</span><span class="nf">pmz_get_port_A</span><span class="p">(</span><span class="k">struct</span> <span class="n">uart_pmac_port</span> <span class="o">*</span><span class="n">uap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uap</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">PMACZILOG_FLAG_IS_CHANNEL_A</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">uap</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">uap</span><span class="o">-&gt;</span><span class="n">mate</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Register accessors. Note that we don&#39;t need to enforce a recovery</span>
<span class="cm"> * delay on PCI PowerMac hardware, it&#39;s dealt in HW by the MacIO chip,</span>
<span class="cm"> * though if we try to use this driver on older machines, we might have</span>
<span class="cm"> * to add it back</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">read_zsreg</span><span class="p">(</span><span class="k">struct</span> <span class="n">uart_pmac_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">writeb</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">control_reg</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">readb</span><span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">control_reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">write_zsreg</span><span class="p">(</span><span class="k">struct</span> <span class="n">uart_pmac_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">writeb</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">control_reg</span><span class="p">);</span>
	<span class="n">writeb</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">control_reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">read_zsdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">uart_pmac_port</span> <span class="o">*</span><span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">readb</span><span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">data_reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">write_zsdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">uart_pmac_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u8</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">writeb</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">data_reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">zssync</span><span class="p">(</span><span class="k">struct</span> <span class="n">uart_pmac_port</span> <span class="o">*</span><span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">readb</span><span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">control_reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Conversion routines to/from brg time constants from/to bits</span>
<span class="cm"> * per second.</span>
<span class="cm"> */</span>
<span class="cp">#define BRG_TO_BPS(brg, freq) ((freq) / 2 / ((brg) + 2))</span>
<span class="cp">#define BPS_TO_BRG(bps, freq) ((((freq) + (bps)) / (2 * (bps))) - 2)</span>

<span class="cp">#define ZS_CLOCK         3686400	</span><span class="cm">/* Z8530 RTxC input clock rate */</span><span class="cp"></span>

<span class="cm">/* The Zilog register set */</span>

<span class="cp">#define	FLAG	0x7e</span>

<span class="cm">/* Write Register 0 */</span>
<span class="cp">#define	R0	0		</span><span class="cm">/* Register selects */</span><span class="cp"></span>
<span class="cp">#define	R1	1</span>
<span class="cp">#define	R2	2</span>
<span class="cp">#define	R3	3</span>
<span class="cp">#define	R4	4</span>
<span class="cp">#define	R5	5</span>
<span class="cp">#define	R6	6</span>
<span class="cp">#define	R7	7</span>
<span class="cp">#define	R8	8</span>
<span class="cp">#define	R9	9</span>
<span class="cp">#define	R10	10</span>
<span class="cp">#define	R11	11</span>
<span class="cp">#define	R12	12</span>
<span class="cp">#define	R13	13</span>
<span class="cp">#define	R14	14</span>
<span class="cp">#define	R15	15</span>
<span class="cp">#define	R7P	16</span>

<span class="cp">#define	NULLCODE	0	</span><span class="cm">/* Null Code */</span><span class="cp"></span>
<span class="cp">#define	POINT_HIGH	0x8	</span><span class="cm">/* Select upper half of registers */</span><span class="cp"></span>
<span class="cp">#define	RES_EXT_INT	0x10	</span><span class="cm">/* Reset Ext. Status Interrupts */</span><span class="cp"></span>
<span class="cp">#define	SEND_ABORT	0x18	</span><span class="cm">/* HDLC Abort */</span><span class="cp"></span>
<span class="cp">#define	RES_RxINT_FC	0x20	</span><span class="cm">/* Reset RxINT on First Character */</span><span class="cp"></span>
<span class="cp">#define	RES_Tx_P	0x28	</span><span class="cm">/* Reset TxINT Pending */</span><span class="cp"></span>
<span class="cp">#define	ERR_RES		0x30	</span><span class="cm">/* Error Reset */</span><span class="cp"></span>
<span class="cp">#define	RES_H_IUS	0x38	</span><span class="cm">/* Reset highest IUS */</span><span class="cp"></span>

<span class="cp">#define	RES_Rx_CRC	0x40	</span><span class="cm">/* Reset Rx CRC Checker */</span><span class="cp"></span>
<span class="cp">#define	RES_Tx_CRC	0x80	</span><span class="cm">/* Reset Tx CRC Checker */</span><span class="cp"></span>
<span class="cp">#define	RES_EOM_L	0xC0	</span><span class="cm">/* Reset EOM latch */</span><span class="cp"></span>

<span class="cm">/* Write Register 1 */</span>

<span class="cp">#define	EXT_INT_ENAB	0x1	</span><span class="cm">/* Ext Int Enable */</span><span class="cp"></span>
<span class="cp">#define	TxINT_ENAB	0x2	</span><span class="cm">/* Tx Int Enable */</span><span class="cp"></span>
<span class="cp">#define	PAR_SPEC	0x4	</span><span class="cm">/* Parity is special condition */</span><span class="cp"></span>

<span class="cp">#define	RxINT_DISAB	0	</span><span class="cm">/* Rx Int Disable */</span><span class="cp"></span>
<span class="cp">#define	RxINT_FCERR	0x8	</span><span class="cm">/* Rx Int on First Character Only or Error */</span><span class="cp"></span>
<span class="cp">#define	INT_ALL_Rx	0x10	</span><span class="cm">/* Int on all Rx Characters or error */</span><span class="cp"></span>
<span class="cp">#define	INT_ERR_Rx	0x18	</span><span class="cm">/* Int on error only */</span><span class="cp"></span>
<span class="cp">#define RxINT_MASK	0x18</span>

<span class="cp">#define	WT_RDY_RT	0x20	</span><span class="cm">/* W/Req reflects recv if 1, xmit if 0 */</span><span class="cp"></span>
<span class="cp">#define	WT_FN_RDYFN	0x40	</span><span class="cm">/* W/Req pin is DMA request if 1, wait if 0 */</span><span class="cp"></span>
<span class="cp">#define	WT_RDY_ENAB	0x80	</span><span class="cm">/* Enable W/Req pin */</span><span class="cp"></span>

<span class="cm">/* Write Register #2 (Interrupt Vector) */</span>

<span class="cm">/* Write Register 3 */</span>

<span class="cp">#define	RxENABLE	0x1	</span><span class="cm">/* Rx Enable */</span><span class="cp"></span>
<span class="cp">#define	SYNC_L_INH	0x2	</span><span class="cm">/* Sync Character Load Inhibit */</span><span class="cp"></span>
<span class="cp">#define	ADD_SM		0x4	</span><span class="cm">/* Address Search Mode (SDLC) */</span><span class="cp"></span>
<span class="cp">#define	RxCRC_ENAB	0x8	</span><span class="cm">/* Rx CRC Enable */</span><span class="cp"></span>
<span class="cp">#define	ENT_HM		0x10	</span><span class="cm">/* Enter Hunt Mode */</span><span class="cp"></span>
<span class="cp">#define	AUTO_ENAB	0x20	</span><span class="cm">/* Auto Enables */</span><span class="cp"></span>
<span class="cp">#define	Rx5		0x0	</span><span class="cm">/* Rx 5 Bits/Character */</span><span class="cp"></span>
<span class="cp">#define	Rx7		0x40	</span><span class="cm">/* Rx 7 Bits/Character */</span><span class="cp"></span>
<span class="cp">#define	Rx6		0x80	</span><span class="cm">/* Rx 6 Bits/Character */</span><span class="cp"></span>
<span class="cp">#define	Rx8		0xc0	</span><span class="cm">/* Rx 8 Bits/Character */</span><span class="cp"></span>
<span class="cp">#define RxN_MASK	0xc0</span>

<span class="cm">/* Write Register 4 */</span>

<span class="cp">#define	PAR_ENAB	0x1	</span><span class="cm">/* Parity Enable */</span><span class="cp"></span>
<span class="cp">#define	PAR_EVEN	0x2	</span><span class="cm">/* Parity Even/Odd* */</span><span class="cp"></span>

<span class="cp">#define	SYNC_ENAB	0	</span><span class="cm">/* Sync Modes Enable */</span><span class="cp"></span>
<span class="cp">#define	SB1		0x4	</span><span class="cm">/* 1 stop bit/char */</span><span class="cp"></span>
<span class="cp">#define	SB15		0x8	</span><span class="cm">/* 1.5 stop bits/char */</span><span class="cp"></span>
<span class="cp">#define	SB2		0xc	</span><span class="cm">/* 2 stop bits/char */</span><span class="cp"></span>
<span class="cp">#define SB_MASK		0xc</span>

<span class="cp">#define	MONSYNC		0	</span><span class="cm">/* 8 Bit Sync character */</span><span class="cp"></span>
<span class="cp">#define	BISYNC		0x10	</span><span class="cm">/* 16 bit sync character */</span><span class="cp"></span>
<span class="cp">#define	SDLC		0x20	</span><span class="cm">/* SDLC Mode (01111110 Sync Flag) */</span><span class="cp"></span>
<span class="cp">#define	EXTSYNC		0x30	</span><span class="cm">/* External Sync Mode */</span><span class="cp"></span>

<span class="cp">#define	X1CLK		0x0	</span><span class="cm">/* x1 clock mode */</span><span class="cp"></span>
<span class="cp">#define	X16CLK		0x40	</span><span class="cm">/* x16 clock mode */</span><span class="cp"></span>
<span class="cp">#define	X32CLK		0x80	</span><span class="cm">/* x32 clock mode */</span><span class="cp"></span>
<span class="cp">#define	X64CLK		0xC0	</span><span class="cm">/* x64 clock mode */</span><span class="cp"></span>
<span class="cp">#define XCLK_MASK	0xC0</span>

<span class="cm">/* Write Register 5 */</span>

<span class="cp">#define	TxCRC_ENAB	0x1	</span><span class="cm">/* Tx CRC Enable */</span><span class="cp"></span>
<span class="cp">#define	RTS		0x2	</span><span class="cm">/* RTS */</span><span class="cp"></span>
<span class="cp">#define	SDLC_CRC	0x4	</span><span class="cm">/* SDLC/CRC-16 */</span><span class="cp"></span>
<span class="cp">#define	TxENABLE	0x8	</span><span class="cm">/* Tx Enable */</span><span class="cp"></span>
<span class="cp">#define	SND_BRK		0x10	</span><span class="cm">/* Send Break */</span><span class="cp"></span>
<span class="cp">#define	Tx5		0x0	</span><span class="cm">/* Tx 5 bits (or less)/character */</span><span class="cp"></span>
<span class="cp">#define	Tx7		0x20	</span><span class="cm">/* Tx 7 bits/character */</span><span class="cp"></span>
<span class="cp">#define	Tx6		0x40	</span><span class="cm">/* Tx 6 bits/character */</span><span class="cp"></span>
<span class="cp">#define	Tx8		0x60	</span><span class="cm">/* Tx 8 bits/character */</span><span class="cp"></span>
<span class="cp">#define TxN_MASK	0x60</span>
<span class="cp">#define	DTR		0x80	</span><span class="cm">/* DTR */</span><span class="cp"></span>

<span class="cm">/* Write Register 6 (Sync bits 0-7/SDLC Address Field) */</span>

<span class="cm">/* Write Register 7 (Sync bits 8-15/SDLC 01111110) */</span>

<span class="cm">/* Write Register 7&#39; (Some enhanced feature control) */</span>
<span class="cp">#define	ENEXREAD	0x40	</span><span class="cm">/* Enable read of some write registers */</span><span class="cp"></span>

<span class="cm">/* Write Register 8 (transmit buffer) */</span>

<span class="cm">/* Write Register 9 (Master interrupt control) */</span>
<span class="cp">#define	VIS	1	</span><span class="cm">/* Vector Includes Status */</span><span class="cp"></span>
<span class="cp">#define	NV	2	</span><span class="cm">/* No Vector */</span><span class="cp"></span>
<span class="cp">#define	DLC	4	</span><span class="cm">/* Disable Lower Chain */</span><span class="cp"></span>
<span class="cp">#define	MIE	8	</span><span class="cm">/* Master Interrupt Enable */</span><span class="cp"></span>
<span class="cp">#define	STATHI	0x10	</span><span class="cm">/* Status high */</span><span class="cp"></span>
<span class="cp">#define	NORESET	0	</span><span class="cm">/* No reset on write to R9 */</span><span class="cp"></span>
<span class="cp">#define	CHRB	0x40	</span><span class="cm">/* Reset channel B */</span><span class="cp"></span>
<span class="cp">#define	CHRA	0x80	</span><span class="cm">/* Reset channel A */</span><span class="cp"></span>
<span class="cp">#define	FHWRES	0xc0	</span><span class="cm">/* Force hardware reset */</span><span class="cp"></span>

<span class="cm">/* Write Register 10 (misc control bits) */</span>
<span class="cp">#define	BIT6	1	</span><span class="cm">/* 6 bit/8bit sync */</span><span class="cp"></span>
<span class="cp">#define	LOOPMODE 2	</span><span class="cm">/* SDLC Loop mode */</span><span class="cp"></span>
<span class="cp">#define	ABUNDER	4	</span><span class="cm">/* Abort/flag on SDLC xmit underrun */</span><span class="cp"></span>
<span class="cp">#define	MARKIDLE 8	</span><span class="cm">/* Mark/flag on idle */</span><span class="cp"></span>
<span class="cp">#define	GAOP	0x10	</span><span class="cm">/* Go active on poll */</span><span class="cp"></span>
<span class="cp">#define	NRZ	0	</span><span class="cm">/* NRZ mode */</span><span class="cp"></span>
<span class="cp">#define	NRZI	0x20	</span><span class="cm">/* NRZI mode */</span><span class="cp"></span>
<span class="cp">#define	FM1	0x40	</span><span class="cm">/* FM1 (transition = 1) */</span><span class="cp"></span>
<span class="cp">#define	FM0	0x60	</span><span class="cm">/* FM0 (transition = 0) */</span><span class="cp"></span>
<span class="cp">#define	CRCPS	0x80	</span><span class="cm">/* CRC Preset I/O */</span><span class="cp"></span>

<span class="cm">/* Write Register 11 (Clock Mode control) */</span>
<span class="cp">#define	TRxCXT	0	</span><span class="cm">/* TRxC = Xtal output */</span><span class="cp"></span>
<span class="cp">#define	TRxCTC	1	</span><span class="cm">/* TRxC = Transmit clock */</span><span class="cp"></span>
<span class="cp">#define	TRxCBR	2	</span><span class="cm">/* TRxC = BR Generator Output */</span><span class="cp"></span>
<span class="cp">#define	TRxCDP	3	</span><span class="cm">/* TRxC = DPLL output */</span><span class="cp"></span>
<span class="cp">#define	TRxCOI	4	</span><span class="cm">/* TRxC O/I */</span><span class="cp"></span>
<span class="cp">#define	TCRTxCP	0	</span><span class="cm">/* Transmit clock = RTxC pin */</span><span class="cp"></span>
<span class="cp">#define	TCTRxCP	8	</span><span class="cm">/* Transmit clock = TRxC pin */</span><span class="cp"></span>
<span class="cp">#define	TCBR	0x10	</span><span class="cm">/* Transmit clock = BR Generator output */</span><span class="cp"></span>
<span class="cp">#define	TCDPLL	0x18	</span><span class="cm">/* Transmit clock = DPLL output */</span><span class="cp"></span>
<span class="cp">#define	RCRTxCP	0	</span><span class="cm">/* Receive clock = RTxC pin */</span><span class="cp"></span>
<span class="cp">#define	RCTRxCP	0x20	</span><span class="cm">/* Receive clock = TRxC pin */</span><span class="cp"></span>
<span class="cp">#define	RCBR	0x40	</span><span class="cm">/* Receive clock = BR Generator output */</span><span class="cp"></span>
<span class="cp">#define	RCDPLL	0x60	</span><span class="cm">/* Receive clock = DPLL output */</span><span class="cp"></span>
<span class="cp">#define	RTxCX	0x80	</span><span class="cm">/* RTxC Xtal/No Xtal */</span><span class="cp"></span>

<span class="cm">/* Write Register 12 (lower byte of baud rate generator time constant) */</span>

<span class="cm">/* Write Register 13 (upper byte of baud rate generator time constant) */</span>

<span class="cm">/* Write Register 14 (Misc control bits) */</span>
<span class="cp">#define	BRENAB	1	</span><span class="cm">/* Baud rate generator enable */</span><span class="cp"></span>
<span class="cp">#define	BRSRC	2	</span><span class="cm">/* Baud rate generator source */</span><span class="cp"></span>
<span class="cp">#define	DTRREQ	4	</span><span class="cm">/* DTR/Request function */</span><span class="cp"></span>
<span class="cp">#define	AUTOECHO 8	</span><span class="cm">/* Auto Echo */</span><span class="cp"></span>
<span class="cp">#define	LOOPBAK	0x10	</span><span class="cm">/* Local loopback */</span><span class="cp"></span>
<span class="cp">#define	SEARCH	0x20	</span><span class="cm">/* Enter search mode */</span><span class="cp"></span>
<span class="cp">#define	RMC	0x40	</span><span class="cm">/* Reset missing clock */</span><span class="cp"></span>
<span class="cp">#define	DISDPLL	0x60	</span><span class="cm">/* Disable DPLL */</span><span class="cp"></span>
<span class="cp">#define	SSBR	0x80	</span><span class="cm">/* Set DPLL source = BR generator */</span><span class="cp"></span>
<span class="cp">#define	SSRTxC	0xa0	</span><span class="cm">/* Set DPLL source = RTxC */</span><span class="cp"></span>
<span class="cp">#define	SFMM	0xc0	</span><span class="cm">/* Set FM mode */</span><span class="cp"></span>
<span class="cp">#define	SNRZI	0xe0	</span><span class="cm">/* Set NRZI mode */</span><span class="cp"></span>

<span class="cm">/* Write Register 15 (external/status interrupt control) */</span>
<span class="cp">#define	EN85C30	1	</span><span class="cm">/* Enable some 85c30-enhanced registers */</span><span class="cp"></span>
<span class="cp">#define	ZCIE	2	</span><span class="cm">/* Zero count IE */</span><span class="cp"></span>
<span class="cp">#define	ENSTFIFO 4	</span><span class="cm">/* Enable status FIFO (SDLC) */</span><span class="cp"></span>
<span class="cp">#define	DCDIE	8	</span><span class="cm">/* DCD IE */</span><span class="cp"></span>
<span class="cp">#define	SYNCIE	0x10	</span><span class="cm">/* Sync/hunt IE */</span><span class="cp"></span>
<span class="cp">#define	CTSIE	0x20	</span><span class="cm">/* CTS IE */</span><span class="cp"></span>
<span class="cp">#define	TxUIE	0x40	</span><span class="cm">/* Tx Underrun/EOM IE */</span><span class="cp"></span>
<span class="cp">#define	BRKIE	0x80	</span><span class="cm">/* Break/Abort IE */</span><span class="cp"></span>


<span class="cm">/* Read Register 0 */</span>
<span class="cp">#define	Rx_CH_AV	0x1	</span><span class="cm">/* Rx Character Available */</span><span class="cp"></span>
<span class="cp">#define	ZCOUNT		0x2	</span><span class="cm">/* Zero count */</span><span class="cp"></span>
<span class="cp">#define	Tx_BUF_EMP	0x4	</span><span class="cm">/* Tx Buffer empty */</span><span class="cp"></span>
<span class="cp">#define	DCD		0x8	</span><span class="cm">/* DCD */</span><span class="cp"></span>
<span class="cp">#define	SYNC_HUNT	0x10	</span><span class="cm">/* Sync/hunt */</span><span class="cp"></span>
<span class="cp">#define	CTS		0x20	</span><span class="cm">/* CTS */</span><span class="cp"></span>
<span class="cp">#define	TxEOM		0x40	</span><span class="cm">/* Tx underrun */</span><span class="cp"></span>
<span class="cp">#define	BRK_ABRT	0x80	</span><span class="cm">/* Break/Abort */</span><span class="cp"></span>

<span class="cm">/* Read Register 1 */</span>
<span class="cp">#define	ALL_SNT		0x1	</span><span class="cm">/* All sent */</span><span class="cp"></span>
<span class="cm">/* Residue Data for 8 Rx bits/char programmed */</span>
<span class="cp">#define	RES3		0x8	</span><span class="cm">/* 0/3 */</span><span class="cp"></span>
<span class="cp">#define	RES4		0x4	</span><span class="cm">/* 0/4 */</span><span class="cp"></span>
<span class="cp">#define	RES5		0xc	</span><span class="cm">/* 0/5 */</span><span class="cp"></span>
<span class="cp">#define	RES6		0x2	</span><span class="cm">/* 0/6 */</span><span class="cp"></span>
<span class="cp">#define	RES7		0xa	</span><span class="cm">/* 0/7 */</span><span class="cp"></span>
<span class="cp">#define	RES8		0x6	</span><span class="cm">/* 0/8 */</span><span class="cp"></span>
<span class="cp">#define	RES18		0xe	</span><span class="cm">/* 1/8 */</span><span class="cp"></span>
<span class="cp">#define	RES28		0x0	</span><span class="cm">/* 2/8 */</span><span class="cp"></span>
<span class="cm">/* Special Rx Condition Interrupts */</span>
<span class="cp">#define	PAR_ERR		0x10	</span><span class="cm">/* Parity error */</span><span class="cp"></span>
<span class="cp">#define	Rx_OVR		0x20	</span><span class="cm">/* Rx Overrun Error */</span><span class="cp"></span>
<span class="cp">#define	CRC_ERR		0x40	</span><span class="cm">/* CRC/Framing Error */</span><span class="cp"></span>
<span class="cp">#define	END_FR		0x80	</span><span class="cm">/* End of Frame (SDLC) */</span><span class="cp"></span>

<span class="cm">/* Read Register 2 (channel b only) - Interrupt vector */</span>
<span class="cp">#define	CHB_Tx_EMPTY	0x00</span>
<span class="cp">#define	CHB_EXT_STAT	0x02</span>
<span class="cp">#define	CHB_Rx_AVAIL	0x04</span>
<span class="cp">#define	CHB_SPECIAL	0x06</span>
<span class="cp">#define	CHA_Tx_EMPTY	0x08</span>
<span class="cp">#define	CHA_EXT_STAT	0x0a</span>
<span class="cp">#define	CHA_Rx_AVAIL	0x0c</span>
<span class="cp">#define	CHA_SPECIAL	0x0e</span>
<span class="cp">#define	STATUS_MASK	0x06</span>

<span class="cm">/* Read Register 3 (interrupt pending register) ch a only */</span>
<span class="cp">#define	CHBEXT	0x1		</span><span class="cm">/* Channel B Ext/Stat IP */</span><span class="cp"></span>
<span class="cp">#define	CHBTxIP	0x2		</span><span class="cm">/* Channel B Tx IP */</span><span class="cp"></span>
<span class="cp">#define	CHBRxIP	0x4		</span><span class="cm">/* Channel B Rx IP */</span><span class="cp"></span>
<span class="cp">#define	CHAEXT	0x8		</span><span class="cm">/* Channel A Ext/Stat IP */</span><span class="cp"></span>
<span class="cp">#define	CHATxIP	0x10		</span><span class="cm">/* Channel A Tx IP */</span><span class="cp"></span>
<span class="cp">#define	CHARxIP	0x20		</span><span class="cm">/* Channel A Rx IP */</span><span class="cp"></span>

<span class="cm">/* Read Register 8 (receive data register) */</span>

<span class="cm">/* Read Register 10  (misc status bits) */</span>
<span class="cp">#define	ONLOOP	2		</span><span class="cm">/* On loop */</span><span class="cp"></span>
<span class="cp">#define	LOOPSEND 0x10		</span><span class="cm">/* Loop sending */</span><span class="cp"></span>
<span class="cp">#define	CLK2MIS	0x40		</span><span class="cm">/* Two clocks missing */</span><span class="cp"></span>
<span class="cp">#define	CLK1MIS	0x80		</span><span class="cm">/* One clock missing */</span><span class="cp"></span>

<span class="cm">/* Read Register 12 (lower byte of baud rate generator constant) */</span>

<span class="cm">/* Read Register 13 (upper byte of baud rate generator constant) */</span>

<span class="cm">/* Read Register 15 (value of WR 15) */</span>

<span class="cm">/* Misc macros */</span>
<span class="cp">#define ZS_CLEARERR(port)    (write_zsreg(port, 0, ERR_RES))</span>
<span class="cp">#define ZS_CLEARFIFO(port)   do { volatile unsigned char garbage; \</span>
<span class="cp">				     garbage = read_zsdata(port); \</span>
<span class="cp">				     garbage = read_zsdata(port); \</span>
<span class="cp">				     garbage = read_zsdata(port); \</span>
<span class="cp">				} while(0)</span>

<span class="cp">#define ZS_IS_CONS(UP)			((UP)-&gt;flags &amp; PMACZILOG_FLAG_IS_CONS)</span>
<span class="cp">#define ZS_IS_KGDB(UP)			((UP)-&gt;flags &amp; PMACZILOG_FLAG_IS_KGDB)</span>
<span class="cp">#define ZS_IS_CHANNEL_A(UP)		((UP)-&gt;flags &amp; PMACZILOG_FLAG_IS_CHANNEL_A)</span>
<span class="cp">#define ZS_REGS_HELD(UP)		((UP)-&gt;flags &amp; PMACZILOG_FLAG_REGS_HELD)</span>
<span class="cp">#define ZS_TX_STOPPED(UP)		((UP)-&gt;flags &amp; PMACZILOG_FLAG_TX_STOPPED)</span>
<span class="cp">#define ZS_TX_ACTIVE(UP)		((UP)-&gt;flags &amp; PMACZILOG_FLAG_TX_ACTIVE)</span>
<span class="cp">#define ZS_WANTS_MODEM_STATUS(UP)	((UP)-&gt;flags &amp; PMACZILOG_FLAG_MODEM_STATUS)</span>
<span class="cp">#define ZS_IS_IRDA(UP)			((UP)-&gt;flags &amp; PMACZILOG_FLAG_IS_IRDA)</span>
<span class="cp">#define ZS_IS_INTMODEM(UP)		((UP)-&gt;flags &amp; PMACZILOG_FLAG_IS_INTMODEM)</span>
<span class="cp">#define ZS_HAS_DMA(UP)			((UP)-&gt;flags &amp; PMACZILOG_FLAG_HAS_DMA)</span>
<span class="cp">#define ZS_IS_OPEN(UP)			((UP)-&gt;flags &amp; PMACZILOG_FLAG_IS_OPEN)</span>
<span class="cp">#define ZS_IS_EXTCLK(UP)		((UP)-&gt;flags &amp; PMACZILOG_FLAG_IS_EXTCLK)</span>

<span class="cp">#endif </span><span class="cm">/* __PMAC_ZILOG_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
