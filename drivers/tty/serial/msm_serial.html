<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › tty › serial › msm_serial.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>msm_serial.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) 2007 Google, Inc.</span>
<span class="cm"> * Author: Robert Love &lt;rlove@google.com&gt;</span>
<span class="cm"> * Copyright (c) 2011, Code Aurora Forum. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software is licensed under the terms of the GNU General Public</span>
<span class="cm"> * License version 2, as published by the Free Software Foundation, and</span>
<span class="cm"> * may be copied, distributed, and modified under those terms.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __DRIVERS_SERIAL_MSM_SERIAL_H</span>
<span class="cp">#define __DRIVERS_SERIAL_MSM_SERIAL_H</span>

<span class="cp">#define UART_MR1			0x0000</span>

<span class="cp">#define UART_MR1_AUTO_RFR_LEVEL0	0x3F</span>
<span class="cp">#define UART_MR1_AUTO_RFR_LEVEL1	0x3FF00</span>
<span class="cp">#define UART_MR1_RX_RDY_CTL    		(1 &lt;&lt; 7)</span>
<span class="cp">#define UART_MR1_CTS_CTL       		(1 &lt;&lt; 6)</span>

<span class="cp">#define UART_MR2			0x0004</span>
<span class="cp">#define UART_MR2_ERROR_MODE		(1 &lt;&lt; 6)</span>
<span class="cp">#define UART_MR2_BITS_PER_CHAR		0x30</span>
<span class="cp">#define UART_MR2_BITS_PER_CHAR_5	(0x0 &lt;&lt; 4)</span>
<span class="cp">#define UART_MR2_BITS_PER_CHAR_6	(0x1 &lt;&lt; 4)</span>
<span class="cp">#define UART_MR2_BITS_PER_CHAR_7	(0x2 &lt;&lt; 4)</span>
<span class="cp">#define UART_MR2_BITS_PER_CHAR_8	(0x3 &lt;&lt; 4)</span>
<span class="cp">#define UART_MR2_STOP_BIT_LEN_ONE	(0x1 &lt;&lt; 2)</span>
<span class="cp">#define UART_MR2_STOP_BIT_LEN_TWO	(0x3 &lt;&lt; 2)</span>
<span class="cp">#define UART_MR2_PARITY_MODE_NONE	0x0</span>
<span class="cp">#define UART_MR2_PARITY_MODE_ODD	0x1</span>
<span class="cp">#define UART_MR2_PARITY_MODE_EVEN	0x2</span>
<span class="cp">#define UART_MR2_PARITY_MODE_SPACE	0x3</span>
<span class="cp">#define UART_MR2_PARITY_MODE		0x3</span>

<span class="cp">#define UART_CSR	0x0008</span>
<span class="cp">#define UART_CSR_115200	0xFF</span>
<span class="cp">#define UART_CSR_57600	0xEE</span>
<span class="cp">#define UART_CSR_38400	0xDD</span>
<span class="cp">#define UART_CSR_28800	0xCC</span>
<span class="cp">#define UART_CSR_19200	0xBB</span>
<span class="cp">#define UART_CSR_14400	0xAA</span>
<span class="cp">#define UART_CSR_9600	0x99</span>
<span class="cp">#define UART_CSR_4800	0x77</span>
<span class="cp">#define UART_CSR_2400	0x55</span>
<span class="cp">#define UART_CSR_1200	0x44</span>
<span class="cp">#define UART_CSR_600	0x33</span>
<span class="cp">#define UART_CSR_300	0x22</span>

<span class="cp">#define UART_TF		0x000C</span>
<span class="cp">#define UARTDM_TF	0x0070</span>

<span class="cp">#define UART_CR				0x0010</span>
<span class="cp">#define UART_CR_CMD_NULL		(0 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_RESET_RX		(1 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_RESET_TX		(2 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_RESET_ERR		(3 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_RESET_BREAK_INT	(4 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_START_BREAK		(5 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_STOP_BREAK		(6 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_RESET_CTS		(7 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_RESET_STALE_INT	(8 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_PACKET_MODE		(9 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_MODE_RESET		(12 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_SET_RFR		(13 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_RESET_RFR		(14 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_PROTECTION_EN	(16 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_CMD_STALE_EVENT_ENABLE	(80 &lt;&lt; 4)</span>
<span class="cp">#define UART_CR_TX_DISABLE		(1 &lt;&lt; 3)</span>
<span class="cp">#define UART_CR_TX_ENABLE		(1 &lt;&lt; 2)</span>
<span class="cp">#define UART_CR_RX_DISABLE		(1 &lt;&lt; 1)</span>
<span class="cp">#define UART_CR_RX_ENABLE		(1 &lt;&lt; 0)</span>

<span class="cp">#define UART_IMR		0x0014</span>
<span class="cp">#define UART_IMR_TXLEV		(1 &lt;&lt; 0)</span>
<span class="cp">#define UART_IMR_RXSTALE	(1 &lt;&lt; 3)</span>
<span class="cp">#define UART_IMR_RXLEV		(1 &lt;&lt; 4)</span>
<span class="cp">#define UART_IMR_DELTA_CTS	(1 &lt;&lt; 5)</span>
<span class="cp">#define UART_IMR_CURRENT_CTS	(1 &lt;&lt; 6)</span>

<span class="cp">#define UART_IPR_RXSTALE_LAST		0x20</span>
<span class="cp">#define UART_IPR_STALE_LSB		0x1F</span>
<span class="cp">#define UART_IPR_STALE_TIMEOUT_MSB	0x3FF80</span>

<span class="cp">#define UART_IPR	0x0018</span>
<span class="cp">#define UART_TFWR	0x001C</span>
<span class="cp">#define UART_RFWR	0x0020</span>
<span class="cp">#define UART_HCR	0x0024</span>

<span class="cp">#define UART_MREG		0x0028</span>
<span class="cp">#define UART_NREG		0x002C</span>
<span class="cp">#define UART_DREG		0x0030</span>
<span class="cp">#define UART_MNDREG		0x0034</span>
<span class="cp">#define UART_IRDA		0x0038</span>
<span class="cp">#define UART_MISR_MODE		0x0040</span>
<span class="cp">#define UART_MISR_RESET		0x0044</span>
<span class="cp">#define UART_MISR_EXPORT	0x0048</span>
<span class="cp">#define UART_MISR_VAL		0x004C</span>
<span class="cp">#define UART_TEST_CTRL		0x0050</span>

<span class="cp">#define UART_SR			0x0008</span>
<span class="cp">#define UART_SR_HUNT_CHAR	(1 &lt;&lt; 7)</span>
<span class="cp">#define UART_SR_RX_BREAK	(1 &lt;&lt; 6)</span>
<span class="cp">#define UART_SR_PAR_FRAME_ERR	(1 &lt;&lt; 5)</span>
<span class="cp">#define UART_SR_OVERRUN		(1 &lt;&lt; 4)</span>
<span class="cp">#define UART_SR_TX_EMPTY	(1 &lt;&lt; 3)</span>
<span class="cp">#define UART_SR_TX_READY	(1 &lt;&lt; 2)</span>
<span class="cp">#define UART_SR_RX_FULL		(1 &lt;&lt; 1)</span>
<span class="cp">#define UART_SR_RX_READY	(1 &lt;&lt; 0)</span>

<span class="cp">#define UART_RF			0x000C</span>
<span class="cp">#define UARTDM_RF		0x0070</span>
<span class="cp">#define UART_MISR		0x0010</span>
<span class="cp">#define UART_ISR		0x0014</span>
<span class="cp">#define UART_ISR_TX_READY	(1 &lt;&lt; 7)</span>

<span class="cp">#define GSBI_CONTROL		0x0</span>
<span class="cp">#define GSBI_PROTOCOL_CODE	0x30</span>
<span class="cp">#define GSBI_PROTOCOL_UART	0x40</span>
<span class="cp">#define GSBI_PROTOCOL_IDLE	0x0</span>

<span class="cp">#define UARTDM_DMRX		0x34</span>
<span class="cp">#define UARTDM_NCF_TX		0x40</span>
<span class="cp">#define UARTDM_RX_TOTAL_SNAP	0x38</span>

<span class="cp">#define UART_TO_MSM(uart_port)	((struct msm_port *) uart_port)</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">void</span> <span class="nf">msm_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">uart_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">off</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">membase</span> <span class="o">+</span> <span class="n">off</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">msm_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">uart_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">off</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">membase</span> <span class="o">+</span> <span class="n">off</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Setup the MND registers to use the TCXO clock.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">msm_serial_set_mnd_regs_tcxo</span><span class="p">(</span><span class="k">struct</span> <span class="n">uart_port</span> <span class="o">*</span><span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">msm_write</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="n">UART_MREG</span><span class="p">);</span>
	<span class="n">msm_write</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mh">0xF1</span><span class="p">,</span> <span class="n">UART_NREG</span><span class="p">);</span>
	<span class="n">msm_write</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="n">UART_DREG</span><span class="p">);</span>
	<span class="n">msm_write</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">,</span> <span class="n">UART_MNDREG</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Setup the MND registers to use the TCXO clock divided by 4.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">msm_serial_set_mnd_regs_tcxoby4</span><span class="p">(</span><span class="k">struct</span> <span class="n">uart_port</span> <span class="o">*</span><span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">msm_write</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="n">UART_MREG</span><span class="p">);</span>
	<span class="n">msm_write</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mh">0xF6</span><span class="p">,</span> <span class="n">UART_NREG</span><span class="p">);</span>
	<span class="n">msm_write</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="n">UART_DREG</span><span class="p">);</span>
	<span class="n">msm_write</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="n">UART_MNDREG</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">void</span> <span class="nf">msm_serial_set_mnd_regs_from_uartclk</span><span class="p">(</span><span class="k">struct</span> <span class="n">uart_port</span> <span class="o">*</span><span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">uartclk</span> <span class="o">==</span> <span class="mi">19200000</span><span class="p">)</span>
		<span class="n">msm_serial_set_mnd_regs_tcxo</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">msm_serial_set_mnd_regs_tcxoby4</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * TROUT has a specific defect that makes it report it&#39;s uartclk</span>
<span class="cm"> * as 19.2Mhz (TCXO) when it&#39;s actually 4.8Mhz (TCXO/4). This special</span>
<span class="cm"> * cases TROUT to use the right clock.</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_MACH_TROUT</span>
<span class="cp">#define msm_serial_set_mnd_regs msm_serial_set_mnd_regs_tcxoby4</span>
<span class="cp">#else</span>
<span class="cp">#define msm_serial_set_mnd_regs msm_serial_set_mnd_regs_from_uartclk</span>
<span class="cp">#endif</span>

<span class="cp">#endif	</span><span class="cm">/* __DRIVERS_SERIAL_MSM_SERIAL_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
