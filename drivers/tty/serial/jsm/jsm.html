<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › tty › serial › jsm › jsm.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>jsm.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/************************************************************************</span>
<span class="cm"> * Copyright 2003 Digi International (www.digi.com)</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2004 IBM Corporation. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2, or (at your option)</span>
<span class="cm"> * any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY, EXPRESS OR IMPLIED; without even the</span>
<span class="cm"> * implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span>
<span class="cm"> * PURPOSE.  See the GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 * Temple Place - Suite 330, Boston,</span>
<span class="cm"> * MA  02111-1307, USA.</span>
<span class="cm"> *</span>
<span class="cm"> * Contact Information:</span>
<span class="cm"> * Scott H Kilau &lt;Scott_Kilau@digi.com&gt;</span>
<span class="cm"> * Wendy Xiong   &lt;wendyx@us.ibm.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> ***********************************************************************/</span>

<span class="cp">#ifndef __JSM_DRIVER_H</span>
<span class="cp">#define __JSM_DRIVER_H</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;	</span><span class="cm">/* To pick up the varions Linux types */</span><span class="cp"></span>
<span class="cp">#include &lt;linux/tty.h&gt;</span>
<span class="cp">#include &lt;linux/serial_core.h&gt;</span>
<span class="cp">#include &lt;linux/device.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Debugging levels can be set using debug insmod variable</span>
<span class="cm"> * They can also be compiled out completely.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">DBG_INIT</span>	<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">DBG_BASIC</span>	<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">DBG_CORE</span>	<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">DBG_OPEN</span>	<span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">DBG_CLOSE</span>	<span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">DBG_READ</span>	<span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">DBG_WRITE</span>	<span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="n">DBG_IOCTL</span>	<span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="n">DBG_PROC</span>	<span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>
	<span class="n">DBG_PARAM</span>	<span class="o">=</span> <span class="mh">0x200</span><span class="p">,</span>
	<span class="n">DBG_PSCAN</span>	<span class="o">=</span> <span class="mh">0x400</span><span class="p">,</span>
	<span class="n">DBG_EVENT</span>	<span class="o">=</span> <span class="mh">0x800</span><span class="p">,</span>
	<span class="n">DBG_DRAIN</span>	<span class="o">=</span> <span class="mh">0x1000</span><span class="p">,</span>
	<span class="n">DBG_MSIGS</span>	<span class="o">=</span> <span class="mh">0x2000</span><span class="p">,</span>
	<span class="n">DBG_MGMT</span>	<span class="o">=</span> <span class="mh">0x4000</span><span class="p">,</span>
	<span class="n">DBG_INTR</span>	<span class="o">=</span> <span class="mh">0x8000</span><span class="p">,</span>
	<span class="n">DBG_CARR</span>	<span class="o">=</span> <span class="mh">0x10000</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define jsm_printk(nlevel, klevel, pdev, fmt, args...)	\</span>
<span class="cp">	if ((DBG_##nlevel &amp; jsm_debug))			\</span>
<span class="cp">	dev_printk(KERN_##klevel, pdev-&gt;dev, fmt, ## args)</span>

<span class="cp">#define	MAXLINES	256</span>
<span class="cp">#define MAXPORTS	8</span>
<span class="cp">#define MAX_STOPS_SENT	5</span>

<span class="cm">/* Board type definitions */</span>

<span class="cp">#define T_NEO		0000</span>
<span class="cp">#define T_CLASSIC	0001</span>
<span class="cp">#define T_PCIBUS	0400</span>

<span class="cm">/* Board State Definitions */</span>

<span class="cp">#define BD_RUNNING	0x0</span>
<span class="cp">#define BD_REASON	0x7f</span>
<span class="cp">#define BD_NOTFOUND	0x1</span>
<span class="cp">#define BD_NOIOPORT	0x2</span>
<span class="cp">#define BD_NOMEM	0x3</span>
<span class="cp">#define BD_NOBIOS	0x4</span>
<span class="cp">#define BD_NOFEP	0x5</span>
<span class="cp">#define BD_FAILED	0x6</span>
<span class="cp">#define BD_ALLOCATED	0x7</span>
<span class="cp">#define BD_TRIBOOT	0x8</span>
<span class="cp">#define BD_BADKME	0x80</span>


<span class="cm">/* 4 extra for alignment play space */</span>
<span class="cp">#define WRITEBUFLEN	((4096) + 4)</span>

<span class="cp">#define JSM_VERSION	&quot;jsm: 1.2-1-INKERNEL&quot;</span>
<span class="cp">#define JSM_PARTNUM	&quot;40002438_A-INKERNEL&quot;</span>

<span class="k">struct</span> <span class="n">jsm_board</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">jsm_channel</span><span class="p">;</span>

<span class="cm">/************************************************************************</span>
<span class="cm"> * Per board operations structure					*</span>
<span class="cm"> ************************************************************************/</span>
<span class="k">struct</span> <span class="n">board_ops</span> <span class="p">{</span>
	<span class="n">irq_handler_t</span> <span class="n">intr</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">uart_init</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">uart_off</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">param</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">assert_modem_signals</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">flush_uart_write</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">flush_uart_read</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">disable_receiver</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">enable_receiver</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">send_break</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">clear_break</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">send_start_character</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">send_stop_character</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">copy_data_from_queue_to_uart</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="n">u32</span> <span class="p">(</span><span class="o">*</span><span class="n">get_uart_bytes_left</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">send_immediate_char</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="p">);</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> *	Per-board information</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">jsm_board</span>
<span class="p">{</span>
	<span class="kt">int</span>		<span class="n">boardnum</span><span class="p">;</span>	<span class="cm">/* Board number: 0-32 */</span>

	<span class="kt">int</span>		<span class="n">type</span><span class="p">;</span>		<span class="cm">/* Type of board */</span>
	<span class="n">u8</span>		<span class="n">rev</span><span class="p">;</span>		<span class="cm">/* PCI revision ID */</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>	<span class="o">*</span><span class="n">pci_dev</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">maxports</span><span class="p">;</span>	<span class="cm">/* MAX ports this board can handle */</span>

	<span class="n">spinlock_t</span>	<span class="n">bd_intr_lock</span><span class="p">;</span>	<span class="cm">/* Used to protect the poller tasklet and</span>
<span class="cm">					 * the interrupt routine from each other.</span>
<span class="cm">					 */</span>

	<span class="n">u32</span>		<span class="n">nasync</span><span class="p">;</span>		<span class="cm">/* Number of ports on card */</span>

	<span class="n">u32</span>		<span class="n">irq</span><span class="p">;</span>		<span class="cm">/* Interrupt request number */</span>

	<span class="n">u64</span>		<span class="n">membase</span><span class="p">;</span>	<span class="cm">/* Start of base memory of the card */</span>
	<span class="n">u64</span>		<span class="n">membase_end</span><span class="p">;</span>	<span class="cm">/* End of base memory of the card */</span>

	<span class="n">u8</span>	<span class="n">__iomem</span> <span class="o">*</span><span class="n">re_map_membase</span><span class="p">;</span><span class="cm">/* Remapped memory of the card */</span>

	<span class="n">u64</span>		<span class="n">iobase</span><span class="p">;</span>		<span class="cm">/* Start of io base of the card */</span>
	<span class="n">u64</span>		<span class="n">iobase_end</span><span class="p">;</span>	<span class="cm">/* End of io base of the card */</span>

	<span class="n">u32</span>		<span class="n">bd_uart_offset</span><span class="p">;</span>	<span class="cm">/* Space between each UART */</span>

	<span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">channels</span><span class="p">[</span><span class="n">MAXPORTS</span><span class="p">];</span> <span class="cm">/* array of pointers to our channels. */</span>

	<span class="n">u32</span>		<span class="n">bd_dividend</span><span class="p">;</span>	<span class="cm">/* Board/UARTs specific dividend */</span>

	<span class="k">struct</span> <span class="n">board_ops</span> <span class="o">*</span><span class="n">bd_ops</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">jsm_board_entry</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/************************************************************************</span>
<span class="cm"> * Device flag definitions for ch_flags.</span>
<span class="cm"> ************************************************************************/</span>
<span class="cp">#define CH_PRON		0x0001		</span><span class="cm">/* Printer on string		*/</span><span class="cp"></span>
<span class="cp">#define CH_STOP		0x0002		</span><span class="cm">/* Output is stopped		*/</span><span class="cp"></span>
<span class="cp">#define CH_STOPI	0x0004		</span><span class="cm">/* Input is stopped		*/</span><span class="cp"></span>
<span class="cp">#define CH_CD		0x0008		</span><span class="cm">/* Carrier is present		*/</span><span class="cp"></span>
<span class="cp">#define CH_FCAR		0x0010		</span><span class="cm">/* Carrier forced on		*/</span><span class="cp"></span>
<span class="cp">#define CH_HANGUP	0x0020		</span><span class="cm">/* Hangup received		*/</span><span class="cp"></span>

<span class="cp">#define CH_RECEIVER_OFF	0x0040		</span><span class="cm">/* Receiver is off		*/</span><span class="cp"></span>
<span class="cp">#define CH_OPENING	0x0080		</span><span class="cm">/* Port in fragile open state	*/</span><span class="cp"></span>
<span class="cp">#define CH_CLOSING	0x0100		</span><span class="cm">/* Port in fragile close state	*/</span><span class="cp"></span>
<span class="cp">#define CH_FIFO_ENABLED 0x0200		</span><span class="cm">/* Port has FIFOs enabled	*/</span><span class="cp"></span>
<span class="cp">#define CH_TX_FIFO_EMPTY 0x0400		</span><span class="cm">/* TX Fifo is completely empty	*/</span><span class="cp"></span>
<span class="cp">#define CH_TX_FIFO_LWM	0x0800		</span><span class="cm">/* TX Fifo is below Low Water	*/</span><span class="cp"></span>
<span class="cp">#define CH_BREAK_SENDING 0x1000		</span><span class="cm">/* Break is being sent		*/</span><span class="cp"></span>
<span class="cp">#define CH_LOOPBACK 0x2000		</span><span class="cm">/* Channel is in lookback mode	*/</span><span class="cp"></span>
<span class="cp">#define CH_BAUD0	0x08000		</span><span class="cm">/* Used for checking B0 transitions */</span><span class="cp"></span>

<span class="cm">/* Our Read/Error/Write queue sizes */</span>
<span class="cp">#define RQUEUEMASK	0x1FFF		</span><span class="cm">/* 8 K - 1 */</span><span class="cp"></span>
<span class="cp">#define EQUEUEMASK	0x1FFF		</span><span class="cm">/* 8 K - 1 */</span><span class="cp"></span>
<span class="cp">#define RQUEUESIZE	(RQUEUEMASK + 1)</span>
<span class="cp">#define EQUEUESIZE	RQUEUESIZE</span>


<span class="cm">/************************************************************************</span>
<span class="cm"> * Channel information structure.</span>
<span class="cm"> ************************************************************************/</span>
<span class="k">struct</span> <span class="n">jsm_channel</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">uart_port</span> <span class="n">uart_port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">jsm_board</span>	<span class="o">*</span><span class="n">ch_bd</span><span class="p">;</span>		<span class="cm">/* Board structure pointer	*/</span>

	<span class="n">spinlock_t</span>	<span class="n">ch_lock</span><span class="p">;</span>	<span class="cm">/* provide for serialization */</span>
	<span class="n">wait_queue_head_t</span> <span class="n">ch_flags_wait</span><span class="p">;</span>

	<span class="n">u32</span>		<span class="n">ch_portnum</span><span class="p">;</span>	<span class="cm">/* Port number, 0 offset.	*/</span>
	<span class="n">u32</span>		<span class="n">ch_open_count</span><span class="p">;</span>	<span class="cm">/* open count			*/</span>
	<span class="n">u32</span>		<span class="n">ch_flags</span><span class="p">;</span>	<span class="cm">/* Channel flags		*/</span>

	<span class="n">u64</span>		<span class="n">ch_close_delay</span><span class="p">;</span>	<span class="cm">/* How long we should drop RTS/DTR for */</span>

	<span class="n">tcflag_t</span>	<span class="n">ch_c_iflag</span><span class="p">;</span>	<span class="cm">/* channel iflags		*/</span>
	<span class="n">tcflag_t</span>	<span class="n">ch_c_cflag</span><span class="p">;</span>	<span class="cm">/* channel cflags		*/</span>
	<span class="n">tcflag_t</span>	<span class="n">ch_c_oflag</span><span class="p">;</span>	<span class="cm">/* channel oflags		*/</span>
	<span class="n">tcflag_t</span>	<span class="n">ch_c_lflag</span><span class="p">;</span>	<span class="cm">/* channel lflags		*/</span>
	<span class="n">u8</span>		<span class="n">ch_stopc</span><span class="p">;</span>	<span class="cm">/* Stop character		*/</span>
	<span class="n">u8</span>		<span class="n">ch_startc</span><span class="p">;</span>	<span class="cm">/* Start character		*/</span>

	<span class="n">u8</span>		<span class="n">ch_mostat</span><span class="p">;</span>	<span class="cm">/* FEP output modem status	*/</span>
	<span class="n">u8</span>		<span class="n">ch_mistat</span><span class="p">;</span>	<span class="cm">/* FEP input modem status	*/</span>

	<span class="k">struct</span> <span class="n">neo_uart_struct</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ch_neo_uart</span><span class="p">;</span>	<span class="cm">/* Pointer to the &quot;mapped&quot; UART struct */</span>
	<span class="n">u8</span>		<span class="n">ch_cached_lsr</span><span class="p">;</span>	<span class="cm">/* Cached value of the LSR register */</span>

	<span class="n">u8</span>		<span class="o">*</span><span class="n">ch_rqueue</span><span class="p">;</span>	<span class="cm">/* Our read queue buffer - malloc&#39;ed */</span>
	<span class="n">u16</span>		<span class="n">ch_r_head</span><span class="p">;</span>	<span class="cm">/* Head location of the read queue */</span>
	<span class="n">u16</span>		<span class="n">ch_r_tail</span><span class="p">;</span>	<span class="cm">/* Tail location of the read queue */</span>

	<span class="n">u8</span>		<span class="o">*</span><span class="n">ch_equeue</span><span class="p">;</span>	<span class="cm">/* Our error queue buffer - malloc&#39;ed */</span>
	<span class="n">u16</span>		<span class="n">ch_e_head</span><span class="p">;</span>	<span class="cm">/* Head location of the error queue */</span>
	<span class="n">u16</span>		<span class="n">ch_e_tail</span><span class="p">;</span>	<span class="cm">/* Tail location of the error queue */</span>

	<span class="n">u64</span>		<span class="n">ch_rxcount</span><span class="p">;</span>	<span class="cm">/* total of data received so far */</span>
	<span class="n">u64</span>		<span class="n">ch_txcount</span><span class="p">;</span>	<span class="cm">/* total of data transmitted so far */</span>

	<span class="n">u8</span>		<span class="n">ch_r_tlevel</span><span class="p">;</span>	<span class="cm">/* Receive Trigger level */</span>
	<span class="n">u8</span>		<span class="n">ch_t_tlevel</span><span class="p">;</span>	<span class="cm">/* Transmit Trigger level */</span>

	<span class="n">u8</span>		<span class="n">ch_r_watermark</span><span class="p">;</span>	<span class="cm">/* Receive Watermark */</span>


	<span class="n">u32</span>		<span class="n">ch_stops_sent</span><span class="p">;</span>	<span class="cm">/* How many times I have sent a stop character</span>
<span class="cm">					 * to try to stop the other guy sending.</span>
<span class="cm">					 */</span>
	<span class="n">u64</span>		<span class="n">ch_err_parity</span><span class="p">;</span>	<span class="cm">/* Count of parity errors on channel */</span>
	<span class="n">u64</span>		<span class="n">ch_err_frame</span><span class="p">;</span>	<span class="cm">/* Count of framing errors on channel */</span>
	<span class="n">u64</span>		<span class="n">ch_err_break</span><span class="p">;</span>	<span class="cm">/* Count of breaks on channel */</span>
	<span class="n">u64</span>		<span class="n">ch_err_overrun</span><span class="p">;</span> <span class="cm">/* Count of overruns on channel */</span>

	<span class="n">u64</span>		<span class="n">ch_xon_sends</span><span class="p">;</span>	<span class="cm">/* Count of xons transmitted */</span>
	<span class="n">u64</span>		<span class="n">ch_xoff_sends</span><span class="p">;</span>	<span class="cm">/* Count of xoffs transmitted */</span>
<span class="p">};</span>


<span class="cm">/************************************************************************</span>
<span class="cm"> * Per channel/port NEO UART structure					*</span>
<span class="cm"> ************************************************************************</span>
<span class="cm"> *		Base Structure Entries Usage Meanings to Host		*</span>
<span class="cm"> *									*</span>
<span class="cm"> *	W = read write		R = read only				*</span>
<span class="cm"> *			U = Unused.					*</span>
<span class="cm"> ************************************************************************/</span>

<span class="k">struct</span> <span class="n">neo_uart_struct</span> <span class="p">{</span>
	 <span class="n">u8</span> <span class="n">txrx</span><span class="p">;</span>		<span class="cm">/* WR	RHR/THR - Holding Reg */</span>
	 <span class="n">u8</span> <span class="n">ier</span><span class="p">;</span>		<span class="cm">/* WR	IER - Interrupt Enable Reg */</span>
	 <span class="n">u8</span> <span class="n">isr_fcr</span><span class="p">;</span>		<span class="cm">/* WR	ISR/FCR - Interrupt Status Reg/Fifo Control Reg */</span>
	 <span class="n">u8</span> <span class="n">lcr</span><span class="p">;</span>		<span class="cm">/* WR	LCR - Line Control Reg */</span>
	 <span class="n">u8</span> <span class="n">mcr</span><span class="p">;</span>		<span class="cm">/* WR	MCR - Modem Control Reg */</span>
	 <span class="n">u8</span> <span class="n">lsr</span><span class="p">;</span>		<span class="cm">/* WR	LSR - Line Status Reg */</span>
	 <span class="n">u8</span> <span class="n">msr</span><span class="p">;</span>		<span class="cm">/* WR	MSR - Modem Status Reg */</span>
	 <span class="n">u8</span> <span class="n">spr</span><span class="p">;</span>		<span class="cm">/* WR	SPR - Scratch Pad Reg */</span>
	 <span class="n">u8</span> <span class="n">fctr</span><span class="p">;</span>		<span class="cm">/* WR	FCTR - Feature Control Reg */</span>
	 <span class="n">u8</span> <span class="n">efr</span><span class="p">;</span>		<span class="cm">/* WR	EFR - Enhanced Function Reg */</span>
	 <span class="n">u8</span> <span class="n">tfifo</span><span class="p">;</span>		<span class="cm">/* WR	TXCNT/TXTRG - Transmit FIFO Reg */</span>
	 <span class="n">u8</span> <span class="n">rfifo</span><span class="p">;</span>		<span class="cm">/* WR	RXCNT/RXTRG - Receive FIFO Reg */</span>
	 <span class="n">u8</span> <span class="n">xoffchar1</span><span class="p">;</span>	<span class="cm">/* WR	XOFF 1 - XOff Character 1 Reg */</span>
	 <span class="n">u8</span> <span class="n">xoffchar2</span><span class="p">;</span>	<span class="cm">/* WR	XOFF 2 - XOff Character 2 Reg */</span>
	 <span class="n">u8</span> <span class="n">xonchar1</span><span class="p">;</span>	<span class="cm">/* WR	XON 1 - Xon Character 1 Reg */</span>
	 <span class="n">u8</span> <span class="n">xonchar2</span><span class="p">;</span>	<span class="cm">/* WR	XON 2 - XOn Character 2 Reg */</span>

	 <span class="n">u8</span> <span class="n">reserved1</span><span class="p">[</span><span class="mh">0x2ff</span> <span class="o">-</span> <span class="mh">0x200</span><span class="p">];</span> <span class="cm">/* U	Reserved by Exar */</span>
	 <span class="n">u8</span> <span class="n">txrxburst</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>	<span class="cm">/* RW	64 bytes of RX/TX FIFO Data */</span>
	 <span class="n">u8</span> <span class="n">reserved2</span><span class="p">[</span><span class="mh">0x37f</span> <span class="o">-</span> <span class="mh">0x340</span><span class="p">];</span> <span class="cm">/* U	Reserved by Exar */</span>
	 <span class="n">u8</span> <span class="n">rxburst_with_errors</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>	<span class="cm">/* R	64 bytes of RX FIFO Data + LSR */</span>
<span class="p">};</span>

<span class="cm">/* Where to read the extended interrupt register (32bits instead of 8bits) */</span>
<span class="cp">#define	UART_17158_POLL_ADDR_OFFSET	0x80</span>

<span class="cm">/*</span>
<span class="cm"> * These are the redefinitions for the FCTR on the XR17C158, since</span>
<span class="cm"> * Exar made them different than their earlier design. (XR16C854)</span>
<span class="cm"> */</span>

<span class="cm">/* These are only applicable when table D is selected */</span>
<span class="cp">#define UART_17158_FCTR_RTS_NODELAY	0x00</span>
<span class="cp">#define UART_17158_FCTR_RTS_4DELAY	0x01</span>
<span class="cp">#define UART_17158_FCTR_RTS_6DELAY	0x02</span>
<span class="cp">#define UART_17158_FCTR_RTS_8DELAY	0x03</span>
<span class="cp">#define UART_17158_FCTR_RTS_12DELAY	0x12</span>
<span class="cp">#define UART_17158_FCTR_RTS_16DELAY	0x05</span>
<span class="cp">#define UART_17158_FCTR_RTS_20DELAY	0x13</span>
<span class="cp">#define UART_17158_FCTR_RTS_24DELAY	0x06</span>
<span class="cp">#define UART_17158_FCTR_RTS_28DELAY	0x14</span>
<span class="cp">#define UART_17158_FCTR_RTS_32DELAY	0x07</span>
<span class="cp">#define UART_17158_FCTR_RTS_36DELAY	0x16</span>
<span class="cp">#define UART_17158_FCTR_RTS_40DELAY	0x08</span>
<span class="cp">#define UART_17158_FCTR_RTS_44DELAY	0x09</span>
<span class="cp">#define UART_17158_FCTR_RTS_48DELAY	0x10</span>
<span class="cp">#define UART_17158_FCTR_RTS_52DELAY	0x11</span>

<span class="cp">#define UART_17158_FCTR_RTS_IRDA	0x10</span>
<span class="cp">#define UART_17158_FCTR_RS485		0x20</span>
<span class="cp">#define UART_17158_FCTR_TRGA		0x00</span>
<span class="cp">#define UART_17158_FCTR_TRGB		0x40</span>
<span class="cp">#define UART_17158_FCTR_TRGC		0x80</span>
<span class="cp">#define UART_17158_FCTR_TRGD		0xC0</span>

<span class="cm">/* 17158 trigger table selects.. */</span>
<span class="cp">#define UART_17158_FCTR_BIT6		0x40</span>
<span class="cp">#define UART_17158_FCTR_BIT7		0x80</span>

<span class="cm">/* 17158 TX/RX memmapped buffer offsets */</span>
<span class="cp">#define UART_17158_RX_FIFOSIZE		64</span>
<span class="cp">#define UART_17158_TX_FIFOSIZE		64</span>

<span class="cm">/* 17158 Extended IIR&#39;s */</span>
<span class="cp">#define UART_17158_IIR_RDI_TIMEOUT	0x0C	</span><span class="cm">/* Receiver data TIMEOUT */</span><span class="cp"></span>
<span class="cp">#define UART_17158_IIR_XONXOFF		0x10	</span><span class="cm">/* Received an XON/XOFF char */</span><span class="cp"></span>
<span class="cp">#define UART_17158_IIR_HWFLOW_STATE_CHANGE 0x20	</span><span class="cm">/* CTS/DSR or RTS/DTR state change */</span><span class="cp"></span>
<span class="cp">#define UART_17158_IIR_FIFO_ENABLED	0xC0	</span><span class="cm">/* 16550 FIFOs are Enabled */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * These are the extended interrupts that get sent</span>
<span class="cm"> * back to us from the UART&#39;s 32bit interrupt register</span>
<span class="cm"> */</span>
<span class="cp">#define UART_17158_RX_LINE_STATUS	0x1	</span><span class="cm">/* RX Ready */</span><span class="cp"></span>
<span class="cp">#define UART_17158_RXRDY_TIMEOUT	0x2	</span><span class="cm">/* RX Ready Timeout */</span><span class="cp"></span>
<span class="cp">#define UART_17158_TXRDY		0x3	</span><span class="cm">/* TX Ready */</span><span class="cp"></span>
<span class="cp">#define UART_17158_MSR			0x4	</span><span class="cm">/* Modem State Change */</span><span class="cp"></span>
<span class="cp">#define UART_17158_TX_AND_FIFO_CLR	0x40	</span><span class="cm">/* Transmitter Holding Reg Empty */</span><span class="cp"></span>
<span class="cp">#define UART_17158_RX_FIFO_DATA_ERROR	0x80	</span><span class="cm">/* UART detected an RX FIFO Data error */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * These are the EXTENDED definitions for the 17C158&#39;s Interrupt</span>
<span class="cm"> * Enable Register.</span>
<span class="cm"> */</span>
<span class="cp">#define UART_17158_EFR_ECB	0x10	</span><span class="cm">/* Enhanced control bit */</span><span class="cp"></span>
<span class="cp">#define UART_17158_EFR_IXON	0x2	</span><span class="cm">/* Receiver compares Xon1/Xoff1 */</span><span class="cp"></span>
<span class="cp">#define UART_17158_EFR_IXOFF	0x8	</span><span class="cm">/* Transmit Xon1/Xoff1 */</span><span class="cp"></span>
<span class="cp">#define UART_17158_EFR_RTSDTR	0x40	</span><span class="cm">/* Auto RTS/DTR Flow Control Enable */</span><span class="cp"></span>
<span class="cp">#define UART_17158_EFR_CTSDSR	0x80	</span><span class="cm">/* Auto CTS/DSR Flow COntrol Enable */</span><span class="cp"></span>

<span class="cp">#define UART_17158_XOFF_DETECT	0x1	</span><span class="cm">/* Indicates whether chip saw an incoming XOFF char */</span><span class="cp"></span>
<span class="cp">#define UART_17158_XON_DETECT	0x2	</span><span class="cm">/* Indicates whether chip saw an incoming XON char */</span><span class="cp"></span>

<span class="cp">#define UART_17158_IER_RSVD1	0x10	</span><span class="cm">/* Reserved by Exar */</span><span class="cp"></span>
<span class="cp">#define UART_17158_IER_XOFF	0x20	</span><span class="cm">/* Xoff Interrupt Enable */</span><span class="cp"></span>
<span class="cp">#define UART_17158_IER_RTSDTR	0x40	</span><span class="cm">/* Output Interrupt Enable */</span><span class="cp"></span>
<span class="cp">#define UART_17158_IER_CTSDSR	0x80	</span><span class="cm">/* Input Interrupt Enable */</span><span class="cp"></span>

<span class="cp">#define PCI_DEVICE_NEO_2DB9_PCI_NAME		&quot;Neo 2 - DB9 Universal PCI&quot;</span>
<span class="cp">#define PCI_DEVICE_NEO_2DB9PRI_PCI_NAME		&quot;Neo 2 - DB9 Universal PCI - Powered Ring Indicator&quot;</span>
<span class="cp">#define PCI_DEVICE_NEO_2RJ45_PCI_NAME		&quot;Neo 2 - RJ45 Universal PCI&quot;</span>
<span class="cp">#define PCI_DEVICE_NEO_2RJ45PRI_PCI_NAME	&quot;Neo 2 - RJ45 Universal PCI - Powered Ring Indicator&quot;</span>
<span class="cp">#define PCIE_DEVICE_NEO_IBM_PCI_NAME		&quot;Neo 4 - PCI Express - IBM&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * Our Global Variables.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="k">struct</span>	<span class="n">uart_driver</span> <span class="n">jsm_uart_driver</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span>	<span class="n">board_ops</span> <span class="n">jsm_neo_ops</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span>	<span class="n">jsm_debug</span><span class="p">;</span>

<span class="cm">/*************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Prototypes for non-static functions used in more than one module</span>
<span class="cm"> *</span>
<span class="cm"> *************************************************************************/</span>
<span class="kt">int</span> <span class="n">jsm_tty_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">jsm_board</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">jsm_uart_port_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">jsm_board</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">jsm_remove_uart_port</span><span class="p">(</span><span class="k">struct</span> <span class="n">jsm_board</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">jsm_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">jsm_check_queue_flow_control</span><span class="p">(</span><span class="k">struct</span> <span class="n">jsm_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
