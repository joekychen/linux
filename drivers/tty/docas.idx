f | bfin_jtag_comm.c | s | 9.3K | 320 | Jiri Slaby | jslaby@suse.cz | 1333996098 |  | TTY: bfin_jtag_comm, use tty from tty_port  Switch from mutex to tty_port->lock and to tty refcounting. This needs a 'continue' to be added to re-grab a tty after schedule returns.  And since tty is not protected by bfin_jc_tty_mutex remove it as well. But this needs tty_port->count to be protected by tty_port->lock now.  Signed-off-by: Jiri Slaby <jslaby@suse.cz> Cc: Mike Frysinger <vapier@gentoo.org> Cc: uclinux-dist-devel@blackfin.uclinux.org Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | rocket.c | s | 92K | 2758 | Jiri Slaby | jslaby@suse.cz | 1331235741 |  | TTY: remove unneeded tty->index checks  Checking if tty->index is in bounds is not needed. The tty has the index set in the initial open. This is done in get_tty_driver. And it can be only in interval <0,driver->num).  So remove the tests which check exactly this interval. Some are left untouched as they check against the current backing device count. (Leaving apart that the check is racy in most of the cases.)  Signed-off-by: Jiri Slaby <jslaby@suse.cz> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | n_hdlc.c | s | 27K | 850 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | ehv_bytechan.c | s | 23K | 742 | Jiri Slaby | jslaby@suse.cz | 1331235478 |  | TTY: remove re-assignments to tty_driver members  All num, magic and owner are set by alloc_tty_driver. No need to re-set them on each allocation site.  pti driver sets something different to what it passes to alloc_tty_driver. It is not a bug, since we don't use the lines parameter in any way. Anyway this is fixed, and now we do the right thing.  Signed-off-by: Jiri Slaby <jslaby@suse.cz> Acked-by: Tilman Schmidt <tilman@imap.cc> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
d | vt |  | 11 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1337797000 |  | Merge branch 'x86-platform-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip  Pull x86 platform changes from Ingo Molnar:  "This tree includes assorted platform driver updates and a preparatory   series for a platform with custom DMA remapping semantics (sta2x11 I/O   hub)."  * 'x86-platform-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip:   x86/vsmp: Fix number of CPUs when vsmp is disabled   keyboard: Use BIOS Keyboard variable to set Numlock   x86/olpc/xo1/sci: Report RTC wakeup events   x86/olpc/xo1/sci: Produce wakeup events for buttons and switches   x86, platform: Initial support for sta2x11 I/O hub   x86: Introduce CONFIG_X86_DMA_REMAP   x86-32: Introduce CONFIG_X86_DEV_DMA_OPS
f | tty_io.c | s | 83K | 3029 | Linus Torvalds | torvalds@linux-foundation.org | 1338675703 |  | tty: Revert the tty locking series, it needs more work  This reverts the tty layer change to use per-tty locking, because it's not correct yet, and fixing it will require some more deep surgery.  The main revert is d29f3ef39be4 ("tty_lock: Localise the lock"), but there are several smaller commits that built upon it, they also get reverted here. The list of reverted commits is:    fde86d310886 - tty: add lockdep annotations   8f6576ad476b - tty: fix ldisc lock inversion trace   d3ca8b64b97e - pty: Fix lock inversion   b1d679afd766 - tty: drop the pty lock during hangup   abcefe5fc357 - tty/amiserial: Add missing argument for tty_unlock()   fd11b42e3598 - cris: fix missing tty arg in wait_event_interruptible_tty call   d29f3ef39be4 - tty_lock: Localise the lock  The revert had a trivial conflict in the 68360serial.c staging driver that got removed in the meantime.  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | sysrq.c | s | 20K | 779 | Anton Vorontsov | anton.vorontsov@linaro.org | 1333664750 |  | sysrq: use SEND_SIG_FORCED instead of force_sig()  Change send_sig_all() to use do_send_sig_info(SEND_SIG_FORCED) instead of force_sig(SIGKILL).  With the recent changes we do not need force_ to kill the CLONE_NEWPID tasks.  And this is more correct.  force_sig() can race with the exiting thread, while do_send_sig_info(group => true) kill the whole process.  Some more notes from Oleg Nesterov:  > Just one note. This change makes no difference for sysrq_handle_kill(). > But it obviously changes the behaviour sysrq_handle_term(). I think > this is fine, if you want to really kill the task which blocks/ignores > SIGTERM you can use sysrq_handle_kill(). > > Even ignoring the reasons why force_sig() is simply wrong here, > force_sig(SIGTERM) looks strange. The task won't be killed if it has > a handler, but SIG_IGN can't help. However if it has the handler > but blocks SIGTERM temporary (this is very common) it will be killed.  Also,  > force_sig() can't kill the process if the main thread has already > exited. IOW, it is trivial to create the process which can't be > killed by sysrq.  So, this patch fixes the issue.  Suggested-by: Oleg Nesterov <oleg@redhat.com> Acked-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org> Acked-by: Oleg Nesterov <oleg@redhat.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org> Cc: Alan Cox <alan@linux.intel.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | Makefile | g | 1.0K |  | Timur Tabi | timur@freescale.com | 1314120776 |  | tty/powerpc: introduce the ePAPR embedded hypervisor byte channel driver  The ePAPR embedded hypervisor specification provides an API for "byte channels", which are serial-like virtual devices for sending and receiving streams of bytes.  This driver provides Linux kernel support for byte channels via three distinct interfaces:  1) An early-console (udbg) driver.  This provides early console output through a byte channel.  The byte channel handle must be specified in a Kconfig option.  2) A normal console driver.  Output is sent to the byte channel designated for stdout in the device tree.  The console driver is for handling kernel printk calls.  3) A tty driver, which is used to handle user-space input and output.  The byte channel used for the console is designated as the default tty.  Signed-off-by: Timur Tabi <timur@freescale.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
d | ipwireless |  | 10 items |  | Jiri Slaby | jslaby@suse.cz | 1333996239 |  | TTY: ipwireless, use tty from tty_port  It does not make the driver less racy though. Close and hangup should be rewritten and tty refcounting used properly.  Signed-off-by: Jiri Slaby <jslaby@suse.cz> Cc: Jiri Kosina <jkosina@suse.cz> Acked-by: David Sterba <dsterba@suse.cz> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | n_r3964.c | s | 30K | 1085 | Linus Torvalds | torvalds@linux-foundation.org | 1338675703 |  | tty: Revert the tty locking series, it needs more work  This reverts the tty layer change to use per-tty locking, because it's not correct yet, and fixing it will require some more deep surgery.  The main revert is d29f3ef39be4 ("tty_lock: Localise the lock"), but there are several smaller commits that built upon it, they also get reverted here. The list of reverted commits is:    fde86d310886 - tty: add lockdep annotations   8f6576ad476b - tty: fix ldisc lock inversion trace   d3ca8b64b97e - pty: Fix lock inversion   b1d679afd766 - tty: drop the pty lock during hangup   abcefe5fc357 - tty/amiserial: Add missing argument for tty_unlock()   fd11b42e3598 - cris: fix missing tty arg in wait_event_interruptible_tty call   d29f3ef39be4 - tty_lock: Localise the lock  The revert had a trivial conflict in the 68360serial.c staging driver that got removed in the meantime.  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | synclinkmp.c | s | 146K | 4659 | Linus Torvalds | torvalds@linux-foundation.org | 1338675703 |  | tty: Revert the tty locking series, it needs more work  This reverts the tty layer change to use per-tty locking, because it's not correct yet, and fixing it will require some more deep surgery.  The main revert is d29f3ef39be4 ("tty_lock: Localise the lock"), but there are several smaller commits that built upon it, they also get reverted here. The list of reverted commits is:    fde86d310886 - tty: add lockdep annotations   8f6576ad476b - tty: fix ldisc lock inversion trace   d3ca8b64b97e - pty: Fix lock inversion   b1d679afd766 - tty: drop the pty lock during hangup   abcefe5fc357 - tty/amiserial: Add missing argument for tty_unlock()   fd11b42e3598 - cris: fix missing tty arg in wait_event_interruptible_tty call   d29f3ef39be4 - tty_lock: Localise the lock  The revert had a trivial conflict in the 68360serial.c staging driver that got removed in the meantime.  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | n_tracesink.c | s | 7.1K | 217 | J Freyensee | james_p_freyensee@linux.intel.com | 1305329460 |  | n_tracerouter and n_tracesink ldisc additions.  The n_tracerouter and n_tracesink line discpline drivers use the Linux tty line discpline framework to route trace data coming from a tty port (say UART for example) to the trace sink line discipline driver and to another tty port(say USB).  Those these two line discipline drivers can be used together, independently from pti.c, they are part of the original implementation solution of the MIPI P1149.7, compact JTAG, PTI solution for Intel mobile platforms starting with the Medfield platform.  Signed-off-by: J Freyensee <james_p_freyensee@linux.intel.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | pty.c | s | 18K | 646 | Linus Torvalds | torvalds@linux-foundation.org | 1338675703 |  | tty: Revert the tty locking series, it needs more work  This reverts the tty layer change to use per-tty locking, because it's not correct yet, and fixing it will require some more deep surgery.  The main revert is d29f3ef39be4 ("tty_lock: Localise the lock"), but there are several smaller commits that built upon it, they also get reverted here. The list of reverted commits is:    fde86d310886 - tty: add lockdep annotations   8f6576ad476b - tty: fix ldisc lock inversion trace   d3ca8b64b97e - pty: Fix lock inversion   b1d679afd766 - tty: drop the pty lock during hangup   abcefe5fc357 - tty/amiserial: Add missing argument for tty_unlock()   fd11b42e3598 - cris: fix missing tty arg in wait_event_interruptible_tty call   d29f3ef39be4 - tty_lock: Localise the lock  The revert had a trivial conflict in the 68360serial.c staging driver that got removed in the meantime.  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | isicom.c | s | 41K | 1471 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1333148595 |  | Documentation: remove references to /etc/modprobe.conf  Usage of /etc/modprobe.conf file was deprecated by module-init-tools and is no longer parsed by new kmod tool. References to this file are replaced in Documentation, comments and Kconfig according to the context.  There are also some references to the old /etc/modules.conf from 2.4 kernels that are being removed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi> Acked-by: Takashi Iwai <tiwai@suse.de> Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Randy Dunlap <rdunlap@xenotime.net> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | tty_buffer.c | s | 14K | 512 | Xiaobing Tu | xiaobing.tu@intel.com | 1333998765 |  | tty: hold lock across tty buffer finding and buffer filling  tty_buffer_request_room is well protected, but while after it returns,  it releases the port->lock. tty->buf.tail might be modified by either irq handler or other threads. The patch adds more protection by holding the lock across tty buffer finding and buffer filling.  Signed-off-by: Alek Du <alek.du@intel.com> Signed-off-by: Xiaobing Tu <xiaobing.tu@intel.com> Cc: Jiri Slaby <jslaby@suse.cz> Cc: Alan Cox <alan@lxorguk.ukuu.org.uk> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | n_tracesink.h | s | 1.3K | 33 | J Freyensee | james_p_freyensee@linux.intel.com | 1305329460 |  | n_tracerouter and n_tracesink ldisc additions.  The n_tracerouter and n_tracesink line discpline drivers use the Linux tty line discpline framework to route trace data coming from a tty port (say UART for example) to the trace sink line discipline driver and to another tty port(say USB).  Those these two line discipline drivers can be used together, independently from pti.c, they are part of the original implementation solution of the MIPI P1149.7, compact JTAG, PTI solution for Intel mobile platforms starting with the Medfield platform.  Signed-off-by: J Freyensee <james_p_freyensee@linux.intel.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | tty_port.c | s | 11K | 399 | Linus Torvalds | torvalds@linux-foundation.org | 1338675703 |  | tty: Revert the tty locking series, it needs more work  This reverts the tty layer change to use per-tty locking, because it's not correct yet, and fixing it will require some more deep surgery.  The main revert is d29f3ef39be4 ("tty_lock: Localise the lock"), but there are several smaller commits that built upon it, they also get reverted here. The list of reverted commits is:    fde86d310886 - tty: add lockdep annotations   8f6576ad476b - tty: fix ldisc lock inversion trace   d3ca8b64b97e - pty: Fix lock inversion   b1d679afd766 - tty: drop the pty lock during hangup   abcefe5fc357 - tty/amiserial: Add missing argument for tty_unlock()   fd11b42e3598 - cris: fix missing tty arg in wait_event_interruptible_tty call   d29f3ef39be4 - tty_lock: Localise the lock  The revert had a trivial conflict in the 68360serial.c staging driver that got removed in the meantime.  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | moxa.c | s | 51K | 1820 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | mxser.h | s | 4.5K | 125 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | moxa.h | s | 8.4K | 267 | Greg Kroah-Hartman | gregkh@suse.de | 1298420096 |  | tty: move a number of tty drivers from drivers/char/ to drivers/tty/  As planned by Arnd Bergmann, this moves the following drivers from drivers/char/ to drivers/tty/ as that's where they really belong: 	amiserial 	nozomi 	synclink 	rocket 	cyclades 	moxa 	mxser 	isicom 	bfin_jtag_comm  Cc: Arnd Bergmann <arnd@arndb.de> Cc: Alan Cox <alan@lxorguk.ukuu.org.uk> Cc: Jiri Slaby <jslaby@suse.cz> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | amiserial.c | s | 45K | 1599 | Linus Torvalds | torvalds@linux-foundation.org | 1338675703 |  | tty: Revert the tty locking series, it needs more work  This reverts the tty layer change to use per-tty locking, because it's not correct yet, and fixing it will require some more deep surgery.  The main revert is d29f3ef39be4 ("tty_lock: Localise the lock"), but there are several smaller commits that built upon it, they also get reverted here. The list of reverted commits is:    fde86d310886 - tty: add lockdep annotations   8f6576ad476b - tty: fix ldisc lock inversion trace   d3ca8b64b97e - pty: Fix lock inversion   b1d679afd766 - tty: drop the pty lock during hangup   abcefe5fc357 - tty/amiserial: Add missing argument for tty_unlock()   fd11b42e3598 - cris: fix missing tty arg in wait_event_interruptible_tty call   d29f3ef39be4 - tty_lock: Localise the lock  The revert had a trivial conflict in the 68360serial.c staging driver that got removed in the meantime.  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | n_tty.c | s | 51K | 1928 | Jiri Slaby | jslaby@suse.cz | 1335752034 |  | TTY: n_tty, do not dereference user buffer  copy_from_read_buf currently copies data to a user buffer and then checks if the data is single EOF. But it checks it by accessing the user buffer. First, the buffer may be changed by other threads of the user program already. Second, it accesses the buffer without any checks. It might be write-only for example.  Fix this by inspecting contents of the tty (kernel) buffer instead. Note that "n == 1" is necessary, but not sufficient. But we check later that there is nothing left by "!tty->read_cnt" condition.  There is still an issue with the current code that EOF being wrapped to the start of the circular buffer will result in an inappropriate losing of the EOF character. But this is not intended to be fixed by this patch.  Signed-off-by: Jiri Slaby <jslaby@suse.cz> Reported-by: Emil Goode <emilgoode@gmail.com> Cc: Howard Chu <hyc@symas.com> Cc: Alan Cox <alan@lxorguk.ukuu.org.uk> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
d | hvc |  | 18 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1339805835 |  | 
f | synclink_gt.c | s | 131K | 4398 | Linus Torvalds | torvalds@linux-foundation.org | 1338675703 |  | tty: Revert the tty locking series, it needs more work  This reverts the tty layer change to use per-tty locking, because it's not correct yet, and fixing it will require some more deep surgery.  The main revert is d29f3ef39be4 ("tty_lock: Localise the lock"), but there are several smaller commits that built upon it, they also get reverted here. The list of reverted commits is:    fde86d310886 - tty: add lockdep annotations   8f6576ad476b - tty: fix ldisc lock inversion trace   d3ca8b64b97e - pty: Fix lock inversion   b1d679afd766 - tty: drop the pty lock during hangup   abcefe5fc357 - tty/amiserial: Add missing argument for tty_unlock()   fd11b42e3598 - cris: fix missing tty arg in wait_event_interruptible_tty call   d29f3ef39be4 - tty_lock: Localise the lock  The revert had a trivial conflict in the 68360serial.c staging driver that got removed in the meantime.  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
d | serial |  | 92 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1340230393 |  | 
f | synclink.c | s | 229K | 6748 | Linus Torvalds | torvalds@linux-foundation.org | 1338675703 |  | tty: Revert the tty locking series, it needs more work  This reverts the tty layer change to use per-tty locking, because it's not correct yet, and fixing it will require some more deep surgery.  The main revert is d29f3ef39be4 ("tty_lock: Localise the lock"), but there are several smaller commits that built upon it, they also get reverted here. The list of reverted commits is:    fde86d310886 - tty: add lockdep annotations   8f6576ad476b - tty: fix ldisc lock inversion trace   d3ca8b64b97e - pty: Fix lock inversion   b1d679afd766 - tty: drop the pty lock during hangup   abcefe5fc357 - tty/amiserial: Add missing argument for tty_unlock()   fd11b42e3598 - cris: fix missing tty arg in wait_event_interruptible_tty call   d29f3ef39be4 - tty_lock: Localise the lock  The revert had a trivial conflict in the 68360serial.c staging driver that got removed in the meantime.  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | Kconfig | g | 14K |  | Stephen Rothwell | sfr@canb.auug.org.au | 1330128710 |  | tty/powerpc: early udbg consoles can't be modules  Fixes these build errors:  ERROR: ".udbg_printf" [drivers/tty/ehv_bytechan.ko] undefined! ERROR: ".register_early_udbg_console" [drivers/tty/ehv_bytechan.ko] undefined! ERROR: "udbg_putc" [drivers/tty/ehv_bytechan.ko] undefined!  Cc: Timur Tabi <timur@freescale.com> Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Cc: stable <stable@vger.kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | rocket.h | s | 3.8K | 98 | Greg Kroah-Hartman | gregkh@suse.de | 1298420096 |  | tty: move a number of tty drivers from drivers/char/ to drivers/tty/  As planned by Arnd Bergmann, this moves the following drivers from drivers/char/ to drivers/tty/ as that's where they really belong: 	amiserial 	nozomi 	synclink 	rocket 	cyclades 	moxa 	mxser 	isicom 	bfin_jtag_comm  Cc: Arnd Bergmann <arnd@arndb.de> Cc: Alan Cox <alan@lxorguk.ukuu.org.uk> Cc: Jiri Slaby <jslaby@suse.cz> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | tty_mutex.c | s | 659B | 29 | Linus Torvalds | torvalds@linux-foundation.org | 1338675703 |  | tty: Revert the tty locking series, it needs more work  This reverts the tty layer change to use per-tty locking, because it's not correct yet, and fixing it will require some more deep surgery.  The main revert is d29f3ef39be4 ("tty_lock: Localise the lock"), but there are several smaller commits that built upon it, they also get reverted here. The list of reverted commits is:    fde86d310886 - tty: add lockdep annotations   8f6576ad476b - tty: fix ldisc lock inversion trace   d3ca8b64b97e - pty: Fix lock inversion   b1d679afd766 - tty: drop the pty lock during hangup   abcefe5fc357 - tty/amiserial: Add missing argument for tty_unlock()   fd11b42e3598 - cris: fix missing tty arg in wait_event_interruptible_tty call   d29f3ef39be4 - tty_lock: Localise the lock  The revert had a trivial conflict in the 68360serial.c staging driver that got removed in the meantime.  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | mxser.c | s | 68K | 2358 | H Hartley Sweeten | hartleys@visionengravers.com | 1336174934 |  | tty: mxser: local variables should not be exposed globally  The variable 'mxser_port_ops' is only referenced in this file and should be marked static to prevent it from being exposed globally.  Quites the sparse warning:  warning: symbol 'mxser_port_ops' was not declared. Should it be static?  Signed-off-by: H Hartley Sweeten <hsweeten@visionengravers.com> Cc: Jiri Slaby <jirislaby@gmail.com> Acked-by: Alan Cox <alan@linux.intel.com> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | tty_ioctl.c | s | 30K | 1069 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | tty_audit.c | s | 8.5K | 318 | Xiaotian Feng | dfeng@redhat.com | 1299528290 |  | tty_audit: fix tty_audit_add_data live lock on audit disabled  The current tty_audit_add_data code:          do {                 size_t run;                  run = N_TTY_BUF_SIZE - buf->valid;                 if (run > size)                         run = size;                 memcpy(buf->data + buf->valid, data, run);                 buf->valid += run;                 data += run;                 size -= run;                 if (buf->valid == N_TTY_BUF_SIZE)                         tty_audit_buf_push_current(buf);         } while (size != 0);  If the current buffer is full, kernel will then call tty_audit_buf_push_current to empty the buffer. But if we disabled audit at the same time, tty_audit_buf_push() returns immediately if audit_enabled is zero.  Without emptying the buffer. With obvious effect on tty_audit_add_data() that ends up spinning in that loop, copying 0 bytes at each iteration and attempting to push each time without any effect. Holding the lock all along.  Suggested-by: Alexander Viro <aviro@redhat.com> Signed-off-by: Xiaotian Feng <dfeng@redhat.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | tty_ldisc.c | s | 23K | 842 | Linus Torvalds | torvalds@linux-foundation.org | 1338675703 |  | tty: Revert the tty locking series, it needs more work  This reverts the tty layer change to use per-tty locking, because it's not correct yet, and fixing it will require some more deep surgery.  The main revert is d29f3ef39be4 ("tty_lock: Localise the lock"), but there are several smaller commits that built upon it, they also get reverted here. The list of reverted commits is:    fde86d310886 - tty: add lockdep annotations   8f6576ad476b - tty: fix ldisc lock inversion trace   d3ca8b64b97e - pty: Fix lock inversion   b1d679afd766 - tty: drop the pty lock during hangup   abcefe5fc357 - tty/amiserial: Add missing argument for tty_unlock()   fd11b42e3598 - cris: fix missing tty arg in wait_event_interruptible_tty call   d29f3ef39be4 - tty_lock: Localise the lock  The revert had a trivial conflict in the 68360serial.c staging driver that got removed in the meantime.  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | nozomi.c | s | 48K | 1676 | Jiri Slaby | jslaby@suse.cz | 1331235478 |  | TTY: remove re-assignments to tty_driver members  All num, magic and owner are set by alloc_tty_driver. No need to re-set them on each allocation site.  pti driver sets something different to what it passes to alloc_tty_driver. It is not a bug, since we don't use the lines parameter in any way. Anyway this is fixed, and now we do the right thing.  Signed-off-by: Jiri Slaby <jslaby@suse.cz> Acked-by: Tilman Schmidt <tilman@imap.cc> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | n_gsm.c | s | 76K | 2830 | Jiri Slaby | jslaby@suse.cz | 1331235478 |  | TTY: remove re-assignments to tty_driver members  All num, magic and owner are set by alloc_tty_driver. No need to re-set them on each allocation site.  pti driver sets something different to what it passes to alloc_tty_driver. It is not a bug, since we don't use the lines parameter in any way. Anyway this is fixed, and now we do the right thing.  Signed-off-by: Jiri Slaby <jslaby@suse.cz> Acked-by: Tilman Schmidt <tilman@imap.cc> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | rocket_int.h | s | 41K | 1074 | Greg Kroah-Hartman | gregkh@suse.de | 1298420096 |  | tty: move a number of tty drivers from drivers/char/ to drivers/tty/  As planned by Arnd Bergmann, this moves the following drivers from drivers/char/ to drivers/tty/ as that's where they really belong: 	amiserial 	nozomi 	synclink 	rocket 	cyclades 	moxa 	mxser 	isicom 	bfin_jtag_comm  Cc: Arnd Bergmann <arnd@arndb.de> Cc: Alan Cox <alan@lxorguk.ukuu.org.uk> Cc: Jiri Slaby <jslaby@suse.cz> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | cyclades.c | s | 111K | 3661 | Linus Torvalds | torvalds@linux-foundation.org | 1338675703 |  | tty: Revert the tty locking series, it needs more work  This reverts the tty layer change to use per-tty locking, because it's not correct yet, and fixing it will require some more deep surgery.  The main revert is d29f3ef39be4 ("tty_lock: Localise the lock"), but there are several smaller commits that built upon it, they also get reverted here. The list of reverted commits is:    fde86d310886 - tty: add lockdep annotations   8f6576ad476b - tty: fix ldisc lock inversion trace   d3ca8b64b97e - pty: Fix lock inversion   b1d679afd766 - tty: drop the pty lock during hangup   abcefe5fc357 - tty/amiserial: Add missing argument for tty_unlock()   fd11b42e3598 - cris: fix missing tty arg in wait_event_interruptible_tty call   d29f3ef39be4 - tty_lock: Localise the lock  The revert had a trivial conflict in the 68360serial.c staging driver that got removed in the meantime.  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | n_tracerouter.c | s | 7.1K | 221 | J Freyensee | james_p_freyensee@linux.intel.com | 1305329460 |  | n_tracerouter and n_tracesink ldisc additions.  The n_tracerouter and n_tracesink line discpline drivers use the Linux tty line discpline framework to route trace data coming from a tty port (say UART for example) to the trace sink line discipline driver and to another tty port(say USB).  Those these two line discipline drivers can be used together, independently from pti.c, they are part of the original implementation solution of the MIPI P1149.7, compact JTAG, PTI solution for Intel mobile platforms starting with the Medfield platform.  Signed-off-by: J Freyensee <james_p_freyensee@linux.intel.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
