<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › usb › gadget › m66592-udc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>m66592-udc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * M66592 UDC (USB gadget)</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2006-2007 Renesas Solutions Corp.</span>
<span class="cm"> *</span>
<span class="cm"> * Author : Yoshihiro Shimoda &lt;yoshihiro.shimoda.uh@renesas.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; version 2 of the License.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __M66592_UDC_H__</span>
<span class="cp">#define __M66592_UDC_H__</span>

<span class="cp">#ifdef CONFIG_HAVE_CLK</span>
<span class="cp">#include &lt;linux/clk.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#include &lt;linux/usb/m66592.h&gt;</span>

<span class="cp">#define M66592_SYSCFG		0x00</span>
<span class="cp">#define M66592_XTAL		0xC000	</span><span class="cm">/* b15-14: Crystal selection */</span><span class="cp"></span>
<span class="cp">#define   M66592_XTAL48		 0x8000		</span><span class="cm">/* 48MHz */</span><span class="cp"></span>
<span class="cp">#define   M66592_XTAL24		 0x4000		</span><span class="cm">/* 24MHz */</span><span class="cp"></span>
<span class="cp">#define   M66592_XTAL12		 0x0000		</span><span class="cm">/* 12MHz */</span><span class="cp"></span>
<span class="cp">#define M66592_XCKE		0x2000	</span><span class="cm">/* b13: External clock enable */</span><span class="cp"></span>
<span class="cp">#define M66592_RCKE		0x1000	</span><span class="cm">/* b12: Register clock enable */</span><span class="cp"></span>
<span class="cp">#define M66592_PLLC		0x0800	</span><span class="cm">/* b11: PLL control */</span><span class="cp"></span>
<span class="cp">#define M66592_SCKE		0x0400	</span><span class="cm">/* b10: USB clock enable */</span><span class="cp"></span>
<span class="cp">#define M66592_ATCKM		0x0100	</span><span class="cm">/* b8: Automatic clock supply */</span><span class="cp"></span>
<span class="cp">#define M66592_HSE		0x0080	</span><span class="cm">/* b7: Hi-speed enable */</span><span class="cp"></span>
<span class="cp">#define M66592_DCFM		0x0040	</span><span class="cm">/* b6: Controller function select  */</span><span class="cp"></span>
<span class="cp">#define M66592_DMRPD		0x0020	</span><span class="cm">/* b5: D- pull down control */</span><span class="cp"></span>
<span class="cp">#define M66592_DPRPU		0x0010	</span><span class="cm">/* b4: D+ pull up control */</span><span class="cp"></span>
<span class="cp">#define M66592_FSRPC		0x0004	</span><span class="cm">/* b2: Full-speed receiver enable */</span><span class="cp"></span>
<span class="cp">#define M66592_PCUT		0x0002	</span><span class="cm">/* b1: Low power sleep enable */</span><span class="cp"></span>
<span class="cp">#define M66592_USBE		0x0001	</span><span class="cm">/* b0: USB module operation enable */</span><span class="cp"></span>

<span class="cp">#define M66592_SYSSTS		0x02</span>
<span class="cp">#define M66592_LNST		0x0003	</span><span class="cm">/* b1-0: D+, D- line status */</span><span class="cp"></span>
<span class="cp">#define   M66592_SE1		 0x0003		</span><span class="cm">/* SE1 */</span><span class="cp"></span>
<span class="cp">#define   M66592_KSTS		 0x0002		</span><span class="cm">/* K State */</span><span class="cp"></span>
<span class="cp">#define   M66592_JSTS		 0x0001		</span><span class="cm">/* J State */</span><span class="cp"></span>
<span class="cp">#define   M66592_SE0		 0x0000		</span><span class="cm">/* SE0 */</span><span class="cp"></span>

<span class="cp">#define M66592_DVSTCTR		0x04</span>
<span class="cp">#define M66592_WKUP		0x0100	</span><span class="cm">/* b8: Remote wakeup */</span><span class="cp"></span>
<span class="cp">#define M66592_RWUPE		0x0080	</span><span class="cm">/* b7: Remote wakeup sense */</span><span class="cp"></span>
<span class="cp">#define M66592_USBRST		0x0040	</span><span class="cm">/* b6: USB reset enable */</span><span class="cp"></span>
<span class="cp">#define M66592_RESUME		0x0020	</span><span class="cm">/* b5: Resume enable */</span><span class="cp"></span>
<span class="cp">#define M66592_UACT		0x0010	</span><span class="cm">/* b4: USB bus enable */</span><span class="cp"></span>
<span class="cp">#define M66592_RHST		0x0003	</span><span class="cm">/* b1-0: Reset handshake status */</span><span class="cp"></span>
<span class="cp">#define   M66592_HSMODE		 0x0003		</span><span class="cm">/* Hi-Speed mode */</span><span class="cp"></span>
<span class="cp">#define   M66592_FSMODE		 0x0002		</span><span class="cm">/* Full-Speed mode */</span><span class="cp"></span>
<span class="cp">#define   M66592_HSPROC		 0x0001		</span><span class="cm">/* HS handshake is processing */</span><span class="cp"></span>

<span class="cp">#define M66592_TESTMODE		0x06</span>
<span class="cp">#define M66592_UTST		0x000F	</span><span class="cm">/* b4-0: Test select */</span><span class="cp"></span>
<span class="cp">#define   M66592_H_TST_PACKET	 0x000C		</span><span class="cm">/* HOST TEST Packet */</span><span class="cp"></span>
<span class="cp">#define   M66592_H_TST_SE0_NAK	 0x000B		</span><span class="cm">/* HOST TEST SE0 NAK */</span><span class="cp"></span>
<span class="cp">#define   M66592_H_TST_K	 0x000A		</span><span class="cm">/* HOST TEST K */</span><span class="cp"></span>
<span class="cp">#define   M66592_H_TST_J	 0x0009		</span><span class="cm">/* HOST TEST J */</span><span class="cp"></span>
<span class="cp">#define   M66592_H_TST_NORMAL	 0x0000		</span><span class="cm">/* HOST Normal Mode */</span><span class="cp"></span>
<span class="cp">#define   M66592_P_TST_PACKET	 0x0004		</span><span class="cm">/* PERI TEST Packet */</span><span class="cp"></span>
<span class="cp">#define   M66592_P_TST_SE0_NAK	 0x0003		</span><span class="cm">/* PERI TEST SE0 NAK */</span><span class="cp"></span>
<span class="cp">#define   M66592_P_TST_K	 0x0002		</span><span class="cm">/* PERI TEST K */</span><span class="cp"></span>
<span class="cp">#define   M66592_P_TST_J	 0x0001		</span><span class="cm">/* PERI TEST J */</span><span class="cp"></span>
<span class="cp">#define   M66592_P_TST_NORMAL	 0x0000		</span><span class="cm">/* PERI Normal Mode */</span><span class="cp"></span>

<span class="cm">/* built-in registers */</span>
<span class="cp">#define M66592_CFBCFG		0x0A</span>
<span class="cp">#define M66592_D0FBCFG		0x0C</span>
<span class="cp">#define M66592_LITTLE		0x0100	</span><span class="cm">/* b8: Little endian mode */</span><span class="cp"></span>
<span class="cm">/* external chip case */</span>
<span class="cp">#define M66592_PINCFG		0x0A</span>
<span class="cp">#define M66592_LDRV		0x8000	</span><span class="cm">/* b15: Drive Current Adjust */</span><span class="cp"></span>
<span class="cp">#define M66592_BIGEND		0x0100	</span><span class="cm">/* b8: Big endian mode */</span><span class="cp"></span>

<span class="cp">#define M66592_DMA0CFG		0x0C</span>
<span class="cp">#define M66592_DMA1CFG		0x0E</span>
<span class="cp">#define M66592_DREQA		0x4000	</span><span class="cm">/* b14: Dreq active select */</span><span class="cp"></span>
<span class="cp">#define M66592_BURST		0x2000	</span><span class="cm">/* b13: Burst mode */</span><span class="cp"></span>
<span class="cp">#define M66592_DACKA		0x0400	</span><span class="cm">/* b10: Dack active select */</span><span class="cp"></span>
<span class="cp">#define M66592_DFORM		0x0380	</span><span class="cm">/* b9-7: DMA mode select */</span><span class="cp"></span>
<span class="cp">#define   M66592_CPU_ADR_RD_WR	 0x0000   </span><span class="cm">/* Address + RD/WR mode (CPU bus) */</span><span class="cp"></span>
<span class="cp">#define   M66592_CPU_DACK_RD_WR	 0x0100   </span><span class="cm">/* DACK + RD/WR mode (CPU bus) */</span><span class="cp"></span>
<span class="cp">#define   M66592_CPU_DACK_ONLY	 0x0180   </span><span class="cm">/* DACK only mode (CPU bus) */</span><span class="cp"></span>
<span class="cp">#define   M66592_SPLIT_DACK_ONLY 0x0200   </span><span class="cm">/* DACK only mode (SPLIT bus) */</span><span class="cp"></span>
<span class="cp">#define   M66592_SPLIT_DACK_DSTB 0x0300   </span><span class="cm">/* DACK + DSTB0 mode (SPLIT bus) */</span><span class="cp"></span>
<span class="cp">#define M66592_DENDA		0x0040	</span><span class="cm">/* b6: Dend active select */</span><span class="cp"></span>
<span class="cp">#define M66592_PKTM		0x0020	</span><span class="cm">/* b5: Packet mode */</span><span class="cp"></span>
<span class="cp">#define M66592_DENDE		0x0010	</span><span class="cm">/* b4: Dend enable */</span><span class="cp"></span>
<span class="cp">#define M66592_OBUS		0x0004	</span><span class="cm">/* b2: OUTbus mode */</span><span class="cp"></span>

<span class="cm">/* common case */</span>
<span class="cp">#define M66592_CFIFO		0x10</span>
<span class="cp">#define M66592_D0FIFO		0x14</span>
<span class="cp">#define M66592_D1FIFO		0x18</span>

<span class="cp">#define M66592_CFIFOSEL		0x1E</span>
<span class="cp">#define M66592_D0FIFOSEL	0x24</span>
<span class="cp">#define M66592_D1FIFOSEL	0x2A</span>
<span class="cp">#define M66592_RCNT		0x8000	</span><span class="cm">/* b15: Read count mode */</span><span class="cp"></span>
<span class="cp">#define M66592_REW		0x4000	</span><span class="cm">/* b14: Buffer rewind */</span><span class="cp"></span>
<span class="cp">#define M66592_DCLRM		0x2000	</span><span class="cm">/* b13: DMA buffer clear mode */</span><span class="cp"></span>
<span class="cp">#define M66592_DREQE		0x1000	</span><span class="cm">/* b12: DREQ output enable */</span><span class="cp"></span>
<span class="cp">#define M66592_MBW_8		0x0000   </span><span class="cm">/*  8bit */</span><span class="cp"></span>
<span class="cp">#define M66592_MBW_16		0x0400   </span><span class="cm">/* 16bit */</span><span class="cp"></span>
<span class="cp">#define M66592_MBW_32		0x0800   </span><span class="cm">/* 32bit */</span><span class="cp"></span>
<span class="cp">#define M66592_TRENB		0x0200	</span><span class="cm">/* b9: Transaction counter enable */</span><span class="cp"></span>
<span class="cp">#define M66592_TRCLR		0x0100	</span><span class="cm">/* b8: Transaction counter clear */</span><span class="cp"></span>
<span class="cp">#define M66592_DEZPM		0x0080	</span><span class="cm">/* b7: Zero-length packet mode */</span><span class="cp"></span>
<span class="cp">#define M66592_ISEL		0x0020	</span><span class="cm">/* b5: DCP FIFO port direction select */</span><span class="cp"></span>
<span class="cp">#define M66592_CURPIPE		0x0007	</span><span class="cm">/* b2-0: PIPE select */</span><span class="cp"></span>

<span class="cp">#define M66592_CFIFOCTR		0x20</span>
<span class="cp">#define M66592_D0FIFOCTR	0x26</span>
<span class="cp">#define M66592_D1FIFOCTR	0x2c</span>
<span class="cp">#define M66592_BVAL		0x8000	</span><span class="cm">/* b15: Buffer valid flag */</span><span class="cp"></span>
<span class="cp">#define M66592_BCLR		0x4000	</span><span class="cm">/* b14: Buffer clear */</span><span class="cp"></span>
<span class="cp">#define M66592_FRDY		0x2000	</span><span class="cm">/* b13: FIFO ready */</span><span class="cp"></span>
<span class="cp">#define M66592_DTLN		0x0FFF	</span><span class="cm">/* b11-0: FIFO received data length */</span><span class="cp"></span>

<span class="cp">#define M66592_CFIFOSIE		0x22</span>
<span class="cp">#define M66592_TGL		0x8000	</span><span class="cm">/* b15: Buffer toggle */</span><span class="cp"></span>
<span class="cp">#define M66592_SCLR		0x4000	</span><span class="cm">/* b14: Buffer clear */</span><span class="cp"></span>
<span class="cp">#define M66592_SBUSY		0x2000	</span><span class="cm">/* b13: SIE_FIFO busy */</span><span class="cp"></span>

<span class="cp">#define M66592_D0FIFOTRN	0x28</span>
<span class="cp">#define M66592_D1FIFOTRN	0x2E</span>
<span class="cp">#define M66592_TRNCNT		0xFFFF	</span><span class="cm">/* b15-0: Transaction counter */</span><span class="cp"></span>

<span class="cp">#define M66592_INTENB0	0x30</span>
<span class="cp">#define M66592_VBSE	0x8000	</span><span class="cm">/* b15: VBUS interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_RSME	0x4000	</span><span class="cm">/* b14: Resume interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_SOFE	0x2000	</span><span class="cm">/* b13: Frame update interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_DVSE	0x1000	</span><span class="cm">/* b12: Device state transition interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_CTRE	0x0800	</span><span class="cm">/* b11: Control transfer stage transition irq */</span><span class="cp"></span>
<span class="cp">#define M66592_BEMPE	0x0400	</span><span class="cm">/* b10: Buffer empty interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_NRDYE	0x0200	</span><span class="cm">/* b9: Buffer not ready interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_BRDYE	0x0100	</span><span class="cm">/* b8: Buffer ready interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_URST	0x0080	</span><span class="cm">/* b7: USB reset detected interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_SADR	0x0040	</span><span class="cm">/* b6: Set address executed interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_SCFG	0x0020	</span><span class="cm">/* b5: Set configuration executed interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_SUSP	0x0010	</span><span class="cm">/* b4: Suspend detected interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_WDST	0x0008	</span><span class="cm">/* b3: Control write data stage completed irq */</span><span class="cp"></span>
<span class="cp">#define M66592_RDST	0x0004	</span><span class="cm">/* b2: Control read data stage completed irq */</span><span class="cp"></span>
<span class="cp">#define M66592_CMPL	0x0002	</span><span class="cm">/* b1: Control transfer complete interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_SERR	0x0001	</span><span class="cm">/* b0: Sequence error interrupt */</span><span class="cp"></span>

<span class="cp">#define M66592_INTENB1	0x32</span>
<span class="cp">#define M66592_BCHGE	0x4000	</span><span class="cm">/* b14: USB us chenge interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_DTCHE	0x1000	</span><span class="cm">/* b12: Detach sense interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_SIGNE	0x0020	</span><span class="cm">/* b5: SETUP IGNORE interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_SACKE	0x0010	</span><span class="cm">/* b4: SETUP ACK interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_BRDYM	0x0004	</span><span class="cm">/* b2: BRDY clear timing */</span><span class="cp"></span>
<span class="cp">#define M66592_INTL	0x0002	</span><span class="cm">/* b1: Interrupt sense select */</span><span class="cp"></span>
<span class="cp">#define M66592_PCSE	0x0001	</span><span class="cm">/* b0: PCUT enable by CS assert */</span><span class="cp"></span>

<span class="cp">#define M66592_BRDYENB		0x36</span>
<span class="cp">#define M66592_BRDYSTS		0x46</span>
<span class="cp">#define M66592_BRDY7		0x0080	</span><span class="cm">/* b7: PIPE7 */</span><span class="cp"></span>
<span class="cp">#define M66592_BRDY6		0x0040	</span><span class="cm">/* b6: PIPE6 */</span><span class="cp"></span>
<span class="cp">#define M66592_BRDY5		0x0020	</span><span class="cm">/* b5: PIPE5 */</span><span class="cp"></span>
<span class="cp">#define M66592_BRDY4		0x0010	</span><span class="cm">/* b4: PIPE4 */</span><span class="cp"></span>
<span class="cp">#define M66592_BRDY3		0x0008	</span><span class="cm">/* b3: PIPE3 */</span><span class="cp"></span>
<span class="cp">#define M66592_BRDY2		0x0004	</span><span class="cm">/* b2: PIPE2 */</span><span class="cp"></span>
<span class="cp">#define M66592_BRDY1		0x0002	</span><span class="cm">/* b1: PIPE1 */</span><span class="cp"></span>
<span class="cp">#define M66592_BRDY0		0x0001	</span><span class="cm">/* b1: PIPE0 */</span><span class="cp"></span>

<span class="cp">#define M66592_NRDYENB		0x38</span>
<span class="cp">#define M66592_NRDYSTS		0x48</span>
<span class="cp">#define M66592_NRDY7		0x0080	</span><span class="cm">/* b7: PIPE7 */</span><span class="cp"></span>
<span class="cp">#define M66592_NRDY6		0x0040	</span><span class="cm">/* b6: PIPE6 */</span><span class="cp"></span>
<span class="cp">#define M66592_NRDY5		0x0020	</span><span class="cm">/* b5: PIPE5 */</span><span class="cp"></span>
<span class="cp">#define M66592_NRDY4		0x0010	</span><span class="cm">/* b4: PIPE4 */</span><span class="cp"></span>
<span class="cp">#define M66592_NRDY3		0x0008	</span><span class="cm">/* b3: PIPE3 */</span><span class="cp"></span>
<span class="cp">#define M66592_NRDY2		0x0004	</span><span class="cm">/* b2: PIPE2 */</span><span class="cp"></span>
<span class="cp">#define M66592_NRDY1		0x0002	</span><span class="cm">/* b1: PIPE1 */</span><span class="cp"></span>
<span class="cp">#define M66592_NRDY0		0x0001	</span><span class="cm">/* b1: PIPE0 */</span><span class="cp"></span>

<span class="cp">#define M66592_BEMPENB		0x3A</span>
<span class="cp">#define M66592_BEMPSTS		0x4A</span>
<span class="cp">#define M66592_BEMP7		0x0080	</span><span class="cm">/* b7: PIPE7 */</span><span class="cp"></span>
<span class="cp">#define M66592_BEMP6		0x0040	</span><span class="cm">/* b6: PIPE6 */</span><span class="cp"></span>
<span class="cp">#define M66592_BEMP5		0x0020	</span><span class="cm">/* b5: PIPE5 */</span><span class="cp"></span>
<span class="cp">#define M66592_BEMP4		0x0010	</span><span class="cm">/* b4: PIPE4 */</span><span class="cp"></span>
<span class="cp">#define M66592_BEMP3		0x0008	</span><span class="cm">/* b3: PIPE3 */</span><span class="cp"></span>
<span class="cp">#define M66592_BEMP2		0x0004	</span><span class="cm">/* b2: PIPE2 */</span><span class="cp"></span>
<span class="cp">#define M66592_BEMP1		0x0002	</span><span class="cm">/* b1: PIPE1 */</span><span class="cp"></span>
<span class="cp">#define M66592_BEMP0		0x0001	</span><span class="cm">/* b0: PIPE0 */</span><span class="cp"></span>

<span class="cp">#define M66592_SOFCFG		0x3C</span>
<span class="cp">#define M66592_SOFM		0x000C	</span><span class="cm">/* b3-2: SOF palse mode */</span><span class="cp"></span>
<span class="cp">#define   M66592_SOF_125US	 0x0008   </span><span class="cm">/* SOF OUT 125us uFrame Signal */</span><span class="cp"></span>
<span class="cp">#define   M66592_SOF_1MS	 0x0004   </span><span class="cm">/* SOF OUT 1ms Frame Signal */</span><span class="cp"></span>
<span class="cp">#define   M66592_SOF_DISABLE	 0x0000   </span><span class="cm">/* SOF OUT Disable */</span><span class="cp"></span>

<span class="cp">#define M66592_INTSTS0		0x40</span>
<span class="cp">#define M66592_VBINT		0x8000	</span><span class="cm">/* b15: VBUS interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_RESM		0x4000	</span><span class="cm">/* b14: Resume interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_SOFR		0x2000	</span><span class="cm">/* b13: SOF frame update interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_DVST		0x1000	</span><span class="cm">/* b12: Device state transition */</span><span class="cp"></span>
<span class="cp">#define M66592_CTRT		0x0800	</span><span class="cm">/* b11: Control stage transition */</span><span class="cp"></span>
<span class="cp">#define M66592_BEMP		0x0400	</span><span class="cm">/* b10: Buffer empty interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_NRDY		0x0200	</span><span class="cm">/* b9: Buffer not ready interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_BRDY		0x0100	</span><span class="cm">/* b8: Buffer ready interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_VBSTS		0x0080	</span><span class="cm">/* b7: VBUS input port */</span><span class="cp"></span>
<span class="cp">#define M66592_DVSQ		0x0070	</span><span class="cm">/* b6-4: Device state */</span><span class="cp"></span>
<span class="cp">#define   M66592_DS_SPD_CNFG	 0x0070	   </span><span class="cm">/* Suspend Configured */</span><span class="cp"></span>
<span class="cp">#define   M66592_DS_SPD_ADDR	 0x0060	   </span><span class="cm">/* Suspend Address */</span><span class="cp"></span>
<span class="cp">#define   M66592_DS_SPD_DFLT	 0x0050	   </span><span class="cm">/* Suspend Default */</span><span class="cp"></span>
<span class="cp">#define   M66592_DS_SPD_POWR	 0x0040	   </span><span class="cm">/* Suspend Powered */</span><span class="cp"></span>
<span class="cp">#define   M66592_DS_SUSP	 0x0040	   </span><span class="cm">/* Suspend */</span><span class="cp"></span>
<span class="cp">#define   M66592_DS_CNFG	 0x0030	   </span><span class="cm">/* Configured */</span><span class="cp"></span>
<span class="cp">#define   M66592_DS_ADDS	 0x0020	   </span><span class="cm">/* Address */</span><span class="cp"></span>
<span class="cp">#define   M66592_DS_DFLT	 0x0010	   </span><span class="cm">/* Default */</span><span class="cp"></span>
<span class="cp">#define   M66592_DS_POWR	 0x0000	   </span><span class="cm">/* Powered */</span><span class="cp"></span>
<span class="cp">#define M66592_DVSQS		0x0030	</span><span class="cm">/* b5-4: Device state */</span><span class="cp"></span>
<span class="cp">#define M66592_VALID		0x0008	</span><span class="cm">/* b3: Setup packet detected flag */</span><span class="cp"></span>
<span class="cp">#define M66592_CTSQ		0x0007	</span><span class="cm">/* b2-0: Control transfer stage */</span><span class="cp"></span>
<span class="cp">#define   M66592_CS_SQER	 0x0006	  </span><span class="cm">/* Sequence error */</span><span class="cp"></span>
<span class="cp">#define   M66592_CS_WRND	 0x0005	  </span><span class="cm">/* Control write nodata status */</span><span class="cp"></span>
<span class="cp">#define   M66592_CS_WRSS	 0x0004	  </span><span class="cm">/* Control write status stage */</span><span class="cp"></span>
<span class="cp">#define   M66592_CS_WRDS	 0x0003	  </span><span class="cm">/* Control write data stage */</span><span class="cp"></span>
<span class="cp">#define   M66592_CS_RDSS	 0x0002	  </span><span class="cm">/* Control read status stage */</span><span class="cp"></span>
<span class="cp">#define   M66592_CS_RDDS	 0x0001	  </span><span class="cm">/* Control read data stage */</span><span class="cp"></span>
<span class="cp">#define   M66592_CS_IDST	 0x0000	  </span><span class="cm">/* Idle or setup stage */</span><span class="cp"></span>

<span class="cp">#define M66592_INTSTS1		0x42</span>
<span class="cp">#define M66592_BCHG		0x4000	</span><span class="cm">/* b14: USB bus chenge interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_DTCH		0x1000	</span><span class="cm">/* b12: Detach sense interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_SIGN		0x0020	</span><span class="cm">/* b5: SETUP IGNORE interrupt */</span><span class="cp"></span>
<span class="cp">#define M66592_SACK		0x0010	</span><span class="cm">/* b4: SETUP ACK interrupt */</span><span class="cp"></span>

<span class="cp">#define M66592_FRMNUM		0x4C</span>
<span class="cp">#define M66592_OVRN		0x8000	</span><span class="cm">/* b15: Overrun error */</span><span class="cp"></span>
<span class="cp">#define M66592_CRCE		0x4000	</span><span class="cm">/* b14: Received data error */</span><span class="cp"></span>
<span class="cp">#define M66592_SOFRM		0x0800	</span><span class="cm">/* b11: SOF output mode */</span><span class="cp"></span>
<span class="cp">#define M66592_FRNM		0x07FF	</span><span class="cm">/* b10-0: Frame number */</span><span class="cp"></span>

<span class="cp">#define M66592_UFRMNUM		0x4E</span>
<span class="cp">#define M66592_UFRNM		0x0007	</span><span class="cm">/* b2-0: Micro frame number */</span><span class="cp"></span>

<span class="cp">#define M66592_RECOVER		0x50</span>
<span class="cp">#define M66592_STSRECOV		0x0700	</span><span class="cm">/* Status recovery */</span><span class="cp"></span>
<span class="cp">#define   M66592_STSR_HI	 0x0400		  </span><span class="cm">/* FULL(0) or HI(1) Speed */</span><span class="cp"></span>
<span class="cp">#define   M66592_STSR_DEFAULT	 0x0100		  </span><span class="cm">/* Default state */</span><span class="cp"></span>
<span class="cp">#define   M66592_STSR_ADDRESS	 0x0200		  </span><span class="cm">/* Address state */</span><span class="cp"></span>
<span class="cp">#define   M66592_STSR_CONFIG	 0x0300		  </span><span class="cm">/* Configured state */</span><span class="cp"></span>
<span class="cp">#define M66592_USBADDR		0x007F	</span><span class="cm">/* b6-0: USB address */</span><span class="cp"></span>

<span class="cp">#define M66592_USBREQ			0x54</span>
<span class="cp">#define M66592_bRequest			0xFF00	</span><span class="cm">/* b15-8: bRequest */</span><span class="cp"></span>
<span class="cp">#define   M66592_GET_STATUS		 0x0000</span>
<span class="cp">#define   M66592_CLEAR_FEATURE		 0x0100</span>
<span class="cp">#define   M66592_ReqRESERVED		 0x0200</span>
<span class="cp">#define   M66592_SET_FEATURE		 0x0300</span>
<span class="cp">#define   M66592_ReqRESERVED1		 0x0400</span>
<span class="cp">#define   M66592_SET_ADDRESS		 0x0500</span>
<span class="cp">#define   M66592_GET_DESCRIPTOR		 0x0600</span>
<span class="cp">#define   M66592_SET_DESCRIPTOR		 0x0700</span>
<span class="cp">#define   M66592_GET_CONFIGURATION	 0x0800</span>
<span class="cp">#define   M66592_SET_CONFIGURATION	 0x0900</span>
<span class="cp">#define   M66592_GET_INTERFACE		 0x0A00</span>
<span class="cp">#define   M66592_SET_INTERFACE		 0x0B00</span>
<span class="cp">#define   M66592_SYNCH_FRAME		 0x0C00</span>
<span class="cp">#define M66592_bmRequestType		0x00FF	</span><span class="cm">/* b7-0: bmRequestType */</span><span class="cp"></span>
<span class="cp">#define M66592_bmRequestTypeDir		0x0080	</span><span class="cm">/* b7  : Data direction */</span><span class="cp"></span>
<span class="cp">#define   M66592_HOST_TO_DEVICE		 0x0000</span>
<span class="cp">#define   M66592_DEVICE_TO_HOST		 0x0080</span>
<span class="cp">#define M66592_bmRequestTypeType	0x0060	</span><span class="cm">/* b6-5: Type */</span><span class="cp"></span>
<span class="cp">#define   M66592_STANDARD		 0x0000</span>
<span class="cp">#define   M66592_CLASS			 0x0020</span>
<span class="cp">#define   M66592_VENDOR			 0x0040</span>
<span class="cp">#define M66592_bmRequestTypeRecip	0x001F	</span><span class="cm">/* b4-0: Recipient */</span><span class="cp"></span>
<span class="cp">#define   M66592_DEVICE			 0x0000</span>
<span class="cp">#define   M66592_INTERFACE		 0x0001</span>
<span class="cp">#define   M66592_ENDPOINT		 0x0002</span>

<span class="cp">#define M66592_USBVAL				0x56</span>
<span class="cp">#define M66592_wValue				0xFFFF	</span><span class="cm">/* b15-0: wValue */</span><span class="cp"></span>
<span class="cm">/* Standard Feature Selector */</span>
<span class="cp">#define   M66592_ENDPOINT_HALT			0x0000</span>
<span class="cp">#define   M66592_DEVICE_REMOTE_WAKEUP		0x0001</span>
<span class="cp">#define   M66592_TEST_MODE			0x0002</span>
<span class="cm">/* Descriptor Types */</span>
<span class="cp">#define M66592_DT_TYPE				0xFF00</span>
<span class="cp">#define M66592_GET_DT_TYPE(v)			(((v) &amp; DT_TYPE) &gt;&gt; 8)</span>
<span class="cp">#define   M66592_DT_DEVICE			0x01</span>
<span class="cp">#define   M66592_DT_CONFIGURATION		0x02</span>
<span class="cp">#define   M66592_DT_STRING			0x03</span>
<span class="cp">#define   M66592_DT_INTERFACE			0x04</span>
<span class="cp">#define   M66592_DT_ENDPOINT			0x05</span>
<span class="cp">#define   M66592_DT_DEVICE_QUALIFIER		0x06</span>
<span class="cp">#define   M66592_DT_OTHER_SPEED_CONFIGURATION	0x07</span>
<span class="cp">#define   M66592_DT_INTERFACE_POWER		0x08</span>
<span class="cp">#define M66592_DT_INDEX				0x00FF</span>
<span class="cp">#define M66592_CONF_NUM				0x00FF</span>
<span class="cp">#define M66592_ALT_SET				0x00FF</span>

<span class="cp">#define M66592_USBINDEX			0x58</span>
<span class="cp">#define M66592_wIndex			0xFFFF	</span><span class="cm">/* b15-0: wIndex */</span><span class="cp"></span>
<span class="cp">#define M66592_TEST_SELECT		0xFF00	</span><span class="cm">/* b15-b8: Test Mode */</span><span class="cp"></span>
<span class="cp">#define   M66592_TEST_J			 0x0100	  </span><span class="cm">/* Test_J */</span><span class="cp"></span>
<span class="cp">#define   M66592_TEST_K			 0x0200	  </span><span class="cm">/* Test_K */</span><span class="cp"></span>
<span class="cp">#define   M66592_TEST_SE0_NAK		 0x0300	  </span><span class="cm">/* Test_SE0_NAK */</span><span class="cp"></span>
<span class="cp">#define   M66592_TEST_PACKET		 0x0400	  </span><span class="cm">/* Test_Packet */</span><span class="cp"></span>
<span class="cp">#define   M66592_TEST_FORCE_ENABLE	 0x0500	  </span><span class="cm">/* Test_Force_Enable */</span><span class="cp"></span>
<span class="cp">#define   M66592_TEST_STSelectors	 0x0600	  </span><span class="cm">/* Standard test selectors */</span><span class="cp"></span>
<span class="cp">#define   M66592_TEST_Reserved		 0x4000	  </span><span class="cm">/* Reserved */</span><span class="cp"></span>
<span class="cp">#define   M66592_TEST_VSTModes		 0xC000	  </span><span class="cm">/* Vendor-specific tests */</span><span class="cp"></span>
<span class="cp">#define M66592_EP_DIR			0x0080	</span><span class="cm">/* b7: Endpoint Direction */</span><span class="cp"></span>
<span class="cp">#define   M66592_EP_DIR_IN		 0x0080</span>
<span class="cp">#define   M66592_EP_DIR_OUT		 0x0000</span>

<span class="cp">#define M66592_USBLENG		0x5A</span>
<span class="cp">#define M66592_wLength		0xFFFF	</span><span class="cm">/* b15-0: wLength */</span><span class="cp"></span>

<span class="cp">#define M66592_DCPCFG		0x5C</span>
<span class="cp">#define M66592_CNTMD		0x0100	</span><span class="cm">/* b8: Continuous transfer mode */</span><span class="cp"></span>
<span class="cp">#define M66592_DIR		0x0010	</span><span class="cm">/* b4: Control transfer DIR select */</span><span class="cp"></span>

<span class="cp">#define M66592_DCPMAXP		0x5E</span>
<span class="cp">#define M66592_DEVSEL		0xC000	</span><span class="cm">/* b15-14: Device address select */</span><span class="cp"></span>
<span class="cp">#define   M66592_DEVICE_0	 0x0000		  </span><span class="cm">/* Device address 0 */</span><span class="cp"></span>
<span class="cp">#define   M66592_DEVICE_1	 0x4000		  </span><span class="cm">/* Device address 1 */</span><span class="cp"></span>
<span class="cp">#define   M66592_DEVICE_2	 0x8000		  </span><span class="cm">/* Device address 2 */</span><span class="cp"></span>
<span class="cp">#define   M66592_DEVICE_3	 0xC000		  </span><span class="cm">/* Device address 3 */</span><span class="cp"></span>
<span class="cp">#define M66592_MAXP		0x007F	</span><span class="cm">/* b6-0: Maxpacket size of ep0 */</span><span class="cp"></span>

<span class="cp">#define M66592_DCPCTR		0x60</span>
<span class="cp">#define M66592_BSTS		0x8000	</span><span class="cm">/* b15: Buffer status */</span><span class="cp"></span>
<span class="cp">#define M66592_SUREQ		0x4000	</span><span class="cm">/* b14: Send USB request  */</span><span class="cp"></span>
<span class="cp">#define M66592_SQCLR		0x0100	</span><span class="cm">/* b8: Sequence toggle bit clear */</span><span class="cp"></span>
<span class="cp">#define M66592_SQSET		0x0080	</span><span class="cm">/* b7: Sequence toggle bit set */</span><span class="cp"></span>
<span class="cp">#define M66592_SQMON		0x0040	</span><span class="cm">/* b6: Sequence toggle bit monitor */</span><span class="cp"></span>
<span class="cp">#define M66592_CCPL		0x0004	</span><span class="cm">/* b2: control transfer complete */</span><span class="cp"></span>
<span class="cp">#define M66592_PID		0x0003	</span><span class="cm">/* b1-0: Response PID */</span><span class="cp"></span>
<span class="cp">#define   M66592_PID_STALL	 0x0002		  </span><span class="cm">/* STALL */</span><span class="cp"></span>
<span class="cp">#define   M66592_PID_BUF	 0x0001		  </span><span class="cm">/* BUF */</span><span class="cp"></span>
<span class="cp">#define   M66592_PID_NAK	 0x0000		  </span><span class="cm">/* NAK */</span><span class="cp"></span>

<span class="cp">#define M66592_PIPESEL		0x64</span>
<span class="cp">#define M66592_PIPENM		0x0007	</span><span class="cm">/* b2-0: Pipe select */</span><span class="cp"></span>
<span class="cp">#define   M66592_PIPE0		 0x0000		  </span><span class="cm">/* PIPE 0 */</span><span class="cp"></span>
<span class="cp">#define   M66592_PIPE1		 0x0001		  </span><span class="cm">/* PIPE 1 */</span><span class="cp"></span>
<span class="cp">#define   M66592_PIPE2		 0x0002		  </span><span class="cm">/* PIPE 2 */</span><span class="cp"></span>
<span class="cp">#define   M66592_PIPE3		 0x0003		  </span><span class="cm">/* PIPE 3 */</span><span class="cp"></span>
<span class="cp">#define   M66592_PIPE4		 0x0004		  </span><span class="cm">/* PIPE 4 */</span><span class="cp"></span>
<span class="cp">#define   M66592_PIPE5		 0x0005		  </span><span class="cm">/* PIPE 5 */</span><span class="cp"></span>
<span class="cp">#define   M66592_PIPE6		 0x0006		  </span><span class="cm">/* PIPE 6 */</span><span class="cp"></span>
<span class="cp">#define   M66592_PIPE7		 0x0007		  </span><span class="cm">/* PIPE 7 */</span><span class="cp"></span>

<span class="cp">#define M66592_PIPECFG		0x66</span>
<span class="cp">#define M66592_TYP		0xC000	</span><span class="cm">/* b15-14: Transfer type */</span><span class="cp"></span>
<span class="cp">#define   M66592_ISO		 0xC000		  </span><span class="cm">/* Isochronous */</span><span class="cp"></span>
<span class="cp">#define   M66592_INT		 0x8000		  </span><span class="cm">/* Interrupt */</span><span class="cp"></span>
<span class="cp">#define   M66592_BULK		 0x4000		  </span><span class="cm">/* Bulk */</span><span class="cp"></span>
<span class="cp">#define M66592_BFRE		0x0400	</span><span class="cm">/* b10: Buffer ready interrupt mode */</span><span class="cp"></span>
<span class="cp">#define M66592_DBLB		0x0200	</span><span class="cm">/* b9: Double buffer mode select */</span><span class="cp"></span>
<span class="cp">#define M66592_CNTMD		0x0100	</span><span class="cm">/* b8: Continuous transfer mode */</span><span class="cp"></span>
<span class="cp">#define M66592_SHTNAK		0x0080	</span><span class="cm">/* b7: Transfer end NAK */</span><span class="cp"></span>
<span class="cp">#define M66592_DIR		0x0010	</span><span class="cm">/* b4: Transfer direction select */</span><span class="cp"></span>
<span class="cp">#define   M66592_DIR_H_OUT	 0x0010		  </span><span class="cm">/* HOST OUT */</span><span class="cp"></span>
<span class="cp">#define   M66592_DIR_P_IN	 0x0010		  </span><span class="cm">/* PERI IN */</span><span class="cp"></span>
<span class="cp">#define   M66592_DIR_H_IN	 0x0000		  </span><span class="cm">/* HOST IN */</span><span class="cp"></span>
<span class="cp">#define   M66592_DIR_P_OUT	 0x0000		  </span><span class="cm">/* PERI OUT */</span><span class="cp"></span>
<span class="cp">#define M66592_EPNUM		0x000F	</span><span class="cm">/* b3-0: Eendpoint number select */</span><span class="cp"></span>
<span class="cp">#define   M66592_EP1		 0x0001</span>
<span class="cp">#define   M66592_EP2		 0x0002</span>
<span class="cp">#define   M66592_EP3		 0x0003</span>
<span class="cp">#define   M66592_EP4		 0x0004</span>
<span class="cp">#define   M66592_EP5		 0x0005</span>
<span class="cp">#define   M66592_EP6		 0x0006</span>
<span class="cp">#define   M66592_EP7		 0x0007</span>
<span class="cp">#define   M66592_EP8		 0x0008</span>
<span class="cp">#define   M66592_EP9		 0x0009</span>
<span class="cp">#define   M66592_EP10		 0x000A</span>
<span class="cp">#define   M66592_EP11		 0x000B</span>
<span class="cp">#define   M66592_EP12		 0x000C</span>
<span class="cp">#define   M66592_EP13		 0x000D</span>
<span class="cp">#define   M66592_EP14		 0x000E</span>
<span class="cp">#define   M66592_EP15		 0x000F</span>

<span class="cp">#define M66592_PIPEBUF		0x68</span>
<span class="cp">#define M66592_BUFSIZE		0x7C00	</span><span class="cm">/* b14-10: Pipe buffer size */</span><span class="cp"></span>
<span class="cp">#define M66592_BUF_SIZE(x)	((((x) / 64) - 1) &lt;&lt; 10)</span>
<span class="cp">#define M66592_BUFNMB		0x00FF	</span><span class="cm">/* b7-0: Pipe buffer number */</span><span class="cp"></span>

<span class="cp">#define M66592_PIPEMAXP		0x6A</span>
<span class="cp">#define M66592_MXPS		0x07FF	</span><span class="cm">/* b10-0: Maxpacket size */</span><span class="cp"></span>

<span class="cp">#define M66592_PIPEPERI		0x6C</span>
<span class="cp">#define M66592_IFIS		0x1000	</span><span class="cm">/* b12: ISO in-buffer flush mode */</span><span class="cp"></span>
<span class="cp">#define M66592_IITV		0x0007	</span><span class="cm">/* b2-0: ISO interval */</span><span class="cp"></span>

<span class="cp">#define M66592_PIPE1CTR		0x70</span>
<span class="cp">#define M66592_PIPE2CTR		0x72</span>
<span class="cp">#define M66592_PIPE3CTR		0x74</span>
<span class="cp">#define M66592_PIPE4CTR		0x76</span>
<span class="cp">#define M66592_PIPE5CTR		0x78</span>
<span class="cp">#define M66592_PIPE6CTR		0x7A</span>
<span class="cp">#define M66592_PIPE7CTR		0x7C</span>
<span class="cp">#define M66592_BSTS		0x8000	</span><span class="cm">/* b15: Buffer status */</span><span class="cp"></span>
<span class="cp">#define M66592_INBUFM		0x4000	</span><span class="cm">/* b14: IN buffer monitor (PIPE 1-5) */</span><span class="cp"></span>
<span class="cp">#define M66592_ACLRM		0x0200	</span><span class="cm">/* b9: Out buffer auto clear mode */</span><span class="cp"></span>
<span class="cp">#define M66592_SQCLR		0x0100	</span><span class="cm">/* b8: Sequence toggle bit clear */</span><span class="cp"></span>
<span class="cp">#define M66592_SQSET		0x0080	</span><span class="cm">/* b7: Sequence toggle bit set */</span><span class="cp"></span>
<span class="cp">#define M66592_SQMON		0x0040	</span><span class="cm">/* b6: Sequence toggle bit monitor */</span><span class="cp"></span>
<span class="cp">#define M66592_PID		0x0003	</span><span class="cm">/* b1-0: Response PID */</span><span class="cp"></span>

<span class="cp">#define M66592_INVALID_REG	0x7E</span>


<span class="cp">#define get_pipectr_addr(pipenum)	(M66592_PIPE1CTR + (pipenum - 1) * 2)</span>

<span class="cp">#define M66592_MAX_SAMPLING	10</span>

<span class="cp">#define M66592_MAX_NUM_PIPE	8</span>
<span class="cp">#define M66592_MAX_NUM_BULK	3</span>
<span class="cp">#define M66592_MAX_NUM_ISOC	2</span>
<span class="cp">#define M66592_MAX_NUM_INT	2</span>

<span class="cp">#define M66592_BASE_PIPENUM_BULK	3</span>
<span class="cp">#define M66592_BASE_PIPENUM_ISOC	1</span>
<span class="cp">#define M66592_BASE_PIPENUM_INT		6</span>

<span class="cp">#define M66592_BASE_BUFNUM	6</span>
<span class="cp">#define M66592_MAX_BUFNUM	0x4F</span>

<span class="k">struct</span> <span class="n">m66592_pipe_info</span> <span class="p">{</span>
	<span class="n">u16</span>	<span class="n">pipe</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">epnum</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">maxpacket</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">type</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">interval</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">dir_in</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">m66592_request</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">usb_request</span>	<span class="n">req</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">queue</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">m66592_ep</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">usb_ep</span>		<span class="n">ep</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">m66592</span>		<span class="o">*</span><span class="n">m66592</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">queue</span><span class="p">;</span>
	<span class="kt">unsigned</span>		<span class="n">busy</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span>		<span class="n">internal_ccpl</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* use only control */</span>

	<span class="cm">/* this member can able to after m66592_enable */</span>
	<span class="kt">unsigned</span>		<span class="n">use_dma</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">pipenum</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">type</span><span class="p">;</span>

	<span class="cm">/* register address */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">fifoaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">fifosel</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">fifoctr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">fifotrn</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">pipectr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">m66592</span> <span class="p">{</span>
	<span class="n">spinlock_t</span>		<span class="n">lock</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>		<span class="o">*</span><span class="n">reg</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_HAVE_CLK</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="k">struct</span> <span class="n">m66592_platdata</span>	<span class="o">*</span><span class="n">pdata</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">irq_trigger</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">usb_gadget</span>		<span class="n">gadget</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">usb_gadget_driver</span>	<span class="o">*</span><span class="n">driver</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">m66592_ep</span>	<span class="n">ep</span><span class="p">[</span><span class="n">M66592_MAX_NUM_PIPE</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">m66592_ep</span>	<span class="o">*</span><span class="n">pipenum2ep</span><span class="p">[</span><span class="n">M66592_MAX_NUM_PIPE</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">m66592_ep</span>	<span class="o">*</span><span class="n">epaddr2ep</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">usb_request</span>	<span class="o">*</span><span class="n">ep0_req</span><span class="p">;</span>	<span class="cm">/* for internal request */</span>
	<span class="n">__le16</span>			<span class="n">ep0_data</span><span class="p">;</span>	<span class="cm">/* for internal request */</span>
	<span class="n">u16</span>			<span class="n">old_vbus</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">timer_list</span>	<span class="n">timer</span><span class="p">;</span>

	<span class="kt">int</span>			<span class="n">scount</span><span class="p">;</span>

	<span class="kt">int</span>			<span class="n">old_dvsq</span><span class="p">;</span>

	<span class="cm">/* pipe config */</span>
	<span class="kt">int</span> <span class="n">bulk</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">interrupt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">isochronous</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_dma</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define gadget_to_m66592(_gadget) container_of(_gadget, struct m66592, gadget)</span>
<span class="cp">#define m66592_to_gadget(m66592) (&amp;m66592-&gt;gadget)</span>

<span class="cp">#define is_bulk_pipe(pipenum)	\</span>
<span class="cp">	((pipenum &gt;= M66592_BASE_PIPENUM_BULK) &amp;&amp; \</span>
<span class="cp">	 (pipenum &lt; (M66592_BASE_PIPENUM_BULK + M66592_MAX_NUM_BULK)))</span>
<span class="cp">#define is_interrupt_pipe(pipenum)	\</span>
<span class="cp">	((pipenum &gt;= M66592_BASE_PIPENUM_INT) &amp;&amp; \</span>
<span class="cp">	 (pipenum &lt; (M66592_BASE_PIPENUM_INT + M66592_MAX_NUM_INT)))</span>
<span class="cp">#define is_isoc_pipe(pipenum)	\</span>
<span class="cp">	((pipenum &gt;= M66592_BASE_PIPENUM_ISOC) &amp;&amp; \</span>
<span class="cp">	 (pipenum &lt; (M66592_BASE_PIPENUM_ISOC + M66592_MAX_NUM_ISOC)))</span>

<span class="cp">#define enable_irq_ready(m66592, pipenum)	\</span>
<span class="cp">	enable_pipe_irq(m66592, pipenum, M66592_BRDYENB)</span>
<span class="cp">#define disable_irq_ready(m66592, pipenum)	\</span>
<span class="cp">	disable_pipe_irq(m66592, pipenum, M66592_BRDYENB)</span>
<span class="cp">#define enable_irq_empty(m66592, pipenum)	\</span>
<span class="cp">	enable_pipe_irq(m66592, pipenum, M66592_BEMPENB)</span>
<span class="cp">#define disable_irq_empty(m66592, pipenum)	\</span>
<span class="cp">	disable_pipe_irq(m66592, pipenum, M66592_BEMPENB)</span>
<span class="cp">#define enable_irq_nrdy(m66592, pipenum)	\</span>
<span class="cp">	enable_pipe_irq(m66592, pipenum, M66592_NRDYENB)</span>
<span class="cp">#define disable_irq_nrdy(m66592, pipenum)	\</span>
<span class="cp">	disable_pipe_irq(m66592, pipenum, M66592_NRDYENB)</span>

<span class="cm">/*-------------------------------------------------------------------------*/</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">u16</span> <span class="nf">m66592_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">m66592</span> <span class="o">*</span><span class="n">m66592</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ioread16</span><span class="p">(</span><span class="n">m66592</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">m66592_read_fifo</span><span class="p">(</span><span class="k">struct</span> <span class="n">m66592</span> <span class="o">*</span><span class="n">m66592</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">,</span>
		<span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">fifoaddr</span> <span class="o">=</span> <span class="n">m66592</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">offset</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">m66592</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">on_chip</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="n">len</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">ioread32_rep</span><span class="p">(</span><span class="n">fifoaddr</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">ioread16_rep</span><span class="p">(</span><span class="n">fifoaddr</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">m66592_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">m66592</span> <span class="o">*</span><span class="n">m66592</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iowrite16</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">m66592</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">m66592_mdfy</span><span class="p">(</span><span class="k">struct</span> <span class="n">m66592</span> <span class="o">*</span><span class="n">m66592</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">,</span> <span class="n">u16</span> <span class="n">pat</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">m66592_read</span><span class="p">(</span><span class="n">m66592</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">pat</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">|</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">m66592_write</span><span class="p">(</span><span class="n">m66592</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define m66592_bclr(m66592, val, offset)	\</span>
<span class="cp">			m66592_mdfy(m66592, 0, val, offset)</span>
<span class="cp">#define m66592_bset(m66592, val, offset)	\</span>
<span class="cp">			m66592_mdfy(m66592, val, 0, offset)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">m66592_write_fifo</span><span class="p">(</span><span class="k">struct</span> <span class="n">m66592</span> <span class="o">*</span><span class="n">m66592</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">m66592_ep</span> <span class="o">*</span><span class="n">ep</span><span class="p">,</span>
		<span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">fifoaddr</span> <span class="o">=</span> <span class="n">m66592</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">+</span> <span class="n">ep</span><span class="o">-&gt;</span><span class="n">fifoaddr</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">m66592</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">on_chip</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pb</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

		<span class="n">count</span> <span class="o">=</span> <span class="n">len</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">iowrite32_rep</span><span class="p">(</span><span class="n">fifoaddr</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&amp;</span> <span class="mh">0x00000003</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pb</span> <span class="o">=</span> <span class="n">buf</span> <span class="o">+</span> <span class="n">count</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">len</span> <span class="o">&amp;</span> <span class="mh">0x00000003</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">m66592_read</span><span class="p">(</span><span class="n">m66592</span><span class="p">,</span> <span class="n">M66592_CFBCFG</span><span class="p">))</span>	<span class="cm">/* le */</span>
					<span class="n">iowrite8</span><span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fifoaddr</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">i</span><span class="p">));</span>
				<span class="k">else</span>
					<span class="n">iowrite8</span><span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fifoaddr</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">odd</span> <span class="o">=</span> <span class="n">len</span> <span class="o">&amp;</span> <span class="mh">0x0001</span><span class="p">;</span>

		<span class="n">len</span> <span class="o">=</span> <span class="n">len</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">iowrite16_rep</span><span class="p">(</span><span class="n">fifoaddr</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">odd</span><span class="p">)</span> <span class="p">{</span>
			<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">m66592</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">wr0_shorted_to_wr1</span><span class="p">)</span>
				<span class="n">m66592_bclr</span><span class="p">(</span><span class="n">m66592</span><span class="p">,</span> <span class="n">M66592_MBW_16</span><span class="p">,</span> <span class="n">ep</span><span class="o">-&gt;</span><span class="n">fifosel</span><span class="p">);</span>
			<span class="n">iowrite8</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">fifoaddr</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">m66592</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">wr0_shorted_to_wr1</span><span class="p">)</span>
				<span class="n">m66592_bset</span><span class="p">(</span><span class="n">m66592</span><span class="p">,</span> <span class="n">M66592_MBW_16</span><span class="p">,</span> <span class="n">ep</span><span class="o">-&gt;</span><span class="n">fifosel</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cp">#endif	</span><span class="cm">/* ifndef __M66592_UDC_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
