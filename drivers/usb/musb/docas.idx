f | am35x.c | s | 16K | 543 | Greg Kroah-Hartman | gregkh@linuxfoundation.org | 1330620333 |  | 
f | Makefile | g | 1.1K |  | Ajay Kumar Gupta | ajay.gupta@ti.com | 1336129174 |  | usb: musb: Add support for ti81xx platform  TI81XX platform has two musb interfaces and uses CPPI4.1 DMA engine. It has builtin USB PHYs as AM35x. The current set of patches adds support for one instance and only in PIO mode.  [ balbi@ti.com : make it compile and solve a "may be used 	uninitialized" warning ]  Signed-off-by: Ajay Kumar Gupta <ajay.gupta@ti.com> Signed-off-by: Ravi Babu <ravibabu@ti.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | musb_virthub.c | s | 11K | 385 | Heikki Krogerus | heikki.krogerus@linux.intel.com | 1329133974 |  | usb: musb: Start using struct usb_otg  Use struct usb_otg members with OTG specific functions instead of usb_phy members.  [ balbi@ti.com: added a missing change on musb_gadget.c to avoid 	a compile error on a later patch ]  Signed-off-by: Heikki Krogerus <heikki.krogerus@linux.intel.com> Reviewed-by: Marek Vasut <marek.vasut@gmail.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | musb_gadget.h | s | 3.5K | 99 | Felipe Balbi | balbi@ti.com | 1297969906 |  | usb: musb: gadget: do not poke with gadget's list_head  struct usb_request's list_head is supposed to be used only by gadget drivers, but musb is abusing that. Give struct musb_request its own list_head and prevent musb from poking into other driver's business.  Signed-off-by: Felipe Balbi <balbi@ti.com>
f | omap2430.c | s | 13K | 453 | Shubhrajyoti D | shubhrajyoti@ti.com | 1334074310 |  | usb: musb: omap: fix the error check for pm_runtime_get_sync  pm_runtime_get_sync returns a signed integer. In case of errors it returns a negative value. This patch fixes the error check by making it signed instead of unsigned thus preventing register access if get_sync_fails. Also passes the error cause to the debug message.  Cc: stable@vger.kernel.org Cc:  Kishon Vijay Abraham I <kishon@ti.com> Signed-off-by: Shubhrajyoti D <shubhrajyoti@ti.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | musb_host.c | s | 64K | 2043 | Ajay Kumar Gupta | ajay.gupta@ti.com | 1340360155 |  | usb: musb: host: release dma channels if no active io  Currently DMA channels are allocated and they remain allocated even if there is no active data transfer. Added channel_release() whenever there is no pending request.  Signed-off-by: Ajay Kumar Gupta <ajay.gupta@ti.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | da8xx.c | s | 16K | 499 | Greg Kroah-Hartman | gregkh@linuxfoundation.org | 1330620333 |  | 
f | musb_core.h | s | 15K | 480 | Felipe Balbi | balbi@ti.com | 1334746160 |  | usb: musb: drop __deprecated flag  Looks like we cannot live without that double_buffer_not_ok flag due to many HW bugs this MUSB core has.  So, let's drop the __deprecated flag to avoid annoying compile warnings.  Signed-off-by: Felipe Balbi <balbi@ti.com>
f | musb_gadget_ep0.c | s | 27K | 952 | Felipe Balbi | balbi@ti.com | 1323683512 |  | usb: musb: headers cleanup  Remove a few unnecessary headers from a few files.  Signed-off-by: Felipe Balbi <balbi@ti.com>
f | musb_regs.h | s | 17K | 539 | Felipe Balbi | balbi@ti.com | 1313139170 |  | usb: musb: tusb6010: fix compilation  earlier commits have broken compilation of tusb6010 glue layer, fix it.  Signed-off-by: Felipe Balbi <balbi@ti.com>
f | omap2430.h | s | 1.2K | 40 | Felipe Balbi | felipe.balbi@nokia.com | 1267570478 |  | USB: musb: get rid of omap_readl/writel  we have those addresses already ioremaped, so let's use our __raw_readl/writel wrappers.  Signed-off-by: Felipe Balbi <felipe.balbi@nokia.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | tusb6010.h | s | 9.3K | 205 | Jarkko Nikula | jarkko.nikula@nokia.com | 1240521327 |  | USB: musb: Remove my email address from few musb related drivers  This email address is going to expire soon and my contribution to musb is next to zero so remove it.  Signed-off-by: Jarkko Nikula <jarkko.nikula@nokia.com> Cc: Felipe Balbi <felipe.balbi@nokia.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | musb_debugfs.c | s | 6.9K | 231 | Felipe Balbi | balbi@ti.com | 1328086966 |  | usb: musb: debugfs: fix error check  debugfs will return NULL on failure, so we must check for !ptr instead of IS_ERR(ptr).  Signed-off-by: Felipe Balbi <balbi@ti.com>
f | musb_io.h | s | 4.7K | 109 | Geert Uytterhoeven | geert@linux-m68k.org | 1335118610 |  | m68k: Make sure {read,write}s[bwl]() are always defined  drivers/usb/musb/musb_io.h provides default implementations for {read,write}s[bwl]() on most platforms, some of which will conflict soon with platform-specific counterparts on m68k.  To avoid having to add more platform-specific checks to musb_io.h later, make sure {read,write}s[bwl]() are always defined on m68k, and disable the default implementations in musb_io.h on m68k, like is already done for several other architectures.  Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org> Acked-by: Felipe Balbi <balbi@ti.com>
f | musbhsdma.c | s | 11K | 350 | Yong Zhang | yong.zhang0@gmail.com | 1316335176 |  | USB: irq: Remove IRQF_DISABLED  This flag is a NOOP and can be removed now.  Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | musbhsdma.h | s | 5.0K | 139 | Tony Lindgren | tony@atomide.com | 1297884758 |  | Merge branches 'devel-cleanup', 'devel-board', 'devel-early-init' and 'devel-ti816x' into omap-for-linus
f | davinci.c | s | 16K | 521 | Jon Povey | jon.povey@racelogic.co.uk | 1338823782 |  | usb: musb: davinci: Fix build breakage  This appears to have been broken by commit 5cfb19ac604a68c030b245561f575c2d1bac1d49 (ARM: davinci: streamline sysmod access)  For now, fix by hardcoding USB_PHY_CTRL and DM355_DEEPSLEEP  Tested on DM365 with defconfig changes.  Signed-off-by: Jon Povey <jon.povey@racelogic.co.uk> Acked-by: Sekhar Nori <nsekhar@ti.com> CC: Felipe Balbi <balbi@ti.com> Cc: <stable@vger.kernel.org> # v3.4.x Signed-off-by: Felipe Balbi <balbi@ti.com>
f | ux500_dma.c | s | 11K | 323 | Alexandre Bounine | alexandre.bounine@idt.com | 1332337822 |  | dmaengine/dma_slave: introduce inline wrappers  Add inline wrappers for device_prep_slave_sg() and device_prep_dma_cyclic() interfaces to hide new parameter from current users of affected interfaces. Convert current users to use new wrappers instead of direct calls. Suggested by Russell King [https://lkml.org/lkml/2012/2/3/269].  Signed-off-by: Alexandre Bounine <alexandre.bounine@idt.com> Signed-off-by: Vinod Koul <vinod.koul@linux.intel.com>
f | cppi_dma.c | s | 44K | 1325 | Reinhard Tartler | tartler@cs.fau.de | 1337024745 |  | usb: musb: cppi: add missing include to fix compilation  This fixes compilation as module.  Signed-off-by: Reinhard Tartler <tartler@cs.fau.de> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | musb_dsps.c | s | 18K | 605 | Ajay Kumar Gupta | ajay.gupta@ti.com | 1336129174 |  | usb: musb: Add support for ti81xx platform  TI81XX platform has two musb interfaces and uses CPPI4.1 DMA engine. It has builtin USB PHYs as AM35x. The current set of patches adds support for one instance and only in PIO mode.  [ balbi@ti.com : make it compile and solve a "may be used 	uninitialized" warning ]  Signed-off-by: Ajay Kumar Gupta <ajay.gupta@ti.com> Signed-off-by: Ravi Babu <ravibabu@ti.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | tusb6010.c | s | 33K | 1057 | Greg Kroah-Hartman | gregkh@linuxfoundation.org | 1330620333 |  | 
f | musb_gadget.c | s | 58K | 1896 | Grazvydas Ignotas | notasas@gmail.com | 1338823820 |  | usb: musb_gadget: fix crash caused by dangling pointer  usb_ep_ops.disable must clear external copy of the endpoint descriptor, otherwise musb crashes after loading/unloading several gadget modules in a row:  Unable to handle kernel paging request at virtual address bf013730 pgd = c0004000 [bf013730] *pgd=8f26d811, *pte=00000000, *ppte=00000000 Internal error: Oops: 7 [#1] Modules linked in: g_cdc [last unloaded: g_file_storage] CPU: 0    Not tainted  (3.2.17 #647) PC is at musb_gadget_enable+0x4c/0x24c LR is at _raw_spin_lock_irqsave+0x4c/0x58 [<c027c030>] (musb_gadget_enable+0x4c/0x24c) from [<bf01b760>] (gether_connect+0x3c/0x19c [g_cdc]) [<bf01b760>] (gether_connect+0x3c/0x19c [g_cdc]) from [<bf01ba1c>] (ecm_set_alt+0x15c/0x180 [g_cdc]) [<bf01ba1c>] (ecm_set_alt+0x15c/0x180 [g_cdc]) from [<bf01ecd4>] (composite_setup+0x85c/0xac4 [g_cdc]) [<bf01ecd4>] (composite_setup+0x85c/0xac4 [g_cdc]) from [<c027b744>] (musb_g_ep0_irq+0x844/0x924) [<c027b744>] (musb_g_ep0_irq+0x844/0x924) from [<c027a97c>] (musb_interrupt+0x79c/0x864) [<c027a97c>] (musb_interrupt+0x79c/0x864) from [<c027aaa8>] (generic_interrupt+0x64/0x7c) [<c027aaa8>] (generic_interrupt+0x64/0x7c) from [<c00797cc>] (handle_irq_event_percpu+0x28/0x178) ...  Cc: stable@vger.kernel.org # v3.1+ Signed-off-by: Grazvydas Ignotas <notasas@gmail.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | musb_debug.h | s | 2.2K | 54 | Vladimir Zapolskiy | vladimir.zapolskiy@nokia.com | 1324466462 |  | usb: musb: remove extern qualifier from musb_debug.h header  This change removes confusing extern qualifier, which doesn't have any practical sense there.  Signed-off-by: Vladimir Zapolskiy <vladimir.zapolskiy@nokia.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | cppi_dma.h | s | 3.2K | 99 | Alexey Dobriyan | adobriyan@gmail.com | 1247426554 |  | headers: smp_lock.h redux  * Remove smp_lock.h from files which don't need it (including some headers!) * Add smp_lock.h to files which do need it * Make smp_lock.h include conditional in hardirq.h   It's needed only for one kernel_locked() usage which is under CONFIG_PREEMPT    This will make hardirq.h inclusion cheaper for every PREEMPT=n config   (which includes allmodconfig/allyesconfig, BTW)  Signed-off-by: Alexey Dobriyan <adobriyan@gmail.com> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | musb_core.c | s | 66K | 2079 | Ajay Kumar Gupta | ajay.gupta@ti.com | 1336129174 |  | usb: musb: Add support for ti81xx platform  TI81XX platform has two musb interfaces and uses CPPI4.1 DMA engine. It has builtin USB PHYs as AM35x. The current set of patches adds support for one instance and only in PIO mode.  [ balbi@ti.com : make it compile and solve a "may be used 	uninitialized" warning ]  Signed-off-by: Ajay Kumar Gupta <ajay.gupta@ti.com> Signed-off-by: Ravi Babu <ravibabu@ti.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | Kconfig | g | 3.3K |  | Ajay Kumar Gupta | ajay.gupta@ti.com | 1336129175 |  | usb: musb: enable support for am335x  Enabled the flag so that musb_dsps glue file can be used for am335x  Signed-off-by: Ajay Kumar Gupta <ajay.gupta@ti.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | tusb6010_omap.c | s | 18K | 592 | Felipe Balbi | balbi@ti.com | 1313139170 |  | usb: musb: tusb6010: fix compilation  earlier commits have broken compilation of tusb6010 glue layer, fix it.  Signed-off-by: Felipe Balbi <balbi@ti.com>
f | musb_host.h | s | 3.5K | 91 | Felipe Balbi | balbi@ti.com | 1309555870 |  | usb: musb: drop a gigantic amount of ifdeferry  the MUSB IP is always OTG, so there's no point in adding so many ifdefs on the code. Drop those and always compile the driver for OTG support.  This also allows us to drop the useless "driver mode" choice. For doing that, we need to make musb depend on both Host and Peripheral side.  Signed-off-by: Felipe Balbi <balbi@ti.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | blackfin.c | s | 14K | 488 | Greg Kroah-Hartman | gregkh@linuxfoundation.org | 1330620333 |  | 
f | musb_dma.h | s | 6.1K | 168 | Mian Yousaf Kaukab | mian.yousaf.kaukab@stericsson.com | 1296549690 |  | usb: musb: introduce api for dma code to check compatibility with usb request  Gadget MUSB driver handles dma mappings in musb_gadget_queue(). Where as it is possible for  dma code to reject the usb request later at ->channel_program() called from txstate()/rxstate()  For example ->channel_program in tusb6010_omap.c:  static int tusb_omap_dma_program(struct dma_channel *channel, u16 packet_sz,         u8 rndis_mode, dma_addr_t dma_addr, u32 len) { ... 	if (unlikely(dma_addr & 0x1) |||| (len < 32) |||| (len > packet_sz)) 		return false; ... 	if (dma_addr & 0x2) 		return false; ... }  In this case, usb request will be handled in PIO mode which renders dma mapping operations unnecessary.  This patch adds an api to allow dma code to indicate incompatibility with usb request. Gadget musb driver call this api, if available, before dma mappings to avoid any unnecessary mapping operations.  Signed-off-by: Mian Yousaf Kaukab <mian.yousaf.kaukab@stericsson.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | blackfin.h | s | 2.7K | 75 | Felipe Balbi | balbi@ti.com | 1309555870 |  | usb: musb: drop a gigantic amount of ifdeferry  the MUSB IP is always OTG, so there's no point in adding so many ifdefs on the code. Drop those and always compile the driver for OTG support.  This also allows us to drop the useless "driver mode" choice. For doing that, we need to make musb depend on both Host and Peripheral side.  Signed-off-by: Felipe Balbi <balbi@ti.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | davinci.h | s | 3.3K | 87 | Jon Povey | jon.povey@racelogic.co.uk | 1338823782 |  | usb: musb: davinci: Fix build breakage  This appears to have been broken by commit 5cfb19ac604a68c030b245561f575c2d1bac1d49 (ARM: davinci: streamline sysmod access)  For now, fix by hardcoding USB_PHY_CTRL and DM355_DEEPSLEEP  Tested on DM365 with defconfig changes.  Signed-off-by: Jon Povey <jon.povey@racelogic.co.uk> Acked-by: Sekhar Nori <nsekhar@ti.com> CC: Felipe Balbi <balbi@ti.com> Cc: <stable@vger.kernel.org> # v3.4.x Signed-off-by: Felipe Balbi <balbi@ti.com>
f | ux500.c | s | 4.6K | 176 | Greg Kroah-Hartman | gregkh@linuxfoundation.org | 1330620333 |  | 
