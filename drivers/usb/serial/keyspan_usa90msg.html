<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › usb › serial › keyspan_usa90msg.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>keyspan_usa90msg.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">	usa90msg.h</span>

<span class="cm">	Copyright (c) 1998-2003 InnoSys Incorporated.  All Rights Reserved</span>
<span class="cm">	This file is available under a BSD-style copyright</span>

<span class="cm">	Keyspan USB Async Message Formats for the USA19HS</span>

<span class="cm">	Redistribution and use in source and binary forms, with or without</span>
<span class="cm">	modification, are permitted provided that the following conditions are</span>
<span class="cm">	met:</span>

<span class="cm">	1. Redistributions of source code must retain this licence text</span>
<span class="cm">   	without modification, this list of conditions, and the following</span>
<span class="cm">   	disclaimer.  The following copyright notice must appear immediately at</span>
<span class="cm">   	the beginning of all source files:</span>

<span class="cm">        	Copyright (c) 1998-2003 InnoSys Incorporated.  All Rights Reserved</span>

<span class="cm">        	This file is available under a BSD-style copyright</span>

<span class="cm">	2. The name of InnoSys Incorporated may not be used to endorse or promote</span>
<span class="cm">   	products derived from this software without specific prior written</span>
<span class="cm">   	permission.</span>

<span class="cm">	THIS SOFTWARE IS PROVIDED BY INNOSYS CORP. ``AS IS&#39;&#39; AND ANY EXPRESS OR</span>
<span class="cm">	IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span>
<span class="cm">	OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN</span>
<span class="cm">	NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,</span>
<span class="cm">	INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<span class="cm">	(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="cm">	SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="cm">	CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<span class="cm">	LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
<span class="cm">	OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
<span class="cm">	SUCH DAMAGE.    </span>

<span class="cm">	Revisions:</span>

<span class="cm">	2003feb14		add setTxMode/txMode  and cancelRxXoff to portControl</span>
<span class="cm">	2003mar21		change name of PARITY_0/1 to add MARK/SPACE</span>
<span class="cm">*/</span>

<span class="cp">#ifndef	__USA90MSG__</span>
<span class="cp">#define	__USA90MSG__</span>

<span class="k">struct</span> <span class="n">keyspan_usa90_portControlMessage</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">		there are three types of &quot;commands&quot; sent in the control message:</span>

<span class="cm">		1.	configuration changes which must be requested by setting</span>
<span class="cm">			the corresponding &quot;set&quot; flag (and should only be requested</span>
<span class="cm">			when necessary, to reduce overhead on the device):</span>
<span class="cm">	*/</span>

	<span class="n">u8</span>	<span class="n">setClocking</span><span class="p">,</span>	<span class="c1">// host requests baud rate be set</span>
		<span class="n">baudLo</span><span class="p">,</span>			<span class="c1">// host does baud divisor calculation</span>
		<span class="n">baudHi</span><span class="p">,</span>			<span class="c1">// host does baud divisor calculation </span>
		
		<span class="n">setLcr</span><span class="p">,</span>			<span class="c1">// host requests lcr be set</span>
		<span class="n">lcr</span><span class="p">,</span>			<span class="c1">// use PARITY, STOPBITS, DATABITS below</span>
		
		<span class="n">setRxMode</span><span class="p">,</span>		<span class="c1">// set receive mode</span>
		<span class="n">rxMode</span><span class="p">,</span>			<span class="c1">// RXMODE_DMA or RXMODE_BYHAND</span>

		<span class="n">setTxMode</span><span class="p">,</span>		<span class="c1">// set transmit mode</span>
		<span class="n">txMode</span><span class="p">,</span>			<span class="c1">// TXMODE_DMA or TXMODE_BYHAND</span>

		<span class="n">setTxFlowControl</span><span class="p">,</span>	<span class="c1">// host requests tx flow control be set</span>
		<span class="n">txFlowControl</span>	<span class="p">,</span>	<span class="c1">// use TX_FLOW... bits below</span>
		<span class="n">setRxFlowControl</span><span class="p">,</span>	<span class="c1">// host requests rx flow control be set</span>
		<span class="n">rxFlowControl</span><span class="p">,</span>	<span class="c1">// use RX_FLOW... bits below</span>
		<span class="n">sendXoff</span><span class="p">,</span>		<span class="c1">// host requests XOFF transmitted immediately</span>
		<span class="n">sendXon</span><span class="p">,</span>		<span class="c1">// host requests XON char transmitted</span>
		<span class="n">xonChar</span><span class="p">,</span>		<span class="c1">// specified in current character format</span>
		<span class="n">xoffChar</span><span class="p">,</span>		<span class="c1">// specified in current character format</span>

		<span class="n">sendChar</span><span class="p">,</span>		<span class="c1">// host requests char transmitted immediately</span>
		<span class="n">txChar</span><span class="p">,</span>			<span class="c1">// character to send</span>

		<span class="n">setRts</span><span class="p">,</span>			<span class="c1">// host requests RTS output be set</span>
		<span class="n">rts</span><span class="p">,</span>			<span class="c1">// 1=on, 0=off</span>
		<span class="n">setDtr</span><span class="p">,</span> 		<span class="c1">// host requests DTR output be set</span>
		<span class="n">dtr</span><span class="p">;</span>			<span class="c1">// 1=on, 0=off</span>

	
	<span class="cm">/*</span>
<span class="cm">		2.	configuration data which is simply used as is </span>
<span class="cm">			and must be specified correctly in every host message.</span>
<span class="cm">	*/</span>

	<span class="n">u8</span>	<span class="n">rxForwardingLength</span><span class="p">,</span>  <span class="c1">// forward when this number of chars available</span>
		<span class="n">rxForwardingTimeout</span><span class="p">,</span> <span class="c1">// (1-31 in ms)</span>
		<span class="n">txAckSetting</span><span class="p">;</span>	   <span class="c1">// 0=don&#39;t ack, 1=normal, 2-255 TBD...</span>
	<span class="cm">/*</span>
<span class="cm">		3.	Firmware states which cause actions if they change					</span>
<span class="cm">		and must be specified correctly in every host message.</span>
<span class="cm">	*/</span>

	<span class="n">u8</span>	<span class="n">portEnabled</span><span class="p">,</span>	<span class="c1">// 0=disabled, 1=enabled</span>
		<span class="n">txFlush</span><span class="p">,</span>		<span class="c1">// 0=normal, 1=toss outbound data</span>
		<span class="n">txBreak</span><span class="p">,</span>		<span class="c1">// 0=break off, 1=break on</span>
		<span class="n">loopbackMode</span><span class="p">;</span>	<span class="c1">// 0=no loopback, 1=loopback enabled</span>

	<span class="cm">/*</span>
<span class="cm">		4.	commands which are flags only; these are processed in order</span>
<span class="cm">			(so that, e.g., if rxFlush and rxForward flags are set, the</span>
<span class="cm">			port will have no data to forward); any non-zero value </span>
<span class="cm">			is respected</span>
<span class="cm">	*/</span>

	<span class="n">u8</span>	<span class="n">rxFlush</span><span class="p">,</span>		<span class="c1">// toss inbound data</span>
		<span class="n">rxForward</span><span class="p">,</span>		<span class="c1">// forward all inbound data, NOW (as if fwdLen==1)</span>
		<span class="n">cancelRxXoff</span><span class="p">,</span>	<span class="c1">// cancel any receive XOFF state (_txXoff)</span>
		<span class="n">returnStatus</span><span class="p">;</span>	<span class="c1">// return current status NOW</span>
<span class="p">};</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>defines for bits in lcr</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define		USA_DATABITS_5		0x00</span>
<span class="cp">#define		USA_DATABITS_6		0x01</span>
<span class="cp">#define		USA_DATABITS_7		0x02</span>
<span class="cp">#define		USA_DATABITS_8		0x03</span>
<span class="cp">#define		STOPBITS_5678_1		0x00	</span><span class="c1">// 1 stop bit for all byte sizes</span>
<span class="cp">#define		STOPBITS_5_1p5		0x04	</span><span class="c1">// 1.5 stop bits for 5-bit byte</span>
<span class="cp">#define		STOPBITS_678_2		0x04	</span><span class="c1">// 2 stop bits for 6-8 bit byte</span>
<span class="cp">#define		USA_PARITY_NONE		0x00</span>
<span class="cp">#define		USA_PARITY_ODD		0x08</span>
<span class="cp">#define		USA_PARITY_EVEN		0x18</span>
<span class="cp">#define		PARITY_MARK_1  		0x28   	</span><span class="c1">// force parity MARK</span>
<span class="cp">#define		PARITY_SPACE_0 		0x38	</span><span class="c1">// force parity SPACE</span>

<span class="cp">#define		TXFLOW_CTS			0x04	</span>
<span class="cp">#define		TXFLOW_DSR			0x08</span>
<span class="cp">#define		TXFLOW_XOFF			0x01	</span>
<span class="cp">#define		TXFLOW_XOFF_ANY		0x02	</span>
<span class="cp">#define		TXFLOW_XOFF_BITS	(TXFLOW_XOFF | TXFLOW_XOFF_ANY)</span>

<span class="cp">#define		RXFLOW_XOFF			0x10	</span>
<span class="cp">#define		RXFLOW_RTS			0x20	</span>
<span class="cp">#define		RXFLOW_DTR			0x40</span>
<span class="cp">#define		RXFLOW_DSR_SENSITIVITY	0x80</span>

<span class="cp">#define		RXMODE_BYHAND		0x00	</span>
<span class="cp">#define		RXMODE_DMA			0x02	</span>

<span class="cp">#define		TXMODE_BYHAND		0x00	</span>
<span class="cp">#define		TXMODE_DMA			0x02	</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>all things called "StatusMessage" are sent on the status endpoint</p></td><td class="code"><div class="highlight"><pre><span class="k">struct</span> <span class="n">keyspan_usa90_portStatusMessage</span>	
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">msr</span><span class="p">,</span>			<span class="c1">// reports the actual MSR register</span>
		<span class="n">cts</span><span class="p">,</span>			<span class="c1">// reports CTS pin</span>
		<span class="n">dcd</span><span class="p">,</span>			<span class="c1">// reports DCD pin</span>
		<span class="n">dsr</span><span class="p">,</span>			<span class="c1">// reports DSR pin</span>
		<span class="n">ri</span><span class="p">,</span>				<span class="c1">// reports RI pin</span>
		<span class="n">_txXoff</span><span class="p">,</span>		<span class="c1">// port is in XOFF state (we received XOFF)</span>
		<span class="n">rxBreak</span><span class="p">,</span>		<span class="c1">// reports break state</span>
		<span class="n">rxOverrun</span><span class="p">,</span>		<span class="c1">// count of overrun errors (since last reported)</span>
		<span class="n">rxParity</span><span class="p">,</span>		<span class="c1">// count of parity errors (since last reported)</span>
		<span class="n">rxFrame</span><span class="p">,</span>		<span class="c1">// count of frame errors (since last reported)</span>
		<span class="n">portState</span><span class="p">,</span>		<span class="c1">// PORTSTATE_xxx bits (useful for debugging)</span>
		<span class="n">messageAck</span><span class="p">,</span>		<span class="c1">// message acknowledgement</span>
		<span class="n">charAck</span><span class="p">,</span>		<span class="c1">// character acknowledgement</span>
		<span class="n">controlResponse</span><span class="p">;</span>	<span class="c1">// (value = returnStatus) a control message has been processed </span>
<span class="p">};</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>bits in RX data message when STAT byte is included</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define	RXERROR_OVERRUN		0x02</span>
<span class="cp">#define	RXERROR_PARITY		0x04</span>
<span class="cp">#define	RXERROR_FRAMING		0x08</span>
<span class="cp">#define	RXERROR_BREAK		0x10</span>

<span class="cp">#define	PORTSTATE_ENABLED	0x80</span>
<span class="cp">#define	PORTSTATE_TXFLUSH	0x01</span>
<span class="cp">#define	PORTSTATE_TXBREAK	0x02</span>
<span class="cp">#define	PORTSTATE_LOOPBACK 	0x04</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>MSR bits</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define USA_MSR_dCTS	  		0x01		</span><span class="c1">// CTS has changed since last report	</span>
<span class="cp">#define USA_MSR_dDSR	  		0x02</span>
<span class="cp">#define USA_MSR_dRI			0x04</span>
<span class="cp">#define USA_MSR_dDCD	  		0x08</span>

<span class="cp">#define USA_MSR_CTS			0x10	  	</span><span class="c1">// current state of CTS</span>
<span class="cp">#define USA_MSR_DSR			0x20</span>
<span class="cp">#define USA_USA_MSR_RI			0x40</span>
<span class="cp">#define MSR_DCD				0x80</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>ie: the maximum length of an endpoint buffer</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define		MAX_DATA_LEN			64</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
