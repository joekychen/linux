<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › usb › serial › keyspan_usa26msg.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>keyspan_usa26msg.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">	usa26msg.h</span>

<span class="cm">	Copyright (C) 1998-2000 InnoSys Incorporated.  All Rights Reserved</span>
<span class="cm">	This file is available under a BSD-style copyright</span>

<span class="cm">	Keyspan USB Async Message Formats for the USA28X</span>

<span class="cm">	Redistribution and use in source and binary forms, with or without</span>
<span class="cm">	modification, are permitted provided that the following conditions are</span>
<span class="cm">	met:</span>

<span class="cm">	1. Redistributions of source code must retain this licence text</span>
<span class="cm">   	without modification, this list of conditions, and the following</span>
<span class="cm">   	disclaimer.  The following copyright notice must appear immediately at</span>
<span class="cm">   	the beginning of all source files:</span>

<span class="cm">        	Copyright (C) 1998-2000 InnoSys Incorporated.  All Rights Reserved</span>

<span class="cm">        	This file is available under a BSD-style copyright</span>

<span class="cm">	2. The name of InnoSys Incorporated may not be used to endorse or promote</span>
<span class="cm">   	products derived from this software without specific prior written</span>
<span class="cm">   	permission.</span>

<span class="cm">	THIS SOFTWARE IS PROVIDED BY INNOSYS CORP. ``AS IS&#39;&#39; AND ANY EXPRESS OR</span>
<span class="cm">	IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span>
<span class="cm">	OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN</span>
<span class="cm">	NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,</span>
<span class="cm">	INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<span class="cm">	(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="cm">	SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="cm">	CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<span class="cm">	LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
<span class="cm">	OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
<span class="cm">	SUCH DAMAGE.    </span>

<span class="cm">	Third revision: USA28X version (aka USA26)</span>

<span class="cm">	Buffer formats for RX/TX data messages are not defined by</span>
<span class="cm">	a structure, but are described here:</span>

<span class="cm">	USB OUT (host -&gt; USAxx, transmit) messages contain a </span>
<span class="cm">	REQUEST_ACK indicator (set to 0xff to request an ACK at the </span>
<span class="cm">	completion of transmit; 0x00 otherwise), followed by data:</span>

<span class="cm">		RQSTACK DAT DAT DAT ...</span>

<span class="cm">	with a total data length of 63.</span>

<span class="cm">	USB IN (USAxx -&gt; host, receive) messages begin with a status</span>
<span class="cm">	byte in which the 0x80 bit is either:</span>

<span class="cm">		(a)	0x80 bit clear</span>
<span class="cm">			indicates that the bytes following it are all data</span>
<span class="cm">			bytes:</span>

<span class="cm">				STAT DATA DATA DATA DATA DATA ...</span>

<span class="cm">			for a total of up to 63 DATA bytes,</span>

<span class="cm">	or:</span>

<span class="cm">		(b)	0x80 bit set</span>
<span class="cm">			indiates that the bytes following alternate data and</span>
<span class="cm">			status bytes:</span>

<span class="cm">				STAT DATA STAT DATA STAT DATA STAT DATA ...</span>

<span class="cm">			for a total of up to 32 DATA bytes.</span>

<span class="cm">	The valid bits in the STAT bytes are:</span>

<span class="cm">		OVERRUN	0x02</span>
<span class="cm">		PARITY	0x04</span>
<span class="cm">		FRAMING	0x08</span>
<span class="cm">		BREAK	0x10</span>

<span class="cm">	Notes:</span>

<span class="cm">	(1) The OVERRUN bit can appear in either (a) or (b) format</span>
<span class="cm">		messages, but the but the PARITY/FRAMING/BREAK bits</span>
<span class="cm">		only appear in (b) format messages.</span>
<span class="cm">	(2) For the host to determine the exact point at which the</span>
<span class="cm">		overrun occurred (to identify the point in the data</span>
<span class="cm">		stream at which the data was lost), it needs to count</span>
<span class="cm">		128 characters, starting at the first character of the</span>
<span class="cm">		message in which OVERRUN was reported; the lost character(s)</span>
<span class="cm">		would have been received between the 128th and 129th</span>
<span class="cm">		characters.</span>
<span class="cm">	(3)	An RX data message in which the first byte has 0x80 clear</span>
<span class="cm">		serves as a &quot;break off&quot; indicator.</span>

<span class="cm">	revision history:</span>

<span class="cm">	1999feb10	add reportHskiaChanges to allow us to ignore them</span>
<span class="cm">	1999feb10	add txAckThreshold for fast+loose throughput enhancement</span>
<span class="cm">	1999mar30	beef up support for RX error reporting</span>
<span class="cm">	1999apr14	add resetDataToggle to control message</span>
<span class="cm">	2000jan04	merge with usa17msg.h</span>
<span class="cm">	2000jun01	add extended BSD-style copyright text</span>
<span class="cm">	2001jul05	change message format to improve OVERRUN case</span>

<span class="cm">	Note on shared names:</span>

<span class="cm">	In the case of fields which have been merged between the USA17</span>
<span class="cm">	and USA26 definitions, the USA26 definition is the first part</span>
<span class="cm">	of the name and the USA17 definition is the second part of the</span>
<span class="cm">	name; both meanings are described below.</span>
<span class="cm">*/</span>

<span class="cp">#ifndef	__USA26MSG__</span>
<span class="cp">#define	__USA26MSG__</span>


<span class="k">struct</span> <span class="n">keyspan_usa26_portControlMessage</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">		there are three types of &quot;commands&quot; sent in the control message:</span>

<span class="cm">		1.	configuration changes which must be requested by setting</span>
<span class="cm">			the corresponding &quot;set&quot; flag (and should only be requested</span>
<span class="cm">			when necessary, to reduce overhead on the USA26):</span>
<span class="cm">	*/</span>
	<span class="n">u8</span>	<span class="n">setClocking</span><span class="p">,</span>	<span class="c1">// BOTH: host requests baud rate be set</span>
		<span class="n">baudLo</span><span class="p">,</span>		<span class="c1">// BOTH: host does baud divisor calculation</span>
		<span class="n">baudHi</span><span class="p">,</span>		<span class="c1">// BOTH: baudHi is only used for first port (gives lower rates)</span>
		<span class="n">externalClock_txClocking</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>USA26: 0=internal, other=external
USA17: 0=internal, other=external/RI</p></td><td class="code"><div class="highlight"><pre>		<span class="n">rxClocking</span><span class="p">,</span>		<span class="c1">// USA17: 0=internal, 1=external/RI, other=external/DSR</span>


		<span class="n">setLcr</span><span class="p">,</span>			<span class="c1">// BOTH: host requests lcr be set</span>
		<span class="n">lcr</span><span class="p">,</span>			<span class="c1">// BOTH: use PARITY, STOPBITS, DATABITS below</span>

		<span class="n">setFlowControl</span><span class="p">,</span>		<span class="c1">// BOTH: host requests flow control be set</span>
		<span class="n">ctsFlowControl</span><span class="p">,</span>		<span class="c1">// BOTH: 1=use CTS flow control, 0=don&#39;t</span>
		<span class="n">xonFlowControl</span><span class="p">,</span>		<span class="c1">// BOTH: 1=use XON/XOFF flow control, 0=don&#39;t</span>
		<span class="n">xonChar</span><span class="p">,</span>		<span class="c1">// BOTH: specified in current character format</span>
		<span class="n">xoffChar</span><span class="p">,</span>		<span class="c1">// BOTH: specified in current character format</span>

		<span class="n">setTxTriState_setRts</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>USA26: host requests TX tri-state be set
USA17: host requests RTS output be set</p></td><td class="code"><div class="highlight"><pre>		<span class="n">txTriState_rts</span><span class="p">,</span>		<span class="c1">// BOTH: 1=active (normal), 0=tristate (off)</span>

		<span class="n">setHskoa_setDtr</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>USA26: host requests HSKOA output be set
USA17: host requests DTR output be set</p></td><td class="code"><div class="highlight"><pre>		<span class="n">hskoa_dtr</span><span class="p">,</span>		<span class="c1">// BOTH: 1=on, 0=off</span>

		<span class="n">setPrescaler</span><span class="p">,</span>		<span class="c1">// USA26: host requests prescalar be set (default: 13)</span>
		<span class="n">prescaler</span><span class="p">;</span>		<span class="c1">// BOTH: specified as N/8; values 8-ff are valid</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>must be set any time internal baud rate is set;
must not be set when external clocking is used
note: in USA17, prescaler is applied whenever
setClocking is requested</p></td><td class="code"><div class="highlight"><pre>	<span class="cm">/*</span>
<span class="cm">		3.	configuration data which is simply used as is (no overhead,</span>
<span class="cm">			but must be specified correctly in every host message).</span>
<span class="cm">	*/</span>
	<span class="n">u8</span>	<span class="n">forwardingLength</span><span class="p">,</span>  <span class="c1">// BOTH: forward when this number of chars available</span>
		<span class="n">reportHskiaChanges_dsrFlowControl</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>USA26: 1=normal; 0=ignore external clock
USA17: 1=use DSR flow control, 0=don't</p></td><td class="code"><div class="highlight"><pre>		<span class="n">txAckThreshold</span><span class="p">,</span>	<span class="c1">// BOTH: 0=not allowed, 1=normal, 2-255 deliver ACK faster</span>
		<span class="n">loopbackMode</span><span class="p">;</span>	<span class="c1">// BOTH: 0=no loopback, 1=loopback enabled</span>

	<span class="cm">/*</span>
<span class="cm">		4.	commands which are flags only; these are processed in order</span>
<span class="cm">			(so that, e.g., if both _txOn and _txOff flags are set, the</span>
<span class="cm">			port ends in a TX_OFF state); any non-zero value is respected</span>
<span class="cm">	*/</span>
	<span class="n">u8</span>	<span class="n">_txOn</span><span class="p">,</span>			<span class="c1">// BOTH: enable transmitting (and continue if there&#39;s data)</span>
		<span class="n">_txOff</span><span class="p">,</span>			<span class="c1">// BOTH: stop transmitting</span>
		<span class="n">txFlush</span><span class="p">,</span>		<span class="c1">// BOTH: toss outbound data</span>
		<span class="n">txBreak</span><span class="p">,</span>		<span class="c1">// BOTH: turn on break (cleared by _txOn)</span>
		<span class="n">rxOn</span><span class="p">,</span>			<span class="c1">// BOTH: turn on receiver</span>
		<span class="n">rxOff</span><span class="p">,</span>			<span class="c1">// BOTH: turn off receiver</span>
		<span class="n">rxFlush</span><span class="p">,</span>		<span class="c1">// BOTH: toss inbound data</span>
		<span class="n">rxForward</span><span class="p">,</span>		<span class="c1">// BOTH: forward all inbound data, NOW (as if fwdLen==1)</span>
		<span class="n">returnStatus</span><span class="p">,</span>	<span class="c1">// BOTH: return current status (even if it hasn&#39;t changed)</span>
		<span class="n">resetDataToggle</span><span class="p">;</span><span class="c1">// BOTH: reset data toggle state to DATA0</span>
	
<span class="p">};</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>defines for bits in lcr</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define	USA_DATABITS_5		0x00</span>
<span class="cp">#define	USA_DATABITS_6		0x01</span>
<span class="cp">#define	USA_DATABITS_7		0x02</span>
<span class="cp">#define	USA_DATABITS_8		0x03</span>
<span class="cp">#define	STOPBITS_5678_1	0x00	</span><span class="c1">// 1 stop bit for all byte sizes</span>
<span class="cp">#define	STOPBITS_5_1p5	0x04	</span><span class="c1">// 1.5 stop bits for 5-bit byte</span>
<span class="cp">#define	STOPBITS_678_2	0x04	</span><span class="c1">// 2 stop bits for 6/7/8-bit byte</span>
<span class="cp">#define	USA_PARITY_NONE		0x00</span>
<span class="cp">#define	USA_PARITY_ODD		0x08</span>
<span class="cp">#define	USA_PARITY_EVEN		0x18</span>
<span class="cp">#define	PARITY_1		0x28</span>
<span class="cp">#define	PARITY_0		0x38</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>all things called "StatusMessage" are sent on the status endpoint</p></td><td class="code"><div class="highlight"><pre><span class="k">struct</span> <span class="n">keyspan_usa26_portStatusMessage</span>	<span class="c1">// one for each port</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">port</span><span class="p">,</span>			<span class="c1">// BOTH: 0=first, 1=second, other=see below</span>
		<span class="n">hskia_cts</span><span class="p">,</span>		<span class="c1">// USA26: reports HSKIA pin</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>USA17: reports CTS pin</p></td><td class="code"><div class="highlight"><pre>		<span class="n">gpia_dcd</span><span class="p">,</span>		<span class="c1">// USA26: reports GPIA pin</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>USA17: reports DCD pin</p></td><td class="code"><div class="highlight"><pre>		<span class="n">dsr</span><span class="p">,</span>			<span class="c1">// USA17: reports DSR pin</span>
		<span class="n">ri</span><span class="p">,</span>				<span class="c1">// USA17: reports RI pin</span>
		<span class="n">_txOff</span><span class="p">,</span>			<span class="c1">// port has been disabled (by host)</span>
		<span class="n">_txXoff</span><span class="p">,</span>		<span class="c1">// port is in XOFF state (either host or RX XOFF)</span>
		<span class="n">rxEnabled</span><span class="p">,</span>		<span class="c1">// as configured by rxOn/rxOff 1=on, 0=off</span>
		<span class="n">controlResponse</span><span class="p">;</span><span class="c1">// 1=a control message has been processed</span>
<span class="p">};</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>bits in RX data message when STAT byte is included</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define	RXERROR_OVERRUN	0x02</span>
<span class="cp">#define	RXERROR_PARITY	0x04</span>
<span class="cp">#define	RXERROR_FRAMING	0x08</span>
<span class="cp">#define	RXERROR_BREAK	0x10</span>

<span class="k">struct</span> <span class="n">keyspan_usa26_globalControlMessage</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">sendGlobalStatus</span><span class="p">,</span>	<span class="c1">// 2=request for two status responses</span>
		<span class="n">resetStatusToggle</span><span class="p">,</span>	<span class="c1">// 1=reset global status toggle</span>
		<span class="n">resetStatusCount</span><span class="p">;</span>	<span class="c1">// a cycling value</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">keyspan_usa26_globalStatusMessage</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">port</span><span class="p">,</span>				<span class="c1">// 3</span>
		<span class="n">sendGlobalStatus</span><span class="p">,</span>	<span class="c1">// from request, decremented</span>
		<span class="n">resetStatusCount</span><span class="p">;</span>	<span class="c1">// as in request</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">keyspan_usa26_globalDebugMessage</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">port</span><span class="p">,</span>				<span class="c1">// 2</span>
		<span class="n">a</span><span class="p">,</span>
		<span class="n">b</span><span class="p">,</span>
		<span class="n">c</span><span class="p">,</span>
		<span class="n">d</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>ie: the maximum length of an EZUSB endpoint buffer</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define	MAX_DATA_LEN			64</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>update status approx. 60 times a second (16.6666 ms)</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define	STATUS_UPDATE_INTERVAL	16</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>status rationing tuning value (each port gets checked each n ms)</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define	STATUS_RATION	10</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
