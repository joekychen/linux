<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › usb › serial › keyspan_usa28msg.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>keyspan_usa28msg.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">	usa28msg.h</span>

<span class="cm">	Copyright (C) 1998-2000 InnoSys Incorporated.  All Rights Reserved</span>
<span class="cm">	This file is available under a BSD-style copyright</span>

<span class="cm">	Keyspan USB Async Message Formats for the USA26X</span>

<span class="cm">	Redistribution and use in source and binary forms, with or without</span>
<span class="cm">	modification, are permitted provided that the following conditions are</span>
<span class="cm">	met:</span>

<span class="cm">	1. Redistributions of source code must retain this licence text</span>
<span class="cm">   	without modification, this list of conditions, and the following</span>
<span class="cm">   	disclaimer.  The following copyright notice must appear immediately at</span>
<span class="cm">   	the beginning of all source files:</span>

<span class="cm">        	Copyright (C) 1998-2000 InnoSys Incorporated.  All Rights Reserved</span>

<span class="cm">        	This file is available under a BSD-style copyright</span>

<span class="cm">	2. The name of InnoSys Incorporated may not be used to endorse or promote</span>
<span class="cm">   	products derived from this software without specific prior written</span>
<span class="cm">   	permission.</span>

<span class="cm">	THIS SOFTWARE IS PROVIDED BY INNOSYS CORP. ``AS IS&#39;&#39; AND ANY EXPRESS OR</span>
<span class="cm">	IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span>
<span class="cm">	OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN</span>
<span class="cm">	NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,</span>
<span class="cm">	INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<span class="cm">	(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="cm">	SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="cm">	CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<span class="cm">	LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
<span class="cm">	OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
<span class="cm">	SUCH DAMAGE.    </span>

<span class="cm">	Note: these message formats are common to USA18, USA19, and USA28;</span>
<span class="cm">	(for USA28X, see usa26msg.h)</span>

<span class="cm">	Buffer formats for RX/TX data messages are not defined by</span>
<span class="cm">	a structure, but are described here:</span>

<span class="cm">	USB OUT (host -&gt; USA28, transmit) messages contain a </span>
<span class="cm">	REQUEST_ACK indicator (set to 0xff to request an ACK at the </span>
<span class="cm">	completion of transmit; 0x00 otherwise), followed by data.</span>
<span class="cm">	If the port is configured for parity, the data will be an </span>
<span class="cm">	alternating string of parity and data bytes, so the message</span>
<span class="cm">	format will be:</span>

<span class="cm">		RQSTACK PAR DAT PAR DAT ...</span>

<span class="cm">	so the maximum length is 63 bytes (1 + 62, or 31 data bytes);</span>
<span class="cm">	always an odd number for the total message length.</span>

<span class="cm">	If there is no parity, the format is simply:</span>

<span class="cm">		RQSTACK DAT DAT DAT ...</span>

<span class="cm">	with a total data length of 63.</span>

<span class="cm">	USB IN (USA28 -&gt; host, receive) messages contain data and parity</span>
<span class="cm">	if parity is configred, thusly:</span>
<span class="cm">	</span>
<span class="cm">		DAT PAR DAT PAR DAT PAR ...</span>

<span class="cm">	for a total of 32 data bytes;</span>
<span class="cm">	</span>
<span class="cm">	If parity is not configured, the format is:</span>

<span class="cm">		DAT DAT DAT ...</span>

<span class="cm">	for a total of 64 data bytes.</span>

<span class="cm">	In the TX messages (USB OUT), the 0x01 bit of the PARity byte is </span>
<span class="cm">	the parity bit.  In the RX messages (USB IN), the PARity byte is </span>
<span class="cm">	the content of the 8051&#39;s status register; the parity bit </span>
<span class="cm">	(RX_PARITY_BIT) is the 0x04 bit.</span>

<span class="cm">	revision history:</span>

<span class="cm">	1999may06	add resetDataToggle to control message</span>
<span class="cm">	2000mar21	add rs232invalid to status response message</span>
<span class="cm">	2000apr04	add 230.4Kb definition to setBaudRate</span>
<span class="cm">	2000apr13	add/remove loopbackMode switch</span>
<span class="cm">	2000apr13	change definition of setBaudRate to cover 115.2Kb, too</span>
<span class="cm">	2000jun01	add extended BSD-style copyright text</span>
<span class="cm">*/</span>

<span class="cp">#ifndef	__USA28MSG__</span>
<span class="cp">#define	__USA28MSG__</span>


<span class="k">struct</span> <span class="n">keyspan_usa28_portControlMessage</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">		there are four types of &quot;commands&quot; sent in the control message:</span>

<span class="cm">		1.	configuration changes which must be requested by setting</span>
<span class="cm">			the corresponding &quot;set&quot; flag (and should only be requested</span>
<span class="cm">			when necessary, to reduce overhead on the USA28):</span>
<span class="cm">	*/</span>
	<span class="n">u8</span>	<span class="n">setBaudRate</span><span class="p">,</span>	<span class="c1">// 0=don&#39;t set, 1=baudLo/Hi, 2=115.2K, 3=230.4K</span>
		<span class="n">baudLo</span><span class="p">,</span>			<span class="c1">// host does baud divisor calculation</span>
		<span class="n">baudHi</span><span class="p">;</span>			<span class="c1">// baudHi is only used for first port (gives lower rates)</span>

	<span class="cm">/*</span>
<span class="cm">		2.	configuration changes which are done every time (because it&#39;s</span>
<span class="cm">			hardly more trouble to do them than to check whether to do them):</span>
<span class="cm">	*/</span>
	<span class="n">u8</span>	<span class="n">parity</span><span class="p">,</span>			<span class="c1">// 1=use parity, 0=don&#39;t</span>
		<span class="n">ctsFlowControl</span><span class="p">,</span>	        <span class="c1">// all except 19Q: 1=use CTS flow control, 0=don&#39;t</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>19Q: 0x08:CTSflowControl 0x10:DSRflowControl</p></td><td class="code"><div class="highlight"><pre>		<span class="n">xonFlowControl</span><span class="p">,</span>	<span class="c1">// 1=use XON/XOFF flow control, 0=don&#39;t</span>
		<span class="n">rts</span><span class="p">,</span>			<span class="c1">// 1=on, 0=off</span>
		<span class="n">dtr</span><span class="p">;</span>			<span class="c1">// 1=on, 0=off</span>

	<span class="cm">/*</span>
<span class="cm">		3.	configuration data which is simply used as is (no overhead,</span>
<span class="cm">			but must be correct in every host message).</span>
<span class="cm">	*/</span>
	<span class="n">u8</span>	<span class="n">forwardingLength</span><span class="p">,</span>  <span class="c1">// forward when this number of chars available</span>
		<span class="n">forwardMs</span><span class="p">,</span>		<span class="c1">// forward this many ms after last rx data</span>
		<span class="n">breakThreshold</span><span class="p">,</span>	<span class="c1">// specified in ms, 1-255 (see note below)</span>
		<span class="n">xonChar</span><span class="p">,</span>		<span class="c1">// specified in current character format</span>
		<span class="n">xoffChar</span><span class="p">;</span>		<span class="c1">// specified in current character format</span>

	<span class="cm">/*</span>
<span class="cm">		4.	commands which are flags only; these are processed in order</span>
<span class="cm">			(so that, e.g., if both _txOn and _txOff flags are set, the</span>
<span class="cm">			port ends in a TX_OFF state); any non-zero value is respected</span>
<span class="cm">	*/</span>
	<span class="n">u8</span>	<span class="n">_txOn</span><span class="p">,</span>			<span class="c1">// enable transmitting (and continue if there&#39;s data)</span>
		<span class="n">_txOff</span><span class="p">,</span>			<span class="c1">// stop transmitting</span>
		<span class="n">txFlush</span><span class="p">,</span>		<span class="c1">// toss outbound data</span>
		<span class="n">txForceXoff</span><span class="p">,</span>	<span class="c1">// pretend we&#39;ve received XOFF</span>
		<span class="n">txBreak</span><span class="p">,</span>		<span class="c1">// turn on break (leave on until txOn clears it)</span>
		<span class="n">rxOn</span><span class="p">,</span>			<span class="c1">// turn on receiver</span>
		<span class="n">rxOff</span><span class="p">,</span>			<span class="c1">// turn off receiver</span>
		<span class="n">rxFlush</span><span class="p">,</span>		<span class="c1">// toss inbound data</span>
		<span class="n">rxForward</span><span class="p">,</span>		<span class="c1">// forward all inbound data, NOW</span>
		<span class="n">returnStatus</span><span class="p">,</span>	<span class="c1">// return current status n times (1 or 2)</span>
		<span class="n">resetDataToggle</span><span class="p">;</span><span class="c1">// reset data toggle state to DATA0</span>
	
<span class="p">};</span>

<span class="k">struct</span> <span class="n">keyspan_usa28_portStatusMessage</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">port</span><span class="p">,</span>			<span class="c1">// 0=first, 1=second, 2=global (see below)</span>
		<span class="n">cts</span><span class="p">,</span>
		<span class="n">dsr</span><span class="p">,</span>			<span class="c1">// (not used in all products)</span>
		<span class="n">dcd</span><span class="p">,</span>

		<span class="n">ri</span><span class="p">,</span>				<span class="c1">// (not used in all products)</span>
		<span class="n">_txOff</span><span class="p">,</span>			<span class="c1">// port has been disabled (by host)</span>
		<span class="n">_txXoff</span><span class="p">,</span>		<span class="c1">// port is in XOFF state (either host or RX XOFF)</span>
		<span class="n">dataLost</span><span class="p">,</span>		<span class="c1">// count of lost chars; wraps; not guaranteed exact</span>

		<span class="n">rxEnabled</span><span class="p">,</span>		<span class="c1">// as configured by rxOn/rxOff 1=on, 0=off</span>
		<span class="n">rxBreak</span><span class="p">,</span>		<span class="c1">// 1=we&#39;re in break state</span>
		<span class="n">rs232invalid</span><span class="p">,</span>	<span class="c1">// 1=no valid signals on rs-232 inputs</span>
		<span class="n">controlResponse</span><span class="p">;</span><span class="c1">// 1=a control messages has been processed</span>
<span class="p">};</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>bit defines in txState</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define	TX_OFF			0x01	</span><span class="c1">// requested by host txOff command</span>
<span class="cp">#define	TX_XOFF			0x02	</span><span class="c1">// either real, or simulated by host</span>

<span class="k">struct</span> <span class="n">keyspan_usa28_globalControlMessage</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">sendGlobalStatus</span><span class="p">,</span>	<span class="c1">// 2=request for two status responses</span>
		<span class="n">resetStatusToggle</span><span class="p">,</span>	<span class="c1">// 1=reset global status toggle</span>
		<span class="n">resetStatusCount</span><span class="p">;</span>	<span class="c1">// a cycling value</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">keyspan_usa28_globalStatusMessage</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">port</span><span class="p">,</span>				<span class="c1">// 3</span>
		<span class="n">sendGlobalStatus</span><span class="p">,</span>	<span class="c1">// from request, decremented</span>
		<span class="n">resetStatusCount</span><span class="p">;</span>	<span class="c1">// as in request</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">keyspan_usa28_globalDebugMessage</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">port</span><span class="p">,</span>				<span class="c1">// 2</span>
		<span class="n">n</span><span class="p">,</span>					<span class="c1">// typically a count/status byte</span>
		<span class="n">b</span><span class="p">;</span>					<span class="c1">// typically a data byte</span>
<span class="p">};</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>ie: the maximum length of an EZUSB endpoint buffer</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define	MAX_DATA_LEN			64</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>the parity bytes have only one significant bit</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define	RX_PARITY_BIT			0x04</span>
<span class="cp">#define	TX_PARITY_BIT			0x01</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>update status approx. 60 times a second (16.6666 ms)</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define	STATUS_UPDATE_INTERVAL	16</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
