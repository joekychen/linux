<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › usb › storage › debug.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>debug.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* Driver for USB Mass Storage compliant devices</span>
<span class="cm"> * Debugging Functions Source Code File</span>
<span class="cm"> *</span>
<span class="cm"> * Current development and maintenance by:</span>
<span class="cm"> *   (c) 1999-2002 Matthew Dharm (mdharm-usb@one-eyed-alien.net)</span>
<span class="cm"> *</span>
<span class="cm"> * Developed with the assistance of:</span>
<span class="cm"> *   (c) 2002 Alan Stern &lt;stern@rowland.org&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Initial work by:</span>
<span class="cm"> *   (c) 1999 Michael Gee (michael@linuxspecific.com)</span>
<span class="cm"> *</span>
<span class="cm"> * This driver is based on the &#39;USB Mass Storage Class&#39; document. This</span>
<span class="cm"> * describes in detail the protocol used to communicate with such</span>
<span class="cm"> * devices.  Clearly, the designers had SCSI and ATAPI commands in</span>
<span class="cm"> * mind when they created this document.  The commands are all very</span>
<span class="cm"> * similar to commands in the SCSI-II and ATAPI specifications.</span>
<span class="cm"> *</span>
<span class="cm"> * It is important to note that in a number of cases this class</span>
<span class="cm"> * exhibits class-specific exemptions from the USB specification.</span>
<span class="cm"> * Notably the usage of NAK, STALL and ACK differs from the norm, in</span>
<span class="cm"> * that they are used to communicate wait, failed and OK on commands.</span>
<span class="cm"> *</span>
<span class="cm"> * Also, for certain devices, the interrupt endpoint is used to convey</span>
<span class="cm"> * status of a command.</span>
<span class="cm"> *</span>
<span class="cm"> * Please see http://www.one-eyed-alien.net/~mdharm/linux-usb for more</span>
<span class="cm"> * information about this driver.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> * under the terms of the GNU General Public License as published by the</span>
<span class="cm"> * Free Software Foundation; either version 2, or (at your option) any</span>
<span class="cm"> * later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> * General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along</span>
<span class="cm"> * with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/cdrom.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_cmnd.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_dbg.h&gt;</span>

<span class="cp">#include &quot;debug.h&quot;</span>
<span class="cp">#include &quot;scsi.h&quot;</span>


<span class="kt">void</span> <span class="nf">usb_stor_show_command</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">srb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">what</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">srb</span><span class="o">-&gt;</span><span class="n">cmnd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">TEST_UNIT_READY</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;TEST_UNIT_READY&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">REZERO_UNIT</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;REZERO_UNIT&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">REQUEST_SENSE</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;REQUEST_SENSE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">FORMAT_UNIT</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;FORMAT_UNIT&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_BLOCK_LIMITS</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_BLOCK_LIMITS&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">REASSIGN_BLOCKS</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;REASSIGN_BLOCKS&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_6</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_6&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WRITE_6</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;WRITE_6&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEEK_6</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEEK_6&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_REVERSE</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_REVERSE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WRITE_FILEMARKS</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;WRITE_FILEMARKS&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SPACE</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SPACE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">INQUIRY</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;INQUIRY&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RECOVER_BUFFERED_DATA</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;RECOVER_BUFFERED_DATA&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MODE_SELECT</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;MODE_SELECT&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RESERVE</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;RESERVE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RELEASE</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;RELEASE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">COPY</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;COPY&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ERASE</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;ERASE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MODE_SENSE</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;MODE_SENSE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">START_STOP</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;START_STOP&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RECEIVE_DIAGNOSTIC</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;RECEIVE_DIAGNOSTIC&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEND_DIAGNOSTIC</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEND_DIAGNOSTIC&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ALLOW_MEDIUM_REMOVAL</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;ALLOW_MEDIUM_REMOVAL&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SET_WINDOW</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SET_WINDOW&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_CAPACITY</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_CAPACITY&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_10</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_10&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WRITE_10</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;WRITE_10&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEEK_10</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEEK_10&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WRITE_VERIFY</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;WRITE_VERIFY&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">VERIFY</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;VERIFY&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEARCH_HIGH</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEARCH_HIGH&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEARCH_EQUAL</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEARCH_EQUAL&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEARCH_LOW</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEARCH_LOW&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SET_LIMITS</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SET_LIMITS&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_POSITION</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_POSITION&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SYNCHRONIZE_CACHE</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SYNCHRONIZE_CACHE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LOCK_UNLOCK_CACHE</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;LOCK_UNLOCK_CACHE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_DEFECT_DATA</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_DEFECT_DATA&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MEDIUM_SCAN</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;MEDIUM_SCAN&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">COMPARE</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;COMPARE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">COPY_VERIFY</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;COPY_VERIFY&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WRITE_BUFFER</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;WRITE_BUFFER&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_BUFFER</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_BUFFER&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">UPDATE_BLOCK</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;UPDATE_BLOCK&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_LONG</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_LONG&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WRITE_LONG</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;WRITE_LONG&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CHANGE_DEFINITION</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;CHANGE_DEFINITION&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WRITE_SAME</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;WRITE_SAME&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_READ_SUBCHANNEL</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ SUBCHANNEL&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_TOC</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_TOC&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_READ_HEADER</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ HEADER&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_PLAY_AUDIO_10</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;PLAY AUDIO (10)&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_PLAY_AUDIO_MSF</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;PLAY AUDIO MSF&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_GET_EVENT_STATUS_NOTIFICATION</span>:
		<span class="n">what</span> <span class="o">=</span> <span class="s">&quot;GET EVENT/STATUS NOTIFICATION&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_PAUSE_RESUME</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;PAUSE/RESUME&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LOG_SELECT</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;LOG_SELECT&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LOG_SENSE</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;LOG_SENSE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_STOP_PLAY_SCAN</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;STOP PLAY/SCAN&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_READ_DISC_INFO</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ DISC INFORMATION&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_READ_TRACK_RZONE_INFO</span>:
		<span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ TRACK INFORMATION&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_RESERVE_RZONE_TRACK</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;RESERVE TRACK&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_SEND_OPC</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEND OPC&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MODE_SELECT_10</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;MODE_SELECT_10&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_REPAIR_RZONE_TRACK</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;REPAIR TRACK&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x59</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ MASTER CUE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MODE_SENSE_10</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;MODE_SENSE_10&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_CLOSE_TRACK</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;CLOSE TRACK/SESSION&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x5C</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ BUFFER CAPACITY&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x5D</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEND CUE SHEET&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_BLANK</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;BLANK&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">REPORT_LUNS</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;REPORT LUNS&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MOVE_MEDIUM</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;MOVE_MEDIUM or PLAY AUDIO (12)&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_12</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_12&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WRITE_12</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;WRITE_12&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WRITE_VERIFY_12</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;WRITE_VERIFY_12&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEARCH_HIGH_12</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEARCH_HIGH_12&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEARCH_EQUAL_12</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEARCH_EQUAL_12&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEARCH_LOW_12</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEARCH_LOW_12&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEND_VOLUME_TAG</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SEND_VOLUME_TAG&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">READ_ELEMENT_STATUS</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ_ELEMENT_STATUS&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_READ_CD_MSF</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ CD MSF&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_SCAN</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SCAN&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_SET_SPEED</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;SET CD SPEED&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_MECHANISM_STATUS</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;MECHANISM STATUS&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">GPCMD_READ_CD</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;READ CD&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0xE1</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;WRITE CONTINUE&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WRITE_LONG_2</span>: <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;WRITE_LONG_2&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span> <span class="n">what</span> <span class="o">=</span> <span class="s">&quot;(unknown command)&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">US_DEBUGP</span><span class="p">(</span><span class="s">&quot;Command %s (%d bytes)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">srb</span><span class="o">-&gt;</span><span class="n">cmd_len</span><span class="p">);</span>
	<span class="n">US_DEBUGP</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">srb</span><span class="o">-&gt;</span><span class="n">cmd_len</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">US_DEBUGPX</span><span class="p">(</span><span class="s">&quot; %02x&quot;</span><span class="p">,</span> <span class="n">srb</span><span class="o">-&gt;</span><span class="n">cmnd</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="n">US_DEBUGPX</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">usb_stor_show_sense</span><span class="p">(</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">key</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">asc</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ascq</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">what</span><span class="p">,</span> <span class="o">*</span><span class="n">keystr</span><span class="p">;</span>

	<span class="n">keystr</span> <span class="o">=</span> <span class="n">scsi_sense_key_string</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
	<span class="n">what</span> <span class="o">=</span> <span class="n">scsi_extd_sense_format</span><span class="p">(</span><span class="n">asc</span><span class="p">,</span> <span class="n">ascq</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">keystr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="n">keystr</span> <span class="o">=</span> <span class="s">&quot;(Unknown Key)&quot;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">what</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="n">what</span> <span class="o">=</span> <span class="s">&quot;(unknown ASC/ASCQ)&quot;</span><span class="p">;</span>

	<span class="n">US_DEBUGP</span><span class="p">(</span><span class="s">&quot;%s: &quot;</span><span class="p">,</span> <span class="n">keystr</span><span class="p">);</span>
	<span class="n">US_DEBUGPX</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">ascq</span><span class="p">);</span>
	<span class="n">US_DEBUGPX</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
