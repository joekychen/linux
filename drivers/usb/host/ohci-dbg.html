<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › usb › host › ohci-dbg.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>ohci-dbg.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * OHCI HCD (Host Controller Driver) for USB.</span>
<span class="cm"> *</span>
<span class="cm"> * (C) Copyright 1999 Roman Weissgaerber &lt;weissg@vienna.at&gt;</span>
<span class="cm"> * (C) Copyright 2000-2002 David Brownell &lt;dbrownell@users.sourceforge.net&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This file is licenced under the GPL.</span>
<span class="cm"> */</span>

<span class="cm">/*-------------------------------------------------------------------------*/</span>

<span class="cp">#ifdef DEBUG</span>

<span class="cp">#define edstring(ed_type) ({ char *temp; \</span>
<span class="cp">	switch (ed_type) { \</span>
<span class="cp">	case PIPE_CONTROL:	temp = &quot;ctrl&quot;; break; \</span>
<span class="cp">	case PIPE_BULK:		temp = &quot;bulk&quot;; break; \</span>
<span class="cp">	case PIPE_INTERRUPT:	temp = &quot;intr&quot;; break; \</span>
<span class="cp">	default:		temp = &quot;isoc&quot;; break; \</span>
<span class="cp">	}; temp;})</span>
<span class="cp">#define pipestring(pipe) edstring(usb_pipetype(pipe))</span>

<span class="cm">/* debug| print the main components of an URB</span>
<span class="cm"> * small: 0) header + data packets 1) just header</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__maybe_unused</span>
<span class="nf">urb_print</span><span class="p">(</span><span class="k">struct</span> <span class="n">urb</span> <span class="o">*</span> <span class="n">urb</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">small</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pipe</span><span class="o">=</span> <span class="n">urb</span><span class="o">-&gt;</span><span class="n">pipe</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">urb</span><span class="o">-&gt;</span><span class="n">dev</span> <span class="o">||</span> <span class="o">!</span><span class="n">urb</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;%s URB: no dev</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

<span class="cp">#ifndef	OHCI_VERBOSE_DEBUG</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="cp">#endif</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;%s %p dev=%d ep=%d%s-%s flags=%x len=%d/%d stat=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">str</span><span class="p">,</span>
		    <span class="n">urb</span><span class="p">,</span>
		    <span class="n">usb_pipedevice</span> <span class="p">(</span><span class="n">pipe</span><span class="p">),</span>
		    <span class="n">usb_pipeendpoint</span> <span class="p">(</span><span class="n">pipe</span><span class="p">),</span>
		    <span class="n">usb_pipeout</span> <span class="p">(</span><span class="n">pipe</span><span class="p">)</span><span class="o">?</span> <span class="s">&quot;out&quot;</span> <span class="o">:</span> <span class="s">&quot;in&quot;</span><span class="p">,</span>
		    <span class="n">pipestring</span> <span class="p">(</span><span class="n">pipe</span><span class="p">),</span>
		    <span class="n">urb</span><span class="o">-&gt;</span><span class="n">transfer_flags</span><span class="p">,</span>
		    <span class="n">urb</span><span class="o">-&gt;</span><span class="n">actual_length</span><span class="p">,</span>
		    <span class="n">urb</span><span class="o">-&gt;</span><span class="n">transfer_buffer_length</span><span class="p">,</span>
		    <span class="n">status</span><span class="p">);</span>

<span class="cp">#ifdef	OHCI_VERBOSE_DEBUG</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">small</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">len</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">usb_pipecontrol</span> <span class="p">(</span><span class="n">pipe</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">printk</span> <span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;%s: setup(8):&quot;</span><span class="p">,</span> <span class="n">__FILE__</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="n">printk</span> <span class="p">(</span><span class="s">&quot; %02x&quot;</span><span class="p">,</span> <span class="p">((</span><span class="n">__u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">urb</span><span class="o">-&gt;</span><span class="n">setup_packet</span><span class="p">)</span> <span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="n">printk</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">urb</span><span class="o">-&gt;</span><span class="n">transfer_buffer_length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">urb</span><span class="o">-&gt;</span><span class="n">transfer_buffer</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span> <span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;%s: data(%d/%d):&quot;</span><span class="p">,</span> <span class="n">__FILE__</span><span class="p">,</span>
				<span class="n">urb</span><span class="o">-&gt;</span><span class="n">actual_length</span><span class="p">,</span>
				<span class="n">urb</span><span class="o">-&gt;</span><span class="n">transfer_buffer_length</span><span class="p">);</span>
			<span class="n">len</span> <span class="o">=</span> <span class="n">usb_pipeout</span> <span class="p">(</span><span class="n">pipe</span><span class="p">)</span><span class="o">?</span>
						<span class="n">urb</span><span class="o">-&gt;</span><span class="n">transfer_buffer_length</span><span class="o">:</span> <span class="n">urb</span><span class="o">-&gt;</span><span class="n">actual_length</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="n">printk</span> <span class="p">(</span><span class="s">&quot; %02x&quot;</span><span class="p">,</span> <span class="p">((</span><span class="n">__u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">urb</span><span class="o">-&gt;</span><span class="n">transfer_buffer</span><span class="p">)</span> <span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="n">printk</span> <span class="p">(</span><span class="s">&quot;%s stat:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="o">?</span> <span class="s">&quot;...&quot;</span><span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#define ohci_dbg_sw(ohci, next, size, format, arg...) \</span>
<span class="cp">	do { \</span>
<span class="cp">	if (next != NULL) { \</span>
<span class="cp">		unsigned s_len; \</span>
<span class="cp">		s_len = scnprintf (*next, *size, format, ## arg ); \</span>
<span class="cp">		*size -= s_len; *next += s_len; \</span>
<span class="cp">	} else \</span>
<span class="cp">		ohci_dbg(ohci,format, ## arg ); \</span>
<span class="cp">	} while (0);</span>

<span class="cm">/* Version for use where &quot;next&quot; is the address of a local variable */</span>
<span class="cp">#define ohci_dbg_nosw(ohci, next, size, format, arg...) \</span>
<span class="cp">	do { \</span>
<span class="cp">		unsigned s_len; \</span>
<span class="cp">		s_len = scnprintf(*next, *size, format, ## arg); \</span>
<span class="cp">		*size -= s_len; *next += s_len; \</span>
<span class="cp">	} while (0);</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">ohci_dump_intr_mask</span> <span class="p">(</span>
	<span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">ohci</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">,</span>
	<span class="n">u32</span> <span class="n">mask</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">**</span><span class="n">next</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="o">*</span><span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ohci_dbg_sw</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;%s 0x%08x%s%s%s%s%s%s%s%s%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">label</span><span class="p">,</span>
		<span class="n">mask</span><span class="p">,</span>
		<span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">OHCI_INTR_MIE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; MIE&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">OHCI_INTR_OC</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; OC&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">OHCI_INTR_RHSC</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; RHSC&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">OHCI_INTR_FNO</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; FNO&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">OHCI_INTR_UE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; UE&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">OHCI_INTR_RD</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; RD&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">OHCI_INTR_SF</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; SF&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">OHCI_INTR_WDH</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; WDH&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">OHCI_INTR_SO</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; SO&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
		<span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">maybe_print_eds</span> <span class="p">(</span>
	<span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">ohci</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">,</span>
	<span class="n">u32</span> <span class="n">value</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">**</span><span class="n">next</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="o">*</span><span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="n">ohci_dbg_sw</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;%s %08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">hcfs2string</span> <span class="p">(</span><span class="kt">int</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">OHCI_USB_RESET</span>:	<span class="k">return</span> <span class="s">&quot;reset&quot;</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OHCI_USB_RESUME</span>:	<span class="k">return</span> <span class="s">&quot;resume&quot;</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OHCI_USB_OPER</span>:	<span class="k">return</span> <span class="s">&quot;operational&quot;</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OHCI_USB_SUSPEND</span>:	<span class="k">return</span> <span class="s">&quot;suspend&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="s">&quot;?&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">rh_state_string</span><span class="p">(</span><span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">ohci</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">rh_state</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">OHCI_RH_HALTED</span>:
		<span class="k">return</span> <span class="s">&quot;halted&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OHCI_RH_SUSPENDED</span>:
		<span class="k">return</span> <span class="s">&quot;suspended&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">OHCI_RH_RUNNING</span>:
		<span class="k">return</span> <span class="s">&quot;running&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="s">&quot;?&quot;</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>dump control and status registers</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span>
<span class="nf">ohci_dump_status</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">controller</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">next</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="o">*</span><span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ohci_regs</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">regs</span> <span class="o">=</span> <span class="n">controller</span><span class="o">-&gt;</span><span class="n">regs</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">temp</span><span class="p">;</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="n">ohci_readl</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">revision</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">ohci_dbg_sw</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
		<span class="s">&quot;OHCI %d.%d, %s legacy support registers, rh state %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="mh">0x03</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">),</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x0100</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;with&quot;</span> <span class="o">:</span> <span class="s">&quot;NO&quot;</span><span class="p">,</span>
		<span class="n">rh_state_string</span><span class="p">(</span><span class="n">controller</span><span class="p">));</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="n">ohci_readl</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">control</span><span class="p">);</span>
	<span class="n">ohci_dbg_sw</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
		<span class="s">&quot;control 0x%03x%s%s%s HCFS=%s%s%s%s%s CBSR=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">temp</span><span class="p">,</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_CTRL_RWE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; RWE&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_CTRL_RWC</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; RWC&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_CTRL_IR</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; IR&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="n">hcfs2string</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_CTRL_HCFS</span><span class="p">),</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_CTRL_BLE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; BLE&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_CTRL_CLE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; CLE&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_CTRL_IE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; IE&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_CTRL_PLE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; PLE&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_CTRL_CBSR</span>
		<span class="p">);</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="n">ohci_readl</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">cmdstatus</span><span class="p">);</span>
	<span class="n">ohci_dbg_sw</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
		<span class="s">&quot;cmdstatus 0x%05x SOC=%d%s%s%s%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_SOC</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">,</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_OCR</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; OCR&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_BLF</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; BLF&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_CLF</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; CLF&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">OHCI_HCR</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; HCR&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
		<span class="p">);</span>

	<span class="n">ohci_dump_intr_mask</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="s">&quot;intrstatus&quot;</span><span class="p">,</span>
			<span class="n">ohci_readl</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">intrstatus</span><span class="p">),</span>
			<span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
	<span class="n">ohci_dump_intr_mask</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="s">&quot;intrenable&quot;</span><span class="p">,</span>
			<span class="n">ohci_readl</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">intrenable</span><span class="p">),</span>
			<span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>intrdisable always same as intrenable</p></td><td class="code"><div class="highlight"><pre>	<span class="n">maybe_print_eds</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="s">&quot;ed_periodcurrent&quot;</span><span class="p">,</span>
			<span class="n">ohci_readl</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ed_periodcurrent</span><span class="p">),</span>
			<span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

	<span class="n">maybe_print_eds</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="s">&quot;ed_controlhead&quot;</span><span class="p">,</span>
			<span class="n">ohci_readl</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ed_controlhead</span><span class="p">),</span>
			<span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
	<span class="n">maybe_print_eds</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="s">&quot;ed_controlcurrent&quot;</span><span class="p">,</span>
			<span class="n">ohci_readl</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ed_controlcurrent</span><span class="p">),</span>
			<span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

	<span class="n">maybe_print_eds</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="s">&quot;ed_bulkhead&quot;</span><span class="p">,</span>
			<span class="n">ohci_readl</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ed_bulkhead</span><span class="p">),</span>
			<span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
	<span class="n">maybe_print_eds</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="s">&quot;ed_bulkcurrent&quot;</span><span class="p">,</span>
			<span class="n">ohci_readl</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ed_bulkcurrent</span><span class="p">),</span>
			<span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

	<span class="n">maybe_print_eds</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="s">&quot;donehead&quot;</span><span class="p">,</span>
			<span class="n">ohci_readl</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">donehead</span><span class="p">),</span> <span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define dbg_port_sw(hc,num,value,next,size) \</span>
<span class="cp">	ohci_dbg_sw (hc, next, size, \</span>
<span class="cp">		&quot;roothub.portstatus [%d] &quot; \</span>
<span class="cp">		&quot;0x%08x%s%s%s%s%s%s%s%s%s%s%s%s\n&quot;, \</span>
<span class="cp">		num, temp, \</span>
<span class="cp">		(temp &amp; RH_PS_PRSC) ? &quot; PRSC&quot; : &quot;&quot;, \</span>
<span class="cp">		(temp &amp; RH_PS_OCIC) ? &quot; OCIC&quot; : &quot;&quot;, \</span>
<span class="cp">		(temp &amp; RH_PS_PSSC) ? &quot; PSSC&quot; : &quot;&quot;, \</span>
<span class="cp">		(temp &amp; RH_PS_PESC) ? &quot; PESC&quot; : &quot;&quot;, \</span>
<span class="cp">		(temp &amp; RH_PS_CSC) ? &quot; CSC&quot; : &quot;&quot;, \</span>
<span class="cp">		\</span>
<span class="cp">		(temp &amp; RH_PS_LSDA) ? &quot; LSDA&quot; : &quot;&quot;, \</span>
<span class="cp">		(temp &amp; RH_PS_PPS) ? &quot; PPS&quot; : &quot;&quot;, \</span>
<span class="cp">		(temp &amp; RH_PS_PRS) ? &quot; PRS&quot; : &quot;&quot;, \</span>
<span class="cp">		(temp &amp; RH_PS_POCI) ? &quot; POCI&quot; : &quot;&quot;, \</span>
<span class="cp">		(temp &amp; RH_PS_PSS) ? &quot; PSS&quot; : &quot;&quot;, \</span>
<span class="cp">		\</span>
<span class="cp">		(temp &amp; RH_PS_PES) ? &quot; PES&quot; : &quot;&quot;, \</span>
<span class="cp">		(temp &amp; RH_PS_CCS) ? &quot; CCS&quot; : &quot;&quot; \</span>
<span class="cp">		);</span>


<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ohci_dump_roothub</span> <span class="p">(</span>
	<span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">controller</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">verbose</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">**</span><span class="n">next</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="o">*</span><span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span>			<span class="n">temp</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="n">roothub_a</span> <span class="p">(</span><span class="n">controller</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="o">~</span><span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ohci_dbg_sw</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
			<span class="s">&quot;roothub.a %08x POTPGT=%d%s%s%s%s%s NDP=%d(%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span>
			<span class="p">((</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_A_POTPGT</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_A_NOCP</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; NOCP&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_A_OCPM</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; OCPM&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_A_DT</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; DT&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_A_NPS</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; NPS&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_A_PSM</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; PSM&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_A_NDP</span><span class="p">),</span> <span class="n">controller</span><span class="o">-&gt;</span><span class="n">num_ports</span>
			<span class="p">);</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="n">roothub_b</span> <span class="p">(</span><span class="n">controller</span><span class="p">);</span>
		<span class="n">ohci_dbg_sw</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
			<span class="s">&quot;roothub.b %08x PPCM=%04x DR=%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">temp</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_B_PPCM</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_B_DR</span><span class="p">)</span>
			<span class="p">);</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="n">roothub_status</span> <span class="p">(</span><span class="n">controller</span><span class="p">);</span>
		<span class="n">ohci_dbg_sw</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
			<span class="s">&quot;roothub.status %08x%s%s%s%s%s%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">temp</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_HS_CRWE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; CRWE&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_HS_OCIC</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; OCIC&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_HS_LPSC</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; LPSC&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_HS_DRWE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; DRWE&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_HS_OCI</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; OCI&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">RH_HS_LPS</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; LPS&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span>
			<span class="p">);</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">controller</span><span class="o">-&gt;</span><span class="n">num_ports</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="n">roothub_portstatus</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">dbg_port_sw</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ohci_dump</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">controller</span><span class="p">,</span> <span class="kt">int</span> <span class="n">verbose</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="s">&quot;OHCI controller state</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>dumps some of the state we know about</p></td><td class="code"><div class="highlight"><pre>	<span class="n">ohci_dump_status</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">controller</span><span class="o">-&gt;</span><span class="n">hcca</span><span class="p">)</span>
		<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span>
			<span class="s">&quot;hcca frame #%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ohci_frame_no</span><span class="p">(</span><span class="n">controller</span><span class="p">));</span>
	<span class="n">ohci_dump_roothub</span> <span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">data0</span> <span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;DATA0&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">data1</span> <span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;DATA1&quot;</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ohci_dump_td</span> <span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">ohci</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">td</span> <span class="o">*</span><span class="n">td</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span>	<span class="n">tmp</span> <span class="o">=</span> <span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">td</span><span class="o">-&gt;</span><span class="n">hwINFO</span><span class="p">);</span>

	<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="s">&quot;%s td %p%s; urb %p index %d; hw next td %08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">label</span><span class="p">,</span> <span class="n">td</span><span class="p">,</span>
		<span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">TD_DONE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; (DONE)&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="n">td</span><span class="o">-&gt;</span><span class="n">urb</span><span class="p">,</span> <span class="n">td</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">,</span>
		<span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">td</span><span class="o">-&gt;</span><span class="n">hwNextTD</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">TD_ISO</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">toggle</span><span class="p">,</span> <span class="o">*</span><span class="n">pid</span><span class="p">;</span>
		<span class="n">u32</span>	<span class="n">cbp</span><span class="p">,</span> <span class="n">be</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">TD_T</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">TD_T_DATA0</span>: <span class="n">toggle</span> <span class="o">=</span> <span class="n">data0</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">TD_T_DATA1</span>: <span class="n">toggle</span> <span class="o">=</span> <span class="n">data1</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">TD_T_TOGGLE</span>: <span class="n">toggle</span> <span class="o">=</span> <span class="s">&quot;(CARRY)&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span> <span class="n">toggle</span> <span class="o">=</span> <span class="s">&quot;(?)&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">TD_DP</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">TD_DP_SETUP</span>: <span class="n">pid</span> <span class="o">=</span> <span class="s">&quot;SETUP&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">TD_DP_IN</span>: <span class="n">pid</span> <span class="o">=</span> <span class="s">&quot;IN&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">TD_DP_OUT</span>: <span class="n">pid</span> <span class="o">=</span> <span class="s">&quot;OUT&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span> <span class="n">pid</span> <span class="o">=</span> <span class="s">&quot;(bad pid)&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="s">&quot;     info %08x CC=%x %s DI=%d %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span>
			<span class="n">TD_CC_GET</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span> <span class="cm">/* EC, */</span> <span class="n">toggle</span><span class="p">,</span>
			<span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">TD_DI</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">21</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span>
			<span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">TD_R</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;R&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
		<span class="n">cbp</span> <span class="o">=</span> <span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">td</span><span class="o">-&gt;</span><span class="n">hwCBP</span><span class="p">);</span>
		<span class="n">be</span> <span class="o">=</span> <span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">td</span><span class="o">-&gt;</span><span class="n">hwBE</span><span class="p">);</span>
		<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="s">&quot;     cbp %08x be %08x (len %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cbp</span><span class="p">,</span> <span class="n">be</span><span class="p">,</span>
			<span class="n">cbp</span> <span class="o">?</span> <span class="p">(</span><span class="n">be</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cbp</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="kt">unsigned</span>	<span class="n">i</span><span class="p">;</span>
		<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="s">&quot;  info %08x CC=%x FC=%d DI=%d SF=%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span>
			<span class="n">TD_CC_GET</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span>
			<span class="p">(</span><span class="n">tmp</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">,</span>
			<span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">TD_DI</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">21</span><span class="p">,</span>
			<span class="n">tmp</span> <span class="o">&amp;</span> <span class="mh">0x0000ffff</span><span class="p">);</span>
		<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="s">&quot;  bp0 %08x be %08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">td</span><span class="o">-&gt;</span><span class="n">hwCBP</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x0fff</span><span class="p">,</span>
			<span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">td</span><span class="o">-&gt;</span><span class="n">hwBE</span><span class="p">));</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAXPSW</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">u16</span>	<span class="n">psw</span> <span class="o">=</span> <span class="n">ohci_hwPSW</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="n">td</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
			<span class="kt">int</span>	<span class="n">cc</span> <span class="o">=</span> <span class="p">(</span><span class="n">psw</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">;</span>
			<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="s">&quot;    psw [%d] = %2x, CC=%x %s=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
				<span class="n">psw</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span>
				<span class="p">(</span><span class="n">cc</span> <span class="o">&gt;=</span> <span class="mh">0x0e</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;OFFSET&quot;</span> <span class="o">:</span> <span class="s">&quot;SIZE&quot;</span><span class="p">,</span>
				<span class="n">psw</span> <span class="o">&amp;</span> <span class="mh">0x0fff</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* caller MUST own hcd spinlock if verbose is set! */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__maybe_unused</span>
<span class="nf">ohci_dump_ed</span> <span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">ohci</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">ed</span> <span class="o">*</span><span class="n">ed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">verbose</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span>	<span class="n">tmp</span> <span class="o">=</span> <span class="n">hc32_to_cpu</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="n">ed</span><span class="o">-&gt;</span><span class="n">hwINFO</span><span class="p">);</span>
	<span class="kt">char</span>	<span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>

	<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="s">&quot;%s, ed %p state 0x%x type %s; next ed %08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">label</span><span class="p">,</span>
		<span class="n">ed</span><span class="p">,</span> <span class="n">ed</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">,</span> <span class="n">edstring</span> <span class="p">(</span><span class="n">ed</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">),</span>
		<span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ed</span><span class="o">-&gt;</span><span class="n">hwNextED</span><span class="p">));</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ED_IN</span><span class="o">|</span><span class="n">ED_OUT</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">ED_OUT</span>: <span class="n">type</span> <span class="o">=</span> <span class="s">&quot;-OUT&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ED_IN</span>: <span class="n">type</span> <span class="o">=</span> <span class="s">&quot;-IN&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="cm">/* else from TDs ... control */</span>
	<span class="p">}</span>
	<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span>
		<span class="s">&quot;  info %08x MAX=%d%s%s%s%s EP=%d%s DEV=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span>
		<span class="mh">0x03ff</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">),</span>
		<span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">ED_DEQUEUE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; DQ&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">ED_ISO</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; ISO&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">ED_SKIP</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; SKIP&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">ED_LOWSPEED</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; LOW&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="mh">0x000f</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">),</span>
		<span class="n">type</span><span class="p">,</span>
		<span class="mh">0x007f</span> <span class="o">&amp;</span> <span class="n">tmp</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ed</span><span class="o">-&gt;</span><span class="n">hwHeadP</span><span class="p">);</span>
	<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="s">&quot;  tds: head %08x %s%s tail %08x%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">tmp</span><span class="p">,</span>
		<span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">ED_C</span><span class="p">)</span> <span class="o">?</span> <span class="n">data1</span> <span class="o">:</span> <span class="n">data0</span><span class="p">,</span>
		<span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">ED_H</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; HALT&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ed</span><span class="o">-&gt;</span><span class="n">hwTailP</span><span class="p">),</span>
		<span class="n">verbose</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="s">&quot; (not listing)&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">list_head</span>	<span class="o">*</span><span class="n">tmp</span><span class="p">;</span>

		<span class="cm">/* use ed-&gt;td_list because HC concurrently modifies</span>
<span class="cm">		 * hwNextTD as it accumulates ed_donelist.</span>
<span class="cm">		 */</span>
		<span class="n">list_for_each</span> <span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ed</span><span class="o">-&gt;</span><span class="n">td_list</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">td</span>		<span class="o">*</span><span class="n">td</span><span class="p">;</span>
			<span class="n">td</span> <span class="o">=</span> <span class="n">list_entry</span> <span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">td</span><span class="p">,</span> <span class="n">td_list</span><span class="p">);</span>
			<span class="n">ohci_dump_td</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="s">&quot;  -&gt;&quot;</span><span class="p">,</span> <span class="n">td</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ohci_dump</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">controller</span><span class="p">,</span> <span class="kt">int</span> <span class="n">verbose</span><span class="p">)</span> <span class="p">{}</span>

<span class="cp">#undef OHCI_VERBOSE_DEBUG</span>

<span class="cp">#endif </span><span class="cm">/* DEBUG */</span><span class="cp"></span>

<span class="cm">/*-------------------------------------------------------------------------*/</span>

<span class="cp">#ifdef STUB_DEBUG_FILES</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">create_debug_files</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">bus</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">remove_debug_files</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">bus</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="cp">#else</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">debug_async_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">debug_periodic_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">debug_registers_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">debug_async_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">ssize_t</span> <span class="n">debug_output</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span><span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span><span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">loff_t</span><span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">debug_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">debug_async_fops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span>		<span class="o">=</span> <span class="n">debug_async_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">debug_output</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span>	<span class="o">=</span> <span class="n">debug_close</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span>		<span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">debug_periodic_fops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span>		<span class="o">=</span> <span class="n">debug_periodic_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">debug_output</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span>	<span class="o">=</span> <span class="n">debug_close</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span>		<span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">debug_registers_fops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span>		<span class="o">=</span> <span class="n">debug_registers_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">debug_output</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span>	<span class="o">=</span> <span class="n">debug_close</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span>		<span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">ohci_debug_root</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">debug_buffer</span> <span class="p">{</span>
	<span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">fill_func</span><span class="p">)(</span><span class="k">struct</span> <span class="n">debug_buffer</span> <span class="o">*</span><span class="p">);</span>	<span class="cm">/* fill method */</span>
	<span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">ohci</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">mutex</span><span class="p">;</span>	<span class="cm">/* protect filling of buffer */</span>
	<span class="kt">size_t</span> <span class="n">count</span><span class="p">;</span>		<span class="cm">/* number of characters filled into buffer */</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">page</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span>
<span class="nf">show_list</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">ohci</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ed</span> <span class="o">*</span><span class="n">ed</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span>		<span class="n">temp</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">count</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ed</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* print first --&gt; last */</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">ed</span><span class="o">-&gt;</span><span class="n">ed_prev</span><span class="p">)</span>
		<span class="n">ed</span> <span class="o">=</span> <span class="n">ed</span><span class="o">-&gt;</span><span class="n">ed_prev</span><span class="p">;</span>

	<span class="cm">/* dump a snapshot of the bulk or control schedule */</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">ed</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span>		<span class="n">info</span> <span class="o">=</span> <span class="n">hc32_to_cpu</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="n">ed</span><span class="o">-&gt;</span><span class="n">hwINFO</span><span class="p">);</span>
		<span class="n">u32</span>		<span class="n">headp</span> <span class="o">=</span> <span class="n">hc32_to_cpu</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="n">ed</span><span class="o">-&gt;</span><span class="n">hwHeadP</span><span class="p">);</span>
		<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">entry</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">td</span>	<span class="o">*</span><span class="n">td</span><span class="p">;</span>

		<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
			<span class="s">&quot;ed/%p %cs dev%d ep%d%s max %d %08x%s%s %s&quot;</span><span class="p">,</span>
			<span class="n">ed</span><span class="p">,</span>
			<span class="p">(</span><span class="n">info</span> <span class="o">&amp;</span> <span class="n">ED_LOWSPEED</span><span class="p">)</span> <span class="o">?</span> <span class="sc">&#39;l&#39;</span> <span class="o">:</span> <span class="sc">&#39;f&#39;</span><span class="p">,</span>
			<span class="n">info</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
			<span class="p">(</span><span class="n">info</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">,</span>
			<span class="p">(</span><span class="n">info</span> <span class="o">&amp;</span> <span class="n">ED_IN</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;in&quot;</span> <span class="o">:</span> <span class="s">&quot;out&quot;</span><span class="p">,</span>
			<span class="mh">0x03ff</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">info</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">),</span>
			<span class="n">info</span><span class="p">,</span>
			<span class="p">(</span><span class="n">info</span> <span class="o">&amp;</span> <span class="n">ED_SKIP</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; s&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">headp</span> <span class="o">&amp;</span> <span class="n">ED_H</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; H&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">headp</span> <span class="o">&amp;</span> <span class="n">ED_C</span><span class="p">)</span> <span class="o">?</span> <span class="n">data1</span> <span class="o">:</span> <span class="n">data0</span><span class="p">);</span>
		<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
		<span class="n">buf</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>

		<span class="n">list_for_each</span> <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ed</span><span class="o">-&gt;</span><span class="n">td_list</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">u32</span>		<span class="n">cbp</span><span class="p">,</span> <span class="n">be</span><span class="p">;</span>

			<span class="n">td</span> <span class="o">=</span> <span class="n">list_entry</span> <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="k">struct</span> <span class="n">td</span><span class="p">,</span> <span class="n">td_list</span><span class="p">);</span>
			<span class="n">info</span> <span class="o">=</span> <span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">td</span><span class="o">-&gt;</span><span class="n">hwINFO</span><span class="p">);</span>
			<span class="n">cbp</span> <span class="o">=</span> <span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">td</span><span class="o">-&gt;</span><span class="n">hwCBP</span><span class="p">);</span>
			<span class="n">be</span> <span class="o">=</span> <span class="n">hc32_to_cpup</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">td</span><span class="o">-&gt;</span><span class="n">hwBE</span><span class="p">);</span>
			<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
					<span class="s">&quot;</span><span class="se">\n\t</span><span class="s">td %p %s %d cc=%x urb %p (%08x)&quot;</span><span class="p">,</span>
					<span class="n">td</span><span class="p">,</span>
					<span class="p">({</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pid</span><span class="p">;</span>
					<span class="k">switch</span> <span class="p">(</span><span class="n">info</span> <span class="o">&amp;</span> <span class="n">TD_DP</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">case</span> <span class="n">TD_DP_SETUP</span>: <span class="n">pid</span> <span class="o">=</span> <span class="s">&quot;setup&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
					<span class="k">case</span> <span class="n">TD_DP_IN</span>: <span class="n">pid</span> <span class="o">=</span> <span class="s">&quot;in&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
					<span class="k">case</span> <span class="n">TD_DP_OUT</span>: <span class="n">pid</span> <span class="o">=</span> <span class="s">&quot;out&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
					<span class="nl">default:</span> <span class="n">pid</span> <span class="o">=</span> <span class="s">&quot;(?)&quot;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
					 <span class="p">}</span> <span class="n">pid</span><span class="p">;}),</span>
					<span class="n">cbp</span> <span class="o">?</span> <span class="p">(</span><span class="n">be</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cbp</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">TD_CC_GET</span> <span class="p">(</span><span class="n">info</span><span class="p">),</span> <span class="n">td</span><span class="o">-&gt;</span><span class="n">urb</span><span class="p">,</span> <span class="n">info</span><span class="p">);</span>
			<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
			<span class="n">buf</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
		<span class="n">buf</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>

		<span class="n">ed</span> <span class="o">=</span> <span class="n">ed</span><span class="o">-&gt;</span><span class="n">ed_next</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">count</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">fill_async_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">debug_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ohci_hcd</span>		<span class="o">*</span><span class="n">ohci</span><span class="p">;</span>
	<span class="kt">size_t</span>			<span class="n">temp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">flags</span><span class="p">;</span>

	<span class="n">ohci</span> <span class="o">=</span> <span class="n">buf</span><span class="o">-&gt;</span><span class="n">ohci</span><span class="p">;</span>

	<span class="cm">/* display control and bulk lists together, for simplicity */</span>
	<span class="n">spin_lock_irqsave</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="n">show_list</span><span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">,</span> <span class="n">buf</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">,</span> <span class="n">ohci</span><span class="o">-&gt;</span><span class="n">ed_controltail</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">+=</span> <span class="n">show_list</span><span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span> <span class="o">+</span> <span class="n">temp</span><span class="p">,</span> <span class="n">buf</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">-</span> <span class="n">temp</span><span class="p">,</span>
			  <span class="n">ohci</span><span class="o">-&gt;</span><span class="n">ed_bulktail</span><span class="p">);</span>
	<span class="n">spin_unlock_irqrestore</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define DBG_SCHED_LIMIT 64</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">fill_periodic_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">debug_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ohci_hcd</span>		<span class="o">*</span><span class="n">ohci</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ed</span>		<span class="o">**</span><span class="n">seen</span><span class="p">,</span> <span class="o">*</span><span class="n">ed</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">flags</span><span class="p">;</span>
	<span class="kt">unsigned</span>		<span class="n">temp</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">seen_count</span><span class="p">;</span>
	<span class="kt">char</span>			<span class="o">*</span><span class="n">next</span><span class="p">;</span>
	<span class="kt">unsigned</span>		<span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">seen</span> <span class="o">=</span> <span class="n">kmalloc</span> <span class="p">(</span><span class="n">DBG_SCHED_LIMIT</span> <span class="o">*</span> <span class="k">sizeof</span> <span class="o">*</span><span class="n">seen</span><span class="p">,</span> <span class="n">GFP_ATOMIC</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">seen_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">ohci</span> <span class="o">=</span> <span class="n">buf</span><span class="o">-&gt;</span><span class="n">ohci</span><span class="p">;</span>
	<span class="n">next</span> <span class="o">=</span> <span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">;</span>
	<span class="n">size</span> <span class="o">=</span> <span class="n">PAGE_SIZE</span><span class="p">;</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;size = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">NUM_INTS</span><span class="p">);</span>
	<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">next</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>

	<span class="cm">/* dump a snapshot of the periodic schedule (and load) */</span>
	<span class="n">spin_lock_irqsave</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_INTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ed</span> <span class="o">=</span> <span class="n">ohci</span><span class="o">-&gt;</span><span class="n">periodic</span> <span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;%2d [%3d]:&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ohci</span><span class="o">-&gt;</span><span class="n">load</span> <span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
		<span class="n">next</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>

		<span class="k">do</span> <span class="p">{</span>
			<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot; ed%d/%p&quot;</span><span class="p">,</span>
				<span class="n">ed</span><span class="o">-&gt;</span><span class="n">interval</span><span class="p">,</span> <span class="n">ed</span><span class="p">);</span>
			<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
			<span class="n">next</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="n">seen_count</span><span class="p">;</span> <span class="n">temp</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">seen</span> <span class="p">[</span><span class="n">temp</span><span class="p">]</span> <span class="o">==</span> <span class="n">ed</span><span class="p">)</span>
					<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="cm">/* show more info the first time around */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="n">seen_count</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">u32</span>	<span class="n">info</span> <span class="o">=</span> <span class="n">hc32_to_cpu</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="n">ed</span><span class="o">-&gt;</span><span class="n">hwINFO</span><span class="p">);</span>
				<span class="k">struct</span> <span class="n">list_head</span>	<span class="o">*</span><span class="n">entry</span><span class="p">;</span>
				<span class="kt">unsigned</span>		<span class="n">qlen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

				<span class="cm">/* qlen measured here in TDs, not urbs */</span>
				<span class="n">list_for_each</span> <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ed</span><span class="o">-&gt;</span><span class="n">td_list</span><span class="p">)</span>
					<span class="n">qlen</span><span class="o">++</span><span class="p">;</span>

				<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
					<span class="s">&quot; (%cs dev%d ep%d%s-%s qlen %u&quot;</span>
					<span class="s">&quot; max %d %08x%s%s)&quot;</span><span class="p">,</span>
					<span class="p">(</span><span class="n">info</span> <span class="o">&amp;</span> <span class="n">ED_LOWSPEED</span><span class="p">)</span> <span class="o">?</span> <span class="sc">&#39;l&#39;</span> <span class="o">:</span> <span class="sc">&#39;f&#39;</span><span class="p">,</span>
					<span class="n">info</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
					<span class="p">(</span><span class="n">info</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">,</span>
					<span class="p">(</span><span class="n">info</span> <span class="o">&amp;</span> <span class="n">ED_IN</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;in&quot;</span> <span class="o">:</span> <span class="s">&quot;out&quot;</span><span class="p">,</span>
					<span class="p">(</span><span class="n">info</span> <span class="o">&amp;</span> <span class="n">ED_ISO</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;iso&quot;</span> <span class="o">:</span> <span class="s">&quot;int&quot;</span><span class="p">,</span>
					<span class="n">qlen</span><span class="p">,</span>
					<span class="mh">0x03ff</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">info</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">),</span>
					<span class="n">info</span><span class="p">,</span>
					<span class="p">(</span><span class="n">info</span> <span class="o">&amp;</span> <span class="n">ED_SKIP</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; K&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
					<span class="p">(</span><span class="n">ed</span><span class="o">-&gt;</span><span class="n">hwHeadP</span> <span class="o">&amp;</span>
						<span class="n">cpu_to_hc32</span><span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="n">ED_H</span><span class="p">))</span> <span class="o">?</span>
							<span class="s">&quot; H&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
				<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
				<span class="n">next</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">seen_count</span> <span class="o">&lt;</span> <span class="n">DBG_SCHED_LIMIT</span><span class="p">)</span>
					<span class="n">seen</span> <span class="p">[</span><span class="n">seen_count</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ed</span><span class="p">;</span>

				<span class="n">ed</span> <span class="o">=</span> <span class="n">ed</span><span class="o">-&gt;</span><span class="n">ed_next</span><span class="p">;</span>

			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="cm">/* we&#39;ve seen it and what&#39;s after */</span>
				<span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">ed</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
			<span class="p">}</span>

		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">ed</span><span class="p">);</span>

		<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
		<span class="n">next</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">spin_unlock_irqrestore</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">kfree</span> <span class="p">(</span><span class="n">seen</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">PAGE_SIZE</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#undef DBG_SCHED_LIMIT</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">fill_registers_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">debug_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usb_hcd</span>		<span class="o">*</span><span class="n">hcd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ohci_hcd</span>		<span class="o">*</span><span class="n">ohci</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ohci_regs</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">regs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">flags</span><span class="p">;</span>
	<span class="kt">unsigned</span>		<span class="n">temp</span><span class="p">,</span> <span class="n">size</span><span class="p">;</span>
	<span class="kt">char</span>			<span class="o">*</span><span class="n">next</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">rdata</span><span class="p">;</span>

	<span class="n">ohci</span> <span class="o">=</span> <span class="n">buf</span><span class="o">-&gt;</span><span class="n">ohci</span><span class="p">;</span>
	<span class="n">hcd</span> <span class="o">=</span> <span class="n">ohci_to_hcd</span><span class="p">(</span><span class="n">ohci</span><span class="p">);</span>
	<span class="n">regs</span> <span class="o">=</span> <span class="n">ohci</span><span class="o">-&gt;</span><span class="n">regs</span><span class="p">;</span>
	<span class="n">next</span> <span class="o">=</span> <span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">;</span>
	<span class="n">size</span> <span class="o">=</span> <span class="n">PAGE_SIZE</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="cm">/* dump driver info, then registers in spec order */</span>

	<span class="n">ohci_dbg_nosw</span><span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">next</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">,</span>
		<span class="s">&quot;bus %s, device %s</span><span class="se">\n</span><span class="s">&quot;</span>
		<span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span>
		<span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">hcd</span><span class="o">-&gt;</span><span class="n">self</span><span class="p">.</span><span class="n">controller</span><span class="o">-&gt;</span><span class="n">bus</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span>
		<span class="n">dev_name</span><span class="p">(</span><span class="n">hcd</span><span class="o">-&gt;</span><span class="n">self</span><span class="p">.</span><span class="n">controller</span><span class="p">),</span>
		<span class="n">hcd</span><span class="o">-&gt;</span><span class="n">product_desc</span><span class="p">,</span>
		<span class="n">hcd_name</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">HCD_HW_ACCESSIBLE</span><span class="p">(</span><span class="n">hcd</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">size</span> <span class="o">-=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
			<span class="s">&quot;SUSPENDED (no register access)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ohci_dump_status</span><span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">next</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>

	<span class="cm">/* hcca */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">hcca</span><span class="p">)</span>
		<span class="n">ohci_dbg_nosw</span><span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">next</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">,</span>
			<span class="s">&quot;hcca frame 0x%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ohci_frame_no</span><span class="p">(</span><span class="n">ohci</span><span class="p">));</span>

	<span class="cm">/* other registers mostly affect frame timings */</span>
	<span class="n">rdata</span> <span class="o">=</span> <span class="n">ohci_readl</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">fminterval</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
			<span class="s">&quot;fmintvl 0x%08x %sFSMPS=0x%04x FI=0x%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rdata</span><span class="p">,</span> <span class="p">(</span><span class="n">rdata</span> <span class="o">&gt;&gt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;FIT &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">rdata</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xefff</span><span class="p">,</span> <span class="n">rdata</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span>
	<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">next</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>

	<span class="n">rdata</span> <span class="o">=</span> <span class="n">ohci_readl</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">fmremaining</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;fmremaining 0x%08x %sFR=0x%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rdata</span><span class="p">,</span> <span class="p">(</span><span class="n">rdata</span> <span class="o">&gt;&gt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;FRT &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
			<span class="n">rdata</span> <span class="o">&amp;</span> <span class="mh">0x3fff</span><span class="p">);</span>
	<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">next</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>

	<span class="n">rdata</span> <span class="o">=</span> <span class="n">ohci_readl</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">periodicstart</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;periodicstart 0x%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rdata</span> <span class="o">&amp;</span> <span class="mh">0x3fff</span><span class="p">);</span>
	<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">next</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>

	<span class="n">rdata</span> <span class="o">=</span> <span class="n">ohci_readl</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">lsthresh</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;lsthresh 0x%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rdata</span> <span class="o">&amp;</span> <span class="mh">0x3fff</span><span class="p">);</span>
	<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">next</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="n">scnprintf</span> <span class="p">(</span><span class="n">next</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;hub poll timer %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">HCD_POLL_RH</span><span class="p">(</span><span class="n">ohci_to_hcd</span><span class="p">(</span><span class="n">ohci</span><span class="p">))</span> <span class="o">?</span> <span class="s">&quot;ON&quot;</span> <span class="o">:</span> <span class="s">&quot;off&quot;</span><span class="p">);</span>
	<span class="n">size</span> <span class="o">-=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">next</span> <span class="o">+=</span> <span class="n">temp</span><span class="p">;</span>

	<span class="cm">/* roothub */</span>
	<span class="n">ohci_dump_roothub</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">next</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>

<span class="nl">done:</span>
	<span class="n">spin_unlock_irqrestore</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">PAGE_SIZE</span> <span class="o">-</span> <span class="n">size</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">debug_buffer</span> <span class="o">*</span><span class="nf">alloc_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">ohci</span><span class="p">,</span>
				<span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">fill_func</span><span class="p">)(</span><span class="k">struct</span> <span class="n">debug_buffer</span> <span class="o">*</span><span class="p">))</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">debug_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">debug_buffer</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">buf</span><span class="o">-&gt;</span><span class="n">ohci</span> <span class="o">=</span> <span class="n">ohci</span><span class="p">;</span>
		<span class="n">buf</span><span class="o">-&gt;</span><span class="n">fill_func</span> <span class="o">=</span> <span class="n">fill_func</span><span class="p">;</span>
		<span class="n">mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">fill_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">debug_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">)</span>
		<span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">get_zeroed_page</span><span class="p">(</span><span class="n">GFP_KERNEL</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">buf</span><span class="o">-&gt;</span><span class="n">fill_func</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">buf</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">debug_output</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			<span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">debug_buffer</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">fill_buffer</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span>
				      <span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">,</span> <span class="n">buf</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">);</span>

<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">debug_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">debug_buffer</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">)</span>
			<span class="n">free_page</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">);</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">debug_async_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span> <span class="o">=</span> <span class="n">alloc_buffer</span><span class="p">(</span><span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_private</span><span class="p">,</span> <span class="n">fill_async_buffer</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">debug_periodic_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span> <span class="o">=</span> <span class="n">alloc_buffer</span><span class="p">(</span><span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_private</span><span class="p">,</span>
					  <span class="n">fill_periodic_buffer</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">debug_registers_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span> <span class="o">=</span> <span class="n">alloc_buffer</span><span class="p">(</span><span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_private</span><span class="p">,</span>
					  <span class="n">fill_registers_buffer</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">create_debug_files</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">ohci</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usb_bus</span> <span class="o">*</span><span class="n">bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ohci_to_hcd</span><span class="p">(</span><span class="n">ohci</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">self</span><span class="p">;</span>

	<span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_dir</span> <span class="o">=</span> <span class="n">debugfs_create_dir</span><span class="p">(</span><span class="n">bus</span><span class="o">-&gt;</span><span class="n">bus_name</span><span class="p">,</span> <span class="n">ohci_debug_root</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_dir</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">dir_error</span><span class="p">;</span>

	<span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_async</span> <span class="o">=</span> <span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;async&quot;</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
						<span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_dir</span><span class="p">,</span> <span class="n">ohci</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">debug_async_fops</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_async</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">async_error</span><span class="p">;</span>

	<span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_periodic</span> <span class="o">=</span> <span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;periodic&quot;</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
						   <span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_dir</span><span class="p">,</span> <span class="n">ohci</span><span class="p">,</span>
						   <span class="o">&amp;</span><span class="n">debug_periodic_fops</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_periodic</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">periodic_error</span><span class="p">;</span>

	<span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_registers</span> <span class="o">=</span> <span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;registers&quot;</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
						    <span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_dir</span><span class="p">,</span> <span class="n">ohci</span><span class="p">,</span>
						    <span class="o">&amp;</span><span class="n">debug_registers_fops</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_registers</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">registers_error</span><span class="p">;</span>

	<span class="n">ohci_dbg</span> <span class="p">(</span><span class="n">ohci</span><span class="p">,</span> <span class="s">&quot;created debug files</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>

<span class="nl">registers_error:</span>
	<span class="n">debugfs_remove</span><span class="p">(</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_periodic</span><span class="p">);</span>
<span class="nl">periodic_error:</span>
	<span class="n">debugfs_remove</span><span class="p">(</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_async</span><span class="p">);</span>
<span class="nl">async_error:</span>
	<span class="n">debugfs_remove</span><span class="p">(</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_dir</span><span class="p">);</span>
<span class="nl">dir_error:</span>
	<span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_periodic</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_async</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_dir</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">remove_debug_files</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ohci_hcd</span> <span class="o">*</span><span class="n">ohci</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">debugfs_remove</span><span class="p">(</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_registers</span><span class="p">);</span>
	<span class="n">debugfs_remove</span><span class="p">(</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_periodic</span><span class="p">);</span>
	<span class="n">debugfs_remove</span><span class="p">(</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_async</span><span class="p">);</span>
	<span class="n">debugfs_remove</span><span class="p">(</span><span class="n">ohci</span><span class="o">-&gt;</span><span class="n">debug_dir</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#endif</span>

<span class="cm">/*-------------------------------------------------------------------------*/</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
