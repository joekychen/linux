f | zfcp_scsi.c | s | 20K | 627 | Steffen Maier | maier@linux.vnet.ibm.com | 1323862843 |  | [SCSI] zfcp: return early from slave_destroy if slave_alloc returned early  zfcp_scsi_slave_destroy erroneously always tried to finish its task even if the corresponding previous zfcp_scsi_slave_alloc returned early. This can lead to kernel page faults on accessing uninitialized fields of struct zfcp_scsi_dev in zfcp_erp_lun_shutdown_wait. Take the port field of the struct to determine if slave_alloc returned early.  This zfcp bug is exposed by 4e6c82b (in turn fixing f7c9c6b to be compatible with 21208ae) which can call slave_destroy for a corresponding previous slave_alloc that did not finish.  This patch is based on James Bottomley's fix suggestion in http://www.spinics.net/lists/linux-scsi/msg55449.html.  Signed-off-by: Steffen Maier <maier@linux.vnet.ibm.com> Cc: <stable@kernel.org> #2.6.38+ Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | zfcp_qdio.c | s | 13K | 422 | Heiko Carstens | heiko.carstens@de.ibm.com | 1320103858 |  | s390: add missing module.h/export.h includes  Fix several compile errors on s390 caused by splitting module.h.  Some include additions [e.g. qdio_setup.c, zfcp_qdio.c] are in anticipation of pending changes queued for s390 that increase the modular use footprint.  [PG: added additional obvious changes since Heiko's original patch]  Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com> Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | zfcp_sysfs.c | s | 16K | 476 | Swen Schillig | swen@vnet.ibm.com | 1292955886 |  | [SCSI] zfcp: Redesign of the debug tracing final cleanup.  This patch is the final cleanup of the redesign from the zfcp tracing. Structures and elements which were used by multiple areas of the former debug tracing are now changed to the new scheme.  Signed-off-by: Swen Schillig <swen@vnet.ibm.com> Signed-off-by: Christof Schmitt <christof.schmitt@de.ibm.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | Makefile | g | 239B |  | Christof Schmitt | christof.schmitt@de.ibm.com | 1284692055 |  | [SCSI] zfcp: Move code for managing zfcp_unit devices to new file  Move the code for managing zfcp_unit devices to the new file zfcp_unit.c. This is in preparation for the change that zfcp_unit will only track the LUNs configured via unit_add, other data will be moved from zfcp_unit to the new struct zfcp_scsi_dev.  Reviewed-by: Swen Schillig <swen@vnet.ibm.com> Signed-off-by: Christof Schmitt <christof.schmitt@de.ibm.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | zfcp_qdio.h | s | 7.1K | 240 | Swen Schillig | swen@vnet.ibm.com | 1314455823 |  | [SCSI] zfcp: support for hardware data router  FICON Express8S supports hardware data router, which requires an adapted qdio request format. This part 2/2 exploits the functionality in zfcp.  Signed-off-by: Swen Schillig <swen@vnet.ibm.com> Signed-off-by: Steffen Maier <maier@linux.vnet.ibm.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | zfcp_ext.h | s | 8.2K | 158 | Swen Schillig | swen@vnet.ibm.com | 1314455823 |  | [SCSI] zfcp: support for hardware data router  FICON Express8S supports hardware data router, which requires an adapted qdio request format. This part 2/2 exploits the functionality in zfcp.  Signed-off-by: Swen Schillig <swen@vnet.ibm.com> Signed-off-by: Steffen Maier <maier@linux.vnet.ibm.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | zfcp_erp.c | s | 42K | 1324 | Christof Schmitt | christof.schmitt@de.ibm.com | 1298653341 |  | [SCSI] zfcp: Add information to symbolic port name when running in NPIV mode  Query the FC symbolic port name for reporting in the fc_host sysfs and enable the symbolic_name attribute in the fc_host sysfs. When running in NPIV mode, extend the symbolic port name with the devno and the hostname. This allows better identification of Linux systems for SAN and storage administrators.  Signed-off-by: Christof Schmitt <christof.schmitt@de.ibm.com> Signed-off-by: Steffen Maier <maier@linux.vnet.ibm.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | zfcp_dbf.h | s | 9.9K | 348 | Swen Schillig | swen@vnet.ibm.com | 1292955886 |  | [SCSI] zfcp: Redesign of the debug tracing final cleanup.  This patch is the final cleanup of the redesign from the zfcp tracing. Structures and elements which were used by multiple areas of the former debug tracing are now changed to the new scheme.  Signed-off-by: Swen Schillig <swen@vnet.ibm.com> Signed-off-by: Christof Schmitt <christof.schmitt@de.ibm.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | zfcp_dbf.c | s | 14K | 434 | Heiko Carstens | heiko.carstens@de.ibm.com | 1320103858 |  | s390: add missing module.h/export.h includes  Fix several compile errors on s390 caused by splitting module.h.  Some include additions [e.g. qdio_setup.c, zfcp_qdio.c] are in anticipation of pending changes queued for s390 that increase the modular use footprint.  [PG: added additional obvious changes since Heiko's original patch]  Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com> Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | zfcp_cfdc.c | s | 12K | 387 | Heiko Carstens | heiko.carstens@de.ibm.com | 1330358067 |  | compat: fix compile breakage on s390  The new is_compat_task() define for the !COMPAT case in include/linux/compat.h conflicts with a similar define in arch/s390/include/asm/compat.h.  This is the minimal patch which fixes the build issues.  Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | zfcp_fsf.h | s | 13K | 424 | Felix Beck | felix.beck@de.ibm.com | 1280328536 |  | [SCSI] zfcp: Introduce experimental support for DIF/DIX  Introduce support for DIF/DIX in zfcp: Report the capabilities for the Scsi_host, map the protection data when issuing I/O requests and handle the new error codes. Also add the fsf data_direction field to the hba trace, it is useful information for debugging in that area. This is an EXPERIMENTAL feature for now.  Signed-off-by: Felix Beck <felix.beck@de.ibm.com> Signed-off-by: Christof Schmitt <christof.schmitt@de.ibm.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | zfcp_reqlist.h | s | 4.4K | 156 | Christof Schmitt | christof.schmitt@de.ibm.com | 1266450379 |  | [SCSI] zfcp: Move FSF request tracking code to new file  Move the code for tracking FSF requests to new file to have this code in one place. The functions for adding and removing requests on the I/O path are already inline. The alloc and free functions are only called once, so it does not hurt to inline them and add them to the same file.  Reviewed-by: Swen Schillig <swen@vnet.ibm.com> Signed-off-by: Christof Schmitt <christof.schmitt@de.ibm.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | zfcp_fc.h | s | 7.8K | 265 | Christof Schmitt | christof.schmitt@de.ibm.com | 1298653341 |  | [SCSI] zfcp: Add information to symbolic port name when running in NPIV mode  Query the FC symbolic port name for reporting in the fc_host sysfs and enable the symbolic_name attribute in the fc_host sysfs. When running in NPIV mode, extend the symbolic port name with the devno and the hostname. This allows better identification of Linux systems for SAN and storage administrators.  Signed-off-by: Christof Schmitt <christof.schmitt@de.ibm.com> Signed-off-by: Steffen Maier <maier@linux.vnet.ibm.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | zfcp_unit.c | s | 6.0K | 206 | Christof Schmitt | christof.schmitt@de.ibm.com | 1288017757 |  | [SCSI] zfcp: Call get_device on port before calling put_device  zfcp_unit_release calls put_device on the port. Ensure that get_device has been called before possibly triggering the release function through put_device or device_unregister.  Reviewed-by: Swen Schillig <swen@vnet.ibm.com> Signed-off-by: Christof Schmitt <christof.schmitt@de.ibm.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | zfcp_fc.c | s | 26K | 806 | Christof Schmitt | christof.schmitt@de.ibm.com | 1298653341 |  | [SCSI] zfcp: Add information to symbolic port name when running in NPIV mode  Query the FC symbolic port name for reporting in the fc_host sysfs and enable the symbolic_name attribute in the fc_host sysfs. When running in NPIV mode, extend the symbolic port name with the devno and the hostname. This allows better identification of Linux systems for SAN and storage administrators.  Signed-off-by: Christof Schmitt <christof.schmitt@de.ibm.com> Signed-off-by: Steffen Maier <maier@linux.vnet.ibm.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | zfcp_def.h | s | 10K | 292 | Swen Schillig | swen@vnet.ibm.com | 1314455823 |  | [SCSI] zfcp: support for hardware data router  FICON Express8S supports hardware data router, which requires an adapted qdio request format. This part 2/2 exploits the functionality in zfcp.  Signed-off-by: Swen Schillig <swen@vnet.ibm.com> Signed-off-by: Steffen Maier <maier@linux.vnet.ibm.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | zfcp_fsf.c | s | 67K | 2107 | Swen Schillig | swen@vnet.ibm.com | 1314455823 |  | [SCSI] zfcp: support for hardware data router  FICON Express8S supports hardware data router, which requires an adapted qdio request format. This part 2/2 exploits the functionality in zfcp.  Signed-off-by: Swen Schillig <swen@vnet.ibm.com> Signed-off-by: Steffen Maier <maier@linux.vnet.ibm.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | zfcp_ccw.c | s | 7.0K | 227 | Heiko Carstens | heiko.carstens@de.ibm.com | 1320103858 |  | s390: add missing module.h/export.h includes  Fix several compile errors on s390 caused by splitting module.h.  Some include additions [e.g. qdio_setup.c, zfcp_qdio.c] are in anticipation of pending changes queued for s390 that increase the modular use footprint.  [PG: added additional obvious changes since Heiko's original patch]  Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com> Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | zfcp_aux.c | s | 15K | 498 | Heiko Carstens | heiko.carstens@de.ibm.com | 1320103858 |  | s390: add missing module.h/export.h includes  Fix several compile errors on s390 caused by splitting module.h.  Some include additions [e.g. qdio_setup.c, zfcp_qdio.c] are in anticipation of pending changes queued for s390 that increase the modular use footprint.  [PG: added additional obvious changes since Heiko's original patch]  Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com> Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
