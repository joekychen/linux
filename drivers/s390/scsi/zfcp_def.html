<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › s390 › scsi › zfcp_def.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>zfcp_def.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * zfcp device driver</span>
<span class="cm"> *</span>
<span class="cm"> * Global definitions for the zfcp device driver.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright IBM Corporation 2002, 2010</span>
<span class="cm"> */</span>

<span class="cp">#ifndef ZFCP_DEF_H</span>
<span class="cp">#define ZFCP_DEF_H</span>

<span class="cm">/*************************** INCLUDES *****************************************/</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/moduleparam.h&gt;</span>
<span class="cp">#include &lt;linux/major.h&gt;</span>
<span class="cp">#include &lt;linux/blkdev.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/mempool.h&gt;</span>
<span class="cp">#include &lt;linux/syscalls.h&gt;</span>
<span class="cp">#include &lt;linux/scatterlist.h&gt;</span>
<span class="cp">#include &lt;linux/ioctl.h&gt;</span>
<span class="cp">#include &lt;scsi/fc/fc_fs.h&gt;</span>
<span class="cp">#include &lt;scsi/fc/fc_gs.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_tcq.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_cmnd.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_device.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_host.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_transport.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_transport_fc.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_bsg_fc.h&gt;</span>
<span class="cp">#include &lt;asm/ccwdev.h&gt;</span>
<span class="cp">#include &lt;asm/debug.h&gt;</span>
<span class="cp">#include &lt;asm/ebcdic.h&gt;</span>
<span class="cp">#include &lt;asm/sysinfo.h&gt;</span>
<span class="cp">#include &quot;zfcp_fsf.h&quot;</span>
<span class="cp">#include &quot;zfcp_fc.h&quot;</span>
<span class="cp">#include &quot;zfcp_qdio.h&quot;</span>

<span class="k">struct</span> <span class="n">zfcp_reqlist</span><span class="p">;</span>

<span class="cm">/********************* SCSI SPECIFIC DEFINES *********************************/</span>
<span class="cp">#define ZFCP_SCSI_ER_TIMEOUT                    (10*HZ)</span>

<span class="cm">/********************* FSF SPECIFIC DEFINES *********************************/</span>

<span class="cm">/* ATTENTION: value must not be used by hardware */</span>
<span class="cp">#define FSF_QTCB_UNSOLICITED_STATUS		0x6305</span>

<span class="cm">/* timeout value for &quot;default timer&quot; for fsf requests */</span>
<span class="cp">#define ZFCP_FSF_REQUEST_TIMEOUT (60*HZ)</span>

<span class="cm">/*************** ADAPTER/PORT/UNIT AND FSF_REQ STATUS FLAGS ******************/</span>

<span class="cm">/*</span>
<span class="cm"> * Note, the leftmost status byte is common among adapter, port</span>
<span class="cm"> * and unit</span>
<span class="cm"> */</span>
<span class="cp">#define ZFCP_COMMON_FLAGS			0xfff00000</span>

<span class="cm">/* common status bits */</span>
<span class="cp">#define ZFCP_STATUS_COMMON_RUNNING		0x40000000</span>
<span class="cp">#define ZFCP_STATUS_COMMON_ERP_FAILED		0x20000000</span>
<span class="cp">#define ZFCP_STATUS_COMMON_UNBLOCKED		0x10000000</span>
<span class="cp">#define ZFCP_STATUS_COMMON_OPEN                 0x04000000</span>
<span class="cp">#define ZFCP_STATUS_COMMON_ERP_INUSE		0x01000000</span>
<span class="cp">#define ZFCP_STATUS_COMMON_ACCESS_DENIED	0x00800000</span>
<span class="cp">#define ZFCP_STATUS_COMMON_ACCESS_BOXED		0x00400000</span>
<span class="cp">#define ZFCP_STATUS_COMMON_NOESC		0x00200000</span>

<span class="cm">/* adapter status */</span>
<span class="cp">#define ZFCP_STATUS_ADAPTER_MB_ACT		0x00000001</span>
<span class="cp">#define ZFCP_STATUS_ADAPTER_QDIOUP		0x00000002</span>
<span class="cp">#define ZFCP_STATUS_ADAPTER_SIOSL_ISSUED	0x00000004</span>
<span class="cp">#define ZFCP_STATUS_ADAPTER_XCONFIG_OK		0x00000008</span>
<span class="cp">#define ZFCP_STATUS_ADAPTER_HOST_CON_INIT	0x00000010</span>
<span class="cp">#define ZFCP_STATUS_ADAPTER_ERP_PENDING		0x00000100</span>
<span class="cp">#define ZFCP_STATUS_ADAPTER_LINK_UNPLUGGED	0x00000200</span>
<span class="cp">#define ZFCP_STATUS_ADAPTER_DATA_DIV_ENABLED	0x00000400</span>

<span class="cm">/* remote port status */</span>
<span class="cp">#define ZFCP_STATUS_PORT_PHYS_OPEN		0x00000001</span>
<span class="cp">#define ZFCP_STATUS_PORT_LINK_TEST		0x00000002</span>

<span class="cm">/* logical unit status */</span>
<span class="cp">#define ZFCP_STATUS_LUN_SHARED			0x00000004</span>
<span class="cp">#define ZFCP_STATUS_LUN_READONLY		0x00000008</span>

<span class="cm">/* FSF request status (this does not have a common part) */</span>
<span class="cp">#define ZFCP_STATUS_FSFREQ_ERROR		0x00000008</span>
<span class="cp">#define ZFCP_STATUS_FSFREQ_CLEANUP		0x00000010</span>
<span class="cp">#define ZFCP_STATUS_FSFREQ_ABORTSUCCEEDED	0x00000040</span>
<span class="cp">#define ZFCP_STATUS_FSFREQ_ABORTNOTNEEDED       0x00000080</span>
<span class="cp">#define ZFCP_STATUS_FSFREQ_TMFUNCFAILED         0x00000200</span>
<span class="cp">#define ZFCP_STATUS_FSFREQ_DISMISSED            0x00001000</span>

<span class="cm">/************************* STRUCTURE DEFINITIONS *****************************/</span>

<span class="k">struct</span> <span class="n">zfcp_fsf_req</span><span class="p">;</span>

<span class="cm">/* holds various memory pools of an adapter */</span>
<span class="k">struct</span> <span class="n">zfcp_adapter_mempool</span> <span class="p">{</span>
	<span class="n">mempool_t</span> <span class="o">*</span><span class="n">erp_req</span><span class="p">;</span>
	<span class="n">mempool_t</span> <span class="o">*</span><span class="n">gid_pn_req</span><span class="p">;</span>
	<span class="n">mempool_t</span> <span class="o">*</span><span class="n">scsi_req</span><span class="p">;</span>
	<span class="n">mempool_t</span> <span class="o">*</span><span class="n">scsi_abort</span><span class="p">;</span>
	<span class="n">mempool_t</span> <span class="o">*</span><span class="n">status_read_req</span><span class="p">;</span>
	<span class="n">mempool_t</span> <span class="o">*</span><span class="n">sr_data</span><span class="p">;</span>
	<span class="n">mempool_t</span> <span class="o">*</span><span class="n">gid_pn</span><span class="p">;</span>
	<span class="n">mempool_t</span> <span class="o">*</span><span class="n">qtcb_pool</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">zfcp_erp_action</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">action</span><span class="p">;</span>	              <span class="cm">/* requested action code */</span>
	<span class="k">struct</span> <span class="n">zfcp_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">;</span> <span class="cm">/* device which should be recovered */</span>
	<span class="k">struct</span> <span class="n">zfcp_port</span> <span class="o">*</span><span class="n">port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_device</span> <span class="o">*</span><span class="n">sdev</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">status</span><span class="p">;</span>	      <span class="cm">/* recovery status */</span>
	<span class="n">u32</span> <span class="n">step</span><span class="p">;</span>	              <span class="cm">/* active step of this erp action */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">fsf_req_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">timer</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fsf_latency_record</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">min</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">max</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">sum</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">latency_cont</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fsf_latency_record</span> <span class="n">channel</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fsf_latency_record</span> <span class="n">fabric</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">counter</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">zfcp_latencies</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">latency_cont</span> <span class="n">read</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">latency_cont</span> <span class="n">write</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">latency_cont</span> <span class="n">cmd</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">zfcp_adapter</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">kref</span>		<span class="n">ref</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">peer_wwnn</span><span class="p">;</span>	   <span class="cm">/* P2P peer WWNN */</span>
	<span class="n">u64</span>			<span class="n">peer_wwpn</span><span class="p">;</span>	   <span class="cm">/* P2P peer WWPN */</span>
	<span class="n">u32</span>			<span class="n">peer_d_id</span><span class="p">;</span>	   <span class="cm">/* P2P peer D_ID */</span>
	<span class="k">struct</span> <span class="n">ccw_device</span>       <span class="o">*</span><span class="n">ccw_device</span><span class="p">;</span>	   <span class="cm">/* S/390 ccw device */</span>
	<span class="k">struct</span> <span class="n">zfcp_qdio</span>	<span class="o">*</span><span class="n">qdio</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">hydra_version</span><span class="p">;</span>	   <span class="cm">/* Hydra version */</span>
	<span class="n">u32</span>			<span class="n">fsf_lic_version</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">adapter_features</span><span class="p">;</span>  <span class="cm">/* FCP channel features */</span>
	<span class="n">u32</span>			<span class="n">connection_features</span><span class="p">;</span> <span class="cm">/* host connection features */</span>
        <span class="n">u32</span>			<span class="n">hardware_version</span><span class="p">;</span>  <span class="cm">/* of FCP channel */</span>
	<span class="n">u16</span>			<span class="n">timer_ticks</span><span class="p">;</span>       <span class="cm">/* time int for a tick */</span>
	<span class="k">struct</span> <span class="n">Scsi_Host</span>	<span class="o">*</span><span class="n">scsi_host</span><span class="p">;</span>	   <span class="cm">/* Pointer to mid-layer */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">port_list</span><span class="p">;</span>	   <span class="cm">/* remote port list */</span>
	<span class="n">rwlock_t</span>		<span class="n">port_list_lock</span><span class="p">;</span>    <span class="cm">/* port list lock */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">req_no</span><span class="p">;</span>		   <span class="cm">/* unique FSF req number */</span>
	<span class="k">struct</span> <span class="n">zfcp_reqlist</span>	<span class="o">*</span><span class="n">req_list</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">fsf_req_seq_no</span><span class="p">;</span>	   <span class="cm">/* FSF cmnd seq number */</span>
	<span class="n">rwlock_t</span>		<span class="n">abort_lock</span><span class="p">;</span>        <span class="cm">/* Protects against SCSI</span>
<span class="cm">						      stack abort/command</span>
<span class="cm">						      completion races */</span>
	<span class="n">atomic_t</span>		<span class="n">stat_miss</span><span class="p">;</span>	   <span class="cm">/* # missing status reads*/</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">stat_read_buf_num</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>	<span class="n">stat_work</span><span class="p">;</span>
	<span class="n">atomic_t</span>		<span class="n">status</span><span class="p">;</span>	           <span class="cm">/* status of this adapter */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">erp_ready_head</span><span class="p">;</span>	   <span class="cm">/* error recovery for this</span>
<span class="cm">						      adapter/devices */</span>
	<span class="n">wait_queue_head_t</span>	<span class="n">erp_ready_wq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">erp_running_head</span><span class="p">;</span>
	<span class="n">rwlock_t</span>		<span class="n">erp_lock</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span>	<span class="n">erp_done_wqh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">zfcp_erp_action</span>	<span class="n">erp_action</span><span class="p">;</span>	   <span class="cm">/* pending error recovery */</span>
        <span class="n">atomic_t</span>                <span class="n">erp_counter</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">erp_total_count</span><span class="p">;</span>   <span class="cm">/* total nr of enqueued erp</span>
<span class="cm">						      actions */</span>
	<span class="n">u32</span>			<span class="n">erp_low_mem_count</span><span class="p">;</span> <span class="cm">/* nr of erp actions waiting</span>
<span class="cm">						      for memory */</span>
	<span class="k">struct</span> <span class="n">task_struct</span>	<span class="o">*</span><span class="n">erp_thread</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">zfcp_fc_wka_ports</span> <span class="o">*</span><span class="n">gs</span><span class="p">;</span>		   <span class="cm">/* generic services */</span>
	<span class="k">struct</span> <span class="n">zfcp_dbf</span>		<span class="o">*</span><span class="n">dbf</span><span class="p">;</span>		   <span class="cm">/* debug traces */</span>
	<span class="k">struct</span> <span class="n">zfcp_adapter_mempool</span>	<span class="n">pool</span><span class="p">;</span>      <span class="cm">/* Adapter memory pools */</span>
	<span class="k">struct</span> <span class="n">fc_host_statistics</span> <span class="o">*</span><span class="n">fc_stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fsf_qtcb_bottom_port</span> <span class="o">*</span><span class="n">stats_reset_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">stats_reset</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>	<span class="n">scan_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>	<span class="n">ns_up_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">service_level</span>	<span class="n">service_level</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">workqueue_struct</span>	<span class="o">*</span><span class="n">work_queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_dma_parameters</span> <span class="n">dma_parms</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">zfcp_fc_events</span> <span class="n">events</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">zfcp_port</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span>          <span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fc_rport</span>        <span class="o">*</span><span class="n">rport</span><span class="p">;</span>         <span class="cm">/* rport of fc transport class */</span>
	<span class="k">struct</span> <span class="n">list_head</span>       <span class="n">list</span><span class="p">;</span>	       <span class="cm">/* list of remote ports */</span>
	<span class="k">struct</span> <span class="n">zfcp_adapter</span>    <span class="o">*</span><span class="n">adapter</span><span class="p">;</span>       <span class="cm">/* adapter used to access port */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">unit_list</span><span class="p">;</span>	<span class="cm">/* head of logical unit list */</span>
	<span class="n">rwlock_t</span>		<span class="n">unit_list_lock</span><span class="p">;</span> <span class="cm">/* unit list lock */</span>
	<span class="n">atomic_t</span>	       <span class="n">status</span><span class="p">;</span>	       <span class="cm">/* status of this remote port */</span>
	<span class="n">u64</span>		       <span class="n">wwnn</span><span class="p">;</span>	       <span class="cm">/* WWNN if known */</span>
	<span class="n">u64</span>		       <span class="n">wwpn</span><span class="p">;</span>	       <span class="cm">/* WWPN */</span>
	<span class="n">u32</span>		       <span class="n">d_id</span><span class="p">;</span>	       <span class="cm">/* D_ID */</span>
	<span class="n">u32</span>		       <span class="n">handle</span><span class="p">;</span>	       <span class="cm">/* handle assigned by FSF */</span>
	<span class="k">struct</span> <span class="n">zfcp_erp_action</span> <span class="n">erp_action</span><span class="p">;</span>     <span class="cm">/* pending error recovery */</span>
        <span class="n">atomic_t</span>               <span class="n">erp_counter</span><span class="p">;</span>
	<span class="n">u32</span>                    <span class="n">maxframe_size</span><span class="p">;</span>
	<span class="n">u32</span>                    <span class="n">supported_classes</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>     <span class="n">gid_pn_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>     <span class="n">test_link_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>     <span class="n">rport_work</span><span class="p">;</span>
	<span class="k">enum</span> <span class="p">{</span> <span class="n">RPORT_NONE</span><span class="p">,</span> <span class="n">RPORT_ADD</span><span class="p">,</span> <span class="n">RPORT_DEL</span> <span class="p">}</span>  <span class="n">rport_task</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">starget_id</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct zfcp_unit - LUN configured via zfcp sysfs</span>
<span class="cm"> * @dev: struct device for sysfs representation and reference counting</span>
<span class="cm"> * @list: entry in LUN/unit list per zfcp_port</span>
<span class="cm"> * @port: reference to zfcp_port where this LUN is configured</span>
<span class="cm"> * @fcp_lun: 64 bit LUN value</span>
<span class="cm"> * @scsi_work: for running scsi_scan_target</span>
<span class="cm"> *</span>
<span class="cm"> * This is the representation of a LUN that has been configured for</span>
<span class="cm"> * usage. The main data here is the 64 bit LUN value, data for</span>
<span class="cm"> * running I/O and recovery is in struct zfcp_scsi_dev.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">zfcp_unit</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span>		<span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">zfcp_port</span>	<span class="o">*</span><span class="n">port</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">fcp_lun</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>	<span class="n">scsi_work</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct zfcp_scsi_dev - zfcp data per SCSI device</span>
<span class="cm"> * @status: zfcp internal status flags</span>
<span class="cm"> * @lun_handle: handle from &quot;open lun&quot; for issuing FSF requests</span>
<span class="cm"> * @erp_action: zfcp erp data for opening and recovering this LUN</span>
<span class="cm"> * @erp_counter: zfcp erp counter for this LUN</span>
<span class="cm"> * @latencies: FSF channel and fabric latencies</span>
<span class="cm"> * @port: zfcp_port where this LUN belongs to</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">zfcp_scsi_dev</span> <span class="p">{</span>
	<span class="n">atomic_t</span>		<span class="n">status</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">lun_handle</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">zfcp_erp_action</span>	<span class="n">erp_action</span><span class="p">;</span>
	<span class="n">atomic_t</span>		<span class="n">erp_counter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">zfcp_latencies</span>	<span class="n">latencies</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">zfcp_port</span>	<span class="o">*</span><span class="n">port</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * sdev_to_zfcp - Access zfcp LUN data for SCSI device</span>
<span class="cm"> * @sdev: scsi_device where to get the zfcp_scsi_dev pointer</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">zfcp_scsi_dev</span> <span class="o">*</span><span class="nf">sdev_to_zfcp</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_device</span> <span class="o">*</span><span class="n">sdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">scsi_transport_device_data</span><span class="p">(</span><span class="n">sdev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * zfcp_scsi_dev_lun - Return SCSI device LUN as 64 bit FCP LUN</span>
<span class="cm"> * @sdev: SCSI device where to get the LUN from</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">u64</span> <span class="nf">zfcp_scsi_dev_lun</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_device</span> <span class="o">*</span><span class="n">sdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u64</span> <span class="n">fcp_lun</span><span class="p">;</span>

	<span class="n">int_to_scsilun</span><span class="p">(</span><span class="n">sdev</span><span class="o">-&gt;</span><span class="n">lun</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_lun</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">fcp_lun</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">fcp_lun</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * struct zfcp_fsf_req - basic FSF request structure</span>
<span class="cm"> * @list: list of FSF requests</span>
<span class="cm"> * @req_id: unique request ID</span>
<span class="cm"> * @adapter: adapter this request belongs to</span>
<span class="cm"> * @qdio_req: qdio queue related values</span>
<span class="cm"> * @completion: used to signal the completion of the request</span>
<span class="cm"> * @status: status of the request</span>
<span class="cm"> * @fsf_command: FSF command issued</span>
<span class="cm"> * @qtcb: associated QTCB</span>
<span class="cm"> * @seq_no: sequence number of this request</span>
<span class="cm"> * @data: private data</span>
<span class="cm"> * @timer: timer data of this request</span>
<span class="cm"> * @erp_action: reference to erp action if request issued on behalf of ERP</span>
<span class="cm"> * @pool: reference to memory pool if used for this request</span>
<span class="cm"> * @issued: time when request was send (STCK)</span>
<span class="cm"> * @handler: handler which should be called to process response</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">zfcp_fsf_req</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">list</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">req_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">zfcp_adapter</span>	<span class="o">*</span><span class="n">adapter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">zfcp_qdio_req</span>	<span class="n">qdio_req</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span>	<span class="n">completion</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">status</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">fsf_command</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fsf_qtcb</span>		<span class="o">*</span><span class="n">qtcb</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">seq_no</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span>	<span class="n">timer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">zfcp_erp_action</span>	<span class="o">*</span><span class="n">erp_action</span><span class="p">;</span>
	<span class="n">mempool_t</span>		<span class="o">*</span><span class="n">pool</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span>	<span class="n">issued</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="p">(</span><span class="o">*</span><span class="n">handler</span><span class="p">)(</span><span class="k">struct</span> <span class="n">zfcp_fsf_req</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">zfcp_adapter_multi_buffer_active</span><span class="p">(</span><span class="k">struct</span> <span class="n">zfcp_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ZFCP_STATUS_ADAPTER_MB_ACT</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* ZFCP_DEF_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
