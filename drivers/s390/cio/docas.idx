f | device.c | s | 54K | 1914 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1337172166 |  | s390/ccwgroup: exploit ccwdev_by_dev_id  Instead of finding devices via driver_find_device use the bus_find_device wrapper get_ccwdev_by_dev_id. This allows us to get rid of the ccw_driver argument of ccwgroup_create_dev and thus simplify the interface.  Reviewed-by: Cornelia Huck <cornelia.huck@de.ibm.com> Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | Makefile | g | 460B |  | Jan Glauber | jang@linux.vnet.ibm.com | 1262592358 |  | [S390] qdio: convert global statistics to per-device stats  Revamp the qdio performance statistics and move them from procfs to debugfs using the seq_file interface. Since the statistics are not intended for the general user the removal of /proc/qdio_perf should not surprise anyone.  The per device statistics are disabled by default, writing 1 to /<debugfs mountpoint>/qdio/<device bus ID>/statistics enables the statistics for the given device.  Signed-off-by: Jan Glauber <jang@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | crw.c | s | 4.0K | 147 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for S390  Disintegrate asm/system.h for S390.  Signed-off-by: David Howells <dhowells@redhat.com> cc: linux-s390@vger.kernel.org
f | fcx.c | s | 9.3K | 327 | Julia Lawall | julia@diku.dk | 1261154612 |  | [S390] drivers: Correct size given to memset  Memset should be given the size of the structure, not the size of the pointer.  The semantic patch that makes this change is as follows: (http://coccinelle.lip6.fr/)  // <smpl> @@ type T; T *x; expression E; @@  memset(x, E, sizeof( + *  x)) // </smpl>  Signed-off-by: Julia Lawall <julia@diku.dk> Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | device_fsm.c | s | 30K | 1030 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1322742738 |  | [S390] cio: provide fake irb for transport mode IO  If a driver wants to do command mode IO while CIO is doing online path verification we ignore this request and provide a fake irb when we are done and the driver can do IO again.  For transport mode IO we have no such mechanism, giving the driver no other chance then to retry the action until we are done. This is not very reliable.  Provide a fake irb for transport mode IO as well.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | blacklist.c | s | 8.3K | 342 | Joe Perches | joe@perches.com | 1316087702 |  | s390: Convert vmalloc/memset to vzalloc  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | idset.h | s | 771B | 21 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1253653122 |  | [S390] cio: introduce consistent subchannel scanning  Previously, there were multiple subchannel scanning mechanisms which could potentially conflict with each other. Fix this problem by moving blacklist and ccw driver triggered scanning to the existing evaluation method.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | blacklist.h | s | 108B | 4 | Cornelia Huck | cohuck@de.ibm.com | 1136565232 |  | [PATCH] s390: multiple subchannel sets support  Add support for multiple subchannel sets.  Works with arbitrary devices in subchannel set 1 and is transparent to device drivers.  Although currently only two subchannel sets are available, this will work with the architectured maximum number of subchannel sets as well.  Signed-off-by: Cornelia Huck <cohuck@de.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com> Signed-off-by: Andrew Morton <akpm@osdl.org> Signed-off-by: Linus Torvalds <torvalds@osdl.org>
f | css.h | s | 4.4K | 129 | Martin Schwidefsky | schwidefsky@de.ibm.com | 1319984206 |  | [S390] sparse: fix sparse warnings about missing prototypes  Add prototypes and includes for functions used in different modules.  Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | chp.c | s | 17K | 646 | Heiko Carstens | heiko.carstens@de.ibm.com | 1320103858 |  | s390: add missing module.h/export.h includes  Fix several compile errors on s390 caused by splitting module.h.  Some include additions [e.g. qdio_setup.c, zfcp_qdio.c] are in anticipation of pending changes queued for s390 that increase the modular use footprint.  [PG: added additional obvious changes since Heiko's original patch]  Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com> Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | chp.h | s | 1.7K | 61 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1288015818 |  | [S390] cio: update descriptor in chsc_chp_vary  Update the channel path descriptor at the beginning of to the vary_on operation.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | cmf.c | s | 33K | 1189 | Rusty Russell | rusty@rustcorp.com.au | 1326409337 |  | module_param: avoid bool abuse, add bint for special cases.  For historical reasons, we allow module_param(bool) to take an int (or an unsigned int).  That's going away.  A few drivers really want an int: they set it to -1 and a parameter will set it to 0 or 1.  This sucks: reading them from sysfs will give 'Y' for both -1 and 1, but if we change it to an int, then the users might be broken (if they did "param" instead of "param=1").  Use a new 'bint' parser for them.  (ntfs has a different problem: it needs an int for debug_msgs because it's also exposed via sysctl.)  Cc: Steve Glendinning <steve.glendinning@smsc.com> Cc: Jean Delvare <khali@linux-fr.org> Cc: Guenter Roeck <guenter.roeck@ericsson.com> Cc: Hoang-Nam Nguyen <hnguyen@de.ibm.com> Cc: Christoph Raisch <raisch@de.ibm.com> Cc: Roland Dreier <roland@kernel.org> Cc: Sean Hefty <sean.hefty@intel.com> Cc: Hal Rosenstock <hal.rosenstock@gmail.com> Cc: linux390@de.ibm.com Cc: Anton Altaparmakov <anton@tuxera.com> Cc: Jaroslav Kysela <perex@perex.cz> Cc: Takashi Iwai <tiwai@suse.de> Cc: lm-sensors@lm-sensors.org Cc: linux-rdma@vger.kernel.org Cc: linux-s390@vger.kernel.org Cc: linux-ntfs-dev@lists.sourceforge.net Cc: alsa-devel@alsa-project.org Acked-by: Takashi Iwai <tiwai@suse.de> (For the sound part) Acked-by: Guenter Roeck <guenter.roeck@ericsson.com> (For the hwmon driver) Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | ccwgroup.c | s | 15K | 541 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1337172169 |  | s390/ccwgroup: remove ccwgroup_create_from_string  Remove the old ccwgroup_create_from_string interface since all drivers have been converted to ccwgroup_create_dev. Also remove now unused members of ccwgroup_driver.  Reviewed-by: Cornelia Huck <cornelia.huck@de.ibm.com> Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | device_ops.c | s | 23K | 724 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1322742738 |  | [S390] cio: provide fake irb for transport mode IO  If a driver wants to do command mode IO while CIO is doing online path verification we ignore this request and provide a fake irb when we are done and the driver can do IO again.  For transport mode IO we have no such mechanism, giving the driver no other chance then to retry the action until we are done. This is not very reliable.  Provide a fake irb for transport mode IO as well.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | itcw.c | s | 11K | 352 | Stefan Weinhuber | wein@de.ibm.com | 1294228049 |  | [S390] cio: reduce memory consumption of itcw structures  Any list of indirect data adresses (TIDAL) used by a TCW must not cross a page boundary. The original itcw implementation complies with this restriction by allocating allmost twice as much memory as actually needed, so that in any case there is enough room for the full TIDAL, either above or below the page boundary. This patch implements an alternative method, by using a TTIC TIDAW to connect TIDAL parts below and above a page boundary.  Signed-off-by: Stefan Weinhuber <wein@de.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | device_pgid.c | s | 14K | 523 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1288015819 |  | [S390] cio: notify drivers of channel path events  This patch adds a notification mechanism to inform ccw drivers about changes to channel paths, which occured while the device is online.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | qdio_main.c | s | 44K | 1589 | Heiko Carstens | heiko.carstens@de.ibm.com | 1337172161 |  | s390/time: always use stckf instead of stck if available  The store clock fast instruction saves a couple of instructions compared to the store clock instruction. Always use stckf instead of stck if it is available.  Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com> Reviewed-by: Martin Schwidefsky <schwidefsky@de.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | chsc_sch.c | s | 19K | 806 | Heiko Carstens | heiko.carstens@de.ibm.com | 1330358067 |  | compat: fix compile breakage on s390  The new is_compat_task() define for the !COMPAT case in include/linux/compat.h conflicts with a similar define in arch/s390/include/asm/compat.h.  This is the minimal patch which fixes the build issues.  Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | ccwreq.c | s | 8.3K | 338 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1319984201 |  | [S390] cio: add message for timeouts on internal I/O  Print a message in case we do not receive an IRQ in time (for internal I/O). Also print the ID of the last used channel path, since it is possible that not the device itself but this specific path might have a defect.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | chsc_sch.h | s | 179B | 10 | Cornelia Huck | cornelia.huck@de.ibm.com | 1216022532 |  | [S390] cio: Add chsc subchannel driver.  This patch adds a driver for subchannels of type chsc.  A device /dev/chsc is created which may be used to issue ioctls to: - obtain information about the machine's I/O configuration - dynamically change the machine's I/O configuration via   asynchronous chsc commands  Signed-off-by: Cornelia Huck <cornelia.huck@de.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com> Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
f | device.h | s | 4.7K | 131 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1337172166 |  | s390/ccwgroup: exploit ccwdev_by_dev_id  Instead of finding devices via driver_find_device use the bus_find_device wrapper get_ccwdev_by_dev_id. This allows us to get rid of the ccw_driver argument of ccwgroup_create_dev and thus simplify the interface.  Reviewed-by: Cornelia Huck <cornelia.huck@de.ibm.com> Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | qdio.h | s | 12K | 393 | Jan Glauber | jang@linux.vnet.ibm.com | 1319984207 |  | [S390] qdio: prevent dsci access without adapter interrupts  A kernel panic may occur during sending or receiving network packets on a machine without adapter interrupts since commit d36deae. The bug is triggered by writing to the shared indicator address which is set to 0 if the machine doesn't have adapter interrupts.  Make the reading and setting of the shared indicator dependent on the adapter interrupt feature and while at it move the code to the file containing the adapter interrupt related code.  Thanks to Jan Jaeger for tracking this down.  Reported-by: Jan Jaeger <jan.jaeger@westnet.com.au> Tested-by: Jan Jaeger <jan.jaeger@westnet.com.au> Signed-off-by: Jan Glauber <jang@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | cio.h | s | 4.4K | 131 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1322742737 |  | [S390] hibernate: directly trigger subchannel evaluation  Using the generic css_schedule_eval to evaluate subchannels while resuming from hibernation is very slow when used with many devices. Provide a new evaluation trigger which exploits css_sched_sch_todo and use this in the resume callback for ccw devices.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | idset.c | s | 2.7K | 109 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1253653122 |  | [S390] cio: introduce consistent subchannel scanning  Previously, there were multiple subchannel scanning mechanisms which could potentially conflict with each other. Fix this problem by moving blacklist and ccw driver triggered scanning to the existing evaluation method.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | qdio_debug.c | s | 8.0K | 275 | Linus Torvalds | torvalds@linux-foundation.org | 1320637487 |  | Merge branch 'modsplit-Oct31_2011' of git://git.kernel.org/pub/scm/linux/kernel/git/paulg/linux  * 'modsplit-Oct31_2011' of git://git.kernel.org/pub/scm/linux/kernel/git/paulg/linux: (230 commits)   Revert "tracing: Include module.h in define_trace.h"   irq: don't put module.h into irq.h for tracking irqgen modules.   bluetooth: macroize two small inlines to avoid module.h   ip_vs.h: fix implicit use of module_get/module_put from module.h   nf_conntrack.h: fix up fallout from implicit moduleparam.h presence   include: replace linux/module.h with "struct module" wherever possible   include: convert various register fcns to macros to avoid include chaining   crypto.h: remove unused crypto_tfm_alg_modname() inline   uwb.h: fix implicit use of asm/page.h for PAGE_SIZE   pm_runtime.h: explicitly requires notifier.h   linux/dmaengine.h: fix implicit use of bitmap.h and asm/page.h   miscdevice.h: fix up implicit use of lists and types   stop_machine.h: fix implicit use of smp.h for smp_processor_id   of: fix implicit use of errno.h in include/linux/of.h   of_platform.h: delete needless include <linux/module.h>   acpi: remove module.h include from platform/aclinux.h   miscdevice.h: delete unnecessary inclusion of module.h   device_cgroup.h: delete needless include <linux/module.h>   net: sch_generic remove redundant use of <linux/module.h>   net: inet_timewait_sock doesnt need <linux/module.h>   ...  Fix up trivial conflicts (other header files, and  removal of the ab3550 mfd driver) in  - drivers/media/dvb/frontends/dibx000_common.c  - drivers/media/video/{mt9m111.c,ov6650.c}  - drivers/mfd/ab3550-core.c  - include/linux/dmaengine.h
f | chsc.c | s | 24K | 946 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1322742738 |  | [S390] cio: fix chsc_chp_vary  The functions called by chsc_chp_vary operate on pointers to channel path ids not channel path links. (This worked by chance since the id is the first member of the link structure)  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | chsc.h | s | 2.5K | 102 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1294228048 |  | [S390] cio: obtain mdc value per channel path  Add support to accumulate the number of 64K-bytes blocks all paths to a device at least support for a transport command.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | qdio_debug.h | s | 2.1K | 68 | Jan Glauber | jang@linux.vnet.ibm.com | 1230208739 |  | [S390] qdio: rework debug feature logging  - make qdio_trace a per device view - remove s390dbf exceptions - remove CONFIG_QDIO_DEBUG, not needed anymore if we check for the level   before calling sprintf - use snprintf for dbf entries - add start markers to see if the dbf view wrapped - add a global error view for all queues  Signed-off-by: Jan Glauber <jang@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | io_sch.h | s | 5.8K | 193 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1322742738 |  | [S390] cio: provide fake irb for transport mode IO  If a driver wants to do command mode IO while CIO is doing online path verification we ignore this request and provide a fake irb when we are done and the driver can do IO again.  For transport mode IO we have no such mechanism, giving the driver no other chance then to retry the action until we are done. This is not very reliable.  Provide a fake irb for transport mode IO as well.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | css.c | s | 28K | 1103 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1322742737 |  | [S390] hibernate: directly trigger subchannel evaluation  Using the generic css_schedule_eval to evaluate subchannels while resuming from hibernation is very slow when used with many devices. Provide a new evaluation trigger which exploits css_sched_sch_todo and use this in the resume callback for ccw devices.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | ioasm.h | s | 3.0K | 144 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1300205303 |  | [S390] cio: move asms to generic header  The ssch and csch functions are not I/O subchannel specific, thus move them from io_sch.h to ioasm.h  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | device_status.c | s | 12K | 360 | Peter Oberparleiter | peter.oberparleiter@de.ibm.com | 1260186691 |  | [S390] cio: remove intretry flag  After changing all internal I/O functions to use the newly introduced ccw request infrastructure, retries are handled automatically after a clear operation. Therefore remove the internal retry flag and associated code.  Signed-off-by: Peter Oberparleiter <peter.oberparleiter@de.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | cio.c | s | 25K | 986 | Martin Schwidefsky | schwidefsky@de.ibm.com | 1337172158 |  | s390: remove superfluous tpi from wait_cons_dev  wait_cons_dev waits for a particular subchannel to complete an I/O. It is not necessary to use tpi to get the subchannel id as it is already known. This avoids changes to the interrupt subclass mask and allows to remove the lock & unlock of the subchannel lock.  Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | qdio_thinint.c | s | 7.5K | 273 | Jan Glauber | jang@linux.vnet.ibm.com | 1319984207 |  | [S390] qdio: prevent dsci access without adapter interrupts  A kernel panic may occur during sending or receiving network packets on a machine without adapter interrupts since commit d36deae. The bug is triggered by writing to the shared indicator address which is set to 0 if the machine doesn't have adapter interrupts.  Make the reading and setting of the shared indicator dependent on the adapter interrupt feature and while at it move the code to the file containing the adapter interrupt related code.  Thanks to Jan Jaeger for tracking this down.  Reported-by: Jan Jaeger <jan.jaeger@westnet.com.au> Tested-by: Jan Jaeger <jan.jaeger@westnet.com.au> Signed-off-by: Jan Glauber <jang@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | cio_debug.h | s | 849B | 27 | Michael Ernst | mernst@de.ibm.com | 1210144981 |  | [S390] cio: Remove cio_msg kernel parameter.  The only sporadically used CIO_DEBUG messages are replaced by ordinary CIO_MSG_EVENT messages. The CIO_MSG_EVENT messages debug levels are consolidated.  Signed-off-by: Michael Ernst <mernst@de.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | orb.h | s | 1.5K | 62 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1300205303 |  | [S390] cio: move orb definitions to separate header  Move the data definition for the orb union to a separate header file. Also apply the curent codingstyle.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | qdio_setup.c | s | 14K | 477 | Jan Glauber | jang@linux.vnet.ibm.com | 1332497604 |  | [S390] qdio: log all adapter characteristics  Log all adapter characteristics in the s390dbf to ease debugging of new features.  Signed-off-by: Jan Glauber <jang@linux.vnet.ibm.com> Reported-by: Raymond Higgs <rayhiggs@us.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | device_id.c | s | 5.7K | 205 | Peter Oberparleiter | peter.oberparleiter@de.ibm.com | 1260186693 |  | [S390] cio: improve error recovery for internal I/Os  Improve error recovery for internal I/Os by repeating each I/O 256 times per path to cope with long-running non-permanent error conditions. Also retry each path twice to cope with link flapping, i.e. single paths becoming unavailable in the order in which they are tried.  Signed-off-by: Peter Oberparleiter <peter.oberparleiter@de.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | airq.c | s | 3.5K | 134 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1238077454 |  | [S390] cio: airq - fix array boundary  MAX_ISC is a valid isc number, so arrays with an index of isc need to have a length of MAX_ISC+1  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
f | isc.c | s | 1.7K | 62 | Sebastian Ott | sebott@linux.vnet.ibm.com | 1216022531 |  | [S390] cio: introduce isc_(un)register functions.  This interface makes it easy for drivers to register usage of different I/O interruption subclasses without needing to worry about possible other users of the same isc.  Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com> Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com> Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
