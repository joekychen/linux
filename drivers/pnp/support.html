<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › pnp › support.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>support.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * support.c - standard functions for the use of pnp protocol drivers</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2003 Adam Belay &lt;ambx1@neo.rr.com&gt;</span>
<span class="cm"> * Copyright (C) 2008 Hewlett-Packard Development Company, L.P.</span>
<span class="cm"> *	Bjorn Helgaas &lt;bjorn.helgaas@hp.com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/ctype.h&gt;</span>
<span class="cp">#include &lt;linux/pnp.h&gt;</span>
<span class="cp">#include &quot;base.h&quot;</span>

<span class="cm">/**</span>
<span class="cm"> * pnp_is_active - Determines if a device is active based on its current</span>
<span class="cm"> *	resources</span>
<span class="cm"> * @dev: pointer to the desired PnP device</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">pnp_is_active</span><span class="p">(</span><span class="k">struct</span> <span class="n">pnp_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * I don&#39;t think this is very reliable because pnp_disable_dev()</span>
<span class="cm">	 * only clears out auto-assigned resources.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pnp_port_start</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">pnp_port_len</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span>
	    <span class="o">!</span><span class="n">pnp_mem_start</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">pnp_mem_len</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span>
	    <span class="n">pnp_irq</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">pnp_dma</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">pnp_is_active</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Functionally similar to acpi_ex_eisa_id_to_string(), but that&#39;s</span>
<span class="cm"> * buried in the ACPI CA, and we can&#39;t depend on it being present.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">pnp_eisa_id_to_string</span><span class="p">(</span><span class="n">u32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">id</span> <span class="o">=</span> <span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * According to the specs, the first three characters are five-bit</span>
<span class="cm">	 * compressed ASCII, and the left-over high order bit should be zero.</span>
<span class="cm">	 * However, the Linux ISAPNP code historically used six bits for the</span>
<span class="cm">	 * first character, and there seem to be IDs that depend on that,</span>
<span class="cm">	 * e.g., &quot;nEC8241&quot; in the Linux 8250_pnp serial driver and the</span>
<span class="cm">	 * FreeBSD sys/pc98/cbus/sio_cbus.c driver.</span>
<span class="cm">	 */</span>
	<span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="p">((</span><span class="n">id</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="p">((</span><span class="n">id</span> <span class="o">&gt;&gt;</span> <span class="mi">21</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="p">((</span><span class="n">id</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_asc_hi</span><span class="p">(</span><span class="n">id</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">str</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_asc_lo</span><span class="p">(</span><span class="n">id</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">str</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_asc_hi</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
	<span class="n">str</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_asc_lo</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
	<span class="n">str</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">char</span> <span class="o">*</span><span class="nf">pnp_resource_type_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">pnp_resource_type</span><span class="p">(</span><span class="n">res</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">IORESOURCE_IO</span>:
		<span class="k">return</span> <span class="s">&quot;io&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IORESOURCE_MEM</span>:
		<span class="k">return</span> <span class="s">&quot;mem&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IORESOURCE_IRQ</span>:
		<span class="k">return</span> <span class="s">&quot;irq&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IORESOURCE_DMA</span>:
		<span class="k">return</span> <span class="s">&quot;dma&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IORESOURCE_BUS</span>:
		<span class="k">return</span> <span class="s">&quot;bus&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="s">&quot;unknown&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">dbg_pnp_show_resources</span><span class="p">(</span><span class="k">struct</span> <span class="n">pnp_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">desc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">pnp_resource</span> <span class="o">*</span><span class="n">pnp_res</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">list_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">resources</span><span class="p">))</span>
		<span class="n">pnp_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;%s: no current resources</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">pnp_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;%s: current resources:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="p">);</span>
		<span class="n">list_for_each_entry</span><span class="p">(</span><span class="n">pnp_res</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">resources</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span>
			<span class="n">pnp_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;%pr</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pnp_res</span><span class="o">-&gt;</span><span class="n">res</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">char</span> <span class="o">*</span><span class="nf">pnp_option_priority_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">pnp_option</span> <span class="o">*</span><span class="n">option</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">pnp_option_priority</span><span class="p">(</span><span class="n">option</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">PNP_RES_PRIORITY_PREFERRED</span>:
		<span class="k">return</span> <span class="s">&quot;preferred&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">PNP_RES_PRIORITY_ACCEPTABLE</span>:
		<span class="k">return</span> <span class="s">&quot;acceptable&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">PNP_RES_PRIORITY_FUNCTIONAL</span>:
		<span class="k">return</span> <span class="s">&quot;functional&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="s">&quot;invalid&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">dbg_pnp_show_option</span><span class="p">(</span><span class="k">struct</span> <span class="n">pnp_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pnp_option</span> <span class="o">*</span><span class="n">option</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pnp_port</span> <span class="o">*</span><span class="n">port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pnp_mem</span> <span class="o">*</span><span class="n">mem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pnp_irq</span> <span class="o">*</span><span class="n">irq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pnp_dma</span> <span class="o">*</span><span class="n">dma</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pnp_option_is_dependent</span><span class="p">(</span><span class="n">option</span><span class="p">))</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
				 <span class="s">&quot;  dependent set %d (%s) &quot;</span><span class="p">,</span>
				 <span class="n">pnp_option_set</span><span class="p">(</span><span class="n">option</span><span class="p">),</span>
				 <span class="n">pnp_option_priority_name</span><span class="p">(</span><span class="n">option</span><span class="p">));</span>
	<span class="k">else</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
				 <span class="s">&quot;  independent &quot;</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">option</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">IORESOURCE_IO</span>:
		<span class="n">port</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">option</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">port</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;io  min %#llx &quot;</span>
				 <span class="s">&quot;max %#llx align %lld size %lld flags %#x&quot;</span><span class="p">,</span>
				 <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">min</span><span class="p">,</span>
				 <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">max</span><span class="p">,</span>
				 <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">align</span><span class="p">,</span>
				 <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">,</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IORESOURCE_MEM</span>:
		<span class="n">mem</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">option</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">mem</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;mem min %#llx &quot;</span>
				 <span class="s">&quot;max %#llx align %lld size %lld flags %#x&quot;</span><span class="p">,</span>
				 <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">min</span><span class="p">,</span>
				 <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">max</span><span class="p">,</span>
				 <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">align</span><span class="p">,</span>
				 <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">,</span> <span class="n">mem</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IORESOURCE_IRQ</span>:
		<span class="n">irq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">option</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">irq</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;irq&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bitmap_empty</span><span class="p">(</span><span class="n">irq</span><span class="o">-&gt;</span><span class="n">map</span><span class="p">.</span><span class="n">bits</span><span class="p">,</span> <span class="n">PNP_IRQ_NR</span><span class="p">))</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
					 <span class="s">&quot; &lt;none&gt;&quot;</span><span class="p">);</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PNP_IRQ_NR</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">test_bit</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">irq</span><span class="o">-&gt;</span><span class="n">map</span><span class="p">.</span><span class="n">bits</span><span class="p">))</span>
					<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span>
							 <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
							 <span class="s">&quot; %d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; flags %#x&quot;</span><span class="p">,</span>
				 <span class="n">irq</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">irq</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IORESOURCE_IRQ_OPTIONAL</span><span class="p">)</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
					 <span class="s">&quot; (optional)&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IORESOURCE_DMA</span>:
		<span class="n">dma</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">option</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">dma</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;dma&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dma</span><span class="o">-&gt;</span><span class="n">map</span><span class="p">)</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
					 <span class="s">&quot; &lt;none&gt;&quot;</span><span class="p">);</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dma</span><span class="o">-&gt;</span><span class="n">map</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span>
					<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span>
							 <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
							 <span class="s">&quot; %d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; (bitmask %#x) &quot;</span>
				 <span class="s">&quot;flags %#x&quot;</span><span class="p">,</span> <span class="n">dma</span><span class="o">-&gt;</span><span class="n">map</span><span class="p">,</span> <span class="n">dma</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">pnp_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
