<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › video › vermilion › vermilion.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>vermilion.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) Intel Corp. 2007.</span>
<span class="cm"> * All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Intel funded Tungsten Graphics (http://www.tungstengraphics.com) to</span>
<span class="cm"> * develop this driver.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is part of the Vermilion Range fb driver.</span>
<span class="cm"> * The Vermilion Range fb driver is free software;</span>
<span class="cm"> * you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * The Vermilion Range fb driver is distributed</span>
<span class="cm"> * in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this driver; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<span class="cm"> *</span>
<span class="cm"> * Authors:</span>
<span class="cm"> *   Thomas Hellström &lt;thomas-at-tungstengraphics-dot-com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _VERMILION_H_</span>
<span class="cp">#define _VERMILION_H_</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/atomic.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>

<span class="cp">#define VML_DEVICE_GPU 0x5002</span>
<span class="cp">#define VML_DEVICE_VDC 0x5009</span>

<span class="cp">#define VML_VRAM_AREAS 3</span>
<span class="cp">#define VML_MAX_XRES 1024</span>
<span class="cp">#define VML_MAX_YRES 768</span>
<span class="cp">#define VML_MAX_XRES_VIRTUAL 1040</span>

<span class="cm">/*</span>
<span class="cm"> * Display controller registers:</span>
<span class="cm"> */</span>

<span class="cm">/* Display controller 10-bit color representation */</span>

<span class="cp">#define VML_R_MASK                   0x3FF00000</span>
<span class="cp">#define VML_R_SHIFT                  20</span>
<span class="cp">#define VML_G_MASK                   0x000FFC00</span>
<span class="cp">#define VML_G_SHIFT                  10</span>
<span class="cp">#define VML_B_MASK                   0x000003FF</span>
<span class="cp">#define VML_B_SHIFT                  0</span>

<span class="cm">/* Graphics plane control */</span>
<span class="cp">#define VML_DSPCCNTR                 0x00072180</span>
<span class="cp">#define VML_GFX_ENABLE               0x80000000</span>
<span class="cp">#define VML_GFX_GAMMABYPASS          0x40000000</span>
<span class="cp">#define VML_GFX_ARGB1555             0x0C000000</span>
<span class="cp">#define VML_GFX_RGB0888              0x18000000</span>
<span class="cp">#define VML_GFX_ARGB8888             0x1C000000</span>
<span class="cp">#define VML_GFX_ALPHACONST           0x02000000</span>
<span class="cp">#define VML_GFX_ALPHAMULT            0x01000000</span>
<span class="cp">#define VML_GFX_CONST_ALPHA          0x000000FF</span>

<span class="cm">/* Graphics plane start address. Pixel aligned. */</span>
<span class="cp">#define VML_DSPCADDR                 0x00072184</span>

<span class="cm">/* Graphics plane stride register. */</span>
<span class="cp">#define VML_DSPCSTRIDE               0x00072188</span>

<span class="cm">/* Graphics plane position register. */</span>
<span class="cp">#define VML_DSPCPOS                  0x0007218C</span>
<span class="cp">#define VML_POS_YMASK                0x0FFF0000</span>
<span class="cp">#define VML_POS_YSHIFT               16</span>
<span class="cp">#define VML_POS_XMASK                0x00000FFF</span>
<span class="cp">#define VML_POS_XSHIFT               0</span>

<span class="cm">/* Graphics plane height and width */</span>
<span class="cp">#define VML_DSPCSIZE                 0x00072190</span>
<span class="cp">#define VML_SIZE_HMASK               0x0FFF0000</span>
<span class="cp">#define VML_SIZE_HSHIFT              16</span>
<span class="cp">#define VML_SISE_WMASK               0x00000FFF</span>
<span class="cp">#define VML_SIZE_WSHIFT              0</span>

<span class="cm">/* Graphics plane gamma correction lookup table registers (129 * 32 bits) */</span>
<span class="cp">#define VML_DSPCGAMLUT               0x00072200</span>

<span class="cm">/* Pixel video output configuration register */</span>
<span class="cp">#define VML_PVOCONFIG                0x00061140</span>
<span class="cp">#define VML_CONFIG_BASE              0x80000000</span>
<span class="cp">#define VML_CONFIG_PIXEL_SWAP        0x04000000</span>
<span class="cp">#define VML_CONFIG_DE_INV            0x01000000</span>
<span class="cp">#define VML_CONFIG_HREF_INV          0x00400000</span>
<span class="cp">#define VML_CONFIG_VREF_INV          0x00100000</span>
<span class="cp">#define VML_CONFIG_CLK_INV           0x00040000</span>
<span class="cp">#define VML_CONFIG_CLK_DIV2          0x00010000</span>
<span class="cp">#define VML_CONFIG_ESTRB_INV         0x00008000</span>

<span class="cm">/* Pipe A Horizontal total register */</span>
<span class="cp">#define VML_HTOTAL_A                 0x00060000</span>
<span class="cp">#define VML_HTOTAL_MASK              0x1FFF0000</span>
<span class="cp">#define VML_HTOTAL_SHIFT             16</span>
<span class="cp">#define VML_HTOTAL_VAL               8192</span>
<span class="cp">#define VML_HACTIVE_MASK             0x000007FF</span>
<span class="cp">#define VML_HACTIVE_SHIFT            0</span>
<span class="cp">#define VML_HACTIVE_VAL              4096</span>

<span class="cm">/* Pipe A Horizontal Blank register */</span>
<span class="cp">#define VML_HBLANK_A                 0x00060004</span>
<span class="cp">#define VML_HBLANK_END_MASK          0x1FFF0000</span>
<span class="cp">#define VML_HBLANK_END_SHIFT         16</span>
<span class="cp">#define VML_HBLANK_END_VAL           8192</span>
<span class="cp">#define VML_HBLANK_START_MASK        0x00001FFF</span>
<span class="cp">#define VML_HBLANK_START_SHIFT       0</span>
<span class="cp">#define VML_HBLANK_START_VAL         8192</span>

<span class="cm">/* Pipe A Horizontal Sync register */</span>
<span class="cp">#define VML_HSYNC_A                  0x00060008</span>
<span class="cp">#define VML_HSYNC_END_MASK           0x1FFF0000</span>
<span class="cp">#define VML_HSYNC_END_SHIFT          16</span>
<span class="cp">#define VML_HSYNC_END_VAL            8192</span>
<span class="cp">#define VML_HSYNC_START_MASK         0x00001FFF</span>
<span class="cp">#define VML_HSYNC_START_SHIFT        0</span>
<span class="cp">#define VML_HSYNC_START_VAL          8192</span>

<span class="cm">/* Pipe A Vertical total register */</span>
<span class="cp">#define VML_VTOTAL_A                 0x0006000C</span>
<span class="cp">#define VML_VTOTAL_MASK              0x1FFF0000</span>
<span class="cp">#define VML_VTOTAL_SHIFT             16</span>
<span class="cp">#define VML_VTOTAL_VAL               8192</span>
<span class="cp">#define VML_VACTIVE_MASK             0x000007FF</span>
<span class="cp">#define VML_VACTIVE_SHIFT            0</span>
<span class="cp">#define VML_VACTIVE_VAL              4096</span>

<span class="cm">/* Pipe A Vertical Blank register */</span>
<span class="cp">#define VML_VBLANK_A                 0x00060010</span>
<span class="cp">#define VML_VBLANK_END_MASK          0x1FFF0000</span>
<span class="cp">#define VML_VBLANK_END_SHIFT         16</span>
<span class="cp">#define VML_VBLANK_END_VAL           8192</span>
<span class="cp">#define VML_VBLANK_START_MASK        0x00001FFF</span>
<span class="cp">#define VML_VBLANK_START_SHIFT       0</span>
<span class="cp">#define VML_VBLANK_START_VAL         8192</span>

<span class="cm">/* Pipe A Vertical Sync register */</span>
<span class="cp">#define VML_VSYNC_A                  0x00060014</span>
<span class="cp">#define VML_VSYNC_END_MASK           0x1FFF0000</span>
<span class="cp">#define VML_VSYNC_END_SHIFT          16</span>
<span class="cp">#define VML_VSYNC_END_VAL            8192</span>
<span class="cp">#define VML_VSYNC_START_MASK         0x00001FFF</span>
<span class="cp">#define VML_VSYNC_START_SHIFT        0</span>
<span class="cp">#define VML_VSYNC_START_VAL          8192</span>

<span class="cm">/* Pipe A Source Image size (minus one - equal to active size)</span>
<span class="cm"> * Programmable while pipe is enabled.</span>
<span class="cm"> */</span>
<span class="cp">#define VML_PIPEASRC                 0x0006001C</span>
<span class="cp">#define VML_PIPEASRC_HMASK           0x0FFF0000</span>
<span class="cp">#define VML_PIPEASRC_HSHIFT          16</span>
<span class="cp">#define VML_PIPEASRC_VMASK           0x00000FFF</span>
<span class="cp">#define VML_PIPEASRC_VSHIFT          0</span>

<span class="cm">/* Pipe A Border Color Pattern register (10 bit color) */</span>
<span class="cp">#define VML_BCLRPAT_A                0x00060020</span>

<span class="cm">/* Pipe A Canvas Color register  (10 bit color) */</span>
<span class="cp">#define VML_CANVSCLR_A               0x00060024</span>

<span class="cm">/* Pipe A Configuration register */</span>
<span class="cp">#define VML_PIPEACONF                0x00070008</span>
<span class="cp">#define VML_PIPE_BASE                0x00000000</span>
<span class="cp">#define VML_PIPE_ENABLE              0x80000000</span>
<span class="cp">#define VML_PIPE_FORCE_BORDER        0x02000000</span>
<span class="cp">#define VML_PIPE_PLANES_OFF          0x00080000</span>
<span class="cp">#define VML_PIPE_ARGB_OUTPUT_MODE    0x00040000</span>

<span class="cm">/* Pipe A FIFO setting */</span>
<span class="cp">#define VML_DSPARB                   0x00070030</span>
<span class="cp">#define VML_FIFO_DEFAULT             0x00001D9C</span>

<span class="cm">/* MDVO rcomp status &amp; pads control register */</span>
<span class="cp">#define VML_RCOMPSTAT                0x00070048</span>
<span class="cp">#define VML_MDVO_VDC_I_RCOMP         0x80000000</span>
<span class="cp">#define VML_MDVO_POWERSAVE_OFF       0x00000008</span>
<span class="cp">#define VML_MDVO_PAD_ENABLE          0x00000004</span>
<span class="cp">#define VML_MDVO_PULLDOWN_ENABLE     0x00000001</span>

<span class="k">struct</span> <span class="n">vml_par</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">vdc</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">vdc_mem_base</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">vdc_mem_size</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">vdc_mem</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">gpu</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">gpu_mem_base</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">gpu_mem_size</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">gpu_mem</span><span class="p">;</span>

	<span class="n">atomic_t</span> <span class="n">refcount</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vram_area</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">logical</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">order</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vml_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fb_info</span> <span class="n">info</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vml_par</span> <span class="o">*</span><span class="n">par</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vram_area</span> <span class="n">vram</span><span class="p">[</span><span class="n">VML_VRAM_AREAS</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">vram_start</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">vram_contig_size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">num_areas</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">vram_logical</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pseudo_palette</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">stride</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bytes_per_pixel</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">vmas</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">cur_blank_mode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pipe_disabled</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Subsystem</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">vml_sys</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Save / Restore;</span>
<span class="cm">	 */</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">save</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">vml_sys</span> <span class="o">*</span> <span class="n">sys</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">restore</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">vml_sys</span> <span class="o">*</span> <span class="n">sys</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * PLL programming;</span>
<span class="cm">	 */</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">set_clock</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">vml_sys</span> <span class="o">*</span> <span class="n">sys</span><span class="p">,</span> <span class="kt">int</span> <span class="n">clock</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">nearest_clock</span><span class="p">)</span> <span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">vml_sys</span> <span class="o">*</span> <span class="n">sys</span><span class="p">,</span> <span class="kt">int</span> <span class="n">clock</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmlfb_register_subsys</span><span class="p">(</span><span class="k">struct</span> <span class="n">vml_sys</span> <span class="o">*</span><span class="n">sys</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmlfb_unregister_subsys</span><span class="p">(</span><span class="k">struct</span> <span class="n">vml_sys</span> <span class="o">*</span><span class="n">sys</span><span class="p">);</span>

<span class="cp">#define VML_READ32(_par, _offset) \</span>
<span class="cp">	(ioread32((_par)-&gt;vdc_mem + (_offset)))</span>
<span class="cp">#define VML_WRITE32(_par, _offset, _value)				\</span>
<span class="cp">	iowrite32(_value, (_par)-&gt;vdc_mem + (_offset))</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
