<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › video › nvidia › nv_local.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>nv_local.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/***************************************************************************\</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*       Copyright 1993-2003 NVIDIA, Corporation.  All rights reserved.      *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*     NOTICE TO USER:   The source code  is copyrighted under  U.S. and     *|</span>
<span class="cm">|*     international laws.  Users and possessors of this source code are     *|</span>
<span class="cm">|*     hereby granted a nonexclusive,  royalty-free copyright license to     *|</span>
<span class="cm">|*     use this code in individual and commercial software.                  *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*     Any use of this source code must include,  in the user documenta-     *|</span>
<span class="cm">|*     tion and  internal comments to the code,  notices to the end user     *|</span>
<span class="cm">|*     as follows:                                                           *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*       Copyright 1993-1999 NVIDIA, Corporation.  All rights reserved.      *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*     NVIDIA, CORPORATION MAKES NO REPRESENTATION ABOUT THE SUITABILITY     *|</span>
<span class="cm">|*     OF  THIS SOURCE  CODE  FOR ANY PURPOSE.  IT IS  PROVIDED  &quot;AS IS&quot;     *|</span>
<span class="cm">|*     WITHOUT EXPRESS OR IMPLIED WARRANTY OF ANY KIND.  NVIDIA, CORPOR-     *|</span>
<span class="cm">|*     ATION DISCLAIMS ALL WARRANTIES  WITH REGARD  TO THIS SOURCE CODE,     *|</span>
<span class="cm">|*     INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY, NONINFRINGE-     *|</span>
<span class="cm">|*     MENT,  AND FITNESS  FOR A PARTICULAR PURPOSE.   IN NO EVENT SHALL     *|</span>
<span class="cm">|*     NVIDIA, CORPORATION  BE LIABLE FOR ANY SPECIAL,  INDIRECT,  INCI-     *|</span>
<span class="cm">|*     DENTAL, OR CONSEQUENTIAL DAMAGES,  OR ANY DAMAGES  WHATSOEVER RE-     *|</span>
<span class="cm">|*     SULTING FROM LOSS OF USE,  DATA OR PROFITS,  WHETHER IN AN ACTION     *|</span>
<span class="cm">|*     OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION,  ARISING OUT OF     *|</span>
<span class="cm">|*     OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOURCE CODE.     *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*     U.S. Government  End  Users.   This source code  is a &quot;commercial     *|</span>
<span class="cm">|*     item,&quot;  as that  term is  defined at  48 C.F.R. 2.101 (OCT 1995),     *|</span>
<span class="cm">|*     consisting  of &quot;commercial  computer  software&quot;  and  &quot;commercial     *|</span>
<span class="cm">|*     computer  software  documentation,&quot;  as such  terms  are  used in     *|</span>
<span class="cm">|*     48 C.F.R. 12.212 (SEPT 1995)  and is provided to the U.S. Govern-     *|</span>
<span class="cm">|*     ment only as  a commercial end item.   Consistent with  48 C.F.R.     *|</span>
<span class="cm">|*     12.212 and  48 C.F.R. 227.7202-1 through  227.7202-4 (JUNE 1995),     *|</span>
<span class="cm">|*     all U.S. Government End Users  acquire the source code  with only     *|</span>
<span class="cm">|*     those rights set forth herein.                                        *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm"> \***************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> * GPL Licensing Note - According to Mark Vojkovich, author of the Xorg/</span>
<span class="cm"> * XFree86 &#39;nv&#39; driver, this source code is provided under MIT-style licensing</span>
<span class="cm"> * where the source code is provided &quot;as is&quot; without warranty of any kind.</span>
<span class="cm"> * The only usage restriction is for the copyright notices to be retained</span>
<span class="cm"> * whenever code is used.</span>
<span class="cm"> *</span>
<span class="cm"> * Antonino Daplas &lt;adaplas@pol.net&gt; 2005-03-11</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __NV_LOCAL_H__</span>
<span class="cp">#define __NV_LOCAL_H__</span>

<span class="cm">/*</span>
<span class="cm"> * This file includes any environment or machine specific values to access the</span>
<span class="cm"> * HW.  Put all affected includes, typdefs, etc. here so the riva_hw.* files</span>
<span class="cm"> * can stay generic in nature.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * HW access macros.  These assume memory-mapped I/O, and not normal I/O space.</span>
<span class="cm"> */</span>
<span class="cp">#define NV_WR08(p,i,d)  (__raw_writeb((d), (void __iomem *)(p) + (i)))</span>
<span class="cp">#define NV_RD08(p,i)    (__raw_readb((void __iomem *)(p) + (i)))</span>
<span class="cp">#define NV_WR16(p,i,d)  (__raw_writew((d), (void __iomem *)(p) + (i)))</span>
<span class="cp">#define NV_RD16(p,i)    (__raw_readw((void __iomem *)(p) + (i)))</span>
<span class="cp">#define NV_WR32(p,i,d)  (__raw_writel((d), (void __iomem *)(p) + (i)))</span>
<span class="cp">#define NV_RD32(p,i)    (__raw_readl((void __iomem *)(p) + (i)))</span>

<span class="cm">/* VGA I/O is now always done through MMIO */</span>
<span class="cp">#define VGA_WR08(p,i,d) (writeb((d), (void __iomem *)(p) + (i)))</span>
<span class="cp">#define VGA_RD08(p,i)   (readb((void __iomem *)(p) + (i)))</span>

<span class="cp">#define NVDmaNext(par, data) \</span>
<span class="cp">     NV_WR32(&amp;(par)-&gt;dmaBase[(par)-&gt;dmaCurrent++], 0, (data))</span>

<span class="cp">#define NVDmaStart(info, par, tag, size) {    \</span>
<span class="cp">     if((par)-&gt;dmaFree &lt;= (size))             \</span>
<span class="cp">        NVDmaWait(info, size);                \</span>
<span class="cp">     NVDmaNext(par, ((size) &lt;&lt; 18) | (tag));  \</span>
<span class="cp">     (par)-&gt;dmaFree -= ((size) + 1);          \</span>
<span class="cp">}</span>

<span class="cp">#if defined(__i386__)</span>
<span class="cp">#define _NV_FENCE() outb(0, 0x3D0);</span>
<span class="cp">#else</span>
<span class="cp">#define _NV_FENCE() mb();</span>
<span class="cp">#endif</span>

<span class="cp">#define WRITE_PUT(par, data) {                   \</span>
<span class="cp">  _NV_FENCE()                                    \</span>
<span class="cp">  NV_RD08((par)-&gt;FbStart, 0);                    \</span>
<span class="cp">  NV_WR32(&amp;(par)-&gt;FIFO[0x0010], 0, (data) &lt;&lt; 2); \</span>
<span class="cp">  mb();                                          \</span>
<span class="cp">}</span>

<span class="cp">#define READ_GET(par) (NV_RD32(&amp;(par)-&gt;FIFO[0x0011], 0) &gt;&gt; 2)</span>

<span class="cp">#ifdef __LITTLE_ENDIAN</span>

<span class="cp">#include &lt;linux/bitrev.h&gt;</span>

<span class="cp">#define reverse_order(l)        \</span>
<span class="cp">do {                            \</span>
<span class="cp">	u8 *a = (u8 *)(l);      \</span>
<span class="cp">	a[0] = bitrev8(a[0]);   \</span>
<span class="cp">	a[1] = bitrev8(a[1]);   \</span>
<span class="cp">	a[2] = bitrev8(a[2]);   \</span>
<span class="cp">	a[3] = bitrev8(a[3]);   \</span>
<span class="cp">} while(0)</span>
<span class="cp">#else</span>
<span class="cp">#define reverse_order(l) do { } while(0)</span>
<span class="cp">#endif                          </span><span class="cm">/* __LITTLE_ENDIAN */</span><span class="cp"></span>

<span class="cp">#endif				</span><span class="cm">/* __NV_LOCAL_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
