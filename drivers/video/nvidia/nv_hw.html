<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › video › nvidia › nv_hw.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>nv_hw.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre> <span class="cm">/***************************************************************************\</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*       Copyright 1993-2003 NVIDIA, Corporation.  All rights reserved.      *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*     NOTICE TO USER:   The source code  is copyrighted under  U.S. and     *|</span>
<span class="cm">|*     international laws.  Users and possessors of this source code are     *|</span>
<span class="cm">|*     hereby granted a nonexclusive,  royalty-free copyright license to     *|</span>
<span class="cm">|*     use this code in individual and commercial software.                  *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*     Any use of this source code must include,  in the user documenta-     *|</span>
<span class="cm">|*     tion and  internal comments to the code,  notices to the end user     *|</span>
<span class="cm">|*     as follows:                                                           *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*       Copyright 1993-2003 NVIDIA, Corporation.  All rights reserved.      *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*     NVIDIA, CORPORATION MAKES NO REPRESENTATION ABOUT THE SUITABILITY     *|</span>
<span class="cm">|*     OF  THIS SOURCE  CODE  FOR ANY PURPOSE.  IT IS  PROVIDED  &quot;AS IS&quot;     *|</span>
<span class="cm">|*     WITHOUT EXPRESS OR IMPLIED WARRANTY OF ANY KIND.  NVIDIA, CORPOR-     *|</span>
<span class="cm">|*     ATION DISCLAIMS ALL WARRANTIES  WITH REGARD  TO THIS SOURCE CODE,     *|</span>
<span class="cm">|*     INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY, NONINFRINGE-     *|</span>
<span class="cm">|*     MENT,  AND FITNESS  FOR A PARTICULAR PURPOSE.   IN NO EVENT SHALL     *|</span>
<span class="cm">|*     NVIDIA, CORPORATION  BE LIABLE FOR ANY SPECIAL,  INDIRECT,  INCI-     *|</span>
<span class="cm">|*     DENTAL, OR CONSEQUENTIAL DAMAGES,  OR ANY DAMAGES  WHATSOEVER RE-     *|</span>
<span class="cm">|*     SULTING FROM LOSS OF USE,  DATA OR PROFITS,  WHETHER IN AN ACTION     *|</span>
<span class="cm">|*     OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION,  ARISING OUT OF     *|</span>
<span class="cm">|*     OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOURCE CODE.     *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm">|*     U.S. Government  End  Users.   This source code  is a &quot;commercial     *|</span>
<span class="cm">|*     item,&quot;  as that  term is  defined at  48 C.F.R. 2.101 (OCT 1995),     *|</span>
<span class="cm">|*     consisting  of &quot;commercial  computer  software&quot;  and  &quot;commercial     *|</span>
<span class="cm">|*     computer  software  documentation,&quot;  as such  terms  are  used in     *|</span>
<span class="cm">|*     48 C.F.R. 12.212 (SEPT 1995)  and is provided to the U.S. Govern-     *|</span>
<span class="cm">|*     ment only as  a commercial end item.   Consistent with  48 C.F.R.     *|</span>
<span class="cm">|*     12.212 and  48 C.F.R. 227.7202-1 through  227.7202-4 (JUNE 1995),     *|</span>
<span class="cm">|*     all U.S. Government End Users  acquire the source code  with only     *|</span>
<span class="cm">|*     those rights set forth herein.                                        *|</span>
<span class="cm">|*                                                                           *|</span>
<span class="cm"> \***************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> * GPL Licensing Note - According to Mark Vojkovich, author of the Xorg/</span>
<span class="cm"> * XFree86 &#39;nv&#39; driver, this source code is provided under MIT-style licensing</span>
<span class="cm"> * where the source code is provided &quot;as is&quot; without warranty of any kind.</span>
<span class="cm"> * The only usage restriction is for the copyright notices to be retained</span>
<span class="cm"> * whenever code is used.</span>
<span class="cm"> *</span>
<span class="cm"> * Antonino Daplas &lt;adaplas@pol.net&gt; 2005-03-11</span>
<span class="cm"> */</span>

<span class="cm">/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/nv/nv_hw.c,v 1.4 2003/11/03 05:11:25 tsi Exp $ */</span>

<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &quot;nv_type.h&quot;</span>
<span class="cp">#include &quot;nv_local.h&quot;</span>
<span class="cp">#include &quot;nv_proto.h&quot;</span>

<span class="kt">void</span> <span class="nf">NVLockUnlock</span><span class="p">(</span><span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Lock</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">cr11</span><span class="p">;</span>

	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x3D4</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x3D5</span><span class="p">,</span> <span class="n">Lock</span> <span class="o">?</span> <span class="mh">0x99</span> <span class="o">:</span> <span class="mh">0x57</span><span class="p">);</span>

	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x3D4</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>
	<span class="n">cr11</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x3D5</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">Lock</span><span class="p">)</span>
		<span class="n">cr11</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">cr11</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x80</span><span class="p">;</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x3D5</span><span class="p">,</span> <span class="n">cr11</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">NVShowHideCursor</span><span class="p">(</span><span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ShowHide</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">cur</span> <span class="o">=</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CurrentState</span><span class="o">-&gt;</span><span class="n">cursor1</span><span class="p">;</span>

	<span class="n">par</span><span class="o">-&gt;</span><span class="n">CurrentState</span><span class="o">-&gt;</span><span class="n">cursor1</span> <span class="o">=</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">CurrentState</span><span class="o">-&gt;</span><span class="n">cursor1</span> <span class="o">&amp;</span> <span class="mh">0xFE</span><span class="p">)</span> <span class="o">|</span>
	    <span class="p">(</span><span class="n">ShowHide</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x3D4</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x3D5</span><span class="p">,</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CurrentState</span><span class="o">-&gt;</span><span class="n">cursor1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">==</span> <span class="n">NV_ARCH_40</span><span class="p">)</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0300</span><span class="p">,</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0300</span><span class="p">));</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">cur</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************\</span>
<span class="cm">*                                                                            *</span>
<span class="cm">* The video arbitration routines calculate some &quot;magic&quot; numbers.  Fixes      *</span>
<span class="cm">* the snow seen when accessing the framebuffer without it.                   *</span>
<span class="cm">* It just works (I hope).                                                    *</span>
<span class="cm">*                                                                            *</span>
<span class="cm">\****************************************************************************/</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">graphics_lwm</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">video_lwm</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">graphics_burst_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">video_burst_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">valid</span><span class="p">;</span>
<span class="p">}</span> <span class="n">nv4_fifo_info</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">pclk_khz</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mclk_khz</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nvclk_khz</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">mem_page_miss</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">mem_latency</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">memory_width</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">enable_video</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">gr_during_vid</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">pix_bpp</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">mem_aligned</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">enable_mp</span><span class="p">;</span>
<span class="p">}</span> <span class="n">nv4_sim_state</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">graphics_lwm</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">video_lwm</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">graphics_burst_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">video_burst_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">valid</span><span class="p">;</span>
<span class="p">}</span> <span class="n">nv10_fifo_info</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">pclk_khz</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mclk_khz</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nvclk_khz</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">mem_page_miss</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">mem_latency</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">memory_type</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">memory_width</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">enable_video</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">gr_during_vid</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">pix_bpp</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">mem_aligned</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">enable_mp</span><span class="p">;</span>
<span class="p">}</span> <span class="n">nv10_sim_state</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">nvGetClocks</span><span class="p">(</span><span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">MClk</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">NVClk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pll</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">MB</span><span class="p">,</span> <span class="n">NB</span><span class="p">,</span> <span class="n">P</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_40</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x4020</span><span class="p">);</span>
		<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">;</span>
		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x4024</span><span class="p">);</span>
		<span class="n">M</span> <span class="o">=</span> <span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0290</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0390</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">MB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">NB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">MB</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
			<span class="n">NB</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="o">*</span><span class="n">MClk</span> <span class="o">=</span> <span class="p">((</span><span class="n">N</span> <span class="o">*</span> <span class="n">NB</span> <span class="o">*</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">MB</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">P</span><span class="p">;</span>

		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">);</span>
		<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">;</span>
		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x4004</span><span class="p">);</span>
		<span class="n">M</span> <span class="o">=</span> <span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">MB</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">NB</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>

		<span class="o">*</span><span class="n">NVClk</span> <span class="o">=</span> <span class="p">((</span><span class="n">N</span> <span class="o">*</span> <span class="n">NB</span> <span class="o">*</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">MB</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">P</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">twoStagePLL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0504</span><span class="p">);</span>
		<span class="n">M</span> <span class="o">=</span> <span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0574</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">MB</span> <span class="o">=</span> <span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
			<span class="n">NB</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">MB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">NB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="o">*</span><span class="n">MClk</span> <span class="o">=</span> <span class="p">((</span><span class="n">N</span> <span class="o">*</span> <span class="n">NB</span> <span class="o">*</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">MB</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">P</span><span class="p">;</span>

		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0500</span><span class="p">);</span>
		<span class="n">M</span> <span class="o">=</span> <span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0570</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">MB</span> <span class="o">=</span> <span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
			<span class="n">NB</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">MB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">NB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="o">*</span><span class="n">NVClk</span> <span class="o">=</span> <span class="p">((</span><span class="n">N</span> <span class="o">*</span> <span class="n">NB</span> <span class="o">*</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">MB</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">P</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
	    <span class="k">if</span> <span class="p">(((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0x0ff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0300</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0x0ff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0330</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0504</span><span class="p">);</span>
		<span class="n">M</span> <span class="o">=</span> <span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
		<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0x00000080</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">MB</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">;</span>
			<span class="n">NB</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">MB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">NB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="o">*</span><span class="n">MClk</span> <span class="o">=</span> <span class="p">((</span><span class="n">N</span> <span class="o">*</span> <span class="n">NB</span> <span class="o">*</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">MB</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">P</span><span class="p">;</span>

		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0500</span><span class="p">);</span>
		<span class="n">M</span> <span class="o">=</span> <span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
		<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0x00000080</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">MB</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">;</span>
			<span class="n">NB</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">MB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">NB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="o">*</span><span class="n">NVClk</span> <span class="o">=</span> <span class="p">((</span><span class="n">N</span> <span class="o">*</span> <span class="n">NB</span> <span class="o">*</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">MB</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">P</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0504</span><span class="p">);</span>
		<span class="n">M</span> <span class="o">=</span> <span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
		<span class="o">*</span><span class="n">MClk</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span> <span class="o">/</span> <span class="n">M</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">P</span><span class="p">;</span>

		<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0500</span><span class="p">);</span>
		<span class="n">M</span> <span class="o">=</span> <span class="n">pll</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
		<span class="o">*</span><span class="n">NVClk</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span> <span class="o">/</span> <span class="n">M</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">P</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">nv4CalcArbitration</span><span class="p">(</span><span class="n">nv4_fifo_info</span> <span class="o">*</span> <span class="n">fifo</span><span class="p">,</span> <span class="n">nv4_sim_state</span> <span class="o">*</span> <span class="n">arb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">data</span><span class="p">,</span> <span class="n">pagemiss</span><span class="p">,</span> <span class="n">cas</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">video_enable</span><span class="p">,</span> <span class="n">bpp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nvclks</span><span class="p">,</span> <span class="n">mclks</span><span class="p">,</span> <span class="n">pclks</span><span class="p">,</span> <span class="n">vpagemiss</span><span class="p">,</span> <span class="n">crtpagemiss</span><span class="p">,</span> <span class="n">vbs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">found</span><span class="p">,</span> <span class="n">mclk_extra</span><span class="p">,</span> <span class="n">mclk_loop</span><span class="p">,</span> <span class="n">cbs</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">p1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mclk_freq</span><span class="p">,</span> <span class="n">pclk_freq</span><span class="p">,</span> <span class="n">nvclk_freq</span><span class="p">,</span> <span class="n">mp_enable</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">us_m</span><span class="p">,</span> <span class="n">us_n</span><span class="p">,</span> <span class="n">us_p</span><span class="p">,</span> <span class="n">video_drain_rate</span><span class="p">,</span> <span class="n">crtc_drain_rate</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">vpm_us</span><span class="p">,</span> <span class="n">us_video</span><span class="p">,</span> <span class="n">vlwm</span><span class="p">,</span> <span class="n">video_fill_us</span><span class="p">,</span> <span class="n">cpm_us</span><span class="p">,</span> <span class="n">us_crt</span><span class="p">,</span> <span class="n">clwm</span><span class="p">;</span>

	<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pclk_freq</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">pclk_khz</span><span class="p">;</span>
	<span class="n">mclk_freq</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">mclk_khz</span><span class="p">;</span>
	<span class="n">nvclk_freq</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">nvclk_khz</span><span class="p">;</span>
	<span class="n">pagemiss</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">mem_page_miss</span><span class="p">;</span>
	<span class="n">cas</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">mem_latency</span><span class="p">;</span>
	<span class="n">width</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">memory_width</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">video_enable</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">enable_video</span><span class="p">;</span>
	<span class="n">bpp</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">pix_bpp</span><span class="p">;</span>
	<span class="n">mp_enable</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">enable_mp</span><span class="p">;</span>
	<span class="n">clwm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">vlwm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">cbs</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
	<span class="n">pclks</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">nvclks</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">mclks</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">mclks</span> <span class="o">+=</span> <span class="n">cas</span><span class="p">;</span>
	<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">mclk_extra</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mp_enable</span><span class="p">)</span>
		<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pclks</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">vbs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">found</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">mclk_loop</span> <span class="o">=</span> <span class="n">mclks</span> <span class="o">+</span> <span class="n">mclk_extra</span><span class="p">;</span>
		<span class="n">us_m</span> <span class="o">=</span> <span class="n">mclk_loop</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>
		<span class="n">us_n</span> <span class="o">=</span> <span class="n">nvclks</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">nvclk_freq</span><span class="p">;</span>
		<span class="n">us_p</span> <span class="o">=</span> <span class="n">nvclks</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">pclk_freq</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">video_enable</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">video_drain_rate</span> <span class="o">=</span> <span class="n">pclk_freq</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">crtc_drain_rate</span> <span class="o">=</span> <span class="n">pclk_freq</span> <span class="o">*</span> <span class="n">bpp</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>
			<span class="n">vpagemiss</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">vpagemiss</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">crtpagemiss</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">vpm_us</span> <span class="o">=</span>
			    <span class="p">(</span><span class="n">vpagemiss</span> <span class="o">*</span> <span class="n">pagemiss</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">nvclk_freq</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="n">mclk_freq</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
				<span class="n">video_fill_us</span> <span class="o">=</span>
				    <span class="n">cbs</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">16</span> <span class="o">/</span> <span class="n">nvclk_freq</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">video_fill_us</span> <span class="o">=</span>
				    <span class="n">cbs</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span> <span class="o">/</span>
				    <span class="n">mclk_freq</span><span class="p">;</span>
			<span class="n">us_video</span> <span class="o">=</span> <span class="n">vpm_us</span> <span class="o">+</span> <span class="n">us_m</span> <span class="o">+</span> <span class="n">us_n</span> <span class="o">+</span> <span class="n">us_p</span> <span class="o">+</span> <span class="n">video_fill_us</span><span class="p">;</span>
			<span class="n">vlwm</span> <span class="o">=</span> <span class="n">us_video</span> <span class="o">*</span> <span class="n">video_drain_rate</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
			<span class="n">vlwm</span><span class="o">++</span><span class="p">;</span>
			<span class="n">vbs</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">vlwm</span> <span class="o">&gt;</span> <span class="mi">128</span><span class="p">)</span>
				<span class="n">vbs</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">vlwm</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">256</span> <span class="o">-</span> <span class="mi">64</span><span class="p">))</span>
				<span class="n">vbs</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">nvclk_freq</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="n">mclk_freq</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
				<span class="n">video_fill_us</span> <span class="o">=</span>
				    <span class="n">vbs</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mi">16</span> <span class="o">/</span> <span class="n">nvclk_freq</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">video_fill_us</span> <span class="o">=</span>
				    <span class="n">vbs</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span> <span class="o">/</span>
				    <span class="n">mclk_freq</span><span class="p">;</span>
			<span class="n">cpm_us</span> <span class="o">=</span>
			    <span class="n">crtpagemiss</span> <span class="o">*</span> <span class="n">pagemiss</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>
			<span class="n">us_crt</span> <span class="o">=</span>
			    <span class="n">us_video</span> <span class="o">+</span> <span class="n">video_fill_us</span> <span class="o">+</span> <span class="n">cpm_us</span> <span class="o">+</span> <span class="n">us_m</span> <span class="o">+</span> <span class="n">us_n</span> <span class="o">+</span>
			    <span class="n">us_p</span><span class="p">;</span>
			<span class="n">clwm</span> <span class="o">=</span> <span class="n">us_crt</span> <span class="o">*</span> <span class="n">crtc_drain_rate</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
			<span class="n">clwm</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">crtc_drain_rate</span> <span class="o">=</span> <span class="n">pclk_freq</span> <span class="o">*</span> <span class="n">bpp</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>
			<span class="n">crtpagemiss</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">crtpagemiss</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">cpm_us</span> <span class="o">=</span>
			    <span class="n">crtpagemiss</span> <span class="o">*</span> <span class="n">pagemiss</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>
			<span class="n">us_crt</span> <span class="o">=</span> <span class="n">cpm_us</span> <span class="o">+</span> <span class="n">us_m</span> <span class="o">+</span> <span class="n">us_n</span> <span class="o">+</span> <span class="n">us_p</span><span class="p">;</span>
			<span class="n">clwm</span> <span class="o">=</span> <span class="n">us_crt</span> <span class="o">*</span> <span class="n">crtc_drain_rate</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
			<span class="n">clwm</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">m1</span> <span class="o">=</span> <span class="n">clwm</span> <span class="o">+</span> <span class="n">cbs</span> <span class="o">-</span> <span class="mi">512</span><span class="p">;</span>
		<span class="n">p1</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">*</span> <span class="n">pclk_freq</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>
		<span class="n">p1</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">*</span> <span class="n">bpp</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">p1</span> <span class="o">&lt;</span> <span class="n">m1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">m1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">mclk_extra</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">mclk_extra</span><span class="o">--</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">video_enable</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">clwm</span> <span class="o">&gt;</span> <span class="mi">511</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">vlwm</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">mclk_extra</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
					<span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">mclk_extra</span><span class="o">--</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">clwm</span> <span class="o">&gt;</span> <span class="mi">519</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">mclk_extra</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
					<span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">mclk_extra</span><span class="o">--</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clwm</span> <span class="o">&lt;</span> <span class="mi">384</span><span class="p">)</span>
			<span class="n">clwm</span> <span class="o">=</span> <span class="mi">384</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vlwm</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">)</span>
			<span class="n">vlwm</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
		<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">clwm</span><span class="p">);</span>
		<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">graphics_lwm</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
		<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">graphics_burst_size</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
		<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="n">vlwm</span> <span class="o">+</span> <span class="mi">15</span><span class="p">));</span>
		<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">video_lwm</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
		<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">video_burst_size</span> <span class="o">=</span> <span class="n">vbs</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">nv4UpdateArbitrationSettings</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">VClk</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="n">pixelDepth</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="o">*</span><span class="n">burst</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="o">*</span><span class="n">lwm</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">nv4_fifo_info</span> <span class="n">fifo_data</span><span class="p">;</span>
	<span class="n">nv4_sim_state</span> <span class="n">sim_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">MClk</span><span class="p">,</span> <span class="n">NVClk</span><span class="p">,</span> <span class="n">cfg1</span><span class="p">;</span>

	<span class="n">nvGetClocks</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MClk</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">NVClk</span><span class="p">);</span>

	<span class="n">cfg1</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x00000204</span><span class="p">);</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">pix_bpp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">pixelDepth</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">enable_video</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">enable_mp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">memory_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PEXTDEV</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">?</span>
	    <span class="mi">128</span> <span class="o">:</span> <span class="mi">64</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">mem_latency</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">cfg1</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">mem_aligned</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">mem_page_miss</span> <span class="o">=</span>
	    <span class="p">(</span><span class="kt">char</span><span class="p">)(((</span><span class="n">cfg1</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">cfg1</span> <span class="o">&gt;&gt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">));</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">gr_during_vid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">pclk_khz</span> <span class="o">=</span> <span class="n">VClk</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">mclk_khz</span> <span class="o">=</span> <span class="n">MClk</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">nvclk_khz</span> <span class="o">=</span> <span class="n">NVClk</span><span class="p">;</span>
	<span class="n">nv4CalcArbitration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fifo_data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sim_data</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fifo_data</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">fifo_data</span><span class="p">.</span><span class="n">graphics_burst_size</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
		<span class="o">*</span><span class="n">burst</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="p">(</span><span class="o">*</span><span class="n">burst</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
		<span class="o">*</span><span class="n">lwm</span> <span class="o">=</span> <span class="n">fifo_data</span><span class="p">.</span><span class="n">graphics_lwm</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">nv10CalcArbitration</span><span class="p">(</span><span class="n">nv10_fifo_info</span> <span class="o">*</span> <span class="n">fifo</span><span class="p">,</span> <span class="n">nv10_sim_state</span> <span class="o">*</span> <span class="n">arb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">data</span><span class="p">,</span> <span class="n">pagemiss</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">video_enable</span><span class="p">,</span> <span class="n">bpp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nvclks</span><span class="p">,</span> <span class="n">mclks</span><span class="p">,</span> <span class="n">pclks</span><span class="p">,</span> <span class="n">vpagemiss</span><span class="p">,</span> <span class="n">crtpagemiss</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nvclk_fill</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">found</span><span class="p">,</span> <span class="n">mclk_extra</span><span class="p">,</span> <span class="n">mclk_loop</span><span class="p">,</span> <span class="n">cbs</span><span class="p">,</span> <span class="n">m1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mclk_freq</span><span class="p">,</span> <span class="n">pclk_freq</span><span class="p">,</span> <span class="n">nvclk_freq</span><span class="p">,</span> <span class="n">mp_enable</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">us_m</span><span class="p">,</span> <span class="n">us_m_min</span><span class="p">,</span> <span class="n">us_n</span><span class="p">,</span> <span class="n">us_p</span><span class="p">,</span> <span class="n">crtc_drain_rate</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">vus_m</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">vpm_us</span><span class="p">,</span> <span class="n">us_video</span><span class="p">,</span> <span class="n">cpm_us</span><span class="p">,</span> <span class="n">us_crt</span><span class="p">,</span> <span class="n">clwm</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">clwm_rnd_down</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">m2us</span><span class="p">,</span> <span class="n">us_pipe_min</span><span class="p">,</span> <span class="n">p1clk</span><span class="p">,</span> <span class="n">p2</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">min_mclk_extra</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">us_min_mclk_extra</span><span class="p">;</span>

	<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pclk_freq</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">pclk_khz</span><span class="p">;</span>	<span class="cm">/* freq in KHz */</span>
	<span class="n">mclk_freq</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">mclk_khz</span><span class="p">;</span>
	<span class="n">nvclk_freq</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">nvclk_khz</span><span class="p">;</span>
	<span class="n">pagemiss</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">mem_page_miss</span><span class="p">;</span>
	<span class="n">width</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">memory_width</span> <span class="o">/</span> <span class="mi">64</span><span class="p">;</span>
	<span class="n">video_enable</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">enable_video</span><span class="p">;</span>
	<span class="n">bpp</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">pix_bpp</span><span class="p">;</span>
	<span class="n">mp_enable</span> <span class="o">=</span> <span class="n">arb</span><span class="o">-&gt;</span><span class="n">enable_mp</span><span class="p">;</span>
	<span class="n">clwm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">cbs</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>

	<span class="n">pclks</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>	<span class="cm">/* lwm detect. */</span>

	<span class="n">nvclks</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>	<span class="cm">/* lwm -&gt; sync. */</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/* fbi bus cycles (1 req + 1 busy) */</span>
	<span class="cm">/* 2 edge sync.  may be very close to edge so just put one. */</span>
	<span class="n">mclks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* arb_hp_req */</span>
	<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">;</span>	<span class="cm">/* ap_hp_req   tiling pipeline */</span>

	<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/* tc_req     latency fifo */</span>
	<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/* fb_cas_n_  memory request to fbio block */</span>
	<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">;</span>	<span class="cm">/* sm_d_rdv   data returned from fbio block */</span>

	<span class="cm">/* fb.rd.d.Put_gc   need to accumulate 256 bits for read */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">arb</span><span class="o">-&gt;</span><span class="n">memory_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">arb</span><span class="o">-&gt;</span><span class="n">memory_width</span> <span class="o">==</span> <span class="mi">64</span><span class="p">)</span>	<span class="cm">/* 64 bit bus */</span>
			<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">arb</span><span class="o">-&gt;</span><span class="n">memory_width</span> <span class="o">==</span> <span class="mi">64</span><span class="p">)</span>	<span class="cm">/* 64 bit bus */</span>
		<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="n">video_enable</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">arb</span><span class="o">-&gt;</span><span class="n">memory_width</span> <span class="o">==</span> <span class="mi">128</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">mclk_extra</span> <span class="o">=</span> <span class="p">(</span><span class="n">bpp</span> <span class="o">==</span> <span class="mi">32</span><span class="p">)</span> <span class="o">?</span> <span class="mi">31</span> <span class="o">:</span> <span class="mi">42</span><span class="p">;</span>	<span class="cm">/* Margin of error */</span>
		<span class="n">min_mclk_extra</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">mclk_extra</span> <span class="o">=</span> <span class="p">(</span><span class="n">bpp</span> <span class="o">==</span> <span class="mi">32</span><span class="p">)</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>	<span class="cm">/* Margin of error */</span>
		<span class="cm">/* mclk_extra = 4; *//* Margin of error */</span>
		<span class="n">min_mclk_extra</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* 2 edge sync.  may be very close to edge so just put one. */</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>		<span class="cm">/* fbi_d_rdv_n */</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Fbi_d_rdata */</span>
	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>		<span class="cm">/* crtfifo load */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mp_enable</span><span class="p">)</span>
		<span class="n">mclks</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>	<span class="cm">/* Mp can get in with a burst of 8. */</span>
	<span class="cm">/* Extra clocks determined by heuristics */</span>

	<span class="n">nvclks</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pclks</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">found</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">mclk_loop</span> <span class="o">=</span> <span class="n">mclks</span> <span class="o">+</span> <span class="n">mclk_extra</span><span class="p">;</span>
		<span class="cm">/* Mclk latency in us */</span>
		<span class="n">us_m</span> <span class="o">=</span> <span class="n">mclk_loop</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>
		<span class="cm">/* Minimum Mclk latency in us */</span>
		<span class="n">us_m_min</span> <span class="o">=</span> <span class="n">mclks</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>
		<span class="n">us_min_mclk_extra</span> <span class="o">=</span> <span class="n">min_mclk_extra</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>
		<span class="cm">/* nvclk latency in us */</span>
		<span class="n">us_n</span> <span class="o">=</span> <span class="n">nvclks</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">nvclk_freq</span><span class="p">;</span>
		<span class="cm">/* nvclk latency in us */</span>
		<span class="n">us_p</span> <span class="o">=</span> <span class="n">pclks</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">pclk_freq</span><span class="p">;</span>
		<span class="n">us_pipe_min</span> <span class="o">=</span> <span class="n">us_m_min</span> <span class="o">+</span> <span class="n">us_n</span> <span class="o">+</span> <span class="n">us_p</span><span class="p">;</span>

		<span class="cm">/* Mclk latency in us */</span>
		<span class="n">vus_m</span> <span class="o">=</span> <span class="n">mclk_loop</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">video_enable</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">crtc_drain_rate</span> <span class="o">=</span> <span class="n">pclk_freq</span> <span class="o">*</span> <span class="n">bpp</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>	<span class="cm">/* MB/s */</span>

			<span class="n">vpagemiss</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* self generating page miss */</span>
			<span class="n">vpagemiss</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* One higher priority before */</span>

			<span class="n">crtpagemiss</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/* self generating page miss */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">mp_enable</span><span class="p">)</span>
				<span class="n">crtpagemiss</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* if MA0 conflict */</span>

			<span class="n">vpm_us</span> <span class="o">=</span>
			    <span class="p">(</span><span class="n">vpagemiss</span> <span class="o">*</span> <span class="n">pagemiss</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>

			<span class="cm">/* Video has separate read return path */</span>
			<span class="n">us_video</span> <span class="o">=</span> <span class="n">vpm_us</span> <span class="o">+</span> <span class="n">vus_m</span><span class="p">;</span>

			<span class="n">cpm_us</span> <span class="o">=</span>
			    <span class="n">crtpagemiss</span> <span class="o">*</span> <span class="n">pagemiss</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>
			<span class="cm">/* Wait for video */</span>
			<span class="n">us_crt</span> <span class="o">=</span> <span class="n">us_video</span>
			    <span class="o">+</span> <span class="n">cpm_us</span>	<span class="cm">/* CRT Page miss */</span>
			    <span class="o">+</span> <span class="n">us_m</span> <span class="o">+</span> <span class="n">us_n</span> <span class="o">+</span> <span class="n">us_p</span>	<span class="cm">/* other latency */</span>
			    <span class="p">;</span>

			<span class="n">clwm</span> <span class="o">=</span> <span class="n">us_crt</span> <span class="o">*</span> <span class="n">crtc_drain_rate</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
			<span class="cm">/* fixed point &lt;= float_point - 1.  Fixes that */</span>
			<span class="n">clwm</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="cm">/* bpp * pclk/8 */</span>
			<span class="n">crtc_drain_rate</span> <span class="o">=</span> <span class="n">pclk_freq</span> <span class="o">*</span> <span class="n">bpp</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>

			<span class="n">crtpagemiss</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* self generating page miss */</span>
			<span class="n">crtpagemiss</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* MA0 page miss */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">mp_enable</span><span class="p">)</span>
				<span class="n">crtpagemiss</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* if MA0 conflict */</span>
			<span class="n">cpm_us</span> <span class="o">=</span>
			    <span class="n">crtpagemiss</span> <span class="o">*</span> <span class="n">pagemiss</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">mclk_freq</span><span class="p">;</span>
			<span class="n">us_crt</span> <span class="o">=</span> <span class="n">cpm_us</span> <span class="o">+</span> <span class="n">us_m</span> <span class="o">+</span> <span class="n">us_n</span> <span class="o">+</span> <span class="n">us_p</span><span class="p">;</span>
			<span class="n">clwm</span> <span class="o">=</span> <span class="n">us_crt</span> <span class="o">*</span> <span class="n">crtc_drain_rate</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
			<span class="cm">/* fixed point &lt;= float_point - 1.  Fixes that */</span>
			<span class="n">clwm</span><span class="o">++</span><span class="p">;</span>

			<span class="cm">/* Finally, a heuristic check when width == 64 bits */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">width</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">nvclk_fill</span> <span class="o">=</span> <span class="n">nvclk_freq</span> <span class="o">*</span> <span class="mi">8</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">crtc_drain_rate</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&gt;=</span> <span class="n">nvclk_fill</span> <span class="o">*</span> <span class="mi">102</span><span class="p">)</span>
					<span class="cm">/*Large number to fail */</span>
					<span class="n">clwm</span> <span class="o">=</span> <span class="mh">0xfff</span><span class="p">;</span>

				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">crtc_drain_rate</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&gt;=</span>
					 <span class="n">nvclk_fill</span> <span class="o">*</span> <span class="mi">98</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">clwm</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
					<span class="n">cbs</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="cm">/*</span>
<span class="cm">		   Overfill check:</span>
<span class="cm">		 */</span>

		<span class="n">clwm_rnd_down</span> <span class="o">=</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">clwm</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clwm_rnd_down</span> <span class="o">&lt;</span> <span class="n">clwm</span><span class="p">)</span>
			<span class="n">clwm</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>

		<span class="n">m1</span> <span class="o">=</span> <span class="n">clwm</span> <span class="o">+</span> <span class="n">cbs</span> <span class="o">-</span> <span class="mi">1024</span><span class="p">;</span>	<span class="cm">/* Amount of overfill */</span>
		<span class="n">m2us</span> <span class="o">=</span> <span class="n">us_pipe_min</span> <span class="o">+</span> <span class="n">us_min_mclk_extra</span><span class="p">;</span>

		<span class="cm">/* pclk cycles to drain */</span>
		<span class="n">p1clk</span> <span class="o">=</span> <span class="n">m2us</span> <span class="o">*</span> <span class="n">pclk_freq</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
		<span class="n">p2</span> <span class="o">=</span> <span class="n">p1clk</span> <span class="o">*</span> <span class="n">bpp</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>	<span class="cm">/* bytes drained. */</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">p2</span> <span class="o">&lt;</span> <span class="n">m1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">m1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">min_mclk_extra</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">cbs</span> <span class="o">&lt;=</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/* Can&#39;t adjust anymore! */</span>
					<span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="cm">/* reduce the burst size */</span>
					<span class="n">cbs</span> <span class="o">=</span> <span class="n">cbs</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">min_mclk_extra</span><span class="o">--</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">clwm</span> <span class="o">&gt;</span> <span class="mi">1023</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* Have some margin */</span>
				<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">min_mclk_extra</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
					<span class="cm">/* Can&#39;t adjust anymore! */</span>
					<span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">else</span>
					<span class="n">min_mclk_extra</span><span class="o">--</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">clwm</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">-</span> <span class="n">cbs</span> <span class="o">+</span> <span class="mi">8</span><span class="p">))</span>
			<span class="n">clwm</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">-</span> <span class="n">cbs</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">clwm</span><span class="p">);</span>
		<span class="cm">/*  printf(&quot;CRT LWM: %f bytes, prog: 0x%x, bs: 256\n&quot;,</span>
<span class="cm">		    clwm, data ); */</span>
		<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">graphics_lwm</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
		<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">graphics_burst_size</span> <span class="o">=</span> <span class="n">cbs</span><span class="p">;</span>

		<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">video_lwm</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
		<span class="n">fifo</span><span class="o">-&gt;</span><span class="n">video_burst_size</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">nv10UpdateArbitrationSettings</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">VClk</span><span class="p">,</span>
					  <span class="kt">unsigned</span> <span class="n">pixelDepth</span><span class="p">,</span>
					  <span class="kt">unsigned</span> <span class="o">*</span><span class="n">burst</span><span class="p">,</span>
					  <span class="kt">unsigned</span> <span class="o">*</span><span class="n">lwm</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">nv10_fifo_info</span> <span class="n">fifo_data</span><span class="p">;</span>
	<span class="n">nv10_sim_state</span> <span class="n">sim_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">MClk</span><span class="p">,</span> <span class="n">NVClk</span><span class="p">,</span> <span class="n">cfg1</span><span class="p">;</span>

	<span class="n">nvGetClocks</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MClk</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">NVClk</span><span class="p">);</span>

	<span class="n">cfg1</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0204</span><span class="p">);</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">pix_bpp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">pixelDepth</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">enable_video</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">enable_mp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">memory_type</span> <span class="o">=</span> <span class="p">(</span><span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">memory_width</span> <span class="o">=</span> <span class="p">(</span><span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PEXTDEV</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">?</span>
	    <span class="mi">128</span> <span class="o">:</span> <span class="mi">64</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">mem_latency</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">cfg1</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">mem_aligned</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">mem_page_miss</span> <span class="o">=</span>
	    <span class="p">(</span><span class="kt">char</span><span class="p">)(((</span><span class="n">cfg1</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">cfg1</span> <span class="o">&gt;&gt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">));</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">gr_during_vid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">pclk_khz</span> <span class="o">=</span> <span class="n">VClk</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">mclk_khz</span> <span class="o">=</span> <span class="n">MClk</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">nvclk_khz</span> <span class="o">=</span> <span class="n">NVClk</span><span class="p">;</span>
	<span class="n">nv10CalcArbitration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fifo_data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sim_data</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fifo_data</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">fifo_data</span><span class="p">.</span><span class="n">graphics_burst_size</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
		<span class="o">*</span><span class="n">burst</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="p">(</span><span class="o">*</span><span class="n">burst</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
		<span class="o">*</span><span class="n">lwm</span> <span class="o">=</span> <span class="n">fifo_data</span><span class="p">.</span><span class="n">graphics_lwm</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">nv30UpdateArbitrationSettings</span> <span class="p">(</span>
    <span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">,</span>
    <span class="kt">unsigned</span> <span class="kt">int</span>      <span class="o">*</span><span class="n">burst</span><span class="p">,</span>
    <span class="kt">unsigned</span> <span class="kt">int</span>      <span class="o">*</span><span class="n">lwm</span>
<span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">MClk</span><span class="p">,</span> <span class="n">NVClk</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fifo_size</span><span class="p">,</span> <span class="n">burst_size</span><span class="p">,</span> <span class="n">graphics_lwm</span><span class="p">;</span>

    <span class="n">fifo_size</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">;</span>
    <span class="n">burst_size</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
    <span class="n">graphics_lwm</span> <span class="o">=</span> <span class="n">fifo_size</span> <span class="o">-</span> <span class="n">burst_size</span><span class="p">;</span>

    <span class="n">nvGetClocks</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MClk</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">NVClk</span><span class="p">);</span>

    <span class="o">*</span><span class="n">burst</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">burst_size</span> <span class="o">&gt;&gt;=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">burst_size</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">burst</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
    <span class="o">*</span><span class="n">lwm</span> <span class="o">=</span> <span class="n">graphics_lwm</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">nForceUpdateArbitrationSettings</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">VClk</span><span class="p">,</span>
					    <span class="kt">unsigned</span> <span class="n">pixelDepth</span><span class="p">,</span>
					    <span class="kt">unsigned</span> <span class="o">*</span><span class="n">burst</span><span class="p">,</span>
					    <span class="kt">unsigned</span> <span class="o">*</span><span class="n">lwm</span><span class="p">,</span>
					    <span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">nv10_fifo_info</span> <span class="n">fifo_data</span><span class="p">;</span>
	<span class="n">nv10_sim_state</span> <span class="n">sim_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">pll</span><span class="p">,</span> <span class="n">MClk</span><span class="p">,</span> <span class="n">NVClk</span><span class="p">,</span> <span class="n">memctrl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0x0FF0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x01A0</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">uMClkPostDiv</span><span class="p">;</span>
		<span class="n">dev</span> <span class="o">=</span> <span class="n">pci_get_bus_and_slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">pci_read_config_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uMClkPostDiv</span><span class="p">);</span>
		<span class="n">uMClkPostDiv</span> <span class="o">=</span> <span class="p">(</span><span class="n">uMClkPostDiv</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">uMClkPostDiv</span><span class="p">)</span>
			<span class="n">uMClkPostDiv</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">MClk</span> <span class="o">=</span> <span class="mi">400000</span> <span class="o">/</span> <span class="n">uMClkPostDiv</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">dev</span> <span class="o">=</span> <span class="n">pci_get_bus_and_slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
		<span class="n">pci_read_config_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MClk</span><span class="p">);</span>
		<span class="n">MClk</span> <span class="o">/=</span> <span class="mi">1000</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">pci_dev_put</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">pll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0500</span><span class="p">);</span>
	<span class="n">M</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
	<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
	<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">pll</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
	<span class="n">NVClk</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span> <span class="o">/</span> <span class="n">M</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">P</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">pix_bpp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">pixelDepth</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">enable_video</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">enable_mp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">dev</span> <span class="o">=</span> <span class="n">pci_get_bus_and_slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">pci_read_config_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x7C</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sim_data</span><span class="p">.</span><span class="n">memory_type</span><span class="p">);</span>
	<span class="n">pci_dev_put</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">memory_type</span> <span class="o">=</span> <span class="p">(</span><span class="n">sim_data</span><span class="p">.</span><span class="n">memory_type</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">memory_width</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>

	<span class="n">dev</span> <span class="o">=</span> <span class="n">pci_get_bus_and_slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">pci_read_config_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">memctrl</span><span class="p">);</span>
	<span class="n">pci_dev_put</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">memctrl</span> <span class="o">&gt;&gt;=</span> <span class="mi">16</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">memctrl</span> <span class="o">==</span> <span class="mh">0x1A9</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">memctrl</span> <span class="o">==</span> <span class="mh">0x1AB</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">memctrl</span> <span class="o">==</span> <span class="mh">0x1ED</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">dimm</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

		<span class="n">dev</span> <span class="o">=</span> <span class="n">pci_get_bus_and_slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">pci_read_config_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dimm</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">dimm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dimm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x4f</span><span class="p">;</span>
		<span class="n">pci_read_config_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dimm</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
		<span class="n">dimm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dimm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x4f</span><span class="p">;</span>
		<span class="n">pci_read_config_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dimm</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
		<span class="n">dimm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dimm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x4f</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">dimm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dimm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="n">dimm</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;nvidiafb: your nForce DIMMs are not arranged &quot;</span>
			       <span class="s">&quot;in optimal banks!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">pci_dev_put</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">sim_data</span><span class="p">.</span><span class="n">mem_latency</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">mem_aligned</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">mem_page_miss</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">gr_during_vid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">pclk_khz</span> <span class="o">=</span> <span class="n">VClk</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">mclk_khz</span> <span class="o">=</span> <span class="n">MClk</span><span class="p">;</span>
	<span class="n">sim_data</span><span class="p">.</span><span class="n">nvclk_khz</span> <span class="o">=</span> <span class="n">NVClk</span><span class="p">;</span>
	<span class="n">nv10CalcArbitration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fifo_data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sim_data</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fifo_data</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">fifo_data</span><span class="p">.</span><span class="n">graphics_burst_size</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
		<span class="o">*</span><span class="n">burst</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="p">(</span><span class="o">*</span><span class="n">burst</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
		<span class="o">*</span><span class="n">lwm</span> <span class="o">=</span> <span class="n">fifo_data</span><span class="p">.</span><span class="n">graphics_lwm</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************\</span>
<span class="cm">*                                                                            *</span>
<span class="cm">*                          RIVA Mode State Routines                          *</span>
<span class="cm">*                                                                            *</span>
<span class="cm">\****************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> * Calculate the Video Clock parameters for the PLL.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">CalcVClock</span><span class="p">(</span><span class="kt">int</span> <span class="n">clockIn</span><span class="p">,</span>
		       <span class="kt">int</span> <span class="o">*</span><span class="n">clockOut</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span> <span class="n">pllOut</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">lowM</span><span class="p">,</span> <span class="n">highM</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">DeltaNew</span><span class="p">,</span> <span class="n">DeltaOld</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">VClk</span><span class="p">,</span> <span class="n">Freq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">P</span><span class="p">;</span>

	<span class="n">DeltaOld</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span><span class="p">;</span>

	<span class="n">VClk</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">clockIn</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span> <span class="o">==</span> <span class="mi">13500</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">lowM</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
		<span class="n">highM</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">lowM</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">highM</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">P</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">P</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">P</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Freq</span> <span class="o">=</span> <span class="n">VClk</span> <span class="o">&lt;&lt;</span> <span class="n">P</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">Freq</span> <span class="o">&gt;=</span> <span class="mi">128000</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">Freq</span> <span class="o">&lt;=</span> <span class="mi">350000</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">M</span> <span class="o">=</span> <span class="n">lowM</span><span class="p">;</span> <span class="n">M</span> <span class="o">&lt;=</span> <span class="n">highM</span><span class="p">;</span> <span class="n">M</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">N</span> <span class="o">=</span> <span class="p">((</span><span class="n">VClk</span> <span class="o">&lt;&lt;</span> <span class="n">P</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span><span class="p">)</span> <span class="o">/</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">Freq</span> <span class="o">=</span>
					    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span> <span class="o">/</span>
					     <span class="n">M</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">P</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">Freq</span> <span class="o">&gt;</span> <span class="n">VClk</span><span class="p">)</span>
						<span class="n">DeltaNew</span> <span class="o">=</span> <span class="n">Freq</span> <span class="o">-</span> <span class="n">VClk</span><span class="p">;</span>
					<span class="k">else</span>
						<span class="n">DeltaNew</span> <span class="o">=</span> <span class="n">VClk</span> <span class="o">-</span> <span class="n">Freq</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">DeltaNew</span> <span class="o">&lt;</span> <span class="n">DeltaOld</span><span class="p">)</span> <span class="p">{</span>
						<span class="o">*</span><span class="n">pllOut</span> <span class="o">=</span>
						    <span class="p">(</span><span class="n">P</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">N</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">M</span><span class="p">;</span>
						<span class="o">*</span><span class="n">clockOut</span> <span class="o">=</span> <span class="n">Freq</span><span class="p">;</span>
						<span class="n">DeltaOld</span> <span class="o">=</span> <span class="n">DeltaNew</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">CalcVClock2Stage</span><span class="p">(</span><span class="kt">int</span> <span class="n">clockIn</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="o">*</span><span class="n">clockOut</span><span class="p">,</span>
			     <span class="n">u32</span> <span class="o">*</span> <span class="n">pllOut</span><span class="p">,</span>
			     <span class="n">u32</span> <span class="o">*</span> <span class="n">pllBOut</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">DeltaNew</span><span class="p">,</span> <span class="n">DeltaOld</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">VClk</span><span class="p">,</span> <span class="n">Freq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">P</span><span class="p">;</span>

	<span class="n">DeltaOld</span> <span class="o">=</span> <span class="mh">0xFFFFFFFF</span><span class="p">;</span>

	<span class="o">*</span><span class="n">pllBOut</span> <span class="o">=</span> <span class="mh">0x80000401</span><span class="p">;</span>	<span class="cm">/* fixed at x4 for now */</span>

	<span class="n">VClk</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">clockIn</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">P</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">P</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">;</span> <span class="n">P</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Freq</span> <span class="o">=</span> <span class="n">VClk</span> <span class="o">&lt;&lt;</span> <span class="n">P</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">Freq</span> <span class="o">&gt;=</span> <span class="mi">400000</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">Freq</span> <span class="o">&lt;=</span> <span class="mi">1000000</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">M</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">M</span> <span class="o">&lt;=</span> <span class="mi">13</span><span class="p">;</span> <span class="n">M</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">N</span> <span class="o">=</span> <span class="p">((</span><span class="n">VClk</span> <span class="o">&lt;&lt;</span> <span class="n">P</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span><span class="p">)</span> <span class="o">/</span>
				    <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">((</span><span class="n">N</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">Freq</span> <span class="o">=</span>
					    <span class="p">(((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">CrystalFreqKHz</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span> <span class="o">/</span>
					     <span class="n">M</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">P</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">Freq</span> <span class="o">&gt;</span> <span class="n">VClk</span><span class="p">)</span>
						<span class="n">DeltaNew</span> <span class="o">=</span> <span class="n">Freq</span> <span class="o">-</span> <span class="n">VClk</span><span class="p">;</span>
					<span class="k">else</span>
						<span class="n">DeltaNew</span> <span class="o">=</span> <span class="n">VClk</span> <span class="o">-</span> <span class="n">Freq</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">DeltaNew</span> <span class="o">&lt;</span> <span class="n">DeltaOld</span><span class="p">)</span> <span class="p">{</span>
						<span class="o">*</span><span class="n">pllOut</span> <span class="o">=</span>
						    <span class="p">(</span><span class="n">P</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">N</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">M</span><span class="p">;</span>
						<span class="o">*</span><span class="n">clockOut</span> <span class="o">=</span> <span class="n">Freq</span><span class="p">;</span>
						<span class="n">DeltaOld</span> <span class="o">=</span> <span class="n">DeltaNew</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Calculate extended mode parameters (SVGA) and save in a</span>
<span class="cm"> * mode state structure.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">NVCalcStateExt</span><span class="p">(</span><span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">,</span>
		    <span class="n">RIVA_HW_STATE</span> <span class="o">*</span> <span class="n">state</span><span class="p">,</span>
		    <span class="kt">int</span> <span class="n">bpp</span><span class="p">,</span>
		    <span class="kt">int</span> <span class="n">width</span><span class="p">,</span>
		    <span class="kt">int</span> <span class="n">hDisplaySize</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dotClock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">pixelDepth</span><span class="p">,</span> <span class="n">VClk</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * Save mode parameters.</span>
<span class="cm">	 */</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">bpp</span> <span class="o">=</span> <span class="n">bpp</span><span class="p">;</span>	<span class="cm">/* this is not bitsPerPixel, it&#39;s 8,15,16,32 */</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">;</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * Extended RIVA registers.</span>
<span class="cm">	 */</span>
	<span class="n">pixelDepth</span> <span class="o">=</span> <span class="p">(</span><span class="n">bpp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">twoStagePLL</span><span class="p">)</span>
		<span class="n">CalcVClock2Stage</span><span class="p">(</span><span class="n">dotClock</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">VClk</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">pll</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">pllB</span><span class="p">,</span>
				 <span class="n">par</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">CalcVClock</span><span class="p">(</span><span class="n">dotClock</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">VClk</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">pll</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">NV_ARCH_04</span>:
		<span class="n">nv4UpdateArbitrationSettings</span><span class="p">(</span><span class="n">VClk</span><span class="p">,</span>
					     <span class="n">pixelDepth</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
					     <span class="o">&amp;</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration0</span><span class="p">),</span>
					     <span class="o">&amp;</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration1</span><span class="p">),</span> <span class="n">par</span><span class="p">);</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor0</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor1</span> <span class="o">=</span> <span class="mh">0xbC</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">FB_VMODE_DOUBLE</span><span class="p">)</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor1</span> <span class="o">|=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor2</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">;</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">pllsel</span> <span class="o">=</span> <span class="mh">0x10000700</span><span class="p">;</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">=</span> <span class="mh">0x00001114</span><span class="p">;</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">general</span> <span class="o">=</span> <span class="n">bpp</span> <span class="o">==</span> <span class="mi">16</span> <span class="o">?</span> <span class="mh">0x00101100</span> <span class="o">:</span> <span class="mh">0x00100100</span><span class="p">;</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">repaint1</span> <span class="o">=</span> <span class="n">hDisplaySize</span> <span class="o">&lt;</span> <span class="mi">1280</span> <span class="o">?</span> <span class="mh">0x04</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">NV_ARCH_40</span>:
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">FlatPanel</span><span class="p">)</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">control</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0580</span><span class="p">)</span> <span class="o">&amp;</span>
				<span class="mh">0xeffffeff</span><span class="p">;</span>
		<span class="cm">/* fallthrough */</span>
	<span class="k">case</span> <span class="n">NV_ARCH_10</span>:
	<span class="k">case</span> <span class="n">NV_ARCH_20</span>:
	<span class="k">case</span> <span class="n">NV_ARCH_30</span>:
	<span class="nl">default:</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0240</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x03d0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration0</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration1</span> <span class="o">=</span> <span class="mh">0x0480</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x01A0</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x01f0</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">nForceUpdateArbitrationSettings</span><span class="p">(</span><span class="n">VClk</span><span class="p">,</span>
							<span class="n">pixelDepth</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration0</span><span class="p">),</span>
							<span class="o">&amp;</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration1</span><span class="p">),</span>
							<span class="n">par</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&lt;</span> <span class="n">NV_ARCH_30</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">nv10UpdateArbitrationSettings</span><span class="p">(</span><span class="n">VClk</span><span class="p">,</span>
						      <span class="n">pixelDepth</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
						      <span class="o">&amp;</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration0</span><span class="p">),</span>
						      <span class="o">&amp;</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration1</span><span class="p">),</span>
						      <span class="n">par</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">nv30UpdateArbitrationSettings</span><span class="p">(</span><span class="n">par</span><span class="p">,</span>
						      <span class="o">&amp;</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration0</span><span class="p">),</span>
						      <span class="o">&amp;</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration1</span><span class="p">));</span>
		<span class="p">}</span>

		<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor0</span> <span class="o">=</span> <span class="mh">0x80</span> <span class="o">|</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">CursorStart</span> <span class="o">&gt;&gt;</span> <span class="mi">17</span><span class="p">);</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor1</span> <span class="o">=</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">CursorStart</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor2</span> <span class="o">=</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">CursorStart</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">FB_VMODE_DOUBLE</span><span class="p">)</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor1</span> <span class="o">|=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">pllsel</span> <span class="o">=</span> <span class="mh">0x10000700</span><span class="p">;</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x00000200</span><span class="p">);</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">general</span> <span class="o">=</span> <span class="n">bpp</span> <span class="o">==</span> <span class="mi">16</span> <span class="o">?</span> <span class="mh">0x00101100</span> <span class="o">:</span> <span class="mh">0x00100100</span><span class="p">;</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">repaint1</span> <span class="o">=</span> <span class="n">hDisplaySize</span> <span class="o">&lt;</span> <span class="mi">1280</span> <span class="o">?</span> <span class="mh">0x04</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">bpp</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">)</span>		<span class="cm">/* DirectColor */</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">general</span> <span class="o">|=</span> <span class="mh">0x00000030</span><span class="p">;</span>

	<span class="n">state</span><span class="o">-&gt;</span><span class="n">repaint0</span> <span class="o">=</span> <span class="p">(((</span><span class="n">width</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">pixelDepth</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x700</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">pixel</span> <span class="o">=</span> <span class="p">(</span><span class="n">pixelDepth</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="mi">3</span> <span class="o">:</span> <span class="n">pixelDepth</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">NVLoadStateExt</span><span class="p">(</span><span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">,</span> <span class="n">RIVA_HW_STATE</span> <span class="o">*</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x0140</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">,</span> <span class="mh">0xFFFF00FF</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">);</span>

	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PTIMER</span><span class="p">,</span> <span class="mh">0x0200</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000008</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PTIMER</span><span class="p">,</span> <span class="mh">0x0210</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000003</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PTIMER</span><span class="p">,</span> <span class="mh">0x0140</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PTIMER</span><span class="p">,</span> <span class="mh">0x0100</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">==</span> <span class="n">NV_ARCH_04</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&lt;</span> <span class="n">NV_ARCH_40</span><span class="p">)</span> <span class="o">||</span>
		   <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0040</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0240</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0x10</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0244</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0x10</span><span class="p">),</span>
				<span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">regions</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0090</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x01D0</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0290</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0390</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x03D0</span><span class="p">))</span>
			<span class="n">regions</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">regions</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0600</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0x10</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0604</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0x10</span><span class="p">),</span>
				<span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_40</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0000</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000010</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0001</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00101202</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0002</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000011</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0003</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00101204</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0004</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000012</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0005</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00101206</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0006</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000013</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0007</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00101208</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0008</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000014</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0009</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0010120A</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000015</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000B</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0010120C</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000016</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000D</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0010120E</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000E</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000017</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000F</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00101210</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0800</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00003000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0801</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0802</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000002</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0808</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02080062</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0809</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00001200</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080B</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00001200</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080D</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0810</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02080043</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0811</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0812</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0813</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0814</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0815</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0818</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02080044</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0819</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081B</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081D</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0820</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02080019</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0821</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0822</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0823</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0824</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0825</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0828</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x020A005C</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0829</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x082A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x082B</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x082C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x082D</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0830</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0208009F</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0831</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0832</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00001200</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0833</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00001200</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0834</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0835</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0838</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0208004A</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0839</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x083A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x083B</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x083C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x083D</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0840</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x02080077</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0841</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0842</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00001200</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0843</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00001200</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0844</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0845</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x084C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00003002</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x084D</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00007FFF</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x084E</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">par</span><span class="o">-&gt;</span><span class="n">FbUsableSize</span> <span class="o">|</span> <span class="mh">0x00000002</span><span class="p">);</span>

<span class="cp">#ifdef __BIG_ENDIAN</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x01000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0812</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0812</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x01000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x01000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0822</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0822</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x01000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x082A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x082A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x01000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0832</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0832</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x01000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x083A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x083A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x01000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0842</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0842</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x01000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0819</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x01000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0839</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x01000000</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0000</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000010</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0001</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80011201</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0002</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000011</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0003</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80011202</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0004</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000012</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0005</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80011203</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0006</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000013</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0007</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80011204</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0008</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000014</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0009</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80011205</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000015</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000B</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80011206</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000016</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000D</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80011207</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000E</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80000017</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x000F</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x80011208</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0800</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00003000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0801</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0802</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000002</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0803</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000002</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_10</span><span class="p">)</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0804</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x01008062</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0804</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x01008042</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0805</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0806</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x12001200</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0807</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0808</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x01008043</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0809</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080B</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x01008044</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080D</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000002</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080E</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080F</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0810</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x01008019</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0811</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0812</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0813</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0814</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0100A05C</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0815</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0816</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0817</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">WaitVSyncPossible</span><span class="p">)</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0818</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0100809F</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0818</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0100805F</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0819</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081A</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x12001200</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081B</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0100804A</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081D</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000002</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081E</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081F</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0820</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x01018077</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0821</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0822</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x12001200</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0823</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0824</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00003002</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0825</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00007FFF</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0826</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">par</span><span class="o">-&gt;</span><span class="n">FbUsableSize</span> <span class="o">|</span> <span class="mh">0x00000002</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0827</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000002</span><span class="p">);</span>
<span class="cp">#ifdef __BIG_ENDIAN</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0804</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0804</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0808</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0808</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0810</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0810</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0814</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0814</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0818</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0818</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0820</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0820</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x080D</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000001</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x081D</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000001</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&lt;</span> <span class="n">NV_ARCH_10</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0x0fff</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0020</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0824</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
				<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0824</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00020000</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span> <span class="mh">0x0826</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
				<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMIN</span><span class="p">,</span>
					<span class="mh">0x0826</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">FbAddress</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0080</span><span class="p">,</span> <span class="mh">0x000001FF</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0080</span><span class="p">,</span> <span class="mh">0x1230C000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0084</span><span class="p">,</span> <span class="mh">0x72111101</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0088</span><span class="p">,</span> <span class="mh">0x11D5F071</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x008C</span><span class="p">,</span> <span class="mh">0x0004FF31</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x008C</span><span class="p">,</span> <span class="mh">0x4004FF31</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0140</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0100</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0170</span><span class="p">,</span> <span class="mh">0x10010100</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0710</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0720</span><span class="p">,</span> <span class="mh">0x00000001</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0810</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0608</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0080</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0080</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>

		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0140</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0100</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0144</span><span class="p">,</span> <span class="mh">0x10010100</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0714</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0720</span><span class="p">,</span> <span class="mh">0x00000001</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0710</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0710</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0007ff00</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0710</span><span class="p">,</span>
			<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0710</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00020100</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">==</span> <span class="n">NV_ARCH_10</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0084</span><span class="p">,</span> <span class="mh">0x00118700</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0088</span><span class="p">,</span> <span class="mh">0x24E00810</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x008C</span><span class="p">,</span> <span class="mh">0x55DE0030</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="o">&amp;</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">[(</span><span class="mh">0x0B00</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">NV_RD32</span><span class="p">(</span><span class="o">&amp;</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">[(</span><span class="mh">0x0240</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span>
						<span class="mi">0</span><span class="p">));</span>

			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x640</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x644</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x684</span><span class="p">,</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x688</span><span class="p">,</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0810</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0608</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_40</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0084</span><span class="p">,</span> <span class="mh">0x401287c0</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x008C</span><span class="p">,</span> <span class="mh">0x60de8051</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0090</span><span class="p">,</span> <span class="mh">0x00008000</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0610</span><span class="p">,</span> <span class="mh">0x00be3c5f</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0bc4</span><span class="p">,</span>
					<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0bc4</span><span class="p">)</span> <span class="o">|</span>
					<span class="mh">0x00008000</span><span class="p">);</span>

				<span class="n">j</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">REGS</span><span class="p">,</span> <span class="mh">0x1540</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">!</span><span class="p">(</span><span class="n">j</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span> <span class="n">j</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">++</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x5000</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
				<span class="p">}</span>

				<span class="k">if</span> <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0040</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x09b0</span><span class="p">,</span>
						<span class="mh">0x83280fff</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x09b4</span><span class="p">,</span>
						<span class="mh">0x000000a0</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0820</span><span class="p">,</span>
						<span class="mh">0x83280eff</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0824</span><span class="p">,</span>
						<span class="mh">0x000000a0</span><span class="p">);</span>
				<span class="p">}</span>

				<span class="k">switch</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">case</span> <span class="mh">0x0040</span>:
				<span class="k">case</span> <span class="mh">0x0210</span>:
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x09b8</span><span class="p">,</span>
						<span class="mh">0x0078e366</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x09bc</span><span class="p">,</span>
						<span class="mh">0x0000014c</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x033C</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x33C</span><span class="p">)</span> <span class="o">&amp;</span>
						<span class="mh">0xffff7fff</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mh">0x00C0</span>:
				<span class="k">case</span> <span class="mh">0x0120</span>:
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0828</span><span class="p">,</span>
						<span class="mh">0x007596ff</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x082C</span><span class="p">,</span>
						<span class="mh">0x00000108</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mh">0x0160</span>:
				<span class="k">case</span> <span class="mh">0x01D0</span>:
				<span class="k">case</span> <span class="mh">0x0240</span>:
				<span class="k">case</span> <span class="mh">0x03D0</span>:
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x1700</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x020C</span><span class="p">));</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x1704</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x1708</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x170C</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x020C</span><span class="p">));</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0860</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0864</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0608</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span>
							<span class="mh">0x0608</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00100000</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mh">0x0140</span>:
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0828</span><span class="p">,</span>
						<span class="mh">0x0072cb77</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x082C</span><span class="p">,</span>
						<span class="mh">0x00000108</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mh">0x0220</span>:
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0860</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0864</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0608</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0608</span><span class="p">)</span> <span class="o">|</span>
						<span class="mh">0x00100000</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mh">0x0090</span>:
				<span class="k">case</span> <span class="mh">0x0290</span>:
				<span class="k">case</span> <span class="mh">0x0390</span>:
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0608</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0608</span><span class="p">)</span> <span class="o">|</span>
						<span class="mh">0x00100000</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0828</span><span class="p">,</span>
						<span class="mh">0x07830610</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x082C</span><span class="p">,</span>
						<span class="mh">0x0000016A</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="nl">default:</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">};</span>

				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0b38</span><span class="p">,</span> <span class="mh">0x2ffff800</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0b3c</span><span class="p">,</span> <span class="mh">0x00006000</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x032C</span><span class="p">,</span> <span class="mh">0x01000000</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0220</span><span class="p">,</span> <span class="mh">0x00001200</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">==</span> <span class="n">NV_ARCH_30</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0084</span><span class="p">,</span> <span class="mh">0x40108700</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0890</span><span class="p">,</span> <span class="mh">0x00140000</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x008C</span><span class="p">,</span> <span class="mh">0xf00e0431</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0090</span><span class="p">,</span> <span class="mh">0x00008000</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0610</span><span class="p">,</span> <span class="mh">0xf04b1f36</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0B80</span><span class="p">,</span> <span class="mh">0x1002d888</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0B88</span><span class="p">,</span> <span class="mh">0x62ff007f</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0084</span><span class="p">,</span> <span class="mh">0x00118700</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x008C</span><span class="p">,</span> <span class="mh">0xF20E0431</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0090</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x009C</span><span class="p">,</span> <span class="mh">0x00000040</span><span class="p">);</span>

				<span class="k">if</span> <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0x0ff0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mh">0x0250</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0890</span><span class="p">,</span>
						<span class="mh">0x00080000</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0610</span><span class="p">,</span>
						<span class="mh">0x304B1FB6</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0B80</span><span class="p">,</span>
						<span class="mh">0x18B82880</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0B84</span><span class="p">,</span>
						<span class="mh">0x44000000</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0098</span><span class="p">,</span>
						<span class="mh">0x40000080</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0B88</span><span class="p">,</span>
						<span class="mh">0x000000ff</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0880</span><span class="p">,</span>
						<span class="mh">0x00080000</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0094</span><span class="p">,</span>
						<span class="mh">0x00000005</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0B80</span><span class="p">,</span>
						<span class="mh">0x45CAA208</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0B84</span><span class="p">,</span>
						<span class="mh">0x24000000</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0098</span><span class="p">,</span>
						<span class="mh">0x00000040</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0750</span><span class="p">,</span>
						<span class="mh">0x00E00038</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0754</span><span class="p">,</span>
						<span class="mh">0x00000030</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0750</span><span class="p">,</span>
						<span class="mh">0x00E10038</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0754</span><span class="p">,</span>
						<span class="mh">0x00000030</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&lt;</span> <span class="n">NV_ARCH_40</span><span class="p">)</span> <span class="o">||</span>
			    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0040</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0900</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0240</span> <span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">));</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x6900</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0240</span> <span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">));</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0090</span><span class="p">)</span> <span class="o">||</span>
				    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x01D0</span><span class="p">)</span> <span class="o">||</span>
				    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0290</span><span class="p">)</span> <span class="o">||</span>
				    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0390</span><span class="p">)</span> <span class="o">||</span>
				    <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x03D0</span><span class="p">))</span> <span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span>
							<span class="mh">0x0D00</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
							<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span>
								<span class="mh">0x0600</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">));</span>
						<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span>
							<span class="mh">0x6900</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
							<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span>
								<span class="mh">0x0600</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">));</span>
					<span class="p">}</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">48</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span>
							<span class="mh">0x0900</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
							<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span>
								<span class="mh">0x0600</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">));</span>
						<span class="k">if</span><span class="p">(((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span>
						    <span class="o">!=</span> <span class="mh">0x0160</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
						   <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span>
						    <span class="o">!=</span> <span class="mh">0x0220</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
						   <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span>
						    <span class="o">!=</span> <span class="mh">0x240</span><span class="p">))</span>
							<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span>
								<span class="mh">0x6900</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
								<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span>
									<span class="mh">0x0600</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">));</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_40</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0040</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x09A4</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">));</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x09A8</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0204</span><span class="p">));</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x69A4</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">));</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x69A8</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0204</span><span class="p">));</span>

					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0820</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0824</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0864</span><span class="p">,</span>
						<span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0868</span><span class="p">,</span>
						<span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0090</span> <span class="o">||</span>
					    <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x01D0</span> <span class="o">||</span>
					    <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0290</span> <span class="o">||</span>
					    <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0xfff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0390</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0DF0</span><span class="p">,</span>
							<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">));</span>
						<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0DF4</span><span class="p">,</span>
							<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0204</span><span class="p">));</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x09F0</span><span class="p">,</span>
							<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">));</span>
						<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x09F4</span><span class="p">,</span>
							<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0204</span><span class="p">));</span>
					<span class="p">}</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x69F0</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">));</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x69F4</span><span class="p">,</span>
						<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0204</span><span class="p">));</span>

					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0840</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0844</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x08a0</span><span class="p">,</span>
						<span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
					<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x08a4</span><span class="p">,</span>
						<span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x09A4</span><span class="p">,</span>
					<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">));</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x09A8</span><span class="p">,</span>
					<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0204</span><span class="p">));</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0750</span><span class="p">,</span> <span class="mh">0x00EA0000</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0754</span><span class="p">,</span>
					<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">));</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0750</span><span class="p">,</span> <span class="mh">0x00EA0004</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0754</span><span class="p">,</span>
					<span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0204</span><span class="p">));</span>

				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0820</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0824</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0864</span><span class="p">,</span>
					<span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0868</span><span class="p">,</span>
					<span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0B20</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0B04</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x053C</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0540</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0544</span><span class="p">,</span> <span class="mh">0x00007FFF</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PGRAPH</span><span class="p">,</span> <span class="mh">0x0548</span><span class="p">,</span> <span class="mh">0x00007FFF</span><span class="p">);</span>

	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0140</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0141</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000001</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0480</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0494</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_40</span><span class="p">)</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0481</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00010000</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0481</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000100</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0490</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0491</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_40</span><span class="p">)</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x048B</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00001213</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x048B</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00001209</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0400</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0414</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0084</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x03000100</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0085</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000110</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0086</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000112</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0143</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0000FFFF</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0496</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0000FFFF</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0050</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0040</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0415</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000001</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x048C</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x04A0</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000000</span><span class="p">);</span>
<span class="cp">#ifdef __BIG_ENDIAN</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0489</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x800F0078</span><span class="p">);</span>
<span class="cp">#else</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0489</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x000F0078</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0488</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000001</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0480</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000001</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0494</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000001</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0495</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000001</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFIFO</span><span class="p">,</span> <span class="mh">0x0140</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x00000001</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">par</span><span class="o">-&gt;</span><span class="n">CurrentState</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	    <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_10</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">twoHeads</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCRTC0</span><span class="p">,</span> <span class="mh">0x0860</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCRTC0</span><span class="p">,</span> <span class="mh">0x2860</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">head2</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0404</span><span class="p">,</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0404</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">));</span>

		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x8704</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x8140</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x8920</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x8924</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x8908</span><span class="p">,</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x890C</span><span class="p">,</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">FbMapSize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PMC</span><span class="p">,</span> <span class="mh">0x1588</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCRTC</span><span class="p">,</span> <span class="mh">0x0810</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">cursorConfig</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCRTC</span><span class="p">,</span> <span class="mh">0x0830</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">displayV</span> <span class="o">-</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCRTC</span><span class="p">,</span> <span class="mh">0x0834</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">displayV</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">FlatPanel</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0x0ff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0110</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0528</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">dither</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">twoHeads</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x083C</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">dither</span><span class="p">);</span>
			<span class="p">}</span>

			<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">);</span>
			<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">timingH</span><span class="p">);</span>
			<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">);</span>
			<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">timingV</span><span class="p">);</span>
			<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">);</span>
			<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">);</span>
		<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">extra</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">repaint0</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">repaint1</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">screen</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">pixel</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">horiz</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">fifo</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x1B</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration0</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration1</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_30</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">);</span>
		<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration1</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor0</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor1</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x2F</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor2</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">interlace</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">FlatPanel</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_40</span><span class="p">)</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0580</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">control</span><span class="p">);</span>

		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x050C</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">pllsel</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0508</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">vpll</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">twoHeads</span><span class="p">)</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0520</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">vpll2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">twoStagePLL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0578</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">vpllB</span><span class="p">);</span>
			<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x057C</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">vpll2B</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0848</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">scale</span><span class="p">);</span>
		<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0828</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">crtcSync</span> <span class="o">+</span>
			<span class="n">par</span><span class="o">-&gt;</span><span class="n">PanelTweak</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0600</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">general</span><span class="p">);</span>

	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCRTC</span><span class="p">,</span> <span class="mh">0x0140</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCRTC</span><span class="p">,</span> <span class="mh">0x0100</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">par</span><span class="o">-&gt;</span><span class="n">CurrentState</span> <span class="o">=</span> <span class="n">state</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">NVUnloadStateExt</span><span class="p">(</span><span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">,</span> <span class="n">RIVA_HW_STATE</span> <span class="o">*</span> <span class="n">state</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">repaint0</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">repaint1</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">screen</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">pixel</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">horiz</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x1C</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">fifo</span>         <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x1B</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration0</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration1</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_30</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">);</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">arbitration1</span> <span class="o">|=</span> <span class="p">(</span><span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor0</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor1</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x2F</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursor2</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
	<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">interlace</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">vpll</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0508</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">twoHeads</span><span class="p">)</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">vpll2</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0520</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">twoStagePLL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">vpllB</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0578</span><span class="p">);</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">vpll2B</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x057C</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">pllsel</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x050C</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">general</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0600</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">scale</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0848</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PFB</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_40</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">FlatPanel</span><span class="p">)</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">control</span>  <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC0</span><span class="p">,</span> <span class="mh">0x0580</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Architecture</span> <span class="o">&gt;=</span> <span class="n">NV_ARCH_10</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">twoHeads</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">head</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCRTC0</span><span class="p">,</span> <span class="mh">0x0860</span><span class="p">);</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">head2</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCRTC0</span><span class="p">,</span> <span class="mh">0x2860</span><span class="p">);</span>
			<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">);</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">crtcOwner</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">);</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">extra</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">cursorConfig</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCRTC</span><span class="p">,</span> <span class="mh">0x0810</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">Chipset</span> <span class="o">&amp;</span> <span class="mh">0x0ff0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x0110</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">dither</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x0528</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">twoHeads</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">dither</span> <span class="o">=</span> <span class="n">NV_RD32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PRAMDAC</span><span class="p">,</span> <span class="mh">0x083C</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">FlatPanel</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">);</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">timingH</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
			<span class="n">VGA_WR08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D4</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">);</span>
			<span class="n">state</span><span class="o">-&gt;</span><span class="n">timingV</span> <span class="o">=</span> <span class="n">VGA_RD08</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCIO</span><span class="p">,</span> <span class="mh">0x03D5</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">NVSetStartAddress</span><span class="p">(</span><span class="k">struct</span> <span class="n">nvidia_par</span> <span class="o">*</span><span class="n">par</span><span class="p">,</span> <span class="n">u32</span> <span class="n">start</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">NV_WR32</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">PCRTC</span><span class="p">,</span> <span class="mh">0x800</span><span class="p">,</span> <span class="n">start</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
