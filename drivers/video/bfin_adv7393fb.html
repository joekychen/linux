<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › video › bfin_adv7393fb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>bfin_adv7393fb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Frame buffer driver for ADV7393/2 video encoder</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2006-2009 Analog Devices Inc.</span>
<span class="cm"> * Licensed under the GPL-2 or late.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __BFIN_ADV7393FB_H__</span>
<span class="cp">#define __BFIN_ADV7393FB_H__</span>

<span class="cp">#define BFIN_LCD_NBR_PALETTE_ENTRIES	256</span>

<span class="cp">#ifdef CONFIG_NTSC</span>
<span class="cp"># define VMODE 0</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_PAL</span>
<span class="cp"># define VMODE 1</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_NTSC_640x480</span>
<span class="cp"># define VMODE 2</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_PAL_640x480</span>
<span class="cp"># define VMODE 3</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_NTSC_YCBCR</span>
<span class="cp"># define VMODE 4</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_PAL_YCBCR</span>
<span class="cp"># define VMODE 5</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef VMODE</span>
<span class="cp"># define VMODE 1</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_ADV7393_2XMEM</span>
<span class="cp"># define VMEM 2</span>
<span class="cp">#else</span>
<span class="cp"># define VMEM 1</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_BF537) || defined(CONFIG_BF536) || defined(CONFIG_BF534)</span>
<span class="cp"># define DMA_CFG_VAL	0x7935	</span><span class="cm">/* Set Sync Bit */</span><span class="cp"></span>
<span class="cp"># define VB_DUMMY_MEMORY_SOURCE	L1_DATA_B_START</span>
<span class="cp">#else</span>
<span class="cp"># define DMA_CFG_VAL	0x7915</span>
<span class="cp"># define VB_DUMMY_MEMORY_SOURCE	BOOT_ROM_START</span>
<span class="cp">#endif</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">DESTRUCT</span><span class="p">,</span>
	<span class="n">BUILD</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">POWER_ON</span><span class="p">,</span>
	<span class="n">POWER_DOWN</span><span class="p">,</span>
	<span class="n">BLANK_ON</span><span class="p">,</span>
	<span class="n">BLANK_OFF</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define DRIVER_NAME &quot;bfin-adv7393&quot;</span>

<span class="k">struct</span> <span class="n">adv7393fb_modes</span> <span class="p">{</span>
	<span class="k">const</span> <span class="n">s8</span> <span class="n">name</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>	<span class="cm">/* Full name */</span>
	<span class="n">u16</span> <span class="n">xres</span><span class="p">;</span>		<span class="cm">/* Active Horizonzal Pixels  */</span>
	<span class="n">u16</span> <span class="n">yres</span><span class="p">;</span>		<span class="cm">/* Active Vertical Pixels  */</span>
	<span class="n">u16</span> <span class="n">bpp</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">vmode</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">a_lines</span><span class="p">;</span>		<span class="cm">/* Active Lines per Field */</span>
	<span class="n">u16</span> <span class="n">vb1_lines</span><span class="p">;</span>		<span class="cm">/* Vertical Blanking Field 1 Lines */</span>
	<span class="n">u16</span> <span class="n">vb2_lines</span><span class="p">;</span>		<span class="cm">/* Vertical Blanking Field 2 Lines */</span>
	<span class="n">u16</span> <span class="n">tot_lines</span><span class="p">;</span>		<span class="cm">/* Total Lines per Frame */</span>
	<span class="n">u16</span> <span class="n">boeft_blank</span><span class="p">;</span>	<span class="cm">/* Before Odd/Even Field Transition No. of Blank Pixels */</span>
	<span class="n">u16</span> <span class="n">aoeft_blank</span><span class="p">;</span>	<span class="cm">/* After Odd/Even Field Transition No. of Blank Pixels */</span>
	<span class="k">const</span> <span class="n">s8</span> <span class="o">*</span><span class="n">adv7393_i2c_initd</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">adv7393_i2c_initd_len</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">init_NTSC_TESTPATTERN</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1E</span><span class="p">,</span>	<span class="cm">/* Power up all DACs and PLL */</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* SD-Only Mode */</span>
	<span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span>	<span class="cm">/* SSAF Luma Filter Enabled, NTSC Mode */</span>
	<span class="mh">0x82</span><span class="p">,</span> <span class="mh">0xCB</span><span class="p">,</span>	<span class="cm">/* Step control on, pixel data valid, pedestal on, PrPb SSAF on, CVBS/YC output */</span>
	<span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span>	<span class="cm">/* SD Color Bar Test Pattern Enabled, DAC 2 = Luma, DAC 3 = Chroma */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">init_NTSC</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1E</span><span class="p">,</span>	<span class="cm">/* Power up all DACs and PLL */</span>
	<span class="mh">0xC3</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0xC5</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0xC2</span><span class="p">,</span> <span class="mh">0x4A</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0xC6</span><span class="p">,</span> <span class="mh">0x5E</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0xBD</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0xBF</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">,</span>	<span class="cm">/* NTSC Subcarrier Frequency */</span>
	<span class="mh">0x8D</span><span class="p">,</span> <span class="mh">0x7C</span><span class="p">,</span>	<span class="cm">/* NTSC Subcarrier Frequency */</span>
	<span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span>	<span class="cm">/* NTSC Subcarrier Frequency */</span>
	<span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span>	<span class="cm">/* NTSC Subcarrier Frequency */</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* SD-Only Mode */</span>
	<span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span>	<span class="cm">/* SSAF Luma Filter Enabled, NTSC Mode */</span>
	<span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span>	<span class="cm">/* Step control on, pixel data invalid, pedestal on, PrPb SSAF on, CVBS/YC output */</span>
	<span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>	<span class="cm">/* SD Color Bar Test Pattern Enabled, DAC 2 = Luma, DAC 3 = Chroma */</span>
	<span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span>
	<span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="mh">0x8A</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">init_PAL</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1E</span><span class="p">,</span>	<span class="cm">/* Power up all DACs and PLL */</span>
	<span class="mh">0xC3</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0xC5</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0xC2</span><span class="p">,</span> <span class="mh">0x4A</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0xC6</span><span class="p">,</span> <span class="mh">0x5E</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0xBD</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0xBF</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span>	<span class="cm">/* Program RGB-&gt;YCrCb Color Space conversion matrix */</span>
	<span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0xCB</span><span class="p">,</span>	<span class="cm">/* PAL Subcarrier Frequency */</span>
	<span class="mh">0x8D</span><span class="p">,</span> <span class="mh">0x8A</span><span class="p">,</span>	<span class="cm">/* PAL Subcarrier Frequency */</span>
	<span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span>	<span class="cm">/* PAL Subcarrier Frequency */</span>
	<span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0x2A</span><span class="p">,</span>	<span class="cm">/* PAL Subcarrier Frequency */</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* SD-Only Mode */</span>
	<span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span>	<span class="cm">/* SSAF Luma Filter Enabled, PAL Mode */</span>
	<span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span>	<span class="cm">/* Step control on, pixel data invalid, pedestal on, PrPb SSAF on, CVBS/YC output */</span>
	<span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>	<span class="cm">/* SD Color Bar Test Pattern Enabled, DAC 2 = Luma, DAC 3 = Chroma */</span>
	<span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span>
	<span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="mh">0x8A</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">init_NTSC_YCbCr</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1E</span><span class="p">,</span>	<span class="cm">/* Power up all DACs and PLL */</span>
	<span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">,</span>	<span class="cm">/* NTSC Subcarrier Frequency */</span>
	<span class="mh">0x8D</span><span class="p">,</span> <span class="mh">0x7C</span><span class="p">,</span>	<span class="cm">/* NTSC Subcarrier Frequency */</span>
	<span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span>	<span class="cm">/* NTSC Subcarrier Frequency */</span>
	<span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span>	<span class="cm">/* NTSC Subcarrier Frequency */</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* SD-Only Mode */</span>
	<span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span>	<span class="cm">/* SSAF Luma Filter Enabled, NTSC Mode */</span>
	<span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span>	<span class="cm">/* Step control on, pixel data invalid, pedestal on, PrPb SSAF on, CVBS/YC output */</span>
	<span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* DAC 2 = Luma, DAC 3 = Chroma */</span>
	<span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span>
	<span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="mh">0x8A</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">init_PAL_YCbCr</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1E</span><span class="p">,</span>	<span class="cm">/* Power up all DACs and PLL */</span>
	<span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0xCB</span><span class="p">,</span>	<span class="cm">/* PAL Subcarrier Frequency */</span>
	<span class="mh">0x8D</span><span class="p">,</span> <span class="mh">0x8A</span><span class="p">,</span>	<span class="cm">/* PAL Subcarrier Frequency */</span>
	<span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span>	<span class="cm">/* PAL Subcarrier Frequency */</span>
	<span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0x2A</span><span class="p">,</span>	<span class="cm">/* PAL Subcarrier Frequency */</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* SD-Only Mode */</span>
	<span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span>	<span class="cm">/* SSAF Luma Filter Enabled, PAL Mode */</span>
	<span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span>	<span class="cm">/* Step control on, pixel data invalid, pedestal on, PrPb SSAF on, CVBS/YC output */</span>
	<span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* DAC 2 = Luma, DAC 3 = Chroma */</span>
	<span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span>
	<span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="mh">0x8A</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">adv7393fb_modes</span> <span class="n">known_modes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* NTSC 720x480 CRT */</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;NTSC 720x480&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xres</span> <span class="o">=</span> <span class="mi">720</span><span class="p">,</span>
		<span class="p">.</span><span class="n">yres</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bpp</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vmode</span> <span class="o">=</span> <span class="n">FB_VMODE_INTERLACED</span><span class="p">,</span>
		<span class="p">.</span><span class="n">a_lines</span> <span class="o">=</span> <span class="mi">240</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb1_lines</span> <span class="o">=</span> <span class="mi">22</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb2_lines</span> <span class="o">=</span> <span class="mi">23</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tot_lines</span> <span class="o">=</span> <span class="mi">525</span><span class="p">,</span>
		<span class="p">.</span><span class="n">boeft_blank</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
		<span class="p">.</span><span class="n">aoeft_blank</span> <span class="o">=</span> <span class="mi">122</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd</span> <span class="o">=</span> <span class="n">init_NTSC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">init_NTSC</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="cm">/* PAL 720x480 CRT */</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PAL 720x576&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xres</span> <span class="o">=</span> <span class="mi">720</span><span class="p">,</span>
		<span class="p">.</span><span class="n">yres</span> <span class="o">=</span> <span class="mi">576</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bpp</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vmode</span> <span class="o">=</span> <span class="n">FB_VMODE_INTERLACED</span><span class="p">,</span>
		<span class="p">.</span><span class="n">a_lines</span> <span class="o">=</span> <span class="mi">288</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb1_lines</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb2_lines</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tot_lines</span> <span class="o">=</span> <span class="mi">625</span><span class="p">,</span>
		<span class="p">.</span><span class="n">boeft_blank</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
		<span class="p">.</span><span class="n">aoeft_blank</span> <span class="o">=</span> <span class="mi">132</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd</span> <span class="o">=</span> <span class="n">init_PAL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">init_PAL</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="cm">/* NTSC 640x480 CRT Experimental */</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;NTSC 640x480&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xres</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>
		<span class="p">.</span><span class="n">yres</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bpp</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vmode</span> <span class="o">=</span> <span class="n">FB_VMODE_INTERLACED</span><span class="p">,</span>
		<span class="p">.</span><span class="n">a_lines</span> <span class="o">=</span> <span class="mi">240</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb1_lines</span> <span class="o">=</span> <span class="mi">22</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb2_lines</span> <span class="o">=</span> <span class="mi">23</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tot_lines</span> <span class="o">=</span> <span class="mi">525</span><span class="p">,</span>
		<span class="p">.</span><span class="n">boeft_blank</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">40</span><span class="p">,</span>
		<span class="p">.</span><span class="n">aoeft_blank</span> <span class="o">=</span> <span class="mi">122</span> <span class="o">+</span> <span class="mi">40</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd</span> <span class="o">=</span> <span class="n">init_NTSC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">init_NTSC</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="cm">/* PAL 640x480 CRT Experimental */</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PAL 640x480&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xres</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>
		<span class="p">.</span><span class="n">yres</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bpp</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vmode</span> <span class="o">=</span> <span class="n">FB_VMODE_INTERLACED</span><span class="p">,</span>
		<span class="p">.</span><span class="n">a_lines</span> <span class="o">=</span> <span class="mi">288</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb1_lines</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb2_lines</span> <span class="o">=</span> <span class="mi">25</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tot_lines</span> <span class="o">=</span> <span class="mi">625</span><span class="p">,</span>
		<span class="p">.</span><span class="n">boeft_blank</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">40</span><span class="p">,</span>
		<span class="p">.</span><span class="n">aoeft_blank</span> <span class="o">=</span> <span class="mi">132</span> <span class="o">+</span> <span class="mi">40</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd</span> <span class="o">=</span> <span class="n">init_PAL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">init_PAL</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="cm">/* NTSC 720x480 YCbCR */</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;NTSC 720x480 YCbCR&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xres</span> <span class="o">=</span> <span class="mi">720</span><span class="p">,</span>
		<span class="p">.</span><span class="n">yres</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bpp</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vmode</span> <span class="o">=</span> <span class="n">FB_VMODE_INTERLACED</span><span class="p">,</span>
		<span class="p">.</span><span class="n">a_lines</span> <span class="o">=</span> <span class="mi">240</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb1_lines</span> <span class="o">=</span> <span class="mi">22</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb2_lines</span> <span class="o">=</span> <span class="mi">23</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tot_lines</span> <span class="o">=</span> <span class="mi">525</span><span class="p">,</span>
		<span class="p">.</span><span class="n">boeft_blank</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
		<span class="p">.</span><span class="n">aoeft_blank</span> <span class="o">=</span> <span class="mi">122</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd</span> <span class="o">=</span> <span class="n">init_NTSC_YCbCr</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">init_NTSC_YCbCr</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="cm">/* PAL 720x480 CRT */</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PAL 720x576 YCbCR&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xres</span> <span class="o">=</span> <span class="mi">720</span><span class="p">,</span>
		<span class="p">.</span><span class="n">yres</span> <span class="o">=</span> <span class="mi">576</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bpp</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vmode</span> <span class="o">=</span> <span class="n">FB_VMODE_INTERLACED</span><span class="p">,</span>
		<span class="p">.</span><span class="n">a_lines</span> <span class="o">=</span> <span class="mi">288</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb1_lines</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vb2_lines</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tot_lines</span> <span class="o">=</span> <span class="mi">625</span><span class="p">,</span>
		<span class="p">.</span><span class="n">boeft_blank</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
		<span class="p">.</span><span class="n">aoeft_blank</span> <span class="o">=</span> <span class="mi">132</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd</span> <span class="o">=</span> <span class="n">init_PAL_YCbCr</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adv7393_i2c_initd_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">init_PAL_YCbCr</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">adv7393fb_regs</span> <span class="p">{</span>

<span class="p">};</span>

<span class="k">struct</span> <span class="n">adv7393fb_device</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fb_info</span> <span class="n">info</span><span class="p">;</span>	<span class="cm">/* FB driver info record */</span>

	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dmasg</span> <span class="o">*</span><span class="n">descriptor_list_head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dmasg</span> <span class="o">*</span><span class="n">vb1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dmasg</span> <span class="o">*</span><span class="n">av1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dmasg</span> <span class="o">*</span><span class="n">vb2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dmasg</span> <span class="o">*</span><span class="n">av2</span><span class="p">;</span>

	<span class="n">dma_addr_t</span> <span class="n">dma_handle</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">fb_info</span> <span class="n">bfin_adv7393_fb</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">adv7393fb_modes</span> <span class="o">*</span><span class="n">modes</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">adv7393fb_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">;</span>	<span class="cm">/* Registers memory map */</span>
	<span class="kt">size_t</span> <span class="n">regs_len</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">fb_len</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">line_len</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">open</span><span class="p">;</span>
	<span class="n">u16</span> <span class="o">*</span><span class="n">fb_mem</span><span class="p">;</span>		<span class="cm">/* RGB Buffer */</span>

<span class="p">};</span>

<span class="cp">#define to_adv7393fb_device(_info) \</span>
<span class="cp">	  (_info ? container_of(_info, struct adv7393fb_device, info) : NULL);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">bfin_adv7393_fb_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">int</span> <span class="n">user</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">bfin_adv7393_fb_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">int</span> <span class="n">user</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">bfin_adv7393_fb_check_var</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">bfin_adv7393_fb_pan_display</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">bfin_adv7393_fb_blank</span><span class="p">(</span><span class="kt">int</span> <span class="n">blank</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">bfin_config_ppi</span><span class="p">(</span><span class="k">struct</span> <span class="n">adv7393fb_device</span> <span class="o">*</span><span class="n">fbdev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">bfin_config_dma</span><span class="p">(</span><span class="k">struct</span> <span class="n">adv7393fb_device</span> <span class="o">*</span><span class="n">fbdev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">bfin_disable_dma</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">bfin_enable_ppi</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">bfin_disable_ppi</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">adv7393_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">value</span><span class="p">);</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">adv7393_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adv7393_write_block</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">bfin_adv7393_fb_cursor</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_cursor</span> <span class="o">*</span><span class="n">cursor</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">bfin_adv7393_fb_setcolreg</span><span class="p">(</span><span class="n">u_int</span><span class="p">,</span> <span class="n">u_int</span><span class="p">,</span> <span class="n">u_int</span><span class="p">,</span> <span class="n">u_int</span><span class="p">,</span>
				     <span class="n">u_int</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
