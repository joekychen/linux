f | fbcon_cw.c | s | 10K | 350 | Denys Vlasenko | vda.linux@googlemail.com | 1281542349 |  | fbcon: uninline four foo_update_attr() functions  This patch uninlines four similar functions, foo_update_attr(), in four fbcon-related files.  These functions contain loops, two of theam have _nested_ loops, and they have more than one callsite each.  I think they should not be inlined.  Signed-off-by: Denys Vlasenko <vda.linux@googlemail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | dummycon.c | s | 1.8K | 70 | H. Peter Anvin | hpa@zytor.com | 1192600637 |  | Remove magic macros for screen_info structure members  Stop using magic macros for screen_info structure members.  Signed-off-by: H. Peter Anvin <hpa@zytor.com>
f | Makefile | g | 1.5K |  | David S. Miller | davem@davemloft.net | 1253059478 |  | sparc: Kill PROM console driver.  Many years ago when this driver was written, it had a use, but these days it's nothing but trouble and distributions should not enable it in any situation.  Pretty much every console device a sparc machine could see has a bonafide real driver, making the PROM console hack unnecessary.  If any new device shows up, we should write a driver instead of depending upon this crutch to save us.  We've been able to take care of this even when no chip documentation exists (sunxvr500, sunxvr2500) so there are no excuses.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | font_6x11.c | s | 66K | 3090 | Ralf Baechle | ralf@linux-mips.org | 1192552997 |  | fbcon: Convert struct font_desc to use ISO C initializers  Akpm's patch "newport_con warning fix" got me to look at the console drivers again and one thing that I noticed was that none of the fonts was using ISO initializers for it's fonts.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> Signed-off-by: Antonino Daplas <adaplas@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | mdacon.c | s | 13K | 472 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | tileblit.c | s | 3.8K | 136 | Henry Nestler | henry.nestler@gmail.com | 1300779668 |  | fbcon: Bugfix soft cursor detection in Tile Blitting  Use mask 0x10 for "soft cursor" detection on in function tile_cursor. (Tile Blitting Operation in framebuffer console).  The old mask 0x01 for vc_cursor_type detects CUR_NONE, CUR_LOWER_THIRD and every second mode value as "software cursor". This hides the cursor for these modes (cursor.mode = 0). But, only CUR_NONE or "software cursor" should hide the cursor. See also 0x10 in functions add_softcursor, bit_cursor and cw_cursor.  Signed-off-by: Henry Nestler <henry.nestler@gmail.com> Cc: stable@kernel.org Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | font_7x14.c | s | 79K | 3856 | Ralf Baechle | ralf@linux-mips.org | 1192552997 |  | fbcon: Convert struct font_desc to use ISO C initializers  Akpm's patch "newport_con warning fix" got me to look at the console drivers again and one thing that I noticed was that none of the fonts was using ISO initializers for it's fonts.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> Signed-off-by: Antonino Daplas <adaplas@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | fbcon_rotate.h | s | 2.3K | 75 | Stefani Seibold | stefani@seibold.net | 1249666795 |  | fbcon: fix rotate upside down crash  Fix the rotate_ud() function not to crash in case of a font which has not a width of multiple by 8: The inner loop of the font pixel copy should not access a bit outside the font memory area.  Subtract the shift offset from the font width will prevent this.  Signed-off-by: Stefani Seibold <stefani@seibold.net> Cc: Krzysztof Helt <krzysztof.h1@poczta.fm> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | vgacon.c | s | 40K | 1247 | Thomas Gleixner | tglx@linutronix.de | 1315905124 |  | locking, video: Annotate vga console lock as raw  The vga_lock lock can be taken in atomic context and therefore cannot be preempted on -rt - annotate it.  In mainline this change documents the low level nature of the lock - otherwise there's no functional difference. Lockdep and Sparse checking will work as usual.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de> Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | sticore.c | s | 26K | 892 | Rolf Eike Beer | eike-kernel@sf-tec.de | 1336687928 |  | parisc: move definition of PAGE0 to asm/page.h  This was defined in asm/pdc.h which needs to include asm/page.h for __PAGE_OFFSET. This leads to an include loop so that page.h eventually will include pdc.h again. While this is no problem because of header guards, it is a problem because some symbols may be undefined. Such an error is this:  In file included from include/linux/bitops.h:35:0,                  from include/asm-generic/getorder.h:7,                  from arch/parisc/include/asm/page.h:162,                  from arch/parisc/include/asm/pdc.h:346,                  from arch/parisc/include/asm/processor.h:16,                  from arch/parisc/include/asm/spinlock.h:6,                  from arch/parisc/include/asm/atomic.h:20,                  from include/linux/atomic.h:4,                  from include/linux/sysfs.h:20,                  from include/linux/kobject.h:21,                  from include/linux/device.h:17,                  from include/linux/eisa.h:5,                  from arch/parisc/kernel/pci.c:11: arch/parisc/include/asm/bitops.h: In function ‘set_bit’: arch/parisc/include/asm/bitops.h:82:2: error: implicit declaration of function ‘_atomic_spin_lock_irqsave’ [-Werror=implicit-function-declaration] arch/parisc/include/asm/bitops.h:84:2: error: implicit declaration of function ‘_atomic_spin_unlock_irqrestore’ [-Werror=implicit-function-declaration]  Signed-off-by: Rolf Eike Beer <eike-kernel@sf-tec.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | font_sun8x16.c | s | 22K | 272 | Ralf Baechle | ralf@linux-mips.org | 1192552997 |  | fbcon: Convert struct font_desc to use ISO C initializers  Akpm's patch "newport_con warning fix" got me to look at the console drivers again and one thing that I noticed was that none of the fonts was using ISO initializers for it's fonts.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> Signed-off-by: Antonino Daplas <adaplas@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | font_pearl_8x8.c | s | 54K | 2326 | Ralf Baechle | ralf@linux-mips.org | 1192552997 |  | fbcon: Convert struct font_desc to use ISO C initializers  Akpm's patch "newport_con warning fix" got me to look at the console drivers again and one thing that I noticed was that none of the fonts was using ISO initializers for it's fonts.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> Signed-off-by: Antonino Daplas <adaplas@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | fbcon.c | s | 86K | 3090 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | bitblit.c | s | 10K | 361 | Denys Vlasenko | vda.linux@googlemail.com | 1281542349 |  | fbcon: uninline four foo_update_attr() functions  This patch uninlines four similar functions, foo_update_attr(), in four fbcon-related files.  These functions contain loops, two of theam have _nested_ loops, and they have more than one callsite each.  I think they should not be inlined.  Signed-off-by: Denys Vlasenko <vda.linux@googlemail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | softcursor.c | s | 2.1K | 69 | Krzysztof Helt | krzysztof.h1@wp.pl | 1192552997 |  | fbdev: change asm/uaccess.h to linux/uaccess.h  This patch replaces <asm/uaccess.h> with <linux/uaccess.h> after the checkpatch.pl hint.  The include of <asm/uaccess.h> is removed if the driver does not use it.  Signed-off-by: Krzysztof Helt <krzysztof.h1@wp.pl> Signed-off-by: Antonino Daplas <adaplas@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | fbcon_rotate.c | s | 2.5K | 100 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | fbcon_ud.c | s | 11K | 383 | Denys Vlasenko | vda.linux@googlemail.com | 1281542349 |  | fbcon: uninline four foo_update_attr() functions  This patch uninlines four similar functions, foo_update_attr(), in four fbcon-related files.  These functions contain loops, two of theam have _nested_ loops, and they have more than one callsite each.  I think they should not be inlined.  Signed-off-by: Denys Vlasenko <vda.linux@googlemail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | fbcon_ccw.c | s | 10K | 359 | Denys Vlasenko | vda.linux@googlemail.com | 1281542349 |  | fbcon: uninline four foo_update_attr() functions  This patch uninlines four similar functions, foo_update_attr(), in four fbcon-related files.  These functions contain loops, two of theam have _nested_ loops, and they have more than one callsite each.  I think they should not be inlined.  Signed-off-by: Denys Vlasenko <vda.linux@googlemail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | font_acorn_8x8.c | s | 15K | 272 | Ralf Baechle | ralf@linux-mips.org | 1192552997 |  | fbcon: Convert struct font_desc to use ISO C initializers  Akpm's patch "newport_con warning fix" got me to look at the console drivers again and one thing that I noticed was that none of the fonts was using ISO initializers for it's fonts.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> Signed-off-by: Antonino Daplas <adaplas@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | font_10x18.c | s | 140K | 4884 | Ralf Baechle | ralf@linux-mips.org | 1192552997 |  | fbcon: Convert struct font_desc to use ISO C initializers  Akpm's patch "newport_con warning fix" got me to look at the console drivers again and one thing that I noticed was that none of the fonts was using ISO initializers for it's fonts.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> Signed-off-by: Antonino Daplas <adaplas@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | Kconfig | g | 8.1K |  | Arnd Bergmann | arnd@arndb.de | 1339246271 |  | video/console: automatically select a font  The frame buffer console needs at least one font to be built into the kernel, so add the necessary Kconfig magic to guarantee that one of the available font is always on. If a user accidentally disables all fonts manually, the 8x16 font will be selected anyway.  Signed-off-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Mathieu Poirier <mathieu.poirier@linaro.org> Signed-off-by: Florian Tobias Schandinat <FlorianSchandinat@gmx.de>
f | newport_con.c | s | 19K | 672 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | fonts.c | s | 3.0K | 136 | Adrian Bunk | bunk@kernel.org | 1202323261 |  | cleanup after APUS removal  After the APUS removal, some code can be removed.  Signed-off-by: Adrian Bunk <bunk@kernel.org> Acked-by: Geert Uytterhoeven <geert@linux-m68k.org> Cc: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Cc: Karsten Keil <kkeil@suse.de> Cc: James Bottomley <James.Bottomley@steeleye.com> Cc: "Antonino A. Daplas" <adaplas@pol.net> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | font_sun12x22.c | s | 181K | 5904 | Ralf Baechle | ralf@linux-mips.org | 1192552997 |  | fbcon: Convert struct font_desc to use ISO C initializers  Akpm's patch "newport_con warning fix" got me to look at the console drivers again and one thing that I noticed was that none of the fonts was using ISO initializers for it's fonts.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> Signed-off-by: Antonino Daplas <adaplas@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | sticon.c | s | 9.3K | 329 | Linus Torvalds | torvalds@linux-foundation.org | 1224011522 |  | Revert "vt: fix background color on line feed"  This reverts commit c9e587abfdec2c2aaa55fab83bcb4972e2f84f9b, and the subsequent commits that fixed it up:   - afa9b649 "fbcon: prevent cursor disappearance after switching to 512    character font"   - d850a2fa "vt/fbcon: fix background color on line feed"   - 7fe3915a "vt/fbcon: update scrl_erase_char after 256/512-glyph font    switch"  by request of Alan Cox. Quoth Alan:   "Unfortunately it's wrong and its been causing breakages because    various apps like ncurses expect our previous (and correct)    behaviour."  Alexander sent out a similar patch.  Requested-by: Alan Cox <alan@lxorguk.ukuu.org.uk> Tested-by: Jan Engelhardt <jengelh@medozas.de> Cc: Alexander V. Lukyanov <lav@netis.ru> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | font_8x16.c | s | 93K | 4371 | Andrew Morton | akpm@linux-foundation.org | 1192552999 |  | export font_vga_8x16  mips allmodconfig:  ERROR: "font_vga_8x16" [drivers/video/console/newport_con.ko] undefined!  Cc: Ralf Baechle <ralf@linux-mips.org> Cc: "Antonino A. Daplas" <adaplas@pol.net> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | font_mini_4x6.c | s | 54K | 2141 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | font_8x8.c | s | 49K | 2321 | Ralf Baechle | ralf@linux-mips.org | 1192552997 |  | fbcon: Convert struct font_desc to use ISO C initializers  Akpm's patch "newport_con warning fix" got me to look at the console drivers again and one thing that I noticed was that none of the fonts was using ISO initializers for it's fonts.  Signed-off-by: Ralf Baechle <ralf@linux-mips.org> Signed-off-by: Antonino Daplas <adaplas@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | fbcon.h | s | 7.2K | 229 | Jesse Barnes | jbarnes@virtuousgeek.org | 1281018151 |  | fb: add hooks to handle KDB enter/exit  Add fb ops to handle enter/exit of the kernel debugger.  If present, the fb core will register them with KGDB and they'll be called when the debugger is entered and exited.  The new functions are responsible for switching to an appropriate debug framebuffer and restoring the interrupted state at exit time.  Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org> Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
