<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › video › sis › sis_accel.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>sis_accel.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * SiS 300/540/630[S]/730[S],</span>
<span class="cm"> * SiS 315[E|PRO]/550/[M]650/651/[M]661[F|M]X/740/[M]741[GX]/330/[M]760[GX],</span>
<span class="cm"> * XGI V3XT/V5/V8, Z7</span>
<span class="cm"> * frame buffer driver for Linux kernels &gt;= 2.4.14 and &gt;=2.6.3</span>
<span class="cm"> *</span>
<span class="cm"> * 2D acceleration part</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the named License,</span>
<span class="cm"> * or any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA</span>
<span class="cm"> *</span>
<span class="cm"> * Based on the X driver&#39;s sis300_accel.h which is</span>
<span class="cm"> *     Copyright (C) 2001-2004 by Thomas Winischhofer, Vienna, Austria</span>
<span class="cm"> * and sis310_accel.h which is</span>
<span class="cm"> *     Copyright (C) 2001-2004 by Thomas Winischhofer, Vienna, Austria</span>
<span class="cm"> *</span>
<span class="cm"> * Author:   Thomas Winischhofer &lt;thomas@winischhofer.net&gt;:</span>
<span class="cm"> *			(see http://www.winischhofer.net/</span>
<span class="cm"> *			for more information and updates)</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _SISFB_ACCEL_H</span>
<span class="cp">#define _SISFB_ACCEL_H</span>

<span class="cm">/* Guard accelerator accesses with spin_lock_irqsave? Works well without. */</span>
<span class="cp">#undef SISFB_USE_SPINLOCKS</span>

<span class="cp">#ifdef SISFB_USE_SPINLOCKS</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#define CRITBEGIN  spin_lock_irqsave(&amp;ivideo-&gt;lockaccel, critflags);</span>
<span class="cp">#define CRITEND	   spin_unlock_irqrestore(&amp;ivideo-&gt;lockaccel, critflags);</span>
<span class="cp">#define CRITFLAGS  unsigned long critflags;</span>
<span class="cp">#else</span>
<span class="cp">#define CRITBEGIN</span>
<span class="cp">#define CRITEND</span>
<span class="cp">#define CRITFLAGS</span>
<span class="cp">#endif</span>

<span class="cm">/* Definitions for the SIS engine communication. */</span>

<span class="cp">#define PATREGSIZE      384  </span><span class="cm">/* Pattern register size. 384 bytes @ 0x8300 */</span><span class="cp"></span>
<span class="cp">#define BR(x)   (0x8200 | (x) &lt;&lt; 2)</span>
<span class="cp">#define PBR(x)  (0x8300 | (x) &lt;&lt; 2)</span>

<span class="cm">/* SiS300 engine commands */</span>
<span class="cp">#define BITBLT                  0x00000000  </span><span class="cm">/* Blit */</span><span class="cp"></span>
<span class="cp">#define COLOREXP                0x00000001  </span><span class="cm">/* Color expand */</span><span class="cp"></span>
<span class="cp">#define ENCOLOREXP              0x00000002  </span><span class="cm">/* Enhanced color expand */</span><span class="cp"></span>
<span class="cp">#define MULTIPLE_SCANLINE       0x00000003  </span><span class="cm">/* ? */</span><span class="cp"></span>
<span class="cp">#define LINE                    0x00000004  </span><span class="cm">/* Draw line */</span><span class="cp"></span>
<span class="cp">#define TRAPAZOID_FILL          0x00000005  </span><span class="cm">/* Fill trapezoid */</span><span class="cp"></span>
<span class="cp">#define TRANSPARENT_BITBLT      0x00000006  </span><span class="cm">/* Transparent Blit */</span><span class="cp"></span>

<span class="cm">/* Additional engine commands for 315 */</span>
<span class="cp">#define ALPHA_BLEND		0x00000007  </span><span class="cm">/* Alpha blend ? */</span><span class="cp"></span>
<span class="cp">#define A3D_FUNCTION		0x00000008  </span><span class="cm">/* 3D command ? */</span><span class="cp"></span>
<span class="cp">#define	CLEAR_Z_BUFFER		0x00000009  </span><span class="cm">/* ? */</span><span class="cp"></span>
<span class="cp">#define GRADIENT_FILL		0x0000000A  </span><span class="cm">/* Gradient fill */</span><span class="cp"></span>

<span class="cm">/* source select */</span>
<span class="cp">#define SRCVIDEO                0x00000000  </span><span class="cm">/* source is video RAM */</span><span class="cp"></span>
<span class="cp">#define SRCSYSTEM               0x00000010  </span><span class="cm">/* source is system memory */</span><span class="cp"></span>
<span class="cp">#define SRCCPUBLITBUF           SRCSYSTEM   </span><span class="cm">/* source is CPU-driven BitBuffer (for color expand) */</span><span class="cp"></span>
<span class="cp">#define SRCAGP                  0x00000020  </span><span class="cm">/* source is AGP memory (?) */</span><span class="cp"></span>

<span class="cm">/* Pattern flags */</span>
<span class="cp">#define PATFG                   0x00000000  </span><span class="cm">/* foreground color */</span><span class="cp"></span>
<span class="cp">#define PATPATREG               0x00000040  </span><span class="cm">/* pattern in pattern buffer (0x8300) */</span><span class="cp"></span>
<span class="cp">#define PATMONO                 0x00000080  </span><span class="cm">/* mono pattern */</span><span class="cp"></span>

<span class="cm">/* blitting direction (300 series only) */</span>
<span class="cp">#define X_INC                   0x00010000</span>
<span class="cp">#define X_DEC                   0x00000000</span>
<span class="cp">#define Y_INC                   0x00020000</span>
<span class="cp">#define Y_DEC                   0x00000000</span>

<span class="cm">/* Clipping flags */</span>
<span class="cp">#define NOCLIP                  0x00000000</span>
<span class="cp">#define NOMERGECLIP             0x04000000</span>
<span class="cp">#define CLIPENABLE              0x00040000</span>
<span class="cp">#define CLIPWITHOUTMERGE        0x04040000</span>

<span class="cm">/* Transparency */</span>
<span class="cp">#define OPAQUE                  0x00000000</span>
<span class="cp">#define TRANSPARENT             0x00100000</span>

<span class="cm">/* ? */</span>
<span class="cp">#define DSTAGP                  0x02000000</span>
<span class="cp">#define DSTVIDEO                0x02000000</span>

<span class="cm">/* Subfunctions for Color/Enhanced Color Expansion (315 only) */</span>
<span class="cp">#define COLOR_TO_MONO		0x00100000</span>
<span class="cp">#define AA_TEXT			0x00200000</span>

<span class="cm">/* Some general registers for 315 series */</span>
<span class="cp">#define SRC_ADDR		0x8200</span>
<span class="cp">#define SRC_PITCH		0x8204</span>
<span class="cp">#define AGP_BASE		0x8206 </span><span class="cm">/* color-depth dependent value */</span><span class="cp"></span>
<span class="cp">#define SRC_Y			0x8208</span>
<span class="cp">#define SRC_X			0x820A</span>
<span class="cp">#define DST_Y			0x820C</span>
<span class="cp">#define DST_X			0x820E</span>
<span class="cp">#define DST_ADDR		0x8210</span>
<span class="cp">#define DST_PITCH		0x8214</span>
<span class="cp">#define DST_HEIGHT		0x8216</span>
<span class="cp">#define RECT_WIDTH		0x8218</span>
<span class="cp">#define RECT_HEIGHT		0x821A</span>
<span class="cp">#define PAT_FGCOLOR		0x821C</span>
<span class="cp">#define PAT_BGCOLOR		0x8220</span>
<span class="cp">#define SRC_FGCOLOR		0x8224</span>
<span class="cp">#define SRC_BGCOLOR		0x8228</span>
<span class="cp">#define MONO_MASK		0x822C</span>
<span class="cp">#define LEFT_CLIP		0x8234</span>
<span class="cp">#define TOP_CLIP		0x8236</span>
<span class="cp">#define RIGHT_CLIP		0x8238</span>
<span class="cp">#define BOTTOM_CLIP		0x823A</span>
<span class="cp">#define COMMAND_READY		0x823C</span>
<span class="cp">#define FIRE_TRIGGER      	0x8240</span>

<span class="cp">#define PATTERN_REG		0x8300  </span><span class="cm">/* 384 bytes pattern buffer */</span><span class="cp"></span>

<span class="cm">/* Transparent bitblit registers */</span>
<span class="cp">#define TRANS_DST_KEY_HIGH	PAT_FGCOLOR</span>
<span class="cp">#define TRANS_DST_KEY_LOW	PAT_BGCOLOR</span>
<span class="cp">#define TRANS_SRC_KEY_HIGH	SRC_FGCOLOR</span>
<span class="cp">#define TRANS_SRC_KEY_LOW	SRC_BGCOLOR</span>

<span class="cm">/* Store queue length in par */</span>
<span class="cp">#define CmdQueLen ivideo-&gt;cmdqueuelength</span>

<span class="cm">/* ------------- SiS 300 series -------------- */</span>

<span class="cm">/* BR(16) (0x8240):</span>

<span class="cm">   bit 31 2D engine: 1 is idle,</span>
<span class="cm">   bit 30 3D engine: 1 is idle,</span>
<span class="cm">   bit 29 Command queue: 1 is empty</span>
<span class="cm">   bits 28:24: Current CPU driven BitBlt buffer stage bit[4:0]</span>
<span class="cm">   bits 15:0:  Current command queue length</span>

<span class="cm">*/</span>

<span class="cp">#define SiS300Idle \</span>
<span class="cp">  { \</span>
<span class="cp">  	while((MMIO_IN16(ivideo-&gt;mmio_vbase, BR(16)+2) &amp; 0xE000) != 0xE000){}; \</span>
<span class="cp">  	while((MMIO_IN16(ivideo-&gt;mmio_vbase, BR(16)+2) &amp; 0xE000) != 0xE000){}; \</span>
<span class="cp">  	while((MMIO_IN16(ivideo-&gt;mmio_vbase, BR(16)+2) &amp; 0xE000) != 0xE000){}; \</span>
<span class="cp">  	CmdQueLen = MMIO_IN16(ivideo-&gt;mmio_vbase, 0x8240); \</span>
<span class="cp">  }</span>
<span class="cm">/* (do three times, because 2D engine seems quite unsure about whether or not it&#39;s idle) */</span>

<span class="cp">#define SiS300SetupSRCBase(base) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(0), base);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupSRCPitch(pitch) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT16(ivideo-&gt;mmio_vbase, BR(1), pitch);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupSRCXY(x,y) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(2), (x)&lt;&lt;16 | (y) );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupDSTBase(base) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(4), base);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupDSTXY(x,y) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(3), (x)&lt;&lt;16 | (y) );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupDSTRect(x,y) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(5), (y)&lt;&lt;16 | (x) );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupDSTColorDepth(bpp) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT16(ivideo-&gt;mmio_vbase, BR(1)+2, bpp);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupRect(w,h) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(6), (h)&lt;&lt;16 | (w) );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupPATFG(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(7), color);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupPATBG(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(8), color);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupSRCFG(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(9), color);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupSRCBG(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(10), color);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cm">/* 0x8224 src colorkey high */</span>
<span class="cm">/* 0x8228 src colorkey low */</span>
<span class="cm">/* 0x821c dest colorkey high */</span>
<span class="cm">/* 0x8220 dest colorkey low */</span>
<span class="cp">#define SiS300SetupSRCTrans(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 1) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, 0x8224, color);\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, 0x8228, color);\</span>
<span class="cp">	CmdQueLen -= 2;</span>

<span class="cp">#define SiS300SetupDSTTrans(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 1) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, 0x821C, color); \</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, 0x8220, color); \</span>
<span class="cp">	CmdQueLen -= 2;</span>

<span class="cp">#define SiS300SetupMONOPAT(p0,p1) \</span>
<span class="cp">	if(CmdQueLen &lt;= 1) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(11), p0);\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(12), p1);\</span>
<span class="cp">	CmdQueLen -= 2;</span>

<span class="cp">#define SiS300SetupClipLT(left,top) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(13), ((left) &amp; 0xFFFF) | (top)&lt;&lt;16 );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS300SetupClipRB(right,bottom) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(14), ((right) &amp; 0xFFFF) | (bottom)&lt;&lt;16 );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cm">/* General */</span>
<span class="cp">#define SiS300SetupROP(rop) \</span>
<span class="cp">	ivideo-&gt;CommandReg = (rop) &lt;&lt; 8;</span>

<span class="cp">#define SiS300SetupCMDFlag(flags) \</span>
<span class="cp">	ivideo-&gt;CommandReg |= (flags);</span>

<span class="cp">#define SiS300DoCMD \</span>
<span class="cp">	if(CmdQueLen &lt;= 1) SiS300Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(15), ivideo-&gt;CommandReg); \</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, BR(16), 0);\</span>
<span class="cp">	CmdQueLen -= 2;</span>

<span class="cm">/* -------------- SiS 315/330 series --------------- */</span>

<span class="cm">/* Q_STATUS:</span>
<span class="cm">   bit 31 = 1: All engines idle and all queues empty</span>
<span class="cm">   bit 30 = 1: Hardware Queue (=HW CQ, 2D queue, 3D queue) empty</span>
<span class="cm">   bit 29 = 1: 2D engine is idle</span>
<span class="cm">   bit 28 = 1: 3D engine is idle</span>
<span class="cm">   bit 27 = 1: HW command queue empty</span>
<span class="cm">   bit 26 = 1: 2D queue empty</span>
<span class="cm">   bit 25 = 1: 3D queue empty</span>
<span class="cm">   bit 24 = 1: SW command queue empty</span>
<span class="cm">   bits 23:16: 2D counter 3</span>
<span class="cm">   bits 15:8:  2D counter 2</span>
<span class="cm">   bits 7:0:   2D counter 1</span>
<span class="cm">*/</span>

<span class="cp">#define SiS310Idle \</span>
<span class="cp">  { \</span>
<span class="cp">  	while( (MMIO_IN16(ivideo-&gt;mmio_vbase, Q_STATUS+2) &amp; 0x8000) != 0x8000){}; \</span>
<span class="cp">  	while( (MMIO_IN16(ivideo-&gt;mmio_vbase, Q_STATUS+2) &amp; 0x8000) != 0x8000){}; \</span>
<span class="cp">	while( (MMIO_IN16(ivideo-&gt;mmio_vbase, Q_STATUS+2) &amp; 0x8000) != 0x8000){}; \</span>
<span class="cp">  	while( (MMIO_IN16(ivideo-&gt;mmio_vbase, Q_STATUS+2) &amp; 0x8000) != 0x8000){}; \</span>
<span class="cp">  	CmdQueLen = 0; \</span>
<span class="cp">  }</span>

<span class="cp">#define SiS310SetupSRCBase(base) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, SRC_ADDR, base);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupSRCPitch(pitch) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT16(ivideo-&gt;mmio_vbase, SRC_PITCH, pitch);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupSRCXY(x,y) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, SRC_Y, (x)&lt;&lt;16 | (y) );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupDSTBase(base) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, DST_ADDR, base);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupDSTXY(x,y) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, DST_Y, (x)&lt;&lt;16 | (y) );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupDSTRect(x,y) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, DST_PITCH, (y)&lt;&lt;16 | (x) );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupDSTColorDepth(bpp) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT16(ivideo-&gt;mmio_vbase, AGP_BASE, bpp);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupRect(w,h) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, RECT_WIDTH, (h)&lt;&lt;16 | (w) );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupPATFG(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, PAT_FGCOLOR, color);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupPATBG(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, PAT_BGCOLOR, color);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupSRCFG(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, SRC_FGCOLOR, color);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupSRCBG(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, SRC_BGCOLOR, color);\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupSRCTrans(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 1) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, TRANS_SRC_KEY_HIGH, color);\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, TRANS_SRC_KEY_LOW, color);\</span>
<span class="cp">	CmdQueLen -= 2;</span>

<span class="cp">#define SiS310SetupDSTTrans(color) \</span>
<span class="cp">	if(CmdQueLen &lt;= 1) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, TRANS_DST_KEY_HIGH, color); \</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, TRANS_DST_KEY_LOW, color); \</span>
<span class="cp">	CmdQueLen -= 2;</span>

<span class="cp">#define SiS310SetupMONOPAT(p0,p1) \</span>
<span class="cp">	if(CmdQueLen &lt;= 1) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, MONO_MASK, p0);\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, MONO_MASK+4, p1);\</span>
<span class="cp">	CmdQueLen -= 2;</span>

<span class="cp">#define SiS310SetupClipLT(left,top) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, LEFT_CLIP, ((left) &amp; 0xFFFF) | (top)&lt;&lt;16 );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupClipRB(right,bottom) \</span>
<span class="cp">	if(CmdQueLen &lt;= 0) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, RIGHT_CLIP, ((right) &amp; 0xFFFF) | (bottom)&lt;&lt;16 );\</span>
<span class="cp">	CmdQueLen--;</span>

<span class="cp">#define SiS310SetupROP(rop) \</span>
<span class="cp">	ivideo-&gt;CommandReg = (rop) &lt;&lt; 8;</span>

<span class="cp">#define SiS310SetupCMDFlag(flags) \</span>
<span class="cp">	ivideo-&gt;CommandReg |= (flags);</span>

<span class="cp">#define SiS310DoCMD \</span>
<span class="cp">	if(CmdQueLen &lt;= 1) SiS310Idle;\</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, COMMAND_READY, ivideo-&gt;CommandReg); \</span>
<span class="cp">	MMIO_OUT32(ivideo-&gt;mmio_vbase, FIRE_TRIGGER, 0); \</span>
<span class="cp">	CmdQueLen -= 2;</span>

<span class="kt">int</span>  <span class="n">sisfb_initaccel</span><span class="p">(</span><span class="k">struct</span> <span class="n">sis_video_info</span> <span class="o">*</span><span class="n">ivideo</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">sisfb_syncaccel</span><span class="p">(</span><span class="k">struct</span> <span class="n">sis_video_info</span> <span class="o">*</span><span class="n">ivideo</span><span class="p">);</span>

<span class="kt">int</span>  <span class="n">fbcon_sis_sync</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">fbcon_sis_fillrect</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_fillrect</span> <span class="o">*</span><span class="n">rect</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">fbcon_sis_copyarea</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_copyarea</span> <span class="o">*</span><span class="n">area</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
