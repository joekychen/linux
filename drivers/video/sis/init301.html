<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › video › sis › init301.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>init301.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* $XFree86$ */</span>
<span class="cm">/* $XdotOrg$ */</span>
<span class="cm">/*</span>
<span class="cm"> * Mode initializing code (CRT2 section)</span>
<span class="cm"> * for SiS 300/305/540/630/730,</span>
<span class="cm"> *     SiS 315/550/[M]650/651/[M]661[FGM]X/[M]74x[GX]/330/[M]76x[GX],</span>
<span class="cm"> *     XGI V3XT/V5/V8, Z7</span>
<span class="cm"> * (Universal module for Linux kernel framebuffer and X.org/XFree86 4.x)</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2001-2005 by Thomas Winischhofer, Vienna, Austria</span>
<span class="cm"> *</span>
<span class="cm"> * If distributed as part of the Linux kernel, the following license terms</span>
<span class="cm"> * apply:</span>
<span class="cm"> *</span>
<span class="cm"> * * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * * the Free Software Foundation; either version 2 of the named License,</span>
<span class="cm"> * * or any later version.</span>
<span class="cm"> * *</span>
<span class="cm"> * * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="cm"> * * GNU General Public License for more details.</span>
<span class="cm"> * *</span>
<span class="cm"> * * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * * along with this program; if not, write to the Free Software</span>
<span class="cm"> * * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA</span>
<span class="cm"> *</span>
<span class="cm"> * Otherwise, the following license terms apply:</span>
<span class="cm"> *</span>
<span class="cm"> * * Redistribution and use in source and binary forms, with or without</span>
<span class="cm"> * * modification, are permitted provided that the following conditions</span>
<span class="cm"> * * are met:</span>
<span class="cm"> * * 1) Redistributions of source code must retain the above copyright</span>
<span class="cm"> * *    notice, this list of conditions and the following disclaimer.</span>
<span class="cm"> * * 2) Redistributions in binary form must reproduce the above copyright</span>
<span class="cm"> * *    notice, this list of conditions and the following disclaimer in the</span>
<span class="cm"> * *    documentation and/or other materials provided with the distribution.</span>
<span class="cm"> * * 3) The name of the author may not be used to endorse or promote products</span>
<span class="cm"> * *    derived from this software without specific prior written permission.</span>
<span class="cm"> * *</span>
<span class="cm"> * * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS&#39;&#39; AND ANY EXPRESS OR</span>
<span class="cm"> * * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span>
<span class="cm"> * * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<span class="cm"> * * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<span class="cm"> * * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT</span>
<span class="cm"> * * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="cm"> * * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span class="cm"> * * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="cm"> * * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF</span>
<span class="cm"> * * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="cm"> *</span>
<span class="cm"> * Author: 	Thomas Winischhofer &lt;thomas@winischhofer.net&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Formerly based on non-functional code-fragements for 300 series by SiS, Inc.</span>
<span class="cm"> * Used by permission.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#if 1</span>
<span class="cp">#define SET_EMI		</span><span class="cm">/* 302LV/ELV: Set EMI values */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cp">#if 1</span>
<span class="cp">#define SET_PWD		</span><span class="cm">/* 301/302LV: Set PWD */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cp">#define COMPAL_HACK	</span><span class="cm">/* Needed for Compal 1400x1050 (EMI) */</span><span class="cp"></span>
<span class="cp">#define COMPAQ_HACK	</span><span class="cm">/* Needed for Inventec/Compaq 1280x1024 (EMI) */</span><span class="cp"></span>
<span class="cp">#define ASUS_HACK	</span><span class="cm">/* Needed for Asus A2H 1024x768 (EMI) */</span><span class="cp"></span>

<span class="cp">#include &quot;init301.h&quot;</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
<span class="cp">#include &quot;oem300.h&quot;</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="cp">#include &quot;oem310.h&quot;</span>
<span class="cp">#endif</span>

<span class="cp">#define SiS_I2CDELAY      1000</span>
<span class="cp">#define SiS_I2CDELAYSHORT  150</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">SiS_GetBIOSLCDResInfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span>		<span class="n">SiS_SetCH70xx</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">);</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*         HELPER: Lock/Unlock CRT2          */</span>
<span class="cm">/*********************************************/</span>

<span class="kt">void</span>
<span class="nf">SiS_UnLockCRT2</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">XGI_20</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span>
      <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2f</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
   <span class="k">else</span>
      <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="kt">void</span>
<span class="nf">SiS_LockCRT2</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">XGI_20</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span>
      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2F</span><span class="p">,</span><span class="mh">0xFE</span><span class="p">);</span>
   <span class="k">else</span>
      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="mh">0xFE</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*            HELPER: Write SR11             */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">DataAND</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">DataOR</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">DataAND</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
      <span class="n">DataOR</span>  <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x11</span><span class="p">,</span><span class="n">DataAND</span><span class="p">,</span><span class="n">DataOR</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*    HELPER: Get Pointer to LCD structure   */</span>
<span class="cm">/*********************************************/</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">GetLCDStructPtr661</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">myptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">romindex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="cm">/* Use the BIOS tables only for LVDS panels; TMDS is unreliable</span>
<span class="cm">    * due to the variaty of panels the BIOS doesn&#39;t know about.</span>
<span class="cm">    * Exception: If the BIOS has better knowledge (such as in case</span>
<span class="cm">    * of machines with a 301C and a panel that does not support DDC)</span>
<span class="cm">    * use the BIOS data as well.</span>
<span class="cm">    */</span>

   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelSelfDetected</span><span class="p">)))</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x3c</span><span class="p">;</span>
      <span class="k">else</span>                           <span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7d</span><span class="p">;</span>

      <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="n">reg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="o">*</span> <span class="mi">26</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="mi">26</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">myptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">SiS_LCDStruct661</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="n">romindex</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x100</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">romindex</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">romindex</span> <span class="o">+=</span> <span class="n">idx</span><span class="p">;</span>
         <span class="n">myptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romindex</span><span class="p">];</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="n">myptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">GetLCDStructPtr661_2</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">romptr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="cm">/* Use the BIOS tables only for LVDS panels; TMDS is unreliable</span>
<span class="cm">    * due to the variaty of panels the BIOS doesn&#39;t know about.</span>
<span class="cm">    * Exception: If the BIOS has better knowledge (such as in case</span>
<span class="cm">    * of machines with a 301C and a panel that does not support DDC)</span>
<span class="cm">    * use the BIOS data as well.</span>
<span class="cm">    */</span>

   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelSelfDetected</span><span class="p">)))</span> <span class="p">{</span>
      <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x102</span><span class="p">);</span>
      <span class="n">romptr</span> <span class="o">+=</span> <span class="p">((</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS661LCD2TableSize</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="n">romptr</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*           Adjust Rate for CRT2            */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_AdjustCRT2Rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RRTI</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">checkmask</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">modeid</span><span class="p">,</span> <span class="n">infoflag</span><span class="p">;</span>

   <span class="n">modeid</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RRTI</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">)].</span><span class="n">ModeID</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">)</span> <span class="p">{</span>

	 <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">SupportRAMDAC2</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">SupportRAMDAC2_135</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">SupportRAMDAC2_162</span><span class="p">;</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISRAMDAC202</span><span class="p">)</span> <span class="p">{</span>
		  <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">SupportRAMDAC2_202</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	 <span class="p">}</span>

      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>

	 <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">SupportLCD</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
	          <span class="k">if</span><span class="p">(</span><span class="n">modeid</span> <span class="o">==</span> <span class="mh">0x2e</span><span class="p">)</span> <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">Support64048060Hz</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	 <span class="p">}</span>

      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>

	 <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">SupportHiVision</span><span class="p">;</span>

      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToYPbPr525750</span><span class="o">|</span><span class="n">SetCRT2ToAVIDEO</span><span class="o">|</span><span class="n">SetCRT2ToSVIDEO</span><span class="o">|</span><span class="n">SetCRT2ToSCART</span><span class="p">))</span> <span class="p">{</span>

	 <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">SupportTV</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">SupportTV1024</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span> <span class="p">{</span>
	          <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">SupportYPbPr750p</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	 <span class="p">}</span>

      <span class="p">}</span>

   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>	<span class="cm">/* LVDS */</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">SupportCHTV</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">checkmask</span> <span class="o">|=</span> <span class="n">SupportLCD</span><span class="p">;</span>
      <span class="p">}</span>

   <span class="p">}</span>

   <span class="cm">/* Look backwards in table for matching CRT2 mode */</span>
   <span class="k">for</span><span class="p">(;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RRTI</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">)].</span><span class="n">ModeID</span> <span class="o">==</span> <span class="n">modeid</span><span class="p">;</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">infoflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RRTI</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">)].</span><span class="n">Ext_InfoFlag</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">infoflag</span> <span class="o">&amp;</span> <span class="n">checkmask</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
      <span class="k">if</span><span class="p">((</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="cm">/* Look through the whole mode-section of the table from the beginning</span>
<span class="cm">    * for a matching CRT2 mode if no mode was found yet.</span>
<span class="cm">    */</span>
   <span class="k">for</span><span class="p">((</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RRTI</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">)].</span><span class="n">ModeID</span> <span class="o">!=</span> <span class="n">modeid</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="n">infoflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RRTI</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="p">)].</span><span class="n">Ext_InfoFlag</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">infoflag</span> <span class="o">&amp;</span> <span class="n">checkmask</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*              Get rate index               */</span>
<span class="cm">/*********************************************/</span>

<span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_GetRatePtr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RRTI</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">backup_i</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">modeflag</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">backupindex</span><span class="p">;</span>
   <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">LCDRefreshIndex</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
		<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
		<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
		<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
   <span class="p">};</span>

   <span class="cm">/* Do NOT check for UseCustomMode here, will skrew up FIFO */</span>
   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0xfe</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;</span> <span class="mh">0x14</span><span class="p">)</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>

   <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x33</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SelectCRT2Rate</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
   <span class="n">backupindex</span> <span class="o">=</span> <span class="n">index</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">index</span><span class="o">--</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">ProgrammingCRT2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span>		 <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="n">backupindex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	 <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">))</span> <span class="p">{</span>
	       <span class="n">temp</span> <span class="o">=</span> <span class="n">LCDRefreshIndex</span><span class="p">[</span><span class="n">SiS_GetBIOSLCDResInfo</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)];</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="n">RRTI</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">REFindex</span><span class="p">;</span>
   <span class="n">ModeNo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RRTI</span><span class="p">].</span><span class="n">ModeID</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DriverMode</span><span class="p">))</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_VESAID</span> <span class="o">==</span> <span class="mh">0x105</span><span class="p">)</span> <span class="o">||</span>
	     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_VESAID</span> <span class="o">==</span> <span class="mh">0x107</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">backupindex</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="n">RRTI</span><span class="o">++</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">do</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RRTI</span> <span class="o">+</span> <span class="n">i</span><span class="p">].</span><span class="n">ModeID</span> <span class="o">!=</span> <span class="n">ModeNo</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RRTI</span> <span class="o">+</span> <span class="n">i</span><span class="p">].</span><span class="n">Ext_InfoFlag</span><span class="p">;</span>
      <span class="n">temp</span> <span class="o">&amp;=</span> <span class="n">ModeTypeMask</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&lt;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="n">i</span><span class="o">++</span><span class="p">;</span>
      <span class="n">index</span><span class="o">--</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="n">index</span> <span class="o">!=</span> <span class="mh">0xFFFF</span><span class="p">);</span>

   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RRTI</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">Ext_InfoFlag</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">InterlaceMode</span><span class="p">)</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="n">i</span><span class="o">--</span><span class="p">;</span>

   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">ProgrammingCRT2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)))</span> <span class="p">{</span>
      <span class="n">backup_i</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_AdjustCRT2Rate</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RRTI</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">)))</span> <span class="p">{</span>
	 <span class="n">i</span> <span class="o">=</span> <span class="n">backup_i</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="p">(</span><span class="n">RRTI</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*            STORE CRT2 INFO in CR34        */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SaveCRT2Info</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">;</span>

   <span class="cm">/* Store CRT1 ModeNo in CR34 */</span>
   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x34</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">);</span>
   <span class="n">temp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
   <span class="n">temp2</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">SetInSlaveMode</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">,</span><span class="n">temp2</span><span class="p">,</span><span class="n">temp1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*    HELPER: GET SOME DATA FROM BIOS ROM    */</span>
<span class="cm">/*********************************************/</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_CR36BIOSWord23b</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">,</span><span class="n">temp1</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">((</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x233</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x12</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x234</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x34</span><span class="p">))</span> <span class="p">{</span>
	 <span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">);</span>
	 <span class="n">temp1</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x23b</span><span class="p">);</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="n">temp</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_CR36BIOSWord23d</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">,</span><span class="n">temp1</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">((</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x233</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x12</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x234</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x34</span><span class="p">))</span> <span class="p">{</span>
	 <span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">);</span>
	 <span class="n">temp1</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x23d</span><span class="p">);</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="n">temp</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*          HELPER: DELAY FUNCTIONS          */</span>
<span class="cm">/*********************************************/</span>

<span class="kt">void</span>
<span class="nf">SiS_DDC2Delay</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">delaytime</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">delaytime</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_GenericDelay</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">delay</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">delay</span> <span class="o">*</span> <span class="mi">36</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_LongDelay</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">delay</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">while</span><span class="p">(</span><span class="n">delay</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">6623</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_ShortDelay</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">delay</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">while</span><span class="p">(</span><span class="n">delay</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">66</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_PanelDelay</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">DelayTime</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">PanelID</span><span class="p">,</span> <span class="n">DelayIndex</span><span class="p">,</span> <span class="n">Delay</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="cp">#endif</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>

      <span class="n">PanelID</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301</span><span class="p">)</span> <span class="n">PanelID</span> <span class="o">&amp;=</span> <span class="mh">0xf7</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">))</span> <span class="n">PanelID</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">DelayIndex</span> <span class="o">=</span> <span class="n">PanelID</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
      <span class="k">if</span><span class="p">((</span><span class="n">DelayTime</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">PanelID</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>  <span class="p">{</span>
	 <span class="n">Delay</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">DelayTime</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="n">DelayTime</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">DelayTime</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="p">{</span>
	    <span class="n">Delay</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelDelayTbl</span><span class="p">[</span><span class="n">DelayIndex</span><span class="p">].</span><span class="n">timer</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="n">Delay</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelDelayTbl</span><span class="p">[</span><span class="n">DelayIndex</span><span class="p">].</span><span class="n">timer</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	 <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x220</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">DelayTime</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="n">Delay</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x225</span><span class="p">];</span>
	       <span class="k">else</span> 	    	       <span class="n">Delay</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x226</span><span class="p">];</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">SiS_ShortDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">Delay</span><span class="p">);</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_300 */</span><span class="cp"></span>

   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>

      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span>    <span class="o">||</span>
	 <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;=</span> <span class="n">SIS_315PRO</span><span class="p">)</span> <span class="o">||</span>
	 <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_330</span><span class="p">)</span>    <span class="o">||</span>
	 <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">))</span> <span class="p">{</span>

	 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">DelayTime</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="p">{</span>
	    <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">);</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">);</span>
	 <span class="p">}</span>

      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="cm">/* ||</span>
<span class="cm">	 (SiS_Pr-&gt;SiS_CustomT == CUT_COMPAQ1280) ||</span>
<span class="cm">	 (SiS_Pr-&gt;SiS_CustomT == CUT_CLEVO1400) */</span> <span class="p">)</span> <span class="p">{</span>			<span class="cm">/* 315 series, LVDS; Special */</span>

	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">PanelID</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">);</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_CLEVO1400</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">))</span> <span class="n">PanelID</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_COMPAQ1280</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">DelayIndex</span> <span class="o">=</span> <span class="n">PanelID</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	       <span class="n">DelayIndex</span> <span class="o">=</span> <span class="n">PanelID</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="k">if</span><span class="p">((</span><span class="n">DelayTime</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">PanelID</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>  <span class="p">{</span>
	       <span class="n">Delay</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">DelayTime</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="n">DelayTime</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
	       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">DelayTime</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="p">{</span>
		  <span class="n">Delay</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelDelayTblLVDS</span><span class="p">[</span><span class="n">DelayIndex</span><span class="p">].</span><span class="n">timer</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		  <span class="n">Delay</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelDelayTblLVDS</span><span class="p">[</span><span class="n">DelayIndex</span><span class="p">].</span><span class="n">timer</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	       <span class="p">}</span>
	       <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)))</span> <span class="p">{</span>
		  <span class="k">if</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x13c</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">)</span> <span class="p">{</span>
		     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">DelayTime</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">Delay</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x17e</span><span class="p">];</span>
		     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">Delay</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x17f</span><span class="p">];</span>
		     <span class="p">}</span>
		  <span class="p">}</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	    <span class="n">SiS_ShortDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">Delay</span><span class="p">);</span>
	 <span class="p">}</span>

      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>			<span class="cm">/* 315 series, all bridges */</span>

	 <span class="n">DelayIndex</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">DelayTime</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="p">{</span>
	    <span class="n">Delay</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelDelayTbl</span><span class="p">[</span><span class="n">DelayIndex</span><span class="p">].</span><span class="n">timer</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="n">Delay</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelDelayTbl</span><span class="p">[</span><span class="n">DelayIndex</span><span class="p">].</span><span class="n">timer</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	 <span class="p">}</span>
	 <span class="n">Delay</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
	 <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">Delay</span><span class="p">);</span>

      <span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>

   <span class="p">}</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_PanelDelayLoop</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">DelayTime</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">DelayLoop</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
   <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">DelayLoop</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">DelayTime</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*    HELPER: WAIT-FOR-RETRACE FUNCTIONS     */</span>
<span class="cm">/*********************************************/</span>

<span class="kt">void</span>
<span class="nf">SiS_WaitRetrace1</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">watchdog</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xc0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x17</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

   <span class="n">watchdog</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">;</span>
   <span class="k">while</span><span class="p">((</span><span class="n">SiS_GetRegByte</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3da</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">--</span><span class="n">watchdog</span><span class="p">);</span>
   <span class="n">watchdog</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">;</span>
   <span class="k">while</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetRegByte</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3da</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">--</span><span class="n">watchdog</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_WaitRetrace2</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">watchdog</span><span class="p">;</span>

   <span class="n">watchdog</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">;</span>
   <span class="k">while</span><span class="p">((</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="n">reg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">--</span><span class="n">watchdog</span><span class="p">);</span>
   <span class="n">watchdog</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">;</span>
   <span class="k">while</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="n">reg</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">--</span><span class="n">watchdog</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_WaitVBRetrace</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">))</span> <span class="p">{</span>
	 <span class="n">SiS_WaitRetrace1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="n">SiS_WaitRetrace2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">);</span>
      <span class="p">}</span>
<span class="cp">#endif</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">))</span> <span class="p">{</span>
	 <span class="n">SiS_WaitRetrace1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="n">SiS_WaitRetrace2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">);</span>
      <span class="p">}</span>
<span class="cp">#endif</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_VBWait</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempal</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">;</span>

   <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tempal</span> <span class="o">=</span> <span class="n">SiS_GetRegByte</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3da</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">tempal</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">))</span>  <span class="k">continue</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tempal</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
     <span class="p">}</span>
     <span class="n">temp</span> <span class="o">^=</span> <span class="mh">0x01</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_VBLongWait</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_VBWait</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">SiS_WaitRetrace1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*               HELPER: MISC                */</span>
<span class="cm">/*********************************************/</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_Is301B</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mh">0xb0</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_CRT2IsLCD</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_730</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">bool</span>
<span class="nf">SiS_IsDualEdge</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">!=</span> <span class="n">SIS_650</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x5f</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">))</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">EnableDualEdge</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="cp">#endif</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">bool</span>
<span class="nf">SiS_IsVAMode</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">flag</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">);</span>
      <span class="k">if</span><span class="p">((</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">EnableDualEdge</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">SetToLCDA</span><span class="p">))</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
<span class="cp">#endif</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_IsVAorLCD</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span>  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_IsDualLink</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">((</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="o">||</span>
         <span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDDualLink</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="cp">#endif</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_TVEnabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">((</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0x0c</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISYPBPR</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x4d</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_LCDAEnabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_WeHaveBacklightCtrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_661</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x79</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_IsNotM650orLater</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">flag</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_650</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x5f</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">;</span>
      <span class="cm">/* Check for revision != A0 only */</span>
      <span class="k">if</span><span class="p">((</span><span class="n">flag</span> <span class="o">==</span> <span class="mh">0xe0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">flag</span> <span class="o">==</span> <span class="mh">0xc0</span><span class="p">)</span> <span class="o">||</span>
         <span class="p">(</span><span class="n">flag</span> <span class="o">==</span> <span class="mh">0xb0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">flag</span> <span class="o">==</span> <span class="mh">0x90</span><span class="p">))</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
   <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_IsYPbPr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* YPrPb = 0x08 */</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">EnableCHYPbPr</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_IsChScart</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/* Scart = 0x04 */</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">EnableCHScart</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_IsTVOrYPbPrOrScart</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">flag</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x30</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span>        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">EnableCHYPbPr</span><span class="p">)</span>      <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>  <span class="cm">/* = YPrPb = 0x08 */</span>
      <span class="k">if</span><span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">EnableCHScart</span><span class="p">)</span>      <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>  <span class="cm">/* = Scart = 0x04 - TW */</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x30</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span>        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_IsLCDOrLCDA</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">flag</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x30</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">SetToLCDA</span><span class="p">)</span>    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x30</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_HaveBridge</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">flag</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
      <span class="k">if</span><span class="p">((</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_BridgeIsEnabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">flag</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_HaveBridge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">flag</span> <span class="o">&amp;=</span> <span class="mh">0xa0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">((</span><span class="n">flag</span> <span class="o">==</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">flag</span> <span class="o">==</span> <span class="mh">0x20</span><span class="p">))</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="n">flag</span> <span class="o">&amp;=</span> <span class="mh">0x50</span><span class="p">;</span>
	<span class="k">if</span><span class="p">((</span><span class="n">flag</span> <span class="o">==</span> <span class="mh">0x40</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">flag</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">))</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_BridgeInSlavemode</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">flag1</span><span class="p">;</span>

   <span class="n">flag1</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="n">flag1</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetInSlaveMode</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*       GET VIDEO BRIDGE CONFIG INFO        */</span>
<span class="cm">/*********************************************/</span>

<span class="cm">/* Setup general purpose IO for Chrontel communication */</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
<span class="kt">void</span>
<span class="nf">SiS_SetChrontelGPIO</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">myvbinfo</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">acpibase</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ChSW</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

   <span class="n">acpibase</span> <span class="o">=</span> <span class="n">sisfb_read_lpc_pci_dword</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">);</span>
   <span class="n">acpibase</span> <span class="o">&amp;=</span> <span class="mh">0xFFFF</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">acpibase</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetRegShort</span><span class="p">((</span><span class="n">acpibase</span> <span class="o">+</span> <span class="mh">0x3c</span><span class="p">));</span>	<span class="cm">/* ACPI register 0x3c: GP Event 1 I/O mode select */</span>
   <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0xFEFF</span><span class="p">;</span>
   <span class="n">SiS_SetRegShort</span><span class="p">((</span><span class="n">acpibase</span> <span class="o">+</span> <span class="mh">0x3c</span><span class="p">),</span> <span class="n">temp</span><span class="p">);</span>
   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetRegShort</span><span class="p">((</span><span class="n">acpibase</span> <span class="o">+</span> <span class="mh">0x3c</span><span class="p">));</span>
   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetRegShort</span><span class="p">((</span><span class="n">acpibase</span> <span class="o">+</span> <span class="mh">0x3a</span><span class="p">));</span>	<span class="cm">/* ACPI register 0x3a: GP Pin Level (low/high) */</span>
   <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0xFEFF</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">myvbinfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x0100</span><span class="p">;</span>
   <span class="n">SiS_SetRegShort</span><span class="p">((</span><span class="n">acpibase</span> <span class="o">+</span> <span class="mh">0x3a</span><span class="p">),</span> <span class="n">temp</span><span class="p">);</span>
   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetRegShort</span><span class="p">((</span><span class="n">acpibase</span> <span class="o">+</span> <span class="mh">0x3a</span><span class="p">));</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="kt">void</span>
<span class="nf">SiS_GetVBInfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="kt">int</span> <span class="n">checkcrt2mode</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempax</span><span class="p">,</span> <span class="n">tempbx</span><span class="p">,</span> <span class="n">temp</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">resinfo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_GetModeFlag</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>

   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">=</span> <span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">ModeTypeMask</span><span class="p">;</span>

   <span class="k">if</span><span class="p">((</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_HaveBridge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x30</span><span class="p">);</span>
	<span class="n">tempbx</span> <span class="o">|=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">tempax</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="n">DriverMode</span> <span class="o">|</span> <span class="n">LoadDACFlag</span> <span class="o">|</span> <span class="n">SetNotSimuMode</span> <span class="o">|</span> <span class="n">SetPALTV</span><span class="p">);</span>
	<span class="n">tempbx</span> <span class="o">|=</span> <span class="n">tempax</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLCDA</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">)</span> <span class="p">{</span>
		 <span class="cm">/* Mode 0x03 is never in driver mode */</span>
		 <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">,</span><span class="mh">0xbf</span><span class="p">);</span>
	      <span class="p">}</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">DriverMode</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)))</span> <span class="p">{</span>
		 <span class="cm">/* Reset LCDA setting if not driver mode */</span>
		 <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">,</span><span class="mh">0xfc</span><span class="p">);</span>
	      <span class="p">}</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS650</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseLCDA</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x5f</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">)</span> <span class="p">{</span>
		       <span class="k">if</span><span class="p">((</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">DriverMode</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))))</span> <span class="p">{</span>
			  <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">,(</span><span class="n">EnableDualEdge</span> <span class="o">|</span> <span class="n">SetToLCDA</span><span class="p">));</span>
		       <span class="p">}</span>
		    <span class="p">}</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	      <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">);</span>
	      <span class="k">if</span><span class="p">((</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">EnableDualEdge</span> <span class="o">|</span> <span class="n">SetToLCDA</span><span class="p">))</span> <span class="o">==</span> <span class="p">(</span><span class="n">EnableDualEdge</span> <span class="o">|</span> <span class="n">SetToLCDA</span><span class="p">))</span> <span class="p">{</span>
		 <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">SetCRT2ToLCDA</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* New CR layout */</span>
	      <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">SetCRT2ToYPbPr525750</span> <span class="o">|</span> <span class="n">SetCRT2ToHiVision</span><span class="p">);</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x35</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xe0</span><span class="p">;</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mh">0x60</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">SetCRT2ToHiVision</span><span class="p">;</span>
		 <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISYPBPR</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">;</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">);</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">SetToLCDA</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">SetCRT2ToLCDA</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">EnableCHYPbPr</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">SetCRT2ToCHYPbPr</span><span class="p">;</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVGA2</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">SetCRT2ToRAMDAC</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">SetCRT2ToSVIDEO</span>   <span class="o">|</span>
		  <span class="n">SetCRT2ToAVIDEO</span>   <span class="o">|</span>
		  <span class="n">SetCRT2ToSCART</span>    <span class="o">|</span>
		  <span class="n">SetCRT2ToLCDA</span>     <span class="o">|</span>
		  <span class="n">SetCRT2ToLCD</span>      <span class="o">|</span>
		  <span class="n">SetCRT2ToRAMDAC</span>   <span class="o">|</span>
		  <span class="n">SetCRT2ToHiVision</span> <span class="o">|</span>
		  <span class="n">SetCRT2ToYPbPr525750</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">temp</span> <span class="o">=</span> <span class="n">SetCRT2ToAVIDEO</span> <span class="o">|</span>
		        <span class="n">SetCRT2ToSVIDEO</span> <span class="o">|</span>
		        <span class="n">SetCRT2ToSCART</span>  <span class="o">|</span>
		        <span class="n">SetCRT2ToLCDA</span>   <span class="o">|</span>
		        <span class="n">SetCRT2ToLCD</span>    <span class="o">|</span>
		        <span class="n">SetCRT2ToCHYPbPr</span><span class="p">;</span>
	      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		 <span class="n">temp</span> <span class="o">=</span> <span class="n">SetCRT2ToLCDA</span>   <span class="o">|</span>
		        <span class="n">SetCRT2ToLCD</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">temp</span> <span class="o">=</span> <span class="n">SetCRT2ToTV</span> <span class="o">|</span> <span class="n">SetCRT2ToLCD</span><span class="p">;</span>
	      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		 <span class="n">temp</span> <span class="o">=</span> <span class="n">SetCRT2ToLCD</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">temp</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">tempax</span> <span class="o">=</span> <span class="n">DisableCRT2Display</span><span class="p">;</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

	   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">clearmask</span> <span class="o">=</span> <span class="p">(</span> <span class="n">DriverMode</span> <span class="o">|</span>
				<span class="n">DisableCRT2Display</span> <span class="o">|</span>
				<span class="n">LoadDACFlag</span> 	   <span class="o">|</span>
				<span class="n">SetNotSimuMode</span> 	   <span class="o">|</span>
				<span class="n">SetInSlaveMode</span> 	   <span class="o">|</span>
				<span class="n">SetPALTV</span> 	   <span class="o">|</span>
				<span class="n">SwitchCRT2</span>	   <span class="o">|</span>
				<span class="n">SetSimuScanMode</span> <span class="p">);</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span>        <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="n">clearmask</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">);</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">)</span>      <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="n">clearmask</span> <span class="o">|</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">);</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span>         <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="n">clearmask</span> <span class="o">|</span> <span class="n">SetCRT2ToLCD</span><span class="p">);</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToSCART</span><span class="p">)</span>       <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="n">clearmask</span> <span class="o">|</span> <span class="n">SetCRT2ToSCART</span><span class="p">);</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span>    <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="n">clearmask</span> <span class="o">|</span> <span class="n">SetCRT2ToHiVision</span><span class="p">);</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="n">clearmask</span> <span class="o">|</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">);</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="mh">0xFF00</span><span class="o">|</span><span class="n">SwitchCRT2</span><span class="o">|</span><span class="n">SetSimuScanMode</span><span class="p">);</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="mh">0xFF00</span><span class="o">|</span><span class="n">SetCRT2ToTV</span><span class="o">|</span><span class="n">SwitchCRT2</span><span class="o">|</span><span class="n">SetSimuScanMode</span><span class="p">);</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="mh">0xFF00</span><span class="o">|</span><span class="n">SetCRT2ToLCD</span><span class="o">|</span><span class="n">SwitchCRT2</span><span class="o">|</span><span class="n">SetSimuScanMode</span><span class="p">);</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
	         <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">SetCRT2ToLCD</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>

	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">tempax</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SwitchCRT2</span> <span class="o">|</span> <span class="n">SetSimuScanMode</span><span class="p">)))</span> <span class="p">{</span>
	      <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SetSimuScanMode</span> <span class="o">|</span> <span class="n">DisableCRT2Display</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">DriverMode</span><span class="p">))</span> <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">SetSimuScanMode</span><span class="p">;</span>

	<span class="cm">/* LVDS/CHRONTEL (LCD/TV) and 301BDH (LCD) can only be slave in 8bpp modes */</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&lt;=</span> <span class="n">ModeVGA</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span>
	       <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
	      <span class="n">modeflag</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">CRT2Mode</span><span class="p">);</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetSimuScanMode</span><span class="p">))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SwitchCRT2</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">CRT2Mode</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">checkcrt2mode</span><span class="p">))</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">!=</span> <span class="n">SIS_RI_1600x1200</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">SetSimuScanMode</span><span class="p">;</span>
		 <span class="p">}</span>
              <span class="p">}</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_BridgeIsEnabled</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">DriverMode</span><span class="p">))</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">SiS_BridgeInSlavemode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
		       <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">SetSimuScanMode</span><span class="p">;</span>
		    <span class="p">}</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">DriverMode</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="n">SetSimuScanMode</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">CRT2Mode</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">checkcrt2mode</span><span class="p">))</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">!=</span> <span class="n">SIS_RI_1600x1200</span><span class="p">)</span> <span class="p">{</span>
		       <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">SetInSlaveMode</span><span class="p">;</span>
		    <span class="p">}</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">SetInSlaveMode</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>

   <span class="p">}</span>

   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_630</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_SetChrontelGPIO</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span><span class="p">);</span>
   <span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">   printk(KERN_DEBUG &quot;sisfb: (init301: VBInfo= 0x%04x, SetFlag=0x%04x)\n&quot;,</span>
<span class="c">      SiS_Pr-&gt;SiS_VBInfo, SiS_Pr-&gt;SiS_SetFlag);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*           DETERMINE YPbPr MODE            */</span>
<span class="cm">/*********************************************/</span>

<span class="kt">void</span>
<span class="nf">SiS_SetYPbPr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>

   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">temp</span><span class="p">;</span>

   <span class="cm">/* Note: This variable is only used on 30xLV systems.</span>
<span class="cm">    * CR38 has a different meaning on LVDS/CH7019 systems.</span>
<span class="cm">    * On 661 and later, these bits moved to CR35.</span>
<span class="cm">    *</span>
<span class="cm">    * On 301, 301B, only HiVision 1080i is supported.</span>
<span class="cm">    * On 30xLV, 301C, only YPbPr 1080i is supported.</span>
<span class="cm">    */</span>

   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_YPbPr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_YPbPr</span> <span class="o">=</span> <span class="n">YPbPrHiVision</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISYPBPR</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">);</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">switch</span><span class="p">((</span><span class="n">temp</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">case</span> <span class="mh">0x00</span>: <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_YPbPr</span> <span class="o">=</span> <span class="n">YPbPr525i</span><span class="p">;</span>     <span class="k">break</span><span class="p">;</span>
	    <span class="k">case</span> <span class="mh">0x01</span>: <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_YPbPr</span> <span class="o">=</span> <span class="n">YPbPr525p</span><span class="p">;</span>     <span class="k">break</span><span class="p">;</span>
	    <span class="k">case</span> <span class="mh">0x02</span>: <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_YPbPr</span> <span class="o">=</span> <span class="n">YPbPr750p</span><span class="p">;</span>     <span class="k">break</span><span class="p">;</span>
	    <span class="k">case</span> <span class="mh">0x03</span>: <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_YPbPr</span> <span class="o">=</span> <span class="n">YPbPrHiVision</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>

<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*           DETERMINE TVMode flag           */</span>
<span class="cm">/*********************************************/</span>

<span class="kt">void</span>
<span class="nf">SiS_SetTVMode</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">resinfo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">romindex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">OutputSelect</span> <span class="o">=</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">pSiS_OutputSelect</span><span class="p">;</span>

   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetPALTV</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetPAL</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_630</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_730</span><span class="p">))</span> <span class="p">{</span>
	    <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x35</span><span class="p">;</span>
	    <span class="n">romindex</span> <span class="o">=</span> <span class="mh">0xfe</span><span class="p">;</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x38</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">XGI_20</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">romindex</span> <span class="o">=</span> <span class="mh">0xf3</span><span class="p">;</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_330</span><span class="p">)</span> <span class="n">romindex</span> <span class="o">=</span> <span class="mh">0x11b</span><span class="p">;</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">romindex</span> <span class="o">&amp;&amp;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)))</span> <span class="p">{</span>
	       <span class="n">OutputSelect</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romindex</span><span class="p">];</span>
	       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">OutputSelect</span> <span class="o">&amp;</span> <span class="n">EnablePALMN</span><span class="p">))</span> <span class="p">{</span>
		  <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="mh">0x3F</span><span class="p">);</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	    <span class="n">temp1</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="n">EnablePALM</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* 0x40 */</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetPALM</span><span class="p">;</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">TVSetPAL</span><span class="p">;</span>
	       <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="n">EnablePALN</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* 0x80 */</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetPALN</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="n">EnableNTSCJ</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* 0x40 */</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetNTSCJ</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
	 <span class="cm">/* Translate HiVision/YPbPr to our new flags */</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_YPbPr</span> <span class="o">==</span> <span class="n">YPbPr750p</span><span class="p">)</span>          <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetYPbPr750p</span><span class="p">;</span>
	    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_YPbPr</span> <span class="o">==</span> <span class="n">YPbPr525p</span><span class="p">)</span>     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetYPbPr525p</span><span class="p">;</span>
	    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_YPbPr</span> <span class="o">==</span> <span class="n">YPbPrHiVision</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetHiVision</span><span class="p">;</span>
	    <span class="k">else</span>				        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetYPbPr525i</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetYPbPr750p</span> <span class="o">|</span> <span class="n">TVSetYPbPr525p</span> <span class="o">|</span> <span class="n">TVSetYPbPr525i</span><span class="p">))</span> <span class="p">{</span>
	       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SetCRT2ToHiVision</span><span class="p">;</span>
	       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">|=</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetHiVision</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetPAL</span><span class="p">;</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHOverScan</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x35</span><span class="p">);</span>
	       <span class="k">if</span><span class="p">((</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">TVOverScan</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHOverScan</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetCHOverScan</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x79</span><span class="p">);</span>
	       <span class="k">if</span><span class="p">((</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHOverScan</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetCHOverScan</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHSOverScan</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetCHOverScan</span><span class="p">;</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x38</span><span class="p">);</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">EnablePALM</span><span class="p">)</span>      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetPALM</span><span class="p">;</span>
	       <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">EnablePALN</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetPALN</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">EnableNTSCJ</span><span class="p">)</span> <span class="p">{</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetNTSCJ</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span>

   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="cm">/* 661 and later */</span>

      <span class="n">temp1</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x35</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetPAL</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetPALN</span><span class="p">;</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">TVSetPAL</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetPALM</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetNTSCJ</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHOverScan</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">((</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHOverScan</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
	       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetCHOverScan</span><span class="p">;</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">temp1</span> <span class="o">&amp;=</span> <span class="mh">0xe0</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span>      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetYPbPr525i</span><span class="p">;</span>
	    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">==</span> <span class="mh">0x20</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetYPbPr525p</span><span class="p">;</span>
	    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">==</span> <span class="mh">0x40</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetYPbPr750p</span><span class="p">;</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="p">(</span><span class="n">TVSetHiVision</span> <span class="o">|</span> <span class="n">TVSetPAL</span><span class="p">);</span>
	 <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToYPbPr525750</span> <span class="o">|</span> <span class="n">SetCRT2ToHiVision</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_800x480</span> <span class="o">||</span> <span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1024x576</span> <span class="o">||</span> <span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1280x720</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVAspect169</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	       <span class="n">temp1</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x39</span><span class="p">);</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span> <span class="p">{</span>
		  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetYPbPr750p</span> <span class="o">|</span> <span class="n">TVSetHiVision</span><span class="p">))</span> <span class="p">{</span>
		     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVAspect169</span><span class="p">;</span>
		  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVAspect43LB</span><span class="p">;</span>
		  <span class="p">}</span>
	       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVAspect43</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToSCART</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetPAL</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetPAL</span><span class="p">;</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">TVSetPALM</span> <span class="o">|</span> <span class="n">TVSetPALN</span> <span class="o">|</span> <span class="n">TVSetNTSCJ</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetYPbPr525i</span> <span class="o">|</span> <span class="n">TVSetYPbPr525p</span> <span class="o">|</span> <span class="n">TVSetYPbPr750p</span><span class="p">))</span> <span class="p">{</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">TVSetPAL</span> <span class="o">|</span> <span class="n">TVSetNTSCJ</span> <span class="o">|</span> <span class="n">TVSetPALM</span> <span class="o">|</span> <span class="n">TVSetPALN</span><span class="p">);</span>
	 <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetNotSimuMode</span><span class="p">))</span> <span class="p">{</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetTVSimuMode</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">))</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1024x768</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSet525p1024</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetHiVision</span> <span class="o">|</span> <span class="n">TVSetYPbPr750p</span><span class="p">)))</span> <span class="p">{</span>
	       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetNTSC1024</span><span class="p">;</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span>

      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVRPLLDIV2XO</span><span class="p">;</span>
      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	 <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="p">{</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">TVRPLLDIV2XO</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetYPbPr525p</span> <span class="o">|</span> <span class="n">TVSetYPbPr750p</span><span class="p">))</span> <span class="p">{</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">TVRPLLDIV2XO</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">))</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">TVRPLLDIV2XO</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span>

   <span class="p">}</span>

   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SetPALTV</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*               GET LCD INFO                */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_GetBIOSLCDResInfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">;</span>
   <span class="cm">/* Translate my LCDResInfo to BIOS value */</span>
   <span class="k">switch</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">case</span> <span class="n">Panel_1280x768_2</span>: <span class="n">temp</span> <span class="o">=</span> <span class="n">Panel_1280x768</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
   <span class="k">case</span> <span class="n">Panel_1280x800_2</span>: <span class="n">temp</span> <span class="o">=</span> <span class="n">Panel_1280x800</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
   <span class="k">case</span> <span class="n">Panel_1280x854</span>:   <span class="n">temp</span> <span class="o">=</span> <span class="n">Panel661_1280x854</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_GetLCDInfoBIOS</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

   <span class="k">if</span><span class="p">((</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">GetLCDStructPtr661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">((</span><span class="n">temp</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NeedRomModeData</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>  <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">((</span><span class="n">temp</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NeedRomModeData</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>  <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mi">14</span><span class="p">);</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK_CUSTOM_315</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VCLKData</span><span class="p">[</span><span class="n">VCLK_CUSTOM_315</span><span class="p">].</span><span class="n">CLOCK</span> <span class="o">=</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBVCLKData</span><span class="p">[</span><span class="n">VCLK_CUSTOM_315</span><span class="p">].</span><span class="n">CLOCK</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)((</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mi">18</span><span class="p">]);</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VCLKData</span><span class="p">[</span><span class="n">VCLK_CUSTOM_315</span><span class="p">].</span><span class="n">SR2B</span> <span class="o">=</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBVCLKData</span><span class="p">[</span><span class="n">VCLK_CUSTOM_315</span><span class="p">].</span><span class="n">Part4_A</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="mi">19</span><span class="p">];</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VCLKData</span><span class="p">[</span><span class="n">VCLK_CUSTOM_315</span><span class="p">].</span><span class="n">SR2C</span> <span class="o">=</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBVCLKData</span><span class="p">[</span><span class="n">VCLK_CUSTOM_315</span><span class="p">].</span><span class="n">Part4_B</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>

   <span class="p">}</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_CheckScaling</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">resinfo</span><span class="p">,</span>
			<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">nonscalingmodes</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">while</span><span class="p">(</span><span class="n">nonscalingmodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0xff</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">nonscalingmodes</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">==</span> <span class="n">resinfo</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UsePanelScaler</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>
	 <span class="p">}</span>
	 <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">SiS_GetLCDResInfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">,</span><span class="n">modeflag</span><span class="p">,</span><span class="n">resinfo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">modexres</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">modeyres</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">bool</span> <span class="n">panelcanscale</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">SiS300SeriesLCDRes</span><span class="p">[]</span> <span class="o">=</span>
          <span class="p">{</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>
	    <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span> <span class="p">};</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="o">*</span><span class="n">myptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="cp">#endif</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>        <span class="o">=</span> <span class="mi">999</span><span class="p">;</span> <span class="cm">/* HSync start */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>        <span class="o">=</span> <span class="mi">999</span><span class="p">;</span> <span class="cm">/* HSync end */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>        <span class="o">=</span> <span class="mi">999</span><span class="p">;</span> <span class="cm">/* VSync start */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>        <span class="o">=</span> <span class="mi">999</span><span class="p">;</span> <span class="cm">/* VSync end */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NeedRomModeData</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

  <span class="cm">/* Alternative 1600x1200@60 timing for 1600x1200 LCDA */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Alternate1600x1200</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)))</span> <span class="k">return</span><span class="p">;</span>

  <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_GetModeFlag</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>

  <span class="k">if</span><span class="p">((</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
     <span class="n">modexres</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeResInfo</span><span class="p">[</span><span class="n">resinfo</span><span class="p">].</span><span class="n">HTotal</span><span class="p">;</span>
     <span class="n">modeyres</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeResInfo</span><span class="p">[</span><span class="n">resinfo</span><span class="p">].</span><span class="n">VTotal</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">);</span>

  <span class="cm">/* For broken BIOSes: Assume 1024x768 */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x39</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7c</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="cm">/* Very old BIOSes only know 7 sizes (NetVista 2179, 1.01g) */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&lt;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x07</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="cm">/* Translate 300 series LCDRes to 315 series for unified usage */</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS300SeriesLCDRes</span><span class="p">[</span><span class="n">temp</span><span class="p">];</span>
  <span class="p">}</span>
<span class="cp">#endif</span>

  <span class="cm">/* Translate to our internal types */</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_550</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span>     <span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="n">Panel310_1152x768</span><span class="p">)</span>  <span class="n">temp</span> <span class="o">=</span> <span class="n">Panel_320x240_2</span><span class="p">;</span> <span class="cm">/* Verified working */</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="n">Panel310_320x240_2</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">Panel_320x240_2</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="n">Panel310_320x240_3</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">Panel_320x240_3</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="n">Panel661_1280x854</span><span class="p">)</span>       <span class="n">temp</span> <span class="o">=</span> <span class="n">Panel_1280x854</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">#endif</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* SiS LVDS */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="n">Panel310_1280x768</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">Panel_1280x768_2</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="n">Panel661_1280x800</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">Panel_1280x800_2</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">=</span> <span class="n">Panel_Barco1366</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL848</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">=</span> <span class="n">Panel_848x480</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL856</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">=</span> <span class="n">Panel_856x480</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="cp">#endif</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">&lt;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelMin301</span><span class="p">)</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelMin301</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">&lt;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelMinLVDS</span><span class="p">)</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelMinLVDS</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x37</span><span class="p">);</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x000e</span><span class="p">;</span>
  <span class="cm">/* Need temp below! */</span>

  <span class="cm">/* These must/can&#39;t scale no matter what */</span>
  <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">Panel_320x240_1</span>:
  <span class="k">case</span> <span class="n">Panel_320x240_2</span>:
  <span class="k">case</span> <span class="n">Panel_320x240_3</span>:
  <span class="k">case</span> <span class="n">Panel_1280x960</span>:
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">DontExpandLCD</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Panel_640x480</span>:
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">panelcanscale</span> <span class="o">=</span> <span class="p">(</span><span class="n">bool</span><span class="p">)(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UsePanelScaler</span><span class="p">)</span>          <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">DontExpandLCD</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UsePanelScaler</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>

  <span class="cm">/* Dual link, Pass 1:1 BIOS default, etc. */</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">LCDPass11</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISDUALLINK</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">LCDDualLink</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">myptr</span> <span class="o">=</span> <span class="n">GetLCDStructPtr661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">myptr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">LCDDualLink</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x39</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">LCDPass11</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelSelfDetected</span><span class="p">)))</span> <span class="p">{</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">LCDRGB18Bit</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x35</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">LCDRGB18Bit</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISDUALLINK</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">LCDDualLink</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISDUALLINK</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_CLEVO1024</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">LCDDualLink</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="o">||</span>
	      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">)</span> <span class="o">||</span>
	      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">)</span> <span class="o">||</span>
	      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1680x1050</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">LCDDualLink</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="cp">#endif</span>

  <span class="cm">/* Pass 1:1 */</span>
  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">))</span> <span class="p">{</span>
     <span class="cm">/* Always center screen on LVDS (if scaling is disabled) */</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LCDPass11</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	<span class="cm">/* Always center screen on SiS LVDS (if scaling is disabled) */</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LCDPass11</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="cm">/* By default, pass 1:1 on SiS TMDS (if scaling is supported) */</span>
	<span class="k">if</span><span class="p">(</span><span class="n">panelcanscale</span><span class="p">)</span>             <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">LCDPass11</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CenterScreen</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LCDPass11</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK65_300</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK108_2_315</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">case</span> <span class="n">Panel_320x240_1</span>:
     <span class="k">case</span> <span class="n">Panel_320x240_2</span>:
     <span class="k">case</span> <span class="n">Panel_320x240_3</span>:  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span>  <span class="mi">640</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">480</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>   <span class="mi">24</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK28</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK28</span><span class="p">;</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_640x480</span>:    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span>  <span class="mi">640</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">480</span><span class="p">;</span>
						      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK28</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK28</span><span class="p">;</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_800x600</span>:    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span>  <span class="mi">800</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">600</span><span class="p">;</span>
     			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1056</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">628</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>   <span class="mi">40</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>  <span class="mi">128</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>    <span class="mi">1</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">4</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK40</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK40</span><span class="p">;</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1024x600</span>:   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">600</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1344</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">800</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>   <span class="mi">24</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>  <span class="mi">136</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>    <span class="mi">2</span> <span class="cm">/* 88 */</span> <span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">6</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK65_300</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK65_315</span><span class="p">;</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1024x768</span>:   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">768</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1344</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">806</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>   <span class="mi">24</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>  <span class="mi">136</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">6</span><span class="p">;</span>
			    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span>
						      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">5</span><span class="p">;</span>
			    <span class="p">}</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK65_300</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK65_315</span><span class="p">;</span>
			    <span class="n">SiS_GetLCDInfoBIOS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1152x768</span>:   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1152</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">768</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1344</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">806</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>   <span class="mi">24</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>  <span class="mi">136</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">6</span><span class="p">;</span>
			    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span>
						      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">5</span><span class="p">;</span>
			    <span class="p">}</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK65_300</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK65_315</span><span class="p">;</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1152x864</span>:   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1152</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">864</span><span class="p">;</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1280x720</span>:   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">720</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1650</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">750</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>  <span class="mi">110</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>   <span class="mi">40</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>    <span class="mi">5</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">5</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK_1280x720</span><span class="p">;</span>
			    <span class="cm">/* Data above for TMDS (projector); get from BIOS for LVDS */</span>
			    <span class="n">SiS_GetLCDInfoBIOS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1280x768</span>:   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">768</span><span class="p">;</span>
			    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1408</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">806</span><span class="p">;</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK81_300</span><span class="p">;</span> <span class="cm">/* ? */</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK81_315</span><span class="p">;</span> <span class="cm">/* ? */</span>
			    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1688</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">802</span><span class="p">;</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>   <span class="mi">48</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>  <span class="mi">112</span><span class="p">;</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">6</span><span class="p">;</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK81_300</span><span class="p">;</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK81_315</span><span class="p">;</span>
			    <span class="p">}</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1280x768_2</span>: <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">768</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1660</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">806</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>   <span class="mi">48</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>  <span class="mi">112</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">6</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK_1280x768_2</span><span class="p">;</span>
			    <span class="n">SiS_GetLCDInfoBIOS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1280x800</span>:   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">800</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1408</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">816</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>   <span class="o">=</span>  <span class="mi">21</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>   <span class="mi">24</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>   <span class="o">=</span>   <span class="mi">4</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK_1280x800_315</span><span class="p">;</span>
			    <span class="n">SiS_GetLCDInfoBIOS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1280x800_2</span>: <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">800</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1552</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">812</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>   <span class="o">=</span>  <span class="mi">48</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>  <span class="mi">112</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>   <span class="o">=</span>   <span class="mi">4</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK_1280x800_315_2</span><span class="p">;</span>
			    <span class="n">SiS_GetLCDInfoBIOS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1280x854</span>:   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">854</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1664</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">861</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>   <span class="o">=</span>  <span class="mi">16</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>  <span class="mi">112</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>   <span class="o">=</span>   <span class="mi">1</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK_1280x854</span><span class="p">;</span>
			    <span class="n">SiS_GetLCDInfoBIOS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1280x960</span>:   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">960</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1800</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK108_3_300</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK108_3_315</span><span class="p">;</span>
			    <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1280x1024</span><span class="p">)</span> <span class="p">{</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK100_300</span><span class="p">;</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK100_315</span><span class="p">;</span>
			    <span class="p">}</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1280x1024</span>:  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1688</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span> <span class="mi">1066</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>   <span class="mi">48</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>  <span class="mi">112</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>    <span class="mi">1</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK108_3_300</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK108_2_315</span><span class="p">;</span>
			    <span class="n">SiS_GetLCDInfoBIOS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1400x1050</span>:  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1400</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span> <span class="mi">1050</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1688</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span> <span class="mi">1066</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>   <span class="mi">48</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>  <span class="mi">112</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>    <span class="mi">1</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK108_2_315</span><span class="p">;</span>
			    <span class="n">SiS_GetLCDInfoBIOS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1600x1200</span>:  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1600</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">2160</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span> <span class="mi">1250</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>   <span class="mi">64</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>  <span class="mi">192</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>    <span class="mi">1</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK162_315</span><span class="p">;</span>
			    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISTMDSLCDA</span><span class="p">)</span> <span class="p">{</span>
			       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>  <span class="o">=</span> <span class="mi">1760</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>  <span class="o">=</span> <span class="mi">1235</span><span class="p">;</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span> <span class="o">=</span>   <span class="mi">48</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span> <span class="o">=</span>   <span class="mi">32</span><span class="p">;</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span> <span class="o">=</span>    <span class="mi">2</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span> <span class="o">=</span>    <span class="mi">4</span><span class="p">;</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK130_315</span><span class="p">;</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Alternate1600x1200</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			       <span class="p">}</span>
			    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span><span class="p">)</span> <span class="p">{</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>  <span class="o">=</span> <span class="mi">2048</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>  <span class="o">=</span> <span class="mi">1320</span><span class="p">;</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span> <span class="o">=</span> <span class="mi">999</span><span class="p">;</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span> <span class="o">=</span> <span class="mi">999</span><span class="p">;</span>
			    <span class="p">}</span>
			    <span class="n">SiS_GetLCDInfoBIOS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1680x1050</span>:  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1680</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span> <span class="mi">1050</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1900</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span> <span class="mi">1066</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span>   <span class="mi">26</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span>   <span class="mi">76</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span>    <span class="mi">3</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span>    <span class="mi">6</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK121_315</span><span class="p">;</span>
			    <span class="n">SiS_GetLCDInfoBIOS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_Barco1366</span>:  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1360</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1688</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span> <span class="mi">1066</span><span class="p">;</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_848x480</span>:    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span>  <span class="mi">848</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">480</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1088</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">525</span><span class="p">;</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_856x480</span>:    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span>  <span class="mi">856</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">480</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1088</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">525</span><span class="p">;</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_Custom</span>:     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_MaxX</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_MaxY</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHTotal</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVTotal</span><span class="p">;</span>
			    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PreferredIndex</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_HDisplay</span><span class="p">[</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PreferredIndex</span><span class="p">];</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_VDisplay</span><span class="p">[</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PreferredIndex</span><span class="p">];</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_HTotal</span><span class="p">[</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PreferredIndex</span><span class="p">];</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_VTotal</span><span class="p">[</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PreferredIndex</span><span class="p">];</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_HSyncStart</span><span class="p">[</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PreferredIndex</span><span class="p">];</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_HSyncEnd</span><span class="p">[</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PreferredIndex</span><span class="p">];</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_VSyncStart</span><span class="p">[</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PreferredIndex</span><span class="p">];</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_VSyncEnd</span><span class="p">[</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PreferredIndex</span><span class="p">];</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span> <span class="o">-=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span><span class="p">;</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span> <span class="o">-=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span><span class="p">;</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span> <span class="o">-=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">;</span>
			       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span> <span class="o">-=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span><span class="p">;</span>
			       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PrefClock</span><span class="p">)</span> <span class="p">{</span>
				  <span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span> <span class="o">=</span> <span class="n">VCLK_CUSTOM_315</span><span class="p">;</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span> <span class="o">=</span> <span class="n">VCLK_CUSTOM_300</span><span class="p">;</span>
				  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">VCLK_CUSTOM_300</span><span class="p">;</span>
				  <span class="k">else</span>				   <span class="n">idx</span> <span class="o">=</span> <span class="n">VCLK_CUSTOM_315</span><span class="p">;</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VCLKData</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">CLOCK</span> <span class="o">=</span>
				     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBVCLKData</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">CLOCK</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PrefClock</span><span class="p">;</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VCLKData</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">SR2B</span> <span class="o">=</span>
				     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBVCLKData</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">Part4_A</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PrefSR2B</span><span class="p">;</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VCLKData</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">SR2C</span> <span class="o">=</span>
				     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBVCLKData</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">Part4_B</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PrefSR2C</span><span class="p">;</span>
			       <span class="p">}</span>
			    <span class="p">}</span>
			    <span class="k">break</span><span class="p">;</span>
     <span class="nl">default:</span>		    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">=</span>  <span class="mi">768</span><span class="p">;</span>
			    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span>   <span class="o">=</span> <span class="mi">1344</span><span class="p">;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span>   <span class="o">=</span>  <span class="mi">806</span><span class="p">;</span>
			    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/* Special cases */</span>
  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span><span class="p">)</span>              <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_DSTN</span><span class="p">)</span>              <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1024</span><span class="p">)</span> <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL848</span><span class="p">)</span>  <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL856</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span> <span class="o">=</span> <span class="mi">999</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span> <span class="o">=</span> <span class="mi">999</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1024</span><span class="p">)</span> <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL848</span><span class="p">)</span>  <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL856</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span> <span class="o">=</span> <span class="mi">999</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span> <span class="o">=</span> <span class="mi">999</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/* DontExpand overrule */</span>
  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)))</span> <span class="p">{</span>

     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">NoSupportLCDScale</span><span class="p">))</span> <span class="p">{</span>
	<span class="cm">/* No scaling for this mode on any panel (LCD=CRT2)*/</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>

     <span class="k">case</span> <span class="n">Panel_Custom</span>:
     <span class="k">case</span> <span class="n">Panel_1152x864</span>:
     <span class="k">case</span> <span class="n">Panel_1280x768</span>:	<span class="cm">/* TMDS only */</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>
	<span class="k">break</span><span class="p">;</span>

     <span class="k">case</span> <span class="n">Panel_800x600</span>: <span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	   <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">case</span> <span class="n">Panel_1024x768</span>: <span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	   <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="n">SIS_RI_848x480</span><span class="p">,</span>
	   <span class="n">SIS_RI_856x480</span><span class="p">,</span> <span class="n">SIS_RI_960x540</span><span class="p">,</span> <span class="n">SIS_RI_960x600</span><span class="p">,</span> <span class="n">SIS_RI_1024x576</span><span class="p">,</span><span class="n">SIS_RI_1024x600</span><span class="p">,</span>
	   <span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">case</span> <span class="n">Panel_1280x720</span>: <span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	   <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="n">SIS_RI_848x480</span><span class="p">,</span>
	   <span class="n">SIS_RI_856x480</span><span class="p">,</span> <span class="n">SIS_RI_960x540</span><span class="p">,</span> <span class="n">SIS_RI_960x600</span><span class="p">,</span> <span class="n">SIS_RI_1024x576</span><span class="p">,</span><span class="n">SIS_RI_1024x600</span><span class="p">,</span>
	   <span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span> <span class="o">==</span> <span class="mi">1650</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">case</span> <span class="n">Panel_1280x768_2</span>: <span class="p">{</span>  <span class="cm">/* LVDS only */</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	   <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="n">SIS_RI_848x480</span><span class="p">,</span>
	   <span class="n">SIS_RI_856x480</span><span class="p">,</span> <span class="n">SIS_RI_960x540</span><span class="p">,</span> <span class="n">SIS_RI_960x600</span><span class="p">,</span> <span class="n">SIS_RI_1024x576</span><span class="p">,</span><span class="n">SIS_RI_1024x600</span><span class="p">,</span>
	   <span class="n">SIS_RI_1152x768</span><span class="p">,</span><span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">resinfo</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SIS_RI_1280x720</span>:  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UsePanelScaler</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>
			       <span class="p">}</span>
			       <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">case</span> <span class="n">Panel_1280x800</span>: <span class="p">{</span>  	<span class="cm">/* SiS TMDS special (Averatec 6200 series) */</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	   <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="n">SIS_RI_848x480</span><span class="p">,</span>
	   <span class="n">SIS_RI_856x480</span><span class="p">,</span> <span class="n">SIS_RI_960x540</span><span class="p">,</span> <span class="n">SIS_RI_960x600</span><span class="p">,</span> <span class="n">SIS_RI_1024x576</span><span class="p">,</span><span class="n">SIS_RI_1024x600</span><span class="p">,</span>
	   <span class="n">SIS_RI_1152x768</span><span class="p">,</span><span class="n">SIS_RI_1280x720</span><span class="p">,</span><span class="n">SIS_RI_1280x768</span><span class="p">,</span><span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">case</span> <span class="n">Panel_1280x800_2</span>:  <span class="p">{</span> 	<span class="cm">/* SiS LVDS */</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	   <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="n">SIS_RI_848x480</span><span class="p">,</span>
	   <span class="n">SIS_RI_856x480</span><span class="p">,</span> <span class="n">SIS_RI_960x540</span><span class="p">,</span> <span class="n">SIS_RI_960x600</span><span class="p">,</span> <span class="n">SIS_RI_1024x576</span><span class="p">,</span><span class="n">SIS_RI_1024x600</span><span class="p">,</span>
	   <span class="n">SIS_RI_1152x768</span><span class="p">,</span><span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">resinfo</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SIS_RI_1280x720</span>:
	<span class="k">case</span> <span class="n">SIS_RI_1280x768</span>:  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UsePanelScaler</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>
			       <span class="p">}</span>
			       <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">case</span> <span class="n">Panel_1280x854</span>: <span class="p">{</span>  	<span class="cm">/* SiS LVDS */</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	   <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="n">SIS_RI_848x480</span><span class="p">,</span>
	   <span class="n">SIS_RI_856x480</span><span class="p">,</span> <span class="n">SIS_RI_960x540</span><span class="p">,</span> <span class="n">SIS_RI_960x600</span><span class="p">,</span> <span class="n">SIS_RI_1024x576</span><span class="p">,</span><span class="n">SIS_RI_1024x600</span><span class="p">,</span>
	   <span class="n">SIS_RI_1152x768</span><span class="p">,</span><span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">resinfo</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SIS_RI_1280x720</span>:
	<span class="k">case</span> <span class="n">SIS_RI_1280x768</span>:
	<span class="k">case</span> <span class="n">SIS_RI_1280x800</span>:  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UsePanelScaler</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>
			       <span class="p">}</span>
			       <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">case</span> <span class="n">Panel_1280x960</span>: <span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	   <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="n">SIS_RI_848x480</span><span class="p">,</span>
	   <span class="n">SIS_RI_856x480</span><span class="p">,</span> <span class="n">SIS_RI_960x540</span><span class="p">,</span> <span class="n">SIS_RI_960x600</span><span class="p">,</span> <span class="n">SIS_RI_1024x576</span><span class="p">,</span><span class="n">SIS_RI_1024x600</span><span class="p">,</span>
	   <span class="n">SIS_RI_1152x768</span><span class="p">,</span><span class="n">SIS_RI_1152x864</span><span class="p">,</span><span class="n">SIS_RI_1280x720</span><span class="p">,</span><span class="n">SIS_RI_1280x768</span><span class="p">,</span><span class="n">SIS_RI_1280x800</span><span class="p">,</span>
	   <span class="n">SIS_RI_1280x854</span><span class="p">,</span><span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">case</span> <span class="n">Panel_1280x1024</span>: <span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	   <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="n">SIS_RI_848x480</span><span class="p">,</span>
	   <span class="n">SIS_RI_856x480</span><span class="p">,</span> <span class="n">SIS_RI_960x540</span><span class="p">,</span> <span class="n">SIS_RI_960x600</span><span class="p">,</span> <span class="n">SIS_RI_1024x576</span><span class="p">,</span><span class="n">SIS_RI_1024x600</span><span class="p">,</span>
	   <span class="n">SIS_RI_1152x768</span><span class="p">,</span><span class="n">SIS_RI_1152x864</span><span class="p">,</span><span class="n">SIS_RI_1280x720</span><span class="p">,</span><span class="n">SIS_RI_1280x768</span><span class="p">,</span><span class="n">SIS_RI_1280x800</span><span class="p">,</span>
	   <span class="n">SIS_RI_1280x854</span><span class="p">,</span><span class="n">SIS_RI_1280x960</span><span class="p">,</span><span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">case</span> <span class="n">Panel_1400x1050</span>: <span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	     <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="n">SIS_RI_848x480</span><span class="p">,</span>
	     <span class="n">SIS_RI_856x480</span><span class="p">,</span> <span class="n">SIS_RI_960x540</span><span class="p">,</span> <span class="n">SIS_RI_960x600</span><span class="p">,</span> <span class="n">SIS_RI_1024x576</span><span class="p">,</span><span class="n">SIS_RI_1024x600</span><span class="p">,</span>
	     <span class="n">SIS_RI_1152x768</span><span class="p">,</span><span class="n">SIS_RI_1152x864</span><span class="p">,</span><span class="n">SIS_RI_1280x768</span><span class="p">,</span><span class="n">SIS_RI_1280x800</span><span class="p">,</span><span class="n">SIS_RI_1280x854</span><span class="p">,</span>
	     <span class="n">SIS_RI_1280x960</span><span class="p">,</span><span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">resinfo</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SIS_RI_1280x720</span>:  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UsePanelScaler</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>
			       <span class="p">}</span>
			       <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SIS_RI_1280x1024</span>: <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>
			       <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">case</span> <span class="n">Panel_1600x1200</span>: <span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	     <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="n">SIS_RI_848x480</span><span class="p">,</span>
	     <span class="n">SIS_RI_856x480</span><span class="p">,</span> <span class="n">SIS_RI_960x540</span><span class="p">,</span> <span class="n">SIS_RI_960x600</span><span class="p">,</span> <span class="n">SIS_RI_1024x576</span><span class="p">,</span><span class="n">SIS_RI_1024x600</span><span class="p">,</span>
	     <span class="n">SIS_RI_1152x768</span><span class="p">,</span><span class="n">SIS_RI_1152x864</span><span class="p">,</span><span class="n">SIS_RI_1280x720</span><span class="p">,</span><span class="n">SIS_RI_1280x768</span><span class="p">,</span><span class="n">SIS_RI_1280x800</span><span class="p">,</span>
	     <span class="n">SIS_RI_1280x854</span><span class="p">,</span><span class="n">SIS_RI_1280x960</span><span class="p">,</span><span class="n">SIS_RI_1360x768</span><span class="p">,</span><span class="n">SIS_RI_1360x1024</span><span class="p">,</span><span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">case</span> <span class="n">Panel_1680x1050</span>: <span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">nonscalingmodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	     <span class="n">SIS_RI_720x480</span><span class="p">,</span> <span class="n">SIS_RI_720x576</span><span class="p">,</span> <span class="n">SIS_RI_768x576</span><span class="p">,</span> <span class="n">SIS_RI_800x480</span><span class="p">,</span> <span class="n">SIS_RI_848x480</span><span class="p">,</span>
	     <span class="n">SIS_RI_856x480</span><span class="p">,</span> <span class="n">SIS_RI_960x540</span><span class="p">,</span> <span class="n">SIS_RI_960x600</span><span class="p">,</span> <span class="n">SIS_RI_1024x576</span><span class="p">,</span><span class="n">SIS_RI_1024x600</span><span class="p">,</span>
	     <span class="n">SIS_RI_1152x768</span><span class="p">,</span><span class="n">SIS_RI_1152x864</span><span class="p">,</span><span class="n">SIS_RI_1280x854</span><span class="p">,</span><span class="n">SIS_RI_1280x960</span><span class="p">,</span><span class="n">SIS_RI_1360x768</span><span class="p">,</span>
	     <span class="n">SIS_RI_1360x1024</span><span class="p">,</span><span class="mh">0xff</span>
	<span class="p">};</span>
	<span class="n">SiS_CheckScaling</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">nonscalingmodes</span><span class="p">);</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL848</span> <span class="o">||</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL856</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">=</span> <span class="mh">0x80</span> <span class="o">|</span> <span class="mh">0x40</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>   <span class="cm">/* neg h/v sync, RGB24(D0 = 0) */</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x233</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x12</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x234</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x34</span><span class="p">))</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x235</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">))</span> <span class="p">{</span>
		 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">DontExpandLCD</span><span class="p">);</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">SetDOSMode</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">)))</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">DontExpandLCD</span><span class="p">);</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="cp">#endif</span>

  <span class="cm">/* Special cases */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">modexres</span> <span class="o">==</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">&amp;&amp;</span> <span class="n">modeyres</span> <span class="o">==</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LCDPass11</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_TRUMPION</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="p">(</span><span class="n">DontExpandLCD</span> <span class="o">|</span> <span class="n">LCDPass11</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">Panel_640x480</span>:
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="p">(</span><span class="n">DontExpandLCD</span> <span class="o">|</span> <span class="n">LCDPass11</span><span class="p">);</span>
     <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Panel_1280x800</span>:
     <span class="cm">/* Don&#39;t pass 1:1 by default (TMDS special) */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CenterScreen</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LCDPass11</span><span class="p">;</span>
     <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Panel_1280x960</span>:
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LCDPass11</span><span class="p">;</span>
     <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">Panel_Custom</span>:
     <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CP_PrefClock</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="n">modexres</span> <span class="o">&gt;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">modeyres</span> <span class="o">&gt;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">LCDPass11</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_UNKNOWNLCD</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="p">(</span><span class="n">DontExpandLCD</span> <span class="o">|</span> <span class="n">LCDPass11</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/* (In)validate LCDPass11 flag */</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LCDPass11</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/* LVDS DDA */</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">SetDOSMode</span><span class="p">)))</span> <span class="p">{</span>

     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_TRUMPION</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x12</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">EnableLVDSDDA</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x600</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">))</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">((</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_800x600</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_400x300</span><span class="p">))</span> <span class="p">{</span>
		       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">EnableLVDSDDA</span><span class="p">;</span>
		    <span class="p">}</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>

     <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_TRUMPION</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">EnableLVDSDDA</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">EnableLVDSDDA</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_640x480</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">EnableLVDSDDA</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_512x384</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">EnableLVDSDDA</span><span class="p">;</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_800x600</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_400x300</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">EnableLVDSDDA</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>

  <span class="p">}</span>

  <span class="cm">/* VESA timing */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetNotSimuMode</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">LCDVESATiming</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">LCDVESATiming</span><span class="p">;</span>
  <span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">  printk(KERN_DEBUG &quot;sisfb: (LCDInfo=0x%04x LCDResInfo=0x%02x LCDTypeInfo=0x%02x)\n&quot;,</span>
<span class="c">	SiS_Pr-&gt;SiS_LCDInfo, SiS_Pr-&gt;SiS_LCDResInfo, SiS_Pr-&gt;SiS_LCDTypeInfo);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*                 GET VCLK                  */</span>
<span class="cm">/*********************************************/</span>

<span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_GetVCLK2Ptr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">CRT2Index</span><span class="p">,</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">VCLKIndexGEN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">VCLKIndexGENCRT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">tempbx</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">CHTVVCLKPtr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ResInfo</span><span class="p">;</span>
     <span class="n">CRT2Index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span><span class="p">;</span>
     <span class="n">VCLKIndexGEN</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_GetRegByte</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3ca</span><span class="o">+</span><span class="mh">0x02</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">;</span>
     <span class="n">VCLKIndexGENCRT</span> <span class="o">=</span> <span class="n">VCLKIndexGEN</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
     <span class="n">CRT2Index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC</span><span class="p">;</span>
     <span class="n">VCLKIndexGEN</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRTVCLK</span><span class="p">;</span>
     <span class="n">VCLKIndexGENCRT</span> <span class="o">=</span> <span class="n">SiS_GetRefCRTVCLK</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">,</span>
		<span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">ProgrammingCRT2</span><span class="p">)</span> <span class="o">?</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseWideCRT2</span> <span class="o">:</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseWide</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>    <span class="cm">/* 30x/B/LV */</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">ProgrammingCRT2</span><span class="p">)</span> <span class="p">{</span>

	<span class="n">CRT2Index</span> <span class="o">&gt;&gt;=</span> <span class="mi">6</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>      	<span class="cm">/*  LCD */</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
		 <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLKIndexGEN</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
		 <span class="k">switch</span><span class="p">(</span><span class="n">resinfo</span><span class="p">)</span> <span class="p">{</span>
		 <span class="cm">/* Correct those whose IndexGEN doesn&#39;t match VBVCLK array */</span>
		 <span class="k">case</span> <span class="n">SIS_RI_720x480</span>:  <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK_720x480</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
		 <span class="k">case</span> <span class="n">SIS_RI_720x576</span>:  <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK_720x576</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
		 <span class="k">case</span> <span class="n">SIS_RI_768x576</span>:  <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK_768x576</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
		 <span class="k">case</span> <span class="n">SIS_RI_848x480</span>:  <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK_848x480</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
		 <span class="k">case</span> <span class="n">SIS_RI_856x480</span>:  <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK_856x480</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
		 <span class="k">case</span> <span class="n">SIS_RI_800x480</span>:  <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK_800x480</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
		 <span class="k">case</span> <span class="n">SIS_RI_1024x576</span>: <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK_1024x576</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		 <span class="k">case</span> <span class="n">SIS_RI_1152x864</span>: <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK_1152x864</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		 <span class="k">case</span> <span class="n">SIS_RI_1280x720</span>: <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK_1280x720</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		 <span class="k">case</span> <span class="n">SIS_RI_1360x768</span>: <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK_1360x768</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		 <span class="nl">default:</span>              <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLKIndexGEN</span><span class="p">;</span>
		 <span class="p">}</span>

		 <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;=</span> <span class="n">SIS_315PRO</span><span class="p">)</span> <span class="p">{</span>
		       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mh">0x42</span><span class="p">;</span>
		    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		    <span class="p">}</span>
		 <span class="p">}</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;=</span> <span class="n">SIS_315PRO</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">VCLKIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mh">0x41</span><span class="p">;</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">VCLKIndex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mh">0x43</span><span class="p">;</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">VCLKIndex</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mh">0x44</span><span class="p">;</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span>

	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>                 	<span class="cm">/*  TV */</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVRPLLDIV2XO</span><span class="p">)</span> 	   <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">HiTVVCLKDIV2</span><span class="p">;</span>
	      <span class="k">else</span>                                  	   <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">HiTVVCLK</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">)</span>     <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">HiTVSimuVCLK</span><span class="p">;</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span>  <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">YPbPr750pVCLK</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span>    <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">TVVCLKDIV2</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVRPLLDIV2XO</span><span class="p">)</span>      <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">TVVCLKDIV2</span><span class="p">;</span>
	   <span class="k">else</span>						   <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">TVVCLK</span><span class="p">;</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">+=</span> <span class="n">TVCLKBASE_300</span><span class="p">;</span>
	   <span class="k">else</span>				   <span class="n">VCLKIndex</span> <span class="o">+=</span> <span class="n">TVCLKBASE_315</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>							<span class="cm">/* VGA2 */</span>

	   <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLKIndexGENCRT</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_630</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipRevision</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">))</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">VCLKIndex</span> <span class="o">==</span> <span class="mh">0x14</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mh">0x34</span><span class="p">;</span>
		 <span class="p">}</span>
		 <span class="cm">/* Better VGA2 clock for 1280x1024@75 */</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">VCLKIndex</span> <span class="o">==</span> <span class="mh">0x17</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mh">0x45</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>   <span class="cm">/* If not programming CRT2 */</span>

	<span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLKIndexGENCRT</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">!=</span> <span class="n">SIS_630</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">!=</span> <span class="n">SIS_300</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">VCLKIndex</span> <span class="o">==</span> <span class="mh">0x1b</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mh">0x48</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>       <span class="cm">/*   LVDS  */</span>

     <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">CRT2Index</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">ProgrammingCRT2</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>

	   <span class="n">VCLKIndex</span> <span class="o">&amp;=</span> <span class="mh">0x1f</span><span class="p">;</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetCHOverScan</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&gt;</span> <span class="n">ModeVGA</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHSOverScan</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetCHOverScan</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALN</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetCHOverScan</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	   <span class="k">switch</span><span class="p">(</span><span class="n">tempbx</span><span class="p">)</span> <span class="p">{</span>
	     <span class="k">case</span>  <span class="mi">0</span>: <span class="n">CHTVVCLKPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVVCLKUNTSC</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	     <span class="k">case</span>  <span class="mi">1</span>: <span class="n">CHTVVCLKPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVVCLKONTSC</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	     <span class="k">case</span>  <span class="mi">2</span>: <span class="n">CHTVVCLKPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVVCLKUPAL</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	     <span class="k">case</span>  <span class="mi">3</span>: <span class="n">CHTVVCLKPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVVCLKOPAL</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	     <span class="k">case</span>  <span class="mi">4</span>: <span class="n">CHTVVCLKPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVVCLKUPALM</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	     <span class="k">case</span>  <span class="mi">5</span>: <span class="n">CHTVVCLKPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVVCLKOPALM</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	     <span class="k">case</span>  <span class="mi">6</span>: <span class="n">CHTVVCLKPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVVCLKUPALN</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	     <span class="k">case</span>  <span class="mi">7</span>: <span class="n">CHTVVCLKPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVVCLKOPALN</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	     <span class="k">case</span>  <span class="mi">8</span>: <span class="n">CHTVVCLKPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVVCLKSOPAL</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	     <span class="nl">default:</span> <span class="n">CHTVVCLKPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVVCLKOPAL</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">CHTVVCLKPtr</span><span class="p">[</span><span class="n">VCLKIndex</span><span class="p">];</span>

	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx300</span><span class="p">;</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVCLKIdx315</span><span class="p">;</span>
	   <span class="p">}</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
	   <span class="cm">/* Special Timing: Barco iQ Pro R series */</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mh">0x44</span><span class="p">;</span>

	   <span class="cm">/* Special Timing: 848x480 and 856x480 parallel lvds panels */</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL848</span> <span class="o">||</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL856</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK34_300</span><span class="p">;</span>
		 <span class="cm">/* if(resinfo == SIS_RI_1360x768) VCLKIndex = ?; */</span>
	      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		 <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLK34_315</span><span class="p">;</span>
		 <span class="cm">/* if(resinfo == SIS_RI_1360x768) VCLKIndex = ?; */</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
<span class="cp">#endif</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	   <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLKIndexGENCRT</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_630</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipRevision</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">VCLKIndex</span> <span class="o">==</span> <span class="mh">0x14</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mh">0x2e</span><span class="p">;</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="cm">/* if not programming CRT2 */</span>

	<span class="n">VCLKIndex</span> <span class="o">=</span> <span class="n">VCLKIndexGENCRT</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">!=</span> <span class="n">SIS_630</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">!=</span> <span class="n">SIS_300</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">VCLKIndex</span> <span class="o">==</span> <span class="mh">0x1b</span><span class="p">)</span> <span class="n">VCLKIndex</span> <span class="o">=</span> <span class="mh">0x48</span><span class="p">;</span>
	      <span class="p">}</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	      if(SiS_Pr-&gt;ChipType == SIS_730) {</span>
<span class="c">		 if(VCLKIndex == 0x0b) VCLKIndex = 0x40;   /* 1024x768-70 */</span>
<span class="c">		 if(VCLKIndex == 0x0d) VCLKIndex = 0x41;   /* 1024x768-75 */</span>
<span class="c">	      }</span>
<span class="cp">#endif</span>
	   <span class="p">}</span>
        <span class="p">}</span>

     <span class="p">}</span>

  <span class="p">}</span>

  <span class="k">return</span> <span class="n">VCLKIndex</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*        SET CRT2 MODE TYPE REGISTERS       */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetCRT2ModeRegs</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">tempah</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">short</span> <span class="n">tempcl</span><span class="p">;</span>
<span class="cp">#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempbl</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempah2</span><span class="p">,</span> <span class="n">tempbl2</span><span class="p">;</span>
<span class="cp">#endif</span>

  <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_GetModeFlag</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xAF</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span>
     <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2E</span><span class="p">,</span><span class="mh">0xF7</span><span class="p">);</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

     <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span><span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x7F</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="n">tempcl</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300    </span><span class="cm">/* ---- 300 series ---- */</span><span class="cp"></span>

	<span class="cm">/* For 301BDH: (with LCD via LVDS) */</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempbl</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">);</span>
	   <span class="n">tempbl</span> <span class="o">&amp;=</span> <span class="mh">0xef</span><span class="p">;</span>
	   <span class="n">tempbl</span> <span class="o">|=</span> <span class="mh">0x02</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">tempbl</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
	      <span class="n">tempbl</span> <span class="o">&amp;=</span> <span class="mh">0xfd</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="n">tempbl</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempcl</span> <span class="o">-=</span> <span class="n">ModeVGA</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempcl</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">tempah</span> <span class="o">=</span> <span class="p">((</span><span class="mh">0x10</span> <span class="o">&gt;&gt;</span> <span class="n">tempcl</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x80</span><span class="p">);</span>
	   <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span>  <span class="n">tempah</span> <span class="o">^=</span> <span class="mh">0xA0</span><span class="p">;</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_300 */</span><span class="cp"></span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315    </span><span class="cm">/* ------- 315/330 series ------ */</span><span class="cp"></span>

	<span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempcl</span> <span class="o">-=</span> <span class="n">ModeVGA</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempcl</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">tempah</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x08</span> <span class="o">&gt;&gt;</span> <span class="n">tempcl</span><span class="p">);</span>
	      <span class="k">if</span> <span class="p">(</span><span class="n">tempah</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="n">tempah</span> <span class="o">^=</span> <span class="mh">0x50</span><span class="p">;</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>

     <span class="p">}</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xa0</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xa0</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	   <span class="p">}</span>
	<span class="p">}</span>
<span class="cp">#endif</span>
     <span class="p">}</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

	<span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x02</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">tempah</span> <span class="o">^=</span> <span class="mh">0x05</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">tempah</span> <span class="o">^=</span> <span class="mh">0x01</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)</span>  <span class="n">tempah</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	   <span class="n">tempah</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempah</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	   <span class="n">tempah</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempah</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)</span>  <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span>           <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x08</span><span class="p">;</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2E</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	   <span class="n">tempah</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x08</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">==</span> <span class="n">ModeVGA</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)))</span> <span class="p">{</span>
	   <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">&lt;</span> <span class="mi">1280</span> <span class="o">&amp;&amp;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">&lt;</span> <span class="mi">960</span><span class="p">)</span> <span class="n">tempah</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x80</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetYPbPr750p</span> <span class="o">|</span> <span class="n">TVSetYPbPr525p</span><span class="p">)))</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0D</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>

	<span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">&lt;</span> <span class="mi">1280</span> <span class="o">&amp;&amp;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">&lt;</span> <span class="mi">960</span><span class="p">)</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVRPLLDIV2XO</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0C</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="cm">/* LVDS */</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
	   <span class="cm">/* LVDS can only be slave in 8bpp modes */</span>
	   <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">CRT2Mode</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&gt;</span> <span class="n">ModeVGA</span><span class="p">))</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DriverMode</span><span class="p">)</span> <span class="p">{</span>
	         <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x02</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>

	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span>  <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x02</span><span class="p">;</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span>        <span class="n">tempah</span> <span class="o">^=</span> <span class="mh">0x01</span><span class="p">;</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2e</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
	   <span class="n">tempah</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&gt;</span> <span class="n">ModeVGA</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
	      <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x02</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="n">tempah</span> <span class="o">&lt;&lt;=</span> <span class="mi">5</span><span class="p">;</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="p">}</span>

     <span class="p">}</span>

  <span class="p">}</span>  <span class="cm">/* LCDA */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
	<span class="cm">/* unsigned char bridgerev = SiS_GetReg(SiS_Pr-&gt;SiS_Part4Port,0x01); */</span>

	<span class="cm">/* The following is nearly unpreditable and varies from machine</span>
<span class="cm">	 * to machine. Especially the 301DH seems to be a real trouble</span>
<span class="cm">	 * maker. Some BIOSes simply set the registers (like in the</span>
<span class="cm">	 * NoLCD-if-statements here), some set them according to the</span>
<span class="cm">	 * LCDA stuff. It is very likely that some machines are not</span>
<span class="cm">	 * treated correctly in the following, very case-orientated</span>
<span class="cm">	 * code. What do I do then...?</span>
<span class="cm">	 */</span>

	<span class="cm">/* 740 variants match for 30xB, 301B-DH, 30xLV */</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>						   <span class="cm">/* For all bridges */</span>
	   <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0xfb</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	         <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="n">tempbl</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* The following two are responsible for eventually wrong colors</span>
<span class="cm">	 * in TV output. The DH (VB_NoLCD) conditions are unknown; the</span>
<span class="cm">	 * b0 was found in some 651 machine (Pim; P4_23=0xe5); the b1 version</span>
<span class="cm">	 * in a 650 box (Jake). What is the criteria?</span>
<span class="cm">	 * Addendum: Another combination 651+301B-DH(b1) (Rapo) needs same</span>
<span class="cm">	 * treatment like the 651+301B-DH(b0) case. Seems more to be the</span>
<span class="cm">	 * chipset than the bridge revision.</span>
<span class="cm">	 */</span>

	<span class="k">if</span><span class="p">((</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>
	   <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0xc0</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)</span> <span class="o">||</span>
	      <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x5b</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">))))</span> <span class="p">{</span>
	      <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	      <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2c</span><span class="p">,</span><span class="mh">0xcf</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="n">tempbl</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301</span><span class="p">)</span> <span class="p">{</span>
	   <span class="cm">/* Fixes &quot;TV-blue-bug&quot; on 315+301 */</span>
	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2c</span><span class="p">,</span><span class="mh">0xcf</span><span class="p">);</span>	<span class="cm">/* For 301   */</span>
	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2c</span><span class="p">,</span><span class="mh">0x30</span><span class="p">);</span>	<span class="cm">/* For 30xLV */</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0xc0</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* For 301B-DH */</span>
	   <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span> <span class="n">tempah2</span> <span class="o">=</span> <span class="mh">0xc0</span><span class="p">;</span>
	   <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0xcf</span><span class="p">;</span> <span class="n">tempbl2</span> <span class="o">=</span> <span class="mh">0x3f</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVBlue</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	         <span class="n">tempah</span> <span class="o">=</span> <span class="n">tempah2</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVBlue</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	      <span class="cm">/* Set on 651/M650, clear on 315/650 */</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">IS_SIS65x</span><span class="p">))</span> <span class="cm">/* (bridgerev != 0xb0) */</span> <span class="p">{</span>
	         <span class="n">tempah</span> <span class="o">=</span> <span class="n">tempah2</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2c</span><span class="p">,</span><span class="n">tempbl</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="n">tempbl2</span><span class="p">,</span><span class="n">tempah2</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span> <span class="n">tempah2</span> <span class="o">=</span> <span class="mh">0xc0</span><span class="p">;</span>		       <span class="cm">/* For 30xB, 301C */</span>
	   <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0xcf</span><span class="p">;</span> <span class="n">tempbl2</span> <span class="o">=</span> <span class="mh">0x3f</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">tempah</span> <span class="o">=</span> <span class="n">tempah2</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
		 <span class="n">tempbl</span> <span class="o">=</span> <span class="n">tempbl2</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2c</span><span class="p">,</span><span class="n">tempbl</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="n">tempbl2</span><span class="p">,</span><span class="n">tempah2</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x23</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	   <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0x7f</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x23</span><span class="p">,</span><span class="n">tempbl</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>

     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
	<span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">);</span>

	<span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)</span> <span class="o">||</span>
	   <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)))</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x23</span><span class="p">,</span><span class="mh">0x7F</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x23</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
	<span class="p">}</span>
<span class="cp">#endif</span>

     <span class="p">}</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0D</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xCLV</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x3A</span><span class="p">,</span><span class="mh">0xC0</span><span class="p">);</span>
        <span class="p">}</span>
     <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="cm">/* LVDS */</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

	   <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
	   <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0xfb</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="n">tempbl</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">);</span>
	   <span class="p">}</span>

	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2c</span><span class="p">,</span><span class="mh">0x30</span><span class="p">);</span>

	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_550</span><span class="p">)</span> <span class="p">{</span>

	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">);</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2c</span><span class="p">,</span><span class="mh">0x30</span><span class="p">);</span>

	<span class="p">}</span>

     <span class="p">}</span>
<span class="cp">#endif</span>

  <span class="p">}</span>

<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*            GET RESOLUTION DATA            */</span>
<span class="cm">/*********************************************/</span>

<span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_GetResInfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ResInfo</span><span class="p">);</span>
   <span class="k">else</span>
      <span class="k">return</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_GetCRT2ResInfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">xres</span><span class="p">,</span> <span class="n">yres</span><span class="p">,</span> <span class="n">modeflag</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">resindex</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">xres</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHDisplay</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CModeFlag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">xres</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span> <span class="o">=</span> <span class="n">xres</span><span class="p">;</span>
      <span class="cm">/* DoubleScanMode-check done in CheckCalcCustomMode()! */</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVDisplay</span><span class="p">;</span>
      <span class="k">return</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">resindex</span> <span class="o">=</span> <span class="n">SiS_GetResInfo</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">);</span>

   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">xres</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_StResInfo</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">HTotal</span><span class="p">;</span>
      <span class="n">yres</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_StResInfo</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">VTotal</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">xres</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeResInfo</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">HTotal</span><span class="p">;</span>
      <span class="n">yres</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeResInfo</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">VTotal</span><span class="p">;</span>
      <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_DSTN</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">((</span><span class="n">ModeNo</span> <span class="o">!=</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">SetDOSMode</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">yres</span> <span class="o">==</span> <span class="mi">350</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
	 <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x3a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x12</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span>       <span class="n">xres</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">DoubleScanMode</span><span class="p">)</span> <span class="n">yres</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>

   <span class="p">}</span>

   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)))</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">case</span> <span class="n">Panel_1024x768</span>:
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">))</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">yres</span> <span class="o">==</span> <span class="mi">350</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">357</span><span class="p">;</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">yres</span> <span class="o">==</span> <span class="mi">400</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">420</span><span class="p">;</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">yres</span> <span class="o">==</span> <span class="mi">480</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">525</span><span class="p">;</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="n">Panel_1280x1024</span>:
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">))</span> <span class="p">{</span>
		 <span class="cm">/* BIOS bug - does this regardless of scaling */</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">yres</span> <span class="o">==</span> <span class="mi">400</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">405</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">yres</span> <span class="o">==</span> <span class="mi">350</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">360</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">yres</span> <span class="o">==</span> <span class="mi">360</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">375</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="n">Panel_1600x1200</span>:
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">yres</span> <span class="o">==</span> <span class="mi">1024</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">1056</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">break</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span>

   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToHiVision</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">xres</span> <span class="o">==</span> <span class="mi">720</span><span class="p">)</span> <span class="n">xres</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">xres</span> <span class="o">==</span> <span class="mi">720</span><span class="p">)</span> <span class="n">xres</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">SetDOSMode</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">yres</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x17</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>
	 <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_DSTN</span> <span class="o">||</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span><span class="p">)</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>
      <span class="p">}</span>

   <span class="p">}</span>
   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span> <span class="o">=</span> <span class="n">xres</span><span class="p">;</span>
   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">=</span> <span class="n">yres</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*           GET CRT2 TIMING DATA            */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_GetCRT2Ptr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
	       <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">CRT2Index</span><span class="p">,</span>
	       <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">ResIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempbx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tempal</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">resinfo</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">tempal</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">tempal</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC</span><span class="p">;</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>                            <span class="cm">/* LCD */</span>

	<span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">32</span><span class="p">;</span>

	<span class="cm">/* patch index */</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1680x1050</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span>     <span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1280x800</span><span class="p">)</span>  <span class="n">tempal</span> <span class="o">=</span>  <span class="mi">9</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1400x1050</span><span class="p">)</span> <span class="n">tempal</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x800</span><span class="p">)</span> <span class="o">||</span>
		  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x800_2</span><span class="p">)</span> <span class="o">||</span>
		  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x854</span><span class="p">))</span> <span class="p">{</span>
	   <span class="k">if</span>     <span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1280x768</span><span class="p">)</span>  <span class="n">tempal</span> <span class="o">=</span>  <span class="mi">9</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
	   <span class="cm">/* Pass 1:1 only (center-screen handled outside) */</span>
	   <span class="cm">/* This is never called for the panel&#39;s native resolution */</span>
	   <span class="cm">/* since Pass1:1 will not be set in this case */</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">tempal</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC_NS</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_COMPAQ1280</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">))</span> <span class="p">{</span>
		 <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
		 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>
<span class="cp">#endif</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>						  	<span class="cm">/* TV */</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
	   <span class="cm">/* if(SiS_Pr-&gt;SiS_VGAVDE &gt; 480) SiS_Pr-&gt;SiS_TVMode &amp;= (~TVSetTVSimuMode); */</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">))</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span>	<span class="n">tempbx</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span>	<span class="n">tempbx</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
	   <span class="k">else</span>						<span class="n">tempbx</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">)</span>	<span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span>		<span class="n">tempbx</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	   <span class="k">else</span>						<span class="n">tempbx</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">)</span>	<span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="p">}</span>

     <span class="p">}</span>

     <span class="n">tempal</span> <span class="o">&amp;=</span> <span class="mh">0x3F</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTVNoHiVision</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">switch</span><span class="p">(</span><span class="n">resinfo</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">case</span> <span class="n">SIS_RI_720x480</span>:
	      <span class="n">tempal</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetPAL</span> <span class="o">|</span> <span class="n">TVSetPALN</span><span class="p">))</span>	<span class="n">tempal</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="n">SIS_RI_720x576</span>:
	   <span class="k">case</span> <span class="n">SIS_RI_768x576</span>:
	   <span class="k">case</span> <span class="n">SIS_RI_1024x576</span>: <span class="cm">/* Not in NTSC or YPBPR mode (except 1080i)! */</span>
	      <span class="n">tempal</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span>	<span class="n">tempal</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="n">SIS_RI_800x480</span>:
	      <span class="n">tempal</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="n">SIS_RI_512x384</span>:
	   <span class="k">case</span> <span class="n">SIS_RI_1024x768</span>:
	      <span class="n">tempal</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span>	<span class="n">tempal</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="n">SIS_RI_1280x720</span>:
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span>	<span class="n">tempal</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>

     <span class="o">*</span><span class="n">CRT2Index</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>
     <span class="o">*</span><span class="n">ResIndex</span> <span class="o">=</span> <span class="n">tempal</span><span class="p">;</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>   <span class="cm">/* LVDS, 301B-DH (if running on LCD) */</span>

     <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="p">{</span>

	<span class="n">tempbx</span> <span class="o">=</span> <span class="mi">90</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">92</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&gt;</span> <span class="n">ModeVGA</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHSOverScan</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">99</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span>      <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">94</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALN</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">96</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">!=</span> <span class="mi">99</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetCHOverScan</span><span class="p">)</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	<span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">Panel_640x480</span>:   <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_320x240_1</span>: <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_320x240_2</span>:
	<span class="k">case</span> <span class="n">Panel_320x240_3</span>: <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_800x600</span>:   <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_1024x600</span>:  <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_1152x768</span>:
	<span class="k">case</span> <span class="n">Panel_1024x768</span>:  <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_1280x768</span>:  <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_1280x1024</span>: <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_1400x1050</span>: <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_1600x1200</span>: <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">28</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
	<span class="k">case</span> <span class="n">Panel_Barco1366</span>: <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="p">}</span>

	<span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">Panel_320x240_1</span>:
	<span class="k">case</span> <span class="n">Panel_320x240_2</span>:
	<span class="k">case</span> <span class="n">Panel_320x240_3</span>:
	<span class="k">case</span> <span class="n">Panel_640x480</span>:
	   <span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1024</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">82</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL848</span> <span class="o">||</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL856</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">84</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
<span class="cp">#endif</span>

     <span class="p">}</span>

     <span class="p">(</span><span class="o">*</span><span class="n">CRT2Index</span><span class="p">)</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>
     <span class="p">(</span><span class="o">*</span><span class="n">ResIndex</span><span class="p">)</span> <span class="o">=</span> <span class="n">tempal</span> <span class="o">&amp;</span> <span class="mh">0x1F</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_GetRAMDAC2DATA</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tempbx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">dotclock</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">modeflag</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tempcx</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCMAX</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCFACT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
     <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_GetModePtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">);</span>

     <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_StandTable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CRTC</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
     <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_StandTable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CRTC</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
     <span class="n">temp1</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_StandTable</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CRTC</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>

     <span class="n">dotclock</span> <span class="o">=</span> <span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">Charx8Dot</span><span class="p">)</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">9</span><span class="p">;</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
     <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_GetRefCRT1CRTC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">,</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseWideCRT2</span><span class="p">);</span>

     <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
     <span class="n">tempax</span> <span class="o">|=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
     <span class="n">tempax</span> <span class="o">&amp;=</span> <span class="mh">0x03FF</span><span class="p">;</span>
     <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
     <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
     <span class="n">tempcx</span> <span class="o">&amp;=</span> <span class="mh">0x0100</span><span class="p">;</span>
     <span class="n">tempcx</span> <span class="o">&lt;&lt;=</span> <span class="mi">2</span><span class="p">;</span>
     <span class="n">tempbx</span> <span class="o">|=</span> <span class="n">tempcx</span><span class="p">;</span>
     <span class="n">temp1</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>

     <span class="n">dotclock</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">|=</span> <span class="mh">0x0100</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">|=</span> <span class="mh">0x0200</span><span class="p">;</span>

  <span class="n">tempax</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="n">tempax</span> <span class="o">*=</span> <span class="n">dotclock</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">tempax</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_CalcPanelLinkTiming</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ResIndex</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">ResIndex</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHTotal</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CModeFlag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">ResIndex</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">ResIndex</span><span class="p">;</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVTotal</span><span class="p">;</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">ResIndex</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	       <span class="n">ResIndex</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC_NS</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">ResIndex</span> <span class="o">==</span> <span class="mh">0x09</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Alternate1600x1200</span><span class="p">)</span>        <span class="n">ResIndex</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span> <span class="cm">/* 1600x1200 LCDA */</span>
	       <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">ResIndex</span> <span class="o">=</span> <span class="mh">0x21</span><span class="p">;</span> <span class="cm">/* 1600x1200 LVDS */</span>
	    <span class="p">}</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NoScaleData</span><span class="p">[</span><span class="n">ResIndex</span><span class="p">].</span><span class="n">VGAHT</span><span class="p">;</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NoScaleData</span><span class="p">[</span><span class="n">ResIndex</span><span class="p">].</span><span class="n">VGAVT</span><span class="p">;</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span>    <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NoScaleData</span><span class="p">[</span><span class="n">ResIndex</span><span class="p">].</span><span class="n">LCDHT</span><span class="p">;</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span>    <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NoScaleData</span><span class="p">[</span><span class="n">ResIndex</span><span class="p">].</span><span class="n">LCDVT</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span><span class="p">;</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="cm">/* This handles custom modes and custom panels */</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span> <span class="o">-</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">);</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_GetCRT2DataLVDS</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
                    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">CRT2Index</span><span class="p">,</span> <span class="n">ResIndex</span><span class="p">,</span> <span class="n">backup</span><span class="p">;</span>
   <span class="k">const</span> <span class="k">struct</span> <span class="n">SiS_LVDSData</span> <span class="o">*</span><span class="n">LVDSData</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

   <span class="n">SiS_GetCRT2ResInfo</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCMAX</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCFACT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NewFlickerMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY1COE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY2COE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY3COE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY4COE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
      <span class="n">SiS_CalcPanelLinkTiming</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
      <span class="n">SiS_CalcLCDACRT1Timing</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>
<span class="cp">#endif</span>

   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

      <span class="cm">/* 301BDH needs LVDS Data */</span>
      <span class="n">backup</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span><span class="p">;</span>
      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">))</span> <span class="p">{</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="n">SiS_GetCRT2Ptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">,</span>
                     		            <span class="o">&amp;</span><span class="n">CRT2Index</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ResIndex</span><span class="p">);</span>

      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">=</span> <span class="n">backup</span><span class="p">;</span>

      <span class="k">switch</span><span class="p">(</span><span class="n">CRT2Index</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">case</span> <span class="mi">10</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDS320x240Data_1</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">14</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDS320x240Data_2</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">12</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDS640x480Data_1</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">16</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDS800x600Data_1</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">18</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDS1024x600Data_1</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">20</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDS1024x768Data_1</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
	 <span class="k">case</span> <span class="mi">80</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDSBARCO1366Data_1</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">81</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDSBARCO1366Data_2</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">82</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDSBARCO1024Data_1</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">84</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDS848x480Data_1</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">85</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDS848x480Data_2</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
<span class="cp">#endif</span>
	 <span class="k">case</span> <span class="mi">90</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVUNTSCData</span><span class="p">;</span>        <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">91</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVONTSCData</span><span class="p">;</span>        <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">92</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVUPALData</span><span class="p">;</span>         <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">93</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVOPALData</span><span class="p">;</span>         <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">94</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVUPALMData</span><span class="p">;</span>        <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">95</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVOPALMData</span><span class="p">;</span>        <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">96</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVUPALNData</span><span class="p">;</span>        <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">97</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVOPALNData</span><span class="p">;</span>        <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="mi">99</span>: <span class="n">LVDSData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVSOPALData</span><span class="p">;</span>	       <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="n">LVDSData</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">=</span> <span class="p">(</span><span class="n">LVDSData</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">VGAHT</span><span class="p">;</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">=</span> <span class="p">(</span><span class="n">LVDSData</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">VGAVT</span><span class="p">;</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span>    <span class="o">=</span> <span class="p">(</span><span class="n">LVDSData</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">LCDHT</span><span class="p">;</span>
	 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span>    <span class="o">=</span> <span class="p">(</span><span class="n">LVDSData</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">LCDVT</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="n">SiS_CalcPanelLinkTiming</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
	  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	  <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">))</span> <span class="o">||</span>
	     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">SetDOSMode</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
	    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span><span class="p">;</span>
            <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">ResIndex</span> <span class="o">&lt;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="p">{</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">;</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
<span class="cp">#endif</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_GetCRT2Data301</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempax</span><span class="p">,</span> <span class="n">tempbx</span><span class="p">,</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">romptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">resinfo</span><span class="p">,</span> <span class="n">CRT2Index</span><span class="p">,</span> <span class="n">ResIndex</span><span class="p">;</span>
  <span class="k">const</span> <span class="k">struct</span> <span class="n">SiS_LCDData</span> <span class="o">*</span><span class="n">LCDPtr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">const</span> <span class="k">struct</span> <span class="n">SiS_TVData</span>  <span class="o">*</span><span class="n">TVPtr</span>  <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="kt">short</span> <span class="n">resinfo661</span><span class="p">;</span>
<span class="cp">#endif</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ResInfo</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CModeFlag</span><span class="p">;</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
     <span class="n">resinfo661</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">ROMMODEIDX661</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span>   <span class="o">&amp;&amp;</span>
	 <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	 <span class="p">(</span><span class="n">resinfo661</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>                     <span class="o">&amp;&amp;</span>
	 <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NeedRomModeData</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">((</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">GetLCDStructPtr661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">romptr</span> <span class="o">=</span> <span class="p">(</span><span class="n">SISGETROMW</span><span class="p">(</span><span class="mi">21</span><span class="p">))))</span> <span class="p">{</span>
	      <span class="n">romptr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">resinfo661</span> <span class="o">*</span> <span class="mi">10</span><span class="p">);</span>
	      <span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
<span class="cp">#endif</span>
  <span class="p">}</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NewFlickerMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY1COE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY2COE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY3COE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY4COE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="n">SiS_GetCRT2ResInfo</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">)</span> <span class="p">{</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>

	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCMAX</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCFACT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span>       <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span>       <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">;</span>

	<span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHTotal</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">tempax</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVTotal</span><span class="p">;</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	<span class="n">SiS_GetRAMDAC2DATA</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>

     <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">SiS_GetCRT2Ptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">,</span><span class="n">RefreshRateTableIndex</span><span class="p">,</span>
		    <span class="o">&amp;</span><span class="n">CRT2Index</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ResIndex</span><span class="p">);</span>

     <span class="k">switch</span><span class="p">(</span><span class="n">CRT2Index</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span>  <span class="mi">2</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ExtHiTVData</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span>  <span class="mi">3</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ExtPALData</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span>  <span class="mi">4</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ExtNTSCData</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span>  <span class="mi">5</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Ext525iData</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span>  <span class="mi">6</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Ext525pData</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span>  <span class="mi">7</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Ext750pData</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span>  <span class="mi">8</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_StPALData</span><span class="p">;</span>     <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span>  <span class="mi">9</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_StNTSCData</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">10</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_St525iData</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">11</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_St525pData</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">12</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_St750pData</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">13</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_St1HiTVData</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">14</span>: <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_St2HiTVData</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span> <span class="n">TVPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_StPALData</span><span class="p">;</span>     <span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCMAX</span>  <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RVBHCMAX</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCFACT</span> <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RVBHCFACT</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span>     <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">VGAHT</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span>     <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">VGAVT</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span>       <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">TVHDE</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span>       <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">TVVDE</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span>   <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RVBHRS2</span> <span class="o">&amp;</span> <span class="mh">0x0fff</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS</span> <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">HALFRVBHRS</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span> <span class="o">=</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">;</span>
	   <span class="n">tempax</span> <span class="o">=</span> <span class="p">((</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RVBHRS2</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RVBHRS2</span> <span class="o">&amp;</span> <span class="mh">0x8000</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span> <span class="o">-=</span> <span class="n">tempax</span><span class="p">;</span>
	   <span class="k">else</span>                                   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span> <span class="o">+=</span> <span class="n">tempax</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS</span>    <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RVBHRS</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NewFlickerMode</span> <span class="o">=</span> <span class="p">((</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">FlickerMode</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">if</span><span class="p">((</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_960x600</span><span class="p">)</span>   <span class="o">||</span>
	   <span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1024x768</span><span class="p">)</span>  <span class="o">||</span>
	   <span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1280x1024</span><span class="p">)</span> <span class="o">||</span>
	   <span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1280x720</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NewFlickerMode</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">350</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">|=</span> <span class="n">TVSetTVSimuMode</span><span class="p">;</span>

	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">ExtHiTVHT</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="n">ExtHiTVVT</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">StHiTVHT</span><span class="p">;</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="n">StHiTVVT</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="mi">1650</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="mi">750</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">NTSCHT</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSet525p1024</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">NTSC2HT</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="n">NTSCVT</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">NTSCHT</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSC1024</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">NTSC2HT</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="n">NTSCVT</span><span class="p">;</span>
	<span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY1COE</span> <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RY1COE</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY2COE</span> <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RY2COE</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY3COE</span> <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RY3COE</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY4COE</span> <span class="o">=</span> <span class="p">(</span><span class="n">TVPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RY4COE</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY1COE</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY2COE</span> <span class="o">=</span> <span class="mh">0xf4</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY3COE</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY4COE</span> <span class="o">=</span> <span class="mh">0x38</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">NTSCHT</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSC1024</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">NTSC2HT</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="n">NTSCVT</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">PALHT</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="n">PALVT</span><span class="p">;</span>
	<span class="p">}</span>

     <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCMAX</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCFACT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>

	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span>   <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span>   <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">;</span>

	<span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHTotal</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">=</span> <span class="n">tempax</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVTotal</span><span class="p">;</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	<span class="n">bool</span> <span class="n">gotit</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)))</span> <span class="p">{</span>

	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span>    <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span>    <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span><span class="p">;</span>
	   <span class="n">gotit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCMAX</span>  <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="p">];</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCFACT</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span>     <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">|</span> <span class="p">((</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span>     <span class="o">=</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span>        <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">|</span> <span class="p">((</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span>        <span class="o">=</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span>   <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span> <span class="o">|</span> <span class="p">((</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span> <span class="o">=</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">;</span>
	      <span class="n">tempax</span> <span class="o">=</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span> <span class="o">-=</span> <span class="n">tempax</span><span class="p">;</span>
	      <span class="k">else</span>                         <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span> <span class="o">+=</span> <span class="n">tempax</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span><span class="p">)</span> <span class="n">gotit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	   <span class="k">else</span> <span class="p">{</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">|=</span> <span class="n">DontExpandLCD</span><span class="p">;</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">LCDPass11</span><span class="p">;</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCMAX</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCFACT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span>   <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span><span class="p">;</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span>   <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span><span class="p">;</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span>      <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span><span class="p">;</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span>      <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span><span class="p">;</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	      <span class="n">gotit</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	   <span class="p">}</span>
<span class="cp">#endif</span>

	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">gotit</span><span class="p">)</span> <span class="p">{</span>

	   <span class="n">SiS_GetCRT2Ptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">,</span><span class="n">RefreshRateTableIndex</span><span class="p">,</span>
			  <span class="o">&amp;</span><span class="n">CRT2Index</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ResIndex</span><span class="p">);</span>

	   <span class="k">switch</span><span class="p">(</span><span class="n">CRT2Index</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">case</span> <span class="n">Panel_1024x768</span>      : <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ExtLCD1024x768Data</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1024x768</span>  <span class="o">+</span> <span class="mi">32</span>: <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_St2LCD1024x768Data</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1280x720</span>      :
	      <span class="k">case</span> <span class="n">Panel_1280x720</span>  <span class="o">+</span> <span class="mi">32</span>: <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCD1280x720Data</span><span class="p">;</span>      <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1280x768_2</span>    : <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ExtLCD1280x768_2Data</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1280x768_2</span><span class="o">+</span> <span class="mi">32</span>: <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_StLCD1280x768_2Data</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1280x800</span>      :
	      <span class="k">case</span> <span class="n">Panel_1280x800</span>  <span class="o">+</span> <span class="mi">32</span>: <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCD1280x800Data</span><span class="p">;</span>      <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1280x800_2</span>    :
	      <span class="k">case</span> <span class="n">Panel_1280x800_2</span><span class="o">+</span> <span class="mi">32</span>: <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCD1280x800_2Data</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1280x854</span>      :
	      <span class="k">case</span> <span class="n">Panel_1280x854</span>  <span class="o">+</span> <span class="mi">32</span>: <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCD1280x854Data</span><span class="p">;</span>      <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1280x960</span>      :
	      <span class="k">case</span> <span class="n">Panel_1280x960</span>  <span class="o">+</span> <span class="mi">32</span>: <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCD1280x960Data</span><span class="p">;</span>      <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1280x1024</span>     : <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ExtLCD1280x1024Data</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1280x1024</span> <span class="o">+</span> <span class="mi">32</span>: <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_St2LCD1280x1024Data</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1400x1050</span>     : <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ExtLCD1400x1050Data</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1400x1050</span> <span class="o">+</span> <span class="mi">32</span>: <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_StLCD1400x1050Data</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1600x1200</span>     : <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ExtLCD1600x1200Data</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1600x1200</span> <span class="o">+</span> <span class="mi">32</span>: <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_StLCD1600x1200Data</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1680x1050</span>     :
	      <span class="k">case</span> <span class="n">Panel_1680x1050</span> <span class="o">+</span> <span class="mi">32</span>: <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCD1680x1050Data</span><span class="p">;</span>     <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">100</span>		       : <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NoScaleData</span><span class="p">;</span>	    <span class="k">break</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
	      <span class="k">case</span> <span class="mi">200</span>                 : <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS310_ExtCompaq1280x1024Data</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">201</span>                 : <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_St2LCD1280x1024Data</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
<span class="cp">#endif</span>
	      <span class="k">default</span>                  <span class="o">:</span> <span class="n">LCDPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ExtLCD1024x768Data</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
	   <span class="p">}</span>

	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCMAX</span>  <span class="o">=</span> <span class="p">(</span><span class="n">LCDPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RVBHCMAX</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCFACT</span> <span class="o">=</span> <span class="p">(</span><span class="n">LCDPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RVBHCFACT</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span>     <span class="o">=</span> <span class="p">(</span><span class="n">LCDPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">VGAHT</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span>     <span class="o">=</span> <span class="p">(</span><span class="n">LCDPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">VGAVT</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span>        <span class="o">=</span> <span class="p">(</span><span class="n">LCDPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">LCDHT</span><span class="p">;</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span>        <span class="o">=</span> <span class="p">(</span><span class="n">LCDPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">LCDVT</span><span class="p">;</span>

        <span class="p">}</span>

	<span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span><span class="p">;</span>
	<span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">;</span>

	<span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">Panel_1024x768</span>:
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span>     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">350</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">560</span><span class="p">;</span>
		 <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">400</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="k">if</span>     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">357</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">527</span><span class="p">;</span>
	      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">420</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">620</span><span class="p">;</span>
	      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">525</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">775</span><span class="p">;</span>
	      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">600</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">775</span><span class="p">;</span>
	      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">350</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">560</span><span class="p">;</span>
	      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">400</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">640</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_1280x960</span>:
	   <span class="k">if</span>     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">350</span><span class="p">)</span>  <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">400</span><span class="p">)</span>  <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">1024</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">960</span><span class="p">;</span>
	   <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_1280x1024</span>:
	   <span class="k">if</span>     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">360</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">768</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">375</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">405</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">864</span><span class="p">;</span>
	   <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_1600x1200</span>:
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="p">{</span>
	      <span class="k">if</span>     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">350</span><span class="p">)</span>  <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">875</span><span class="p">;</span>
	      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">400</span><span class="p">)</span>  <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">;</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span> <span class="o">=</span> <span class="n">tempax</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_GetCRT2Data</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
                <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">SiS_GetCRT2DataLVDS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">))</span> <span class="p">{</span>
	    <span class="cm">/* Need LVDS Data for LCD on 301B-DH */</span>
	    <span class="n">SiS_GetCRT2DataLVDS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="n">SiS_GetCRT2Data301</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	 <span class="p">}</span>
      <span class="p">}</span>

   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

      <span class="n">SiS_GetCRT2DataLVDS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>

   <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*         GET LVDS DES (SKEW) DATA          */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">SiS_LVDSDes</span> <span class="o">*</span>
<span class="nf">SiS_GetLVDSDesPtr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">const</span> <span class="k">struct</span> <span class="n">SiS_LVDSDes</span> <span class="o">*</span><span class="n">PanelDesPtr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">PanelDesPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelType04_1a</span><span class="p">;</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
		  <span class="n">PanelDesPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelType04_2a</span><span class="p">;</span>
	       <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1024</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">PanelDesPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelType04_1b</span><span class="p">;</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
		  <span class="n">PanelDesPtr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PanelType04_2b</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="cp">#endif</span>
   <span class="k">return</span> <span class="n">PanelDesPtr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_GetLVDSDesData</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
                   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">ResIndex</span><span class="p">;</span>
  <span class="k">const</span> <span class="k">struct</span> <span class="n">SiS_LVDSDes</span> <span class="o">*</span><span class="n">PanelDesPtr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="cm">/* Some special cases */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>

     <span class="cm">/* Trumpion */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_TRUMPION</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="cm">/* 640x480 on LVDS */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_640x480</span> <span class="o">&amp;&amp;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
	   <span class="k">if</span>     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&gt;=</span> <span class="mi">480</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="mi">436</span><span class="p">;</span>
	   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&gt;=</span> <span class="mi">350</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="mi">440</span><span class="p">;</span>
	   <span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>

  <span class="p">}</span> <span class="cm">/* LCD */</span>

  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> 		         <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_Custom</span><span class="p">)</span>   <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL848</span><span class="p">)</span>      <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL856</span><span class="p">)</span>      <span class="o">||</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
     <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="n">ResIndex</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span><span class="p">;</span>
  <span class="k">else</span>               <span class="n">ResIndex</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC</span><span class="p">;</span>

  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
	<span class="cm">/* non-pass 1:1 only, see above */</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">-</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">-</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CUT_UNIWILL1024</span>:
	<span class="k">case</span> <span class="n">CUT_UNIWILL10242</span>:
	<span class="k">case</span> <span class="n">CUT_CLEVO1400</span>:
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">Panel_1280x1024</span>:
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">!=</span> <span class="n">CUT_COMPAQ1280</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">Panel_1280x800</span>:	<span class="cm">/* Verified for Averatec 6240 */</span>
	<span class="k">case</span> <span class="n">Panel_1280x800_2</span>:	<span class="cm">/* Verified for Asus A4L */</span>
	<span class="k">case</span> <span class="n">Panel_1280x854</span>:    <span class="cm">/* Not verified yet FIXME */</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	   <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>
<span class="cp">#endif</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="p">{</span>

	<span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">ResIndex</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
	<span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">PanelDesPtr</span> <span class="o">=</span> <span class="n">SiS_GetLVDSDesPtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>

	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="p">(</span><span class="n">PanelDesPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">LCDHDES</span><span class="p">;</span>
	<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="p">(</span><span class="n">PanelDesPtr</span><span class="o">+</span><span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">LCDVDES</span><span class="p">;</span>

     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">-</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">-</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">case</span> <span class="n">Panel_800x600</span>:
	      <span class="k">case</span> <span class="n">Panel_1024x768</span>:
	      <span class="k">case</span> <span class="n">Panel_1280x1024</span>:
		 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span><span class="p">;</span>
		 <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="n">Panel_1400x1050</span>:
		 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
		 <span class="k">break</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
	   <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">case</span> <span class="n">Panel_800x600</span>:
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span> <span class="o">+</span> <span class="mi">3</span><span class="p">;</span>
		 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span><span class="p">;</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">400</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
		 <span class="k">else</span>                          <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">-=</span> <span class="mi">4</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="n">Panel_1024x768</span>:
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&lt;=</span> <span class="mi">400</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">8</span><span class="p">;</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&lt;=</span> <span class="mi">350</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">12</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="n">Panel_1024x600</span>:
	   <span class="nl">default:</span>
	      <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">==</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		 <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="p">}</span>

	   <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">case</span> <span class="mi">1</span>:
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="mi">3</span>: <span class="cm">/* 640x480 only? */</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
	      <span class="k">if</span>     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&gt;=</span> <span class="mi">480</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
	      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="mi">436</span><span class="p">;</span>
	      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&gt;=</span> <span class="mi">350</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="mi">440</span><span class="p">;</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="p">}</span>
<span class="cp">#endif</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
	   <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">case</span> <span class="n">Panel_1024x768</span>:
	   <span class="k">case</span> <span class="n">Panel_1280x1024</span>:
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">)</span> <span class="p">{</span>
	         <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="n">Panel_320x240_1</span>:
	   <span class="k">case</span> <span class="n">Panel_320x240_2</span>:
	   <span class="k">case</span> <span class="n">Panel_320x240_3</span>:
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="mi">524</span><span class="p">;</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="p">}</span>
<span class="cp">#endif</span>
	<span class="p">}</span>
     <span class="p">}</span>

     <span class="k">if</span><span class="p">((</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
	<span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">))</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">632</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">SetDOSMode</span><span class="p">))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">!=</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">&gt;=</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	         <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">))</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">320</span><span class="p">;</span>
	         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span>  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">804</span><span class="p">;</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">704</span><span class="p">;</span>
		    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">))</span> <span class="p">{</span>
		       <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">320</span><span class="p">;</span>
		       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">632</span><span class="p">;</span>
		       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="mi">542</span><span class="p">;</span>
        	    <span class="p">}</span>
<span class="cp">#endif</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*           DISABLE VIDEO BRIDGE            */</span>
<span class="cm">/*********************************************/</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">SiS_HandlePWD</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#ifdef SET_PWD</span>
   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">romptr</span> <span class="o">=</span> <span class="n">GetLCDStructPtr661_2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">drivermode</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISPWD</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
       <span class="p">(</span><span class="n">romptr</span><span class="p">)</span>				<span class="o">&amp;&amp;</span>
       <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PWDOffset</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x2b</span><span class="p">,</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PWDOffset</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]);</span>
      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x2c</span><span class="p">,</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PWDOffset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PWDOffset</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]);</span>
      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x2e</span><span class="p">,</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PWDOffset</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]);</span>
      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x2f</span><span class="p">,</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PWDOffset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]);</span>
      <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
      <span class="k">if</span><span class="p">((</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x06</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">drivermode</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
	 <span class="n">ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x27</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
   <span class="p">}</span>
<span class="cp">#endif</span>
   <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/* NEVER use any variables (VBInfo), this will be called</span>
<span class="cm"> * from outside the context of modeswitch!</span>
<span class="cm"> * MUST call getVBType before calling this</span>
<span class="cm"> */</span>
<span class="kt">void</span>
<span class="nf">SiS_DisableBridge</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempah</span><span class="p">,</span> <span class="n">pushax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">modenum</span><span class="p">;</span>
<span class="cp">#endif</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* ===== For 30xB/C/LV ===== */</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300	   </span><span class="cm">/* 300 series */</span><span class="cp"></span>

	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23b</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0xFE</span><span class="p">);</span>
	      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		 <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xF7</span><span class="p">,</span><span class="mh">0x08</span><span class="p">);</span>
	      <span class="p">}</span>
	      <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Is301B</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">);</span>
	      <span class="n">SiS_ShortDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
	   <span class="p">}</span>
	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>
	   <span class="n">SiS_DisplayOff</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>
	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>
	   <span class="n">SiS_UnLockCRT2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
	      <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">||</span>
	       <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23d</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	         <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0xFD</span><span class="p">);</span>
	      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		 <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xFB</span><span class="p">,</span><span class="mh">0x04</span><span class="p">);</span>
	      <span class="p">}</span>
	   <span class="p">}</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_300 */</span><span class="cp"></span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315	   </span><span class="cm">/* 315 series */</span><span class="cp"></span>

	   <span class="kt">int</span> <span class="n">didpwd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	   <span class="n">bool</span> <span class="n">custom1</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_COMPAQ1280</span><span class="p">)</span> <span class="o">||</span>
	                  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_CLEVO1400</span><span class="p">);</span>

	   <span class="n">modenum</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x34</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">;</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef SET_EMI</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISEMI</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">!=</span> <span class="n">CUT_CLEVO1400</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0x0c</span><span class="p">);</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
<span class="cp">#endif</span>

	      <span class="n">didpwd</span> <span class="o">=</span> <span class="n">SiS_HandlePWD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

	      <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">modenum</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span>           <span class="o">||</span>
		  <span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span>      <span class="o">||</span>
		  <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">didpwd</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0xfe</span><span class="p">);</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">custom1</span><span class="p">)</span> <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		    <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0xfc</span><span class="p">);</span>
		 <span class="p">}</span>
	      <span class="p">}</span>

	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">custom1</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xff00</span><span class="p">);</span>
		 <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xe000</span><span class="p">);</span>
		 <span class="n">SiS_SetRegByte</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c6</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
		 <span class="n">pushax</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x06</span><span class="p">);</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="mh">0xE3</span><span class="p">);</span>
		 <span class="p">}</span>
	         <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	      <span class="p">}</span>

	   <span class="p">}</span>

	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsNotM650orLater</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	      <span class="cm">/* if(SiS_Pr-&gt;ChipType &lt; SIS_340) {*/</span>
		 <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0xef</span><span class="p">;</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0xf7</span><span class="p">;</span>
		 <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x4c</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	      <span class="cm">/*}*/</span>
	   <span class="p">}</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="o">~</span><span class="mh">0x10</span><span class="p">);</span>
	   <span class="p">}</span>

	   <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x3f</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x7f</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0xbf</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>

	   <span class="k">if</span><span class="p">((</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="o">||</span>
	      <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">modenum</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)))</span> <span class="p">{</span>

	      <span class="n">SiS_DisplayOff</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	      <span class="p">}</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>

	   <span class="p">}</span>

	   <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">||</span>
	      <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">modenum</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)))</span> <span class="p">{</span>

	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
		 <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xdf</span><span class="p">);</span>
		 <span class="n">SiS_DisplayOff</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	      <span class="p">}</span>
	      <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>

	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	      <span class="p">}</span>

	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>
	      <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	      <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

	   <span class="p">}</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsNotM650orLater</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2e</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>
	   <span class="p">}</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>

	      <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span>  <span class="o">&amp;&amp;</span>
		  <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">&amp;&amp;</span>
		  <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>

		 <span class="k">if</span><span class="p">(</span><span class="n">custom1</span><span class="p">)</span> <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">didpwd</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0xFD</span><span class="p">);</span>
		 <span class="p">}</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">custom1</span><span class="p">)</span> <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	      <span class="p">}</span>

	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">custom1</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="n">pushax</span><span class="p">);</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISEMI</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsVAorLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
		       <span class="n">SiS_PanelDelayLoop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
		    <span class="p">}</span>
		 <span class="p">}</span>
	      <span class="p">}</span>

	   <span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>

	<span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>     <span class="cm">/* ============ For 301 ================ */</span>

        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23b</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xF7</span><span class="p">,</span><span class="mh">0x08</span><span class="p">);</span>
	      <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	   <span class="p">}</span>
<span class="cp">#endif</span>
	<span class="p">}</span>

	<span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>           <span class="cm">/* disable VB */</span>
	<span class="n">SiS_DisplayOff</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>                <span class="cm">/* disable lock mode */</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	    <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
	    <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
	    <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>            <span class="cm">/* disable CRT2 */</span>
	    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">||</span>
		<span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23d</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>
		<span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xFB</span><span class="p">,</span><span class="mh">0x04</span><span class="p">);</span>
	    <span class="p">}</span>
<span class="cp">#endif</span>
	<span class="p">}</span>

      <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>     <span class="cm">/* ============ For LVDS =============*/</span>

    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300	</span><span class="cm">/* 300 series */</span><span class="cp"></span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x0E</span><span class="p">,</span><span class="mh">0x09</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_730</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x11</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_WaitVBRetrace</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23b</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xF7</span><span class="p">,</span><span class="mh">0x08</span><span class="p">);</span>
	      <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	   <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x11</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">))</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">))</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23b</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
		    <span class="n">SiS_WaitVBRetrace</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
		    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x06</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1c</span><span class="p">))</span> <span class="p">{</span>
		       <span class="n">SiS_DisplayOff</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
		    <span class="p">}</span>
		    <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xF7</span><span class="p">,</span><span class="mh">0x08</span><span class="p">);</span>
		    <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="n">SiS_DisplayOff</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

	<span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>

	<span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>
	<span class="n">SiS_UnLockCRT2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	<span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
	<span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">||</span>
	    <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23d</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	   <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xFB</span><span class="p">,</span><span class="mh">0x04</span><span class="p">);</span>
	<span class="p">}</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_300 */</span><span class="cp"></span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315	</span><span class="cm">/* 315 series */</span><span class="cp"></span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsNotM650orLater</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	   <span class="cm">/*if(SiS_Pr-&gt;ChipType &lt; SIS_340) { */</span> <span class="cm">/* XGI needs this */</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x4c</span><span class="p">,</span><span class="o">~</span><span class="mh">0x18</span><span class="p">);</span>
	   <span class="cm">/* } */</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x61</span><span class="p">);</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="mh">0xac</span><span class="p">);</span>
		 <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	      <span class="p">}</span>

	      <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">||</span>
		  <span class="p">(</span><span class="n">SiS_IsTVOrYPbPrOrScart</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">,</span><span class="mh">0x3e</span><span class="p">);</span>
	      <span class="p">}</span>
	   <span class="p">}</span>

	   <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">||</span>
	       <span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_Chrontel701xBLOff</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	      <span class="n">SiS_Chrontel701xOff</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	   <span class="p">}</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">!=</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">||</span>
		  <span class="p">(</span><span class="n">SiS_IsTVOrYPbPrOrScart</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
	      <span class="p">}</span>
	   <span class="p">}</span>

	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xF7</span><span class="p">,</span><span class="mh">0x08</span><span class="p">);</span>
	   <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">||</span>
	    <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">||</span>
	    <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsTVOrYPbPrOrScart</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_DisplayOff</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">||</span>
	    <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">||</span>
	    <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2e</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">||</span>
	    <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">||</span>
	    <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0xdf</span><span class="p">);</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_550</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0xbf</span><span class="p">);</span>
		 <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0xef</span><span class="p">);</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsLCDOrLCDA</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
		 <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0xdf</span><span class="p">);</span>
	      <span class="p">}</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0xdf</span><span class="p">);</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	      <span class="cm">/* SiS_SetRegAND(SiS_Pr-&gt;SiS_Part1Port,0x13,0xff); */</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">);</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="n">SiS_UnLockCRT2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_550</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span> <span class="cm">/* DirectDVD PAL?*/</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span> <span class="cm">/* VB clock / 4 ? */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">||</span>
		   <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="o">||</span>
		   <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2e</span><span class="p">,</span><span class="mh">0xf7</span><span class="p">);</span>
	<span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_WeHaveBacklightCtrl</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
		 <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		 <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xFB</span><span class="p">,</span><span class="mh">0x04</span><span class="p">);</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
        <span class="p">}</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>

    <span class="p">}</span>  <span class="cm">/* 315 series */</span>

  <span class="p">}</span>  <span class="cm">/* LVDS */</span>

<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*            ENABLE VIDEO BRIDGE            */</span>
<span class="cm">/*********************************************/</span>

<span class="cm">/* NEVER use any variables (VBInfo), this will be called</span>
<span class="cm"> * from outside the context of a mode switch!</span>
<span class="cm"> * MUST call getVBType before calling this</span>
<span class="cm"> */</span>
<span class="k">static</span>
<span class="kt">void</span>
<span class="nf">SiS_EnableBridge</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tempah</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">pushax</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">bool</span> <span class="n">delaylong</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="cp">#endif</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* ====== For 301B et al  ====== */</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300     </span><span class="cm">/* 300 series */</span><span class="cp"></span>

	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0x02</span><span class="p">);</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xFB</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	    <span class="p">}</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">VB_SISLVDS</span> <span class="o">|</span> <span class="n">VB_NoLCD</span><span class="p">))</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23d</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
		  <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	 <span class="p">}</span>

	 <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>

	    <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>   		<span class="cm">/* Enable CRT2 */</span>
	    <span class="n">SiS_DisplayOn</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	    <span class="n">SiS_UnLockCRT2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	    <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0xBF</span><span class="p">);</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_BridgeInSlavemode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	       <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">);</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	       <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span>
	    <span class="p">}</span>
	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">))</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">))</span> <span class="p">{</span>
		  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23b</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
		     <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		  <span class="p">}</span>
		  <span class="n">SiS_WaitVBRetrace</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
		  <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xF7</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	       <span class="p">}</span>
	    <span class="p">}</span>

	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	    <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xDF</span><span class="p">;</span>             <span class="cm">/* lock mode */</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_BridgeInSlavemode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	       <span class="n">tempah</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x30</span><span class="p">);</span>
	       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tempah</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">))</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
	    <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
	    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>        <span class="cm">/* enable VB processor */</span>
	    <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="mh">0xC0</span><span class="p">);</span>
	    <span class="n">SiS_DisplayOn</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
		  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">))</span> <span class="p">{</span>
		     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23b</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
		        <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		     <span class="p">}</span>
		     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
		  <span class="p">}</span>
	       <span class="p">}</span>
	    <span class="p">}</span>

	 <span class="p">}</span>


<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_SIS_300 */</span><span class="cp"></span>

      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315    </span><span class="cm">/* 315 series */</span><span class="cp"></span>

<span class="cp">#ifdef SET_EMI</span>
	 <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">r30</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r31</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r32</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r33</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cr36</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	 <span class="kt">int</span> <span class="n">didpwd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	 <span class="cm">/* unsigned short  emidelay=0; */</span>
<span class="cp">#endif</span>

	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">,</span><span class="mh">0xef</span><span class="p">);</span>
<span class="cp">#ifdef SET_EMI</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISEMI</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0x0c</span><span class="p">);</span>
	    <span class="p">}</span>
<span class="cp">#endif</span>
	 <span class="p">}</span>

	 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsNotM650orLater</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	    <span class="cm">/*if(SiS_Pr-&gt;ChipType &lt; SIS_340) { */</span>
	       <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_LCDAEnabled</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
		  <span class="k">if</span><span class="p">(</span><span class="n">SiS_TVEnabled</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
		  <span class="k">else</span>			    <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	       <span class="p">}</span>
	       <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x4c</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	    <span class="cm">/*}*/</span>
	 <span class="p">}</span>

	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>

	    <span class="n">SiS_SetRegByte</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c6</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	    <span class="n">SiS_DisplayOff</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	    <span class="n">pushax</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x06</span><span class="p">);</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="mh">0xE3</span><span class="p">);</span>
	    <span class="p">}</span>

	    <span class="n">didpwd</span> <span class="o">=</span> <span class="n">SiS_HandlePWD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsVAorLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">didpwd</span><span class="p">)</span> <span class="p">{</span>
		  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">))</span> <span class="p">{</span>
		     <span class="n">SiS_PanelDelayLoop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0x02</span><span class="p">);</span>
		     <span class="n">SiS_PanelDelayLoop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISEMI</span><span class="p">)</span> <span class="p">{</span>
		        <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">17664</span><span class="p">);</span>
		     <span class="p">}</span>
		  <span class="p">}</span>
	       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		  <span class="n">SiS_PanelDelayLoop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISEMI</span><span class="p">)</span> <span class="p">{</span>
		     <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">17664</span><span class="p">);</span>
		  <span class="p">}</span>
	       <span class="p">}</span>
	    <span class="p">}</span>

	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">))</span> <span class="p">{</span>
	       <span class="n">SiS_PanelDelayLoop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
	       <span class="n">delaylong</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	    <span class="p">}</span>

	 <span class="p">}</span>

	 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>

	    <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xDF</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_BridgeInSlavemode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	       <span class="n">tempah</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x30</span><span class="p">);</span>
	       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tempah</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">))</span> <span class="p">{</span>
		  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_LCDAEnabled</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

	    <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>                   <span class="cm">/* enable CRT2 */</span>

	    <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2e</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>
	    <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2e</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>

	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	    <span class="p">}</span>

	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	    <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>

	 <span class="p">}</span>

	 <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
	 <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2e</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>

	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISPOWER</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_LCDAEnabled</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="o">||</span>
	        <span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
	       <span class="cm">/* Enable &quot;LVDS PLL power on&quot; (even on 301C) */</span>
	       <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x2a</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>
	       <span class="cm">/* Enable &quot;LVDS Driver Power on&quot; (even on 301C) */</span>
	       <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>
	    <span class="p">}</span>
	 <span class="p">}</span>

	 <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0xc0</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualEdge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	    <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="n">tempah</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
	 <span class="p">}</span>
	 <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>

	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>

	    <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	    <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
	    <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2e</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>

	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">!=</span> <span class="n">CUT_CLEVO1400</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef SET_EMI</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISEMI</span><span class="p">)</span> <span class="p">{</span>
		  <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0x0c</span><span class="p">);</span>
		  <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2048</span><span class="p">);</span>
	       <span class="p">}</span>
<span class="cp">#endif</span>
	       <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x27</span><span class="p">,</span><span class="mh">0x0c</span><span class="p">);</span>

	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISEMI</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef SET_EMI</span>
		  <span class="n">cr36</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">);</span>

		  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="p">{</span>
		     <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
		     <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">romptr</span> <span class="o">=</span> <span class="n">GetLCDStructPtr661_2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
		     <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span> <span class="cm">/* Reset */</span>
			<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">EMI_30</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">EMI_31</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EMIOffset</span> <span class="o">+</span> <span class="mi">0</span><span class="p">];</span>
			<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">EMI_32</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EMIOffset</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
			<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">EMI_33</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EMIOffset</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
			<span class="k">if</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">EMI_30</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
			<span class="cm">/* emidelay = SISGETROMW((romptr + 0x22)); */</span>
			<span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">HaveEMI</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">HaveEMILCD</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">OverruleEMI</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		     <span class="p">}</span>
		  <span class="p">}</span>

		  <span class="cm">/*                                              (P4_30|0x40)  */</span>
		  <span class="cm">/* Compal 1400x1050: 0x05, 0x60, 0x00                YES  (1.10.7w;  CR36=69)      */</span>
		  <span class="cm">/* Compal 1400x1050: 0x0d, 0x70, 0x40                YES  (1.10.7x;  CR36=69)      */</span>
		  <span class="cm">/* Acer   1280x1024: 0x12, 0xd0, 0x6b                NO   (1.10.9k;  CR36=73)      */</span>
		  <span class="cm">/* Compaq 1280x1024: 0x0d, 0x70, 0x6b                YES  (1.12.04b; CR36=03)      */</span>
		  <span class="cm">/* Clevo   1024x768: 0x05, 0x60, 0x33                NO   (1.10.8e;  CR36=12, DL!) */</span>
		  <span class="cm">/* Clevo   1024x768: 0x0d, 0x70, 0x40 (if type == 3) YES  (1.10.8y;  CR36=?2)      */</span>
		  <span class="cm">/* Clevo   1024x768: 0x05, 0x60, 0x33 (if type != 3) YES  (1.10.8y;  CR36=?2)      */</span>
		  <span class="cm">/* Asus    1024x768: ?                                ?   (1.10.8o;  CR36=?2)      */</span>
		  <span class="cm">/* Asus    1024x768: 0x08, 0x10, 0x3c (problematic)  YES  (1.10.8q;  CR36=22)      */</span>

		  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">HaveEMI</span><span class="p">)</span> <span class="p">{</span>
		     <span class="n">r30</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">EMI_30</span><span class="p">;</span> <span class="n">r31</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">EMI_31</span><span class="p">;</span>
		     <span class="n">r32</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">EMI_32</span><span class="p">;</span> <span class="n">r33</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">EMI_33</span><span class="p">;</span>
		  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		     <span class="n">r30</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		  <span class="p">}</span>

		  <span class="cm">/* EMI_30 is read at driver start; however, the BIOS sets this</span>
<span class="cm">		   * (if it is used) only if the LCD is in use. In case we caught</span>
<span class="cm">		   * the machine while on TV output, this bit is not set and we</span>
<span class="cm">		   * don&#39;t know if it should be set - hence our detection is wrong.</span>
<span class="cm">		   * Work-around this here:</span>
<span class="cm">		   */</span>

		  <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">HaveEMI</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">HaveEMILCD</span><span class="p">))</span> <span class="p">{</span>
		     <span class="k">switch</span><span class="p">((</span><span class="n">cr36</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">))</span> <span class="p">{</span>
		     <span class="k">case</span> <span class="mi">2</span>:
			<span class="n">r30</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_CLEVO1024</span><span class="p">)</span> <span class="n">r30</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x40</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">HaveEMI</span><span class="p">)</span> <span class="p">{</span>
			   <span class="n">r31</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span> <span class="n">r32</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span> <span class="n">r33</span> <span class="o">=</span> <span class="mh">0x33</span><span class="p">;</span>
			   <span class="k">if</span><span class="p">((</span><span class="n">cr36</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x30</span><span class="p">)</span> <span class="p">{</span>
			      <span class="n">r31</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">;</span> <span class="n">r32</span> <span class="o">=</span> <span class="mh">0x70</span><span class="p">;</span> <span class="n">r33</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
			   <span class="p">}</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		     <span class="k">case</span> <span class="mi">3</span>:  <span class="cm">/* 1280x1024 */</span>
			<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_COMPAQ1280</span><span class="p">)</span> <span class="n">r30</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">HaveEMI</span><span class="p">)</span> <span class="p">{</span>
			   <span class="n">r31</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span> <span class="n">r32</span> <span class="o">=</span> <span class="mh">0xd0</span><span class="p">;</span> <span class="n">r33</span> <span class="o">=</span> <span class="mh">0x6b</span><span class="p">;</span>
			   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_COMPAQ1280</span><span class="p">)</span> <span class="p">{</span>
			      <span class="n">r31</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">;</span> <span class="n">r32</span> <span class="o">=</span> <span class="mh">0x70</span><span class="p">;</span> <span class="n">r33</span> <span class="o">=</span> <span class="mh">0x6b</span><span class="p">;</span>
			   <span class="p">}</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		     <span class="k">case</span> <span class="mi">9</span>:  <span class="cm">/* 1400x1050 */</span>
			<span class="n">r30</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">HaveEMI</span><span class="p">)</span> <span class="p">{</span>
			   <span class="n">r31</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span> <span class="n">r32</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span> <span class="n">r33</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
			   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_COMPAL1400_2</span><span class="p">)</span> <span class="p">{</span>
			      <span class="n">r31</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">;</span> <span class="n">r32</span> <span class="o">=</span> <span class="mh">0x70</span><span class="p">;</span> <span class="n">r33</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>  <span class="cm">/* BIOS values */</span>
			   <span class="p">}</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		     <span class="k">case</span> <span class="mi">11</span>: <span class="cm">/* 1600x1200 - unknown */</span>
			<span class="n">r30</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">HaveEMI</span><span class="p">)</span> <span class="p">{</span>
			   <span class="n">r31</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span> <span class="n">r32</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span> <span class="n">r33</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
			<span class="p">}</span>
		     <span class="p">}</span>
                  <span class="p">}</span>

		  <span class="cm">/* BIOS values don&#39;t work so well sometimes */</span>
		  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">OverruleEMI</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef COMPAL_HACK</span>
		     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_COMPAL1400_2</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">((</span><span class="n">cr36</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x09</span><span class="p">)</span> <span class="p">{</span>
			   <span class="n">r30</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span> <span class="n">r31</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span> <span class="n">r32</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span> <span class="n">r33</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
			<span class="p">}</span>
 		     <span class="p">}</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef COMPAQ_HACK</span>
		     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_COMPAQ1280</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">((</span><span class="n">cr36</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">)</span> <span class="p">{</span>
			   <span class="n">r30</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span> <span class="n">r31</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span> <span class="n">r32</span> <span class="o">=</span> <span class="mh">0xd0</span><span class="p">;</span> <span class="n">r33</span> <span class="o">=</span> <span class="mh">0x6b</span><span class="p">;</span>
			<span class="p">}</span>
		     <span class="p">}</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef ASUS_HACK</span>
		     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_ASUSA2H_2</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">((</span><span class="n">cr36</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">)</span> <span class="p">{</span>
			   <span class="cm">/* r30 = 0x60; r31 = 0x05; r32 = 0x60; r33 = 0x33;  */</span>   <span class="cm">/* rev 2 */</span>
			   <span class="cm">/* r30 = 0x20; r31 = 0x05; r32 = 0x60; r33 = 0x33;  */</span>   <span class="cm">/* rev 3 */</span>
			   <span class="cm">/* r30 = 0x60; r31 = 0x0d; r32 = 0x70; r33 = 0x40;  */</span>   <span class="cm">/* rev 4 */</span>
			   <span class="cm">/* r30 = 0x20; r31 = 0x0d; r32 = 0x70; r33 = 0x40;  */</span>   <span class="cm">/* rev 5 */</span>
			<span class="p">}</span>
		     <span class="p">}</span>
<span class="cp">#endif</span>
		  <span class="p">}</span>

		  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">OverruleEMI</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">r30</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">r31</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">r32</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">r33</span><span class="p">)))</span> <span class="p">{</span>
		     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span> <span class="cm">/* Reset */</span>
		     <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2048</span><span class="p">);</span>
		  <span class="p">}</span>
		  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x31</span><span class="p">,</span><span class="n">r31</span><span class="p">);</span>
		  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="n">r32</span><span class="p">);</span>
		  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x33</span><span class="p">,</span><span class="n">r33</span><span class="p">);</span>
<span class="cp">#endif	</span><span class="cm">/* SET_EMI */</span><span class="cp"></span>

		  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x34</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>

<span class="cp">#ifdef SET_EMI</span>
		  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_LCDAEnabled</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="o">||</span>
		      <span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
		     <span class="k">if</span><span class="p">(</span><span class="n">r30</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/*SiS_SetRegOR(SiS_Pr-&gt;SiS_Part4Port,0x2a,0x80);*/</span>
			<span class="n">SiS_PanelDelayLoop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
			<span class="k">if</span><span class="p">(</span><span class="n">delaylong</span><span class="p">)</span> <span class="p">{</span>
			   <span class="n">SiS_PanelDelayLoop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
			   <span class="n">delaylong</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">SiS_WaitVBRetrace</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			<span class="n">SiS_WaitVBRetrace</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
			<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_ASUSA2H_2</span><span class="p">)</span> <span class="p">{</span>
			   <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1280</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span>   <span class="cm">/* Enable */</span>
			<span class="cm">/*SiS_SetRegAND(SiS_Pr-&gt;SiS_Part4Port,0x2a,0x7f);*/</span>
		     <span class="p">}</span>
		  <span class="p">}</span>
<span class="cp">#endif</span>
	       <span class="p">}</span>
	    <span class="p">}</span>

	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_WeHaveBacklightCtrl</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsVAorLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
		  <span class="n">SiS_PanelDelayLoop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
		  <span class="k">if</span><span class="p">(</span><span class="n">delaylong</span><span class="p">)</span> <span class="p">{</span>
		     <span class="n">SiS_PanelDelayLoop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
		  <span class="p">}</span>
		  <span class="n">SiS_WaitVBRetrace</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
		  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISEMI</span><span class="p">)</span> <span class="p">{</span>
		     <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2048</span><span class="p">);</span>
		     <span class="n">SiS_WaitVBRetrace</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
		  <span class="p">}</span>
		  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">didpwd</span><span class="p">)</span> <span class="p">{</span>
		     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
		  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
		  <span class="p">}</span>
	       <span class="p">}</span>
	    <span class="p">}</span>

	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="n">pushax</span><span class="p">);</span>
	    <span class="n">SiS_DisplayOn</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	    <span class="n">SiS_SetRegByte</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c6</span><span class="p">,</span><span class="mh">0xff</span><span class="p">);</span>

	 <span class="p">}</span>

	 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_WeHaveBacklightCtrl</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	    <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>
	 <span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>

      <span class="p">}</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>	<span class="cm">/* ============  For 301 ================ */</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	     <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xFB</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	     <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	  <span class="p">}</span>
       <span class="p">}</span>

       <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xDF</span><span class="p">;</span>          <span class="cm">/* lock mode */</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_BridgeInSlavemode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	  <span class="n">tempah</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x30</span><span class="p">);</span>
	  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tempah</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">))</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
       <span class="p">}</span>
       <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

       <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>                  <span class="cm">/* enable CRT2 */</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2E</span><span class="p">);</span>
	  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">))</span> <span class="p">{</span>
	     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2E</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>         <span class="cm">/* BVBDOENABLE=1 */</span>
	  <span class="p">}</span>
       <span class="p">}</span>

       <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>     <span class="cm">/* enable VB processor */</span>

       <span class="n">SiS_VBLongWait</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
       <span class="n">SiS_DisplayOn</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	  <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>
       <span class="p">}</span>
       <span class="n">SiS_VBLongWait</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	     <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	     <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xF7</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	  <span class="p">}</span>
       <span class="p">}</span>

    <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>   <span class="cm">/* =================== For LVDS ================== */</span>

    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300    </span><span class="cm">/* 300 series */</span><span class="cp"></span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_730</span><span class="p">)</span> <span class="p">{</span>
	     <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	     <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	     <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	  <span class="p">}</span>
	  <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xFB</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23d</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	     <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	  <span class="p">}</span>
       <span class="p">}</span>

       <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
       <span class="n">SiS_DisplayOn</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
       <span class="n">SiS_UnLockCRT2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
       <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0xBF</span><span class="p">);</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_BridgeInSlavemode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	  <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">);</span>
       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span>
       <span class="p">}</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	     <span class="n">SiS_WaitVBRetrace</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	     <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x0E</span><span class="p">,</span><span class="mh">0x0B</span><span class="p">);</span>
	  <span class="p">}</span>
       <span class="p">}</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">))</span> <span class="p">{</span>
	     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_CR36BIOSWord23b</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
		   <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		   <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">SiS_WaitVBRetrace</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
		<span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xF7</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	     <span class="p">}</span>
	  <span class="p">}</span>
       <span class="p">}</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_300 */</span><span class="cp"></span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315    </span><span class="cm">/* 315 series */</span><span class="cp"></span>

       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsNotM650orLater</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	  <span class="cm">/*if(SiS_Pr-&gt;ChipType &lt; SIS_340) {*/</span>  <span class="cm">/* XGI needs this */</span>
	     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x4c</span><span class="p">,</span><span class="mh">0x18</span><span class="p">);</span>
	  <span class="cm">/*}*/</span>
       <span class="p">}</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	     <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xFB</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	     <span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	  <span class="p">}</span>
       <span class="p">}</span>

       <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
       <span class="n">SiS_UnLockCRT2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

       <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2e</span><span class="p">,</span><span class="mh">0xf7</span><span class="p">);</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">);</span>
	  <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x20</span><span class="p">;</span>
	  <span class="n">SiS_Chrontel701xBLOff</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
       <span class="p">}</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">!=</span> <span class="n">SIS_550</span><span class="p">)</span> <span class="p">{</span>
	  <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2e</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>
       <span class="p">}</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	     <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsLCDOrLCDA</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
	     <span class="p">}</span>
	  <span class="p">}</span>
       <span class="p">}</span>

       <span class="n">temp1</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2E</span><span class="p">);</span>
       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">temp1</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">))</span> <span class="p">{</span>
	  <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2E</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
       <span class="p">}</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="p">{</span>
	     <span class="n">SiS_Chrontel701xBLOn</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	  <span class="p">}</span>
       <span class="p">}</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
	     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_550</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span>
		<span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
	     <span class="p">}</span>
	  <span class="p">}</span>
       <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">!=</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
	     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
	  <span class="p">}</span>
       <span class="p">}</span>

       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_WeHaveBacklightCtrl</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	  <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>
       <span class="p">}</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsTVOrYPbPrOrScart</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	     <span class="n">SiS_Chrontel701xOn</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	  <span class="p">}</span>
	  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="o">||</span>
	      <span class="p">(</span><span class="n">SiS_IsLCDOrLCDA</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
	     <span class="n">SiS_ChrontelDoSomething1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	  <span class="p">}</span>
       <span class="p">}</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_WeHaveBacklightCtrl</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	     <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="o">||</span>
		 <span class="p">(</span><span class="n">SiS_IsLCDOrLCDA</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
		<span class="n">SiS_Chrontel701xBLOn</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
		<span class="n">SiS_ChrontelInitTVVSync</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	     <span class="p">}</span>
	  <span class="p">}</span>
       <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_WeHaveBacklightCtrl</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	     <span class="k">if</span><span class="p">(</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">SiS_PanelDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xF7</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	     <span class="p">}</span>
	  <span class="p">}</span>
       <span class="p">}</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>

    <span class="p">}</span> <span class="cm">/* 310 series */</span>

  <span class="p">}</span>  <span class="cm">/* LVDS */</span>

<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*         SET PART 1 REGISTER GROUP         */</span>
<span class="cm">/*********************************************/</span>

<span class="cm">/* Set CRT2 OFFSET / PITCH */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetCRT2Offset</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RRTI</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">offset</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">temp</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

   <span class="n">offset</span> <span class="o">=</span> <span class="n">SiS_GetOffset</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">,</span><span class="n">RRTI</span><span class="p">);</span>

   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x07</span><span class="p">,(</span><span class="n">offset</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">));</span>
   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x09</span><span class="p">,(</span><span class="n">offset</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">));</span>

   <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)(((</span><span class="n">offset</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="n">offset</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">)</span> <span class="n">temp</span><span class="o">++</span><span class="p">;</span>
   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x03</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Set CRT2 sync and PanelLink mode */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetCRT2Sync</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempah</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tempbl</span><span class="p">,</span> <span class="n">infoflag</span><span class="p">;</span>

   <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0xC0</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">infoflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CInfoFlag</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">infoflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_InfoFlag</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>					<span class="cm">/* LVDS */</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">tempah</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDSync</span><span class="p">))</span> <span class="p">{</span>
	 <span class="n">tempah</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="n">tempah</span> <span class="o">=</span> <span class="n">infoflag</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
      <span class="n">tempah</span> <span class="o">&amp;=</span> <span class="mh">0xC0</span><span class="p">;</span>
      <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">))</span> <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1024</span><span class="p">))</span> <span class="p">{</span>
	    <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0xf0</span><span class="p">;</span>
	 <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span><span class="p">)</span> <span class="o">||</span>
	     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_DSTN</span><span class="p">)</span> <span class="o">||</span>
	     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_TRUMPION</span><span class="p">)</span> <span class="o">||</span>
	     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL848</span><span class="p">)</span> <span class="o">||</span>
	     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL856</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
	    <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x30</span><span class="p">;</span>
	 <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span><span class="p">)</span> <span class="o">||</span>
	     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_DSTN</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
	    <span class="n">tempah</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0xc0</span><span class="p">;</span>
	 <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">tempah</span> <span class="o">&gt;&gt;=</span> <span class="mi">3</span><span class="p">;</span>
	    <span class="n">tempah</span> <span class="o">&amp;=</span> <span class="mh">0x18</span><span class="p">;</span>
	    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="mh">0xE7</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	    <span class="cm">/* Don&#39;t care about 12/18/24 bit mode - TV is via VGA, not PL */</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,</span><span class="mh">0xe0</span><span class="p">);</span>
	 <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
      <span class="p">}</span>

   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300  </span><span class="cm">/* ---- 300 series --- */</span><span class="cp"></span>

	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>			<span class="cm">/* 630 - 301B(-DH) */</span>

	    <span class="n">tempah</span> <span class="o">=</span> <span class="n">infoflag</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
	    <span class="n">tempbl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDSync</span><span class="p">)</span> <span class="p">{</span>
		  <span class="n">tempah</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span><span class="p">;</span>
		  <span class="n">tempbl</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempah</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	    <span class="n">tempah</span> <span class="o">&amp;=</span> <span class="mh">0xC0</span><span class="p">;</span>
	    <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">))</span> <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
	    <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0xc0</span><span class="p">;</span>
	    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	    <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)))</span> <span class="p">{</span>
	       <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">,</span><span class="mh">0xf0</span><span class="p">,</span><span class="n">tempbl</span><span class="p">);</span>
	    <span class="p">}</span>

	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>							<span class="cm">/* 630 - 301 */</span>

	    <span class="n">tempah</span> <span class="o">=</span> <span class="p">((</span><span class="n">infoflag</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xc0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">))</span> <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
	    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>

	 <span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_SIS_300 */</span><span class="cp"></span>

      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315  </span><span class="cm">/* ------- 315 series ------ */</span><span class="cp"></span>

	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>	  		<span class="cm">/* 315 - LVDS */</span>

	    <span class="n">tempbl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_COMPAQ1280</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	       <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">))</span> <span class="p">{</span>
	       <span class="n">tempah</span> <span class="o">=</span> <span class="n">infoflag</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDSync</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">tempbl</span> <span class="o">=</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="mh">0xc0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">);</span>
	       <span class="p">}</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_CLEVO1400</span><span class="p">)</span>  <span class="o">&amp;&amp;</span>
		      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">))</span> <span class="p">{</span>
	       <span class="n">tempah</span> <span class="o">=</span> <span class="n">infoflag</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
	       <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	       <span class="n">tempah</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x37</span><span class="p">);</span>
	       <span class="n">tempbl</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempah</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">;</span>
	       <span class="n">tempbl</span> <span class="o">|=</span> <span class="mh">0x08</span><span class="p">;</span>
	       <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">))</span> <span class="n">tempbl</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="n">tempah</span> <span class="o">&amp;=</span> <span class="mh">0xC0</span><span class="p">;</span>
	    <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">))</span> <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span>   <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0xc0</span><span class="p">;</span>
	    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
		  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">,</span><span class="mh">0xf0</span><span class="p">,</span><span class="n">tempbl</span><span class="p">);</span>
	       <span class="p">}</span>
	    <span class="p">}</span>

	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>							<span class="cm">/* 315 - TMDS */</span>

	    <span class="n">tempah</span> <span class="o">=</span> <span class="n">tempbl</span> <span class="o">=</span> <span class="n">infoflag</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">tempbl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	       <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xC</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">))</span> <span class="p">{</span>
		  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
		     <span class="n">tempah</span> <span class="o">=</span> <span class="n">SiS_GetRegByte</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3ca</span><span class="o">+</span><span class="mh">0x02</span><span class="p">));</span>
		  <span class="p">}</span>
	       <span class="p">}</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
		  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDSync</span><span class="p">)</span> <span class="p">{</span>
		       <span class="n">tempah</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span><span class="p">;</span>
		       <span class="n">tempbl</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempah</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">;</span>
		    <span class="p">}</span>
		  <span class="p">}</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	    <span class="n">tempah</span> <span class="o">&amp;=</span> <span class="mh">0xC0</span><span class="p">;</span>
	    <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">))</span> <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="p">{</span>
	       <span class="cm">/* Imitate BIOS bug */</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span>  <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0xc0</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xC</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">))</span> <span class="p">{</span>
	       <span class="n">tempah</span> <span class="o">&gt;&gt;=</span> <span class="mi">3</span><span class="p">;</span>
	       <span class="n">tempah</span> <span class="o">&amp;=</span> <span class="mh">0x18</span><span class="p">;</span>
	       <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="mh">0xe7</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	       <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
		  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
		     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">,</span><span class="mh">0xf0</span><span class="p">,</span><span class="n">tempbl</span><span class="p">);</span>
		  <span class="p">}</span>
	       <span class="p">}</span>
	    <span class="p">}</span>

         <span class="p">}</span>
<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Set CRT2 FIFO on 300/540/630/730 */</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetCRT2FIFO_300</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">modeidindex</span><span class="p">,</span> <span class="n">refreshratetableindex</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">VCLK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MCLK</span><span class="p">,</span> <span class="n">colorth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempbx</span><span class="p">,</span> <span class="n">tempcl</span><span class="p">,</span> <span class="n">CRT1ModeNo</span><span class="p">,</span> <span class="n">CRT2ModeNo</span><span class="p">,</span> <span class="n">SelectRate_backup</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">data</span><span class="p">,</span> <span class="n">pci50</span><span class="p">,</span> <span class="n">pciA0</span><span class="p">;</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">colortharray</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  	<span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span>
  <span class="p">};</span>

  <span class="n">SelectRate_backup</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SelectCRT2Rate</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CRT1UsesCustomMode</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">CRT1ModeNo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Mode</span><span class="p">;</span>                                 <span class="cm">/* get CRT1 ModeNo */</span>
     <span class="n">SiS_SearchModeID</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CRT1ModeNo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">modeidindex</span><span class="p">);</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">ProgrammingCRT2</span><span class="p">);</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SelectCRT2Rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="n">refreshratetableindex</span> <span class="o">=</span> <span class="n">SiS_GetRatePtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">CRT1ModeNo</span><span class="p">,</span> <span class="n">modeidindex</span><span class="p">);</span>

     <span class="k">if</span><span class="p">(</span><span class="n">CRT1ModeNo</span> <span class="o">&gt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* Get VCLK */</span>
	<span class="n">index</span> <span class="o">=</span> <span class="n">SiS_GetRefCRTVCLK</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">refreshratetableindex</span><span class="p">,</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseWide</span><span class="p">);</span>
	<span class="n">VCLK</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VCLKData</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CLOCK</span><span class="p">;</span>

	<span class="cm">/* Get colordepth */</span>
	<span class="n">colorth</span> <span class="o">=</span> <span class="n">SiS_GetColorDepth</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">CRT1ModeNo</span><span class="p">,</span><span class="n">modeidindex</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">colorth</span><span class="p">)</span> <span class="n">colorth</span><span class="o">++</span><span class="p">;</span>
     <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

     <span class="n">CRT1ModeNo</span> <span class="o">=</span> <span class="mh">0xfe</span><span class="p">;</span>

     <span class="cm">/* Get VCLK */</span>
     <span class="n">VCLK</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CSRClock_CRT1</span><span class="p">;</span>

     <span class="cm">/* Get color depth */</span>
     <span class="n">colorth</span> <span class="o">=</span> <span class="n">colortharray</span><span class="p">[((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CModeFlag_CRT1</span> <span class="o">&amp;</span> <span class="n">ModeTypeMask</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)];</span>

  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">CRT1ModeNo</span> <span class="o">&gt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="cm">/* Get MCLK */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_300</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x3A</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1A</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="n">index</span> <span class="o">&amp;=</span> <span class="mh">0x07</span><span class="p">;</span>
     <span class="n">MCLK</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_MCLKData_0</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CLOCK</span><span class="p">;</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x14</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">temp</span><span class="p">)</span> <span class="n">temp</span><span class="o">++</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">&lt;&lt;=</span> <span class="mi">2</span><span class="p">;</span>

     <span class="n">data2</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">-</span> <span class="p">((</span><span class="n">colorth</span> <span class="o">*</span> <span class="n">VCLK</span><span class="p">)</span> <span class="o">/</span> <span class="n">MCLK</span><span class="p">);</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">28</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span> <span class="o">%</span> <span class="n">data2</span><span class="p">;</span>
     <span class="n">data2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">28</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="n">data2</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="n">data2</span><span class="o">++</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_300</span><span class="p">)</span> <span class="p">{</span>

	<span class="n">SiS_GetFIFOThresholdIndex300</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tempbx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tempcl</span><span class="p">);</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">SiS_GetFIFOThresholdB300</span><span class="p">(</span><span class="n">tempbx</span><span class="p">,</span> <span class="n">tempcl</span><span class="p">);</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	<span class="n">pci50</span> <span class="o">=</span> <span class="n">sisfb_read_nbridge_pci_dword</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">);</span>
	<span class="n">pciA0</span> <span class="o">=</span> <span class="n">sisfb_read_nbridge_pci_dword</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_730</span><span class="p">)</span> <span class="p">{</span>

	   <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(((</span><span class="n">pciA0</span> <span class="o">&gt;&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span>
	   <span class="n">index</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(((</span><span class="n">pci50</span> <span class="o">&gt;&gt;</span> <span class="mi">9</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">);</span>

	   <span class="cm">/* BIOS BUG (2.04.5d, 2.04.6a use ah here, which is unset!) */</span>
	   <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="cm">/* -- do it like the BIOS anyway... */</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	   <span class="n">pci50</span> <span class="o">&gt;&gt;=</span> <span class="mi">24</span><span class="p">;</span>
	   <span class="n">pciA0</span> <span class="o">&gt;&gt;=</span> <span class="mi">24</span><span class="p">;</span>

	   <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">pci50</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">;</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">pci50</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span>    <span class="n">index</span> <span class="o">+=</span> <span class="mi">6</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">pciA0</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="n">index</span> <span class="o">+=</span> <span class="mi">24</span><span class="p">;</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="n">index</span> <span class="o">+=</span> <span class="mi">12</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="n">data</span> <span class="o">=</span> <span class="n">SiS_GetLatencyFactor630</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="mi">15</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x14</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">))</span> <span class="n">data</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">;</span>

     <span class="p">}</span>

     <span class="n">data</span> <span class="o">+=</span> <span class="n">data2</span><span class="p">;</span>						<span class="cm">/* CRT1 Request Period */</span>

     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">ProgrammingCRT2</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SelectCRT2Rate</span> <span class="o">=</span> <span class="n">SelectRate_backup</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>

	<span class="n">CRT2ModeNo</span> <span class="o">=</span> <span class="n">ModeNo</span><span class="p">;</span>
	<span class="n">SiS_SearchModeID</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">CRT2ModeNo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">modeidindex</span><span class="p">);</span>

	<span class="n">refreshratetableindex</span> <span class="o">=</span> <span class="n">SiS_GetRatePtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">CRT2ModeNo</span><span class="p">,</span> <span class="n">modeidindex</span><span class="p">);</span>

	<span class="cm">/* Get VCLK  */</span>
	<span class="n">index</span> <span class="o">=</span> <span class="n">SiS_GetVCLK2Ptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">CRT2ModeNo</span><span class="p">,</span> <span class="n">modeidindex</span><span class="p">,</span> <span class="n">refreshratetableindex</span><span class="p">);</span>
	<span class="n">VCLK</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VCLKData</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CLOCK</span><span class="p">;</span>

	<span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1024</span><span class="p">))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x220</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">VCLK</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x229</span><span class="p">]</span> <span class="o">|</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x22a</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	      <span class="p">}</span>
           <span class="p">}</span>
        <span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	<span class="cm">/* Get VCLK */</span>
	<span class="n">CRT2ModeNo</span> <span class="o">=</span> <span class="mh">0xfe</span><span class="p">;</span>
	<span class="n">VCLK</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CSRClock</span><span class="p">;</span>

     <span class="p">}</span>

     <span class="cm">/* Get colordepth */</span>
     <span class="n">colorth</span> <span class="o">=</span> <span class="n">SiS_GetColorDepth</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">CRT2ModeNo</span><span class="p">,</span><span class="n">modeidindex</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">colorth</span><span class="p">)</span> <span class="n">colorth</span><span class="o">++</span><span class="p">;</span>

     <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">*</span> <span class="n">VCLK</span> <span class="o">*</span> <span class="n">colorth</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span> <span class="o">%</span> <span class="p">(</span><span class="n">MCLK</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
     <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">/</span> <span class="p">(</span><span class="n">MCLK</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="n">data</span><span class="o">++</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="n">data</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mh">0x14</span><span class="p">)</span> <span class="n">data</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_300</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">;</span>
	<span class="k">if</span><span class="p">((</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">))</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">;</span>
	<span class="k">if</span><span class="p">((</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_630</span><span class="p">)</span> <span class="o">||</span>
	     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_730</span><span class="p">)</span> <span class="p">)</span>  <span class="o">&amp;&amp;</span>
	   <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipRevision</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">))</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x1b</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0xe0</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_630</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	<span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipRevision</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="n">data</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0xe0</span><span class="p">,</span><span class="n">data</span><span class="p">);</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="cm">/* If mode &lt;= 0x13, we just restore everything */</span>

     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">ProgrammingCRT2</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SelectCRT2Rate</span> <span class="o">=</span> <span class="n">SelectRate_backup</span><span class="p">;</span>

  <span class="p">}</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/* Set CRT2 FIFO on 315/330 series */</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetCRT2FIFO_310</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x3B</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_760</span><span class="p">)</span>      <span class="o">&amp;&amp;</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SysFlags</span> <span class="o">&amp;</span> <span class="n">SF_760LFB</span><span class="p">)</span>  <span class="o">&amp;&amp;</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">==</span> <span class="n">Mode32Bpp</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">&gt;=</span> <span class="mi">1280</span><span class="p">)</span>	  <span class="o">&amp;&amp;</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&gt;=</span> <span class="mi">1024</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2f</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x3b</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x4d</span><span class="p">,</span><span class="mh">0xc0</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2f</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x4d</span><span class="p">,</span><span class="mh">0xc0</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x6e</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="o">~</span><span class="mh">0x3f</span><span class="p">,</span><span class="mh">0x04</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_GetVGAHT2</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tempax</span><span class="p">,</span><span class="n">tempbx</span><span class="p">;</span>

  <span class="n">tempbx</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">)</span> <span class="o">*</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCMAX</span><span class="p">;</span>
  <span class="n">tempax</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">)</span> <span class="o">*</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCFACT</span><span class="p">;</span>
  <span class="n">tempax</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempax</span> <span class="o">*</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span><span class="p">)</span> <span class="o">/</span> <span class="n">tempbx</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">tempax</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Set Part 1 / SiS bridge slave mode */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetGroup1_301</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
                  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">,</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">xres</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">VGAVDE</span><span class="p">;</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">CRTranslation</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
       <span class="cm">/* CR0   CR1   CR2   CR3   CR4   CR5   CR6   CR7   */</span>
	  <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span>
       <span class="cm">/* CR8   CR9   SR0A  SR0B  SR0C  SR0D  SR0E  CR0F  */</span>
	  <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
       <span class="cm">/* CR10  CR11  CR12  CR13  CR14  CR15  CR16  CR17  */</span>
	  <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span>
  <span class="p">};</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CModeFlag</span><span class="p">;</span>
     <span class="n">xres</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHDisplay</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
     <span class="n">xres</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">XRes</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/* The following is only done if bridge is in slave mode: */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">xres</span> <span class="o">&gt;=</span> <span class="mi">1600</span><span class="p">)</span> <span class="p">{</span>  <span class="cm">/* BIOS: == 1600 */</span>
        <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">,</span><span class="mh">0x04</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHTotal</span> <span class="o">=</span> <span class="mi">8224</span><span class="p">;</span>  <span class="cm">/* Max HT, 0x2020, results in 0x3ff in registers */</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHDisplay</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHDisplay</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHBlankStart</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHDisplay</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHBlankStart</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHBlankEnd</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">xres</span> <span class="o">==</span> <span class="mi">1600</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHBlankEnd</span> <span class="o">+=</span> <span class="mi">80</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">-</span> <span class="mi">96</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">))</span> <span class="n">temp</span> <span class="o">-=</span> <span class="mi">32</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x04</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">|=</span> <span class="p">((</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x0b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xc0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">-=</span> <span class="mi">3</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">&lt;&lt;=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHSyncStart</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHSyncEnd</span> <span class="o">=</span> <span class="mh">0xffe8</span><span class="p">;</span> 	<span class="cm">/* results in 0x2000 in registers */</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVTotal</span> <span class="o">=</span> <span class="mi">2049</span><span class="p">;</span>  	<span class="cm">/* Max VT, 0x0801, results in 0x7ff in registers */</span>

  <span class="n">VGAVDE</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">;</span>
  <span class="k">if</span>     <span class="p">(</span><span class="n">VGAVDE</span> <span class="o">==</span>  <span class="mi">357</span><span class="p">)</span> <span class="n">VGAVDE</span> <span class="o">=</span>  <span class="mi">350</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">VGAVDE</span> <span class="o">==</span>  <span class="mi">360</span><span class="p">)</span> <span class="n">VGAVDE</span> <span class="o">=</span>  <span class="mi">350</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">VGAVDE</span> <span class="o">==</span>  <span class="mi">375</span><span class="p">)</span> <span class="n">VGAVDE</span> <span class="o">=</span>  <span class="mi">350</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">VGAVDE</span> <span class="o">==</span>  <span class="mi">405</span><span class="p">)</span> <span class="n">VGAVDE</span> <span class="o">=</span>  <span class="mi">400</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">VGAVDE</span> <span class="o">==</span>  <span class="mi">420</span><span class="p">)</span> <span class="n">VGAVDE</span> <span class="o">=</span>  <span class="mi">400</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">VGAVDE</span> <span class="o">==</span>  <span class="mi">525</span><span class="p">)</span> <span class="n">VGAVDE</span> <span class="o">=</span>  <span class="mi">480</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">VGAVDE</span> <span class="o">==</span> <span class="mi">1056</span><span class="p">)</span> <span class="n">VGAVDE</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVDisplay</span> <span class="o">=</span> <span class="n">VGAVDE</span><span class="p">;</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVBlankStart</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVDisplay</span><span class="p">;</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVBlankEnd</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x3c</span><span class="p">)</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVBlankEnd</span> <span class="o">=</span> <span class="mi">226</span><span class="p">;</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">-</span> <span class="n">VGAVDE</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVSyncStart</span> <span class="o">=</span> <span class="n">VGAVDE</span> <span class="o">+</span> <span class="n">temp</span><span class="p">;</span>

  <span class="n">temp</span> <span class="o">&gt;&gt;=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVSyncEnd</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVSyncStart</span> <span class="o">+</span> <span class="n">temp</span><span class="p">;</span>

  <span class="n">SiS_CalcCRRegisters</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0xE0</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="n">CRTranslation</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0x12</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="n">CRTranslation</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0x15</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0x16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="n">CRTranslation</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0x0c</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="n">CRTranslation</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xE0</span><span class="p">;</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="n">CRTranslation</span><span class="p">[</span><span class="mh">0x0E</span><span class="p">],</span><span class="mh">0x1F</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">DoubleScanMode</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="n">CRTranslation</span><span class="p">[</span><span class="mh">0x09</span><span class="p">],</span><span class="mh">0x5F</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">temp</span> <span class="o">|=</span> <span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x01</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x08</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x16</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>              	<span class="cm">/* SR01: HalfDCLK[3], 8/9 div dotclock[0] */</span>

  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>              	<span class="cm">/* CR14: (text mode: underline location) */</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x12</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>              	<span class="cm">/* CR17: n/a */</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1A</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>                	<span class="cm">/* SR0E, dither[7] */</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetRegByte</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3ca</span><span class="o">+</span><span class="mh">0x02</span><span class="p">));</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>			<span class="cm">/* ? */</span>
<span class="p">}</span>

<span class="cm">/* Setup panel link</span>
<span class="cm"> * This is used for LVDS, LCDA and Chrontel TV output</span>
<span class="cm"> * 300/LVDS+TV, 300/301B-DH, 315/LVDS+TV, 315/LCDA</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetGroup1_LVDS</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">resinfo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">push2</span><span class="p">,</span> <span class="n">tempax</span><span class="p">,</span> <span class="n">tempbx</span><span class="p">,</span> <span class="n">tempcx</span><span class="p">,</span> <span class="n">temp</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">tempeax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tempebx</span><span class="p">,</span> <span class="n">tempecx</span><span class="p">,</span> <span class="n">tempvcfact</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">bool</span> <span class="n">islvds</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="n">issis</span>  <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="n">chkdclkfirst</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">crt2crtc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">pushcx</span><span class="p">;</span>
<span class="cp">#endif</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ResInfo</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
     <span class="n">crt2crtc</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span><span class="p">;</span>
<span class="cp">#endif</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CModeFlag</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
     <span class="n">crt2crtc</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC</span><span class="p">;</span>
<span class="cp">#endif</span>
  <span class="p">}</span>

  <span class="cm">/* is lvds if really LVDS, or 301B-DH with external LVDS transmitter */</span>
  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">islvds</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/* is really sis if sis bridge, but not 301B-DH */</span>
  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)))</span> <span class="p">{</span>
     <span class="n">issis</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">islvds</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_DSTN</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">chkdclkfirst</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS330</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">islvds</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">,</span><span class="mh">0x04</span><span class="p">);</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
        <span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">islvds</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">,</span><span class="mh">0x04</span><span class="p">);</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">);</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xC</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="o">||</span>
	         <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">))</span> <span class="p">{</span>
	         <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
        <span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="cp">#endif</span>

  <span class="cm">/* Horizontal */</span>

  <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">islvds</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_DSTN</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_640x480</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	      <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)))</span> <span class="p">{</span>
	      <span class="n">tempax</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempax</span> <span class="o">&amp;</span> <span class="mh">0x0007</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1A</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>			<span class="cm">/* BPLHDESKEW[2:0]   */</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempax</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x16</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>			<span class="cm">/* BPLHDESKEW[10:3]  */</span>

  <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_1</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_2</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_3</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">tempbx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">tempax</span> <span class="o">+=</span> <span class="n">tempbx</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">tempax</span> <span class="o">&gt;=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">-=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span><span class="p">;</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">tempax</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">)</span> <span class="n">temp</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">temp</span> <span class="o">&gt;&gt;=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x17</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>			<span class="cm">/* BPLHDEE  */</span>

  <span class="n">tempcx</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">-</span> <span class="n">tempbx</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span> <span class="o">!=</span> <span class="mi">999</span><span class="p">)</span> <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRS</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">tempcx</span> <span class="o">+=</span> <span class="n">tempax</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">tempcx</span> <span class="o">&gt;=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span><span class="p">)</span> <span class="n">tempcx</span> <span class="o">-=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span><span class="p">;</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempcx</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_TRUMPION</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">switch</span><span class="p">(</span><span class="n">ModeNo</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">case</span> <span class="mh">0x04</span>:
	   <span class="k">case</span> <span class="mh">0x05</span>:
	   <span class="k">case</span> <span class="mh">0x0d</span>: <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x56</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="mh">0x10</span>: <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="mh">0x13</span>: <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x5f</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="mh">0x40</span>:
	   <span class="k">case</span> <span class="mh">0x41</span>:
	   <span class="k">case</span> <span class="mh">0x4f</span>:
	   <span class="k">case</span> <span class="mh">0x43</span>:
	   <span class="k">case</span> <span class="mh">0x44</span>:
	   <span class="k">case</span> <span class="mh">0x62</span>:
	   <span class="k">case</span> <span class="mh">0x56</span>:
	   <span class="k">case</span> <span class="mh">0x53</span>:
	   <span class="k">case</span> <span class="mh">0x5d</span>:
	   <span class="k">case</span> <span class="mh">0x5e</span>: <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x54</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x14</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>			<span class="cm">/* BPLHRS */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">temp</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span> <span class="o">!=</span> <span class="mi">999</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">tempcx</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelHRE</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span><span class="p">)</span> <span class="n">temp</span> <span class="o">-=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span><span class="p">;</span>
	   <span class="n">temp</span> <span class="o">&gt;&gt;=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">+=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x1F</span><span class="p">;</span>
  <span class="n">temp</span> <span class="o">|=</span> <span class="p">((</span><span class="n">tempcx</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x15</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>			<span class="cm">/* BPLHRE */</span>

  <span class="cm">/* Vertical */</span>

  <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">+</span> <span class="n">tempax</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">-=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span><span class="p">;</span>

  <span class="n">push2</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>

  <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">islvds</span><span class="p">)</span> <span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">else</span>       <span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
      <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> 		    <span class="o">&amp;&amp;</span>
      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span> <span class="o">!=</span> <span class="mi">999</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
     <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRS</span><span class="p">;</span>
     <span class="n">tempbx</span> <span class="o">+=</span> <span class="n">tempcx</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">issis</span><span class="p">)</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">tempbx</span> <span class="o">+=</span> <span class="n">tempcx</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">issis</span><span class="p">)</span>                   <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">-=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span><span class="p">;</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">tempbx</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_TRUMPION</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mh">0xa9</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>			<span class="cm">/* BPLVRS */</span>

  <span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">tempcx</span><span class="o">++</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span> <span class="o">!=</span> <span class="mi">999</span><span class="p">)</span> <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelVRE</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">tempcx</span> <span class="o">+=</span> <span class="n">tempbx</span><span class="p">;</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="n">tempcx</span> <span class="o">&amp;</span> <span class="mh">0x000F</span><span class="p">;</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>	<span class="cm">/* BPLVRE  */</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span> <span class="o">||</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_DSTN</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span> <span class="o">!=</span> <span class="mi">640</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">)</span>  <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">EnableLVDSDDA</span><span class="p">)</span>          <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
  <span class="n">tempbx</span> <span class="o">=</span> <span class="mh">0x87</span><span class="p">;</span>
  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="o">||</span>
     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipRevision</span> <span class="o">&gt;=</span> <span class="mh">0x30</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">tempbx</span> <span class="o">=</span> <span class="mh">0x07</span><span class="p">;</span>
     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">)</span>    <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="cm">/* Chrontel 701x operates in 24bit mode (8-8-8, 2x12bit multiplexed) via VGA2 */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x06</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span>      <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1A</span><span class="p">,</span><span class="n">tempbx</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

  <span class="n">tempbx</span> <span class="o">=</span> <span class="n">push2</span><span class="p">;</span>						<span class="cm">/* BPLVDEE */</span>

  <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span><span class="p">;</span>					<span class="cm">/* BPLVDES */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">case</span> <span class="n">Panel_640x480</span>:
	<span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">;</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_800x600</span>:
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_800x600</span><span class="p">)</span> <span class="n">tempcx</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1024x600</span>:
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1024x600</span><span class="p">)</span> <span class="n">tempcx</span><span class="o">++</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_800x600</span><span class="p">)</span> <span class="n">tempcx</span><span class="o">++</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1024x768</span>:
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1024x768</span><span class="p">)</span> <span class="n">tempcx</span><span class="o">++</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">temp</span> <span class="o">|=</span> <span class="p">((</span><span class="n">tempcx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1D</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1C</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1B</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>

  <span class="cm">/* Vertical scaling */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300      </span><span class="cm">/* 300 series */</span><span class="cp"></span>
     <span class="n">tempeax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempeax</span> <span class="o">%</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">);</span>
     <span class="n">tempeax</span> <span class="o">=</span> <span class="n">tempeax</span> <span class="o">/</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="n">tempeax</span><span class="o">++</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">EnableLVDSDDA</span><span class="p">)</span> <span class="n">tempeax</span> <span class="o">=</span> <span class="mh">0x3F</span><span class="p">;</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>      	<span class="cm">/* BPLVCFACT */</span>
     <span class="n">tempvcfact</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_SIS_300 */</span><span class="cp"></span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315  </span><span class="cm">/* 315 series */</span><span class="cp"></span>
     <span class="n">tempeax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&lt;&lt;</span> <span class="mi">18</span><span class="p">;</span>
     <span class="n">tempebx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempeax</span> <span class="o">%</span> <span class="n">tempebx</span><span class="p">);</span>
     <span class="n">tempeax</span> <span class="o">=</span> <span class="n">tempeax</span> <span class="o">/</span> <span class="n">tempebx</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="n">tempeax</span><span class="o">++</span><span class="p">;</span>
     <span class="n">tempvcfact</span> <span class="o">=</span> <span class="n">tempeax</span><span class="p">;</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x37</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)((</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x00FF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x36</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)((</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x00030000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">==</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x35</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISPART4SCALER</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x3c</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)((</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x00FF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x3b</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(((</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x00030000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>
        <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x3a</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x08</span><span class="p">;</span>
        <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0xf3</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="p">}</span>
<span class="cp">#endif</span>

  <span class="p">}</span>

  <span class="cm">/* Horizontal scaling */</span>

  <span class="n">tempeax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">;</span>		<span class="cm">/* 1f = ( (VGAHDE * 65536) / ( (VGAHDE * 65536) / HDE ) ) - 1*/</span>
  <span class="k">if</span><span class="p">(</span><span class="n">chkdclkfirst</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">tempeax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">tempebx</span> <span class="o">=</span> <span class="n">tempeax</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span> <span class="o">==</span> <span class="n">tempeax</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">tempecx</span> <span class="o">=</span> <span class="mh">0xFFFF</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">tempecx</span> <span class="o">=</span> <span class="n">tempebx</span> <span class="o">/</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">tempebx</span> <span class="o">%</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">)</span> <span class="n">tempecx</span><span class="o">++</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">tempeax</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempebx</span> <span class="o">/</span> <span class="n">tempecx</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">tempeax</span> <span class="o">=</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="n">tempecx</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">tempecx</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempecx</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">);</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(</span><span class="n">tempecx</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">tempeax</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&lt;&lt;</span> <span class="mi">18</span><span class="p">)</span> <span class="o">/</span> <span class="n">tempvcfact</span><span class="p">;</span>
     <span class="n">tempbx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">tempeax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">;</span>
     <span class="n">tempbx</span> <span class="o">=</span> <span class="n">tempvcfact</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
     <span class="n">tempeax</span> <span class="o">/=</span> <span class="n">tempbx</span><span class="p">;</span>
     <span class="n">tempbx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="n">tempbx</span><span class="o">--</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">EnableLVDSDDA</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_DSTN</span><span class="p">))</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">!=</span> <span class="n">Panel_640x480</span><span class="p">)</span>             <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">|</span> <span class="p">((</span><span class="n">tempecx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>

  <span class="n">tempecx</span> <span class="o">&gt;&gt;=</span> <span class="mi">16</span><span class="p">;</span>						<span class="cm">/* BPLHCFACT  */</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">chkdclkfirst</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">tempecx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)((</span><span class="n">tempecx</span> <span class="o">&amp;</span> <span class="mh">0xFF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x22</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(</span><span class="n">tempecx</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x23</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">((</span><span class="n">islvds</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">))</span> <span class="p">{</span>
           <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
	<span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">islvds</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
           <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0x23</span><span class="p">);</span>
           <span class="p">}</span>
        <span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_TRUMPION</span><span class="p">)</span> <span class="p">{</span>
     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">trumpdata</span><span class="p">;</span>
     <span class="kt">int</span>   <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">crt2crtc</span><span class="p">;</span>
     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">TrumpMode13</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>   <span class="o">=</span> <span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">};</span>
     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">TrumpMode10_1</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">};</span>
     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">TrumpMode10_2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">};</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">trumpdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x8001</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)];</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span> <span class="o">==</span> <span class="mh">0x0e</span><span class="p">)</span> <span class="n">j</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">;</span>
	<span class="n">trumpdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">SiS300_TrumpionData</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
     <span class="p">}</span>

     <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0xbf</span><span class="p">);</span>
     <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_SetTrumpionBlock</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">trumpdata</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_SetTrumpionBlock</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">TrumpMode13</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	   <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_SetTrumpionBlock</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">TrumpMode10_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	      <span class="n">SiS_SetTrumpionBlock</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">TrumpMode10_2</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span>
  <span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span> <span class="o">||</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_DSTN</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x25</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x27</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x28</span><span class="p">,</span><span class="mh">0x87</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x29</span><span class="p">,</span><span class="mh">0x5A</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2A</span><span class="p">,</span><span class="mh">0x4B</span><span class="p">);</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x44</span><span class="p">,</span><span class="o">~</span><span class="mh">0x07</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
     <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">;</span>					<span class="cm">/* Blps = lcdhdee(lcdhdes+HDE) + 64 */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_1</span> <span class="o">||</span>
        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_2</span> <span class="o">||</span>
        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_3</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">tempax</span> <span class="o">+=</span> <span class="mi">64</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x38</span><span class="p">,</span><span class="n">tempax</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempax</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x35</span><span class="p">,</span><span class="o">~</span><span class="mh">0x078</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="n">tempax</span> <span class="o">+=</span> <span class="mi">32</span><span class="p">;</span>						<span class="cm">/* Blpe = lBlps+32 */</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x39</span><span class="p">,</span><span class="n">tempax</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3A</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>		<span class="cm">/* Bflml = 0 */</span>
     <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3C</span><span class="p">,</span><span class="o">~</span><span class="mh">0x007</span><span class="p">);</span>

     <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_1</span> <span class="o">||</span>
        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_2</span> <span class="o">||</span>
        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_3</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3B</span><span class="p">,</span><span class="n">tempax</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempax</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3C</span><span class="p">,</span><span class="o">~</span><span class="mh">0x038</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

     <span class="n">tempeax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_1</span> <span class="o">||</span>
        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_2</span> <span class="o">||</span>
        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_3</span><span class="p">)</span> <span class="n">tempeax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">tempeax</span> <span class="o">&lt;&lt;=</span> <span class="mi">2</span><span class="p">;</span>			 			<span class="cm">/* BDxFIFOSTOP = (HDE*4)/128 */</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">;</span>
     <span class="n">tempeax</span> <span class="o">&gt;&gt;=</span> <span class="mi">7</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="n">tempeax</span><span class="o">++</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x45</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3F</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>		<span class="cm">/* BDxWadrst0 */</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3E</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3D</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
     <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3C</span><span class="p">,</span><span class="o">~</span><span class="mh">0x040</span><span class="p">);</span>

     <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_1</span> <span class="o">||</span>
        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_2</span> <span class="o">||</span>
        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_3</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span>						<span class="cm">/* BDxWadroff = HDE*4/8/8 */</span>
     <span class="n">pushcx</span> <span class="o">=</span> <span class="n">tempax</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">tempax</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x43</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempax</span> <span class="o">&amp;</span> <span class="mh">0xFF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="n">temp</span><span class="p">);</span>

     <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">;</span>				 	<span class="cm">/* BDxWadrst1 = BDxWadrst0 + BDxWadroff * VDE */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_1</span> <span class="o">||</span>
        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_2</span> <span class="o">||</span>
        <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_320x240_3</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">tempeax</span> <span class="o">=</span> <span class="n">tempax</span> <span class="o">*</span> <span class="n">pushcx</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x42</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0xFF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x41</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0xFF0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x10</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x01000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">;</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">,</span> <span class="mh">0x7F</span><span class="p">,</span> <span class="n">temp</span><span class="p">);</span>

     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2F</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x03</span><span class="p">,</span><span class="mh">0x50</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2F</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0x38</span><span class="p">);</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2b</span><span class="p">,</span><span class="mh">0x02</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2c</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x35</span><span class="p">,</span><span class="mh">0x0c</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x36</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x37</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x38</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x39</span><span class="p">,</span><span class="mh">0xA0</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3a</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3b</span><span class="p">,</span><span class="mh">0xf0</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3c</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3d</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3e</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x41</span><span class="p">,</span><span class="mh">0x25</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x42</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x43</span><span class="p">,</span><span class="mh">0x14</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x44</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x45</span><span class="p">,</span><span class="mh">0x0a</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>
<span class="p">}</span>

<span class="cm">/* Set Part 1 */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetGroup1</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if defined(CONFIG_FB_SIS_300) || defined(CONFIG_FB_SIS_315)</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
<span class="cp">#endif</span>
  <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">temp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tempax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tempbx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tempcx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bridgeadd</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">pushbx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">CRT1Index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">resinfo</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">tempbl</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="cp">#endif</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetGroup1_LVDS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
     <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CModeFlag</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">CRT1Index</span> <span class="o">=</span> <span class="n">SiS_GetRefCRT1CRTC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">,</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseWideCRT2</span><span class="p">);</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">SiS_SetCRT2Offset</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span> <span class="o">!</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
         <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
         <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span> <span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
	<span class="n">SiS_SetCRT2FIFO_300</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">);</span>
<span class="cp">#endif</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
	<span class="n">SiS_SetCRT2FIFO_310</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
<span class="cp">#endif</span>
     <span class="p">}</span>

     <span class="cm">/* 1. Horizontal setup */</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span> <span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300   </span><span class="cm">/* ------------- 300 series --------------*/</span><span class="cp"></span>

	<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0FF</span><span class="p">;</span>   		  <span class="cm">/* BTVGA2HT 0x08,0x09 */</span>
	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x08</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>              <span class="cm">/* CRT2 Horizontal Total */</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="p">(((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x09</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>    <span class="cm">/* CRT2 Horizontal Total Overflow [7:4] */</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0FF</span><span class="p">;</span>                 <span class="cm">/* BTVGA2HDEE 0x0A,0x0C */</span>
	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x0A</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>              <span class="cm">/* CRT2 Horizontal Display Enable End */</span>

	<span class="n">pushbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">+</span> <span class="mi">12</span><span class="p">;</span>                         <span class="cm">/* bx  BTVGA2HRS 0x0B,0x0C */</span>
	<span class="n">tempcx</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">tempbx</span> <span class="o">=</span> <span class="n">pushbx</span> <span class="o">+</span> <span class="n">tempcx</span><span class="p">;</span>
	<span class="n">tempcx</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tempcx</span> <span class="o">+=</span> <span class="n">tempbx</span><span class="p">;</span>

	<span class="n">bridgeadd</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_SIS_300 */</span><span class="cp"></span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315  </span><span class="cm">/* ------------------- 315/330 series --------------- */</span><span class="cp"></span>

	<span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span><span class="p">;</span>				  <span class="cm">/* BTVGA2HT 0x08,0x09 */</span>
	<span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
	      <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span> <span class="o">+</span> <span class="n">tempax</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
	         <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">-</span> <span class="n">tempax</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>
	<span class="n">tempcx</span><span class="o">--</span><span class="p">;</span>
	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x08</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>            <span class="cm">/* CRT2 Horizontal Total */</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempcx</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">;</span>
	<span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x09</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>    <span class="cm">/* CRT2 Horizontal Total Overflow [7:4] */</span>

	<span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span><span class="p">;</span>				  <span class="cm">/* BTVGA2HDEE 0x0A,0x0C */</span>
	<span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">;</span>
	<span class="n">tempcx</span> <span class="o">-=</span> <span class="n">tempbx</span><span class="p">;</span>
	<span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempbx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
	   <span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>

	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x0A</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>            <span class="cm">/* CRT2 Horizontal Display Enable End */</span>

	<span class="n">pushbx</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>
	<span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tempbx</span> <span class="o">+=</span> <span class="n">tempcx</span><span class="p">;</span>
	<span class="n">tempcx</span> <span class="o">+=</span> <span class="n">tempbx</span><span class="p">;</span>

	<span class="n">bridgeadd</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">)</span> <span class="o">||</span>
		 <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">))</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1280x1024</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">tempcx</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempcx</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x30</span><span class="p">;</span>
		 <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1600x1200</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">tempcx</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempcx</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0xff</span><span class="p">;</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
        <span class="p">}</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>

     <span class="p">}</span>  <span class="cm">/* 315/330 series */</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHSyncStart</span> <span class="o">+</span> <span class="n">bridgeadd</span><span class="p">;</span>
	   <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHSyncEnd</span> <span class="o">+</span> <span class="n">bridgeadd</span><span class="p">;</span>
	   <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
	   <span class="n">tempax</span><span class="o">--</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempcx</span> <span class="o">&gt;</span> <span class="n">tempax</span><span class="p">)</span> <span class="n">tempcx</span> <span class="o">=</span> <span class="n">tempax</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">)</span> <span class="p">{</span>
	   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cr4</span><span class="p">,</span> <span class="n">cr14</span><span class="p">,</span> <span class="n">cr5</span><span class="p">,</span> <span class="n">cr15</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">cr4</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	      <span class="n">cr14</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
	      <span class="n">cr5</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	      <span class="n">cr15</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">cr4</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">CRT1Index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	      <span class="n">cr14</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">CRT1Index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
	      <span class="n">cr5</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">CRT1Index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	      <span class="n">cr15</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">CRT1Index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>
	   <span class="p">}</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="p">((</span><span class="n">cr4</span> <span class="o">|</span> <span class="p">((</span><span class="n">cr14</span> <span class="o">&amp;</span> <span class="mh">0xC0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span> 		    <span class="cm">/* (VGAHRS-3)*8 */</span>
	   <span class="n">tempcx</span> <span class="o">=</span> <span class="p">(((</span><span class="n">cr5</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">cr15</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="o">-</span><span class="mi">2</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>   <span class="cm">/* (VGAHRE-3)*8 */</span>
	   <span class="n">tempcx</span> <span class="o">&amp;=</span> <span class="mh">0x00FF</span><span class="p">;</span>
	   <span class="n">tempcx</span> <span class="o">|=</span> <span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="mh">0xFF00</span><span class="p">);</span>
	   <span class="n">tempbx</span> <span class="o">+=</span> <span class="n">bridgeadd</span><span class="p">;</span>
	   <span class="n">tempcx</span> <span class="o">+=</span> <span class="n">bridgeadd</span><span class="p">;</span>
	   <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
	   <span class="n">tempax</span><span class="o">--</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempcx</span> <span class="o">&gt;</span> <span class="n">tempax</span><span class="p">)</span> <span class="n">tempcx</span> <span class="o">=</span> <span class="n">tempax</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetNTSC1024</span> <span class="o">|</span> <span class="n">TVSet525p1024</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">1040</span><span class="p">;</span>
	   <span class="n">tempcx</span> <span class="o">=</span> <span class="mi">1044</span><span class="p">;</span>   <span class="cm">/* HWCursor bug! */</span>
	<span class="p">}</span>

     <span class="p">}</span>

     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x0B</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>            	  <span class="cm">/* CRT2 Horizontal Retrace Start */</span>

     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x0D</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>               <span class="cm">/* CRT2 Horizontal Retrace End */</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">pushbx</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x0C</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>		  <span class="cm">/* Overflow */</span>

     <span class="cm">/* 2. Vertical setup */</span>

     <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">tempcx</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	         <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToSVIDEO</span> <span class="o">|</span> <span class="n">SetCRT2ToAVIDEO</span><span class="p">))</span> <span class="p">{</span>
	            <span class="n">temp</span><span class="o">--</span><span class="p">;</span>
	         <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">temp</span><span class="o">--</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">temp</span><span class="o">--</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x0E</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>                 <span class="cm">/* CRT2 Vertical Total */</span>

     <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>               <span class="cm">/* CRT2 Vertical Display Enable End */</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x38</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">tempcx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x12</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>                 <span class="cm">/* Overflow */</span>

     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_661</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
	<span class="n">tempax</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>
	<span class="n">tempcx</span><span class="o">++</span><span class="p">;</span>
	<span class="n">tempcx</span> <span class="o">-=</span> <span class="n">tempax</span><span class="p">;</span>
	<span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">tempbx</span> <span class="o">+=</span> <span class="n">tempcx</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">tempcx</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="n">tempcx</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">tempcx</span> <span class="o">+=</span> <span class="n">tempbx</span><span class="p">;</span>
	<span class="n">tempcx</span><span class="o">++</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="n">tempbx</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>                 <span class="cm">/*  BTVGA2VRS     0x10,0x11   */</span>
	<span class="n">tempcx</span> <span class="o">=</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">tempbx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>  <span class="cm">/*  BTVGA2VRE     0x11        */</span>
     <span class="p">}</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVSyncStart</span><span class="p">;</span>
	   <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVSyncEnd</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">)</span> <span class="p">{</span>
	   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cr8</span><span class="p">,</span> <span class="n">cr7</span><span class="p">,</span> <span class="n">cr13</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">cr8</span>    <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	      <span class="n">cr7</span>    <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	      <span class="n">cr13</span>   <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>
	      <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CCRT1CRTC</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">cr8</span>    <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">CRT1Index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	      <span class="n">cr7</span>    <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">CRT1Index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	      <span class="n">cr13</span>   <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">CRT1Index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>
	      <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT1Table</span><span class="p">[</span><span class="n">CRT1Index</span><span class="p">].</span><span class="n">CR</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
	   <span class="p">}</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="n">cr8</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">cr7</span>  <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">|=</span> <span class="mh">0x0100</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">cr7</span>  <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">|=</span> <span class="mh">0x0200</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">cr13</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">|=</span> <span class="mh">0x0400</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x10</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>               <span class="cm">/* CRT2 Vertical Retrace Start */</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x70</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">tempcx</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x11</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>                 <span class="cm">/* CRT2 Vert. Retrace End; Overflow */</span>

     <span class="cm">/* 3. Panel delay compensation */</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300  </span><span class="cm">/* ---------- 300 series -------------- */</span><span class="cp"></span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_300</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span>  <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x2c</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x960</span><span class="p">)</span>     <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x24</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_Custom</span><span class="p">)</span>       <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x2c</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> 	    <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> 	    <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x2c</span><span class="p">;</span>
	      <span class="k">else</span> 					    <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x220</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTVNoYPbPrHiVision</span><span class="p">)</span>
		    <span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x221</span><span class="p">];</span>
		 <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span>
		    <span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x222</span><span class="p">];</span>
		 <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span>
		    <span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x223</span><span class="p">];</span>
		 <span class="k">else</span>
		    <span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x224</span><span class="p">];</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDC</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDC</span><span class="p">;</span>
	   <span class="p">}</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_640x480</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x220</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
	         <span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x220</span><span class="p">];</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDC</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDC</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x3c</span><span class="p">;</span>

	<span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="o">~</span><span class="mh">0x3C</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>   <span class="cm">/* Panel Link Delay Compensation; (Software Command Reset; Power Saving) */</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_300 */</span><span class="cp"></span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315   </span><span class="cm">/* --------------- 315/330 series ---------------*/</span><span class="cp"></span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="p">{</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	      <span class="k">else</span> 		              <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span>
	      <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0xF0</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_650</span><span class="p">)</span> <span class="p">{</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0x0F</span><span class="p">;</span>
		 <span class="p">}</span>
	      <span class="p">}</span>

	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_DSTN</span> <span class="o">||</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_FSTN</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
		 <span class="n">tempbl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		 <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)))</span> <span class="p">{</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x13c</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="n">tempbl</span> <span class="o">=</span> <span class="mh">0xf0</span><span class="p">;</span>
		 <span class="p">}</span>
	      <span class="p">}</span>

	      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="n">tempbl</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>	    <span class="cm">/* Panel Link Delay Compensation */</span>
	   <span class="p">}</span>

	<span class="p">}</span> <span class="cm">/* &lt; 661 */</span>

	<span class="n">tempax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">DoubleScanMode</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span>       <span class="n">tempax</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
	<span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2C</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="n">tempax</span><span class="p">);</span>

<span class="cp">#endif  </span><span class="cm">/* CONFIG_FB_SIS_315 */</span><span class="cp"></span>

     <span class="p">}</span>

  <span class="p">}</span>  <span class="cm">/* Slavemode */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">))</span> <span class="p">{</span>
	<span class="cm">/* For 301BDH with LCD, we set up the Panel Link */</span>
	<span class="n">SiS_SetGroup1_LVDS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_SetGroup1_301</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_SetGroup1_LVDS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_SetGroup1_LVDS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">,</span><span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	   <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="n">SiS_SetGroup1_LVDS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">,</span><span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*         SET PART 2 REGISTER GROUP         */</span>
<span class="cm">/*********************************************/</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">SiS_GetGroup2CLVXPtr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tabletype</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tableptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span>      <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="n">a</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">;</span>
   <span class="n">b</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">tabletype</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">a</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">;</span>
      <span class="n">b</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">tableptr</span> <span class="o">=</span> <span class="n">SiS_Part2CLVX_1</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">tableptr</span> <span class="o">=</span> <span class="n">SiS_Part2CLVX_2</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">tableptr</span> <span class="o">=</span> <span class="n">SiS_Part2CLVX_4</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="n">tableptr</span> <span class="o">=</span> <span class="n">SiS_Part2CLVX_3</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525i</span><span class="p">)</span> 	<span class="n">tableptr</span> <span class="o">=</span> <span class="n">SiS_Part2CLVX_3</span><span class="p">;</span>
	 <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span> 	<span class="n">tableptr</span> <span class="o">=</span> <span class="n">SiS_Part2CLVX_3</span><span class="p">;</span>
	 <span class="k">else</span> 				         	<span class="n">tableptr</span> <span class="o">=</span> <span class="n">SiS_Part2CLVX_5</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">tableptr</span> <span class="o">=</span> <span class="n">SiS_Part2CLVX_6</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">do</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">((</span><span class="n">tableptr</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">|</span> <span class="n">tableptr</span><span class="p">[</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
	 <span class="n">p</span> <span class="o">+=</span> <span class="mh">0x42</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">while</span><span class="p">((</span><span class="n">tableptr</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">|</span> <span class="n">tableptr</span><span class="p">[</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0xffff</span><span class="p">);</span>
      <span class="k">if</span><span class="p">((</span><span class="n">tableptr</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">|</span> <span class="n">tableptr</span><span class="p">[</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="n">p</span> <span class="o">-=</span> <span class="mh">0x42</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="n">p</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
   <span class="k">return</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tableptr</span><span class="p">[</span><span class="n">p</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetGroup2_C_ELV</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
	      	    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tableptr</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">temp</span><span class="p">;</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISTAP4SCALER</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

   <span class="n">tableptr</span> <span class="o">=</span> <span class="n">SiS_GetGroup2CLVXPtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
   <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0xbf</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">tableptr</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
   <span class="p">}</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">tableptr</span> <span class="o">=</span> <span class="n">SiS_GetGroup2CLVXPtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0xff</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">tableptr</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>
   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x4e</span><span class="p">,</span><span class="mh">0xeb</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_GetCRT2Part2Ptr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">CRT2Index</span><span class="p">,</span>
		    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">ResIndex</span><span class="p">)</span>
<span class="p">{</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span>
     <span class="p">(</span><span class="o">*</span><span class="n">ResIndex</span><span class="p">)</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span><span class="p">;</span>
  <span class="k">else</span>
     <span class="p">(</span><span class="o">*</span><span class="n">ResIndex</span><span class="p">)</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC</span><span class="p">;</span>

  <span class="p">(</span><span class="o">*</span><span class="n">ResIndex</span><span class="p">)</span> <span class="o">&amp;=</span> <span class="mh">0x3f</span><span class="p">;</span>
  <span class="p">(</span><span class="o">*</span><span class="n">CRT2Index</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="p">{</span>
        <span class="p">(</span><span class="o">*</span><span class="n">CRT2Index</span><span class="p">)</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_ASUSA2H_2</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">CRT2Index</span><span class="p">)</span> <span class="o">=</span> <span class="mi">206</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(((</span><span class="o">*</span><span class="n">CRT2Index</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">));</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_Group2LCDSpecial</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">crt2crtc</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempcx</span><span class="p">;</span>
   <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">atable</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
       <span class="mh">0xc3</span><span class="p">,</span><span class="mh">0x9e</span><span class="p">,</span><span class="mh">0xc3</span><span class="p">,</span><span class="mh">0x9e</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span>
       <span class="mh">0xab</span><span class="p">,</span><span class="mh">0x87</span><span class="p">,</span><span class="mh">0xab</span><span class="p">,</span><span class="mh">0x9e</span><span class="p">,</span><span class="mh">0xe7</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x02</span>
   <span class="p">};</span>

   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_630</span><span class="p">)</span> <span class="o">||</span>
	      <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_730</span><span class="p">)</span> <span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipRevision</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)</span>  <span class="o">&amp;&amp;</span>
	  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	  <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span>  <span class="o">&amp;&amp;</span>
	  <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="mh">0xB9</span><span class="p">);</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x05</span><span class="p">,</span><span class="mh">0xCC</span><span class="p">);</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="mh">0xA6</span><span class="p">);</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">crt2crtc</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x2B</span><span class="p">);</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x13</span><span class="p">);</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="mh">0xE5</span><span class="p">);</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x05</span><span class="p">,</span><span class="mh">0x08</span><span class="p">);</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="mh">0xE2</span><span class="p">);</span>
	 <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span> <span class="o">==</span> <span class="mh">0x0c</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">crt2crtc</span> <span class="o">&amp;=</span> <span class="mh">0x1f</span><span class="p">;</span>
	    <span class="n">tempcx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetNotSimuMode</span><span class="p">))</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
		  <span class="n">tempcx</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	    <span class="n">tempcx</span> <span class="o">+=</span> <span class="n">crt2crtc</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">crt2crtc</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="mh">0xff</span><span class="p">);</span>
	    <span class="p">}</span>

	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetNotSimuMode</span><span class="p">))</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
		  <span class="k">if</span><span class="p">(</span><span class="n">crt2crtc</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x28</span><span class="p">);</span>
		  <span class="p">}</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x18</span><span class="p">);</span>
	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="n">atable</span><span class="p">[</span><span class="n">tempcx</span><span class="p">]);</span>
	 <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* For ECS A907. Highly preliminary. */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_Set300Part2Regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">,</span>
		    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="k">struct</span> <span class="n">SiS_Part2PortTbl</span> <span class="o">*</span><span class="n">CRT2Part2Ptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">crt2crtc</span><span class="p">,</span> <span class="n">resindex</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">!=</span> <span class="n">SIS_300</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">crt2crtc</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">crt2crtc</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">resindex</span> <span class="o">=</span> <span class="n">crt2crtc</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">)</span> <span class="n">CRT2Part2Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT2Part2_1024x768_1</span><span class="p">;</span>
  <span class="k">else</span>                                    <span class="n">CRT2Part2Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT2Part2_1024x768_2</span><span class="p">;</span>

  <span class="cm">/* The BIOS code (1.16.51,56) is obviously a fragment! */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">CRT2Part2Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT2Part2_1024x768_1</span><span class="p">;</span>
     <span class="n">resindex</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x80</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x80</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="mh">0x06</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">j</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mh">0x1c</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="mh">0x1d</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">j</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mh">0x1f</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="mh">0x21</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">j</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x23</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="mi">10</span><span class="p">]);</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x25</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="mi">11</span><span class="p">]);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetTVSpecial</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTVNoHiVision</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetYPbPr525p</span> <span class="o">|</span> <span class="n">TVSetYPbPr750p</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSC1024</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">specialtv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0xa7</span><span class="p">,</span><span class="mh">0x07</span><span class="p">,</span><span class="mh">0xf2</span><span class="p">,</span><span class="mh">0x6e</span><span class="p">,</span><span class="mh">0x17</span><span class="p">,</span><span class="mh">0x8b</span><span class="p">,</span><span class="mh">0x73</span><span class="p">,</span><span class="mh">0x53</span><span class="p">,</span>
		<span class="mh">0x13</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="mh">0x34</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0x63</span><span class="p">,</span><span class="mh">0xbb</span><span class="p">,</span><span class="mh">0xcc</span><span class="p">,</span><span class="mh">0x7a</span><span class="p">,</span>
		<span class="mh">0x58</span><span class="p">,</span><span class="mh">0xe4</span><span class="p">,</span><span class="mh">0x73</span><span class="p">,</span><span class="mh">0xda</span><span class="p">,</span><span class="mh">0x13</span>
	<span class="p">};</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0x30</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">specialtv</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x43</span><span class="p">,</span><span class="mh">0x72</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x14</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">);</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x14</span><span class="p">);</span>  <span class="cm">/* 15 */</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">);</span>  <span class="cm">/* 1b */</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">((</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x38</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x4a</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x64</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x52</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x58</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x5c</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">);</span>  <span class="cm">/* 21 */</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x54</span><span class="p">);</span>  <span class="cm">/* 5a */</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">);</span>  <span class="cm">/* 21 */</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x53</span><span class="p">);</span>  <span class="cm">/* 5a */</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetGroup2_Tail</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">525</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="mh">0xc3</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&lt;=</span> <span class="n">ModeVGA</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">temp</span><span class="o">++</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="n">temp</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x2f</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0xb3</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">420</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="mh">0x4d</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&lt;=</span> <span class="n">ModeVGA</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">temp</span><span class="o">++</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="n">temp</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x2f</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xB</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
	   <span class="cm">/* Not always for LV, see SetGrp2 */</span>
	<span class="p">}</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x0b</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="p">}</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">     /* 651+301C, for 1280x768 - do I really need that? */</span>
<span class="c">     if((SiS_Pr-&gt;SiS_PanelXRes == 1280) &amp;&amp; (SiS_Pr-&gt;SiS_PanelYRes == 768)) {</span>
<span class="c">        if(SiS_Pr-&gt;SiS_VBInfo &amp; SetSimuScanMode) {</span>
<span class="c">	   if(((SiS_Pr-&gt;SiS_HDE == 640) &amp;&amp; (SiS_Pr-&gt;SiS_VDE == 480)) ||</span>
<span class="c">	      ((SiS_Pr-&gt;SiS_HDE == 320) &amp;&amp; (SiS_Pr-&gt;SiS_VDE == 240))) {</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x01,0x2b);</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x02,0x13);</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x04,0xe5);</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x05,0x08);</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x06,0xe2);</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x1c,0x21);</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x1d,0x45);</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x1f,0x0b);</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x20,0x00);</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x21,0xa9);</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x23,0x0b);</span>
<span class="c">	      SiS_SetReg(SiS_Part2Port,0x25,0x04);</span>
<span class="c">	   }</span>
<span class="c">	}</span>
<span class="c">     }</span>
<span class="cp">#endif</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetGroup2</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">tempax</span><span class="p">,</span> <span class="n">tempbx</span><span class="p">,</span> <span class="n">tempcx</span><span class="p">,</span> <span class="n">tempch</span><span class="p">,</span> <span class="n">tempcl</span><span class="p">,</span> <span class="n">temp</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">push2</span><span class="p">,</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">crt2crtc</span><span class="p">,</span> <span class="n">bridgeoffset</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">longtemp</span><span class="p">,</span> <span class="n">PhaseIndex</span><span class="p">;</span>
  <span class="n">bool</span>           <span class="n">newtvphase</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">TimingPoint</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">resindex</span><span class="p">,</span> <span class="n">CRT2Index</span><span class="p">;</span>
  <span class="k">const</span> <span class="k">struct</span> <span class="n">SiS_Part2PortTbl</span> <span class="o">*</span><span class="n">CRT2Part2Ptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
<span class="cp">#endif</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
     <span class="n">crt2crtc</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CModeFlag</span><span class="p">;</span>
     <span class="n">crt2crtc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
     <span class="n">crt2crtc</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToAVIDEO</span><span class="p">))</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x08</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToSVIDEO</span><span class="p">))</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToSCART</span><span class="p">)</span>     <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x02</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span>  <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x01</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">))</span> 	      <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>

  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

  <span class="n">PhaseIndex</span>  <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span> <span class="cm">/* SiS_PALPhase */</span>
  <span class="n">TimingPoint</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_PALTiming</span><span class="p">;</span>

  <span class="n">newtvphase</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="o">||</span>
	<span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
     <span class="n">newtvphase</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">TimingPoint</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HiTVExtTiming</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">TimingPoint</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HiTVSt2Timing</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">TimingPoint</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HiTVSt1Timing</span><span class="p">;</span>
        <span class="p">}</span>
     <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span>      <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

     <span class="n">TimingPoint</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">SiS_YPbPrTable</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>

     <span class="n">PhaseIndex</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="cm">/* SiS_NTSCPhase */</span>

  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="p">{</span>

     <span class="k">if</span><span class="p">(</span><span class="n">newtvphase</span><span class="p">)</span> <span class="n">PhaseIndex</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">;</span> <span class="cm">/* SiS_PALPhase2 */</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

     <span class="n">TimingPoint</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NTSCTiming</span><span class="p">;</span>
     <span class="n">PhaseIndex</span>  <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSCJ</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0x01</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">;</span>	<span class="cm">/* SiS_PALPhase : SiS_NTSCPhase */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">newtvphase</span><span class="p">)</span> <span class="n">PhaseIndex</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>					<span class="cm">/* SiS_PALPhase2 : SiS_NTSCPhase2 */</span>

  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetPALM</span> <span class="o">|</span> <span class="n">TVSetPALN</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">PhaseIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0x02</span> <span class="o">:</span> <span class="mh">0x03</span><span class="p">;</span>	<span class="cm">/* SiS_PALMPhase : SiS_PALNPhase */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">newtvphase</span><span class="p">)</span> <span class="n">PhaseIndex</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>					<span class="cm">/* SiS_PALMPhase2 : SiS_PALNPhase2 */</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSC1024</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">PhaseIndex</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span> <span class="cm">/* SiS_SpecialPhaseM */</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSCJ</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">PhaseIndex</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span> <span class="cm">/* SiS_SpecialPhaseJ */</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">PhaseIndex</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span> <span class="cm">/* SiS_SpecialPhase */</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0x31</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0x34</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS_TVPhase</span><span class="p">[(</span><span class="n">PhaseIndex</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0x2D</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">TimingPoint</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0x39</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0x45</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">TimingPoint</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">!=</span> <span class="n">ModeText</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x3A</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x0A</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_NewFlickerMode</span><span class="p">);</span>

  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x35</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY1COE</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x36</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY2COE</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x37</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY3COE</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x38</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RY4COE</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span>	<span class="n">tempax</span> <span class="o">=</span> <span class="mi">950</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span>  <span class="n">tempax</span> <span class="o">=</span> <span class="mi">680</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span>	<span class="n">tempax</span> <span class="o">=</span> <span class="mi">520</span><span class="p">;</span>
  <span class="k">else</span>						<span class="n">tempax</span> <span class="o">=</span> <span class="mi">440</span><span class="p">;</span> <span class="cm">/* NTSC, YPbPr 525 */</span>

  <span class="k">if</span><span class="p">(</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">&lt;=</span> <span class="n">tempax</span><span class="p">))</span> <span class="o">||</span>
      <span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTVNoHiVision</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">==</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">&lt;=</span> <span class="n">tempax</span><span class="p">))</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>

     <span class="n">tempax</span> <span class="o">-=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">;</span>
     <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetYPbPr525p</span> <span class="o">|</span> <span class="n">TVSetYPbPr750p</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">tempax</span> <span class="o">&amp;=</span> <span class="mh">0x00ff</span><span class="p">;</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="n">tempax</span> <span class="o">+</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">TimingPoint</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="n">tempax</span> <span class="o">+</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">TimingPoint</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTVNoYPbPrHiVision</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">&gt;=</span> <span class="mi">1024</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">);</span>
           <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x54</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
           <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x17</span><span class="p">);</span>
           <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x1d</span><span class="p">);</span>
        <span class="p">}</span>
     <span class="p">}</span>

  <span class="p">}</span>

  <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">tempcx</span><span class="o">--</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="n">tempcx</span><span class="o">--</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x1B</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x1D</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">,((</span><span class="n">tempcx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">));</span>

  <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">tempcx</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="n">tempcx</span> <span class="o">-=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x22</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,((</span><span class="n">tempcx</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>

  <span class="n">tempbx</span> <span class="o">=</span> <span class="n">TimingPoint</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">|</span> <span class="p">(</span><span class="n">TimingPoint</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">tempbx</span> <span class="o">+=</span> <span class="n">tempcx</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x25</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>

  <span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">tempbx</span> <span class="o">-=</span> <span class="mi">4</span><span class="p">;</span>
     <span class="n">tempcx</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x29</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,((</span><span class="n">tempbx</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>

  <span class="n">j</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="n">tempcx</span> <span class="o">+=</span> <span class="p">(</span><span class="n">TimingPoint</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">|</span> <span class="p">(</span><span class="n">TimingPoint</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">));</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x27</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x28</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,((</span><span class="n">tempcx</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>

  <span class="n">tempcx</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="n">tempcx</span> <span class="o">-=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x2A</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,((</span><span class="n">tempcx</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>

  <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">j</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="n">tempcx</span> <span class="o">-=</span> <span class="p">(</span><span class="n">TimingPoint</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">|</span> <span class="p">((</span><span class="n">TimingPoint</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">));</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,((</span><span class="n">tempcx</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>

  <span class="n">tempcx</span> <span class="o">-=</span> <span class="mi">11</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_GetVGAHT2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x2E</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>

  <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">360</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">746</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">375</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">746</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">==</span> <span class="mi">405</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">853</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
             <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetYPbPr525p</span><span class="o">|</span><span class="n">TVSetYPbPr750p</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>
     <span class="n">tempbx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">crt2crtc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&lt;=</span> <span class="n">ModeVGA</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">crt2crtc</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x2f</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x5d</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x5e</span><span class="p">))</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">)</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span> <span class="cm">/* From 1.10.7w - doesn&#39;t make sense */</span>
        <span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">tempbx</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x2F</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempcx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
  <span class="n">temp</span> <span class="o">|=</span> <span class="p">((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xC0</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToSVIDEO</span> <span class="o">|</span> <span class="n">SetCRT2ToAVIDEO</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToAVIDEO</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISPART4OVERFLOW</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0xdf</span><span class="p">,((</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="mh">0x0400</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
         <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetYPbPr525p</span> <span class="o">|</span> <span class="n">TVSetYPbPr750p</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">tempbx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">tempbx</span> <span class="o">-=</span> <span class="mi">3</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x18</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x46</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x47</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISPART4OVERFLOW</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0xbf</span><span class="p">,((</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="mh">0x0400</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">));</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">&gt;=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tempax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">tempbx</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">tempch</span> <span class="o">=</span> <span class="n">tempcl</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">&gt;=</span> <span class="mi">960</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">tempcl</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">&gt;=</span> <span class="mi">1280</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">tempch</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
              <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x20</span><span class="p">;</span>
           <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">&gt;=</span> <span class="mi">1024</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">tempch</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
           <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">tempch</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span> <span class="cm">/* OK */</span>
	   <span class="p">}</span>
        <span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">tempcl</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">longtemp</span> <span class="o">=</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">*</span> <span class="n">tempch</span><span class="p">)</span> <span class="o">/</span> <span class="n">tempcl</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="n">longtemp</span> <span class="o">&lt;&lt;=</span> <span class="mi">3</span><span class="p">;</span>
     <span class="n">tempax</span> <span class="o">=</span> <span class="n">longtemp</span> <span class="o">/</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">longtemp</span> <span class="o">%</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">)</span> <span class="n">tempax</span><span class="o">++</span><span class="p">;</span>
     <span class="n">tempbx</span> <span class="o">|=</span> <span class="p">((</span><span class="n">tempax</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1F</span><span class="p">);</span>
     <span class="n">tempcx</span> <span class="o">=</span> <span class="n">tempax</span> <span class="o">&gt;&gt;</span> <span class="mi">13</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x44</span><span class="p">,</span><span class="n">tempax</span><span class="p">);</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x45</span><span class="p">,</span><span class="mh">0xC0</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">tempcx</span> <span class="o">&amp;=</span> <span class="mh">0x07</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="n">tempcx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x46</span><span class="p">,</span><span class="mh">0xF8</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tempbx</span> <span class="o">=</span> <span class="mh">0x0382</span><span class="p">;</span>
        <span class="n">tempcx</span> <span class="o">=</span> <span class="mh">0x007e</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">tempbx</span> <span class="o">=</span> <span class="mh">0x0369</span><span class="p">;</span>
        <span class="n">tempcx</span> <span class="o">=</span> <span class="mh">0x0061</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x4B</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x4C</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempcx</span> <span class="o">&amp;</span> <span class="mh">0x0300</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">|=</span> <span class="p">((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span>      <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x4D</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x43</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x43</span><span class="p">,(</span><span class="n">temp</span> <span class="o">-</span> <span class="mi">3</span><span class="p">));</span>

     <span class="n">SiS_SetTVSpecial</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">);</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xCLV</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
        <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x4e</span><span class="p">,</span><span class="mh">0xf7</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="p">}</span>

  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSC1024</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,(</span><span class="n">temp</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
     <span class="p">}</span>
     <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xEF</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x0B</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="cm">/* From here: Part2 LCD setup */</span>

  <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempbx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">tempbx</span><span class="o">--</span><span class="p">;</span>			         	<span class="cm">/* RHACTE = HDE - 1 */</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x2C</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x2B</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">==</span> <span class="n">ModeEGA</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span> <span class="o">&gt;=</span> <span class="mi">1024</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>
           <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
	   <span class="p">}</span>
        <span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x0B</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

  <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x03</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x0C</span><span class="p">,</span><span class="mh">0xF8</span><span class="p">,((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">));</span>

  <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempcx</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xE0</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">)</span> <span class="p">{</span>
     <span class="cm">/* Enable dithering; only do this for 32bpp mode */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x1A</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

  <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x09</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">);</span>
  <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x0A</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">);</span>

  <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x17</span><span class="p">,</span><span class="mh">0xFB</span><span class="p">);</span>
  <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0xDF</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_GetCRT2Part2Ptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">,</span>
                          			<span class="o">&amp;</span><span class="n">CRT2Index</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">resindex</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">switch</span><span class="p">(</span><span class="n">CRT2Index</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">206</span>: <span class="n">CRT2Part2Ptr</span> <span class="o">=</span> <span class="n">SiS310_CRT2Part2_Asus1024x768_3</span><span class="p">;</span>    <span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
        <span class="k">case</span> <span class="mi">200</span>: <span class="n">CRT2Part2Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CRT2Part2_1024x768_1</span><span class="p">;</span>   <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x80</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x80</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
      <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="mh">0x06</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">j</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mh">0x1c</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="mh">0x1d</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">j</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mh">0x1f</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="mh">0x21</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">j</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x23</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="mi">10</span><span class="p">]);</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x25</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,(</span><span class="n">CRT2Part2Ptr</span><span class="o">+</span><span class="n">resindex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="mi">11</span><span class="p">]);</span>

      <span class="n">SiS_SetGroup2_Tail</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">);</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="cp">#endif</span>

    <span class="cm">/* Checked for 1024x768, 1280x1024, 1400x1050, 1600x1200 */</span>
    <span class="cm">/*             Clevo dual-link 1024x768 */</span>
    <span class="cm">/* 		   Compaq 1280x1024 has HT 1696 sometimes (calculation OK, if given HT is correct)  */</span>
    <span class="cm">/*		   Acer: OK, but uses different setting for VESA timing at 640/800/1024 and 640x400 */</span>

    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">==</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
          <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">+</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	  <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">-</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
       <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
       <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">;</span>
       <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span><span class="p">;</span>
       <span class="n">tempax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">;</span>
	  <span class="cm">/* if(SiS_Pr-&gt;SiS_VGAVDE == 525) tempax += 0x3c;   */</span>  <span class="cm">/* 651+301C */</span>
          <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">&lt;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">)</span> <span class="p">{</span>
             <span class="n">tempax</span> <span class="o">=</span> <span class="n">tempcx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
             <span class="n">tempax</span> <span class="o">-=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
       <span class="p">}</span>
       <span class="n">tempcx</span> <span class="o">-=</span> <span class="n">tempax</span><span class="p">;</span> <span class="cm">/* lcdvdes */</span>
       <span class="n">tempbx</span> <span class="o">-=</span> <span class="n">tempax</span><span class="p">;</span> <span class="cm">/* lcdvdee */</span>
    <span class="p">}</span>

    <span class="cm">/* Non-expanding: lcdvdes = tempcx = VT-1; lcdvdee = tempbx = VDE-1 */</span>

    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x05</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>	<span class="cm">/* lcdvdes  */</span>
    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>	<span class="cm">/* lcdvdee  */</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x38</span><span class="p">;</span>
    <span class="n">temp</span> <span class="o">|=</span> <span class="p">((</span><span class="n">tempcx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">);</span>
    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

    <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">;</span>
    <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)))</span> <span class="p">{</span>
       <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">tempcx</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">-</span> <span class="n">tempax</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
    <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)))</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">)</span> <span class="p">{</span>
	  <span class="n">tempcx</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">-</span> <span class="n">tempax</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
       <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">tempbx</span> <span class="o">=</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span> <span class="cm">/* ? */</span>
             <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VT</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span><span class="p">;</span>
	     <span class="k">if</span><span class="p">(</span><span class="n">tempax</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span> <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">tempax</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
	     <span class="k">else</span>           <span class="p">{</span> <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">;</span>           <span class="p">}</span>
             <span class="n">tempbx</span> <span class="o">-=</span> <span class="p">(</span><span class="n">tempax</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	     <span class="n">tempbx</span> <span class="o">-=</span> <span class="mi">10</span><span class="p">;</span>
	     <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&lt;=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	  <span class="p">}</span>
       <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
       <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">crt2crtc</span> <span class="o">==</span> <span class="mi">6</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">)</span> <span class="p">{</span>
	     <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">770</span><span class="p">;</span>
	     <span class="n">tempcx</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	  <span class="p">}</span>
       <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/* non-expanding: lcdvrs = ((VT + VDE) / 2) - 10 */</span>

    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVSyncStart</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>	    <span class="cm">/* lcdvrs */</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">;</span>
    <span class="n">tempbx</span> <span class="o">+=</span> <span class="p">(</span><span class="n">tempcx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">temp</span> <span class="o">|=</span> <span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0xf0</span><span class="p">;</span>
       <span class="n">temp</span> <span class="o">|=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CVSyncEnd</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
    <span class="n">SiS_Group2LCDSpecial</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">crt2crtc</span><span class="p">);</span>
<span class="cp">#endif</span>

    <span class="n">bridgeoffset</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span>	<span class="n">bridgeoffset</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xCLV</span><span class="p">)</span>	<span class="n">bridgeoffset</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span> <span class="cm">/* OK for Averatec 1280x800 (301C) */</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span>			<span class="n">bridgeoffset</span><span class="o">++</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS302LV</span><span class="p">)</span>	<span class="n">bridgeoffset</span><span class="o">++</span><span class="p">;</span>    <span class="cm">/* OK for Asus A4L 1280x800 */</span>
    <span class="cm">/* Higher bridgeoffset shifts to the LEFT */</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)))</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">)</span> <span class="p">{</span>
	  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">-</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	  <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">temp</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
       <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">temp</span> <span class="o">+=</span> <span class="n">bridgeoffset</span><span class="p">;</span>
    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>  	     <span class="cm">/* lcdhdes */</span>
    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,((</span><span class="n">temp</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>

    <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span><span class="p">;</span>
    <span class="n">tempax</span> <span class="o">=</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">;</span>
    <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)))</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span><span class="p">;</span>
          <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">-</span> <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
       <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
       <span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
       <span class="n">tempbx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
       <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">tempbx</span> <span class="o">+=</span> <span class="n">bridgeoffset</span><span class="p">;</span>

    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x23</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>	    <span class="cm">/* lcdhdee */</span>
    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x25</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">,((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">));</span>

    <span class="n">tempcx</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempcx</span> <span class="o">-</span> <span class="n">tempax</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>

    <span class="n">tempbx</span> <span class="o">+=</span> <span class="n">tempcx</span><span class="p">;</span>
    <span class="n">push2</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)</span> <span class="p">{</span>
             <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span> <span class="o">==</span> <span class="mi">1280</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x47</span><span class="p">;</span>
	  <span class="p">}</span>
       <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHSyncStart</span><span class="p">;</span>
       <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempbx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
       <span class="n">tempbx</span> <span class="o">+=</span> <span class="n">bridgeoffset</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x1C</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>	    <span class="cm">/* lcdhrs */</span>
    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x1D</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,((</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>

    <span class="n">tempbx</span> <span class="o">=</span> <span class="n">push2</span><span class="p">;</span>

    <span class="n">tempcx</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)))</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">!=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HDE</span><span class="p">)</span> <span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">tempbx</span> <span class="o">+=</span> <span class="n">tempcx</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CHSyncEnd</span><span class="p">;</span>
       <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempbx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
       <span class="n">tempbx</span> <span class="o">+=</span> <span class="n">bridgeoffset</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>	    <span class="cm">/* lcdhre */</span>

    <span class="n">SiS_SetGroup2_Tail</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
    <span class="n">SiS_Set300Part2Regs</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
  <span class="p">}</span> <span class="cm">/* CRT2-LCD from table */</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*         SET PART 3 REGISTER GROUP         */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetGroup3</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">i</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tempdi</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

<span class="cp">#ifndef SIS_CP</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part3Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
<span class="cp">#else</span>
  <span class="n">SIS_CP_INIT301_CP</span>
<span class="cp">#endif</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part3Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="mh">0xFA</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part3Port</span><span class="p">,</span><span class="mh">0x14</span><span class="p">,</span><span class="mh">0xC8</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part3Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="mh">0xF5</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part3Port</span><span class="p">,</span><span class="mh">0x14</span><span class="p">,</span><span class="mh">0xB7</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part3Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="mh">0xFA</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part3Port</span><span class="p">,</span><span class="mh">0x14</span><span class="p">,</span><span class="mh">0xC8</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part3Port</span><span class="p">,</span><span class="mh">0x3D</span><span class="p">,</span><span class="mh">0xA8</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">tempdi</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">tempdi</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HiTVGroup3Data</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tempdi</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HiTVGroup3Simu</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525i</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">tempdi</span> <span class="o">=</span> <span class="n">SiS_HiTVGroup3_1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span> <span class="n">tempdi</span> <span class="o">=</span> <span class="n">SiS_HiTVGroup3_2</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">tempdi</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x3E</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part3Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">tempdi</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xCLV</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part3Port</span><span class="p">,</span><span class="mh">0x28</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">);</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>

<span class="cp">#ifdef SIS_CP</span>
  <span class="n">SIS_CP_INIT301_CP2</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*         SET PART 4 REGISTER GROUP         */</span>
<span class="cm">/*********************************************/</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void</span>
<span class="c">SiS_ShiftXPos(struct SiS_Private *SiS_Pr, int shift)</span>
<span class="c">{</span>
<span class="c">   unsigned short temp, temp1, temp2;</span>

<span class="c">   temp1 = SiS_GetReg(SiS_Pr-&gt;SiS_Part2Port,0x1f);</span>
<span class="c">   temp2 = SiS_GetReg(SiS_Pr-&gt;SiS_Part2Port,0x20);</span>
<span class="c">   temp = (unsigned short)((int)((temp1 | ((temp2 &amp; 0xf0) &lt;&lt; 4))) + shift);</span>
<span class="c">   SiS_SetReg(SiS_Pr-&gt;SiS_Part2Port,0x1f,temp);</span>
<span class="c">   SiS_SetRegANDOR(SiS_Pr-&gt;SiS_Part2Port,0x20,0x0f,((temp &gt;&gt; 4) &amp; 0xf0));</span>
<span class="c">   temp = SiS_GetReg(SiS_Pr-&gt;SiS_Part2Port,0x2b) &amp; 0x0f;</span>
<span class="c">   temp = (unsigned short)((int)(temp) + shift);</span>
<span class="c">   SiS_SetRegANDOR(SiS_Pr-&gt;SiS_Part2Port,0x2b,0xf0,(temp &amp; 0x0f));</span>
<span class="c">   temp1 = SiS_GetReg(SiS_Pr-&gt;SiS_Part2Port,0x43);</span>
<span class="c">   temp2 = SiS_GetReg(SiS_Pr-&gt;SiS_Part2Port,0x42);</span>
<span class="c">   temp = (unsigned short)((int)((temp1 | ((temp2 &amp; 0xf0) &lt;&lt; 4))) + shift);</span>
<span class="c">   SiS_SetReg(SiS_Pr-&gt;SiS_Part2Port,0x43,temp);</span>
<span class="c">   SiS_SetRegANDOR(SiS_Pr-&gt;SiS_Part2Port,0x42,0x0f,((temp &gt;&gt; 4) &amp; 0xf0));</span>
<span class="c">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetGroup4_C_ELV</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">resinfo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xCLV</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToHiVision</span> <span class="o">|</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)))</span> <span class="k">return</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">XGI_20</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x61</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x3a</span><span class="p">,</span><span class="mh">0x08</span><span class="p">);</span>
   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x3a</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x3a</span><span class="p">,</span><span class="mh">0xdf</span><span class="p">);</span>
      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x25</span><span class="p">,</span><span class="mh">0xfc</span><span class="p">);</span>
      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)))</span> <span class="p">{</span>
         <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x25</span><span class="p">,</span><span class="mh">0xf8</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span>      <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x0000</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x0002</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetHiVision</span><span class="p">)</span>  <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x0400</span><span class="p">;</span>
      <span class="k">else</span>					   <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x0402</span><span class="p">;</span>
      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">temp1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVAspect43</span><span class="p">)</span> <span class="n">temp1</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	 <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">,</span><span class="n">temp1</span><span class="p">);</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVAspect43LB</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x01</span><span class="p">;</span>
	 <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0x7c</span><span class="p">,(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">));</span>
	 <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x3a</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">,(</span><span class="n">temp</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">));</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x39</span><span class="p">,</span><span class="mh">0xfd</span><span class="p">);</span>
         <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="n">temp1</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x3b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x01</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">temp1</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>  <span class="cm">/* ? why not 0x10? */</span>
	 <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0xf8</span><span class="p">,(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">));</span>
	 <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x3a</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">,(</span><span class="n">temp</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">));</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x3b</span><span class="p">,</span><span class="mh">0xfd</span><span class="p">);</span>
         <span class="p">}</span>
      <span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">      if(SiS_Pr-&gt;ChipType &gt;= SIS_661) { 		/* ? */</span>
<span class="c">         if(SiS_Pr-&gt;SiS_TVMode &amp; TVAspect43) {</span>
<span class="c">            if(SiS_Pr-&gt;SiS_TVMode &amp; TVSetYPbPr750p) {</span>
<span class="c">	       if(resinfo == SIS_RI_1024x768) {</span>
<span class="c">	          SiS_ShiftXPos(SiS_Pr, 97);</span>
<span class="c">	       } else {</span>
<span class="c">	          SiS_ShiftXPos(SiS_Pr, 111);</span>
<span class="c">	       }</span>
<span class="c">	    } else if(SiS_Pr-&gt;SiS_TVMode &amp; TVSetHiVision) {</span>
<span class="c">	       SiS_ShiftXPos(SiS_Pr, 136);</span>
<span class="c">	    }</span>
<span class="c">         }</span>
<span class="c">      }</span>
<span class="cp">#endif</span>

   <span class="p">}</span>

<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetCRT2VCLK</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
                 <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">vclkindex</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">reg1</span><span class="p">,</span> <span class="n">reg2</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">reg1</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CSR2B</span><span class="p">;</span>
     <span class="n">reg2</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CSR2C</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">vclkindex</span> <span class="o">=</span> <span class="n">SiS_GetVCLK2Ptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
     <span class="n">reg1</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBVCLKData</span><span class="p">[</span><span class="n">vclkindex</span><span class="p">].</span><span class="n">Part4_A</span><span class="p">;</span>
     <span class="n">reg2</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBVCLKData</span><span class="p">[</span><span class="n">vclkindex</span><span class="p">].</span><span class="n">Part4_B</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetNTSC1024</span> <span class="o">|</span> <span class="n">TVSet525p1024</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0a</span><span class="p">,</span><span class="mh">0x57</span><span class="p">);</span>
 	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0b</span><span class="p">,</span><span class="mh">0x46</span><span class="p">);</span>
	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">,</span><span class="mh">0xf6</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0a</span><span class="p">,</span><span class="n">reg1</span><span class="p">);</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0b</span><span class="p">,</span><span class="n">reg2</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0a</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0b</span><span class="p">,</span><span class="n">reg2</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0a</span><span class="p">,</span><span class="n">reg1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x12</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
  <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x12</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetDualLinkEtc</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISDUALLINK</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">((</span><span class="n">SiS_CRT2IsLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="o">||</span>
	   <span class="p">(</span><span class="n">SiS_IsVAMode</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDDualLink</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x27</span><span class="p">,</span><span class="mh">0x2c</span><span class="p">);</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x27</span><span class="p">,</span><span class="o">~</span><span class="mh">0x20</span><span class="p">);</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISEMI</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x2a</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
<span class="cp">#ifdef SET_EMI</span>
     <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0x0c</span><span class="p">);</span>
<span class="cp">#endif</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x34</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetGroup4</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempax</span><span class="p">,</span> <span class="n">tempcx</span><span class="p">,</span> <span class="n">tempbx</span><span class="p">,</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">resinfo</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">tempebx</span><span class="p">,</span> <span class="n">tempeax</span><span class="p">,</span> <span class="n">templong</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ResInfo</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CModeFlag</span><span class="p">;</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="mh">0x0e</span><span class="p">);</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">VB_SIS30xCLV</span> <span class="o">|</span> <span class="n">VB_SIS302LV</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0x9f</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_SetDualLinkEtc</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCFACT</span><span class="p">);</span>

  <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHCMAX</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x14</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">;</span>

  <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x16</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>

  <span class="n">temp</span> <span class="o">|=</span> <span class="p">((</span><span class="n">tempcx</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x78</span><span class="p">);</span>

  <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="n">tempcx</span> <span class="o">-=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x17</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>

  <span class="n">temp</span> <span class="o">|=</span> <span class="p">((</span><span class="n">tempcx</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x15</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

  <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span>    <span class="n">tempbx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempbx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">)</span>        <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">)</span>       <span class="n">temp</span> <span class="o">=</span> <span class="mh">0xC0</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;=</span> <span class="mi">960</span><span class="p">)</span>  <span class="n">temp</span> <span class="o">=</span> <span class="mh">0xA0</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetYPbPr525p</span> <span class="o">|</span> <span class="n">TVSetYPbPr750p</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;=</span> <span class="mi">1280</span><span class="p">)</span>      <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;=</span> <span class="mi">1024</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;=</span> <span class="mi">1024</span><span class="p">)</span>      <span class="n">temp</span> <span class="o">=</span> <span class="mh">0xA0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">|=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Init_P4_0E</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">!=</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0xf0</span><span class="p">;</span>
        <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x0A</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0E</span><span class="p">,</span><span class="mh">0x10</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

  <span class="n">tempeax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">;</span>
  <span class="n">tempebx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VDE</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0xE0</span><span class="p">))</span> <span class="n">tempebx</span> <span class="o">&gt;&gt;=</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">tempcx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RVBHRS</span><span class="p">;</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="n">tempcx</span><span class="p">);</span>
  <span class="n">tempcx</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">tempcx</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">tempeax</span> <span class="o">&lt;=</span> <span class="n">tempebx</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">tempcx</span> <span class="o">^=</span> <span class="mh">0x40</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">tempeax</span> <span class="o">-=</span> <span class="n">tempebx</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">tempeax</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">256</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">);</span>
  <span class="n">templong</span> <span class="o">=</span> <span class="n">tempeax</span> <span class="o">%</span> <span class="n">tempebx</span><span class="p">;</span>
  <span class="n">tempeax</span> <span class="o">/=</span> <span class="n">tempebx</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">templong</span><span class="p">)</span> <span class="n">tempeax</span><span class="o">++</span><span class="p">;</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)(</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x000000FF</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1B</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)((</span><span class="n">tempeax</span> <span class="o">&amp;</span> <span class="mh">0x0000FF00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1A</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)((</span><span class="n">tempeax</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x70</span><span class="p">);</span> <span class="cm">/* sic! */</span>
  <span class="n">temp</span> <span class="o">|=</span> <span class="p">(</span><span class="n">tempcx</span> <span class="o">&amp;</span> <span class="mh">0x4F</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1C</span><span class="p">,</span><span class="mh">0x28</span><span class="p">);</span>

     <span class="cm">/* Calc Linebuffer max address and set/clear decimode */</span>
     <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetHiVision</span> <span class="o">|</span> <span class="n">TVSetYPbPr750p</span><span class="p">))</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
     <span class="n">tempax</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAHDE</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span>    <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">tempax</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">tempax</span> <span class="o">-=</span> <span class="mi">800</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="n">tempbx</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempax</span> <span class="o">==</span> <span class="mi">960</span><span class="p">)</span>	   <span class="n">tempax</span> <span class="o">*=</span> <span class="mi">25</span><span class="p">;</span> <span class="cm">/* Correct */</span>
           <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">tempax</span> <span class="o">==</span> <span class="mi">1024</span><span class="p">)</span> <span class="n">tempax</span> <span class="o">*=</span> <span class="mi">25</span><span class="p">;</span>
           <span class="k">else</span>			   <span class="n">tempax</span> <span class="o">*=</span> <span class="mi">20</span><span class="p">;</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">tempax</span> <span class="o">%</span> <span class="mi">32</span><span class="p">;</span>
	   <span class="n">tempax</span> <span class="o">/=</span> <span class="mi">32</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="n">tempax</span><span class="o">++</span><span class="p">;</span>
	   <span class="n">tempax</span><span class="o">++</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1024x768</span> <span class="o">||</span>
	         <span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1024x576</span> <span class="o">||</span>
		 <span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1280x1024</span> <span class="o">||</span>
		 <span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1280x720</span><span class="p">)</span> <span class="p">{</span>
	         <span class="cm">/* Otherwise white line or garbage at right edge */</span>
	         <span class="n">tempax</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempax</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
     <span class="n">tempax</span><span class="o">--</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempax</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x30</span><span class="p">)</span> <span class="o">|</span> <span class="n">tempbx</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1D</span><span class="p">,</span><span class="n">tempax</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x0036</span><span class="p">;</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mh">0xD0</span><span class="p">;</span>
     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="mh">0x0026</span><span class="p">;</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mh">0xC0</span><span class="p">;</span> <span class="cm">/* See En/DisableBridge() */</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetNTSC1024</span> <span class="o">|</span> <span class="n">TVSetHiVision</span> <span class="o">|</span> <span class="n">TVSetYPbPr750p</span> <span class="o">|</span> <span class="n">TVSetYPbPr525p</span><span class="p">)))</span> <span class="p">{</span>
	   <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x01</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">))</span> <span class="p">{</span>
  	         <span class="n">temp</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x01</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="n">tempbx</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

     <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_HT</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsDualLink</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">tempbx</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">tempbx</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x22</span><span class="p">,</span><span class="n">tempbx</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x38</span><span class="p">;</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0xC0</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="mh">0x0e</span><span class="p">);</span>
	   <span class="cm">/* LCD-too-dark-error-source, see FinalizeLCD() */</span>
	<span class="p">}</span>
     <span class="p">}</span>

     <span class="n">SiS_SetDualLinkEtc</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

  <span class="p">}</span>  <span class="cm">/* 301B */</span>

  <span class="n">SiS_SetCRT2VCLK</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*         SET PART 5 REGISTER GROUP         */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetGroup5</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span>  <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">==</span> <span class="n">ModeVGA</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetInSlaveMode</span> <span class="o">|</span> <span class="n">LoadDACFlag</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1E</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
        <span class="n">SiS_LoadDAC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*     MODIFY CRT1 GROUP FOR SLAVE MODE      */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_GetLVDSCRT1Ptr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">ResIndex</span><span class="p">,</span>
		   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span>
 <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">modeflag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">bool</span> <span class="n">checkhd</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

  <span class="cm">/* Pass 1:1 not supported here */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
     <span class="p">(</span><span class="o">*</span><span class="n">ResIndex</span><span class="p">)</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
     <span class="p">(</span><span class="o">*</span><span class="n">ResIndex</span><span class="p">)</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">(</span><span class="o">*</span><span class="n">ResIndex</span><span class="p">)</span> <span class="o">&amp;=</span> <span class="mh">0x3F</span><span class="p">;</span>

  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="p">{</span>

     <span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)))</span> <span class="p">{</span>
      	<span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span> <span class="o">=</span> <span class="mi">82</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&gt;</span> <span class="n">ModeVGA</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHSOverScan</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span> <span class="o">=</span> <span class="mi">84</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">((</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">84</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetCHOverScan</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
     <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

     <span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
     <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">case</span> <span class="n">Panel_320x240_1</span>: <span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
			   <span class="n">checkhd</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			   <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_320x240_2</span>: <span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
			   <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_320x240_3</span>: <span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
			   <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_640x480</span>:   <span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
			   <span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">Panel_1024x600</span>:  <span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span>
			   <span class="k">break</span><span class="p">;</span>
     <span class="nl">default:</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="k">if</span><span class="p">(</span><span class="n">checkhd</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x600</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">DisplayType</span><span class="p">)</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
     <span class="p">}</span>

  <span class="p">}</span>

  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_ModCRT1CRTC</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
                <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempah</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">ResIndex</span><span class="p">,</span> <span class="n">DisplayType</span><span class="p">;</span>
  <span class="k">const</span> <span class="k">struct</span> <span class="n">SiS_LVDSCRT1Data</span> <span class="o">*</span><span class="n">LVDSCRT1Ptr</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">CRIdx</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span>
	<span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x16</span>
  <span class="p">};</span>

  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="o">||</span>
     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1024</span><span class="p">)</span> <span class="o">||</span>
     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL848</span><span class="p">)</span>  <span class="o">||</span>
     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_PANEL856</span><span class="p">)</span> <span class="p">)</span>
     <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">SetDOSMode</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetLVDSCRT1Ptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">,</span>
                          <span class="o">&amp;</span><span class="n">ResIndex</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">DisplayType</span><span class="p">)))</span> <span class="p">{</span>
     <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">DisplayType</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">50</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDSCRT1320x240_1</span><span class="p">;</span>           <span class="k">break</span><span class="p">;</span> <span class="cm">/* xSTN */</span>
    <span class="k">case</span> <span class="mi">14</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDSCRT1320x240_2</span><span class="p">;</span>           <span class="k">break</span><span class="p">;</span> <span class="cm">/* xSTN */</span>
    <span class="k">case</span> <span class="mi">15</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDSCRT1320x240_2_H</span><span class="p">;</span>         <span class="k">break</span><span class="p">;</span> <span class="cm">/* xSTN */</span>
    <span class="k">case</span> <span class="mi">18</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDSCRT1320x240_3</span><span class="p">;</span>           <span class="k">break</span><span class="p">;</span> <span class="cm">/* xSTN */</span>
    <span class="k">case</span> <span class="mi">19</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDSCRT1320x240_3_H</span><span class="p">;</span>         <span class="k">break</span><span class="p">;</span> <span class="cm">/* xSTN */</span>
    <span class="k">case</span> <span class="mi">10</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDSCRT1640x480_1</span><span class="p">;</span>           <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">11</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LVDSCRT1640x480_1_H</span><span class="p">;</span>         <span class="k">break</span><span class="p">;</span>
<span class="cp">#if 0</span><span class="c"> /* Works better with calculated numbers */</span>
<span class="c">    case 26: LVDSCRT1Ptr = SiS_Pr-&gt;SiS_LVDSCRT11024x600_1;          break;</span>
<span class="c">    case 27: LVDSCRT1Ptr = SiS_Pr-&gt;SiS_LVDSCRT11024x600_1_H;        break;</span>
<span class="c">    case 28: LVDSCRT1Ptr = SiS_Pr-&gt;SiS_LVDSCRT11024x600_2;          break;</span>
<span class="c">    case 29: LVDSCRT1Ptr = SiS_Pr-&gt;SiS_LVDSCRT11024x600_2_H;        break;</span>
<span class="cp">#endif</span>
    <span class="k">case</span> <span class="mi">80</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVCRT1UNTSC</span><span class="p">;</span>               <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">81</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVCRT1ONTSC</span><span class="p">;</span>               <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">82</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVCRT1UPAL</span><span class="p">;</span>                <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">83</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVCRT1OPAL</span><span class="p">;</span>                <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">84</span>: <span class="n">LVDSCRT1Ptr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVCRT1SOPAL</span><span class="p">;</span>               <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">LVDSCRT1Ptr</span><span class="p">)</span> <span class="p">{</span>

     <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x11</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>

     <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tempah</span> <span class="o">=</span> <span class="p">(</span><span class="n">LVDSCRT1Ptr</span> <span class="o">+</span> <span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="n">CRIdx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">tempah</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">0x0C</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tempah</span> <span class="o">=</span> <span class="p">(</span><span class="n">LVDSCRT1Ptr</span> <span class="o">+</span> <span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="n">tempah</span> <span class="o">=</span> <span class="p">(</span><span class="n">LVDSCRT1Ptr</span> <span class="o">+</span> <span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xE0</span><span class="p">;</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x0E</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>

     <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
     <span class="k">else</span>               <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>

     <span class="n">tempah</span> <span class="o">=</span> <span class="p">((</span><span class="n">LVDSCRT1Ptr</span> <span class="o">+</span> <span class="n">ResIndex</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">CR</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">DoubleScanMode</span><span class="p">)</span> <span class="n">tempah</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
     <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x09</span><span class="p">,</span><span class="o">~</span><span class="mh">0x020</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

     <span class="n">SiS_CalcLCDACRT1Timing</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>

  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*              SET CRT2 ECLK                */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetCRT2ECLK</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
           <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">clkbase</span><span class="p">,</span> <span class="n">vclkindex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">sr2b</span><span class="p">,</span> <span class="n">sr2c</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">ProgrammingCRT2</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRTVCLK</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">RefreshRateTableIndex</span><span class="o">--</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">vclkindex</span> <span class="o">=</span> <span class="n">SiS_GetVCLK2Ptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
                                    <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">ProgrammingCRT2</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">vclkindex</span> <span class="o">=</span> <span class="n">SiS_GetVCLK2Ptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
                                    <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">sr2b</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VCLKData</span><span class="p">[</span><span class="n">vclkindex</span><span class="p">].</span><span class="n">SR2B</span><span class="p">;</span>
  <span class="n">sr2c</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VCLKData</span><span class="p">[</span><span class="n">vclkindex</span><span class="p">].</span><span class="n">SR2C</span><span class="p">;</span>

  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1024</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x220</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">sr2b</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x227</span><span class="p">];</span>
	   <span class="n">sr2c</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x228</span><span class="p">];</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">clkbase</span> <span class="o">=</span> <span class="mh">0x02B</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">clkbase</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="n">clkbase</span><span class="p">,</span><span class="n">sr2b</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="n">clkbase</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">sr2c</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="n">clkbase</span><span class="p">,</span><span class="n">sr2b</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="n">clkbase</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">sr2c</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x31</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="n">clkbase</span><span class="p">,</span><span class="n">sr2b</span><span class="p">);</span>
  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="n">clkbase</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">sr2c</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*           SET UP CHRONTEL CHIPS           */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetCHTVReg</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
               <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefreshRateTableIndex</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">TVType</span><span class="p">,</span> <span class="n">resindex</span><span class="p">;</span>
   <span class="k">const</span> <span class="k">struct</span> <span class="n">SiS_CHTVRegData</span> <span class="o">*</span><span class="n">CHTVRegData</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span>
      <span class="n">resindex</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span><span class="p">;</span>
   <span class="k">else</span>
      <span class="n">resindex</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefreshRateTableIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC</span><span class="p">;</span>

   <span class="n">resindex</span> <span class="o">&amp;=</span> <span class="mh">0x3F</span><span class="p">;</span>

   <span class="n">TVType</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetCHOverScan</span><span class="p">)</span> <span class="n">TVType</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">TVType</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&gt;</span> <span class="n">ModeVGA</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHSOverScan</span><span class="p">)</span> <span class="n">TVType</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">TVType</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetCHOverScan</span><span class="p">)</span> <span class="n">TVType</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALN</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">TVType</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetCHOverScan</span><span class="p">)</span> <span class="n">TVType</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="k">switch</span><span class="p">(</span><span class="n">TVType</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span>  <span class="mi">0</span>: <span class="n">CHTVRegData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVReg_UNTSC</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span>  <span class="mi">1</span>: <span class="n">CHTVRegData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVReg_ONTSC</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span>  <span class="mi">2</span>: <span class="n">CHTVRegData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVReg_UPAL</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span>  <span class="mi">3</span>: <span class="n">CHTVRegData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVReg_OPAL</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span>  <span class="mi">4</span>: <span class="n">CHTVRegData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVReg_UPALM</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span>  <span class="mi">5</span>: <span class="n">CHTVRegData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVReg_OPALM</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span>  <span class="mi">6</span>: <span class="n">CHTVRegData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVReg_UPALN</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span>  <span class="mi">7</span>: <span class="n">CHTVRegData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVReg_OPALN</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span>  <span class="mi">8</span>: <span class="n">CHTVRegData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVReg_SOPAL</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
      <span class="nl">default:</span> <span class="n">CHTVRegData</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CHTVReg_OPAL</span><span class="p">;</span>  <span class="k">break</span><span class="p">;</span>
   <span class="p">}</span>


   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>

      <span class="cm">/* Chrontel 7005 - I assume that it does not come with a 315 series chip */</span>

      <span class="cm">/* We don&#39;t support modes &gt;800x600 */</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">resindex</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="mh">0x43</span><span class="p">);</span>  <span class="cm">/* 0x40=76uA (PAL); 0x03=15bit non-multi RGB*/</span>
	 <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x09</span><span class="p">,</span><span class="mh">0x69</span><span class="p">);</span>  <span class="cm">/* Black level for PAL (105)*/</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>   <span class="cm">/* upper nibble=71uA (NTSC), 0x03=15bit non-multi RGB*/</span>
	 <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x09</span><span class="p">,</span><span class="mh">0x71</span><span class="p">);</span>   <span class="cm">/* Black level for NTSC (113)*/</span>
      <span class="p">}</span>

      <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>	<span class="cm">/* Mode register */</span>
      <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x07</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>	<span class="cm">/* Start active video register */</span>
      <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x08</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>	<span class="cm">/* Position overflow register */</span>
      <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x0a</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>	<span class="cm">/* Horiz Position register */</span>
      <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x0b</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>	<span class="cm">/* Vertical Position register */</span>

      <span class="cm">/* Set minimum flicker filter for Luma channel (SR1-0=00),</span>
<span class="cm">                minimum text enhancement (S3-2=10),</span>
<span class="cm">   	        maximum flicker filter for Chroma channel (S5-4=10)</span>
<span class="cm">	        =00101000=0x28 (When reading, S1-0-&gt;S3-2, and S3-2-&gt;S1-0!)</span>
<span class="cm">       */</span>
      <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x28</span><span class="p">);</span>

      <span class="cm">/* Set video bandwidth</span>
<span class="cm">            High bandwidth Luma composite video filter(S0=1)</span>
<span class="cm">            low bandwidth Luma S-video filter (S2-1=00)</span>
<span class="cm">	    disable peak filter in S-video channel (S3=0)</span>
<span class="cm">	    high bandwidth Chroma Filter (S5-4=11)</span>
<span class="cm">	    =00110001=0x31</span>
<span class="cm">      */</span>
      <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x03</span><span class="p">,</span><span class="mh">0xb1</span><span class="p">);</span>       <span class="cm">/* old: 3103 */</span>

      <span class="cm">/* Register 0x3D does not exist in non-macrovision register map</span>
<span class="cm">            (Maybe this is a macrovision register?)</span>
<span class="cm">       */</span>
<span class="cp">#ifndef SIS_CP</span>
      <span class="n">SiS_SetCH70xx</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x3d</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
<span class="cp">#endif</span>

      <span class="cm">/* Register 0x10 only contains 1 writable bit (S0) for sensing,</span>
<span class="cm">             all other bits a read-only. Macrovision?</span>
<span class="cm">       */</span>
      <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">);</span>

      <span class="cm">/* Register 0x11 only contains 3 writable bits (S0-S2) for</span>
<span class="cm">             contrast enhancement (set to 010 -&gt; gain 1 Yout = 17/16*(Yin-30) )</span>
<span class="cm">       */</span>
      <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x11</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0xF8</span><span class="p">);</span>

      <span class="cm">/* Clear DSEN</span>
<span class="cm">       */</span>
      <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xEF</span><span class="p">);</span>

      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">))</span> <span class="p">{</span>		<span class="cm">/* ---- NTSC ---- */</span>
         <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetCHOverScan</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">resindex</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">)</span> <span class="p">{</span>   			<span class="cm">/* 640x480 overscan: Mode 16 */</span>
      	       <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xEF</span><span class="p">);</span>	<span class="cm">/* loop filter off */</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0xFE</span><span class="p">);</span>	<span class="cm">/* ACIV on, no need to set FSCI */</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">resindex</span> <span class="o">==</span> <span class="mh">0x05</span><span class="p">)</span> <span class="p">{</span>    		<span class="cm">/* 800x600 overscan: Mode 23 */</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">);</span>	<span class="cm">/* 0x18-0x1f: FSCI 469,762,048 */</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0x0C</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">);</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">);</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">);</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">);</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1d</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">);</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">);</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">);</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0xEF</span><span class="p">);</span>	<span class="cm">/* Loop filter on for mode 23 */</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xFE</span><span class="p">);</span>	<span class="cm">/* ACIV off, need to set FSCI */</span>
            <span class="p">}</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">resindex</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">)</span> <span class="p">{</span>     			<span class="cm">/* ----- 640x480 underscan; Mode 17 */</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xEF</span><span class="p">);</span>	<span class="cm">/* loop filter off */</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0xFE</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">resindex</span> <span class="o">==</span> <span class="mh">0x05</span><span class="p">)</span> <span class="p">{</span>   		<span class="cm">/* ----- 800x600 underscan: Mode 24 */</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">               SiS_SetCH70xxANDOR(SiS_Pr,0x18,0x01,0xF0);	/* (FSCI was 0x1f1c71c7 - this is for mode 22) */</span>
<span class="c">               SiS_SetCH70xxANDOR(SiS_Pr,0x19,0x09,0xF0);	/* FSCI for mode 24 is 428,554,851 */</span>
<span class="c">               SiS_SetCH70xxANDOR(SiS_Pr,0x1a,0x08,0xF0);       /* 198b3a63 */</span>
<span class="c">               SiS_SetCH70xxANDOR(SiS_Pr,0x1b,0x0b,0xF0);</span>
<span class="c">               SiS_SetCH70xxANDOR(SiS_Pr,0x1c,0x04,0xF0);</span>
<span class="c">               SiS_SetCH70xxANDOR(SiS_Pr,0x1d,0x01,0xF0);</span>
<span class="c">               SiS_SetCH70xxANDOR(SiS_Pr,0x1e,0x06,0xF0);</span>
<span class="c">               SiS_SetCH70xxANDOR(SiS_Pr,0x1f,0x05,0xF0);</span>
<span class="c">               SiS_SetCH70xxANDOR(SiS_Pr,0x20,0x00,0xEF);	/* loop filter off for mode 24 */</span>
<span class="c">               SiS_SetCH70xxANDOR(SiS_Pr,0x21,0x00,0xFE);	* ACIV off, need to set FSCI */</span>
<span class="cp">#endif         /* All alternatives wrong (datasheet wrong?), don&#39;t use FSCI */</span>
	       <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xEF</span><span class="p">);</span>	 <span class="cm">/* loop filter off */</span>
               <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0xFE</span><span class="p">);</span>
            <span class="p">}</span>
         <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>						<span class="cm">/* ---- PAL ---- */</span>
         <span class="cm">/* We don&#39;t play around with FSCI in PAL mode */</span>
         <span class="k">if</span><span class="p">(</span><span class="n">resindex</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xEF</span><span class="p">);</span>	<span class="cm">/* loop filter off */</span>
            <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0xFE</span><span class="p">);</span>	<span class="cm">/* ACIV on */</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0xEF</span><span class="p">);</span>	<span class="cm">/* loop filter off */</span>
            <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0xFE</span><span class="p">);</span>	<span class="cm">/* ACIV on */</span>
         <span class="p">}</span>
      <span class="p">}</span>

<span class="cp">#endif  </span><span class="cm">/* 300 */</span><span class="cp"></span>

   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

      <span class="cm">/* Chrontel 7019 - assumed that it does not come with a 300 series chip */</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>

      <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

      <span class="cm">/* We don&#39;t support modes &gt;1024x768 */</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">resindex</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

      <span class="n">temp</span> <span class="o">=</span> <span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSCJ</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x03</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x05</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x06</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">6</span><span class="p">]);</span>

      <span class="n">temp</span> <span class="o">=</span> <span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSCJ</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x66</span><span class="p">;</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x07</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x08</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">8</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x15</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">9</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">10</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x0c</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">11</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x0d</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">12</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x0e</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">13</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">14</span><span class="p">]);</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x10</span><span class="p">,</span><span class="n">CHTVRegData</span><span class="p">[</span><span class="n">resindex</span><span class="p">].</span><span class="n">Reg</span><span class="p">[</span><span class="mi">15</span><span class="p">]);</span>

      <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x21</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x02</span><span class="p">;</span>
      <span class="cm">/* D1 should be set for PAL, PAL-N and NTSC-J,</span>
<span class="cm">         but I won&#39;t do that for PAL unless somebody</span>
<span class="cm">	 tells me to do so. Since the BIOS uses</span>
<span class="cm">	 non-default CIV values and blacklevels,</span>
<span class="cm">	 this might be compensated anyway.</span>
<span class="cm">       */</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetPALN</span> <span class="o">|</span> <span class="n">TVSetNTSCJ</span><span class="p">))</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x02</span><span class="p">;</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

<span class="cp">#endif	</span><span class="cm">/* 315 */</span><span class="cp"></span>

   <span class="p">}</span>

<span class="cp">#ifdef SIS_CP</span>
   <span class="n">SIS_CP_INIT301_CP3</span>
<span class="cp">#endif</span>

<span class="p">}</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315  </span><span class="cm">/* ----------- 315 series only ---------- */</span><span class="cp"></span>

<span class="kt">void</span>
<span class="nf">SiS_Chrontel701xBLOn</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

   <span class="cm">/* Enable Chrontel 7019 LCD panel backlight */</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x65</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">);</span>
	 <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
	 <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">SiS_Chrontel701xBLOff</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

   <span class="cm">/* Disable Chrontel 7019 LCD panel backlight */</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">);</span>
      <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0xDF</span><span class="p">;</span>
      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_ChrontelPowerSequencing</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">regtable</span><span class="p">[]</span>      <span class="o">=</span> <span class="p">{</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0x6b</span> <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1024_740</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1400_740</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">asus1024_740</span><span class="p">[]</span>  <span class="o">=</span> <span class="p">{</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x09</span> <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">asus1400_740</span><span class="p">[]</span>  <span class="o">=</span> <span class="p">{</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x09</span> <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1024_650</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1400_650</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">};</span>
  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tableptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

  <span class="cm">/* Set up Power up/down timing */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_ASUSL3000D</span><span class="p">)</span> <span class="n">tableptr</span> <span class="o">=</span> <span class="n">asus1024_740</span><span class="p">;</span>
	<span class="k">else</span>    			          <span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1024_740</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="o">||</span>
	       <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">)</span> <span class="o">||</span>
	       <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_ASUSL3000D</span><span class="p">)</span> <span class="n">tableptr</span> <span class="o">=</span> <span class="n">asus1400_740</span><span class="p">;</span>
        <span class="k">else</span>					  <span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1400_740</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1024_650</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="o">||</span>
	       <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">)</span> <span class="o">||</span>
	       <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1400_650</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">regtable</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tableptr</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetCH701xForLCD</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tableptr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempbh</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">regtable</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span>
		<span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x66</span>
  <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1024_740</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">,</span>
		<span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x44</span>
  <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1280_740</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span>
		<span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x44</span>
  <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1400_740</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span>
		<span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x44</span>
  <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1600_740</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span>
		<span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xde</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x44</span>
  <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1024_650</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">,</span>
		<span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x02</span>
  <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1280_650</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span>
		<span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x02</span>
  <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1400_650</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xef</span><span class="p">,</span>
		<span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x02</span>
  <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">table1600_650</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span>
		<span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xde</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x1a</span>
  <span class="p">};</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span>       <span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1024_740</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1280_740</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">)</span> <span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1400_740</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">)</span> <span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1600_740</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span>       <span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1024_650</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1280_650</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">)</span> <span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1400_650</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">)</span> <span class="n">tableptr</span> <span class="o">=</span> <span class="n">table1600_650</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">tempbh</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x74</span><span class="p">);</span>
  <span class="k">if</span><span class="p">((</span><span class="n">tempbh</span> <span class="o">==</span> <span class="mh">0xf6</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">tempbh</span> <span class="o">==</span> <span class="mh">0xc7</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">tempbh</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x73</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">tempbh</span> <span class="o">==</span> <span class="mh">0xc8</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">tempbh</span> <span class="o">==</span> <span class="mh">0xdb</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">tempbh</span> <span class="o">==</span> <span class="mh">0xde</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="n">tempbh</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">;</span>
  <span class="k">else</span>     			  <span class="n">tempbh</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tempbh</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">regtable</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tableptr</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="n">SiS_ChrontelPowerSequencing</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
  <span class="n">tempbh</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">);</span>
  <span class="n">tempbh</span> <span class="o">|=</span> <span class="mh">0xc0</span><span class="p">;</span>
  <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="n">tempbh</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">tempbh</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">);</span>
     <span class="n">tempbh</span> <span class="o">&amp;=</span> <span class="mh">0xfb</span><span class="p">;</span>
     <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">,</span><span class="n">tempbh</span><span class="p">);</span>
     <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
     <span class="n">tempbh</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x64</span><span class="p">);</span>
     <span class="n">tempbh</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>
     <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x64</span><span class="p">,</span><span class="n">tempbh</span><span class="p">);</span>
     <span class="n">tempbh</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
     <span class="n">tempbh</span> <span class="o">&amp;=</span> <span class="mh">0x3f</span><span class="p">;</span>
     <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x03</span><span class="p">,</span><span class="n">tempbh</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_ChrontelResetVSync</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">temp</span><span class="p">,</span> <span class="n">temp1</span><span class="p">;</span>

  <span class="n">temp1</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">);</span>
  <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">,</span><span class="mh">0x3e</span><span class="p">);</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">);</span>
  <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x7f</span><span class="p">;</span>	<span class="cm">/* Use external VSYNC */</span>
  <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
  <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">);</span>
  <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>	<span class="cm">/* Use internal VSYNC */</span>
  <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
  <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">,</span><span class="n">temp1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_Chrontel701xOn</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>	<span class="cm">/* Invert XCLK phase */</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsYPbPr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x3f</span><span class="p">;</span>
	<span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>	<span class="cm">/* Enable YPrPb (HDTV) */</span>
	<span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsChScart</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x3f</span><span class="p">;</span>
	<span class="n">temp</span> <span class="o">|=</span> <span class="mh">0xc0</span><span class="p">;</span>	<span class="cm">/* Enable SCART + CVBS */</span>
	<span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_ChrontelResetVSync</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>   <span class="cm">/* Enable TV path */</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>   <span class="cm">/* Enable TV path */</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsYPbPr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
           <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x73</span><span class="p">);</span>
	   <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x60</span><span class="p">;</span>
	   <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x73</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x7f</span><span class="p">;</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
        <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_Chrontel701xOff</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

  <span class="cm">/* Complete power down of LVDS */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">5887</span><span class="p">);</span>
	<span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="mh">0xac</span><span class="p">);</span>
	<span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0xfc</span><span class="p">;</span>
	<span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
	<span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_ChrontelResetDB</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
     <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x4a</span><span class="p">);</span>  <span class="cm">/* Version ID */</span>
        <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x01</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">temp</span><span class="p">)</span> <span class="p">{</span>

           <span class="k">if</span><span class="p">(</span><span class="n">SiS_WeHaveBacklightCtrl</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">);</span>
	      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">,</span><span class="mh">0x3e</span><span class="p">);</span>
	   <span class="p">}</span>

	   <span class="cm">/* Reset Chrontel 7019 datapath */</span>
           <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x48</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
           <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
           <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x48</span><span class="p">,</span><span class="mh">0x18</span><span class="p">);</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_WeHaveBacklightCtrl</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_ChrontelResetVSync</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	      <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
	   <span class="p">}</span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	   <span class="cm">/* Clear/set/clear GPIO */</span>
           <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x5c</span><span class="p">);</span>
	   <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0xef</span><span class="p">;</span>
	   <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x5c</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x5c</span><span class="p">);</span>
	   <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
	   <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x5c</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x5c</span><span class="p">);</span>
	   <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0xef</span><span class="p">;</span>
	   <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x5c</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x61</span><span class="p">);</span>
	   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">temp</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_SetCH701xForLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	   <span class="p">}</span>
        <span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="cm">/* 650 */</span>
        <span class="cm">/* Reset Chrontel 7019 datapath */</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x48</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
        <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x48</span><span class="p">,</span><span class="mh">0x18</span><span class="p">);</span>
     <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_ChrontelInitTVVSync</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
     <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span><span class="p">(</span><span class="n">SiS_WeHaveBacklightCtrl</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
           <span class="n">SiS_ChrontelResetVSync</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
        <span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="mh">0xaf</span><span class="p">);</span>  <span class="cm">/* Power up LVDS block */</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x49</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>  <span class="cm">/* TV block powered? (0 = yes, 1 = no) */</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">);</span>
	   <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x70</span><span class="p">;</span>
	   <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>  <span class="cm">/* enable VSYNC */</span>
	   <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">);</span>
	   <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
	   <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x47</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>  <span class="cm">/* disable VSYNC */</span>
        <span class="p">}</span>

     <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_ChrontelDoSomething3</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">)</span>
<span class="p">{</span>
     <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">,</span><span class="n">temp1</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x61</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">temp</span><span class="o">++</span><span class="p">;</span>
	   <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x61</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x45</span><span class="p">);</span>  <span class="cm">/* Panel power on */</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="mh">0xaf</span><span class="p">);</span>  <span class="cm">/* All power on */</span>
        <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">5887</span><span class="p">);</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="cm">/* 650 */</span>

        <span class="n">temp1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x61</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">temp</span><span class="o">++</span><span class="p">;</span>
	   <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x61</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
	   <span class="n">temp1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="mh">0xac</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x5f</span><span class="p">;</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">if</span><span class="p">(</span><span class="n">SiS_WeHaveBacklightCtrl</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1023</span><span class="p">);</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">767</span><span class="p">);</span>
	   <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
           <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">temp1</span><span class="p">)</span>
	      <span class="n">SiS_GenericDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">767</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x03</span><span class="p">;</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x7f</span><span class="p">;</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
        <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

     <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_ChrontelDoSomething2</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
     <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

     <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

     <span class="k">do</span> <span class="p">{</span>
       <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">);</span>
       <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x04</span><span class="p">;</span>  <span class="cm">/* PLL stable? -&gt; bail out */</span>
       <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>

       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
          <span class="cm">/* Power down LVDS output, PLL normal operation */</span>
          <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="mh">0xac</span><span class="p">);</span>
       <span class="p">}</span>

       <span class="n">SiS_SetCH701xForLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

       <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">);</span>
       <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0xfb</span><span class="p">;</span>  <span class="cm">/* Reset PLL */</span>
       <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
       <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
       <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">);</span>
       <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>  <span class="cm">/* PLL normal operation */</span>
       <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x78</span><span class="p">,</span><span class="mh">0xe0</span><span class="p">);</span>	<span class="cm">/* PLL loop filter */</span>
       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x78</span><span class="p">,</span><span class="mh">0x60</span><span class="p">);</span>
       <span class="p">}</span>
       <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x77</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>  <span class="cm">/* MV? */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_ChrontelDoSomething1</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
     <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">;</span>

     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
     <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>	<span class="cm">/* Set datapath 1 to TV   */</span>
     <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0xbf</span><span class="p">;</span>	<span class="cm">/* Set datapath 2 to LVDS */</span>
     <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x03</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_740</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0xfb</span><span class="p">;</span>	<span class="cm">/* Normal XCLK phase */</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x64</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x40</span><span class="p">;</span>	<span class="cm">/* ? Bit not defined */</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x64</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x3f</span><span class="p">;</span>	<span class="cm">/* D1 input to both LVDS and TV */</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x03</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_ASUSL3000D</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x63</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span> <span class="cm">/* LVDS off */</span>
	   <span class="n">SiS_LongDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	   <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x63</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span> <span class="cm">/* LVDS on */</span>
	   <span class="n">SiS_ChrontelResetDB</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	   <span class="n">SiS_ChrontelDoSomething2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	   <span class="n">SiS_ChrontelDoSomething3</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
           <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x66</span><span class="p">);</span>
           <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">!=</span> <span class="mh">0x45</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">SiS_ChrontelResetDB</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
              <span class="n">SiS_ChrontelDoSomething2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
              <span class="n">SiS_ChrontelDoSomething3</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
           <span class="p">}</span>
	<span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="cm">/* 650 */</span>

        <span class="n">SiS_ChrontelResetDB</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
        <span class="n">SiS_ChrontelDoSomething2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x34</span><span class="p">);</span>
        <span class="n">SiS_ChrontelDoSomething3</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
        <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x76</span><span class="p">,</span><span class="mh">0xaf</span><span class="p">);</span>  <span class="cm">/* All power on, LVDS normal operation */</span>

     <span class="p">}</span>

<span class="p">}</span>
<span class="cp">#endif  </span><span class="cm">/* 315 series  */</span><span class="cp"></span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*      MAIN: SET CRT2 REGISTER GROUP        */</span>
<span class="cm">/*********************************************/</span>

<span class="n">bool</span>
<span class="nf">SiS_SetCRT2Group</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span>  <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
<span class="cp">#endif</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">;</span>

   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">|=</span> <span class="n">ProgrammingCRT2</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_SearchModeID</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ModeNo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ModeIdIndex</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">ModeIdIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="cm">/* Used for shifting CR33 */</span>
   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SelectCRT2Rate</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

   <span class="n">SiS_UnLockCRT2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

   <span class="n">RefreshRateTableIndex</span> <span class="o">=</span> <span class="n">SiS_GetRatePtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>

   <span class="n">SiS_SaveCRT2Info</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">);</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LowModeTests</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_DisableBridge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_730</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">SiS_SetCRT2ModeRegs</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">DisableCRT2Display</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_LockCRT2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="n">SiS_DisplayOn</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">SiS_GetCRT2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>

   <span class="cm">/* Set up Panel Link for LVDS and LCDA */</span>
   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDHDES</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDVDES</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span>
       <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">))</span> <span class="o">||</span>
       <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_GetLVDSDesData</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LowModeTests</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_SetGroup1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LowModeTests</span><span class="p">)</span> <span class="p">{</span>

	 <span class="n">SiS_SetGroup2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
	 <span class="n">SiS_SetGroup2_C_ELV</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
<span class="cp">#endif</span>
	 <span class="n">SiS_SetGroup3</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>
	 <span class="n">SiS_SetGroup4</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
	 <span class="n">SiS_SetGroup4_C_ELV</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>
<span class="cp">#endif</span>
	 <span class="n">SiS_SetGroup5</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>

	 <span class="n">SiS_SetCRT2Sync</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>

	 <span class="cm">/* For 301BDH (Panel link initialization): */</span>
	 <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_NoLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">))</span> <span class="p">{</span>

	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">SetDOSMode</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">))))</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="p">{</span>
		  <span class="n">SiS_ModCRT1CRTC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	       <span class="p">}</span>
            <span class="p">}</span>
	    <span class="n">SiS_SetCRT2ECLK</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	 <span class="p">}</span>
      <span class="p">}</span>

   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

      <span class="n">SiS_SetCRT2Sync</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>

      <span class="n">SiS_ModCRT1CRTC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">,</span><span class="n">RefreshRateTableIndex</span><span class="p">);</span>

      <span class="n">SiS_SetCRT2ECLK</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">,</span><span class="n">RefreshRateTableIndex</span><span class="p">);</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LowModeTests</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
		  <span class="n">SiS_SetCH701xForLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
<span class="cp">#endif</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">SiS_SetCHTVReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">,</span><span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span>

   <span class="p">}</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LowModeTests</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseOEM</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseOEM</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">((</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x233</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x12</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x234</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x34</span><span class="p">))</span> <span class="p">{</span>
		  <span class="n">SiS_OEM300Setting</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	       <span class="p">}</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	       <span class="n">SiS_OEM300Setting</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="o">||</span>
	       <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1024</span><span class="p">))</span> <span class="p">{</span>
	       <span class="n">SetOEMLCDData2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span><span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	    <span class="p">}</span>
	    <span class="n">SiS_DisplayOn</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_315H</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LowModeTests</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">SiS_FinalizeLCD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>
	    <span class="n">SiS_OEM310Setting</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="n">SiS_OEM661Setting</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RefreshRateTableIndex</span><span class="p">);</span>
	 <span class="p">}</span>
	 <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="cp">#endif</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LowModeTests</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_EnableBridge</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="n">SiS_DisplayOn</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
	 <span class="cm">/* Disable LCD panel when using TV */</span>
	 <span class="n">SiS_SetRegSR11ANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xFF</span><span class="p">,</span><span class="mh">0x0C</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	 <span class="cm">/* Disable TV when using LCD */</span>
	 <span class="n">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x0e</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0xf8</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LowModeTests</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_LockCRT2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*********************************************/</span>
<span class="cm">/*     ENABLE/DISABLE LCD BACKLIGHT (SIS)    */</span>
<span class="cm">/*********************************************/</span>

<span class="kt">void</span>
<span class="nf">SiS_SiS30xBLOn</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="cm">/* Switch on LCD backlight on SiS30xLV */</span>
  <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xff00</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0x02</span><span class="p">);</span>
     <span class="n">SiS_WaitVBRetrace</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">SiS_SiS30xBLOff</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="cm">/* Switch off LCD backlight on SiS30xLV */</span>
  <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x26</span><span class="p">,</span><span class="mh">0xFE</span><span class="p">);</span>
  <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0xff00</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*********************************************/</span>
<span class="cm">/*          DDC RELATED FUNCTIONS            */</span>
<span class="cm">/*********************************************/</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetupDDCN</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span> <span class="o">=</span> <span class="o">~</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span><span class="p">;</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NClk</span>  <span class="o">=</span> <span class="o">~</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Clk</span><span class="p">;</span>
  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span> <span class="o">==</span> <span class="mh">0x11</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SensibleSR11</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NClk</span>  <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">SiS_SetTrumpBlockLoop</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dataptr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">num</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempah</span><span class="p">,</span><span class="n">temp</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mydataptr</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>				<span class="cm">/* Do 20 attempts to write */</span>
     <span class="n">mydataptr</span> <span class="o">=</span> <span class="n">dataptr</span><span class="p">;</span>
     <span class="n">num</span> <span class="o">=</span> <span class="o">*</span><span class="n">mydataptr</span><span class="o">++</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">num</span><span class="p">)</span> <span class="k">return</span> <span class="n">mydataptr</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetStop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	<span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">SiS_I2CDELAYSHORT</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetStart</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>		<span class="cm">/* Set start condition */</span>
     <span class="n">tempah</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>	<span class="cm">/* Write DAB (S0=0=write) */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>				<span class="cm">/*    (ERROR: no ack) */</span>
     <span class="n">tempah</span> <span class="o">=</span> <span class="o">*</span><span class="n">mydataptr</span><span class="o">++</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span>	<span class="cm">/* Write register number */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>				<span class="cm">/*    (ERROR: no ack) */</span>
     <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">num</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tempah</span> <span class="o">=</span> <span class="o">*</span><span class="n">mydataptr</span><span class="o">++</span><span class="p">;</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">tempah</span><span class="p">);</span><span class="cm">/* Write DAB (S0=0=write) */</span>
	<span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetStop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
     <span class="k">return</span> <span class="n">mydataptr</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_SetTrumpionBlock</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dataptr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">=</span> <span class="mh">0xF0</span><span class="p">;</span>  		<span class="cm">/* DAB (Device Address Byte) */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>			<span class="cm">/* Bit 0 = SC;  Bit 1 = SD */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span>  <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>			<span class="cm">/* Bitmask in IndexReg for Data */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Clk</span>   <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>			<span class="cm">/* Bitmask in IndexReg for Clk */</span>
  <span class="n">SiS_SetupDDCN</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

  <span class="n">SiS_SetSwitchDDC2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

  <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">dataptr</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">dataptr</span> <span class="o">=</span> <span class="n">SiS_SetTrumpBlockLoop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">dataptr</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">dataptr</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/* The Chrontel 700x is connected to the 630/730 via</span>
<span class="cm"> * the 630/730&#39;s DDC/I2C port.</span>
<span class="cm"> *</span>
<span class="cm"> * On 630(S)T chipset, the index changed from 0x11 to</span>
<span class="cm"> * 0x0a, possibly for working around the DDC problems</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">SiS_SetChReg</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">myor</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>				<span class="cm">/* Do 20 attempts to write */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_SetStop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	<span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">SiS_I2CDELAYSHORT</span> <span class="o">*</span> <span class="mi">4</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetStart</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>					<span class="cm">/* Set start condition */</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span><span class="p">);</span>	<span class="cm">/* Write DAB (S0=0=write) */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>							<span class="cm">/*    (ERROR: no ack) */</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="p">(</span><span class="n">reg</span> <span class="o">|</span> <span class="n">myor</span><span class="p">));</span>			<span class="cm">/* Write RAB (700x: set bit 7, see datasheet) */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>							<span class="cm">/*    (ERROR: no ack) */</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>				<span class="cm">/* Write data */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>							<span class="cm">/*    (ERROR: no ack) */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetStop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>					<span class="cm">/* Set stop condition */</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ChrontelInit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Write to Chrontel 700x */</span>
<span class="kt">void</span>
<span class="nf">SiS_SetCH700x</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">=</span> <span class="mh">0xEA</span><span class="p">;</span>  		<span class="cm">/* DAB (Device Address Byte) */</span>

  <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">SiS_I2CDELAYSHORT</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ChrontelInit</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>		<span class="cm">/* Bit 0 = SC;  Bit 1 = SD */</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span>  <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>		<span class="cm">/* Bitmask in IndexReg for Data */</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Clk</span>   <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>		<span class="cm">/* Bitmask in IndexReg for Clk */</span>
     <span class="n">SiS_SetupDDCN</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_SetChReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">)))</span> <span class="o">&amp;&amp;</span>
      <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ChrontelInit</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span>  <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Clk</span>   <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
     <span class="n">SiS_SetupDDCN</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

     <span class="n">SiS_SetChReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Write to Chrontel 701x */</span>
<span class="cm">/* Parameter is [Data (S15-S8) | Register no (S7-S0)] */</span>
<span class="kt">void</span>
<span class="nf">SiS_SetCH701x</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>			<span class="cm">/* Bit 0 = SC;  Bit 1 = SD */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span>  <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>			<span class="cm">/* Bitmask in IndexReg for Data */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Clk</span>   <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>			<span class="cm">/* Bitmask in IndexReg for Clk */</span>
  <span class="n">SiS_SetupDDCN</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">=</span> <span class="mh">0xEA</span><span class="p">;</span>		<span class="cm">/* DAB (Device Address Byte) */</span>
  <span class="n">SiS_SetChReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="kt">void</span>
<span class="nf">SiS_SetCH70xx</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
     <span class="n">SiS_SetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
  <span class="k">else</span>
     <span class="n">SiS_SetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_GetChReg</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">myor</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempah</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>				<span class="cm">/* Do 20 attempts to read */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_SetStop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	<span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">SiS_I2CDELAYSHORT</span> <span class="o">*</span> <span class="mi">4</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetStart</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>					<span class="cm">/* Set start condition */</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span><span class="p">);</span>	<span class="cm">/* Write DAB (S0=0=write) */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>							<span class="cm">/*        (ERROR: no ack) */</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_ReadAddr</span> <span class="o">|</span> <span class="n">myor</span><span class="p">);</span>	<span class="cm">/* Write RAB (700x: | 0x80) */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>							<span class="cm">/*        (ERROR: no ack) */</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">SiS_SetStart</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>				<span class="cm">/* Re-start */</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">|</span> <span class="mh">0x01</span><span class="p">);</span><span class="cm">/* DAB (S0=1=read) */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>							<span class="cm">/*        (ERROR: no ack) */</span>
     <span class="n">tempah</span> <span class="o">=</span> <span class="n">SiS_ReadDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>					<span class="cm">/* Read byte */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetStop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>					<span class="cm">/* Stop condition */</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ChrontelInit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">return</span> <span class="n">tempah</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Read from Chrontel 700x */</span>
<span class="cm">/* Parameter is [Register no (S7-S0)] */</span>
<span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_GetCH700x</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempbx</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">result</span><span class="p">;</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">=</span> <span class="mh">0xEA</span><span class="p">;</span>		<span class="cm">/* DAB */</span>

  <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">SiS_I2CDELAYSHORT</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ChrontelInit</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>		<span class="cm">/* Bit 0 = SC;  Bit 1 = SD */</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span>  <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>		<span class="cm">/* Bitmask in IndexReg for Data */</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Clk</span>   <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>		<span class="cm">/* Bitmask in IndexReg for Clk */</span>
     <span class="n">SiS_SetupDDCN</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_ReadAddr</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span> <span class="p">((</span><span class="n">result</span> <span class="o">=</span> <span class="n">SiS_GetChReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x80</span><span class="p">))</span> <span class="o">==</span> <span class="mh">0xFFFF</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
      <span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ChrontelInit</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>

     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span>  <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Clk</span>   <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
     <span class="n">SiS_SetupDDCN</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

     <span class="n">result</span> <span class="o">=</span> <span class="n">SiS_GetChReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Read from Chrontel 701x */</span>
<span class="cm">/* Parameter is [Register no (S7-S0)] */</span>
<span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_GetCH701x</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempbx</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>			<span class="cm">/* Bit 0 = SC;  Bit 1 = SD */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span>  <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>			<span class="cm">/* Bitmask in IndexReg for Data */</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Clk</span>   <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>			<span class="cm">/* Bitmask in IndexReg for Clk */</span>
  <span class="n">SiS_SetupDDCN</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">=</span> <span class="mh">0xEA</span><span class="p">;</span>		<span class="cm">/* DAB */</span>

  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_ReadAddr</span> <span class="o">=</span> <span class="n">tempbx</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">SiS_GetChReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Read from Chrontel 70xx */</span>
<span class="cm">/* Parameter is [Register no (S7-S0)] */</span>
<span class="k">static</span>
<span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_GetCH70xx</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempbx</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
     <span class="k">return</span> <span class="n">SiS_GetCH700x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">tempbx</span><span class="p">);</span>
  <span class="k">else</span>
     <span class="k">return</span> <span class="n">SiS_GetCH701x</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">tempbx</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">SiS_SetCH70xxANDOR</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">myor</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">myand</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempbl</span><span class="p">;</span>

  <span class="n">tempbl</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_GetCH70xx</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">myand</span><span class="p">)</span> <span class="o">|</span> <span class="n">myor</span><span class="p">;</span>
  <span class="n">SiS_SetCH70xx</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">tempbl</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Our own DDC functions */</span>
<span class="k">static</span>
<span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_InitDDCRegs</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">VBFlags</span><span class="p">,</span> <span class="kt">int</span> <span class="n">VGAEngine</span><span class="p">,</span>
                <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">adaptnum</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">DDCdatatype</span><span class="p">,</span> <span class="n">bool</span> <span class="n">checkcr32</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">VBFlags2</span><span class="p">)</span>
<span class="p">{</span>
     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ddcdtype</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0xa6</span> <span class="p">};</span>
     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">flag</span><span class="p">,</span> <span class="n">cr32</span><span class="p">;</span>
     <span class="kt">unsigned</span> <span class="kt">short</span>        <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">myadaptnum</span> <span class="o">=</span> <span class="n">adaptnum</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">adaptnum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">VBFlags2</span> <span class="o">&amp;</span> <span class="n">VB2_SISTMDSBRIDGE</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
	<span class="k">if</span><span class="p">((</span><span class="n">VBFlags2</span> <span class="o">&amp;</span> <span class="n">VB2_30xBDH</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">adaptnum</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="cm">/* adapternum for SiS bridges: 0 = CRT1, 1 = LCD, 2 = VGA2 */</span>

     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ChrontelInit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   <span class="cm">/* force re-detection! */</span>

     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_SecAddr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">=</span> <span class="n">ddcdtype</span><span class="p">[</span><span class="n">DDCdatatype</span><span class="p">];</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">;</span>
     <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
     <span class="n">flag</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>

     <span class="n">cr32</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x32</span><span class="p">);</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">     if(VBFlags2 &amp; VB2_SISBRIDGE) {</span>
<span class="c">	if(myadaptnum == 0) {</span>
<span class="c">	   if(!(cr32 &amp; 0x20)) {</span>
<span class="c">	      myadaptnum = 2;</span>
<span class="c">	      if(!(cr32 &amp; 0x10)) {</span>
<span class="c">	         myadaptnum = 1;</span>
<span class="c">		 if(!(cr32 &amp; 0x08)) {</span>
<span class="c">		    myadaptnum = 0;</span>
<span class="c">		 }</span>
<span class="c">	      }</span>
<span class="c">	   }</span>
<span class="c">        }</span>
<span class="c">     }</span>
<span class="cp">#endif</span>

     <span class="k">if</span><span class="p">(</span><span class="n">VGAEngine</span> <span class="o">==</span> <span class="n">SIS_300_VGA</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* 300 series */</span>

        <span class="k">if</span><span class="p">(</span><span class="n">myadaptnum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">VBFlags2</span> <span class="o">&amp;</span> <span class="n">VB2_SISBRIDGE</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">;</span>
              <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	   <span class="p">}</span>
        <span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">VBFlags2</span> <span class="o">&amp;</span> <span class="n">VB2_301</span><span class="p">))</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">cr32</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">checkcr32</span><span class="p">))</span> <span class="p">{</span>
              <span class="k">if</span><span class="p">(</span><span class="n">myadaptnum</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	         <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cr32</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">))</span> <span class="p">{</span>
		     <span class="n">myadaptnum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cr32</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
                 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">myadaptnum</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>						<span class="cm">/* 315/330 series */</span>

	<span class="cm">/* here we simplify: 0 = CRT1, 1 = CRT2 (VGA, LCD) */</span>

	<span class="k">if</span><span class="p">(</span><span class="n">VBFlags2</span> <span class="o">&amp;</span> <span class="n">VB2_SISBRIDGE</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">myadaptnum</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">myadaptnum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">myadaptnum</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">VBFlags2</span> <span class="o">&amp;</span> <span class="n">VB2_SISBRIDGE</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">;</span>
              <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	   <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">((</span><span class="n">cr32</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">checkcr32</span><span class="p">))</span> <span class="p">{</span>
           <span class="k">if</span><span class="p">(</span><span class="n">myadaptnum</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cr32</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">))</span> <span class="p">{</span>
	         <span class="n">myadaptnum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		 <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cr32</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="n">myadaptnum</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">myadaptnum</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">VBFlags2</span> <span class="o">&amp;</span> <span class="n">VB2_LVDS</span><span class="p">)</span> <span class="n">flag</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
        <span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span> <span class="o">=</span> <span class="mh">0x02</span> <span class="o">&lt;&lt;</span> <span class="n">temp</span><span class="p">;</span>
    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Clk</span>  <span class="o">=</span> <span class="mh">0x01</span> <span class="o">&lt;&lt;</span> <span class="n">temp</span><span class="p">;</span>

    <span class="n">SiS_SetupDDCN</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_WriteDABDDC</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetStart</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_SecAddr</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_PrepareReadDDC</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetStart</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_WriteDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">|</span> <span class="mh">0x01</span><span class="p">)))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_PrepareDDC</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_WriteDABDDC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="n">SiS_WriteDABDDC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_PrepareReadDDC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">return</span> <span class="p">(</span><span class="n">SiS_PrepareReadDDC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">));</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SendACK</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">yesno</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">SiS_SetSCLKLow</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="n">yesno</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span><span class="p">,</span>
		      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span><span class="p">,</span>
		      <span class="mi">0</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="n">SiS_SetSCLKHigh</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_DoProbeDDC</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">mask</span><span class="p">,</span> <span class="n">value</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">temp</span><span class="p">,</span> <span class="n">ret</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">bool</span> <span class="n">failed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

    <span class="n">SiS_SetSwitchDDC2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_PrepareDDC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">SiS_SetStop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
         <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xf0</span><span class="p">;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">==</span> <span class="mh">0xa0</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">SiS_ReadDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
       <span class="n">SiS_SendACK</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
       <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
	   <span class="n">value</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
           <span class="n">failed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	   <span class="n">ret</span> <span class="o">=</span> <span class="mh">0xFFFF</span><span class="p">;</span>
       <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">failed</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">SiS_ReadDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
       <span class="n">SiS_SendACK</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
       <span class="n">temp</span> <span class="o">&amp;=</span> <span class="n">mask</span><span class="p">;</span>
       <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
       <span class="k">else</span> <span class="p">{</span>
          <span class="n">ret</span> <span class="o">=</span> <span class="mh">0xFFFF</span><span class="p">;</span>
          <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">==</span> <span class="mh">0xa0</span><span class="p">)</span> <span class="p">{</span>
             <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mh">0x30</span><span class="p">)</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="p">}</span>
       <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">SiS_SetStop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_ProbeDDC</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">flag</span><span class="p">;</span>

   <span class="n">flag</span> <span class="o">=</span> <span class="mh">0x180</span><span class="p">;</span>
   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">=</span> <span class="mh">0xa0</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_DoProbeDDC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="n">flag</span> <span class="o">|=</span> <span class="mh">0x02</span><span class="p">;</span>
   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">=</span> <span class="mh">0xa2</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_DoProbeDDC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="n">flag</span> <span class="o">|=</span> <span class="mh">0x08</span><span class="p">;</span>
   <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_DeviceAddr</span> <span class="o">=</span> <span class="mh">0xa6</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_DoProbeDDC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="n">flag</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="mh">0x1a</span><span class="p">))</span> <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">return</span> <span class="n">flag</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_ReadDDC</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">DDCdatatype</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">flag</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">chksum</span><span class="p">,</span><span class="n">gotcha</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">DDCdatatype</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>

   <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="n">SiS_SetSwitchDDC2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_PrepareDDC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
      <span class="n">length</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">DDCdatatype</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
      <span class="n">chksum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">gotcha</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	 <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">SiS_ReadDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	 <span class="n">chksum</span> <span class="o">+=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	 <span class="n">gotcha</span> <span class="o">|=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	 <span class="n">SiS_SendACK</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">SiS_ReadDDC2Data</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="n">chksum</span> <span class="o">+=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">SiS_SendACK</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">gotcha</span><span class="p">)</span> <span class="n">flag</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">chksum</span><span class="p">;</span>
      <span class="k">else</span> <span class="n">flag</span> <span class="o">=</span> <span class="mh">0xFFFF</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">flag</span> <span class="o">=</span> <span class="mh">0xFFFF</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="n">SiS_SetStop</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">flag</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Our private DDC functions</span>

<span class="cm">   It complies somewhat with the corresponding VESA function</span>
<span class="cm">   in arguments and return values.</span>

<span class="cm">   Since this is probably called before the mode is changed,</span>
<span class="cm">   we use our pre-detected pSiS-values instead of SiS_Pr as</span>
<span class="cm">   regards chipset and video bridge type.</span>

<span class="cm">   Arguments:</span>
<span class="cm">       adaptnum: 0=CRT1(analog), 1=CRT2/LCD(digital), 2=CRT2/VGA2(analog)</span>
<span class="cm">                 CRT2 DDC is only supported on SiS301, 301B, 301C, 302B.</span>
<span class="cm">		 LCDA is CRT1, but DDC is read from CRT2 port.</span>
<span class="cm">       DDCdatatype: 0=Probe, 1=EDID, 2=EDID+VDIF, 3=EDID V2 (P&amp;D), 4=EDID V2 (FPDI-2)</span>
<span class="cm">       buffer: ptr to 256 data bytes which will be filled with read data.</span>

<span class="cm">   Returns 0xFFFF if error, otherwise</span>
<span class="cm">       if DDCdatatype &gt; 0:  Returns 0 if reading OK (included a correct checksum)</span>
<span class="cm">       if DDCdatatype = 0:  Returns supported DDC modes</span>

<span class="cm"> */</span>
<span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_HandleDDC</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">VBFlags</span><span class="p">,</span> <span class="kt">int</span> <span class="n">VGAEngine</span><span class="p">,</span>
              <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">adaptnum</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">DDCdatatype</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
	      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">VBFlags2</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">sr1f</span><span class="p">,</span> <span class="n">cr17</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">result</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">adaptnum</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
      <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">DDCdatatype</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
      <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>

   <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">VBFlags2</span> <span class="o">&amp;</span> <span class="n">VB2_VIDEOBRIDGE</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">adaptnum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
      <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_InitDDCRegs</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">VBFlags</span><span class="p">,</span> <span class="n">VGAEngine</span><span class="p">,</span> <span class="n">adaptnum</span><span class="p">,</span> <span class="n">DDCdatatype</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="n">VBFlags2</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xFFFF</span><span class="p">)</span>
      <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>

   <span class="n">sr1f</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">);</span>
   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="mh">0x04</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="n">VGAEngine</span> <span class="o">==</span> <span class="n">SIS_300_VGA</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">cr17</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x17</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cr17</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x17</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
         <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
         <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="k">if</span><span class="p">((</span><span class="n">sr1f</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">cr17</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">SiS_WaitRetrace1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="n">SiS_WaitRetrace1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="n">SiS_WaitRetrace1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="n">SiS_WaitRetrace1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">DDCdatatype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">SiS_ProbeDDC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">SiS_ReadDDC</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">DDCdatatype</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
      <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="n">result</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">DDCdatatype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
         <span class="k">if</span><span class="p">((</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mh">0x12</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">DDCPortMixup</span><span class="p">)</span> <span class="p">{</span>
	       <span class="k">if</span><span class="p">(</span><span class="n">adaptnum</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mh">0x14</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">))</span> <span class="n">result</span> <span class="o">=</span> <span class="mh">0xFFFE</span><span class="p">;</span>
	       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	          <span class="k">if</span><span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mh">0x14</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span>    <span class="n">result</span> <span class="o">=</span> <span class="mh">0xFFFE</span><span class="p">;</span>
	       <span class="p">}</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">,</span><span class="n">sr1f</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="n">VGAEngine</span> <span class="o">==</span> <span class="n">SIS_300_VGA</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x17</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">,</span><span class="n">cr17</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic I2C functions for Chrontel &amp; DDC --------- */</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_SetSwitchDDC2</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">SiS_SetSCLKHigh</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
  <span class="n">SiS_WaitRetrace1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

  <span class="n">SiS_SetSCLKLow</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
  <span class="n">SiS_WaitRetrace1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_ReadDDC1Bit</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">SiS_WaitRetrace1</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
   <span class="k">return</span> <span class="p">((</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3c4</span><span class="p">,</span><span class="mh">0x11</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Set I2C start condition */</span>
<span class="cm">/* This is done by a SD high-to-low transition while SC is high */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_SetStart</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetSCLKLow</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>			<span class="cm">/* (SC-&gt;low)  */</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span><span class="p">);</span>        		<span class="cm">/* SD-&gt;high */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetSCLKHigh</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>			<span class="cm">/* SC-&gt;high */</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span><span class="p">,</span>
		  <span class="mh">0x00</span><span class="p">);</span>					<span class="cm">/* SD-&gt;low = start condition */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetSCLKHigh</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>			<span class="cm">/* (SC-&gt;low) */</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Set I2C stop condition */</span>
<span class="cm">/* This is done by a SD low-to-high transition while SC is high */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_SetStop</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetSCLKLow</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>			<span class="cm">/* (SC-&gt;low) */</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span><span class="p">,</span>
		  <span class="mh">0x00</span><span class="p">);</span>					<span class="cm">/* SD-&gt;low   */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetSCLKHigh</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>			<span class="cm">/* SC-&gt;high  */</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span><span class="p">);</span>			<span class="cm">/* SD-&gt;high = stop condition */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_SetSCLKHigh</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>			<span class="cm">/* (SC-&gt;high) */</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Write 8 bits of data */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_WriteDDC2Data</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempax</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">i</span><span class="p">,</span><span class="n">flag</span><span class="p">,</span><span class="n">temp</span><span class="p">;</span>

  <span class="n">flag</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">SiS_SetSCLKLow</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>					<span class="cm">/* SC-&gt;low */</span>
    <span class="k">if</span><span class="p">(</span><span class="n">tempax</span> <span class="o">&amp;</span> <span class="n">flag</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span><span class="p">,</span>
		      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span><span class="p">);</span>			<span class="cm">/* Write bit (1) to SD */</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		      <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span><span class="p">,</span>
		      <span class="mh">0x00</span><span class="p">);</span>					<span class="cm">/* Write bit (0) to SD */</span>
    <span class="p">}</span>
    <span class="n">SiS_SetSCLKHigh</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>					<span class="cm">/* SC-&gt;high */</span>
    <span class="n">flag</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_CheckACK</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>					<span class="cm">/* Check acknowledge */</span>
  <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_ReadDDC2Data</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">i</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">getdata</span><span class="p">;</span>

  <span class="n">getdata</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">getdata</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">SiS_SetSCLKLow</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span><span class="p">,</span>
		    <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span><span class="p">);</span>
    <span class="n">SiS_SetSCLKHigh</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span><span class="p">)</span> <span class="n">getdata</span> <span class="o">|=</span> <span class="mh">0x01</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">getdata</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_SetSCLKLow</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NClk</span><span class="p">,</span>
		  <span class="mh">0x00</span><span class="p">);</span>					<span class="cm">/* SetSCLKLow()  */</span>
  <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">SiS_I2CDELAYSHORT</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_SetSCLKHigh</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">temp</span><span class="p">,</span> <span class="n">watchdog</span><span class="o">=</span><span class="mi">1000</span><span class="p">;</span>

  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NClk</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Clk</span><span class="p">);</span>  			<span class="cm">/* SetSCLKHigh()  */</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">while</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Clk</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">--</span><span class="n">watchdog</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">watchdog</span><span class="p">)</span> <span class="p">{</span>
  	<span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">SiS_DDC2Delay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">SiS_I2CDELAYSHORT</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Check I2C acknowledge */</span>
<span class="cm">/* Returns 0 if ack ok, non-0 if ack not ok */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_CheckACK</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempah</span><span class="p">;</span>

  <span class="n">SiS_SetSCLKLow</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>				           <span class="cm">/* (SC-&gt;low) */</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_NData</span><span class="p">,</span>
		  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span><span class="p">);</span>			   <span class="cm">/* (SD-&gt;high) */</span>
  <span class="n">SiS_SetSCLKHigh</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>				           <span class="cm">/* SC-&gt;high = clock impulse for ack */</span>
  <span class="n">tempah</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Port</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Index</span><span class="p">);</span> <span class="cm">/* Read SD */</span>
  <span class="n">SiS_SetSCLKLow</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>				           <span class="cm">/* SC-&gt;low = end of clock impulse */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">tempah</span> <span class="o">&amp;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_DDC_Data</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>			   <span class="cm">/* Ack OK if bit = 0 */</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* End of I2C functions ----------------------- */</span>


<span class="cm">/* =============== SiS 315/330 O.E.M. ================= */</span>

<span class="cp">#ifdef CONFIG_FB_SIS_315</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">GetRAMDACromptr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">romptr</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_330</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x128</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xB</span><span class="p">)</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x12a</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x1a8</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xB</span><span class="p">)</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x1aa</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">romptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">GetLCDromptr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">romptr</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_330</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x120</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x122</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x1a0</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x1a2</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">romptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">GetTVromptr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">romptr</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_330</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x114</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x11a</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x194</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x19a</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">romptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">GetLCDPtrIndexBIOS</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">;</span>

  <span class="k">if</span><span class="p">((</span><span class="n">IS_SIS650</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_IsNotM650orLater</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">((</span><span class="n">index</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">index</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span>
	   <span class="n">index</span> <span class="o">*=</span> <span class="mi">3</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="n">index</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
           <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="n">index</span><span class="o">++</span><span class="p">;</span>
           <span class="k">return</span> <span class="n">index</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_GetBIOSLCDResInfo</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">)</span>      <span class="n">index</span> <span class="o">-=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301C</span><span class="p">)</span> <span class="p">{</span>  <span class="cm">/* 1.15.20 and later (not VB specific) */</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">)</span> <span class="n">index</span> <span class="o">-=</span> <span class="mi">5</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x768</span><span class="p">)</span> <span class="n">index</span> <span class="o">-=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">)</span> <span class="n">index</span> <span class="o">-=</span> <span class="mi">6</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">index</span><span class="o">--</span><span class="p">;</span>
  <span class="n">index</span> <span class="o">*=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="n">index</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="n">index</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">index</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">GetLCDPtrIndex</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">;</span>

  <span class="n">index</span> <span class="o">=</span> <span class="p">((</span><span class="n">SiS_GetBIOSLCDResInfo</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span>         <span class="n">index</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="n">index</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">index</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">GetTVPtrIndex</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">;</span>

  <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="n">index</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
     <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">))</span> <span class="p">{</span>
     <span class="n">index</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">index</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span>
<span class="nf">GetOEMTVPtr661_2_GEN</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addme</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span>   <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span>  <span class="n">index</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALN</span><span class="p">)</span>  <span class="n">index</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSCJ</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSC1024</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">index</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span>  <span class="n">index</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSCJ</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="o">||</span>
         <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">))</span> <span class="p">{</span>
	 <span class="n">index</span> <span class="o">+=</span> <span class="n">addme</span><span class="p">;</span>
	 <span class="n">temp</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">temp</span> <span class="o">+=</span> <span class="mh">0x0100</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)(</span><span class="n">index</span> <span class="o">|</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span>
<span class="nf">GetOEMTVPtr661_2_OLD</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">GetOEMTVPtr661_2_GEN</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static unsigned int</span>
<span class="c">GetOEMTVPtr661_2_NEW(struct SiS_Private *SiS_Pr)</span>
<span class="c">{</span>
<span class="c">   return (GetOEMTVPtr661_2_GEN(SiS_Pr, 6));</span>
<span class="c">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">GetOEMTVPtr661</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span>          <span class="n">index</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525i</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetHiVision</span><span class="p">)</span>  <span class="n">index</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetHiVision</span><span class="p">)</span>  <span class="n">index</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525i</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr525p</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetYPbPr750p</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">)</span> <span class="n">index</span><span class="o">++</span><span class="p">;</span>

   <span class="k">return</span> <span class="n">index</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetDelayComp</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">myindex</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">romptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">bool</span> <span class="n">dochiptest</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0xbf</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x35</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/* Find delay (from ROM, internal tables, PCI subsystem) */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">)</span> <span class="p">{</span>			<span class="cm">/* ------------ VGA */</span>

     <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">GetRAMDACromptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="n">delay</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="p">];</span>
     <span class="k">else</span> <span class="p">{</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xB</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS650</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;</span> <span class="n">SIS_330</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">;</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span><span class="o">|</span><span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>  <span class="cm">/* ----------	LCD/LCDA */</span>

     <span class="n">bool</span> <span class="n">gotitfrompci</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

     <span class="cm">/* Could we detect a PDC for LCD or did we get a user-defined? If yes, use it */</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDC</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="mh">0xf0</span><span class="p">,((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDC</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">));</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x35</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">,((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDC</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">));</span>
	   <span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDCA</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDCA</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0xbf</span><span class="p">,((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDCA</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">));</span>
	   <span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>

     <span class="cm">/* Custom Panel? */</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_Custom</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">&lt;=</span> <span class="mi">1280</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">&lt;=</span> <span class="mi">1024</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,</span><span class="n">delay</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">;</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301C</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">&gt;</span> <span class="mi">1280</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">))</span> <span class="p">{</span>
	         <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	      <span class="p">}</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
	      <span class="k">else</span>          <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	   <span class="p">}</span>
	   <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="mh">0xf0</span><span class="p">,</span><span class="n">delay</span><span class="p">);</span>
	<span class="p">}</span>
        <span class="k">return</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="cm">/* This is a piece of typical SiS crap: They code the OEM LCD</span>
<span class="cm">      * delay into the code, at no defined place in the BIOS.</span>
<span class="cm">      * We now have to start doing a PCI subsystem check here.</span>
<span class="cm">      */</span>

     <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">case</span> <span class="n">CUT_COMPAQ1280</span>:
     <span class="k">case</span> <span class="n">CUT_COMPAQ12802</span>:
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">gotitfrompci</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	   <span class="n">dochiptest</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	   <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">CUT_CLEVO1400</span>:
     <span class="k">case</span> <span class="n">CUT_CLEVO14002</span>:
	<span class="n">gotitfrompci</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">dochiptest</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">delay</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="k">case</span> <span class="n">CUT_CLEVO1024</span>:
     <span class="k">case</span> <span class="n">CUT_CLEVO10242</span>:
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">gotitfrompci</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	   <span class="n">dochiptest</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	   <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x33</span><span class="p">;</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="n">delay</span><span class="p">);</span>
	   <span class="n">delay</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="cm">/* Could we find it through the PCI ID? If no, use ROM or table */</span>

     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">gotitfrompci</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">GetLCDPtrIndexBIOS</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
        <span class="n">myindex</span> <span class="o">=</span> <span class="n">GetLCDPtrIndex</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS650</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">))</span> <span class="p">{</span>

           <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsNotM650orLater</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>

              <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)))</span> <span class="p">{</span>
	         <span class="cm">/* Always use the second pointer on 650; some BIOSes */</span>
                 <span class="cm">/* still carry old 301 data at the first location    */</span>
	         <span class="cm">/* romptr = SISGETROMW(0x120);                       */</span>
	         <span class="cm">/* if(SiS_Pr-&gt;SiS_VBType &amp; VB_SIS302LV)              */</span>
	         <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x122</span><span class="p">);</span>
	         <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">romptr</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
	         <span class="n">delay</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[(</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">index</span><span class="p">)];</span>
	      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                 <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_LCDDelayCompensation_650301LV</span><span class="p">[</span><span class="n">myindex</span><span class="p">];</span>
	      <span class="p">}</span>

          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

             <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_LCDDelayCompensation_651301LV</span><span class="p">[</span><span class="n">myindex</span><span class="p">];</span>
	     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">VB_SIS302LV</span> <span class="o">|</span> <span class="n">VB_SIS302ELV</span><span class="p">))</span>
	        <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_LCDDelayCompensation_651302LV</span><span class="p">[</span><span class="n">myindex</span><span class="p">];</span>

          <span class="p">}</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span> 			      <span class="o">&amp;&amp;</span>
		  <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">))</span>		      <span class="o">&amp;&amp;</span>
	          <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">!=</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">!=</span> <span class="n">Panel_1280x768</span><span class="p">)</span>  <span class="o">&amp;&amp;</span>
		  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">!=</span> <span class="n">Panel_1280x960</span><span class="p">)</span>  <span class="o">&amp;&amp;</span>
		  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">!=</span> <span class="n">Panel_1600x1200</span><span class="p">)</span>  <span class="o">&amp;&amp;</span>
		  <span class="p">((</span><span class="n">romptr</span> <span class="o">=</span> <span class="n">GetLCDromptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))))</span> <span class="p">{</span>

	   <span class="cm">/* Data for 1280x1024 wrong in 301B BIOS */</span>
	   <span class="cm">/* Data for 1600x1200 wrong in 301C BIOS */</span>
	   <span class="n">delay</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[(</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">index</span><span class="p">)];</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

	   <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	   <span class="k">else</span>          <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

           <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_LCDDelayCompensation_301</span><span class="p">[</span><span class="n">myindex</span><span class="p">];</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
	      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&lt;=</span> <span class="n">SIS_315PRO</span><span class="p">)</span> <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_LCDDelayCompensation_3xx301LV</span><span class="p">[</span><span class="n">myindex</span><span class="p">];</span>
	      <span class="k">else</span>          <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_LCDDelayCompensation_650301LV</span><span class="p">[</span><span class="n">myindex</span><span class="p">];</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301C</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>  <span class="cm">/* ? */</span>
	      <span class="k">else</span>          <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1600x1200</span><span class="p">)</span> <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span> <span class="cm">/* experience */</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xB</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
	      <span class="k">else</span>          <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_LCDDelayCompensation_3xx301B</span><span class="p">[</span><span class="n">myindex</span><span class="p">];</span>
	   <span class="p">}</span>

        <span class="p">}</span>

     <span class="p">}</span>  <span class="cm">/* got it from PCI */</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,((</span><span class="n">delay</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>
	<span class="n">dochiptest</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
     <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>			<span class="cm">/* ------------ TV */</span>

     <span class="n">index</span> <span class="o">=</span> <span class="n">GetTVPtrIndex</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

     <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS650</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">))</span> <span class="p">{</span>

        <span class="k">if</span><span class="p">(</span><span class="n">SiS_IsNotM650orLater</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>

           <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)))</span> <span class="p">{</span>
	      <span class="cm">/* Always use the second pointer on 650; some BIOSes */</span>
              <span class="cm">/* still carry old 301 data at the first location    */</span>
              <span class="cm">/* romptr = SISGETROMW(0x114);			   */</span>
	      <span class="cm">/* if(SiS_Pr-&gt;SiS_VBType &amp; VB_SIS302LV)              */</span>
	      <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x11a</span><span class="p">);</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">romptr</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
	      <span class="n">delay</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">index</span><span class="p">];</span>

	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	      <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_TVDelayCompensation_301B</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>

	   <span class="p">}</span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

           <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">case</span> <span class="n">CUT_COMPAQ1280</span>:
	   <span class="k">case</span> <span class="n">CUT_COMPAQ12802</span>:
	   <span class="k">case</span> <span class="n">CUT_CLEVO1400</span>:
	   <span class="k">case</span> <span class="n">CUT_CLEVO14002</span>:
	      <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>
	      <span class="n">dochiptest</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	      <span class="k">break</span><span class="p">;</span>
	   <span class="k">case</span> <span class="n">CUT_CLEVO1024</span>:
	   <span class="k">case</span> <span class="n">CUT_CLEVO10242</span>:
	      <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	      <span class="n">dochiptest</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
   	      <span class="k">break</span><span class="p">;</span>
	   <span class="nl">default:</span>
              <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_TVDelayCompensation_651301LV</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS302LV</span><span class="p">)</span> <span class="p">{</span>
	         <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_TVDelayCompensation_651302LV</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
        <span class="p">}</span>

     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)))</span> <span class="p">{</span>

        <span class="n">romptr</span> <span class="o">=</span> <span class="n">GetTVromptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">romptr</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
	<span class="n">delay</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">index</span><span class="p">];</span>

     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_TVDelayCompensation_LVDS</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

	<span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_TVDelayCompensation_301</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS740</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_TVDelayCompensation_740301B</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
	      <span class="cm">/* LV: use 301 data? BIOS bug? */</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS310_TVDelayCompensation_301B</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301C</span><span class="p">)</span> <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span>

     <span class="p">}</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_LCDAEnabled</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">delay</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">dochiptest</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
     <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="k">return</span><span class="p">;</span>

  <span class="cm">/* Write delay */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

     <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS650</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">dochiptest</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* 1400x1050 BIOS (COMPAL) */</span>
	   <span class="n">delay</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
	   <span class="n">delay</span> <span class="o">|=</span> <span class="mh">0xb0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">delay</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
	   <span class="n">delay</span> <span class="o">|=</span> <span class="mh">0xc0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* 1280x1024 BIOS (which one?) */</span>
	   <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x35</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="n">delay</span><span class="p">);</span>

     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">,</span><span class="n">delay</span><span class="p">);</span>

     <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="cm">/* LVDS */</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">,</span><span class="n">delay</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS650</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_CH70xx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
           <span class="n">delay</span> <span class="o">&lt;&lt;=</span> <span class="mi">4</span><span class="p">;</span>
           <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0x0F</span><span class="p">,</span><span class="n">delay</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
           <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2D</span><span class="p">,</span><span class="mh">0xF0</span><span class="p">,</span><span class="n">delay</span><span class="p">);</span>
        <span class="p">}</span>
     <span class="p">}</span>

  <span class="p">}</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetAntiFlicker</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">romptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetYPbPr750p</span><span class="o">|</span><span class="n">TVSetYPbPr525p</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span><span class="o">&lt;=</span><span class="mh">0x13</span><span class="p">)</span>
     <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">VB_StTVFlickerIndex</span><span class="p">;</span>
  <span class="k">else</span>
     <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">VB_ExtTVFlickerIndex</span><span class="p">;</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">GetTVPtrIndex</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
  <span class="n">temp</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>  	  <span class="cm">/* 0: NTSC/YPbPr, 1: PAL, 2: HiTV */</span>
  <span class="n">temp1</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="n">GetOEMTVPtr661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
        <span class="n">temp1</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x260</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_760</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x360</span><span class="p">);</span>
	<span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_330</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x192</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x112</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">temp1</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">temp1</span> <span class="o">+</span> <span class="n">index</span><span class="p">];</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS310_TVAntiFlick1</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="n">temp</span> <span class="o">&lt;&lt;=</span> <span class="mi">4</span><span class="p">;</span>

  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x0A</span><span class="p">,</span><span class="mh">0x8f</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>  <span class="cm">/* index 0A D[6:4] */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetEdgeEnhance</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">romptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">temp1</span> <span class="o">=</span> <span class="n">GetTVPtrIndex</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> 	<span class="cm">/* 0: NTSC/YPbPr, 1: PAL, 2: HiTV */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span>
     <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">VB_StTVEdgeIndex</span><span class="p">;</span>
  <span class="k">else</span>
     <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">VB_ExtTVEdgeIndex</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x26c</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_760</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x36c</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">temp1</span> <span class="o">=</span> <span class="n">GetOEMTVPtr661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
        <span class="n">temp1</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_330</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x1a4</span><span class="p">);</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x124</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">temp1</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">temp1</span> <span class="o">+</span> <span class="n">index</span><span class="p">];</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS310_TVEdge1</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="n">temp</span> <span class="o">&lt;&lt;=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x3A</span><span class="p">,</span><span class="mh">0x1F</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>  <span class="cm">/* index 0A D[7:5] */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetYFilter</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">VB_StTVYFilterIndex</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">VB_ExtTVYFilterIndex</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">GetTVPtrIndex</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>  <span class="cm">/* 0: NTSC/YPbPr, 1: PAL, 2: HiTV */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSCJ</span><span class="p">)</span>	     <span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="cm">/* NTSC-J uses PAL */</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span>    <span class="n">temp</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="cm">/* PAL-M */</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALN</span><span class="p">)</span>    <span class="n">temp</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="cm">/* PAL-N */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="cm">/* HiVision uses PAL */</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mh">0x35</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x38</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS310_TVYFilter2</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
     <span class="p">}</span>
     <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mh">0x48</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x4A</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS310_TVYFilter2</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mh">0x35</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x38</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS310_TVYFilter1</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetPhaseIncr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">resinfo</span><span class="p">,</span><span class="n">romptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">lindex</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

  <span class="cm">/* NTSC-J data not in BIOS, and already set in SetGroup2 */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetNTSCJ</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_661</span><span class="p">)</span> <span class="o">||</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">lindex</span> <span class="o">=</span> <span class="n">GetOEMTVPtr661_2_OLD</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
     <span class="n">lindex</span> <span class="o">&lt;&lt;=</span> <span class="mi">2</span><span class="p">;</span>
     <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mh">0x31</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x34</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS_TVPhase</span><span class="p">[</span><span class="n">lindex</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
     <span class="p">}</span>
     <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/* PAL-M, PAL-N not in BIOS, and already set in SetGroup2 */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetPALM</span> <span class="o">|</span> <span class="n">TVSetPALN</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span><span class="o">&lt;=</span><span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ResInfo</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">GetTVPtrIndex</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
  <span class="cm">/* 0: NTSC Graphics, 1: NTSC Text,    2: PAL Graphics,</span>
<span class="cm">   * 3: PAL Text,      4: HiTV Graphics 5: HiTV Text</span>
<span class="cm">   */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x116</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_330</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x196</span><span class="p">);</span>
     <span class="p">}</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x11c</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_330</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x19c</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">)))</span> <span class="p">{</span>
	   <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x116</span><span class="p">);</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_330</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x196</span><span class="p">);</span>
           <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">romptr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
     <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mh">0x31</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x34</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">index</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>          <span class="cm">/* 0:NTSC, 1:PAL, 2:HiTV */</span>
     <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mh">0x31</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x34</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">))</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS310_TVPhaseIncr1</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetTVSimuMode</span><span class="p">))</span>
           <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS310_TVPhaseIncr2</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
        <span class="k">else</span>
           <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS310_TVPhaseIncr1</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetPAL</span> <span class="o">|</span> <span class="n">TVSetYPbPr525p</span> <span class="o">|</span> <span class="n">TVSetYPbPr750p</span><span class="p">)))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">((</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_640x480</span><span class="p">)</span> <span class="o">||</span>
	   <span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_800x600</span><span class="p">))</span> <span class="p">{</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x31</span><span class="p">,</span><span class="mh">0x21</span><span class="p">);</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="mh">0xf0</span><span class="p">);</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x33</span><span class="p">,</span><span class="mh">0xf5</span><span class="p">);</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x34</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1024x768</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x31</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">);</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="mh">0x8b</span><span class="p">);</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x33</span><span class="p">,</span><span class="mh">0xfb</span><span class="p">);</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x34</span><span class="p">,</span><span class="mh">0x7b</span><span class="p">);</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetDelayComp661</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span>
                <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RTI</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">delay</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">romptr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">lcdpdcindex</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToTV</span> <span class="o">|</span> <span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span> <span class="o">|</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">)))</span>
      <span class="k">return</span><span class="p">;</span>

   <span class="cm">/* 1. New ROM: VGA2 and LCD/LCDA-Pass1:1 */</span>
   <span class="cm">/* (If a custom mode is used, Pass1:1 is always set; hence we do this:) */</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToRAMDAC</span><span class="p">)</span> 			<span class="o">||</span>
         <span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
	  <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">)))</span> <span class="p">{</span>
         <span class="n">index</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
         <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CSRClock</span><span class="p">;</span>
         <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_GetVCLK2Ptr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">,</span><span class="n">RTI</span><span class="p">);</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VCLKData</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">CLOCK</span><span class="p">;</span>
         <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
         <span class="n">index</span> <span class="o">=</span> <span class="p">((</span><span class="n">index</span> <span class="o">/</span> <span class="mi">25</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
         <span class="k">if</span><span class="p">((</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x5b</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToRAMDAC</span> <span class="o">|</span> <span class="n">SetCRT2ToLCD</span><span class="p">)))</span> <span class="p">{</span>
	    <span class="n">index</span><span class="o">++</span><span class="p">;</span>
	 <span class="p">}</span>
	 <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x104</span><span class="p">);</span>
         <span class="n">delay</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">index</span><span class="p">];</span>
         <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToRAMDAC</span> <span class="o">|</span> <span class="n">SetCRT2ToLCD</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="mh">0xf0</span><span class="p">,((</span><span class="n">delay</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">));</span>
            <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x35</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">,((</span><span class="n">delay</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">));</span>
         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,((</span><span class="n">delay</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>
	    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0xbf</span><span class="p">,((</span><span class="n">delay</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">));</span>
         <span class="p">}</span>
         <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="cm">/* 2. Old ROM: VGA2 and LCD/LCDA-Pass 1:1 */</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
   <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span>   <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
   <span class="k">else</span>                      <span class="n">delay</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RTI</span><span class="p">].</span><span class="n">Ext_PDC</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>
   <span class="n">delay</span> <span class="o">|=</span> <span class="p">(</span><span class="n">delay</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">XGI_20</span><span class="p">)</span> <span class="p">{</span>

      <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0606</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>

	 <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0404</span><span class="p">;</span>
         <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_XGIROM</span><span class="p">)</span> <span class="p">{</span>
	     <span class="n">index</span> <span class="o">=</span> <span class="n">GetTVPtrIndex</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
	     <span class="k">if</span><span class="p">((</span><span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x35e</span><span class="p">)))</span> <span class="p">{</span>
	        <span class="n">delay</span> <span class="o">=</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">index</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">delay</span> <span class="o">|=</span> <span class="p">(</span><span class="n">delay</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	     <span class="p">}</span>
	 <span class="p">}</span>

	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">XGI_40</span> <span class="o">&amp;&amp;</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipRevision</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">)</span> <span class="p">{</span>
	       <span class="n">delay</span> <span class="o">-=</span> <span class="mh">0x0404</span><span class="p">;</span>
	    <span class="p">}</span>
	 <span class="p">}</span>
      <span class="p">}</span>

   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">&gt;=</span> <span class="n">SIS_340</span><span class="p">)</span> <span class="p">{</span>

      <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0606</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0404</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="cm">/* TODO (eventually) */</span>

   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>

      <span class="cm">/* 3. TV */</span>

      <span class="n">index</span> <span class="o">=</span> <span class="n">GetOEMTVPtr661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x106</span><span class="p">);</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_UMC</span><span class="p">)</span> <span class="n">romptr</span> <span class="o">+=</span> <span class="mi">12</span><span class="p">;</span>
         <span class="n">delay</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">index</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">index</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="n">delay</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>

   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>

      <span class="cm">/* 4. LCD, LCDA (for new ROM only LV and non-Pass 1:1) */</span>

      <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">!=</span> <span class="n">Panel_Custom</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
          <span class="p">((</span><span class="n">romptr</span> <span class="o">=</span> <span class="n">GetLCDStructPtr661_2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">)</span> <span class="p">{</span>

	 <span class="n">lcdpdcindex</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_UMC</span><span class="p">)</span> <span class="o">?</span> <span class="mi">14</span> <span class="o">:</span> <span class="mi">12</span><span class="p">;</span>

	 <span class="cm">/* For LVDS (and sometimes TMDS), the BIOS must know about the correct value */</span>
	 <span class="n">delay</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">lcdpdcindex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>	<span class="cm">/* LCD  */</span>
	 <span class="n">delay</span> <span class="o">|=</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">lcdpdcindex</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>	<span class="cm">/* LCDA */</span>

      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

         <span class="cm">/* TMDS: Set our own, since BIOS has no idea */</span>
	 <span class="cm">/* (This is done on &gt;=661 only, since &lt;661 is calling this only for LVDS) */</span>
         <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
	    <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">case</span> <span class="n">Panel_1024x768</span>:  <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0008</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	    <span class="k">case</span> <span class="n">Panel_1280x720</span>:  <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0004</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	    <span class="k">case</span> <span class="n">Panel_1280x768</span>:
	    <span class="k">case</span> <span class="n">Panel_1280x768_2</span>:<span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0004</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	    <span class="k">case</span> <span class="n">Panel_1280x800</span>:
	    <span class="k">case</span> <span class="n">Panel_1280x800_2</span>:<span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0004</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span> <span class="cm">/* Verified for 1280x800 */</span>
	    <span class="k">case</span> <span class="n">Panel_1280x854</span>:  <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0004</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span> <span class="cm">/* FIXME */</span>
	    <span class="k">case</span> <span class="n">Panel_1280x1024</span>: <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x1e04</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	    <span class="k">case</span> <span class="n">Panel_1400x1050</span>: <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0004</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	    <span class="k">case</span> <span class="n">Panel_1600x1200</span>: <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0400</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	    <span class="k">case</span> <span class="n">Panel_1680x1050</span>: <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0e04</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	    <span class="nl">default:</span>
               <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">&lt;=</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">&lt;=</span> <span class="mi">768</span><span class="p">))</span> <span class="p">{</span>
	          <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0008</span><span class="p">;</span>
	       <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">==</span> <span class="mi">1280</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">==</span> <span class="mi">1024</span><span class="p">))</span> <span class="p">{</span>
	          <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x1e04</span><span class="p">;</span>
               <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">&lt;=</span> <span class="mi">1400</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">&lt;=</span> <span class="mi">1050</span><span class="p">))</span> <span class="p">{</span>
	          <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0004</span><span class="p">;</span>
	       <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelXRes</span> <span class="o">&lt;=</span> <span class="mi">1600</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PanelYRes</span> <span class="o">&lt;=</span> <span class="mi">1200</span><span class="p">))</span> <span class="p">{</span>
	          <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0400</span><span class="p">;</span>
               <span class="p">}</span> <span class="k">else</span>
	          <span class="n">delay</span> <span class="o">=</span> <span class="mh">0x0e04</span><span class="p">;</span>
	       <span class="k">break</span><span class="p">;</span>
	    <span class="p">}</span>
         <span class="p">}</span>

	 <span class="cm">/* Override by detected or user-set values */</span>
	 <span class="cm">/* (but only if, for some reason, we can&#39;t read value from BIOS) */</span>
         <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDC</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDC</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDCA</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDCA</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
         <span class="p">}</span>

      <span class="p">}</span>

   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">delay</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span><span class="p">;</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,((</span><span class="n">delay</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">));</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mh">0xbf</span><span class="p">,((</span><span class="n">delay</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">));</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x2d</span><span class="p">,</span><span class="mh">0xf0</span><span class="p">,((</span><span class="n">delay</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">));</span>
      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x35</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">,((</span><span class="n">delay</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">));</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetCRT2SyncDither661</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RTI</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">infoflag</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">temp</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">infoflag</span> <span class="o">=</span> <span class="n">SiS_GetRegByte</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3ca</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">infoflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">CInfoFlag</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="n">infoflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RTI</span><span class="p">].</span><span class="n">Ext_InfoFlag</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDPass11</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">infoflag</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x37</span><span class="p">);</span> <span class="cm">/* No longer check D5 */</span>
      <span class="p">}</span>

      <span class="n">infoflag</span> <span class="o">&amp;=</span> <span class="mh">0xc0</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">infoflag</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x0c</span><span class="p">;</span>
         <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">temp</span> <span class="o">^=</span> <span class="mh">0x04</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&gt;=</span> <span class="n">Mode24Bpp</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>
	 <span class="p">}</span>
         <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">,</span><span class="mh">0xe0</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>
         <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
         <span class="n">temp</span> <span class="o">|=</span> <span class="n">infoflag</span><span class="p">;</span>
         <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
         <span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
         <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">LCDRGB18Bit</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ModeType</span> <span class="o">&gt;=</span> <span class="n">Mode24Bpp</span><span class="p">)</span> <span class="n">temp</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>
	 <span class="p">}</span>
         <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">,</span><span class="mh">0x7f</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
      <span class="p">}</span>

   <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetPanelParms661</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">romptr</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">VB_SISLVDS</span> <span class="o">|</span> <span class="n">VB_SIS30xC</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="mh">0x0f</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">LVDSHL</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="mh">0xfc</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">LVDSHL</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">((</span><span class="n">romptr</span> <span class="o">=</span> <span class="n">GetLCDStructPtr661_2</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">)))</span> <span class="p">{</span>
         <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">temp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x0c</span><span class="p">;</span>
	    <span class="n">temp2</span> <span class="o">=</span> <span class="mh">0xfc</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">LVDSHL</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">temp1</span> <span class="o">&amp;=</span> <span class="mh">0xfc</span><span class="p">;</span>
	      <span class="n">temp2</span> <span class="o">=</span> <span class="mh">0xf3</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="n">temp2</span><span class="p">,</span><span class="n">temp1</span><span class="p">);</span>
         <span class="p">}</span>
	 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">temp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x0d</span><span class="p">,</span><span class="mh">0xbf</span><span class="p">,</span><span class="n">temp1</span><span class="p">);</span>
	 <span class="p">}</span>
      <span class="p">}</span>

   <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_OEM310Setting</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RRTI</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">SetDelayComp661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RRTI</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">SetCRT2SyncDither661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">RRTI</span><span class="p">);</span>
         <span class="n">SetPanelParms661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">SetDelayComp</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">((</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">SetAntiFlicker</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">);</span>
      <span class="n">SetPhaseIncr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">);</span>
      <span class="n">SetYFilter</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">SetEdgeEnhance</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="n">ModeNo</span><span class="p">,</span><span class="n">ModeIdIndex</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_OEM661Setting</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RRTI</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>

      <span class="n">SetDelayComp661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">,</span> <span class="n">RRTI</span><span class="p">);</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">SetCRT2SyncDither661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">RRTI</span><span class="p">);</span>
         <span class="n">SetPanelParms661</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">SetPhaseIncr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>
         <span class="n">SetYFilter</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>
         <span class="n">SetAntiFlicker</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>
         <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">SetEdgeEnhance</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">ModeIdIndex</span><span class="p">);</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* FinalizeLCD</span>
<span class="cm"> * This finalizes some CRT2 registers for the very panel used.</span>
<span class="cm"> * If we have a backup if these registers, we use it; otherwise</span>
<span class="cm"> * we set the register according to most BIOSes. However, this</span>
<span class="cm"> * function looks quite different in every BIOS, so you better</span>
<span class="cm"> * pray that we have a backup...</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_FinalizeLCD</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempcl</span><span class="p">,</span><span class="n">tempch</span><span class="p">,</span><span class="n">tempbl</span><span class="p">,</span><span class="n">tempbh</span><span class="p">,</span><span class="n">tempbx</span><span class="p">,</span><span class="n">tempax</span><span class="p">,</span><span class="n">temp</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">resinfo</span><span class="p">,</span><span class="n">modeflag</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISLVDS</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_ROMNew</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">LVDSHL</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="mh">0xfc</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">LVDSHL</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_Custom</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">switch</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">CUT_COMPAQ1280</span>:
  <span class="k">case</span> <span class="n">CUT_COMPAQ12802</span>:
  <span class="k">case</span> <span class="n">CUT_CLEVO1400</span>:
  <span class="k">case</span> <span class="n">CUT_CLEVO14002</span>:
     <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ResInfo</span><span class="p">;</span>
     <span class="n">modeflag</span> <span class="o">=</span>  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">resinfo</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_RESINFO</span><span class="p">;</span>
     <span class="n">modeflag</span> <span class="o">=</span>  <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">IS_SIS650</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span> <span class="mh">0x5f</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_CLEVO1024</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0x02</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
           <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1e</span><span class="p">,</span><span class="mh">0x03</span><span class="p">);</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_CLEVO1024</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* Maybe all panels? */</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">LVDSHL</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="mh">0xfc</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_CLEVO10242</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">LVDSHL</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	      <span class="cm">/* Maybe all panels? */</span>
              <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="mh">0xfc</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">tempch</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">tempch</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
	         <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0x02</span><span class="p">);</span>
	         <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">,</span><span class="mh">0x25</span><span class="p">);</span>
	         <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	         <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1d</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">);</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	   <span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToLCD</span> <span class="o">|</span> <span class="n">SetCRT2ToLCDA</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISEMI</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x2a</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
<span class="cp">#ifdef SET_EMI</span>
	   <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0x0c</span><span class="p">);</span>
<span class="cp">#endif</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x34</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
	<span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1280x1024</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">LVDSHL</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
           <span class="cm">/* Maybe ACER only? */</span>
           <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part4Port</span><span class="p">,</span><span class="mh">0x24</span><span class="p">,</span><span class="mh">0xfc</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
	<span class="p">}</span>
     <span class="p">}</span>
     <span class="n">tempch</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCDA</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1400x1050</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1f</span><span class="p">,</span><span class="mh">0x76</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">tempch</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0x02</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">,</span><span class="mh">0x25</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1d</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">);</span>
	   <span class="p">}</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup_Mode</span> <span class="o">==</span> <span class="n">ModeNo</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x14</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup_14</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x15</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup_15</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x16</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup_16</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x17</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup_17</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup_18</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup_19</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup_1a</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup_1b</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup_1c</span><span class="p">);</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1d</span><span class="p">,</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">Backup_1d</span><span class="p">);</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">))</span> <span class="p">{</span>	<span class="cm">/* 1.10.8w */</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x14</span><span class="p">,</span><span class="mh">0x90</span><span class="p">);</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	         <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0x11</span><span class="p">);</span>
		 <span class="k">if</span><span class="p">((</span><span class="n">resinfo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0x18</span><span class="p">);</span>
		 <span class="k">if</span><span class="p">((</span><span class="n">resinfo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="mi">3</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
	      <span class="p">}</span>
	      <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0x02</span><span class="p">);</span>
	      <span class="k">if</span><span class="p">((</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x13</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1024x768</span><span class="p">))</span> <span class="p">{</span>
	         <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0x02</span><span class="p">);</span>  <span class="cm">/* 1.10.7u */</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	         tempbx = 806;  /* 0x326 */			 /* other older BIOSes */</span>
<span class="c">		 tempbx--;</span>
<span class="c">		 temp = tempbx &amp; 0xff;</span>
<span class="c">		 SiS_SetReg(SiS_Pr-&gt;SiS_Part1Port,0x1b,temp);</span>
<span class="c">		 temp = (tempbx &gt;&gt; 8) &amp; 0x03;</span>
<span class="c">		 SiS_SetRegANDOR(SiS_Pr-&gt;SiS_Part1Port,0x1d,0xf8,temp);</span>
<span class="cp">#endif</span>
	      <span class="p">}</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0x70</span><span class="p">);</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0xff</span><span class="p">);</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">,</span><span class="mh">0x48</span><span class="p">);</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1d</span><span class="p">,</span><span class="mh">0x12</span><span class="p">);</span>
	      <span class="p">}</span>
	      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">))</span> <span class="p">{</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x14</span><span class="p">,</span><span class="mh">0x20</span><span class="p">);</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x15</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">);</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x16</span><span class="p">,</span><span class="mh">0x28</span><span class="p">);</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x17</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0x4c</span><span class="p">);</span>
		 <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0xdc</span><span class="p">);</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">==</span> <span class="mh">0x12</span><span class="p">)</span> <span class="p">{</span>
		    <span class="k">switch</span><span class="p">(</span><span class="n">tempch</span><span class="p">)</span> <span class="p">{</span>
		       <span class="k">case</span> <span class="mi">0</span>:
			  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0x95</span><span class="p">);</span>
			  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x19</span><span class="p">,</span><span class="mh">0xdc</span><span class="p">);</span>
			  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1a</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
			  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">,</span><span class="mh">0x95</span><span class="p">);</span>
			  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1c</span><span class="p">,</span><span class="mh">0x48</span><span class="p">);</span>
			  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1d</span><span class="p">,</span><span class="mh">0x12</span><span class="p">);</span>
			  <span class="k">break</span><span class="p">;</span>
		       <span class="k">case</span> <span class="mi">2</span>:
			  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="mh">0x95</span><span class="p">);</span>
			  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">,</span><span class="mh">0x48</span><span class="p">);</span>
			  <span class="k">break</span><span class="p">;</span>
		       <span class="k">case</span> <span class="mi">3</span>:
			  <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">,</span><span class="mh">0x95</span><span class="p">);</span>
			  <span class="k">break</span><span class="p">;</span>
		    <span class="p">}</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span>
	<span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">tempcl</span> <span class="o">=</span> <span class="n">tempbh</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">);</span>
	<span class="n">tempcl</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">tempbh</span> <span class="o">&amp;=</span> <span class="mh">0x70</span><span class="p">;</span>
	<span class="n">tempbh</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">tempbl</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x04</span><span class="p">);</span>
	<span class="n">tempbx</span> <span class="o">=</span> <span class="p">(</span><span class="n">tempbh</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">tempbl</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
	   <span class="k">if</span><span class="p">((</span><span class="n">resinfo</span> <span class="o">==</span> <span class="n">SIS_RI_1024x768</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)))</span> <span class="p">{</span>
	      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">)</span> <span class="p">{</span>
	      	 <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">770</span><span class="p">;</span>
	      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	         <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">&gt;</span> <span class="mi">770</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="mi">770</span><span class="p">;</span>
		 <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">tempax</span> <span class="o">=</span> <span class="mi">768</span> <span class="o">-</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span><span class="p">;</span>
		    <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span>  				 <span class="cm">/* 1.10.7w; 1.10.6s: 3;  */</span>
		    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAVDE</span> <span class="o">&lt;=</span> <span class="mi">480</span><span class="p">)</span>  <span class="n">tempax</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span> <span class="cm">/* 1.10.7w; 1.10.6s: &lt; 480; &gt;&gt;=1; */</span>
		    <span class="n">tempbx</span> <span class="o">-=</span> <span class="n">tempax</span><span class="p">;</span>
		 <span class="p">}</span>
	      <span class="p">}</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="n">tempbx</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x04</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">tempbx</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="n">tempcl</span><span class="p">;</span>
	<span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x01</span><span class="p">,</span><span class="mh">0x80</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">#endif</span>

<span class="cm">/*  =================  SiS 300 O.E.M. ================== */</span>

<span class="cp">#ifdef CONFIG_FB_SIS_300</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetOEMLCDData2</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefTabIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">crt2crtc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">modeflag</span><span class="p">,</span> <span class="n">myindex</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">temp</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mh">0x13</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_ModeFlag</span><span class="p">;</span>
     <span class="n">crt2crtc</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">St_CRT2CRTC</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">modeflag</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_EModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">Ext_ModeFlag</span><span class="p">;</span>
     <span class="n">crt2crtc</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_RefIndex</span><span class="p">[</span><span class="n">RefTabIndex</span><span class="p">].</span><span class="n">Ext_CRT2CRTC</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">crt2crtc</span> <span class="o">&amp;=</span> <span class="mh">0x3f</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1024</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="mh">0xdf</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_CustomT</span> <span class="o">==</span> <span class="n">CUT_BARCO1366</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">modeflag</span> <span class="o">&amp;</span> <span class="n">HalfDCLK</span><span class="p">)</span> <span class="n">myindex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LowModeTests</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">7</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">if</span><span class="p">(</span><span class="n">barco_p1</span><span class="p">[</span><span class="n">myindex</span><span class="p">][</span><span class="n">crt2crtc</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	      <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span>
	                      <span class="n">barco_p1</span><span class="p">[</span><span class="n">myindex</span><span class="p">][</span><span class="n">crt2crtc</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
	   	   	      <span class="n">barco_p1</span><span class="p">[</span><span class="n">myindex</span><span class="p">][</span><span class="n">crt2crtc</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
			      <span class="n">barco_p1</span><span class="p">[</span><span class="n">myindex</span><span class="p">][</span><span class="n">crt2crtc</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
	   <span class="p">}</span>
        <span class="p">}</span>
     <span class="p">}</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x00</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">);</span>
        <span class="n">temp</span><span class="o">++</span><span class="p">;</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x18</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">GetOEMLCDPtr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Flag</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempbx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">romptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">customtable300</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span>
	<span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span>
  <span class="p">};</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">customtable630</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span>
	<span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span><span class="p">,</span><span class="mh">0xff</span>
  <span class="p">};</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">==</span> <span class="n">SIS_300</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_P3d4</span><span class="p">,</span><span class="mh">0x36</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS301</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">&amp;=</span> <span class="mh">0x07</span><span class="p">;</span>
    <span class="n">tempbx</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_1024x768</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x235</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span><span class="p">;</span>
          <span class="k">if</span><span class="p">(</span><span class="n">Flag</span><span class="p">)</span> <span class="p">{</span>
	     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x255</span><span class="p">);</span>
	     <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span><span class="p">];</span>
	     <span class="k">else</span>       <span class="n">tempbx</span> <span class="o">=</span> <span class="n">customtable300</span><span class="p">[</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span><span class="p">];</span>
             <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">==</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
          <span class="p">}</span>
	  <span class="n">tempbx</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
	  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_SetFlag</span> <span class="o">&amp;</span> <span class="n">LCDVESATiming</span><span class="p">))</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
       <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="n">Flag</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x255</span><span class="p">);</span>
	  <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span><span class="p">];</span>
	  <span class="k">else</span> 	     <span class="n">tempbx</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">tempbx</span> <span class="o">=</span> <span class="n">customtable630</span><span class="p">[</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span><span class="p">];</span>
       <span class="p">}</span>
       <span class="k">if</span><span class="p">(</span><span class="n">tempbx</span> <span class="o">==</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="k">return</span> <span class="mh">0xFFFF</span><span class="p">;</span>
       <span class="n">tempbx</span> <span class="o">&lt;&lt;=</span> <span class="mi">2</span><span class="p">;</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
       <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>
       <span class="k">return</span> <span class="n">tempbx</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">tempbx</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDTypeInfo</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">)</span> <span class="n">tempbx</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDInfo</span> <span class="o">&amp;</span> <span class="n">DontExpandLCD</span><span class="p">)</span> <span class="n">tempbx</span><span class="o">++</span><span class="p">;</span>

  <span class="p">}</span>

  <span class="k">return</span> <span class="n">tempbx</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetOEMLCDDelay</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">romptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_LCDResInfo</span> <span class="o">==</span> <span class="n">Panel_Custom</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x237</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x237</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x24b</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/* The Panel Compensation Delay should be set according to tables</span>
<span class="cm">   * here. Unfortunately, various BIOS versions don&#39;t care about</span>
<span class="cm">   * a uniform way using eg. ROM byte 0x220, but use different</span>
<span class="cm">   * hard coded delays (0x04, 0x20, 0x18) in SetGroup1().</span>
<span class="cm">   * Thus we don&#39;t set this if the user selected a custom pdc or if</span>
<span class="cm">   * we otherwise detected a valid pdc.</span>
<span class="cm">   */</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">PDC</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">GetOEMLCDPtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span>
     <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">else</span>
     <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">VB_LCDDelayIndex</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">ChipType</span> <span class="o">!=</span> <span class="n">SIS_300</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">romptr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="n">romptr</span><span class="p">);</span>
	<span class="n">romptr</span> <span class="o">+=</span> <span class="n">index</span><span class="p">;</span>
	<span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="p">];</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
    	   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS300_OEMLCDDelay2</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">];</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
           <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS300_OEMLCDDelay3</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">];</span>
        <span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x235</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">romptr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
	   <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="n">romptr</span><span class="p">);</span>
	   <span class="n">romptr</span> <span class="o">+=</span> <span class="n">index</span><span class="p">;</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="p">];</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS300_OEMLCDDelay5</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">];</span>
	<span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">romptr</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x249</span><span class="p">]</span> <span class="o">|</span> <span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x24a</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	   <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">romptr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
	      <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="n">romptr</span><span class="p">);</span>
	      <span class="n">romptr</span> <span class="o">+=</span> <span class="n">index</span><span class="p">;</span>
	      <span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="p">];</span>
	   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS300_OEMLCDDelay4</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">];</span>
	   <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	   <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS300_OEMLCDDelay4</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">];</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x3c</span><span class="p">;</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="o">~</span><span class="mh">0x3C</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>  <span class="cm">/* index 0A D[6:4] */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetOEMLCDData</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if 0</span><span class="c">  /* Unfinished; Data table missing */</span>
<span class="c">  unsigned char  *ROMAddr = SiS_Pr-&gt;VirtualRomBase;</span>
<span class="c">  unsigned short index,temp;</span>

<span class="c">  if((SiS_Pr-&gt;SiS_UseROM) {</span>
<span class="c">     if(!(ROMAddr[0x237] &amp; 0x01)) return;</span>
<span class="c">     if(!(ROMAddr[0x237] &amp; 0x04)) return;</span>
<span class="c">     /* No rom pointer in BIOS header! */</span>
<span class="c">  }</span>

<span class="c">  temp = GetOEMLCDPtr(SiS_Pr, 1);</span>
<span class="c">  if(temp == 0xFFFF) return;</span>

<span class="c">  index = SiS_Pr-&gt;SiS_VBModeIDTable[ModeIdIndex]._VB_LCDHIndex;</span>
<span class="c">  for(i=0x14, j=0; i&lt;=0x17; i++, j++) {</span>
<span class="c">      SiS_SetReg(SiS_Pr-&gt;SiS_Part1Port,i,SiS300_LCDHData[temp][index][j]);</span>
<span class="c">  }</span>
<span class="c">  SiS_SetRegANDOR(SiS_SiS_Part1Port,0x1a, 0xf8, (SiS300_LCDHData[temp][index][j] &amp; 0x07));</span>

<span class="c">  index = SiS_Pr-&gt;SiS_VBModeIDTable[ModeIdIndex]._VB_LCDVIndex;</span>
<span class="c">  SiS_SetReg(SiS_SiS_Part1Port,0x18, SiS300_LCDVData[temp][index][0]);</span>
<span class="c">  SiS_SetRegANDOR(SiS_SiS_Part1Port,0x19, 0xF0, SiS300_LCDVData[temp][index][1]);</span>
<span class="c">  SiS_SetRegANDOR(SiS_SiS_Part1Port,0x1A, 0xC7, (SiS300_LCDVData[temp][index][2] &amp; 0x38));</span>
<span class="c">  for(i=0x1b, j=3; i&lt;=0x1d; i++, j++) {</span>
<span class="c">      SiS_SetReg(SiS_Pr-&gt;SiS_Part1Port,i,SiS300_LCDVData[temp][index][j]);</span>
<span class="c">  }</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">GetOEMTVPtr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">;</span>

  <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetInSlaveMode</span><span class="p">))</span>  <span class="n">index</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToSCART</span><span class="p">)</span>  <span class="n">index</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="n">index</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>
     <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span>   <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetCHOverScan</span><span class="p">)</span> <span class="n">index</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPAL</span><span class="p">)</span>        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">index</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetOEMTVDelay</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">romptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x238</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x238</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x241</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">GetOEMTVPtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

  <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">VB_TVDelayIndex</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">romptr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="n">romptr</span><span class="p">);</span>
     <span class="n">romptr</span> <span class="o">+=</span> <span class="n">index</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="p">];</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS300_OEMTVDelay301</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">];</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS300_OEMTVDelayLVDS</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">];</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x3c</span><span class="p">;</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part1Port</span><span class="p">,</span><span class="mh">0x13</span><span class="p">,</span><span class="o">~</span><span class="mh">0x3C</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetOEMAntiFlicker</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">romptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x238</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x238</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x243</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">GetOEMTVPtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

  <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">VB_TVFlickerIndex</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">romptr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="n">romptr</span><span class="p">);</span>
     <span class="n">romptr</span> <span class="o">+=</span> <span class="n">index</span><span class="p">;</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span><span class="p">];</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">temp</span> <span class="o">=</span> <span class="n">SiS300_OEMTVFlicker</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="n">temp</span> <span class="o">&amp;=</span> <span class="mh">0x70</span><span class="p">;</span>
  <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="mh">0x0A</span><span class="p">,</span><span class="mh">0x8F</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetOEMPhaseIncr</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">romptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToHiVision</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetNTSC1024</span> <span class="o">|</span> <span class="n">TVSetNTSCJ</span> <span class="o">|</span> <span class="n">TVSetPALM</span> <span class="o">|</span> <span class="n">TVSetPALN</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x238</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x238</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x245</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">GetOEMTVPtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

  <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">VB_TVPhaseIndex</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mh">0x31</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x34</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS300_Phase2</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
     <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="n">romptr</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">romptr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="n">romptr</span><span class="p">);</span>
	<span class="n">romptr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">index</span> <span class="o">*</span> <span class="mi">4</span><span class="p">);</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mh">0x31</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x34</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	   <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
	<span class="p">}</span>
     <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mh">0x31</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x34</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS300_Phase1</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
	<span class="p">}</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SetOEMYFilter</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">ROMAddr</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">VirtualRomBase</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">index</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">romptr</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SetCRT2ToSCART</span> <span class="o">|</span> <span class="n">SetCRT2ToHiVision</span> <span class="o">|</span> <span class="n">SetCRT2ToYPbPr525750</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_UseROM</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x238</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ROMAddr</span><span class="p">[</span><span class="mh">0x238</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
     <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="mh">0x247</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">temp</span> <span class="o">=</span> <span class="n">GetOEMTVPtr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALM</span><span class="p">)</span>      <span class="n">temp</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="n">TVSetPALN</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
  <span class="cm">/* NTSCJ uses NTSC filters */</span>

  <span class="n">index</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">VB_TVYFilterIndex</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SIS30xBLV</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mh">0x35</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x38</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
       	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS300_Filter2</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mh">0x48</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x4A</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     	<span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS300_Filter2</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
      <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">((</span><span class="n">romptr</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_TVMode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">TVSetPALM</span><span class="o">|</span><span class="n">TVSetPALN</span><span class="p">))))</span> <span class="p">{</span>
         <span class="n">romptr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
	 <span class="n">romptr</span> <span class="o">=</span> <span class="n">SISGETROMW</span><span class="p">(</span><span class="n">romptr</span><span class="p">);</span>
	 <span class="n">romptr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">index</span> <span class="o">*</span> <span class="mi">4</span><span class="p">);</span>
	 <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mh">0x35</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x38</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
       	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ROMAddr</span><span class="p">[</span><span class="n">romptr</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
         <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
         <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mh">0x35</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mh">0x38</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
       	    <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_Part2Port</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">SiS300_Filter1</span><span class="p">[</span><span class="n">temp</span><span class="p">][</span><span class="n">index</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
         <span class="p">}</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">SiS_SearchVBModeID</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">ModeNo</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">VGAINFO</span> <span class="o">=</span> <span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VGAINFO</span><span class="p">;</span>

   <span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">ModeNo</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span><span class="n">ModeNo</span> <span class="o">|=</span> <span class="mi">1</span><span class="p">;</span>

   <span class="k">for</span><span class="p">(</span><span class="n">ModeIdIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">ModeIdIndex</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">ModeID</span> <span class="o">==</span> <span class="o">*</span><span class="n">ModeNo</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBModeIDTable</span><span class="p">[</span><span class="n">ModeIdIndex</span><span class="p">].</span><span class="n">ModeID</span> <span class="o">==</span> <span class="mh">0xFF</span><span class="p">)</span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">ModeNo</span> <span class="o">!=</span> <span class="mh">0x07</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">ModeNo</span> <span class="o">&gt;</span> <span class="mh">0x03</span><span class="p">)</span> <span class="k">return</span> <span class="n">ModeIdIndex</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="n">VGAINFO</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="k">return</span> <span class="n">ModeIdIndex</span><span class="p">;</span>
      <span class="n">ModeIdIndex</span><span class="o">++</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">if</span><span class="p">(</span><span class="n">VGAINFO</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="n">ModeIdIndex</span><span class="o">++</span><span class="p">;</span>   <span class="cm">/* 400 lines */</span>
	                               <span class="cm">/* else 350 lines */</span>
   <span class="k">return</span> <span class="n">ModeIdIndex</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">SiS_OEM300Setting</span><span class="p">(</span><span class="k">struct</span> <span class="n">SiS_Private</span> <span class="o">*</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ModeIdIndex</span><span class="p">,</span>
		  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">RefTableIndex</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">OEMModeIdIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">OEMModeIdIndex</span> <span class="o">=</span> <span class="n">SiS_SearchVBModeID</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span><span class="o">&amp;</span><span class="n">ModeNo</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">OEMModeIdIndex</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToLCD</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SetOEMLCDDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">OEMModeIdIndex</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_IF_DEF_LVDS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SetOEMLCDData</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">OEMModeIdIndex</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">UseCustomMode</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBInfo</span> <span class="o">&amp;</span> <span class="n">SetCRT2ToTV</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">SetOEMTVDelay</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span><span class="n">OEMModeIdIndex</span><span class="p">);</span>
     <span class="k">if</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="o">-&gt;</span><span class="n">SiS_VBType</span> <span class="o">&amp;</span> <span class="n">VB_SISVB</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SetOEMAntiFlicker</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">OEMModeIdIndex</span><span class="p">);</span>
    	<span class="n">SetOEMPhaseIncr</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">OEMModeIdIndex</span><span class="p">);</span>
       	<span class="n">SetOEMYFilter</span><span class="p">(</span><span class="n">SiS_Pr</span><span class="p">,</span> <span class="n">ModeNo</span><span class="p">,</span> <span class="n">OEMModeIdIndex</span><span class="p">);</span>
     <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
