<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › video › sis › sis.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>sis.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * SiS 300/540/630[S]/730[S],</span>
<span class="cm"> * SiS 315[E|PRO]/550/[M]65x/[M]661[F|M]X/740/[M]741[GX]/330/[M]76x[GX],</span>
<span class="cm"> * XGI V3XT/V5/V8, Z7</span>
<span class="cm"> * frame buffer driver for Linux kernels &gt;=2.4.14 and &gt;=2.6.3</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2001-2005 Thomas Winischhofer, Vienna, Austria.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the named License,</span>
<span class="cm"> * or any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _SIS_H_</span>
<span class="cp">#define _SIS_H_</span>

<span class="cp">#include &lt;video/sisfb.h&gt;</span>

<span class="cp">#include &quot;vgatypes.h&quot;</span>
<span class="cp">#include &quot;vstruct.h&quot;</span>

<span class="cp">#define VER_MAJOR		1</span>
<span class="cp">#define VER_MINOR		8</span>
<span class="cp">#define VER_LEVEL		9</span>

<span class="cp">#include &lt;linux/spinlock.h&gt;</span>

<span class="cp">#ifdef CONFIG_COMPAT</span>
<span class="cp">#define SIS_NEW_CONFIG_COMPAT</span>
<span class="cp">#endif	</span><span class="cm">/* CONFIG_COMPAT */</span><span class="cp"></span>

<span class="cp">#undef SISFBDEBUG</span>

<span class="cp">#ifdef SISFBDEBUG</span>
<span class="cp">#define DPRINTK(fmt, args...) printk(KERN_DEBUG &quot;%s: &quot; fmt, __func__ , ## args)</span>
<span class="cp">#define TWDEBUG(x) printk(KERN_INFO x &quot;\n&quot;);</span>
<span class="cp">#else</span>
<span class="cp">#define DPRINTK(fmt, args...)</span>
<span class="cp">#define TWDEBUG(x)</span>
<span class="cp">#endif</span>

<span class="cp">#define SISFAIL(x) do { printk(x &quot;\n&quot;); return -EINVAL; } while(0)</span>

<span class="cm">/* To be included in pci_ids.h */</span>
<span class="cp">#ifndef PCI_DEVICE_ID_SI_650_VGA</span>
<span class="cp">#define PCI_DEVICE_ID_SI_650_VGA	0x6325</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef PCI_DEVICE_ID_SI_650</span>
<span class="cp">#define PCI_DEVICE_ID_SI_650		0x0650</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef PCI_DEVICE_ID_SI_651</span>
<span class="cp">#define PCI_DEVICE_ID_SI_651		0x0651</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef PCI_DEVICE_ID_SI_740</span>
<span class="cp">#define PCI_DEVICE_ID_SI_740		0x0740</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef PCI_DEVICE_ID_SI_330</span>
<span class="cp">#define PCI_DEVICE_ID_SI_330		0x0330</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef PCI_DEVICE_ID_SI_660_VGA</span>
<span class="cp">#define PCI_DEVICE_ID_SI_660_VGA	0x6330</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef PCI_DEVICE_ID_SI_661</span>
<span class="cp">#define PCI_DEVICE_ID_SI_661		0x0661</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef PCI_DEVICE_ID_SI_741</span>
<span class="cp">#define PCI_DEVICE_ID_SI_741		0x0741</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef PCI_DEVICE_ID_SI_660</span>
<span class="cp">#define PCI_DEVICE_ID_SI_660		0x0660</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef PCI_DEVICE_ID_SI_760</span>
<span class="cp">#define PCI_DEVICE_ID_SI_760		0x0760</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef PCI_DEVICE_ID_SI_761</span>
<span class="cp">#define PCI_DEVICE_ID_SI_761		0x0761</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef PCI_VENDOR_ID_XGI</span>
<span class="cp">#define PCI_VENDOR_ID_XGI		0x18ca</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef PCI_DEVICE_ID_XGI_20</span>
<span class="cp">#define PCI_DEVICE_ID_XGI_20		0x0020</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef PCI_DEVICE_ID_XGI_40</span>
<span class="cp">#define PCI_DEVICE_ID_XGI_40		0x0040</span>
<span class="cp">#endif</span>

<span class="cm">/* To be included in fb.h */</span>
<span class="cp">#ifndef FB_ACCEL_SIS_GLAMOUR_2</span>
<span class="cp">#define FB_ACCEL_SIS_GLAMOUR_2	40	</span><span class="cm">/* SiS 315, 65x, 740, 661, 741  */</span><span class="cp"></span>
<span class="cp">#endif</span>
<span class="cp">#ifndef FB_ACCEL_SIS_XABRE</span>
<span class="cp">#define FB_ACCEL_SIS_XABRE	41	</span><span class="cm">/* SiS 330 (&quot;Xabre&quot;), 76x 	*/</span><span class="cp"></span>
<span class="cp">#endif</span>
<span class="cp">#ifndef FB_ACCEL_XGI_VOLARI_V</span>
<span class="cp">#define FB_ACCEL_XGI_VOLARI_V	47	</span><span class="cm">/* XGI Volari Vx (V3XT, V5, V8)	*/</span><span class="cp"></span>
<span class="cp">#endif</span>
<span class="cp">#ifndef FB_ACCEL_XGI_VOLARI_Z</span>
<span class="cp">#define FB_ACCEL_XGI_VOLARI_Z	48	</span><span class="cm">/* XGI Volari Z7		*/</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cm">/* ivideo-&gt;caps */</span>
<span class="cp">#define HW_CURSOR_CAP		0x80</span>
<span class="cp">#define TURBO_QUEUE_CAP		0x40</span>
<span class="cp">#define AGP_CMD_QUEUE_CAP	0x20</span>
<span class="cp">#define VM_CMD_QUEUE_CAP	0x10</span>
<span class="cp">#define MMIO_CMD_QUEUE_CAP	0x08</span>

<span class="cm">/* For 300 series */</span>
<span class="cp">#define TURBO_QUEUE_AREA_SIZE	(512 * 1024)	</span><span class="cm">/* 512K */</span><span class="cp"></span>
<span class="cp">#define HW_CURSOR_AREA_SIZE_300	4096		</span><span class="cm">/* 4K */</span><span class="cp"></span>

<span class="cm">/* For 315/Xabre series */</span>
<span class="cp">#define COMMAND_QUEUE_AREA_SIZE	(512 * 1024)	</span><span class="cm">/* 512K */</span><span class="cp"></span>
<span class="cp">#define COMMAND_QUEUE_AREA_SIZE_Z7 (128 * 1024)	</span><span class="cm">/* 128k for XGI Z7 */</span><span class="cp"></span>
<span class="cp">#define HW_CURSOR_AREA_SIZE_315	16384		</span><span class="cm">/* 16K */</span><span class="cp"></span>
<span class="cp">#define COMMAND_QUEUE_THRESHOLD	0x1F</span>

<span class="cp">#define SIS_OH_ALLOC_SIZE	4000</span>
<span class="cp">#define SENTINEL		0x7fffffff</span>

<span class="cp">#define SEQ_ADR			0x14</span>
<span class="cp">#define SEQ_DATA		0x15</span>
<span class="cp">#define DAC_ADR			0x18</span>
<span class="cp">#define DAC_DATA		0x19</span>
<span class="cp">#define CRTC_ADR		0x24</span>
<span class="cp">#define CRTC_DATA		0x25</span>
<span class="cp">#define DAC2_ADR		(0x16-0x30)</span>
<span class="cp">#define DAC2_DATA		(0x17-0x30)</span>
<span class="cp">#define VB_PART1_ADR		(0x04-0x30)</span>
<span class="cp">#define VB_PART1_DATA		(0x05-0x30)</span>
<span class="cp">#define VB_PART2_ADR		(0x10-0x30)</span>
<span class="cp">#define VB_PART2_DATA		(0x11-0x30)</span>
<span class="cp">#define VB_PART3_ADR		(0x12-0x30)</span>
<span class="cp">#define VB_PART3_DATA		(0x13-0x30)</span>
<span class="cp">#define VB_PART4_ADR		(0x14-0x30)</span>
<span class="cp">#define VB_PART4_DATA		(0x15-0x30)</span>

<span class="cp">#define SISSR			ivideo-&gt;SiS_Pr.SiS_P3c4</span>
<span class="cp">#define SISCR			ivideo-&gt;SiS_Pr.SiS_P3d4</span>
<span class="cp">#define SISDACA			ivideo-&gt;SiS_Pr.SiS_P3c8</span>
<span class="cp">#define SISDACD			ivideo-&gt;SiS_Pr.SiS_P3c9</span>
<span class="cp">#define SISPART1		ivideo-&gt;SiS_Pr.SiS_Part1Port</span>
<span class="cp">#define SISPART2		ivideo-&gt;SiS_Pr.SiS_Part2Port</span>
<span class="cp">#define SISPART3		ivideo-&gt;SiS_Pr.SiS_Part3Port</span>
<span class="cp">#define SISPART4		ivideo-&gt;SiS_Pr.SiS_Part4Port</span>
<span class="cp">#define SISPART5		ivideo-&gt;SiS_Pr.SiS_Part5Port</span>
<span class="cp">#define SISDAC2A		SISPART5</span>
<span class="cp">#define SISDAC2D		(SISPART5 + 1)</span>
<span class="cp">#define SISMISCR		(ivideo-&gt;SiS_Pr.RelIO + 0x1c)</span>
<span class="cp">#define SISMISCW		ivideo-&gt;SiS_Pr.SiS_P3c2</span>
<span class="cp">#define SISINPSTAT		(ivideo-&gt;SiS_Pr.RelIO + 0x2a)</span>
<span class="cp">#define SISPEL			ivideo-&gt;SiS_Pr.SiS_P3c6</span>
<span class="cp">#define SISVGAENABLE		(ivideo-&gt;SiS_Pr.RelIO + 0x13)</span>
<span class="cp">#define SISVID			(ivideo-&gt;SiS_Pr.RelIO + 0x02 - 0x30)</span>
<span class="cp">#define SISCAP			(ivideo-&gt;SiS_Pr.RelIO + 0x00 - 0x30)</span>

<span class="cp">#define IND_SIS_PASSWORD		0x05  </span><span class="cm">/* SRs */</span><span class="cp"></span>
<span class="cp">#define IND_SIS_COLOR_MODE		0x06</span>
<span class="cp">#define IND_SIS_RAMDAC_CONTROL		0x07</span>
<span class="cp">#define IND_SIS_DRAM_SIZE		0x14</span>
<span class="cp">#define IND_SIS_MODULE_ENABLE		0x1E</span>
<span class="cp">#define IND_SIS_PCI_ADDRESS_SET		0x20</span>
<span class="cp">#define IND_SIS_TURBOQUEUE_ADR		0x26</span>
<span class="cp">#define IND_SIS_TURBOQUEUE_SET		0x27</span>
<span class="cp">#define IND_SIS_POWER_ON_TRAP		0x38</span>
<span class="cp">#define IND_SIS_POWER_ON_TRAP2		0x39</span>
<span class="cp">#define IND_SIS_CMDQUEUE_SET		0x26</span>
<span class="cp">#define IND_SIS_CMDQUEUE_THRESHOLD	0x27</span>

<span class="cp">#define IND_SIS_AGP_IO_PAD	0x48</span>

<span class="cp">#define SIS_CRT2_WENABLE_300	0x24  </span><span class="cm">/* Part1 */</span><span class="cp"></span>
<span class="cp">#define SIS_CRT2_WENABLE_315	0x2F</span>

<span class="cp">#define SIS_PASSWORD		0x86  </span><span class="cm">/* SR05 */</span><span class="cp"></span>

<span class="cp">#define SIS_INTERLACED_MODE	0x20  </span><span class="cm">/* SR06 */</span><span class="cp"></span>
<span class="cp">#define SIS_8BPP_COLOR_MODE	0x0</span>
<span class="cp">#define SIS_15BPP_COLOR_MODE	0x1</span>
<span class="cp">#define SIS_16BPP_COLOR_MODE	0x2</span>
<span class="cp">#define SIS_32BPP_COLOR_MODE	0x4</span>

<span class="cp">#define SIS_ENABLE_2D		0x40  </span><span class="cm">/* SR1E */</span><span class="cp"></span>

<span class="cp">#define SIS_MEM_MAP_IO_ENABLE	0x01  </span><span class="cm">/* SR20 */</span><span class="cp"></span>
<span class="cp">#define SIS_PCI_ADDR_ENABLE	0x80</span>

<span class="cp">#define SIS_AGP_CMDQUEUE_ENABLE		0x80  </span><span class="cm">/* 315/330/340 series SR26 */</span><span class="cp"></span>
<span class="cp">#define SIS_VRAM_CMDQUEUE_ENABLE	0x40</span>
<span class="cp">#define SIS_MMIO_CMD_ENABLE		0x20</span>
<span class="cp">#define SIS_CMD_QUEUE_SIZE_512k		0x00</span>
<span class="cp">#define SIS_CMD_QUEUE_SIZE_1M		0x04</span>
<span class="cp">#define SIS_CMD_QUEUE_SIZE_2M		0x08</span>
<span class="cp">#define SIS_CMD_QUEUE_SIZE_4M		0x0C</span>
<span class="cp">#define SIS_CMD_QUEUE_RESET		0x01</span>
<span class="cp">#define SIS_CMD_AUTO_CORR		0x02</span>

<span class="cp">#define SIS_CMD_QUEUE_SIZE_Z7_64k	0x00 </span><span class="cm">/* XGI Z7 */</span><span class="cp"></span>
<span class="cp">#define SIS_CMD_QUEUE_SIZE_Z7_128k	0x04</span>

<span class="cp">#define SIS_SIMULTANEOUS_VIEW_ENABLE	0x01  </span><span class="cm">/* CR30 */</span><span class="cp"></span>
<span class="cp">#define SIS_MODE_SELECT_CRT2		0x02</span>
<span class="cp">#define SIS_VB_OUTPUT_COMPOSITE		0x04</span>
<span class="cp">#define SIS_VB_OUTPUT_SVIDEO		0x08</span>
<span class="cp">#define SIS_VB_OUTPUT_SCART		0x10</span>
<span class="cp">#define SIS_VB_OUTPUT_LCD		0x20</span>
<span class="cp">#define SIS_VB_OUTPUT_CRT2		0x40</span>
<span class="cp">#define SIS_VB_OUTPUT_HIVISION		0x80</span>

<span class="cp">#define SIS_VB_OUTPUT_DISABLE	0x20  </span><span class="cm">/* CR31 */</span><span class="cp"></span>
<span class="cp">#define SIS_DRIVER_MODE		0x40</span>

<span class="cp">#define SIS_VB_COMPOSITE	0x01  </span><span class="cm">/* CR32 */</span><span class="cp"></span>
<span class="cp">#define SIS_VB_SVIDEO		0x02</span>
<span class="cp">#define SIS_VB_SCART		0x04</span>
<span class="cp">#define SIS_VB_LCD		0x08</span>
<span class="cp">#define SIS_VB_CRT2		0x10</span>
<span class="cp">#define SIS_CRT1		0x20</span>
<span class="cp">#define SIS_VB_HIVISION		0x40</span>
<span class="cp">#define SIS_VB_YPBPR		0x80</span>
<span class="cp">#define SIS_VB_TV		(SIS_VB_COMPOSITE | SIS_VB_SVIDEO | \</span>
<span class="cp">				SIS_VB_SCART | SIS_VB_HIVISION | SIS_VB_YPBPR)</span>

<span class="cp">#define SIS_EXTERNAL_CHIP_MASK			0x0E  </span><span class="cm">/* CR37 (&lt; SiS 660) */</span><span class="cp"></span>
<span class="cp">#define SIS_EXTERNAL_CHIP_SIS301		0x01  </span><span class="cm">/* in CR37 &lt;&lt; 1 ! */</span><span class="cp"></span>
<span class="cp">#define SIS_EXTERNAL_CHIP_LVDS			0x02</span>
<span class="cp">#define SIS_EXTERNAL_CHIP_TRUMPION		0x03</span>
<span class="cp">#define SIS_EXTERNAL_CHIP_LVDS_CHRONTEL		0x04</span>
<span class="cp">#define SIS_EXTERNAL_CHIP_CHRONTEL		0x05</span>
<span class="cp">#define SIS310_EXTERNAL_CHIP_LVDS		0x02</span>
<span class="cp">#define SIS310_EXTERNAL_CHIP_LVDS_CHRONTEL	0x03</span>

<span class="cp">#define SIS_AGP_2X		0x20  </span><span class="cm">/* CR48 */</span><span class="cp"></span>

<span class="cm">/* vbflags, private entries (others in sisfb.h) */</span>
<span class="cp">#define VB_CONEXANT		0x00000800	</span><span class="cm">/* 661 series only */</span><span class="cp"></span>
<span class="cp">#define VB_TRUMPION		VB_CONEXANT	</span><span class="cm">/* 300 series only */</span><span class="cp"></span>
<span class="cp">#define VB_302ELV		0x00004000</span>
<span class="cp">#define VB_301			0x00100000	</span><span class="cm">/* Video bridge type */</span><span class="cp"></span>
<span class="cp">#define VB_301B			0x00200000</span>
<span class="cp">#define VB_302B			0x00400000</span>
<span class="cp">#define VB_30xBDH		0x00800000	</span><span class="cm">/* 30xB DH version (w/o LCD support) */</span><span class="cp"></span>
<span class="cp">#define VB_LVDS			0x01000000</span>
<span class="cp">#define VB_CHRONTEL		0x02000000</span>
<span class="cp">#define VB_301LV		0x04000000</span>
<span class="cp">#define VB_302LV		0x08000000</span>
<span class="cp">#define VB_301C			0x10000000</span>

<span class="cp">#define VB_SISBRIDGE		(VB_301|VB_301B|VB_301C|VB_302B|VB_301LV|VB_302LV|VB_302ELV)</span>
<span class="cp">#define VB_VIDEOBRIDGE		(VB_SISBRIDGE | VB_LVDS | VB_CHRONTEL | VB_CONEXANT)</span>

<span class="cm">/* vbflags2 (static stuff only!) */</span>
<span class="cp">#define VB2_SISUMC		0x00000001</span>
<span class="cp">#define VB2_301			0x00000002	</span><span class="cm">/* Video bridge type */</span><span class="cp"></span>
<span class="cp">#define VB2_301B		0x00000004</span>
<span class="cp">#define VB2_301C		0x00000008</span>
<span class="cp">#define VB2_307T		0x00000010</span>
<span class="cp">#define VB2_302B		0x00000800</span>
<span class="cp">#define VB2_301LV		0x00001000</span>
<span class="cp">#define VB2_302LV		0x00002000</span>
<span class="cp">#define VB2_302ELV		0x00004000</span>
<span class="cp">#define VB2_307LV		0x00008000</span>
<span class="cp">#define VB2_30xBDH		0x08000000      </span><span class="cm">/* 30xB DH version (w/o LCD support) */</span><span class="cp"></span>
<span class="cp">#define VB2_CONEXANT		0x10000000</span>
<span class="cp">#define VB2_TRUMPION		0x20000000</span>
<span class="cp">#define VB2_LVDS		0x40000000</span>
<span class="cp">#define VB2_CHRONTEL		0x80000000</span>

<span class="cp">#define VB2_SISLVDSBRIDGE	(VB2_301LV | VB2_302LV | VB2_302ELV | VB2_307LV)</span>
<span class="cp">#define VB2_SISTMDSBRIDGE	(VB2_301   | VB2_301B  | VB2_301C   | VB2_302B | VB2_307T)</span>
<span class="cp">#define VB2_SISBRIDGE		(VB2_SISLVDSBRIDGE | VB2_SISTMDSBRIDGE)</span>

<span class="cp">#define VB2_SISTMDSLCDABRIDGE	(VB2_301C | VB2_307T)</span>
<span class="cp">#define VB2_SISLCDABRIDGE	(VB2_SISTMDSLCDABRIDGE | VB2_301LV | VB2_302LV | VB2_302ELV | VB2_307LV)</span>

<span class="cp">#define VB2_SISHIVISIONBRIDGE	(VB2_301  | VB2_301B | VB2_302B)</span>
<span class="cp">#define VB2_SISYPBPRBRIDGE	(VB2_301C | VB2_307T | VB2_SISLVDSBRIDGE)</span>
<span class="cp">#define VB2_SISYPBPRARBRIDGE	(VB2_301C | VB2_307T | VB2_307LV)</span>
<span class="cp">#define VB2_SISTAP4SCALER	(VB2_301C | VB2_307T | VB2_302ELV | VB2_307LV)</span>
<span class="cp">#define VB2_SISTVBRIDGE		(VB2_SISHIVISIONBRIDGE | VB2_SISYPBPRBRIDGE)</span>

<span class="cp">#define VB2_SISVGA2BRIDGE	(VB2_301 | VB2_301B | VB2_301C | VB2_302B | VB2_307T)</span>

<span class="cp">#define VB2_VIDEOBRIDGE		(VB2_SISBRIDGE | VB2_LVDS | VB2_CHRONTEL | VB2_CONEXANT)</span>

<span class="cp">#define VB2_30xB		(VB2_301B  | VB2_301C   | VB2_302B  | VB2_307T)</span>
<span class="cp">#define VB2_30xBLV		(VB2_30xB  | VB2_SISLVDSBRIDGE)</span>
<span class="cp">#define VB2_30xC		(VB2_301C  | VB2_307T)</span>
<span class="cp">#define VB2_30xCLV		(VB2_301C  | VB2_307T   | VB2_302ELV| VB2_307LV)</span>
<span class="cp">#define VB2_SISEMIBRIDGE	(VB2_302LV | VB2_302ELV | VB2_307LV)</span>
<span class="cp">#define VB2_LCD162MHZBRIDGE	(VB2_301C  | VB2_307T)</span>
<span class="cp">#define VB2_LCDOVER1280BRIDGE	(VB2_301C  | VB2_307T   | VB2_302LV | VB2_302ELV | VB2_307LV)</span>
<span class="cp">#define VB2_LCDOVER1600BRIDGE	(VB2_307T  | VB2_307LV)</span>
<span class="cp">#define VB2_RAMDAC202MHZBRIDGE	(VB2_301C  | VB2_307T)</span>

<span class="cm">/* I/O port access functions */</span>

<span class="kt">void</span> <span class="n">SiS_SetReg</span><span class="p">(</span><span class="n">SISIOADDRESS</span><span class="p">,</span> <span class="n">u8</span><span class="p">,</span> <span class="n">u8</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">SiS_SetRegByte</span><span class="p">(</span><span class="n">SISIOADDRESS</span><span class="p">,</span> <span class="n">u8</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">SiS_SetRegShort</span><span class="p">(</span><span class="n">SISIOADDRESS</span><span class="p">,</span> <span class="n">u16</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">SiS_SetRegLong</span><span class="p">(</span><span class="n">SISIOADDRESS</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">SiS_SetRegANDOR</span><span class="p">(</span><span class="n">SISIOADDRESS</span><span class="p">,</span> <span class="n">u8</span><span class="p">,</span> <span class="n">u8</span><span class="p">,</span> <span class="n">u8</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">SiS_SetRegAND</span><span class="p">(</span><span class="n">SISIOADDRESS</span><span class="p">,</span> <span class="n">u8</span><span class="p">,</span> <span class="n">u8</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">SiS_SetRegOR</span><span class="p">(</span><span class="n">SISIOADDRESS</span><span class="p">,</span> <span class="n">u8</span><span class="p">,</span> <span class="n">u8</span><span class="p">);</span>
<span class="n">u8</span> <span class="n">SiS_GetReg</span><span class="p">(</span><span class="n">SISIOADDRESS</span><span class="p">,</span> <span class="n">u8</span><span class="p">);</span>
<span class="n">u8</span> <span class="n">SiS_GetRegByte</span><span class="p">(</span><span class="n">SISIOADDRESS</span><span class="p">);</span>
<span class="n">u16</span> <span class="n">SiS_GetRegShort</span><span class="p">(</span><span class="n">SISIOADDRESS</span><span class="p">);</span>
<span class="n">u32</span> <span class="n">SiS_GetRegLong</span><span class="p">(</span><span class="n">SISIOADDRESS</span><span class="p">);</span>

<span class="cm">/* MMIO access macros */</span>
<span class="cp">#define MMIO_IN8(base, offset)  readb((base+offset))</span>
<span class="cp">#define MMIO_IN16(base, offset) readw((base+offset))</span>
<span class="cp">#define MMIO_IN32(base, offset) readl((base+offset))</span>

<span class="cp">#define MMIO_OUT8(base, offset, val)  writeb(((u8)(val)), (base+offset))</span>
<span class="cp">#define MMIO_OUT16(base, offset, val) writew(((u16)(val)), (base+offset))</span>
<span class="cp">#define MMIO_OUT32(base, offset, val) writel(((u32)(val)), (base+offset))</span>

<span class="cm">/* Queue control MMIO registers */</span>
<span class="cp">#define Q_BASE_ADDR		0x85C0  </span><span class="cm">/* Base address of software queue */</span><span class="cp"></span>
<span class="cp">#define Q_WRITE_PTR		0x85C4  </span><span class="cm">/* Current write pointer */</span><span class="cp"></span>
<span class="cp">#define Q_READ_PTR		0x85C8  </span><span class="cm">/* Current read pointer */</span><span class="cp"></span>
<span class="cp">#define Q_STATUS		0x85CC  </span><span class="cm">/* queue status */</span><span class="cp"></span>

<span class="cp">#define MMIO_QUEUE_PHYBASE      Q_BASE_ADDR</span>
<span class="cp">#define MMIO_QUEUE_WRITEPORT    Q_WRITE_PTR</span>
<span class="cp">#define MMIO_QUEUE_READPORT     Q_READ_PTR</span>

<span class="cp">#ifndef FB_BLANK_UNBLANK</span>
<span class="cp">#define FB_BLANK_UNBLANK	0</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef FB_BLANK_NORMAL</span>
<span class="cp">#define FB_BLANK_NORMAL		1</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef FB_BLANK_VSYNC_SUSPEND</span>
<span class="cp">#define FB_BLANK_VSYNC_SUSPEND	2</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef FB_BLANK_HSYNC_SUSPEND</span>
<span class="cp">#define FB_BLANK_HSYNC_SUSPEND	3</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef FB_BLANK_POWERDOWN</span>
<span class="cp">#define FB_BLANK_POWERDOWN	4</span>
<span class="cp">#endif</span>

<span class="k">enum</span> <span class="n">_SIS_LCD_TYPE</span> <span class="p">{</span>
    <span class="n">LCD_INVALID</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">LCD_800x600</span><span class="p">,</span>
    <span class="n">LCD_1024x768</span><span class="p">,</span>
    <span class="n">LCD_1280x1024</span><span class="p">,</span>
    <span class="n">LCD_1280x960</span><span class="p">,</span>
    <span class="n">LCD_640x480</span><span class="p">,</span>
    <span class="n">LCD_1600x1200</span><span class="p">,</span>
    <span class="n">LCD_1920x1440</span><span class="p">,</span>
    <span class="n">LCD_2048x1536</span><span class="p">,</span>
    <span class="n">LCD_320x240</span><span class="p">,</span>	<span class="cm">/* FSTN */</span>
    <span class="n">LCD_1400x1050</span><span class="p">,</span>
    <span class="n">LCD_1152x864</span><span class="p">,</span>
    <span class="n">LCD_1152x768</span><span class="p">,</span>
    <span class="n">LCD_1280x768</span><span class="p">,</span>
    <span class="n">LCD_1024x600</span><span class="p">,</span>
    <span class="n">LCD_320x240_2</span><span class="p">,</span>	<span class="cm">/* DSTN */</span>
    <span class="n">LCD_320x240_3</span><span class="p">,</span>	<span class="cm">/* DSTN */</span>
    <span class="n">LCD_848x480</span><span class="p">,</span>
    <span class="n">LCD_1280x800</span><span class="p">,</span>
    <span class="n">LCD_1680x1050</span><span class="p">,</span>
    <span class="n">LCD_1280x720</span><span class="p">,</span>
    <span class="n">LCD_1280x854</span><span class="p">,</span>
    <span class="n">LCD_CUSTOM</span><span class="p">,</span>
    <span class="n">LCD_UNKNOWN</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">_SIS_CMDTYPE</span> <span class="p">{</span>
    <span class="n">MMIO_CMD</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">AGP_CMD_QUEUE</span><span class="p">,</span>
    <span class="n">VM_CMD_QUEUE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SIS_OH</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">SIS_OH</span> <span class="o">*</span><span class="n">poh_next</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">SIS_OH</span> <span class="o">*</span><span class="n">poh_prev</span><span class="p">;</span>
	<span class="n">u32</span>            <span class="n">offset</span><span class="p">;</span>
	<span class="n">u32</span>            <span class="n">size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SIS_OHALLOC</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">SIS_OHALLOC</span> <span class="o">*</span><span class="n">poha_next</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">SIS_OH</span> <span class="n">aoh</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SIS_HEAP</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">SIS_OH</span>	<span class="n">oh_free</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">SIS_OH</span>	<span class="n">oh_used</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">SIS_OH</span>	<span class="o">*</span><span class="n">poh_freelist</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">SIS_OHALLOC</span> <span class="o">*</span><span class="n">poha_chain</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">max_freesize</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sis_video_info</span> <span class="o">*</span><span class="n">vinfo</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Our &quot;par&quot; */</span>
<span class="k">struct</span> <span class="n">sis_video_info</span> <span class="p">{</span>
	<span class="kt">int</span>		<span class="n">cardnumber</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_info</span>  <span class="o">*</span><span class="n">memyselfandi</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">SiS_Private</span> <span class="n">SiS_Pr</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">sisfb_info</span> <span class="n">sisfbinfo</span><span class="p">;</span>	<span class="cm">/* For ioctl SISFB_GET_INFO */</span>

	<span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="n">default_var</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">fb_fix_screeninfo</span> <span class="n">sisfb_fix</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">pseudo_palette</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">sisfb_monitor</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">hmin</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">hmax</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">vmin</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">vmax</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">dclockmax</span><span class="p">;</span>
		<span class="n">u8</span>  <span class="n">feature</span><span class="p">;</span>
		<span class="n">bool</span> <span class="n">datavalid</span><span class="p">;</span>
	<span class="p">}</span>		<span class="n">sisfb_thismonitor</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">chip_id</span><span class="p">;</span>	<span class="cm">/* PCI ID of chip */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">chip_vendor</span><span class="p">;</span>	<span class="cm">/* PCI ID of vendor */</span>
	<span class="kt">char</span>		<span class="n">myid</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">pci_dev</span>  <span class="o">*</span><span class="n">nbridge</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>  <span class="o">*</span><span class="n">lpcdev</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="n">mni</span><span class="p">;</span>	<span class="cm">/* Mode number index */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">video_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">video_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">mmio_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">mmio_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">vga_base</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">video_offset</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">UMAsize</span><span class="p">,</span> <span class="n">LFBsize</span><span class="p">;</span>

	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">video_vbase</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">mmio_vbase</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">bios_abase</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="n">mtrr</span><span class="p">;</span>

	<span class="n">u32</span>		<span class="n">sisfb_mem</span><span class="p">;</span>

	<span class="n">u32</span>		<span class="n">sisfb_parm_mem</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_accel</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_ypan</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_max</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_userom</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_useoem</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_mode_idx</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_parm_rate</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_crt1off</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_forcecrt1</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_crt2type</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_crt2flags</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_dstn</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_fstn</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_tvplug</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_tvstd</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisfb_nocrt2rate</span><span class="p">;</span>

	<span class="n">u32</span>		<span class="n">heapstart</span><span class="p">;</span>		<span class="cm">/* offset  */</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">sisfb_heap_start</span><span class="p">;</span>	<span class="cm">/* address */</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">sisfb_heap_end</span><span class="p">;</span>	<span class="cm">/* address */</span>
	<span class="n">u32</span>		<span class="n">sisfb_heap_size</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">havenoheap</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">SIS_HEAP</span>	<span class="n">sisfb_heap</span><span class="p">;</span>		<span class="cm">/* This card&#39;s vram heap */</span>

	<span class="kt">int</span>		<span class="n">video_bpp</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">video_cmap_len</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">video_width</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">video_height</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">refresh_rate</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">chip</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">chip_real_id</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">revision_id</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sisvga_enabled</span><span class="p">;</span>		<span class="cm">/* PCI device was enabled */</span>

	<span class="kt">int</span>		<span class="n">video_linelength</span><span class="p">;</span>	<span class="cm">/* real pitch */</span>
	<span class="kt">int</span>		<span class="n">scrnpitchCRT1</span><span class="p">;</span>		<span class="cm">/* pitch regarding interlace */</span>

	<span class="n">u16</span>		<span class="n">DstColor</span><span class="p">;</span>		<span class="cm">/* For 2d acceleration */</span>
	<span class="n">u32</span>		<span class="n">SiS310_AccelDepth</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">CommandReg</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">cmdqueuelength</span><span class="p">;</span>		<span class="cm">/* Current (for accel) */</span>
	<span class="n">u32</span>		<span class="n">cmdQueueSize</span><span class="p">;</span>		<span class="cm">/* Total size in KB */</span>

	<span class="n">spinlock_t</span>	<span class="n">lockaccel</span><span class="p">;</span>		<span class="cm">/* Do not use outside of kernel! */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">pcibus</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">pcislot</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">pcifunc</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="n">accel</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">engineok</span><span class="p">;</span>

	<span class="n">u16</span>		<span class="n">subsysvendor</span><span class="p">;</span>
	<span class="n">u16</span>		<span class="n">subsysdevice</span><span class="p">;</span>

	<span class="n">u32</span>		<span class="n">vbflags</span><span class="p">;</span>		<span class="cm">/* Replacing deprecated stuff from above */</span>
	<span class="n">u32</span>		<span class="n">currentvbflags</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">vbflags2</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="n">lcdxres</span><span class="p">,</span> <span class="n">lcdyres</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">lcddefmodeidx</span><span class="p">,</span> <span class="n">tvdefmodeidx</span><span class="p">,</span> <span class="n">defmodeidx</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">CRT2LCDType</span><span class="p">;</span>		<span class="cm">/* defined in &quot;SIS_LCD_TYPE&quot; */</span>
	<span class="n">u32</span>		<span class="n">curFSTN</span><span class="p">,</span> <span class="n">curDSTN</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="n">current_bpp</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">current_width</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">current_height</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">current_htotal</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">current_vtotal</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">current_linelength</span><span class="p">;</span>
	<span class="n">__u32</span>		<span class="n">current_pixclock</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">current_refresh_rate</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">current_base</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">mode_no</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">rate_idx</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">modechanged</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">modeprechange</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">sisfb_lastrates</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>

	<span class="kt">int</span>		<span class="n">newrom</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">haveXGIROM</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">registered</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">warncount</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="n">sisvga_engine</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">hwcursor_size</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">CRT2_write_enable</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">caps</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">detectedpdc</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">detectedpdca</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">detectedlcda</span><span class="p">;</span>

	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">hwcursor_vbase</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="n">chronteltype</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">tvxpos</span><span class="p">,</span> <span class="n">tvypos</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">p2_1f</span><span class="p">,</span><span class="n">p2_20</span><span class="p">,</span><span class="n">p2_2b</span><span class="p">,</span><span class="n">p2_42</span><span class="p">,</span><span class="n">p2_43</span><span class="p">,</span><span class="n">p2_01</span><span class="p">,</span><span class="n">p2_02</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">tvx</span><span class="p">,</span> <span class="n">tvy</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">sisfblocked</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">sisfb_info</span> <span class="n">sisfb_infoblock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">sisfb_cmd</span> <span class="n">sisfb_command</span><span class="p">;</span>

	<span class="n">u32</span>		<span class="n">sisfb_id</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">sisfb_can_post</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">sisfb_card_posted</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">sisfb_was_boot_device</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">sis_video_info</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
