<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › video › savage › savagefb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>savagefb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * linux/drivers/video/savagefb.h -- S3 Savage Framebuffer Driver</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2001  Denis Oliver Kropp &lt;dok@convergence.de&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General</span>
<span class="cm"> * Public License.  See the file COPYING in the main directory of this</span>
<span class="cm"> * archive for more details.</span>
<span class="cm"> */</span>


<span class="cp">#ifndef __SAVAGEFB_H__</span>
<span class="cp">#define __SAVAGEFB_H__</span>

<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/i2c-algo-bit.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>
<span class="cp">#include &lt;video/vga.h&gt;</span>
<span class="cp">#include &quot;../edid.h&quot;</span>

<span class="cp">#ifdef SAVAGEFB_DEBUG</span>
<span class="cp"># define DBG(x)		printk (KERN_DEBUG &quot;savagefb: %s\n&quot;, (x));</span>
<span class="cp">#else</span>
<span class="cp"># define DBG(x)</span>
<span class="cp"># define SavagePrintRegs(...)</span>
<span class="cp">#endif</span>


<span class="cp">#define PCI_CHIP_SAVAGE4      0x8a22</span>
<span class="cp">#define PCI_CHIP_SAVAGE3D     0x8a20</span>
<span class="cp">#define PCI_CHIP_SAVAGE3D_MV  0x8a21</span>
<span class="cp">#define PCI_CHIP_SAVAGE2000   0x9102</span>
<span class="cp">#define PCI_CHIP_SAVAGE_MX_MV 0x8c10</span>
<span class="cp">#define PCI_CHIP_SAVAGE_MX    0x8c11</span>
<span class="cp">#define PCI_CHIP_SAVAGE_IX_MV 0x8c12</span>
<span class="cp">#define PCI_CHIP_SAVAGE_IX    0x8c13</span>
<span class="cp">#define PCI_CHIP_PROSAVAGE_PM 0x8a25</span>
<span class="cp">#define PCI_CHIP_PROSAVAGE_KM 0x8a26</span>
<span class="cp">#define PCI_CHIP_S3TWISTER_P  0x8d01</span>
<span class="cp">#define PCI_CHIP_S3TWISTER_K  0x8d02</span>
<span class="cp">#define PCI_CHIP_PROSAVAGE_DDR          0x8d03</span>
<span class="cp">#define PCI_CHIP_PROSAVAGE_DDRK         0x8d04</span>
<span class="cp">#define PCI_CHIP_SUPSAV_MX128		0x8c22</span>
<span class="cp">#define PCI_CHIP_SUPSAV_MX64		0x8c24</span>
<span class="cp">#define PCI_CHIP_SUPSAV_MX64C		0x8c26</span>
<span class="cp">#define PCI_CHIP_SUPSAV_IX128SDR	0x8c2a</span>
<span class="cp">#define PCI_CHIP_SUPSAV_IX128DDR	0x8c2b</span>
<span class="cp">#define PCI_CHIP_SUPSAV_IX64SDR		0x8c2c</span>
<span class="cp">#define PCI_CHIP_SUPSAV_IX64DDR		0x8c2d</span>
<span class="cp">#define PCI_CHIP_SUPSAV_IXCSDR		0x8c2e</span>
<span class="cp">#define PCI_CHIP_SUPSAV_IXCDDR		0x8c2f</span>


<span class="cp">#define S3_SAVAGE_SERIES(chip)    ((chip&gt;=S3_SAVAGE3D) &amp;&amp; (chip&lt;=S3_SAVAGE2000))</span>

<span class="cp">#define S3_SAVAGE3D_SERIES(chip)  ((chip&gt;=S3_SAVAGE3D) &amp;&amp; (chip&lt;=S3_SAVAGE_MX))</span>

<span class="cp">#define S3_SAVAGE4_SERIES(chip)   ((chip&gt;=S3_SAVAGE4) &amp;&amp; (chip&lt;=S3_PROSAVAGEDDR))</span>

<span class="cp">#define S3_SAVAGE_MOBILE_SERIES(chip)  ((chip==S3_SAVAGE_MX) || (chip==S3_SUPERSAVAGE))</span>

<span class="cp">#define S3_MOBILE_TWISTER_SERIES(chip) ((chip==S3_TWISTER) || (chip==S3_PROSAVAGEDDR))</span>

<span class="cm">/* Chip tags.  These are used to group the adapters into</span>
<span class="cm"> * related families.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
  <span class="n">S3_UNKNOWN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
  <span class="n">S3_SAVAGE3D</span><span class="p">,</span>
  <span class="n">S3_SAVAGE_MX</span><span class="p">,</span>
  <span class="n">S3_SAVAGE4</span><span class="p">,</span>
  <span class="n">S3_PROSAVAGE</span><span class="p">,</span>
  <span class="n">S3_TWISTER</span><span class="p">,</span>
  <span class="n">S3_PROSAVAGEDDR</span><span class="p">,</span>
  <span class="n">S3_SUPERSAVAGE</span><span class="p">,</span>
  <span class="n">S3_SAVAGE2000</span><span class="p">,</span>
  <span class="n">S3_LAST</span>
<span class="p">}</span> <span class="n">savage_chipset</span><span class="p">;</span>

<span class="cp">#define BIOS_BSIZE		     1024</span>
<span class="cp">#define BIOS_BASE		     0xc0000</span>

<span class="cp">#define SAVAGE_NEWMMIO_REGBASE_S3    0x1000000  </span><span class="cm">/* 16MB */</span><span class="cp"></span>
<span class="cp">#define SAVAGE_NEWMMIO_REGBASE_S4    0x0000000</span>
<span class="cp">#define SAVAGE_NEWMMIO_REGSIZE	     0x0080000  </span><span class="cm">/* 512kb */</span><span class="cp"></span>
<span class="cp">#define SAVAGE_NEWMMIO_VGABASE	     0x8000</span>

<span class="cp">#define BASE_FREQ		     14318</span>
<span class="cp">#define HALF_BASE_FREQ               7159</span>

<span class="cp">#define FIFO_CONTROL_REG	     0x8200</span>
<span class="cp">#define MIU_CONTROL_REG		     0x8204</span>
<span class="cp">#define STREAMS_TIMEOUT_REG	     0x8208</span>
<span class="cp">#define MISC_TIMEOUT_REG	     0x820c</span>

<span class="cp">#define MONO_PAT_0                   0xa4e8</span>
<span class="cp">#define MONO_PAT_1                   0xa4ec</span>

<span class="cp">#define MAXFIFO                      0x7f00</span>

<span class="cp">#define BCI_CMD_NOP                  0x40000000</span>
<span class="cp">#define BCI_CMD_SETREG               0x96000000</span>
<span class="cp">#define BCI_CMD_RECT                 0x48000000</span>
<span class="cp">#define BCI_CMD_RECT_XP              0x01000000</span>
<span class="cp">#define BCI_CMD_RECT_YP              0x02000000</span>
<span class="cp">#define BCI_CMD_SEND_COLOR           0x00008000</span>
<span class="cp">#define BCI_CMD_DEST_GBD             0x00000000</span>
<span class="cp">#define BCI_CMD_SRC_GBD              0x00000020</span>
<span class="cp">#define BCI_CMD_SRC_SOLID            0x00000000</span>
<span class="cp">#define BCI_CMD_SRC_MONO             0x00000060</span>
<span class="cp">#define BCI_CMD_CLIP_NEW             0x00006000</span>
<span class="cp">#define BCI_CMD_CLIP_LR              0x00004000</span>

<span class="cp">#define BCI_CLIP_LR(l, r)            ((((r) &lt;&lt; 16) | (l)) &amp; 0x0FFF0FFF)</span>
<span class="cp">#define BCI_CLIP_TL(t, l)            ((((t) &lt;&lt; 16) | (l)) &amp; 0x0FFF0FFF)</span>
<span class="cp">#define BCI_CLIP_BR(b, r)            ((((b) &lt;&lt; 16) | (r)) &amp; 0x0FFF0FFF)</span>
<span class="cp">#define BCI_W_H(w, h)                (((h) &lt;&lt; 16) | ((w) &amp; 0xFFF))</span>
<span class="cp">#define BCI_X_Y(x, y)                (((y) &lt;&lt; 16) | ((x) &amp; 0xFFF))</span>

<span class="cp">#define BCI_GBD1                     0xE0</span>
<span class="cp">#define BCI_GBD2                     0xE1</span>

<span class="cp">#define BCI_BUFFER_OFFSET            0x10000</span>
<span class="cp">#define BCI_SIZE                     0x4000</span>

<span class="cp">#define BCI_SEND(dw)                 writel(dw, par-&gt;bci_base + par-&gt;bci_ptr++)</span>

<span class="cp">#define BCI_CMD_GET_ROP(cmd)         (((cmd) &gt;&gt; 16) &amp; 0xFF)</span>
<span class="cp">#define BCI_CMD_SET_ROP(cmd, rop)    ((cmd) |= ((rop &amp; 0xFF) &lt;&lt; 16))</span>
<span class="cp">#define BCI_CMD_SEND_COLOR           0x00008000</span>

<span class="cp">#define DISP_CRT     1</span>
<span class="cp">#define DISP_LCD     2</span>
<span class="cp">#define DISP_DFP     3</span>

<span class="k">struct</span> <span class="n">xtimings</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">Clock</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">HDisplay</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">HSyncStart</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">HSyncEnd</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">HTotal</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">HAdjusted</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">VDisplay</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">VSyncStart</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">VSyncEnd</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">VTotal</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sync</span><span class="p">;</span>
	<span class="kt">int</span>	       <span class="n">dblscan</span><span class="p">;</span>
	<span class="kt">int</span>	       <span class="n">interlaced</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">savage_reg</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">MiscOutReg</span><span class="p">;</span>     <span class="cm">/* Misc */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">CRTC</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>       <span class="cm">/* Crtc Controller */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">Sequencer</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>   <span class="cm">/* Video Sequencer */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">Graphics</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>    <span class="cm">/* Video Graphics */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">Attribute</span><span class="p">[</span><span class="mi">21</span><span class="p">];</span>  <span class="cm">/* Video Attribute */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">,</span> <span class="n">refresh</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">SR08</span><span class="p">,</span> <span class="n">SR0E</span><span class="p">,</span> <span class="n">SR0F</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">SR10</span><span class="p">,</span> <span class="n">SR11</span><span class="p">,</span> <span class="n">SR12</span><span class="p">,</span> <span class="n">SR13</span><span class="p">,</span> <span class="n">SR15</span><span class="p">,</span> <span class="n">SR18</span><span class="p">,</span> <span class="n">SR29</span><span class="p">,</span> <span class="n">SR30</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">SR54</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">Clock</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">CR31</span><span class="p">,</span> <span class="n">CR32</span><span class="p">,</span> <span class="n">CR33</span><span class="p">,</span> <span class="n">CR34</span><span class="p">,</span> <span class="n">CR36</span><span class="p">,</span> <span class="n">CR3A</span><span class="p">,</span> <span class="n">CR3B</span><span class="p">,</span> <span class="n">CR3C</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">CR40</span><span class="p">,</span> <span class="n">CR41</span><span class="p">,</span> <span class="n">CR42</span><span class="p">,</span> <span class="n">CR43</span><span class="p">,</span> <span class="n">CR45</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">CR50</span><span class="p">,</span> <span class="n">CR51</span><span class="p">,</span> <span class="n">CR53</span><span class="p">,</span> <span class="n">CR55</span><span class="p">,</span> <span class="n">CR58</span><span class="p">,</span> <span class="n">CR5B</span><span class="p">,</span> <span class="n">CR5D</span><span class="p">,</span> <span class="n">CR5E</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">CR60</span><span class="p">,</span> <span class="n">CR63</span><span class="p">,</span> <span class="n">CR65</span><span class="p">,</span> <span class="n">CR66</span><span class="p">,</span> <span class="n">CR67</span><span class="p">,</span> <span class="n">CR68</span><span class="p">,</span> <span class="n">CR69</span><span class="p">,</span> <span class="n">CR6D</span><span class="p">,</span> <span class="n">CR6F</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">CR86</span><span class="p">,</span> <span class="n">CR88</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">CR90</span><span class="p">,</span> <span class="n">CR91</span><span class="p">,</span> <span class="n">CRB0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">STREAMS</span><span class="p">[</span><span class="mi">22</span><span class="p">];</span>	<span class="cm">/* yuck, streams regs */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">MMPR0</span><span class="p">,</span> <span class="n">MMPR1</span><span class="p">,</span> <span class="n">MMPR2</span><span class="p">,</span> <span class="n">MMPR3</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/* --------------------------------------------------------------------- */</span>

<span class="cp">#define NR_PALETTE	256</span>


<span class="k">struct</span> <span class="n">savagefb_par</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">savagefb_i2c_chan</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="n">adapter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_algo_bit_data</span> <span class="n">algo</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">;</span>
	<span class="n">u32</span>   <span class="n">reg</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">savagefb_par</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pcidev</span><span class="p">;</span>
	<span class="n">savage_chipset</span>  <span class="n">chip</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">savagefb_i2c_chan</span> <span class="n">chan</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">savage_reg</span> <span class="n">state</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">savage_reg</span> <span class="n">save</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">savage_reg</span> <span class="n">initial</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vgastate</span> <span class="n">vgastate</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">open_lock</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>   <span class="o">*</span><span class="n">edid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pseudo_palette</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">open_count</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">paletteEnabled</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pm_state</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">display_type</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dvi</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">crtonly</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dacSpeedBpp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">maxClock</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">minClock</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">numClocks</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">clock</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">MCLK</span><span class="p">,</span> <span class="n">REFCLK</span><span class="p">,</span> <span class="n">LCDclk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">void</span>   <span class="n">__iomem</span> <span class="o">*</span><span class="n">vbase</span><span class="p">;</span>
		<span class="n">u32</span>    <span class="n">pbase</span><span class="p">;</span>
		<span class="n">u32</span>    <span class="n">len</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_MTRR</span>
		<span class="kt">int</span>    <span class="n">mtrr</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="p">}</span> <span class="n">video</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">void</span>  <span class="n">__iomem</span> <span class="o">*</span><span class="n">vbase</span><span class="p">;</span>
		<span class="n">u32</span>           <span class="n">pbase</span><span class="p">;</span>
		<span class="n">u32</span>           <span class="n">len</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">mmio</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">u32</span>  <span class="n">__iomem</span> <span class="o">*</span><span class="n">bci_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">bci_ptr</span><span class="p">;</span>
	<span class="n">u32</span>           <span class="n">cob_offset</span><span class="p">;</span>
	<span class="n">u32</span>           <span class="n">cob_size</span><span class="p">;</span>
	<span class="kt">int</span>           <span class="n">cob_index</span><span class="p">;</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">SavageWaitIdle</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">SavageWaitFifo</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">,</span> <span class="kt">int</span> <span class="n">space</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">HorizScaleFactor</span><span class="p">;</span>

	<span class="cm">/* Panels size */</span>
	<span class="kt">int</span> <span class="n">SavagePanelWidth</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">SavagePanelHeight</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">transp</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">palette</span><span class="p">[</span><span class="n">NR_PALETTE</span><span class="p">];</span>

	<span class="kt">int</span> <span class="n">depth</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">vwidth</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define BCI_BD_BW_DISABLE            0x10000000</span>
<span class="cp">#define BCI_BD_SET_BPP(bd, bpp)      ((bd) |= (((bpp) &amp; 0xFF) &lt;&lt; 16))</span>
<span class="cp">#define BCI_BD_SET_STRIDE(bd, st)    ((bd) |= ((st) &amp; 0xFFFF))</span>


<span class="cm">/* IO functions */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">savage_in8</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">readb</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">.</span><span class="n">vbase</span> <span class="o">+</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u16</span> <span class="nf">savage_in16</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">readw</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">.</span><span class="n">vbase</span> <span class="o">+</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">savage_in32</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">readl</span><span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">.</span><span class="n">vbase</span> <span class="o">+</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">savage_out8</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u8</span> <span class="n">val</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">writeb</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">.</span><span class="n">vbase</span> <span class="o">+</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">savage_out16</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">writew</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">.</span><span class="n">vbase</span> <span class="o">+</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">savage_out32</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">par</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">.</span><span class="n">vbase</span> <span class="o">+</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">vga_in8</span><span class="p">(</span><span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">savage_in8</span><span class="p">(</span><span class="mh">0x8000</span> <span class="o">+</span> <span class="n">addr</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u16</span> <span class="nf">vga_in16</span><span class="p">(</span><span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">savage_in16</span><span class="p">(</span><span class="mh">0x8000</span> <span class="o">+</span> <span class="n">addr</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">vga_in32</span><span class="p">(</span><span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">savage_in32</span><span class="p">(</span><span class="mh">0x8000</span> <span class="o">+</span> <span class="n">addr</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">vga_out8</span><span class="p">(</span><span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u8</span> <span class="n">val</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">savage_out8</span><span class="p">(</span><span class="mh">0x8000</span> <span class="o">+</span> <span class="n">addr</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">vga_out16</span><span class="p">(</span><span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">savage_out16</span><span class="p">(</span><span class="mh">0x8000</span> <span class="o">+</span> <span class="n">addr</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">vga_out32</span><span class="p">(</span><span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">savage_out32</span><span class="p">(</span><span class="mh">0x8000</span> <span class="o">+</span> <span class="n">addr</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">VGArCR</span> <span class="p">(</span><span class="n">u8</span> <span class="n">index</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3d4</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span>  <span class="n">par</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">vga_in8</span><span class="p">(</span><span class="mh">0x3d5</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">VGArGR</span> <span class="p">(</span><span class="n">u8</span> <span class="n">index</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3ce</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">vga_in8</span><span class="p">(</span><span class="mh">0x3cf</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">VGArSEQ</span> <span class="p">(</span><span class="n">u8</span> <span class="n">index</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3c4</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">vga_in8</span><span class="p">(</span><span class="mh">0x3c5</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">VGAwCR</span><span class="p">(</span><span class="n">u8</span> <span class="n">index</span><span class="p">,</span> <span class="n">u8</span> <span class="n">val</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3d4</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3d5</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">VGAwGR</span><span class="p">(</span><span class="n">u8</span> <span class="n">index</span><span class="p">,</span> <span class="n">u8</span> <span class="n">val</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3ce</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3cf</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">VGAwSEQ</span><span class="p">(</span><span class="n">u8</span> <span class="n">index</span><span class="p">,</span> <span class="n">u8</span> <span class="n">val</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3c4</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="n">vga_out8</span> <span class="p">(</span><span class="mh">0x3c5</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">VGAenablePalette</span><span class="p">(</span><span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">tmp</span><span class="p">;</span>

	<span class="n">tmp</span> <span class="o">=</span> <span class="n">vga_in8</span><span class="p">(</span><span class="mh">0x3da</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3c0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="n">par</span><span class="o">-&gt;</span><span class="n">paletteEnabled</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">VGAdisablePalette</span><span class="p">(</span><span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">tmp</span><span class="p">;</span>

	<span class="n">tmp</span> <span class="o">=</span> <span class="n">vga_in8</span><span class="p">(</span><span class="mh">0x3da</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3c0</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="n">par</span><span class="o">-&gt;</span><span class="n">paletteEnabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">VGAwATTR</span><span class="p">(</span><span class="n">u8</span> <span class="n">index</span><span class="p">,</span> <span class="n">u8</span> <span class="n">value</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">tmp</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">par</span><span class="o">-&gt;</span><span class="n">paletteEnabled</span><span class="p">)</span>
		<span class="n">index</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x20</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">index</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>

	<span class="n">tmp</span> <span class="o">=</span> <span class="n">vga_in8</span><span class="p">(</span><span class="mh">0x3da</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3c0</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="n">vga_out8</span> <span class="p">(</span><span class="mh">0x3c0</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">VGAwMISC</span><span class="p">(</span><span class="n">u8</span> <span class="n">value</span><span class="p">,</span> <span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3c2</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#ifndef CONFIG_FB_SAVAGE_ACCEL</span>
<span class="cp">#define savagefb_set_clip(x)</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">VerticalRetraceWait</span><span class="p">(</span><span class="k">struct</span> <span class="n">savagefb_par</span> <span class="o">*</span><span class="n">par</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vga_out8</span><span class="p">(</span><span class="mh">0x3d4</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="n">par</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vga_in8</span><span class="p">(</span><span class="mh">0x3d5</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">while</span> <span class="p">((</span><span class="n">vga_in8</span><span class="p">(</span><span class="mh">0x3da</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x08</span><span class="p">);</span>
		<span class="k">while</span> <span class="p">((</span><span class="n">vga_in8</span><span class="p">(</span><span class="mh">0x3da</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">savagefb_probe_i2c_connector</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
					<span class="n">u8</span> <span class="o">**</span><span class="n">out_edid</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">savagefb_create_i2c_busses</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">savagefb_delete_i2c_busses</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>  <span class="n">savagefb_sync</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">savagefb_copyarea</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			      <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_copyarea</span> <span class="o">*</span><span class="n">region</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">savagefb_fillrect</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			      <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_fillrect</span> <span class="o">*</span><span class="n">rect</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">savagefb_imageblit</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			       <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_image</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>


<span class="cp">#endif </span><span class="cm">/* __SAVAGEFB_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
