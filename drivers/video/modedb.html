<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › video › modedb.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>modedb.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  linux/drivers/video/modedb.c -- Standard video mode database management</span>
<span class="cm"> *</span>
<span class="cm"> *	Copyright (C) 1999 Geert Uytterhoeven</span>
<span class="cm"> *</span>
<span class="cm"> *	2001 - Documented with DocBook</span>
<span class="cm"> *	- Brad Douglas &lt;brad@neruo.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> *  License. See the file COPYING in the main directory of this archive for</span>
<span class="cm"> *  more details.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/fb.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>

<span class="cp">#undef DEBUG</span>

<span class="cp">#define name_matches(v, s, l) \</span>
<span class="cp">    ((v).name &amp;&amp; !strncmp((s), (v).name, (l)) &amp;&amp; strlen((v).name) == (l))</span>
<span class="cp">#define res_matches(v, x, y) \</span>
<span class="cp">    ((v).xres == (x) &amp;&amp; (v).yres == (y))</span>

<span class="cp">#ifdef DEBUG</span>
<span class="cp">#define DPRINTK(fmt, args...)	printk(&quot;modedb %s: &quot; fmt, __func__ , ## args)</span>
<span class="cp">#else</span>
<span class="cp">#define DPRINTK(fmt, args...)</span>
<span class="cp">#endif</span>

<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fb_mode_option</span><span class="p">;</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">fb_mode_option</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> *  Standard video mode definitions (taken from XFree86)</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">modedb</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

	<span class="cm">/* 640x400 @ 70 Hz, 31.5 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">39721</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 640x480 @ 60 Hz, 31.5 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">39721</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 800x600 @ 56 Hz, 35.15 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">27777</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1024x768 @ 87 Hz interlaced, 35.5 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">22271</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_INTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 640x400 @ 85 Hz, 37.86 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">31746</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
		<span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 640x480 @ 72 Hz, 36.5 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">31746</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 640x480 @ 75 Hz, 37.50 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">31746</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 800x600 @ 60 Hz, 37.8 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">25000</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 640x480 @ 85 Hz, 43.27 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">27777</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1152x864 @ 89 Hz interlaced, 44 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">1152</span><span class="p">,</span> <span class="mi">864</span><span class="p">,</span> <span class="mi">15384</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_INTERLACED</span> <span class="p">},</span>
	<span class="cm">/* 800x600 @ 72 Hz, 48.0 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1024x768 @ 60 Hz, 48.4 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">15384</span><span class="p">,</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 640x480 @ 100 Hz, 53.01 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">21834</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1152x864 @ 60 Hz, 53.5 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1152</span><span class="p">,</span> <span class="mi">864</span><span class="p">,</span> <span class="mi">11123</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 800x600 @ 85 Hz, 55.84 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">16460</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1024x768 @ 70 Hz, 56.5 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">13333</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1280x1024 @ 87 Hz interlaced, 51 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">12500</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_INTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 800x600 @ 100 Hz, 64.02 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">14357</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1024x768 @ 76 Hz, 62.5 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">11764</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1152x864 @ 70 Hz, 62.4 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">1152</span><span class="p">,</span> <span class="mi">864</span><span class="p">,</span> <span class="mi">10869</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1280x1024 @ 61 Hz, 64.2 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">9090</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1400x1050 @ 60Hz, 63.9 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1400</span><span class="p">,</span> <span class="mi">1050</span><span class="p">,</span> <span class="mi">9259</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1400x1050 @ 75,107 Hz, 82,392 kHz +hsync +vsync*/</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">1400</span><span class="p">,</span> <span class="mi">1050</span><span class="p">,</span> <span class="mi">7190</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1400x1050 @ 60 Hz, ? kHz +hsync +vsync*/</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1400</span><span class="p">,</span> <span class="mi">1050</span><span class="p">,</span> <span class="mi">9259</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1024x768 @ 85 Hz, 70.24 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">10111</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1152x864 @ 78 Hz, 70.8 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">1152</span><span class="p">,</span> <span class="mi">864</span><span class="p">,</span> <span class="mi">9090</span><span class="p">,</span> <span class="mi">228</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1280x1024 @ 70 Hz, 74.59 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">7905</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1600x1200 @ 60Hz, 75.00 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">6172</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1152x864 @ 84 Hz, 76.0 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">1152</span><span class="p">,</span> <span class="mi">864</span><span class="p">,</span> <span class="mi">7407</span><span class="p">,</span> <span class="mi">184</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1280x1024 @ 74 Hz, 78.85 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">7407</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1024x768 @ 100Hz, 80.21 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">8658</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1280x1024 @ 76 Hz, 81.13 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">7407</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1600x1200 @ 70 Hz, 87.50 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">5291</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1152x864 @ 100 Hz, 89.62 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1152</span><span class="p">,</span> <span class="mi">864</span><span class="p">,</span> <span class="mi">7264</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1280x1024 @ 85 Hz, 91.15 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">6349</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1600x1200 @ 75 Hz, 93.75 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">4938</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1680x1050 @ 60 Hz, 65.191 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1680</span><span class="p">,</span> <span class="mi">1050</span><span class="p">,</span> <span class="mi">6848</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1600x1200 @ 85 Hz, 105.77 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">4545</span><span class="p">,</span> <span class="mi">272</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1280x1024 @ 100 Hz, 107.16 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">5502</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1800x1440 @ 64Hz, 96.15 kHz hsync  */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1800</span><span class="p">,</span> <span class="mi">1440</span><span class="p">,</span> <span class="mi">4347</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1800x1440 @ 70Hz, 104.52 kHz hsync  */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">1800</span><span class="p">,</span> <span class="mi">1440</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 512x384 @ 78 Hz, 31.50 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">49603</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 512x384 @ 85 Hz, 34.38 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">45454</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 320x200 @ 70 Hz, 31.5 kHz hsync, 8:5 aspect ratio */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">79440</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_DOUBLE</span> <span class="p">},</span>

	<span class="cm">/* 320x240 @ 60 Hz, 31.5 kHz hsync, 4:3 aspect ratio */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">79440</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_DOUBLE</span> <span class="p">},</span>

	<span class="cm">/* 320x240 @ 72 Hz, 36.5 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">63492</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_DOUBLE</span> <span class="p">},</span>

	<span class="cm">/* 400x300 @ 56 Hz, 35.2 kHz hsync, 4:3 aspect ratio */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">55555</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_DOUBLE</span> <span class="p">},</span>

	<span class="cm">/* 400x300 @ 60 Hz, 37.8 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_DOUBLE</span> <span class="p">},</span>

	<span class="cm">/* 400x300 @ 72 Hz, 48.0 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">40000</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>	<span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_DOUBLE</span> <span class="p">},</span>

	<span class="cm">/* 480x300 @ 56 Hz, 35.2 kHz hsync, 8:5 aspect ratio */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">46176</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_DOUBLE</span> <span class="p">},</span>

	<span class="cm">/* 480x300 @ 60 Hz, 37.8 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">41858</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_DOUBLE</span> <span class="p">},</span>

	<span class="cm">/* 480x300 @ 63 Hz, 39.6 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">40000</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_DOUBLE</span> <span class="p">},</span>

	<span class="cm">/* 480x300 @ 72 Hz, 48.0 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">33386</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_DOUBLE</span> <span class="p">},</span>

	<span class="cm">/* 1920x1200 @ 60 Hz, 74.5 Khz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">5177</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">336</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1152x768, 60 Hz, PowerBook G4 Titanium I and II */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1152</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">14047</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1366x768, 60 Hz, 47.403 kHz hsync, WXGA 16:9 aspect ratio */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1366</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">13806</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 1280x800, 60 Hz, 47.403 kHz hsync, WXGA 16:10 aspect ratio */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">12048</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 720x576i @ 50 Hz, 15.625 kHz hsync (PAL RGB) */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">576</span><span class="p">,</span> <span class="mi">74074</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_INTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 800x520i @ 50 Hz, 15.625 kHz hsync (PAL RGB) */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">58823</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_INTERLACED</span> <span class="p">},</span>

	<span class="cm">/* 864x480 @ 60 Hz, 35.15 kHz hsync */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">864</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">27777</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="mi">0</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_FB_MODE_HELPERS</span>
<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">cea_modes</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* #1: 640x480p@59.94/60Hz */</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">39722</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* #3: 720x480p@59.94/60Hz */</span>
	<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">37037</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* #5: 1920x1080i@59.94/60Hz */</span>
	<span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">,</span> <span class="mi">13763</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_INTERLACED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* #7: 720(1440)x480iH@59.94/60Hz */</span>
	<span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1440</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">18554</span><span class="cm">/*37108*/</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_INTERLACED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* #9: 720(1440)x240pH@59.94/60Hz */</span>
	<span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1440</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">18554</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* #18: 720x576pH@50Hz */</span>
	<span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">576</span><span class="p">,</span> <span class="mi">37037</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* #19: 1280x720p@50Hz */</span>
	<span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">13468</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">440</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* #20: 1920x1080i@50Hz */</span>
	<span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">,</span> <span class="mi">13480</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">528</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">528</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_INTERLACED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* #32: 1920x1080p@23.98/24Hz */</span>
	<span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">,</span> <span class="mi">13468</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">638</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
		<span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* #35: (2880)x480p4x@59.94/60Hz */</span>
	<span class="p">[</span><span class="mi">35</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">2880</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">9250</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">vesa_modes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* 0 640x350-85 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">31746</span><span class="p">,</span>  <span class="mi">96</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span><span class="p">},</span>
	<span class="cm">/* 1 640x400-85 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">31746</span><span class="p">,</span>  <span class="mi">96</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 2 720x400-85 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">721</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">28169</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 3 640x480-60 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">39682</span><span class="p">,</span>  <span class="mi">48</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
	  <span class="mi">0</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 4 640x480-72 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">31746</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
	  <span class="mi">0</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 5 640x480-75 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">31746</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="mi">0</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 6 640x480-85 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">27777</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="mi">0</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 7 800x600-56 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">27777</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 8 800x600-60 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">25000</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 9 800x600-72 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 10 800x600-75 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">20202</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 11 800x600-85 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">17761</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
        <span class="cm">/* 12 1024x768i-43 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">22271</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_INTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 13 1024x768-60 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">15384</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
	  <span class="mi">0</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 14 1024x768-70 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">13333</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
	  <span class="mi">0</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 15 1024x768-75 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">12690</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 16 1024x768-85 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">10582</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 17 1152x864-75 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">1152</span><span class="p">,</span> <span class="mi">864</span><span class="p">,</span> <span class="mi">9259</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 18 1280x960-60 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="mi">9259</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 19 1280x960-85 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="mi">6734</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 20 1280x1024-60 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">9259</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 21 1280x1024-75 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">7407</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 22 1280x1024-85 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">6349</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 23 1600x1200-60 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">6172</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 24 1600x1200-65 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">5698</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span>  <span class="mi">64</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 25 1600x1200-70 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">5291</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 26 1600x1200-75 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">4938</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 27 1600x1200-85 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">4357</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_HOR_HIGH_ACT</span> <span class="o">|</span> <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span>
	  <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 28 1792x1344-60 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1792</span><span class="p">,</span> <span class="mi">1344</span><span class="p">,</span> <span class="mi">4882</span><span class="p">,</span> <span class="mi">328</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 29 1792x1344-75 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">1792</span><span class="p">,</span> <span class="mi">1344</span><span class="p">,</span> <span class="mi">3831</span><span class="p">,</span> <span class="mi">352</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 30 1856x1392-60 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1856</span><span class="p">,</span> <span class="mi">1392</span><span class="p">,</span> <span class="mi">4580</span><span class="p">,</span> <span class="mi">352</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 31 1856x1392-75 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">1856</span><span class="p">,</span> <span class="mi">1392</span><span class="p">,</span> <span class="mi">3472</span><span class="p">,</span> <span class="mi">352</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 32 1920x1440-60 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1440</span><span class="p">,</span> <span class="mi">4273</span><span class="p">,</span> <span class="mi">344</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
	<span class="cm">/* 33 1920x1440-75 VESA */</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">1920</span><span class="p">,</span> <span class="mi">1440</span><span class="p">,</span> <span class="mi">3367</span><span class="p">,</span> <span class="mi">352</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	  <span class="n">FB_SYNC_VERT_HIGH_ACT</span><span class="p">,</span> <span class="n">FB_VMODE_NONINTERLACED</span><span class="p">,</span> <span class="n">FB_MODE_IS_VESA</span> <span class="p">},</span>
<span class="p">};</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">vesa_modes</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_MODE_HELPERS */</span><span class="cp"></span>

<span class="cm">/**</span>
<span class="cm"> *	fb_try_mode - test a video mode</span>
<span class="cm"> *	@var: frame buffer user defined part of display</span>
<span class="cm"> *	@info: frame buffer info structure</span>
<span class="cm"> *	@mode: frame buffer video mode structure</span>
<span class="cm"> *	@bpp: color depth in bits per pixel</span>
<span class="cm"> *</span>
<span class="cm"> *	Tries a video mode to test it&#39;s validity for device @info.</span>
<span class="cm"> *</span>
<span class="cm"> *	Returns 1 on success.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">fb_try_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
		       <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bpp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Trying mode %s %dx%d-%d@%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">mode</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">?</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">:</span> <span class="s">&quot;noname&quot;</span><span class="p">,</span>
		<span class="n">mode</span><span class="o">-&gt;</span><span class="n">xres</span><span class="p">,</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">yres</span><span class="p">,</span> <span class="n">bpp</span><span class="p">,</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">refresh</span><span class="p">);</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">xres</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">xres</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">yres</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">yres</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">xres_virtual</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">xres</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">yres_virtual</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">yres</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">xoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">yoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">bits_per_pixel</span> <span class="o">=</span> <span class="n">bpp</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">activate</span> <span class="o">|=</span> <span class="n">FB_ACTIVATE_TEST</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">pixclock</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">pixclock</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">left_margin</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">left_margin</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">right_margin</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">right_margin</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">upper_margin</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">upper_margin</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">lower_margin</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">lower_margin</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">hsync_len</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">hsync_len</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">vsync_len</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">vsync_len</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">sync</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">sync</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">vmode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">vmode</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">fbops</span><span class="o">-&gt;</span><span class="n">fb_check_var</span><span class="p">)</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">fbops</span><span class="o">-&gt;</span><span class="n">fb_check_var</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">info</span><span class="p">);</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">activate</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FB_ACTIVATE_TEST</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *     fb_find_mode - finds a valid video mode</span>
<span class="cm"> *     @var: frame buffer user defined part of display</span>
<span class="cm"> *     @info: frame buffer info structure</span>
<span class="cm"> *     @mode_option: string video mode to find</span>
<span class="cm"> *     @db: video mode database</span>
<span class="cm"> *     @dbsize: size of @db</span>
<span class="cm"> *     @default_mode: default video mode to fall back to</span>
<span class="cm"> *     @default_bpp: default color depth in bits per pixel</span>
<span class="cm"> *</span>
<span class="cm"> *     Finds a suitable video mode, starting with the specified mode</span>
<span class="cm"> *     in @mode_option with fallback to @default_mode.  If</span>
<span class="cm"> *     @default_mode fails, all modes in the video mode database will</span>
<span class="cm"> *     be tried.</span>
<span class="cm"> *</span>
<span class="cm"> *     Valid mode specifiers for @mode_option:</span>
<span class="cm"> *</span>
<span class="cm"> *     &lt;xres&gt;x&lt;yres&gt;[M][R][-&lt;bpp&gt;][@&lt;refresh&gt;][i][m] or</span>
<span class="cm"> *     &lt;name&gt;[-&lt;bpp&gt;][@&lt;refresh&gt;]</span>
<span class="cm"> *</span>
<span class="cm"> *     with &lt;xres&gt;, &lt;yres&gt;, &lt;bpp&gt; and &lt;refresh&gt; decimal numbers and</span>
<span class="cm"> *     &lt;name&gt; a string.</span>
<span class="cm"> *</span>
<span class="cm"> *      If &#39;M&#39; is present after yres (and before refresh/bpp if present),</span>
<span class="cm"> *      the function will compute the timings using VESA(tm) Coordinated</span>
<span class="cm"> *      Video Timings (CVT).  If &#39;R&#39; is present after &#39;M&#39;, will compute with</span>
<span class="cm"> *      reduced blanking (for flatpanels).  If &#39;i&#39; is present, compute</span>
<span class="cm"> *      interlaced mode.  If &#39;m&#39; is present, add margins equal to 1.8%</span>
<span class="cm"> *      of xres rounded down to 8 pixels, and 1.8% of yres. The char</span>
<span class="cm"> *      &#39;i&#39; and &#39;m&#39; must be after &#39;M&#39; and &#39;R&#39;. Example:</span>
<span class="cm"> *</span>
<span class="cm"> *      1024x768MR-8@60m - Reduced blank with margins at 60Hz.</span>
<span class="cm"> *</span>
<span class="cm"> *     NOTE: The passed struct @var is _not_ cleared!  This allows you</span>
<span class="cm"> *     to supply values for e.g. the grayscale and accel_flags fields.</span>
<span class="cm"> *</span>
<span class="cm"> *     Returns zero for failure, 1 if using specified @mode_option,</span>
<span class="cm"> *     2 if using specified @mode_option with an ignored refresh rate,</span>
<span class="cm"> *     3 if default mode is used, 4 if fall back to any valid mode.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="kt">int</span> <span class="nf">fb_find_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
		 <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mode_option</span><span class="p">,</span>
		 <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">db</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dbsize</span><span class="p">,</span>
		 <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">default_mode</span><span class="p">,</span>
		 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">default_bpp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/* Set up defaults */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">db</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">db</span> <span class="o">=</span> <span class="n">modedb</span><span class="p">;</span>
		<span class="n">dbsize</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">modedb</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">default_mode</span><span class="p">)</span>
		<span class="n">default_mode</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">db</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">default_bpp</span><span class="p">)</span>
		<span class="n">default_bpp</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

	<span class="cm">/* Did the user specify a video mode? */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">mode_option</span><span class="p">)</span>
		<span class="n">mode_option</span> <span class="o">=</span> <span class="n">fb_mode_option</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mode_option</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">mode_option</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">namelen</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">res_specified</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bpp_specified</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">refresh_specified</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">xres</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yres</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bpp</span> <span class="o">=</span> <span class="n">default_bpp</span><span class="p">,</span> <span class="n">refresh</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">yres_specified</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cvt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">interlace</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">margins</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">best</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">tdiff</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">namelen</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
			<span class="k">case</span> <span class="sc">&#39;@&#39;</span>:
				<span class="n">namelen</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">refresh_specified</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">bpp_specified</span> <span class="o">&amp;&amp;</span>
				    <span class="o">!</span><span class="n">yres_specified</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">refresh</span> <span class="o">=</span> <span class="n">simple_strtol</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span>
								<span class="mi">10</span><span class="p">);</span>
					<span class="n">refresh_specified</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">cvt</span> <span class="o">||</span> <span class="n">rb</span><span class="p">)</span>
						<span class="n">cvt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">&#39;-&#39;</span>:
				<span class="n">namelen</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bpp_specified</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">yres_specified</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">bpp</span> <span class="o">=</span> <span class="n">simple_strtol</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span>
							    <span class="mi">10</span><span class="p">);</span>
					<span class="n">bpp_specified</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">cvt</span> <span class="o">||</span> <span class="n">rb</span><span class="p">)</span>
						<span class="n">cvt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">&#39;x&#39;</span>:
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">yres_specified</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">yres</span> <span class="o">=</span> <span class="n">simple_strtol</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">,</span>
							     <span class="mi">10</span><span class="p">);</span>
					<span class="n">yres_specified</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">&#39;0&#39;</span> <span class="p">...</span> <span class="sc">&#39;9&#39;</span>:
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">&#39;M&#39;</span>:
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">yres_specified</span><span class="p">)</span>
					<span class="n">cvt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">&#39;R&#39;</span>:
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cvt</span><span class="p">)</span>
					<span class="n">rb</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">&#39;m&#39;</span>:
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cvt</span><span class="p">)</span>
					<span class="n">margins</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="sc">&#39;i&#39;</span>:
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cvt</span><span class="p">)</span>
					<span class="n">interlace</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="nl">default:</span>
				<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">yres_specified</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">xres</span> <span class="o">=</span> <span class="n">simple_strtol</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
			<span class="n">res_specified</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
<span class="nl">done:</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cvt</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">cvt_mode</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

			<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;CVT mode %dx%d@%dHz%s%s%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">xres</span><span class="p">,</span> <span class="n">yres</span><span class="p">,</span>
				<span class="p">(</span><span class="n">refresh</span><span class="p">)</span> <span class="o">?</span> <span class="n">refresh</span> <span class="o">:</span> <span class="mi">60</span><span class="p">,</span>
				<span class="p">(</span><span class="n">rb</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; reduced blanking&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
				<span class="p">(</span><span class="n">margins</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; with margins&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
				<span class="p">(</span><span class="n">interlace</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; interlaced&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>

			<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cvt_mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cvt_mode</span><span class="p">));</span>
			<span class="n">cvt_mode</span><span class="p">.</span><span class="n">xres</span> <span class="o">=</span> <span class="n">xres</span><span class="p">;</span>
			<span class="n">cvt_mode</span><span class="p">.</span><span class="n">yres</span> <span class="o">=</span> <span class="n">yres</span><span class="p">;</span>
			<span class="n">cvt_mode</span><span class="p">.</span><span class="n">refresh</span> <span class="o">=</span> <span class="p">(</span><span class="n">refresh</span><span class="p">)</span> <span class="o">?</span> <span class="n">refresh</span> <span class="o">:</span> <span class="mi">60</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">interlace</span><span class="p">)</span>
				<span class="n">cvt_mode</span><span class="p">.</span><span class="n">vmode</span> <span class="o">|=</span> <span class="n">FB_VMODE_INTERLACED</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">cvt_mode</span><span class="p">.</span><span class="n">vmode</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FB_VMODE_INTERLACED</span><span class="p">;</span>

			<span class="n">ret</span> <span class="o">=</span> <span class="n">fb_find_mode_cvt</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cvt_mode</span><span class="p">,</span> <span class="n">margins</span><span class="p">,</span> <span class="n">rb</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ret</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">fb_try_mode</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cvt_mode</span><span class="p">,</span> <span class="n">bpp</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;modedb CVT: CVT mode ok</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;CVT mode invalid, getting mode from database</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Trying specified video mode%s %ix%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">refresh_specified</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="s">&quot; (ignoring refresh rate)&quot;</span><span class="p">,</span>
			<span class="n">xres</span><span class="p">,</span> <span class="n">yres</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">refresh_specified</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/*</span>
<span class="cm">			 * If the caller has provided a custom mode database and</span>
<span class="cm">			 * a valid monspecs structure, we look for the mode with</span>
<span class="cm">			 * the highest refresh rate.  Otherwise we play it safe</span>
<span class="cm">			 * it and try to find a mode with a refresh rate closest</span>
<span class="cm">			 * to the standard 60 Hz.</span>
<span class="cm">			 */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">db</span> <span class="o">!=</span> <span class="n">modedb</span> <span class="o">&amp;&amp;</span>
			    <span class="n">info</span><span class="o">-&gt;</span><span class="n">monspecs</span><span class="p">.</span><span class="n">vfmin</span> <span class="o">&amp;&amp;</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">monspecs</span><span class="p">.</span><span class="n">vfmax</span> <span class="o">&amp;&amp;</span>
			    <span class="n">info</span><span class="o">-&gt;</span><span class="n">monspecs</span><span class="p">.</span><span class="n">hfmin</span> <span class="o">&amp;&amp;</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">monspecs</span><span class="p">.</span><span class="n">hfmax</span> <span class="o">&amp;&amp;</span>
			    <span class="n">info</span><span class="o">-&gt;</span><span class="n">monspecs</span><span class="p">.</span><span class="n">dclkmax</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">refresh</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">refresh</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="n">diff</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">best</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dbsize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">name_matches</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="n">namelen</span><span class="p">)</span> <span class="o">||</span>
			     <span class="p">(</span><span class="n">res_specified</span> <span class="o">&amp;&amp;</span> <span class="n">res_matches</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xres</span><span class="p">,</span> <span class="n">yres</span><span class="p">)))</span> <span class="o">&amp;&amp;</span>
			    <span class="o">!</span><span class="n">fb_try_mode</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bpp</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">refresh_specified</span> <span class="o">&amp;&amp;</span> <span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">refresh</span> <span class="o">==</span> <span class="n">refresh</span><span class="p">)</span>
					<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">refresh</span> <span class="o">-</span> <span class="n">refresh</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">diff</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">diff</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">refresh</span> <span class="o">-</span> <span class="n">refresh</span><span class="p">);</span>
					<span class="n">best</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">best</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">fb_try_mode</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">db</span><span class="p">[</span><span class="n">best</span><span class="p">],</span> <span class="n">bpp</span><span class="p">);</span>
			<span class="k">return</span> <span class="p">(</span><span class="n">refresh_specified</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">diff</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">xres</span> <span class="o">+</span> <span class="n">yres</span><span class="p">);</span>
		<span class="n">best</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Trying best-fit modes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dbsize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Trying %ix%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">xres</span><span class="p">,</span> <span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">yres</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fb_try_mode</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bpp</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tdiff</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">xres</span> <span class="o">-</span> <span class="n">xres</span><span class="p">)</span> <span class="o">+</span>
					<span class="n">abs</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">yres</span> <span class="o">-</span> <span class="n">yres</span><span class="p">);</span>

				<span class="cm">/*</span>
<span class="cm">				 * Penalize modes with resolutions smaller</span>
<span class="cm">				 * than requested.</span>
<span class="cm">				 */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">xres</span> <span class="o">&gt;</span> <span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">xres</span> <span class="o">||</span> <span class="n">yres</span> <span class="o">&gt;</span> <span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">yres</span><span class="p">)</span>
					<span class="n">tdiff</span> <span class="o">+=</span> <span class="n">xres</span> <span class="o">+</span> <span class="n">yres</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="n">tdiff</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">diff</span> <span class="o">=</span> <span class="n">tdiff</span><span class="p">;</span>
					<span class="n">best</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">best</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">fb_try_mode</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">db</span><span class="p">[</span><span class="n">best</span><span class="p">],</span> <span class="n">bpp</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Trying default video mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fb_try_mode</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">default_mode</span><span class="p">,</span> <span class="n">default_bpp</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">3</span><span class="p">;</span>

	<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Trying all modes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dbsize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fb_try_mode</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">db</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">default_bpp</span><span class="p">))</span>
			<span class="k">return</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;No valid mode found</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * fb_var_to_videomode - convert fb_var_screeninfo to fb_videomode</span>
<span class="cm"> * @mode: pointer to struct fb_videomode</span>
<span class="cm"> * @var: pointer to struct fb_var_screeninfo</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">fb_var_to_videomode</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span>
			 <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">pixclock</span><span class="p">,</span> <span class="n">hfreq</span><span class="p">,</span> <span class="n">htotal</span><span class="p">,</span> <span class="n">vtotal</span><span class="p">;</span>

	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">xres</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">xres</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">yres</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">yres</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">pixclock</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">pixclock</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">hsync_len</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">hsync_len</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">vsync_len</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">vsync_len</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">left_margin</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">left_margin</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">right_margin</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">right_margin</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">upper_margin</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">upper_margin</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">lower_margin</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">lower_margin</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">sync</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">sync</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">vmode</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">vmode</span> <span class="o">&amp;</span> <span class="n">FB_VMODE_MASK</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">flag</span> <span class="o">=</span> <span class="n">FB_MODE_IS_FROM_VAR</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">refresh</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">var</span><span class="o">-&gt;</span><span class="n">pixclock</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">pixclock</span> <span class="o">=</span> <span class="n">PICOS2KHZ</span><span class="p">(</span><span class="n">var</span><span class="o">-&gt;</span><span class="n">pixclock</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>

	<span class="n">htotal</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">xres</span> <span class="o">+</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">right_margin</span> <span class="o">+</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">hsync_len</span> <span class="o">+</span>
		<span class="n">var</span><span class="o">-&gt;</span><span class="n">left_margin</span><span class="p">;</span>
	<span class="n">vtotal</span> <span class="o">=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">yres</span> <span class="o">+</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">lower_margin</span> <span class="o">+</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">vsync_len</span> <span class="o">+</span>
		<span class="n">var</span><span class="o">-&gt;</span><span class="n">upper_margin</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">var</span><span class="o">-&gt;</span><span class="n">vmode</span> <span class="o">&amp;</span> <span class="n">FB_VMODE_INTERLACED</span><span class="p">)</span>
		<span class="n">vtotal</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">var</span><span class="o">-&gt;</span><span class="n">vmode</span> <span class="o">&amp;</span> <span class="n">FB_VMODE_DOUBLE</span><span class="p">)</span>
		<span class="n">vtotal</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="n">hfreq</span> <span class="o">=</span> <span class="n">pixclock</span><span class="o">/</span><span class="n">htotal</span><span class="p">;</span>
	<span class="n">mode</span><span class="o">-&gt;</span><span class="n">refresh</span> <span class="o">=</span> <span class="n">hfreq</span><span class="o">/</span><span class="n">vtotal</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * fb_videomode_to_var - convert fb_videomode to fb_var_screeninfo</span>
<span class="cm"> * @var: pointer to struct fb_var_screeninfo</span>
<span class="cm"> * @mode: pointer to struct fb_videomode</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">fb_videomode_to_var</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
			 <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">xres</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">xres</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">yres</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">yres</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">xres_virtual</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">xres</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">yres_virtual</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">yres</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">xoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">yoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">pixclock</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">pixclock</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">left_margin</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">left_margin</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">right_margin</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">right_margin</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">upper_margin</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">upper_margin</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">lower_margin</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">lower_margin</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">hsync_len</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">hsync_len</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">vsync_len</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">vsync_len</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">sync</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">sync</span><span class="p">;</span>
	<span class="n">var</span><span class="o">-&gt;</span><span class="n">vmode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">vmode</span> <span class="o">&amp;</span> <span class="n">FB_VMODE_MASK</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * fb_mode_is_equal - compare 2 videomodes</span>
<span class="cm"> * @mode1: first videomode</span>
<span class="cm"> * @mode2: second videomode</span>
<span class="cm"> *</span>
<span class="cm"> * RETURNS:</span>
<span class="cm"> * 1 if equal, 0 if not</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">fb_mode_is_equal</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode1</span><span class="p">,</span>
		     <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">mode1</span><span class="o">-&gt;</span><span class="n">xres</span>         <span class="o">==</span> <span class="n">mode2</span><span class="o">-&gt;</span><span class="n">xres</span> <span class="o">&amp;&amp;</span>
		<span class="n">mode1</span><span class="o">-&gt;</span><span class="n">yres</span>         <span class="o">==</span> <span class="n">mode2</span><span class="o">-&gt;</span><span class="n">yres</span> <span class="o">&amp;&amp;</span>
		<span class="n">mode1</span><span class="o">-&gt;</span><span class="n">pixclock</span>     <span class="o">==</span> <span class="n">mode2</span><span class="o">-&gt;</span><span class="n">pixclock</span> <span class="o">&amp;&amp;</span>
		<span class="n">mode1</span><span class="o">-&gt;</span><span class="n">hsync_len</span>    <span class="o">==</span> <span class="n">mode2</span><span class="o">-&gt;</span><span class="n">hsync_len</span> <span class="o">&amp;&amp;</span>
		<span class="n">mode1</span><span class="o">-&gt;</span><span class="n">vsync_len</span>    <span class="o">==</span> <span class="n">mode2</span><span class="o">-&gt;</span><span class="n">vsync_len</span> <span class="o">&amp;&amp;</span>
		<span class="n">mode1</span><span class="o">-&gt;</span><span class="n">left_margin</span>  <span class="o">==</span> <span class="n">mode2</span><span class="o">-&gt;</span><span class="n">left_margin</span> <span class="o">&amp;&amp;</span>
		<span class="n">mode1</span><span class="o">-&gt;</span><span class="n">right_margin</span> <span class="o">==</span> <span class="n">mode2</span><span class="o">-&gt;</span><span class="n">right_margin</span> <span class="o">&amp;&amp;</span>
		<span class="n">mode1</span><span class="o">-&gt;</span><span class="n">upper_margin</span> <span class="o">==</span> <span class="n">mode2</span><span class="o">-&gt;</span><span class="n">upper_margin</span> <span class="o">&amp;&amp;</span>
		<span class="n">mode1</span><span class="o">-&gt;</span><span class="n">lower_margin</span> <span class="o">==</span> <span class="n">mode2</span><span class="o">-&gt;</span><span class="n">lower_margin</span> <span class="o">&amp;&amp;</span>
		<span class="n">mode1</span><span class="o">-&gt;</span><span class="n">sync</span>         <span class="o">==</span> <span class="n">mode2</span><span class="o">-&gt;</span><span class="n">sync</span> <span class="o">&amp;&amp;</span>
		<span class="n">mode1</span><span class="o">-&gt;</span><span class="n">vmode</span>        <span class="o">==</span> <span class="n">mode2</span><span class="o">-&gt;</span><span class="n">vmode</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * fb_find_best_mode - find best matching videomode</span>
<span class="cm"> * @var: pointer to struct fb_var_screeninfo</span>
<span class="cm"> * @head: pointer to struct list_head of modelist</span>
<span class="cm"> *</span>
<span class="cm"> * RETURNS:</span>
<span class="cm"> * struct fb_videomode, NULL if none found</span>
<span class="cm"> *</span>
<span class="cm"> * IMPORTANT:</span>
<span class="cm"> * This function assumes that all modelist entries in</span>
<span class="cm"> * info-&gt;modelist are valid.</span>
<span class="cm"> *</span>
<span class="cm"> * NOTES:</span>
<span class="cm"> * Finds best matching videomode which has an equal or greater dimension than</span>
<span class="cm"> * var-&gt;xres and var-&gt;yres.  If more than 1 videomode is found, will return</span>
<span class="cm"> * the videomode with the highest refresh rate</span>
<span class="cm"> */</span>
<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="nf">fb_find_best_mode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">pos</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_modelist</span> <span class="o">*</span><span class="n">modelist</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span> <span class="o">*</span><span class="n">best</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">diff</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">list_for_each</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">d</span><span class="p">;</span>

		<span class="n">modelist</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_modelist</span><span class="p">,</span> <span class="n">list</span><span class="p">);</span>
		<span class="n">mode</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">modelist</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="o">-&gt;</span><span class="n">xres</span> <span class="o">&gt;=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">xres</span> <span class="o">&amp;&amp;</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">yres</span> <span class="o">&gt;=</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">yres</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">mode</span><span class="o">-&gt;</span><span class="n">xres</span> <span class="o">-</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">xres</span><span class="p">)</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">mode</span><span class="o">-&gt;</span><span class="n">yres</span> <span class="o">-</span> <span class="n">var</span><span class="o">-&gt;</span><span class="n">yres</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">diff</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
				<span class="n">best</span> <span class="o">=</span> <span class="n">mode</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="n">d</span> <span class="o">&amp;&amp;</span> <span class="n">best</span> <span class="o">&amp;&amp;</span>
				   <span class="n">mode</span><span class="o">-&gt;</span><span class="n">refresh</span> <span class="o">&gt;</span> <span class="n">best</span><span class="o">-&gt;</span><span class="n">refresh</span><span class="p">)</span>
				<span class="n">best</span> <span class="o">=</span> <span class="n">mode</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">best</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * fb_find_nearest_mode - find closest videomode</span>
<span class="cm"> *</span>
<span class="cm"> * @mode: pointer to struct fb_videomode</span>
<span class="cm"> * @head: pointer to modelist</span>
<span class="cm"> *</span>
<span class="cm"> * Finds best matching videomode, smaller or greater in dimension.</span>
<span class="cm"> * If more than 1 videomode is found, will return the videomode with</span>
<span class="cm"> * the closest refresh rate.</span>
<span class="cm"> */</span>
<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="nf">fb_find_nearest_mode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span>
					        <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">pos</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_modelist</span> <span class="o">*</span><span class="n">modelist</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">cmode</span><span class="p">,</span> <span class="o">*</span><span class="n">best</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">diff</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">diff_refresh</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">list_for_each</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">d</span><span class="p">;</span>

		<span class="n">modelist</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_modelist</span><span class="p">,</span> <span class="n">list</span><span class="p">);</span>
		<span class="n">cmode</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">modelist</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">;</span>

		<span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">cmode</span><span class="o">-&gt;</span><span class="n">xres</span> <span class="o">-</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">xres</span><span class="p">)</span> <span class="o">+</span>
			<span class="n">abs</span><span class="p">(</span><span class="n">cmode</span><span class="o">-&gt;</span><span class="n">yres</span> <span class="o">-</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">yres</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">diff</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
			<span class="n">diff_refresh</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">cmode</span><span class="o">-&gt;</span><span class="n">refresh</span> <span class="o">-</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">refresh</span><span class="p">);</span>
			<span class="n">best</span> <span class="o">=</span> <span class="n">cmode</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">cmode</span><span class="o">-&gt;</span><span class="n">refresh</span> <span class="o">-</span> <span class="n">mode</span><span class="o">-&gt;</span><span class="n">refresh</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">diff_refresh</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">diff_refresh</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
				<span class="n">best</span> <span class="o">=</span> <span class="n">cmode</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">best</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * fb_match_mode - find a videomode which exactly matches the timings in var</span>
<span class="cm"> * @var: pointer to struct fb_var_screeninfo</span>
<span class="cm"> * @head: pointer to struct list_head of modelist</span>
<span class="cm"> *</span>
<span class="cm"> * RETURNS:</span>
<span class="cm"> * struct fb_videomode, NULL if none found</span>
<span class="cm"> */</span>
<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="nf">fb_match_mode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">pos</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_modelist</span> <span class="o">*</span><span class="n">modelist</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">mode</span><span class="p">;</span>

	<span class="n">fb_var_to_videomode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mode</span><span class="p">,</span> <span class="n">var</span><span class="p">);</span>
	<span class="n">list_for_each</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">modelist</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_modelist</span><span class="p">,</span> <span class="n">list</span><span class="p">);</span>
		<span class="n">m</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">modelist</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fb_mode_is_equal</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mode</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">m</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * fb_add_videomode - adds videomode entry to modelist</span>
<span class="cm"> * @mode: videomode to add</span>
<span class="cm"> * @head: struct list_head of modelist</span>
<span class="cm"> *</span>
<span class="cm"> * NOTES:</span>
<span class="cm"> * Will only add unmatched mode entries</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">fb_add_videomode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">pos</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_modelist</span> <span class="o">*</span><span class="n">modelist</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">m</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">list_for_each</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">modelist</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_modelist</span><span class="p">,</span> <span class="n">list</span><span class="p">);</span>
		<span class="n">m</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">modelist</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fb_mode_is_equal</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mode</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">found</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">modelist</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_modelist</span><span class="p">),</span>
						  <span class="n">GFP_KERNEL</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">modelist</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="n">modelist</span><span class="o">-&gt;</span><span class="n">mode</span> <span class="o">=</span> <span class="o">*</span><span class="n">mode</span><span class="p">;</span>
		<span class="n">list_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">modelist</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">,</span> <span class="n">head</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * fb_delete_videomode - removed videomode entry from modelist</span>
<span class="cm"> * @mode: videomode to remove</span>
<span class="cm"> * @head: struct list_head of modelist</span>
<span class="cm"> *</span>
<span class="cm"> * NOTES:</span>
<span class="cm"> * Will remove all matching mode entries</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">fb_delete_videomode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">pos</span><span class="p">,</span> <span class="o">*</span><span class="n">n</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_modelist</span> <span class="o">*</span><span class="n">modelist</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">m</span><span class="p">;</span>

	<span class="n">list_for_each_safe</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">modelist</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_modelist</span><span class="p">,</span> <span class="n">list</span><span class="p">);</span>
		<span class="n">m</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">modelist</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fb_mode_is_equal</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">mode</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">list_del</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
			<span class="n">kfree</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * fb_destroy_modelist - destroy modelist</span>
<span class="cm"> * @head: struct list_head of modelist</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">fb_destroy_modelist</span><span class="p">(</span><span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">pos</span><span class="p">,</span> <span class="o">*</span><span class="n">n</span><span class="p">;</span>

	<span class="n">list_for_each_safe</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">list_del</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">fb_destroy_modelist</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * fb_videomode_to_modelist - convert mode array to mode list</span>
<span class="cm"> * @modedb: array of struct fb_videomode</span>
<span class="cm"> * @num: number of entries in array</span>
<span class="cm"> * @head: struct list_head of modelist</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">fb_videomode_to_modelist</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">modedb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">INIT_LIST_HEAD</span><span class="p">(</span><span class="n">head</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fb_add_videomode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">modedb</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">head</span><span class="p">))</span>
			<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="nf">fb_find_best_display</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_monspecs</span> <span class="o">*</span><span class="n">specs</span><span class="p">,</span>
					        <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">pos</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_modelist</span> <span class="o">*</span><span class="n">modelist</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">m1</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">*</span><span class="n">md</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">*</span><span class="n">best</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">first</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">||</span> <span class="o">!</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">||</span> <span class="n">list_empty</span><span class="p">(</span><span class="n">head</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">finished</span><span class="p">;</span>

	<span class="cm">/* get the first detailed mode and the very first mode */</span>
	<span class="n">list_for_each</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">modelist</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_modelist</span><span class="p">,</span> <span class="n">list</span><span class="p">);</span>
		<span class="n">m</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">modelist</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">first</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">m1</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span>
			<span class="n">first</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">FB_MODE_IS_FIRST</span><span class="p">)</span> <span class="p">{</span>
 			<span class="n">md</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/* first detailed timing is preferred */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">specs</span><span class="o">-&gt;</span><span class="n">misc</span> <span class="o">&amp;</span> <span class="n">FB_MISC_1ST_DETAIL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">best</span> <span class="o">=</span> <span class="n">md</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">finished</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* find best mode based on display width and height */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">specs</span><span class="o">-&gt;</span><span class="n">max_x</span> <span class="o">&amp;&amp;</span> <span class="n">specs</span><span class="o">-&gt;</span><span class="n">max_y</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="n">var</span><span class="p">;</span>

		<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">var</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_var_screeninfo</span><span class="p">));</span>
		<span class="n">var</span><span class="p">.</span><span class="n">xres</span> <span class="o">=</span> <span class="p">(</span><span class="n">specs</span><span class="o">-&gt;</span><span class="n">max_x</span> <span class="o">*</span> <span class="mi">7200</span><span class="p">)</span><span class="o">/</span><span class="mi">254</span><span class="p">;</span>
		<span class="n">var</span><span class="p">.</span><span class="n">yres</span> <span class="o">=</span> <span class="p">(</span><span class="n">specs</span><span class="o">-&gt;</span><span class="n">max_y</span> <span class="o">*</span> <span class="mi">7200</span><span class="p">)</span><span class="o">/</span><span class="mi">254</span><span class="p">;</span>
		<span class="n">m</span> <span class="o">=</span> <span class="n">fb_find_best_mode</span><span class="p">(</span><span class="o">&amp;</span><span class="n">var</span><span class="p">,</span> <span class="n">head</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">best</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span>
			<span class="k">goto</span> <span class="n">finished</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/* use first detailed mode */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">md</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">best</span> <span class="o">=</span> <span class="n">md</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">finished</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* last resort, use the very first mode */</span>
	<span class="n">best</span> <span class="o">=</span> <span class="n">m1</span><span class="p">;</span>
<span class="nl">finished:</span>
	<span class="k">return</span> <span class="n">best</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">fb_find_best_display</span><span class="p">);</span>

<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">fb_videomode_to_var</span><span class="p">);</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">fb_var_to_videomode</span><span class="p">);</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">fb_mode_is_equal</span><span class="p">);</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">fb_add_videomode</span><span class="p">);</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">fb_match_mode</span><span class="p">);</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">fb_find_best_mode</span><span class="p">);</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">fb_find_nearest_mode</span><span class="p">);</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">fb_videomode_to_modelist</span><span class="p">);</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">fb_find_mode</span><span class="p">);</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">fb_find_mode_cvt</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
