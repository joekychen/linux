<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › input › misc › wistron_btns.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>wistron_btns.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Wistron laptop button driver</span>
<span class="cm"> * Copyright (C) 2005 Miloslav Trmac &lt;mitr@volny.cz&gt;</span>
<span class="cm"> * Copyright (C) 2005 Bernhard Rosenkraenzer &lt;bero@arklinux.org&gt;</span>
<span class="cm"> * Copyright (C) 2005 Dmitry Torokhov &lt;dtor@mail.ru&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * You can redistribute and/or modify this program under the terms of the</span>
<span class="cm"> * GNU General Public License version 2 as published by the Free Software</span>
<span class="cm"> * Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General</span>
<span class="cm"> * Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along</span>
<span class="cm"> * with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 59 Temple Place Suite 330, Boston, MA 02111-1307, USA.</span>
<span class="cm"> */</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/dmi.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/input-polldev.h&gt;</span>
<span class="cp">#include &lt;linux/input/sparse-keymap.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/jiffies.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/mc146818rtc.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/preempt.h&gt;</span>
<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/leds.h&gt;</span>

<span class="cm">/* How often we poll keys - msecs */</span>
<span class="cp">#define POLL_INTERVAL_DEFAULT	500 </span><span class="cm">/* when idle */</span><span class="cp"></span>
<span class="cp">#define POLL_INTERVAL_BURST	100 </span><span class="cm">/* when a key was recently pressed */</span><span class="cp"></span>

<span class="cm">/* BIOS subsystem IDs */</span>
<span class="cp">#define WIFI		0x35</span>
<span class="cp">#define BLUETOOTH	0x34</span>
<span class="cp">#define MAIL_LED	0x31</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Miloslav Trmac &lt;mitr@volny.cz&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;Wistron laptop button driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL v2&quot;</span><span class="p">);</span>
<span class="n">MODULE_VERSION</span><span class="p">(</span><span class="s">&quot;0.3&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">bool</span> <span class="n">force</span><span class="p">;</span> <span class="cm">/* = 0; */</span>
<span class="n">module_param</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="n">bool</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="s">&quot;Load even if computer is not in database&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">keymap_name</span><span class="p">;</span> <span class="cm">/* = NULL; */</span>
<span class="n">module_param_named</span><span class="p">(</span><span class="n">keymap</span><span class="p">,</span> <span class="n">keymap_name</span><span class="p">,</span> <span class="n">charp</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">keymap</span><span class="p">,</span> <span class="s">&quot;Keymap name, if it can&#39;t be autodetected [generic, 1557/MS2141]&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">wistron_device</span><span class="p">;</span>

 <span class="cm">/* BIOS interface implementation */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">bios_entry_point</span><span class="p">;</span> <span class="cm">/* BIOS routine entry point */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">bios_code_map_base</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">bios_data_map_base</span><span class="p">;</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">cmos_address</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">regs</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">eax</span><span class="p">,</span> <span class="n">ebx</span><span class="p">,</span> <span class="n">ecx</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">call_bios</span><span class="p">(</span><span class="k">struct</span> <span class="n">regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">preempt_disable</span><span class="p">();</span>
	<span class="n">local_irq_save</span><span class="p">(</span><span class="n">flags</span><span class="p">);</span>
	<span class="n">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&quot;pushl %%ebp;&quot;</span>
		      <span class="s">&quot;movl %7, %%ebp;&quot;</span>
		      <span class="s">&quot;call *%6;&quot;</span>
		      <span class="s">&quot;popl %%ebp&quot;</span>
		      <span class="o">:</span> <span class="s">&quot;=a&quot;</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">eax</span><span class="p">),</span> <span class="s">&quot;=b&quot;</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ebx</span><span class="p">),</span> <span class="s">&quot;=c&quot;</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ecx</span><span class="p">)</span>
		      <span class="o">:</span> <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">eax</span><span class="p">),</span> <span class="s">&quot;1&quot;</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ebx</span><span class="p">),</span> <span class="s">&quot;2&quot;</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">ecx</span><span class="p">),</span>
			<span class="s">&quot;m&quot;</span> <span class="p">(</span><span class="n">bios_entry_point</span><span class="p">),</span> <span class="s">&quot;m&quot;</span> <span class="p">(</span><span class="n">bios_data_map_base</span><span class="p">)</span>
		      <span class="o">:</span> <span class="s">&quot;edx&quot;</span><span class="p">,</span> <span class="s">&quot;edi&quot;</span><span class="p">,</span> <span class="s">&quot;esi&quot;</span><span class="p">,</span> <span class="s">&quot;memory&quot;</span><span class="p">);</span>
	<span class="n">local_irq_restore</span><span class="p">(</span><span class="n">flags</span><span class="p">);</span>
	<span class="n">preempt_enable</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="n">__init</span> <span class="nf">locate_wistron_bios</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">base</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">__initdata</span> <span class="n">signature</span><span class="p">[]</span> <span class="o">=</span>
		<span class="p">{</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">};</span>
	<span class="kt">ssize_t</span> <span class="n">offset</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mh">0x10000</span><span class="p">;</span> <span class="n">offset</span> <span class="o">+=</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">check_signature</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span>
				    <span class="k">sizeof</span><span class="p">(</span><span class="n">signature</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">offset</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">map_bios</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">base</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">offset</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">entry_point</span><span class="p">;</span>

	<span class="n">base</span> <span class="o">=</span> <span class="n">ioremap</span><span class="p">(</span><span class="mh">0xF0000</span><span class="p">,</span> <span class="mh">0x10000</span><span class="p">);</span> <span class="cm">/* Can&#39;t fail */</span>
	<span class="n">offset</span> <span class="o">=</span> <span class="n">locate_wistron_bios</span><span class="p">(</span><span class="n">base</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;wistron_btns: BIOS entry point not found</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">iounmap</span><span class="p">(</span><span class="n">base</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">entry_point</span> <span class="o">=</span> <span class="n">readl</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="mi">5</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span>
		<span class="s">&quot;wistron_btns: BIOS signature found at %p, entry point %08X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">base</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">entry_point</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">entry_point</span> <span class="o">&gt;=</span> <span class="mh">0xF0000</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bios_code_map_base</span> <span class="o">=</span> <span class="n">base</span><span class="p">;</span>
		<span class="n">bios_entry_point</span> <span class="o">=</span> <span class="n">bios_code_map_base</span> <span class="o">+</span> <span class="p">(</span><span class="n">entry_point</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">iounmap</span><span class="p">(</span><span class="n">base</span><span class="p">);</span>
		<span class="n">bios_code_map_base</span> <span class="o">=</span> <span class="n">ioremap</span><span class="p">(</span><span class="n">entry_point</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x3FFF</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bios_code_map_base</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span>
				<span class="s">&quot;wistron_btns: Can&#39;t map BIOS code at %08X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">entry_point</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x3FFF</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">bios_entry_point</span> <span class="o">=</span> <span class="n">bios_code_map_base</span> <span class="o">+</span> <span class="p">(</span><span class="n">entry_point</span> <span class="o">&amp;</span> <span class="mh">0x3FFF</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="cm">/* The Windows driver maps 0x10000 bytes, we keep only one page... */</span>
	<span class="n">bios_data_map_base</span> <span class="o">=</span> <span class="n">ioremap</span><span class="p">(</span><span class="mh">0x400</span><span class="p">,</span> <span class="mh">0xc00</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bios_data_map_base</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;wistron_btns: Can&#39;t map BIOS data</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">err_code</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">err_code:</span>
	<span class="n">iounmap</span><span class="p">(</span><span class="n">bios_code_map_base</span><span class="p">);</span>
<span class="nl">err:</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">unmap_bios</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iounmap</span><span class="p">(</span><span class="n">bios_code_map_base</span><span class="p">);</span>
	<span class="n">iounmap</span><span class="p">(</span><span class="n">bios_data_map_base</span><span class="p">);</span>
<span class="p">}</span>

 <span class="cm">/* BIOS calls */</span>

<span class="k">static</span> <span class="n">u16</span> <span class="nf">bios_pop_queue</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">regs</span> <span class="n">regs</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">regs</span><span class="p">));</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">eax</span> <span class="o">=</span> <span class="mh">0x9610</span><span class="p">;</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">ebx</span> <span class="o">=</span> <span class="mh">0x061C</span><span class="p">;</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">ecx</span> <span class="o">=</span> <span class="mh">0x0000</span><span class="p">;</span>
	<span class="n">call_bios</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">regs</span><span class="p">.</span><span class="n">eax</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__devinit</span> <span class="nf">bios_attach</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">regs</span> <span class="n">regs</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">regs</span><span class="p">));</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">eax</span> <span class="o">=</span> <span class="mh">0x9610</span><span class="p">;</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">ebx</span> <span class="o">=</span> <span class="mh">0x012E</span><span class="p">;</span>
	<span class="n">call_bios</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bios_detach</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">regs</span> <span class="n">regs</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">regs</span><span class="p">));</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">eax</span> <span class="o">=</span> <span class="mh">0x9610</span><span class="p">;</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">ebx</span> <span class="o">=</span> <span class="mh">0x002E</span><span class="p">;</span>
	<span class="n">call_bios</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">__devinit</span> <span class="nf">bios_get_cmos_address</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">regs</span> <span class="n">regs</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">regs</span><span class="p">));</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">eax</span> <span class="o">=</span> <span class="mh">0x9610</span><span class="p">;</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">ebx</span> <span class="o">=</span> <span class="mh">0x051C</span><span class="p">;</span>
	<span class="n">call_bios</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">regs</span><span class="p">.</span><span class="n">ecx</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u16</span> <span class="n">__devinit</span> <span class="nf">bios_get_default_setting</span><span class="p">(</span><span class="n">u8</span> <span class="n">subsys</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">regs</span> <span class="n">regs</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">regs</span><span class="p">));</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">eax</span> <span class="o">=</span> <span class="mh">0x9610</span><span class="p">;</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">ebx</span> <span class="o">=</span> <span class="mh">0x0200</span> <span class="o">|</span> <span class="n">subsys</span><span class="p">;</span>
	<span class="n">call_bios</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">regs</span><span class="p">.</span><span class="n">eax</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bios_set_state</span><span class="p">(</span><span class="n">u8</span> <span class="n">subsys</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">regs</span> <span class="n">regs</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">regs</span><span class="p">));</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">eax</span> <span class="o">=</span> <span class="mh">0x9610</span><span class="p">;</span>
	<span class="n">regs</span><span class="p">.</span><span class="n">ebx</span> <span class="o">=</span> <span class="p">(</span><span class="n">enable</span> <span class="o">?</span> <span class="mh">0x0100</span> <span class="o">:</span> <span class="mh">0x0000</span><span class="p">)</span> <span class="o">|</span> <span class="n">subsys</span><span class="p">;</span>
	<span class="n">call_bios</span><span class="p">(</span><span class="o">&amp;</span><span class="n">regs</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Hardware database */</span>

<span class="cp">#define KE_WIFI		(KE_LAST + 1)</span>
<span class="cp">#define KE_BLUETOOTH	(KE_LAST + 2)</span>

<span class="cp">#define FE_MAIL_LED 0x01</span>
<span class="cp">#define FE_WIFI_LED 0x02</span>
<span class="cp">#define FE_UNTESTED 0x80</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="o">*</span><span class="n">keymap</span><span class="p">;</span> <span class="cm">/* = NULL; Current key map */</span>
<span class="k">static</span> <span class="n">bool</span> <span class="n">have_wifi</span><span class="p">;</span>
<span class="k">static</span> <span class="n">bool</span> <span class="n">have_bluetooth</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">leds_present</span><span class="p">;</span>	<span class="cm">/* bitmask of leds present */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">dmi_matched</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">dmi_system_id</span> <span class="o">*</span><span class="n">dmi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="o">*</span><span class="n">key</span><span class="p">;</span>

	<span class="n">keymap</span> <span class="o">=</span> <span class="n">dmi</span><span class="o">-&gt;</span><span class="n">driver_data</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="n">keymap</span><span class="p">;</span> <span class="n">key</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">!=</span> <span class="n">KE_END</span><span class="p">;</span> <span class="n">key</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">KE_WIFI</span><span class="p">)</span>
			<span class="n">have_wifi</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">KE_BLUETOOTH</span><span class="p">)</span>
			<span class="n">have_bluetooth</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">leds_present</span> <span class="o">=</span> <span class="n">key</span><span class="o">-&gt;</span><span class="n">code</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_WIFI_LED</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_empty</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_fs_amilo_pro_v2000</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_fs_amilo_pro_v3505</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>       <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>          <span class="cm">/* Fn+F1 */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>       <span class="mh">0x06</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_DISPLAYTOGGLE</span><span class="p">}</span> <span class="p">},</span> <span class="cm">/* Fn+F4 */</span>
	<span class="p">{</span> <span class="n">KE_BLUETOOTH</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>                      <span class="cm">/* Fn+F10 */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>       <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>          <span class="cm">/* mail button */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>       <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>           <span class="cm">/* www button */</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span>      <span class="mh">0x78</span> <span class="p">},</span>                      <span class="cm">/* satellite dish button */</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span>       <span class="mi">0</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_fujitsu_n3510</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_STOPCD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PLAYPAUSE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_REWIND</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_FORWARD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_wistron_ms2111</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x13</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_wistron_md40100</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_DISPLAYTOGGLE</span><span class="p">}</span> <span class="p">},</span> <span class="cm">/* Display on/off */</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_WIFI_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_wistron_ms2141</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x22</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_REWIND</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x23</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_FORWARD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x24</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PLAYPAUSE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x25</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_STOPCD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_aspire_1500</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_POWER</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_BLUETOOTH</span><span class="p">,</span> <span class="mh">0x44</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_aspire_1600</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_POWER</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MUTE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_BLUETOOTH</span><span class="p">,</span> <span class="mh">0x44</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* 3020 has been tested */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_aspire_5020</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_POWER</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_SWITCHVIDEOMODE</span><span class="p">}</span> <span class="p">},</span> <span class="cm">/* Display selection */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_BLUETOOTH</span><span class="p">,</span> <span class="mh">0x44</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_travelmate_2410</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_POWER</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_BLUETOOTH</span><span class="p">,</span> <span class="mh">0x44</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_travelmate_110</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_POWER</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MUTE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_VOLUMEUP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_VOLUMEDOWN</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_SW</span><span class="p">,</span> <span class="mh">0x4a</span><span class="p">,</span> <span class="p">{.</span><span class="n">sw</span> <span class="o">=</span> <span class="p">{</span><span class="n">SW_LID</span><span class="p">,</span> <span class="mi">1</span><span class="p">}}</span> <span class="p">},</span> <span class="cm">/* lid close */</span>
	<span class="p">{</span> <span class="n">KE_SW</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="p">{.</span><span class="n">sw</span> <span class="o">=</span> <span class="p">{</span><span class="n">SW_LID</span><span class="p">,</span> <span class="mi">0</span><span class="p">}}</span> <span class="p">},</span> <span class="cm">/* lid open */</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_travelmate_300</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_POWER</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MUTE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_VOLUMEUP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_VOLUMEDOWN</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_BLUETOOTH</span><span class="p">,</span> <span class="mh">0x44</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_travelmate_380</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_POWER</span><span class="p">}</span> <span class="p">},</span> <span class="cm">/* not 370 */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* unusual map */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_travelmate_220</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_WIFI_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_travelmate_230</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_WIFI_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_travelmate_240</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_POWER</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MUTE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_BLUETOOTH</span><span class="p">,</span> <span class="mh">0x44</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_travelmate_350</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_WIFI_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_travelmate_360</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WLAN</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_WIFI_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span> <span class="cm">/* no mail led */</span>
<span class="p">};</span>

<span class="cm">/* Wifi subsystem only activates the led. Therefore we need to pass</span>
<span class="cm"> * wifi event as a normal key, then userspace can really change the wifi state.</span>
<span class="cm"> * TODO we need to export led state to userspace (wifi and mail) */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_travelmate_610</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WLAN</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_WIFI_LED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_acer_travelmate_630</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_POWER</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MUTE</span><span class="p">}</span> <span class="p">},</span> <span class="cm">/* not 620 */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_VOLUMEUP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_VOLUMEDOWN</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_aopen_1559as</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x06</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_fs_amilo_d88x0</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MUTE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_WIFI_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_wistron_md2900</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_MAIL_LED</span> <span class="o">|</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_wistron_md96500</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_SWITCHVIDEOMODE</span><span class="p">}</span> <span class="p">},</span> <span class="cm">/* Display selection */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_DISPLAYTOGGLE</span><span class="p">}</span> <span class="p">},</span> <span class="cm">/* Display on/off */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MUTE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_VOLUMEUP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_VOLUMEDOWN</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_REWIND</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_FORWARD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PLAYPAUSE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_STOPCD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_BLUETOOTH</span><span class="p">,</span> <span class="mh">0x44</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="n">FE_UNTESTED</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_wistron_generic</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_POWER</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_SWITCHVIDEOMODE</span><span class="p">}</span> <span class="p">},</span> <span class="cm">/* Display selection */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_DISPLAYTOGGLE</span><span class="p">}</span> <span class="p">},</span> <span class="cm">/* Display on/off */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MUTE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_VOLUMEUP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_VOLUMEDOWN</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_REWIND</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_FORWARD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PLAYPAUSE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_STOPCD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_DISPLAYTOGGLE</span><span class="p">}</span> <span class="p">},</span> <span class="cm">/* Display on/off */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WLAN</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_SW</span><span class="p">,</span> <span class="mh">0x4a</span><span class="p">,</span> <span class="p">{.</span><span class="n">sw</span> <span class="o">=</span> <span class="p">{</span><span class="n">SW_LID</span><span class="p">,</span> <span class="mi">1</span><span class="p">}}</span> <span class="p">},</span> <span class="cm">/* lid close */</span>
	<span class="p">{</span> <span class="n">KE_SW</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="p">{.</span><span class="n">sw</span> <span class="o">=</span> <span class="p">{</span><span class="n">SW_LID</span><span class="p">,</span> <span class="mi">0</span><span class="p">}}</span> <span class="p">},</span> <span class="cm">/* lid open */</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_CONFIG</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_POWER</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_STOPCD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PLAYPAUSE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_REWIND</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_FORWARD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_BLUETOOTH</span><span class="p">,</span> <span class="mh">0x44</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_aopen_1557</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_HELP</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x22</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_REWIND</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x23</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_FORWARD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x24</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PLAYPAUSE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x25</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_STOPCD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="n">keymap_prestigio</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x11</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x12</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PROG2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_WIFI</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x22</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_REWIND</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x23</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_FORWARD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x24</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_PLAYPAUSE</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x25</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_STOPCD</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x31</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_MAIL</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_KEY</span><span class="p">,</span>  <span class="mh">0x36</span><span class="p">,</span> <span class="p">{</span><span class="n">KEY_WWW</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">KE_END</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">}</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * If your machine is not here (which is currently rather likely), please send</span>
<span class="cm"> * a list of buttons and their key codes (reported when loading this module</span>
<span class="cm"> * with force=1) and the output of dmidecode to $MODULE_AUTHOR.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dmi_system_id</span> <span class="n">__initconst</span> <span class="n">dmi_ids</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="cm">/* Fujitsu-Siemens Amilo Pro V2000 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;FUJITSU SIEMENS&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;AMILO Pro V2000&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_fs_amilo_pro_v2000</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Fujitsu-Siemens Amilo Pro Edition V3505 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;FUJITSU SIEMENS&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;AMILO Pro Edition V3505&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_fs_amilo_pro_v3505</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Fujitsu-Siemens Amilo M7400 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;FUJITSU SIEMENS&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;AMILO M        &quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_fs_amilo_pro_v2000</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Maxdata Pro 7000 DX */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;MAXDATA&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;Pro 7000&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_fs_amilo_pro_v2000</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Fujitsu N3510 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;FUJITSU&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;N3510&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_fujitsu_n3510</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer Aspire 1500 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;Aspire 1500&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_aspire_1500</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer Aspire 1600 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;Aspire 1600&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_aspire_1600</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer Aspire 3020 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;Aspire 3020&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_aspire_5020</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer Aspire 5020 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;Aspire 5020&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_aspire_5020</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 2100 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 2100&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_aspire_5020</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 2410 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 2410&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_2410</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate C300 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate C300&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_300</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate C100 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate C100&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_300</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate C110 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate C110&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_110</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 380 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 380&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_380</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 370 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 370&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_380</span> <span class="cm">/* keyboard minus 1 key */</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 220 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 220&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_220</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 260 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 260&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_220</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 230 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 230&quot;</span><span class="p">),</span>
			<span class="cm">/* acerhk looks for &quot;TravelMate F4...&quot; ?! */</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_230</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 280 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 280&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_230</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 240 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 240&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_240</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 250 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 250&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_240</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 2424NWXCi */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 2420&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_240</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 350 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 350&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_350</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 360 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 360&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_360</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 610 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;ACER&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 610&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_610</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 620 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 620&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_630</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Acer TravelMate 630 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;TravelMate 630&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_acer_travelmate_630</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* AOpen 1559AS */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;E2U&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_BOARD_NAME</span><span class="p">,</span> <span class="s">&quot;E2U&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_aopen_1559as</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Medion MD 9783 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;MEDIONNB&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;MD 9783&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_wistron_ms2111</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Medion MD 40100 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;MEDIONNB&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;WID2000&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_wistron_md40100</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Medion MD 2900 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;MEDIONNB&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;WIM 2000&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_wistron_md2900</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Medion MD 42200 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;Medion&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;WIM 2030&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_fs_amilo_pro_v2000</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Medion MD 96500 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;MEDIONPC&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;WIM 2040&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_wistron_md96500</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Medion MD 95400 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;MEDIONPC&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;WIM 2050&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_wistron_md96500</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Fujitsu Siemens Amilo D7820 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;FUJITSU SIEMENS&quot;</span><span class="p">),</span> <span class="cm">/* not sure */</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;Amilo D&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_fs_amilo_d88x0</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Fujitsu Siemens Amilo D88x0 */</span>
		<span class="p">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dmi_matched</span><span class="p">,</span>
		<span class="p">.</span><span class="n">matches</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_SYS_VENDOR</span><span class="p">,</span> <span class="s">&quot;FUJITSU SIEMENS&quot;</span><span class="p">),</span>
			<span class="n">DMI_MATCH</span><span class="p">(</span><span class="n">DMI_PRODUCT_NAME</span><span class="p">,</span> <span class="s">&quot;AMILO D&quot;</span><span class="p">),</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">keymap_fs_amilo_d88x0</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* Copy the good keymap, as the original ones are free&#39;d */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">copy_keymap</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="o">*</span><span class="n">key</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">key_entry</span> <span class="o">*</span><span class="n">new_keymap</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="n">keymap</span><span class="p">;</span> <span class="n">key</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">!=</span> <span class="n">KE_END</span><span class="p">;</span> <span class="n">key</span><span class="o">++</span><span class="p">)</span>
		<span class="n">length</span><span class="o">++</span><span class="p">;</span>

	<span class="n">new_keymap</span> <span class="o">=</span> <span class="n">kmemdup</span><span class="p">(</span><span class="n">keymap</span><span class="p">,</span> <span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">key_entry</span><span class="p">),</span>
			     <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">new_keymap</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">keymap</span> <span class="o">=</span> <span class="n">new_keymap</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">select_keymap</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dmi_check_system</span><span class="p">(</span><span class="n">dmi_ids</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">keymap_name</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span> <span class="p">(</span><span class="n">keymap_name</span><span class="p">,</span> <span class="s">&quot;1557/MS2141&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">keymap</span> <span class="o">=</span> <span class="n">keymap_wistron_ms2141</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span> <span class="p">(</span><span class="n">keymap_name</span><span class="p">,</span> <span class="s">&quot;aopen1557&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">keymap</span> <span class="o">=</span> <span class="n">keymap_aopen_1557</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span> <span class="p">(</span><span class="n">keymap_name</span><span class="p">,</span> <span class="s">&quot;prestigio&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">keymap</span> <span class="o">=</span> <span class="n">keymap_prestigio</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span> <span class="p">(</span><span class="n">keymap_name</span><span class="p">,</span> <span class="s">&quot;generic&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">keymap</span> <span class="o">=</span> <span class="n">keymap_wistron_generic</span><span class="p">;</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;wistron_btns: Keymap unknown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">keymap</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">force</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;wistron_btns: System unknown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">keymap</span> <span class="o">=</span> <span class="n">keymap_empty</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">copy_keymap</span><span class="p">();</span>
<span class="p">}</span>

 <span class="cm">/* Input layer interface */</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">input_polled_dev</span> <span class="o">*</span><span class="n">wistron_idev</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">jiffies_last_press</span><span class="p">;</span>
<span class="k">static</span> <span class="n">bool</span> <span class="n">wifi_enabled</span><span class="p">;</span>
<span class="k">static</span> <span class="n">bool</span> <span class="n">bluetooth_enabled</span><span class="p">;</span>

 <span class="cm">/* led management */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">wistron_mail_led_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">,</span>
				<span class="k">enum</span> <span class="n">led_brightness</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bios_set_state</span><span class="p">(</span><span class="n">MAIL_LED</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span> <span class="o">!=</span> <span class="n">LED_OFF</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* same as setting up wifi card, but for laptops on which the led is managed */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">wistron_wifi_led_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">,</span>
				<span class="k">enum</span> <span class="n">led_brightness</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bios_set_state</span><span class="p">(</span><span class="n">WIFI</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span> <span class="o">!=</span> <span class="n">LED_OFF</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">led_classdev</span> <span class="n">wistron_mail_led</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;wistron:green:mail&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">brightness_set</span>		<span class="o">=</span> <span class="n">wistron_mail_led_set</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">led_classdev</span> <span class="n">wistron_wifi_led</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;wistron:red:wifi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">brightness_set</span>		<span class="o">=</span> <span class="n">wistron_wifi_led_set</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__devinit</span> <span class="nf">wistron_led_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">leds_present</span> <span class="o">&amp;</span> <span class="n">FE_WIFI_LED</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">wifi</span> <span class="o">=</span> <span class="n">bios_get_default_setting</span><span class="p">(</span><span class="n">WIFI</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wifi</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">wistron_wifi_led</span><span class="p">.</span><span class="n">brightness</span> <span class="o">=</span> <span class="p">(</span><span class="n">wifi</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="n">LED_FULL</span> <span class="o">:</span> <span class="n">LED_OFF</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">led_classdev_register</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wistron_wifi_led</span><span class="p">))</span>
				<span class="n">leds_present</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FE_WIFI_LED</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">bios_set_state</span><span class="p">(</span><span class="n">WIFI</span><span class="p">,</span> <span class="n">wistron_wifi_led</span><span class="p">.</span><span class="n">brightness</span><span class="p">);</span>

		<span class="p">}</span> <span class="k">else</span>
			<span class="n">leds_present</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FE_WIFI_LED</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">leds_present</span> <span class="o">&amp;</span> <span class="n">FE_MAIL_LED</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* bios_get_default_setting(MAIL) always retuns 0, so just turn the led off */</span>
		<span class="n">wistron_mail_led</span><span class="p">.</span><span class="n">brightness</span> <span class="o">=</span> <span class="n">LED_OFF</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">led_classdev_register</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wistron_mail_led</span><span class="p">))</span>
			<span class="n">leds_present</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FE_MAIL_LED</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">bios_set_state</span><span class="p">(</span><span class="n">MAIL_LED</span><span class="p">,</span> <span class="n">wistron_mail_led</span><span class="p">.</span><span class="n">brightness</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__devexit</span> <span class="nf">wistron_led_remove</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">leds_present</span> <span class="o">&amp;</span> <span class="n">FE_MAIL_LED</span><span class="p">)</span>
		<span class="n">led_classdev_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wistron_mail_led</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">leds_present</span> <span class="o">&amp;</span> <span class="n">FE_WIFI_LED</span><span class="p">)</span>
		<span class="n">led_classdev_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wistron_wifi_led</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">wistron_led_suspend</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">leds_present</span> <span class="o">&amp;</span> <span class="n">FE_MAIL_LED</span><span class="p">)</span>
		<span class="n">led_classdev_suspend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wistron_mail_led</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">leds_present</span> <span class="o">&amp;</span> <span class="n">FE_WIFI_LED</span><span class="p">)</span>
		<span class="n">led_classdev_suspend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wistron_wifi_led</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">wistron_led_resume</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">leds_present</span> <span class="o">&amp;</span> <span class="n">FE_MAIL_LED</span><span class="p">)</span>
		<span class="n">led_classdev_resume</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wistron_mail_led</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">leds_present</span> <span class="o">&amp;</span> <span class="n">FE_WIFI_LED</span><span class="p">)</span>
		<span class="n">led_classdev_resume</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wistron_wifi_led</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">handle_key</span><span class="p">(</span><span class="n">u8</span> <span class="n">code</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">key_entry</span> <span class="o">*</span><span class="n">key</span> <span class="o">=</span>
		<span class="n">sparse_keymap_entry_from_scancode</span><span class="p">(</span><span class="n">wistron_idev</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">,</span> <span class="n">code</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">key</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">KE_WIFI</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">have_wifi</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">wifi_enabled</span> <span class="o">=</span> <span class="o">!</span><span class="n">wifi_enabled</span><span class="p">;</span>
				<span class="n">bios_set_state</span><span class="p">(</span><span class="n">WIFI</span><span class="p">,</span> <span class="n">wifi_enabled</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">KE_BLUETOOTH</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">have_bluetooth</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">bluetooth_enabled</span> <span class="o">=</span> <span class="o">!</span><span class="n">bluetooth_enabled</span><span class="p">;</span>
				<span class="n">bios_set_state</span><span class="p">(</span><span class="n">BLUETOOTH</span><span class="p">,</span> <span class="n">bluetooth_enabled</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">sparse_keymap_report_entry</span><span class="p">(</span><span class="n">wistron_idev</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">,</span>
						   <span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">jiffies_last_press</span> <span class="o">=</span> <span class="n">jiffies</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_NOTICE</span>
			<span class="s">&quot;wistron_btns: Unknown key code %02X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">code</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">poll_bios</span><span class="p">(</span><span class="n">bool</span> <span class="n">discard</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">qlen</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">val</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
		<span class="n">qlen</span> <span class="o">=</span> <span class="n">CMOS_READ</span><span class="p">(</span><span class="n">cmos_address</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">qlen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">bios_pop_queue</span><span class="p">();</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">discard</span><span class="p">)</span>
			<span class="n">handle_key</span><span class="p">((</span><span class="n">u8</span><span class="p">)</span><span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wistron_flush</span><span class="p">(</span><span class="k">struct</span> <span class="n">input_polled_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* Flush stale event queue */</span>
	<span class="n">poll_bios</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wistron_poll</span><span class="p">(</span><span class="k">struct</span> <span class="n">input_polled_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">poll_bios</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>

	<span class="cm">/* Increase poll frequency if user is currently pressing keys (&lt; 2s ago) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">time_before</span><span class="p">(</span><span class="n">jiffies</span><span class="p">,</span> <span class="n">jiffies_last_press</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">HZ</span><span class="p">))</span>
		<span class="n">dev</span><span class="o">-&gt;</span><span class="n">poll_interval</span> <span class="o">=</span> <span class="n">POLL_INTERVAL_BURST</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">dev</span><span class="o">-&gt;</span><span class="n">poll_interval</span> <span class="o">=</span> <span class="n">POLL_INTERVAL_DEFAULT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">wistron_setup_keymap</span><span class="p">(</span><span class="k">struct</span> <span class="n">input_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">key_entry</span> <span class="o">*</span><span class="n">entry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>

	<span class="cm">/* if wifi or bluetooth are not available, create normal keys */</span>
	<span class="k">case</span> <span class="n">KE_WIFI</span>:
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">have_wifi</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">entry</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">KE_KEY</span><span class="p">;</span>
			<span class="n">entry</span><span class="o">-&gt;</span><span class="n">keycode</span> <span class="o">=</span> <span class="n">KEY_WLAN</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">KE_BLUETOOTH</span>:
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">have_bluetooth</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">entry</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">KE_KEY</span><span class="p">;</span>
			<span class="n">entry</span><span class="o">-&gt;</span><span class="n">keycode</span> <span class="o">=</span> <span class="n">KEY_BLUETOOTH</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">KE_END</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">code</span> <span class="o">&amp;</span> <span class="n">FE_UNTESTED</span><span class="p">)</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;Untested laptop multimedia keys, &quot;</span>
				<span class="s">&quot;please report success or failure to &quot;</span>
				<span class="s">&quot;eric.piel@tremplin-utc.net</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">setup_input_dev</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">input_dev</span> <span class="o">*</span><span class="n">input_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">error</span><span class="p">;</span>

	<span class="n">wistron_idev</span> <span class="o">=</span> <span class="n">input_allocate_polled_device</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wistron_idev</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">wistron_idev</span><span class="o">-&gt;</span><span class="n">open</span> <span class="o">=</span> <span class="n">wistron_flush</span><span class="p">;</span>
	<span class="n">wistron_idev</span><span class="o">-&gt;</span><span class="n">poll</span> <span class="o">=</span> <span class="n">wistron_poll</span><span class="p">;</span>
	<span class="n">wistron_idev</span><span class="o">-&gt;</span><span class="n">poll_interval</span> <span class="o">=</span> <span class="n">POLL_INTERVAL_DEFAULT</span><span class="p">;</span>

	<span class="n">input_dev</span> <span class="o">=</span> <span class="n">wistron_idev</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">;</span>
	<span class="n">input_dev</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Wistron laptop buttons&quot;</span><span class="p">;</span>
	<span class="n">input_dev</span><span class="o">-&gt;</span><span class="n">phys</span> <span class="o">=</span> <span class="s">&quot;wistron/input0&quot;</span><span class="p">;</span>
	<span class="n">input_dev</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">bustype</span> <span class="o">=</span> <span class="n">BUS_HOST</span><span class="p">;</span>
	<span class="n">input_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wistron_device</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>

	<span class="n">error</span> <span class="o">=</span> <span class="n">sparse_keymap_setup</span><span class="p">(</span><span class="n">input_dev</span><span class="p">,</span> <span class="n">keymap</span><span class="p">,</span> <span class="n">wistron_setup_keymap</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err_free_dev</span><span class="p">;</span>

	<span class="n">error</span> <span class="o">=</span> <span class="n">input_register_polled_device</span><span class="p">(</span><span class="n">wistron_idev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err_free_keymap</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

 <span class="nl">err_free_keymap:</span>
	<span class="n">sparse_keymap_free</span><span class="p">(</span><span class="n">input_dev</span><span class="p">);</span>
 <span class="nl">err_free_dev:</span>
	<span class="n">input_free_polled_device</span><span class="p">(</span><span class="n">wistron_idev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">error</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Driver core */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">wistron_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">bios_attach</span><span class="p">();</span>
	<span class="n">cmos_address</span> <span class="o">=</span> <span class="n">bios_get_cmos_address</span><span class="p">();</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">have_wifi</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">wifi</span> <span class="o">=</span> <span class="n">bios_get_default_setting</span><span class="p">(</span><span class="n">WIFI</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wifi</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">wifi_enabled</span> <span class="o">=</span> <span class="n">wifi</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">have_wifi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">have_wifi</span><span class="p">)</span>
			<span class="n">bios_set_state</span><span class="p">(</span><span class="n">WIFI</span><span class="p">,</span> <span class="n">wifi_enabled</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">have_bluetooth</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">bt</span> <span class="o">=</span> <span class="n">bios_get_default_setting</span><span class="p">(</span><span class="n">BLUETOOTH</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bt</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">bluetooth_enabled</span> <span class="o">=</span> <span class="n">bt</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">have_bluetooth</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">have_bluetooth</span><span class="p">)</span>
			<span class="n">bios_set_state</span><span class="p">(</span><span class="n">BLUETOOTH</span><span class="p">,</span> <span class="n">bluetooth_enabled</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">wistron_led_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">setup_input_dev</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bios_detach</span><span class="p">();</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devexit</span> <span class="nf">wistron_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">wistron_led_remove</span><span class="p">();</span>
	<span class="n">input_unregister_polled_device</span><span class="p">(</span><span class="n">wistron_idev</span><span class="p">);</span>
	<span class="n">sparse_keymap_free</span><span class="p">(</span><span class="n">wistron_idev</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">);</span>
	<span class="n">input_free_polled_device</span><span class="p">(</span><span class="n">wistron_idev</span><span class="p">);</span>
	<span class="n">bios_detach</span><span class="p">();</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_PM</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">wistron_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">have_wifi</span><span class="p">)</span>
		<span class="n">bios_set_state</span><span class="p">(</span><span class="n">WIFI</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">have_bluetooth</span><span class="p">)</span>
		<span class="n">bios_set_state</span><span class="p">(</span><span class="n">BLUETOOTH</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">wistron_led_suspend</span><span class="p">();</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wistron_resume</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">have_wifi</span><span class="p">)</span>
		<span class="n">bios_set_state</span><span class="p">(</span><span class="n">WIFI</span><span class="p">,</span> <span class="n">wifi_enabled</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">have_bluetooth</span><span class="p">)</span>
		<span class="n">bios_set_state</span><span class="p">(</span><span class="n">BLUETOOTH</span><span class="p">,</span> <span class="n">bluetooth_enabled</span><span class="p">);</span>

	<span class="n">wistron_led_resume</span><span class="p">();</span>

	<span class="n">poll_bios</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dev_pm_ops</span> <span class="n">wistron_pm_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">suspend</span>	<span class="o">=</span> <span class="n">wistron_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resume</span>		<span class="o">=</span> <span class="n">wistron_resume</span><span class="p">,</span>
	<span class="p">.</span><span class="n">poweroff</span>	<span class="o">=</span> <span class="n">wistron_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">restore</span>	<span class="o">=</span> <span class="n">wistron_resume</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_driver</span> <span class="n">wistron_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;wistron-bios&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">owner</span>	<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_PM</span>
		<span class="p">.</span><span class="n">pm</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">wistron_pm_ops</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">probe</span>		<span class="o">=</span> <span class="n">wistron_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span>		<span class="o">=</span> <span class="n">__devexit_p</span><span class="p">(</span><span class="n">wistron_remove</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">wb_module_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">select_keymap</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">map_bios</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err_free_keymap</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">platform_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wistron_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err_unmap_bios</span><span class="p">;</span>

	<span class="n">wistron_device</span> <span class="o">=</span> <span class="n">platform_device_alloc</span><span class="p">(</span><span class="s">&quot;wistron-bios&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wistron_device</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">err_unregister_driver</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">platform_device_add</span><span class="p">(</span><span class="n">wistron_device</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err_free_device</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

 <span class="nl">err_free_device:</span>
	<span class="n">platform_device_put</span><span class="p">(</span><span class="n">wistron_device</span><span class="p">);</span>
 <span class="nl">err_unregister_driver:</span>
	<span class="n">platform_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wistron_driver</span><span class="p">);</span>
 <span class="nl">err_unmap_bios:</span>
	<span class="n">unmap_bios</span><span class="p">();</span>
 <span class="nl">err_free_keymap:</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">keymap</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">wb_module_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">platform_device_unregister</span><span class="p">(</span><span class="n">wistron_device</span><span class="p">);</span>
	<span class="n">platform_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wistron_driver</span><span class="p">);</span>
	<span class="n">unmap_bios</span><span class="p">();</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">keymap</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">wb_module_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">wb_module_exit</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
