f | serio_raw.c | s | 9.9K | 355 | Dmitry Torokhov | dmitry.torokhov@gmail.com | 1335943273 |  | Input: serio_raw - signal EFAULT even if read/write partially succeeds  When copy_to/from_user fails in the middle of transfer we should not report to the user that read/write partially succeeded but rather report -EFAULT right away, so that application will know that it got its buffers all wrong.  If application messed up its buffers we can't trust the data fetched from userspace and successfully written to the device or if data read from the device and transferred to userspace ended up where application expected it to end.  If serio_write() fails we still going to report partial writes if failure happens in the middle of the transfer.  This is basically a revert of 7a0a27d2ce38aee19a31fee8c12095f586eed393 and 4fa0771138d0b56fe59ab8ab3b1ce9e594484362.  Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | ct82c710.c | s | 6.6K | 206 | Davidlohr Bueso | dave@gnu.org | 1295326162 |  | Input: ct82710c - return proper error code for ct82c710_open  If request_irq() fails we should return the proper error instead of -1.  Signed-off-by: Davidlohr Bueso <dave@gnu.org> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | q40kbd.c | s | 4.8K | 164 | Dmitry Torokhov | dmitry.torokhov@gmail.com | 1327305751 |  | Input: q40kbd - convert driver to the split model  Convert the driver to standard spilt model arch-specific code registers platform device to which driver code can bind later.  Also request IRQ immediately upon binding to the device instead of doing this when serio port is being opened.  Acked-by: Geert Uytterhoeven <geert@linux-m68k.org> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | i8042-ppcio.h | s | 1.0K | 45 | Christoph Egger | siccegge@cs.fau.de | 1275637470 |  | Input: i8042 - remove SPRUCE support  CONFIG_SPRUCE was removed from kernel around 2.6.26; let's remove the last remaining piece.  Signed-off-by: Christoph Egger <siccegge@cs.fau.de> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | at32psif.c | s | 8.4K | 308 | Dmitry Torokhov | dmitry.torokhov@gmail.com | 1331319317 |  | Merge commit 'v3.3-rc6' into next
f | i8042.h | s | 2.3K | 90 | GuanXuetao | gxt@mprc.pku.edu.cn | 1300324755 |  | unicore32 machine related files: ps2 driver  This patch implements arch-specific ps2 driver.  By reviewed with Dmitry Torokhov:      1. move i8042-ucio.h to drivers/input/serio/i8042-unicore32io.h      2. move puv3_ps2_init() to arch/unicore32/kernel/puv3-core.c      3. remove unused comments.  Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn> Acked-by: Dmitry Torokhov <dtor@mail.ru>
f | i8042-unicore32io.h | s | 1.5K | 60 | GuanXuetao | gxt@mprc.pku.edu.cn | 1300324759 |  | unicore32 io: redefine __REG(x) and re-use readl/writel funcs    -- by advice of Arnd Bergmann  Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn> Reviewed-by: Arnd Bergmann <arnd@arndb.de>
f | Makefile | g | 965B |  | Dmitry Eremin-Solenikov | dbaryshkov@gmail.com | 1287419611 |  | Input: serio - add support for PS2Mult multiplexer protocol  PS2Mult is a simple serial protocol used for multiplexing several PS/2 streams into one serial data stream. It's used e.g. on TQM85xx series of boards.  Signed-off-by: Dmitry Eremin-Solenikov <dbaryshkov@gmail.com> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | rpckbd.c | s | 4.3K | 144 | Linus Torvalds | torvalds@linux-foundation.org | 1332975501 |  | 
f | ambakmi.c | s | 4.4K | 174 | viresh kumar | viresh.kumar@st.com | 1331940755 |  | ARM: 7362/1: AMBA: Add module_amba_driver() helper macro for amba_driver  For simple modules that contain a single amba_driver without any additional setup code then ends up being a block of duplicated boilerplate. This patch adds a new macro, module_amba_driver(), which replaces the module_init()/module_exit() registrations with template functions.  Signed-off-by: Viresh Kumar <viresh.kumar@st.com> Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
f | hp_sdc_mlc.c | s | 9.2K | 307 | Jesper Juhl | jj@chaosbits.net | 1290289098 |  | Input: serio HIL MLC - don't deref null, don't leak and return proper error  While reviewing various users of kernel memory allocation functions I came across drivers/input/serio/hil_mlc.c::hil_mlc_register() and noticed that:   - it calls kzalloc() but fails to check for a NULL return before use.  - it makes several allocations and if one fails it doesn't free the    previous ones.  - It doesn't return -ENOMEM in the failed memory allocation case (it just    crashes).  This patch corrects all of the above and also reworks the only caller of this function that I could find (drivers/input/serio/hp_sdc_mlc.c::hp_sdc_mlc_out()) so that it now checks the return value of hil_mlc_register() and properly propagates it on failure and I also restructured the code to remove some labels and goto's to make it, IMHO nicer to read.  Signed-off-by: Jesper Juhl <jj@chaosbits.net> Tested-by: Helge Deller <deller@gmx.de> Acked-by: Helge Deller <deller@gmx.de> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | i8042-ip22io.h | s | 1.4K | 59 | Dmitry Torokhov | dtor_core@ameritech.net | 1125816098 |  | Input: make i8042_platform_init return 'real' error code  Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | i8042.c | s | 33K | 1196 | Dmitry Torokhov | dmitry.torokhov@gmail.com | 1320476516 |  | Input: i8042 - also perform controller reset when suspending  In addition to some laptops needing i8042 reset after resuming from S2R to get their touchpads working there is another class of laptops - ones that need i8042 reset before going to S2R, otherwise they will simply reboot instead of resuming.  See https://bugzilla.kernel.org/show_bug.cgi?id=15612  This change forces reset of i8042 before doing S2R.  Reported-by: Stefan Koch <stefan_koch@gmx.net> Tested-by: Alexander van Loon <a.vanloon@alexandervanloon.nl> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | gscps2.c | s | 11K | 365 | Guy Martin | gmsoft@tuxicoman.be | 1291479599 |  | parisc: Fix GSC PS/2 driver name for keyboard and mouse  Fix kernel warnings caused by the driver name of GSC PS/2 containing '/'.  The following warnings are observed on a K410 system :  [   10.700000] name 'GSC PS/2 keyboard' [   10.732000] ------------[ cut here ]------------ [   10.772000] WARNING: at fs/proc/generic.c:323 [   10.828000] Modules linked in: [   10.916000] [   10.916000]      YZrvWESTHLNXBCVMcbcbcbcbOGFRQPDI [   10.936000] PSW: 00000000000001000000000000001111 Not tainted [   10.992000] r00-03  0004000f 104fe3e0 10201ea0 00000000 [   11.060000] r04-07  4fc405c8 00000006 4fc405c8 4fc40694 [   11.124000] r08-11  4fc40708 10438aa0 00000001 1043bfc8 [   11.184000] r12-15  104ff2a0 104ff2a0 4fc38634 104ff2a0 [   11.248000] r16-19  f0001570 10479af0 f000006c 1044fe50 [   11.308000] r20-23  00000000 00000028 104cd858 00000000 [   11.372000] r24-27  ffffffff 0000000e 1044fe10 1043bbe0 [   11.436000] r28-31  0000002b 00000078 4fc40800 0000000d [   11.496000] sr00-03  00000000 00000000 00000000 00000000 [   11.560000] sr04-07  00000000 00000000 00000000 00000000 [   11.624000] [   11.688000] IASQ: 00000000 00000000 IAOQ: 10201ea0 10201ea4 [   11.704000]  IIR: 03ffe01f    ISR: 00000000  IOR: 0000000d [   11.772000]  CPU:        0   CR30: 4fc40000 CR31: f01043b0 [   11.836000]  ORIG_R28: 4fc40940 [   11.904000]  IAOQ[0]: __xlate_proc_name+0x90/0xd0 [   11.940000]  IAOQ[1]: __xlate_proc_name+0x94/0xd0 [   11.996000]  RP(r2): __xlate_proc_name+0x90/0xd0 [   12.052000] Backtrace: [   12.108000]  [<10257790>] vsnprintf+0x290/0x4f4 [   12.136000] [   12.188000] ---[ end trace 91bf6ece17e322dd ]--- [   12.208000] serio: GSC PS/2 keyboard port at 0x0001c000 irq 19 @ 10:12:7 [   12.264000] name 'GSC PS/2 mouse' [   12.344000] ------------[ cut here ]------------ [   12.384000] WARNING: at fs/proc/generic.c:323 [   12.436000] Modules linked in: [   12.524000] [   12.528000]      YZrvWESTHLNXBCVMcbcbcbcbOGFRQPDI [   12.544000] PSW: 00000000000001000000000000001111 Tainted: G        W [   12.600000] r00-03  0004000f 104fe3e0 10201ea0 00000000 [   12.680000] r04-07  4fc405c8 00000006 4fc405c8 4fc40694 [   12.740000] r08-11  4fc40708 10438aa0 00000001 1043bfc8 [   12.804000] r12-15  104ff2a0 104ff2a0 4fc38634 104ff2a0 [   12.868000] r16-19  f0001570 10479af0 f000006c 1044fe50 [   12.928000] r20-23  00000000 00000025 104cd858 00000000 [   12.992000] r24-27  ffffffff 0000000e 1044fe10 1043bbe0 [   13.056000] r28-31  00000028 00000078 4fc40800 0000000d [   13.116000] sr00-03  00000000 00000000 00000000 00000000 [   13.180000] sr04-07  00000000 00000000 00000000 00000000 [   13.244000] [   13.308000] IASQ: 00000000 00000000 IAOQ: 10201ea0 10201ea4 [   13.324000]  IIR: 03ffe01f    ISR: 00000000  IOR: 0000000d [   13.392000]  CPU:        0   CR30: 4fc40000 CR31: f01043b0 [   13.456000]  ORIG_R28: 4fc40940 [   13.524000]  IAOQ[0]: __xlate_proc_name+0x90/0xd0 [   13.560000]  IAOQ[1]: __xlate_proc_name+0x94/0xd0 [   13.616000]  RP(r2): __xlate_proc_name+0x90/0xd0 [   13.672000] Backtrace: [   13.728000]  [<10257790>] vsnprintf+0x290/0x4f4 [   13.756000] [   13.808000] ---[ end trace 91bf6ece17e322de ]--- [   13.828000] serio: GSC PS/2 mouse port at 0x00020100 irq 19 @ 10:12:8  Signed-off-by: Guy Martin <gmsoft@tuxicoman.be> Acked-by: Helge Deller <deller@gmx.de> Signed-off-by: Kyle McMartin <kyle@mcmartin.ca>
f | maceps2.c | s | 5.4K | 171 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | i8042-jazzio.h | s | 1.3K | 54 | Dmitry Torokhov | dtor_core@ameritech.net | 1125816098 |  | Input: make i8042_platform_init return 'real' error code  Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | sa1111ps2.c | s | 8.1K | 309 | Linus Torvalds | torvalds@linux-foundation.org | 1332975501 |  | 
f | xilinx_ps2.c | s | 10K | 316 | Dmitry Torokhov | dmitry.torokhov@gmail.com | 1333472231 |  | Input: xilinx_ps2 - allocate serio port separately  'struct serio' is a refcounted data structure with lifetime rules different from 'struct xps2data'. It is quite likely that serio_unregister_port() will try to free memory allocated by the port and that is why it should be allocated separately.  Also switch to using platform_get/set_drvdata instead of dev_get/set_drvdata because we are dealing with platform device.  Reported-by: Tobias Klauser <tklauser@distanz.ch> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | serport.c | s | 6.2K | 211 | Linus Torvalds | torvalds@linux-foundation.org | 1307136804 |  | Revert "tty: make receive_buf() return the amout of bytes received"  This reverts commit b1c43f82c5aa265442f82dba31ce985ebb7aa71c.  It was broken in so many ways, and results in random odd pty issues.  It re-introduced the buggy schedule_work() in flush_to_ldisc() that can cause endless work-loops (see commit a5660b41af6a: "tty: fix endless work loop when the buffer fills up").  It also used an "unsigned int" return value fo the ->receive_buf() function, but then made multiple functions return a negative error code, and didn't actually check for the error in the caller.  And it didn't actually work at all.  BenH bisected down odd tty behavior to it:   "It looks like the patch is causing some major malfunctions of the X    server for me, possibly related to PTYs.  For example, cat'ing a    large file in a gnome terminal hangs the kernel for -minutes- in a    loop of what looks like flush_to_ldisc/workqueue code, (some ftrace    data in the quoted bits further down).     ...     Some more data: It -looks- like what happens is that the    flush_to_ldisc work queue entry constantly re-queues itself (because    the PTY is full ?) and the workqueue thread will basically loop    forver calling it without ever scheduling, thus starving the consumer    process that could have emptied the PTY."  which is pretty much exactly the problem we fixed in a5660b41af6a.  Milton Miller pointed out the 'unsigned int' issue.  Reported-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Reported-by: Milton Miller <miltonm@bga.com> Cc: Stefan Bigler <stefan.bigler@keymile.com> Cc: Toby Gray <toby.gray@realvnc.com> Cc: Felipe Balbi <balbi@ti.com> Cc: Greg Kroah-Hartman <gregkh@suse.de> Cc: Alan Cox <alan@lxorguk.ukuu.org.uk> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | i8042-snirm.h | s | 1.4K | 60 | Thomas Bogendoerfer | tsbogend@alpha.franken.de | 1205510046 |  | Input: i8042 - add SNI RM support  SNI RM200 don't have the i8042 controller connected to the EISA bus, but have a second address range for onboard devices. This patch handles the two possible address ranges for the i8042 on SNI RMs.  Signed-off-by: Thomas Bogendoerfer <tsbogend@alpha.franken.de> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | ams_delta_serio.c | s | 4.9K | 167 | Tony Lindgren | tony@atomide.com | 1333041364 |  | Merge branch 'fixes-gpio-to-irq' into fixes  Conflicts: 	arch/arm/mach-omap1/board-htcherald.c 	arch/arm/mach-omap2/board-rx51-peripherals.c 	arch/arm/plat-omap/include/plat/gpio.h 	drivers/input/serio/ams_delta_serio.c
f | ps2mult.c | s | 6.7K | 238 | Axel Lin | axel.lin@gmail.com | 1333556743 |  | Input: serio - use module_serio_driver  This patch converts the drivers in drivers/input/* to use module_serio_driver() macro which makes the code smaller and a bit simpler.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | i8042-sparcio.h | s | 3.4K | 127 | Grant Likely | grant.likely@secretlab.ca | 1298882199 |  | dt/sparc: Eliminate users of of_platform_{,un}register_driver  Get rid of old users of of_platform_driver in arch/sparc.  Most of_platform_driver users can be converted to use the platform_bus directly.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | libps2.c | s | 8.4K | 308 | Justin P. Mattock | justinmattock@gmail.com | 1309170536 |  | Input: libps2.c: fix comment typo arrrives.  Fix a typo in a comment.  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | serio.c | s | 24K | 854 | Alan Stern | stern@rowland.harvard.edu | 1327449634 |  | Driver core: driver_find() drops reference before returning  As part of the removal of get_driver()/put_driver(), this patch (as1510) changes driver_find(); it now drops the reference it acquires before returning.  The patch also adjusts all the callers of driver_find() to remove the now unnecessary calls to put_driver().  In addition, the patch adds a warning to driver_find(): Callers must make sure the driver they are searching for does not get unloaded while they are using it.  This has always been the case; driver_find() has never prevented a driver from being unregistered or unloaded. Hence the patch will not introduce any new bugs.  The existing callers all seem to be okay in this respect, however I don't understand the video drivers well enough to be certain about them.  Signed-off-by: Alan Stern <stern@rowland.harvard.edu> CC: Dmitry Torokhov <dmitry.torokhov@gmail.com> CC: Kyungmin Park <kyungmin.park@samsung.com> CC: Andy Walls <awalls@md.metrocast.net> CC: Martin Schwidefsky <schwidefsky@de.ibm.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | Kconfig | g | 7.2K |  | David Rientjes | rientjes@google.com | 1295571725 |  | kconfig: rename CONFIG_EMBEDDED to CONFIG_EXPERT  The meaning of CONFIG_EMBEDDED has long since been obsoleted; the option is used to configure any non-standard kernel with a much larger scope than only small devices.  This patch renames the option to CONFIG_EXPERT in init/Kconfig and fixes references to the option throughout the kernel.  A new CONFIG_EMBEDDED option is added that automatically selects CONFIG_EXPERT when enabled and can be used in the future to isolate options that should only be considered for embedded systems (RISC architectures, SLOB, etc).  Calling the option "EXPERT" more accurately represents its intention: only expert users who understand the impact of the configuration changes they are making should enable it.  Reviewed-by: Ingo Molnar <mingo@elte.hu> Acked-by: David Woodhouse <david.woodhouse@intel.com> Signed-off-by: David Rientjes <rientjes@google.com> Cc: Greg KH <gregkh@suse.de> Cc: "David S. Miller" <davem@davemloft.net> Cc: Jens Axboe <axboe@kernel.dk> Cc: Arnd Bergmann <arnd@arndb.de> Cc: Robin Holt <holt@sgi.com> Cc: <linux-arch@vger.kernel.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | i8042-io.h | s | 1.9K | 79 | Martyn Welch | martyn.welch@ge.com | 1278638913 |  | powerpc: Add i8042 keyboard and mouse irq parsing  Currently the irqs for the i8042, which historically provides keyboard and mouse (aux) support, is hardwired in the driver rather than parsing the dts.  This patch modifies the powerpc legacy IO code to attempt to parse the device tree for this information, failing back to the hardcoded values if it fails.  Signed-off-by: Martyn Welch <martyn.welch@ge.com> Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
f | parkbd.c | s | 5.1K | 171 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | altera_ps2.c | s | 4.5K | 170 | Tobias Klauser | tklauser@distanz.ch | 1331966040 |  | Input: altera_ps2 - use of_match_ptr()  Instead of having to define the match table to NULL if CONFIG_OF isn't set, use the of_match_ptr() macro which will do this for us.  Signed-off-by: Tobias Klauser <tklauser@distanz.ch> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | i8042-x86ia64io.h | s | 21K | 875 | Igor Murzov | intergalactic.anonymous@gmail.com | 1328257363 |  | Input: i8042 - add Lenovo Ideapad U455 to 'reset' blacklist  From 2d5a38a56453421e82428155f4b00303f3fb19b2 Mon Sep 17 00:00:00 2001 From: Igor Murzov <e-mail@date.by> Date: Wed, 1 Feb 2012 03:11:53 +0400 Subject: [PATCH] Input: i8042 - add Lenovo Ideapad U455 to 'reset' blacklist  Lenovo Ideapad U455 needs to be in the reset quirk list for its touchpad's proper function.  Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=40672  Signed-off-by: Igor Murzov <e-mail@date.by> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | pcips2.c | s | 4.8K | 183 | Axel Lin | axel.lin@gmail.com | 1335077338 |  | Input: use module_pci_driver  This patch converts the drivers in drivers/input/* to use module_pci_driver() macro which makes the code smaller and a bit simpler.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | hil_mlc.c | s | 25K | 837 | Jesper Juhl | jj@chaosbits.net | 1290289098 |  | Input: serio HIL MLC - don't deref null, don't leak and return proper error  While reviewing various users of kernel memory allocation functions I came across drivers/input/serio/hil_mlc.c::hil_mlc_register() and noticed that:   - it calls kzalloc() but fails to check for a NULL return before use.  - it makes several allocations and if one fails it doesn't free the    previous ones.  - It doesn't return -ENOMEM in the failed memory allocation case (it just    crashes).  This patch corrects all of the above and also reworks the only caller of this function that I could find (drivers/input/serio/hp_sdc_mlc.c::hp_sdc_mlc_out()) so that it now checks the return value of hil_mlc_register() and properly propagates it on failure and I also restructured the code to remove some labels and goto's to make it, IMHO nicer to read.  Signed-off-by: Jesper Juhl <jj@chaosbits.net> Tested-by: Helge Deller <deller@gmx.de> Acked-by: Helge Deller <deller@gmx.de> Signed-off-by: Dmitry Torokhov <dtor@mail.ru>
f | hp_sdc.c | s | 28K | 949 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
