<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › input › tablet › wacom.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>wacom.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * drivers/input/tablet/wacom.h</span>
<span class="cm"> *</span>
<span class="cm"> *  USB Wacom tablet support</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (c) 2000-2004 Vojtech Pavlik	&lt;vojtech@ucw.cz&gt;</span>
<span class="cm"> *  Copyright (c) 2000 Andreas Bach Aaen	&lt;abach@stofanet.dk&gt;</span>
<span class="cm"> *  Copyright (c) 2000 Clifford Wolf		&lt;clifford@clifford.at&gt;</span>
<span class="cm"> *  Copyright (c) 2000 Sam Mosel		&lt;sam.mosel@computer.org&gt;</span>
<span class="cm"> *  Copyright (c) 2000 James E. Blair		&lt;corvus@gnu.org&gt;</span>
<span class="cm"> *  Copyright (c) 2000 Daniel Egger		&lt;egger@suse.de&gt;</span>
<span class="cm"> *  Copyright (c) 2001 Frederic Lepied		&lt;flepied@mandrakesoft.com&gt;</span>
<span class="cm"> *  Copyright (c) 2004 Panagiotis Issaris	&lt;panagiotis.issaris@mech.kuleuven.ac.be&gt;</span>
<span class="cm"> *  Copyright (c) 2002-2011 Ping Cheng		&lt;pingc@wacom.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  ChangeLog:</span>
<span class="cm"> *      v0.1 (vp)  - Initial release</span>
<span class="cm"> *      v0.2 (aba) - Support for all buttons / combinations</span>
<span class="cm"> *      v0.3 (vp)  - Support for Intuos added</span>
<span class="cm"> *	v0.4 (sm)  - Support for more Intuos models, menustrip</span>
<span class="cm"> *			relative mode, proximity.</span>
<span class="cm"> *	v0.5 (vp)  - Big cleanup, nifty features removed,</span>
<span class="cm"> *			they belong in userspace</span>
<span class="cm"> *	v1.8 (vp)  - Submit URB only when operating, moved to CVS,</span>
<span class="cm"> *			use input_report_key instead of report_btn and</span>
<span class="cm"> *			other cleanups</span>
<span class="cm"> *	v1.11 (vp) - Add URB -&gt;dev setting for new kernels</span>
<span class="cm"> *	v1.11 (jb) - Add support for the 4D Mouse &amp; Lens</span>
<span class="cm"> *	v1.12 (de) - Add support for two more inking pen IDs</span>
<span class="cm"> *	v1.14 (vp) - Use new USB device id probing scheme.</span>
<span class="cm"> *		     Fix Wacom Graphire mouse wheel</span>
<span class="cm"> *	v1.18 (vp) - Fix mouse wheel direction</span>
<span class="cm"> *		     Make mouse relative</span>
<span class="cm"> *      v1.20 (fl) - Report tool id for Intuos devices</span>
<span class="cm"> *                 - Multi tools support</span>
<span class="cm"> *                 - Corrected Intuos protocol decoding (airbrush, 4D mouse, lens cursor...)</span>
<span class="cm"> *                 - Add PL models support</span>
<span class="cm"> *		   - Fix Wacom Graphire mouse wheel again</span>
<span class="cm"> *	v1.21 (vp) - Removed protocol descriptions</span>
<span class="cm"> *		   - Added MISC_SERIAL for tool serial numbers</span>
<span class="cm"> *	      (gb) - Identify version on module load.</span>
<span class="cm"> *    v1.21.1 (fl) - added Graphire2 support</span>
<span class="cm"> *    v1.21.2 (fl) - added Intuos2 support</span>
<span class="cm"> *                 - added all the PL ids</span>
<span class="cm"> *    v1.21.3 (fl) - added another eraser id from Neil Okamoto</span>
<span class="cm"> *                 - added smooth filter for Graphire from Peri Hankey</span>
<span class="cm"> *                 - added PenPartner support from Olaf van Es</span>
<span class="cm"> *                 - new tool ids from Ole Martin Bjoerndalen</span>
<span class="cm"> *	v1.29 (pc) - Add support for more tablets</span>
<span class="cm"> *		   - Fix pressure reporting</span>
<span class="cm"> *	v1.30 (vp) - Merge 2.4 and 2.5 drivers</span>
<span class="cm"> *		   - Since 2.5 now has input_sync(), remove MSC_SERIAL abuse</span>
<span class="cm"> *		   - Cleanups here and there</span>
<span class="cm"> *    v1.30.1 (pi) - Added Graphire3 support</span>
<span class="cm"> *	v1.40 (pc) - Add support for several new devices, fix eraser reporting, ...</span>
<span class="cm"> *	v1.43 (pc) - Added support for Cintiq 21UX</span>
<span class="cm"> *		   - Fixed a Graphire bug</span>
<span class="cm"> *		   - Merged wacom_intuos3_irq into wacom_intuos_irq</span>
<span class="cm"> *	v1.44 (pc) - Added support for Graphire4, Cintiq 710, Intuos3 6x11, etc.</span>
<span class="cm"> *		   - Report Device IDs</span>
<span class="cm"> *      v1.45 (pc) - Added support for DTF 521, Intuos3 12x12 and 12x19</span>
<span class="cm"> *                 - Minor data report fix</span>
<span class="cm"> *      v1.46 (pc) - Split wacom.c into wacom_sys.c and wacom_wac.c,</span>
<span class="cm"> *		   - where wacom_sys.c deals with system specific code,</span>
<span class="cm"> *		   - and wacom_wac.c deals with Wacom specific code</span>
<span class="cm"> *		   - Support Intuos3 4x6</span>
<span class="cm"> *      v1.47 (pc) - Added support for Bamboo</span>
<span class="cm"> *      v1.48 (pc) - Added support for Bamboo1, BambooFun, and Cintiq 12WX</span>
<span class="cm"> *      v1.49 (pc) - Added support for USB Tablet PC (0x90, 0x93, and 0x9A)</span>
<span class="cm"> *      v1.50 (pc) - Fixed a TabletPC touch bug in 2.6.28</span>
<span class="cm"> *      v1.51 (pc) - Added support for Intuos4</span>
<span class="cm"> *      v1.52 (pc) - Query Wacom data upon system resume</span>
<span class="cm"> *                 - add defines for features-&gt;type</span>
<span class="cm"> *                 - add new devices (0x9F, 0xE2, and 0XE3)</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef WACOM_H</span>
<span class="cp">#define WACOM_H</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/mod_devicetable.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/usb/input.h&gt;</span>
<span class="cp">#include &lt;linux/power_supply.h&gt;</span>
<span class="cp">#include &lt;asm/unaligned.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Version Information</span>
<span class="cm"> */</span>
<span class="cp">#define DRIVER_VERSION &quot;v1.53&quot;</span>
<span class="cp">#define DRIVER_AUTHOR &quot;Vojtech Pavlik &lt;vojtech@ucw.cz&gt;&quot;</span>
<span class="cp">#define DRIVER_DESC &quot;USB Wacom tablet driver&quot;</span>
<span class="cp">#define DRIVER_LICENSE &quot;GPL&quot;</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="n">DRIVER_AUTHOR</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="n">DRIVER_DESC</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="n">DRIVER_LICENSE</span><span class="p">);</span>

<span class="cp">#define USB_VENDOR_ID_WACOM	0x056a</span>
<span class="cp">#define USB_VENDOR_ID_LENOVO	0x17ef</span>

<span class="k">struct</span> <span class="n">wacom</span> <span class="p">{</span>
	<span class="n">dma_addr_t</span> <span class="n">data_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">usb_device</span> <span class="o">*</span><span class="n">usbdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">usb_interface</span> <span class="o">*</span><span class="n">intf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">urb</span> <span class="o">*</span><span class="n">irq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">wacom_wac</span> <span class="n">wacom_wac</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">work</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">open</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">phys</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">wacom_led</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">select</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="cm">/* status led selector (0..3) */</span>
		<span class="n">u8</span> <span class="n">llv</span><span class="p">;</span>       <span class="cm">/* status led brightness no button (1..127) */</span>
		<span class="n">u8</span> <span class="n">hlv</span><span class="p">;</span>       <span class="cm">/* status led brightness button pressed (1..127) */</span>
		<span class="n">u8</span> <span class="n">img_lum</span><span class="p">;</span>   <span class="cm">/* OLED matrix display brightness */</span>
	<span class="p">}</span> <span class="n">led</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">power_supply</span> <span class="n">battery</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">wacom_schedule_work</span><span class="p">(</span><span class="k">struct</span> <span class="n">wacom_wac</span> <span class="o">*</span><span class="n">wacom_wac</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">wacom</span> <span class="o">*</span><span class="n">wacom</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">wacom_wac</span><span class="p">,</span> <span class="k">struct</span> <span class="n">wacom</span><span class="p">,</span> <span class="n">wacom_wac</span><span class="p">);</span>
	<span class="n">schedule_work</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wacom</span><span class="o">-&gt;</span><span class="n">work</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="n">wacom_ids</span><span class="p">[];</span>

<span class="kt">void</span> <span class="n">wacom_wac_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">wacom_wac</span> <span class="o">*</span><span class="n">wacom_wac</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">wacom_setup_device_quirks</span><span class="p">(</span><span class="k">struct</span> <span class="n">wacom_features</span> <span class="o">*</span><span class="n">features</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">wacom_setup_input_capabilities</span><span class="p">(</span><span class="k">struct</span> <span class="n">input_dev</span> <span class="o">*</span><span class="n">input_dev</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">wacom_wac</span> <span class="o">*</span><span class="n">wacom_wac</span><span class="p">);</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
