<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › pcmcia › o2micro.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>o2micro.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * o2micro.h 1.13 1999/10/25 20:03:34</span>
<span class="cm"> *</span>
<span class="cm"> * The contents of this file are subject to the Mozilla Public License</span>
<span class="cm"> * Version 1.1 (the &quot;License&quot;); you may not use this file except in</span>
<span class="cm"> * compliance with the License. You may obtain a copy of the License</span>
<span class="cm"> * at http://www.mozilla.org/MPL/</span>
<span class="cm"> *</span>
<span class="cm"> * Software distributed under the License is distributed on an &quot;AS IS&quot;</span>
<span class="cm"> * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See</span>
<span class="cm"> * the License for the specific language governing rights and</span>
<span class="cm"> * limitations under the License. </span>
<span class="cm"> *</span>
<span class="cm"> * The initial developer of the original code is David A. Hinds</span>
<span class="cm"> * &lt;dahinds@users.sourceforge.net&gt;.  Portions created by David A. Hinds</span>
<span class="cm"> * are Copyright (C) 1999 David A. Hinds.  All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Alternatively, the contents of this file may be used under the</span>
<span class="cm"> * terms of the GNU General Public License version 2 (the &quot;GPL&quot;), in which</span>
<span class="cm"> * case the provisions of the GPL are applicable instead of the</span>
<span class="cm"> * above.  If you wish to allow the use of your version of this file</span>
<span class="cm"> * only under the terms of the GPL and not to allow others to use</span>
<span class="cm"> * your version of this file under the MPL, indicate your decision by</span>
<span class="cm"> * deleting the provisions above and replace them with the notice and</span>
<span class="cm"> * other provisions required by the GPL.  If you do not delete the</span>
<span class="cm"> * provisions above, a recipient may use your version of this file</span>
<span class="cm"> * under either the MPL or the GPL.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _LINUX_O2MICRO_H</span>
<span class="cp">#define _LINUX_O2MICRO_H</span>

<span class="cm">/* Additional PCI configuration registers */</span>

<span class="cp">#define O2_MUX_CONTROL		0x90	</span><span class="cm">/* 32 bit */</span><span class="cp"></span>
<span class="cp">#define  O2_MUX_RING_OUT	0x0000000f</span>
<span class="cp">#define  O2_MUX_SKTB_ACTV	0x000000f0</span>
<span class="cp">#define  O2_MUX_SCTA_ACTV_ENA	0x00000100</span>
<span class="cp">#define  O2_MUX_SCTB_ACTV_ENA	0x00000200</span>
<span class="cp">#define  O2_MUX_SER_IRQ_ROUTE	0x0000e000</span>
<span class="cp">#define  O2_MUX_SER_PCI		0x00010000</span>

<span class="cp">#define  O2_MUX_SKTA_TURBO	0x000c0000	</span><span class="cm">/* for 6833, 6860 */</span><span class="cp"></span>
<span class="cp">#define  O2_MUX_SKTB_TURBO	0x00300000</span>
<span class="cp">#define  O2_MUX_AUX_VCC_3V	0x00400000</span>
<span class="cp">#define  O2_MUX_PCI_VCC_5V	0x00800000</span>
<span class="cp">#define  O2_MUX_PME_MUX		0x0f000000</span>

<span class="cm">/* Additional ExCA registers */</span>

<span class="cp">#define O2_MODE_A		0x38</span>
<span class="cp">#define O2_MODE_A_2		0x26	</span><span class="cm">/* for 6833B, 6860C */</span><span class="cp"></span>
<span class="cp">#define  O2_MODE_A_CD_PULSE	0x04</span>
<span class="cp">#define  O2_MODE_A_SUSP_EDGE	0x08</span>
<span class="cp">#define  O2_MODE_A_HOST_SUSP	0x10</span>
<span class="cp">#define  O2_MODE_A_PWR_MASK	0x60</span>
<span class="cp">#define  O2_MODE_A_QUIET	0x80</span>

<span class="cp">#define O2_MODE_B		0x39</span>
<span class="cp">#define O2_MODE_B_2		0x2e	</span><span class="cm">/* for 6833B, 6860C */</span><span class="cp"></span>
<span class="cp">#define  O2_MODE_B_IDENT	0x03</span>
<span class="cp">#define  O2_MODE_B_ID_BSTEP	0x00</span>
<span class="cp">#define  O2_MODE_B_ID_CSTEP	0x01</span>
<span class="cp">#define  O2_MODE_B_ID_O2	0x02</span>
<span class="cp">#define  O2_MODE_B_VS1		0x04</span>
<span class="cp">#define  O2_MODE_B_VS2		0x08</span>
<span class="cp">#define  O2_MODE_B_IRQ15_RI	0x80</span>

<span class="cp">#define O2_MODE_C		0x3a</span>
<span class="cp">#define  O2_MODE_C_DREQ_MASK	0x03</span>
<span class="cp">#define  O2_MODE_C_DREQ_INPACK	0x01</span>
<span class="cp">#define  O2_MODE_C_DREQ_WP	0x02</span>
<span class="cp">#define  O2_MODE_C_DREQ_BVD2	0x03</span>
<span class="cp">#define  O2_MODE_C_ZVIDEO	0x08</span>
<span class="cp">#define  O2_MODE_C_IREQ_SEL	0x30</span>
<span class="cp">#define  O2_MODE_C_MGMT_SEL	0xc0</span>

<span class="cp">#define O2_MODE_D		0x3b</span>
<span class="cp">#define  O2_MODE_D_IRQ_MODE	0x03</span>
<span class="cp">#define  O2_MODE_D_PCI_CLKRUN	0x04</span>
<span class="cp">#define  O2_MODE_D_CB_CLKRUN	0x08</span>
<span class="cp">#define  O2_MODE_D_SKT_ACTV	0x20</span>
<span class="cp">#define  O2_MODE_D_PCI_FIFO	0x40	</span><span class="cm">/* for OZ6729, OZ6730 */</span><span class="cp"></span>
<span class="cp">#define  O2_MODE_D_W97_IRQ	0x40</span>
<span class="cp">#define  O2_MODE_D_ISA_IRQ	0x80</span>

<span class="cp">#define O2_MHPG_DMA		0x3c</span>
<span class="cp">#define  O2_MHPG_CHANNEL	0x07</span>
<span class="cp">#define  O2_MHPG_CINT_ENA	0x08</span>
<span class="cp">#define  O2_MHPG_CSC_ENA	0x10</span>

<span class="cp">#define O2_FIFO_ENA		0x3d</span>
<span class="cp">#define  O2_FIFO_ZVIDEO_3	0x08</span>
<span class="cp">#define  O2_FIFO_PCI_FIFO	0x10</span>
<span class="cp">#define  O2_FIFO_POSTWR		0x40</span>
<span class="cp">#define  O2_FIFO_BUFFER		0x80</span>

<span class="cp">#define O2_MODE_E		0x3e</span>
<span class="cp">#define  O2_MODE_E_MHPG_DMA	0x01</span>
<span class="cp">#define  O2_MODE_E_SPKR_OUT	0x02</span>
<span class="cp">#define  O2_MODE_E_LED_OUT	0x08</span>
<span class="cp">#define  O2_MODE_E_SKTA_ACTV	0x10</span>

<span class="cp">#define O2_RESERVED1		0x94</span>
<span class="cp">#define O2_RESERVED2		0xD4</span>
<span class="cp">#define O2_RES_READ_PREFETCH	0x02</span>
<span class="cp">#define O2_RES_WRITE_BURST	0x08</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">o2micro_override</span><span class="p">(</span><span class="k">struct</span> <span class="n">yenta_socket</span> <span class="o">*</span><span class="n">socket</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * &#39;reserved&#39; register at 0x94/D4. allows setting read prefetch and write</span>
<span class="cm">	 * bursting. read prefetching for example makes the RME Hammerfall DSP</span>
<span class="cm">	 * working. for some bridges it is at 0x94, for others at 0xD4. it&#39;s</span>
<span class="cm">	 * ok to write to both registers on all O2 bridges.</span>
<span class="cm">	 * from Eric Still, 02Micro.</span>
<span class="cm">	 */</span>
	<span class="n">u8</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">use_speedup</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">PCI_FUNC</span><span class="p">(</span><span class="n">socket</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">devfn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">a</span> <span class="o">=</span> <span class="n">config_readb</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">O2_RESERVED1</span><span class="p">);</span>
		<span class="n">b</span> <span class="o">=</span> <span class="n">config_readb</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">O2_RESERVED2</span><span class="p">);</span>
		<span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">socket</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;O2: 0x94/0xD4: %02x/%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">socket</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * older bridges have problems with both read prefetch and write</span>
<span class="cm">		 * bursting depending on the combination of the chipset, bridge</span>
<span class="cm">		 * and the cardbus card. so disable them to be on the safe side.</span>
<span class="cm">		 */</span>
		<span class="k">case</span> <span class="n">PCI_DEVICE_ID_O2_6729</span>:
		<span class="k">case</span> <span class="n">PCI_DEVICE_ID_O2_6730</span>:
		<span class="k">case</span> <span class="n">PCI_DEVICE_ID_O2_6812</span>:
		<span class="k">case</span> <span class="n">PCI_DEVICE_ID_O2_6832</span>:
		<span class="k">case</span> <span class="n">PCI_DEVICE_ID_O2_6836</span>:
		<span class="k">case</span> <span class="n">PCI_DEVICE_ID_O2_6933</span>:
			<span class="n">use_speedup</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">use_speedup</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="cm">/* the user may override our decision */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">o2_speedup</span><span class="p">,</span> <span class="s">&quot;on&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">use_speedup</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">o2_speedup</span><span class="p">,</span> <span class="s">&quot;off&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">use_speedup</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">strcasecmp</span><span class="p">(</span><span class="n">o2_speedup</span><span class="p">,</span> <span class="s">&quot;default&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">dev_warn</span><span class="p">(</span><span class="o">&amp;</span><span class="n">socket</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				<span class="s">&quot;O2: Unknown parameter, using &#39;default&#39;&quot;</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">use_speedup</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dev_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">socket</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				<span class="s">&quot;O2: enabling read prefetch/write burst. If you experience problems or performance issues, use the yenta_socket parameter &#39;o2_speedup=off&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">config_writeb</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">O2_RESERVED1</span><span class="p">,</span>
				      <span class="n">a</span> <span class="o">|</span> <span class="n">O2_RES_READ_PREFETCH</span> <span class="o">|</span> <span class="n">O2_RES_WRITE_BURST</span><span class="p">);</span>
			<span class="n">config_writeb</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">O2_RESERVED2</span><span class="p">,</span>
				      <span class="n">b</span> <span class="o">|</span> <span class="n">O2_RES_READ_PREFETCH</span> <span class="o">|</span> <span class="n">O2_RES_WRITE_BURST</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">dev_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">socket</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				<span class="s">&quot;O2: disabling read prefetch/write burst. If you experience problems or performance issues, use the yenta_socket parameter &#39;o2_speedup=on&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">config_writeb</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">O2_RESERVED1</span><span class="p">,</span>
				      <span class="n">a</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">O2_RES_READ_PREFETCH</span> <span class="o">|</span> <span class="n">O2_RES_WRITE_BURST</span><span class="p">));</span>
			<span class="n">config_writeb</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">O2_RESERVED2</span><span class="p">,</span>
				      <span class="n">b</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">O2_RES_READ_PREFETCH</span> <span class="o">|</span> <span class="n">O2_RES_WRITE_BURST</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">o2micro_restore_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">yenta_socket</span> <span class="o">*</span><span class="n">socket</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * as long as read prefetch is the only thing in</span>
<span class="cm">	 * o2micro_override, it&#39;s safe to call it from here</span>
<span class="cm">	 */</span>
	<span class="n">o2micro_override</span><span class="p">(</span><span class="n">socket</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* _LINUX_O2MICRO_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
