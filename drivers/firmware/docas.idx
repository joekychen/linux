f | edd.c | s | 19K | 700 | Michael Chan | mchan@broadcom.com | 1320053179 |  | [SCSI] edd: Treat "XPRS" host bus type the same as "PCI"  PCI Express devices will return "XPRS" host bus type during BIOS EDD call.  "XPRS" should be treated just like "PCI" so that the proper pci_dev symlink will be created.  Scripts such as fcoe_edd.sh will then work correctly.  Signed-off-by: Michael Chan <mchan@broadcom.com> Reviewed-by: Matt Domsch <Matt_Domsch@dell.com> Signed-off-by: Yi Zou <yi.zou@intel.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | Makefile | g | 498B |  | Lars-Peter Clausen | lars@metafoo.de | 1322568070 |  | ASoC: Move SigmaDSP firmware loader to ASoC  It has been pointed out previously, that the firmware subsystem is not the right place for the SigmaDSP firmware loader. Furthermore the SigmaDSP is currently only used in audio products and we are aiming for better integration into the ASoC framework in the future, with support for ALSA controls for firmware parameters and support dynamic power management as well. So the natural choice for the SigmaDSP firmware loader is the ASoC subsystem.  Signed-off-by: Lars-Peter Clausen <lars@metafoo.de> Acked-by: Mike Frysinger <vapier@gentoo.org> Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com>
f | dmi-id.c | s | 6.5K | 203 | Axel Lin | axel.lin@gmail.com | 1281041614 |  | dmi-id: fix a memory leak in dmi_id_init error path  This patch adds a missing kfree(dmi_dev) in dmi_id_init error path.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Tejun Heo <tj@kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | memmap.c | s | 7.1K | 212 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
d | google |  | 4 items |  | Maxin B. John | maxin.john@gmail.com | 1323476629 |  | firmware: google: fix gsmi.c build warning  Use min_t() macro instead of min() to fix a build warning:    CC      drivers/firmware/google/gsmi.o drivers/firmware/google/gsmi.c: In function ‘gsmi_get_variable’: drivers/firmware/google/gsmi.c:348: warning: comparison of distinct pointer types lacks a cast  Signed-off-by: Maxin B. John <maxin.john@gmail.com> Acked-By: Mike Waychison <mikew@google.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | dmi_scan.c | s | 17K | 639 | Jean Delvare | khali@linux-fr.org | 1321404111 |  | drivers/firmware/dmi_scan.c: make dmi_name_in_vendors more focused  The current implementation of dmi_name_in_vendors() is an invitation to lazy coding and false positives [1].  Searching for a string in 8 know what you're looking for, so you should know where to look.  strstr isn't fast, especially when it fails, so we should avoid calling it when it just can't succeed.  Looking at the current users of the function, it seems clear to me that they are looking for a system or board vendor name, so let's limit dmi_name_in_vendors to these two DMI fields.  This much better matches the function name, BTW.  [1] We currently have code looking for short names in DMI data, such as "IBM", "ASUS" or "Acer".  I let you guess what will happen the day other vendors ship products named, for example, "SCHREIBMEISTER", "PEGASUS" or "Acerola".  Signed-off-by: Jean Delvare <khali@linux-fr.org> Cc: Andi Kleen <andi@firstfloor.org> Cc: Jesse Barnes <jbarnes@virtuousgeek.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | dcdbas.h | s | 2.8K | 87 | Matthew Garrett | mjg59@srcf.ucam.org | 1231432272 |  | dcdbas: export functionality for use in other drivers  The dcdbas code allows calls to be made into the firmware on Dell systems.  Exporting this to other drivers allows them to implement Dell-specific functionality in a safe way.  Signed-off-by: Matthew Garrett <mjg@redhat.com> Cc: Matt Domsch <Matt_Domsch@dell.com> Cc: Greg KH <greg@kroah.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | pcdp.c | s | 3.3K | 116 | Matthew Wilcox | matthew@wil.cx | 1245256429 |  | [IA64] Convert ia64 to use int-ll64.h  It is generally agreed that it would be beneficial for u64 to be an unsigned long long on all architectures.  ia64 (in common with several other 64-bit architectures) currently uses unsigned long.  Migrating piecemeal is too painful; this giant patch fixes all compilation warnings and errors that come as a result of switching to use int-ll64.h.  Note that userspace will still see __u64 defined as unsigned long.  This is important as it affects C++ name mangling.  [Updated by Tony Luck to change efi.h:efi_freemem_callback_t to use  u64 for start/end rather than unsigned long]  Signed-off-by: Matthew Wilcox <willy@linux.intel.com> Signed-off-by: Tony Luck <tony.luck@intel.com>
f | iscsi_ibft_find.c | s | 2.8K | 100 | Yinghai Lu | yinghai.lu@oracle.com | 1323785311 |  | ibft: Fix finding IBFT ACPI table on UEFI  Found one system with UEFI/iBFT, kernel does not detect the iBFT during iscsi_ibft module loading.  Root cause: on x86 (UEFI), we are calling of find_ibft_region() much earlier - specifically in setup_arch() before ACPI is enabled.  Try to split acpi checking code out and call that later  At that time ACPI iBFT already get permanent mapped with ioremap. So isa_virt_to_bus() will get wrong phys from right virt address. We could just skip that phys address printing.  For legacy one, print the found address early.  -v2: update comments and description according to Konrad. -v3: fix problem about module use case that is found by Konrad. -v4: use acpi_get_table() instead of acpi_table_parse() to handle module use case that is found by Konrad again.. Signed-off-by: Yinghai Lu <yinghai@kernel.org> Signed-off-by: Konrad Rzeszutek Wilk <konrad@kernel.org>
f | dmi-sysfs.c | s | 16K | 584 | Mike Waychison | mikew@google.com | 1298679003 |  | firmware: Fix unaligned memory accesses in dmi-sysfs  DMI entries are arranged in memory back to back with no alignment guarantees. This means that the struct dmi_header passed to callbacks from dmi_walk() itself isn't byte aligned.  This causes problems on architectures that expect aligned data, such as IA64.  The dmi-sysfs patchset introduced structure member accesses through this passed in dmi_header.  Fix this by memcpy()ing the structures to temporary locations on stack when inspecting/copying them.  Signed-off-by: Mike Waychison <mikew@google.com> Tested-by: Tony Luck <tony.luck@intel.com> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | dcdbas.c | s | 15K | 559 | Stuart Hayes | stuart_hayes@yahoo.com | 1299069730 |  | dcdbas: force SMI to happen when expected  The dcdbas driver can do an I/O write to cause a SMI to occur.  The SMI handler looks at certain registers and memory locations, so the SMI needs to happen immediately.  On some systems I/O writes are posted, though, causing the SMI to happen well after the "outb" occurred, which causes random failures.  Following the "outb" with an "inb" forces the write to go through even if it is posted.  Signed-off-by: Stuart Hayes <stuart_hayes@yahoo.com> Acked-by: Doug Warzecha <douglas_warzecha@dell.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | pcdp.h | s | 2.7K | 99 | Justin P. Mattock | justinmattock@gmail.com | 1287392594 |  | Update broken web addresses in the kernel.  The patch below updates broken web addresses in the kernel  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Cc: Maciej W. Rozycki <macro@linux-mips.org> Cc: Geert Uytterhoeven <geert@linux-m68k.org> Cc: Finn Thain <fthain@telegraphics.com.au> Cc: Randy Dunlap <rdunlap@xenotime.net> Cc: Matt Turner <mattst88@gmail.com> Cc: Dimitry Torokhov <dmitry.torokhov@gmail.com> Cc: Mike Frysinger <vapier.adi@gmail.com> Acked-by: Ben Pfaff <blp@cs.stanford.edu> Acked-by: Hans J. Koch <hjk@linutronix.de> Reviewed-by: Finn Thain <fthain@telegraphics.com.au> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | efivars.c | s | 31K | 1065 | Matthew Garrett | mjg@redhat.com | 1336090759 |  | efivars: Improve variable validation  Ben Hutchings pointed out that the validation in efivars was inadequate - most obviously, an entry with size 0 would server as a DoS against the kernel. Improve this based on his suggestions.  Signed-off-by: Matthew Garrett <mjg@redhat.com> Cc: stable@vger.kernel.org Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | iscsi_ibft.c | s | 19K | 744 | Al Viro | viro@zeniv.linux.org.uk | 1325649295 |  | switch ->is_visible() to returning umode_t  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | Kconfig | g | 5.3K |  | Lars-Peter Clausen | lars@metafoo.de | 1322568070 |  | ASoC: Move SigmaDSP firmware loader to ASoC  It has been pointed out previously, that the firmware subsystem is not the right place for the SigmaDSP firmware loader. Furthermore the SigmaDSP is currently only used in audio products and we are aiming for better integration into the ASoC framework in the future, with support for ALSA controls for firmware parameters and support dynamic power management as well. So the natural choice for the SigmaDSP firmware loader is the ASoC subsystem.  Signed-off-by: Lars-Peter Clausen <lars@metafoo.de> Acked-by: Mike Frysinger <vapier@gentoo.org> Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com>
f | dell_rbu.c | s | 19K | 651 | Chris Wright | chrisw@sous-sol.org | 1274459851 |  | sysfs: add struct file* to bin_attr callbacks  This allows bin_attr->read,write,mmap callbacks to check file specific data (such as inode owner) as part of any privilege validation.  Signed-off-by: Chris Wright <chrisw@sous-sol.org> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
