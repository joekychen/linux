<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › mmc › host › atmel-mci-regs.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>atmel-mci-regs.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Atmel MultiMedia Card Interface driver</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2004-2006 Atmel Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Superset of MCI IP registers integrated in Atmel AVR32 and AT91 Processors</span>
<span class="cm"> * Registers and bitfields marked with [2] are only available in MCI2</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __DRIVERS_MMC_ATMEL_MCI_H__</span>
<span class="cp">#define __DRIVERS_MMC_ATMEL_MCI_H__</span>

<span class="cm">/* MCI Register Definitions */</span>
<span class="cp">#define ATMCI_CR			0x0000	</span><span class="cm">/* Control */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CR_MCIEN			(  1 &lt;&lt;  0)	</span><span class="cm">/* MCI Enable */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CR_MCIDIS		(  1 &lt;&lt;  1)	</span><span class="cm">/* MCI Disable */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CR_PWSEN			(  1 &lt;&lt;  2)	</span><span class="cm">/* Power Save Enable */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CR_PWSDIS		(  1 &lt;&lt;  3)	</span><span class="cm">/* Power Save Disable */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CR_SWRST			(  1 &lt;&lt;  7)	</span><span class="cm">/* Software Reset */</span><span class="cp"></span>
<span class="cp">#define ATMCI_MR			0x0004	</span><span class="cm">/* Mode */</span><span class="cp"></span>
<span class="cp"># define ATMCI_MR_CLKDIV(x)		((x) &lt;&lt;  0)	</span><span class="cm">/* Clock Divider */</span><span class="cp"></span>
<span class="cp"># define ATMCI_MR_PWSDIV(x)		((x) &lt;&lt;  8)	</span><span class="cm">/* Power Saving Divider */</span><span class="cp"></span>
<span class="cp"># define ATMCI_MR_RDPROOF		(  1 &lt;&lt; 11)	</span><span class="cm">/* Read Proof */</span><span class="cp"></span>
<span class="cp"># define ATMCI_MR_WRPROOF		(  1 &lt;&lt; 12)	</span><span class="cm">/* Write Proof */</span><span class="cp"></span>
<span class="cp"># define ATMCI_MR_PDCFBYTE		(  1 &lt;&lt; 13)	</span><span class="cm">/* Force Byte Transfer */</span><span class="cp"></span>
<span class="cp"># define ATMCI_MR_PDCPADV		(  1 &lt;&lt; 14)	</span><span class="cm">/* Padding Value */</span><span class="cp"></span>
<span class="cp"># define ATMCI_MR_PDCMODE		(  1 &lt;&lt; 15)	</span><span class="cm">/* PDC-oriented Mode */</span><span class="cp"></span>
<span class="cp"># define ATMCI_MR_CLKODD(x)		((x) &lt;&lt; 16)	</span><span class="cm">/* LSB of Clock Divider */</span><span class="cp"></span>
<span class="cp">#define ATMCI_DTOR			0x0008	</span><span class="cm">/* Data Timeout */</span><span class="cp"></span>
<span class="cp"># define ATMCI_DTOCYC(x)		((x) &lt;&lt;  0)	</span><span class="cm">/* Data Timeout Cycles */</span><span class="cp"></span>
<span class="cp"># define ATMCI_DTOMUL(x)		((x) &lt;&lt;  4)	</span><span class="cm">/* Data Timeout Multiplier */</span><span class="cp"></span>
<span class="cp">#define ATMCI_SDCR			0x000c	</span><span class="cm">/* SD Card / SDIO */</span><span class="cp"></span>
<span class="cp"># define ATMCI_SDCSEL_SLOT_A		(  0 &lt;&lt;  0)	</span><span class="cm">/* Select SD slot A */</span><span class="cp"></span>
<span class="cp"># define ATMCI_SDCSEL_SLOT_B		(  1 &lt;&lt;  0)	</span><span class="cm">/* Select SD slot A */</span><span class="cp"></span>
<span class="cp"># define ATMCI_SDCSEL_MASK		(  3 &lt;&lt;  0)</span>
<span class="cp"># define ATMCI_SDCBUS_1BIT		(  0 &lt;&lt;  6)	</span><span class="cm">/* 1-bit data bus */</span><span class="cp"></span>
<span class="cp"># define ATMCI_SDCBUS_4BIT		(  2 &lt;&lt;  6)	</span><span class="cm">/* 4-bit data bus */</span><span class="cp"></span>
<span class="cp"># define ATMCI_SDCBUS_8BIT		(  3 &lt;&lt;  6)	</span><span class="cm">/* 8-bit data bus[2] */</span><span class="cp"></span>
<span class="cp"># define ATMCI_SDCBUS_MASK		(  3 &lt;&lt;  6)</span>
<span class="cp">#define ATMCI_ARGR			0x0010	</span><span class="cm">/* Command Argument */</span><span class="cp"></span>
<span class="cp">#define ATMCI_CMDR			0x0014	</span><span class="cm">/* Command */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_CMDNB(x)		((x) &lt;&lt;  0)	</span><span class="cm">/* Command Opcode */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_RSPTYP_NONE		(  0 &lt;&lt;  6)	</span><span class="cm">/* No response */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_RSPTYP_48BIT	(  1 &lt;&lt;  6)	</span><span class="cm">/* 48-bit response */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_RSPTYP_136BIT	(  2 &lt;&lt;  6)	</span><span class="cm">/* 136-bit response */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_SPCMD_INIT		(  1 &lt;&lt;  8)	</span><span class="cm">/* Initialization command */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_SPCMD_SYNC		(  2 &lt;&lt;  8)	</span><span class="cm">/* Synchronized command */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_SPCMD_INT		(  4 &lt;&lt;  8)	</span><span class="cm">/* Interrupt command */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_SPCMD_INTRESP	(  5 &lt;&lt;  8)	</span><span class="cm">/* Interrupt response */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_OPDCMD		(  1 &lt;&lt; 11)	</span><span class="cm">/* Open Drain */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_MAXLAT_5CYC		(  0 &lt;&lt; 12)	</span><span class="cm">/* Max latency 5 cycles */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_MAXLAT_64CYC	(  1 &lt;&lt; 12)	</span><span class="cm">/* Max latency 64 cycles */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_START_XFER		(  1 &lt;&lt; 16)	</span><span class="cm">/* Start data transfer */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_STOP_XFER		(  2 &lt;&lt; 16)	</span><span class="cm">/* Stop data transfer */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_TRDIR_WRITE		(  0 &lt;&lt; 18)	</span><span class="cm">/* Write data */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_TRDIR_READ		(  1 &lt;&lt; 18)	</span><span class="cm">/* Read data */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_BLOCK		(  0 &lt;&lt; 19)	</span><span class="cm">/* Single-block transfer */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_MULTI_BLOCK		(  1 &lt;&lt; 19)	</span><span class="cm">/* Multi-block transfer */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_STREAM		(  2 &lt;&lt; 19)	</span><span class="cm">/* MMC Stream transfer */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_SDIO_BYTE		(  4 &lt;&lt; 19)	</span><span class="cm">/* SDIO Byte transfer */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_SDIO_BLOCK		(  5 &lt;&lt; 19)	</span><span class="cm">/* SDIO Block transfer */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_SDIO_SUSPEND	(  1 &lt;&lt; 24)	</span><span class="cm">/* SDIO Suspend Command */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDR_SDIO_RESUME		(  2 &lt;&lt; 24)	</span><span class="cm">/* SDIO Resume Command */</span><span class="cp"></span>
<span class="cp">#define ATMCI_BLKR			0x0018	</span><span class="cm">/* Block */</span><span class="cp"></span>
<span class="cp"># define ATMCI_BCNT(x)			((x) &lt;&lt;  0)	</span><span class="cm">/* Data Block Count */</span><span class="cp"></span>
<span class="cp"># define ATMCI_BLKLEN(x)		((x) &lt;&lt; 16)	</span><span class="cm">/* Data Block Length */</span><span class="cp"></span>
<span class="cp">#define ATMCI_CSTOR			0x001c	</span><span class="cm">/* Completion Signal Timeout[2] */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CSTOCYC(x)		((x) &lt;&lt;  0)	</span><span class="cm">/* CST cycles */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CSTOMUL(x)		((x) &lt;&lt;  4)	</span><span class="cm">/* CST multiplier */</span><span class="cp"></span>
<span class="cp">#define ATMCI_RSPR			0x0020	</span><span class="cm">/* Response 0 */</span><span class="cp"></span>
<span class="cp">#define ATMCI_RSPR1			0x0024	</span><span class="cm">/* Response 1 */</span><span class="cp"></span>
<span class="cp">#define ATMCI_RSPR2			0x0028	</span><span class="cm">/* Response 2 */</span><span class="cp"></span>
<span class="cp">#define ATMCI_RSPR3			0x002c	</span><span class="cm">/* Response 3 */</span><span class="cp"></span>
<span class="cp">#define ATMCI_RDR			0x0030	</span><span class="cm">/* Receive Data */</span><span class="cp"></span>
<span class="cp">#define ATMCI_TDR			0x0034	</span><span class="cm">/* Transmit Data */</span><span class="cp"></span>
<span class="cp">#define ATMCI_SR			0x0040	</span><span class="cm">/* Status */</span><span class="cp"></span>
<span class="cp">#define ATMCI_IER			0x0044	</span><span class="cm">/* Interrupt Enable */</span><span class="cp"></span>
<span class="cp">#define ATMCI_IDR			0x0048	</span><span class="cm">/* Interrupt Disable */</span><span class="cp"></span>
<span class="cp">#define ATMCI_IMR			0x004c	</span><span class="cm">/* Interrupt Mask */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CMDRDY			(  1 &lt;&lt;   0)	</span><span class="cm">/* Command Ready */</span><span class="cp"></span>
<span class="cp"># define ATMCI_RXRDY			(  1 &lt;&lt;   1)	</span><span class="cm">/* Receiver Ready */</span><span class="cp"></span>
<span class="cp"># define ATMCI_TXRDY			(  1 &lt;&lt;   2)	</span><span class="cm">/* Transmitter Ready */</span><span class="cp"></span>
<span class="cp"># define ATMCI_BLKE			(  1 &lt;&lt;   3)	</span><span class="cm">/* Data Block Ended */</span><span class="cp"></span>
<span class="cp"># define ATMCI_DTIP			(  1 &lt;&lt;   4)	</span><span class="cm">/* Data Transfer In Progress */</span><span class="cp"></span>
<span class="cp"># define ATMCI_NOTBUSY			(  1 &lt;&lt;   5)	</span><span class="cm">/* Data Not Busy */</span><span class="cp"></span>
<span class="cp"># define ATMCI_ENDRX			(  1 &lt;&lt;   6)    </span><span class="cm">/* End of RX Buffer */</span><span class="cp"></span>
<span class="cp"># define ATMCI_ENDTX			(  1 &lt;&lt;   7)    </span><span class="cm">/* End of TX Buffer */</span><span class="cp"></span>
<span class="cp"># define ATMCI_SDIOIRQA			(  1 &lt;&lt;   8)	</span><span class="cm">/* SDIO IRQ in slot A */</span><span class="cp"></span>
<span class="cp"># define ATMCI_SDIOIRQB			(  1 &lt;&lt;   9)	</span><span class="cm">/* SDIO IRQ in slot B */</span><span class="cp"></span>
<span class="cp"># define ATMCI_SDIOWAIT			(  1 &lt;&lt;  12)    </span><span class="cm">/* SDIO Read Wait Operation Status */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CSRCV			(  1 &lt;&lt;  13)    </span><span class="cm">/* CE-ATA Completion Signal Received */</span><span class="cp"></span>
<span class="cp"># define ATMCI_RXBUFF			(  1 &lt;&lt;  14)    </span><span class="cm">/* RX Buffer Full */</span><span class="cp"></span>
<span class="cp"># define ATMCI_TXBUFE			(  1 &lt;&lt;  15)    </span><span class="cm">/* TX Buffer Empty */</span><span class="cp"></span>
<span class="cp"># define ATMCI_RINDE			(  1 &lt;&lt;  16)	</span><span class="cm">/* Response Index Error */</span><span class="cp"></span>
<span class="cp"># define ATMCI_RDIRE			(  1 &lt;&lt;  17)	</span><span class="cm">/* Response Direction Error */</span><span class="cp"></span>
<span class="cp"># define ATMCI_RCRCE			(  1 &lt;&lt;  18)	</span><span class="cm">/* Response CRC Error */</span><span class="cp"></span>
<span class="cp"># define ATMCI_RENDE			(  1 &lt;&lt;  19)	</span><span class="cm">/* Response End Bit Error */</span><span class="cp"></span>
<span class="cp"># define ATMCI_RTOE			(  1 &lt;&lt;  20)	</span><span class="cm">/* Response Time-Out Error */</span><span class="cp"></span>
<span class="cp"># define ATMCI_DCRCE			(  1 &lt;&lt;  21)	</span><span class="cm">/* Data CRC Error */</span><span class="cp"></span>
<span class="cp"># define ATMCI_DTOE			(  1 &lt;&lt;  22)	</span><span class="cm">/* Data Time-Out Error */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CSTOE			(  1 &lt;&lt;  23)    </span><span class="cm">/* Completion Signal Time-out Error */</span><span class="cp"></span>
<span class="cp"># define ATMCI_BLKOVRE			(  1 &lt;&lt;  24)    </span><span class="cm">/* DMA Block Overrun Error */</span><span class="cp"></span>
<span class="cp"># define ATMCI_DMADONE			(  1 &lt;&lt;  25)    </span><span class="cm">/* DMA Transfer Done */</span><span class="cp"></span>
<span class="cp"># define ATMCI_FIFOEMPTY		(  1 &lt;&lt;  26)    </span><span class="cm">/* FIFO Empty Flag */</span><span class="cp"></span>
<span class="cp"># define ATMCI_XFRDONE			(  1 &lt;&lt;  27)    </span><span class="cm">/* Transfer Done Flag */</span><span class="cp"></span>
<span class="cp"># define ATMCI_ACKRCV			(  1 &lt;&lt;  28)    </span><span class="cm">/* Boot Operation Acknowledge Received */</span><span class="cp"></span>
<span class="cp"># define ATMCI_ACKRCVE			(  1 &lt;&lt;  29)    </span><span class="cm">/* Boot Operation Acknowledge Error */</span><span class="cp"></span>
<span class="cp"># define ATMCI_OVRE			(  1 &lt;&lt;  30)	</span><span class="cm">/* RX Overrun Error */</span><span class="cp"></span>
<span class="cp"># define ATMCI_UNRE			(  1 &lt;&lt;  31)	</span><span class="cm">/* TX Underrun Error */</span><span class="cp"></span>
<span class="cp">#define ATMCI_DMA			0x0050	</span><span class="cm">/* DMA Configuration[2] */</span><span class="cp"></span>
<span class="cp"># define ATMCI_DMA_OFFSET(x)		((x) &lt;&lt;  0)	</span><span class="cm">/* DMA Write Buffer Offset */</span><span class="cp"></span>
<span class="cp"># define ATMCI_DMA_CHKSIZE(x)		((x) &lt;&lt;  4)	</span><span class="cm">/* DMA Channel Read and Write Chunk Size */</span><span class="cp"></span>
<span class="cp"># define ATMCI_DMAEN			(  1 &lt;&lt;  8)	</span><span class="cm">/* DMA Hardware Handshaking Enable */</span><span class="cp"></span>
<span class="cp">#define ATMCI_CFG			0x0054	</span><span class="cm">/* Configuration[2] */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CFG_FIFOMODE_1DATA	(  1 &lt;&lt;  0)	</span><span class="cm">/* MCI Internal FIFO control mode */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CFG_FERRCTRL_COR		(  1 &lt;&lt;  4)	</span><span class="cm">/* Flow Error flag reset control mode */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CFG_HSMODE		(  1 &lt;&lt;  8)	</span><span class="cm">/* High Speed Mode */</span><span class="cp"></span>
<span class="cp"># define ATMCI_CFG_LSYNC		(  1 &lt;&lt; 12)	</span><span class="cm">/* Synchronize on the last block */</span><span class="cp"></span>
<span class="cp">#define ATMCI_WPMR			0x00e4	</span><span class="cm">/* Write Protection Mode[2] */</span><span class="cp"></span>
<span class="cp"># define ATMCI_WP_EN			(  1 &lt;&lt;  0)	</span><span class="cm">/* WP Enable */</span><span class="cp"></span>
<span class="cp"># define ATMCI_WP_KEY			(0x4d4349 &lt;&lt; 8)	</span><span class="cm">/* WP Key */</span><span class="cp"></span>
<span class="cp">#define ATMCI_WPSR			0x00e8	</span><span class="cm">/* Write Protection Status[2] */</span><span class="cp"></span>
<span class="cp"># define ATMCI_GET_WP_VS(x)		((x) &amp; 0x0f)</span>
<span class="cp"># define ATMCI_GET_WP_VSRC(x)		(((x) &gt;&gt; 8) &amp; 0xffff)</span>
<span class="cp">#define ATMCI_VERSION			0x00FC  </span><span class="cm">/* Version */</span><span class="cp"></span>
<span class="cp">#define ATMCI_FIFO_APERTURE		0x0200	</span><span class="cm">/* FIFO Aperture[2] */</span><span class="cp"></span>

<span class="cm">/* This is not including the FIFO Aperture on MCI2 */</span>
<span class="cp">#define ATMCI_REGS_SIZE		0x100</span>

<span class="cm">/* Register access macros */</span>
<span class="cp">#define atmci_readl(port,reg)				\</span>
<span class="cp">	__raw_readl((port)-&gt;regs + reg)</span>
<span class="cp">#define atmci_writel(port,reg,value)			\</span>
<span class="cp">	__raw_writel((value), (port)-&gt;regs + reg)</span>

<span class="cm">/*</span>
<span class="cm"> * Fix sconfig&#39;s burst size according to atmel MCI. We need to convert them as:</span>
<span class="cm"> * 1 -&gt; 0, 4 -&gt; 1, 8 -&gt; 2, 16 -&gt; 3.</span>
<span class="cm"> *</span>
<span class="cm"> * This can be done by finding most significant bit set.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">atmci_convert_chksize</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">maxburst</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">maxburst</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">fls</span><span class="p">(</span><span class="n">maxburst</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* __DRIVERS_MMC_ATMEL_MCI_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
