<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › atm › midway.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>midway.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* drivers/atm/midway.h - Efficient Networks Midway (SAR) description */</span>
 
<span class="cm">/* Written 1995-1999 by Werner Almesberger, EPFL LRC/ICA */</span>
 

<span class="cp">#ifndef DRIVERS_ATM_MIDWAY_H</span>
<span class="cp">#define DRIVERS_ATM_MIDWAY_H</span>


<span class="cp">#define NR_VCI		1024		</span><span class="cm">/* number of VCIs */</span><span class="cp"></span>
<span class="cp">#define NR_VCI_LD	10		</span><span class="cm">/* log2(NR_VCI) */</span><span class="cp"></span>
<span class="cp">#define NR_DMA_RX	512		</span><span class="cm">/* RX DMA queue entries */</span><span class="cp"></span>
<span class="cp">#define NR_DMA_TX	512		</span><span class="cm">/* TX DMA queue entries */</span><span class="cp"></span>
<span class="cp">#define NR_SERVICE	NR_VCI		</span><span class="cm">/* service list size */</span><span class="cp"></span>
<span class="cp">#define NR_CHAN		8		</span><span class="cm">/* number of TX channels */</span><span class="cp"></span>
<span class="cp">#define TS_CLOCK	25000000	</span><span class="cm">/* traffic shaper clock (cell/sec) */</span><span class="cp"></span>

<span class="cp">#define MAP_MAX_SIZE	0x00400000	</span><span class="cm">/* memory window for max config */</span><span class="cp"></span>
<span class="cp">#define EPROM_SIZE	0x00010000</span>
<span class="cp">#define	MEM_VALID	0xffc00000	</span><span class="cm">/* mask base address with this */</span><span class="cp"></span>
<span class="cp">#define PHY_BASE	0x00020000	</span><span class="cm">/* offset of PHY register are */</span><span class="cp"></span>
<span class="cp">#define REG_BASE	0x00040000	</span><span class="cm">/* offset of Midway register area */</span><span class="cp"></span>
<span class="cp">#define RAM_BASE	0x00200000	</span><span class="cm">/* offset of RAM area */</span><span class="cp"></span>
<span class="cp">#define RAM_INCREMENT	0x00020000	</span><span class="cm">/* probe for RAM every 128kB */</span><span class="cp"></span>

<span class="cp">#define MID_VCI_BASE	RAM_BASE</span>
<span class="cp">#define MID_DMA_RX_BASE	(MID_VCI_BASE+NR_VCI*16)</span>
<span class="cp">#define MID_DMA_TX_BASE	(MID_DMA_RX_BASE+NR_DMA_RX*8)</span>
<span class="cp">#define MID_SERVICE_BASE (MID_DMA_TX_BASE+NR_DMA_TX*8)</span>
<span class="cp">#define MID_FREE_BASE	(MID_SERVICE_BASE+NR_SERVICE*4)</span>

<span class="cp">#define MAC_LEN 6 </span><span class="cm">/* atm.h */</span><span class="cp"></span>

<span class="cp">#define MID_MIN_BUF_SIZE (1024)		</span><span class="cm">/*   1 kB is minimum */</span><span class="cp"></span>
<span class="cp">#define MID_MAX_BUF_SIZE (128*1024)	</span><span class="cm">/* 128 kB is maximum */</span><span class="cp"></span>

<span class="cp">#define RX_DESCR_SIZE	1		</span><span class="cm">/* RX PDU descr is 1 longword */</span><span class="cp"></span>
<span class="cp">#define TX_DESCR_SIZE	2		</span><span class="cm">/* TX PDU descr is 2 longwords */</span><span class="cp"></span>
<span class="cp">#define AAL5_TRAILER	(ATM_AAL5_TRAILER/4) </span><span class="cm">/* AAL5 trailer is 2 longwords */</span><span class="cp"></span>

<span class="cp">#define TX_GAP		8		</span><span class="cm">/* TX buffer gap (words) */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Midway Reset/ID</span>
<span class="cm"> *</span>
<span class="cm"> * All values read-only. Writing to this register resets Midway chip.</span>
<span class="cm"> */</span>

<span class="cp">#define MID_RES_ID_MCON	0x00		</span><span class="cm">/* Midway Reset/ID */</span><span class="cp"></span>

<span class="cp">#define MID_ID		0xf0000000	</span><span class="cm">/* Midway version */</span><span class="cp"></span>
<span class="cp">#define MID_SHIFT	24</span>
<span class="cp">#define MID_MOTHER_ID	0x00000700	</span><span class="cm">/* mother board id */</span><span class="cp"></span>
<span class="cp">#define MID_MOTHER_SHIFT 8</span>
<span class="cp">#define MID_CON_TI	0x00000080	</span><span class="cm">/* 0: normal ctrl; 1: SABRE */</span><span class="cp"></span>
<span class="cp">#define MID_CON_SUNI	0x00000040	</span><span class="cm">/* 0: UTOPIA; 1: SUNI */</span><span class="cp"></span>
<span class="cp">#define MID_CON_V6	0x00000020	</span><span class="cm">/* 0: non-pipel UTOPIA (required iff</span>
<span class="cm">					   !CON_SUNI; 1: UTOPIA */</span><span class="cp"></span>
<span class="cp">#define DAUGTHER_ID	0x0000001f	</span><span class="cm">/* daugther board id */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Interrupt Status Acknowledge, Interrupt Status &amp; Interrupt Enable</span>
<span class="cm"> */</span>

<span class="cp">#define MID_ISA		0x01		</span><span class="cm">/* Interrupt Status Acknowledge */</span><span class="cp"></span>
<span class="cp">#define MID_IS		0x02		</span><span class="cm">/* Interrupt Status */</span><span class="cp"></span>
<span class="cp">#define MID_IE		0x03		</span><span class="cm">/* Interrupt Enable */</span><span class="cp"></span>

<span class="cp">#define MID_TX_COMPLETE_7 0x00010000	</span><span class="cm">/* channel N completed a PDU */</span><span class="cp"></span>
<span class="cp">#define MID_TX_COMPLETE_6 0x00008000	</span><span class="cm">/* transmission */</span><span class="cp"></span>
<span class="cp">#define MID_TX_COMPLETE_5 0x00004000</span>
<span class="cp">#define MID_TX_COMPLETE_4 0x00002000</span>
<span class="cp">#define MID_TX_COMPLETE_3 0x00001000</span>
<span class="cp">#define MID_TX_COMPLETE_2 0x00000800</span>
<span class="cp">#define MID_TX_COMPLETE_1 0x00000400</span>
<span class="cp">#define MID_TX_COMPLETE_0 0x00000200</span>
<span class="cp">#define MID_TX_COMPLETE	0x0001fe00	</span><span class="cm">/* any TX */</span><span class="cp"></span>
<span class="cp">#define MID_TX_DMA_OVFL	0x00000100	</span><span class="cm">/* DMA to adapter overflow */</span><span class="cp"></span>
<span class="cp">#define MID_TX_IDENT_MISM 0x00000080	</span><span class="cm">/* TX: ident mismatch =&gt; halted */</span><span class="cp"></span>
<span class="cp">#define MID_DMA_LERR_ACK 0x00000040	</span><span class="cm">/* LERR - SBus ? */</span><span class="cp"></span>
<span class="cp">#define MID_DMA_ERR_ACK	0x00000020	</span><span class="cm">/* DMA error */</span><span class="cp"></span>
<span class="cp">#define	MID_RX_DMA_COMPLETE 0x00000010	</span><span class="cm">/* DMA to host done */</span><span class="cp"></span>
<span class="cp">#define MID_TX_DMA_COMPLETE 0x00000008	</span><span class="cm">/* DMA from host done */</span><span class="cp"></span>
<span class="cp">#define MID_SERVICE	0x00000004	</span><span class="cm">/* something in service list */</span><span class="cp"></span>
<span class="cp">#define MID_SUNI_INT	0x00000002	</span><span class="cm">/* interrupt from SUNI */</span><span class="cp"></span>
<span class="cp">#define MID_STAT_OVFL	0x00000001	</span><span class="cm">/* statistics overflow */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Master Control/Status</span>
<span class="cm"> */</span>

<span class="cp">#define MID_MC_S	0x04</span>

<span class="cp">#define MID_INT_SELECT	0x000001C0	</span><span class="cm">/* Interrupt level (000: off) */</span><span class="cp"></span>
<span class="cp">#define MID_INT_SEL_SHIFT 6</span>
<span class="cp">#define	MID_TX_LOCK_MODE 0x00000020	</span><span class="cm">/* 0: streaming; 1: TX ovfl-&gt;lock */</span><span class="cp"></span>
<span class="cp">#define MID_DMA_ENABLE	0x00000010	</span><span class="cm">/* R: 0: disable; 1: enable</span>
<span class="cm">					   W: 0: no change; 1: enable */</span><span class="cp"></span>
<span class="cp">#define MID_TX_ENABLE	0x00000008	</span><span class="cm">/* R: 0: TX disabled; 1: enabled</span>
<span class="cm">					   W: 0: no change; 1: enable */</span><span class="cp"></span>
<span class="cp">#define MID_RX_ENABLE	0x00000004	</span><span class="cm">/* like TX */</span><span class="cp"></span>
<span class="cp">#define MID_WAIT_1MS	0x00000002	</span><span class="cm">/* R: 0: timer not running; 1: running</span>
<span class="cm">					   W: 0: no change; 1: no interrupts</span>
<span class="cm">							       for 1 ms */</span><span class="cp"></span>
<span class="cp">#define MID_WAIT_500US	0x00000001	</span><span class="cm">/* like WAIT_1MS, but 0.5 ms */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Statistics</span>
<span class="cm"> *</span>
<span class="cm"> * Cleared when reading.</span>
<span class="cm"> */</span>

<span class="cp">#define MID_STAT		0x05</span>

<span class="cp">#define MID_VCI_TRASH	0xFFFF0000	</span><span class="cm">/* trashed cells because of VCI mode */</span><span class="cp"></span>
<span class="cp">#define MID_VCI_TRASH_SHIFT 16</span>
<span class="cp">#define MID_OVFL_TRASH	0x0000FFFF	</span><span class="cm">/* trashed cells because of overflow */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Address registers</span>
<span class="cm"> */</span>

<span class="cp">#define MID_SERV_WRITE	0x06	</span><span class="cm">/* free pos in service area (R, 10 bits) */</span><span class="cp"></span>
<span class="cp">#define MID_DMA_ADDR	0x07	</span><span class="cm">/* virtual DMA address (R, 32 bits) */</span><span class="cp"></span>
<span class="cp">#define MID_DMA_WR_RX	0x08	</span><span class="cm">/* (RW, 9 bits) */</span><span class="cp"></span>
<span class="cp">#define MID_DMA_RD_RX	0x09</span>
<span class="cp">#define MID_DMA_WR_TX	0x0A</span>
<span class="cp">#define MID_DMA_RD_TX	0x0B</span>

<span class="cm">/*</span>
<span class="cm"> * Transmit Place Registers (0x10+4*channel)</span>
<span class="cm"> */</span>

<span class="cp">#define MID_TX_PLACE(c)	(0x10+4*(c))</span>

<span class="cp">#define MID_SIZE	0x00003800	</span><span class="cm">/* size, N*256 x 32 bit */</span><span class="cp"></span>
<span class="cp">#define MID_SIZE_SHIFT	11</span>
<span class="cp">#define MID_LOCATION	0x000007FF	</span><span class="cm">/* location in adapter memory (word) */</span><span class="cp"></span>

<span class="cp">#define MID_LOC_SKIP	8		</span><span class="cm">/* 8 bits of location are always zero</span>
<span class="cm">					   (applies to all uses of location) */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Transmit ReadPtr Registers (0x11+4*channel)</span>
<span class="cm"> */</span>

<span class="cp">#define MID_TX_RDPTR(c)	(0x11+4*(c))</span>

<span class="cp">#define MID_READ_PTR	0x00007FFF	</span><span class="cm">/* next word for PHY */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Transmit DescrStart Registers (0x12+4*channel)</span>
<span class="cm"> */</span>

<span class="cp">#define MID_TX_DESCRSTART(c) (0x12+4*(c))</span>

<span class="cp">#define MID_DESCR_START	0x00007FFF	</span><span class="cm">/* seg buffer being DMAed */</span><span class="cp"></span>

<span class="cp">#define ENI155_MAGIC	0xa54b872d</span>

<span class="k">struct</span> <span class="n">midway_eprom</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">mac</span><span class="p">[</span><span class="n">MAC_LEN</span><span class="p">],</span><span class="n">inv_mac</span><span class="p">[</span><span class="n">MAC_LEN</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pad</span><span class="p">[</span><span class="mi">36</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">serial</span><span class="p">,</span><span class="n">inv_serial</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">magic</span><span class="p">,</span><span class="n">inv_magic</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * VCI table entry</span>
<span class="cm"> */</span>

<span class="cp">#define MID_VCI_IN_SERVICE	0x00000001	</span><span class="cm">/* set if VCI is currently in</span>
<span class="cm">						   service list */</span><span class="cp"></span>
<span class="cp">#define MID_VCI_SIZE		0x00038000	</span><span class="cm">/* reassembly buffer size,</span>
<span class="cm">						   2*&lt;size&gt; kB */</span><span class="cp"></span>
<span class="cp">#define MID_VCI_SIZE_SHIFT	15</span>
<span class="cp">#define MID_VCI_LOCATION	0x1ffc0000	</span><span class="cm">/* buffer location */</span><span class="cp"></span>
<span class="cp">#define MID_VCI_LOCATION_SHIFT	18</span>
<span class="cp">#define MID_VCI_PTI_MODE	0x20000000	</span><span class="cm">/* 0: trash, 1: preserve */</span><span class="cp"></span>
<span class="cp">#define MID_VCI_MODE		0xc0000000</span>
<span class="cp">#define MID_VCI_MODE_SHIFT	30</span>
<span class="cp">#define MID_VCI_READ		0x00007fff</span>
<span class="cp">#define MID_VCI_READ_SHIFT	0</span>
<span class="cp">#define MID_VCI_DESCR		0x7fff0000</span>
<span class="cp">#define MID_VCI_DESCR_SHIFT	16</span>
<span class="cp">#define MID_VCI_COUNT		0x000007ff</span>
<span class="cp">#define MID_VCI_COUNT_SHIFT	0</span>
<span class="cp">#define MID_VCI_STATE		0x0000c000</span>
<span class="cp">#define MID_VCI_STATE_SHIFT	14</span>
<span class="cp">#define MID_VCI_WRITE		0x7fff0000</span>
<span class="cp">#define MID_VCI_WRITE_SHIFT	16</span>

<span class="cp">#define MID_MODE_TRASH	0</span>
<span class="cp">#define MID_MODE_RAW	1</span>
<span class="cp">#define MID_MODE_AAL5	2</span>

<span class="cm">/*</span>
<span class="cm"> * Reassembly buffer descriptor</span>
<span class="cm"> */</span>

<span class="cp">#define MID_RED_COUNT		0x000007ff</span>
<span class="cp">#define MID_RED_CRC_ERR		0x00000800</span>
<span class="cp">#define MID_RED_T		0x00001000</span>
<span class="cp">#define MID_RED_CE		0x00010000</span>
<span class="cp">#define MID_RED_CLP		0x01000000</span>
<span class="cp">#define MID_RED_IDEN		0xfe000000</span>
<span class="cp">#define MID_RED_SHIFT		25</span>

<span class="cp">#define MID_RED_RX_ID		0x1b		</span><span class="cm">/* constant identifier */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Segmentation buffer descriptor</span>
<span class="cm"> */</span>

<span class="cp">#define MID_SEG_COUNT		MID_RED_COUNT</span>
<span class="cp">#define MID_SEG_RATE		0x01f80000</span>
<span class="cp">#define MID_SEG_RATE_SHIFT	19</span>
<span class="cp">#define MID_SEG_PR		0x06000000</span>
<span class="cp">#define MID_SEG_PR_SHIFT	25</span>
<span class="cp">#define MID_SEG_AAL5		0x08000000</span>
<span class="cp">#define MID_SEG_ID		0xf0000000</span>
<span class="cp">#define MID_SEG_ID_SHIFT	28</span>
<span class="cp">#define MID_SEG_MAX_RATE	63</span>

<span class="cp">#define MID_SEG_CLP		0x00000001</span>
<span class="cp">#define MID_SEG_PTI		0x0000000e</span>
<span class="cp">#define MID_SEG_PTI_SHIFT	1</span>
<span class="cp">#define MID_SEG_VCI		0x00003ff0</span>
<span class="cp">#define MID_SEG_VCI_SHIFT	4</span>

<span class="cp">#define MID_SEG_TX_ID		0xb		</span><span class="cm">/* constant identifier */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * DMA entry</span>
<span class="cm"> */</span>

<span class="cp">#define MID_DMA_COUNT		0xffff0000</span>
<span class="cp">#define MID_DMA_COUNT_SHIFT	16</span>
<span class="cp">#define MID_DMA_END		0x00000020</span>
<span class="cp">#define MID_DMA_TYPE		0x0000000f</span>

<span class="cp">#define MID_DT_JK	0x3</span>
<span class="cp">#define MID_DT_WORD	0x0</span>
<span class="cp">#define MID_DT_2W	0x7</span>
<span class="cp">#define MID_DT_4W	0x4</span>
<span class="cp">#define MID_DT_8W	0x5</span>
<span class="cp">#define MID_DT_16W	0x6</span>
<span class="cp">#define MID_DT_2WM	0xf</span>
<span class="cp">#define MID_DT_4WM	0xc</span>
<span class="cp">#define MID_DT_8WM	0xd</span>
<span class="cp">#define MID_DT_16WM	0xe</span>

<span class="cm">/* only for RX*/</span>
<span class="cp">#define MID_DMA_VCI		0x0000ffc0</span>
<span class="cp">#define	MID_DMA_VCI_SHIFT	6</span>

<span class="cm">/* only for TX */</span>
<span class="cp">#define MID_DMA_CHAN		0x000001c0</span>
<span class="cp">#define MID_DMA_CHAN_SHIFT	6</span>

<span class="cp">#define MID_DT_BYTE	0x1</span>
<span class="cp">#define MID_DT_HWORD	0x2</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
