<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › qla2xxx › qla_def.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>qla_def.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * QLogic Fibre Channel HBA Driver</span>
<span class="cm"> * Copyright (c)  2003-2011 QLogic Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * See LICENSE.qla2xxx for copyright and licensing details.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __QLA_DEF_H</span>
<span class="cp">#define __QLA_DEF_H</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/dma-mapping.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/dmapool.h&gt;</span>
<span class="cp">#include &lt;linux/mempool.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/completion.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/workqueue.h&gt;</span>
<span class="cp">#include &lt;linux/firmware.h&gt;</span>
<span class="cp">#include &lt;linux/aer.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>

<span class="cp">#include &lt;scsi/scsi.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_host.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_device.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_cmnd.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_transport_fc.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_bsg_fc.h&gt;</span>

<span class="cp">#include &quot;qla_bsg.h&quot;</span>
<span class="cp">#include &quot;qla_nx.h&quot;</span>
<span class="cp">#define QLA2XXX_DRIVER_NAME	&quot;qla2xxx&quot;</span>
<span class="cp">#define QLA2XXX_APIDEV		&quot;ql2xapidev&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * We have MAILBOX_REGISTER_COUNT sized arrays in a few places,</span>
<span class="cm"> * but that&#39;s fine as we don&#39;t look at the last 24 ones for</span>
<span class="cm"> * ISP2100 HBAs.</span>
<span class="cm"> */</span>
<span class="cp">#define MAILBOX_REGISTER_COUNT_2100	8</span>
<span class="cp">#define MAILBOX_REGISTER_COUNT_2200	24</span>
<span class="cp">#define MAILBOX_REGISTER_COUNT		32</span>

<span class="cp">#define QLA2200A_RISC_ROM_VER	4</span>
<span class="cp">#define FPM_2300		6</span>
<span class="cp">#define FPM_2310		7</span>

<span class="cp">#include &quot;qla_settings.h&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * Data bit definitions</span>
<span class="cm"> */</span>
<span class="cp">#define BIT_0	0x1</span>
<span class="cp">#define BIT_1	0x2</span>
<span class="cp">#define BIT_2	0x4</span>
<span class="cp">#define BIT_3	0x8</span>
<span class="cp">#define BIT_4	0x10</span>
<span class="cp">#define BIT_5	0x20</span>
<span class="cp">#define BIT_6	0x40</span>
<span class="cp">#define BIT_7	0x80</span>
<span class="cp">#define BIT_8	0x100</span>
<span class="cp">#define BIT_9	0x200</span>
<span class="cp">#define BIT_10	0x400</span>
<span class="cp">#define BIT_11	0x800</span>
<span class="cp">#define BIT_12	0x1000</span>
<span class="cp">#define BIT_13	0x2000</span>
<span class="cp">#define BIT_14	0x4000</span>
<span class="cp">#define BIT_15	0x8000</span>
<span class="cp">#define BIT_16	0x10000</span>
<span class="cp">#define BIT_17	0x20000</span>
<span class="cp">#define BIT_18	0x40000</span>
<span class="cp">#define BIT_19	0x80000</span>
<span class="cp">#define BIT_20	0x100000</span>
<span class="cp">#define BIT_21	0x200000</span>
<span class="cp">#define BIT_22	0x400000</span>
<span class="cp">#define BIT_23	0x800000</span>
<span class="cp">#define BIT_24	0x1000000</span>
<span class="cp">#define BIT_25	0x2000000</span>
<span class="cp">#define BIT_26	0x4000000</span>
<span class="cp">#define BIT_27	0x8000000</span>
<span class="cp">#define BIT_28	0x10000000</span>
<span class="cp">#define BIT_29	0x20000000</span>
<span class="cp">#define BIT_30	0x40000000</span>
<span class="cp">#define BIT_31	0x80000000</span>

<span class="cp">#define LSB(x)	((uint8_t)(x))</span>
<span class="cp">#define MSB(x)	((uint8_t)((uint16_t)(x) &gt;&gt; 8))</span>

<span class="cp">#define LSW(x)	((uint16_t)(x))</span>
<span class="cp">#define MSW(x)	((uint16_t)((uint32_t)(x) &gt;&gt; 16))</span>

<span class="cp">#define LSD(x)	((uint32_t)((uint64_t)(x)))</span>
<span class="cp">#define MSD(x)	((uint32_t)((((uint64_t)(x)) &gt;&gt; 16) &gt;&gt; 16))</span>

<span class="cp">#define MAKE_HANDLE(x, y) ((uint32_t)((((uint32_t)(x)) &lt;&lt; 16) | (uint32_t)(y)))</span>

<span class="cm">/*</span>
<span class="cm"> * I/O register</span>
<span class="cm">*/</span>

<span class="cp">#define RD_REG_BYTE(addr)		readb(addr)</span>
<span class="cp">#define RD_REG_WORD(addr)		readw(addr)</span>
<span class="cp">#define RD_REG_DWORD(addr)		readl(addr)</span>
<span class="cp">#define RD_REG_BYTE_RELAXED(addr)	readb_relaxed(addr)</span>
<span class="cp">#define RD_REG_WORD_RELAXED(addr)	readw_relaxed(addr)</span>
<span class="cp">#define RD_REG_DWORD_RELAXED(addr)	readl_relaxed(addr)</span>
<span class="cp">#define WRT_REG_BYTE(addr, data)	writeb(data,addr)</span>
<span class="cp">#define WRT_REG_WORD(addr, data)	writew(data,addr)</span>
<span class="cp">#define WRT_REG_DWORD(addr, data)	writel(data,addr)</span>

<span class="cm">/*</span>
<span class="cm"> * The ISP2312 v2 chip cannot access the FLASH/GPIO registers via MMIO in an</span>
<span class="cm"> * 133Mhz slot.</span>
<span class="cm"> */</span>
<span class="cp">#define RD_REG_WORD_PIO(addr)		(inw((unsigned long)addr))</span>
<span class="cp">#define WRT_REG_WORD_PIO(addr, data)	(outw(data,(unsigned long)addr))</span>

<span class="cm">/*</span>
<span class="cm"> * Fibre Channel device definitions.</span>
<span class="cm"> */</span>
<span class="cp">#define WWN_SIZE		8	</span><span class="cm">/* Size of WWPN, WWN &amp; WWNN */</span><span class="cp"></span>
<span class="cp">#define MAX_FIBRE_DEVICES_2100	512</span>
<span class="cp">#define MAX_FIBRE_DEVICES_2400	2048</span>
<span class="cp">#define MAX_FIBRE_DEVICES_LOOP	128</span>
<span class="cp">#define MAX_FIBRE_DEVICES_MAX	MAX_FIBRE_DEVICES_2400</span>
<span class="cp">#define MAX_FIBRE_LUNS  	0xFFFF</span>
<span class="cp">#define	MAX_HOST_COUNT		16</span>

<span class="cm">/*</span>
<span class="cm"> * Host adapter default definitions.</span>
<span class="cm"> */</span>
<span class="cp">#define MAX_BUSES		1  </span><span class="cm">/* We only have one bus today */</span><span class="cp"></span>
<span class="cp">#define MIN_LUNS		8</span>
<span class="cp">#define MAX_LUNS		MAX_FIBRE_LUNS</span>
<span class="cp">#define MAX_CMDS_PER_LUN	255</span>

<span class="cm">/*</span>
<span class="cm"> * Fibre Channel device definitions.</span>
<span class="cm"> */</span>
<span class="cp">#define SNS_LAST_LOOP_ID_2100	0xfe</span>
<span class="cp">#define SNS_LAST_LOOP_ID_2300	0x7ff</span>

<span class="cp">#define LAST_LOCAL_LOOP_ID	0x7d</span>
<span class="cp">#define SNS_FL_PORT		0x7e</span>
<span class="cp">#define FABRIC_CONTROLLER	0x7f</span>
<span class="cp">#define SIMPLE_NAME_SERVER	0x80</span>
<span class="cp">#define SNS_FIRST_LOOP_ID	0x81</span>
<span class="cp">#define MANAGEMENT_SERVER	0xfe</span>
<span class="cp">#define BROADCAST		0xff</span>

<span class="cm">/*</span>
<span class="cm"> * There is no correspondence between an N-PORT id and an AL_PA.  Therefore the</span>
<span class="cm"> * valid range of an N-PORT id is 0 through 0x7ef.</span>
<span class="cm"> */</span>
<span class="cp">#define NPH_LAST_HANDLE		0x7ef</span>
<span class="cp">#define NPH_MGMT_SERVER		0x7fa		</span><span class="cm">/*  FFFFFA */</span><span class="cp"></span>
<span class="cp">#define NPH_SNS			0x7fc		</span><span class="cm">/*  FFFFFC */</span><span class="cp"></span>
<span class="cp">#define NPH_FABRIC_CONTROLLER	0x7fd		</span><span class="cm">/*  FFFFFD */</span><span class="cp"></span>
<span class="cp">#define NPH_F_PORT		0x7fe		</span><span class="cm">/*  FFFFFE */</span><span class="cp"></span>
<span class="cp">#define NPH_IP_BROADCAST	0x7ff		</span><span class="cm">/*  FFFFFF */</span><span class="cp"></span>

<span class="cp">#define MAX_CMDSZ	16		</span><span class="cm">/* SCSI maximum CDB size. */</span><span class="cp"></span>
<span class="cp">#include &quot;qla_fw.h&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * Timeout timer counts in seconds</span>
<span class="cm"> */</span>
<span class="cp">#define PORT_RETRY_TIME			1</span>
<span class="cp">#define LOOP_DOWN_TIMEOUT		60</span>
<span class="cp">#define LOOP_DOWN_TIME			255	</span><span class="cm">/* 240 */</span><span class="cp"></span>
<span class="cp">#define	LOOP_DOWN_RESET			(LOOP_DOWN_TIME - 30)</span>

<span class="cm">/* Maximum outstanding commands in ISP queues (1-65535) */</span>
<span class="cp">#define MAX_OUTSTANDING_COMMANDS	1024</span>

<span class="cm">/* ISP request and response entry counts (37-65535) */</span>
<span class="cp">#define REQUEST_ENTRY_CNT_2100		128	</span><span class="cm">/* Number of request entries. */</span><span class="cp"></span>
<span class="cp">#define REQUEST_ENTRY_CNT_2200		2048	</span><span class="cm">/* Number of request entries. */</span><span class="cp"></span>
<span class="cp">#define REQUEST_ENTRY_CNT_24XX		2048	</span><span class="cm">/* Number of request entries. */</span><span class="cp"></span>
<span class="cp">#define RESPONSE_ENTRY_CNT_2100		64	</span><span class="cm">/* Number of response entries.*/</span><span class="cp"></span>
<span class="cp">#define RESPONSE_ENTRY_CNT_2300		512	</span><span class="cm">/* Number of response entries.*/</span><span class="cp"></span>
<span class="cp">#define RESPONSE_ENTRY_CNT_MQ		128	</span><span class="cm">/* Number of response entries.*/</span><span class="cp"></span>
<span class="cp">#define ATIO_ENTRY_CNT_24XX		4096	</span><span class="cm">/* Number of ATIO entries. */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">req_que</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * (sd.h is not exported, hence local inclusion)</span>
<span class="cm"> * Data Integrity Field tuple.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sd_dif_tuple</span> <span class="p">{</span>
	<span class="n">__be16</span> <span class="n">guard_tag</span><span class="p">;</span>	<span class="cm">/* Checksum */</span>
	<span class="n">__be16</span> <span class="n">app_tag</span><span class="p">;</span>		<span class="cm">/* Opaque storage */</span>
	<span class="n">__be32</span> <span class="n">ref_tag</span><span class="p">;</span>		<span class="cm">/* Target LBA or indirect LBA */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * SCSI Request Block</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">srb_cmd</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">cmd</span><span class="p">;</span>		<span class="cm">/* Linux SCSI command pkt */</span>
	<span class="kt">uint32_t</span> <span class="n">request_sense_length</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="o">*</span><span class="n">request_sense_ptr</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">ctx</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * SRB flag definitions</span>
<span class="cm"> */</span>
<span class="cp">#define SRB_DMA_VALID			BIT_0	</span><span class="cm">/* Command sent to ISP */</span><span class="cp"></span>
<span class="cp">#define SRB_FCP_CMND_DMA_VALID		BIT_12	</span><span class="cm">/* DIF: DSD List valid */</span><span class="cp"></span>
<span class="cp">#define SRB_CRC_CTX_DMA_VALID		BIT_2	</span><span class="cm">/* DIF: context DMA valid */</span><span class="cp"></span>
<span class="cp">#define SRB_CRC_PROT_DMA_VALID		BIT_4	</span><span class="cm">/* DIF: prot DMA valid */</span><span class="cp"></span>
<span class="cp">#define SRB_CRC_CTX_DSD_VALID		BIT_5	</span><span class="cm">/* DIF: dsd_list valid */</span><span class="cp"></span>

<span class="cm">/* To identify if a srb is of T10-CRC type. @sp =&gt; srb_t pointer */</span>
<span class="cp">#define IS_PROT_IO(sp)	(sp-&gt;flags &amp; SRB_CRC_CTX_DSD_VALID)</span>

<span class="cm">/*</span>
<span class="cm"> * SRB extensions.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">srb_iocb</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint16_t</span> <span class="n">flags</span><span class="p">;</span>
<span class="cp">#define SRB_LOGIN_RETRIED	BIT_0</span>
<span class="cp">#define SRB_LOGIN_COND_PLOGI	BIT_1</span>
<span class="cp">#define SRB_LOGIN_SKIP_PRLI	BIT_2</span>
			<span class="kt">uint16_t</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">logio</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="cm">/*</span>
<span class="cm">			 * Values for flags field below are as</span>
<span class="cm">			 * defined in tsk_mgmt_entry struct</span>
<span class="cm">			 * for control_flags field in qla_fw.h.</span>
<span class="cm">			 */</span>
			<span class="kt">uint32_t</span> <span class="n">flags</span><span class="p">;</span>
			<span class="kt">uint32_t</span> <span class="n">lun</span><span class="p">;</span>
			<span class="kt">uint32_t</span> <span class="n">data</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">tmf</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">timer</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">timeout</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* Values for srb_ctx type */</span>
<span class="cp">#define SRB_LOGIN_CMD	1</span>
<span class="cp">#define SRB_LOGOUT_CMD	2</span>
<span class="cp">#define SRB_ELS_CMD_RPT 3</span>
<span class="cp">#define SRB_ELS_CMD_HST 4</span>
<span class="cp">#define SRB_CT_CMD	5</span>
<span class="cp">#define SRB_ADISC_CMD	6</span>
<span class="cp">#define SRB_TM_CMD	7</span>
<span class="cp">#define SRB_SCSI_CMD	8</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">srb</span> <span class="p">{</span>
	<span class="n">atomic_t</span> <span class="n">ref_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fc_port</span> <span class="o">*</span><span class="n">fcport</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">iocbs</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">srb_iocb</span> <span class="n">iocb_cmd</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">fc_bsg_job</span> <span class="o">*</span><span class="n">bsg_job</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">srb_cmd</span> <span class="n">scmd</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">done</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">free</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
<span class="p">}</span> <span class="n">srb_t</span><span class="p">;</span>

<span class="cp">#define GET_CMD_SP(sp) (sp-&gt;u.scmd.cmd)</span>
<span class="cp">#define SET_CMD_SP(sp, cmd) (sp-&gt;u.scmd.cmd = cmd)</span>
<span class="cp">#define GET_CMD_CTX_SP(sp) (sp-&gt;u.scmd.ctx)</span>

<span class="cp">#define GET_CMD_SENSE_LEN(sp) \</span>
<span class="cp">	(sp-&gt;u.scmd.request_sense_length)</span>
<span class="cp">#define SET_CMD_SENSE_LEN(sp, len) \</span>
<span class="cp">	(sp-&gt;u.scmd.request_sense_length = len)</span>
<span class="cp">#define GET_CMD_SENSE_PTR(sp) \</span>
<span class="cp">	(sp-&gt;u.scmd.request_sense_ptr)</span>
<span class="cp">#define SET_CMD_SENSE_PTR(sp, ptr) \</span>
<span class="cp">	(sp-&gt;u.scmd.request_sense_ptr = ptr)</span>

<span class="k">struct</span> <span class="n">msg_echo_lb</span> <span class="p">{</span>
	<span class="n">dma_addr_t</span> <span class="n">send_dma</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">rcv_dma</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">req_sg_cnt</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">rsp_sg_cnt</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">options</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">transfer_size</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * ISP I/O Register Set structure definitions.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">device_reg_2xxx</span> <span class="p">{</span>
	<span class="kt">uint16_t</span> <span class="n">flash_address</span><span class="p">;</span> 	<span class="cm">/* Flash BIOS address */</span>
	<span class="kt">uint16_t</span> <span class="n">flash_data</span><span class="p">;</span>		<span class="cm">/* Flash BIOS data */</span>
	<span class="kt">uint16_t</span> <span class="n">unused_1</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>		<span class="cm">/* Gap */</span>
	<span class="kt">uint16_t</span> <span class="n">ctrl_status</span><span class="p">;</span>		<span class="cm">/* Control/Status */</span>
<span class="cp">#define CSR_FLASH_64K_BANK	BIT_3	</span><span class="cm">/* Flash upper 64K bank select */</span><span class="cp"></span>
<span class="cp">#define CSR_FLASH_ENABLE	BIT_1	</span><span class="cm">/* Flash BIOS Read/Write enable */</span><span class="cp"></span>
<span class="cp">#define CSR_ISP_SOFT_RESET	BIT_0	</span><span class="cm">/* ISP soft reset */</span><span class="cp"></span>

	<span class="kt">uint16_t</span> <span class="n">ictrl</span><span class="p">;</span>			<span class="cm">/* Interrupt control */</span>
<span class="cp">#define ICR_EN_INT		BIT_15	</span><span class="cm">/* ISP enable interrupts. */</span><span class="cp"></span>
<span class="cp">#define ICR_EN_RISC		BIT_3	</span><span class="cm">/* ISP enable RISC interrupts. */</span><span class="cp"></span>

	<span class="kt">uint16_t</span> <span class="n">istatus</span><span class="p">;</span>		<span class="cm">/* Interrupt status */</span>
<span class="cp">#define ISR_RISC_INT		BIT_3	</span><span class="cm">/* RISC interrupt */</span><span class="cp"></span>

	<span class="kt">uint16_t</span> <span class="n">semaphore</span><span class="p">;</span>		<span class="cm">/* Semaphore */</span>
	<span class="kt">uint16_t</span> <span class="n">nvram</span><span class="p">;</span>			<span class="cm">/* NVRAM register. */</span>
<span class="cp">#define NVR_DESELECT		0</span>
<span class="cp">#define NVR_BUSY		BIT_15</span>
<span class="cp">#define NVR_WRT_ENABLE		BIT_14	</span><span class="cm">/* Write enable */</span><span class="cp"></span>
<span class="cp">#define NVR_PR_ENABLE		BIT_13	</span><span class="cm">/* Protection register enable */</span><span class="cp"></span>
<span class="cp">#define NVR_DATA_IN		BIT_3</span>
<span class="cp">#define NVR_DATA_OUT		BIT_2</span>
<span class="cp">#define NVR_SELECT		BIT_1</span>
<span class="cp">#define NVR_CLOCK		BIT_0</span>

<span class="cp">#define NVR_WAIT_CNT		20000</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox0</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox1</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox2</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox3</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox4</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox5</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox6</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox7</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">unused_2</span><span class="p">[</span><span class="mi">59</span><span class="p">];</span>	<span class="cm">/* Gap */</span>
		<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">isp2100</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
						<span class="cm">/* Request Queue */</span>
			<span class="kt">uint16_t</span> <span class="n">req_q_in</span><span class="p">;</span>	<span class="cm">/*  In-Pointer */</span>
			<span class="kt">uint16_t</span> <span class="n">req_q_out</span><span class="p">;</span>	<span class="cm">/*  Out-Pointer */</span>
						<span class="cm">/* Response Queue */</span>
			<span class="kt">uint16_t</span> <span class="n">rsp_q_in</span><span class="p">;</span>	<span class="cm">/*  In-Pointer */</span>
			<span class="kt">uint16_t</span> <span class="n">rsp_q_out</span><span class="p">;</span>	<span class="cm">/*  Out-Pointer */</span>

						<span class="cm">/* RISC to Host Status */</span>
			<span class="kt">uint32_t</span> <span class="n">host_status</span><span class="p">;</span>
<span class="cp">#define HSR_RISC_INT		BIT_15	</span><span class="cm">/* RISC interrupt */</span><span class="cp"></span>
<span class="cp">#define HSR_RISC_PAUSED		BIT_8	</span><span class="cm">/* RISC Paused */</span><span class="cp"></span>

					<span class="cm">/* Host to Host Semaphore */</span>
			<span class="kt">uint16_t</span> <span class="n">host_semaphore</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">unused_3</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span>	<span class="cm">/* Gap */</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox0</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox1</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox2</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox3</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox4</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox5</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox6</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox7</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox8</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox9</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox10</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox11</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox12</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox13</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox14</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox15</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox16</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox17</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox18</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox19</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox20</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox21</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox22</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox23</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox24</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox25</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox26</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox27</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox28</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox29</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox30</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox31</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">fb_cmd</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">unused_4</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>	<span class="cm">/* Gap */</span>
		<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">isp2300</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>

	<span class="kt">uint16_t</span> <span class="n">fpm_diag_config</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">unused_5</span><span class="p">[</span><span class="mh">0x4</span><span class="p">];</span>		<span class="cm">/* Gap */</span>
	<span class="kt">uint16_t</span> <span class="n">risc_hw</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">unused_5_1</span><span class="p">;</span>		<span class="cm">/* Gap */</span>
	<span class="kt">uint16_t</span> <span class="n">pcr</span><span class="p">;</span>			<span class="cm">/* Processor Control Register. */</span>
	<span class="kt">uint16_t</span> <span class="n">unused_6</span><span class="p">[</span><span class="mh">0x5</span><span class="p">];</span>		<span class="cm">/* Gap */</span>
	<span class="kt">uint16_t</span> <span class="n">mctr</span><span class="p">;</span>			<span class="cm">/* Memory Configuration and Timing. */</span>
	<span class="kt">uint16_t</span> <span class="n">unused_7</span><span class="p">[</span><span class="mh">0x3</span><span class="p">];</span>		<span class="cm">/* Gap */</span>
	<span class="kt">uint16_t</span> <span class="n">fb_cmd_2100</span><span class="p">;</span>		<span class="cm">/* Unused on 23XX */</span>
	<span class="kt">uint16_t</span> <span class="n">unused_8</span><span class="p">[</span><span class="mh">0x3</span><span class="p">];</span>		<span class="cm">/* Gap */</span>
	<span class="kt">uint16_t</span> <span class="n">hccr</span><span class="p">;</span>			<span class="cm">/* Host command &amp; control register. */</span>
<span class="cp">#define HCCR_HOST_INT		BIT_7	</span><span class="cm">/* Host interrupt bit */</span><span class="cp"></span>
<span class="cp">#define HCCR_RISC_PAUSE		BIT_5	</span><span class="cm">/* Pause mode bit */</span><span class="cp"></span>
					<span class="cm">/* HCCR commands */</span>
<span class="cp">#define HCCR_RESET_RISC		0x1000	</span><span class="cm">/* Reset RISC */</span><span class="cp"></span>
<span class="cp">#define HCCR_PAUSE_RISC		0x2000	</span><span class="cm">/* Pause RISC */</span><span class="cp"></span>
<span class="cp">#define HCCR_RELEASE_RISC	0x3000	</span><span class="cm">/* Release RISC from reset. */</span><span class="cp"></span>
<span class="cp">#define HCCR_SET_HOST_INT	0x5000	</span><span class="cm">/* Set host interrupt */</span><span class="cp"></span>
<span class="cp">#define HCCR_CLR_HOST_INT	0x6000	</span><span class="cm">/* Clear HOST interrupt */</span><span class="cp"></span>
<span class="cp">#define HCCR_CLR_RISC_INT	0x7000	</span><span class="cm">/* Clear RISC interrupt */</span><span class="cp"></span>
<span class="cp">#define	HCCR_DISABLE_PARITY_PAUSE 0x4001 </span><span class="cm">/* Disable parity error RISC pause. */</span><span class="cp"></span>
<span class="cp">#define HCCR_ENABLE_PARITY	0xA000	</span><span class="cm">/* Enable PARITY interrupt */</span><span class="cp"></span>

	<span class="kt">uint16_t</span> <span class="n">unused_9</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>		<span class="cm">/* Gap */</span>
	<span class="kt">uint16_t</span> <span class="n">gpiod</span><span class="p">;</span>			<span class="cm">/* GPIO Data register. */</span>
	<span class="kt">uint16_t</span> <span class="n">gpioe</span><span class="p">;</span>			<span class="cm">/* GPIO Enable register. */</span>
<span class="cp">#define GPIO_LED_MASK			0x00C0</span>
<span class="cp">#define GPIO_LED_GREEN_OFF_AMBER_OFF	0x0000</span>
<span class="cp">#define GPIO_LED_GREEN_ON_AMBER_OFF	0x0040</span>
<span class="cp">#define GPIO_LED_GREEN_OFF_AMBER_ON	0x0080</span>
<span class="cp">#define GPIO_LED_GREEN_ON_AMBER_ON	0x00C0</span>
<span class="cp">#define GPIO_LED_ALL_OFF		0x0000</span>
<span class="cp">#define GPIO_LED_RED_ON_OTHER_OFF	0x0001	</span><span class="cm">/* isp2322 */</span><span class="cp"></span>
<span class="cp">#define GPIO_LED_RGA_ON			0x00C1	</span><span class="cm">/* isp2322: red green amber */</span><span class="cp"></span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint16_t</span> <span class="n">unused_10</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>	<span class="cm">/* Gap */</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox8</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox9</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox10</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox11</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox12</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox13</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox14</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox15</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox16</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox17</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox18</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox19</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox20</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox21</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox22</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">mailbox23</span><span class="p">;</span>	<span class="cm">/* Also probe reg. */</span>
		<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">isp2200</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u_end</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">device_reg_25xxmq</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">req_q_in</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">req_q_out</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">rsp_q_in</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">rsp_q_out</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">device_reg_2xxx</span> <span class="n">isp</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">device_reg_24xx</span> <span class="n">isp24</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">device_reg_25xxmq</span> <span class="n">isp25mq</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">device_reg_82xx</span> <span class="n">isp82</span><span class="p">;</span>
<span class="p">}</span> <span class="n">device_reg_t</span><span class="p">;</span>

<span class="cp">#define ISP_REQ_Q_IN(ha, reg) \</span>
<span class="cp">	(IS_QLA2100(ha) || IS_QLA2200(ha) ? \</span>
<span class="cp">	 &amp;(reg)-&gt;u.isp2100.mailbox4 : \</span>
<span class="cp">	 &amp;(reg)-&gt;u.isp2300.req_q_in)</span>
<span class="cp">#define ISP_REQ_Q_OUT(ha, reg) \</span>
<span class="cp">	(IS_QLA2100(ha) || IS_QLA2200(ha) ? \</span>
<span class="cp">	 &amp;(reg)-&gt;u.isp2100.mailbox4 : \</span>
<span class="cp">	 &amp;(reg)-&gt;u.isp2300.req_q_out)</span>
<span class="cp">#define ISP_RSP_Q_IN(ha, reg) \</span>
<span class="cp">	(IS_QLA2100(ha) || IS_QLA2200(ha) ? \</span>
<span class="cp">	 &amp;(reg)-&gt;u.isp2100.mailbox5 : \</span>
<span class="cp">	 &amp;(reg)-&gt;u.isp2300.rsp_q_in)</span>
<span class="cp">#define ISP_RSP_Q_OUT(ha, reg) \</span>
<span class="cp">	(IS_QLA2100(ha) || IS_QLA2200(ha) ? \</span>
<span class="cp">	 &amp;(reg)-&gt;u.isp2100.mailbox5 : \</span>
<span class="cp">	 &amp;(reg)-&gt;u.isp2300.rsp_q_out)</span>

<span class="cp">#define MAILBOX_REG(ha, reg, num) \</span>
<span class="cp">	(IS_QLA2100(ha) || IS_QLA2200(ha) ? \</span>
<span class="cp">	 (num &lt; 8 ? \</span>
<span class="cp">	  &amp;(reg)-&gt;u.isp2100.mailbox0 + (num) : \</span>
<span class="cp">	  &amp;(reg)-&gt;u_end.isp2200.mailbox8 + (num) - 8) : \</span>
<span class="cp">	 &amp;(reg)-&gt;u.isp2300.mailbox0 + (num))</span>
<span class="cp">#define RD_MAILBOX_REG(ha, reg, num) \</span>
<span class="cp">	RD_REG_WORD(MAILBOX_REG(ha, reg, num))</span>
<span class="cp">#define WRT_MAILBOX_REG(ha, reg, num, data) \</span>
<span class="cp">	WRT_REG_WORD(MAILBOX_REG(ha, reg, num), data)</span>

<span class="cp">#define FB_CMD_REG(ha, reg) \</span>
<span class="cp">	(IS_QLA2100(ha) || IS_QLA2200(ha) ? \</span>
<span class="cp">	 &amp;(reg)-&gt;fb_cmd_2100 : \</span>
<span class="cp">	 &amp;(reg)-&gt;u.isp2300.fb_cmd)</span>
<span class="cp">#define RD_FB_CMD_REG(ha, reg) \</span>
<span class="cp">	RD_REG_WORD(FB_CMD_REG(ha, reg))</span>
<span class="cp">#define WRT_FB_CMD_REG(ha, reg, data) \</span>
<span class="cp">	WRT_REG_WORD(FB_CMD_REG(ha, reg), data)</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>	<span class="n">out_mb</span><span class="p">;</span>		<span class="cm">/* outbound from driver */</span>
	<span class="kt">uint32_t</span>	<span class="n">in_mb</span><span class="p">;</span>			<span class="cm">/* Incoming from RISC */</span>
	<span class="kt">uint16_t</span>	<span class="n">mb</span><span class="p">[</span><span class="n">MAILBOX_REGISTER_COUNT</span><span class="p">];</span>
	<span class="kt">long</span>		<span class="n">buf_size</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">bufp</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">tov</span><span class="p">;</span>
	<span class="kt">uint8_t</span>		<span class="n">flags</span><span class="p">;</span>
<span class="cp">#define MBX_DMA_IN	BIT_0</span>
<span class="cp">#define	MBX_DMA_OUT	BIT_1</span>
<span class="cp">#define IOCTL_CMD	BIT_2</span>
<span class="p">}</span> <span class="n">mbx_cmd_t</span><span class="p">;</span>

<span class="cp">#define	MBX_TOV_SECONDS	30</span>

<span class="cm">/*</span>
<span class="cm"> *  ISP product identification definitions in mailboxes after reset.</span>
<span class="cm"> */</span>
<span class="cp">#define PROD_ID_1		0x4953</span>
<span class="cp">#define PROD_ID_2		0x0000</span>
<span class="cp">#define PROD_ID_2a		0x5020</span>
<span class="cp">#define PROD_ID_3		0x2020</span>

<span class="cm">/*</span>
<span class="cm"> * ISP mailbox Self-Test status codes</span>
<span class="cm"> */</span>
<span class="cp">#define MBS_FRM_ALIVE		0	</span><span class="cm">/* Firmware Alive. */</span><span class="cp"></span>
<span class="cp">#define MBS_CHKSUM_ERR		1	</span><span class="cm">/* Checksum Error. */</span><span class="cp"></span>
<span class="cp">#define MBS_BUSY		4	</span><span class="cm">/* Busy. */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * ISP mailbox command complete status codes</span>
<span class="cm"> */</span>
<span class="cp">#define MBS_COMMAND_COMPLETE		0x4000</span>
<span class="cp">#define MBS_INVALID_COMMAND		0x4001</span>
<span class="cp">#define MBS_HOST_INTERFACE_ERROR	0x4002</span>
<span class="cp">#define MBS_TEST_FAILED			0x4003</span>
<span class="cp">#define MBS_COMMAND_ERROR		0x4005</span>
<span class="cp">#define MBS_COMMAND_PARAMETER_ERROR	0x4006</span>
<span class="cp">#define MBS_PORT_ID_USED		0x4007</span>
<span class="cp">#define MBS_LOOP_ID_USED		0x4008</span>
<span class="cp">#define MBS_ALL_IDS_IN_USE		0x4009</span>
<span class="cp">#define MBS_NOT_LOGGED_IN		0x400A</span>
<span class="cp">#define MBS_LINK_DOWN_ERROR		0x400B</span>
<span class="cp">#define MBS_DIAG_ECHO_TEST_ERROR	0x400C</span>

<span class="cm">/*</span>
<span class="cm"> * ISP mailbox asynchronous event status codes</span>
<span class="cm"> */</span>
<span class="cp">#define MBA_ASYNC_EVENT		0x8000	</span><span class="cm">/* Asynchronous event. */</span><span class="cp"></span>
<span class="cp">#define MBA_RESET		0x8001	</span><span class="cm">/* Reset Detected. */</span><span class="cp"></span>
<span class="cp">#define MBA_SYSTEM_ERR		0x8002	</span><span class="cm">/* System Error. */</span><span class="cp"></span>
<span class="cp">#define MBA_REQ_TRANSFER_ERR	0x8003	</span><span class="cm">/* Request Transfer Error. */</span><span class="cp"></span>
<span class="cp">#define MBA_RSP_TRANSFER_ERR	0x8004	</span><span class="cm">/* Response Transfer Error. */</span><span class="cp"></span>
<span class="cp">#define MBA_WAKEUP_THRES	0x8005	</span><span class="cm">/* Request Queue Wake-up. */</span><span class="cp"></span>
<span class="cp">#define MBA_LIP_OCCURRED	0x8010	</span><span class="cm">/* Loop Initialization Procedure */</span><span class="cp"></span>
					<span class="cm">/* occurred. */</span>
<span class="cp">#define MBA_LOOP_UP		0x8011	</span><span class="cm">/* FC Loop UP. */</span><span class="cp"></span>
<span class="cp">#define MBA_LOOP_DOWN		0x8012	</span><span class="cm">/* FC Loop Down. */</span><span class="cp"></span>
<span class="cp">#define MBA_LIP_RESET		0x8013	</span><span class="cm">/* LIP reset occurred. */</span><span class="cp"></span>
<span class="cp">#define MBA_PORT_UPDATE		0x8014	</span><span class="cm">/* Port Database update. */</span><span class="cp"></span>
<span class="cp">#define MBA_RSCN_UPDATE		0x8015	</span><span class="cm">/* Register State Chg Notification. */</span><span class="cp"></span>
<span class="cp">#define MBA_LIP_F8		0x8016	</span><span class="cm">/* Received a LIP F8. */</span><span class="cp"></span>
<span class="cp">#define MBA_LOOP_INIT_ERR	0x8017	</span><span class="cm">/* Loop Initialization Error. */</span><span class="cp"></span>
<span class="cp">#define MBA_FABRIC_AUTH_REQ	0x801b	</span><span class="cm">/* Fabric Authentication Required. */</span><span class="cp"></span>
<span class="cp">#define MBA_SCSI_COMPLETION	0x8020	</span><span class="cm">/* SCSI Command Complete. */</span><span class="cp"></span>
<span class="cp">#define MBA_CTIO_COMPLETION	0x8021	</span><span class="cm">/* CTIO Complete. */</span><span class="cp"></span>
<span class="cp">#define MBA_IP_COMPLETION	0x8022	</span><span class="cm">/* IP Transmit Command Complete. */</span><span class="cp"></span>
<span class="cp">#define MBA_IP_RECEIVE		0x8023	</span><span class="cm">/* IP Received. */</span><span class="cp"></span>
<span class="cp">#define MBA_IP_BROADCAST	0x8024	</span><span class="cm">/* IP Broadcast Received. */</span><span class="cp"></span>
<span class="cp">#define MBA_IP_LOW_WATER_MARK	0x8025	</span><span class="cm">/* IP Low Water Mark reached. */</span><span class="cp"></span>
<span class="cp">#define MBA_IP_RCV_BUFFER_EMPTY 0x8026	</span><span class="cm">/* IP receive buffer queue empty. */</span><span class="cp"></span>
<span class="cp">#define MBA_IP_HDR_DATA_SPLIT	0x8027	</span><span class="cm">/* IP header/data splitting feature */</span><span class="cp"></span>
					<span class="cm">/* used. */</span>
<span class="cp">#define MBA_TRACE_NOTIFICATION	0x8028	</span><span class="cm">/* Trace/Diagnostic notification. */</span><span class="cp"></span>
<span class="cp">#define MBA_POINT_TO_POINT	0x8030	</span><span class="cm">/* Point to point mode. */</span><span class="cp"></span>
<span class="cp">#define MBA_CMPLT_1_16BIT	0x8031	</span><span class="cm">/* Completion 1 16bit IOSB. */</span><span class="cp"></span>
<span class="cp">#define MBA_CMPLT_2_16BIT	0x8032	</span><span class="cm">/* Completion 2 16bit IOSB. */</span><span class="cp"></span>
<span class="cp">#define MBA_CMPLT_3_16BIT	0x8033	</span><span class="cm">/* Completion 3 16bit IOSB. */</span><span class="cp"></span>
<span class="cp">#define MBA_CMPLT_4_16BIT	0x8034	</span><span class="cm">/* Completion 4 16bit IOSB. */</span><span class="cp"></span>
<span class="cp">#define MBA_CMPLT_5_16BIT	0x8035	</span><span class="cm">/* Completion 5 16bit IOSB. */</span><span class="cp"></span>
<span class="cp">#define MBA_CHG_IN_CONNECTION	0x8036	</span><span class="cm">/* Change in connection mode. */</span><span class="cp"></span>
<span class="cp">#define MBA_RIO_RESPONSE	0x8040	</span><span class="cm">/* RIO response queue update. */</span><span class="cp"></span>
<span class="cp">#define MBA_ZIO_RESPONSE	0x8040	</span><span class="cm">/* ZIO response queue update. */</span><span class="cp"></span>
<span class="cp">#define MBA_CMPLT_2_32BIT	0x8042	</span><span class="cm">/* Completion 2 32bit IOSB. */</span><span class="cp"></span>
<span class="cp">#define MBA_BYPASS_NOTIFICATION	0x8043	</span><span class="cm">/* Auto bypass notification. */</span><span class="cp"></span>
<span class="cp">#define MBA_DISCARD_RND_FRAME	0x8048	</span><span class="cm">/* discard RND frame due to error. */</span><span class="cp"></span>
<span class="cp">#define MBA_REJECTED_FCP_CMD	0x8049	</span><span class="cm">/* rejected FCP_CMD. */</span><span class="cp"></span>

<span class="cm">/* ISP mailbox loopback echo diagnostic error code */</span>
<span class="cp">#define MBS_LB_RESET	0x17</span>
<span class="cm">/*</span>
<span class="cm"> * Firmware options 1, 2, 3.</span>
<span class="cm"> */</span>
<span class="cp">#define FO1_AE_ON_LIPF8			BIT_0</span>
<span class="cp">#define FO1_AE_ALL_LIP_RESET		BIT_1</span>
<span class="cp">#define FO1_CTIO_RETRY			BIT_3</span>
<span class="cp">#define FO1_DISABLE_LIP_F7_SW		BIT_4</span>
<span class="cp">#define FO1_DISABLE_100MS_LOS_WAIT	BIT_5</span>
<span class="cp">#define FO1_DISABLE_GPIO6_7		BIT_6	</span><span class="cm">/* LED bits */</span><span class="cp"></span>
<span class="cp">#define FO1_AE_ON_LOOP_INIT_ERR		BIT_7</span>
<span class="cp">#define FO1_SET_EMPHASIS_SWING		BIT_8</span>
<span class="cp">#define FO1_AE_AUTO_BYPASS		BIT_9</span>
<span class="cp">#define FO1_ENABLE_PURE_IOCB		BIT_10</span>
<span class="cp">#define FO1_AE_PLOGI_RJT		BIT_11</span>
<span class="cp">#define FO1_ENABLE_ABORT_SEQUENCE	BIT_12</span>
<span class="cp">#define FO1_AE_QUEUE_FULL		BIT_13</span>

<span class="cp">#define FO2_ENABLE_ATIO_TYPE_3		BIT_0</span>
<span class="cp">#define FO2_REV_LOOPBACK		BIT_1</span>

<span class="cp">#define FO3_ENABLE_EMERG_IOCB		BIT_0</span>
<span class="cp">#define FO3_AE_RND_ERROR		BIT_1</span>

<span class="cm">/* 24XX additional firmware options */</span>
<span class="cp">#define ADD_FO_COUNT			3</span>
<span class="cp">#define ADD_FO1_DISABLE_GPIO_LED_CTRL	BIT_6	</span><span class="cm">/* LED bits */</span><span class="cp"></span>
<span class="cp">#define ADD_FO1_ENABLE_PUREX_IOCB	BIT_10</span>

<span class="cp">#define ADD_FO2_ENABLE_SEL_CLS2		BIT_5</span>

<span class="cp">#define ADD_FO3_NO_ABT_ON_LINK_DOWN	BIT_14</span>

<span class="cm">/*</span>
<span class="cm"> * ISP mailbox commands</span>
<span class="cm"> */</span>
<span class="cp">#define MBC_LOAD_RAM			1	</span><span class="cm">/* Load RAM. */</span><span class="cp"></span>
<span class="cp">#define MBC_EXECUTE_FIRMWARE		2	</span><span class="cm">/* Execute firmware. */</span><span class="cp"></span>
<span class="cp">#define MBC_WRITE_RAM_WORD		4	</span><span class="cm">/* Write RAM word. */</span><span class="cp"></span>
<span class="cp">#define MBC_READ_RAM_WORD		5	</span><span class="cm">/* Read RAM word. */</span><span class="cp"></span>
<span class="cp">#define MBC_MAILBOX_REGISTER_TEST	6	</span><span class="cm">/* Wrap incoming mailboxes */</span><span class="cp"></span>
<span class="cp">#define MBC_VERIFY_CHECKSUM		7	</span><span class="cm">/* Verify checksum. */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_FIRMWARE_VERSION	8	</span><span class="cm">/* Get firmware revision. */</span><span class="cp"></span>
<span class="cp">#define MBC_LOAD_RISC_RAM		9	</span><span class="cm">/* Load RAM command. */</span><span class="cp"></span>
<span class="cp">#define MBC_DUMP_RISC_RAM		0xa	</span><span class="cm">/* Dump RAM command. */</span><span class="cp"></span>
<span class="cp">#define MBC_LOAD_RISC_RAM_EXTENDED	0xb	</span><span class="cm">/* Load RAM extended. */</span><span class="cp"></span>
<span class="cp">#define MBC_DUMP_RISC_RAM_EXTENDED	0xc	</span><span class="cm">/* Dump RAM extended. */</span><span class="cp"></span>
<span class="cp">#define MBC_WRITE_RAM_WORD_EXTENDED	0xd	</span><span class="cm">/* Write RAM word extended */</span><span class="cp"></span>
<span class="cp">#define MBC_READ_RAM_EXTENDED		0xf	</span><span class="cm">/* Read RAM extended. */</span><span class="cp"></span>
<span class="cp">#define MBC_IOCB_COMMAND		0x12	</span><span class="cm">/* Execute IOCB command. */</span><span class="cp"></span>
<span class="cp">#define MBC_STOP_FIRMWARE		0x14	</span><span class="cm">/* Stop firmware. */</span><span class="cp"></span>
<span class="cp">#define MBC_ABORT_COMMAND		0x15	</span><span class="cm">/* Abort IOCB command. */</span><span class="cp"></span>
<span class="cp">#define MBC_ABORT_DEVICE		0x16	</span><span class="cm">/* Abort device (ID/LUN). */</span><span class="cp"></span>
<span class="cp">#define MBC_ABORT_TARGET		0x17	</span><span class="cm">/* Abort target (ID). */</span><span class="cp"></span>
<span class="cp">#define MBC_RESET			0x18	</span><span class="cm">/* Reset. */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_ADAPTER_LOOP_ID		0x20	</span><span class="cm">/* Get loop id of ISP2200. */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_RETRY_COUNT		0x22	</span><span class="cm">/* Get f/w retry cnt/delay. */</span><span class="cp"></span>
<span class="cp">#define MBC_DISABLE_VI			0x24	</span><span class="cm">/* Disable VI operation. */</span><span class="cp"></span>
<span class="cp">#define MBC_ENABLE_VI			0x25	</span><span class="cm">/* Enable VI operation. */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_FIRMWARE_OPTION		0x28	</span><span class="cm">/* Get Firmware Options. */</span><span class="cp"></span>
<span class="cp">#define MBC_SET_FIRMWARE_OPTION		0x38	</span><span class="cm">/* Set Firmware Options. */</span><span class="cp"></span>
<span class="cp">#define MBC_LOOP_PORT_BYPASS		0x40	</span><span class="cm">/* Loop Port Bypass. */</span><span class="cp"></span>
<span class="cp">#define MBC_LOOP_PORT_ENABLE		0x41	</span><span class="cm">/* Loop Port Enable. */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_RESOURCE_COUNTS		0x42	</span><span class="cm">/* Get Resource Counts. */</span><span class="cp"></span>
<span class="cp">#define MBC_NON_PARTICIPATE		0x43	</span><span class="cm">/* Non-Participating Mode. */</span><span class="cp"></span>
<span class="cp">#define MBC_DIAGNOSTIC_ECHO		0x44	</span><span class="cm">/* Diagnostic echo. */</span><span class="cp"></span>
<span class="cp">#define MBC_DIAGNOSTIC_LOOP_BACK	0x45	</span><span class="cm">/* Diagnostic loop back. */</span><span class="cp"></span>
<span class="cp">#define MBC_ONLINE_SELF_TEST		0x46	</span><span class="cm">/* Online self-test. */</span><span class="cp"></span>
<span class="cp">#define MBC_ENHANCED_GET_PORT_DATABASE	0x47	</span><span class="cm">/* Get port database + login */</span><span class="cp"></span>
<span class="cp">#define MBC_CONFIGURE_VF		0x4b	</span><span class="cm">/* Configure VFs */</span><span class="cp"></span>
<span class="cp">#define MBC_RESET_LINK_STATUS		0x52	</span><span class="cm">/* Reset Link Error Status */</span><span class="cp"></span>
<span class="cp">#define MBC_IOCB_COMMAND_A64		0x54	</span><span class="cm">/* Execute IOCB command (64) */</span><span class="cp"></span>
<span class="cp">#define MBC_PORT_LOGOUT			0x56	</span><span class="cm">/* Port Logout request */</span><span class="cp"></span>
<span class="cp">#define MBC_SEND_RNID_ELS		0x57	</span><span class="cm">/* Send RNID ELS request */</span><span class="cp"></span>
<span class="cp">#define MBC_SET_RNID_PARAMS		0x59	</span><span class="cm">/* Set RNID parameters */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_RNID_PARAMS		0x5a	</span><span class="cm">/* Data Rate */</span><span class="cp"></span>
<span class="cp">#define MBC_DATA_RATE			0x5d	</span><span class="cm">/* Get RNID parameters */</span><span class="cp"></span>
<span class="cp">#define MBC_INITIALIZE_FIRMWARE		0x60	</span><span class="cm">/* Initialize firmware */</span><span class="cp"></span>
<span class="cp">#define MBC_INITIATE_LIP		0x62	</span><span class="cm">/* Initiate Loop */</span><span class="cp"></span>
						<span class="cm">/* Initialization Procedure */</span>
<span class="cp">#define MBC_GET_FC_AL_POSITION_MAP	0x63	</span><span class="cm">/* Get FC_AL Position Map. */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_PORT_DATABASE		0x64	</span><span class="cm">/* Get Port Database. */</span><span class="cp"></span>
<span class="cp">#define MBC_CLEAR_ACA			0x65	</span><span class="cm">/* Clear ACA. */</span><span class="cp"></span>
<span class="cp">#define MBC_TARGET_RESET		0x66	</span><span class="cm">/* Target Reset. */</span><span class="cp"></span>
<span class="cp">#define MBC_CLEAR_TASK_SET		0x67	</span><span class="cm">/* Clear Task Set. */</span><span class="cp"></span>
<span class="cp">#define MBC_ABORT_TASK_SET		0x68	</span><span class="cm">/* Abort Task Set. */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_FIRMWARE_STATE		0x69	</span><span class="cm">/* Get firmware state. */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_PORT_NAME		0x6a	</span><span class="cm">/* Get port name. */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_LINK_STATUS		0x6b	</span><span class="cm">/* Get port link status. */</span><span class="cp"></span>
<span class="cp">#define MBC_LIP_RESET			0x6c	</span><span class="cm">/* LIP reset. */</span><span class="cp"></span>
<span class="cp">#define MBC_SEND_SNS_COMMAND		0x6e	</span><span class="cm">/* Send Simple Name Server */</span><span class="cp"></span>
						<span class="cm">/* commandd. */</span>
<span class="cp">#define MBC_LOGIN_FABRIC_PORT		0x6f	</span><span class="cm">/* Login fabric port. */</span><span class="cp"></span>
<span class="cp">#define MBC_SEND_CHANGE_REQUEST		0x70	</span><span class="cm">/* Send Change Request. */</span><span class="cp"></span>
<span class="cp">#define MBC_LOGOUT_FABRIC_PORT		0x71	</span><span class="cm">/* Logout fabric port. */</span><span class="cp"></span>
<span class="cp">#define MBC_LIP_FULL_LOGIN		0x72	</span><span class="cm">/* Full login LIP. */</span><span class="cp"></span>
<span class="cp">#define MBC_LOGIN_LOOP_PORT		0x74	</span><span class="cm">/* Login Loop Port. */</span><span class="cp"></span>
<span class="cp">#define MBC_PORT_NODE_NAME_LIST		0x75	</span><span class="cm">/* Get port/node name list. */</span><span class="cp"></span>
<span class="cp">#define MBC_INITIALIZE_RECEIVE_QUEUE	0x77	</span><span class="cm">/* Initialize receive queue */</span><span class="cp"></span>
<span class="cp">#define MBC_UNLOAD_IP			0x79	</span><span class="cm">/* Shutdown IP */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_ID_LIST			0x7C	</span><span class="cm">/* Get Port ID list. */</span><span class="cp"></span>
<span class="cp">#define MBC_SEND_LFA_COMMAND		0x7D	</span><span class="cm">/* Send Loop Fabric Address */</span><span class="cp"></span>
<span class="cp">#define MBC_LUN_RESET			0x7E	</span><span class="cm">/* Send LUN reset */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * ISP24xx mailbox commands</span>
<span class="cm"> */</span>
<span class="cp">#define MBC_SERDES_PARAMS		0x10	</span><span class="cm">/* Serdes Tx Parameters. */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_IOCB_STATUS		0x12	</span><span class="cm">/* Get IOCB status command. */</span><span class="cp"></span>
<span class="cp">#define MBC_PORT_PARAMS			0x1A	</span><span class="cm">/* Port iDMA Parameters. */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_TIMEOUT_PARAMS		0x22	</span><span class="cm">/* Get FW timeouts. */</span><span class="cp"></span>
<span class="cp">#define MBC_TRACE_CONTROL		0x27	</span><span class="cm">/* Trace control command. */</span><span class="cp"></span>
<span class="cp">#define MBC_GEN_SYSTEM_ERROR		0x2a	</span><span class="cm">/* Generate System Error. */</span><span class="cp"></span>
<span class="cp">#define MBC_WRITE_SFP			0x30	</span><span class="cm">/* Write SFP Data. */</span><span class="cp"></span>
<span class="cp">#define MBC_READ_SFP			0x31	</span><span class="cm">/* Read SFP Data. */</span><span class="cp"></span>
<span class="cp">#define MBC_SET_TIMEOUT_PARAMS		0x32	</span><span class="cm">/* Set FW timeouts. */</span><span class="cp"></span>
<span class="cp">#define MBC_MID_INITIALIZE_FIRMWARE	0x48	</span><span class="cm">/* MID Initialize firmware. */</span><span class="cp"></span>
<span class="cp">#define MBC_MID_GET_VP_DATABASE		0x49	</span><span class="cm">/* MID Get VP Database. */</span><span class="cp"></span>
<span class="cp">#define MBC_MID_GET_VP_ENTRY		0x4a	</span><span class="cm">/* MID Get VP Entry. */</span><span class="cp"></span>
<span class="cp">#define MBC_HOST_MEMORY_COPY		0x53	</span><span class="cm">/* Host Memory Copy. */</span><span class="cp"></span>
<span class="cp">#define MBC_SEND_RNFT_ELS		0x5e	</span><span class="cm">/* Send RNFT ELS request */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_LINK_PRIV_STATS		0x6d	</span><span class="cm">/* Get link &amp; private data. */</span><span class="cp"></span>
<span class="cp">#define MBC_SET_VENDOR_ID		0x76	</span><span class="cm">/* Set Vendor ID. */</span><span class="cp"></span>
<span class="cp">#define MBC_SET_PORT_CONFIG		0x122	</span><span class="cm">/* Set port configuration */</span><span class="cp"></span>
<span class="cp">#define MBC_GET_PORT_CONFIG		0x123	</span><span class="cm">/* Get port configuration */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * ISP81xx mailbox commands</span>
<span class="cm"> */</span>
<span class="cp">#define MBC_WRITE_MPI_REGISTER		0x01    </span><span class="cm">/* Write MPI Register. */</span><span class="cp"></span>

<span class="cm">/* Firmware return data sizes */</span>
<span class="cp">#define FCAL_MAP_SIZE	128</span>

<span class="cm">/* Mailbox bit definitions for out_mb and in_mb */</span>
<span class="cp">#define	MBX_31		BIT_31</span>
<span class="cp">#define	MBX_30		BIT_30</span>
<span class="cp">#define	MBX_29		BIT_29</span>
<span class="cp">#define	MBX_28		BIT_28</span>
<span class="cp">#define	MBX_27		BIT_27</span>
<span class="cp">#define	MBX_26		BIT_26</span>
<span class="cp">#define	MBX_25		BIT_25</span>
<span class="cp">#define	MBX_24		BIT_24</span>
<span class="cp">#define	MBX_23		BIT_23</span>
<span class="cp">#define	MBX_22		BIT_22</span>
<span class="cp">#define	MBX_21		BIT_21</span>
<span class="cp">#define	MBX_20		BIT_20</span>
<span class="cp">#define	MBX_19		BIT_19</span>
<span class="cp">#define	MBX_18		BIT_18</span>
<span class="cp">#define	MBX_17		BIT_17</span>
<span class="cp">#define	MBX_16		BIT_16</span>
<span class="cp">#define	MBX_15		BIT_15</span>
<span class="cp">#define	MBX_14		BIT_14</span>
<span class="cp">#define	MBX_13		BIT_13</span>
<span class="cp">#define	MBX_12		BIT_12</span>
<span class="cp">#define	MBX_11		BIT_11</span>
<span class="cp">#define	MBX_10		BIT_10</span>
<span class="cp">#define	MBX_9		BIT_9</span>
<span class="cp">#define	MBX_8		BIT_8</span>
<span class="cp">#define	MBX_7		BIT_7</span>
<span class="cp">#define	MBX_6		BIT_6</span>
<span class="cp">#define	MBX_5		BIT_5</span>
<span class="cp">#define	MBX_4		BIT_4</span>
<span class="cp">#define	MBX_3		BIT_3</span>
<span class="cp">#define	MBX_2		BIT_2</span>
<span class="cp">#define	MBX_1		BIT_1</span>
<span class="cp">#define	MBX_0		BIT_0</span>

<span class="cm">/*</span>
<span class="cm"> * Firmware state codes from get firmware state mailbox command</span>
<span class="cm"> */</span>
<span class="cp">#define FSTATE_CONFIG_WAIT      0</span>
<span class="cp">#define FSTATE_WAIT_AL_PA       1</span>
<span class="cp">#define FSTATE_WAIT_LOGIN       2</span>
<span class="cp">#define FSTATE_READY            3</span>
<span class="cp">#define FSTATE_LOSS_OF_SYNC     4</span>
<span class="cp">#define FSTATE_ERROR            5</span>
<span class="cp">#define FSTATE_REINIT           6</span>
<span class="cp">#define FSTATE_NON_PART         7</span>

<span class="cp">#define FSTATE_CONFIG_CORRECT      0</span>
<span class="cp">#define FSTATE_P2P_RCV_LIP         1</span>
<span class="cp">#define FSTATE_P2P_CHOOSE_LOOP     2</span>
<span class="cp">#define FSTATE_P2P_RCV_UNIDEN_LIP  3</span>
<span class="cp">#define FSTATE_FATAL_ERROR         4</span>
<span class="cp">#define FSTATE_LOOP_BACK_CONN      5</span>

<span class="cm">/*</span>
<span class="cm"> * Port Database structure definition</span>
<span class="cm"> * Little endian except where noted.</span>
<span class="cm"> */</span>
<span class="cp">#define	PORT_DATABASE_SIZE	128	</span><span class="cm">/* bytes */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">options</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">control</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">master_state</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">slave_state</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">hard_address</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">reserved_1</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">port_id</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint16_t</span> <span class="n">execution_throttle</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">execution_count</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">reset_count</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">reserved_2</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">resource_allocation</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">current_allocation</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">queue_head</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">queue_tail</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">transmit_execution_list_next</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">transmit_execution_list_previous</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">common_features</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">total_concurrent_sequences</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">RO_by_information_category</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">recipient</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">initiator</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">receive_data_size</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">concurrent_sequences</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">open_sequences_per_exchange</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">lun_abort_flags</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">lun_stop_flags</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">stop_queue_head</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">stop_queue_tail</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">port_retry_timer</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">next_sequence_id</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">frame_count</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">PRLI_payload_length</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">prli_svc_param_word_0</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Big endian */</span>
						<span class="cm">/* Bits 15-0 of word 0 */</span>
	<span class="kt">uint8_t</span> <span class="n">prli_svc_param_word_3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Big endian */</span>
						<span class="cm">/* Bits 15-0 of word 3 */</span>
	<span class="kt">uint16_t</span> <span class="n">loop_id</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">extended_lun_info_list_pointer</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">extended_lun_stop_list_pointer</span><span class="p">;</span>
<span class="p">}</span> <span class="n">port_database_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Port database slave/master states</span>
<span class="cm"> */</span>
<span class="cp">#define PD_STATE_DISCOVERY			0</span>
<span class="cp">#define PD_STATE_WAIT_DISCOVERY_ACK		1</span>
<span class="cp">#define PD_STATE_PORT_LOGIN			2</span>
<span class="cp">#define PD_STATE_WAIT_PORT_LOGIN_ACK		3</span>
<span class="cp">#define PD_STATE_PROCESS_LOGIN			4</span>
<span class="cp">#define PD_STATE_WAIT_PROCESS_LOGIN_ACK		5</span>
<span class="cp">#define PD_STATE_PORT_LOGGED_IN			6</span>
<span class="cp">#define PD_STATE_PORT_UNAVAILABLE		7</span>
<span class="cp">#define PD_STATE_PROCESS_LOGOUT			8</span>
<span class="cp">#define PD_STATE_WAIT_PROCESS_LOGOUT_ACK	9</span>
<span class="cp">#define PD_STATE_PORT_LOGOUT			10</span>
<span class="cp">#define PD_STATE_WAIT_PORT_LOGOUT_ACK		11</span>


<span class="cp">#define QLA_ZIO_MODE_6		(BIT_2 | BIT_1)</span>
<span class="cp">#define QLA_ZIO_DISABLED	0</span>
<span class="cp">#define QLA_ZIO_DEFAULT_TIMER	2</span>

<span class="cm">/*</span>
<span class="cm"> * ISP Initialization Control Block.</span>
<span class="cm"> * Little endian except where noted.</span>
<span class="cm"> */</span>
<span class="cp">#define	ICB_VERSION 1</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span>  <span class="n">version</span><span class="p">;</span>
	<span class="kt">uint8_t</span>  <span class="n">reserved_1</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * LSB BIT 0  = Enable Hard Loop Id</span>
<span class="cm">	 * LSB BIT 1  = Enable Fairness</span>
<span class="cm">	 * LSB BIT 2  = Enable Full-Duplex</span>
<span class="cm">	 * LSB BIT 3  = Enable Fast Posting</span>
<span class="cm">	 * LSB BIT 4  = Enable Target Mode</span>
<span class="cm">	 * LSB BIT 5  = Disable Initiator Mode</span>
<span class="cm">	 * LSB BIT 6  = Enable ADISC</span>
<span class="cm">	 * LSB BIT 7  = Enable Target Inquiry Data</span>
<span class="cm">	 *</span>
<span class="cm">	 * MSB BIT 0  = Enable PDBC Notify</span>
<span class="cm">	 * MSB BIT 1  = Non Participating LIP</span>
<span class="cm">	 * MSB BIT 2  = Descending Loop ID Search</span>
<span class="cm">	 * MSB BIT 3  = Acquire Loop ID in LIPA</span>
<span class="cm">	 * MSB BIT 4  = Stop PortQ on Full Status</span>
<span class="cm">	 * MSB BIT 5  = Full Login after LIP</span>
<span class="cm">	 * MSB BIT 6  = Node Name Option</span>
<span class="cm">	 * MSB BIT 7  = Ext IFWCB enable bit</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span>  <span class="n">firmware_options</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="kt">uint16_t</span> <span class="n">frame_payload_size</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">max_iocb_allocation</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">execution_throttle</span><span class="p">;</span>
	<span class="kt">uint8_t</span>  <span class="n">retry_count</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">retry_delay</span><span class="p">;</span>			<span class="cm">/* unused */</span>
	<span class="kt">uint8_t</span>	 <span class="n">port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>		<span class="cm">/* Big endian. */</span>
	<span class="kt">uint16_t</span> <span class="n">hard_address</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">inquiry_data</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">login_timeout</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>		<span class="cm">/* Big endian. */</span>

	<span class="kt">uint16_t</span> <span class="n">request_q_outpointer</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">response_q_inpointer</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">request_q_length</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">response_q_length</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">request_q_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">response_q_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="kt">uint16_t</span> <span class="n">lun_enables</span><span class="p">;</span>
	<span class="kt">uint8_t</span>  <span class="n">command_resource_count</span><span class="p">;</span>
	<span class="kt">uint8_t</span>  <span class="n">immediate_notify_resource_count</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">timeout</span><span class="p">;</span>
	<span class="kt">uint8_t</span>  <span class="n">reserved_2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/*</span>
<span class="cm">	 * LSB BIT 0 = Timer Operation mode bit 0</span>
<span class="cm">	 * LSB BIT 1 = Timer Operation mode bit 1</span>
<span class="cm">	 * LSB BIT 2 = Timer Operation mode bit 2</span>
<span class="cm">	 * LSB BIT 3 = Timer Operation mode bit 3</span>
<span class="cm">	 * LSB BIT 4 = Init Config Mode bit 0</span>
<span class="cm">	 * LSB BIT 5 = Init Config Mode bit 1</span>
<span class="cm">	 * LSB BIT 6 = Init Config Mode bit 2</span>
<span class="cm">	 * LSB BIT 7 = Enable Non part on LIHA failure</span>
<span class="cm">	 *</span>
<span class="cm">	 * MSB BIT 0 = Enable class 2</span>
<span class="cm">	 * MSB BIT 1 = Enable ACK0</span>
<span class="cm">	 * MSB BIT 2 =</span>
<span class="cm">	 * MSB BIT 3 =</span>
<span class="cm">	 * MSB BIT 4 = FC Tape Enable</span>
<span class="cm">	 * MSB BIT 5 = Enable FC Confirm</span>
<span class="cm">	 * MSB BIT 6 = Enable command queuing in target mode</span>
<span class="cm">	 * MSB BIT 7 = No Logo On Link Down</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span>	 <span class="n">add_firmware_options</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="kt">uint8_t</span>	 <span class="n">response_accumulation_timer</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">interrupt_delay_timer</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * LSB BIT 0 = Enable Read xfr_rdy</span>
<span class="cm">	 * LSB BIT 1 = Soft ID only</span>
<span class="cm">	 * LSB BIT 2 =</span>
<span class="cm">	 * LSB BIT 3 =</span>
<span class="cm">	 * LSB BIT 4 = FCP RSP Payload [0]</span>
<span class="cm">	 * LSB BIT 5 = FCP RSP Payload [1] / Sbus enable - 2200</span>
<span class="cm">	 * LSB BIT 6 = Enable Out-of-Order frame handling</span>
<span class="cm">	 * LSB BIT 7 = Disable Automatic PLOGI on Local Loop</span>
<span class="cm">	 *</span>
<span class="cm">	 * MSB BIT 0 = Sbus enable - 2300</span>
<span class="cm">	 * MSB BIT 1 =</span>
<span class="cm">	 * MSB BIT 2 =</span>
<span class="cm">	 * MSB BIT 3 =</span>
<span class="cm">	 * MSB BIT 4 = LED mode</span>
<span class="cm">	 * MSB BIT 5 = enable 50 ohm termination</span>
<span class="cm">	 * MSB BIT 6 = Data Rate (2300 only)</span>
<span class="cm">	 * MSB BIT 7 = Data Rate (2300 only)</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span>	 <span class="n">special_options</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="kt">uint8_t</span>  <span class="n">reserved_3</span><span class="p">[</span><span class="mi">26</span><span class="p">];</span>
<span class="p">}</span> <span class="n">init_cb_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Get Link Status mailbox command return buffer.</span>
<span class="cm"> */</span>
<span class="cp">#define GLSO_SEND_RPS	BIT_0</span>
<span class="cp">#define GLSO_USE_DID	BIT_3</span>

<span class="k">struct</span> <span class="n">link_statistics</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">link_fail_cnt</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">loss_sync_cnt</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">loss_sig_cnt</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">prim_seq_err_cnt</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">inval_xmit_word_cnt</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">inval_crc_cnt</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">lip_cnt</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">unused1</span><span class="p">[</span><span class="mh">0x1a</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">tx_frames</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">rx_frames</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">dumped_frames</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">unused2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">nos_rcvd</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * NVRAM Command values.</span>
<span class="cm"> */</span>
<span class="cp">#define NV_START_BIT            BIT_2</span>
<span class="cp">#define NV_WRITE_OP             (BIT_26+BIT_24)</span>
<span class="cp">#define NV_READ_OP              (BIT_26+BIT_25)</span>
<span class="cp">#define NV_ERASE_OP             (BIT_26+BIT_25+BIT_24)</span>
<span class="cp">#define NV_MASK_OP              (BIT_26+BIT_25+BIT_24)</span>
<span class="cp">#define NV_DELAY_COUNT          10</span>

<span class="cm">/*</span>
<span class="cm"> * QLogic ISP2100, ISP2200 and ISP2300 NVRAM structure definition.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * NVRAM header</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span>	<span class="n">id</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">uint8_t</span>	<span class="n">nvram_version</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	<span class="n">reserved_0</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * NVRAM RISC parameter block</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span>	<span class="n">parameter_block_version</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	<span class="n">reserved_1</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * LSB BIT 0  = Enable Hard Loop Id</span>
<span class="cm">	 * LSB BIT 1  = Enable Fairness</span>
<span class="cm">	 * LSB BIT 2  = Enable Full-Duplex</span>
<span class="cm">	 * LSB BIT 3  = Enable Fast Posting</span>
<span class="cm">	 * LSB BIT 4  = Enable Target Mode</span>
<span class="cm">	 * LSB BIT 5  = Disable Initiator Mode</span>
<span class="cm">	 * LSB BIT 6  = Enable ADISC</span>
<span class="cm">	 * LSB BIT 7  = Enable Target Inquiry Data</span>
<span class="cm">	 *</span>
<span class="cm">	 * MSB BIT 0  = Enable PDBC Notify</span>
<span class="cm">	 * MSB BIT 1  = Non Participating LIP</span>
<span class="cm">	 * MSB BIT 2  = Descending Loop ID Search</span>
<span class="cm">	 * MSB BIT 3  = Acquire Loop ID in LIPA</span>
<span class="cm">	 * MSB BIT 4  = Stop PortQ on Full Status</span>
<span class="cm">	 * MSB BIT 5  = Full Login after LIP</span>
<span class="cm">	 * MSB BIT 6  = Node Name Option</span>
<span class="cm">	 * MSB BIT 7  = Ext IFWCB enable bit</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span>	 <span class="n">firmware_options</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="kt">uint16_t</span> <span class="n">frame_payload_size</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">max_iocb_allocation</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">execution_throttle</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">retry_count</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">retry_delay</span><span class="p">;</span>			<span class="cm">/* unused */</span>
	<span class="kt">uint8_t</span>	 <span class="n">port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>		<span class="cm">/* Big endian. */</span>
	<span class="kt">uint16_t</span> <span class="n">hard_address</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">inquiry_data</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">login_timeout</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>		<span class="cm">/* Big endian. */</span>

	<span class="cm">/*</span>
<span class="cm">	 * LSB BIT 0 = Timer Operation mode bit 0</span>
<span class="cm">	 * LSB BIT 1 = Timer Operation mode bit 1</span>
<span class="cm">	 * LSB BIT 2 = Timer Operation mode bit 2</span>
<span class="cm">	 * LSB BIT 3 = Timer Operation mode bit 3</span>
<span class="cm">	 * LSB BIT 4 = Init Config Mode bit 0</span>
<span class="cm">	 * LSB BIT 5 = Init Config Mode bit 1</span>
<span class="cm">	 * LSB BIT 6 = Init Config Mode bit 2</span>
<span class="cm">	 * LSB BIT 7 = Enable Non part on LIHA failure</span>
<span class="cm">	 *</span>
<span class="cm">	 * MSB BIT 0 = Enable class 2</span>
<span class="cm">	 * MSB BIT 1 = Enable ACK0</span>
<span class="cm">	 * MSB BIT 2 =</span>
<span class="cm">	 * MSB BIT 3 =</span>
<span class="cm">	 * MSB BIT 4 = FC Tape Enable</span>
<span class="cm">	 * MSB BIT 5 = Enable FC Confirm</span>
<span class="cm">	 * MSB BIT 6 = Enable command queuing in target mode</span>
<span class="cm">	 * MSB BIT 7 = No Logo On Link Down</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span>	 <span class="n">add_firmware_options</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="kt">uint8_t</span>	 <span class="n">response_accumulation_timer</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">interrupt_delay_timer</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * LSB BIT 0 = Enable Read xfr_rdy</span>
<span class="cm">	 * LSB BIT 1 = Soft ID only</span>
<span class="cm">	 * LSB BIT 2 =</span>
<span class="cm">	 * LSB BIT 3 =</span>
<span class="cm">	 * LSB BIT 4 = FCP RSP Payload [0]</span>
<span class="cm">	 * LSB BIT 5 = FCP RSP Payload [1] / Sbus enable - 2200</span>
<span class="cm">	 * LSB BIT 6 = Enable Out-of-Order frame handling</span>
<span class="cm">	 * LSB BIT 7 = Disable Automatic PLOGI on Local Loop</span>
<span class="cm">	 *</span>
<span class="cm">	 * MSB BIT 0 = Sbus enable - 2300</span>
<span class="cm">	 * MSB BIT 1 =</span>
<span class="cm">	 * MSB BIT 2 =</span>
<span class="cm">	 * MSB BIT 3 =</span>
<span class="cm">	 * MSB BIT 4 = LED mode</span>
<span class="cm">	 * MSB BIT 5 = enable 50 ohm termination</span>
<span class="cm">	 * MSB BIT 6 = Data Rate (2300 only)</span>
<span class="cm">	 * MSB BIT 7 = Data Rate (2300 only)</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span>	 <span class="n">special_options</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* Reserved for expanded RISC parameter block */</span>
	<span class="kt">uint8_t</span> <span class="n">reserved_2</span><span class="p">[</span><span class="mi">22</span><span class="p">];</span>

	<span class="cm">/*</span>
<span class="cm">	 * LSB BIT 0 = Tx Sensitivity 1G bit 0</span>
<span class="cm">	 * LSB BIT 1 = Tx Sensitivity 1G bit 1</span>
<span class="cm">	 * LSB BIT 2 = Tx Sensitivity 1G bit 2</span>
<span class="cm">	 * LSB BIT 3 = Tx Sensitivity 1G bit 3</span>
<span class="cm">	 * LSB BIT 4 = Rx Sensitivity 1G bit 0</span>
<span class="cm">	 * LSB BIT 5 = Rx Sensitivity 1G bit 1</span>
<span class="cm">	 * LSB BIT 6 = Rx Sensitivity 1G bit 2</span>
<span class="cm">	 * LSB BIT 7 = Rx Sensitivity 1G bit 3</span>
<span class="cm">	 *</span>
<span class="cm">	 * MSB BIT 0 = Tx Sensitivity 2G bit 0</span>
<span class="cm">	 * MSB BIT 1 = Tx Sensitivity 2G bit 1</span>
<span class="cm">	 * MSB BIT 2 = Tx Sensitivity 2G bit 2</span>
<span class="cm">	 * MSB BIT 3 = Tx Sensitivity 2G bit 3</span>
<span class="cm">	 * MSB BIT 4 = Rx Sensitivity 2G bit 0</span>
<span class="cm">	 * MSB BIT 5 = Rx Sensitivity 2G bit 1</span>
<span class="cm">	 * MSB BIT 6 = Rx Sensitivity 2G bit 2</span>
<span class="cm">	 * MSB BIT 7 = Rx Sensitivity 2G bit 3</span>
<span class="cm">	 *</span>
<span class="cm">	 * LSB BIT 0 = Output Swing 1G bit 0</span>
<span class="cm">	 * LSB BIT 1 = Output Swing 1G bit 1</span>
<span class="cm">	 * LSB BIT 2 = Output Swing 1G bit 2</span>
<span class="cm">	 * LSB BIT 3 = Output Emphasis 1G bit 0</span>
<span class="cm">	 * LSB BIT 4 = Output Emphasis 1G bit 1</span>
<span class="cm">	 * LSB BIT 5 = Output Swing 2G bit 0</span>
<span class="cm">	 * LSB BIT 6 = Output Swing 2G bit 1</span>
<span class="cm">	 * LSB BIT 7 = Output Swing 2G bit 2</span>
<span class="cm">	 *</span>
<span class="cm">	 * MSB BIT 0 = Output Emphasis 2G bit 0</span>
<span class="cm">	 * MSB BIT 1 = Output Emphasis 2G bit 1</span>
<span class="cm">	 * MSB BIT 2 = Output Enable</span>
<span class="cm">	 * MSB BIT 3 =</span>
<span class="cm">	 * MSB BIT 4 =</span>
<span class="cm">	 * MSB BIT 5 =</span>
<span class="cm">	 * MSB BIT 6 =</span>
<span class="cm">	 * MSB BIT 7 =</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span> <span class="n">seriallink_options</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

	<span class="cm">/*</span>
<span class="cm">	 * NVRAM host parameter block</span>
<span class="cm">	 *</span>
<span class="cm">	 * LSB BIT 0 = Enable spinup delay</span>
<span class="cm">	 * LSB BIT 1 = Disable BIOS</span>
<span class="cm">	 * LSB BIT 2 = Enable Memory Map BIOS</span>
<span class="cm">	 * LSB BIT 3 = Enable Selectable Boot</span>
<span class="cm">	 * LSB BIT 4 = Disable RISC code load</span>
<span class="cm">	 * LSB BIT 5 = Set cache line size 1</span>
<span class="cm">	 * LSB BIT 6 = PCI Parity Disable</span>
<span class="cm">	 * LSB BIT 7 = Enable extended logging</span>
<span class="cm">	 *</span>
<span class="cm">	 * MSB BIT 0 = Enable 64bit addressing</span>
<span class="cm">	 * MSB BIT 1 = Enable lip reset</span>
<span class="cm">	 * MSB BIT 2 = Enable lip full login</span>
<span class="cm">	 * MSB BIT 3 = Enable target reset</span>
<span class="cm">	 * MSB BIT 4 = Enable database storage</span>
<span class="cm">	 * MSB BIT 5 = Enable cache flush read</span>
<span class="cm">	 * MSB BIT 6 = Enable database load</span>
<span class="cm">	 * MSB BIT 7 = Enable alternate WWN</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span> <span class="n">host_p</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="kt">uint8_t</span> <span class="n">boot_node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">boot_lun_number</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">reset_delay</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">port_down_retry_count</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">boot_id_number</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">max_luns_per_target</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">fcode_boot_port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">alternate_port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">alternate_node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>

	<span class="cm">/*</span>
<span class="cm">	 * BIT 0 = Selective Login</span>
<span class="cm">	 * BIT 1 = Alt-Boot Enable</span>
<span class="cm">	 * BIT 2 =</span>
<span class="cm">	 * BIT 3 = Boot Order List</span>
<span class="cm">	 * BIT 4 =</span>
<span class="cm">	 * BIT 5 = Selective LUN</span>
<span class="cm">	 * BIT 6 =</span>
<span class="cm">	 * BIT 7 = unused</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span> <span class="n">efi_parameters</span><span class="p">;</span>

	<span class="kt">uint8_t</span> <span class="n">link_down_timeout</span><span class="p">;</span>

	<span class="kt">uint8_t</span> <span class="n">adapter_id</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="kt">uint8_t</span> <span class="n">alt1_boot_node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint16_t</span> <span class="n">alt1_boot_lun_number</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">alt2_boot_node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint16_t</span> <span class="n">alt2_boot_lun_number</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">alt3_boot_node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint16_t</span> <span class="n">alt3_boot_lun_number</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">alt4_boot_node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint16_t</span> <span class="n">alt4_boot_lun_number</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">alt5_boot_node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint16_t</span> <span class="n">alt5_boot_lun_number</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">alt6_boot_node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint16_t</span> <span class="n">alt6_boot_lun_number</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">alt7_boot_node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint16_t</span> <span class="n">alt7_boot_lun_number</span><span class="p">;</span>

	<span class="kt">uint8_t</span> <span class="n">reserved_3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* Offset 200-215 : Model Number */</span>
	<span class="kt">uint8_t</span> <span class="n">model_number</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="cm">/* OEM related items */</span>
	<span class="kt">uint8_t</span> <span class="n">oem_specific</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="cm">/*</span>
<span class="cm">	 * NVRAM Adapter Features offset 232-239</span>
<span class="cm">	 *</span>
<span class="cm">	 * LSB BIT 0 = External GBIC</span>
<span class="cm">	 * LSB BIT 1 = Risc RAM parity</span>
<span class="cm">	 * LSB BIT 2 = Buffer Plus Module</span>
<span class="cm">	 * LSB BIT 3 = Multi Chip Adapter</span>
<span class="cm">	 * LSB BIT 4 = Internal connector</span>
<span class="cm">	 * LSB BIT 5 =</span>
<span class="cm">	 * LSB BIT 6 =</span>
<span class="cm">	 * LSB BIT 7 =</span>
<span class="cm">	 *</span>
<span class="cm">	 * MSB BIT 0 =</span>
<span class="cm">	 * MSB BIT 1 =</span>
<span class="cm">	 * MSB BIT 2 =</span>
<span class="cm">	 * MSB BIT 3 =</span>
<span class="cm">	 * MSB BIT 4 =</span>
<span class="cm">	 * MSB BIT 5 =</span>
<span class="cm">	 * MSB BIT 6 =</span>
<span class="cm">	 * MSB BIT 7 =</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span>	<span class="n">adapter_features</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="kt">uint8_t</span> <span class="n">reserved_4</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="cm">/* Subsystem vendor ID for ISP2200 */</span>
	<span class="kt">uint16_t</span> <span class="n">subsystem_vendor_id_2200</span><span class="p">;</span>

	<span class="cm">/* Subsystem device ID for ISP2200 */</span>
	<span class="kt">uint16_t</span> <span class="n">subsystem_device_id_2200</span><span class="p">;</span>

	<span class="kt">uint8_t</span>	 <span class="n">reserved_5</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	 <span class="n">checksum</span><span class="p">;</span>
<span class="p">}</span> <span class="n">nvram_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue - response queue entry definition.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span>		<span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span>		<span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span>		<span class="n">sys_define</span><span class="p">;</span>		<span class="cm">/* System defined. */</span>
	<span class="kt">uint8_t</span>		<span class="n">entry_status</span><span class="p">;</span>		<span class="cm">/* Entry Status. */</span>
	<span class="kt">uint32_t</span>	<span class="n">handle</span><span class="p">;</span>			<span class="cm">/* System defined handle */</span>
	<span class="kt">uint8_t</span>		<span class="n">data</span><span class="p">[</span><span class="mi">52</span><span class="p">];</span>
	<span class="kt">uint32_t</span>	<span class="n">signature</span><span class="p">;</span>
<span class="cp">#define RESPONSE_PROCESSED	0xDEADDEAD	</span><span class="cm">/* Signature */</span><span class="cp"></span>
<span class="p">}</span> <span class="n">response_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue - ATIO queue entry definition.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">atio</span> <span class="p">{</span>
	<span class="kt">uint8_t</span>		<span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span>		<span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span>		<span class="n">data</span><span class="p">[</span><span class="mi">58</span><span class="p">];</span>
	<span class="kt">uint32_t</span>	<span class="n">signature</span><span class="p">;</span>
<span class="cp">#define ATIO_PROCESSED 0xDEADDEAD		</span><span class="cm">/* Signature */</span><span class="cp"></span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
	<span class="kt">uint16_t</span> <span class="n">extended</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">uint8_t</span> <span class="n">reserved</span><span class="p">;</span>
		<span class="kt">uint8_t</span> <span class="n">standard</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">id</span><span class="p">;</span>
<span class="p">}</span> <span class="n">target_id_t</span><span class="p">;</span>

<span class="cp">#define SET_TARGET_ID(ha, to, from)			\</span>
<span class="cp">do {							\</span>
<span class="cp">	if (HAS_EXTENDED_IDS(ha))			\</span>
<span class="cp">		to.extended = cpu_to_le16(from);	\</span>
<span class="cp">	else						\</span>
<span class="cp">		to.id.standard = (uint8_t)from;		\</span>
<span class="cp">} while (0)</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue - command entry structure definition.</span>
<span class="cm"> */</span>
<span class="cp">#define COMMAND_TYPE	0x11		</span><span class="cm">/* Command entry */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span> <span class="n">sys_define</span><span class="p">;</span>		<span class="cm">/* System defined. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_status</span><span class="p">;</span>		<span class="cm">/* Entry Status. */</span>
	<span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">;</span>		<span class="cm">/* System handle. */</span>
	<span class="n">target_id_t</span> <span class="n">target</span><span class="p">;</span>		<span class="cm">/* SCSI ID */</span>
	<span class="kt">uint16_t</span> <span class="n">lun</span><span class="p">;</span>			<span class="cm">/* SCSI LUN */</span>
	<span class="kt">uint16_t</span> <span class="n">control_flags</span><span class="p">;</span>		<span class="cm">/* Control flags. */</span>
<span class="cp">#define CF_WRITE	BIT_6</span>
<span class="cp">#define CF_READ		BIT_5</span>
<span class="cp">#define CF_SIMPLE_TAG	BIT_3</span>
<span class="cp">#define CF_ORDERED_TAG	BIT_2</span>
<span class="cp">#define CF_HEAD_TAG	BIT_1</span>
	<span class="kt">uint16_t</span> <span class="n">reserved_1</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">timeout</span><span class="p">;</span>		<span class="cm">/* Command timeout. */</span>
	<span class="kt">uint16_t</span> <span class="n">dseg_count</span><span class="p">;</span>		<span class="cm">/* Data segment count. */</span>
	<span class="kt">uint8_t</span> <span class="n">scsi_cdb</span><span class="p">[</span><span class="n">MAX_CMDSZ</span><span class="p">];</span> 	<span class="cm">/* SCSI command words. */</span>
	<span class="kt">uint32_t</span> <span class="n">byte_count</span><span class="p">;</span>		<span class="cm">/* Total byte count. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_0_address</span><span class="p">;</span>	<span class="cm">/* Data segment 0 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_0_length</span><span class="p">;</span>		<span class="cm">/* Data segment 0 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_1_address</span><span class="p">;</span>	<span class="cm">/* Data segment 1 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_1_length</span><span class="p">;</span>		<span class="cm">/* Data segment 1 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_2_address</span><span class="p">;</span>	<span class="cm">/* Data segment 2 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_2_length</span><span class="p">;</span>		<span class="cm">/* Data segment 2 length. */</span>
<span class="p">}</span> <span class="n">cmd_entry_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue - 64-Bit addressing, command entry structure definition.</span>
<span class="cm"> */</span>
<span class="cp">#define COMMAND_A64_TYPE	0x19	</span><span class="cm">/* Command A64 entry */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span> <span class="n">sys_define</span><span class="p">;</span>		<span class="cm">/* System defined. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_status</span><span class="p">;</span>		<span class="cm">/* Entry Status. */</span>
	<span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">;</span>		<span class="cm">/* System handle. */</span>
	<span class="n">target_id_t</span> <span class="n">target</span><span class="p">;</span>		<span class="cm">/* SCSI ID */</span>
	<span class="kt">uint16_t</span> <span class="n">lun</span><span class="p">;</span>			<span class="cm">/* SCSI LUN */</span>
	<span class="kt">uint16_t</span> <span class="n">control_flags</span><span class="p">;</span>		<span class="cm">/* Control flags. */</span>
	<span class="kt">uint16_t</span> <span class="n">reserved_1</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">timeout</span><span class="p">;</span>		<span class="cm">/* Command timeout. */</span>
	<span class="kt">uint16_t</span> <span class="n">dseg_count</span><span class="p">;</span>		<span class="cm">/* Data segment count. */</span>
	<span class="kt">uint8_t</span> <span class="n">scsi_cdb</span><span class="p">[</span><span class="n">MAX_CMDSZ</span><span class="p">];</span>	<span class="cm">/* SCSI command words. */</span>
	<span class="kt">uint32_t</span> <span class="n">byte_count</span><span class="p">;</span>		<span class="cm">/* Total byte count. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_0_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Data segment 0 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_0_length</span><span class="p">;</span>		<span class="cm">/* Data segment 0 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_1_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Data segment 1 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_1_length</span><span class="p">;</span>		<span class="cm">/* Data segment 1 length. */</span>
<span class="p">}</span> <span class="n">cmd_a64_entry_t</span><span class="p">,</span> <span class="n">request_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue - continuation entry structure definition.</span>
<span class="cm"> */</span>
<span class="cp">#define CONTINUE_TYPE		0x02	</span><span class="cm">/* Continuation entry. */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span> <span class="n">sys_define</span><span class="p">;</span>		<span class="cm">/* System defined. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_status</span><span class="p">;</span>		<span class="cm">/* Entry Status. */</span>
	<span class="kt">uint32_t</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_0_address</span><span class="p">;</span>	<span class="cm">/* Data segment 0 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_0_length</span><span class="p">;</span>		<span class="cm">/* Data segment 0 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_1_address</span><span class="p">;</span>	<span class="cm">/* Data segment 1 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_1_length</span><span class="p">;</span>		<span class="cm">/* Data segment 1 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_2_address</span><span class="p">;</span>	<span class="cm">/* Data segment 2 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_2_length</span><span class="p">;</span>		<span class="cm">/* Data segment 2 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_3_address</span><span class="p">;</span>	<span class="cm">/* Data segment 3 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_3_length</span><span class="p">;</span>		<span class="cm">/* Data segment 3 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_4_address</span><span class="p">;</span>	<span class="cm">/* Data segment 4 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_4_length</span><span class="p">;</span>		<span class="cm">/* Data segment 4 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_5_address</span><span class="p">;</span>	<span class="cm">/* Data segment 5 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_5_length</span><span class="p">;</span>		<span class="cm">/* Data segment 5 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_6_address</span><span class="p">;</span>	<span class="cm">/* Data segment 6 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_6_length</span><span class="p">;</span>		<span class="cm">/* Data segment 6 length. */</span>
<span class="p">}</span> <span class="n">cont_entry_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue - 64-Bit addressing, continuation entry structure definition.</span>
<span class="cm"> */</span>
<span class="cp">#define CONTINUE_A64_TYPE	0x0A	</span><span class="cm">/* Continuation A64 entry. */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span> <span class="n">sys_define</span><span class="p">;</span>		<span class="cm">/* System defined. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_status</span><span class="p">;</span>		<span class="cm">/* Entry Status. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_0_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Data segment 0 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_0_length</span><span class="p">;</span>		<span class="cm">/* Data segment 0 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_1_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Data segment 1 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_1_length</span><span class="p">;</span>		<span class="cm">/* Data segment 1 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_2_address</span>	<span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Data segment 2 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_2_length</span><span class="p">;</span>		<span class="cm">/* Data segment 2 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_3_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Data segment 3 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_3_length</span><span class="p">;</span>		<span class="cm">/* Data segment 3 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_4_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Data segment 4 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_4_length</span><span class="p">;</span>		<span class="cm">/* Data segment 4 length. */</span>
<span class="p">}</span> <span class="n">cont_a64_entry_t</span><span class="p">;</span>

<span class="cp">#define PO_MODE_DIF_INSERT	0</span>
<span class="cp">#define PO_MODE_DIF_REMOVE	BIT_0</span>
<span class="cp">#define PO_MODE_DIF_PASS	BIT_1</span>
<span class="cp">#define PO_MODE_DIF_REPLACE	(BIT_0 + BIT_1)</span>
<span class="cp">#define PO_ENABLE_DIF_BUNDLING	BIT_8</span>
<span class="cp">#define PO_ENABLE_INCR_GUARD_SEED	BIT_3</span>
<span class="cp">#define PO_DISABLE_INCR_REF_TAG	BIT_5</span>
<span class="cp">#define PO_DISABLE_GUARD_CHECK	BIT_4</span>
<span class="cm">/*</span>
<span class="cm"> * ISP queue - 64-Bit addressing, continuation crc entry structure definition.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">crc_context</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">;</span>		<span class="cm">/* System handle. */</span>
	<span class="kt">uint32_t</span> <span class="n">ref_tag</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">app_tag</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">ref_tag_mask</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* Validation/Replacement Mask*/</span>
	<span class="kt">uint8_t</span> <span class="n">app_tag_mask</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Validation/Replacement Mask*/</span>
	<span class="kt">uint16_t</span> <span class="n">guard_seed</span><span class="p">;</span>		<span class="cm">/* Initial Guard Seed */</span>
	<span class="kt">uint16_t</span> <span class="n">prot_opts</span><span class="p">;</span>		<span class="cm">/* Requested Data Protection Mode */</span>
	<span class="kt">uint16_t</span> <span class="n">blk_size</span><span class="p">;</span>		<span class="cm">/* Data size in bytes */</span>
	<span class="kt">uint16_t</span> <span class="n">runt_blk_guard</span><span class="p">;</span>	<span class="cm">/* Guard value for runt block (tape</span>
<span class="cm">					 * only) */</span>
	<span class="kt">uint32_t</span> <span class="n">byte_count</span><span class="p">;</span>		<span class="cm">/* Total byte count/ total data</span>
<span class="cm">					 * transfer count */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint32_t</span>	<span class="n">reserved_1</span><span class="p">;</span>
			<span class="kt">uint16_t</span>	<span class="n">reserved_2</span><span class="p">;</span>
			<span class="kt">uint16_t</span>	<span class="n">reserved_3</span><span class="p">;</span>
			<span class="kt">uint32_t</span>	<span class="n">reserved_4</span><span class="p">;</span>
			<span class="kt">uint32_t</span>	<span class="n">data_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="kt">uint32_t</span>	<span class="n">data_length</span><span class="p">;</span>
			<span class="kt">uint32_t</span>	<span class="n">reserved_5</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="kt">uint32_t</span>	<span class="n">reserved_6</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">nobundling</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint32_t</span>	<span class="n">dif_byte_count</span><span class="p">;</span>	<span class="cm">/* Total DIF byte</span>
<span class="cm">							 * count */</span>
			<span class="kt">uint16_t</span>	<span class="n">reserved_1</span><span class="p">;</span>
			<span class="kt">uint16_t</span>	<span class="n">dseg_count</span><span class="p">;</span>	<span class="cm">/* Data segment count */</span>
			<span class="kt">uint32_t</span>	<span class="n">reserved_2</span><span class="p">;</span>
			<span class="kt">uint32_t</span>	<span class="n">data_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="kt">uint32_t</span>	<span class="n">data_length</span><span class="p">;</span>
			<span class="kt">uint32_t</span>	<span class="n">dif_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="kt">uint32_t</span>	<span class="n">dif_length</span><span class="p">;</span>	<span class="cm">/* Data segment 0</span>
<span class="cm">							 * length */</span>
		<span class="p">}</span> <span class="n">bundling</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">fcp_cmnd</span>	<span class="n">fcp_cmnd</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">crc_ctx_dma</span><span class="p">;</span>
	<span class="cm">/* List of DMA context transfers */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">dsd_list</span><span class="p">;</span>

	<span class="cm">/* This structure should not exceed 512 bytes */</span>
<span class="p">};</span>

<span class="cp">#define CRC_CONTEXT_LEN_FW	(offsetof(struct crc_context, fcp_cmnd.lun))</span>
<span class="cp">#define CRC_CONTEXT_FCPCMND_OFF	(offsetof(struct crc_context, fcp_cmnd.lun))</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue - status entry structure definition.</span>
<span class="cm"> */</span>
<span class="cp">#define	STATUS_TYPE	0x03		</span><span class="cm">/* Status entry. */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span> <span class="n">sys_define</span><span class="p">;</span>		<span class="cm">/* System defined. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_status</span><span class="p">;</span>		<span class="cm">/* Entry Status. */</span>
	<span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">;</span>		<span class="cm">/* System handle. */</span>
	<span class="kt">uint16_t</span> <span class="n">scsi_status</span><span class="p">;</span>		<span class="cm">/* SCSI status. */</span>
	<span class="kt">uint16_t</span> <span class="n">comp_status</span><span class="p">;</span>		<span class="cm">/* Completion status. */</span>
	<span class="kt">uint16_t</span> <span class="n">state_flags</span><span class="p">;</span>		<span class="cm">/* State flags. */</span>
	<span class="kt">uint16_t</span> <span class="n">status_flags</span><span class="p">;</span>		<span class="cm">/* Status flags. */</span>
	<span class="kt">uint16_t</span> <span class="n">rsp_info_len</span><span class="p">;</span>		<span class="cm">/* Response Info Length. */</span>
	<span class="kt">uint16_t</span> <span class="n">req_sense_length</span><span class="p">;</span>	<span class="cm">/* Request sense data length. */</span>
	<span class="kt">uint32_t</span> <span class="n">residual_length</span><span class="p">;</span>	<span class="cm">/* Residual transfer length. */</span>
	<span class="kt">uint8_t</span> <span class="n">rsp_info</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>		<span class="cm">/* FCP response information. */</span>
	<span class="kt">uint8_t</span> <span class="n">req_sense_data</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>	<span class="cm">/* Request sense data. */</span>
<span class="p">}</span> <span class="n">sts_entry_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Status entry entry status</span>
<span class="cm"> */</span>
<span class="cp">#define RF_RQ_DMA_ERROR	BIT_6		</span><span class="cm">/* Request Queue DMA error. */</span><span class="cp"></span>
<span class="cp">#define RF_INV_E_ORDER	BIT_5		</span><span class="cm">/* Invalid entry order. */</span><span class="cp"></span>
<span class="cp">#define RF_INV_E_COUNT	BIT_4		</span><span class="cm">/* Invalid entry count. */</span><span class="cp"></span>
<span class="cp">#define RF_INV_E_PARAM	BIT_3		</span><span class="cm">/* Invalid entry parameter. */</span><span class="cp"></span>
<span class="cp">#define RF_INV_E_TYPE	BIT_2		</span><span class="cm">/* Invalid entry type. */</span><span class="cp"></span>
<span class="cp">#define RF_BUSY		BIT_1		</span><span class="cm">/* Busy */</span><span class="cp"></span>
<span class="cp">#define RF_MASK		(RF_RQ_DMA_ERROR | RF_INV_E_ORDER | RF_INV_E_COUNT | \</span>
<span class="cp">			 RF_INV_E_PARAM | RF_INV_E_TYPE | RF_BUSY)</span>
<span class="cp">#define RF_MASK_24XX	(RF_INV_E_ORDER | RF_INV_E_COUNT | RF_INV_E_PARAM | \</span>
<span class="cp">			 RF_INV_E_TYPE)</span>

<span class="cm">/*</span>
<span class="cm"> * Status entry SCSI status bit definitions.</span>
<span class="cm"> */</span>
<span class="cp">#define SS_MASK				0xfff	</span><span class="cm">/* Reserved bits BIT_12-BIT_15*/</span><span class="cp"></span>
<span class="cp">#define SS_RESIDUAL_UNDER		BIT_11</span>
<span class="cp">#define SS_RESIDUAL_OVER		BIT_10</span>
<span class="cp">#define SS_SENSE_LEN_VALID		BIT_9</span>
<span class="cp">#define SS_RESPONSE_INFO_LEN_VALID	BIT_8</span>

<span class="cp">#define SS_RESERVE_CONFLICT		(BIT_4 | BIT_3)</span>
<span class="cp">#define SS_BUSY_CONDITION		BIT_3</span>
<span class="cp">#define SS_CONDITION_MET		BIT_2</span>
<span class="cp">#define SS_CHECK_CONDITION		BIT_1</span>

<span class="cm">/*</span>
<span class="cm"> * Status entry completion status</span>
<span class="cm"> */</span>
<span class="cp">#define CS_COMPLETE		0x0	</span><span class="cm">/* No errors */</span><span class="cp"></span>
<span class="cp">#define CS_INCOMPLETE		0x1	</span><span class="cm">/* Incomplete transfer of cmd. */</span><span class="cp"></span>
<span class="cp">#define CS_DMA			0x2	</span><span class="cm">/* A DMA direction error. */</span><span class="cp"></span>
<span class="cp">#define CS_TRANSPORT		0x3	</span><span class="cm">/* Transport error. */</span><span class="cp"></span>
<span class="cp">#define CS_RESET		0x4	</span><span class="cm">/* SCSI bus reset occurred */</span><span class="cp"></span>
<span class="cp">#define CS_ABORTED		0x5	</span><span class="cm">/* System aborted command. */</span><span class="cp"></span>
<span class="cp">#define CS_TIMEOUT		0x6	</span><span class="cm">/* Timeout error. */</span><span class="cp"></span>
<span class="cp">#define CS_DATA_OVERRUN		0x7	</span><span class="cm">/* Data overrun. */</span><span class="cp"></span>
<span class="cp">#define CS_DIF_ERROR		0xC	</span><span class="cm">/* DIF error detected  */</span><span class="cp"></span>

<span class="cp">#define CS_DATA_UNDERRUN	0x15	</span><span class="cm">/* Data Underrun. */</span><span class="cp"></span>
<span class="cp">#define CS_QUEUE_FULL		0x1C	</span><span class="cm">/* Queue Full. */</span><span class="cp"></span>
<span class="cp">#define CS_PORT_UNAVAILABLE	0x28	</span><span class="cm">/* Port unavailable */</span><span class="cp"></span>
					<span class="cm">/* (selection timeout) */</span>
<span class="cp">#define CS_PORT_LOGGED_OUT	0x29	</span><span class="cm">/* Port Logged Out */</span><span class="cp"></span>
<span class="cp">#define CS_PORT_CONFIG_CHG	0x2A	</span><span class="cm">/* Port Configuration Changed */</span><span class="cp"></span>
<span class="cp">#define CS_PORT_BUSY		0x2B	</span><span class="cm">/* Port Busy */</span><span class="cp"></span>
<span class="cp">#define CS_COMPLETE_CHKCOND	0x30	</span><span class="cm">/* Error? */</span><span class="cp"></span>
<span class="cp">#define CS_BAD_PAYLOAD		0x80	</span><span class="cm">/* Driver defined */</span><span class="cp"></span>
<span class="cp">#define CS_UNKNOWN		0x81	</span><span class="cm">/* Driver defined */</span><span class="cp"></span>
<span class="cp">#define CS_RETRY		0x82	</span><span class="cm">/* Driver defined */</span><span class="cp"></span>
<span class="cp">#define CS_LOOP_DOWN_ABORT	0x83	</span><span class="cm">/* Driver defined */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Status entry status flags</span>
<span class="cm"> */</span>
<span class="cp">#define SF_ABTS_TERMINATED	BIT_10</span>
<span class="cp">#define SF_LOGOUT_SENT		BIT_13</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue - status continuation entry structure definition.</span>
<span class="cm"> */</span>
<span class="cp">#define	STATUS_CONT_TYPE	0x10	</span><span class="cm">/* Status continuation entry. */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span> <span class="n">sys_define</span><span class="p">;</span>		<span class="cm">/* System defined. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_status</span><span class="p">;</span>		<span class="cm">/* Entry Status. */</span>
	<span class="kt">uint8_t</span> <span class="n">data</span><span class="p">[</span><span class="mi">60</span><span class="p">];</span>		<span class="cm">/* data */</span>
<span class="p">}</span> <span class="n">sts_cont_entry_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue -	RIO Type 1 status entry (32 bit I/O entry handles)</span>
<span class="cm"> *		structure definition.</span>
<span class="cm"> */</span>
<span class="cp">#define	STATUS_TYPE_21 0x21		</span><span class="cm">/* Status entry. */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span> <span class="n">handle_count</span><span class="p">;</span>		<span class="cm">/* Handle count. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_status</span><span class="p">;</span>		<span class="cm">/* Entry Status. */</span>
	<span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>		<span class="cm">/* System handles. */</span>
<span class="p">}</span> <span class="n">sts21_entry_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue -	RIO Type 2 status entry (16 bit I/O entry handles)</span>
<span class="cm"> *		structure definition.</span>
<span class="cm"> */</span>
<span class="cp">#define	STATUS_TYPE_22	0x22		</span><span class="cm">/* Status entry. */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span> <span class="n">handle_count</span><span class="p">;</span>		<span class="cm">/* Handle count. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_status</span><span class="p">;</span>		<span class="cm">/* Entry Status. */</span>
	<span class="kt">uint16_t</span> <span class="n">handle</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>		<span class="cm">/* System handles. */</span>
<span class="p">}</span> <span class="n">sts22_entry_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue - marker entry structure definition.</span>
<span class="cm"> */</span>
<span class="cp">#define MARKER_TYPE	0x04		</span><span class="cm">/* Marker entry. */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span> <span class="n">handle_count</span><span class="p">;</span>		<span class="cm">/* Handle count. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_status</span><span class="p">;</span>		<span class="cm">/* Entry Status. */</span>
	<span class="kt">uint32_t</span> <span class="n">sys_define_2</span><span class="p">;</span>		<span class="cm">/* System defined. */</span>
	<span class="n">target_id_t</span> <span class="n">target</span><span class="p">;</span>		<span class="cm">/* SCSI ID */</span>
	<span class="kt">uint8_t</span> <span class="n">modifier</span><span class="p">;</span>		<span class="cm">/* Modifier (7-0). */</span>
<span class="cp">#define MK_SYNC_ID_LUN	0		</span><span class="cm">/* Synchronize ID/LUN */</span><span class="cp"></span>
<span class="cp">#define MK_SYNC_ID	1		</span><span class="cm">/* Synchronize ID */</span><span class="cp"></span>
<span class="cp">#define MK_SYNC_ALL	2		</span><span class="cm">/* Synchronize all ID/LUN */</span><span class="cp"></span>
<span class="cp">#define MK_SYNC_LIP	3		</span><span class="cm">/* Synchronize all ID/LUN, */</span><span class="cp"></span>
					<span class="cm">/* clear port changed, */</span>
					<span class="cm">/* use sequence number. */</span>
	<span class="kt">uint8_t</span> <span class="n">reserved_1</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">sequence_number</span><span class="p">;</span>	<span class="cm">/* Sequence number of event */</span>
	<span class="kt">uint16_t</span> <span class="n">lun</span><span class="p">;</span>			<span class="cm">/* SCSI LUN */</span>
	<span class="kt">uint8_t</span> <span class="n">reserved_2</span><span class="p">[</span><span class="mi">48</span><span class="p">];</span>
<span class="p">}</span> <span class="n">mrk_entry_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * ISP queue - Management Server entry structure definition.</span>
<span class="cm"> */</span>
<span class="cp">#define MS_IOCB_TYPE		0x29	</span><span class="cm">/* Management Server IOCB entry */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">entry_type</span><span class="p">;</span>		<span class="cm">/* Entry type. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_count</span><span class="p">;</span>		<span class="cm">/* Entry count. */</span>
	<span class="kt">uint8_t</span> <span class="n">handle_count</span><span class="p">;</span>		<span class="cm">/* Handle count. */</span>
	<span class="kt">uint8_t</span> <span class="n">entry_status</span><span class="p">;</span>		<span class="cm">/* Entry Status. */</span>
	<span class="kt">uint32_t</span> <span class="n">handle1</span><span class="p">;</span>		<span class="cm">/* System handle. */</span>
	<span class="n">target_id_t</span> <span class="n">loop_id</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">status</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">control_flags</span><span class="p">;</span>		<span class="cm">/* Control flags. */</span>
	<span class="kt">uint16_t</span> <span class="n">reserved2</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">timeout</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">cmd_dsd_count</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">total_dsd_count</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">r_ctl</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">rx_id</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">reserved3</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">handle2</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">rsp_bytecount</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">req_bytecount</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_req_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Data segment 0 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_req_length</span><span class="p">;</span>	<span class="cm">/* Data segment 0 length. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_rsp_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* Data segment 1 address. */</span>
	<span class="kt">uint32_t</span> <span class="n">dseg_rsp_length</span><span class="p">;</span>	<span class="cm">/* Data segment 1 length. */</span>
<span class="p">}</span> <span class="n">ms_iocb_entry_t</span><span class="p">;</span>


<span class="cm">/*</span>
<span class="cm"> * ISP queue - Mailbox Command entry structure definition.</span>
<span class="cm"> */</span>
<span class="cp">#define MBX_IOCB_TYPE	0x39</span>
<span class="k">struct</span> <span class="n">mbx_entry</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">entry_type</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">entry_count</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">sys_define1</span><span class="p">;</span>
	<span class="cm">/* Use sys_define1 for source type */</span>
<span class="cp">#define SOURCE_SCSI	0x00</span>
<span class="cp">#define SOURCE_IP	0x01</span>
<span class="cp">#define SOURCE_VI	0x02</span>
<span class="cp">#define SOURCE_SCTP	0x03</span>
<span class="cp">#define SOURCE_MP	0x04</span>
<span class="cp">#define SOURCE_MPIOCTL	0x05</span>
<span class="cp">#define SOURCE_ASYNC_IOCB 0x07</span>

	<span class="kt">uint8_t</span> <span class="n">entry_status</span><span class="p">;</span>

	<span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">;</span>
	<span class="n">target_id_t</span> <span class="n">loop_id</span><span class="p">;</span>

	<span class="kt">uint16_t</span> <span class="n">status</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">state_flags</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">status_flags</span><span class="p">;</span>

	<span class="kt">uint32_t</span> <span class="n">sys_define2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="kt">uint16_t</span> <span class="n">mb0</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">mb1</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">mb2</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">mb3</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">mb6</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">mb7</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">mb9</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">mb10</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">reserved_2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * ISP request and response queue entry sizes</span>
<span class="cm"> */</span>
<span class="cp">#define RESPONSE_ENTRY_SIZE	(sizeof(response_t))</span>
<span class="cp">#define REQUEST_ENTRY_SIZE	(sizeof(request_t))</span>


<span class="cm">/*</span>
<span class="cm"> * 24 bit port ID type definition.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">b24</span> <span class="o">:</span> <span class="mi">24</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
<span class="cp">#ifdef __BIG_ENDIAN</span>
		<span class="kt">uint8_t</span> <span class="n">domain</span><span class="p">;</span>
		<span class="kt">uint8_t</span> <span class="n">area</span><span class="p">;</span>
		<span class="kt">uint8_t</span> <span class="n">al_pa</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN)</span>
		<span class="kt">uint8_t</span> <span class="n">al_pa</span><span class="p">;</span>
		<span class="kt">uint8_t</span> <span class="n">area</span><span class="p">;</span>
		<span class="kt">uint8_t</span> <span class="n">domain</span><span class="p">;</span>
<span class="cp">#else</span>
<span class="cp">#error &quot;__BIG_ENDIAN or __LITTLE_ENDIAN must be defined!&quot;</span>
<span class="cp">#endif</span>
		<span class="kt">uint8_t</span> <span class="n">rsvd_1</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span> <span class="n">port_id_t</span><span class="p">;</span>
<span class="cp">#define INVALID_PORT_ID	0xFFFFFF</span>

<span class="cm">/*</span>
<span class="cm"> * Switch info gathering structure.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">port_id_t</span> <span class="n">d_id</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">fabric_port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint16_t</span> <span class="n">fp_speed</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">fc4_type</span><span class="p">;</span>
<span class="p">}</span> <span class="n">sw_info_t</span><span class="p">;</span>

<span class="cm">/* FCP-4 types */</span>
<span class="cp">#define FC4_TYPE_FCP_SCSI	0x08</span>
<span class="cp">#define FC4_TYPE_OTHER		0x0</span>
<span class="cp">#define FC4_TYPE_UNKNOWN	0xff</span>

<span class="cm">/*</span>
<span class="cm"> * Fibre channel port type.</span>
<span class="cm"> */</span>
 <span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">FCT_UNKNOWN</span><span class="p">,</span>
	<span class="n">FCT_RSCN</span><span class="p">,</span>
	<span class="n">FCT_SWITCH</span><span class="p">,</span>
	<span class="n">FCT_BROADCAST</span><span class="p">,</span>
	<span class="n">FCT_INITIATOR</span><span class="p">,</span>
	<span class="n">FCT_TARGET</span>
<span class="p">}</span> <span class="n">fc_port_type_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Fibre channel port structure.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">fc_port</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="n">vha</span><span class="p">;</span>

	<span class="kt">uint8_t</span> <span class="n">node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="n">port_id_t</span> <span class="n">d_id</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">loop_id</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">old_loop_id</span><span class="p">;</span>

	<span class="kt">uint8_t</span> <span class="n">fcp_prio</span><span class="p">;</span>

	<span class="kt">uint8_t</span> <span class="n">fabric_port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint16_t</span> <span class="n">fp_speed</span><span class="p">;</span>

	<span class="n">fc_port_type_t</span> <span class="n">port_type</span><span class="p">;</span>

	<span class="n">atomic_t</span> <span class="n">state</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">flags</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">login_retry</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">fc_rport</span> <span class="o">*</span><span class="n">rport</span><span class="p">,</span> <span class="o">*</span><span class="n">drport</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">supported_classes</span><span class="p">;</span>

	<span class="kt">uint8_t</span> <span class="n">fc4_type</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">scan_state</span><span class="p">;</span>
<span class="p">}</span> <span class="n">fc_port_t</span><span class="p">;</span>

<span class="cp">#define QLA_FCPORT_SCAN_NONE	0</span>
<span class="cp">#define QLA_FCPORT_SCAN_FOUND	1</span>

<span class="cm">/*</span>
<span class="cm"> * Fibre channel port/lun states.</span>
<span class="cm"> */</span>
<span class="cp">#define FCS_UNCONFIGURED	1</span>
<span class="cp">#define FCS_DEVICE_DEAD		2</span>
<span class="cp">#define FCS_DEVICE_LOST		3</span>
<span class="cp">#define FCS_ONLINE		4</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">port_state_str</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Unknown&quot;</span><span class="p">,</span>
	<span class="s">&quot;UNCONFIGURED&quot;</span><span class="p">,</span>
	<span class="s">&quot;DEAD&quot;</span><span class="p">,</span>
	<span class="s">&quot;LOST&quot;</span><span class="p">,</span>
	<span class="s">&quot;ONLINE&quot;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * FC port flags.</span>
<span class="cm"> */</span>
<span class="cp">#define FCF_FABRIC_DEVICE	BIT_0</span>
<span class="cp">#define FCF_LOGIN_NEEDED	BIT_1</span>
<span class="cp">#define FCF_FCP2_DEVICE		BIT_2</span>
<span class="cp">#define FCF_ASYNC_SENT		BIT_3</span>
<span class="cp">#define FCF_CONF_COMP_SUPPORTED BIT_4</span>

<span class="cm">/* No loop ID flag. */</span>
<span class="cp">#define FC_NO_LOOP_ID		0x1000</span>

<span class="cm">/*</span>
<span class="cm"> * FC-CT interface</span>
<span class="cm"> *</span>
<span class="cm"> * NOTE: All structures are big-endian in form.</span>
<span class="cm"> */</span>

<span class="cp">#define CT_REJECT_RESPONSE	0x8001</span>
<span class="cp">#define CT_ACCEPT_RESPONSE	0x8002</span>
<span class="cp">#define CT_REASON_INVALID_COMMAND_CODE	0x01</span>
<span class="cp">#define CT_REASON_CANNOT_PERFORM	0x09</span>
<span class="cp">#define CT_REASON_COMMAND_UNSUPPORTED	0x0b</span>
<span class="cp">#define CT_EXPL_ALREADY_REGISTERED	0x10</span>

<span class="cp">#define NS_N_PORT_TYPE	0x01</span>
<span class="cp">#define NS_NL_PORT_TYPE	0x02</span>
<span class="cp">#define NS_NX_PORT_TYPE	0x7F</span>

<span class="cp">#define	GA_NXT_CMD	0x100</span>
<span class="cp">#define	GA_NXT_REQ_SIZE	(16 + 4)</span>
<span class="cp">#define	GA_NXT_RSP_SIZE	(16 + 620)</span>

<span class="cp">#define	GID_PT_CMD	0x1A1</span>
<span class="cp">#define	GID_PT_REQ_SIZE	(16 + 4)</span>

<span class="cp">#define	GPN_ID_CMD	0x112</span>
<span class="cp">#define	GPN_ID_REQ_SIZE	(16 + 4)</span>
<span class="cp">#define	GPN_ID_RSP_SIZE	(16 + 8)</span>

<span class="cp">#define	GNN_ID_CMD	0x113</span>
<span class="cp">#define	GNN_ID_REQ_SIZE	(16 + 4)</span>
<span class="cp">#define	GNN_ID_RSP_SIZE	(16 + 8)</span>

<span class="cp">#define	GFT_ID_CMD	0x117</span>
<span class="cp">#define	GFT_ID_REQ_SIZE	(16 + 4)</span>
<span class="cp">#define	GFT_ID_RSP_SIZE	(16 + 32)</span>

<span class="cp">#define	RFT_ID_CMD	0x217</span>
<span class="cp">#define	RFT_ID_REQ_SIZE	(16 + 4 + 32)</span>
<span class="cp">#define	RFT_ID_RSP_SIZE	16</span>

<span class="cp">#define	RFF_ID_CMD	0x21F</span>
<span class="cp">#define	RFF_ID_REQ_SIZE	(16 + 4 + 2 + 1 + 1)</span>
<span class="cp">#define	RFF_ID_RSP_SIZE	16</span>

<span class="cp">#define	RNN_ID_CMD	0x213</span>
<span class="cp">#define	RNN_ID_REQ_SIZE	(16 + 4 + 8)</span>
<span class="cp">#define	RNN_ID_RSP_SIZE	16</span>

<span class="cp">#define	RSNN_NN_CMD	 0x239</span>
<span class="cp">#define	RSNN_NN_REQ_SIZE (16 + 8 + 1 + 255)</span>
<span class="cp">#define	RSNN_NN_RSP_SIZE 16</span>

<span class="cp">#define	GFPN_ID_CMD	0x11C</span>
<span class="cp">#define	GFPN_ID_REQ_SIZE (16 + 4)</span>
<span class="cp">#define	GFPN_ID_RSP_SIZE (16 + 8)</span>

<span class="cp">#define	GPSC_CMD	0x127</span>
<span class="cp">#define	GPSC_REQ_SIZE	(16 + 8)</span>
<span class="cp">#define	GPSC_RSP_SIZE	(16 + 2 + 2)</span>

<span class="cp">#define GFF_ID_CMD	0x011F</span>
<span class="cp">#define GFF_ID_REQ_SIZE	(16 + 4)</span>
<span class="cp">#define GFF_ID_RSP_SIZE (16 + 128)</span>

<span class="cm">/*</span>
<span class="cm"> * HBA attribute types.</span>
<span class="cm"> */</span>
<span class="cp">#define FDMI_HBA_ATTR_COUNT			9</span>
<span class="cp">#define FDMI_HBA_NODE_NAME			1</span>
<span class="cp">#define FDMI_HBA_MANUFACTURER			2</span>
<span class="cp">#define FDMI_HBA_SERIAL_NUMBER			3</span>
<span class="cp">#define FDMI_HBA_MODEL				4</span>
<span class="cp">#define FDMI_HBA_MODEL_DESCRIPTION		5</span>
<span class="cp">#define FDMI_HBA_HARDWARE_VERSION		6</span>
<span class="cp">#define FDMI_HBA_DRIVER_VERSION			7</span>
<span class="cp">#define FDMI_HBA_OPTION_ROM_VERSION		8</span>
<span class="cp">#define FDMI_HBA_FIRMWARE_VERSION		9</span>
<span class="cp">#define FDMI_HBA_OS_NAME_AND_VERSION		0xa</span>
<span class="cp">#define FDMI_HBA_MAXIMUM_CT_PAYLOAD_LENGTH	0xb</span>

<span class="k">struct</span> <span class="n">ct_fdmi_hba_attr</span> <span class="p">{</span>
	<span class="kt">uint16_t</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">len</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="kt">uint8_t</span> <span class="n">node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">manufacturer</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">serial_num</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">model</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">model_desc</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">hw_version</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">driver_version</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">orom_version</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">fw_version</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">os_version</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">max_ct_len</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">a</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ct_fdmi_hba_attributes</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ct_fdmi_hba_attr</span> <span class="n">entry</span><span class="p">[</span><span class="n">FDMI_HBA_ATTR_COUNT</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Port attribute types.</span>
<span class="cm"> */</span>
<span class="cp">#define FDMI_PORT_ATTR_COUNT		6</span>
<span class="cp">#define FDMI_PORT_FC4_TYPES		1</span>
<span class="cp">#define FDMI_PORT_SUPPORT_SPEED		2</span>
<span class="cp">#define FDMI_PORT_CURRENT_SPEED		3</span>
<span class="cp">#define FDMI_PORT_MAX_FRAME_SIZE	4</span>
<span class="cp">#define FDMI_PORT_OS_DEVICE_NAME	5</span>
<span class="cp">#define FDMI_PORT_HOST_NAME		6</span>

<span class="cp">#define FDMI_PORT_SPEED_1GB		0x1</span>
<span class="cp">#define FDMI_PORT_SPEED_2GB		0x2</span>
<span class="cp">#define FDMI_PORT_SPEED_10GB		0x4</span>
<span class="cp">#define FDMI_PORT_SPEED_4GB		0x8</span>
<span class="cp">#define FDMI_PORT_SPEED_8GB		0x10</span>
<span class="cp">#define FDMI_PORT_SPEED_16GB		0x20</span>
<span class="cp">#define FDMI_PORT_SPEED_UNKNOWN		0x8000</span>

<span class="k">struct</span> <span class="n">ct_fdmi_port_attr</span> <span class="p">{</span>
	<span class="kt">uint16_t</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">len</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="kt">uint8_t</span> <span class="n">fc4_types</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
		<span class="kt">uint32_t</span> <span class="n">sup_speed</span><span class="p">;</span>
		<span class="kt">uint32_t</span> <span class="n">cur_speed</span><span class="p">;</span>
		<span class="kt">uint32_t</span> <span class="n">max_frame_size</span><span class="p">;</span>
		<span class="kt">uint8_t</span> <span class="n">os_dev_name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">host_name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">a</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Port Attribute Block.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ct_fdmi_port_attributes</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ct_fdmi_port_attr</span> <span class="n">entry</span><span class="p">[</span><span class="n">FDMI_PORT_ATTR_COUNT</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* FDMI definitions. */</span>
<span class="cp">#define GRHL_CMD	0x100</span>
<span class="cp">#define GHAT_CMD	0x101</span>
<span class="cp">#define GRPL_CMD	0x102</span>
<span class="cp">#define GPAT_CMD	0x110</span>

<span class="cp">#define RHBA_CMD	0x200</span>
<span class="cp">#define RHBA_RSP_SIZE	16</span>

<span class="cp">#define RHAT_CMD	0x201</span>
<span class="cp">#define RPRT_CMD	0x210</span>

<span class="cp">#define RPA_CMD		0x211</span>
<span class="cp">#define RPA_RSP_SIZE	16</span>

<span class="cp">#define DHBA_CMD	0x300</span>
<span class="cp">#define DHBA_REQ_SIZE	(16 + 8)</span>
<span class="cp">#define DHBA_RSP_SIZE	16</span>

<span class="cp">#define DHAT_CMD	0x301</span>
<span class="cp">#define DPRT_CMD	0x310</span>
<span class="cp">#define DPA_CMD		0x311</span>

<span class="cm">/* CT command header -- request/response common fields */</span>
<span class="k">struct</span> <span class="n">ct_cmd_hdr</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">revision</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">in_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">gs_type</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">gs_subtype</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">options</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">reserved</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* CT command request */</span>
<span class="k">struct</span> <span class="n">ct_sns_req</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ct_cmd_hdr</span> <span class="n">header</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">command</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">max_rsp_size</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">fragment_id</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="cm">/* GA_NXT, GPN_ID, GNN_ID, GFT_ID, GFPN_ID */</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">reserved</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">port_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">port_id</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">port_type</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">domain</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">area</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">reserved</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">gid_pt</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">reserved</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">port_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">fc4_types</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">rft_id</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">reserved</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">port_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
			<span class="kt">uint16_t</span> <span class="n">reserved2</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">fc4_feature</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">fc4_type</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">rff_id</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">reserved</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">port_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">node_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">rnn_id</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">node_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">name_len</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">sym_node_name</span><span class="p">[</span><span class="mi">255</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">rsnn_nn</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">hba_indentifier</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">ghat</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">hba_identifier</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
			<span class="kt">uint32_t</span> <span class="n">entry_count</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
			<span class="k">struct</span> <span class="n">ct_fdmi_hba_attributes</span> <span class="n">attrs</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">rhba</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">hba_identifier</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
			<span class="k">struct</span> <span class="n">ct_fdmi_hba_attributes</span> <span class="n">attrs</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">rhat</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
			<span class="k">struct</span> <span class="n">ct_fdmi_port_attributes</span> <span class="n">attrs</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">rpa</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">dhba</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">dhat</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">dprt</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">dpa</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">gpsc</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">reserved</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">gff_id</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">req</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* CT command response header */</span>
<span class="k">struct</span> <span class="n">ct_rsp_hdr</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ct_cmd_hdr</span> <span class="n">header</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">response</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">residual</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">fragment_id</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">reason_code</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">explanation_code</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">vendor_unique</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ct_sns_gid_pt_data</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">control_byte</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">port_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ct_sns_rsp</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ct_rsp_hdr</span> <span class="n">header</span><span class="p">;</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">port_type</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">port_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">sym_port_name_len</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">sym_port_name</span><span class="p">[</span><span class="mi">255</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">node_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">sym_node_name_len</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">sym_node_name</span><span class="p">[</span><span class="mi">255</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">init_proc_assoc</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">node_ip_addr</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">class_of_service</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">fc4_types</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">ip_address</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">fabric_port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
			<span class="kt">uint8_t</span> <span class="n">reserved</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">hard_address</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">ga_nxt</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="cm">/* Assume the largest number of targets for the union */</span>
			<span class="k">struct</span> <span class="n">ct_sns_gid_pt_data</span>
			    <span class="n">entries</span><span class="p">[</span><span class="n">MAX_FIBRE_DEVICES_MAX</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">gid_pt</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">gpn_id</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">node_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">gnn_id</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">fc4_types</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">gft_id</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint32_t</span> <span class="n">entry_count</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
			<span class="k">struct</span> <span class="n">ct_fdmi_hba_attributes</span> <span class="n">attrs</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">ghat</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">gfpn_id</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint16_t</span> <span class="n">speeds</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">speed</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">gpsc</span><span class="p">;</span>

<span class="cp">#define GFF_FCP_SCSI_OFFSET	7</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint8_t</span> <span class="n">fc4_features</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">gff_id</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">rsp</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ct_sns_pkt</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">ct_sns_req</span> <span class="n">req</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">ct_sns_rsp</span> <span class="n">rsp</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">p</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * SNS command structures -- for 2200 compatibility.</span>
<span class="cm"> */</span>
<span class="cp">#define	RFT_ID_SNS_SCMD_LEN	22</span>
<span class="cp">#define	RFT_ID_SNS_CMD_SIZE	60</span>
<span class="cp">#define	RFT_ID_SNS_DATA_SIZE	16</span>

<span class="cp">#define	RNN_ID_SNS_SCMD_LEN	10</span>
<span class="cp">#define	RNN_ID_SNS_CMD_SIZE	36</span>
<span class="cp">#define	RNN_ID_SNS_DATA_SIZE	16</span>

<span class="cp">#define	GA_NXT_SNS_SCMD_LEN	6</span>
<span class="cp">#define	GA_NXT_SNS_CMD_SIZE	28</span>
<span class="cp">#define	GA_NXT_SNS_DATA_SIZE	(620 + 16)</span>

<span class="cp">#define	GID_PT_SNS_SCMD_LEN	6</span>
<span class="cp">#define	GID_PT_SNS_CMD_SIZE	28</span>
<span class="cm">/*</span>
<span class="cm"> * Assume MAX_FIBRE_DEVICES_2100 as these defines are only used with older</span>
<span class="cm"> * adapters.</span>
<span class="cm"> */</span>
<span class="cp">#define	GID_PT_SNS_DATA_SIZE	(MAX_FIBRE_DEVICES_2100 * 4 + 16)</span>

<span class="cp">#define	GPN_ID_SNS_SCMD_LEN	6</span>
<span class="cp">#define	GPN_ID_SNS_CMD_SIZE	28</span>
<span class="cp">#define	GPN_ID_SNS_DATA_SIZE	(8 + 16)</span>

<span class="cp">#define	GNN_ID_SNS_SCMD_LEN	6</span>
<span class="cp">#define	GNN_ID_SNS_CMD_SIZE	28</span>
<span class="cp">#define	GNN_ID_SNS_DATA_SIZE	(8 + 16)</span>

<span class="k">struct</span> <span class="n">sns_cmd_pkt</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">uint16_t</span> <span class="n">buffer_length</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">reserved_1</span><span class="p">;</span>
			<span class="kt">uint32_t</span> <span class="n">buffer_address</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="kt">uint16_t</span> <span class="n">subcommand_length</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">reserved_2</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">subcommand</span><span class="p">;</span>
			<span class="kt">uint16_t</span> <span class="n">size</span><span class="p">;</span>
			<span class="kt">uint32_t</span> <span class="n">reserved_3</span><span class="p">;</span>
			<span class="kt">uint8_t</span> <span class="n">param</span><span class="p">[</span><span class="mi">36</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">cmd</span><span class="p">;</span>

		<span class="kt">uint8_t</span> <span class="n">rft_data</span><span class="p">[</span><span class="n">RFT_ID_SNS_DATA_SIZE</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">rnn_data</span><span class="p">[</span><span class="n">RNN_ID_SNS_DATA_SIZE</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">gan_data</span><span class="p">[</span><span class="n">GA_NXT_SNS_DATA_SIZE</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">gid_data</span><span class="p">[</span><span class="n">GID_PT_SNS_DATA_SIZE</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">gpn_data</span><span class="p">[</span><span class="n">GPN_ID_SNS_DATA_SIZE</span><span class="p">];</span>
		<span class="kt">uint8_t</span> <span class="n">gnn_data</span><span class="p">[</span><span class="n">GNN_ID_SNS_DATA_SIZE</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">p</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fw_blob</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">segs</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">fw</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Return data from MBC_GET_ID_LIST call. */</span>
<span class="k">struct</span> <span class="n">gid_list_info</span> <span class="p">{</span>
	<span class="kt">uint8_t</span>	<span class="n">al_pa</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	<span class="n">area</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	<span class="n">domain</span><span class="p">;</span>
	<span class="kt">uint8_t</span>	<span class="n">loop_id_2100</span><span class="p">;</span>	<span class="cm">/* ISP2100/ISP2200 -- 4 bytes. */</span>
	<span class="kt">uint16_t</span> <span class="n">loop_id</span><span class="p">;</span>	<span class="cm">/* ISP23XX         -- 6 bytes. */</span>
	<span class="kt">uint16_t</span> <span class="n">reserved_1</span><span class="p">;</span>	<span class="cm">/* ISP24XX         -- 8 bytes. */</span>
<span class="p">};</span>

<span class="cm">/* NPIV */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">vport_info</span> <span class="p">{</span>
	<span class="kt">uint8_t</span>		<span class="n">port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span>		<span class="n">node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">int</span>		<span class="n">vp_id</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">loop_id</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">host_no</span><span class="p">;</span>
	<span class="kt">uint8_t</span>		<span class="n">port_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="kt">int</span>		<span class="n">loop_state</span><span class="p">;</span>
<span class="p">}</span> <span class="n">vport_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">vport_params</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> 	<span class="n">port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span> 	<span class="n">node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint32_t</span> 	<span class="n">options</span><span class="p">;</span>
<span class="cp">#define	VP_OPTS_RETRY_ENABLE	BIT_0</span>
<span class="cp">#define	VP_OPTS_VP_DISABLE	BIT_1</span>
<span class="p">}</span> <span class="n">vport_params_t</span><span class="p">;</span>

<span class="cm">/* NPIV - return codes of VP create and modify */</span>
<span class="cp">#define VP_RET_CODE_OK			0</span>
<span class="cp">#define VP_RET_CODE_FATAL		1</span>
<span class="cp">#define VP_RET_CODE_WRONG_ID		2</span>
<span class="cp">#define VP_RET_CODE_WWPN		3</span>
<span class="cp">#define VP_RET_CODE_RESOURCES		4</span>
<span class="cp">#define VP_RET_CODE_NO_MEM		5</span>
<span class="cp">#define VP_RET_CODE_NOT_FOUND		6</span>

<span class="k">struct</span> <span class="n">qla_hw_data</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">rsp_que</span><span class="p">;</span>
<span class="cm">/*</span>
<span class="cm"> * ISP operations</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">isp_operations</span> <span class="p">{</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">pci_config</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">reset_chip</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">chip_diag</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">config_rings</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">reset_adapter</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">nvram_config</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">update_fw_options</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">load_risc</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="p">);</span>

	<span class="kt">char</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">pci_info_str</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">char</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">fw_version_str</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>

	<span class="n">irq_handler_t</span> <span class="n">intr_handler</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">enable_intrs</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">disable_intrs</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">abort_command</span><span class="p">)</span> <span class="p">(</span><span class="n">srb_t</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">target_reset</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">fc_port</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">lun_reset</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">fc_port</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fabric_login</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint16_t</span><span class="p">,</span> <span class="kt">uint8_t</span><span class="p">,</span>
		<span class="kt">uint8_t</span><span class="p">,</span> <span class="kt">uint8_t</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint8_t</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fabric_logout</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint16_t</span><span class="p">,</span> <span class="kt">uint8_t</span><span class="p">,</span>
	    <span class="kt">uint8_t</span><span class="p">,</span> <span class="kt">uint8_t</span><span class="p">);</span>

	<span class="kt">uint16_t</span> <span class="p">(</span><span class="o">*</span><span class="n">calc_req_entries</span><span class="p">)</span> <span class="p">(</span><span class="kt">uint16_t</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">build_iocbs</span><span class="p">)</span> <span class="p">(</span><span class="n">srb_t</span> <span class="o">*</span><span class="p">,</span> <span class="n">cmd_entry_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint16_t</span><span class="p">);</span>
	<span class="kt">void</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">prep_ms_iocb</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint32_t</span><span class="p">,</span> <span class="kt">uint32_t</span><span class="p">);</span>
	<span class="kt">void</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">prep_ms_fdmi_iocb</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint32_t</span><span class="p">,</span>
	    <span class="kt">uint32_t</span><span class="p">);</span>

	<span class="kt">uint8_t</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">read_nvram</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="p">,</span>
		<span class="kt">uint32_t</span><span class="p">,</span> <span class="kt">uint32_t</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">write_nvram</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint32_t</span><span class="p">,</span>
		<span class="kt">uint32_t</span><span class="p">);</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fw_dump</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">beacon_on</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">beacon_off</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">beacon_blink</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">);</span>

	<span class="kt">uint8_t</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">read_optrom</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="p">,</span>
		<span class="kt">uint32_t</span><span class="p">,</span> <span class="kt">uint32_t</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">write_optrom</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">uint32_t</span><span class="p">,</span>
		<span class="kt">uint32_t</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_flash_version</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">start_scsi</span><span class="p">)</span> <span class="p">(</span><span class="n">srb_t</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">abort_isp</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">iospace_config</span><span class="p">)(</span><span class="k">struct</span> <span class="n">qla_hw_data</span><span class="o">*</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* MSI-X Support *************************************************************/</span>

<span class="cp">#define QLA_MSIX_CHIP_REV_24XX	3</span>
<span class="cp">#define QLA_MSIX_FW_MODE(m)	(((m) &amp; (BIT_7|BIT_8|BIT_9)) &gt;&gt; 7)</span>
<span class="cp">#define QLA_MSIX_FW_MODE_1(m)	(QLA_MSIX_FW_MODE(m) == 1)</span>

<span class="cp">#define QLA_MSIX_DEFAULT	0x00</span>
<span class="cp">#define QLA_MSIX_RSP_Q		0x01</span>

<span class="cp">#define QLA_MIDX_DEFAULT	0</span>
<span class="cp">#define QLA_MIDX_RSP_Q		1</span>
<span class="cp">#define QLA_PCI_MSIX_CONTROL	0xa2</span>
<span class="cp">#define QLA_83XX_PCI_MSIX_CONTROL	0x92</span>

<span class="k">struct</span> <span class="n">scsi_qla_host</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qla_msix_entry</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">have_irq</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">vector</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">entry</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rsp_que</span> <span class="o">*</span><span class="n">rsp</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define	WATCH_INTERVAL		1       </span><span class="cm">/* number of seconds */</span><span class="cp"></span>

<span class="cm">/* Work events.  */</span>
<span class="k">enum</span> <span class="n">qla_work_type</span> <span class="p">{</span>
	<span class="n">QLA_EVT_AEN</span><span class="p">,</span>
	<span class="n">QLA_EVT_IDC_ACK</span><span class="p">,</span>
	<span class="n">QLA_EVT_ASYNC_LOGIN</span><span class="p">,</span>
	<span class="n">QLA_EVT_ASYNC_LOGIN_DONE</span><span class="p">,</span>
	<span class="n">QLA_EVT_ASYNC_LOGOUT</span><span class="p">,</span>
	<span class="n">QLA_EVT_ASYNC_LOGOUT_DONE</span><span class="p">,</span>
	<span class="n">QLA_EVT_ASYNC_ADISC</span><span class="p">,</span>
	<span class="n">QLA_EVT_ASYNC_ADISC_DONE</span><span class="p">,</span>
	<span class="n">QLA_EVT_UEVENT</span><span class="p">,</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">qla_work_evt</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">list</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">qla_work_type</span>	<span class="n">type</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">flags</span><span class="p">;</span>
<span class="cp">#define QLA_EVT_FLAG_FREE	0x1</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">enum</span> <span class="n">fc_host_event_code</span> <span class="n">code</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">data</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">aen</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
<span class="cp">#define QLA_IDC_ACK_REGS	7</span>
			<span class="kt">uint16_t</span> <span class="n">mb</span><span class="p">[</span><span class="n">QLA_IDC_ACK_REGS</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">idc_ack</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">fc_port</span> <span class="o">*</span><span class="n">fcport</span><span class="p">;</span>
<span class="cp">#define QLA_LOGIO_LOGIN_RETRIED	BIT_0</span>
			<span class="n">u16</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">logio</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u32</span> <span class="n">code</span><span class="p">;</span>
<span class="cp">#define QLA_UEVENT_CODE_FW_DUMP	0</span>
		<span class="p">}</span> <span class="n">uevent</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qla_chip_state_84xx</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kref</span> <span class="n">kref</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">bus</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">access_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">fw_update_mutex</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">fw_update</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">op_fw_version</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">op_fw_size</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">op_fw_seq_size</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">diag_fw_version</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">gold_fw_version</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qla_statistics</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">total_isp_aborts</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">input_bytes</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">output_bytes</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Multi queue support */</span>
<span class="cp">#define MBC_INITIALIZE_MULTIQ 0x1f</span>
<span class="cp">#define QLA_QUE_PAGE 0X1000</span>
<span class="cp">#define QLA_MQ_SIZE 32</span>
<span class="cp">#define QLA_MAX_QUEUES 256</span>
<span class="cp">#define ISP_QUE_REG(ha, id) \</span>
<span class="cp">	((ha-&gt;mqenable || IS_QLA83XX(ha)) ? \</span>
<span class="cp">	((void *)(ha-&gt;mqiobase) +\</span>
<span class="cp">	(QLA_QUE_PAGE * id)) :\</span>
<span class="cp">	((void *)(ha-&gt;iobase)))</span>
<span class="cp">#define QLA_REQ_QUE_ID(tag) \</span>
<span class="cp">	((tag &lt; QLA_MAX_QUEUES &amp;&amp; tag &gt; 0) ? tag : 0)</span>
<span class="cp">#define QLA_DEFAULT_QUE_QOS 5</span>
<span class="cp">#define QLA_PRECONFIG_VPORTS 32</span>
<span class="cp">#define QLA_MAX_VPORTS_QLA24XX	128</span>
<span class="cp">#define QLA_MAX_VPORTS_QLA25XX	256</span>
<span class="cm">/* Response queue data structure */</span>
<span class="k">struct</span> <span class="n">rsp_que</span> <span class="p">{</span>
	<span class="n">dma_addr_t</span>  <span class="n">dma</span><span class="p">;</span>
	<span class="n">response_t</span> <span class="o">*</span><span class="n">ring</span><span class="p">;</span>
	<span class="n">response_t</span> <span class="o">*</span><span class="n">ring_ptr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">rsp_q_in</span><span class="p">;</span>	<span class="cm">/* FWI2-capable only. */</span>
	<span class="kt">uint32_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">rsp_q_out</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">ring_index</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">out_ptr</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">length</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">options</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">rid</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">id</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">vp_idx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_msix_entry</span> <span class="o">*</span><span class="n">msix</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">req_que</span> <span class="o">*</span><span class="n">req</span><span class="p">;</span>
	<span class="n">srb_t</span> <span class="o">*</span><span class="n">status_srb</span><span class="p">;</span> <span class="cm">/* status continuation entry */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">q_work</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Request queue data structure */</span>
<span class="k">struct</span> <span class="n">req_que</span> <span class="p">{</span>
	<span class="n">dma_addr_t</span>  <span class="n">dma</span><span class="p">;</span>
	<span class="n">request_t</span> <span class="o">*</span><span class="n">ring</span><span class="p">;</span>
	<span class="n">request_t</span> <span class="o">*</span><span class="n">ring_ptr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">req_q_in</span><span class="p">;</span>	<span class="cm">/* FWI2-capable only. */</span>
	<span class="kt">uint32_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">req_q_out</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">ring_index</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">in_ptr</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">cnt</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">length</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">options</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">rid</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">id</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">qos</span><span class="p">;</span>
	<span class="kt">uint16_t</span>  <span class="n">vp_idx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rsp_que</span> <span class="o">*</span><span class="n">rsp</span><span class="p">;</span>
	<span class="n">srb_t</span> <span class="o">*</span><span class="n">outstanding_cmds</span><span class="p">[</span><span class="n">MAX_OUTSTANDING_COMMANDS</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">current_outstanding_cmd</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">max_q_depth</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Place holder for FW buffer parameters */</span>
<span class="k">struct</span> <span class="n">qlfc_fw</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">fw_buf</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">fw_dma</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">len</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlt_hw_data</span> <span class="p">{</span>
	<span class="cm">/* Protected by hw lock */</span>
	<span class="kt">uint32_t</span> <span class="n">enable_class_2</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">enable_explicit_conf</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">ini_mode_force_reverse</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">node_name_set</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">dma_addr_t</span> <span class="n">atio_dma</span><span class="p">;</span>	<span class="cm">/* Physical address. */</span>
	<span class="k">struct</span> <span class="n">atio</span> <span class="o">*</span><span class="n">atio_ring</span><span class="p">;</span>	<span class="cm">/* Base virtual address */</span>
	<span class="k">struct</span> <span class="n">atio</span> <span class="o">*</span><span class="n">atio_ring_ptr</span><span class="p">;</span>	<span class="cm">/* Current address. */</span>
	<span class="kt">uint16_t</span> <span class="n">atio_ring_index</span><span class="p">;</span> <span class="cm">/* Current index. */</span>
	<span class="kt">uint16_t</span> <span class="n">atio_q_length</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">target_lport_ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_tgt_func_tmpl</span> <span class="o">*</span><span class="n">tgt_ops</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_tgt</span> <span class="o">*</span><span class="n">qla_tgt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_tgt_cmd</span> <span class="o">*</span><span class="n">cmds</span><span class="p">[</span><span class="n">MAX_OUTSTANDING_COMMANDS</span><span class="p">];</span>
	<span class="kt">uint16_t</span> <span class="n">current_handle</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">qla_tgt_vp_map</span> <span class="o">*</span><span class="n">tgt_vp_map</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">tgt_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">tgt_host_action_mutex</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">saved_set</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">saved_exchange_count</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saved_firmware_options_1</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saved_firmware_options_2</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saved_firmware_options_3</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">saved_firmware_options</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">uint8_t</span> <span class="n">saved_add_firmware_options</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="kt">uint8_t</span> <span class="n">tgt_node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Qlogic host adapter specific data structure.</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>  <span class="o">*</span><span class="n">pdev</span><span class="p">;</span>
	<span class="cm">/* SRB cache. */</span>
<span class="cp">#define SRB_MIN_REQ     128</span>
	<span class="n">mempool_t</span>       <span class="o">*</span><span class="n">srb_mempool</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="k">struct</span> <span class="p">{</span>
		<span class="kt">uint32_t</span>	<span class="n">mbox_int</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">mbox_busy</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">disable_risc_code_load</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">enable_64bit_addressing</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">enable_lip_reset</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">enable_target_reset</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">enable_lip_full_login</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">enable_led_scheme</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>

		<span class="kt">uint32_t</span>	<span class="n">msi_enabled</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">msix_enabled</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">disable_serdes</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">gpsc_supported</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">npiv_supported</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">pci_channel_io_perm_failure</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">fce_enabled</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">fac_supported</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>

		<span class="kt">uint32_t</span>	<span class="n">chip_reset_done</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">port0</span>			<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">running_gold_fw</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">eeh_busy</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">cpu_affinity_enabled</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">disable_msix_handshake</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">fcp_prio_enabled</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">isp82xx_fw_hung</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

		<span class="kt">uint32_t</span>	<span class="n">quiesce_owner</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">thermal_supported</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">isp82xx_reset_hdlr_active</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">isp82xx_reset_owner</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">isp82xx_no_md_cap</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">host_shutting_down</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="cm">/* 30 bits */</span>
	<span class="p">}</span> <span class="n">flags</span><span class="p">;</span>

	<span class="cm">/* This spinlock is used to protect &quot;io transactions&quot;, you must</span>
<span class="cm">	* acquire it before doing any IO to the card, eg with RD_REG*() and</span>
<span class="cm">	* WRT_REG*() for the duration of your entire commandtransaction.</span>
<span class="cm">	*</span>
<span class="cm">	* This spinlock is of lower priority than the io request lock.</span>
<span class="cm">	*/</span>

	<span class="n">spinlock_t</span>	<span class="n">hardware_lock</span> <span class="n">____cacheline_aligned</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">bars</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">mem_only</span><span class="p">;</span>
	<span class="n">device_reg_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">iobase</span><span class="p">;</span>           <span class="cm">/* Base I/O address */</span>
	<span class="n">resource_size_t</span> <span class="n">pio_address</span><span class="p">;</span>

<span class="cp">#define MIN_IOBASE_LEN          0x100</span>
<span class="cm">/* Multi queue data structs */</span>
	<span class="n">device_reg_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mqiobase</span><span class="p">;</span>
	<span class="n">device_reg_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">msixbase</span><span class="p">;</span>
	<span class="kt">uint16_t</span>        <span class="n">msix_count</span><span class="p">;</span>
	<span class="kt">uint8_t</span>         <span class="n">mqenable</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">req_que</span> <span class="o">**</span><span class="n">req_q_map</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rsp_que</span> <span class="o">**</span><span class="n">rsp_q_map</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">req_qid_map</span><span class="p">[(</span><span class="n">QLA_MAX_QUEUES</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rsp_qid_map</span><span class="p">[(</span><span class="n">QLA_MAX_QUEUES</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)];</span>
	<span class="kt">uint8_t</span> 	<span class="n">max_req_queues</span><span class="p">;</span>
	<span class="kt">uint8_t</span> 	<span class="n">max_rsp_queues</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_npiv_entry</span> <span class="o">*</span><span class="n">npiv_info</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">nvram_npiv_size</span><span class="p">;</span>

	<span class="kt">uint16_t</span>        <span class="n">switch_cap</span><span class="p">;</span>
<span class="cp">#define FLOGI_SEQ_DEL           BIT_8</span>
<span class="cp">#define FLOGI_MID_SUPPORT       BIT_10</span>
<span class="cp">#define FLOGI_VSAN_SUPPORT      BIT_12</span>
<span class="cp">#define FLOGI_SP_SUPPORT        BIT_13</span>

	<span class="kt">uint8_t</span>		<span class="n">port_no</span><span class="p">;</span>		<span class="cm">/* Physical port of adapter */</span>

	<span class="cm">/* Timeout timers. */</span>
	<span class="kt">uint8_t</span> 	<span class="n">loop_down_abort_time</span><span class="p">;</span>    <span class="cm">/* port down timer */</span>
	<span class="n">atomic_t</span>	<span class="n">loop_down_timer</span><span class="p">;</span>         <span class="cm">/* loop down timer */</span>
	<span class="kt">uint8_t</span>		<span class="n">link_down_timeout</span><span class="p">;</span>       <span class="cm">/* link down timeout */</span>
	<span class="kt">uint16_t</span>	<span class="n">max_loop_id</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">max_fibre_devices</span><span class="p">;</span>	<span class="cm">/* Maximum number of targets */</span>

	<span class="kt">uint16_t</span>	<span class="n">fb_rev</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">min_external_loopid</span><span class="p">;</span>    <span class="cm">/* First external loop Id */</span>

<span class="cp">#define PORT_SPEED_UNKNOWN 0xFFFF</span>
<span class="cp">#define PORT_SPEED_1GB  0x00</span>
<span class="cp">#define PORT_SPEED_2GB  0x01</span>
<span class="cp">#define PORT_SPEED_4GB  0x03</span>
<span class="cp">#define PORT_SPEED_8GB  0x04</span>
<span class="cp">#define PORT_SPEED_16GB 0x05</span>
<span class="cp">#define PORT_SPEED_10GB	0x13</span>
	<span class="kt">uint16_t</span>	<span class="n">link_data_rate</span><span class="p">;</span>         <span class="cm">/* F/W operating speed */</span>

	<span class="kt">uint8_t</span>		<span class="n">current_topology</span><span class="p">;</span>
	<span class="kt">uint8_t</span>		<span class="n">prev_topology</span><span class="p">;</span>
<span class="cp">#define ISP_CFG_NL	1</span>
<span class="cp">#define ISP_CFG_N	2</span>
<span class="cp">#define ISP_CFG_FL	4</span>
<span class="cp">#define ISP_CFG_F	8</span>

	<span class="kt">uint8_t</span>		<span class="n">operating_mode</span><span class="p">;</span>         <span class="cm">/* F/W operating mode */</span>
<span class="cp">#define LOOP      0</span>
<span class="cp">#define P2P       1</span>
<span class="cp">#define LOOP_P2P  2</span>
<span class="cp">#define P2P_LOOP  3</span>
	<span class="kt">uint8_t</span>		<span class="n">interrupts_on</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">isp_abort_cnt</span><span class="p">;</span>

<span class="cp">#define PCI_DEVICE_ID_QLOGIC_ISP2532    0x2532</span>
<span class="cp">#define PCI_DEVICE_ID_QLOGIC_ISP8432    0x8432</span>
<span class="cp">#define PCI_DEVICE_ID_QLOGIC_ISP8001	0x8001</span>
<span class="cp">#define PCI_DEVICE_ID_QLOGIC_ISP8031	0x8031</span>
<span class="cp">#define PCI_DEVICE_ID_QLOGIC_ISP2031	0x2031</span>
	<span class="kt">uint32_t</span>	<span class="n">device_type</span><span class="p">;</span>
<span class="cp">#define DT_ISP2100                      BIT_0</span>
<span class="cp">#define DT_ISP2200                      BIT_1</span>
<span class="cp">#define DT_ISP2300                      BIT_2</span>
<span class="cp">#define DT_ISP2312                      BIT_3</span>
<span class="cp">#define DT_ISP2322                      BIT_4</span>
<span class="cp">#define DT_ISP6312                      BIT_5</span>
<span class="cp">#define DT_ISP6322                      BIT_6</span>
<span class="cp">#define DT_ISP2422                      BIT_7</span>
<span class="cp">#define DT_ISP2432                      BIT_8</span>
<span class="cp">#define DT_ISP5422                      BIT_9</span>
<span class="cp">#define DT_ISP5432                      BIT_10</span>
<span class="cp">#define DT_ISP2532                      BIT_11</span>
<span class="cp">#define DT_ISP8432                      BIT_12</span>
<span class="cp">#define DT_ISP8001			BIT_13</span>
<span class="cp">#define DT_ISP8021			BIT_14</span>
<span class="cp">#define DT_ISP2031			BIT_15</span>
<span class="cp">#define DT_ISP8031			BIT_16</span>
<span class="cp">#define DT_ISP_LAST			(DT_ISP8031 &lt;&lt; 1)</span>

<span class="cp">#define DT_T10_PI                       BIT_25</span>
<span class="cp">#define DT_IIDMA                        BIT_26</span>
<span class="cp">#define DT_FWI2                         BIT_27</span>
<span class="cp">#define DT_ZIO_SUPPORTED                BIT_28</span>
<span class="cp">#define DT_OEM_001                      BIT_29</span>
<span class="cp">#define DT_ISP2200A                     BIT_30</span>
<span class="cp">#define DT_EXTENDED_IDS                 BIT_31</span>
<span class="cp">#define DT_MASK(ha)     ((ha)-&gt;device_type &amp; (DT_ISP_LAST - 1))</span>
<span class="cp">#define IS_QLA2100(ha)  (DT_MASK(ha) &amp; DT_ISP2100)</span>
<span class="cp">#define IS_QLA2200(ha)  (DT_MASK(ha) &amp; DT_ISP2200)</span>
<span class="cp">#define IS_QLA2300(ha)  (DT_MASK(ha) &amp; DT_ISP2300)</span>
<span class="cp">#define IS_QLA2312(ha)  (DT_MASK(ha) &amp; DT_ISP2312)</span>
<span class="cp">#define IS_QLA2322(ha)  (DT_MASK(ha) &amp; DT_ISP2322)</span>
<span class="cp">#define IS_QLA6312(ha)  (DT_MASK(ha) &amp; DT_ISP6312)</span>
<span class="cp">#define IS_QLA6322(ha)  (DT_MASK(ha) &amp; DT_ISP6322)</span>
<span class="cp">#define IS_QLA2422(ha)  (DT_MASK(ha) &amp; DT_ISP2422)</span>
<span class="cp">#define IS_QLA2432(ha)  (DT_MASK(ha) &amp; DT_ISP2432)</span>
<span class="cp">#define IS_QLA5422(ha)  (DT_MASK(ha) &amp; DT_ISP5422)</span>
<span class="cp">#define IS_QLA5432(ha)  (DT_MASK(ha) &amp; DT_ISP5432)</span>
<span class="cp">#define IS_QLA2532(ha)  (DT_MASK(ha) &amp; DT_ISP2532)</span>
<span class="cp">#define IS_QLA8432(ha)  (DT_MASK(ha) &amp; DT_ISP8432)</span>
<span class="cp">#define IS_QLA8001(ha)	(DT_MASK(ha) &amp; DT_ISP8001)</span>
<span class="cp">#define IS_QLA81XX(ha)	(IS_QLA8001(ha))</span>
<span class="cp">#define IS_QLA82XX(ha)	(DT_MASK(ha) &amp; DT_ISP8021)</span>
<span class="cp">#define IS_QLA2031(ha)	(DT_MASK(ha) &amp; DT_ISP2031)</span>
<span class="cp">#define IS_QLA8031(ha)	(DT_MASK(ha) &amp; DT_ISP8031)</span>

<span class="cp">#define IS_QLA23XX(ha)  (IS_QLA2300(ha) || IS_QLA2312(ha) || IS_QLA2322(ha) || \</span>
<span class="cp">			IS_QLA6312(ha) || IS_QLA6322(ha))</span>
<span class="cp">#define IS_QLA24XX(ha)  (IS_QLA2422(ha) || IS_QLA2432(ha))</span>
<span class="cp">#define IS_QLA54XX(ha)  (IS_QLA5422(ha) || IS_QLA5432(ha))</span>
<span class="cp">#define IS_QLA25XX(ha)  (IS_QLA2532(ha))</span>
<span class="cp">#define IS_QLA83XX(ha)	(IS_QLA2031(ha) || IS_QLA8031(ha))</span>
<span class="cp">#define IS_QLA84XX(ha)  (IS_QLA8432(ha))</span>
<span class="cp">#define IS_QLA24XX_TYPE(ha)     (IS_QLA24XX(ha) || IS_QLA54XX(ha) || \</span>
<span class="cp">				IS_QLA84XX(ha))</span>
<span class="cp">#define IS_CNA_CAPABLE(ha)	(IS_QLA81XX(ha) || IS_QLA82XX(ha) || \</span>
<span class="cp">				IS_QLA8031(ha))</span>
<span class="cp">#define IS_QLA2XXX_MIDTYPE(ha)	(IS_QLA24XX(ha) || IS_QLA84XX(ha) || \</span>
<span class="cp">				IS_QLA25XX(ha) || IS_QLA81XX(ha) || \</span>
<span class="cp">				IS_QLA82XX(ha) || IS_QLA83XX(ha))</span>
<span class="cp">#define IS_MSIX_NACK_CAPABLE(ha) (IS_QLA81XX(ha) || IS_QLA83XX(ha))</span>
<span class="cp">#define IS_NOPOLLING_TYPE(ha)	((IS_QLA25XX(ha) || IS_QLA81XX(ha) || \</span>
<span class="cp">			IS_QLA83XX(ha)) &amp;&amp; (ha)-&gt;flags.msix_enabled)</span>
<span class="cp">#define IS_FAC_REQUIRED(ha)	(IS_QLA81XX(ha) || IS_QLA83XX(ha))</span>
<span class="cp">#define IS_NOCACHE_VPD_TYPE(ha)	(IS_QLA81XX(ha) || IS_QLA83XX(ha))</span>
<span class="cp">#define IS_ALOGIO_CAPABLE(ha)	(IS_QLA23XX(ha) || IS_FWI2_CAPABLE(ha))</span>

<span class="cp">#define IS_T10_PI_CAPABLE(ha)   ((ha)-&gt;device_type &amp; DT_T10_PI)</span>
<span class="cp">#define IS_IIDMA_CAPABLE(ha)    ((ha)-&gt;device_type &amp; DT_IIDMA)</span>
<span class="cp">#define IS_FWI2_CAPABLE(ha)     ((ha)-&gt;device_type &amp; DT_FWI2)</span>
<span class="cp">#define IS_ZIO_SUPPORTED(ha)    ((ha)-&gt;device_type &amp; DT_ZIO_SUPPORTED)</span>
<span class="cp">#define IS_OEM_001(ha)          ((ha)-&gt;device_type &amp; DT_OEM_001)</span>
<span class="cp">#define HAS_EXTENDED_IDS(ha)    ((ha)-&gt;device_type &amp; DT_EXTENDED_IDS)</span>
<span class="cp">#define IS_CT6_SUPPORTED(ha)	((ha)-&gt;device_type &amp; DT_CT6_SUPPORTED)</span>
<span class="cp">#define IS_MQUE_CAPABLE(ha)	((ha)-&gt;mqenable || IS_QLA83XX(ha))</span>

	<span class="cm">/* HBA serial number */</span>
	<span class="kt">uint8_t</span>		<span class="n">serial0</span><span class="p">;</span>
	<span class="kt">uint8_t</span>		<span class="n">serial1</span><span class="p">;</span>
	<span class="kt">uint8_t</span>		<span class="n">serial2</span><span class="p">;</span>

	<span class="cm">/* NVRAM configuration data */</span>
<span class="cp">#define MAX_NVRAM_SIZE  4096</span>
<span class="cp">#define VPD_OFFSET      MAX_NVRAM_SIZE / 2</span>
	<span class="kt">uint16_t</span>	<span class="n">nvram_size</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">nvram_base</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">nvram</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">vpd_size</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">vpd_base</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">vpd</span><span class="p">;</span>

	<span class="kt">uint16_t</span>	<span class="n">loop_reset_delay</span><span class="p">;</span>
	<span class="kt">uint8_t</span>		<span class="n">retry_count</span><span class="p">;</span>
	<span class="kt">uint8_t</span>		<span class="n">login_timeout</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">r_a_tov</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">port_down_retry_count</span><span class="p">;</span>
	<span class="kt">uint8_t</span>		<span class="n">mbx_count</span><span class="p">;</span>

	<span class="kt">uint32_t</span>	<span class="n">login_retry_count</span><span class="p">;</span>
	<span class="cm">/* SNS command interfaces. */</span>
	<span class="n">ms_iocb_entry_t</span>		<span class="o">*</span><span class="n">ms_iocb</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>		<span class="n">ms_iocb_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ct_sns_pkt</span>	<span class="o">*</span><span class="n">ct_sns</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>		<span class="n">ct_sns_dma</span><span class="p">;</span>
	<span class="cm">/* SNS command interfaces for 2200. */</span>
	<span class="k">struct</span> <span class="n">sns_cmd_pkt</span>	<span class="o">*</span><span class="n">sns_cmd</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>		<span class="n">sns_cmd_dma</span><span class="p">;</span>

<span class="cp">#define SFP_DEV_SIZE    256</span>
<span class="cp">#define SFP_BLOCK_SIZE  64</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">sfp_data</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">sfp_data_dma</span><span class="p">;</span>

<span class="cp">#define XGMAC_DATA_SIZE	4096</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">xgmac_data</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">xgmac_data_dma</span><span class="p">;</span>

<span class="cp">#define DCBX_TLV_DATA_SIZE 4096</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">dcbx_tlv</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">dcbx_tlv_dma</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">task_struct</span>	<span class="o">*</span><span class="n">dpc_thread</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">dpc_active</span><span class="p">;</span>                  <span class="cm">/* DPC routine is active */</span>

	<span class="n">dma_addr_t</span>	<span class="n">gid_list_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gid_list_info</span> <span class="o">*</span><span class="n">gid_list</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">gid_list_info_size</span><span class="p">;</span>

	<span class="cm">/* Small DMA pool allocations -- maximum 256 bytes in length. */</span>
<span class="cp">#define DMA_POOL_SIZE   256</span>
	<span class="k">struct</span> <span class="n">dma_pool</span> <span class="o">*</span><span class="n">s_dma_pool</span><span class="p">;</span>

	<span class="n">dma_addr_t</span>	<span class="n">init_cb_dma</span><span class="p">;</span>
	<span class="n">init_cb_t</span>	<span class="o">*</span><span class="n">init_cb</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">init_cb_size</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">ex_init_cb_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ex_init_cb_81xx</span> <span class="o">*</span><span class="n">ex_init_cb</span><span class="p">;</span>

	<span class="kt">void</span>		<span class="o">*</span><span class="n">async_pd</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">async_pd_dma</span><span class="p">;</span>

	<span class="kt">void</span>		<span class="o">*</span><span class="n">swl</span><span class="p">;</span>

	<span class="cm">/* These are used by mailbox operations. */</span>
	<span class="k">volatile</span> <span class="kt">uint16_t</span> <span class="n">mailbox_out</span><span class="p">[</span><span class="n">MAILBOX_REGISTER_COUNT</span><span class="p">];</span>

	<span class="n">mbx_cmd_t</span>	<span class="o">*</span><span class="n">mcp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">mbx_cmd_flags</span><span class="p">;</span>
<span class="cp">#define MBX_INTERRUPT		1</span>
<span class="cp">#define MBX_INTR_WAIT		2</span>
<span class="cp">#define MBX_UPDATE_FLASH_ACTIVE	3</span>

	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">vport_lock</span><span class="p">;</span>        <span class="cm">/* Virtual port synchronization */</span>
	<span class="n">spinlock_t</span> <span class="n">vport_slock</span><span class="p">;</span> <span class="cm">/* order is hardware_lock, then vport_slock */</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">mbx_cmd_comp</span><span class="p">;</span> <span class="cm">/* Serialize mbx access */</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">mbx_intr_comp</span><span class="p">;</span>  <span class="cm">/* Used for completion notification */</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">dcbx_comp</span><span class="p">;</span>	<span class="cm">/* For set port config notification */</span>
	<span class="kt">int</span> <span class="n">notify_dcbx_comp</span><span class="p">;</span>

	<span class="cm">/* Basic firmware related information. */</span>
	<span class="kt">uint16_t</span>	<span class="n">fw_major_version</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">fw_minor_version</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">fw_subminor_version</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">fw_attributes</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">fw_attributes_h</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">fw_attributes_ext</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">uint32_t</span>	<span class="n">fw_memory_size</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">fw_transfer_size</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">fw_srisc_address</span><span class="p">;</span>
<span class="cp">#define RISC_START_ADDRESS_2100 0x1000</span>
<span class="cp">#define RISC_START_ADDRESS_2300 0x800</span>
<span class="cp">#define RISC_START_ADDRESS_2400 0x100000</span>
	<span class="kt">uint16_t</span>	<span class="n">fw_xcb_count</span><span class="p">;</span>

	<span class="kt">uint16_t</span>	<span class="n">fw_options</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>         <span class="cm">/* slots: 1,2,3,10,11 */</span>
	<span class="kt">uint8_t</span>		<span class="n">fw_seriallink_options</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">uint16_t</span>	<span class="n">fw_seriallink_options24</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

	<span class="kt">uint8_t</span>		<span class="n">mpi_version</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="kt">uint32_t</span>	<span class="n">mpi_capabilities</span><span class="p">;</span>
	<span class="kt">uint8_t</span>		<span class="n">phy_version</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

	<span class="cm">/* Firmware dump information. */</span>
	<span class="k">struct</span> <span class="n">qla2xxx_fw_dump</span> <span class="o">*</span><span class="n">fw_dump</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">fw_dump_len</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">fw_dumped</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">fw_dump_reading</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">eft_dma</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">eft</span><span class="p">;</span>

	<span class="kt">uint32_t</span>	<span class="n">chain_offset</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dfs_dir</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dfs_fce</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">fce_dma</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">fce</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">fce_bufs</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">fce_mb</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">uint64_t</span>	<span class="n">fce_wr</span><span class="p">,</span> <span class="n">fce_rd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>	<span class="n">fce_mutex</span><span class="p">;</span>

	<span class="kt">uint32_t</span>	<span class="n">pci_attr</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">chip_revision</span><span class="p">;</span>

	<span class="kt">uint16_t</span>	<span class="n">product_id</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

	<span class="kt">uint8_t</span>		<span class="n">model_number</span><span class="p">[</span><span class="mi">16</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="cp">#define BINZERO		&quot;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&quot;</span>
	<span class="kt">char</span>		<span class="n">model_desc</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>
	<span class="kt">uint8_t</span>		<span class="n">adapter_id</span><span class="p">[</span><span class="mi">16</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>

	<span class="cm">/* Option ROM information. */</span>
	<span class="kt">char</span>		<span class="o">*</span><span class="n">optrom_buffer</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">optrom_size</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">optrom_state</span><span class="p">;</span>
<span class="cp">#define QLA_SWAITING	0</span>
<span class="cp">#define QLA_SREADING	1</span>
<span class="cp">#define QLA_SWRITING	2</span>
	<span class="kt">uint32_t</span>	<span class="n">optrom_region_start</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">optrom_region_size</span><span class="p">;</span>

<span class="cm">/* PCI expansion ROM image information. */</span>
<span class="cp">#define ROM_CODE_TYPE_BIOS	0</span>
<span class="cp">#define ROM_CODE_TYPE_FCODE	1</span>
<span class="cp">#define ROM_CODE_TYPE_EFI	3</span>
	<span class="kt">uint8_t</span> 	<span class="n">bios_revision</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">uint8_t</span> 	<span class="n">efi_revision</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">uint8_t</span> 	<span class="n">fcode_revision</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="kt">uint32_t</span>	<span class="n">fw_revision</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

	<span class="kt">uint32_t</span>	<span class="n">gold_fw_version</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

	<span class="cm">/* Offsets for flash/nvram access (set to ~0 if not used). */</span>
	<span class="kt">uint32_t</span>	<span class="n">flash_conf_off</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">flash_data_off</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">nvram_conf_off</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">nvram_data_off</span><span class="p">;</span>

	<span class="kt">uint32_t</span>	<span class="n">fdt_wrt_disable</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">fdt_erase_cmd</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">fdt_block_size</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">fdt_unprotect_sec_cmd</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">fdt_protect_sec_cmd</span><span class="p">;</span>

	<span class="kt">uint32_t</span>        <span class="n">flt_region_flt</span><span class="p">;</span>
	<span class="kt">uint32_t</span>        <span class="n">flt_region_fdt</span><span class="p">;</span>
	<span class="kt">uint32_t</span>        <span class="n">flt_region_boot</span><span class="p">;</span>
	<span class="kt">uint32_t</span>        <span class="n">flt_region_fw</span><span class="p">;</span>
	<span class="kt">uint32_t</span>        <span class="n">flt_region_vpd_nvram</span><span class="p">;</span>
	<span class="kt">uint32_t</span>        <span class="n">flt_region_vpd</span><span class="p">;</span>
	<span class="kt">uint32_t</span>        <span class="n">flt_region_nvram</span><span class="p">;</span>
	<span class="kt">uint32_t</span>        <span class="n">flt_region_npiv_conf</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">flt_region_gold_fw</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">flt_region_fcp_prio</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">flt_region_bootload</span><span class="p">;</span>

	<span class="cm">/* Needed for BEACON */</span>
	<span class="kt">uint16_t</span>        <span class="n">beacon_blink_led</span><span class="p">;</span>
	<span class="kt">uint8_t</span>         <span class="n">beacon_color_state</span><span class="p">;</span>
<span class="cp">#define QLA_LED_GRN_ON		0x01</span>
<span class="cp">#define QLA_LED_YLW_ON		0x02</span>
<span class="cp">#define QLA_LED_ABR_ON		0x04</span>
<span class="cp">#define QLA_LED_ALL_ON		0x07	</span><span class="cm">/* yellow, green, amber. */</span><span class="cp"></span>
					<span class="cm">/* ISP2322: red, green, amber. */</span>
	<span class="kt">uint16_t</span>        <span class="n">zio_mode</span><span class="p">;</span>
	<span class="kt">uint16_t</span>        <span class="n">zio_timer</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">qla_msix_entry</span> <span class="o">*</span><span class="n">msix_entries</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span>        <span class="n">vp_list</span><span class="p">;</span>        <span class="cm">/* list of VP */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>   <span class="n">vp_idx_map</span><span class="p">[(</span><span class="n">MAX_MULTI_ID_FABRIC</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)];</span>
	<span class="kt">uint16_t</span>        <span class="n">num_vhosts</span><span class="p">;</span>     <span class="cm">/* number of vports created */</span>
	<span class="kt">uint16_t</span>        <span class="n">num_vsans</span><span class="p">;</span>      <span class="cm">/* number of vsan created */</span>
	<span class="kt">uint16_t</span>        <span class="n">max_npiv_vports</span><span class="p">;</span>        <span class="cm">/* 63 or 125 per topoloty */</span>
	<span class="kt">int</span>             <span class="n">cur_vport_count</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">qla_chip_state_84xx</span> <span class="o">*</span><span class="n">cs84xx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">isp_operations</span> <span class="o">*</span><span class="n">isp_ops</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">workqueue_struct</span> <span class="o">*</span><span class="n">wq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qlfc_fw</span> <span class="n">fw_buf</span><span class="p">;</span>

	<span class="cm">/* FCP_CMND priority support */</span>
	<span class="k">struct</span> <span class="n">qla_fcp_prio_cfg</span> <span class="o">*</span><span class="n">fcp_prio_cfg</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dma_pool</span> <span class="o">*</span><span class="n">dl_dma_pool</span><span class="p">;</span>
<span class="cp">#define DSD_LIST_DMA_POOL_SIZE  512</span>

	<span class="k">struct</span> <span class="n">dma_pool</span> <span class="o">*</span><span class="n">fcp_cmnd_dma_pool</span><span class="p">;</span>
	<span class="n">mempool_t</span>       <span class="o">*</span><span class="n">ctx_mempool</span><span class="p">;</span>
<span class="cp">#define FCP_CMND_DMA_POOL_SIZE 512</span>

	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">nx_pcibase</span><span class="p">;</span>		<span class="cm">/* Base I/O address */</span>
	<span class="kt">uint8_t</span>		<span class="o">*</span><span class="n">nxdb_rd_ptr</span><span class="p">;</span>		<span class="cm">/* Doorbell read pointer */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">nxdb_wr_ptr</span><span class="p">;</span>		<span class="cm">/* Door bell write pointer */</span>

	<span class="kt">uint32_t</span>	<span class="n">crb_win</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">curr_window</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">ddr_mn_window</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">mn_win_crb</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">ms_win_crb</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">qdr_sn_window</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">nx_dev_init_timeout</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">nx_reset_timeout</span><span class="p">;</span>
	<span class="n">rwlock_t</span>	<span class="n">hw_lock</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">portnum</span><span class="p">;</span>		<span class="cm">/* port number */</span>
	<span class="kt">int</span>		<span class="n">link_width</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fw_blob</span>	<span class="o">*</span><span class="n">hablob</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla82xx_legacy_intr_set</span> <span class="n">nx_legacy_intr</span><span class="p">;</span>

	<span class="kt">uint16_t</span>	<span class="n">gbl_dsd_inuse</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">gbl_dsd_avail</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">gbl_dsd_list</span><span class="p">;</span>
<span class="cp">#define NUM_DSD_CHAIN 4096</span>

	<span class="kt">uint8_t</span> <span class="n">fw_type</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">file_prd_off</span><span class="p">;</span>	<span class="cm">/* File firmware product offset */</span>

	<span class="kt">uint32_t</span>	<span class="n">md_template_size</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">md_tmplt_hdr</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>      <span class="n">md_tmplt_hdr_dma</span><span class="p">;</span>
	<span class="kt">void</span>            <span class="o">*</span><span class="n">md_dump</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">md_dump_size</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">qlt_hw_data</span> <span class="n">tgt</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Qlogic scsi host structure</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">vp_fcports</span><span class="p">;</span>	<span class="cm">/* list of fcports */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">work_list</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">work_lock</span><span class="p">;</span>

	<span class="cm">/* Commonly used flags and state information. */</span>
	<span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="n">host</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">host_no</span><span class="p">;</span>
	<span class="kt">uint8_t</span>		<span class="n">host_str</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="k">volatile</span> <span class="k">struct</span> <span class="p">{</span>
		<span class="kt">uint32_t</span>	<span class="n">init_done</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">online</span>			<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">reset_active</span>		<span class="o">:</span><span class="mi">1</span><span class="p">;</span>

		<span class="kt">uint32_t</span>	<span class="n">management_server_logged_in</span> <span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">process_response_queue</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">difdix_supported</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="kt">uint32_t</span>	<span class="n">delete_progress</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">atomic_t</span>	<span class="n">loop_state</span><span class="p">;</span>
<span class="cp">#define LOOP_TIMEOUT	1</span>
<span class="cp">#define LOOP_DOWN	2</span>
<span class="cp">#define LOOP_UP		3</span>
<span class="cp">#define LOOP_UPDATE	4</span>
<span class="cp">#define LOOP_READY	5</span>
<span class="cp">#define LOOP_DEAD	6</span>

	<span class="kt">unsigned</span> <span class="kt">long</span>   <span class="n">dpc_flags</span><span class="p">;</span>
<span class="cp">#define RESET_MARKER_NEEDED	0	</span><span class="cm">/* Send marker to ISP. */</span><span class="cp"></span>
<span class="cp">#define RESET_ACTIVE		1</span>
<span class="cp">#define ISP_ABORT_NEEDED	2	</span><span class="cm">/* Initiate ISP abort. */</span><span class="cp"></span>
<span class="cp">#define ABORT_ISP_ACTIVE	3	</span><span class="cm">/* ISP abort in progress. */</span><span class="cp"></span>
<span class="cp">#define LOOP_RESYNC_NEEDED	4	</span><span class="cm">/* Device Resync needed. */</span><span class="cp"></span>
<span class="cp">#define LOOP_RESYNC_ACTIVE	5</span>
<span class="cp">#define LOCAL_LOOP_UPDATE	6	</span><span class="cm">/* Perform a local loop update. */</span><span class="cp"></span>
<span class="cp">#define RSCN_UPDATE		7	</span><span class="cm">/* Perform an RSCN update. */</span><span class="cp"></span>
<span class="cp">#define RELOGIN_NEEDED		8</span>
<span class="cp">#define REGISTER_FC4_NEEDED	9	</span><span class="cm">/* SNS FC4 registration required. */</span><span class="cp"></span>
<span class="cp">#define ISP_ABORT_RETRY		10	</span><span class="cm">/* ISP aborted. */</span><span class="cp"></span>
<span class="cp">#define BEACON_BLINK_NEEDED	11</span>
<span class="cp">#define REGISTER_FDMI_NEEDED	12</span>
<span class="cp">#define FCPORT_UPDATE_NEEDED	13</span>
<span class="cp">#define VP_DPC_NEEDED		14	</span><span class="cm">/* wake up for VP dpc handling */</span><span class="cp"></span>
<span class="cp">#define UNLOADING		15</span>
<span class="cp">#define NPIV_CONFIG_NEEDED	16</span>
<span class="cp">#define ISP_UNRECOVERABLE	17</span>
<span class="cp">#define FCOE_CTX_RESET_NEEDED	18	</span><span class="cm">/* Initiate FCoE context reset */</span><span class="cp"></span>
<span class="cp">#define MPI_RESET_NEEDED	19	</span><span class="cm">/* Initiate MPI FW reset */</span><span class="cp"></span>
<span class="cp">#define ISP_QUIESCE_NEEDED	20	</span><span class="cm">/* Driver need some quiescence */</span><span class="cp"></span>
<span class="cp">#define SCR_PENDING		21	</span><span class="cm">/* SCR in target mode */</span><span class="cp"></span>

	<span class="kt">uint32_t</span>	<span class="n">device_flags</span><span class="p">;</span>
<span class="cp">#define SWITCH_FOUND		BIT_0</span>
<span class="cp">#define DFLG_NO_CABLE		BIT_1</span>
<span class="cp">#define DFLG_DEV_FAILED		BIT_5</span>

	<span class="cm">/* ISP configuration data. */</span>
	<span class="kt">uint16_t</span>	<span class="n">loop_id</span><span class="p">;</span>		<span class="cm">/* Host adapter loop id */</span>

	<span class="n">port_id_t</span>	<span class="n">d_id</span><span class="p">;</span>			<span class="cm">/* Host adapter port id */</span>
	<span class="kt">uint8_t</span>		<span class="n">marker_needed</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">mgmt_svr_loop_id</span><span class="p">;</span>



	<span class="cm">/* Timeout timers. */</span>
	<span class="kt">uint8_t</span>         <span class="n">loop_down_abort_time</span><span class="p">;</span>    <span class="cm">/* port down timer */</span>
	<span class="n">atomic_t</span>        <span class="n">loop_down_timer</span><span class="p">;</span>         <span class="cm">/* loop down timer */</span>
	<span class="kt">uint8_t</span>         <span class="n">link_down_timeout</span><span class="p">;</span>       <span class="cm">/* link down timeout */</span>

	<span class="kt">uint32_t</span>        <span class="n">timer_active</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span>        <span class="n">timer</span><span class="p">;</span>

	<span class="kt">uint8_t</span>		<span class="n">node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span>		<span class="n">port_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>
	<span class="kt">uint8_t</span>		<span class="n">fabric_node_name</span><span class="p">[</span><span class="n">WWN_SIZE</span><span class="p">];</span>

	<span class="kt">uint16_t</span>	<span class="n">fcoe_vlan_id</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">fcoe_fcf_idx</span><span class="p">;</span>
	<span class="kt">uint8_t</span>		<span class="n">fcoe_vn_port_mac</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>

	<span class="kt">uint32_t</span>   	<span class="n">vp_abort_cnt</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">fc_vport</span>	<span class="o">*</span><span class="n">fc_vport</span><span class="p">;</span>	<span class="cm">/* holds fc_vport * for each vport */</span>
	<span class="kt">uint16_t</span>        <span class="n">vp_idx</span><span class="p">;</span>		<span class="cm">/* vport ID */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">vp_flags</span><span class="p">;</span>
<span class="cp">#define VP_IDX_ACQUIRED		0	</span><span class="cm">/* bit no 0 */</span><span class="cp"></span>
<span class="cp">#define VP_CREATE_NEEDED	1</span>
<span class="cp">#define VP_BIND_NEEDED		2</span>
<span class="cp">#define VP_DELETE_NEEDED	3</span>
<span class="cp">#define VP_SCR_NEEDED		4	</span><span class="cm">/* State Change Request registration */</span><span class="cp"></span>
	<span class="n">atomic_t</span> 		<span class="n">vp_state</span><span class="p">;</span>
<span class="cp">#define VP_OFFLINE		0</span>
<span class="cp">#define VP_ACTIVE		1</span>
<span class="cp">#define VP_FAILED		2</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><h1>define VP_DISABLE        3</h1></td><td class="code"><div class="highlight"><pre>	<span class="kt">uint16_t</span> 	<span class="n">vp_err_state</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">vp_prev_err_state</span><span class="p">;</span>
<span class="cp">#define VP_ERR_UNKWN		0</span>
<span class="cp">#define VP_ERR_PORTDWN		1</span>
<span class="cp">#define VP_ERR_FAB_UNSUPPORTED	2</span>
<span class="cp">#define VP_ERR_FAB_NORESOURCES	3</span>
<span class="cp">#define VP_ERR_FAB_LOGOUT	4</span>
<span class="cp">#define VP_ERR_ADAP_NORESOURCES	5</span>
	<span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">req_que</span> <span class="o">*</span><span class="n">req</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">fw_heartbeat_counter</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">seconds_since_last_heartbeat</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fc_host_statistics</span> <span class="n">fc_host_stat</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_statistics</span> <span class="n">qla_stats</span><span class="p">;</span>

	<span class="n">atomic_t</span>	<span class="n">vref_count</span><span class="p">;</span>
<span class="p">}</span> <span class="n">scsi_qla_host_t</span><span class="p">;</span>

<span class="cp">#define SET_VP_IDX	1</span>
<span class="cp">#define SET_AL_PA	2</span>
<span class="cp">#define RESET_VP_IDX	3</span>
<span class="cp">#define RESET_AL_PA	4</span>
<span class="k">struct</span> <span class="n">qla_tgt_vp_map</span> <span class="p">{</span>
	<span class="kt">uint8_t</span>	<span class="n">idx</span><span class="p">;</span>
	<span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Macros to help code, maintain, etc.</span>
<span class="cm"> */</span>
<span class="cp">#define LOOP_TRANSITION(ha) \</span>
<span class="cp">	(test_bit(ISP_ABORT_NEEDED, &amp;ha-&gt;dpc_flags) || \</span>
<span class="cp">	 test_bit(LOOP_RESYNC_NEEDED, &amp;ha-&gt;dpc_flags) || \</span>
<span class="cp">	 atomic_read(&amp;ha-&gt;loop_state) == LOOP_DOWN)</span>

<span class="cp">#define QLA_VHA_MARK_BUSY(__vha, __bail) do {		     \</span>
<span class="cp">	atomic_inc(&amp;__vha-&gt;vref_count);			     \</span>
<span class="cp">	mb();						     \</span>
<span class="cp">	if (__vha-&gt;flags.delete_progress) {		     \</span>
<span class="cp">		atomic_dec(&amp;__vha-&gt;vref_count);		     \</span>
<span class="cp">		__bail = 1;				     \</span>
<span class="cp">	} else {					     \</span>
<span class="cp">		__bail = 0;				     \</span>
<span class="cp">	}						     \</span>
<span class="cp">} while (0)</span>

<span class="cp">#define QLA_VHA_MARK_NOT_BUSY(__vha) do {		     \</span>
<span class="cp">	atomic_dec(&amp;__vha-&gt;vref_count);			     \</span>
<span class="cp">} while (0)</span>

<span class="cm">/*</span>
<span class="cm"> * qla2x00 local function return status codes</span>
<span class="cm"> */</span>
<span class="cp">#define MBS_MASK		0x3fff</span>

<span class="cp">#define QLA_SUCCESS		(MBS_COMMAND_COMPLETE &amp; MBS_MASK)</span>
<span class="cp">#define QLA_INVALID_COMMAND	(MBS_INVALID_COMMAND &amp; MBS_MASK)</span>
<span class="cp">#define QLA_INTERFACE_ERROR	(MBS_HOST_INTERFACE_ERROR &amp; MBS_MASK)</span>
<span class="cp">#define QLA_TEST_FAILED		(MBS_TEST_FAILED &amp; MBS_MASK)</span>
<span class="cp">#define QLA_COMMAND_ERROR	(MBS_COMMAND_ERROR &amp; MBS_MASK)</span>
<span class="cp">#define QLA_PARAMETER_ERROR	(MBS_COMMAND_PARAMETER_ERROR &amp; MBS_MASK)</span>
<span class="cp">#define QLA_PORT_ID_USED	(MBS_PORT_ID_USED &amp; MBS_MASK)</span>
<span class="cp">#define QLA_LOOP_ID_USED	(MBS_LOOP_ID_USED &amp; MBS_MASK)</span>
<span class="cp">#define QLA_ALL_IDS_IN_USE	(MBS_ALL_IDS_IN_USE &amp; MBS_MASK)</span>
<span class="cp">#define QLA_NOT_LOGGED_IN	(MBS_NOT_LOGGED_IN &amp; MBS_MASK)</span>

<span class="cp">#define QLA_FUNCTION_TIMEOUT		0x100</span>
<span class="cp">#define QLA_FUNCTION_PARAMETER_ERROR	0x101</span>
<span class="cp">#define QLA_FUNCTION_FAILED		0x102</span>
<span class="cp">#define QLA_MEMORY_ALLOC_FAILED		0x103</span>
<span class="cp">#define QLA_LOCK_TIMEOUT		0x104</span>
<span class="cp">#define QLA_ABORTED			0x105</span>
<span class="cp">#define QLA_SUSPENDED			0x106</span>
<span class="cp">#define QLA_BUSY			0x107</span>
<span class="cp">#define QLA_ALREADY_REGISTERED		0x109</span>

<span class="cp">#define NVRAM_DELAY()		udelay(10)</span>

<span class="cp">#define INVALID_HANDLE	(MAX_OUTSTANDING_COMMANDS+1)</span>

<span class="cm">/*</span>
<span class="cm"> * Flash support definitions</span>
<span class="cm"> */</span>
<span class="cp">#define OPTROM_SIZE_2300	0x20000</span>
<span class="cp">#define OPTROM_SIZE_2322	0x100000</span>
<span class="cp">#define OPTROM_SIZE_24XX	0x100000</span>
<span class="cp">#define OPTROM_SIZE_25XX	0x200000</span>
<span class="cp">#define OPTROM_SIZE_81XX	0x400000</span>
<span class="cp">#define OPTROM_SIZE_82XX	0x800000</span>
<span class="cp">#define OPTROM_SIZE_83XX	0x1000000</span>

<span class="cp">#define OPTROM_BURST_SIZE	0x1000</span>
<span class="cp">#define OPTROM_BURST_DWORDS	(OPTROM_BURST_SIZE / 4)</span>

<span class="cp">#define	QLA_DSDS_PER_IOCB	37</span>

<span class="cp">#define CMD_SP(Cmnd)		((Cmnd)-&gt;SCp.ptr)</span>

<span class="cp">#define QLA_SG_ALL	1024</span>

<span class="k">enum</span> <span class="n">nexus_wait_type</span> <span class="p">{</span>
	<span class="n">WAIT_HOST</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">WAIT_TARGET</span><span class="p">,</span>
	<span class="n">WAIT_LUN</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#include &quot;qla_gbl.h&quot;</span>
<span class="cp">#include &quot;qla_dbg.h&quot;</span>
<span class="cp">#include &quot;qla_inline.h&quot;</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
