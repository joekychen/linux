<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › qla2xxx › qla_dbg.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>qla_dbg.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * QLogic Fibre Channel HBA Driver</span>
<span class="cm"> * Copyright (c)  2003-2011 QLogic Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * See LICENSE.qla2xxx for copyright and licensing details.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Table for showing the current message id in use for particular level</span>
<span class="cm"> * Change this table for addition of log/debug messages.</span>
<span class="cm"> * ----------------------------------------------------------------------</span>
<span class="cm"> * |             Level            |   Last Value Used  |     Holes	|</span>
<span class="cm"> * ----------------------------------------------------------------------</span>
<span class="cm"> * | Module Init and Probe        |       0x0122       | 0x4b,0xba,0xfa |</span>
<span class="cm"> * | Mailbox commands             |       0x1140       | 0x111a-0x111b  |</span>
<span class="cm"> * |                              |                    | 0x112c-0x112e  |</span>
<span class="cm"> * |                              |                    | 0x113a         |</span>
<span class="cm"> * | Device Discovery             |       0x2086       | 0x2020-0x2022  |</span>
<span class="cm"> * | Queue Command and IO tracing |       0x3030       | 0x3006,0x3008  |</span>
<span class="cm"> * |                              |                    | 0x302d-0x302e  |</span>
<span class="cm"> * | DPC Thread                   |       0x401c       | 0x4002,0x4013  |</span>
<span class="cm"> * | Async Events                 |       0x505f       | 0x502b-0x502f  |</span>
<span class="cm"> * |                              |                    | 0x5047,0x5052  |</span>
<span class="cm"> * | Timer Routines               |       0x6011       |                |</span>
<span class="cm"> * | User Space Interactions      |       0x709f       | 0x7018,0x702e, |</span>
<span class="cm"> * |                              |                    | 0x7039,0x7045, |</span>
<span class="cm"> * |                              |                    | 0x7073-0x7075, |</span>
<span class="cm"> * |                              |                    | 0x708c         |</span>
<span class="cm"> * | Task Management              |       0x803c       | 0x8025-0x8026  |</span>
<span class="cm"> * |                              |                    | 0x800b,0x8039  |</span>
<span class="cm"> * | AER/EEH                      |       0x9011       |		|</span>
<span class="cm"> * | Virtual Port                 |       0xa007       |		|</span>
<span class="cm"> * | ISP82XX Specific             |       0xb054       | 0xb024         |</span>
<span class="cm"> * | MultiQ                       |       0xc00c       |		|</span>
<span class="cm"> * | Misc                         |       0xd010       |		|</span>
<span class="cm"> * | Target Mode		  |	  0xe06f       |		|</span>
<span class="cm"> * | Target Mode Management	  |	  0xf071       |		|</span>
<span class="cm"> * | Target Mode Task Management  |	  0x1000b      |		|</span>
<span class="cm"> * ----------------------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#include &quot;qla_def.h&quot;</span>

<span class="cp">#include &lt;linux/delay.h&gt;</span>

<span class="k">static</span> <span class="kt">uint32_t</span> <span class="n">ql_dbg_offset</span> <span class="o">=</span> <span class="mh">0x800</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">qla2xxx_prep_dump</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span><span class="p">,</span> <span class="k">struct</span> <span class="n">qla2xxx_fw_dump</span> <span class="o">*</span><span class="n">fw_dump</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">fw_major_version</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_major_version</span><span class="p">);</span>
	<span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">fw_minor_version</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_minor_version</span><span class="p">);</span>
	<span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">fw_subminor_version</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_subminor_version</span><span class="p">);</span>
	<span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">fw_attributes</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_attributes</span><span class="p">);</span>

	<span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">vendor</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">vendor</span><span class="p">);</span>
	<span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">device</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">);</span>
	<span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">subsystem_vendor</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">subsystem_vendor</span><span class="p">);</span>
	<span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">subsystem_device</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">subsystem_device</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span>
<span class="nf">qla2xxx_copy_queues</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">req_que</span> <span class="o">*</span><span class="n">req</span> <span class="o">=</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">req_q_map</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">rsp_que</span> <span class="o">*</span><span class="n">rsp</span> <span class="o">=</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">rsp_q_map</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="cm">/* Request queue. */</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">ring</span><span class="p">,</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span>
	    <span class="k">sizeof</span><span class="p">(</span><span class="n">request_t</span><span class="p">));</span>

	<span class="cm">/* Response queue. */</span>
	<span class="n">ptr</span> <span class="o">+=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">request_t</span><span class="p">);</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">rsp</span><span class="o">-&gt;</span><span class="n">ring</span><span class="p">,</span> <span class="n">rsp</span><span class="o">-&gt;</span><span class="n">length</span>  <span class="o">*</span>
	    <span class="k">sizeof</span><span class="p">(</span><span class="n">response_t</span><span class="p">));</span>

	<span class="k">return</span> <span class="n">ptr</span> <span class="o">+</span> <span class="p">(</span><span class="n">rsp</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">response_t</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">qla24xx_dump_ram</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">ram</span><span class="p">,</span>
    <span class="kt">uint32_t</span> <span class="n">ram_dwords</span><span class="p">,</span> <span class="kt">void</span> <span class="o">**</span><span class="n">nxt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rval</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">timer</span><span class="p">,</span> <span class="n">dwords</span><span class="p">,</span> <span class="n">idx</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">mb0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_24xx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp24</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">dump_dma</span> <span class="o">=</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">gid_list_dma</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="o">*</span><span class="n">dump</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="o">*</span><span class="p">)</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">gid_list</span><span class="p">;</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span>
	<span class="n">mb0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox0</span><span class="p">,</span> <span class="n">MBC_DUMP_RISC_RAM_EXTENDED</span><span class="p">);</span>
	<span class="n">clear_bit</span><span class="p">(</span><span class="n">MBX_INTERRUPT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mbx_cmd_flags</span><span class="p">);</span>

	<span class="n">dwords</span> <span class="o">=</span> <span class="n">qla2x00_gid_list_size</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="n">ram_dwords</span> <span class="o">&amp;&amp;</span> <span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span>
	    <span class="n">cnt</span> <span class="o">+=</span> <span class="n">dwords</span><span class="p">,</span> <span class="n">addr</span> <span class="o">+=</span> <span class="n">dwords</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">+</span> <span class="n">dwords</span> <span class="o">&gt;</span> <span class="n">ram_dwords</span><span class="p">)</span>
			<span class="n">dwords</span> <span class="o">=</span> <span class="n">ram_dwords</span> <span class="o">-</span> <span class="n">cnt</span><span class="p">;</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox1</span><span class="p">,</span> <span class="n">LSW</span><span class="p">(</span><span class="n">addr</span><span class="p">));</span>
		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox8</span><span class="p">,</span> <span class="n">MSW</span><span class="p">(</span><span class="n">addr</span><span class="p">));</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox2</span><span class="p">,</span> <span class="n">MSW</span><span class="p">(</span><span class="n">dump_dma</span><span class="p">));</span>
		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox3</span><span class="p">,</span> <span class="n">LSW</span><span class="p">(</span><span class="n">dump_dma</span><span class="p">));</span>
		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox6</span><span class="p">,</span> <span class="n">MSW</span><span class="p">(</span><span class="n">MSD</span><span class="p">(</span><span class="n">dump_dma</span><span class="p">)));</span>
		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox7</span><span class="p">,</span> <span class="n">LSW</span><span class="p">(</span><span class="n">MSD</span><span class="p">(</span><span class="n">dump_dma</span><span class="p">)));</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox4</span><span class="p">,</span> <span class="n">MSW</span><span class="p">(</span><span class="n">dwords</span><span class="p">));</span>
		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox5</span><span class="p">,</span> <span class="n">LSW</span><span class="p">(</span><span class="n">dwords</span><span class="p">));</span>
		<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCRX_SET_HOST_INT</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">timer</span> <span class="o">=</span> <span class="mi">6000000</span><span class="p">;</span> <span class="n">timer</span><span class="p">;</span> <span class="n">timer</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Check for pending interrupts. */</span>
			<span class="n">stat</span> <span class="o">=</span> <span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">host_status</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">stat</span> <span class="o">&amp;</span> <span class="n">HSRX_RISC_INT</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">stat</span> <span class="o">&amp;=</span> <span class="mh">0xff</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">stat</span> <span class="o">==</span> <span class="mh">0x1</span> <span class="o">||</span> <span class="n">stat</span> <span class="o">==</span> <span class="mh">0x2</span> <span class="o">||</span>
				    <span class="n">stat</span> <span class="o">==</span> <span class="mh">0x10</span> <span class="o">||</span> <span class="n">stat</span> <span class="o">==</span> <span class="mh">0x11</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">set_bit</span><span class="p">(</span><span class="n">MBX_INTERRUPT</span><span class="p">,</span>
					    <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mbx_cmd_flags</span><span class="p">);</span>

					<span class="n">mb0</span> <span class="o">=</span> <span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox0</span><span class="p">);</span>

					<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span>
					    <span class="n">HCCRX_CLR_RISC_INT</span><span class="p">);</span>
					<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>

				<span class="cm">/* Clear this intr; it wasn&#39;t a mailbox intr */</span>
				<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCRX_CLR_RISC_INT</span><span class="p">);</span>
				<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">test_and_clear_bit</span><span class="p">(</span><span class="n">MBX_INTERRUPT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mbx_cmd_flags</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">rval</span> <span class="o">=</span> <span class="n">mb0</span> <span class="o">&amp;</span> <span class="n">MBS_MASK</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">dwords</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
				<span class="n">ram</span><span class="p">[</span><span class="n">cnt</span> <span class="o">+</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">swab32</span><span class="p">(</span><span class="n">dump</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_FUNCTION_FAILED</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="n">nxt</span> <span class="o">=</span> <span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span> <span class="o">?</span> <span class="o">&amp;</span><span class="n">ram</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">:</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">rval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">qla24xx_dump_memory</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">code_ram</span><span class="p">,</span>
    <span class="kt">uint32_t</span> <span class="n">cram_size</span><span class="p">,</span> <span class="kt">void</span> <span class="o">**</span><span class="n">nxt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rval</span><span class="p">;</span>

	<span class="cm">/* Code RAM. */</span>
	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_dump_ram</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="mh">0x20000</span><span class="p">,</span> <span class="n">code_ram</span><span class="p">,</span> <span class="n">cram_size</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">nxt</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">rval</span><span class="p">;</span>

	<span class="cm">/* External Memory. */</span>
	<span class="k">return</span> <span class="n">qla24xx_dump_ram</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="mh">0x100000</span><span class="p">,</span> <span class="o">*</span><span class="n">nxt</span><span class="p">,</span>
	    <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_memory_size</span> <span class="o">-</span> <span class="mh">0x100000</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxt</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">uint32_t</span> <span class="o">*</span>
<span class="nf">qla24xx_read_window</span><span class="p">(</span><span class="k">struct</span> <span class="n">device_reg_24xx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">iobase</span><span class="p">,</span>
    <span class="kt">uint32_t</span> <span class="n">count</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dmp_reg</span><span class="p">;</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="n">iobase</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span>
<span class="nf">qla24xx_pause_risc</span><span class="p">(</span><span class="k">struct</span> <span class="n">device_reg_24xx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">cnt</span><span class="p">;</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCRX_SET_RISC_PAUSE</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">;</span>
	    <span class="p">((</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">host_status</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">HSRX_RISC_PAUSED</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span> <span class="n">cnt</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_FUNCTION_TIMEOUT</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">rval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">qla24xx_soft_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">cnt</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">mb0</span><span class="p">,</span> <span class="n">wd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_24xx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp24</span><span class="p">;</span>

	<span class="cm">/* Reset RISC. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="n">CSRX_DMA_SHUTDOWN</span><span class="o">|</span><span class="n">MWB_4096_BYTES</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">30000</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">CSRX_DMA_ACTIVE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span>
	    <span class="n">CSRX_ISP_SOFT_RESET</span><span class="o">|</span><span class="n">CSRX_DMA_SHUTDOWN</span><span class="o">|</span><span class="n">MWB_4096_BYTES</span><span class="p">);</span>
	<span class="n">pci_read_config_word</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">,</span> <span class="n">PCI_COMMAND</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wd</span><span class="p">);</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
	<span class="cm">/* Wait for firmware to complete NVRAM accesses. */</span>
	<span class="n">mb0</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox0</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">10000</span> <span class="p">;</span> <span class="n">cnt</span> <span class="o">&amp;&amp;</span> <span class="n">mb0</span><span class="p">;</span> <span class="n">cnt</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
		<span class="n">mb0</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox0</span><span class="p">);</span>
		<span class="n">barrier</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="cm">/* Wait for soft-reset to complete. */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">30000</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">)</span> <span class="o">&amp;</span>
		    <span class="n">CSRX_ISP_SOFT_RESET</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCRX_CLR_RISC_RESET</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>             <span class="cm">/* PCI Posting. */</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">;</span> <span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
	    <span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span> <span class="n">cnt</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_FUNCTION_TIMEOUT</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">rval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">qla2xxx_dump_ram</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="o">*</span><span class="n">ram</span><span class="p">,</span>
    <span class="kt">uint32_t</span> <span class="n">ram_words</span><span class="p">,</span> <span class="kt">void</span> <span class="o">**</span><span class="n">nxt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rval</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">stat</span><span class="p">,</span> <span class="n">timer</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">idx</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">mb0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_2xxx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">dump_dma</span> <span class="o">=</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">gid_list_dma</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="o">*</span><span class="n">dump</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint16_t</span> <span class="o">*</span><span class="p">)</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">gid_list</span><span class="p">;</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span>
	<span class="n">mb0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">WRT_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MBC_DUMP_RISC_RAM_EXTENDED</span><span class="p">);</span>
	<span class="n">clear_bit</span><span class="p">(</span><span class="n">MBX_INTERRUPT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mbx_cmd_flags</span><span class="p">);</span>

	<span class="n">words</span> <span class="o">=</span> <span class="n">qla2x00_gid_list_size</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="n">ram_words</span> <span class="o">&amp;&amp;</span> <span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span>
	    <span class="n">cnt</span> <span class="o">+=</span> <span class="n">words</span><span class="p">,</span> <span class="n">addr</span> <span class="o">+=</span> <span class="n">words</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">+</span> <span class="n">words</span> <span class="o">&gt;</span> <span class="n">ram_words</span><span class="p">)</span>
			<span class="n">words</span> <span class="o">=</span> <span class="n">ram_words</span> <span class="o">-</span> <span class="n">cnt</span><span class="p">;</span>

		<span class="n">WRT_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">LSW</span><span class="p">(</span><span class="n">addr</span><span class="p">));</span>
		<span class="n">WRT_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">MSW</span><span class="p">(</span><span class="n">addr</span><span class="p">));</span>

		<span class="n">WRT_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">MSW</span><span class="p">(</span><span class="n">dump_dma</span><span class="p">));</span>
		<span class="n">WRT_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">LSW</span><span class="p">(</span><span class="n">dump_dma</span><span class="p">));</span>
		<span class="n">WRT_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">MSW</span><span class="p">(</span><span class="n">MSD</span><span class="p">(</span><span class="n">dump_dma</span><span class="p">)));</span>
		<span class="n">WRT_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">LSW</span><span class="p">(</span><span class="n">MSD</span><span class="p">(</span><span class="n">dump_dma</span><span class="p">)));</span>

		<span class="n">WRT_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">words</span><span class="p">);</span>
		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCR_SET_HOST_INT</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">timer</span> <span class="o">=</span> <span class="mi">6000000</span><span class="p">;</span> <span class="n">timer</span><span class="p">;</span> <span class="n">timer</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Check for pending interrupts. */</span>
			<span class="n">stat</span> <span class="o">=</span> <span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">isp2300</span><span class="p">.</span><span class="n">host_status</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">stat</span> <span class="o">&amp;</span> <span class="n">HSR_RISC_INT</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">stat</span> <span class="o">&amp;=</span> <span class="mh">0xff</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">stat</span> <span class="o">==</span> <span class="mh">0x1</span> <span class="o">||</span> <span class="n">stat</span> <span class="o">==</span> <span class="mh">0x2</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">set_bit</span><span class="p">(</span><span class="n">MBX_INTERRUPT</span><span class="p">,</span>
					    <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mbx_cmd_flags</span><span class="p">);</span>

					<span class="n">mb0</span> <span class="o">=</span> <span class="n">RD_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

					<span class="cm">/* Release mailbox registers. */</span>
					<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">semaphore</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span>
					    <span class="n">HCCR_CLR_RISC_INT</span><span class="p">);</span>
					<span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">stat</span> <span class="o">==</span> <span class="mh">0x10</span> <span class="o">||</span> <span class="n">stat</span> <span class="o">==</span> <span class="mh">0x11</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">set_bit</span><span class="p">(</span><span class="n">MBX_INTERRUPT</span><span class="p">,</span>
					    <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mbx_cmd_flags</span><span class="p">);</span>

					<span class="n">mb0</span> <span class="o">=</span> <span class="n">RD_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

					<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span>
					    <span class="n">HCCR_CLR_RISC_INT</span><span class="p">);</span>
					<span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>

				<span class="cm">/* clear this intr; it wasn&#39;t a mailbox intr */</span>
				<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCR_CLR_RISC_INT</span><span class="p">);</span>
				<span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">test_and_clear_bit</span><span class="p">(</span><span class="n">MBX_INTERRUPT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mbx_cmd_flags</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">rval</span> <span class="o">=</span> <span class="n">mb0</span> <span class="o">&amp;</span> <span class="n">MBS_MASK</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">words</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
				<span class="n">ram</span><span class="p">[</span><span class="n">cnt</span> <span class="o">+</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">swab16</span><span class="p">(</span><span class="n">dump</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_FUNCTION_FAILED</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="n">nxt</span> <span class="o">=</span> <span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span> <span class="o">?</span> <span class="o">&amp;</span><span class="n">ram</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">:</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">rval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">qla2xxx_read_window</span><span class="p">(</span><span class="k">struct</span> <span class="n">device_reg_2xxx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">count</span><span class="p">,</span>
    <span class="kt">uint16_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint16_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">isp2300</span><span class="p">.</span><span class="n">fb_cmd</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span>
<span class="nf">qla24xx_copy_eft</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">eft</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ptr</span><span class="p">;</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">eft</span><span class="p">,</span> <span class="n">ntohl</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">eft_size</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">ptr</span> <span class="o">+</span> <span class="n">ntohl</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">eft_size</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span>
<span class="nf">qla25xx_copy_fce</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">**</span><span class="n">last_chain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">cnt</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="o">*</span><span class="n">iter_reg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla2xxx_fce_chain</span> <span class="o">*</span><span class="n">fcec</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fce</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ptr</span><span class="p">;</span>

	<span class="o">*</span><span class="n">last_chain</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fcec</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">;</span>
	<span class="n">fcec</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_FCE</span><span class="p">);</span>
	<span class="n">fcec</span><span class="o">-&gt;</span><span class="n">chain_size</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_fce_chain</span><span class="p">)</span> <span class="o">+</span>
	    <span class="n">fce_calc_size</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fce_bufs</span><span class="p">));</span>
	<span class="n">fcec</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">fce_calc_size</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fce_bufs</span><span class="p">));</span>
	<span class="n">fcec</span><span class="o">-&gt;</span><span class="n">addr_l</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">LSD</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fce_dma</span><span class="p">));</span>
	<span class="n">fcec</span><span class="o">-&gt;</span><span class="n">addr_h</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">MSD</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fce_dma</span><span class="p">));</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fcec</span><span class="o">-&gt;</span><span class="n">eregs</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fce_mb</span><span class="p">[</span><span class="n">cnt</span><span class="p">]);</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">iter_reg</span><span class="p">,</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fce</span><span class="p">,</span> <span class="n">ntohl</span><span class="p">(</span><span class="n">fcec</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">));</span>

	<span class="k">return</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">iter_reg</span> <span class="o">+</span> <span class="n">ntohl</span><span class="p">(</span><span class="n">fcec</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span>
<span class="nf">qla2xxx_copy_atioqueues</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span>
	<span class="kt">uint32_t</span> <span class="o">**</span><span class="n">last_chain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">qla2xxx_mqueue_chain</span> <span class="o">*</span><span class="n">q</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla2xxx_mqueue_header</span> <span class="o">*</span><span class="n">qh</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">num_queues</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">que</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">length</span><span class="p">;</span>
		<span class="kt">void</span> <span class="o">*</span><span class="n">ring</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">aq</span><span class="p">,</span> <span class="o">*</span><span class="n">aqp</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">tgt</span><span class="p">.</span><span class="n">atio_q_length</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ptr</span><span class="p">;</span>

	<span class="n">num_queues</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">aqp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">aq</span><span class="p">;</span>
	<span class="n">aqp</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">=</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">tgt</span><span class="p">.</span><span class="n">atio_q_length</span><span class="p">;</span>
	<span class="n">aqp</span><span class="o">-&gt;</span><span class="n">ring</span> <span class="o">=</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">tgt</span><span class="p">.</span><span class="n">atio_ring</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">que</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">que</span> <span class="o">&lt;</span> <span class="n">num_queues</span><span class="p">;</span> <span class="n">que</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* aqp = ha-&gt;atio_q_map[que]; */</span>
		<span class="n">q</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
		<span class="o">*</span><span class="n">last_chain</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">;</span>
		<span class="n">q</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_QUEUE</span><span class="p">);</span>
		<span class="n">q</span><span class="o">-&gt;</span><span class="n">chain_size</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_chain</span><span class="p">)</span> <span class="o">+</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_header</span><span class="p">)</span> <span class="o">+</span>
		    <span class="p">(</span><span class="n">aqp</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">request_t</span><span class="p">)));</span>
		<span class="n">ptr</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_chain</span><span class="p">);</span>

		<span class="cm">/* Add header. */</span>
		<span class="n">qh</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
		<span class="n">qh</span><span class="o">-&gt;</span><span class="n">queue</span> <span class="o">=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">TYPE_ATIO_QUEUE</span><span class="p">);</span>
		<span class="n">qh</span><span class="o">-&gt;</span><span class="n">number</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">que</span><span class="p">);</span>
		<span class="n">qh</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">aqp</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">request_t</span><span class="p">));</span>
		<span class="n">ptr</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_header</span><span class="p">);</span>

		<span class="cm">/* Add data. */</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">aqp</span><span class="o">-&gt;</span><span class="n">ring</span><span class="p">,</span> <span class="n">aqp</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">request_t</span><span class="p">));</span>

		<span class="n">ptr</span> <span class="o">+=</span> <span class="n">aqp</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">request_t</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span>
<span class="nf">qla25xx_copy_mqueues</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">**</span><span class="n">last_chain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">qla2xxx_mqueue_chain</span> <span class="o">*</span><span class="n">q</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla2xxx_mqueue_header</span> <span class="o">*</span><span class="n">qh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">req_que</span> <span class="o">*</span><span class="n">req</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rsp_que</span> <span class="o">*</span><span class="n">rsp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">que</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mqenable</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ptr</span><span class="p">;</span>

	<span class="cm">/* Request queues */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">que</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">que</span> <span class="o">&lt;</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">max_req_queues</span><span class="p">;</span> <span class="n">que</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">req</span> <span class="o">=</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">req_q_map</span><span class="p">[</span><span class="n">que</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">req</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="cm">/* Add chain. */</span>
		<span class="n">q</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
		<span class="o">*</span><span class="n">last_chain</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">;</span>
		<span class="n">q</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_QUEUE</span><span class="p">);</span>
		<span class="n">q</span><span class="o">-&gt;</span><span class="n">chain_size</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_chain</span><span class="p">)</span> <span class="o">+</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_header</span><span class="p">)</span> <span class="o">+</span>
		    <span class="p">(</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">request_t</span><span class="p">)));</span>
		<span class="n">ptr</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_chain</span><span class="p">);</span>

		<span class="cm">/* Add header. */</span>
		<span class="n">qh</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
		<span class="n">qh</span><span class="o">-&gt;</span><span class="n">queue</span> <span class="o">=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">TYPE_REQUEST_QUEUE</span><span class="p">);</span>
		<span class="n">qh</span><span class="o">-&gt;</span><span class="n">number</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">que</span><span class="p">);</span>
		<span class="n">qh</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">request_t</span><span class="p">));</span>
		<span class="n">ptr</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_header</span><span class="p">);</span>

		<span class="cm">/* Add data. */</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">ring</span><span class="p">,</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">request_t</span><span class="p">));</span>
		<span class="n">ptr</span> <span class="o">+=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">request_t</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Response queues */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">que</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">que</span> <span class="o">&lt;</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">max_rsp_queues</span><span class="p">;</span> <span class="n">que</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rsp</span> <span class="o">=</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">rsp_q_map</span><span class="p">[</span><span class="n">que</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rsp</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="cm">/* Add chain. */</span>
		<span class="n">q</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
		<span class="o">*</span><span class="n">last_chain</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">q</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">;</span>
		<span class="n">q</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_QUEUE</span><span class="p">);</span>
		<span class="n">q</span><span class="o">-&gt;</span><span class="n">chain_size</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_chain</span><span class="p">)</span> <span class="o">+</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_header</span><span class="p">)</span> <span class="o">+</span>
		    <span class="p">(</span><span class="n">rsp</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">response_t</span><span class="p">)));</span>
		<span class="n">ptr</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_chain</span><span class="p">);</span>

		<span class="cm">/* Add header. */</span>
		<span class="n">qh</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
		<span class="n">qh</span><span class="o">-&gt;</span><span class="n">queue</span> <span class="o">=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">TYPE_RESPONSE_QUEUE</span><span class="p">);</span>
		<span class="n">qh</span><span class="o">-&gt;</span><span class="n">number</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">que</span><span class="p">);</span>
		<span class="n">qh</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">rsp</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">response_t</span><span class="p">));</span>
		<span class="n">ptr</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mqueue_header</span><span class="p">);</span>

		<span class="cm">/* Add data. */</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">rsp</span><span class="o">-&gt;</span><span class="n">ring</span><span class="p">,</span> <span class="n">rsp</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">response_t</span><span class="p">));</span>
		<span class="n">ptr</span> <span class="o">+=</span> <span class="n">rsp</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">response_t</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span>
<span class="nf">qla25xx_copy_mq</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">**</span><span class="n">last_chain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">que_idx</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">que_cnt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla2xxx_mq_chain</span> <span class="o">*</span><span class="n">mq</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_25xxmq</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mqenable</span> <span class="o">||</span> <span class="n">IS_QLA83XX</span><span class="p">(</span><span class="n">ha</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">ptr</span><span class="p">;</span>

	<span class="n">mq</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>
	<span class="o">*</span><span class="n">last_chain</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mq</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">;</span>
	<span class="n">mq</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_MQ</span><span class="p">);</span>
	<span class="n">mq</span><span class="o">-&gt;</span><span class="n">chain_size</span> <span class="o">=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mq_chain</span><span class="p">));</span>

	<span class="n">que_cnt</span> <span class="o">=</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">max_req_queues</span> <span class="o">&gt;</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">max_rsp_queues</span> <span class="o">?</span>
		<span class="n">ha</span><span class="o">-&gt;</span><span class="n">max_req_queues</span> <span class="o">:</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">max_rsp_queues</span><span class="p">;</span>
	<span class="n">mq</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">que_cnt</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="n">que_cnt</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">device_reg_25xxmq</span> <span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span>
			<span class="n">ha</span><span class="o">-&gt;</span><span class="n">mqiobase</span> <span class="o">+</span> <span class="n">cnt</span> <span class="o">*</span> <span class="n">QLA_QUE_PAGE</span><span class="p">);</span>
		<span class="n">que_idx</span> <span class="o">=</span> <span class="n">cnt</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">mq</span><span class="o">-&gt;</span><span class="n">qregs</span><span class="p">[</span><span class="n">que_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">req_q_in</span><span class="p">));</span>
		<span class="n">mq</span><span class="o">-&gt;</span><span class="n">qregs</span><span class="p">[</span><span class="n">que_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">req_q_out</span><span class="p">));</span>
		<span class="n">mq</span><span class="o">-&gt;</span><span class="n">qregs</span><span class="p">[</span><span class="n">que_idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">rsp_q_in</span><span class="p">));</span>
		<span class="n">mq</span><span class="o">-&gt;</span><span class="n">qregs</span><span class="p">[</span><span class="n">que_idx</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">rsp_q_out</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ptr</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">qla2xxx_mq_chain</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">qla2xxx_dump_post_process</span><span class="p">(</span><span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rval</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span> <span class="o">=</span> <span class="n">vha</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd000</span><span class="p">,</span>
		    <span class="s">&quot;Failed to dump firmware (%x).</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rval</span><span class="p">);</span>
		<span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dumped</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_info</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd001</span><span class="p">,</span>
		    <span class="s">&quot;Firmware dump saved to temp buffer (%ld/%p).</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">vha</span><span class="o">-&gt;</span><span class="n">host_no</span><span class="p">,</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>
		<span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dumped</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">qla2x00_post_uevent_work</span><span class="p">(</span><span class="n">vha</span><span class="p">,</span> <span class="n">QLA_UEVENT_CODE_FW_DUMP</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * qla2300_fw_dump() - Dumps binary data from the 2300 firmware.</span>
<span class="cm"> * @ha: HA context</span>
<span class="cm"> * @hardware_locked: Called with the hardware_lock</span>
<span class="cm"> */</span>
<span class="kt">void</span>
<span class="nf">qla2300_fw_dump</span><span class="p">(</span><span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hardware_locked</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span>		<span class="n">rval</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">cnt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span> <span class="o">=</span> <span class="n">vha</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_2xxx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dmp_reg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla2300_fw_dump</span>	<span class="o">*</span><span class="n">fw</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">nxt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="n">base_vha</span> <span class="o">=</span> <span class="n">pci_get_drvdata</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">);</span>

	<span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd002</span><span class="p">,</span>
		    <span class="s">&quot;No buffer available for dump.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla2300_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dumped</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd003</span><span class="p">,</span>
		    <span class="s">&quot;Firmware has been previously dumped (%p) &quot;</span>
		    <span class="s">&quot;-- ignoring request.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla2300_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">fw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">isp</span><span class="p">.</span><span class="n">isp23</span><span class="p">;</span>
	<span class="n">qla2xxx_prep_dump</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">hccr</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">));</span>

	<span class="cm">/* Pause RISC. */</span>
	<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCR_PAUSE_RISC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IS_QLA2300</span><span class="p">(</span><span class="n">ha</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">;</span>
		    <span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">HCCR_RISC_PAUSE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
			<span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span> <span class="n">cnt</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
				<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_FUNCTION_TIMEOUT</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>		<span class="cm">/* PCI Posting. */</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">flash_address</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">pbiu_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
			<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pbiu_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

		<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">isp2300</span><span class="p">.</span><span class="n">req_q_in</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_host_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
			<span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_host_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

		<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">isp2300</span><span class="p">.</span><span class="n">mailbox0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">mailbox_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
			<span class="n">fw</span><span class="o">-&gt;</span><span class="n">mailbox_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">resp_dma_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">dma_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">risc_hw</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_hdw_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
			<span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_hdw_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp0_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2200</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp1_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2400</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp2_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2600</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp3_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2800</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp4_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2A00</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp5_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2C00</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp6_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2E00</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp7_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">frame_buf_hdw_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fpm_b0_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fpm_b1_reg</span><span class="p">);</span>

		<span class="cm">/* Reset RISC. */</span>
		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="n">CSR_ISP_SOFT_RESET</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">30000</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">)</span> <span class="o">&amp;</span>
			    <span class="n">CSR_ISP_SOFT_RESET</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_QLA2300</span><span class="p">(</span><span class="n">ha</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">;</span> <span class="n">RD_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
		    <span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span> <span class="n">cnt</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
				<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_FUNCTION_TIMEOUT</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/* Get RISC SRAM. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="n">rval</span> <span class="o">=</span> <span class="n">qla2xxx_dump_ram</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="mh">0x800</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_ram</span><span class="p">,</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_ram</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nxt</span><span class="p">);</span>

	<span class="cm">/* Get stack SRAM. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="n">rval</span> <span class="o">=</span> <span class="n">qla2xxx_dump_ram</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="mh">0x10000</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">stack_ram</span><span class="p">,</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">stack_ram</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nxt</span><span class="p">);</span>

	<span class="cm">/* Get data SRAM. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="n">rval</span> <span class="o">=</span> <span class="n">qla2xxx_dump_ram</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="mh">0x11000</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">data_ram</span><span class="p">,</span>
		    <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_memory_size</span> <span class="o">-</span> <span class="mh">0x11000</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nxt</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="n">qla2xxx_copy_queues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt</span><span class="p">);</span>

	<span class="n">qla2xxx_dump_post_process</span><span class="p">(</span><span class="n">base_vha</span><span class="p">,</span> <span class="n">rval</span><span class="p">);</span>

<span class="nl">qla2300_fw_dump_failed:</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * qla2100_fw_dump() - Dumps binary data from the 2100/2200 firmware.</span>
<span class="cm"> * @ha: HA context</span>
<span class="cm"> * @hardware_locked: Called with the hardware_lock</span>
<span class="cm"> */</span>
<span class="kt">void</span>
<span class="nf">qla2100_fw_dump</span><span class="p">(</span><span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hardware_locked</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span>		<span class="n">rval</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">cnt</span><span class="p">,</span> <span class="n">timer</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">risc_address</span><span class="p">;</span>
	<span class="kt">uint16_t</span>	<span class="n">mb0</span><span class="p">,</span> <span class="n">mb2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span> <span class="o">=</span> <span class="n">vha</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_2xxx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dmp_reg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla2100_fw_dump</span>	<span class="o">*</span><span class="n">fw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="n">base_vha</span> <span class="o">=</span> <span class="n">pci_get_drvdata</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">);</span>

	<span class="n">risc_address</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">mb0</span> <span class="o">=</span> <span class="n">mb2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd004</span><span class="p">,</span>
		    <span class="s">&quot;No buffer available for dump.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla2100_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dumped</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd005</span><span class="p">,</span>
		    <span class="s">&quot;Firmware has been previously dumped (%p) &quot;</span>
		    <span class="s">&quot;-- ignoring request.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla2100_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">fw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">isp</span><span class="p">.</span><span class="n">isp21</span><span class="p">;</span>
	<span class="n">qla2xxx_prep_dump</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">hccr</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">));</span>

	<span class="cm">/* Pause RISC. */</span>
	<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCR_PAUSE_RISC</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">;</span> <span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">HCCR_RISC_PAUSE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
	    <span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span> <span class="n">cnt</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_FUNCTION_TIMEOUT</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">flash_address</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">pbiu_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
			<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pbiu_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

		<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">isp2100</span><span class="p">.</span><span class="n">mailbox0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">mbx_count</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span>
				<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">u_end</span><span class="p">.</span><span class="n">isp2200</span><span class="p">.</span><span class="n">mailbox8</span><span class="p">;</span>

			<span class="n">fw</span><span class="o">-&gt;</span><span class="n">mailbox_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>
		<span class="p">}</span>

		<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">isp2100</span><span class="p">.</span><span class="n">unused_2</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">dma_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
			<span class="n">fw</span><span class="o">-&gt;</span><span class="n">dma_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">risc_hw</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_hdw_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
			<span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_hdw_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp0_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2100</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp1_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2200</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp2_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2300</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp3_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2400</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp4_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2500</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp5_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2600</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp6_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">pcr</span><span class="p">,</span> <span class="mh">0x2700</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp7_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">frame_buf_hdw_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fpm_b0_reg</span><span class="p">);</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">);</span>
		<span class="n">qla2xxx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fpm_b1_reg</span><span class="p">);</span>

		<span class="cm">/* Reset the ISP. */</span>
		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ctrl_status</span><span class="p">,</span> <span class="n">CSR_ISP_SOFT_RESET</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">;</span> <span class="n">RD_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
	    <span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span> <span class="n">cnt</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_FUNCTION_TIMEOUT</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Pause RISC. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">IS_QLA2200</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">IS_QLA2100</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mctr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">BIT_1</span> <span class="o">|</span> <span class="n">BIT_0</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)))</span> <span class="p">{</span>

		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCR_PAUSE_RISC</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">;</span>
		    <span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">HCCR_RISC_PAUSE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
		    <span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span> <span class="n">cnt</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
				<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_FUNCTION_TIMEOUT</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Set memory configuration and timing. */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">IS_QLA2100</span><span class="p">(</span><span class="n">ha</span><span class="p">))</span>
				<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mctr</span><span class="p">,</span> <span class="mh">0xf1</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mctr</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">);</span>
			<span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mctr</span><span class="p">);</span>	<span class="cm">/* PCI Posting. */</span>

			<span class="cm">/* Release RISC. */</span>
			<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCR_RELEASE_RISC</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Get RISC SRAM. */</span>
		<span class="n">risc_address</span> <span class="o">=</span> <span class="mh">0x1000</span><span class="p">;</span>
 		<span class="n">WRT_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">MBC_READ_RAM_WORD</span><span class="p">);</span>
		<span class="n">clear_bit</span><span class="p">(</span><span class="n">MBX_INTERRUPT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mbx_cmd_flags</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_ram</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span>
	    <span class="n">cnt</span><span class="o">++</span><span class="p">,</span> <span class="n">risc_address</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
 		<span class="n">WRT_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">risc_address</span><span class="p">);</span>
		<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCR_SET_HOST_INT</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">timer</span> <span class="o">=</span> <span class="mi">6000000</span><span class="p">;</span> <span class="n">timer</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">timer</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Check for pending interrupts. */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">istatus</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ISR_RISC_INT</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">semaphore</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">BIT_0</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">set_bit</span><span class="p">(</span><span class="n">MBX_INTERRUPT</span><span class="p">,</span>
					    <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mbx_cmd_flags</span><span class="p">);</span>

					<span class="n">mb0</span> <span class="o">=</span> <span class="n">RD_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">mb2</span> <span class="o">=</span> <span class="n">RD_MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

					<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">semaphore</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span>
					    <span class="n">HCCR_CLR_RISC_INT</span><span class="p">);</span>
					<span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">WRT_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCR_CLR_RISC_INT</span><span class="p">);</span>
				<span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">test_and_clear_bit</span><span class="p">(</span><span class="n">MBX_INTERRUPT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">mbx_cmd_flags</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">rval</span> <span class="o">=</span> <span class="n">mb0</span> <span class="o">&amp;</span> <span class="n">MBS_MASK</span><span class="p">;</span>
			<span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_ram</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">mb2</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_FUNCTION_FAILED</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">==</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="n">qla2xxx_copy_queues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_ram</span><span class="p">[</span><span class="n">cnt</span><span class="p">]);</span>

	<span class="n">qla2xxx_dump_post_process</span><span class="p">(</span><span class="n">base_vha</span><span class="p">,</span> <span class="n">rval</span><span class="p">);</span>

<span class="nl">qla2100_fw_dump_failed:</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">qla24xx_fw_dump</span><span class="p">(</span><span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hardware_locked</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span>		<span class="n">rval</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">cnt</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">risc_address</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span> <span class="o">=</span> <span class="n">vha</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_24xx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp24</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dmp_reg</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="o">*</span><span class="n">iter_reg</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mbx_reg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla24xx_fw_dump</span> <span class="o">*</span><span class="n">fw</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">ext_mem_cnt</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">nxt</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">nxt_chain</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="o">*</span><span class="n">last_chain</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="n">base_vha</span> <span class="o">=</span> <span class="n">pci_get_drvdata</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">IS_QLA82XX</span><span class="p">(</span><span class="n">ha</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">risc_address</span> <span class="o">=</span> <span class="n">ext_mem_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd006</span><span class="p">,</span>
		    <span class="s">&quot;No buffer available for dump.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla24xx_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dumped</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd007</span><span class="p">,</span>
		    <span class="s">&quot;Firmware has been previously dumped (%p) &quot;</span>
		    <span class="s">&quot;-- ignoring request.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla24xx_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">fw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">isp</span><span class="p">.</span><span class="n">isp24</span><span class="p">;</span>
	<span class="n">qla2xxx_prep_dump</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>

	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_status</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">host_status</span><span class="p">));</span>

	<span class="cm">/* Pause RISC. */</span>
	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_pause_risc</span><span class="p">(</span><span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">qla24xx_fw_dump_failed_0</span><span class="p">;</span>

	<span class="cm">/* Host interface registers. */</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">flash_addr</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Disable interrupts. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ictrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ictrl</span><span class="p">);</span>

	<span class="cm">/* Shadow registers. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x0F70</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">);</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0000000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0100000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0200000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0300000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0400000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0500000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0600000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="cm">/* Mailbox registers. */</span>
	<span class="n">mbx_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">mailbox_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="n">fw</span><span class="o">-&gt;</span><span class="n">mailbox_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">mbx_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Transfer sequence registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_0_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_1_reg</span><span class="p">);</span>

	<span class="cm">/* Receive sequence registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFD0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_0_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_1_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_2_reg</span><span class="p">);</span>

	<span class="cm">/* Command DMA registers. */</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7100</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">cmd_dma_reg</span><span class="p">);</span>

	<span class="cm">/* Queues. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">req0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7200</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">resp0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7300</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">req1_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7400</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Transmit DMA registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7600</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7610</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt1_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7620</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7630</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt2_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7640</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7650</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt3_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7660</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7670</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt4_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7680</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7690</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x76A0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt_data_dma_reg</span><span class="p">);</span>

	<span class="cm">/* Receive DMA registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rcvt0_data_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7700</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7710</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rcvt1_data_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7720</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7730</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* RISC registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Local memory controller registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">lmc_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3050</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Fibre Protocol Module registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fpm_hdw_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4050</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4070</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4080</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4090</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40A0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40B0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Frame Buffer registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fb_hdw_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6100</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6130</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6150</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6170</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6190</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x61B0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_soft_reset</span><span class="p">(</span><span class="n">ha</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">qla24xx_fw_dump_failed_0</span><span class="p">;</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_dump_memory</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">code_ram</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">code_ram</span><span class="p">),</span>
	    <span class="o">&amp;</span><span class="n">nxt</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">qla24xx_fw_dump_failed_0</span><span class="p">;</span>

	<span class="n">nxt</span> <span class="o">=</span> <span class="n">qla2xxx_copy_queues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt</span><span class="p">);</span>

	<span class="n">qla24xx_copy_eft</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt</span><span class="p">);</span>

	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span> <span class="o">+</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">chain_offset</span><span class="p">;</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla2xxx_copy_atioqueues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt_chain</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">last_chain</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">|=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_VARIANT</span><span class="p">);</span>
		<span class="o">*</span><span class="n">last_chain</span> <span class="o">|=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_LAST</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Adjust valid length. */</span>
	<span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump_len</span> <span class="o">=</span> <span class="p">(</span><span class="n">nxt_chain</span> <span class="o">-</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>

<span class="nl">qla24xx_fw_dump_failed_0:</span>
	<span class="n">qla2xxx_dump_post_process</span><span class="p">(</span><span class="n">base_vha</span><span class="p">,</span> <span class="n">rval</span><span class="p">);</span>

<span class="nl">qla24xx_fw_dump_failed:</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">qla25xx_fw_dump</span><span class="p">(</span><span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hardware_locked</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span>		<span class="n">rval</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">cnt</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">risc_address</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span> <span class="o">=</span> <span class="n">vha</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_24xx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp24</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dmp_reg</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="o">*</span><span class="n">iter_reg</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mbx_reg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla25xx_fw_dump</span> <span class="o">*</span><span class="n">fw</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">ext_mem_cnt</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">nxt</span><span class="p">,</span> <span class="o">*</span><span class="n">nxt_chain</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="o">*</span><span class="n">last_chain</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="n">base_vha</span> <span class="o">=</span> <span class="n">pci_get_drvdata</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">);</span>

	<span class="n">risc_address</span> <span class="o">=</span> <span class="n">ext_mem_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd008</span><span class="p">,</span>
		    <span class="s">&quot;No buffer available for dump.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla25xx_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dumped</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd009</span><span class="p">,</span>
		    <span class="s">&quot;Firmware has been previously dumped (%p) &quot;</span>
		    <span class="s">&quot;-- ignoring request.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla25xx_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">fw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">isp</span><span class="p">.</span><span class="n">isp25</span><span class="p">;</span>
	<span class="n">qla2xxx_prep_dump</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>
	<span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_status</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">host_status</span><span class="p">));</span>

	<span class="cm">/* Pause RISC. */</span>
	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_pause_risc</span><span class="p">(</span><span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">qla25xx_fw_dump_failed_0</span><span class="p">;</span>

	<span class="cm">/* Host/Risc registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_risc_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* PCIe registers. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x7C00</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">);</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_c4</span><span class="p">;</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="p">));</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">);</span>

	<span class="cm">/* Host interface registers. */</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">flash_addr</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Disable interrupts. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ictrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ictrl</span><span class="p">);</span>

	<span class="cm">/* Shadow registers. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x0F70</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">);</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0000000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0100000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0200000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0300000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0400000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0500000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0600000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0700000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0800000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0900000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0A00000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="cm">/* RISC I/O register. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x0010</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_io_reg</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">));</span>

	<span class="cm">/* Mailbox registers. */</span>
	<span class="n">mbx_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">mailbox_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="n">fw</span><span class="o">-&gt;</span><span class="n">mailbox_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">mbx_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Transfer sequence registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_0_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFC0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFD0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_1_reg</span><span class="p">);</span>

	<span class="cm">/* Receive sequence registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_0_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFC0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFD0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_1_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_2_reg</span><span class="p">);</span>

	<span class="cm">/* Auxiliary sequence registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB050</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB070</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_0_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0C0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0D0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0E0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_1_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0F0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_2_reg</span><span class="p">);</span>

	<span class="cm">/* Command DMA registers. */</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7100</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">cmd_dma_reg</span><span class="p">);</span>

	<span class="cm">/* Queues. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">req0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7200</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">resp0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7300</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">req1_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7400</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Transmit DMA registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7600</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7610</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt1_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7620</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7630</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt2_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7640</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7650</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt3_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7660</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7670</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt4_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7680</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7690</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x76A0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt_data_dma_reg</span><span class="p">);</span>

	<span class="cm">/* Receive DMA registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rcvt0_data_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7700</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7710</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rcvt1_data_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7720</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7730</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* RISC registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Local memory controller registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">lmc_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3050</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3070</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Fibre Protocol Module registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fpm_hdw_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4050</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4070</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4080</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4090</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40A0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40B0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Frame Buffer registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fb_hdw_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6100</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6130</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6150</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6170</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6190</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x61B0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6F00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Multi queue registers */</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla25xx_copy_mq</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span> <span class="o">+</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">chain_offset</span><span class="p">,</span>
	    <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_soft_reset</span><span class="p">(</span><span class="n">ha</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">qla25xx_fw_dump_failed_0</span><span class="p">;</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_dump_memory</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">code_ram</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">code_ram</span><span class="p">),</span>
	    <span class="o">&amp;</span><span class="n">nxt</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">qla25xx_fw_dump_failed_0</span><span class="p">;</span>

	<span class="n">nxt</span> <span class="o">=</span> <span class="n">qla2xxx_copy_queues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt</span><span class="p">);</span>

	<span class="n">nxt</span> <span class="o">=</span> <span class="n">qla24xx_copy_eft</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt</span><span class="p">);</span>

	<span class="cm">/* Chain entries -- started with MQ. */</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla25xx_copy_fce</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt_chain</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla25xx_copy_mqueues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt_chain</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla2xxx_copy_atioqueues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt_chain</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">last_chain</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">|=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_VARIANT</span><span class="p">);</span>
		<span class="o">*</span><span class="n">last_chain</span> <span class="o">|=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_LAST</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Adjust valid length. */</span>
	<span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump_len</span> <span class="o">=</span> <span class="p">(</span><span class="n">nxt_chain</span> <span class="o">-</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>

<span class="nl">qla25xx_fw_dump_failed_0:</span>
	<span class="n">qla2xxx_dump_post_process</span><span class="p">(</span><span class="n">base_vha</span><span class="p">,</span> <span class="n">rval</span><span class="p">);</span>

<span class="nl">qla25xx_fw_dump_failed:</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">qla81xx_fw_dump</span><span class="p">(</span><span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hardware_locked</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span>		<span class="n">rval</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">cnt</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">risc_address</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span> <span class="o">=</span> <span class="n">vha</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_24xx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp24</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dmp_reg</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="o">*</span><span class="n">iter_reg</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mbx_reg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla81xx_fw_dump</span> <span class="o">*</span><span class="n">fw</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">ext_mem_cnt</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">nxt</span><span class="p">,</span> <span class="o">*</span><span class="n">nxt_chain</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="o">*</span><span class="n">last_chain</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="n">base_vha</span> <span class="o">=</span> <span class="n">pci_get_drvdata</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">);</span>

	<span class="n">risc_address</span> <span class="o">=</span> <span class="n">ext_mem_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd00a</span><span class="p">,</span>
		    <span class="s">&quot;No buffer available for dump.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla81xx_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dumped</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd00b</span><span class="p">,</span>
		    <span class="s">&quot;Firmware has been previously dumped (%p) &quot;</span>
		    <span class="s">&quot;-- ignoring request.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla81xx_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">fw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">isp</span><span class="p">.</span><span class="n">isp81</span><span class="p">;</span>
	<span class="n">qla2xxx_prep_dump</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>

	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_status</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">host_status</span><span class="p">));</span>

	<span class="cm">/* Pause RISC. */</span>
	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_pause_risc</span><span class="p">(</span><span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">qla81xx_fw_dump_failed_0</span><span class="p">;</span>

	<span class="cm">/* Host/Risc registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_risc_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* PCIe registers. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x7C00</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">);</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_c4</span><span class="p">;</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="p">));</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">);</span>

	<span class="cm">/* Host interface registers. */</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">flash_addr</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Disable interrupts. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ictrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ictrl</span><span class="p">);</span>

	<span class="cm">/* Shadow registers. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x0F70</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">);</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0000000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0100000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0200000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0300000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0400000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0500000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0600000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0700000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0800000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0900000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0A00000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="cm">/* RISC I/O register. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x0010</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_io_reg</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">));</span>

	<span class="cm">/* Mailbox registers. */</span>
	<span class="n">mbx_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">mailbox_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="n">fw</span><span class="o">-&gt;</span><span class="n">mailbox_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">mbx_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Transfer sequence registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_0_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFC0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFD0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_1_reg</span><span class="p">);</span>

	<span class="cm">/* Receive sequence registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_0_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFC0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFD0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_1_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_2_reg</span><span class="p">);</span>

	<span class="cm">/* Auxiliary sequence registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB050</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB070</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_0_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0C0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0D0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0E0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_1_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0F0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_2_reg</span><span class="p">);</span>

	<span class="cm">/* Command DMA registers. */</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7100</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">cmd_dma_reg</span><span class="p">);</span>

	<span class="cm">/* Queues. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">req0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7200</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">resp0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7300</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">req1_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7400</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Transmit DMA registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7600</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7610</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt1_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7620</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7630</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt2_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7640</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7650</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt3_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7660</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7670</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt4_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7680</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7690</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x76A0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt_data_dma_reg</span><span class="p">);</span>

	<span class="cm">/* Receive DMA registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rcvt0_data_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7700</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7710</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rcvt1_data_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7720</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7730</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* RISC registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Local memory controller registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">lmc_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3050</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3070</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Fibre Protocol Module registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fpm_hdw_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4050</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4070</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4080</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4090</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40A0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40B0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40C0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40D0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Frame Buffer registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fb_hdw_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6100</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6130</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6150</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6170</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6190</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x61B0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x61C0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6F00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Multi queue registers */</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla25xx_copy_mq</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span> <span class="o">+</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">chain_offset</span><span class="p">,</span>
	    <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_soft_reset</span><span class="p">(</span><span class="n">ha</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">qla81xx_fw_dump_failed_0</span><span class="p">;</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_dump_memory</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">code_ram</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">code_ram</span><span class="p">),</span>
	    <span class="o">&amp;</span><span class="n">nxt</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">qla81xx_fw_dump_failed_0</span><span class="p">;</span>

	<span class="n">nxt</span> <span class="o">=</span> <span class="n">qla2xxx_copy_queues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt</span><span class="p">);</span>

	<span class="n">nxt</span> <span class="o">=</span> <span class="n">qla24xx_copy_eft</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt</span><span class="p">);</span>

	<span class="cm">/* Chain entries -- started with MQ. */</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla25xx_copy_fce</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt_chain</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla25xx_copy_mqueues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt_chain</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla2xxx_copy_atioqueues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt_chain</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">last_chain</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">|=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_VARIANT</span><span class="p">);</span>
		<span class="o">*</span><span class="n">last_chain</span> <span class="o">|=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_LAST</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Adjust valid length. */</span>
	<span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump_len</span> <span class="o">=</span> <span class="p">(</span><span class="n">nxt_chain</span> <span class="o">-</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>

<span class="nl">qla81xx_fw_dump_failed_0:</span>
	<span class="n">qla2xxx_dump_post_process</span><span class="p">(</span><span class="n">base_vha</span><span class="p">,</span> <span class="n">rval</span><span class="p">);</span>

<span class="nl">qla81xx_fw_dump_failed:</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">qla83xx_fw_dump</span><span class="p">(</span><span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hardware_locked</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span>		<span class="n">rval</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">cnt</span><span class="p">,</span> <span class="n">reg_data</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">risc_address</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span> <span class="o">=</span> <span class="n">vha</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_24xx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp24</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dmp_reg</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="o">*</span><span class="n">iter_reg</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mbx_reg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla83xx_fw_dump</span> <span class="o">*</span><span class="n">fw</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">ext_mem_cnt</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">nxt</span><span class="p">,</span> <span class="o">*</span><span class="n">nxt_chain</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="o">*</span><span class="n">last_chain</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_qla_host</span> <span class="o">*</span><span class="n">base_vha</span> <span class="o">=</span> <span class="n">pci_get_drvdata</span><span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">);</span>

	<span class="n">risc_address</span> <span class="o">=</span> <span class="n">ext_mem_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd00c</span><span class="p">,</span>
		    <span class="s">&quot;No buffer available for dump!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla83xx_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dumped</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd00d</span><span class="p">,</span>
		    <span class="s">&quot;Firmware has been previously dumped (%p) -- ignoring &quot;</span>
		    <span class="s">&quot;request...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">qla83xx_fw_dump_failed</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">fw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">isp</span><span class="p">.</span><span class="n">isp83</span><span class="p">;</span>
	<span class="n">qla2xxx_prep_dump</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>

	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_status</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">host_status</span><span class="p">));</span>

	<span class="cm">/* Pause RISC. */</span>
	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_pause_risc</span><span class="p">(</span><span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">qla83xx_fw_dump_failed_0</span><span class="p">;</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x6000</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">;</span>
	<span class="n">reg_data</span> <span class="o">=</span> <span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="p">);</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">unused_4_1</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">reg_data</span> <span class="o">=</span> <span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="p">);</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x6010</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">unused_4_1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">reg_data</span> <span class="o">=</span> <span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="p">);</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* select PCR and disable ecc checking and correction */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x0F70</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">);</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0x60000000</span><span class="p">);</span>	<span class="cm">/* write to F0h = PCR */</span>

	<span class="cm">/* Host/Risc registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_risc_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* PCIe registers. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x7C00</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">);</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_c4</span><span class="p">;</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="p">));</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">pcie_regs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">);</span>

	<span class="cm">/* Host interface registers. */</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">flash_addr</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="n">fw</span><span class="o">-&gt;</span><span class="n">host_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Disable interrupts. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ictrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">ictrl</span><span class="p">);</span>

	<span class="cm">/* Shadow registers. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x0F70</span><span class="p">);</span>
	<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">);</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0000000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0100000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0200000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0300000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0400000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0500000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0600000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0700000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0800000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0900000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_select</span><span class="p">,</span> <span class="mh">0xB0A00000</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">shadow_reg</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_sdata</span><span class="p">));</span>

	<span class="cm">/* RISC I/O register. */</span>
	<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_addr</span><span class="p">,</span> <span class="mh">0x0010</span><span class="p">);</span>
	<span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_io_reg</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_window</span><span class="p">));</span>

	<span class="cm">/* Mailbox registers. */</span>
	<span class="n">mbx_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">mailbox_reg</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="n">fw</span><span class="o">-&gt;</span><span class="n">mailbox_reg</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">mbx_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Transfer sequence registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBE00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBE10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBE20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBE30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBE40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBE50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBE60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBE70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBF70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_0_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFC0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFD0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBFF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_1_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xBEF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xseq_2_reg</span><span class="p">);</span>

	<span class="cm">/* Receive sequence registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFE00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFE10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFE20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFE30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFE40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFE50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFE60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFE70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFF70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_0_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFC0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFD0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_1_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFFF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_2_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xFEF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rseq_3_reg</span><span class="p">);</span>

	<span class="cm">/* Auxiliary sequence registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB050</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB070</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB100</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB110</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB120</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB130</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB140</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB150</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB160</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB170</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_0_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0C0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0D0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0E0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_1_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB0F0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_2_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0xB1F0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">aseq_3_reg</span><span class="p">);</span>

	<span class="cm">/* Command DMA registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">cmd_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7100</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7120</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7130</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x71F0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Queues. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">req0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7200</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">resp0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7300</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">req1_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7400</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">dmp_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">iobase_q</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span>
		<span class="o">*</span><span class="n">iter_reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="n">dmp_reg</span><span class="o">++</span><span class="p">));</span>

	<span class="cm">/* Transmit DMA registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt0_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7600</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7610</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt1_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7620</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7630</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt2_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7640</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7650</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt3_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7660</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7670</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt4_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7680</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7690</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x76A0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">xmt_data_dma_reg</span><span class="p">);</span>

	<span class="cm">/* Receive DMA registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rcvt0_data_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7700</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7710</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rcvt1_data_dma_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7720</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7730</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* RISC registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">risc_gp_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x0F70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Local memory controller registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">lmc_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3050</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x3070</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Fibre Protocol Module registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fpm_hdw_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4050</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4070</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4080</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x4090</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40A0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40B0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40C0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40D0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40E0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x40F0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* RQ0 Array registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rq0_array_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5C00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5C10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5C20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5C30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5C40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5C50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5C60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5C70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5C80</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5C90</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5CA0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5CB0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5CC0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5CD0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5CE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5CF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* RQ1 Array registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rq1_array_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5D00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5D10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5D20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5D30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5D40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5D50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5D60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5D70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5D80</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5D90</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5DA0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5DB0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5DC0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5DD0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5DE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5DF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* RP0 Array registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rp0_array_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5E00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5E10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5E20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5E30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5E40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5E50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5E60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5E70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5E80</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5E90</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5EA0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5EB0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5EC0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5ED0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5EE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5EF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* RP1 Array registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">rp1_array_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5F00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5F10</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5F20</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5F30</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5F40</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5F50</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5F60</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5F70</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5F80</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5F90</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5FA0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5FB0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5FC0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5FD0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5FE0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x5FF0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">at0_array_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7080</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7090</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x70A0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x70B0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x70C0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x70D0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x70E0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x70F0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* I/O Queue Control registers. */</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x7800</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">queue_control_reg</span><span class="p">);</span>

	<span class="cm">/* Frame Buffer registers. */</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">fb_hdw_reg</span><span class="p">;</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6000</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6010</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6020</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6030</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6040</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6060</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6070</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6100</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6130</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6150</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6170</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6190</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x61B0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x61C0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6530</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6540</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6550</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6560</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6570</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6580</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6590</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x65A0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x65B0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x65C0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x65D0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">iter_reg</span> <span class="o">=</span> <span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x65E0</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>
	<span class="n">qla24xx_read_window</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="mh">0x6F00</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">iter_reg</span><span class="p">);</span>

	<span class="cm">/* Multi queue registers */</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla25xx_copy_mq</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span> <span class="o">+</span> <span class="n">ha</span><span class="o">-&gt;</span><span class="n">chain_offset</span><span class="p">,</span>
	    <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_soft_reset</span><span class="p">(</span><span class="n">ha</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd00e</span><span class="p">,</span>
		    <span class="s">&quot;SOFT RESET FAILED, forcing continuation of dump!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">rval</span> <span class="o">=</span> <span class="n">QLA_SUCCESS</span><span class="p">;</span>

		<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd00f</span><span class="p">,</span> <span class="s">&quot;try a bigger hammer!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

		<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCRX_SET_RISC_RESET</span><span class="p">);</span>
		<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>

		<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCRX_REL_RISC_PAUSE</span><span class="p">);</span>
		<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>

		<span class="n">WRT_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">,</span> <span class="n">HCCRX_CLR_RISC_RESET</span><span class="p">);</span>
		<span class="n">RD_REG_DWORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">hccr</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">RD_REG_WORD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">mailbox0</span><span class="p">));</span> <span class="n">cnt</span><span class="o">--</span><span class="p">)</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cnt</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">nxt</span> <span class="o">=</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">code_ram</span><span class="p">;</span>
			<span class="n">nxt</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">code_ram</span><span class="p">),</span>
			<span class="n">nxt</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_memory_size</span> <span class="o">-</span> <span class="mh">0x100000</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">copy_queue</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">ql_log</span><span class="p">(</span><span class="n">ql_log_warn</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="mh">0xd010</span><span class="p">,</span>
			    <span class="s">&quot;bigger hammer success?</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">rval</span> <span class="o">=</span> <span class="n">qla24xx_dump_memory</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">code_ram</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">code_ram</span><span class="p">),</span>
	    <span class="o">&amp;</span><span class="n">nxt</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rval</span> <span class="o">!=</span> <span class="n">QLA_SUCCESS</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">qla83xx_fw_dump_failed_0</span><span class="p">;</span>

<span class="nl">copy_queue:</span>
	<span class="n">nxt</span> <span class="o">=</span> <span class="n">qla2xxx_copy_queues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt</span><span class="p">);</span>

	<span class="n">nxt</span> <span class="o">=</span> <span class="n">qla24xx_copy_eft</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt</span><span class="p">);</span>

	<span class="cm">/* Chain entries -- started with MQ. */</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla25xx_copy_fce</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt_chain</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla25xx_copy_mqueues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt_chain</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>
	<span class="n">nxt_chain</span> <span class="o">=</span> <span class="n">qla2xxx_copy_atioqueues</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">nxt_chain</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">last_chain</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">last_chain</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">|=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_VARIANT</span><span class="p">);</span>
		<span class="o">*</span><span class="n">last_chain</span> <span class="o">|=</span> <span class="n">__constant_htonl</span><span class="p">(</span><span class="n">DUMP_CHAIN_LAST</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Adjust valid length. */</span>
	<span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump_len</span> <span class="o">=</span> <span class="p">(</span><span class="n">nxt_chain</span> <span class="o">-</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">fw_dump</span><span class="p">);</span>

<span class="nl">qla83xx_fw_dump_failed_0:</span>
	<span class="n">qla2xxx_dump_post_process</span><span class="p">(</span><span class="n">base_vha</span><span class="p">,</span> <span class="n">rval</span><span class="p">);</span>

<span class="nl">qla83xx_fw_dump_failed:</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hardware_locked</span><span class="p">)</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">hardware_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/*                         Driver Debug Functions.                          */</span>
<span class="cm">/****************************************************************************/</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span>
<span class="nf">ql_mask_match</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">level</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ql2xextended_error_logging</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">ql2xextended_error_logging</span> <span class="o">=</span> <span class="n">QL_DBG_DEFAULT1_MASK</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">level</span> <span class="o">&amp;</span> <span class="n">ql2xextended_error_logging</span><span class="p">)</span> <span class="o">==</span> <span class="n">level</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function is for formatting and logging debug information.</span>
<span class="cm"> * It is to be used when vha is available. It formats the message</span>
<span class="cm"> * and logs it to the messages file.</span>
<span class="cm"> * parameters:</span>
<span class="cm"> * level: The level of the debug messages to be printed.</span>
<span class="cm"> *        If ql2xextended_error_logging value is correctly set,</span>
<span class="cm"> *        this message will appear in the messages file.</span>
<span class="cm"> * vha:   Pointer to the scsi_qla_host_t.</span>
<span class="cm"> * id:    This is a unique identifier for the level. It identifies the</span>
<span class="cm"> *        part of the code from where the message originated.</span>
<span class="cm"> * msg:   The message to be displayed.</span>
<span class="cm"> */</span>
<span class="kt">void</span>
<span class="nf">ql_dbg</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">level</span><span class="p">,</span> <span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
	<span class="kt">va_list</span> <span class="n">va</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">va_format</span> <span class="n">vaf</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ql_mask_match</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">va_start</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>

	<span class="n">vaf</span><span class="p">.</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">;</span>
	<span class="n">vaf</span><span class="p">.</span><span class="n">va</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">va</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">vha</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span> <span class="o">=</span> <span class="n">vha</span><span class="o">-&gt;</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">;</span>
		<span class="cm">/* &lt;module-name&gt; &lt;pci-name&gt; &lt;msg-id&gt;:&lt;host&gt; Message */</span>
		<span class="n">pr_warn</span><span class="p">(</span><span class="s">&quot;%s [%s]-%04x:%ld: %pV&quot;</span><span class="p">,</span>
			<span class="n">QL_MSGHDR</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">)),</span> <span class="n">id</span> <span class="o">+</span> <span class="n">ql_dbg_offset</span><span class="p">,</span>
			<span class="n">vha</span><span class="o">-&gt;</span><span class="n">host_no</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pr_warn</span><span class="p">(</span><span class="s">&quot;%s [%s]-%04x: : %pV&quot;</span><span class="p">,</span>
			<span class="n">QL_MSGHDR</span><span class="p">,</span> <span class="s">&quot;0000:00:00.0&quot;</span><span class="p">,</span> <span class="n">id</span> <span class="o">+</span> <span class="n">ql_dbg_offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">va_end</span><span class="p">(</span><span class="n">va</span><span class="p">);</span>

<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function is for formatting and logging debug information.</span>
<span class="cm"> * It is to be used when vha is not available and pci is availble,</span>
<span class="cm"> * i.e., before host allocation. It formats the message and logs it</span>
<span class="cm"> * to the messages file.</span>
<span class="cm"> * parameters:</span>
<span class="cm"> * level: The level of the debug messages to be printed.</span>
<span class="cm"> *        If ql2xextended_error_logging value is correctly set,</span>
<span class="cm"> *        this message will appear in the messages file.</span>
<span class="cm"> * pdev:  Pointer to the struct pci_dev.</span>
<span class="cm"> * id:    This is a unique id for the level. It identifies the part</span>
<span class="cm"> *        of the code from where the message originated.</span>
<span class="cm"> * msg:   The message to be displayed.</span>
<span class="cm"> */</span>
<span class="kt">void</span>
<span class="nf">ql_dbg_pci</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">level</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">id</span><span class="p">,</span>
	   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
	<span class="kt">va_list</span> <span class="n">va</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">va_format</span> <span class="n">vaf</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pdev</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ql_mask_match</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">va_start</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>

	<span class="n">vaf</span><span class="p">.</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">;</span>
	<span class="n">vaf</span><span class="p">.</span><span class="n">va</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">va</span><span class="p">;</span>

	<span class="cm">/* &lt;module-name&gt; &lt;dev-name&gt;:&lt;msg-id&gt; Message */</span>
	<span class="n">pr_warn</span><span class="p">(</span><span class="s">&quot;%s [%s]-%04x: : %pV&quot;</span><span class="p">,</span>
		<span class="n">QL_MSGHDR</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">)),</span> <span class="n">id</span> <span class="o">+</span> <span class="n">ql_dbg_offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>

	<span class="n">va_end</span><span class="p">(</span><span class="n">va</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function is for formatting and logging log messages.</span>
<span class="cm"> * It is to be used when vha is available. It formats the message</span>
<span class="cm"> * and logs it to the messages file. All the messages will be logged</span>
<span class="cm"> * irrespective of value of ql2xextended_error_logging.</span>
<span class="cm"> * parameters:</span>
<span class="cm"> * level: The level of the log messages to be printed in the</span>
<span class="cm"> *        messages file.</span>
<span class="cm"> * vha:   Pointer to the scsi_qla_host_t</span>
<span class="cm"> * id:    This is a unique id for the level. It identifies the</span>
<span class="cm"> *        part of the code from where the message originated.</span>
<span class="cm"> * msg:   The message to be displayed.</span>
<span class="cm"> */</span>
<span class="kt">void</span>
<span class="nf">ql_log</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">level</span><span class="p">,</span> <span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
	<span class="kt">va_list</span> <span class="n">va</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">va_format</span> <span class="n">vaf</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">pbuf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">level</span> <span class="o">&gt;</span> <span class="n">ql_errlev</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">vha</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span> <span class="o">=</span> <span class="n">vha</span><span class="o">-&gt;</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">;</span>
		<span class="cm">/* &lt;module-name&gt; &lt;msg-id&gt;:&lt;host&gt; Message */</span>
		<span class="n">snprintf</span><span class="p">(</span><span class="n">pbuf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pbuf</span><span class="p">),</span> <span class="s">&quot;%s [%s]-%04x:%ld: &quot;</span><span class="p">,</span>
			<span class="n">QL_MSGHDR</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">)),</span> <span class="n">id</span><span class="p">,</span> <span class="n">vha</span><span class="o">-&gt;</span><span class="n">host_no</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">snprintf</span><span class="p">(</span><span class="n">pbuf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pbuf</span><span class="p">),</span> <span class="s">&quot;%s [%s]-%04x: : &quot;</span><span class="p">,</span>
			<span class="n">QL_MSGHDR</span><span class="p">,</span> <span class="s">&quot;0000:00:00.0&quot;</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">pbuf</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">pbuf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">va_start</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>

	<span class="n">vaf</span><span class="p">.</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">;</span>
	<span class="n">vaf</span><span class="p">.</span><span class="n">va</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">va</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">ql_log_fatal</span>: <span class="cm">/* FATAL LOG */</span>
		<span class="n">pr_crit</span><span class="p">(</span><span class="s">&quot;%s%pV&quot;</span><span class="p">,</span> <span class="n">pbuf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ql_log_warn</span>:
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s%pV&quot;</span><span class="p">,</span> <span class="n">pbuf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ql_log_info</span>:
		<span class="n">pr_warn</span><span class="p">(</span><span class="s">&quot;%s%pV&quot;</span><span class="p">,</span> <span class="n">pbuf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">pr_info</span><span class="p">(</span><span class="s">&quot;%s%pV&quot;</span><span class="p">,</span> <span class="n">pbuf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">va_end</span><span class="p">(</span><span class="n">va</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function is for formatting and logging log messages.</span>
<span class="cm"> * It is to be used when vha is not available and pci is availble,</span>
<span class="cm"> * i.e., before host allocation. It formats the message and logs</span>
<span class="cm"> * it to the messages file. All the messages are logged irrespective</span>
<span class="cm"> * of the value of ql2xextended_error_logging.</span>
<span class="cm"> * parameters:</span>
<span class="cm"> * level: The level of the log messages to be printed in the</span>
<span class="cm"> *        messages file.</span>
<span class="cm"> * pdev:  Pointer to the struct pci_dev.</span>
<span class="cm"> * id:    This is a unique id for the level. It identifies the</span>
<span class="cm"> *        part of the code from where the message originated.</span>
<span class="cm"> * msg:   The message to be displayed.</span>
<span class="cm"> */</span>
<span class="kt">void</span>
<span class="nf">ql_log_pci</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">level</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">id</span><span class="p">,</span>
	   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
	<span class="kt">va_list</span> <span class="n">va</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">va_format</span> <span class="n">vaf</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">pbuf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pdev</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">level</span> <span class="o">&gt;</span> <span class="n">ql_errlev</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="cm">/* &lt;module-name&gt; &lt;dev-name&gt;:&lt;msg-id&gt; Message */</span>
	<span class="n">snprintf</span><span class="p">(</span><span class="n">pbuf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pbuf</span><span class="p">),</span> <span class="s">&quot;%s [%s]-%04x: : &quot;</span><span class="p">,</span>
		 <span class="n">QL_MSGHDR</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">)),</span> <span class="n">id</span><span class="p">);</span>
	<span class="n">pbuf</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">pbuf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">va_start</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>

	<span class="n">vaf</span><span class="p">.</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">;</span>
	<span class="n">vaf</span><span class="p">.</span><span class="n">va</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">va</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">ql_log_fatal</span>: <span class="cm">/* FATAL LOG */</span>
		<span class="n">pr_crit</span><span class="p">(</span><span class="s">&quot;%s%pV&quot;</span><span class="p">,</span> <span class="n">pbuf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ql_log_warn</span>:
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;%s%pV&quot;</span><span class="p">,</span> <span class="n">pbuf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ql_log_info</span>:
		<span class="n">pr_warn</span><span class="p">(</span><span class="s">&quot;%s%pV&quot;</span><span class="p">,</span> <span class="n">pbuf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">pr_info</span><span class="p">(</span><span class="s">&quot;%s%pV&quot;</span><span class="p">,</span> <span class="n">pbuf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vaf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">va_end</span><span class="p">(</span><span class="n">va</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">ql_dump_regs</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">level</span><span class="p">,</span> <span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qla_hw_data</span> <span class="o">*</span><span class="n">ha</span> <span class="o">=</span> <span class="n">vha</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_2xxx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_24xx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg24</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp24</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device_reg_82xx</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg82</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ha</span><span class="o">-&gt;</span><span class="n">iobase</span><span class="o">-&gt;</span><span class="n">isp82</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mbx_reg</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ql_mask_match</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">IS_QLA82XX</span><span class="p">(</span><span class="n">ha</span><span class="p">))</span>
		<span class="n">mbx_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg82</span><span class="o">-&gt;</span><span class="n">mailbox_in</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">IS_FWI2_CAPABLE</span><span class="p">(</span><span class="n">ha</span><span class="p">))</span>
		<span class="n">mbx_reg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reg24</span><span class="o">-&gt;</span><span class="n">mailbox0</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">mbx_reg</span> <span class="o">=</span> <span class="n">MAILBOX_REG</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">ql_dbg</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="s">&quot;Mailbox registers:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">ql_dbg</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span>
		    <span class="s">&quot;mbox[%d] 0x%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">RD_REG_WORD</span><span class="p">(</span><span class="n">mbx_reg</span><span class="o">++</span><span class="p">));</span>
<span class="p">}</span>


<span class="kt">void</span>
<span class="nf">ql_dump_buffer</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">level</span><span class="p">,</span> <span class="n">scsi_qla_host_t</span> <span class="o">*</span><span class="n">vha</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">id</span><span class="p">,</span>
	<span class="kt">uint8_t</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">cnt</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">c</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ql_mask_match</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">ql_dbg</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="s">&quot; 0   1   2   3   4   5   6   7   8   &quot;</span>
	    <span class="s">&quot;9  Ah  Bh  Ch  Dh  Eh  Fh</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">ql_dbg</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="s">&quot;----------------------------------&quot;</span>
	    <span class="s">&quot;----------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">ql_dbg</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;)</span> <span class="p">{</span>
		<span class="n">c</span> <span class="o">=</span> <span class="o">*</span><span class="n">b</span><span class="o">++</span><span class="p">;</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%02x&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span> <span class="n">c</span><span class="p">);</span>
		<span class="n">cnt</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cnt</span> <span class="o">%</span> <span class="mi">16</span><span class="p">))</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">%</span> <span class="mi">16</span><span class="p">)</span>
		<span class="n">ql_dbg</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">vha</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
