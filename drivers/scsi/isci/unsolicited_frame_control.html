<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › isci › unsolicited_frame_control.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>unsolicited_frame_control.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is provided under a dual BSD/GPLv2 license.  When using or</span>
<span class="cm"> * redistributing this file, you may do so under either license.</span>
<span class="cm"> *</span>
<span class="cm"> * GPL LICENSE SUMMARY</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2008 - 2011 Intel Corporation. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of version 2 of the GNU General Public License as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> * General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA.</span>
<span class="cm"> * The full GNU General Public License is included in this distribution</span>
<span class="cm"> * in the file called LICENSE.GPL.</span>
<span class="cm"> *</span>
<span class="cm"> * BSD LICENSE</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2008 - 2011 Intel Corporation. All rights reserved.</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Redistribution and use in source and binary forms, with or without</span>
<span class="cm"> * modification, are permitted provided that the following conditions</span>
<span class="cm"> * are met:</span>
<span class="cm"> *</span>
<span class="cm"> *   * Redistributions of source code must retain the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer.</span>
<span class="cm"> *   * Redistributions in binary form must reproduce the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer in</span>
<span class="cm"> *     the documentation and/or other materials provided with the</span>
<span class="cm"> *     distribution.</span>
<span class="cm"> *   * Neither the name of Intel Corporation nor the names of its</span>
<span class="cm"> *     contributors may be used to endorse or promote products derived</span>
<span class="cm"> *     from this software without specific prior written permission.</span>
<span class="cm"> *</span>
<span class="cm"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="cm"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="cm"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span class="cm"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span class="cm"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="cm"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="cm"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="cm"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span class="cm"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="cm"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="cm"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _SCIC_SDS_UNSOLICITED_FRAME_CONTROL_H_</span>
<span class="cp">#define _SCIC_SDS_UNSOLICITED_FRAME_CONTROL_H_</span>

<span class="cp">#include &quot;isci.h&quot;</span>

<span class="cp">#define SCU_UNSOLICITED_FRAME_HEADER_DATA_DWORDS 15</span>

<span class="cm">/**</span>
<span class="cm"> * struct scu_unsolicited_frame_header -</span>
<span class="cm"> *</span>
<span class="cm"> * This structure delineates the format of an unsolicited frame header. The</span>
<span class="cm"> * first DWORD are UF attributes defined by the silicon architecture. The data</span>
<span class="cm"> * depicts actual header information received on the link.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">scu_unsolicited_frame_header</span> <span class="p">{</span>
	<span class="cm">/**</span>
<span class="cm">	 * This field indicates if there is an Initiator Index Table entry with</span>
<span class="cm">	 * which this header is associated.</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">iit_exists</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field simply indicates the protocol type (i.e. SSP, STP, SMP).</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">protocol_type</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field indicates if the frame is an address frame (IAF or OAF)</span>
<span class="cm">	 * or if it is a information unit frame.</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">is_address_frame</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field simply indicates the connection rate at which the frame</span>
<span class="cm">	 * was received.</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">connection_rate</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">reserved</span><span class="o">:</span><span class="mi">23</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field represents the actual header data received on the link.</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">data</span><span class="p">[</span><span class="n">SCU_UNSOLICITED_FRAME_HEADER_DATA_DWORDS</span><span class="p">];</span>

<span class="p">};</span>



<span class="cm">/**</span>
<span class="cm"> * enum unsolicited_frame_state -</span>
<span class="cm"> *</span>
<span class="cm"> * This enumeration represents the current unsolicited frame state.  The</span>
<span class="cm"> * controller object can not updtate the hardware unsolicited frame put pointer</span>
<span class="cm"> * unless it has already processed the priror unsolicited frames.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">unsolicited_frame_state</span> <span class="p">{</span>
	<span class="cm">/**</span>
<span class="cm">	 * This state is when the frame is empty and not in use.  It is</span>
<span class="cm">	 * different from the released state in that the hardware could DMA</span>
<span class="cm">	 * data to this frame buffer.</span>
<span class="cm">	 */</span>
	<span class="n">UNSOLICITED_FRAME_EMPTY</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This state is set when the frame buffer is in use by by some</span>
<span class="cm">	 * object in the system.</span>
<span class="cm">	 */</span>
	<span class="n">UNSOLICITED_FRAME_IN_USE</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This state is set when the frame is returned to the free pool</span>
<span class="cm">	 * but one or more frames prior to this one are still in use.</span>
<span class="cm">	 * Once all of the frame before this one are freed it will go to</span>
<span class="cm">	 * the empty state.</span>
<span class="cm">	 */</span>
	<span class="n">UNSOLICITED_FRAME_RELEASED</span><span class="p">,</span>

	<span class="n">UNSOLICITED_FRAME_MAX_STATES</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct sci_unsolicited_frame -</span>
<span class="cm"> *</span>
<span class="cm"> * This is the unsolicited frame data structure it acts as the container for</span>
<span class="cm"> * the current frame state, frame header and frame buffer.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sci_unsolicited_frame</span> <span class="p">{</span>
	<span class="cm">/**</span>
<span class="cm">	 * This field contains the current frame state</span>
<span class="cm">	 */</span>
	<span class="k">enum</span> <span class="n">unsolicited_frame_state</span> <span class="n">state</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field points to the frame header data.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">scu_unsolicited_frame_header</span> <span class="o">*</span><span class="n">header</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field points to the frame buffer data.</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>

<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct sci_uf_header_array -</span>
<span class="cm"> *</span>
<span class="cm"> * This structure contains all of the unsolicited frame header information.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sci_uf_header_array</span> <span class="p">{</span>
	<span class="cm">/**</span>
<span class="cm">	 * This field is represents a virtual pointer to the start</span>
<span class="cm">	 * address of the UF address table.  The table contains</span>
<span class="cm">	 * 64-bit pointers as required by the hardware.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">scu_unsolicited_frame_header</span> <span class="o">*</span><span class="n">array</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field specifies the physical address location for the UF</span>
<span class="cm">	 * buffer array.</span>
<span class="cm">	 */</span>
	<span class="n">dma_addr_t</span> <span class="n">physical_address</span><span class="p">;</span>

<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct sci_uf_buffer_array -</span>
<span class="cm"> *</span>
<span class="cm"> * This structure contains all of the unsolicited frame buffer (actual payload)</span>
<span class="cm"> * information.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sci_uf_buffer_array</span> <span class="p">{</span>
	<span class="cm">/**</span>
<span class="cm">	 * This field is the unsolicited frame data its used to manage</span>
<span class="cm">	 * the data for the unsolicited frame requests.  It also represents</span>
<span class="cm">	 * the virtual address location that corresponds to the</span>
<span class="cm">	 * physical_address field.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">sci_unsolicited_frame</span> <span class="n">array</span><span class="p">[</span><span class="n">SCU_MAX_UNSOLICITED_FRAMES</span><span class="p">];</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field specifies the physical address location for the UF</span>
<span class="cm">	 * buffer array.</span>
<span class="cm">	 */</span>
	<span class="n">dma_addr_t</span> <span class="n">physical_address</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct sci_uf_address_table_array -</span>
<span class="cm"> *</span>
<span class="cm"> * This object maintains all of the unsolicited frame address table specific</span>
<span class="cm"> * data.  The address table is a collection of 64-bit pointers that point to</span>
<span class="cm"> * 1KB buffers into which the silicon will DMA unsolicited frames.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sci_uf_address_table_array</span> <span class="p">{</span>
	<span class="cm">/**</span>
<span class="cm">	 * This field represents a virtual pointer that refers to the</span>
<span class="cm">	 * starting address of the UF address table.</span>
<span class="cm">	 * 64-bit pointers are required by the hardware.</span>
<span class="cm">	 */</span>
	<span class="n">u64</span> <span class="o">*</span><span class="n">array</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field specifies the physical address location for the UF</span>
<span class="cm">	 * address table.</span>
<span class="cm">	 */</span>
	<span class="n">dma_addr_t</span> <span class="n">physical_address</span><span class="p">;</span>

<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct sci_unsolicited_frame_control -</span>
<span class="cm"> *</span>
<span class="cm"> * This object contains all of the data necessary to handle unsolicited frames.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sci_unsolicited_frame_control</span> <span class="p">{</span>
	<span class="cm">/**</span>
<span class="cm">	 * This field is the software copy of the unsolicited frame queue</span>
<span class="cm">	 * get pointer.  The controller object writes this value to the</span>
<span class="cm">	 * hardware to let the hardware put more unsolicited frame entries.</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">get</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field contains all of the unsolicited frame header</span>
<span class="cm">	 * specific fields.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">sci_uf_header_array</span> <span class="n">headers</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field contains all of the unsolicited frame buffer</span>
<span class="cm">	 * specific fields.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">sci_uf_buffer_array</span> <span class="n">buffers</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field contains all of the unsolicited frame address table</span>
<span class="cm">	 * specific fields.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">sci_uf_address_table_array</span> <span class="n">address_table</span><span class="p">;</span>

<span class="p">};</span>

<span class="cp">#define SCI_UFI_BUF_SIZE (SCU_MAX_UNSOLICITED_FRAMES * SCU_UNSOLICITED_FRAME_BUFFER_SIZE)</span>
<span class="cp">#define SCI_UFI_HDR_SIZE (SCU_MAX_UNSOLICITED_FRAMES * sizeof(struct scu_unsolicited_frame_header))</span>
<span class="cp">#define SCI_UFI_TOTAL_SIZE (SCI_UFI_BUF_SIZE + SCI_UFI_HDR_SIZE + SCU_MAX_UNSOLICITED_FRAMES * sizeof(u64))</span>

<span class="k">struct</span> <span class="n">isci_host</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">sci_unsolicited_frame_control_construct</span><span class="p">(</span><span class="k">struct</span> <span class="n">isci_host</span> <span class="o">*</span><span class="n">ihost</span><span class="p">);</span>

<span class="k">enum</span> <span class="n">sci_status</span> <span class="n">sci_unsolicited_frame_control_get_header</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">sci_unsolicited_frame_control</span> <span class="o">*</span><span class="n">uf_control</span><span class="p">,</span>
	<span class="n">u32</span> <span class="n">frame_index</span><span class="p">,</span>
	<span class="kt">void</span> <span class="o">**</span><span class="n">frame_header</span><span class="p">);</span>

<span class="k">enum</span> <span class="n">sci_status</span> <span class="n">sci_unsolicited_frame_control_get_buffer</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">sci_unsolicited_frame_control</span> <span class="o">*</span><span class="n">uf_control</span><span class="p">,</span>
	<span class="n">u32</span> <span class="n">frame_index</span><span class="p">,</span>
	<span class="kt">void</span> <span class="o">**</span><span class="n">frame_buffer</span><span class="p">);</span>

<span class="n">bool</span> <span class="n">sci_unsolicited_frame_control_release_frame</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">sci_unsolicited_frame_control</span> <span class="o">*</span><span class="n">uf_control</span><span class="p">,</span>
	<span class="n">u32</span> <span class="n">frame_index</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* _SCIC_SDS_UNSOLICITED_FRAME_CONTROL_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
