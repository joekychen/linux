<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › isci › isci.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>isci.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is provided under a dual BSD/GPLv2 license.  When using or</span>
<span class="cm"> * redistributing this file, you may do so under either license.</span>
<span class="cm"> *</span>
<span class="cm"> * GPL LICENSE SUMMARY</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2008 - 2011 Intel Corporation. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of version 2 of the GNU General Public License as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> * General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA.</span>
<span class="cm"> * The full GNU General Public License is included in this distribution</span>
<span class="cm"> * in the file called LICENSE.GPL.</span>
<span class="cm"> *</span>
<span class="cm"> * BSD LICENSE</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2008 - 2011 Intel Corporation. All rights reserved.</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Redistribution and use in source and binary forms, with or without</span>
<span class="cm"> * modification, are permitted provided that the following conditions</span>
<span class="cm"> * are met:</span>
<span class="cm"> *</span>
<span class="cm"> *   * Redistributions of source code must retain the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer.</span>
<span class="cm"> *   * Redistributions in binary form must reproduce the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer in</span>
<span class="cm"> *     the documentation and/or other materials provided with the</span>
<span class="cm"> *     distribution.</span>
<span class="cm"> *   * Neither the name of Intel Corporation nor the names of its</span>
<span class="cm"> *     contributors may be used to endorse or promote products derived</span>
<span class="cm"> *     from this software without specific prior written permission.</span>
<span class="cm"> *</span>
<span class="cm"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="cm"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="cm"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span class="cm"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span class="cm"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="cm"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="cm"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="cm"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span class="cm"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="cm"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="cm"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ISCI_H__</span>
<span class="cp">#define __ISCI_H__</span>

<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#define DRV_NAME &quot;isci&quot;</span>
<span class="cp">#define SCI_PCI_BAR_COUNT 2</span>
<span class="cp">#define SCI_NUM_MSI_X_INT 2</span>
<span class="cp">#define SCI_SMU_BAR       0</span>
<span class="cp">#define SCI_SMU_BAR_SIZE  (16*1024)</span>
<span class="cp">#define SCI_SCU_BAR       1</span>
<span class="cp">#define SCI_SCU_BAR_SIZE  (4*1024*1024)</span>
<span class="cp">#define SCI_IO_SPACE_BAR0 2</span>
<span class="cp">#define SCI_IO_SPACE_BAR1 3</span>
<span class="cp">#define ISCI_CAN_QUEUE_VAL 250 </span><span class="cm">/* &lt; SCI_MAX_IO_REQUESTS ? */</span><span class="cp"></span>
<span class="cp">#define SCIC_CONTROLLER_STOP_TIMEOUT 5000</span>

<span class="cp">#define SCI_CONTROLLER_INVALID_IO_TAG 0xFFFF</span>

<span class="cp">#define SCI_MAX_PHYS  (4UL)</span>
<span class="cp">#define SCI_MAX_PORTS SCI_MAX_PHYS</span>
<span class="cp">#define SCI_MAX_SMP_PHYS  (384) </span><span class="cm">/* not silicon constrained */</span><span class="cp"></span>
<span class="cp">#define SCI_MAX_REMOTE_DEVICES (256UL)</span>
<span class="cp">#define SCI_MAX_IO_REQUESTS (256UL)</span>
<span class="cp">#define SCI_MAX_SEQ (16)</span>
<span class="cp">#define SCI_MAX_MSIX_MESSAGES  (2)</span>
<span class="cp">#define SCI_MAX_SCATTER_GATHER_ELEMENTS 130 </span><span class="cm">/* not silicon constrained */</span><span class="cp"></span>
<span class="cp">#define SCI_MAX_CONTROLLERS 2</span>
<span class="cp">#define SCI_MAX_DOMAINS  SCI_MAX_PORTS</span>

<span class="cp">#define SCU_MAX_CRITICAL_NOTIFICATIONS    (384)</span>
<span class="cp">#define SCU_MAX_EVENTS_SHIFT		  (7)</span>
<span class="cp">#define SCU_MAX_EVENTS                    (1 &lt;&lt; SCU_MAX_EVENTS_SHIFT)</span>
<span class="cp">#define SCU_MAX_UNSOLICITED_FRAMES        (128)</span>
<span class="cp">#define SCU_MAX_COMPLETION_QUEUE_SCRATCH  (128)</span>
<span class="cp">#define SCU_MAX_COMPLETION_QUEUE_ENTRIES  (SCU_MAX_CRITICAL_NOTIFICATIONS \</span>
<span class="cp">					   + SCU_MAX_EVENTS \</span>
<span class="cp">					   + SCU_MAX_UNSOLICITED_FRAMES	\</span>
<span class="cp">					   + SCI_MAX_IO_REQUESTS \</span>
<span class="cp">					   + SCU_MAX_COMPLETION_QUEUE_SCRATCH)</span>
<span class="cp">#define SCU_MAX_COMPLETION_QUEUE_SHIFT	  (ilog2(SCU_MAX_COMPLETION_QUEUE_ENTRIES))</span>

<span class="cp">#define SCU_ABSOLUTE_MAX_UNSOLICITED_FRAMES (4096)</span>
<span class="cp">#define SCU_UNSOLICITED_FRAME_BUFFER_SIZE   (1024U)</span>
<span class="cp">#define SCU_INVALID_FRAME_INDEX             (0xFFFF)</span>

<span class="cp">#define SCU_IO_REQUEST_MAX_SGE_SIZE         (0x00FFFFFF)</span>
<span class="cp">#define SCU_IO_REQUEST_MAX_TRANSFER_LENGTH  (0x00FFFFFF)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">check_sizes</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">BUILD_BUG_ON_NOT_POWER_OF_2</span><span class="p">(</span><span class="n">SCU_MAX_EVENTS</span><span class="p">);</span>
	<span class="n">BUILD_BUG_ON</span><span class="p">(</span><span class="n">SCU_MAX_UNSOLICITED_FRAMES</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">BUILD_BUG_ON_NOT_POWER_OF_2</span><span class="p">(</span><span class="n">SCU_MAX_UNSOLICITED_FRAMES</span><span class="p">);</span>
	<span class="n">BUILD_BUG_ON_NOT_POWER_OF_2</span><span class="p">(</span><span class="n">SCU_MAX_COMPLETION_QUEUE_ENTRIES</span><span class="p">);</span>
	<span class="n">BUILD_BUG_ON</span><span class="p">(</span><span class="n">SCU_MAX_UNSOLICITED_FRAMES</span> <span class="o">&gt;</span> <span class="n">SCU_ABSOLUTE_MAX_UNSOLICITED_FRAMES</span><span class="p">);</span>
	<span class="n">BUILD_BUG_ON_NOT_POWER_OF_2</span><span class="p">(</span><span class="n">SCI_MAX_IO_REQUESTS</span><span class="p">);</span>
	<span class="n">BUILD_BUG_ON_NOT_POWER_OF_2</span><span class="p">(</span><span class="n">SCI_MAX_SEQ</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * enum sci_status - This is the general return status enumeration for non-IO,</span>
<span class="cm"> *    non-task management related SCI interface methods.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">sci_status</span> <span class="p">{</span>
	<span class="cm">/**</span>
<span class="cm">	 * This member indicates successful completion.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_SUCCESS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This value indicates that the calling method completed successfully,</span>
<span class="cm">	 * but that the IO may have completed before having it&#39;s start method</span>
<span class="cm">	 * invoked.  This occurs during SAT translation for requests that do</span>
<span class="cm">	 * not require an IO to the target or for any other requests that may</span>
<span class="cm">	 * be completed without having to submit IO.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_SUCCESS_IO_COMPLETE_BEFORE_START</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 *  This Value indicates that the SCU hardware returned an early response</span>
<span class="cm">	 *  because the io request specified more data than is returned by the</span>
<span class="cm">	 *  target device (mode pages, inquiry data, etc.). The completion routine</span>
<span class="cm">	 *  will handle this case to get the actual number of bytes transferred.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_SUCCESS_IO_DONE_EARLY</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates that the object for which a state change is</span>
<span class="cm">	 * being requested is already in said state.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_WARNING_ALREADY_IN_STATE</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates interrupt coalescence timer may cause SAS</span>
<span class="cm">	 * specification compliance issues (i.e. SMP target mode response</span>
<span class="cm">	 * frames must be returned within 1.9 milliseconds).</span>
<span class="cm">	 */</span>
	<span class="n">SCI_WARNING_TIMER_CONFLICT</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field indicates a sequence of action is not completed yet. Mostly,</span>
<span class="cm">	 * this status is used when multiple ATA commands are needed in a SATI translation.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_WARNING_SEQUENCE_INCOMPLETE</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates that there was a general failure.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates that the SCI implementation is unable to complete</span>
<span class="cm">	 * an operation due to a critical flaw the prevents any further operation</span>
<span class="cm">	 * (i.e. an invalid pointer).</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FATAL_ERROR</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because the state</span>
<span class="cm">	 * of the controller is in a state that prevents successful completion.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_INVALID_STATE</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because there is</span>
<span class="cm">	 * insufficient resources/memory to complete the request.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_INSUFFICIENT_RESOURCES</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because the</span>
<span class="cm">	 * controller object required for the operation can&#39;t be located.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_CONTROLLER_NOT_FOUND</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because the</span>
<span class="cm">	 * discovered controller type is not supported by the library.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_UNSUPPORTED_CONTROLLER_TYPE</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because the</span>
<span class="cm">	 * requested initialization data version isn&#39;t supported.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_UNSUPPORTED_INIT_DATA_VERSION</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because the</span>
<span class="cm">	 * requested configuration of SAS Phys into SAS Ports is not supported.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_UNSUPPORTED_PORT_CONFIGURATION</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because the</span>
<span class="cm">	 * requested protocol is not supported by the remote device, port,</span>
<span class="cm">	 * or controller.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_UNSUPPORTED_PROTOCOL</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because the</span>
<span class="cm">	 * requested information type is not supported by the SCI implementation.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_UNSUPPORTED_INFORMATION_TYPE</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because the</span>
<span class="cm">	 * device already exists.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_DEVICE_EXISTS</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because adding</span>
<span class="cm">	 * a phy to the object is not possible.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_ADDING_PHY_UNSUPPORTED</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because the</span>
<span class="cm">	 * requested information type is not supported by the SCI implementation.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_UNSUPPORTED_INFORMATION_FIELD</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling function failed, because the SCI</span>
<span class="cm">	 * implementation does not support the supplied time limit.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_UNSUPPORTED_TIME_LIMIT</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling method failed, because the SCI</span>
<span class="cm">	 * implementation does not contain the specified Phy.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_INVALID_PHY</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling method failed, because the SCI</span>
<span class="cm">	 * implementation does not contain the specified Port.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_INVALID_PORT</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling method was partly successful</span>
<span class="cm">	 * The port was reset but not all phys in port are operational</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_RESET_PORT_PARTIAL_SUCCESS</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates that calling method failed</span>
<span class="cm">	 * The port reset did not complete because none of the phys are operational</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_RESET_PORT_FAILURE</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling method failed, because the SCI</span>
<span class="cm">	 * implementation does not contain the specified remote device.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_INVALID_REMOTE_DEVICE</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling method failed, because the remote</span>
<span class="cm">	 * device is in a bad state and requires a reset.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_REMOTE_DEVICE_RESET_REQUIRED</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling method failed, because the SCI</span>
<span class="cm">	 * implementation does not contain or support the specified IO tag.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_INVALID_IO_TAG</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates that the operation failed and the user should</span>
<span class="cm">	 * check the response data associated with the IO.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_IO_RESPONSE_VALID</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates that the operation failed, the failure is</span>
<span class="cm">	 * controller implementation specific, and the response data associated</span>
<span class="cm">	 * with the request is not valid.  You can query for the controller</span>
<span class="cm">	 * specific error information via sci_controller_get_request_status()</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_CONTROLLER_SPECIFIC_IO_ERR</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicated that the operation failed because the</span>
<span class="cm">	 * user requested this IO to be terminated.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_IO_TERMINATED</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates that the operation failed and the associated</span>
<span class="cm">	 * request requires a SCSI abort task to be sent to the target.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_IO_REQUIRES_SCSI_ABORT</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates that the operation failed because the supplied</span>
<span class="cm">	 * device could not be located.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_DEVICE_NOT_FOUND</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates that the operation failed because the</span>
<span class="cm">	 * objects association is required and is not correctly set.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_INVALID_ASSOCIATION</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates that the operation failed, because a timeout</span>
<span class="cm">	 * occurred.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_TIMEOUT</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates that the operation failed, because the user</span>
<span class="cm">	 * specified a value that is either invalid or not supported.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_INVALID_PARAMETER_VALUE</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This value indicates that the operation failed, because the number</span>
<span class="cm">	 * of messages (MSI-X) is not supported.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_UNSUPPORTED_MESSAGE_COUNT</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This value indicates that the method failed due to a lack of</span>
<span class="cm">	 * available NCQ tags.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_NO_NCQ_TAG_AVAILABLE</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This value indicates that a protocol violation has occurred on the</span>
<span class="cm">	 * link.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_PROTOCOL_VIOLATION</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This value indicates a failure condition that retry may help to clear.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_RETRY_REQUIRED</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field indicates the retry limit was reached when a retry is attempted</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_RETRY_LIMIT_REACHED</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This member indicates the calling method was partly successful.</span>
<span class="cm">	 * Mostly, this status is used when a LUN_RESET issued to an expander attached</span>
<span class="cm">	 * STP device in READY NCQ substate needs to have RNC suspended/resumed</span>
<span class="cm">	 * before posting TC.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_RESET_DEVICE_PARTIAL_SUCCESS</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field indicates an illegal phy connection based on the routing attribute</span>
<span class="cm">	 * of both expander phy attached to each other.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_ILLEGAL_ROUTING_ATTRIBUTE_CONFIGURATION</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This field indicates a CONFIG ROUTE INFO command has a response with function result</span>
<span class="cm">	 * INDEX DOES NOT EXIST, usually means exceeding max route index.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_EXCEED_MAX_ROUTE_INDEX</span><span class="p">,</span>

	<span class="cm">/**</span>
<span class="cm">	 * This value indicates that an unsupported PCI device ID has been</span>
<span class="cm">	 * specified.  This indicates that attempts to invoke</span>
<span class="cm">	 * sci_library_allocate_controller() will fail.</span>
<span class="cm">	 */</span>
	<span class="n">SCI_FAILURE_UNSUPPORTED_PCI_DEVICE_ID</span>

<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * enum sci_io_status - This enumeration depicts all of the possible IO</span>
<span class="cm"> *    completion status values.  Each value in this enumeration maps directly</span>
<span class="cm"> *    to a value in the enum sci_status enumeration.  Please refer to that</span>
<span class="cm"> *    enumeration for detailed comments concerning what the status represents.</span>
<span class="cm"> *</span>
<span class="cm"> * Add the API to retrieve the SCU status from the core. Check to see that the</span>
<span class="cm"> * following status are properly handled: - SCI_IO_FAILURE_UNSUPPORTED_PROTOCOL</span>
<span class="cm"> * - SCI_IO_FAILURE_INVALID_IO_TAG</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">sci_io_status</span> <span class="p">{</span>
	<span class="n">SCI_IO_SUCCESS</span>                         <span class="o">=</span> <span class="n">SCI_SUCCESS</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE</span>                         <span class="o">=</span> <span class="n">SCI_FAILURE</span><span class="p">,</span>
	<span class="n">SCI_IO_SUCCESS_COMPLETE_BEFORE_START</span>   <span class="o">=</span> <span class="n">SCI_SUCCESS_IO_COMPLETE_BEFORE_START</span><span class="p">,</span>
	<span class="n">SCI_IO_SUCCESS_IO_DONE_EARLY</span>           <span class="o">=</span> <span class="n">SCI_SUCCESS_IO_DONE_EARLY</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_INVALID_STATE</span>           <span class="o">=</span> <span class="n">SCI_FAILURE_INVALID_STATE</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_INSUFFICIENT_RESOURCES</span>  <span class="o">=</span> <span class="n">SCI_FAILURE_INSUFFICIENT_RESOURCES</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_UNSUPPORTED_PROTOCOL</span>    <span class="o">=</span> <span class="n">SCI_FAILURE_UNSUPPORTED_PROTOCOL</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_RESPONSE_VALID</span>          <span class="o">=</span> <span class="n">SCI_FAILURE_IO_RESPONSE_VALID</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_CONTROLLER_SPECIFIC_ERR</span> <span class="o">=</span> <span class="n">SCI_FAILURE_CONTROLLER_SPECIFIC_IO_ERR</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_TERMINATED</span>              <span class="o">=</span> <span class="n">SCI_FAILURE_IO_TERMINATED</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_REQUIRES_SCSI_ABORT</span>     <span class="o">=</span> <span class="n">SCI_FAILURE_IO_REQUIRES_SCSI_ABORT</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_INVALID_PARAMETER_VALUE</span> <span class="o">=</span> <span class="n">SCI_FAILURE_INVALID_PARAMETER_VALUE</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_NO_NCQ_TAG_AVAILABLE</span>    <span class="o">=</span> <span class="n">SCI_FAILURE_NO_NCQ_TAG_AVAILABLE</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_PROTOCOL_VIOLATION</span>      <span class="o">=</span> <span class="n">SCI_FAILURE_PROTOCOL_VIOLATION</span><span class="p">,</span>

	<span class="n">SCI_IO_FAILURE_REMOTE_DEVICE_RESET_REQUIRED</span> <span class="o">=</span> <span class="n">SCI_FAILURE_REMOTE_DEVICE_RESET_REQUIRED</span><span class="p">,</span>

	<span class="n">SCI_IO_FAILURE_RETRY_REQUIRED</span>      <span class="o">=</span> <span class="n">SCI_FAILURE_RETRY_REQUIRED</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_RETRY_LIMIT_REACHED</span> <span class="o">=</span> <span class="n">SCI_FAILURE_RETRY_LIMIT_REACHED</span><span class="p">,</span>
	<span class="n">SCI_IO_FAILURE_INVALID_REMOTE_DEVICE</span> <span class="o">=</span> <span class="n">SCI_FAILURE_INVALID_REMOTE_DEVICE</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * enum sci_task_status - This enumeration depicts all of the possible task</span>
<span class="cm"> *    completion status values.  Each value in this enumeration maps directly</span>
<span class="cm"> *    to a value in the enum sci_status enumeration.  Please refer to that</span>
<span class="cm"> *    enumeration for detailed comments concerning what the status represents.</span>
<span class="cm"> *</span>
<span class="cm"> * Check to see that the following status are properly handled:</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">sci_task_status</span> <span class="p">{</span>
	<span class="n">SCI_TASK_SUCCESS</span>                         <span class="o">=</span> <span class="n">SCI_SUCCESS</span><span class="p">,</span>
	<span class="n">SCI_TASK_FAILURE</span>                         <span class="o">=</span> <span class="n">SCI_FAILURE</span><span class="p">,</span>
	<span class="n">SCI_TASK_FAILURE_INVALID_STATE</span>           <span class="o">=</span> <span class="n">SCI_FAILURE_INVALID_STATE</span><span class="p">,</span>
	<span class="n">SCI_TASK_FAILURE_INSUFFICIENT_RESOURCES</span>  <span class="o">=</span> <span class="n">SCI_FAILURE_INSUFFICIENT_RESOURCES</span><span class="p">,</span>
	<span class="n">SCI_TASK_FAILURE_UNSUPPORTED_PROTOCOL</span>    <span class="o">=</span> <span class="n">SCI_FAILURE_UNSUPPORTED_PROTOCOL</span><span class="p">,</span>
	<span class="n">SCI_TASK_FAILURE_INVALID_TAG</span>             <span class="o">=</span> <span class="n">SCI_FAILURE_INVALID_IO_TAG</span><span class="p">,</span>
	<span class="n">SCI_TASK_FAILURE_RESPONSE_VALID</span>          <span class="o">=</span> <span class="n">SCI_FAILURE_IO_RESPONSE_VALID</span><span class="p">,</span>
	<span class="n">SCI_TASK_FAILURE_CONTROLLER_SPECIFIC_ERR</span> <span class="o">=</span> <span class="n">SCI_FAILURE_CONTROLLER_SPECIFIC_IO_ERR</span><span class="p">,</span>
	<span class="n">SCI_TASK_FAILURE_TERMINATED</span>              <span class="o">=</span> <span class="n">SCI_FAILURE_IO_TERMINATED</span><span class="p">,</span>
	<span class="n">SCI_TASK_FAILURE_INVALID_PARAMETER_VALUE</span> <span class="o">=</span> <span class="n">SCI_FAILURE_INVALID_PARAMETER_VALUE</span><span class="p">,</span>

	<span class="n">SCI_TASK_FAILURE_REMOTE_DEVICE_RESET_REQUIRED</span> <span class="o">=</span> <span class="n">SCI_FAILURE_REMOTE_DEVICE_RESET_REQUIRED</span><span class="p">,</span>
	<span class="n">SCI_TASK_FAILURE_RESET_DEVICE_PARTIAL_SUCCESS</span> <span class="o">=</span> <span class="n">SCI_FAILURE_RESET_DEVICE_PARTIAL_SUCCESS</span>

<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * sci_swab32_cpy - convert between scsi and scu-hardware byte format</span>
<span class="cm"> * @dest: receive the 4-byte endian swapped version of src</span>
<span class="cm"> * @src: word aligned source buffer</span>
<span class="cm"> *</span>
<span class="cm"> * scu hardware handles SSP/SMP control, response, and unidentified</span>
<span class="cm"> * frames in &quot;big endian dword&quot; order.  Regardless of host endian this</span>
<span class="cm"> * is always a swab32()-per-dword conversion of the standard definition,</span>
<span class="cm"> * i.e. single byte fields swapped and multi-byte fields in little-</span>
<span class="cm"> * endian</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">sci_swab32_cpy</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">_dest</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">_src</span><span class="p">,</span> <span class="kt">ssize_t</span> <span class="n">word_cnt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">dest</span> <span class="o">=</span> <span class="n">_dest</span><span class="p">,</span> <span class="o">*</span><span class="n">src</span> <span class="o">=</span> <span class="n">_src</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">word_cnt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">dest</span><span class="p">[</span><span class="n">word_cnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">swab32</span><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="n">word_cnt</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">no_outbound_task_to</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">u16</span> <span class="n">ssp_max_occ_to</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">u16</span> <span class="n">stp_max_occ_to</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">u16</span> <span class="n">ssp_inactive_to</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">u16</span> <span class="n">stp_inactive_to</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">phy_gen</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">max_concurr_spinup</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">uint</span> <span class="n">cable_selection_override</span><span class="p">;</span>

<span class="n">irqreturn_t</span> <span class="n">isci_msix_isr</span><span class="p">(</span><span class="kt">int</span> <span class="n">vec</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="n">irqreturn_t</span> <span class="n">isci_intx_isr</span><span class="p">(</span><span class="kt">int</span> <span class="n">vec</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="n">irqreturn_t</span> <span class="n">isci_error_isr</span><span class="p">(</span><span class="kt">int</span> <span class="n">vec</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Each timer is associated with a cancellation flag that is set when</span>
<span class="cm"> * del_timer() is called and checked in the timer callback function. This</span>
<span class="cm"> * is needed since del_timer_sync() cannot be called with sci_lock held.</span>
<span class="cm"> * For deinit however, del_timer_sync() is used without holding the lock.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sci_timer</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">timer_list</span>	<span class="n">timer</span><span class="p">;</span>
	<span class="n">bool</span>			<span class="n">cancel</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">void</span> <span class="nf">sci_init_timer</span><span class="p">(</span><span class="k">struct</span> <span class="n">sci_timer</span> <span class="o">*</span><span class="n">tmr</span><span class="p">,</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fn</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">))</span>
<span class="p">{</span>
	<span class="n">tmr</span><span class="o">-&gt;</span><span class="n">timer</span><span class="p">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">fn</span><span class="p">;</span>
	<span class="n">tmr</span><span class="o">-&gt;</span><span class="n">timer</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">tmr</span><span class="p">;</span>
	<span class="n">tmr</span><span class="o">-&gt;</span><span class="n">cancel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">init_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmr</span><span class="o">-&gt;</span><span class="n">timer</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">sci_mod_timer</span><span class="p">(</span><span class="k">struct</span> <span class="n">sci_timer</span> <span class="o">*</span><span class="n">tmr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">msec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">tmr</span><span class="o">-&gt;</span><span class="n">cancel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">mod_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmr</span><span class="o">-&gt;</span><span class="n">timer</span><span class="p">,</span> <span class="n">jiffies</span> <span class="o">+</span> <span class="n">msecs_to_jiffies</span><span class="p">(</span><span class="n">msec</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">sci_del_timer</span><span class="p">(</span><span class="k">struct</span> <span class="n">sci_timer</span> <span class="o">*</span><span class="n">tmr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">tmr</span><span class="o">-&gt;</span><span class="n">cancel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">del_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmr</span><span class="o">-&gt;</span><span class="n">timer</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">sci_base_state_machine</span> <span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">sci_base_state</span> <span class="o">*</span><span class="n">state_table</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">initial_state_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">current_state_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">previous_state_id</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">sci_state_transition_t</span><span class="p">)(</span><span class="k">struct</span> <span class="n">sci_base_state_machine</span> <span class="o">*</span><span class="n">sm</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">sci_base_state</span> <span class="p">{</span>
	<span class="n">sci_state_transition_t</span> <span class="n">enter_state</span><span class="p">;</span>	<span class="cm">/* Called on state entry */</span>
	<span class="n">sci_state_transition_t</span> <span class="n">exit_state</span><span class="p">;</span>	<span class="cm">/* Called on state exit */</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">sci_init_sm</span><span class="p">(</span><span class="k">struct</span> <span class="n">sci_base_state_machine</span> <span class="o">*</span><span class="n">sm</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">sci_base_state</span> <span class="o">*</span><span class="n">state_table</span><span class="p">,</span>
			<span class="n">u32</span> <span class="n">initial_state</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sci_change_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">sci_base_state_machine</span> <span class="o">*</span><span class="n">sm</span><span class="p">,</span> <span class="n">u32</span> <span class="n">next_state</span><span class="p">);</span>
<span class="cp">#endif  </span><span class="cm">/* __ISCI_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
