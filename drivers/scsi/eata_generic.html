<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › eata_generic.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>eata_generic.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/********************************************************</span>
<span class="cm">* Header file for eata_dma.c and eata_pio.c		*</span>
<span class="cm">* Linux EATA SCSI drivers				*</span>
<span class="cm">* (c) 1993-96 Michael Neuffer                           *</span>
<span class="cm">*             mike@i-Connect.Net                        *</span>
<span class="cm">*             neuffer@mail.uni-mainz.de                 *</span>
<span class="cm">*********************************************************</span>
<span class="cm">* last change: 96/08/14                                 *</span>
<span class="cm">********************************************************/</span>


<span class="cp">#ifndef _EATA_GENERIC_H</span>
<span class="cp">#define _EATA_GENERIC_H</span>



<span class="cm">/*********************************************</span>
<span class="cm"> * Misc. definitions			     *</span>
<span class="cm"> *********************************************/</span>

<span class="cp">#define R_LIMIT 0x20000</span>

<span class="cp">#define MAXISA	   4</span>
<span class="cp">#define MAXEISA	  16  </span>
<span class="cp">#define MAXPCI	  16</span>
<span class="cp">#define MAXIRQ	  16 </span>
<span class="cp">#define MAXTARGET 16</span>
<span class="cp">#define MAXCHANNEL 3</span>

<span class="cp">#define IS_ISA	   &#39;I&#39;</span>
<span class="cp">#define IS_EISA	   &#39;E&#39;</span>
<span class="cp">#define IS_PCI	   &#39;P&#39;</span>

<span class="cp">#define BROKEN_INQUIRY	1</span>

<span class="cp">#define BUSMASTER       0xff</span>
<span class="cp">#define PIO             0xfe</span>

<span class="cp">#define EATA_SIGNATURE	0x45415441     </span><span class="cm">/* BIG ENDIAN coded &quot;EATA&quot; sig.	 */</span><span class="cp"></span>

<span class="cp">#define DPT_ID1         0x12</span>
<span class="cp">#define DPT_ID2         0x14</span>

<span class="cp">#define ATT_ID1         0x06</span>
<span class="cp">#define ATT_ID2         0x94</span>
<span class="cp">#define ATT_ID3         0x0</span>

<span class="cp">#define NEC_ID1         0x38</span>
<span class="cp">#define NEC_ID2         0xa3</span>
<span class="cp">#define NEC_ID3         0x82</span>

 
<span class="cp">#define EATA_CP_SIZE	 44</span>

<span class="cp">#define MAX_PCI_DEVICES  32	       </span><span class="cm">/* Maximum # Of Devices Per Bus	 */</span><span class="cp"></span>
<span class="cp">#define MAX_METHOD_2	 16	       </span><span class="cm">/* Max Devices For Method 2	 */</span><span class="cp"></span>
<span class="cp">#define MAX_PCI_BUS	 16	       </span><span class="cm">/* Maximum # Of Busses Allowed	 */</span><span class="cp"></span>

<span class="cp">#define SG_SIZE		 64 </span>
<span class="cp">#define SG_SIZE_BIG	 252	       </span><span class="cm">/* max. 8096 elements, 64k */</span><span class="cp"></span>

<span class="cp">#define UPPER_DEVICE_QUEUE_LIMIT 64    </span><span class="cm">/* The limit we have to set for the </span>
<span class="cm">					* device queue to keep the broken </span>
<span class="cm">					* midlevel SCSI code from producing</span>
<span class="cm">					* bogus timeouts</span>
<span class="cm">					*/</span><span class="cp"></span>

<span class="cp">#define TYPE_DISK_QUEUE  16</span>
<span class="cp">#define TYPE_TAPE_QUEUE  4</span>
<span class="cp">#define TYPE_ROM_QUEUE   4</span>
<span class="cp">#define TYPE_OTHER_QUEUE 2</span>

<span class="cp">#define FREE	         0</span>
<span class="cp">#define OK	         0</span>
<span class="cp">#define NO_TIMEOUT       0</span>
<span class="cp">#define USED	         1</span>
<span class="cp">#define TIMEOUT	         2</span>
<span class="cp">#define RESET	         4</span>
<span class="cp">#define LOCKED	         8</span>
<span class="cp">#define ABORTED          16</span>

<span class="cp">#define READ             0</span>
<span class="cp">#define WRITE            1</span>
<span class="cp">#define OTHER            2</span>

<span class="cp">#define HD(cmd)	 ((hostdata *)&amp;(cmd-&gt;device-&gt;host-&gt;hostdata))</span>
<span class="cp">#define CD(cmd)	 ((struct eata_ccb *)(cmd-&gt;host_scribble))</span>
<span class="cp">#define SD(host) ((hostdata *)&amp;(host-&gt;hostdata))</span>

<span class="cm">/***********************************************</span>
<span class="cm"> *    EATA Command &amp; Register definitions      *</span>
<span class="cm"> ***********************************************/</span>
<span class="cp">#define PCI_REG_DPTconfig	 0x40	 </span>
<span class="cp">#define PCI_REG_PumpModeAddress	 0x44	 </span>
<span class="cp">#define PCI_REG_PumpModeData	 0x48	 </span>
<span class="cp">#define PCI_REG_ConfigParam1	 0x50	 </span>
<span class="cp">#define PCI_REG_ConfigParam2	 0x54	 </span>


<span class="cp">#define EATA_CMD_PIO_SETUPTEST	 0xc6</span>
<span class="cp">#define EATA_CMD_PIO_READ_CONFIG 0xf0</span>
<span class="cp">#define EATA_CMD_PIO_SET_CONFIG	 0xf1</span>
<span class="cp">#define EATA_CMD_PIO_SEND_CP	 0xf2</span>
<span class="cp">#define EATA_CMD_PIO_RECEIVE_SP	 0xf3</span>
<span class="cp">#define EATA_CMD_PIO_TRUNC	 0xf4</span>

<span class="cp">#define EATA_CMD_RESET		 0xf9</span>
<span class="cp">#define EATA_CMD_IMMEDIATE	 0xfa</span>

<span class="cp">#define EATA_CMD_DMA_READ_CONFIG 0xfd</span>
<span class="cp">#define EATA_CMD_DMA_SET_CONFIG	 0xfe</span>
<span class="cp">#define EATA_CMD_DMA_SEND_CP	 0xff</span>

<span class="cp">#define ECS_EMULATE_SENSE	 0xd4</span>

<span class="cp">#define EATA_GENERIC_ABORT       0x00 </span>
<span class="cp">#define EATA_SPECIFIC_RESET      0x01</span>
<span class="cp">#define EATA_BUS_RESET           0x02</span>
<span class="cp">#define EATA_SPECIFIC_ABORT      0x03</span>
<span class="cp">#define EATA_QUIET_INTR          0x04</span>
<span class="cp">#define EATA_COLD_BOOT_HBA       0x06	   </span><span class="cm">/* Only as a last resort	*/</span><span class="cp"></span>
<span class="cp">#define EATA_FORCE_IO            0x07</span>

<span class="cp">#define HA_CTRLREG     0x206       </span><span class="cm">/* control register for HBA    */</span><span class="cp"></span>
<span class="cp">#define HA_CTRL_DISINT 0x02        </span><span class="cm">/* CTRLREG: disable interrupts */</span><span class="cp"></span>
<span class="cp">#define HA_CTRL_RESCPU 0x04        </span><span class="cm">/* CTRLREG: reset processor    */</span><span class="cp"></span>
<span class="cp">#define HA_CTRL_8HEADS 0x08        </span><span class="cm">/* CTRLREG: set for drives with* </span>
<span class="cm">				    * &gt;=8 heads (WD1003 rudimentary :-) */</span><span class="cp"></span>

<span class="cp">#define HA_WCOMMAND    0x07	   </span><span class="cm">/* command register offset	*/</span><span class="cp"></span>
<span class="cp">#define HA_WIFC        0x06	   </span><span class="cm">/* immediate command offset  */</span><span class="cp"></span>
<span class="cp">#define HA_WCODE       0x05 </span>
<span class="cp">#define HA_WCODE2      0x04 </span>
<span class="cp">#define HA_WDMAADDR    0x02	   </span><span class="cm">/* DMA address LSB offset	*/</span><span class="cp">  </span>
<span class="cp">#define HA_RAUXSTAT    0x08	   </span><span class="cm">/* aux status register offset*/</span><span class="cp"></span>
<span class="cp">#define HA_RSTATUS     0x07	   </span><span class="cm">/* status register offset	*/</span><span class="cp"></span>
<span class="cp">#define HA_RDATA       0x00	   </span><span class="cm">/* data register (16bit)	*/</span><span class="cp"></span>
<span class="cp">#define HA_WDATA       0x00	   </span><span class="cm">/* data register (16bit)	*/</span><span class="cp"></span>

<span class="cp">#define HA_ABUSY       0x01	   </span><span class="cm">/* aux busy bit		*/</span><span class="cp"></span>
<span class="cp">#define HA_AIRQ	       0x02	   </span><span class="cm">/* aux IRQ pending bit	*/</span><span class="cp"></span>
<span class="cp">#define HA_SERROR      0x01	   </span><span class="cm">/* pr. command ended in error*/</span><span class="cp"></span>
<span class="cp">#define HA_SMORE       0x02	   </span><span class="cm">/* more data soon to come	*/</span><span class="cp"></span>
<span class="cp">#define HA_SCORR       0x04	   </span><span class="cm">/* data corrected		*/</span><span class="cp"></span>
<span class="cp">#define HA_SDRQ	       0x08	   </span><span class="cm">/* data request active	*/</span><span class="cp"></span>
<span class="cp">#define HA_SSC	       0x10	   </span><span class="cm">/* seek complete		*/</span><span class="cp"></span>
<span class="cp">#define HA_SFAULT      0x20	   </span><span class="cm">/* write fault		*/</span><span class="cp"></span>
<span class="cp">#define HA_SREADY      0x40	   </span><span class="cm">/* drive ready		*/</span><span class="cp"></span>
<span class="cp">#define HA_SBUSY       0x80	   </span><span class="cm">/* drive busy		*/</span><span class="cp"></span>
<span class="cp">#define HA_SDRDY       HA_SSC+HA_SREADY+HA_SDRQ </span>

<span class="cm">/**********************************************</span>
<span class="cm"> * Message definitions			      *</span>
<span class="cm"> **********************************************/</span>

<span class="cp">#define HA_NO_ERROR	 0x00	</span><span class="cm">/* No Error				*/</span><span class="cp"></span>
<span class="cp">#define HA_ERR_SEL_TO	 0x01	</span><span class="cm">/* Selection Timeout			*/</span><span class="cp"></span>
<span class="cp">#define HA_ERR_CMD_TO	 0x02	</span><span class="cm">/* Command Timeout			*/</span><span class="cp"></span>
<span class="cp">#define HA_BUS_RESET	 0x03	</span><span class="cm">/* SCSI Bus Reset Received		*/</span><span class="cp"></span>
<span class="cp">#define HA_INIT_POWERUP	 0x04	</span><span class="cm">/* Initial Controller Power-up		*/</span><span class="cp"></span>
<span class="cp">#define HA_UNX_BUSPHASE	 0x05	</span><span class="cm">/* Unexpected Bus Phase			*/</span><span class="cp"></span>
<span class="cp">#define HA_UNX_BUS_FREE	 0x06	</span><span class="cm">/* Unexpected Bus Free			*/</span><span class="cp"></span>
<span class="cp">#define HA_BUS_PARITY	 0x07	</span><span class="cm">/* Bus Parity Error			*/</span><span class="cp"></span>
<span class="cp">#define HA_SCSI_HUNG	 0x08	</span><span class="cm">/* SCSI Hung				*/</span><span class="cp"></span>
<span class="cp">#define HA_UNX_MSGRJCT	 0x09	</span><span class="cm">/* Unexpected Message Rejected		*/</span><span class="cp"></span>
<span class="cp">#define HA_RESET_STUCK	 0x0a	</span><span class="cm">/* SCSI Bus Reset Stuck			*/</span><span class="cp"></span>
<span class="cp">#define HA_RSENSE_FAIL	 0x0b	</span><span class="cm">/* Auto Request-Sense Failed		*/</span><span class="cp"></span>
<span class="cp">#define HA_PARITY_ERR	 0x0c	</span><span class="cm">/* Controller Ram Parity Error		*/</span><span class="cp"></span>
<span class="cp">#define HA_CP_ABORT_NA	 0x0d	</span><span class="cm">/* Abort Message sent to non-active cmd */</span><span class="cp"></span>
<span class="cp">#define HA_CP_ABORTED	 0x0e	</span><span class="cm">/* Abort Message sent to active cmd	*/</span><span class="cp"></span>
<span class="cp">#define HA_CP_RESET_NA	 0x0f	</span><span class="cm">/* Reset Message sent to non-active cmd */</span><span class="cp"></span>
<span class="cp">#define HA_CP_RESET	 0x10	</span><span class="cm">/* Reset Message sent to active cmd	*/</span><span class="cp"></span>
<span class="cp">#define HA_ECC_ERR	 0x11	</span><span class="cm">/* Controller Ram ECC Error		*/</span><span class="cp"></span>
<span class="cp">#define HA_PCI_PARITY	 0x12	</span><span class="cm">/* PCI Parity Error			*/</span><span class="cp"></span>
<span class="cp">#define HA_PCI_MABORT	 0x13	</span><span class="cm">/* PCI Master Abort			*/</span><span class="cp"></span>
<span class="cp">#define HA_PCI_TABORT	 0x14	</span><span class="cm">/* PCI Target Abort			*/</span><span class="cp"></span>
<span class="cp">#define HA_PCI_STABORT	 0x15	</span><span class="cm">/* PCI Signaled Target Abort		*/</span><span class="cp"></span>

<span class="cm">/**********************************************</span>
<span class="cm"> *  Other  definitions			      *</span>
<span class="cm"> **********************************************/</span>

<span class="k">struct</span> <span class="n">reg_bit</span> <span class="p">{</span>      <span class="cm">/* reading this one will clear the interrupt    */</span>
    <span class="n">__u8</span> <span class="n">error</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>     <span class="cm">/* previous command ended in an error	      */</span>
    <span class="n">__u8</span> <span class="n">more</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>      <span class="cm">/* more DATA coming soon, poll BSY &amp; DRQ (PIO)  */</span>
    <span class="n">__u8</span> <span class="n">corr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>      <span class="cm">/* data read was successfully corrected with ECC*/</span>
    <span class="n">__u8</span> <span class="n">drq</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	      <span class="cm">/* data request active  */</span>     
    <span class="n">__u8</span> <span class="n">sc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	      <span class="cm">/* seek complete	      */</span>
    <span class="n">__u8</span> <span class="n">fault</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>     <span class="cm">/* write fault	      */</span>
    <span class="n">__u8</span> <span class="n">ready</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>     <span class="cm">/* drive ready	      */</span>
    <span class="n">__u8</span> <span class="n">busy</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>      <span class="cm">/* controller busy      */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">reg_abit</span> <span class="p">{</span>     <span class="cm">/* reading this won&#39;t clear the interrupt */</span>
    <span class="n">__u8</span> <span class="n">abusy</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>     <span class="cm">/* auxiliary busy				*/</span>
    <span class="n">__u8</span> <span class="n">irq</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	      <span class="cm">/* set when drive interrupt is asserted	*/</span>
    <span class="n">__u8</span> <span class="n">dummy</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">eata_register</span> <span class="p">{</span>	    <span class="cm">/* EATA register set */</span>
    <span class="n">__u8</span> <span class="n">data_reg</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	    <span class="cm">/* R, couldn&#39;t figure this one out		*/</span>
    <span class="n">__u8</span> <span class="n">cp_addr</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	    <span class="cm">/* W, CP address register			*/</span>
    <span class="k">union</span> <span class="p">{</span> 
	<span class="n">__u8</span> <span class="n">command</span><span class="p">;</span>	    <span class="cm">/* W, command code: [read|set] conf, send CP*/</span>
	<span class="k">struct</span> <span class="n">reg_bit</span> <span class="n">status</span><span class="p">;</span>	<span class="cm">/* R, see register_bit1			*/</span>
	<span class="n">__u8</span> <span class="n">statusbyte</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">ovr</span><span class="p">;</span>   
    <span class="k">struct</span> <span class="n">reg_abit</span> <span class="n">aux_stat</span><span class="p">;</span> <span class="cm">/* R, see register_bit2			*/</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">get_conf</span> <span class="p">{</span>	      <span class="cm">/* Read Configuration Array		*/</span>
    <span class="n">__u32</span>  <span class="n">len</span><span class="p">;</span>		      <span class="cm">/* Should return 0x22, 0x24, etc		*/</span>
    <span class="n">__u32</span> <span class="n">signature</span><span class="p">;</span>	      <span class="cm">/* Signature MUST be &quot;EATA&quot;		*/</span>
    <span class="n">__u8</span>    <span class="n">version2</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span>
	     <span class="nl">version:</span><span class="mi">4</span><span class="p">;</span>	      <span class="cm">/* EATA Version level			*/</span>
    <span class="n">__u8</span> <span class="n">OCS_enabled</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* Overlap Command Support enabled	*/</span>
	 <span class="nl">TAR_support:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* SCSI Target Mode supported		*/</span>
	      <span class="nl">TRNXFR:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* Truncate Transfer Cmd not necessary	*</span>
<span class="cm">			       * Only used in PIO Mode			*/</span>
	<span class="nl">MORE_support:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* MORE supported (only PIO Mode)		*/</span>
	 <span class="nl">DMA_support:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* DMA supported Driver uses only		*</span>
<span class="cm">			       * this mode				*/</span>
	   <span class="nl">DMA_valid:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* DRQ value in Byte 30 is valid		*/</span>
		 <span class="nl">ATA:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* ATA device connected (not supported)	*/</span>
	   <span class="nl">HAA_valid:</span><span class="mi">1</span><span class="p">;</span>	      <span class="cm">/* Hostadapter Address is valid		*/</span>

    <span class="n">__u16</span> <span class="n">cppadlen</span><span class="p">;</span>	      <span class="cm">/* Number of pad bytes send after CD data *</span>
<span class="cm">			       * set to zero for DMA commands		*/</span>
    <span class="n">__u8</span> <span class="n">scsi_id</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	      <span class="cm">/* SCSI ID of controller 2-0 Byte 0 res.	*</span>
<span class="cm">			       * if not, zero is returned		*/</span>
    <span class="n">__u32</span>  <span class="n">cplen</span><span class="p">;</span>	      <span class="cm">/* CP length: number of valid cp bytes	*/</span>
    <span class="n">__u32</span>  <span class="n">splen</span><span class="p">;</span>	      <span class="cm">/* Number of bytes returned after		* </span>
<span class="cm">			       * Receive SP command			*/</span>
    <span class="n">__u16</span> <span class="n">queuesiz</span><span class="p">;</span>	      <span class="cm">/* max number of queueable CPs		*/</span>
    <span class="n">__u16</span> <span class="n">dummy</span><span class="p">;</span>
    <span class="n">__u16</span> <span class="n">SGsiz</span><span class="p">;</span>	      <span class="cm">/* max number of SG table entries		*/</span>
    <span class="n">__u8</span>    <span class="n">IRQ</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span>	      <span class="cm">/* IRQ used this HA			*/</span>
	 <span class="nl">IRQ_TR:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* IRQ Trigger: 0=edge, 1=level		*/</span>
	 <span class="nl">SECOND:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* This is a secondary controller		*/</span>
    <span class="nl">DMA_channel:</span><span class="mi">2</span><span class="p">;</span>	      <span class="cm">/* DRQ index, DRQ is 2comp of DRQX	*/</span>
    <span class="n">__u8</span> <span class="n">sync</span><span class="p">;</span>		      <span class="cm">/* device at ID 7 tru 0 is running in	*</span>
<span class="cm">			       * synchronous mode, this will disappear	*/</span>
    <span class="n">__u8</span>   <span class="n">DSBLE</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* ISA i/o addressing is disabled		*/</span>
	 <span class="nl">FORCADR:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* i/o address has been forced		*/</span>
	  <span class="nl">SG_64K:</span><span class="mi">1</span><span class="p">,</span>
	  <span class="nl">SG_UAE:</span><span class="mi">1</span><span class="p">,</span>
		<span class="o">:</span><span class="mi">4</span><span class="p">;</span>
    <span class="n">__u8</span>  <span class="n">MAX_ID</span><span class="o">:</span><span class="mi">5</span><span class="p">,</span>	      <span class="cm">/* Max number of SCSI target IDs		*/</span>
	<span class="nl">MAX_CHAN:</span><span class="mi">3</span><span class="p">;</span>	      <span class="cm">/* Number of SCSI busses on HBA		*/</span>
    <span class="n">__u8</span> <span class="n">MAX_LUN</span><span class="p">;</span>	      <span class="cm">/* Max number of LUNs			*/</span>
    <span class="n">__u8</span>	<span class="o">:</span><span class="mi">3</span><span class="p">,</span>
	 <span class="nl">AUTOTRM:</span><span class="mi">1</span><span class="p">,</span>
	 <span class="nl">M1_inst:</span><span class="mi">1</span><span class="p">,</span>
	 <span class="nl">ID_qest:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* Raidnum ID is questionable		*/</span>
	  <span class="nl">is_PCI:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* HBA is PCI				*/</span>
	 <span class="nl">is_EISA:</span><span class="mi">1</span><span class="p">;</span>	      <span class="cm">/* HBA is EISA				*/</span>
    <span class="n">__u8</span> <span class="n">RAIDNUM</span><span class="p">;</span>             <span class="cm">/* unique HBA identifier                  */</span>
    <span class="n">__u8</span> <span class="n">unused</span><span class="p">[</span><span class="mi">474</span><span class="p">];</span> 
<span class="p">};</span>

<span class="k">struct</span> <span class="n">eata_sg_list</span>
<span class="p">{</span>
    <span class="n">__u32</span> <span class="n">data</span><span class="p">;</span>
    <span class="n">__u32</span> <span class="n">len</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">eata_ccb</span> <span class="p">{</span>	      <span class="cm">/* Send Command Packet structure	    */</span>
 
    <span class="n">__u8</span> <span class="n">SCSI_Reset</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* Cause a SCSI Bus reset on the cmd	*/</span>
	   <span class="nl">HBA_Init:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* Cause Controller to reinitialize	*/</span>
       <span class="nl">Auto_Req_Sen:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* Do Auto Request Sense on errors	*/</span>
	    <span class="nl">scatter:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* Data Ptr points to a SG Packet		*/</span>
	     <span class="nl">Resrvd:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* RFU					*/</span>
	  <span class="nl">Interpret:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* Interpret the SCSI cdb of own use	*/</span>
	    <span class="nl">DataOut:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* Data Out phase with command		*/</span>
	     <span class="nl">DataIn:</span><span class="mi">1</span><span class="p">;</span>	      <span class="cm">/* Data In phase with command		*/</span>
    <span class="n">__u8</span> <span class="n">reqlen</span><span class="p">;</span>	      <span class="cm">/* Request Sense Length			* </span>
<span class="cm">			       * Valid if Auto_Req_Sen=1		*/</span>
    <span class="n">__u8</span> <span class="n">unused</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="n">__u8</span>  <span class="n">FWNEST</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* send cmd to phys RAID component	*/</span>
	 <span class="nl">unused2:</span><span class="mi">7</span><span class="p">;</span>
    <span class="n">__u8</span> <span class="n">Phsunit</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* physical unit on mirrored pair		*/</span>
	    <span class="nl">I_AT:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* inhibit address translation		*/</span>
	 <span class="nl">I_HBA_C:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* HBA inhibit caching			*/</span>
	 <span class="nl">unused3:</span><span class="mi">5</span><span class="p">;</span>

    <span class="n">__u8</span>     <span class="n">cp_id</span><span class="o">:</span><span class="mi">5</span><span class="p">,</span>	      <span class="cm">/* SCSI Device ID of target		*/</span> 
	<span class="n">cp_channel</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>	      <span class="cm">/* SCSI Channel # of HBA			*/</span>
    <span class="n">__u8</span>    <span class="n">cp_lun</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span>
		  <span class="o">:</span><span class="mi">2</span><span class="p">,</span>
	 <span class="nl">cp_luntar:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* CP is for target ROUTINE		*/</span>
	 <span class="nl">cp_dispri:</span><span class="mi">1</span><span class="p">,</span>	      <span class="cm">/* Grant disconnect privilege		*/</span>
       <span class="nl">cp_identify:</span><span class="mi">1</span><span class="p">;</span>	      <span class="cm">/* Always TRUE				*/</span>
    <span class="n">__u8</span> <span class="n">cp_msg1</span><span class="p">;</span>	      <span class="cm">/* Message bytes 0-3			*/</span>
    <span class="n">__u8</span> <span class="n">cp_msg2</span><span class="p">;</span>
    <span class="n">__u8</span> <span class="n">cp_msg3</span><span class="p">;</span>
    <span class="n">__u8</span> <span class="n">cp_cdb</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>	      <span class="cm">/* Command Descriptor Block		*/</span>
    <span class="n">__u32</span> <span class="n">cp_datalen</span><span class="p">;</span>	      <span class="cm">/* Data Transfer Length			*</span>
<span class="cm">			       * If scatter=1 len of sg package		*/</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">cp_viraddr</span><span class="p">;</span>	      <span class="cm">/* address of this ccb			*/</span>
    <span class="n">__u32</span> <span class="n">cp_dataDMA</span><span class="p">;</span>	      <span class="cm">/* Data Address, if scatter=1		*</span>
<span class="cm">			       * address of scatter packet		*/</span>
    <span class="n">__u32</span> <span class="n">cp_statDMA</span><span class="p">;</span>	      <span class="cm">/* address for Status Packet		*/</span> 
    <span class="n">__u32</span> <span class="n">cp_reqDMA</span><span class="p">;</span>	      <span class="cm">/* Request Sense Address, used if		*</span>
<span class="cm">			       * CP command ends with error		*/</span>
    <span class="cm">/* Additional CP info begins here */</span>
    <span class="n">__u32</span> <span class="n">timestamp</span><span class="p">;</span>	      <span class="cm">/* Needed to measure command latency	*/</span>
    <span class="n">__u32</span> <span class="n">timeout</span><span class="p">;</span>
    <span class="n">__u8</span> <span class="n">sizeindex</span><span class="p">;</span>
    <span class="n">__u8</span> <span class="n">rw_latency</span><span class="p">;</span>
    <span class="n">__u8</span> <span class="n">retries</span><span class="p">;</span>
    <span class="n">__u8</span> <span class="n">status</span><span class="p">;</span>	      <span class="cm">/* status of this queueslot		*/</span>
    <span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">cmd</span><span class="p">;</span>    <span class="cm">/* address of cmd				*/</span>
    <span class="k">struct</span> <span class="n">eata_sg_list</span> <span class="o">*</span><span class="n">sg_list</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">eata_sp</span> <span class="p">{</span>
    <span class="n">__u8</span> <span class="n">hba_stat</span><span class="o">:</span><span class="mi">7</span><span class="p">,</span>	      <span class="cm">/* HBA status				*/</span>
	      <span class="nl">EOC:</span><span class="mi">1</span><span class="p">;</span>	      <span class="cm">/* True if command finished		*/</span>
    <span class="n">__u8</span> <span class="n">scsi_stat</span><span class="p">;</span>	      <span class="cm">/* Target SCSI status			*/</span>
    <span class="n">__u8</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">__u32</span>  <span class="n">residue_len</span><span class="p">;</span>	      <span class="cm">/* Number of bytes not transferred	*/</span>
    <span class="k">struct</span> <span class="n">eata_ccb</span> <span class="o">*</span><span class="n">ccb</span><span class="p">;</span>     <span class="cm">/* Address set in COMMAND PACKET		*/</span>
    <span class="n">__u8</span> <span class="n">msg</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">hstd</span> <span class="p">{</span>
    <span class="n">__u8</span>   <span class="n">vendor</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
    <span class="n">__u8</span>   <span class="n">name</span><span class="p">[</span><span class="mi">18</span><span class="p">];</span>
    <span class="n">__u8</span>   <span class="n">revision</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
    <span class="n">__u8</span>   <span class="n">EATA_revision</span><span class="p">;</span>
    <span class="n">__u32</span>  <span class="n">firmware_revision</span><span class="p">;</span>
    <span class="n">__u8</span>   <span class="n">HBA_number</span><span class="p">;</span>
    <span class="n">__u8</span>   <span class="n">bustype</span><span class="p">;</span>		 <span class="cm">/* bustype of HBA	       */</span>
    <span class="n">__u8</span>   <span class="n">channel</span><span class="p">;</span>		 <span class="cm">/* # of avail. scsi channels  */</span>
    <span class="n">__u8</span>   <span class="n">state</span><span class="p">;</span>		 <span class="cm">/* state of HBA	       */</span>
    <span class="n">__u8</span>   <span class="n">primary</span><span class="p">;</span>		 <span class="cm">/* true if primary	       */</span>
    <span class="n">__u8</span>        <span class="n">more_support</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>  <span class="cm">/* HBA supports MORE flag     */</span>
           <span class="nl">immediate_support:</span><span class="mi">1</span><span class="p">,</span>  <span class="cm">/* HBA supports IMMEDIATE CMDs*/</span>
              <span class="nl">broken_INQUIRY:</span><span class="mi">1</span><span class="p">;</span>	 <span class="cm">/* This is an EISA HBA with   *</span>
<span class="cm">				  * broken INQUIRY	       */</span>
    <span class="n">__u8</span>   <span class="n">do_latency</span><span class="p">;</span>		 <span class="cm">/* Latency measurement flag   */</span>
    <span class="n">__u32</span>  <span class="n">reads</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>
    <span class="n">__u32</span>  <span class="n">writes</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>
    <span class="n">__u32</span>  <span class="n">reads_lat</span><span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">__u32</span>  <span class="n">writes_lat</span><span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">__u32</span>  <span class="n">all_lat</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">__u8</span>   <span class="n">resetlevel</span><span class="p">[</span><span class="n">MAXCHANNEL</span><span class="p">];</span> 
    <span class="n">__u32</span>  <span class="n">last_ccb</span><span class="p">;</span>		 <span class="cm">/* Last used ccb	       */</span>
    <span class="n">__u32</span>  <span class="n">cplen</span><span class="p">;</span>		 <span class="cm">/* size of CP in words	       */</span>
    <span class="n">__u16</span>  <span class="n">cppadlen</span><span class="p">;</span>		 <span class="cm">/* pad length of cp in words  */</span>
    <span class="n">__u16</span>  <span class="n">queuesize</span><span class="p">;</span>
    <span class="n">__u16</span>  <span class="n">sgsize</span><span class="p">;</span>               <span class="cm">/* # of entries in the SG list*/</span>
    <span class="n">__u16</span>  <span class="n">devflags</span><span class="p">;</span>		 <span class="cm">/* bits set for detected devices */</span>
    <span class="n">__u8</span>   <span class="n">hostid</span><span class="p">;</span>		 <span class="cm">/* SCSI ID of HBA	       */</span>
    <span class="n">__u8</span>   <span class="n">moresupport</span><span class="p">;</span>		 <span class="cm">/* HBA supports MORE flag     */</span>
    <span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>	    
    <span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="n">prev</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">;</span>	<span class="cm">/* PCI device or NULL for non PCI */</span>
    <span class="k">struct</span> <span class="n">eata_sp</span> <span class="n">sp</span><span class="p">;</span>		 <span class="cm">/* status packet	       */</span> 
    <span class="k">struct</span> <span class="n">eata_ccb</span> <span class="n">ccb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>	 <span class="cm">/* ccb array begins here      */</span>
<span class="p">}</span><span class="n">hostdata</span><span class="p">;</span>

<span class="cm">/* structure for max. 2 emulated drives */</span>
<span class="k">struct</span> <span class="n">drive_geom_emul</span> <span class="p">{</span>
    <span class="n">__u8</span>  <span class="n">trans</span><span class="p">;</span>		 <span class="cm">/* translation flag 1=transl */</span>
    <span class="n">__u8</span>  <span class="n">channel</span><span class="p">;</span>		 <span class="cm">/* SCSI channel number	      */</span>
    <span class="n">__u8</span>  <span class="n">HBA</span><span class="p">;</span>			 <span class="cm">/* HBA number (prim/sec)     */</span>
    <span class="n">__u8</span>  <span class="n">id</span><span class="p">;</span>			 <span class="cm">/* drive id		      */</span>
    <span class="n">__u8</span>  <span class="n">lun</span><span class="p">;</span>			 <span class="cm">/* drive lun		      */</span>
    <span class="n">__u32</span> <span class="n">heads</span><span class="p">;</span>		 <span class="cm">/* number of heads	      */</span>
    <span class="n">__u32</span> <span class="n">sectors</span><span class="p">;</span>		 <span class="cm">/* number of sectors	      */</span>
    <span class="n">__u32</span> <span class="n">cylinder</span><span class="p">;</span>		 <span class="cm">/* number of cylinders	      */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">geom_emul</span> <span class="p">{</span>
    <span class="n">__u8</span> <span class="n">bios_drives</span><span class="p">;</span>		 <span class="cm">/* number of emulated drives */</span>
    <span class="k">struct</span> <span class="n">drive_geom_emul</span> <span class="n">drv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="cm">/* drive structures	      */</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="cm">/* _EATA_GENERIC_H */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Overrides for Emacs so that we almost follow Linus&#39;s tabbing style.</span>
<span class="cm"> * Emacs will notice this stuff at the end of the file and automatically</span>
<span class="cm"> * adjust the settings for this buffer only.  This must remain at the end</span>
<span class="cm"> * of the file.</span>
<span class="cm"> * ---------------------------------------------------------------------------</span>
<span class="cm"> * Local variables:</span>
<span class="cm"> * c-indent-level: 4</span>
<span class="cm"> * c-brace-imaginary-offset: 0</span>
<span class="cm"> * c-brace-offset: -4</span>
<span class="cm"> * c-argdecl-indent: 4</span>
<span class="cm"> * c-label-offset: -4</span>
<span class="cm"> * c-continued-statement-offset: 4</span>
<span class="cm"> * c-continued-brace-offset: 0</span>
<span class="cm"> * tab-width: 8</span>
<span class="cm"> * End:</span>
<span class="cm"> */</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
