<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › ibmvscsi › ibmvfc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>ibmvfc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * ibmvfc.h -- driver for IBM Power Virtual Fibre Channel Adapter</span>
<span class="cm"> *</span>
<span class="cm"> * Written By: Brian King &lt;brking@linux.vnet.ibm.com&gt;, IBM Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) IBM Corporation, 2008</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _IBMVFC_H</span>
<span class="cp">#define _IBMVFC_H</span>

<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &quot;viosrp.h&quot;</span>

<span class="cp">#define IBMVFC_NAME	&quot;ibmvfc&quot;</span>
<span class="cp">#define IBMVFC_DRIVER_VERSION		&quot;1.0.9&quot;</span>
<span class="cp">#define IBMVFC_DRIVER_DATE		&quot;(August 5, 2010)&quot;</span>

<span class="cp">#define IBMVFC_DEFAULT_TIMEOUT	60</span>
<span class="cp">#define IBMVFC_ADISC_CANCEL_TIMEOUT	45</span>
<span class="cp">#define IBMVFC_ADISC_TIMEOUT		15</span>
<span class="cp">#define IBMVFC_ADISC_PLUS_CANCEL_TIMEOUT	\</span>
<span class="cp">		(IBMVFC_ADISC_TIMEOUT + IBMVFC_ADISC_CANCEL_TIMEOUT)</span>
<span class="cp">#define IBMVFC_INIT_TIMEOUT		120</span>
<span class="cp">#define IBMVFC_ABORT_TIMEOUT		8</span>
<span class="cp">#define IBMVFC_ABORT_WAIT_TIMEOUT	40</span>
<span class="cp">#define IBMVFC_MAX_REQUESTS_DEFAULT	100</span>

<span class="cp">#define IBMVFC_DEBUG			0</span>
<span class="cp">#define IBMVFC_MAX_TARGETS		1024</span>
<span class="cp">#define IBMVFC_MAX_LUN			0xffffffff</span>
<span class="cp">#define IBMVFC_MAX_SECTORS		0xffffu</span>
<span class="cp">#define IBMVFC_MAX_DISC_THREADS	4</span>
<span class="cp">#define IBMVFC_TGT_MEMPOOL_SZ		64</span>
<span class="cp">#define IBMVFC_MAX_CMDS_PER_LUN	64</span>
<span class="cp">#define IBMVFC_MAX_HOST_INIT_RETRIES	6</span>
<span class="cp">#define IBMVFC_MAX_TGT_INIT_RETRIES		3</span>
<span class="cp">#define IBMVFC_DEV_LOSS_TMO		(5 * 60)</span>
<span class="cp">#define IBMVFC_DEFAULT_LOG_LEVEL	2</span>
<span class="cp">#define IBMVFC_MAX_CDB_LEN		16</span>

<span class="cm">/*</span>
<span class="cm"> * Ensure we have resources for ERP and initialization:</span>
<span class="cm"> * 1 for ERP</span>
<span class="cm"> * 1 for initialization</span>
<span class="cm"> * 1 for NPIV Logout</span>
<span class="cm"> * 2 for BSG passthru</span>
<span class="cm"> * 2 for each discovery thread</span>
<span class="cm"> */</span>
<span class="cp">#define IBMVFC_NUM_INTERNAL_REQ	(1 + 1 + 1 + 2 + (disc_threads * 2))</span>

<span class="cp">#define IBMVFC_MAD_SUCCESS		0x00</span>
<span class="cp">#define IBMVFC_MAD_NOT_SUPPORTED	0xF1</span>
<span class="cp">#define IBMVFC_MAD_FAILED		0xF7</span>
<span class="cp">#define IBMVFC_MAD_DRIVER_FAILED	0xEE</span>
<span class="cp">#define IBMVFC_MAD_CRQ_ERROR		0xEF</span>

<span class="k">enum</span> <span class="n">ibmvfc_crq_valid</span> <span class="p">{</span>
	<span class="n">IBMVFC_CRQ_CMD_RSP</span>		<span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="n">IBMVFC_CRQ_INIT_RSP</span>		<span class="o">=</span> <span class="mh">0xC0</span><span class="p">,</span>
	<span class="n">IBMVFC_CRQ_XPORT_EVENT</span>		<span class="o">=</span> <span class="mh">0xFF</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_crq_format</span> <span class="p">{</span>
	<span class="n">IBMVFC_CRQ_INIT</span>			<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">IBMVFC_CRQ_INIT_COMPLETE</span>	<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">IBMVFC_PARTITION_MIGRATED</span>	<span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_cmd_status_flags</span> <span class="p">{</span>
	<span class="n">IBMVFC_FABRIC_MAPPED</span>		<span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">IBMVFC_VIOS_FAILURE</span>		<span class="o">=</span> <span class="mh">0x0002</span><span class="p">,</span>
	<span class="n">IBMVFC_FC_FAILURE</span>			<span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">IBMVFC_FC_SCSI_ERROR</span>		<span class="o">=</span> <span class="mh">0x0008</span><span class="p">,</span>
	<span class="n">IBMVFC_HW_EVENT_LOGGED</span>		<span class="o">=</span> <span class="mh">0x0010</span><span class="p">,</span>
	<span class="n">IBMVFC_VIOS_LOGGED</span>		<span class="o">=</span> <span class="mh">0x0020</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_fabric_mapped_errors</span> <span class="p">{</span>
	<span class="n">IBMVFC_UNABLE_TO_ESTABLISH</span>	<span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">IBMVFC_XPORT_FAULT</span>		<span class="o">=</span> <span class="mh">0x0002</span><span class="p">,</span>
	<span class="n">IBMVFC_CMD_TIMEOUT</span>		<span class="o">=</span> <span class="mh">0x0003</span><span class="p">,</span>
	<span class="n">IBMVFC_ENETDOWN</span>			<span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">IBMVFC_HW_FAILURE</span>			<span class="o">=</span> <span class="mh">0x0005</span><span class="p">,</span>
	<span class="n">IBMVFC_LINK_DOWN_ERR</span>		<span class="o">=</span> <span class="mh">0x0006</span><span class="p">,</span>
	<span class="n">IBMVFC_LINK_DEAD_ERR</span>		<span class="o">=</span> <span class="mh">0x0007</span><span class="p">,</span>
	<span class="n">IBMVFC_UNABLE_TO_REGISTER</span>	<span class="o">=</span> <span class="mh">0x0008</span><span class="p">,</span>
	<span class="n">IBMVFC_XPORT_BUSY</span>			<span class="o">=</span> <span class="mh">0x000A</span><span class="p">,</span>
	<span class="n">IBMVFC_XPORT_DEAD</span>			<span class="o">=</span> <span class="mh">0x000B</span><span class="p">,</span>
	<span class="n">IBMVFC_CONFIG_ERROR</span>		<span class="o">=</span> <span class="mh">0x000C</span><span class="p">,</span>
	<span class="n">IBMVFC_NAME_SERVER_FAIL</span>		<span class="o">=</span> <span class="mh">0x000D</span><span class="p">,</span>
	<span class="n">IBMVFC_LINK_HALTED</span>		<span class="o">=</span> <span class="mh">0x000E</span><span class="p">,</span>
	<span class="n">IBMVFC_XPORT_GENERAL</span>		<span class="o">=</span> <span class="mh">0x8000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_vios_errors</span> <span class="p">{</span>
	<span class="n">IBMVFC_CRQ_FAILURE</span>			<span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">IBMVFC_SW_FAILURE</span>				<span class="o">=</span> <span class="mh">0x0002</span><span class="p">,</span>
	<span class="n">IBMVFC_INVALID_PARAMETER</span>		<span class="o">=</span> <span class="mh">0x0003</span><span class="p">,</span>
	<span class="n">IBMVFC_MISSING_PARAMETER</span>		<span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_IO_BUS</span>			<span class="o">=</span> <span class="mh">0x0005</span><span class="p">,</span>
	<span class="n">IBMVFC_TRANS_CANCELLED</span>			<span class="o">=</span> <span class="mh">0x0006</span><span class="p">,</span>
	<span class="n">IBMVFC_TRANS_CANCELLED_IMPLICIT</span>	<span class="o">=</span> <span class="mh">0x0007</span><span class="p">,</span>
	<span class="n">IBMVFC_INSUFFICIENT_RESOURCE</span>		<span class="o">=</span> <span class="mh">0x0008</span><span class="p">,</span>
	<span class="n">IBMVFC_PLOGI_REQUIRED</span>			<span class="o">=</span> <span class="mh">0x0010</span><span class="p">,</span>
	<span class="n">IBMVFC_COMMAND_FAILED</span>			<span class="o">=</span> <span class="mh">0x8000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_mad_types</span> <span class="p">{</span>
	<span class="n">IBMVFC_NPIV_LOGIN</span>		<span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">IBMVFC_DISC_TARGETS</span>	<span class="o">=</span> <span class="mh">0x0002</span><span class="p">,</span>
	<span class="n">IBMVFC_PORT_LOGIN</span>		<span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">IBMVFC_PROCESS_LOGIN</span>	<span class="o">=</span> <span class="mh">0x0008</span><span class="p">,</span>
	<span class="n">IBMVFC_QUERY_TARGET</span>	<span class="o">=</span> <span class="mh">0x0010</span><span class="p">,</span>
	<span class="n">IBMVFC_IMPLICIT_LOGOUT</span>	<span class="o">=</span> <span class="mh">0x0040</span><span class="p">,</span>
	<span class="n">IBMVFC_PASSTHRU</span>		<span class="o">=</span> <span class="mh">0x0200</span><span class="p">,</span>
	<span class="n">IBMVFC_TMF_MAD</span>		<span class="o">=</span> <span class="mh">0x0100</span><span class="p">,</span>
	<span class="n">IBMVFC_NPIV_LOGOUT</span>	<span class="o">=</span> <span class="mh">0x0800</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ibmvfc_mad_common</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">version</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">opcode</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">length</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tag</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_npiv_login_mad</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_mad_common</span> <span class="n">common</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">srp_direct_buf</span> <span class="n">buffer</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_npiv_logout_mad</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_mad_common</span> <span class="n">common</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="cp">#define IBMVFC_MAX_NAME 256</span>

<span class="k">struct</span> <span class="n">ibmvfc_npiv_login</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">ostype</span><span class="p">;</span>
<span class="cp">#define IBMVFC_OS_LINUX	0x02</span>
	<span class="n">u32</span> <span class="n">pad</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">max_dma_len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">max_payload</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">max_response</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">partition_num</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">vfc_frame_version</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">fcp_version</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>
<span class="cp">#define IBMVFC_CLIENT_MIGRATED	0x01</span>
<span class="cp">#define IBMVFC_FLUSH_ON_HALT		0x02</span>
	<span class="n">u32</span> <span class="n">max_cmds</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">capabilities</span><span class="p">;</span>
<span class="cp">#define IBMVFC_CAN_MIGRATE		0x01</span>
	<span class="n">u64</span> <span class="n">node_name</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">srp_direct_buf</span> <span class="n">async</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">partition_name</span><span class="p">[</span><span class="n">IBMVFC_MAX_NAME</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">device_name</span><span class="p">[</span><span class="n">IBMVFC_MAX_NAME</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">drc_name</span><span class="p">[</span><span class="n">IBMVFC_MAX_NAME</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">reserved2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_common_svc_parms</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">fcph_version</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">b2b_credit</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">features</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">bb_rcv_sz</span><span class="p">;</span> <span class="cm">/* upper nibble is BB_SC_N */</span>
	<span class="n">u32</span> <span class="n">ratov</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">edtov</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">4</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_service_parms</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_common_svc_parms</span> <span class="n">common</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">port_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">node_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">class1_parms</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">class2_parms</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">class3_parms</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">obsolete</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">vendor_version</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">services_avail</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">ext_len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">clk_sync_qos</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">4</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_npiv_login_resp</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">version</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">error</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
<span class="cp">#define IBMVFC_NATIVE_FC		0x01</span>
<span class="cp">#define IBMVFC_CAN_FLUSH_ON_HALT	0x08</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">capabilities</span><span class="p">;</span>
<span class="cp">#define IBMVFC_CAN_FLUSH_ON_HALT	0x08</span>
	<span class="n">u32</span> <span class="n">max_cmds</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">scsi_id_sz</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">max_dma_len</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">scsi_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">port_name</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">node_name</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">link_speed</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">partition_name</span><span class="p">[</span><span class="n">IBMVFC_MAX_NAME</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">device_name</span><span class="p">[</span><span class="n">IBMVFC_MAX_NAME</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">port_loc_code</span><span class="p">[</span><span class="n">IBMVFC_MAX_NAME</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">drc_name</span><span class="p">[</span><span class="n">IBMVFC_MAX_NAME</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">ibmvfc_service_parms</span> <span class="n">service_parms</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">reserved2</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">union</span> <span class="n">ibmvfc_npiv_login_data</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_npiv_login</span> <span class="n">login</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_npiv_login_resp</span> <span class="n">resp</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_discover_targets_buf</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">scsi_id</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="cp">#define IBMVFC_DISC_TGT_SCSI_ID_MASK	0x00ffffff</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ibmvfc_discover_targets</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_mad_common</span> <span class="n">common</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">srp_direct_buf</span> <span class="n">buffer</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">error</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bufflen</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">num_avail</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">num_written</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">enum</span> <span class="n">ibmvfc_fc_reason</span> <span class="p">{</span>
	<span class="n">IBMVFC_INVALID_ELS_CMD_CODE</span>	<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">IBMVFC_INVALID_VERSION</span>		<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">IBMVFC_LOGICAL_ERROR</span>		<span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="n">IBMVFC_INVALID_CT_IU_SIZE</span>	<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">IBMVFC_LOGICAL_BUSY</span>		<span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="n">IBMVFC_PROTOCOL_ERROR</span>		<span class="o">=</span> <span class="mh">0x07</span><span class="p">,</span>
	<span class="n">IBMVFC_UNABLE_TO_PERFORM_REQ</span>	<span class="o">=</span> <span class="mh">0x09</span><span class="p">,</span>
	<span class="n">IBMVFC_CMD_NOT_SUPPORTED</span>	<span class="o">=</span> <span class="mh">0x0B</span><span class="p">,</span>
	<span class="n">IBMVFC_SERVER_NOT_AVAIL</span>		<span class="o">=</span> <span class="mh">0x0D</span><span class="p">,</span>
	<span class="n">IBMVFC_CMD_IN_PROGRESS</span>		<span class="o">=</span> <span class="mh">0x0E</span><span class="p">,</span>
	<span class="n">IBMVFC_VENDOR_SPECIFIC</span>		<span class="o">=</span> <span class="mh">0xFF</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_fc_type</span> <span class="p">{</span>
	<span class="n">IBMVFC_FABRIC_REJECT</span>	<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">IBMVFC_PORT_REJECT</span>	<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">IBMVFC_LS_REJECT</span>		<span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="n">IBMVFC_FABRIC_BUSY</span>	<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">IBMVFC_PORT_BUSY</span>		<span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="n">IBMVFC_BASIC_REJECT</span>	<span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_gs_explain</span> <span class="p">{</span>
	<span class="n">IBMVFC_PORT_NAME_NOT_REG</span>	<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ibmvfc_port_login</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_mad_common</span> <span class="n">common</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">scsi_id</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">fc_service_class</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">blksz</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">hdr_per_blk</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">error</span><span class="p">;</span>		<span class="cm">/* also fc_reason */</span>
	<span class="n">u16</span> <span class="n">fc_explain</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">fc_type</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reserved2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_service_parms</span> <span class="n">service_parms</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_service_parms</span> <span class="n">service_parms_change</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">reserved3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_prli_svc_parms</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
<span class="cp">#define IBMVFC_SCSI_FCP_TYPE		0x08</span>
	<span class="n">u8</span> <span class="n">type_ext</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>
<span class="cp">#define IBMVFC_PRLI_ORIG_PA_VALID			0x8000</span>
<span class="cp">#define IBMVFC_PRLI_RESP_PA_VALID			0x4000</span>
<span class="cp">#define IBMVFC_PRLI_EST_IMG_PAIR			0x2000</span>
	<span class="n">u32</span> <span class="n">orig_pa</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">resp_pa</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">service_parms</span><span class="p">;</span>
<span class="cp">#define IBMVFC_PRLI_TASK_RETRY			0x00000200</span>
<span class="cp">#define IBMVFC_PRLI_RETRY				0x00000100</span>
<span class="cp">#define IBMVFC_PRLI_DATA_OVERLAY			0x00000040</span>
<span class="cp">#define IBMVFC_PRLI_INITIATOR_FUNC			0x00000020</span>
<span class="cp">#define IBMVFC_PRLI_TARGET_FUNC			0x00000010</span>
<span class="cp">#define IBMVFC_PRLI_READ_FCP_XFER_RDY_DISABLED	0x00000002</span>
<span class="cp">#define IBMVFC_PRLI_WR_FCP_XFER_RDY_DISABLED	0x00000001</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">4</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_process_login</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_mad_common</span> <span class="n">common</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">scsi_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_prli_svc_parms</span> <span class="n">parms</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">48</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">error</span><span class="p">;</span>			<span class="cm">/* also fc_reason */</span>
	<span class="n">u32</span> <span class="n">reserved2</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">reserved3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_query_tgt</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_mad_common</span> <span class="n">common</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">wwpn</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">scsi_id</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">error</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">fc_explain</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">fc_type</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_implicit_logout</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_mad_common</span> <span class="n">common</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">old_scsi_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_tmf</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_mad_common</span> <span class="n">common</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">scsi_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_lun</span> <span class="n">lun</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
<span class="cp">#define IBMVFC_TMF_ABORT_TASK		0x02</span>
<span class="cp">#define IBMVFC_TMF_ABORT_TASK_SET	0x04</span>
<span class="cp">#define IBMVFC_TMF_LUN_RESET		0x10</span>
<span class="cp">#define IBMVFC_TMF_TGT_RESET		0x20</span>
<span class="cp">#define IBMVFC_TMF_LUA_VALID		0x40</span>
	<span class="n">u32</span> <span class="n">cancel_key</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">my_cancel_key</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pad</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">enum</span> <span class="n">ibmvfc_fcp_rsp_info_codes</span> <span class="p">{</span>
	<span class="n">RSP_NO_FAILURE</span>		<span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="n">RSP_TMF_REJECTED</span>		<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">RSP_TMF_FAILED</span>		<span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="n">RSP_TMF_INVALID_LUN</span>	<span class="o">=</span> <span class="mh">0x09</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ibmvfc_fcp_rsp_info</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rsp_code</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved2</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">2</span><span class="p">)));</span>

<span class="k">enum</span> <span class="n">ibmvfc_fcp_rsp_flags</span> <span class="p">{</span>
	<span class="n">FCP_BIDI_RSP</span>			<span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="n">FCP_BIDI_READ_RESID_UNDER</span>	<span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="n">FCP_BIDI_READ_RESID_OVER</span>	<span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">FCP_CONF_REQ</span>			<span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">FCP_RESID_UNDER</span>			<span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">FCP_RESID_OVER</span>			<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">FCP_SNS_LEN_VALID</span>			<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">FCP_RSP_LEN_VALID</span>			<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">ibmvfc_fcp_rsp_data</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_fcp_rsp_info</span> <span class="n">info</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sense</span><span class="p">[</span><span class="n">SCSI_SENSE_BUFFERSIZE</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ibmvfc_fcp_rsp_info</span><span class="p">)];</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_fcp_rsp</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">retry_delay_timer</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">scsi_status</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fcp_resid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fcp_sense_len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fcp_rsp_len</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ibmvfc_fcp_rsp_data</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">enum</span> <span class="n">ibmvfc_cmd_flags</span> <span class="p">{</span>
	<span class="n">IBMVFC_SCATTERLIST</span>	<span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">IBMVFC_NO_MEM_DESC</span>	<span class="o">=</span> <span class="mh">0x0002</span><span class="p">,</span>
	<span class="n">IBMVFC_READ</span>			<span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">IBMVFC_WRITE</span>		<span class="o">=</span> <span class="mh">0x0008</span><span class="p">,</span>
	<span class="n">IBMVFC_TMF</span>			<span class="o">=</span> <span class="mh">0x0080</span><span class="p">,</span>
	<span class="n">IBMVFC_CLASS_3_ERR</span>	<span class="o">=</span> <span class="mh">0x0100</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_fc_task_attr</span> <span class="p">{</span>
	<span class="n">IBMVFC_SIMPLE_TASK</span>	<span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="n">IBMVFC_HEAD_OF_QUEUE</span>	<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">IBMVFC_ORDERED_TASK</span>	<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">IBMVFC_ACA_TASK</span>		<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_fc_tmf_flags</span> <span class="p">{</span>
	<span class="n">IBMVFC_ABORT_TASK_SET</span>	<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">IBMVFC_LUN_RESET</span>		<span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">IBMVFC_TARGET_RESET</span>	<span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ibmvfc_fcp_cmd_iu</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">scsi_lun</span> <span class="n">lun</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">crn</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pri_task_attr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tmf_flags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">add_cdb_len</span><span class="p">;</span>
<span class="cp">#define IBMVFC_RDDATA		0x02</span>
<span class="cp">#define IBMVFC_WRDATA		0x01</span>
	<span class="n">u8</span> <span class="n">cdb</span><span class="p">[</span><span class="n">IBMVFC_MAX_CDB_LEN</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">xfer_len</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">4</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_cmd</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">task_tag</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">frame_type</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">payload_len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">resp_len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">adapter_resid</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">error</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">response_flags</span><span class="p">;</span>
<span class="cp">#define IBMVFC_ADAPTER_RESID_VALID	0x01</span>
	<span class="n">u32</span> <span class="n">cancel_key</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">exchange_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">srp_direct_buf</span> <span class="n">ext_func</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">srp_direct_buf</span> <span class="n">ioba</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">srp_direct_buf</span> <span class="n">resp</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">correlation</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tgt_scsi_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tag</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">reserved3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">ibmvfc_fcp_cmd_iu</span> <span class="n">iu</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_fcp_rsp</span> <span class="n">rsp</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_passthru_fc_iu</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">payload</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<span class="cp">#define IBMVFC_ADISC	0x52000000</span>
	<span class="n">u32</span> <span class="n">response</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ibmvfc_passthru_iu</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">task_tag</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cmd_len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rsp_len</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">error</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
<span class="cp">#define IBMVFC_FC_ELS		0x01</span>
<span class="cp">#define IBMVFC_FC_CT_IU		0x02</span>
	<span class="n">u32</span> <span class="n">cancel_key</span><span class="p">;</span>
<span class="cp">#define IBMVFC_PASSTHRU_CANCEL_KEY	0x80000000</span>
<span class="cp">#define IBMVFC_INTERNAL_CANCEL_KEY	0x80000001</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">srp_direct_buf</span> <span class="n">cmd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">srp_direct_buf</span> <span class="n">rsp</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">correlation</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">scsi_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tag</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">reserved2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_passthru_mad</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_mad_common</span> <span class="n">common</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">srp_direct_buf</span> <span class="n">cmd_ioba</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_passthru_iu</span> <span class="n">iu</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_passthru_fc_iu</span> <span class="n">fc_iu</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_trace_start_entry</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">xfer_len</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ibmvfc_trace_end_entry</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">error</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fcp_rsp_flags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rsp_code</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">scsi_status</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ibmvfc_trace_entry</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_event</span> <span class="o">*</span><span class="n">evt</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">time</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">scsi_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">lun</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fmt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">op_code</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tmf_flags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
<span class="cp">#define IBMVFC_TRC_START	0x00</span>
<span class="cp">#define IBMVFC_TRC_END		0xff</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">ibmvfc_trace_start_entry</span> <span class="n">start</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">ibmvfc_trace_end_entry</span> <span class="n">end</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">enum</span> <span class="n">ibmvfc_crq_formats</span> <span class="p">{</span>
	<span class="n">IBMVFC_CMD_FORMAT</span>		<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">IBMVFC_ASYNC_EVENT</span>	<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">IBMVFC_MAD_FORMAT</span>		<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_async_event</span> <span class="p">{</span>
	<span class="n">IBMVFC_AE_ELS_PLOGI</span>		<span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_ELS_LOGO</span>		<span class="o">=</span> <span class="mh">0x0002</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_ELS_PRLO</span>		<span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_SCN_NPORT</span>		<span class="o">=</span> <span class="mh">0x0008</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_SCN_GROUP</span>		<span class="o">=</span> <span class="mh">0x0010</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_SCN_DOMAIN</span>		<span class="o">=</span> <span class="mh">0x0020</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_SCN_FABRIC</span>		<span class="o">=</span> <span class="mh">0x0040</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_LINK_UP</span>			<span class="o">=</span> <span class="mh">0x0080</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_LINK_DOWN</span>		<span class="o">=</span> <span class="mh">0x0100</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_LINK_DEAD</span>		<span class="o">=</span> <span class="mh">0x0200</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_HALT</span>			<span class="o">=</span> <span class="mh">0x0400</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_RESUME</span>			<span class="o">=</span> <span class="mh">0x0800</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_ADAPTER_FAILED</span>	<span class="o">=</span> <span class="mh">0x1000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ibmvfc_async_desc</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">desc</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ibmvfc_async_event</span> <span class="n">ae</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">log_level</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ibmvfc_crq</span> <span class="p">{</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">valid</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">format</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="k">volatile</span> <span class="n">u64</span> <span class="n">ioba</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_crq_queue</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_crq</span> <span class="o">*</span><span class="n">msgs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="n">cur</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">msg_token</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_ae_link_state</span> <span class="p">{</span>
	<span class="n">IBMVFC_AE_LS_LINK_UP</span>		<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_LS_LINK_BOUNCED</span>	<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_LS_LINK_DOWN</span>		<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">IBMVFC_AE_LS_LINK_DEAD</span>		<span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ibmvfc_async_crq</span> <span class="p">{</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">link_state</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pad</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">pad2</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u64</span> <span class="n">event</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u64</span> <span class="n">scsi_id</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u64</span> <span class="n">wwpn</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u64</span> <span class="n">node_name</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">reserved</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">struct</span> <span class="n">ibmvfc_async_crq_queue</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_async_crq</span> <span class="o">*</span><span class="n">msgs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="n">cur</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">msg_token</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">ibmvfc_iu</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_mad_common</span> <span class="n">mad_common</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_npiv_login_mad</span> <span class="n">npiv_login</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_npiv_logout_mad</span> <span class="n">npiv_logout</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_discover_targets</span> <span class="n">discover_targets</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_port_login</span> <span class="n">plogi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_process_login</span> <span class="n">prli</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_query_tgt</span> <span class="n">query_tgt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_implicit_logout</span> <span class="n">implicit_logout</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_tmf</span> <span class="n">tmf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_cmd</span> <span class="n">cmd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_passthru_mad</span> <span class="n">passthru</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span> <span class="p">(</span><span class="mi">8</span><span class="p">)));</span>

<span class="k">enum</span> <span class="n">ibmvfc_target_action</span> <span class="p">{</span>
	<span class="n">IBMVFC_TGT_ACTION_NONE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IBMVFC_TGT_ACTION_INIT</span><span class="p">,</span>
	<span class="n">IBMVFC_TGT_ACTION_INIT_WAIT</span><span class="p">,</span>
	<span class="n">IBMVFC_TGT_ACTION_DEL_RPORT</span><span class="p">,</span>
	<span class="n">IBMVFC_TGT_ACTION_DELETED_RPORT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ibmvfc_target</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_host</span> <span class="o">*</span><span class="n">vhost</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">scsi_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">new_scsi_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fc_rport</span> <span class="o">*</span><span class="n">rport</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">target_id</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ibmvfc_target_action</span> <span class="n">action</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">need_login</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">add_rport</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">init_retries</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">logo_rcvd</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cancel_key</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_service_parms</span> <span class="n">service_parms</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_service_parms</span> <span class="n">service_parms_change</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fc_rport_identifiers</span> <span class="n">ids</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">job_step</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ibmvfc_target</span> <span class="o">*</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">timer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kref</span> <span class="n">kref</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* a unit of work for the hosting partition */</span>
<span class="k">struct</span> <span class="n">ibmvfc_event</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_host</span> <span class="o">*</span><span class="n">vhost</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_target</span> <span class="o">*</span><span class="n">tgt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">cmnd</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">free</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ibmvfc_iu</span> <span class="o">*</span><span class="n">xfer_iu</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">done</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ibmvfc_event</span> <span class="o">*</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ibmvfc_crq</span> <span class="n">crq</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ibmvfc_iu</span> <span class="n">iu</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ibmvfc_iu</span> <span class="o">*</span><span class="n">sync_iu</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">srp_direct_buf</span> <span class="o">*</span><span class="n">ext_list</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">ext_list_token</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">comp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="o">*</span><span class="n">eh_comp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">timer</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* a pool of event structs for use */</span>
<span class="k">struct</span> <span class="n">ibmvfc_event_pool</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ibmvfc_event</span> <span class="o">*</span><span class="n">events</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">size</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ibmvfc_iu</span> <span class="o">*</span><span class="n">iu_storage</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">iu_token</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_host_action</span> <span class="p">{</span>
	<span class="n">IBMVFC_HOST_ACTION_NONE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_RESET</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_REENABLE</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_LOGO</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_LOGO_WAIT</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_INIT</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_INIT_WAIT</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_QUERY</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_QUERY_TGTS</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_TGT_DEL</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_ALLOC_TGTS</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_TGT_INIT</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_ACTION_TGT_DEL_FAILED</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ibmvfc_host_state</span> <span class="p">{</span>
	<span class="n">IBMVFC_NO_CRQ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IBMVFC_INITIALIZING</span><span class="p">,</span>
	<span class="n">IBMVFC_ACTIVE</span><span class="p">,</span>
	<span class="n">IBMVFC_HALTED</span><span class="p">,</span>
	<span class="n">IBMVFC_LINK_DOWN</span><span class="p">,</span>
	<span class="n">IBMVFC_LINK_DEAD</span><span class="p">,</span>
	<span class="n">IBMVFC_HOST_OFFLINE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ibmvfc_host</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="n">host</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ibmvfc_host_state</span> <span class="n">state</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ibmvfc_host_action</span> <span class="n">action</span><span class="p">;</span>
<span class="cp">#define IBMVFC_NUM_TRACE_INDEX_BITS		8</span>
<span class="cp">#define IBMVFC_NUM_TRACE_ENTRIES		(1 &lt;&lt; IBMVFC_NUM_TRACE_INDEX_BITS)</span>
<span class="cp">#define IBMVFC_TRACE_SIZE	(sizeof(struct ibmvfc_trace_entry) * IBMVFC_NUM_TRACE_ENTRIES)</span>
	<span class="k">struct</span> <span class="n">ibmvfc_trace_entry</span> <span class="o">*</span><span class="n">trace</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">trace_index</span><span class="o">:</span><span class="n">IBMVFC_NUM_TRACE_INDEX_BITS</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_targets</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">targets</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sent</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">free</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_event_pool</span> <span class="n">pool</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dma_pool</span> <span class="o">*</span><span class="n">sg_pool</span><span class="p">;</span>
	<span class="n">mempool_t</span> <span class="o">*</span><span class="n">tgt_pool</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_crq_queue</span> <span class="n">crq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_async_crq_queue</span> <span class="n">async_crq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_npiv_login</span> <span class="n">login_info</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ibmvfc_npiv_login_data</span> <span class="o">*</span><span class="n">login_buf</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">login_buf_dma</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">disc_buf_sz</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">log_level</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ibmvfc_discover_targets_buf</span> <span class="o">*</span><span class="n">disc_buf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">passthru_mutex</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">task_set</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">init_retries</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">discovery_threads</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">abort_threads</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">client_migrated</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">reinit</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">delay_init</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">scan_complete</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">logged_in</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">aborting_passthru</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">events_to_log</span><span class="p">;</span>
<span class="cp">#define IBMVFC_AE_LINKUP	0x0001</span>
<span class="cp">#define IBMVFC_AE_LINKDOWN	0x0002</span>
<span class="cp">#define IBMVFC_AE_RSCN		0x0004</span>
	<span class="n">dma_addr_t</span> <span class="n">disc_buf_dma</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">partition_number</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">partition_name</span><span class="p">[</span><span class="mi">97</span><span class="p">];</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">job_step</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ibmvfc_host</span> <span class="o">*</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">work_thread</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tasklet_struct</span> <span class="n">tasklet</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">rport_add_work_q</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">init_wait_q</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">work_wait_q</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define DBG_CMD(CMD) do { if (ibmvfc_debug) CMD; } while (0)</span>

<span class="cp">#define tgt_dbg(t, fmt, ...)			\</span>
<span class="cp">	DBG_CMD(dev_info((t)-&gt;vhost-&gt;dev, &quot;%llX: &quot; fmt, (t)-&gt;scsi_id, ##__VA_ARGS__))</span>

<span class="cp">#define tgt_info(t, fmt, ...)		\</span>
<span class="cp">	dev_info((t)-&gt;vhost-&gt;dev, &quot;%llX: &quot; fmt, (t)-&gt;scsi_id, ##__VA_ARGS__)</span>

<span class="cp">#define tgt_err(t, fmt, ...)		\</span>
<span class="cp">	dev_err((t)-&gt;vhost-&gt;dev, &quot;%llX: &quot; fmt, (t)-&gt;scsi_id, ##__VA_ARGS__)</span>

<span class="cp">#define tgt_log(t, level, fmt, ...) \</span>
<span class="cp">	do { \</span>
<span class="cp">		if ((t)-&gt;vhost-&gt;log_level &gt;= level) \</span>
<span class="cp">			tgt_err(t, fmt, ##__VA_ARGS__); \</span>
<span class="cp">	} while (0)</span>

<span class="cp">#define ibmvfc_dbg(vhost, ...) \</span>
<span class="cp">	DBG_CMD(dev_info((vhost)-&gt;dev, ##__VA_ARGS__))</span>

<span class="cp">#define ibmvfc_log(vhost, level, ...) \</span>
<span class="cp">	do { \</span>
<span class="cp">		if ((vhost)-&gt;log_level &gt;= level) \</span>
<span class="cp">			dev_err((vhost)-&gt;dev, ##__VA_ARGS__); \</span>
<span class="cp">	} while (0)</span>

<span class="cp">#define ENTER DBG_CMD(printk(KERN_INFO IBMVFC_NAME&quot;: Entering %s\n&quot;, __func__))</span>
<span class="cp">#define LEAVE DBG_CMD(printk(KERN_INFO IBMVFC_NAME&quot;: Leaving %s\n&quot;, __func__))</span>

<span class="cp">#ifdef CONFIG_SCSI_IBMVFC_TRACE</span>
<span class="cp">#define ibmvfc_create_trace_file(kobj, attr) sysfs_create_bin_file(kobj, attr)</span>
<span class="cp">#define ibmvfc_remove_trace_file(kobj, attr) sysfs_remove_bin_file(kobj, attr)</span>
<span class="cp">#else</span>
<span class="cp">#define ibmvfc_create_trace_file(kobj, attr) 0</span>
<span class="cp">#define ibmvfc_remove_trace_file(kobj, attr) do { } while (0)</span>
<span class="cp">#endif</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
