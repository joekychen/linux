d | ufs |  | 5 items |  | Namjae Jeon | linkinjeon@gmail.com | 1337761779 |  | [SCSI] ufs: fix potential NULL pointer dereferencing error in ufshcd_prove.  Avoid dereferencing a NULL pointer if scsi_host_alloc is failed.  Signed-off-by: Namjae Jeon <linkinjeon@gmail.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | zalon.c | s | 5.0K | 162 | James Bottomley | James.Bottomley@HansenPartnership.com | 1245947843 |  | [SCSI] zalon: fix oops on attach failure  I recently discovered on my zalon that if the attachment fails because of a bus misconfiguration (I scrapped my HVD array, so the card is now unterminated) then the system oopses.  The reason is that if ncr_attach() returns NULL (signalling failure) that NULL is passed by the goto failed straight into ncr_detach() which oopses.  The fix is just to return -ENODEV in this case.  Cc: Stable Tree <stable@kernel.org> Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>
f | 3w-sas.h | s | 13K | 354 | adam radford | aradford@gmail.com | 1259949651 |  | [SCSI] 3w-sas: Add new driver for LSI 3ware 9750  [jejb: fix up for new queue depth code] Signed-off-by: Adam Radford <aradford@gmail.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | 53c700_d.h_shipped | g | 28K |  | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
d | bfa |  | 40 items |  | Krishna Gudipati | kgudipat@brocade.com | 1337681189 |  | [SCSI] bfa: Fix to set vport FC host sysfs entries  Made changes to set the fc_host sysfs entries supported_speeds, supported_classes etc., during the vport creation from the FC transport template.  Signed-off-by: Krishna Gudipati <kgudipat@brocade.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
d | pm8001 |  | 10 items |  | Mark Salyzyn | mark_salyzyn@xyratex.com | 1336636927 |  | [SCSI] pm8001: raise host can queue  This is a followup to a patch provided by Jack Wang on September 21 2011.  After increasing the CAN_QUEUE to 510 in pm8001 we discovered some performance degredation from time to time. We needed to increase the MPI queue to compensate and ensure we never hit that limit. We also needed to double the margin to support event and administrivial commands that take from the pool resulting in an occasional largely unproductive command completion with soft error to the caller when the command pool is overloaded temporarily.  Signed-off-by: Mark Salyzyn <mark_salyzyn@xyratex.com> Acked-by: Jack Wang <jack_wang@usish.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | initio.c | s | 81K | 2624 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | ultrastor.h | s | 2.0K | 61 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | vmw_pvscsi.c | s | 38K | 1195 | Arvind Kumar | arvindkumar@vmware.com | 1332833196 |  | [SCSI] vmw_pvscsi: Try setting host->max_id as suggested by the device.  Fetch the config page from the device to learn max target id to set host->max_id.  Also, fix some indentation issues and update the 'Maintained by' field.  Signed-off-by: Arvind Kumar <arvindkumar@vmware.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | u14-34f.c | s | 65K | 1627 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | ppa.c | s | 25K | 998 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | hptiop.h | s | 7.8K | 271 | HighPoint Linux Team | linux@highpoint-tech.com | 1254494722 |  | [SCSI] hptiop: Add RR44xx adapter support  Most code changes were made to support RR44xx adapters. - add more PCI device ID. - using PCI BAR[2] to access RR44xx IOP. - using PCI BAR[0] to check and clear RR44xx IRQ.  Signed-off-by: HighPoint Linux Team <linux@highpoint-tech.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | scsi_pm.c | s | 5.3K | 202 | Aaron Lu | aaron.lu@amd.com | 1337681390 |  | [SCSI] scsi_pm: resume device if suspend failed  For scsi devices which use scsi bus runtime callback, runtime suspend will call scsi_dev_type_suspend, and if the drv->suspend failed, the device will still be in active state. But since scsi_device_quiesce is called, the device will not be able to respond any more commands. So add a check here to see if err occured, if so, bring the device back to normal state with scsi_device_resume.  Signed-off-by: Aaron Lu <aaron.lu@amd.com> Acked-by: Alan Stern <stern@rowland.harvard.edu> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | scsi_debug.c | s | 118K | 3591 | Linus Torvalds | torvalds@linux-foundation.org | 1333225883 |  | 
f | fdomain.c | s | 55K | 1492 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | iscsi_boot_sysfs.c | s | 16K | 447 | Al Viro | viro@zeniv.linux.org.uk | 1325649295 |  | switch ->is_visible() to returning umode_t  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
d | arm |  | 18 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1332975501 |  | 
f | scsi_netlink.c | s | 15K | 570 | Linus Torvalds | torvalds@linux-foundation.org | 1326594993 |  | Merge branch 'for-linus' of git://selinuxproject.org/~jmorris/linux-security  * 'for-linus' of git://selinuxproject.org/~jmorris/linux-security:   capabilities: remove __cap_full_set definition   security: remove the security_netlink_recv hook as it is equivalent to capable()   ptrace: do not audit capability check when outputing /proc/pid/stat   capabilities: remove task_ns_* functions   capabitlies: ns_capable can use the cap helpers rather than lsm call   capabilities: style only - move capable below ns_capable   capabilites: introduce new has_ns_capabilities_noaudit   capabilities: call has_ns_capability from has_capability   capabilities: remove all _real_ interfaces   capabilities: introduce security_capable_noaudit   capabilities: reverse arguments to security_capable   capabilities: remove the task from capable LSM hook entirely   selinux: sparse fix: fix several warnings in the security server cod   selinux: sparse fix: fix warnings in netlink code   selinux: sparse fix: eliminate warnings for selinuxfs   selinux: sparse fix: declare selinux_disable() in security.h   selinux: sparse fix: move selinux_complete_init   selinux: sparse fix: make selinux_secmark_refcount static   SELinux: Fix RCU deref check warning in sel_netport_insert()  Manually fix up a semantic mis-merge wrt security_netlink_recv():   - the interface was removed in commit fd7784615248 ("security: remove    the security_netlink_recv hook as it is equivalent to capable()")   - a new user of it appeared in commit a38f7907b926 ("crypto: Add    userspace configuration API")  causing no automatic merge conflict, but Eric Paris pointed out the issue.
f | qlogicfas408.h | s | 4.5K | 94 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | t128.h | s | 4.1K | 127 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | libiscsi_tcp.c | s | 32K | 1059 | Linus Torvalds | torvalds@linux-foundation.org | 1332446129 |  | 
f | scsi_lib_dma.c | s | 1.1K | 44 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103883 |  | scsi: Add export.h for EXPORT_SYMBOL/THIS_MODULE as required  For the basic SCSI infrastructure files that are exporting symbols but not modules themselves, add in the basic export.h header file to allow the exports.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | zorro7xx.c | s | 4.5K | 152 | Geert Uytterhoeven | geert@linux-m68k.org | 1274125061 |  | m68k: amiga - Zorro bus modalias support  Add Amiga Zorro bus modalias and uevent support  Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
f | gdth_ioctl.h | s | 14K | 318 | Dave Jones | davej@redhat.com | 1263833296 |  | [SCSI] gdth: Convert to use regular kernel types.  converted using this script..   perl -p -i -e 's||ulong32||u32||g' drivers/scsi/gdth*  perl -p -i -e 's||ulong64||u64||g' drivers/scsi/gdth*  perl -p -i -e 's||ushort||u16||g' drivers/scsi/gdth*  perl -p -i -e 's||unchar||u8||g' drivers/scsi/gdth*  perl -p -i -e 's||ulong||unsigned long||g' drivers/scsi/gdth*  perl -p -i -e 's||PACKED||__attribute__((packed))||g' drivers/scsi/gdth*  sha1sum of the generated code was identical before and after.  Signed-off-by: Dave Jones <davej@redhat.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | Makefile | g | 7.6K |  | Paul Gortmaker | paul.gortmaker@windriver.com | 1337295834 |  | scsi: delete the MCA specific drivers and driver code  The support for CONFIG_MCA is being removed, since the 20 year old hardware simply isn't capable of meeting today's software demands on CPU and memory resources.  This commit removes the MCA specific SCSI drivers, and the MCA specific portions of code in dual role ISA/MCA drivers. Also, the MCA specific SCSI documentation is removed.  Cc: James Bottomley <JBottomley@parallels.com> Cc: linux-scsi@vger.kernel.org Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | storvsc_drv.c | s | 37K | 1241 | K. Y. Srinivasan | kys@microsoft.com | 1335343903 |  | [SCSI] storvsc: Properly handle errors from the host  Hyper-V cannot process some commands like ATA_12 and ATA_16. It also returns a very generic error when this happens (SRB_STATUS_ERROR).  Most of the time we treat SRB_STATUS_ERROR as DID_TARGET_FAILURE which causes error handler retry, but in the case of pass through commands, they'll never succeed (and the error handler will offline the device), so put a discriminating block in the command completion routing and send the SRB_STATUS_ERROR upwards with DID_PASSTHROUGH for commands we know should not be retried.  Signed-off-by: K. Y. Srinivasan <kys@microsoft.com> Reviewed-by: Haiyang Zhang <haiyangz@microsoft.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | scsi_proc.c | s | 11K | 419 | Randy Dunlap | randy.dunlap@oracle.com | 1306649531 |  | scsi: fix scsi_proc new kernel-doc warning  Fix kernel-doc warnings in scsi_proc.c:    Warning(drivers/scsi/scsi_proc.c:390): No description found for parameter 'dev'   Warning(drivers/scsi/scsi_proc.c:390): No description found for parameter 'data'   Warning(drivers/scsi/scsi_proc.c:390): Excess function parameter 's' description in 'always_match'   Warning(drivers/scsi/scsi_proc.c:390): Excess function parameter 'p' description in 'always_match'  Signed-off-by: Randy Dunlap <randy.dunlap@oracle.com> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | eata.c | s | 76K | 2222 | Christoph Hellwig | hch@infradead.org | 1304263360 |  | [SCSI] remove cmd->serial_number litter  Stop using cmd->serial_number in printks.  Signed-off-by: Christoph Hellwig <hch@lst.de> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | atp870u.c | s | 84K | 3672 | Linus Torvalds | torvalds@linux-foundation.org | 1333225883 |  | 
f | scsi_trace.c | s | 6.6K | 245 | Martin K. Petersen | martin.petersen@oracle.com | 1306255116 |  | [SCSI] scsi_trace: Decode UNMAP bit in WRITE SAME(10)  As of SBC3r26 WRITE SAME(10) supports the UNMAP bit.  Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com> Signed-off-by: James Bottomley <jbottomley@parallels.com>
f | libsrp.c | s | 10K | 384 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103884 |  | scsi: Fix up files implicitly depending on module.h inclusion  The module.h header was implicitly present everywhere, so files with no explicit include of the module infrastructure would build anyway.  We are now removing the implicit include, and so we need to call out the module.h file that we need explicitly.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | mvumi.h | s | 10K | 424 | Jianyun Li | jyli@marvell.com | 1314455818 |  | [SCSI] mvumi: Add Marvell UMI driver  	The Marvell Universal Message Interface (UMI) defines a messaging interface between host and Marvell products (Plato, for example). It considers situations of limited system resource and optimized system performance. 	UMI driver translates host request to message and sends message to FW via UMI, FW receives message and processes it, then sends response to UMI driver. 	FW generates an interrupt when it needs to send information or response to UMI driver  Signed-off-by: Jianyun Li <jyli@marvell.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | scsi_transport_sas.c | s | 51K | 1668 | Dan Williams | dan.j.williams@intel.com | 1330551834 |  | [SCSI] scsi_transport_sas: 'enable' phys on reset  If userspace requests a phy reset, treat that as a request for the phy to be enabled since that is the effect on hardware.  Signed-off-by: Dan Williams <dan.j.williams@intel.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | dpt_i2o.c | s | 94K | 3252 | Christoph Hellwig | hch@infradead.org | 1304263360 |  | [SCSI] remove cmd->serial_number litter  Stop using cmd->serial_number in printks.  Signed-off-by: Christoph Hellwig <hch@lst.de> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | dpti.h | s | 11K | 285 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | dmx3191d.c | s | 4.4K | 136 | Adam Buchbinder | adam.buchbinder@gmail.com | 1259966507 |  | tree-wide: fix misspelling of "definition" in comments  "Definition" is misspelled "defintion" in several comments; this patch fixes them. No code changes.  Signed-off-by: Adam Buchbinder <adam.buchbinder@gmail.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | a3000.h | s | 1.6K | 62 | Geert Uytterhoeven | geert@linux-m68k.org | 1274896267 |  | m68k/scsi: a3000 - Kill a3000_scsiregs typedef  Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
f | stex.c | s | 43K | 1560 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | esp_scsi.h | s | 21K | 481 | David S. Miller | davem@davemloft.net | 1220001190 |  | sparc: Kill SBUS DVMA layer.  This thing was completely pointless.  Just find the OF device in the parent of drivers that want to program this device, and map the DMA regs inside such drivers too.  This also moves the dummy claim_dma_lock() and release_dma_lock() implementation to floppy_32.h, which makes it handle this issue just like floppy_64.h does.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | script_asm.pl | s | 28K | 886 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
f | sd.c | s | 78K | 2558 | Alan Stern | stern@rowland.harvard.edu | 1340427931 |  | SCSI & usb-storage: add try_rc_10_first flag  Several bug reports have been received recently for USB mass-storage devices that don't handle READ CAPACITY(16) commands properly.  They report bogus sizes, in some cases becoming unusable as a result.  The bugs were triggered by commit 09b6b51b0b6c1b9bb61815baf205e4d74c89ff04 (SCSI & usb-storage: add flags for VPD pages and REPORT LUNS), which caused usb-storage to stop overriding the SCSI level reported by devices.  By default, the sd driver will try READ CAPACITY(16) first for any device whose level is above SCSI_SPC_2.  It seems likely that any device large enough to require the use of READ CAPACITY(16) (i.e., 2 TB or more) would be able to handle READ CAPACITY(10) commands properly.  Indeed, I don't know of any devices that don't handle READ CAPACITY(10) properly.  Therefore this patch (as1559) adds a new flag telling the sd driver to try READ CAPACITY(10) before READ CAPACITY(16), and sets this flag for every USB mass-storage device.  If a device really is larger than 2 TB, sd will fall back to READ CAPACITY(16) just as it used to.  This fixes Bugzilla #43391.  Signed-off-by: Alan Stern <stern@rowland.harvard.edu> Acked-by: Hans de Goede <hdegoede@redhat.com> CC: "James E.J. Bottomley" <JBottomley@parallels.com> CC: Matthew Dharm <mdharm-usb@one-eyed-alien.net> Cc: stable <stable@vger.kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | gdth.c | s | 174K | 4663 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | scsi_tgt_if.c | s | 9.1K | 321 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103883 |  | scsi: Add export.h for EXPORT_SYMBOL/THIS_MODULE as required  For the basic SCSI infrastructure files that are exporting symbols but not modules themselves, add in the basic export.h header file to allow the exports.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | 53c700.scr | s | 10K | 374 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
d | be2iscsi |  | 11 items |  | Mike Christie | michaelc@cs.wisc.edu | 1338370462 |  | [SCSI] be2iscsi: fix dma free size mismatch regression  This patch should go into 3.5 fixes. The bug was added in the patches for the 3.5 feature window.  As you can see from the patch I made a mistake. During development I switched from passing a struct to the size of the struct, but left the sizeof. This results in us allocating 4 bytes (sizeof(int)) but then calling pci_free_consistent with the size of the struct.  Signed-off-by: Mike Christie <michaelc@cs.wisc.edu> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
d | fnic |  | 34 items |  | Abhijeet Joglekar | abjoglek@cisco.com | 1309381541 |  | [SCSI] fnic: fix incorrect use of SLAB_CACHE_DMA flag  Driver was incorrectly using the SLAB_CACHE_DMA flag when creating a cache for SGLs. fnic device does not have 24-bit DMA restrictions. Remove the flag and allocations from ZONE_DMA.  Thanks to Roland Dreier and David Rientjes for pointing out the bug.  Signed-off-by: Abhijeet Joglekar <abjoglek@cisco.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | t128.c | s | 11K | 400 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | nsp32_io.h | s | 5.9K | 203 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
f | gvp11.c | s | 10K | 358 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103884 |  | scsi: Fix up files implicitly depending on module.h inclusion  The module.h header was implicitly present everywhere, so files with no explicit include of the module infrastructure would build anyway.  We are now removing the implicit include, and so we need to call out the module.h file that we need explicitly.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | tmscsim.c | s | 75K | 2272 | Christoph Hellwig | hch@infradead.org | 1304263360 |  | [SCSI] remove cmd->serial_number litter  Stop using cmd->serial_number in printks.  Signed-off-by: Christoph Hellwig <hch@lst.de> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | scsicam.c | s | 7.7K | 230 | Al Viro | viro@zeniv.linux.org.uk | 1325649247 |  | fs: move code out of buffer.c  Move invalidate_bdev, block_sync_page into fs/block_dev.c.  Export kill_bdev as well, so brd doesn't have to open code it.  Reduce buffer_head.h requirement accordingly.  Removed a rather large comment from invalidate_bdev, as it looked a bit obsolete to bother moving.  The small comment replacing it says enough.  Signed-off-by: Nick Piggin <npiggin@suse.de> Cc: Al Viro <viro@ZenIV.linux.org.uk> Cc: Christoph Hellwig <hch@lst.de> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | dtc.h | s | 2.6K | 80 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | sun3_scsi_vme.c | s | 12K | 454 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | bvme6000_scsi.c | s | 3.3K | 116 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | osst.h | s | 24K | 603 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | scsi_tgt_priv.h | s | 1.2K | 28 | Harvey Harrison | harvey.harrison@gmail.com | 1217169109 |  | [SCSI] replace __FUNCTION__ with __func__  [jejb: fixed up a ton of missed conversions.   All of you are on notice this has happened, driver trees will now  need to be rebased]  Signed-off-by: Harvey Harrison <harvey.harrison@gmail.com> Cc: SCSI List <linux-scsi@vger.kernel.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>
f | hpsa_cmd.h | s | 10K | 350 | Stephen M. Cameron | scameron@beardog.cce.hp.com | 1336637979 |  | [SCSI] hpsa: dial down lockup detection during firmware flash  Dial back the aggressiveness of the controller lockup detection thread. Currently it will declare the controller to be locked up if it goes for 10 seconds with no interrupts and no change in the heartbeat register.  Dial back this to 30 seconds with no heartbeat change, and also snoop the ioctl path and if a firmware flash command is detected, dial it back further to 4 minutes until the firmware flash command completes.  The reason for this is that during the firmware flash operation, the controller apparently doesn't update the heartbeat register as frequently as it is supposed to, and we can get a false positive.  Signed-off-by: Stephen M. Cameron <scameron@beardog.cce.hp.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
d | qla4xxx |  | 21 items |  | Vikas Chaudhary | vikas.chaudhary@qlogic.com | 1338368494 |  | [SCSI] qla4xxx: Update driver version to 5.02.00-k17  Signed-off-by: Vikas Chaudhary <vikas.chaudhary@qlogic.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | sd_dif.c | s | 12K | 395 | Cong Wang | amwang@redhat.com | 1332251299 |  | scsi: remove the second argument of k[un]map_atomic()  Signed-off-by: Cong Wang <amwang@redhat.com>
f | mvme147.c | s | 3.9K | 134 | Geert Uytterhoeven | geert@linux-m68k.org | 1274896267 |  | m68k/scsi: mvme147 - Kill obsolete HOSTS_C logic  Kill the obsolete HOSTS_C define and the related double inclusion of mvme147.h  Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
f | a4000t.c | s | 3.4K | 113 | Geert Uytterhoeven | geert@linux-m68k.org | 1274896269 |  | m68k: amiga - A4000T SCSI platform device conversion  Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
f | sgiwd93.c | s | 8.1K | 276 | Justin P. Mattock | justinmattock@gmail.com | 1302095978 |  | update David Miller's old email address  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | sr_vendor.c | s | 8.4K | 293 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | atari_scsi.h | s | 5.5K | 150 | Geert Uytterhoeven | geert@linux-m68k.org | 1335118609 |  | scsi/atari: Make more functions static  Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org> Cc: Michael Schmitz <schmitzmic@googlemail.com> Cc: James E.J. Bottomley <JBottomley@parallels.com> Cc: linux-scsi@vger.kernel.org
f | scsi_error.c | s | 59K | 1975 | Linus Torvalds | torvalds@linux-foundation.org | 1337739770 |  | Merge branch 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jikos/trivial  Pull trivial updates from Jiri Kosina:  "As usual, it's mostly typo fixes, redundant code elimination and some   documentation updates."  * 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jikos/trivial: (57 commits)   edac, mips: don't change code that has been removed in edac/mips tree   xtensa: Change mail addresses of Hannes Weiner and Oskar Schirmer   lib: Change mail address of Oskar Schirmer   net: Change mail address of Oskar Schirmer   arm/m68k: Change mail address of Sebastian Hess   i2c: Change mail address of Oskar Schirmer   net: Fix tcp_build_and_update_options comment in struct tcp_sock   atomic64_32.h: fix parameter naming mismatch   Kconfig: replace "--- help ---" with "---help---"   c2port: fix bogus Kconfig "default no"   edac: Fix spelling errors.   qla1280: Remove redundant NULL check before release_firmware() call   remoteproc: remove redundant NULL check before release_firmware()   qla2xxx: Remove redundant NULL check before release_firmware() call.   aic94xx: Get rid of redundant NULL check before release_firmware() call   tehuti: delete redundant NULL check before release_firmware()   qlogic: get rid of a redundant test for NULL before call to release_firmware()   bna: remove redundant NULL test before release_firmware()   tg3: remove redundant NULL test before release_firmware() call   typhoon: get rid of redundant conditional before all to release_firmware()   ...
f | scsi_sysfs.c | s | 28K | 952 | Vikas Chaudhary | vikas.chaudhary@qlogic.com | 1314455806 |  | [SCSI] scsi: Added support for adapter and firmware reset  Added new sysfs attr 'host_reset' in scsi_sysfs.c to perform adapter or firmware reset as suggested by Mike Christie here: http://marc.info/?l=linux-scsi&m=127359347111167&w=2  user/application can write "adapter" or "firmware" on this attr and it will call newly added function hook in scsi_host_template to call LDD adapter or firmware reset implementation.  Signed-off-by: Vikas Chaudhary <vikas.chaudhary@qlogic.com> Reviewed-by: Mike Christie <michaelc@cs.wisc.edu> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | g_NCR5380.h | s | 3.4K | 109 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | aha1740.h | s | 4.8K | 133 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
f | advansys.c | s | 374K | 11621 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | gdth_proc.c | s | 26K | 685 | Julia Lawall | julia@diku.dk | 1293810609 |  | [SCSI] gdth: Add missing call to gdth_ioctl_free  Add missing call to gdth_ioctl_free before aborting.  The semantic match that finds this problem is as follows: (http://coccinelle.lip6.fr/)  // <smpl> @@ expression buf,ha,len,addr,E; @@  buf = gdth_ioctl_alloc(ha, len, FALSE, &addr) ... when != false buf != NULL     when != true buf == NULL     when != \(E = buf\||buf = E\)     when != gdth_ioctl_free(ha, len, buf, addr) *return ...; // </smpl>  Signed-off-by: Julia Lawall <julia@diku.dk> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | scsi_transport_fc_internal.h | s | 584B | 22 | FUJITA Tomonori | tomof@acm.org | 1192214818 |  | [SCSI] fc_transport: add target driver support  This adds minimum target driver support like the srp transport does:  - fc_remote_port_{rolechg,delete} calls scsi_tgt_it_nexus_{create,destroy} for target drivers.  - add callbacks to notify target drivers of the nexus and tmf operation results to fc_function_template.  Signed-off-by: FUJITA Tomonori <fujita.tomonori@lab.ntt.co.jp> Signed-off-by: Mike Christie <michaelc@cs.wisc.edu> Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
f | aha152x.h | s | 9.9K | 294 | Boaz Harrosh | bharrosh@panasas.com | 1186236666 |  | [SCSI] aha152x: fix debug mode symbol conflict  The symbol <debug_locks> conflicts with the rather global one in include/linux/locks.h.  Signed-off-by: Randy Dunlap <randy.dunlap@oracle.com> Signed-off-by: Boaz Harrosh <bharrosh@panasas.com> Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
f | libiscsi.c | s | 90K | 3061 | Mike Christie | michaelc@cs.wisc.edu | 1329660540 |  | [SCSI] libiscsi: fix cmd timeout/completion race  If the driver/lib has called scsi_done and cleaned up internally but scsi layer has not yet called blk_mark_rq_complete when the command times out we hit a problem if the timeout code calls blk_mark_rq_complete first. When the time out code calls into the driver we were returning BLK_EH_RESET_TIMER and that causes the timeout code to just call us again later.  We need to be calling BLK_EH_HANDLED so the timeout code can complete the completion process because it had called blk_mark_rq_complete on the command and now owns its processing.  Signed-off-by: Mike Christie <michaelc@cs.wisc.edu> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | ses.c | s | 17K | 638 | Douglas Gilbert | dgilbert@interlog.com | 1309367665 |  | [SCSI] ses: requesting a fault indication  Noticed that when the sysfs interface of the SCSI SES driver was used to request a fault indication the LED flashed but the buzzer didn't sound. So it was doing what REQUEST IDENT (locate) should do.  Changelog:    - fix the setting of REQUEST FAULT for the device slot      and array device slot elements in the enclosure control      diagnostic page    - note the potentially defective code that reads the      FAULT SENSED and FAULT REQUESTED bits from the enclosure      status diagnostic page  The attached patch is against git/scsi-misc-2.6  Signed-off-by: Douglas Gilbert <dgilbert@interlog.com> Cc: stable@kernel.org Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | 3w-sas.c | s | 59K | 1604 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | jazz_esp.c | s | 5.4K | 198 | Al Viro | viro@zeniv.linux.org.uk | 1325505895 |  | misc latin1 to utf8 conversions  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
d | device_handler |  | 7 items |  | Moger, Babu | Babu.Moger@netapp.com | 1335205698 |  | [SCSI] scsi_dh_alua: Optimize the STPG command  This patch optimizes the set target port group(STPG) command. During our testing, we found that it is not optimal to send stpg command every time the path group switch happens. This patch uses PREF (preferred target port) bit with combination of flags passed by multipath user level tool to optimize this behaviour. If PREF bit is set then it issues a STPG command, otherwise it will let implicit transfer take place.  By default there is no change in the behaviour. User tool needs to pass the parameter to make this change take effect. Patch has been tested on NetApp E series storage.  Signed-off-by: Babu Moger <babu.moger@netapp.com> Reviewed-by: Hannes Reinecke <hare@suse.de> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
d | dpt |  | 6 items |  | Arun Sharma | asharma@fb.com | 1311724187 |  | atomic: use <linux/atomic.h>  This allows us to move duplicated code in <asm/atomic.h> (atomic_inc_not_zero() for now) to <linux/atomic.h>  Signed-off-by: Arun Sharma <asharma@fb.com> Reviewed-by: Eric Dumazet <eric.dumazet@gmail.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: David Miller <davem@davemloft.net> Cc: Eric Dumazet <eric.dumazet@gmail.com> Acked-by: Mike Frysinger <vapier@gentoo.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | aha1740.c | s | 19K | 617 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | in2000.h | s | 13K | 351 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
d | pcmcia |  | 13 items |  | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | scsi_devinfo.c | s | 29K | 814 | Werner Fink | werner@novell.com | 1309378127 |  | [SCSI] Blacklist Traxdata CDR4120 and IOMEGA Zip drive to avoid lock ups.  This patch resulted from the discussion at https://bugzilla.novell.com/show_bug.cgi?id=679277, https://bugzilla.novell.com/show_bug.cgi?id=681840 .  Signed-off-by: Werner Fink <werner@novell.com> Signed-off-by: Ankit Jain <jankit@suse.de> Cc: stable@kernel.org Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | a100u2w.c | s | 36K | 1070 | Jiri Kosina | jkosina@suse.cz | 1293040622 |  | Merge branch 'master' into for-next  Conflicts: 	MAINTAINERS 	arch/arm/mach-omap2/pm24xx.c 	drivers/scsi/bfa/bfa_fcpim.c  Needed to update to apply fixes for which the old branch was too outdated.
f | wd33c93.h | s | 10K | 295 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | gdth.h | s | 46K | 930 | Paul Bolle | pebolle@tiscali.nl | 1323161620 |  | treewide: Fix comment and string typo 'bufer'  Signed-off-by: Paul Bolle <pebolle@tiscali.nl> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | sr.c | s | 25K | 851 | Kay Sievers | kay.sievers@vrfy.org | 1311282958 |  | [SCSI] sr: check_events() ignore GET_EVENT when TUR says otherwise  Some broken devices indicates that media has changed on every GET_EVENT_STATUS_NOTIFICATION.  This translates into MEDIA_CHANGE uevent on every open() which lets udev run into a loop.  Verify GET_EVENT result against TUR and if it generates spurious events for several times in a row, ignore the GET_EVENT events, and trust only the TUR status.  This is the log of a USB stick with a (broken) fake CDROM drive:   scsi 5:0:0:0: Direct-Access     SanDisk  U3 Cruzer Micro  8.02 PQ: 0 ANSI: 0 CCS  sd 5:0:0:0: Attached scsi generic sg3 type 0  scsi 5:0:0:1: CD-ROM            SanDisk  U3 Cruzer Micro  8.02 PQ: 0 ANSI: 0  sd 5:0:0:0: [sdb] Attached SCSI removable disk  sr2: scsi3-mmc drive: 48x/48x tray  sr 5:0:0:1: Attached scsi CD-ROM sr2  sr 5:0:0:1: Attached scsi generic sg4 type 5  sr2: GET_EVENT and TUR disagree continuously, suppress GET_EVENT events  sd 5:0:0:0: [sdb] 31777279 512-byte logical blocks: (16.2 GB/15.1 GiB)  sd 5:0:0:0: [sdb] No Caching mode page present  sd 5:0:0:0: [sdb] Assuming drive cache: write through  sd 5:0:0:0: [sdb] No Caching mode page present  sd 5:0:0:0: [sdb] Assuming drive cache: write through  sdb: sdb1  -tj: Updated to consider only spurious GET_EVENT events among      different types of disagreement and allow using TUR for kernel      event polling after GET_EVENT is ignored.  Reported-By: Markus Rathgeb maggu2810@googlemail.com Signed-off-by: Kay Sievers <kay.sievers@vrfy.org> Signed-off-by: Tejun Heo <tj@kernel.org> Cc: stable@kernel.org	# >= v2.6.38, fixes udev busy looping w/ certain devices Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | ips.h | s | 41K | 1155 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | aha1542.h | s | 4.7K | 132 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
d | aic7xxx |  | 43 items |  | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1333148595 |  | Documentation: remove references to /etc/modprobe.conf  Usage of /etc/modprobe.conf file was deprecated by module-init-tools and is no longer parsed by new kmod tool. References to this file are replaced in Documentation, comments and Kconfig according to the context.  There are also some references to the old /etc/modules.conf from 2.4 kernels that are being removed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi> Acked-by: Takashi Iwai <tiwai@suse.de> Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Randy Dunlap <rdunlap@xenotime.net> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | qla1280.h | s | 34K | 987 | Michael Reed | mdr@sgi.com | 1242858073 |  | [SCSI] qla1280: error recovery rewrite  The driver now waits for the scsi commands associated with a particular error recovery step to be returned to the mid-layer, and returns the appropriate SUCCESS or FAILED status.  Removes unneeded polling of chip for interrupts.  This patch also bumps the driver version number.  Signed-off-by: Michael Reed <mdr@sgi.com> Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>
f | dtc.c | s | 13K | 427 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | st_options.h | s | 3.9K | 79 | Kai Makisara | Kai.Makisara@kolumbus.fi | 1207588539 |  | [SCSI] st: add option to use SILI in variable block reads  Add new option MT_ST_SILI to enable setting the SILI bit in reads in variable block mode. If SILI is set, reading a block shorter than the byte count does not result in CHECK CONDITION. The length of the block is determined using the residual count from the HBA. Avoiding the REQUEST SENSE command for every block speeds up some real applications considerably.  Signed-off-by: Kai Makisara <kai.makisara@kolumbus.fi> Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>
f | esp_scsi.c | s | 64K | 2276 | Joe Perches | joe@perches.com | 1333670980 |  | scsi: Use vsprintf extention %pf with builtin_return_address  Emit the function name not the address when possible.  builtin_return_address() gives an address.  When building a kernel with CONFIG_KALLSYMS, emit the actual function name not the address.  Signed-off-by: Joe Perches <joe@perches.com> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | ch.c | s | 24K | 896 | Linus Torvalds | torvalds@linux-foundation.org | 1287769976 |  | Merge branch 'llseek' of git://git.kernel.org/pub/scm/linux/kernel/git/arnd/bkl  * 'llseek' of git://git.kernel.org/pub/scm/linux/kernel/git/arnd/bkl:   vfs: make no_llseek the default   vfs: don't use BKL in default_llseek   llseek: automatically add .llseek fop   libfs: use generic_file_llseek for simple_attr   mac80211: disallow seeks in minstrel debug code   lirc: make chardev nonseekable   viotape: use noop_llseek   raw: use explicit llseek file operations   ibmasmfs: use generic_file_llseek   spufs: use llseek in all file operations   arm/omap: use generic_file_llseek in iommu_debug   lkdtm: use generic_file_llseek in debugfs   net/wireless: use generic_file_llseek in debugfs   drm: use noop_llseek
f | qlogicfas.c | s | 5.6K | 191 | James Bottomley | James.Bottomley@HansenPartnership.com | 1201720442 |  | [SCSI] remove use_sg_chaining  With the sg table code, every SCSI driver is now either chain capable or broken (or has sg_tablesize set so chaining is never activated), so there's no need to have a check in the host template.  Also tidy up the code by moving the scatterlist size defines into the SCSI includes and permit the last entry of the scatterlist pools not to be a power of two. Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>
f | tmscsim.h | s | 13K | 459 | Boaz Harrosh | bharrosh@panasas.com | 1184457393 |  | [SCSI] tmscsim: Further clean-up of the driver   - The saved sg_count was a leftover from the time the driver was doing    dma mapping by himself. But now that scsi-ml is called for the mapping    it is not the drivers responsibility.  Signed-off-by: Boaz Harrosh <bharrosh@panasas.com> Acked-by: G. Liakhovetski <g.liakhovetski@gmx.de> Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
f | scsi_transport_spi.c | s | 43K | 1380 | Mike Maslenkin | mihailm@parallels.com | 1336637172 |  | [SCSI] scsi_transport_spi: fix for unbalanced reference counting  Check the domain validation flag on the given device before referencing scsi_device instance, otherwise if the flag is already set we return without decrementing the reference count.  Signed-off-by: Mike Maslenkin <mihailm@parallels.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | g_NCR5380.c | s | 25K | 853 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | ps3rom.c | s | 11K | 377 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103884 |  | scsi: Fix up files implicitly depending on module.h inclusion  The module.h header was implicitly present everywhere, so files with no explicit include of the module infrastructure would build anyway.  We are now removing the implicit include, and so we need to call out the module.h file that we need explicitly.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | atp870u.h | s | 1.5K | 59 | James Bottomley | jejb@titanic.(none) | 1126792776 |  | [SCSI] atp870u: fix memory addressing bug  From: Alan Cox <alan@redhat.com>  The virt_to_bus() wasn't correctly taken out of this driver.  It needs to be able to track both physical and virtual addresses for its prd table. Update the driver to do this with separate tracking entries.  Signed-off-by: Alan Cox <alan@redhat.com> Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
d | mvsas |  | 11 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1332446129 |  | 
f | scsi_transport_iscsi.c | s | 83K | 2613 | Mike Christie | michaelc@cs.wisc.edu | 1332833196 |  | [SCSI] iscsi class: fix gfp use in ping compl and host event  If a ping or host event were to occur when memory is low we do not want to use GFP_KERNEL, because the paths sending them cannot block for data to be written. These paths might be needed to recover write paths. Use GFP_NOIO instead.  Signed-off-by: Mike Christie <michaelc@cs.wisc.edu> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | st.h | s | 6.1K | 197 | David Jeffery | dhjeffery@gmail.com | 1336635154 |  | [SCSI] st: fix memory leak with >1MB tape I/O  There is a memory leak in the st driver when sending large enough reads or writes using st's direct I/O path.  As part of mapping the application's memory, a buffer to hold page pointers is allocated and the count of mapped pages is stored in field do_dio.  A non-zero do_dio marks that direct I/O is in use.  But do_dio is only 1 byte in size.  Mapping 256 4k pages overflows do_dio and causes it to be set to 0, like direct I/O option was not used.  When the I/O completes, the buffer to hold the page pointers is not freed, and the page counts of the mapped pages are not reduced. Every I/O of this size then leaks memory.  The size of do_dio needs to be increased to prevent it wrapping around.  Signed-off-by: David Jeffery <djeffery@redhat.com> Acked-by: Kai Mkisara <kai.makisara@kolumbus.fi> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | ncr53c8xx.h | s | 39K | 1135 | Matthew Wilcox | matthew@wil.cx | 1192215078 |  | [SCSI] ncr53c8xx: Call scsi_host_put in release  Since ncr53c8xx_attach() calls scsi_host_put(), make ncr53c8xx_release() call scsi_host_put() too, for symmetry.  Both callers already expect it to put the host for them, so that works out nicely.  While the zalon driver does 'use' the host pointer afterwards, it only compares it for equality and doesn't dereference it, so that's safe.  While I'm at it, get rid of pointless checks for NULL, use shost_priv() and change ncr53c8xx_release to return void.  Signed-off-by: Matthew Wilcox <matthew@wil.cx> Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
f | aha1542.c | s | 47K | 1447 | Paul Gortmaker | paul.gortmaker@windriver.com | 1337295834 |  | scsi: delete the MCA specific drivers and driver code  The support for CONFIG_MCA is being removed, since the 20 year old hardware simply isn't capable of meeting today's software demands on CPU and memory resources.  This commit removes the MCA specific SCSI drivers, and the MCA specific portions of code in dual role ISA/MCA drivers. Also, the MCA specific SCSI documentation is removed.  Cc: James Bottomley <JBottomley@parallels.com> Cc: linux-scsi@vger.kernel.org Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | pmcraid.h | s | 36K | 937 | Masanari Iida | standby24x7@gmail.com | 1329820837 |  | scsi: Fix typo in pmcraid.h  Correct spelling "thresold" to "threshold" in drivers/scsi/pmraid.h  Signed-off-by: Masanari Iida <standby24x7@gmail.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | mac53c94.c | s | 15K | 502 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | NCR53c406a.c | s | 28K | 936 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
d | sym53c8xx_2 |  | 15 items |  | Stratos Psomadakis | psomas@gentoo.org | 1326236478 |  | [SCSI] sym53c8xx: Fix NULL pointer dereference in slave_destroy  sym53c8xx_slave_destroy unconditionally assumes that sym53c8xx_slave_alloc has succesesfully allocated a sym_lcb. This can lead to a NULL pointer dereference (exposed by commit 4e6c82b).  Signed-off-by: Stratos Psomadakis <psomas@gentoo.org> Cc: stable@vger.kernel.org Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | vmw_pvscsi.h | s | 13K | 398 | Arvind Kumar | arvindkumar@vmware.com | 1332833196 |  | [SCSI] vmw_pvscsi: Try setting host->max_id as suggested by the device.  Fetch the config page from the device to learn max target id to set host->max_id.  Also, fix some indentation issues and update the 'Maintained by' field.  Signed-off-by: Arvind Kumar <arvindkumar@vmware.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | FlashPoint.c | s | 195K | 5944 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | qlogicpti.h | s | 18K | 458 | Grant Likely | grant.likely@secretlab.ca | 1281108350 |  | of/device: Replace struct of_device with struct platform_device  of_device is just an alias for platform_device, so remove it entirely.  Also replace to_of_device() with to_platform_device() and update comment blocks.  This patch was initially generated from the following semantic patch, and then edited by hand to pick up the bits that coccinelle didn't catch.  @@ @@ -struct of_device +struct platform_device  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Reviewed-by: David S. Miller <davem@davemloft.net>
d | bnx2fc |  | 11 items |  | Robert Love | robert.w.love@intel.com | 1337762593 |  | [SCSI] fcoe, bnx2fc, libfcoe: SW FCoE and bnx2fc use FCoE Syfs  This patch has the SW FCoE driver and the bnx2fc driver make use of the new fcoe_sysfs API added earlier in this patch series.  After this patch a fcoe_ctlr_device is allocated with private data in this order.  +------------------+   +------------------+ || fcoe_ctlr_device ||   || fcoe_ctlr_device || +------------------+   +------------------+ || fcoe_ctlr        ||   || fcoe_ctlr        || +------------------+   +------------------+ || fcoe_interface   ||   || bnx2fc_interface || +------------------+   +------------------+  libfcoe also takes part in this new model since it discovers and manages fcoe_fcf instances. The memory allocation is different for FCFs. I didn't want to impact libfcoe's fcoe_fcf processing, so this patch creates fcoe_fcf_device instances for each discovered fcoe_fcf. The two are paired using a (void * priv) member of the fcoe_ctlr_device. This allows libfcoe to continue maintaining its list of fcoe_fcf instances and simply attaches and detaches them from existing or new fcoe_fcf_device instances.  Signed-off-by: Robert Love <robert.w.love@intel.com> Tested-by: Ross Brattain <ross.b.brattain@intel.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | iscsi_tcp.c | s | 27K | 868 | Pavel Emelyanov | xemul@parallels.com | 1335037945 |  | sock: Introduce named constants for sk_reuse  Name them in a "backward compatible" manner, i.e. reuse or not are still 1 and 0 respectively. The reuse value of 2 means that the socket with it will forcibly reuse everyone else's port.  Signed-off-by: Pavel Emelyanov <xemul@openvz.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | BusLogic.c | s | 147K | 3401 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | scsi_transport_srp_internal.h | s | 590B | 22 | FUJITA Tomonori | tomof@acm.org | 1192214289 |  | [SCSI] scsi_transport_srp: remove tgt dependencies  it's better to remove tgt dependencies in srp transport class since most people want only initiator support.  Signed-off-by: FUJITA Tomonori <fujita.tomonori@lab.ntt.co.jp> Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
d | cxgbi |  | 6 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1332446129 |  | 
f | scsi_priv.h | s | 5.8K | 153 | Dan Williams | dan.j.williams@intel.com | 1337242246 |  | [SCSI] sd: limit the scope of the async probe domain  sd injects and synchronizes probe work on the global kernel-wide domain. This runs into conflict with PM that wants to perform resume actions in async context:  [  494.237079] INFO: task kworker/u:3:554 blocked for more than 120 seconds. [  494.294396] "echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message. [  494.360809] kworker/u:3     D 0000000000000000     0   554      2 0x00000000 [  494.420739]  ffff88012e4d3af0 0000000000000046 ffff88013200c160 ffff88012e4d3fd8 [  494.484392]  ffff88012e4d3fd8 0000000000012500 ffff8801394ea0b0 ffff88013200c160 [  494.548038]  ffff88012e4d3ae0 00000000000001e3 ffffffff81a249e0 ffff8801321c5398 [  494.611685] Call Trace: [  494.632649]  [<ffffffff8149dd25>] schedule+0x5a/0x5c [  494.674687]  [<ffffffff8104b968>] async_synchronize_cookie_domain+0xb6/0x112 [  494.734177]  [<ffffffff810461ff>] ? __init_waitqueue_head+0x50/0x50 [  494.787134]  [<ffffffff8131a224>] ? scsi_remove_target+0x48/0x48 [  494.837900]  [<ffffffff8104b9d9>] async_synchronize_cookie+0x15/0x17 [  494.891567]  [<ffffffff8104ba49>] async_synchronize_full+0x54/0x70  <-- here we wait for async contexts to complete [  494.943783]  [<ffffffff8104b9f5>] ? async_synchronize_full_domain+0x1a/0x1a [  495.002547]  [<ffffffffa00114b1>] sd_remove+0x2c/0xa2 [sd_mod] [  495.051861]  [<ffffffff812fe94f>] __device_release_driver+0x86/0xcf [  495.104807]  [<ffffffff812fe9bd>] device_release_driver+0x25/0x32  <-- here we take device_lock()  [  853.511341] INFO: task kworker/u:4:549 blocked for more than 120 seconds. [  853.568693] "echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message. [  853.635119] kworker/u:4     D ffff88013097b5d0     0   549      2 0x00000000 [  853.695129]  ffff880132773c40 0000000000000046 ffff880130790000 ffff880132773fd8 [  853.758990]  ffff880132773fd8 0000000000012500 ffff88013288a0b0 ffff880130790000 [  853.822796]  0000000000000246 0000000000000040 ffff88013097b5c8 ffff880130790000 [  853.886633] Call Trace: [  853.907631]  [<ffffffff8149dd25>] schedule+0x5a/0x5c [  853.949670]  [<ffffffff8149cc44>] __mutex_lock_common+0x220/0x351 [  854.001225]  [<ffffffff81304bd7>] ? device_resume+0x58/0x1c4 [  854.049082]  [<ffffffff81304bd7>] ? device_resume+0x58/0x1c4 [  854.097011]  [<ffffffff8149ce48>] mutex_lock_nested+0x2f/0x36   <-- here we wait for device_lock() [  854.145591]  [<ffffffff81304bd7>] device_resume+0x58/0x1c4 [  854.192066]  [<ffffffff81304d61>] async_resume+0x1e/0x45 [  854.237019]  [<ffffffff8104bc93>] async_run_entry_fn+0xc6/0x173  <-- ...while running in async context  Provide a 'scsi_sd_probe_domain' so that async probe actions actions can be flushed without regard for the state of PM, and allow for the resume path to handle devices that have transitioned from SDEV_QUIESCE to SDEV_DEL prior to resume.  Acked-by: Alan Stern <stern@rowland.harvard.edu> [alan: uplevel scsi_sd_probe_domain, clarify scsi_device_resume] Signed-off-by: Dan Williams <dan.j.williams@intel.com> [jejb: remove unneeded config guards in include file] Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | sym53c416.c | s | 25K | 757 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | mvme147.h | s | 465B | 18 | Geert Uytterhoeven | geert@linux-m68k.org | 1272830103 |  | [SCSI] mvme147: Reindentation  Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | ipr.c | s | 258K | 8116 | Dan Williams | dan.j.williams@intel.com | 1335179507 |  | [SCSI] libsas, libata: fix start of life for a sas ata_port  This changes the ordering of initialization and probing events from:   1/ allocate rphy in PORTE_BYTES_DMAED, DISCE_REVALIDATE_DOMAIN   2/ allocate ata_port and schedule port probe in DISCE_PROBE ...to:   1/ allocate ata_port in PORTE_BYTES_DMAED, DISCE_REVALIDATE_DOMAIN   2/ allocate rphy in PORTE_BYTES_DMAED, DISCE_REVALIDATE_DOMAIN   3/ schedule port probe in DISCE_PROBE  This ordering prevents PHYE_SIGNAL_LOSS_EVENTS from sneaking in to destrory ata devices before they have been fully initialized:    BUG: unable to handle kernel paging request at 0000000000003b10   IP: [<ffffffffa0053d7e>] sas_ata_end_eh+0x12/0x5e [libsas]   ...   [<ffffffffa004d1af>] sas_unregister_common_dev+0x78/0xc9 [libsas]   [<ffffffffa004d4d4>] sas_unregister_dev+0x4f/0xad [libsas]   [<ffffffffa004d5b1>] sas_unregister_domain_devices+0x7f/0xbf [libsas]   [<ffffffffa004c487>] sas_deform_port+0x61/0x1b8 [libsas]   [<ffffffffa004bed0>] sas_phye_loss_of_signal+0x29/0x2b [libsas]  ...and kills the awkward "sata domain_device briefly existing in the domain without an ata_port" state.  Reported-by: Michal Kosciowski <michal.kosciowski@intel.com> Signed-off-by: Dan Williams <dan.j.williams@intel.com> Acked-by: Jeff Garzik <jgarzik@redhat.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | nsp32.c | s | 89K | 2917 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | ultrastor.c | s | 36K | 1045 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | mvumi.c | s | 51K | 1739 | Jianyun Li | jyli@marvell.com | 1314455818 |  | [SCSI] mvumi: Add Marvell UMI driver  	The Marvell Universal Message Interface (UMI) defines a messaging interface between host and Marvell products (Plato, for example). It considers situations of limited system resource and optimized system performance. 	UMI driver translates host request to message and sends message to FW via UMI, FW receives message and processes it, then sends response to UMI driver. 	FW generates an interrupt when it needs to send information or response to UMI driver  Signed-off-by: Jianyun Li <jyli@marvell.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | qlogicpti.c | s | 40K | 1282 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | scsi_sas_internal.h | s | 1.5K | 36 | James Bottomley | James.Bottomley@suse.de | 1265670919 |  | [SCSI] scsi_transport_sas: add support for transport layer retries (TLR)  The mpt2sas driver wants to use transport layer retries (TLR) so the simplest thing to do seems to be to add the enabling flags and checks to the SAS transport class, since they're a SAS specific protocol feature.  Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | g_NCR5380_mmio.c | s | 232B | 7 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
f | mac_scsi.h | s | 1.6K | 64 | Jeff Garzik  | jgarzik@pobox.com | 1119027885 |  | [SCSI] Remove no-op implementations of SCSI EH hooks  Drivers need not implement a hook that returns FAILED, and does nothing else, since the SCSI midlayer code will do that for us.  Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
d | qla2xxx |  | 29 items |  | Sachin Kamat | sachin.kamat@linaro.org | 1339561550 |  | qla2xxx: Remove version.h header file inclusion  version.h header file is no longer required for qla_target code.  Signed-off-by: Sachin Kamat <sachin.kamat@linaro.org> Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>
d | aic94xx |  | 20 items |  | Jesper Juhl | jj@chaosbits.net | 1335784978 |  | aic94xx: Get rid of redundant NULL check before release_firmware() call  release_firmware() checks for NULL pointers internally, so checking before calling the function is redundant.  Signed-off-by: Jesper Juhl <jj@chaosbits.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | osst.c | s | 182K | 5453 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | NCR5380.h | s | 13K | 375 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | 53c700.c | s | 69K | 1916 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | sni_53c710.c | s | 3.9K | 130 | Al Viro | viro@zeniv.linux.org.uk | 1325505895 |  | misc latin1 to utf8 conversions  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | nsp32_debug.c | s | 7.3K | 239 | Justin P. Mattock | justinmattock@gmail.com | 1305015381 |  | treewide: fix a few typos in comments  - kenrel -> kernel - whetehr -> whether - ttt -> tt - sss -> ss  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | scsi.h | s | 1.1K | 42 | Dave Jones | davej@redhat.com | 1156019951 |  | [SCSI] remove unnecessary includes of linux/config.h from drivers/scsi/  kbuild includes this automatically these days.  Signed-off-by: Dave Jones <davej@redhat.com> Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
d | aacraid |  | 14 items |  | Tomas Henzl | thenzl@redhat.com | 1335205704 |  | [SCSI] aacraid: add an iounmap call to aac_src_ioremap  The patch 116046127d1a3bad2853d02781ad9fee33f05e5a "[SCSI] aacraid: Added Sync.mode to support series 7/8/9 controllers" removed an iounmap call from aac_src_ioremap. Before that, the iounmap has been called twice with the same value (dev->base and dev->regs.src.bar0) and the iounmap complained about it (iounmap: bad address ...).  The proper solution is a change the paremeter from bar0 to bar1. Fix this by adding a an iounmap(dev->regs.src.bar1) call.  Signed-off-by: Tomas Henzl <thenzl@redhat.com> Acked-by: Achim Leubner <achim_leubner@pmc-sierra.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | sd.h | s | 4.3K | 156 | Martin K. Petersen | martin.petersen@oracle.com | 1329668092 |  | [SCSI] Handle disk devices which can not process medium access commands  We have experienced several devices which fail in a fashion we do not currently handle gracefully in SCSI. After a failure these devices will respond to the SCSI primary command set (INQUIRY, TEST UNIT READY, etc.) but any command accessing the storage medium will time out.  The following patch adds an callback that can be used by upper level drivers to inspect the results of an error handling command. This in turn has been used to implement additional checking in the SCSI disk driver.  If a medium access command fails twice but TEST UNIT READY succeeds both times in the subsequent error handling we will offline the device. The maximum number of failed commands required to take a device offline can be tweaked in sysfs.  Also add a new error flag to scsi_debug which allows this scenario to be easily reproduced.  [jejb: fix up integer parsing to use kstrtouint] Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | aha152x.c | s | 99K | 3367 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | a100u2w.h | s | 16K | 328 | Alan Cox | alan@lxorguk.ukuu.org.uk | 1182114569 |  | [SCSI] a100u2w: Convert into Linux style  I was investigating strange driver behaviour and thought that readable code and proper visible types might help explain why it didn't work right the moment a second SCB was outstanding to the controller. I was right  - Cleanup, linuxise, demacro - Remove the BSD dual licence on the new work - Switch the if ALPHA to if __LP64__. (struct size is then right elsewhere) and then to CONFIG_64BIT as per Christoph's request - Fix the recursive locking on a reset. This is the only actual real code change (I hope ;)).  I'm not clear what the right way to handle the BIOS param stuff is on n on x86-32/64. Using phys_to_virt and stuff is ugly and probably doesn't make sense elsewhere  Still has a couple of odd things - and there seems to be a commonly shared EEPROM handling error several drivers have. Roughly speaking several SCSI drivers go  	try and read EEPROM 	It failed.. 	Write any changes between the default and the data we read  	Which is great as for some paths we've no idea what was in before, so each boot won't write it all back, won't checksum but will repeat the bug  Also it can still sleep for a second with IRQ off, and there is some dubious looking error path locking marked FIXME in case anyone feels inspired to work on it. Not a newly introduced bug, and at least its now marked.  Signed-off-by: Alan Cox <alan@redhat.com> Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
f | mac_esp.c | s | 15K | 528 | Finn Thain | fthain@telegraphics.com.au | 1327240203 |  | mac_esp: rename irq  Rename the "Mac ESP" irq as "ESP" to be consistent with all the other Mac drivers and ESP drivers.  Signed-off-by: Finn Thain <fthain@telegraphics.com.au> Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
f | scsi_tgt_lib.c | s | 16K | 555 | Kirill A. Shutemov | kirill@shutemov.name | 1304263210 |  | [SCSI] esp, scsi_tgt_lib, fcoe: use list_move() instead of list_del()/list_add() combination  Signed-off-by: Kirill A. Shutemov <kirill@shutemov.name> Signed-off-by: Robert Love <robert.w.love@intel.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | lasi700.c | s | 4.7K | 159 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | NCR_Q720.h | s | 597B | 19 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
f | megaraid.c | s | 113K | 4034 | Cong Wang | amwang@redhat.com | 1332251299 |  | scsi: remove the second argument of k[un]map_atomic()  Signed-off-by: Cong Wang <amwang@redhat.com>
f | eata_pio.c | s | 27K | 844 | Christoph Hellwig | hch@infradead.org | 1304263360 |  | [SCSI] remove cmd->serial_number litter  Stop using cmd->serial_number in printks.  Signed-off-by: Christoph Hellwig <hch@lst.de> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | sun_esp.c | s | 14K | 540 | Grant Likely | grant.likely@secretlab.ca | 1298882199 |  | dt/sparc: Eliminate users of of_platform_{,un}register_driver  Get rid of old users of of_platform_driver in arch/sparc.  Most of_platform_driver users can be converted to use the platform_bus directly.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | dc395x.h | s | 25K | 588 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
d | fcoe |  | 7 items |  | Robert Love | robert.w.love@intel.com | 1337762593 |  | [SCSI] fcoe, bnx2fc, libfcoe: SW FCoE and bnx2fc use FCoE Syfs  This patch has the SW FCoE driver and the bnx2fc driver make use of the new fcoe_sysfs API added earlier in this patch series.  After this patch a fcoe_ctlr_device is allocated with private data in this order.  +------------------+   +------------------+ || fcoe_ctlr_device ||   || fcoe_ctlr_device || +------------------+   +------------------+ || fcoe_ctlr        ||   || fcoe_ctlr        || +------------------+   +------------------+ || fcoe_interface   ||   || bnx2fc_interface || +------------------+   +------------------+  libfcoe also takes part in this new model since it discovers and manages fcoe_fcf instances. The memory allocation is different for FCFs. I didn't want to impact libfcoe's fcoe_fcf processing, so this patch creates fcoe_fcf_device instances for each discovered fcoe_fcf. The two are paired using a (void * priv) member of the fcoe_ctlr_device. This allows libfcoe to continue maintaining its list of fcoe_fcf instances and simply attaches and detaches them from existing or new fcoe_fcf_device instances.  Signed-off-by: Robert Love <robert.w.love@intel.com> Tested-by: Ross Brattain <ross.b.brattain@intel.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | ncr53c8xx.c | s | 210K | 7650 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | pas16.c | s | 17K | 556 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | imm.h | s | 4.9K | 128 | Dave Jones | davej@redhat.com | 1159947534 |  | Remove all inclusions of <linux/config.h> kbuild explicitly includes this at build time.  Signed-off-by: Dave Jones <davej@redhat.com>
d | mpt2sas |  | 11 items |  | nagalakshmi.nandigama@lsi.com | nagalakshmi.nandigama@lsi.com | 1338953936 |  | [SCSI] mpt2sas: Fix unsafe using smp_processor_id() in preemptible  When CONFIG_DEBUG_PREEMPT is enabled, bug is observed in the smp_processor_id(). This is because smp_processor_id() is not called in preempt safe condition.  To fix this issue, use raw_smp_processor_id instead of smp_processor_id.  Signed-off-by: Nagalakshmi Nandigama <nagalakshmi.nandigama@lsi.com> CC: stable@vger.kernel.org Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | ips.c | s | 235K | 6067 | Cong Wang | amwang@redhat.com | 1332251299 |  | scsi: remove the second argument of k[un]map_atomic()  Signed-off-by: Cong Wang <amwang@redhat.com>
f | scsi_transport_fc.c | s | 121K | 3572 | Mike Christie | michaelc@cs.wisc.edu | 1336636763 |  | [SCSI] fc class: fix scanning when devs are offline  When a rport is added back or the role is changed the fc class will queue a scan and then call scsi_target_unblock. The problem with this is if the devices are in the SDEV_OFFLINE state and the scan is run before the scsi_target_unblock, then the scan will see LUN0 as offline and the scan will fail. This patch moves the unblock call to before the scan, so we know the device state will be set correctly when the scan is run.  Signed-off-by: Mike Christie <michaelc@cs.wisc.edu> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | imm.c | s | 28K | 1133 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | sun3_scsi.c | s | 14K | 511 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
d | aic7xxx_old |  | 8 items |  | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | wd33c93.c | s | 65K | 1959 | Linus Torvalds | torvalds@linux-foundation.org | 1306441140 |  | Merge branch 'trivial' of git://git.kernel.org/pub/scm/linux/kernel/git/mmarek/kbuild-2.6  * 'trivial' of git://git.kernel.org/pub/scm/linux/kernel/git/mmarek/kbuild-2.6:   gfs2: Drop __TIME__ usage   isdn/diva: Drop __TIME__ usage   atm: Drop __TIME__ usage   dlm: Drop __TIME__ usage   wan/pc300: Drop __TIME__ usage   parport: Drop __TIME__ usage   hdlcdrv: Drop __TIME__ usage   baycom: Drop __TIME__ usage   pmcraid: Drop __DATE__ usage   edac: Drop __DATE__ usage   rio: Drop __DATE__ usage   scsi/wd33c93: Drop __TIME__ usage   scsi/in2000: Drop __TIME__ usage   aacraid: Drop __TIME__ usage   media/cx231xx: Drop __TIME__ usage   media/radio-maxiradio: Drop __TIME__ usage   nozomi: Drop __TIME__ usage   cyclades: Drop __TIME__ usage
f | gvp11.h | s | 1.2K | 44 | Geert Uytterhoeven | geert@linux-m68k.org | 1274896268 |  | m68k: amiga - GVP Series II SCSI zorro_driver conversion  Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
d | bnx2i |  | 9 items |  | Eddie Wai | eddie.wai@broadcom.com | 1336637058 |  | [SCSI] bnx2i: Updated version and copyright year  Old version: 2.7.0.3 New version: 2.7.2.2  Signed-off-by: Eddie Wai <eddie.wai@broadcom.com> Reviewed-by: Mike Christie <michaelc@cs.wisc.edu> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | mac_scsi.c | s | 14K | 490 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | constants.c | s | 50K | 1284 | Linus Torvalds | torvalds@linux-foundation.org | 1306167146 |  | Merge branch 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jikos/trivial  * 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jikos/trivial: (39 commits)   b43: fix comment typo reqest -> request   Haavard Skinnemoen has left Atmel   cris: typo in mach-fs Makefile   Kconfig: fix copy/paste-ism for dell-wmi-aio driver   doc: timers-howto: fix a typo ("unsgined")   perf: Only include annotate.h once in tools/perf/util/ui/browsers/annotate.c   md, raid5: Fix spelling error in comment ('Ofcourse' --> 'Of course').   treewide: fix a few typos in comments   regulator: change debug statement be consistent with the style of the rest   Revert "arm: mach-u300/gpio: Fix mem_region resource size miscalculations"   audit: acquire creds selectively to reduce atomic op overhead   rtlwifi: don't touch with treewide double semicolon removal   treewide: cleanup continuations and remove logging message whitespace   ath9k_hw: don't touch with treewide double semicolon removal   include/linux/leds-regulator.h: fix syntax in example code   tty: fix typo in descripton of tty_termios_encode_baud_rate   xtensa: remove obsolete BKL kernel option from defconfig   m68k: fix comment typo 'occcured'   arch:Kconfig.locks Remove unused config option.   treewide: remove extra semicolons   ...
f | 3w-9xxx.c | s | 76K | 2005 | James Bottomley | JBottomley@Parallels.com | 1317047338 |  | [SCSI] 3w-9xxx: fix iommu_iova leak  Following reports on the list, it looks like the 3e-9xxx driver will leak dma mappings every time we get a transient queueing error back from the card. This is because it maps the sg list in the routine that sends the command, but doesn't unmap again in the transient failure path (even though the command is sent back to the block layer).  Fix by unmapping before returning the status.  Reported-by: Chris Boot <bootc@bootc.net> Tested-by: Chris Boot <bootc@bootc.net> Acked-by: Adam Radford <aradford@gmail.com> Cc: stable@kernel.org Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | scsi_lib.c | s | 65K | 2276 | Jun'ichi Nomura | j-nomura@ce.jp.nec.com | 1337762057 |  | [SCSI] Fix dm-multipath starvation when scsi host is busy  block congestion control doesn't have any concept of fairness across multiple queues.  This means that if SCSI reports the host as busy in the queue congestion control it can result in an unfair starvation situation in dm-mp if there are multiple multipath devices on the same host.  For example: http://www.redhat.com/archives/dm-devel/2012-May/msg00123.html  The fix for this is to report only the sdev busy state (and ignore the host busy state) in the block congestion control call back. The host is still congested, but the SCSI subsystem will sort out the congestion in a fair way because it knows the relation between the queues and the host.  [jejb: fixed up trailing whitespace] Reported-by: Bernd Schubert <bernd.schubert@itwm.fraunhofer.de> Tested-by: Bernd Schubert <bernd.schubert@itwm.fraunhofer.de> Signed-off-by: Jun'ichi Nomura <j-nomura@ce.jp.nec.com> Cc: <stable@vger.kernel.org> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | ipr.h | s | 48K | 1625 | Brian King | brking@linux.vnet.ibm.com | 1332943768 |  | [SCSI] ipr: Driver version 2.5.3  Signed-off-by: Brian King <brking@linux.vnet.ibm.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | NCR_Q720.c | s | 9.2K | 311 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | scsi_module.c | s | 1.6K | 59 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
d | arcmsr |  | 4 items |  | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | megaraid.h | s | 28K | 882 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | mvme16x_scsi.c | s | 3.7K | 135 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | fdomain.h | s | 1.1K | 23 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
f | hpsa.h | s | 11K | 368 | Stephen M. Cameron | scameron@beardog.cce.hp.com | 1336637979 |  | [SCSI] hpsa: dial down lockup detection during firmware flash  Dial back the aggressiveness of the controller lockup detection thread. Currently it will declare the controller to be locked up if it goes for 10 seconds with no interrupts and no change in the heartbeat register.  Dial back this to 30 seconds with no heartbeat change, and also snoop the ioctl path and if a firmware flash command is detected, dial it back further to 4 minutes until the firmware flash command completes.  The reason for this is that during the firmware flash operation, the controller apparently doesn't update the heartbeat register as frequently as it is supposed to, and we can get a false positive.  Signed-off-by: Stephen M. Cameron <scameron@beardog.cce.hp.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | hosts.c | s | 13K | 502 | James Bottomley | jbottomley@parallels.com | 1336634653 |  | [SCSI] fix oops in all legacy host adapters caused by 6f381fa  Commit 6f381fa344911d5a234b13574433cf23036f9467 Author: Lin Ming <ming.m.lin@intel.com>  [SCSI] scsi_lib: use correct DMA device in __scsi_alloc_queue  Caused a regression where we oops in every legacy mode SCSI host driver because they supply a NULL pointer to scsi_add_host().  Fix this by checking for the NULL in scsi_add_host_with_dma() and changing the DMA device to being the platform_bus in that case (which replicates the original behaviour).  Reported-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | NCR5380.c | s | 91K | 2541 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | atari_NCR5380.c | s | 90K | 2672 | Geert Uytterhoeven | geert@linux-m68k.org | 1309378281 |  | [SCSI] atari_NCR5380: Provide a dummy NCR5380_exit()  and call it from atari_scsi_release(), cfr. the other NCR5380 drivers.  This fixes:  drivers/scsi/NCR5380.h:303: warning: NCR5380_exit declared static but never defined  Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
d | libfc |  | 11 items |  | James Bottomley | JBottomley@Parallels.com | 1337599050 |  | 
f | sun3_NCR5380.c | s | 91K | 2626 | Geert Uytterhoeven | geert@linux-m68k.org | 1309378505 |  | [SCSI] sun3: Remove commented out merge_contiguous_buffers  This fixes:  drivers/scsi/sun3_NCR5380.c:475: warning: merge_contiguous_buffers defined but not used  Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org> Cc: Sam Creasey <sammy@sammy.net> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
d | osd |  | 5 items |  | Boaz Harrosh | bharrosh@panasas.com | 1330179909 |  | [SCSI] osd_uld: Bump MAX_OSD_DEVICES from 64 to 1,048,576  It used to be that minors where 8 bit. But now they are actually 20 bit. So the fix is simplicity itself.  I've tested with 300 devices and all user-mode utils work just fine. I have also mechanically added 10,000 to the ida (so devices are /dev/osd10000, /dev/osd10001 ...) and was able to mkfs an exofs filesystem and access osds from user-mode.  All the open-osd user-mode code uses the same library to access devices through their symbolic names in /dev/osdX so I'd say it's pretty safe. (Well tested)  This patch is very important because some of the systems that will be deploying the 3.2 pnfs-objects code are larger than 64 OSDs and will stop to work properly when reaching that number.  CC: Stable <stable@vger.kernel.org> Signed-off-by: Boaz Harrosh <bharrosh@panasas.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | mac53c94.h | s | 4.9K | 192 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
f | Kconfig | g | 65K |  | Linus Torvalds | torvalds@linux-foundation.org | 1337818326 |  | Merge branch 'delete-mca' of git://git.kernel.org/pub/scm/linux/kernel/git/paulg/linux  Pull the MCA deletion branch from Paul Gortmaker:  "It was good that we could support MCA machines back in the day, but   realistically, nobody is using them anymore.  They were mostly limited   to 386-sx 16MHz CPU and some 486 class machines and never more than   64MB of RAM.  Even the enthusiast hobbyist community seems to have   dried up close to ten years ago, based on what you can find searching   various websites dedicated to the relatively short lived hardware.    So lets remove the support relating to CONFIG_MCA.  There is no point   carrying this forward, wasting cycles doing routine maintenance on it;   wasting allyesconfig build time on validating it, wasting I/O on git   grep'ping over it, and so on."  Let's see if anybody screams.  It generally has compiled, and James Bottomley pointed out that there was a MCA extension from NCR that allowed for up to 4GB of memory and PPro-class machines.  So in *theory* there may be users out there.  But even James (technically listed as a maintainer) doesn't actually have a system, and while Alan Cox claims to have a machine in his cellar that he offered to anybody who wants to take it off his hands, he didn't argue for keeping MCA support either.  So we could bring it back.  But somebody had better speak up and talk about how they have actually been using said MCA hardware with modern kernels for us to do that.  And David already took the patch to delete all the networking driver code (commit a5e371f61ad3: "drivers/net: delete all code/drivers depending on CONFIG_MCA").  * 'delete-mca' of git://git.kernel.org/pub/scm/linux/kernel/git/paulg/linux:   MCA: delete all remaining traces of microchannel bus support.   scsi: delete the MCA specific drivers and driver code   serial: delete the MCA specific 8250 support.   arm: remove ability to select CONFIG_MCA
f | scsi.c | s | 37K | 1204 | James Bottomley | JBottomley@Parallels.com | 1339031780 |  | [SCSI] Fix sd_probe_domain config problem  With CONFIG_BLK_DEV_SD = n and CONFIG_PM = n, you get this compile failure:  (.text+0x4f6c77): undefined reference to `scsi_sd_probe_domain'  This was introduced by  commit a7a20d103994fd760766e6c9d494daa569cbfe06 Author: Dan Williams <dan.j.williams@intel.com> Date:   Thu Mar 22 17:05:11 2012 -0700      [SCSI] sd: limit the scope of the async probe domain  And happens because scsi_sd_probe_domain is conditionally defined but unconditionally used.  Fix this by making the symbol unconditionally defined.  Reported-by: Randy Dunlap <rdunlap@xenotime.net> Cc: Dan Williams <dan.j.williams@intel.com> Tested-by: Randy Dunlap <rdunlap@xenotime.net> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | nsp32.h | s | 21K | 521 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | NCR_D700.h | s | 801B | 22 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
f | st.c | s | 125K | 4043 | Linus Torvalds | torvalds@linux-foundation.org | 1333225883 |  | 
f | a3000.c | s | 7.2K | 244 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103884 |  | scsi: Fix up files implicitly depending on module.h inclusion  The module.h header was implicitly present everywhere, so files with no explicit include of the module infrastructure would build anyway.  We are now removing the implicit include, and so we need to call out the module.h file that we need explicitly.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | 3w-9xxx.h | s | 25K | 638 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | scsi_transport_api.h | s | 145B | 4 | Tejun Heo | htejun@gmail.com | 1148099948 |  | [PATCH] SCSI: make scsi_implement_eh() generic API for SCSI transports  libata implemented a feature to schedule EH without an associated EH by manipulating shost->host_eh_scheduled in ata_scsi_schedule_eh() directly.  Move this function to scsi_error.c and rename it to scsi_schedule_eh().  It is now an exported API for SCSI transports and exported via new header file drivers/scsi/scsi_transport_api.h  This patch also de-export scsi_eh_wakeup() which was exported specifically for ata_scsi_schedule_eh().  Signed-off-by: Tejun Heo <htejun@gmail.com> Signed-off-by: Jeff Garzik <jeff@garzik.org>
f | pmcraid.c | s | 168K | 5299 | Jesper Juhl | jj@chaosbits.net | 1323963338 |  | SCSI, pmcraid: Fix spelling error in a pmcraid_err() call  There's a mistake in one of the pmcraid_err() calls in drivers/scsi/pmcraid.c - 'failed' is misspelled as 'faile'. This patch fixes that error.  PS. This patch is generated on top of my previous one "[PATCH] SCSI, pmcraid: Fix kmalloc() argument order in pmcraid_chr_ioctl()".  Signed-off-by: Jesper Juhl <jj@chaosbits.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | dc395x.c | s | 141K | 4301 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | sim710.c | s | 6.5K | 218 | Paul Gortmaker | paul.gortmaker@windriver.com | 1337295834 |  | scsi: delete the MCA specific drivers and driver code  The support for CONFIG_MCA is being removed, since the 20 year old hardware simply isn't capable of meeting today's software demands on CPU and memory resources.  This commit removes the MCA specific SCSI drivers, and the MCA specific portions of code in dual role ISA/MCA drivers. Also, the MCA specific SCSI documentation is removed.  Cc: James Bottomley <JBottomley@parallels.com> Cc: linux-scsi@vger.kernel.org Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | eata_generic.h | s | 14K | 348 | Richard Knutsson | ricknu-0@student.ltu.se | 1174408023 |  | [SCSI] eata_pio: Remove FALSE/TRUE defines  eata_generic.h is only included by eata_pio.c and it only uses FALSE/TRUE in comments.  Signed-off-by: Richard Knutsson <ricknu-0@student.ltu.se> Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
f | iscsi_tcp.h | s | 1.9K | 56 | Mike Christie | michaelc@cs.wisc.edu | 1298569270 |  | [SCSI] iscsi_tcp: use iscsi_conn_get_addr_param libiscsi function  This has iscsi_tcp use the iscsi_conn_get_addr_param libiscsi function. It also drops the use of the libiscsi session portal buffers, so they can be removed in the next patches. Instead of copying the values at bind time we get them during get() time. If we are not connected userspace will now get -ENOTCONN, so it knows that connection is disconnected instead of a possible stale value.  Signed-off-by: Mike Christie <michaelc@cs.wisc.edu> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | 3w-xxxx.h | s | 16K | 390 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | qlogicfas408.c | s | 14K | 526 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | scsi_logging.h | s | 3.5K | 73 | Jrn Engel | joern@wohnheim.fh-wedel.de | 1151688336 |  | Remove obsolete #include <linux/config.h>  Signed-off-by: Jrn Engel <joern@wohnheim.fh-wedel.de> Signed-off-by: Adrian Bunk <bunk@stusta.de>
f | mesh.c | s | 52K | 1881 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | sr_ioctl.c | s | 15K | 511 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103884 |  | scsi: Fix up files implicitly depending on module.h inclusion  The module.h header was implicitly present everywhere, so files with no explicit include of the module infrastructure would build anyway.  We are now removing the implicit include, and so we need to call out the module.h file that we need explicitly.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | a2091.h | s | 1.5K | 59 | Geert Uytterhoeven | geert@linux-m68k.org | 1274896267 |  | m68k/scsi: a2091 - Kill a2091_scsiregs typedef  Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org>
f | NCR_D700.c | s | 10K | 353 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
d | isci |  | 30 items |  | Jeff Skirvin | jeffrey.d.skirvin@intel.com | 1337290424 |  | isci: End the RNC resumption wait when the RNC is destroyed.  While the RNC is suspended for I/O cleanup, the remote device can be stopped and the RNC setup for destruction.  These changes accomodate that case in the abort path.  Signed-off-by: Jeff Skirvin <jeffrey.d.skirvin@intel.com> Signed-off-by: Dan Williams <dan.j.williams@intel.com>
f | hpsa.c | s | 143K | 4561 | Stephen M. Cameron | scameron@beardog.cce.hp.com | 1336637979 |  | [SCSI] hpsa: dial down lockup detection during firmware flash  Dial back the aggressiveness of the controller lockup detection thread. Currently it will declare the controller to be locked up if it goes for 10 seconds with no interrupts and no change in the heartbeat register.  Dial back this to 30 seconds with no heartbeat change, and also snoop the ioctl path and if a firmware flash command is detected, dial it back further to 4 minutes until the firmware flash command completes.  The reason for this is that during the firmware flash operation, the controller apparently doesn't update the heartbeat register as frequently as it is supposed to, and we can get a false positive.  Signed-off-by: Stephen M. Cameron <scameron@beardog.cce.hp.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | a2091.c | s | 6.5K | 227 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103884 |  | scsi: Fix up files implicitly depending on module.h inclusion  The module.h header was implicitly present everywhere, so files with no explicit include of the module infrastructure would build anyway.  We are now removing the implicit include, and so we need to call out the module.h file that we need explicitly.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | BusLogic.h | s | 39K | 1125 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | sg.c | s | 69K | 2350 | Jrn Engel | joern@logfs.org | 1337245737 |  | [SCSI] sg: constify sg_proc_leaf_arr  Signed-off-by: Joern Engel <joern@logfs.org> Acked-by: Douglas Gilbert <dgilbert@interlog.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | aic7xxx_old.c | s | 357K | 10403 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | scsi_wait_scan.c | s | 1.0K | 37 | James Bottomley | jbottomley@parallels.com | 1338371197 |  | [SCSI] fix scsi_wait_scan  Commit  c751085943362143f84346d274e0011419c84202 Author: Rafael J. Wysocki <rjw@sisk.pl> Date:   Sun Apr 12 20:06:56 2009 +0200      PM/Hibernate: Wait for SCSI devices scan to complete during resume  Broke the scsi_wait_scan module in 2.6.30.  Apparently debian still uses it so fix it and backport to stable before removing it in 3.6.  The breakage is caused because the function template in include/scsi/scsi_scan.h is defined to be a nop unless SCSI is built in. That means that in the modular case (which is every distro), the scsi_wait_scan module does a simple async_synchronize_full() instead of waiting for scans.  Cc: <stable@vger.kernel.org> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | mesh.h | s | 3.9K | 115 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
d | libsas |  | 15 items |  | Dan Williams | dan.j.williams@intel.com | 1335179753 |  | [SCSI] Revert "[SCSI] libsas: fix sas port naming"  This reverts commit a692b0eec5efae382dfa800e8b4b083f172921a7.  Tom reports:  [    8.741033] ------------[ cut here ]------------ [    8.741038] WARNING: at fs/sysfs/dir.c:508 sysfs_add_one+0xc1/0xf0() [    8.741040] Hardware name: To Be Filled By O.E.M. [    8.741041] sysfs: cannot create duplicate filename  ...and missing 2 out of 4 drives connected to mvsas.  Commit a692b0ee made the assumption that all the phy ids an lldd registers to libsas are unique.  However, in the "multi-chip" case mvsas does a rather annoying duplication of phy ids in the array passed to libsas.  So, for example, chip0 has phy0-3 at ha phy index 0-3 and chip1 has its phy0-3 at ha phy index 4-7.  The more natural model would be to create a scsi_host (and sas_ha) per chip (controller), but for now revert the naming fix which unfortunately means dealing with unpredictable end-device names for a bit longer.  Cc: Xiangliang Yu <yuxiangl@marvell.com> Cc: Patrick Thomson <patrick.s.thomson@intel.com> Reported-by: Tom Rini <trini@ti.com> Tested-by: Tom Rini <trini@ti.com> Signed-off-by: Dan Williams <dan.j.williams@intel.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | qla1280.c | s | 125K | 3868 | Jesper Juhl | jj@chaosbits.net | 1335785143 |  | qla1280: Remove redundant NULL check before release_firmware() call  release_firmware() checks for NULL pointers internally so checking before calling the function is redundant.  Signed-off-by: Jesper Juhl <jj@chaosbits.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
d | ibmvscsi |  | 8 items |  | Benjamin Herrenschmidt | benh@kernel.crashing.org | 1332894804 |  | powerpc+sparc/vio: Modernize driver registration  This makes vio_register_driver() get the module owner & name at compile time like PCI drivers do, and adds a name pointer directly in struct vio_driver to avoid having to explicitly initialize the embedded struct device.  Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Acked-by: David S. Miller <davem@davemloft.net>
f | scsi_typedefs.h | s | 37B | 1 | Christoph Hellwig | hch@lst.de | 1149974680 |  | [SCSI] remove scsi_request infrastructure  With Achim patch the last user (gdth) is switched away from scsi_request so we an kill it now.  Also disables some code in i2o_scsi that was broken since the sg driver stopped using scsi_requests.  Signed-off-by: Christoph Hellwig <hch@lst.de> Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
f | scsi_scan.c | s | 54K | 1723 | Dan Williams | dan.j.williams@intel.com | 1338370627 |  | [SCSI] fix async probe regression  Commit a7a20d1 "[SCSI] sd: limit the scope of the async probe domain" moved sd probe work out of reach of wait_for_device_probe().  Allow it to be synced via scsi_complete_async_scans().  Reported-by: Meelis Roos <mroos@linux.ee> Tested-by: Meelis Roos <mroos@linux.ee> Signed-off-by: Dan Williams <dan.j.williams@intel.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | 3w-xxxx.c | s | 83K | 2094 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | sun3_scsi.h | s | 9.7K | 335 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | osst_options.h | s | 4.1K | 80 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
d | megaraid |  | 14 items |  | adam radford | aradford@gmail.com | 1335205601 |  | [SCSI] megaraid_sas: Version and Changelog update  The following patch for megaraid_sas updates the driver version to v00.00.06.15-rc1, and updates Documentation/scsi/ChangeLog.megaraid_sas.  Signed-off-by: Adam Radford <aradford@gmail.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | in2000.c | s | 71K | 1948 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | hptiop.c | s | 34K | 1067 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | 53c700.h | s | 16K | 476 | Kars de Jong | jongk@linux-m68k.org | 1182114956 |  | [SCSI] 53c700: m68k support for the 53c700 SCSI core  Add m68k support to the 53c700 SCSI driver  Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org> Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>
f | atari_scsi.c | s | 34K | 960 | Geert Uytterhoeven | geert@linux-m68k.org | 1335118609 |  | scsi/atari: Make more functions static  Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org> Cc: Michael Schmitz <schmitzmic@googlemail.com> Cc: James E.J. Bottomley <JBottomley@parallels.com> Cc: linux-scsi@vger.kernel.org
f | initio.h | s | 29K | 583 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | sym53c416.h | s | 1.1K | 29 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | pas16.h | s | 4.6K | 138 | Jeff Garzik | jeff@garzik.org | 1289943203 |  | SCSI host lock push-down  Move the mid-layer's ->queuecommand() invocation from being locked with the host lock to being unlocked to facilitate speeding up the critical path for drivers who don't need this lock taken anyway.  The patch below presents a simple SCSI host lock push-down as an equivalent transformation.  No locking or other behavior should change with this patch.  All existing bugs and locking orders are preserved.  Additionally, add one parameter to queuecommand, 	struct Scsi_Host * and remove one parameter from queuecommand, 	void (*done)(struct scsi_cmnd *)  Scsi_Host* is a convenient pointer that most host drivers need anyway, and 'done' is redundant to struct scsi_cmnd->scsi_done.  Minimal code disturbance was attempted with this change.  Most drivers needed only two one-line modifications for their host lock push-down.  Signed-off-by: Jeff Garzik <jgarzik@redhat.com> Acked-by: James Bottomley <James.Bottomley@suse.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | raid_class.c | s | 7.7K | 261 | James Bottomley | James.Bottomley@suse.de | 1267631226 |  | [SCSI] raid_attrs: fix dependency problems  RAID attributes uses scsi_is_sdev_device() to gate some SCSI specific checking code.  This causes two problems.  Firstly if SCSI == n just defining scsi_is_sdev_device() to return false might not be enough to prevent gcc from emitting the code (and thus referring to undefined symbols), so this needs surrounding with an ifdef.  Secondly, using scsi_is_sdev_device() when SCSI is either y or m gives a subtle problem in the m case: raid_attrs must also be m to use the symbol. Do the usual Kconfig jiggery-pokery to fix this.  Reported-by: Randy Dunlap <randy.dunlap@oracle.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | scsi_ioctl.c | s | 9.1K | 297 | Mike Christie | michaelc@cs.wisc.edu | 1259949693 |  | [SCSI] add scsi target reset support to scsi ioctl  The scsi ioctl code path was missing scsi target reset support. This patch just adds it.  Signed-off-by: Mike Christie <michaelc@cs.wisc.edu> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | gdth_proc.h | s | 900B | 18 | Dave Jones | davej@redhat.com | 1263833296 |  | [SCSI] gdth: Convert to use regular kernel types.  converted using this script..   perl -p -i -e 's||ulong32||u32||g' drivers/scsi/gdth*  perl -p -i -e 's||ulong64||u64||g' drivers/scsi/gdth*  perl -p -i -e 's||ushort||u16||g' drivers/scsi/gdth*  perl -p -i -e 's||unchar||u8||g' drivers/scsi/gdth*  perl -p -i -e 's||ulong||unsigned long||g' drivers/scsi/gdth*  perl -p -i -e 's||PACKED||__attribute__((packed))||g' drivers/scsi/gdth*  sha1sum of the generated code was identical before and after.  Signed-off-by: Dave Jones <davej@redhat.com> Signed-off-by: James Bottomley <James.Bottomley@suse.de>
f | eata_pio.h | s | 2.1K | 45 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
d | lpfc |  | 29 items |  | James Smart | james.smart@emulex.com | 1337249910 |  | [SCSI] lpfc 8.3.31: Update lpfc to version 8.3.31  Signed-off-by: Alex Iannicelli <alex.iannicelli@emulex.com> Signed-off-by: James Smart <james.smart@emulex.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | sr.h | s | 2.5K | 63 | Kay Sievers | kay.sievers@vrfy.org | 1311282958 |  | [SCSI] sr: check_events() ignore GET_EVENT when TUR says otherwise  Some broken devices indicates that media has changed on every GET_EVENT_STATUS_NOTIFICATION.  This translates into MEDIA_CHANGE uevent on every open() which lets udev run into a loop.  Verify GET_EVENT result against TUR and if it generates spurious events for several times in a row, ignore the GET_EVENT events, and trust only the TUR status.  This is the log of a USB stick with a (broken) fake CDROM drive:   scsi 5:0:0:0: Direct-Access     SanDisk  U3 Cruzer Micro  8.02 PQ: 0 ANSI: 0 CCS  sd 5:0:0:0: Attached scsi generic sg3 type 0  scsi 5:0:0:1: CD-ROM            SanDisk  U3 Cruzer Micro  8.02 PQ: 0 ANSI: 0  sd 5:0:0:0: [sdb] Attached SCSI removable disk  sr2: scsi3-mmc drive: 48x/48x tray  sr 5:0:0:1: Attached scsi CD-ROM sr2  sr 5:0:0:1: Attached scsi generic sg4 type 5  sr2: GET_EVENT and TUR disagree continuously, suppress GET_EVENT events  sd 5:0:0:0: [sdb] 31777279 512-byte logical blocks: (16.2 GB/15.1 GiB)  sd 5:0:0:0: [sdb] No Caching mode page present  sd 5:0:0:0: [sdb] Assuming drive cache: write through  sd 5:0:0:0: [sdb] No Caching mode page present  sd 5:0:0:0: [sdb] Assuming drive cache: write through  sdb: sdb1  -tj: Updated to consider only spurious GET_EVENT events among      different types of disagreement and allow using TUR for kernel      event polling after GET_EVENT is ignored.  Reported-By: Markus Rathgeb maggu2810@googlemail.com Signed-off-by: Kay Sievers <kay.sievers@vrfy.org> Signed-off-by: Tejun Heo <tj@kernel.org> Cc: stable@kernel.org	# >= v2.6.38, fixes udev busy looping w/ certain devices Signed-off-by: James Bottomley <JBottomley@Parallels.com>
f | ppa.h | s | 5.0K | 136 | Dave Jones | davej@redhat.com | 1159947534 |  | Remove all inclusions of <linux/config.h> kbuild explicitly includes this at build time.  Signed-off-by: Dave Jones <davej@redhat.com>
f | osst_detect.h | s | 232B | 6 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
f | wd7000.c | s | 50K | 1438 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | scsi_sysctl.c | s | 946B | 42 | Eric W. Biederman | ebiederm@xmission.com | 1258562260 |  | sysctl: Drop & in front of every proc_handler.  For consistency drop & in front of every proc_handler.  Explicity taking the address is unnecessary and it prevents optimizations like stubbing the proc_handlers to NULL.  Cc: Alexey Dobriyan <adobriyan@gmail.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: Joe Perches <joe@perches.com> Signed-off-by: Eric W. Biederman <ebiederm@xmission.com>
f | sun3x_esp.c | s | 7.2K | 261 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | scsi_transport_srp.c | s | 10K | 314 | Kay Sievers | kay.sievers@vrfy.org | 1230913336 |  | [SCSI] struct device - replace bus_id with dev_name(), dev_set_name()  [jejb: limit ioctl to returning 20 characters to avoid overrun        on long device names and add a few more conversions] Signed-off-by: Kay Sievers <kay.sievers@vrfy.org> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de> Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>
f | virtio_scsi.c | s | 14K | 500 | Paolo Bonzini | pbonzini@redhat.com | 1336634826 |  | [SCSI] virtio_scsi: fix TMF use-after-free  Fix a use-after-free in the TMF path, where cmd may have been already freed by virtscsi_complete_free when wait_for_completion restarts executing virtscsi_tmf.  Technically a race, but in practice the command will always be freed long before the completion waiter is awoken.  The fix is to make callers specifying a completion responsible for freeing the command in all cases.  Signed-off-by: Hu Tao <hutao@cn.fujitsu.com> Signed-off-by: Paolo Bonzini <pbonzini@redhat.com> Signed-off-by: James Bottomley <JBottomley@Parallels.com>
