<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › dtc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>dtc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * DTC controller, taken from T128 driver by...</span>
<span class="cm"> * Copyright 1993, Drew Eckhardt</span>
<span class="cm"> *	Visionary Computing</span>
<span class="cm"> *	(Unix and Linux consulting and custom programming)</span>
<span class="cm"> *	drew@colorado.edu</span>
<span class="cm"> *      +1 (303) 440-4894</span>
<span class="cm"> *</span>
<span class="cm"> * DISTRIBUTION RELEASE 2. </span>
<span class="cm"> *</span>
<span class="cm"> * For more information, please consult </span>
<span class="cm"> *</span>
<span class="cm"> * </span>
<span class="cm"> * </span>
<span class="cm"> * and </span>
<span class="cm"> *</span>
<span class="cm"> * NCR 5380 Family</span>
<span class="cm"> * SCSI Protocol Controller</span>
<span class="cm"> * Databook</span>
<span class="cm"> *</span>
<span class="cm"> * NCR Microelectronics</span>
<span class="cm"> * 1635 Aeroplaza Drive</span>
<span class="cm"> * Colorado Springs, CO 80916</span>
<span class="cm"> * 1+ (719) 578-3400</span>
<span class="cm"> * 1+ (800) 334-5454</span>
<span class="cm"> */</span>

<span class="cp">#ifndef DTC3280_H</span>
<span class="cp">#define DTC3280_H</span>

<span class="cp">#define DTCDEBUG 0</span>
<span class="cp">#define DTCDEBUG_INIT	0x1</span>
<span class="cp">#define DTCDEBUG_TRANSFER 0x2</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">dtc_abort</span><span class="p">(</span><span class="n">Scsi_Cmnd</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">dtc_biosparam</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">block_device</span> <span class="o">*</span><span class="p">,</span>
		         <span class="n">sector_t</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">dtc_detect</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_host_template</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">dtc_queue_command</span><span class="p">(</span><span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">dtc_bus_reset</span><span class="p">(</span><span class="n">Scsi_Cmnd</span> <span class="o">*</span><span class="p">);</span>

<span class="cp">#ifndef CMD_PER_LUN</span>
<span class="cp">#define CMD_PER_LUN 2</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef CAN_QUEUE</span>
<span class="cp">#define CAN_QUEUE 32 </span>
<span class="cp">#endif</span>

<span class="cp">#define NCR5380_implementation_fields \</span>
<span class="cp">    void __iomem *base</span>

<span class="cp">#define NCR5380_local_declare() \</span>
<span class="cp">    void __iomem *base</span>

<span class="cp">#define NCR5380_setup(instance) \</span>
<span class="cp">    base = ((struct NCR5380_hostdata *)(instance)-&gt;hostdata)-&gt;base</span>

<span class="cp">#define DTC_address(reg) (base + DTC_5380_OFFSET + reg)</span>

<span class="cp">#define dbNCR5380_read(reg)                                              \</span>
<span class="cp">    (rval=readb(DTC_address(reg)), \</span>
<span class="cp">     (((unsigned char) printk(&quot;DTC : read register %d at addr %p is: %02x\n&quot;\</span>
<span class="cp">    , (reg), DTC_address(reg), rval)), rval ) )</span>

<span class="cp">#define dbNCR5380_write(reg, value) do {                                  \</span>
<span class="cp">    printk(&quot;DTC : write %02x to register %d at address %p\n&quot;,         \</span>
<span class="cp">            (value), (reg), DTC_address(reg));     \</span>
<span class="cp">    writeb(value, DTC_address(reg));} while(0)</span>


<span class="cp">#if !(DTCDEBUG &amp; DTCDEBUG_TRANSFER) </span>
<span class="cp">#define NCR5380_read(reg) (readb(DTC_address(reg)))</span>
<span class="cp">#define NCR5380_write(reg, value) (writeb(value, DTC_address(reg)))</span>
<span class="cp">#else</span>
<span class="cp">#define NCR5380_read(reg) (readb(DTC_address(reg)))</span>
<span class="cp">#define xNCR5380_read(reg)						\</span>
<span class="cp">    (((unsigned char) printk(&quot;DTC : read register %d at address %p\n&quot;\</span>
<span class="cp">    , (reg), DTC_address(reg))), readb(DTC_address(reg)))</span>

<span class="cp">#define NCR5380_write(reg, value) do {					\</span>
<span class="cp">    printk(&quot;DTC : write %02x to register %d at address %p\n&quot;, 	\</span>
<span class="cp">	    (value), (reg), DTC_address(reg));	\</span>
<span class="cp">    writeb(value, DTC_address(reg));} while(0)</span>
<span class="cp">#endif</span>

<span class="cp">#define NCR5380_intr			dtc_intr</span>
<span class="cp">#define NCR5380_queue_command		dtc_queue_command</span>
<span class="cp">#define NCR5380_abort			dtc_abort</span>
<span class="cp">#define NCR5380_bus_reset		dtc_bus_reset</span>
<span class="cp">#define NCR5380_proc_info		dtc_proc_info </span>

<span class="cm">/* 15 12 11 10</span>
<span class="cm">   1001 1100 0000 0000 */</span>

<span class="cp">#define DTC_IRQS 0x9c00</span>


<span class="cp">#endif </span><span class="cm">/* DTC3280_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
